(()=>{"use strict";var e,t,n,r,o,i,a,c,s,u,l,m,d,f,p,v,g,x,y,h,b,w,T,C,E;function S(e,t,...n){const r=function(e){const t=[];for(const n of e)if(n&&"boolean"!=typeof n)if("string"==typeof n)t.push(M(n));else if(Array.isArray(n))for(const e of n)if("string"==typeof e)t.push(M(e));else{if(!e||"boolean"==typeof e)continue;t.push(e)}else t.push(n);return t.length>0?t:void 0}(n);if("string"==typeof e)return{type:"tag",attributes:null!=t?t:{},children:r,tag:e};const o=null!=t?t:{};return o.children=r,{type:"component",attributes:o,render:e}}unction A(e){var t;const n=e.geometry.positions[0],r=e.geometry.normals[0],o=e.geometry.textureCoordinates[0],i=e.geometry.ambientOcclusions[0],a=null!==(t=e.geometry.indices)&&void 0!==t?t:new Uint16Array,c=l.GenerateTangentData(n,r,o,a),u={vertexCount:n.length/3,vertices:{position:l.create(n,"vec3"),normal:l.create(r,"vec3"),textureCoordinates:l.create(o,"vec2"),ambientOcclusion:l.create(i,"float"),tangent:l.create(c,"vec3")},indices:a,layout:"triangles"};return s.createElement("geometry",{...u})}let R;var z;let P;var k,_,B;function F(e){const t=T.create(),n=B.getBlending(e.opacityTexture,e.opacity),r=k.getOrCreate(),o={anisotropicMaskTexture:z.getOrCreate(),...e,ringTexture:r},i=m.defaultStencil();return s.createElement("material",{blending:n,stencil:i},s.createElement("shader",{...t}),s.createElement("properties",{...o}))}let I;var O,N,D;function L(e){var t;const n=N.map(e.material,U,e.textures,e.overwriteTexturtes);return n.ambientOcclusionIntensity*=null!==(t=e.ambientocclusionintensity)&&void 0!==t?t:1,e.anisotropicPosition&&(n.anisotropicPosition=e.anisotropicPosition),n.lightTexture={type:"url",url:D.getURL()},s.createElement(F,{...n})}!function(e){e.create=function(e,t){return{width:e,height:t}},e.aspectRatio=e.hasValidDimension=(e||(e={})),function(e){const t=180/Math.PI,n=Math.PI/180;e.ALMOST_ONE=.998,e.EPSILON=1e-8,e.toRadians=function(e){return e*n},e.fromDegrees=e.toDegrees=e.clamp=e.lerp=e.nextPowerOf2=function(e){const t=Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)));if(!isFinite(t))throw`Next Power of 2 of ${e} is invalid`;return t},e.roundDigits=(t||(t={})),function(e){function n(e){return o.toEuler(o.fromQuaternion(e))}e.create=function(e,t,n,r){return{x:e,y:t,z:n,w:r}},e.identity=function(){return{x:0,y:0,z:0,w:1}},e.fromRotationX=function(e){const t=.5*e;return{x:Math.sin(t),y:0,z:0,w:Math.cos(t)}},e.fromRotationY=function(e){const t=.5*e;return{x:0,y:Math.sin(t),z:0,w:Math.cos(t)}},e.fromRotationZ=function(e){const t=.5*e;return{x:0,y:0,z:Math.sin(t),w:Math.cos(t)}},e.rotateX=function(e,t){const n=.5*t,r=Math.sin(n),o=Math.cos(n);return{x:e.x*o+e.w*r,y:e.y*o+e.z*r,z:e.z*o-e.y*r,w:e.w*o-e.x*r}},e.rotateY=function(e,t){const n=.5*t,r=Math.sin(n),o=Math.cos(n);return{x:e.x*o-e.z*r,y:e.y*o+e.w*r,z:e.z*o+e.x*r,w:e.w*o-e.y*r}},e.rotateZ=function(e,t){const n=.5*t,r=Math.sin(n),o=Math.cos(n);return{x:e.x*o+e.y*r,y:e.y*o-e.x*r,z:e.z*o+e.w*r,w:e.w*o-e.z*r}},e.slerp=function(e,n,r){let o,i,a,c,s,u=n.x,l=n.y,m=n.z,d=n.w;return i=e.x*u+e.y*l+e.z*m+e.w*d,i<0&&(i=-i,u=-u,l=-l,m=-m,d=-d),1-i>t.EPSILON?(o=Math.acos(i),a=Math.sin(o),c=Math.sin((1-r)*o)/a,s=Math.sin(r*o)/a):(c=1-r,s=r),{x:c*e.x+s*u,y:c*e.y+s*l,z:c*e.z+s*m,w:c*e.w+s*d}},e.multiply=function(e,t){return{x:e.x*t.w+e.w*t.x+e.y*t.z-e.z*t.y,y:e.y*t.w+e.w*t.y+e.z*t.x-e.x*t.z,z:e.z*t.w+e.w*t.z+e.x*t.y-e.y*t.x,w:e.w*t.w-e.x*t.x-e.y*t.y-e.z*t.z}},e.invert=function(e){const t=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;if(!t)return{...e};const n=1/t;return{x:-e.x*n,y:-e.y*n,z:-e.z*n,w:e.w*n}},e.toEuler=n,e.toEulerInDegrees=function(e){const r=n(e);return r.yaw=t.toDegrees(r.yaw),r.pitch=t.toDegrees(r.pitch),r.roll=t.toDegrees(r.roll),r}}(n||(n={})),function(e){e.create=function(e,t,n){return{yaw:e,pitch:t,roll:n}},e.toQuaternion=function(e){let r=n.identity();return r=n.rotateY(r,t.toRadians(e.x)),r=n.rotateX(r,t.toRadians(e.y)),r=n.rotateZ(r,t.toRadians(e.z)),r}}(r||(r={})),function(e){e.identity=e.multiply=function(e,t){return{m11:e.m11*t.m11+e.m12*t.m21+e.m13*t.m31+e.m14*t.m41,m12:e.m11*t.m12+e.m12*t.m22+e.m13*t.m32+e.m14*t.m42,m13:e.m11*t.m13+e.m12*t.m23+e.m13*t.m33+e.m14*t.m43,m14:e.m11*t.m14+e.m12*t.m24+e.m13*t.m34+e.m14*t.m44,m21:e.m21*t.m11+e.m22*t.m21+e.m23*t.m31+e.m24*t.m41,m22:e.m21*t.m12+e.m22*t.m22+e.m23*t.m32+e.m24*t.m42,m23:e.m21*t.m13+e.m22*t.m23+e.m23*t.m33+e.m24*t.m43,m24:e.m21*t.m14+e.m22*t.m24+e.m23*t.m34+e.m24*t.m44,m31:e.m31*t.m11+e.m32*t.m21+e.m33*t.m31+e.m34*t.m41,m32:e.m31*t.m12+e.m32*t.m22+e.m33*t.m32+e.m34*t.m42,m33:e.m31*t.m13+e.m32*t.m23+e.m33*t.m33+e.m34*t.m43,m34:e.m31*t.m14+e.m32*t.m24+e.m33*t.m34+e.m34*t.m44,m41:e.m41*t.m11+e.m42*t.m21+e.m43*t.m31+e.m44*t.m41,m42:e.m41*t.m12+e.m42*t.m22+e.m43*t.m32+e.m44*t.m42,m43:e.m41*t.m13+e.m42*t.m23+e.m43*t.m33+e.m44*t.m43,m44:e.m41*t.m14+e.m42*t.m24+e.m43*t.m34+e.m44*t.m44}},e.createPerspective=function(e,t,n,r){const o=1/Math.tan(e/2);return{m11:o,m12:0,m13:0,m14:0,m21:0,m22:o*t,m23:0,m24:0,m31:0,m32:0,m33:r/(r-n),m34:1,m41:0,m42:0,m43:-n*r/(r-n),m44:0}},e.createView=function(t,n,r,o){const a=e.identity();return a.m11=r.x,a.m21=r.y,a.m31=r.z,a.m41=-i.dot(r,o),a.m12=n.x,a.m22=n.y,a.m32=n.z,a.m42=-i.dot(n,o),a.m13=t.x,a.m23=t.y,a.m33=t.z,a.m43=-i.dot(t,o),a},e.transformVector3=function(e,t){const n=t.x*e.m11+t.y*e.m21+t.z*e.m31+e.m41,r=t.x*e.m12+t.y*e.m22+t.z*e.m32+e.m42,o=t.x*e.m13+t.y*e.m23+t.z*e.m33+e.m43,a=n,c=r;return i.create(a,c,o)},e.fromAxisAngle=function(e,n){n=t.toRadians(n);var r=Math.sin(n),o=Math.cos(n),i=e.x*e.x,a=e.y*e.y,c=e.z*e.z,s=e.x*e.y,u=e.x*e.z,l=e.y*e.z;return{m11:i+o*(1-i),m12:s-o*s+r*e.z,m13:u-o*u-r*e.y,m14:0,m21:s-o*s-r*e.z,m22:a+o*(1-a),m23:l-o*l+r*e.x,m24:0,m31:u-o*u+r*e.y,m32:l-o*l-r*e.x,m33:c+o*(1-c),m34:0,m41:0,m42:0,m43:0,m44:1}},e.fromQuaternion=function(t){const{x:n,y:r,z:o,w:i}=t,a=n+n,c=r+r,s=o+o,u=n*a,l=r*a,m=r*c,d=o*a,f=o*c,p=o*s,v=i*a,g=i*c,x=i*s,y=e.identity();return y.m11=1-m-p,y.m21=l-x,y.m31=d+g,y.m41=0,y.m12=l+x,y.m22=1-u-p,y.m32=f-v,y.m42=0,y.m13=d-g,y.m23=f+v,y.m33=1-u-m,y.m43=0,y.m14=0,y.m24=0,y.m34=0,y.m44=1,y},e.toArray=function(e){return[e.m11,e.m21,e.m31,e.m41,e.m12,e.m22,e.m32,e.m42,e.m13,e.m23,e.m33,e.m43,e.m14,e.m24,e.m34,e.m44]},e.invert=function(t){let n=t.m11,r=t.m21,o=t.m31,i=t.m41,a=t.m12,c=t.m22,s=t.m32,u=t.m42,l=t.m13,m=t.m23,d=t.m33,f=t.m43,p=t.m14,v=t.m24,g=t.m34,x=t.m44,y=n*c-r*a,h=n*s-o*a,b=n*u-i*a,w=r*s-o*c,T=r*u-i*c,C=o*u-i*s,E=l*v-m*p,S=l*g-d*p,M=l*x-f*p,A=m*g-d*v,R=m*x-f*v,z=d*x-f*g,P=y*z-h*R+b*A+w*M-T*S+C*E;if(!P)return;P=1/P;const k=e.identity();return k.m11=(c*z-s*R+u*A)*P,k.m21=(o*R-r*z-i*A)*P,k.m31=(v*C-g*T+x*w)*P,k.m41=(d*T-m*C-f*w)*P,k.m12=(s*M-a*z-u*S)*P,k.m22=(n*z-o*M+i*S)*P,k.m32=(g*b-p*C-x*h)*P,k.m42=(l*C-d*b+f*h)*P,k.m13=(a*R-c*M+u*E)*P,k.m23=(r*M-n*R-i*E)*P,k.m33=(p*T-v*b+x*y)*P,k.m43=(m*b-l*T-f*y)*P,k.m14=(c*S-a*A-s*E)*P,k.m24=(n*A-r*S+o*E)*P,k.m34=(v*h-p*w-g*y)*P,k.m44=(l*w-m*h+d*y)*P,k},e.translate=function(e,t){return{m11:e.m11,m12:e.m12,m13:e.m13,m14:e.m14,m21:e.m21,m22:e.m22,m23:e.m23,m24:e.m24,m31:e.m31,m32:e.m32,m33:e.m33,m34:e.m34,m41:e.m41+t.x,m42:e.m42+t.y,m43:e.m43+t.z,m44:e.m44}},e.rotate=function(t,n,r){const o=1/i.length(r),a=r.x*o,c=r.y*o,s=r.z*o,u=Math.sin(n),l=Math.cos(n),m=1-l,d=t.m11,f=t.m21,p=t.m31,v=t.m41,g=t.m12,x=t.m22,y=t.m32,h=t.m42,b=t.m13,w=t.m23,T=t.m33,C=t.m43,E=a*a*m+l,S=c*a*m+s*u,M=s*a*m-c*u,A=a*c*m-s*u,R=c*c*m+l,z=s*c*m+a*u,P=a*s*m+c*u,k=c*s*m-a*u,_=s*s*m+l,B=e.identity();return B.m11=d*E+g*S+b*M,B.m21=f*E+x*S+w*M,B.m31=p*E+y*S+T*M,B.m41=v*E+h*S+C*M,B.m12=d*A+g*R+b*z,B.m22=f*A+x*R+w*z,B.m32=p*A+y*R+T*z,B.m42=v*A+h*R+C*z,B.m13=d*P+g*k+b*_,B.m23=f*P+x*k+w*_,B.m33=p*P+y*k+T*_,B.m43=v*P+h*k+C*_,B.m14=t.m14,B.m24=t.m24,B.m34=t.m34,B.m44=t.m44,B},e.toEuler=function(e){const{m11:n,m12:o,m22:i,m31:a,m32:c,m33:s}=e,u=Math.asin(t.clamp(-c,-1,1));if(Math.abs(c)<t.ALMOST_ONE){const e=Math.atan2(a,s),t=Math.atan2(o,i);return r.create(e,u,t)}{const e=Math.atan2(-a,n),t=0;return r.create(e,u,t)}}}(o||(o={})),function(e){function n(e,t){return{x:e.x*t,y:e.y*t,z:e.z*t}}unction i(t){let n=e.create(0,1,0);const r=e.dot(n,t);return r>.99?n=e.create(0,0,-1):r<-.99&&(n=e.create(0,0,1)),e.normalize(e.cross(n,t))}.isVector3=e.zero=function(){return{x:0,y:0,z:0}},e.fromArray=function(t,n){return e.create(t[n],t[n+1],t[n+2])},e.setFromArray=function(t,n,r){return e.set(t,n[r],n[r+1],n[r+2])},e.set=e.create=function(e,t,n){return{x:e,y:t,z:n}},e.center=function(e,t){return{x:.5*(e.x+t.x),y:.5*(e.y+t.y),z:.5*(e.z+t.z)}},e.subtract=function(e,t){return{x:e.x-t.x,y:e.y-t.y,z:e.z-t.z}},e.subtractScalar=function(e,t){return{x:e.x-t,y:e.y-t,z:e.z-t}},e.add=e.addScalar=function(e,t){return{x:e.x+t,y:e.y+t,z:e.z+t}},e.multiplyScalar=n,e.multiply=function(e,t){return{x:e.x*t.x,y:e.y*t.y,z:e.z*t.z}},e.divideScalar=function(e,t){return n(e,1/t)},e.distance=function(t,n){return e.length(e.subtract(t,n))},e.lengthSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z},e.length=r,e.normalize=function(e){return n(e,1/r(e))},e.lerp=e.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},e.cross=function(e,t){return{x:e.y*t.z-e.z*t.y,y:e.z*t.x-e.x*t.z,z:e.x*t.y-e.y*t.x}},e.transformByQuaternion=function(e,t){let n=t.y*e.z-t.z*e.y,r=t.z*e.x-t.x*e.z,o=t.x*e.y-t.y*e.x,i=t.y*o-t.z*r,a=t.z*n-t.x*o,c=t.x*r-t.y*n;const s=2*t.w;return n*=s,r*=s,o*=s,i*=2,a*=2,c*=2,{x:e.x+n+i,y:e.y+r+a,z:e.z+o+c}},e.transformByMatrix=function(t,n){const r=e.zero();return r.x=t.x*n.m11+t.y*n.m21+t.z*n.m31+n.m41,r.y=t.x*n.m12+t.y*n.m22+t.z*n.m32+n.m42,r.z=t.x*n.m13+t.y*n.m23+t.z*n.m33+n.m43,r},e.isFiniteVector=e.getAxisFromNormal=function(e,t=0){let n=i(e),r=a(e,n);if(t){const i=o.fromAxisAngle(e,t);n=o.transformVector3(i,n),r=o.transformVector3(i,r)}return{up:r,right:n,forward:e}},e.getTangent=i,e.getBitangent=a}(i||(i={})),function(e){function t(e){return e.max.x-e.min.x}function n(e){return e.max.y-e.min.y}.create=function(e,t){return{min:e,max:t}},e.fromBoundingSphere=function(e){return{min:i.subtractScalar(e.center,e.radius),max:i.addScalar(e.center,e.radius)}},e.fromPositions=function(e){const t={min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}};for(let n=0;n<e.length;n+=3){const r=e[n],o=e[n+1],i=e[n+2];t.min.x=Math.min(t.min.x,r),t.min.y=Math.min(t.min.y,o),t.min.z=Math.min(t.min.z,i),t.max.x=Math.max(t.max.x,r),t.max.y=Math.max(t.max.y,o),t.max.z=Math.max(t.max.z,i)}return t},e.fromCombinedPositions=e.fromBoundingBoxes=function(e){const t={min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}};for(const n of e)t.min.x=Math.min(t.min.x,n.min.x),t.min.y=Math.min(t.min.y,n.min.y),t.min.z=Math.min(t.min.z,n.min.z),t.max.x=Math.max(t.max.x,n.max.x),t.max.y=Math.max(t.max.y,n.max.y),t.max.z=Math.max(t.max.z,n.max.z);return t},e.width=t,e.height=n,e.depth=r,e.translate=function(e,t){return{min:i.add(e.min,t),max:i.add(e.max,t)}},e.center=e.getLargestDimensionArea=function(e){const o=t(e)*n(e),i=t(e)*r(e),a=n(e)*r(e);return Math.max(Math.max(o,i),a)}}(a||(a={})),function(e){.create=n,e.fromBoundingBox=function(e){const t=i.center(e.min,e.max),r=e.max.x-t.x,o=e.max.z-t.z;return n(t,Math.sqrt(r*r+o*o),a.height(e))},e.optimalZoomDistance=function(e,n,r){const o=Math.tan(.5*t.fromDegrees(n)),i=Math.tan(.5*t.fromDegrees(n/r)),a=e.radius/o,c=e.height/2/i+e.radius;return Math.max(c,a)}}(c||(c={})),function(e){e.createElement=S,e.createComponent=function(e,t){return{...S(e,t),context:"3d"}}}(s||(s={})),function(e){function n(e,t){return{x:e,y:t}}e.isVector2=function(e){return void 0!==e&&"number"==typeof e.x&&"number"==typeof e.y},e.zero=function(){return{x:0,y:0}},e.fromArray=function(t,n=0){return e.create(t[n],t[n+1])},e.create=n,e.center=function(e,t){return{x:.5*(e.x+t.x),y:.5*(e.y+t.y)}},e.subtract=e.subtractScalar=function(e,t){return{x:e.x-t,y:e.y-t}},e.add=e.addScalar=function(e,t){return{x:e.x+t,y:e.y+t}},e.multiply=e.multiplyScalar=e.mirrorX=e.mirrorY=function(e){return{x:-e.x,y:e.y}},e.divideScalar=function(t,n){return e.multiplyScalar(t,1/n)},e.distance=e.lengthSquared=e.length=e.normalize=function(t){const n=e.length(t);return e.multiplyScalar(t,1/n)},e.dot=e.cross=e.lerp=function(e,n,r){return{x:t.lerp(e.x,n.x,r),y:t.lerp(e.y,n.y,r)}},e.transformByMatrix=function(e,t){return n(t.m11*e.x+t.m12*e.y+t.m13,t.m21*e.x+t.m22*e.y+t.m23)}}(u||(u={})),function(e){.create=t,e.fromArray=e.GenerateTangentData=function(e,t,n,r){for(var o=e.length/3,a=new Float32Array(o),c=new Float32Array(o),s=new Float32Array(o),l=new Float32Array(o),m=new Float32Array(o),d=new Float32Array(o),f=0;f<r.length;){var p=r[f],v=r[f+1],g=r[f+2],x=i.fromArray(e,3*p),y=i.fromArray(e,3*v),h=i.fromArray(e,3*g),b=u.fromArray(n,2*p),w=u.fromArray(n,2*v),T=u.fromArray(n,2*g),C=i.subtract(y,x),E=i.subtract(h,x),S=u.create(w.x-b.x,w.y-b.y),M=u.create(T.x-b.x,T.y-b.y),A=1/(S.x*M.y-M.x*S.y),R=(M.y*C.x-S.y*E.x)*A,z=(M.y*C.y-S.y*E.y)*A,P=(M.y*C.z-S.y*E.z)*A,k=(S.x*E.x-M.x*C.x)*A,_=(S.x*E.y-M.x*C.y)*A,B=(S.x*E.z-M.x*C.z)*A;a[p]+=R,c[p]+=z,s[p]+=P,a[v]+=R,c[v]+=z,s[v]+=P,a[g]+=R,c[g]+=z,s[g]+=P,l[p]+=k,m[p]+=_,d[p]+=B,l[v]+=k,m[v]+=_,d[v]+=B,l[g]+=k,m[g]+=_,d[g]+=B,f+=3}var F=new Float32Array(3*o),I=i.create(0,0,0),O=i.create(0,0,0);for(let e=0;e<o;e++){var N=i.fromArray(t,3*e);I.x=a[e],I.y=c[e],I.z=s[e],O.x=l[e],O.y=m[e],O.z=d[e];var D=i.dot(I,N),L=N.x*D,U=N.y*D,G=N.z*D;I.x-=L,I.y-=U,I.z-=G,0==I.x&&0==I.y&&0==I.z||(I=i.normalize(I));var V=i.cross(N,I);i.dot(V,O)<0&&(I.x*=-1,I.y*=-1,I.z*=-1),F[3*e]=I.x,F[3*e+1]=I.y,F[3*e+2]=I.z}return F}}(l||(l={})),function(e){e.defaultStencil=function(){return{writeMask:255,comparison:{function:"always",ref:1,mask:255},operation:{fail:"keep",zFail:"keep",zPass:"replace"}}},e.equal=function(e,t){return e===t||void 0!==e&&void 0!==t&&e.comparison.function===t.comparison.function&&e.comparison.mask===t.comparison.mask&&e.comparison.ref===t.comparison.ref&&e.operation.fail===t.operation.fail&&e.operation.zFail===t.operation.zFail&&e.operation.zPass===t.operation.zPass&&e.writeMask===t.writeMask}}(m||(m={})),function(e){e.isTexture=e.toCode=function(e){let t="";for(const n in e)switch(e[n].type){case"float":t+=`uniform float ${n};\n`;break;case"texture":t+=`uniform sampler2D ${n};\n`,t+=`uniform bool ${n}Set;\n`;break;case"cubemap":t+=`uniform samplerCube ${n};\n`,t+=`uniform bool ${n}Set;\n`;break;case"boolean":t+=`uniform bool ${n};\n`;break;case"vector3":t+=`uniform vec3 ${n};\n`;break;case"vector2":t+=`uniform vec2 ${n};\n`;break;case"color":t+=`uniform vec4 ${n};\n`;break;case"vector3[]":t+=`uniform vec3 ${n}[9];\n`}return t}}(d||(d={})),function(e){function t(e){let n=e.uniforms;if(void 0!==e.snippets)for(let r of Object.values(e.snippets))n={...n,...t(r)};return n}function n(e){let t="";if(e.snippets)for(const r of Object.values(e.snippets))t+=n(r);return t+=e.code,t}e.getShaderUniforms=t,e.toCode=function(e){let r="\n";const o=t(e);if(r+=d.toCode(o),e.snippets)for(const t of Object.values(e.snippets))r+=n(t);return r+=e.code,r}}(f||(f={})),function(e){e.white=function(){return{r:255,g:255,b:255}},e.black=function(){return{r:0,g:0,b:0}},e.toHex=function(e){return`#${((1<<24)+(e.r<<16)+(e.g<<8)+e.b).toString(16).slice(1)}`},e.fromHex=function(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:void 0},e.fromHSV=function(e){let t=e.h%360/60;const n=Math.floor(t),r=n%6,o=t-n,i=Math.round(e.v/100*255),a=e.s/100,c=Math.round(i*(1-a)),s=Math.round(i*(1-o*a)),u=Math.round(i*(1-(1-o)*a));switch(r){case 0:return{r:i,g:u,b:c};case 1:return{r:s,g:i,b:c};case 2:return{r:c,g:i,b:u};case 3:return{r:c,g:s,b:i};case 4:return{r:u,g:c,b:i};case 5:return{r:i,g:c,b:s};default:throw Error("Hue value is invalid.")}}}(p||(p={})),function(e){unction n(e,t,n,r){return{r:e,g:t,b:n,a:r}}e.black=function(){return t(0,0,0)},e.white=function(){return t(255,255,255)},e.hotPink=e.transparent=e.rgb=t,e.rgba=n,e.toHex=function(e){let t=Math.min(Math.round(255*e.a),255).toString(16);return 1===t.length&&(t="0"+t),p.toHex({r:e.r,g:e.g,b:e.b})+t},e.fromHex=function(e){var t;const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);if(n)return{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16),a:parseInt(null!==(t=n[4])&&void 0!==t?t:"ff",16)/255}}}(v||(v={})),function(e){e.create=function(){return{uniforms:{ambientOcclusionTextureBias:{type:"float",default:0},ambientOcclusionIntensity:{type:"float",default:1},ambientOcclusionTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nfloat getAmbientOcclusion(float vertexAmbientOcclusion, vec2 textureCoordinate){\n\tfloat ambientOcclusion = vertexAmbientOcclusion;\n\tif(ambientOcclusionTextureSet){\n\t\tambientOcclusion *= texture(ambientOcclusionTexture, textureCoordinate, ambientOcclusionTextureBias).x;\n\t}\n\n\tambientOcclusion = 1.0 - ((1.0 - ambientOcclusion) * ambientOcclusionIntensity);\n\tambientOcclusion = clamp(ambientOcclusion, 0.0, 1.0);\n\treturn ambientOcclusion;\n}\n"}}}(g||(g={})),function(e){e.create=function(){return{uniforms:{anisotropicMaskTextureBias:{type:"float",default:0},anisotropicMaskAntiAliasing:{type:"float",default:0},anisotropicMaskTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\n\nfloat getAnisotropicMask(vec2 textureCoordinate)\n{\n\tif(!anisotropicMaskTextureSet) return 1.0;\n\t\n\tfloat maskFromTexture = texture(anisotropicMaskTexture, textureCoordinate, anisotropicMaskTextureBias).x;\n\tif(!opacityMasked) return maskFromTexture;\n\t\n\tfloat minMask = 0.5 - anisotropicMaskAntiAliasing;\n\tfloat spanMask = 2.0 * anisotropicMaskAntiAliasing;\n\t\n\t// Calculate the normalized mask.\n\tfloat normalizedMask = (maskFromTexture - minMask) / spanMask;\n\t\n\t// Saturate.\n\tnormalizedMask = clamp(normalizedMask, 0.0, 1.0);\n\n\t// Apply to the mask value.\n\treturn maskFromTexture * normalizedMask;\n}"}}}(x||(x={})),function(e){e.create=function(){return{uniforms:{},code:"\nuniform bool clippingEnabled;\n\nvoid applyClipping(vec3 clipPosition){\n\tif(clippingEnabled){\n\t\tvec3 normalizedClipSpace = clipPosition * vec3(0.5, -0.5, 1) + vec3(0.5, 0.5, 0);\n\t\tfloat min = min(min(normalizedClipSpace.x, normalizedClipSpace.y), normalizedClipSpace.z);\n\t\tfloat max = max(max(normalizedClipSpace.x, normalizedClipSpace.y), normalizedClipSpace.z);\n\t\tif(min < 0.0 || max > 1.0) discard;\n\t}\n}\n"}}}(y||(y={})),function(e){e.create=function(){return{uniforms:{},code:"\nuniform mat4 clippingProjection;\nuniform bool clippingEnabled;\n\nvoid calculateClippingPosition(vec3 modelPosition, vec2 modelTextureCoordinate, out vec3 clipPosition, out vec2 clipTextureCoordinate){\n\tif(clippingEnabled){\n\t\tvec4 projected = vec4(modelPosition, 1.0) * clippingProjection;\n\t\tclipPosition = projected.xyz / projected.w;\n\t\tclipTextureCoordinate = clipPosition.xy * vec2(0.5, -0.5) + vec2(0.5, 0.5);\n\t}else{\n\t\tclipPosition = modelPosition;\n\t\tclipTextureCoordinate = modelTextureCoordinate;\n\t}\n}\n"}}}(h||(h={})),function(e){e.create=function(){return{uniforms:{lightTexture:{type:"texture",sampler:{wrapS:"clampToEdge",wrapT:"clampToEdge",mipmapping:!1}}},code:"\n\nvec4 calculateOffset(float i)\n{\n\t// Define the offsets, containing:\n\t// x = offset in u direction\n\t// y = offset in v direction\n\t// z = scaling in u and v direction\n\t// w = u offset of front (right) related to back (left)\n\n\t// Define the offset.\n\tvec4 offset;\n\n\t// Calculate x.\n\toffset.x = fract(max(i - 2.0, 0.0) * 0.25);\n\n\t// Calculate y.\n\toffset.y = dot(clamp(i - vec3(0.0, 1.0, 5.0), 0.0, 1.0), vec3(0.5, 0.25, 0.125));\n\t\n\t// Calculate the size.\n\toffset.z = 0.125 + max(3.0 - 2.0 * i, 0.0) * 0.125;\n\toffset.w = offset.z;\n\t\n\t// Add/subtract pixels and return.\n\treturn offset + vec4(0.000976563, 0.000976563, -0.001953125, 0);\n}\n\nvec3 decodeGrM(vec2 grm)\n{\n\tfloat m = grm.g * 6.0 + 1.0;\n\treturn grm.rrr * m;\n}\n\nvec3 sampleRadiance(vec3 worldReflect, float gloss)\n{\n\tif(!lightTextureSet){\n\t\treturn vec3(0.5);\n\t}\n\t\n\t// Calculate front coordinates.\n\tvec2 uv = (worldReflect.xy / (2.0 * (1.0 + abs(worldReflect.zz)))) + 0.5;\n\tuv.y = 1.0 - uv.y;\n\n\t// Get 0 for back (left) and 1 for front (right).\n\tfloat side = sign(worldReflect.z);\n\tside = clamp(side, 0.0, 1.0);\n\t\n\t// Calculate which mipmap should be used.\n\tfloat mipmap = (1.0 - gloss) * 6.0;\n\n\t// Pick the right offset.\n\tvec4 offsetLow = calculateOffset(floor(mipmap));\n\tvec4 offsetHigh = calculateOffset(ceil(mipmap));\n\n\t// Apply offset.\n\tvec2 uvLow = uv * offsetLow.zz + vec2(offsetLow.x + side * offsetLow.w, offsetLow.y);\n\tvec2 uvHigh = uv * offsetHigh.zz + vec2(offsetHigh.x + side * offsetHigh.w, offsetHigh.y);\n\n\t// Sample.\n\tvec3 lowGrM  = decodeGrM(texture(lightTexture, uvLow).rg);\n\tvec3 highGrM = decodeGrM(texture(lightTexture, uvHigh).rg);\n\n\t// Lerp between the two samples.\n\treturn mix(lowGrM, highGrM, fract(mipmap));\n}\n\nconst vec4 irradianceOffset = vec4(0.5009766, 0.5009766, 0.2480469, 0.25);\n\nvec3 sampleIrradiance(vec3 normal)\n{\n\tif(!lightTextureSet){\n\t\treturn vec3(0.5);\n\t}\n\t// Calculate front coordinates.\n\tvec2 uv = (normal.xy / (2.0 * (1.0 + abs(normal.zz)))) + 0.5;\n\tuv.y = 1.0 - uv.y;\n\n\t// Get 0 for back (left) and 1 for front (right).\n\tfloat side = sign(normal.z);\n\tside = clamp(side, 0.0, 1.0);\n\t\n\t// Apply offset.\n\tuv = uv * irradianceOffset.zz + vec2(irradianceOffset.x + side * irradianceOffset.w, irradianceOffset.y);\n\n\t// Sample.\n\treturn decodeGrM(texture(lightTexture, uv).rg);\n}\n"}}}(b||(b={})),function(e){e.create=function(){return{uniforms:{opacityTextureBias:{type:"float",default:0},opacity:{type:"float",default:1},opacityMasked:{type:"boolean",default:!1},maskAntiAliasing:{type:"float",default:0},opacityTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nuniform bool blendingEnabled;\n\nvec2 getOpacityMask(vec2 textureCoordinate)\n{\n\tif(!blendingEnabled) return vec2(1, 1);\n\tif(!opacityTextureSet) return vec2(opacity, 1);\n\t\n\tfloat opacityFromTexture = texture(opacityTexture, textureCoordinate, opacityTextureBias).x;\n\tif(!opacityMasked) return vec2(opacityFromTexture * opacity, 1);\n\t\n\t// Calculate min and span.\n\tfloat minMask = 0.5 - maskAntiAliasing;\n\tfloat spanMask = 2.0 * maskAntiAliasing;\n\n\t// Calculate the normalized mask.\n\tfloat mask = (opacityFromTexture  - minMask) / spanMask;\n\t\n\t// Saturate.\n\tmask = clamp(mask, 0.0, 1.0);\n\t\n\t// TODO use a discard here?\n\t// if (mask <= 0.0) discard;\n\treturn vec2(opacity, mask);\n}"}}}(w||(w={})),function(e){let t;e.create=function(){if(!t){const e=C.create(),n=E.create(),r={...f.getShaderUniforms(e),...f.getShaderUniforms(n)};t={vertex:f.toCode(e),fragment:f.toCode(n),uniforms:r,id:"shader-anisotropicConcentric"}}return t}}(T||(T={})),function(e){e.create=function(){return{uniforms:{textureRepeat:{type:"float",default:1},anisotropicPosition:{type:"vector3",default:{x:0,y:0,z:0}}},snippets:{calculateClipping:h.create()},code:"\nuniform mat4 nodeWorld;\nuniform mat4 cameraViewProjection;\nuniform float depthOffset;\n\nout vec4 v_worldPosition;\nout vec3 v_worldNormal;\nout vec2 v_textureCoordinate;\nout float v_vertexAmbientOcclusion;\nout vec4 v_worldAnisotropicPosition;\nout vec3 v_clipPosition;\n\nvoid main(){\n\tcalculateClippingPosition(position, textureCoordinate, v_clipPosition, v_textureCoordinate);\n\t\n\tv_worldPosition = vec4(position, 1.0) * nodeWorld;\n\tgl_Position = v_worldPosition * cameraViewProjection;\n\tgl_Position.z += depthOffset;\n\t\n\tv_worldNormal = (vec4(normal, 0.0) * nodeWorld).xyz;\n\t\n\tv_textureCoordinate *= textureRepeat;\n\tv_vertexAmbientOcclusion = ambientOcclusion;\n\n\tv_worldAnisotropicPosition = vec4(anisotropicPosition, 1.0) * nodeWorld;\n}"}}}(C||(C={})),function(e){e.create=function(){return{uniforms:{gloss:{type:"float",default:1},diffuseColor:{type:"color",default:v.white()},specularity:{type:"color",default:v.white()},anisotropicPosition:{type:"vector3",default:i.zero()},ringCount:{type:"float",default:0},bumpiness:{type:"float",default:0},ringTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},snippets:{opacityMask:w.create(),ambientOcclusion:g.create(),anisotropicMask:x.create(),lighting:b.create(),applyClipping:y.create()},code:"\nin vec4 v_worldPosition;\nin vec3 v_worldNormal;\nin vec2 v_textureCoordinate;\nin float v_vertexAmbientOcclusion;\nin vec4 v_worldAnisotropicPosition;\nin vec3 v_clipPosition;\n\nuniform vec3 cameraPosition;\n\nout vec4 fragColor;\n\nvoid main(){\n\tapplyClipping(v_clipPosition);\n\n\tvec2 opacityMask = getOpacityMask(v_textureCoordinate);\n\n\tvec3 worldNormal = normalize(v_worldNormal);\n\n\tvec3 direction = v_worldPosition.xyz - v_worldAnisotropicPosition.xyz;\n\tfloat distance = length(direction);\n\tdirection /= distance;\n\n\tdirection *= bumpiness;\n\n\tvec3 outwardDirection = normalize(worldNormal + direction);\n\tvec3 inwardDirection = normalize(worldNormal - direction);\n\t\n\tfloat ambientOcclusion = getAmbientOcclusion(v_vertexAmbientOcclusion, v_textureCoordinate);\n\n\tvec3 worldView = normalize(v_worldPosition.xyz - cameraPosition);\n\tvec3 worldReflectA = reflect(worldView, outwardDirection);\n\tvec3 worldReflectB = reflect(worldView, inwardDirection);\n\n\tfloat anisotropicMask = getAnisotropicMask(v_textureCoordinate);\n\n\tif(ringTextureSet && ringCount > 0.0){\n\t\tfloat ringMask = texture(ringTexture, vec2(distance * ringCount, 0.5)).x;\n\t\tanisotropicMask *= ringMask;\n\t}\n\n\tvec3 radianceA = sampleRadiance(worldReflectA, gloss);\n\tvec3 radianceB = sampleRadiance(worldReflectB, gloss);\n\tvec3 radiance = mix(radianceA, radianceB, anisotropicMask);\n\n\tvec3 irradianceA = sampleIrradiance(outwardDirection);\n\tvec3 irradianceB = sampleIrradiance(inwardDirection);\n\tvec3 irradiance = mix(irradianceA, irradianceB, anisotropicMask);\n\n\tfragColor = vec4((diffuseColor.rgb * irradiance + specularity.rgb * radiance) * ambientOcclusion, opacityMask.x) * opacityMask.y;\n}"}}}(E||(E={})),function(e){function t(){const e=new Uint8ClampedArray(4);return e[0]=128,e[1]=128,e[2]=128,e[3]=255,{pixels:e,width:1,height:1}}e.getOrCreate=function(){return R||(R={type:"pixelData",data:t()}),R}}(z||(z={})),function(e){function t(){const e=new Uint8ClampedArray(1024);let t=0;for(let n=0;n<2;n++)for(let n=0;n<128;n++)(n<32||n>96)&&(e[t]=255,e[t+1]=255,e[t+2]=255,e[t+3]=255),t+=4;return{pixels:e,width:128,height:2}}e.getOrCreate=function(){return P||(P={type:"pixelData",data:t()}),P}}(k||(k={})),function(e){e.premultiplied=(_||(_={})),function(e){e.getBlending=function(e,t,n){return void 0!==e||void 0!==t&&1!=t||void 0!==n?_.premultiplied():void 0}}(B||(B={})),function(e){function t(){const e=new Uint8Array(262144);let t=0;for(let i=0;i<65536;i++){var n=Math.sin(i),r=1e4*n;r-=0|r;var o=568453*n;o-=0|o,e[t++]=255*r|0,e[t++]=255*o|0,e[t++]=255,e[t++]=255}return{pixels:new Uint8ClampedArray(e),width:256,height:256}}e.getOrCreate=function(){return I||(I={type:"pixelData",data:t()}),I}}(O||(O={})),function(e){function t(e,t,n){const r=n[e];if(r)return r;const o=t.find(();return o?-1!==o.path.toLowerCase().indexOf("sparklenoisemap")?[O.getOrCreate(),-2]:[{url:o.path,type:"url"},o.bias]:void 0}e.map=function(e,n,r,o){const i=function(e,t){const n={};for(const r in e.booleans){const o=t.booleans[r];if(void 0===o)continue;const i=e.booleans[r];n[o]=i}return n}(e,n),a=function(e,n,r,o){const i={};for(const a in e.maps){const c=n.maps[a];if(void 0===c)continue;const s=`${c}Bias`,u=e.maps[a];if(!u)continue;const l=t(u,r,o);l&&(i[c]=l[0],i[s]=l[1])}return i}(e,n,r,o),c=function(e,t){const n={};for(const r in e.colors){const o=t.colors[r];if(void 0===o)continue;const i=e.colors[r];n[o]=i}return n}(e,n),s=function(e,t){const n={};for(const r in e.values){const o=t.values[r];if(void 0===o)continue;const i=e.values[r];n[o]=i}return n}(e,n),u=function(e,t){const n={};for(const r in e.vector2s){const o=t.vector2s[r];if(void 0===o)continue;const i=e.vector2s[r];n[o]=i}return n}(e,n);return{...i,...a,...c,...s,...u}}}(N||(N={})),D||(D={}));const U={booleans:{mask:"opacityMasked"},colors:{diffuse:"diffuseColor",specularity:"specularity"},maps:{ambientocclusion:"ambientOcclusionTexture",anisotropicmask:"anisotropicMaskTexture",opacity:"opacityTexture"},values:{ambientocclusionintensity:"ambientOcclusionIntensity",ambientocclusiontexturebias:"ambientOcclusionTextureBias",anisotropicmaskantialiasing:"anisotropicMaskAntiAliasing",anisotropicmasktexturebias:"anisotropicMaskTextureBias",bumpiness:"bumpiness",gloss:"gloss",maskantialiasing:"maskAntiAliasing",opacity:"opacity",opacitytexturebias:"opacityTextureBias",ringcount:"ringCount",texturerepeat:"textureRepeat"},vector2s:{}};var G,V,H,j,W,X;let $;var q;function Y(e){const t=j.create(),n=B.getBlending(e.opacityTexture,e.opacity),r={normalTexture:q.getOrCreate(),...e},o=m.defaultStencil();return s.createElement("material",{blending:n,stencil:o},s.createElement("shader",{...t}),s.createElement("properties",{...r}))}function Z(e){var t;const n=N.map(e.material,Q,e.textures,e.overwriteTexturtes);return n.ambientOcclusionIntensity*=null!==(t=e.ambientocclusionintensity)&&void 0!==t?t:1,n.lightTexture={type:"url",url:D.getURL()},s.createElement(Y,{...n})}!function(e){e.create=function(){return{uniforms:{diffuseTextureBias:{type:"float",default:0},diffuseTextureIntensity:{type:"float",default:1},diffuseColor:{type:"color",default:v.white()},diffuseTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nvec3 getDiffuse(vec2 textureCoordinate){\n\tif(diffuseTextureSet){\n\t\tvec3 diffuseFromTexture = texture(diffuseTexture, textureCoordinate, diffuseTextureBias).rgb;\n\t\treturn mix(diffuseColor.rgb, diffuseColor.rgb * diffuseFromTexture, diffuseTextureIntensity);\n\t}else{\n\t\treturn diffuseColor.rgb;\n\t}\n}\n"}}}(G||(G={})),function(e){e.create=function(){return{uniforms:{normalTextureBias:{type:"float",default:0},bumpiness:{type:"float",default:1},normalTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\n\nvec3 calculateNormal(vec3 normalFromTexture, vec3 normal, vec3 tangent, vec3 binormal, float bumpiness)\n{\n\tnormalFromTexture *= bumpiness;\n\tnormalFromTexture.z = abs(normalFromTexture.z);\n\n\tvec3 result = -normalFromTexture.x * tangent + -normalFromTexture.y * binormal + normalFromTexture.z * normal;\n\n\treturn normalize(normal + result);\n}\n\nvec3 getNormal(vec3 worldPosition, vec3 worldNormal, vec2 textureCoordinate, vec3 cameraPosition){\n\tvec3 normalizedWorldNormal = normalize(worldNormal);\n\n\tif(normalTextureSet){\n\t\tvec3 denormTangent = dFdx(textureCoordinate.y) * dFdy(worldPosition.xyz) - dFdx(worldPosition.xyz) * dFdy(textureCoordinate.y);\n\t\tvec3 tangent = normalize(denormTangent - worldNormal * dot(worldNormal, denormTangent));\n\t\tvec3 binormal = cross(normalizedWorldNormal, tangent);\n\n\t\tvec3 normalFromTexture = texture(normalTexture, textureCoordinate, normalTextureBias).xyz;\n\t\tnormalFromTexture.xy = normalFromTexture.xy * 2.0 - 1.0;\n\t\treturn calculateNormal(normalFromTexture, normalizedWorldNormal, tangent, binormal, bumpiness);\n\t}else{\n\t\treturn normalizedWorldNormal;\n\t}\n}\n"}}}(V||(V={})),function(e){e.create=function(){return{uniforms:{specularity:{type:"color",default:v.white()},specularityTextureBias:{type:"float",default:0},specularityTextureIntensity:{type:"float",default:1},specularityTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\n\nvec3 getSpecularity(vec2 textureCoordinate){\n\tif(specularityTextureSet){\n\t\tvec3 specularFromTexture = texture(specularityTexture, textureCoordinate, specularityTextureBias).rgb;\n\t\treturn mix(specularity.rgb, specularity.rgb * specularFromTexture, specularityTextureIntensity);\n\t}else{\n\t\treturn specularity.rgb;\n\t}\n}\n"}}}(H||(H={})),function(e){let t;e.create=function(){if(!t){const e=W.create(),n=X.create(),r={...f.getShaderUniforms(e),...f.getShaderUniforms(n)};t={vertex:f.toCode(e),fragment:f.toCode(n),uniforms:r,id:"shader-anisotropic"}}return t}}(j||(j={})),function(e){e.create=function(){return{uniforms:{textureRepeat:{type:"float",default:1},anisotropicTextureOffset:{type:"vector2",default:u.zero()},anisotropicTextureRepeat:{type:"vector2",default:u.zero()},separateAnisotropicTextureTransform:{type:"boolean",default:!1}},snippets:{calculateClipping:h.create()},code:"\nuniform mat4 nodeWorld;\nuniform mat4 cameraViewProjection;\nuniform float depthOffset;\n\nout vec4 v_worldPosition;\nout vec3 v_worldNormal;\nout vec2 v_textureCoordinate;\nout float v_vertexAmbientOcclusion;\nout vec2 v_anisoTextureCoordinate;\nout vec3 v_clipPosition;\n\nvoid main(){\n\tvec2 clippedTextureCoordinate;\n\tcalculateClippingPosition(position, textureCoordinate, v_clipPosition, clippedTextureCoordinate);\n\n\tv_worldPosition = vec4(position, 1.0) * nodeWorld;\n\tgl_Position = v_worldPosition * cameraViewProjection;\n\tgl_Position.z += depthOffset;\n\t\n\tv_worldNormal = (vec4(normal, 0.0) * nodeWorld).xyz;\n\n\tv_textureCoordinate = clippedTextureCoordinate * textureRepeat;\n\tv_vertexAmbientOcclusion = ambientOcclusion;\n\n\tif(separateAnisotropicTextureTransform){\n\t\tv_anisoTextureCoordinate = clippedTextureCoordinate * anisotropicTextureRepeat + anisotropicTextureOffset;\n\t}else{\n\t\tv_anisoTextureCoordinate = v_textureCoordinate;\n\t}\n}"}}}(W||(W={})),function(e){e.create=function(){return{uniforms:{gloss:{type:"float",default:1}},snippets:{specularity:H.create(),diffuse:G.create(),opacityMask:w.create(),normal:V.create(),ambientOcclusion:g.create(),anisotropicMask:x.create(),lighting:b.create(),applyClipping:y.create()},code:"\nin vec4 v_worldPosition;\nin vec3 v_worldNormal;\nin vec2 v_textureCoordinate;\nin float v_vertexAmbientOcclusion;\nin vec2 v_anisoTextureCoordinate;\nin vec3 v_clipPosition;\n\nuniform vec3 cameraPosition;\n\nout vec4 fragColor;\n\nvoid main(){\n\tapplyClipping(v_clipPosition);\n\n\tvec2 opacityMask = getOpacityMask(v_textureCoordinate);\n\n\tvec3 worldNormalA = getNormal(v_worldPosition.xyz, v_worldNormal, v_anisoTextureCoordinate, cameraPosition - v_worldPosition.xyz);\n\tvec3 worldNormalB = reflect(worldNormalA, normalize(v_worldNormal));\n\n\tvec3 diffuse = getDiffuse(v_textureCoordinate);\n\tvec3 specularity = getSpecularity(v_textureCoordinate);\n\tfloat ambientOcclusion = getAmbientOcclusion(v_vertexAmbientOcclusion, v_textureCoordinate);\n\n\tvec3 worldView = normalize(v_worldPosition.xyz - cameraPosition);\n\tvec3 worldReflectA = reflect(worldView, worldNormalA);\n\tvec3 worldReflectB = reflect(worldView, worldNormalB);\n\n\tfloat anisotropicMask = getAnisotropicMask(v_anisoTextureCoordinate);\n\tvec3 radianceA = sampleRadiance(worldReflectA, gloss);\n\tvec3 radianceB = sampleRadiance(worldReflectB, gloss);\n\tvec3 radiance = mix(radianceA, radianceB, anisotropicMask);\n\n\tvec3 irradianceA = sampleIrradiance(worldNormalA);\n\tvec3 irradianceB = sampleIrradiance(worldNormalB);\n\tvec3 irradiance = mix(irradianceA, irradianceB, anisotropicMask);\n\n\tfragColor = vec4((diffuse * irradiance + specularity * radiance) * ambientOcclusion, opacityMask.x) * opacityMask.y;\n}"}}}(X||(X={})),function(e){function t(){const e=new Uint8ClampedArray(4);return e[0]=128,e[1]=128,e[2]=255,e[3]=255,{pixels:e,width:1,height:1}}e.getOrCreate=function(){return $||($={type:"pixelData",data:t()}),$}}(q||(q={}));const Q={booleans:{mask:"opacityMasked",separateanisotropictexturetransform:"separateAnisotropicTextureTransform"},colors:{diffuse:"diffuseColor",specularity:"specularity"},maps:{ambientocclusion:"ambientOcclusionTexture",anisotropicmask:"anisotropicMaskTexture",diffuse:"diffuseTexture",normal:"normalTexture",opacity:"opacityTexture",specularity:"specularityTexture"},values:{ambientocclusionintensity:"ambientOcclusionIntensity",ambientocclusiontexturebias:"ambientOcclusionTextureBias",anisotropicmaskantialiasing:"anisotropicMaskAntiAliasing",anisotropicmasktexturebias:"anisotropicMaskTextureBias",bumpiness:"bumpiness",diffusetexturebias:"diffuseTextureBias",diffusetextureintensity:"diffuseTextureIntensity",gloss:"gloss",maskantialiasing:"maskAntiAliasing",normaltexturebias:"normalTextureBias",opacity:"opacity",opacitytexturebias:"opacityTextureBias",specularitytexturebias:"specularityTextureBias",specularitytextureintensity:"specularityTextureIntensity",texturerepeat:"textureRepeat"},vector2s:{anisotropictextureoffset:"anisotropicTextureOffset",anisotropictexturerepeat:"anisotropicTextureRepeat"}};var K,J,ee,te,ne,re,oe,ie,ae,ce,se,ue,le,me,de,fe,pe,ve,ge,xe,ye;let he;var be;function we(e){var t;const n=ge.create(),r=B.getBlending(e.opacityTexture,e.opacity,e.maskTexture);let o;e.environmentCubemap&&(o=(null===(t=e.environmentCubemap)||void 0===t?void 0:t.data.length)-1);const i=be.getOrCreate(),a={...e,environmentMaxLod:o,ditheringTexture:i},c=m.defaultStencil();return s.createElement("material",{blending:r,stencil:c},s.createElement("shader",{...n}),s.createElement("properties",{...a}))}function Te(e){var t,n;const r=N.map(e.material,Ce,e.textures,e.overwriteTexturtes);r.ambientOcclusionIntensity*=null!==(t=e.ambientocclusionintensity)&&void 0!==t?t:1,r.thickness=null!==(n=e.thickness)&&void 0!==n?n:1,e.concentricNormalCenter&&(r.concentricNormalCenter=e.concentricNormalCenter);const o=J.create();return r.environmentCubemap={type:"cubemap",data:o.cubemap},r.dfgTexture={type:"url",url:o.dfg},r.exposure=o.exposure,r.environmentIntensity=o.intensity,r.environmentSH=o.sphericalHarmonics,s.createElement(we,{...r})}!function(e){function t(e){const t=[],n=Object.keys(e).length/6,r=Object.keys(e);for(let o=0;o<n;o++)t[o]={right:e[r[6*o]],left:e[r[6*o+1]],top:e[r[6*o+2]],bottom:e[r[6*o+3]],front:e[r[6*o+4]],back:e[r[6*o+5]]};return t}function n(e){const t=[],n=Object.keys(e).length/6,r=Object.keys(e);for(let o=0;o<n;o++)t[o]={left:e[r[6*o]],bottom:e[r[6*o+1]],back:e[r[6*o+2]],right:e[r[6*o+3]],top:e[r[6*o+4]],front:e[r[6*o+5]]};return t}e.GetCubemapFromFolderNumerated=function(e,n,r){const o=["nx","ny","nz","px","py","pz"],i={};for(let t=0;t<r;t++){let r=0;for(const a of o){const o=`${e}/${n}_${t}_${r}.webp`;i[`${n}${t}_${a}`]=o,r++}}return t(i)},e.GetCubemapFromFolder=function(e,t,r){const o=["nx","ny","nz","px","py","pz"],i={};for(let n=0;n<r;n++)for(const r of o){const o=`${t}${n}_${r}`,a=`${e}/${o}.webp`;i[o]=a}return n(i)},e.BuildCubemapFromFilesNumerated=t,e.BuildCubemapFromFiles=n}(K||(K={})),function(e){e.create=function(){return{dfg:"https://az589851.vo.msecnd.net/lightmaps/js/dfg-1/dfg.hdr",cubemap:K.GetCubemapFromFolder("https://az589851.vo.msecnd.net/lightmaps/js/blocky-photo-studio-2","m",7),sphericalHarmonics:[i.create(1.299812197685242,1.262771606445313,1.274021744728088),i.create(1.461060285568237,1.392490029335022,1.412235140800476),i.create(.111392050981522,.08570871502161,.092607744038105),i.create(.039797279983759,.047663073986769,.045741934329271),i.create(-.151130452752113,-.140350639820099,-.143172547221184),i.create(.562471389770508,.522119998931885,.532122015953064),i.create(-.121775068342686,-.114978484809399,-.117047630250454),i.create(-.114901013672352,-.111061908304691,-.111651308834553),i.create(-.568160593509674,-.541185617446899,-.548351883888245)],intensity:1800,exposure:1800}}}(J||(J={})),function(e){e.create=function(){return{uniforms:{anisotropy:{type:"float",default:0}},code:"\n\nvec3 applyAnisotropy(vec3 normal, vec3 view, mat3 TBN) {\n\tif(anisotropy == 0.0) return normal;\n\n\tvec3 tangent = TBN[0];\n\tvec3 bitangent = TBN[1];\n\n\tvec3 anisotropicDirection = anisotropy >= 0.0 ? bitangent : tangent;\n\tvec3 anisotropicTangent = cross(anisotropicDirection, view);\n\tvec3 anisotropicNormal = cross(anisotropicTangent, anisotropicDirection);\n\treturn normalize(mix(normal, anisotropicNormal, abs(anisotropy)));\n}"}}}(ee||(ee={})),function(e){e.create=function(){return{uniforms:{concentricNormalFrequency:{type:"float",default:0}},code:"\nvec3 calculateBendDirection(vec3 normal, vec3 direction, float alpha){\n\tvec3 inwardDirection = normalize(normal - direction);\n\tvec3 outwardDirection = normalize(normal + direction);\n\n\treturn normalize(mix(inwardDirection, outwardDirection, alpha));\n}\n\nmat3 getTangentFrame(vec3 worldNormal, vec3 concentricNormalCenter, vec3 worldPosition, mat3 TBN){\n\tif(concentricNormalFrequency == 0.0) return TBN;\n\n\tvec3 direction = worldPosition - concentricNormalCenter;\n\tfloat distance = length(direction);\n\tdirection /= distance;\n\t\n\tfloat distanceInRingSpace = distance * concentricNormalFrequency;\n\tfloat partialDerivative = length(vec2(dFdx(distanceInRingSpace), dFdy(distanceInRingSpace)));\n\tpartialDerivative = clamp(partialDerivative, 0.0, 1.0);\n\t\n\tfloat blendFactor = sin(distanceInRingSpace) * 0.5 + 0.5;\n\tblendFactor = round(blendFactor);\n\tblendFactor = mix(blendFactor, 1.0, clamp(partialDerivative, 0.0, 1.0));\n\n\tvec3 ringNormal = calculateBendDirection(worldNormal, direction, blendFactor);\n\t\n\tvec3 ringTangent = normalize(cross(ringNormal, worldNormal));\n\tvec3 ringBitangent = normalize(cross(ringTangent, ringNormal));\n\n\treturn mat3(ringTangent, ringBitangent, worldNormal);\n}"}}}(te||(te={})),function(e){e.create=function(){return{uniforms:{environmentIntensity:{type:"float",default:1},environmentSH:{type:"vector3[]",default:[]},dfgTexture:{type:"texture",sampler:{wrapS:"clampToEdge",wrapT:"clampToEdge",mipmapping:!1}},environmentCubemap:{type:"cubemap",sampler:{wrapS:"clampToEdge",wrapT:"clampToEdge",mipmapping:!0}},invertZ:{type:"boolean",default:!1},environmentMaxLod:{type:"float",default:7}},code:"\nvec3 decodeRGBM(vec4 rgbm, float rangeLinear) {\n\tvec3 result = rgbm.rgb * rgbm.a * rangeLinear;\n\treturn result * result;\n}\n\nvec2 prefilteredDFG(float roughness, float NoV){\n\tif(dfgTextureSet){\n\t\tvec2 uv = vec2(NoV, roughness);\n\t\tuv.y = 1.0 - uv.y;\n\t\tvec4 dfg = texture(dfgTexture, uv);\n\t\tvec3 decoded = decodeRGBM(dfg, 1.0);\n\t\treturn decoded.rg;\n\t}else{\n\t\treturn vec2(0.0, 0.0);\n\t}\n}\n\nfloat roughnessToLod(float roughness){\n\treturn environmentMaxLod * roughness * (2.0 - roughness);\n}\n\nvec3 getPrefilteredRadiance(vec3 reflected, float roughness){\n\tif(invertZ){\n\t\treflected *= -1.0;\n\t}\n\tfloat lod = roughnessToLod(roughness);\n\n\tvec4 radiance = textureLod(environmentCubemap, reflected, lod);\n\tvec3 color = decodeRGBM(radiance, 16.0); \n    return color;\n}\n\nvec3 irradianceSphericalHarmonics(vec3 n){\n\treturn environmentIntensity * max(environmentSH[0]\n\t\t+ environmentSH[1] * (n.y)\n\t\t+ environmentSH[2] * (n.z)\n\t\t+ environmentSH[3] * (n.x)\n\t\t+ environmentSH[4] * (n.y * n.x)\n\t\t+ environmentSH[5] * (n.y * n.z)\n\t\t+ environmentSH[6] * (3.0 * n.z * n.z - 1.0)\n\t\t+ environmentSH[7] * (n.z * n.x)\n\t\t+ environmentSH[8] * (n.x * n.x - n.y * n.y)\n\t\t, 0.0);\n}\n"}}}(ne||(ne={})),function(e){e.create=function(){return{uniforms:{iridescentIntensity:{type:"float",default:1},iridescentTextureBias:{type:"float",default:0},iridescentTexture:{type:"texture",sampler:{wrapS:"clampToEdge",wrapT:"clampToEdge",mipmapping:!0}}},code:"\nvec3 applyIridescence(vec2 textureCoordinate, float normalDotView, vec3 Fr){\n\tif(!iridescentTextureSet){\n\t\treturn Fr;\n\t}\n\n\tfloat iridescentAngle = 1.0 - normalDotView;\n\tvec4 iridescence = texture(iridescentTexture, vec2(iridescentAngle, 0.5), iridescentTextureBias);\n\treturn mix(Fr, iridescence.rgb * Fr, iridescentIntensity * iridescence.a);\n}\n"}}}(re||(re={})),function(e){e.create=(oe||(oe={})),function(e){e.create=function(){return{uniforms:{},snippets:{iridescent:re.create(),iblEnvironment:ne.create(),translucency:oe.create()},code:"\nfloat calcSpecularAO(float NoV, float visibility, float roughness){\n\treturn clamp(pow(NoV + visibility, pow(2.0, -16.0 * roughness - 1.0)) + visibility, 0.0, 1.0);\n}\n\nvec3 getMultiBounceAO(float visibility, vec3 albedo){\n\tvec3 a =  2.0404 * albedo - 0.3324;\n\tvec3 b = -4.7951 * albedo + 0.6417;\n\tvec3 c =  2.7552 * albedo + 0.6903;\n\treturn max(vec3(visibility), ((visibility * a + b) * visibility + c) * visibility);\n}\n\nvec3 getDiffuseColor(vec3 baseColor, float metallic){\n\treturn baseColor * (1.0 - metallic);\n}\n\nvec3 getF0(vec3 baseColor, float metallic, float reflectance){\n\tfloat correctedReflectance = reflectance * reflectance * 0.16;\n\treturn mix(vec3(correctedReflectance), baseColor, vec3(metallic));\n}\n\nvec3 getReflected(vec3 view, vec3 normal){\n\treturn reflect(-view, normal);\n}\n\nvec3 getE(vec3 f0, float roughness, float normalDotView, out vec3 energyCompensation){\n\tvec2 dfg = prefilteredDFG(roughness, normalDotView);\n\tvec3 E = mix(dfg.xxx, dfg.yyy, f0);\n\tE = rembrandtSmoothstep(E);\n\tenergyCompensation = 1.0 + f0 * (1.0 / dfg.y - 1.0);\n\treturn E;\n}\n\nvec3 getRadiance(vec3 reflected, float roughness){\n\tvec3 prefilteredRadiance = getPrefilteredRadiance(reflected, roughness);\n\treturn prefilteredRadiance * environmentIntensity;\n}\n\nvec3 getIrradiance(vec3 normal, vec3 diffuseColor){\n\tvec3 irradiance = irradianceSphericalHarmonics(normal);\n\treturn diffuseColor * irradiance;\n}\n\nvec4 ibl(vec3 baseColor, float roughness, float metallic, float reflectance, float vertexAO, vec3 worldNormal, vec3 view, float opacity, float thickness, vec2 textureCordinates){\n\tvec3 reflected = normalize(getReflected(view, worldNormal));\n\tfloat normalDotView = max(getNormalDotView(worldNormal, view), 0.0);\n\tfloat perceptualRoughness = sqrt(roughness);\n\n\tvec3 diffuseColor = getDiffuseColor(baseColor, metallic);\n\n\tvec3 f0 = getF0(baseColor, metallic, reflectance);\n\tvec3 energyCompensation;\n\tvec3 E = getE(f0, perceptualRoughness, normalDotView, energyCompensation);\n\t\n\tvec3 Fr = getRadiance(reflected, roughness) * energyCompensation;\n\tvec3 Fd = getIrradiance(worldNormal, diffuseColor);\n\t\n\tFr = applyIridescence(textureCordinates, normalDotView, Fr);\n\t\n\tfloat translucency = getTranslucency(opacity, thickness, E);\n\n\tvec3 ibl = mix(Fd, Fr, E) * vertexAO * translucency;\n\treturn vec4(ibl, translucency);\n}\n"}}}(ie||(ie={})),function(e){e.create=function(){return{uniforms:{baseColorTextureBias:{type:"float",default:0},baseColorTextureIntensity:{type:"float",default:1},baseColor:{type:"color",default:v.white()},baseColorTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nvec3 getBaseColor(vec2 textureCoordinate){\n\tvec3 base = gammaToLinear(baseColor.rgb);\n\n\tif(baseColorTextureSet){\n\t\tvec3 baseFromTexture = gammaToLinear(texture(baseColorTexture, textureCoordinate, baseColorTextureBias).rgb);\n\t\tbase = mix(base, base * baseFromTexture, baseColorTextureIntensity);\n\t}\n\t\n\treturn base;\n}\n"}}}(ae||(ae={})),function(e){e.create=function(){return{uniforms:{emissiveIntensity:{type:"float",default:0},emissiveTextureBias:{type:"float",default:0},emissiveColor:{type:"color",default:v.white()},emissiveTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nvec3 getEmissive(vec2 textureCoordinate){\n\tvec3 emissive = gammaToLinear(emissiveColor.rgb) * emissiveIntensity;\n\t\n\tif(emissiveTextureSet){\n\t\temissive *= gammaToLinear(texture(emissiveTexture, textureCoordinate, emissiveTextureBias).rgb);\n\t}\n\n\treturn emissive;\n}\n"}}}(ce||(ce={})),function(e){e.create=function(){return{uniforms:{roughness:{type:"float",default:1},roughnessTextureBias:{type:"float",default:0},roughnessTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nfloat perceptualToLinear(float perceptualRoughness){\n\tperceptualRoughness = clamp(perceptualRoughness, 0.045, 1.0);\n\treturn perceptualRoughness * perceptualRoughness;\n}\n\nfloat getRoughness(vec2 textureCoordinate){\n\tfloat linearRoughness = perceptualToLinear(roughness);\n\n\tif(roughnessTextureSet){\n\t\tlinearRoughness *= perceptualToLinear(texture(roughnessTexture, textureCoordinate, roughnessTextureBias).r);\n\t}\n\n\t// Avoid roughness becoming too small.\n\treturn linearRoughness;\n}\n"}}}(se||(se={})),function(e){e.create=function(){return{uniforms:{maskTextureBias:{type:"float",default:0},maskTextureAntiAliasing:{type:"float",default:0},maskTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nfloat getMask(vec2 textureCoordinate)\n{\n\tif(!blendingEnabled) return 1.0;\n\tif(!maskTextureSet) return 1.0;\n\t\n\tfloat maskFromTexture = texture(maskTexture, textureCoordinate, maskTextureBias).x;\n\t\n\t// Calculate min and span.\n\tfloat minMask = 0.5 - maskTextureAntiAliasing;\n\tfloat spanMask = 2.0 * maskTextureAntiAliasing;\n\n\t// Calculate the normalized mask.\n\tfloat mask = (maskFromTexture  - minMask) / spanMask;\n\t\n\t// Saturate.\n\tmask = clamp(mask, 0.0, 1.0);\n\t\n\t// TODO use a discard here?\n\t// if (mask <= 0.0) discard;\n\treturn mask;\n}"}}}(ue||(ue={})),function(e){e.create=function(){return{uniforms:{metallicTextureBias:{type:"float",default:0},metallic:{type:"float",default:0},metallicTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nfloat getMetallic(vec2 textureCoordinate){\n\tif(metallicTextureSet){\n\t\treturn texture(metallicTexture, textureCoordinate, metallicTextureBias).x * metallic;\n\t}else{\n\t\treturn metallic;\n\t}\n}\n"}}}(le||(le={})),function(e){e.create=function(){return{uniforms:{normalTextureBias:{type:"float",default:0},normalTextureIntensity:{type:"float",default:1},invertNormal:{type:"boolean",default:!1},normalTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nvec3 perturbNormal(mat3 TBN, vec2 textureCoordinate ) {\n\tvec3 normalFromTexture = texture(normalTexture, textureCoordinate, normalTextureBias).xyz;\n\tnormalFromTexture.xy = normalFromTexture.xy * 255./127. - 128./127.;\n\tnormalFromTexture.y *= -1.0;\n\tnormalFromTexture.xy *= normalTextureIntensity;\n\tvec3 normal = normalize(TBN * normalFromTexture);\n\treturn normal;\n}\n\nvec3 getNormalFromTexture(mat3 TBN, vec2 textureCoordinate){\n\tvec3 normal = TBN[2];\n\t\n\tif(normalTextureSet && normalTextureIntensity != 0.0){\n\t\tnormal = perturbNormal(TBN, textureCoordinate);\n\t}\n\n\tif (invertNormal){\n\t\tnormal *= -1.0;\n\t}\n\treturn normal;\n}\n\n"}}}(me||(me={})),function(e){e.create=function(){return{uniforms:{opacityTextureBias:{type:"float",default:0},opacity:{type:"float",default:1},opacityTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nuniform bool blendingEnabled;\n\t\t\t\nfloat getOpacity(vec2 textureCoordinate)\n{\n\tif(!blendingEnabled) return 1.0;\n\tif(!opacityTextureSet) return opacity;\n\t\n\treturn texture(opacityTexture, textureCoordinate, opacityTextureBias).x * opacity;\n}"}}}(de||(de={})),function(e){e.create=function(){return{uniforms:{reflectanceTextureBias:{type:"float",default:0},reflectance:{type:"float",default:.5},reflectanceTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nfloat getReflectance(vec2 textureCoordinate){\n\tif(reflectanceTextureSet){\n\t\treturn texture(reflectanceTexture, textureCoordinate, reflectanceTextureBias).x * reflectance;\n\t}else{\n\t\treturn reflectance;\n\t}\n}\n"}}}(fe||(fe={})),function(e){e.create=function(){return{uniforms:{thickness:{type:"float",default:1}},code:"\nfloat getThickness(){\n\treturn thickness;\n}\n"}}}(pe||(pe={})),function(e){e.create=function(){return{uniforms:{gamma:{type:"float",default:2.2},exposure:{type:"float",default:1},ditheringTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!1,minFilter:"nearest",magFilter:"nearest"}}},code:"\nvec3 gammaToLinear(vec3 color){\n\treturn pow(color, vec3(gamma));\n}\n\nfloat gammaToLinear(float value){\n\treturn pow(value, gamma);\n}\n\nvec3 linearToGamma(vec3 color){\n\treturn pow(color, vec3(1.0 / gamma));\n}\n\nvec3 uchimura(vec3 x, float P, float a, float m, float l, float c, float b) {\n\tfloat l0 = ((P - m) * l) / a;\n\tfloat L0 = m - m / a;\n\tfloat L1 = m + (1.0 - m) / a;\n\tfloat S0 = m + l0;\n\tfloat S1 = m + a * l0;\n\tfloat C2 = (a * P) / (P - S1);\n\tfloat CP = -C2 / P;\n  \n\tvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\n\tvec3 w2 = vec3(step(m + l0, x));\n\tvec3 w1 = vec3(1.0 - w0 - w2);\n  \n\tvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\n\tvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\n\tvec3 L = vec3(m + a * (x - m));\n  \n\treturn T * w0 + L * w1 + S * w2;\n  }\n  \nvec3 uchimura(vec3 x) {\n\tx /= exposure;\n\tconst float P = 1.0;  // max display brightness default 1.0\n\tconst float a = 1.0;  // contrast\n\tconst float m = 0.22; // linear section start\n\tconst float l = 0.4;  // linear section length\n\tconst float c = 1.33; // black default 1.33\n\tconst float b = 0.0;  // pedestal\n  \n\treturn uchimura(x, P, a, m, l, c, b);\n}\n\nvec3 dithering(vec3 color) {\t\n\tif(ditheringTextureSet){\t\n\t\treturn color + vec4(texture(ditheringTexture, gl_FragCoord.xy / 8.0).r / 32.0 - (1.0 / 128.0)).rgb;\n\t}\n\treturn color;\n}\n\nvec3 doTonemapping(vec3 color) {\n\tvec3 result = uchimura(color);\n\tresult = linearToGamma(result);\n\tresult = dithering(result);\n\treturn result;\n}\n"}}}(ve||(ve={})),function(e){let t;e.create=function(){if(!t){const e=xe.create(),n=ye.create(),r={...f.getShaderUniforms(e),...f.getShaderUniforms(n)};t={vertex:f.toCode(e),fragment:f.toCode(n),uniforms:r,id:"shader-ibl"}}return t}}(ge||(ge={})),function(e){e.create=function(){return{uniforms:{textureRepeat:{type:"float",default:1},concentricNormalCenter:{type:"vector3",default:{x:0,y:0,z:0}}},snippets:{calculateClipping:h.create()},code:"\nuniform mat4 nodeWorld;\nuniform mat4 cameraViewProjection;\nuniform float depthOffset;\nuniform vec3 cameraPosition;\n\nout vec4 v_worldPosition;\nout vec2 v_textureCoordinate;\nout float v_vertexAmbientOcclusion;\nout vec3 v_clipPosition;\nout mat3 v_TBN;\nout vec3 v_concentricNormalCenter;\n\nvoid main(){\n\tcalculateClippingPosition(position, textureCoordinate, v_clipPosition, v_textureCoordinate);\n\n\tv_worldPosition = vec4(position, 1.0) * nodeWorld;\n\tgl_Position = v_worldPosition * cameraViewProjection;\n\tgl_Position.z += depthOffset;\n\t\n\tv_concentricNormalCenter = ((vec4(concentricNormalCenter, 1.0) * nodeWorld)).xyz;\n\n\tv_textureCoordinate *= textureRepeat;\n\tv_vertexAmbientOcclusion = ambientOcclusion;\n\n\tvec3 N = (vec4(normal, 0.0) * nodeWorld).xyz;\n\tvec3 T = (vec4(tangent, 0.0) * nodeWorld).xyz;\n\tvec3 B = normalize(cross(N, T));\n\n\tv_TBN = mat3(T, B, N);\n}"}}}(xe||(xe={})),function(e){e.create=function(){return{uniforms:{},snippets:{tonemapper:ve.create(),metallic:le.create(),linearBaseColor:ae.create(),opacity:de.create(),mask:ue.create(),normalFromTexture:me.create(),linearEmissive:ce.create(),ambientOcclusion:g.create(),linearRoughness:se.create(),reflectance:fe.create(),anisotropy:ee.create(),ibl:ie.create(),concentricNormal:te.create(),applyClipping:y.create(),thickness:pe.create()},code:"\n\nin vec2 v_textureCoordinate;\nin vec4 v_worldPosition;\nin float v_vertexAmbientOcclusion;\nin vec3 v_clipPosition;\nin vec3 v_concentricNormalCenter;\nin mat3 v_TBN;\n\nuniform vec3 cameraPosition;\n\nout vec4 fragColor;\n\nmat3 normalizeTBN(mat3 TBN){\n\tvec3 T = normalize(TBN[0]);\n\tvec3 B = normalize(TBN[1]);\n\tvec3 N = normalize(TBN[2]);\n\treturn mat3(T, B, N);\n}\n\nvoid main(){\n\tapplyClipping(v_clipPosition);\n\n\tfloat opacity = getOpacity(v_textureCoordinate);\n\tfloat mask = getMask(v_textureCoordinate);\n\n\tmat3 TBN = normalizeTBN(v_TBN);\n\n\tvec3 view = getView(cameraPosition, v_worldPosition.xyz);\n\tvec3 normal = getNormalFromTexture(TBN, v_textureCoordinate);\n\tmat3 generatedTBN = getTangentFrame(normal, v_concentricNormalCenter, v_worldPosition.xyz, TBN);\n\tnormal = applyAnisotropy(normal, view, generatedTBN);\n\t\n\tvec3 baseColor = getBaseColor(v_textureCoordinate);\n\tvec3 emissive = getEmissive(v_textureCoordinate);\n\tfloat ambientOcclusion = getAmbientOcclusion(v_vertexAmbientOcclusion, v_textureCoordinate);\n\tfloat metallic = getMetallic(v_textureCoordinate);\n\tfloat perceptualRoughness = getRoughness(v_textureCoordinate);\n\tfloat reflectance = getReflectance(v_textureCoordinate);\n\tfloat thickness = getThickness();\n\n\tvec4 ibl = ibl(baseColor, perceptualRoughness, metallic, reflectance, ambientOcclusion, normal, view, opacity, thickness, v_textureCoordinate);\n\tvec3 color = ibl.rgb + emissive;\n\tcolor = doTonemapping(color.rgb);\n\t\n\tfragColor = vec4(color, ibl.a) * mask;\n}"}}}(ye||(ye={})),function(e){e.getOrCreate=function(){return he||(he={type:"pixelData",data:{pixels:new Uint8ClampedArray([0,32,8,40,2,34,10,42,48,16,56,24,50,18,58,26,12,44,4,36,14,46,6,38,60,28,52,20,62,30,54,22,3,35,11,43,1,33,9,41,51,19,59,27,49,17,57,25,15,47,7,39,13,45,5,37,63,31,55,23,61,29,53,21]),width:8,height:8,internalFormat:"r8",format:"r"}}),he}}(be||(be={}));const Ce={booleans:{},vector2s:{},colors:{baseColor:"baseColor",emissiveColor:"emissiveColor"},maps:{ambientOcclusionTexture:"ambientOcclusionTexture",baseColorTexture:"baseColorTexture",emissiveTexture:"emissiveTexture",metallicTexture:"metallicTexture",normalTexture:"normalTexture",opacityTexture:"opacityTexture",reflectanceTexture:"reflectanceTexture",roughnessTexture:"roughnessTexture",maskTexture:"maskTexture",iridescentTexture:"iridescentTexture"},values:{textureRepeat:"textureRepeat",ambientOcclusionIntensity:"ambientOcclusionIntensity",ambientOcclusionTextureBias:"ambientOcclusionTextureBias",metallic:"metallic",metallicTextureBias:"metallicTextureBias",baseColorTextureBias:"baseColorTextureBias",baseColorTextureIntensity:"baseColorTextureIntensity",emissiveIntensity:"emissiveIntensity",emissiveTextureBias:"emissiveTextureBias",normalTextureIntensity:"normalTextureIntensity",normalTextureBias:"normalTextureBias",opacity:"opacity",thickness:"thickness",opacityTextureBias:"opacityTextureBias",reflectance:"reflectance",roughness:"roughness",roughnessTextureBias:"roughnessTextureBias",maskTextureAntialiasing:"maskTextureAntiAliasing",maskTextureBias:"maskTextureBias",iridescentIntensity:"iridescentIntensity",iridescentTextureBias:"iridescentTextureBias",anisotropy:"anisotropy",concentricNormalFrequency:"concentricNormalFrequency"}};var Ee,Se,Me,Ae,Re;function ze(e){const t=Me.create(),n=B.getBlending(e.opacityTexture,e.opacity),r=m.defaultStencil();return s.createElement("material",{blending:n,stencil:r},s.createElement("shader",{...t}),s.createElement("properties",{...e}))}function Pe(e){var t;const n=N.map(e.material,ke,e.textures,e.overwriteTexturtes);return n.ambientOcclusionIntensity*=null!==(t=e.ambientocclusionintensity)&&void 0!==t?t:1,n.lightTexture={type:"url",url:D.getURL()},s.createElement(ze,{...n})}!function(e){e.create=function(){return{uniforms:{emissiveIntensity:{type:"float",default:1},emissiveTextureBias:{type:"float",default:0},emissiveColor:{type:"color",default:v.black()},emissiveTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\nvec3 getEmissive(vec2 textureCoordinate){\n\tvec3 emissive = emissiveColor.rgb * emissiveIntensity;\n\t\n\tif(emissiveTextureSet){\n\t\temissive *= texture(emissiveTexture, textureCoordinate, emissiveTextureBias).rgb;\n\t}\n\n\treturn emissive;\n}\n"}}}(Ee||(Ee={})),function(e){e.create=function(){return{uniforms:{glossTextureBias:{type:"float",default:0},gloss:{type:"float",default:1},glossTexture:{type:"texture",sampler:{wrapS:"repeat",wrapT:"repeat",mipmapping:!0}}},code:"\n\nfloat getGloss(vec2 textureCoordinate){\n\tif(glossTextureSet){\n\t\tfloat glossFromTexture = texture(glossTexture, textureCoordinate, glossTextureBias).x;\n\t\treturn glossFromTexture * gloss;\n\t}else{\n\t\treturn gloss;\n\t}\n}\n"}}}(Se||(Se={})),function(e){let t;e.create=function(){if(!t){const e=Ae.create(),n=Re.create(),r={...f.getShaderUniforms(e),...f.getShaderUniforms(n)};t={vertex:f.toCode(e),fragment:f.toCode(n),uniforms:r,id:"shader-pbr"}}return t}}(Me||(Me={})),function(e){e.create=function(){return{uniforms:{textureRepeat:{type:"float",default:1}},snippets:{calculateClipping:h.create()},code:"\nuniform mat4 nodeWorld;\nuniform mat4 cameraViewProjection;\nuniform float depthOffset;\n\nout vec4 v_worldPosition;\nout vec3 v_worldNormal;\nout vec2 v_textureCoordinate;\nout float v_vertexAmbientOcclusion;\nout vec3 v_clipPosition;\n\nvoid main(){\n\tcalculateClippingPosition(position, textureCoordinate, v_clipPosition, v_textureCoordinate);\n\n\tv_worldPosition = vec4(position, 1.0) * nodeWorld;\n\tgl_Position = v_worldPosition * cameraViewProjection;\n\tgl_Position.z += depthOffset;\n\t\n\tv_worldNormal = (vec4(normal, 0.0) * nodeWorld).xyz;\n\t\n\tv_textureCoordinate *= textureRepeat;\n\tv_vertexAmbientOcclusion = ambientOcclusion;\n}"}}}(Ae||(Ae={})),function(e){e.create=function(){return{uniforms:{},snippets:{gloss:Se.create(),specularity:H.create(),diffuse:G.create(),opacityMask:w.create(),normal:V.create(),emissive:Ee.create(),ambientOcclusion:g.create(),lighting:b.create(),applyClipping:y.create()},code:"\nin vec4 v_worldPosition;\nin vec3 v_worldNormal;\nin vec2 v_textureCoordinate;\nin float v_vertexAmbientOcclusion;\nin vec3 v_clipPosition;\n\nuniform vec3 cameraPosition;\n\nout vec4 fragColor;\n\nvoid main(){\n\tapplyClipping(v_clipPosition);\n\n\tvec2 opacityMask = getOpacityMask(v_textureCoordinate);\n\n\tvec3 normal = getNormal(v_worldPosition.xyz, v_worldNormal, v_textureCoordinate, cameraPosition - v_worldPosition.xyz);\n\tvec3 diffuse = getDiffuse(v_textureCoordinate);\n\tvec3 emissive = getEmissive(v_textureCoordinate);\n\tvec3 specularity = getSpecularity(v_textureCoordinate);\n\tfloat ambientOcclusion = getAmbientOcclusion(v_vertexAmbientOcclusion, v_textureCoordinate);\n\tfloat gloss = getGloss(v_textureCoordinate);\n\n\tvec3 worldView = normalize(v_worldPosition.xyz - cameraPosition);\n\tvec3 worldReflect = reflect(worldView, normal);\n\n\tvec3 radiance = sampleRadiance(worldReflect, gloss);\n\tvec3 irradiance = sampleIrradiance(normal);\n\t\n\tfragColor = combinePRB(diffuse, irradiance, specularity, radiance, ambientOcclusion, emissive, opacityMask.x, opacityMask.y);\n}"}}}(Re||(Re={}));const ke={booleans:{mask:"opacityMasked"},colors:{diffuse:"diffuseColor",specularity:"specularity",emissive:"emissiveColor"},maps:{ambientocclusion:"ambientOcclusionTexture",diffuse:"diffuseTexture",emissive:"emissiveTexture",gloss:"glossTexture",normal:"normalTexture",opacity:"opacityTexture",specularity:"specularityTexture"},values:{ambientocclusionintensity:"ambientOcclusionIntensity",ambientocclusiontexturebias:"ambientOcclusionTextureBias",bumpiness:"bumpiness",diffusetexturebias:"diffuseTextureBias",diffusetextureintensity:"diffuseTextureIntensity",emissiveintensity:"emissiveIntensity",emissivetexturebias:"emissiveTextureBias",gloss:"gloss",glosstexturebias:"glossTextureBias",maskantialiasing:"maskAntiAliasing",normaltexturebias:"normalTextureBias",opacity:"opacity",opacitytexturebias:"opacityTextureBias",specularitytextureintensity:"specularityTextureIntensity",specularitytexturebias:"specularityTextureBias",texturerepeat:"textureRepeat"},vector2s:{}};var _e,Be,Fe,Ie;function Oe(e){const t=Be.create(),n=B.getBlending(e.opacityTexture,e.opacity),r=m.defaultStencil();return s.createElement("material",{blending:n,stencil:r},s.createElement("shader",{...t}),s.createElement("properties",{...e}))}function Ne(e){var t;const n=N.map(e.material,De,e.textures,e.overwriteTexturtes);return n.ambientOcclusionIntensity*=null!==(t=e.ambientocclusionintensity)&&void 0!==t?t:1,n.lightTexture={type:"url",url:D.getURL()},s.createElement(Oe,{...n})}!function(e){e.create=function(){return{uniforms:{iridescentIntensity:{type:"float",default:1},iridescentTextureBias:{type:"float",default:0},iridescentTexture:{type:"texture",sampler:{wrapS:"clampToEdge",wrapT:"clampToEdge",mipmapping:!0}}},code:"\n\nvec3 getIridescence(vec2 textureCoordinate, vec3 normal, vec3 view, vec3 specularity){\n\tvec3 iridescence = vec3(1, 1, 1);\n\n\tif(iridescentTextureSet){\n\t\tfloat normalDotView = clamp(-dot(normal, view), 0.0, 1.0);\n\t\tfloat iridescentAngle = 1.0 - normalDotView;\n\t\tiridescence = texture(iridescentTexture, vec2(iridescentAngle, 0.5), iridescentTextureBias).rgb;\n\t}\n\n\treturn mix(specularity, iridescence, iridescentIntensity);\n}\n"}}}(_e||(_e={})),function(e){let t;e.create=function(){if(!t){const e=Fe.create(),n=Ie.create(),r={...f.getShaderUniforms(e),...f.getShaderUniforms(n)};t={vertex:f.toCode(e),fragment:f.toCode(n),uniforms:r,id:"shader-pbrIridescent"}}return t}}(Be||(Be={})),function(e){e.create=function(){return{uniforms:{textureRepeat:{type:"float",default:1}},snippets:{calculateClipping:h.create()},code:"\nuniform mat4 nodeWorld;\nuniform mat4 cameraViewProjection;\nuniform float depthOffset;\n\nout vec4 v_worldPosition;\nout vec3 v_worldNormal;\nout vec2 v_textureCoordinate;\nout float v_vertexAmbientOcclusion;\nout vec3 v_clipPosition;\n\nvoid main(){\n\tcalculateClippingPosition(position, textureCoordinate, v_clipPosition, v_textureCoordinate);\n\n\tv_worldPosition = vec4(position, 1.0) * nodeWorld;\n\tgl_Position = v_worldPosition * cameraViewProjection;\n\tgl_Position.z += depthOffset;\n\t\n\tv_worldNormal = (vec4(normal, 0.0) * nodeWorld).xyz;\n\t\n\tv_textureCoordinate *= textureRepeat;\n\tv_vertexAmbientOcclusion = ambientOcclusion;\n}"}}}(Fe||(Fe={})),function(e){e.create=function(){return{uniforms:{},snippets:{gloss:Se.create(),specularity:H.create(),diffuse:G.create(),opacityMask:w.create(),normal:V.create(),ambientOcclusion:g.create(),lighting:b.create(),iridescence:_e.create(),applyClipping:y.create()},code:"\nin vec4 v_worldPosition;\nin vec3 v_worldNormal;\nin vec2 v_textureCoordinate;\nin float v_vertexAmbientOcclusion;\nin vec3 v_clipPosition;\n\nuniform vec3 cameraPosition;\n\nout vec4 fragColor;\n\nvoid main(){\n\tapplyClipping(v_clipPosition);\n\n\tvec2 opacityMask = getOpacityMask(v_textureCoordinate);\n\n\tvec3 normal = getNormal(v_worldPosition.xyz, v_worldNormal, v_textureCoordinate, cameraPosition - v_worldPosition.xyz);\n\tvec3 diffuse = getDiffuse(v_textureCoordinate);\n\tvec3 specularity = getSpecularity(v_textureCoordinate);\n\tfloat ambientOcclusion = getAmbientOcclusion(v_vertexAmbientOcclusion, v_textureCoordinate);\n\tfloat gloss = getGloss(v_textureCoordinate);\n\n\tvec3 worldView = normalize(v_worldPosition.xyz - cameraPosition);\n\tvec3 worldReflect = reflect(worldView, normal);\n\tvec3 iridescence = getIridescence(v_textureCoordinate, normal, worldView, specularity);\n\n\tvec3 radiance = sampleRadiance(worldReflect, gloss);\n\tvec3 irradiance = sampleIrradiance(normal);\n\n\tfragColor = combinePRB(diffuse, irradiance, iridescence, radiance, ambientOcclusion, vec3(0, 0, 0), opacityMask.x, opacityMask.y);\n}"}}}(Ie||(Ie={}));const De={booleans:{mask:"opacityMasked"},colors:{diffuse:"diffuseColor",specularity:"specularity"},maps:{diffuse:"diffuseTexture",ambientocclusion:"ambientOcclusionTexture",gloss:"glossTexture",iridescent:"iridescentTexture",normal:"normalTexture",opacity:"opacityTexture",specularity:"specularityTexture"},values:{ambientocclusionintensity:"ambientOcclusionIntensity",ambientocclusiontexturebias:"ambientOcclusionTextureBias",bumpiness:"bumpiness",diffusetexturebias:"diffuseTextureBias",diffusetextureintensity:"diffuseTextureIntensity",gloss:"gloss",glosstexturebias:"glossTextureBias",iridescentintensity:"iridescentIntensity",iridescenttexturebias:"iridescentTextureBias",maskantialiasing:"maskAntiAliasing",normaltexturebias:"normalTextureBias",opacity:"opacity",opacitytexturebias:"opacityTextureBias",specularitytexturebias:"specularityTextureBias",specularitytextureintensity:"specularityTextureIntensity",texturerepeat:"textureRepeat"},vector2s:{}};function Le(e){const{material:t,...n}={...e};if(function(e){return"PhysicalBased"===e.type}(t))return s.createElement(Pe,{material:t,...n});if(function(e){return"PhysicalBasedIridescent"===e.type}(t))return s.createElement(Ne,{material:t,...n});if(function(e){return"Anisotropic"===e.type}(t))return s.createElement(Z,{material:t,...n});if(function(e){return"AnisotropicConcentric"===e.type}(t)){const r=Ue(e.AnisotropicPositionX,e.AnisotropicPositionY,e.AnisotropicPositionZ),o={...n,anisotropicPosition:r};return s.createElement(L,{material:t,...o})}if(t)){const r=Ue(e.AnisotropicPositionX,e.AnisotropicPositionY,e.AnisotropicPositionZ),o=e.Thickness,i={...n,concentricNormalCenter:r,thickness:o};return s.createElement(Te,{material:t,...i})}throw`Can't resolve component for unknown material type: ${t.type}`}function Ue(e,t,n){if(void 0!==e&&void 0!==t&&void 0!==n)return i.create(e,t,n)}function Ge(e){const t=e.composition.decals.find((t=>t.id===e.node.contentId)),n=e.node.values,r=e.composition.materials.find((e=>e.id===(null==t?void 0:t.materialId)));if(!t||!r)return s.createElement("layer",null);const o=e.composition.geometries.find((e=>e.id===(null==t?void 0:t.geometryId)));return s.createElement("layer",{culling:t.doubleSided?"none":"back"},o&&s.createElement(A,{geometry:o}),s.createElement(Le,{material:r,textures:e.composition.textures,...n,overwriteTexturtes:e.overwriteTexturtes}))}function Ve(e){const t=e.composition.models.find((t=>t.id===e.node.contentId)),r=e.composition.nodes.filter((t=>t.parentId===e.node.id)).filter((),o=e.node.values,i=e.composition.geometries.find((e=>e.id===(null==t?void 0:t.geometryId))),a=e.composition.materials.find(();return t&&o&&i&&a?s.createElement("node",{transparencyOrder:o.TransparencyOrder,name:e.node.name},s.createElement("position",{...e.node.position}),s.createElement("orientation",{...n.identity()}),s.createElement(A,{geometry:i}),s.createElement("layer",{culling:t.doubleSided?"none":"back"},s.createElement(Le,{material:a,textures:e.composition.textures,...o,overwriteTexturtes:e.overwriteTexturtes})),r.map(()):s.createElement("node",null)}function He(e){if("model"===e.node.content)return s.createElement(Ve,{...e});{const t=e.composition.nodes.filter(();return s.createElement("node",{name:e.node.name},s.createElement("position",{...e.node.position}),t.map(())}}function je(e){const t=e.composition.nodes.filter(();return s.createElement("node",{name:"root"},t.map(())}const We=n.fromRotationY(t.toRadians(180));function Xe(e){return s.createElement("node",null,s.createElement("orientation",{...e.orientation}),s.createElement("position",{...e.position}),s.createElement("node",null,s.createElement("orientation",{...We}),s.createElement("node",null,s.createElement($e,{composition:e.composition,centerComposition:e.centerComposition}),s.createElement(je,{composition:e.composition,overwriteTexturtes:e.overwriteTextures}))))}function $e(e){const t=e.centerComposition?function(e){const t=function(e){const t=new Set;for(const n of e.nodes){if("model"!==n.content)continue;const r=e.models.find(();r&&r.geometryId&&t.add(r.geometryId)}return e.geometries.filter(()}(e).map((),n=a.fromBoundingBoxes(t);return a.center(n)}(e.composition):i.zero();return s.createElement("position",{x:-t.x,y:-t.y,z:-t.z})}var qe,Ye,Ze;(qe||(qe={})).getURL=function(e){function t(e){return e.endsWith("px")}function n(e){return e.endsWith("%")}unction o(e){const t=e.substring(0,e.length-2);return Number.parseFloat(t)}function i(e){const t=e.substring(0,e.length-2);return Number.parseFloat(t)}function a(e){const t=e.substring(0,e.length-1);return Number.parseFloat(t)}e.createPixels=function(e){return`${e}px`},e.createRelative=function(e){return`${e}%`},e.createAspectRatio=e.getSizeInPixels=function(e,c){return"0"===e?0:t(e)?o(e):n(e)?a(e)/100*c:r(e)?i(e):0},e.getOffsetRelativeToParent=function(e,r){return"0"===e?r.offset:t(e)?o(e)+r.offset:n(e)?a(e)*r.size/100+r.offset:0},e.getSizeRelativeToParent=function(e,r){return"0"===e?0:t(e)?o(e):n(e)?a(e)*r/100:0},e.getSizeInPercentage=function(e,r){return"0"===e?0:t(e)?o(e)/r:n(e)?a(e)/100:0},e.isPixelLength=t,e.isRelativeLength=n,e.isAspectRatioLength=r,e.getPixels=o,e.getAspectRatio=i,e.getPercentage=a}(Ye||(Ye={})),function(n){function r(n,r){const i=e.aspectRatio(r),a=t.toRadians(n.fieldOfView);return o.createPerspective(a,i,n.near,n.far)}n.create=function(e,t,n){return{fieldOfView:e,near:t,far:n}},n.equals=function(e,t){return e===t||e.fieldOfView===t.fieldOfView&&e.near===t.near&&e.far===t.far},n.createProjectionTransform=function(n,o,i,a){if(a)return r(n,i);{const r=i.x,a=o.width-i.width-r,c=i.y;return function(n,r,o,i,a,c,s){const u=e.aspectRatio(o),l=.5*t.toRadians(n.fieldOfView),m=Math.tan(l)*n.near,d=m/u,f=.5*(r.width-i-a|0),p=.5*(r.height-c-s|0);return function(e,t,n,r,o,i){return{m11:2*o/(t-e),m12:0,m13:0,m14:0,m21:0,m22:2*o/(r-n),m23:0,m24:0,m31:(t+e)/(e-t),m32:(r+n)/(n-r),m33:i/(i-o),m34:1,m41:0,m42:0,m43:i*o/(o-i),m44:0}}(-((i+f)/f)*m,(a+f)/f*m,-((s+p)/p)*d,(c+p)/p*d,n.near,n.far)}(n,o,i,r,a,c,o.height-i.height-c)}},n.createPerspectiveProjectionTransform=r}(Ze||(Ze={}));var Qe,Ke,Je,et,tt,nt,rt,ot,it,at,ct,st,ut,lt,mt,dt,ft,pt,vt,gt,xt,yt,ht,bt,wt,Tt,Ct,Et,St,Mt,At,Rt,zt,Pt,kt,_t,Bt,Ft,It,Ot,Nt,Dt,Lt,Ut,Gt,Vt,Ht,jt,Wt,Xt,$t,qt,Yt,Zt,Qt,Kt,Jt,en,tn,nn,rn,on,an,cn,sn,un,ln,mn,dn,fn,pn,vn=Object.defineProperty,gn=Object.getOwnPropertySymbols,xn=Object.prototype.hasOwnProperty,yn=Object.prototype.propertyIsEnumerable,hn=(e,t,n)=>t in e?vn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bn=(e,t)=>{for(var n in t||(t={}))xn.call(t,n)&&hn(e,n,t[n]);if(gn)for(var n of gn(t))yn.call(t,n)&&hn(e,n,t[n]);return e};function wn(e){return s.createElement("screen",null,s.createElement(Cn,{id:"product",sceneRect:e.sceneRect}),s.createElement(En,{id:"product",camera:e.camera,products:e.products}))}function Tn(e){const t=[{composition:e.composition,position:i.zero(),orientation:e.bookmarkOrientation}];return s.createElement("offscreen",{onDraw:e.onDraw,size:e.bookmarkSize},s.createElement(Cn,{id:"bookmark"}),s.createElement(En,{id:"bookmark",camera:e.camera,products:t}))}function Cn(e){const t=e.sceneRect?Ye.createRelative(100*e.sceneRect.x):Ye.createRelative(0),n=e.sceneRect?Ye.createRelative(100*e.sceneRect.y):Ye.createRelative(0),r=e.sceneRect?Ye.createRelative(100*e.sceneRect.width):Ye.createRelative(100),o=e.sceneRect?Ye.createRelative(100*e.sceneRect.height):Ye.createRelative(100);return s.createElement("element",null,s.createElement("offset",{x:t,y:n}),s.createElement("size",{width:r,height:o}),s.createElement("viewport",{cameraId:e.id,clamp:!1}))}function En(e){return s.createElement("scene",null,s.createElement(Mn,null),s.createElement(Sn,bn({id:e.id},e.camera)),e.products.map((e=>e.composition&&s.createElement(Xe,{composition:e.composition.composition,centerComposition:!0,orientation:e.orientation,position:e.position,overwriteTextures:e.composition.overwriteTextures}))))}function Sn(e){return s.createElement("node",null,s.createElement("position",bn({},e.position)),s.createElement("orientation",bn({},e.orientation)),s.createElement("camera",{id:e.id,projection:Ze.create(e.fov,e.near,e.far),aperture:4,sensitivity:400,shutterSpeed:1/70}))}function Mn(){return s.createElement("properties",{lightTexture:{type:"url",url:qe.getURL()}})}(Qe||(Qe={})).Component=function(e){return s.createElement("screens",null,s.createElement(wn,bn({},e)),e.bookmarks.map((t=>{let{orientation:n,onDraw:r}=t;return s.createElement(Tn,{camera:e.bookmarkCamera,bookmarkOrientation:n,composition:e.products[0].composition,onDraw:r,bookmarkSize:e.bookmarkSize})})))},function(e){e.isType=function(e,t){var n;return null!==(n=null==t?void 0:t.startsWith(`${e}-`))&&void 0!==n&&n}}(Ke||(Ke={})),function(e){e.isNodeId=function(e){return Ke.isType("node",e)}}(Je||(Je={})),function(e){e.isElementId=function(e){return Ke.isType("element",e)}}(et||(et={})),function(e){e.isSceneId=function(e){return Ke.isType("scene",e)}}(tt||(tt={})),function(e){e.isMaterialId=function(e){return Ke.isType("material",e)}}(nt||(nt={})),function(e){e.isShaderId=function(e){return Ke.isType("shader",e)}}(nt||(nt={})),function(e){e.isLayerId=function(e){return Ke.isType("layer",e)}}(rt||(rt={})),function(e){e.isScreenId=function(e){return Ke.isType("screen",e)}}(ot||(ot={})),function(e){e.isRenderTextureId=(it||(it={})),function(e){e.create=function(e,t){return{tag:"geometry",setGeometry:n=>{Je.isNodeId(t)?e.node.geometry.set(t,n):e.layer.geometry.set(t,n)},remove:()=>{Je.isNodeId(t)?e.node.geometry.remove(t):e.layer.geometry.remove(t)}}}}(at||(at={})),function(e){e.create=function(e,t){return{tag:"properties",setProperties:n=>{tt.isSceneId(t)?e.scene.properties.set(t,n):e.material.properties.set(t,n)},remove:()=>{tt.isSceneId(t)?e.scene.properties.remove(t):e.material.properties.remove(t)}}}}(ct||(ct={})),function(e){e.create=function(e,t){return{tag:"shader",setShader:n=>{const r=e.shader.create(n);e.material.shader.set(t,r)},remove:()=>{e.material.shader.remove(t)}}}}(st||(st={})),function(e){e.create=function(e,t){const n=e.material.create();return e.material.parent.set(n,t),{tag:"material",createProperties:()=>ct.create(e,n),createShader:()=>st.create(e,n),setBlending:t=>{const r=e.material.blending;t?r.set(n,t):r.remove(n)},setStencil:t=>{const r=e.material.stencil;t?r.set(n,t):r.remove(n)},setColorMask:t=>{const r=e.material.colorMask;t?r.set(n,t):r.remove(n)},remove:()=>{e.material.remove(n)}}}}(ut||(ut={})),function(e){e.create=function(e,t,n){const r=e.layer.create();return e.layer.parent.set(r,t),e.layer.order.set(r,n),{tag:"layer",createMaterial:()=>ut.create(e,r),createGeometry:()=>at.create(e,r),setCulling(t){t?e.layer.culling.set(r,t):e.layer.culling.remove(r)},setClipping(t){t?e.layer.clipping.set(r,t):e.layer.clipping.remove(r)},remove:()=>{e.layer.remove(r)}}}}(lt||(lt={})),function(e){e.create=function(e,t){return{tag:"offset",setOffset:n=>{e.element.offset.set(t,n)},remove:()=>{e.element.offset.remove(t)}}}}(mt||(mt={})),function(e){e.create=function(e,t){return{tag:"camera",setCamera:n=>{e.node.camera.set(t,n)},remove:()=>{e.node.camera.remove(t)}}}}(dt||(dt={})),function(e){e.create=function(e,t){return{tag:"orientation",setOrientation:n=>{e.node.orientation.set(t,n)},remove:()=>{e.node.orientation.remove(t)}}}}(ft||(ft={})),function(e){e.create=function(e,t){return{tag:"position",setPosition:n=>{e.node.position.set(t,n)},remove:()=>{e.node.position.remove(t)}}}}(pt||(pt={})),function(e){e.create=function(t,n){const r=t.node.create();return t.node.parent.set(r,n),{tag:"node",createCamera:()=>dt.create(t,r),createGeometry:()=>at.create(t,r),createLayer:e=>lt.create(t,r,e),createNode:()=>e.create(t,r),createPosition:()=>pt.create(t,r),createOrientation:()=>ft.create(t,r),setClick:e=>{e?t.node.click.set(r,e):t.node.click.remove(r)},setEnter:e=>{e?t.node.enter.set(r,e):t.node.enter.remove(r)},setLeave:e=>{e?t.node.leave.set(r,e):t.node.leave.remove(r)},setDraw:e=>{e?t.node.draw.set(r,e):t.node.draw.remove(r)},setMouseDown(e){e?t.node.mouseDown.set(r,e):t.node.mouseDown.remove(r)},setMouseUp(e){e?t.node.mouseUp.set(r,e):t.node.mouseUp.remove(r)},setTransparencyOrder(e){void 0!==e?t.node.transparencyOrder.set(r,e):t.node.transparencyOrder.remove(r)},setName(e){void 0!==e?t.node.name.set(r,e):t.node.name.remove(r)},remove:()=>{t.node.remove(r)}}}}(vt||(vt={})),function(e){e.create=function(e,t){const n=e.scene.create();return e.scene.parent.set(n,t),{tag:"scene",createNode:()=>vt.create(e,n),remove:()=>{e.scene.remove(n)},createProperties:()=>ct.create(e,n)}}}(gt||(gt={})),function(e){e.create=function(e,t){return{tag:"size",setSize:n=>{e.element.size.set(t,n)},remove:()=>{e.element.size.remove(t)}}}}(xt||(xt={})),function(e){e.create=function(e,t){return{tag:"viewport",setViewport:remove:}}(yt||(yt={})),function(e){e.create=function(t,n,r){const o=t.element.create();return t.element.order.set(o,n),t.element.parent.set(o,r),{tag:"element",createOffset:()=>mt.create(t,o),createSize:()=>xt.create(t,o),createViewport:()=>yt.create(t,o),createLayer:e=>lt.create(t,o,e),createElement:n=>e.create(t,n,o),createScene:()=>gt.create(t,r),setClick:e=>{e?t.element.click.set(o,e):t.element.click.remove(o)},setEnter:e=>{e?t.element.enter.set(o,e):t.element.enter.remove(o)},setLeave:e=>{e?t.element.leave.set(o,e):t.element.leave.remove(o)},setMouseDown(e){e?t.element.mouseDown.set(o,e):t.element.mouseDown.remove(o)},setMouseUp(e){e?t.element.mouseUp.set(o,e):t.element.mouseUp.remove(o)},remove:()=>{t.element.remove(o)}}}}(ht||(ht={})),function(e){e.create=function(e){const t=e.screen.create();return{tag:"screen",createElement:n=>ht.create(e,n,t),createScene:()=>gt.create(e,t),setDraw:n=>{n?e.screen.draw.set(t,n):e.screen.draw.remove(t)},setClearColor(n){n?e.screen.color.set(t,n):e.screen.color.remove(t)},remove:()=>{e.screen.remove(t)}}}}(bt||(bt={})),function(e){e.create=function(e){const t=e.screen.create();return{tag:"offscreen",createElement:n=>ht.create(e,n,t),createScene:setDraw:n=>{n?e.screen.draw.set(t,n):e.screen.draw.remove(t)},setSize:n=>{n?e.screen.size.set(t,n):e.screen.size.remove(t)},setClearColorremove:}}(wt||(wt={})),function(e){e.create=function(e){return{tag:"screens",createScreen:()=>bt.create(e),createOffScreen:()=>wt.create(e),remove:()=>{}}}}(Tt||(Tt={})),function(e){e.create=function(e){return{tag:"root",createScreen:()=>bt.create(e),createScreens:()=>Tt.create(e),remove:()=>{}}}}(Ct||(Ct={})),function(e){e.create=function(){return{offset:(e,t,n)=>{const r=n.createOffset();return r.setOffset(t),r},size:(e,t,n)=>{const r=n.createSize();return r.setSize(t),r},viewport:(e,t,n)=>{const r=n.createViewport();return r.setViewport(t),r},layer:(e,t,n,r)=>{const o=n.createLayer(null!=r?r:-1);return t.culling&&o.setCulling(t.culling),t.clipping&&o.setClipping(t.clipping),o},element:(e,t,n,r)=>{const o=n.createElement(null!=r?r:-1);return t.onClick&&o.setClick(t.onClick),t.onEnter&&o.setEnter(t.onEnter),t.onLeave&&o.setLeave(t.onLeave),t.onMouseDown&&o.setMouseDown(t.onMouseDown),t.onMouseUp&&o.setMouseUp(t.onMouseUp),o},scene:(e,t,n)=>n.createScene()}}}(Et||(Et={})),function(e){e.create=function(){return{material:(e,t,n,r)=>{const o=n.createMaterial();return t.blending&&o.setBlending(t.blending),t.stencil&&o.setStencil(t.stencil),t.colorMask&&o.setColorMask(t.colorMask),o},geometry:(e,t,n,r)=>{const o=n.createGeometry();return o.setGeometry(t),o}}}}(St||(St={})),function(e){e.create=function(){return{properties:(e,t,n)=>{const r=n.createProperties();return r.setProperties(t),r},shader:(e,t,n)=>{const r=n.createShader();return r.setShader(t),r}}}}(Mt||(Mt={})),function(e){e.create=function(){return{node:(e,t,n)=>{const r=n.createNode();return t.transparencyOrder&&r.setTransparencyOrder(t.transparencyOrder),t.onClick&&r.setClick(t.onClick),t.onEnter&&r.setEnter(t.onEnter),t.onLeave&&r.setLeave(t.onLeave),t.onDraw&&r.setDraw(t.onDraw),t.onMouseDown&&r.setMouseDown(t.onMouseDown),t.onMouseUp&&r.setMouseUp(t.onMouseUp),t.name&&r.setName(t.name),r},position:(e,t,n)=>{const r=n.createPosition();return r.setPosition(t),r},orientation:(e,t,n)=>{const r=n.createOrientation();return r.setOrientation(t),r},camera:(e,t,n)=>{const r=n.createCamera();return r.setCamera({...t}),r},layer:(e,t,n,r)=>{const o=n.createLayer(null!=r?r:-1);return t.culling&&o.setCulling(t.culling),t.clipping&&o.setClipping(t.clipping),o},geometry:(e,t,n,r)=>{const o=n.createGeometry();return o.setGeometry(t),o}}}}(At||(At={})),function(e){e.create=function(){return{scene:(e,t,n)=>n.createScene(),element:(e,t,n,r)=>{const o=n.createElement(null!=r?r:-1);return t.onClick&&o.setClick(t.onClick),t.onEnter&&o.setEnter(t.onEnter),t.onLeave&&o.setLeave(t.onLeave),o}}}}(Rt||(Rt={})),function(e){e.create=function(){return{screen:(e,t,n)=>{const r=n.createScreen();return t.onDraw&&r.setDraw(t.onDraw),r},screens:(e,t,n)=>n.createScreens()}}}(zt||(zt={})),function(e){e.create=function(){return{node:(e,t,n)=>{const r=n.createNode();return t.transparencyOrder&&r.setTransparencyOrder(t.transparencyOrder),t.onClick&&r.setClick(t.onClick),t.onEnter&&r.setEnter(t.onEnter),t.onLeave&&r.setLeave(t.onLeave),t.onMouseDown&&r.setMouseDown(t.onMouseDown),t.onMouseUp&&r.setMouseUp(t.onMouseUp),t.onDraw&&r.setDraw(t.onDraw),t.name&&r.setName(t.name),r},properties:(e,t,n)=>{const r=n.createProperties();return r.setProperties(t),r}}}}(Pt||(Pt={})),function(e){e.create=function(){return{scene:element:(e,t,n,r)=>{const o=n.createElement(null!=r?r:-1);return t.onClick&&o.setClick(t.onClick),t.onEnter&&o.setEnter(t.onEnter),t.onLeave&&o.setLeave(t.onLeave),t.onMouseDown&&o.setMouseDown(t.onMouseDown),t.onMouseUp&&o.setMouseUp(t.onMouseUp),o}}}}(kt||(kt={})),function(e){e.create=function(){return{screen:(e,t,n)=>{const r=n.createScreen();return t.onDraw&&r.setDraw(t.onDraw),t.clearColor&&r.setClearColor(t.clearColor),r},offscreen:(e,t,n)=>{const r=n.createOffScreen();return t.onDraw&&r.setDraw(t.onDraw),t.size&&r.setSize(t.size),t.clearColor&&r.setClearColor(t.clearColor),r}}}}(_t||(_t={})),function(e){e.create=(Bt||(Bt={})),function(e){function t(e,t){return e===t||!!r(Object.keys(e),e,t)&&!!r(Object.keys(t),e,t)}function n(e){return Array.isArray(e)||"object"==typeof e&&"length"in e}function r(e,r,o){for(const i of e){if(void 0!==(null==r?void 0:r[i])&&void 0!==(null==o?void 0:o[i])&&r[i]!==o[i]){const e=r[i],a=o[i];if(n(e)&&n(a))return!1;if("object"==typeof e){if(!t(e,a))return!1;continue}return!1}if(void 0!==(null==r?void 0:r[i])&&void 0===(null==o?void 0:o[i])||void 0!==(null==o?void 0:o[i])&&void 0===r[i])return!1}return!0}e.strictEquals=t,e.weakEquals=function(e,t){if(e===t)return!0;for(const n of Object.keys(e))if(e[n]!==t[n])return!1;for(const n of Object.keys(t))if(e[n]!==t[n])return!1;return!0},e.find=function(e,t){for(const n in e){const r=e[n];if(t(n,r))return r}},e.findEntry=function(e,t){for(const n in e){const r=e[n];if(t(n,r))return{key:n,value:r}}},e.toArray=function(e,t){const n=[];for(const r in e){const o=e[r];t(r,o)&&n.push(o)}return n},e.foreach=e.map=function(e,t){const n=e).map(t);return r=n,[...r].reduce((,{});var r}}(Ft||(Ft={})),function(e){e.defaultColorMask=e.equal=function(e,t){return e===t||void 0!==e&&void 0!==t&&e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}}(It||(It={})),function(e){e.create=function(){return{camera:(e,t,n)=>{t.id===n.id&&Ze.equals(t.projection,n.projection)&&t.shutterSpeed===n.shutterSpeed&&t.aperture===n.aperture&&t.sensitivity===n.sensitivity||e.setCamera({...n})},viewport:(e,t,n)=>{t.cameraId!==n.cameraId&&e.setViewport(n)},element:(e,t,n)=>{t.onClick!==n.onClick&&e.setClick(n.onClick),t.onEnter!==n.onEnter&&e.setEnter(n.onEnter),t.onLeave!==n.onLeave&&e.setLeave(n.onLeave)},geometry:(e,t,n)=>{t.indices===n.indices&&t.vertexCount===n.vertexCount&&Ft.weakEquals(t.vertices,n.vertices)||e.setGeometry(n)},node:(e,t,n)=>{t.onClick!==n.onClick&&e.setClick(n.onClick),t.onEnter!==n.onEnter&&e.setEnter(n.onEnter),t.onLeave!==n.onLeave&&e.setLeave(n.onLeave),t.onDraw!==n.onDraw&&e.setDraw(n.onDraw),t.transparencyOrder!==n.transparencyOrder&&e.setTransparencyOrder(n.transparencyOrder),t.name!==n.name&&e.setName(n.name)},offset:(e,t,n)=>{t.x===n.x&&t.y===n.y||e.setOffset(n)},orientation:(e,t,n)=>{t.x===n.x&&t.y===n.y&&t.z===n.z&&t.w===n.w||e.setOrientation(n)},position:(e,t,n)=>{t.x===n.x&&t.y===n.y&&t.z===n.z||e.setPosition(n)},shader:(e,t,n)=>{t.fragment===n.fragment&&t.vertex===n.vertex&&Ft.weakEquals(t.uniforms,n.uniforms)||e.setShader(n)},size:(e,t,n)=>{t.height===n.height&&t.width===n.width||e.setSize(n)},properties:(e,t,n)=>{Ft.strictEquals(t,n)||e.setProperties(n)},material:(e,t,n)=>{var r,o,i,a;(null===(r=t.blending)||void 0===r?void 0:r.source)===(null===(o=n.blending)||void 0===o?void 0:o.source)&&(null===(i=t.blending)||void 0===i?void 0:i.destination)===(null===(a=n.blending)||void 0===a?void 0:a.destination)||e.setBlending(n.blending),m.equal(t.stencil,n.stencil)||e.setStencil(n.stencil),It.equal(t.colorMask,n.colorMask)||e.setColorMask(n.colorMask)},screen:(e,t,n)=>{var r,o,i,a,c,s,u,l;t.onDraw!==n.onDraw&&e.setDraw(n.onDraw),(null===(r=t.clearColor)||void 0===r?void 0:r.r)===(null===(o=n.clearColor)||void 0===o?void 0:o.r)&&(null===(i=t.clearColor)||void 0===i?void 0:i.g)===(null===(a=n.clearColor)||void 0===a?void 0:a.g)&&(null===(c=t.clearColor)||void 0===c?void 0:c.b)===(null===(s=n.clearColor)||void 0===s?void 0:s.b)&&(null===(u=t.clearColor)||void 0===u?void 0:u.a)===(null===(l=n.clearColor)||void 0===l?void 0:l.a)||e.setClearColor(n.clearColor)},offscreen:(e,t,n)=>{var r,o,i,a;t.onDraw!==n.onDraw&&e.setDraw(n.onDraw),(null===(r=t.size)||void 0===r?void 0:r.width)===(null===(o=n.size)||void 0===o?void 0:o.width)&&(null===(i=t.size)||void 0===i?void 0:i.height)===(null===(a=n.size)||void 0===a?void 0:a.height)||e.setSize(n.size)},layer:(e,t,n)=>{t.culling!==n.culling&&e.setCulling(n.culling),t.clipping!==n.clipping&&e.setClipping(n.clipping)}}}}(Ot||(Ot={})),function(e){e.create=function(){const e=Bt.create(),t=Ot.create();return{createAndAddText:(e,t,n)=>({tag:"text"}),updateText(e,t){},removeTextFromParentcreateAndAddNode(t,n,r,o){const i=e[r.tag],a=i?i[t]:void 0;if(!i||!a)throw`Unable to add ${t} to ${r.tag}`;return a(t,n,r,o)},updateAttributes(e,n,r){const o=t[e.tag];o&&o(e,n,r)},removeNodeFromParent}}(Nt||(Nt={})),function(e){const t="abcdefghijklmnopqrstvwxyzABCDEFGHIJKLMNOPQRSTVWXYZ0123456789".split(""),n=t.length;function r(){let e=0;return{next:()=>{let r="",o=e;for(;o>=0;){let e=o%n;r=t[e]+r,o=(o-e|0/n)-1}return e++,r}}}e.createFromType=function(e){const t=r();return{next:()=>`${e}-${t.next()}`}},e.create=(Dt||(Dt={})),function(e){e.create=function(){let e={};const t=[],n=[],r=[],o=[];function i(e,n,r){for(const o of t)o(e,n,r)}eturn{get:set(t,r){const o=e[t];o!==r&&(e[t]=r,void 0===o?function(e,t){for(const r of n)r(e,t)}(t,r):i(t,o,r))},setPartial(t,n){const r=e[t];if(void 0===r)throw"Unable to set partial on non-existing component.";const o={...r,...n};e[t]=o,i(t,r,o)},remove(t){const n=e[t];if(void 0!==n)return delete e[t],a(t,n),n},update(t,n){const r=e[t];if(void 0!==r){const o=n(r);e[t]=o,i(t,r,o)}},updateAll(t){for(const n in e){const r=e[n],o=t(n,r);e[n]=o,i(n,r,o)}},throwError(e){!function(e){for(const t of o)t(e)}(e)},async onChanged(e){t.push(e)},async onAdded(t){n.push(t);for(const n in e)t(n,e[n])},async onRemoved(e){r.push(e)},async onError(e){o.push(e)},clear(){for(const t in e)a(t,e[t]);e={}},entries:()=>Object.entries(e),record:()=>e}}}(Lt||(Lt={})),function(e){e.create=function(e){const t=Lt.create();let n={};return e.onAdded(((e,t)=>{n[e]={op:"s",value:t}})),e.onChanged(((e,t,r)=>{n[e]={op:"s",value:r}})),e.onRemoved((),{get:t.get,onChanged:t.onChanged,onAdded:t.onAdded,onRemoved:t.onRemoved,entries:t.entries,processChanges(){let e=!1;for(const r in n){const o=n[r];switch(o.op){case"s":t.set(r,o.value);break;case"r":t.remove(r)}e=!0}e&&(n={})}}}}(Ut||(Ut={})),function(e){e.create=function(e,t,n,r,o){const i=Lt.create();return e.available.onChanged(((r,o)=>{if(void 0===o||!1===o)i.clear();else for(const[r,o]of t.entries()){const t=n(e,i,o,r);i.set(r,t)}})),t.onAdded(((t,r)=>{if(!e.available.get())return;const o=n(e,i,r,t);i.set(t,o)})),t.onChanged(((t,n,o)=>{if(!e.available.get())return;const a=i.get(t);if(a){const c=r(e,i,n,o,a,t);i.set(t,c)}})),t.onRemoved(((t,n)=>{if(!e.available.get())return;const r=i.get(t);r&&(o(e,i,n,r,t),i.remove(t))})),i}}(Gt||(Gt={})),function(e){e.create=function(e,t){function n(e,n){for(const r of t.entries())if(r[1]===e&&n!==r[0])return r[0]}return Gt.create(e,t,((e,t,r,o)=>{const i=n(r,o);return void 0!==i?t.get(i):e.createRenderGeometry(r)}),((e,t,r,o,i,a)=>{if(void 0===i.vertices)return i;const c=n(o,a);let s;s=void 0!==c?t.get(c):e.createRenderGeometry(o);for(const e in i.vertices){const t=e,n=i.vertices[t];if(!n)throw"Can't find vertex buffer";n.delete()}return i.indices.delete(),s}),((e,t,n,r)=>{if(void 0!==r.indices){r.indices.delete();for(const e in r.vertices){const t=e,n=r.vertices[t];if(!n)throw"Can't find vertex buffer";n.delete()}}}))}}(Vt||(Vt={})),function(e){e.create=function(){return{vertexCount:4,vertices:{position:l.fromArray([0,0,1,0,1,1,0,1],"vec2"),textureCoordinates:l.fromArray([0,0,1,0,1,1,0,1],"vec2")},indices:new Uint16Array([0,1,2,0,2,3]),layout:"triangles"}}}(Ht||(Ht={})),function(e){e.connect=function(e){const t=Lt.create(),n=Ut.create(t),r=Vt.create(e,n);return t.set("elementGeometry",Ht.create()),{...r,processChanges:n.processChanges,renderGeometry:r}}}(jt||(jt={})),function(e){unction r(e){return e.x}function o(e){return r(e)+e.width}unction a(e){return i(e)+e.height}function c(e){return t.lerp(i(e),a(e),.5)}function s(e){return t.lerp(r(e),o(e),.5)}e.create=n,e.getRelative=function(t,n){const r=(n.x-t.x)/t.width,o=(n.y-t.y)/t.height,i=n.width/t.width,a=n.height/t.height;return e.create(r,o,i,a)},e.intersectPoint=function(e,t){if(!(t.x<e.x||t.y<e.y||t.x>e.x+e.width||t.y>e.y+e.height))return u.subtract(t,e)},e.union=function(t,n){const r=Math.min(t.x,n.x),o=Math.min(t.y,n.y),i=Math.max(t.x+t.width,n.x+n.width),a=Math.max(t.y+t.height,n.y+n.height);return e.create(r,o,i-r,a-o)},e.getFittingSquare=function(t){if(t.width>t.height){const n=(t.width-t.height)/2+("x"in t?t.x:0),r="y"in t?t.y:0;return e.create(n,null!=r?r:0,t.height,t.height)}{const n="x"in t?t.x:0,r=(t.height-t.width)/2+("y"in t?t.y:0);return e.create(n,r,t.width,t.width)}},e.left=r,e.right=o,e.top=i,e.bottom=a,e.centerH=c,e.centerV=s,e.center=e.inset=function(e,t,c){const s=r(e)+t,u=o(e)-t-s;if(u<0)return;const l=i(e)+c,m=a(e)-c-l;return m<0?void 0:n(s,l,u,m)}}(Wt||(Wt={})),function(e){e.create=function(e,t){return{x:e,y:t}},e.zero=function(){return{x:"0",y:"0"}},e.equals=function(e,t){return e.x===t.x&&e.y===t.y}}(Xt||(Xt={})),function(e){e.calculateOffsetSizeInPixels=function(e,t,n){const r=Ye.getSizeInPixels(t.x,e.width),o=Ye.getSizeInPixels(t.y,e.height),i=function(e,t){return Ye.isAspectRatioLength(e.width)?Ye.isAspectRatioLength(e.height)?0:Math.round(Ye.getSizeInPixels(e.height,t.height)/Ye.getAspectRatio(e.width)):Ye.getSizeInPixels(e.width,t.width)}(n,e),a=function(e,t){return Ye.isAspectRatioLength(e.height)?Ye.isAspectRatioLength(e.width)?0:Math.round(Ye.getSizeInPixels(e.width,t.width)/Ye.getAspectRatio(e.height)):Ye.getSizeInPixels(e.height,t.height)}(n,e);return{x:r,y:o,width:i,height:a}}}($t||($t={})),function(e){e.create=function(e,t){return{width:e,height:t}},e.full=e.equals=(qt||(qt={})),function(e){function t(e,t,n){const r=e.get(n),o=r?[...r,t]:[t];e.set(n,o)}function n(e,t,n){const r=e.get(n);if(r)if(1===r.length&&r[0]===t)e.remove(n);else{const o=r.slice(),i=o.indexOf(t);o.splice(i,1),e.set(n,o)}}e.create=function(e){const r=Lt.create();return e.onAdded(((e,n)=>{t(r,e,n)})),e.onChanged((),e.onRemoved((),r},e.createEmpty=function(){const e=Lt.create();return{store:e,set:function(n,r){var o;(null===(o=e.get(n))||void 0===o?void 0:o.includes(r))||t(e,r,n)},remove:}}(Yt||(Yt={})),function(e){function t(e,t,n){if(e&&t){const n=$t.calculateOffsetSizeInPixels(e,t.offset,t.size);return n.x+=e.x,n.y+=e.y,n}if(t){const e=Wt.create(0,0,n.width,n.height);return $t.calculateOffsetSizeInPixels(e,t.offset,t.size)}return e||Wt.create(0,0,n.width,n.height)}e.create=function(e,n,r,o){const i=Lt.create(),a=Yt.create(n);return r.onChanged(((t,r)=>{var a;for(const t of i.entries()){const c=t[0],s=n.get(c);if(s&&(!ot.isScreenId(s)||o.get(s)))continue;const{offset:u,size:l}=null!==(a=e.get(c))&&void 0!==a?a:{offset:Xt.zero(),size:qt.full()},m=$t.calculateOffsetSizeInPixels(r,u,l);i.set(c,m)}})),o.onChanged(((t,r,o)=>{var a;for(const r of i.entries()){const c=r[0],s=n.get(c);if(s&&(!ot.isScreenId(s)||s!==t))continue;const{offset:u,size:l}=null!==(a=e.get(c))&&void 0!==a?a:{offset:Xt.zero(),size:qt.full()},m=$t.calculateOffsetSizeInPixels(o,u,l);i.set(c,m)}})),e.onAdded(((e,{offset:a,size:c})=>{const s=n.get(e),u=t(s&&!ot.isScreenId(s)?i.get(s):void 0,{offset:a,size:c},ot.isScreenId(s)&&o.get(s)?o.get(s):r.get());i.set(e,u)})),e.onChanged(((e,a,{offset:c,size:s})=>{const u=n.get(e),l=t(u&&!ot.isScreenId(u)?i.get(u):void 0,{offset:c,size:s},ot.isScreenId(u)&&o.get(u)?o.get(u):r.get());i.set(e,l)})),e.onRemoved((e=>{i.remove(e)})),i.onAdded(((c,s)=>{const u=a.get(c);if(u)for(const a of u){const u=e.get(a),l=n.get(c),m=t(s,u,ot.isScreenId(l)&&o.get(l)?o.get(l):r.get());i.set(a,m)}})),i.onChanged(((c,s,u)=>{const l=a.get(c);if(l)for(const a of l){const s=e.get(a),l=n.get(c),m=t(u,s,ot.isScreenId(l)&&o.get(l)?o.get(l):r.get());i.set(a,m)}})),i}}(Zt||(Zt={})),function(e){e.connect=function(e,t,n,r,o){const i=function(e,t){const n=Lt.create();function r(r){const o=[];for(const t of e){const e=t.get(r);if(void 0===e)return;o.push(e)}const i=t.apply(void 0,o);n.set(r,i)}for(const t of e)t.onAdded(r),t.onChanged(r),t.onRemoved(((e,t)=>{n.remove(e)}));return n}([e,t],();return Zt.create(i,r,n,o)}}(Qt||(Qt={})),function(e){e.connect=function(e,t){const n=Ut.create(t),r=Vt.create(e,n);return{processChanges:n.processChanges,renderGeometry:r}}}(Kt||(Kt={})),function(e){e.isBooleanProperty=function(e){return"boolean"==typeof e},e.isNumberProperty=function(e){return"number"==typeof e},e.isColorProperty=function(e){return"object"==typeof e&&"r"in e},e.isVectorArrayProperty=function(e){if("object"!=typeof e||!("length"in e)||!("push"in e))return!1;const t=e[0];return null!=t&&"object"==typeof t},e.isTextureProperty=e.convertVector3ArrayToFloatArray=function(e){const t=e.length,n=new Float32Array(3*t);for(var r=0;r<t;r++){const t=3*r;n[t]=e[r].x,n[t+1]=e[r].y,n[t+2]=e[r].z}return n}}(Jt||(Jt={})),function(e){function t(e,t){const n={};for(const r in e){const o=e[r];if(Jt.isTextureProperty(o)){const e=t(o);n[r]=e}else if(Jt.isVectorArrayProperty(o)){const e=Jt.convertVector3ArrayToFloatArray(o);n[r]=e}else n[r]=o}return n}e.create=function(e,n){const r=Lt.create();return e.onAdded((),e.onChanged(((e,o,i)=>{if(!r.get(e))throw"Material not found : MaterialPropertiesStore on changed";o!==i&&r.set(e,t(i,n))})),e.onRemoved(((e,t)=>{r.remove(e)})),r}}(en||(en={})),function(e){function t(e,t){const n=e.createTexture("cubemap");if(!n)throw"Unabled to create texture from context";return n.texCubemapFromBuffer("rgba8",0,"rgba","unsignedByte",t),n.setTextureParametersFromSampler({mipmapping:!0,magFilter:"linear",minFilter:"linearMipmapLinear",wrapS:"clampToEdge",wrapT:"clampToEdge"}),{state:"loaded",texture:n,width:t.data[0].width,height:t.data[0].height,mipmapped:!0}}function n(e,t){var n,o;const i=e.createTexture("2D");if(!i)throw"Unabled to create texture from context";let a=!1,c=0,s=0;if("pixelData"===t.type){for(let e=0;e<t.lods;e++){const r=t.data[e],a=null!==(n=r.internalFormat)&&void 0!==n?n:"rgba8",c=null!==(o=r.format)&&void 0!==o?o:"rgba";i.texImage2DFromBuffer(e,a,r.width,r.height,0,c,"unsignedByte",r.pixels)}c=t.data[0].width,s=t.data[0].height,a=r(0,c,s,i)}else if("image"===t.type){for(let e=0;e<t.lods;e++){const n=t.image[e];i.texImage2DFromImage(e,"rgba8","rgba","unsignedByte",n)}c=t.image[0].width,s=t.image[0].height,1==t.lods&&(a=r(0,c,s,i))}else if("canvas"===t.type){const e=t.canvas;i.texImage2DFromImage(0,"rgba8","rgba","unsignedByte",e),a=r(0,c,s,i),c=t.canvas.width,s=t.canvas.height}else if("hdrData"===t.type){for(let e=0;e<t.lods;e++){const n=t.data[e];i.texImage2DFromBuffer(e,"rgb16f",n.width,n.height,0,"rgb","float",n.floatPixels)}c=t.data[0].width,s=t.data[0].height}return{state:"loaded",texture:i,width:c,height:s,mipmapped:a}}function r(e,t,n,r,i){const a=o((c={width:t,height:n}).width)&&o(c.height);var c,s=null!=i?i:{mipmapping:a,magFilter:"linear",minFilter:"linearMipmapLinear",wrapS:"repeat",wrapT:"repeat"};return a?r.generateMipmap():i||(s.magFilter="linear",s.minFilter="linear",s.wrapS="clampToEdge",s.wrapT="clampToEdge"),r.setTextureParametersFromSampler(s),a}.create=function(e,r){return Gt.create(e,r,((e,r,o)=>{switch(o.type){case"loading":return{state:"loading"};case"image":case"pixelData":case"canvas":case"hdrData":return n(e,o);case"cubemapData":return t(e,o.data)}}),((e,r,o,i,a)=>{switch(i.type){case"loading":return{state:"loading"};case"image":case"pixelData":case"canvas":case"hdrData":if(!("loaded"===a.state?a.texture:e.createTexture("2D")))throw"Unabled to create texture from context";return n(e,i);case"cubemapData":if(!("loaded"===a.state?a.texture:e.createTexture("2D")))throw"Unabled to create texture from context";return t(e,i.data)}}),((e,t,n,r)=>{"loading"!==r.state&&r.texture.delete()}))}}(tn||(tn={})),function(e){e.tryGetMimeType=function(e){var t=e.match(/^data:(.*);base64/i);if(t&&t.length)return t[1]}}(nn||(nn={})),function(e){e.tryGetBlobExtension=async function(e){if(!e.startsWith("blob"))return;const t=await fetch(e);return(await t.blob()).type}}(rn||(rn={})),function(e){e.tryGetExtension=function(e){const t=e.split(/[#?]/)[0].split(".").pop();if(e!==t)return null==t?void 0:t.trim()}}(on||(on={})),function(e){function t(e,t,n,r){t=Math.pow(2,void 0===t?1:t)/2,void 0===n&&(n=2.2);for(var o,i=1/n,a=e.byteLength>>2,c=(r=r||new Uint8ClampedArray(4*a),0);c<a;c++)o=t*Math.pow(2,e[4*c+3]-136),r[4*c]=255*Math.pow(e[4*c]*o,i),r[4*c+1]=255*Math.pow(e[4*c+1]*o,i),r[4*c+2]=255*Math.pow(e[4*c+2]*o,i),r[4*c+3]=255;return r}e.create=function(){let e,n,r,o="t";const i=document.createElement("canvas");return{...i,getWidth:()=>i.width,getHeight:dataFloat:()=>function(e,t){const n=e.byteLength>>2,r=new Float32Array(3*n);for(let t=0;t<n;t++){const n=Math.pow(2,e[4*t+3]-136);r[3*t]=e[4*t]*n,r[3*t+1]=e[4*t+1]*n,r[3*t+2]=e[4*t+2]*n}return r}(e),setSource(a){if(o=a,r&&r.clearRect(0,0,i.width,i.height),a.match(/\.hdr$|blob:/i))!function(e,t){const n=new XMLHttpRequest,{responseType:"arraybuffer"});n.onerror=t.bind(n,new Uint8Array(0)),n.onload=function(){if(this.status>=400)return this.onerror();let e="",n=0;const r=new Uint8Array(this.response);let o;for(;!e.match(/(\r?\n){2}[^\r\n]+(\r?\n)/g);)e+=String.fromCharCode(r[n++]);if(o=e.match(/FORMAT=(.*)$/m)[1],"32-bit_rle_rgbe"!=o)return console.warn("unknown format : "+o),this.onerror();const i=e.split(/\n/).reverse()[1].split(" "),a=parseInt(i[3]),c=parseInt(i[1]),s=new Uint8Array(a*c*4);let u=0;for(let e=0;e<c;e++){const e=r.slice(n,n+=4),t=[];if(2!=e[0]||2!=e[1]||128&e[2]){let e=a,t=0;for(n-=4;e>0;)if(s.set(r.slice(n,n+=4),u),1==s[u]&&1==s[u+1]&&1==s[u+2]){for(let n=s[u+3]<<t;n>0;n--)s.set(s.slice(u-4,u),u),u+=4,e--;t+=8}else e--,u+=4,t=0}else{if((e[2]<<8)+e[3]!=a)return console.warn("HDR line mismatch .."),this.onerror();for(let e=0;e<4;e++){let o=e*a;const i=(e+1)*a;let c,s;for(;o<i;)if(c=r.slice(n,n+=2),c[0]>128)for(s=c[0]-128;s-- >0;)t[o++]=c[1];else for(s=c[0]-1,t[o++]=c[1];s-- >0;)t[o++]=r[n++]}for(let e=0;e<a;e++)s[u++]=t[e],s[u++]=t[e+a],s[u++]=t[e+2*a],s[u++]=t[e+3*a]}}t&&t(s,a,c)},n.open("GET",e,!0),n.send(null)}(a,((o,a,c)=>{e=o,i.style.width=a.toString(),i.style.height=c.toString(),i.width=a,i.height=c,r=i.getContext("2d"),n=r.getImageData(0,0,a,c),t(e,1,2.2,n.data),r.putImageData(n,0,0),this.onLoad&&this.onLoad()}));else if(a.match(/\.hdr\.png$|\.rgbe\.png/i)){const o=new Image;o.src=a;const c=this;o.onload=function(){const a=document.createElement("canvas");a.width=o.width,a.height=o.height,i.style.width=a.width.toString(),i.style.height=a.height.toString(),i.width=a.width,i.height=a.height;const s=i.width,u=i.height,l=a.getContext("webgl"),m=l.createTexture();l.bindTexture(l.TEXTURE_2D,m),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,o);let d=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,d),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,m,0);const f=new Uint8Array(s*u*4);l.readPixels(0,0,s,u,l.RGBA,l.UNSIGNED_BYTE,f),l.deleteTexture(m),l.deleteFramebuffer(d),e=f,r=i.getContext("2d"),n=r.getImageData(0,0,s,u),t(e,1,2.2,n.data),r.putImageData(n,0,0),c.onLoad&&c.onLoad()}.bind(i)}},onLoad:()=>{}}}}(an||(an={})),function(e){function t(e,t,n){const r=document.createElement("img");r.crossOrigin="anonymous",r.src=e,r.onload=()=>{t(r,n)}}function n(e,t,n){const r=an.create();r.onLoad=()=>{t(r,n)},r.setSource(e)}e.getUrlExtension=async function(e){const t=rn.tryGetBlobExtension(e);if(void 0!==await t)return await t;const n=nn.tryGetMimeType(e);if(void 0!==n)return n;const r=on.tryGetExtension(e);return void 0!==r?r:void 0},e.createHdrLoader=function(){return(e,t)=>{const r=e.lods?e.lods:1;!function(e,t=1,r){const o=[];let i=0;for(let a=0;a<t;a++)n(e[a],((e,n)=>{o[n]={floatPixels:e.dataFloat(),width:e.getWidth(),height:e.getHeight()},i++,i===t&&r(o)}),a)}(Array.isArray(e.url)?e.url:[e.url],e.lods,(e=>{t({type:"hdrData",data:e,lods:r})}))}},e.createNormalLoader=function(){return(e,n)=>{const r=e.lods?e.lods:1;!function(e,n=1,r){const o=[];let i=0;for(let a=0;a<n;a++)t(e[a],((e,t)=>{o[t]=e,i++,i===n&&r(o)}),a)}(Array.isArray(e.url)?e.url:[e.url],e.lods,()}}}(cn||(cn={})),function(e){e.create=function(e,t,n){const r=Lt.create();return e.onAdded(((e,o)=>{const i=t=>{r.update(e,(()=>t))};switch(o.texture.type){case"url":{r.set(e,{type:"loading"});const n=(Array.isArray(o.texture.url)?o.texture.url:[o.texture.url])[0];cn.getUrlExtension(n).then((e=>{if(void 0===e)throw"Texture extension not recognized";const n=t[e];if(void 0===n)throw`Loader not found for type ${e}`;n(o.texture,i)})).catch(();break}case"image":{const t=Array.isArray(o.texture.image)?o.texture.image:[o.texture.image],n=o.texture.lods?o.texture.lods:1;r.set(e,{type:"image",image:t,lods:n});break}case"pixelData":{const t=Array.isArray(o.texture.data)?o.texture.data:[o.texture.data],n=o.texture.lods?o.texture.lods:1;r.set(e,{type:"pixelData",data:t,lods:n});break}case"canvas":{const t=o.texture.canvas,n=()=>{r.set(e,{type:"canvas",canvas:t,contentChanged:n})};t.addEventListener("contentChanged",n),r.set(e,{type:"canvas",canvas:t,contentChanged:n});break}case"cubemap":{r.set(e,{type:"loading"});const t=n.hdr;if(void 0===t)throw"Loader not found";t(o.texture,i)}}})),e.onRemoved(((e,t)=>{const n=r.remove(e);n&&"canvas"===n.type&&n.canvas.removeEventListener("contentChanged",n.contentChanged)})),r}}(sn||(sn={})),function(e){e.create=function(e,t,n){const r=Lt.create(),o=Yt.createEmpty();function i(e){const t=n(e),o=r.get(t);if(o){const n={texture:e,used:o.used+1};r.set(t,n)}else{const n={texture:e,used:1};r.set(t,n)}}function a(e){const t=n(e),o=r.get(t);if(o){if(1===o.used)return r.remove(t),!0;{const n={texture:e,used:o.used-1};return r.set(t,n),!1}}return!1}function c(e,r){const i=t(r);i&&o.set(n(e),i)}return e.onAdded(((e,t)=>{for(const n in t){const r=t[n];Jt.isTextureProperty(r)&&(c(r,e),i(r))}})),e.onChanged(((e,t,n)=>{for(const t in n){const r=n[t];Jt.isTextureProperty(r)&&(c(r,e),i(r))}for(const n in t){const r=t[n];Jt.isTextureProperty(r)&&a(r)&&c(r,e)}})),e.onRemoved(((e,t)=>{for(const n in t){const r=t[n];Jt.isTextureProperty(r)&&a(r)&&c(r,e)}})),{textureUsageStore:r,textureScreenStore:o.store}}}(un||(un={})),function(e){function t(e,t,n){const r=document.createElement("img");r.crossOrigin="anonymous",r.src=e,r.onload=e.createCubemapLoader=function(){return(e,n)=>{!function(e,n){const r=[];let o=0,i=0;const a=e.data,c=a.length,s=6*c;for(let e=0;e<c;e++){const c=a[e];for(let e in c)t(c[e],((t,i)=>{if(void 0===i)throw"Error index undefined";void 0===r[i]&&(r[i]={faces:{left:{},bottom:{},front:{},right:{},top:{},back:{}},width:0,height:0}),r[i].faces[e]=t,r[i].width=t.width,r[i].height=t.height,o++,o===s&&n(r)}),i);i++}}(e,(e=>{let t={data:[]};for(let n=0;n<e.length;n++)t.data.push(e[n]);n({type:"cubemapData",data:t})}))}}}(ln||(ln={})),function(e){e.create=function(e,t,n){let r=Lt.create();for(const e of n.entries())r.set(e,0);function o(e){const n=t.get(e);if(n)for(let e of n)r.update(e,()}return n.onAdded((),t.onChanged(((n,o,i)=>{var a;"loading"===(null===(a=e.get(n))||void 0===a?void 0:a.type)&&function(e,n){const o=t.get(e);if(o)for(let e of o)n.includes(e)||r.update(e,(e=>e+1))}(n,o)})),t.onRemoved((),e.onAdded(((e,n)=>{"loading"===n.type&&function(e){const n=t.get(e);if(n)for(let e of n)r.update(e,()}(e)})),e.onChanged(((e,t,n)=>{"loading"===t.type&&"loading"!==n.type&&o(e)})),e.onRemoved((),}(mn||(mn={})),function(e){e.connect=function(e,t,n,r,o,i){const a=Ut.create(t),{textureUsageStore:c,textureScreenStore:s}=un.create(a,n,o),u=cn.createNormalLoader(),l={png:u,svg:u,jpg:u,jpeg:u,gif:u,webp:u,"application/octet-stream":u,"image/png":u,"image/svg":u,"image/jpg":u,"image/jpeg":u,"image/gif":u,"image/webp":u,"text/plain":u,"text/xml":u,hdr:cn.createHdrLoader()},m={hdr:ln.createCubemapLoader()},d=sn.create(c,l,m),f=tn.create(e,d),p=en.create(a,o),v=mn.create(d,s,r);return d.onError(i),{processChanges:a.processChanges,renderShaderPropertiesStore:p,getRenderTexture:function(e){return f.get(e)},isEverythingLoaded:v}}}(dn||(dn={})),function(e){e.create=function(e,t,n,r){return{screenSize:r,screenIntersection:t,elementOffsetSize:e,elementIntersection:n}}}(fn||(fn={})),function(e){e.create=function(e,t,n){return{a:e,b:t,c:n}},e.interpolateNumber=e.interpolateVector2=function(e,t){const n=u.multiplyScalar(e.a,t.u),r=u.multiplyScalar(e.b,t.v),o=u.multiplyScalar(e.c,t.w);return u.add(u.add(n,r),o)},e.interpolateVector3=function(e,t){const n=i.multiplyScalar(e.a,t.u),r=i.multiplyScalar(e.b,t.v),o=i.multiplyScalar(e.c,t.w);return i.add(i.add(n,r),o)}}(pn||(pn={}));const An={unsignedByte:1,float:1,vec2:2,vec3:3,vec4:4,matrix4:16,sampler2D:1,bool:1,unsignedShort:1,"vec3[]":0,cubemap:1};var Rn,zn,Pn,kn,_n,Bn,Fn,In,On,Nn,Dn,Ln,Un,Gn,Vn,Hn,jn,Wn,Xn,$n,qn,Yn,Zn,Qn,Kn,Jn,er,tr,nr,rr,or,ir,ar,cr,sr,ur,lr,mr,dr,fr,pr,vr,gr,xr,yr,hr,br,wr,Tr,Cr,Er,Sr,Mr,Ar,Rr,zr,Pr,kr,_r,Br,Fr,Ir,Or,Nr,Dr,Lr,Ur,Gr,Vr,Hr,jr,Wr,Xr,$r,qr,Yr,Zr,Qr,Kr,Jr,eo,to,no,ro,oo,io,ao;function co(e,t){const n=Lt.create();function r(r){const o=[];for(const t of e){const e=t.get(r);o.push(e)}const i=t.apply(void 0,o);n.set(r,i)}for(const t of e)t.onAdded(r),t.onChanged(r),t.onRemoved(((e,t)=>{n.remove(e)}));return n}function so(e,t){const n=br.create(t(e.get()));return e.onChanged((),n}let uo,lo;function mo(e){let t=0;uo=(n,r)=>{const o=t;let i=e[o];i||(i={callback:n,cleanup:void 0,dependencies:void 0,shouldRun:!0},e[o]=i);const a=void 0===i.dependencies||(c=r,s=i.dependencies,!!ao.isDifferent(c,s));var c,s;i.shouldRun=a,i.dependencies=r,i.callback=n,t++}}function fo(e){var t;for(const n of e)n.shouldRun&&(n.cleanup&&(n.cleanup(),n.cleanup=void 0),n.cleanup=null===(t=n.callback)||void 0===t?void 0:t.call(n,n.dependencies))}function po(e,t){let n=0;lo=r=>{const o=n;n++;let i=e[o];if(!i){const t=r)?r():r;i=[t,()=>{}],e[o]=i}return i[1]=e=>{i[0]!==e&&(i[0]=e,t())},i}}!function(e){function t(e,t,n,r){return{name:t,dataType:n,setInt(t){r.uniform1i(e,t)},getUniformLocation:()=>e}}e.createUniform=t,e.createRegularUniform=function(e,n,r,o){return{...t(e,n,r,o),dataType:r,setColor(t){o.uniform4f(e,t.r,t.g,t.b,t.a)},setBooleansetFloat(t){o.uniform1f(e,t)},setMatrixsetFloatArray(t){o.uniform3fv(e,t)},setVector2setVector3setVector4setVector3Array},e.createSamplerUniform=function(e,n,r,o,i,a){const c=void 0===i?"cubemap":"sampler2D";return{...t(e,r,c,o),textureIndex:n,setUniform:i,dataType:c,setTexture(e){o.activeTexture(o.TEXTURE0+n),o.bindTexture(a.textureTypes[e.target],e.texture),this.setInt(n)}}}}(Rn||(Rn={})),function(e){e.create=function(e,t){function n(n,r,o){return i=>{const a=t(e.id);if(!a)return;const c=a.vertices[i];if(!c||An[c.dataType]!==n)return;const s=r(c.data,e.indices.indexA),u=r(c.data,e.indices.indexB),l=r(c.data,e.indices.indexC),m=pn.create(s,u,l);return o(m,e.barycentric)}}return{distance:e.distance,interpolateVector3:n(3,i.fromArray,pn.interpolateVector3),interpolateVector2:n(1,u.fromArray,pn.interpolateVector2),interpolateNumber:n(1,(,pn.interpolateNumber)}}}(zn||(zn={})),function(e){e.create=function(e,t,n,r,o,i,a,c){e.onChanged(((e,s)=>{const u=n.get();c.pick(s,u,(function(e){const n=function(e,t){return t(e)||void 0}(e.id,a);return!!n&&(n(fn.create(e.offsetSize,s,e.intersection,u),t.get()),!0)}),(function(e){const n=function(e,t,n){const r=n(e);if(r)return r;let o=t(e);for(;Je.isNodeId(o);){const e=n(o);if(e)return e;o=t(o)}}(e.id,r,o);return!!n&&(n(zn.create(e,i),t.get()),!0)}),(()=>{}))}))}}(Pn||(Pn={})),function(e){e.create=function(e,t,n,r,o,i,a,c,s,u){function l(e){const n=function(e,t){const n=t(e);return n?{id:e,mouseUp:n}:void 0}(e.id,c);return!!n&&(n.mouseUp(t.get()),!0)}function m(e){const n=function(e,t){const n=t(e);return n?{id:e,mouseDown:n}:void 0}(e.id,s);return!!n&&(n.mouseDown(t.get()),!0)}function d(e){const n=function(e,t,n){const r=n(e);if(r)return{id:e,mouseUp:r};let o=t(e);for(;Je.isNodeId(o);){const e=n(o);if(e)return{id:o,mouseUp:e};o=t(o)}}(e.id,a,o);return!!n&&(n.mouseUp(t.get()),!0)}function f(e){const n=function(e,t,n){const r=n(e);if(r)return{id:e,mouseDown:r};let o=t(e);for(;Je.isNodeId(o);){const e=n(o);if(e)return{id:o,mouseDown:e};o=t(o)}}(e.id,a,i);return!!n&&(n.mouseDown(t.get()),!0)}function p(e,t){const o=r.get(),i=n.get();i&&u.pick(i,o,e,t,(()=>{}))}e.onChanged(((e,t)=>{switch(t){case"down":p(m,f);break;case"up":p(l,d);break;default:return}}))}}(kn||(kn={})),function(e){function t(e,t,n,r){if(Je.isNodeId(e)){const r=n(e);r&&r(t.get())}else if(et.isElementId(e)){const n=r(e);n&&n(t.get())}}e.create=function(e,n,r,o,i,a,c,s,u,l){let m;function d(o){const i=function(e,t){const n=t(e);return n?{id:e,enter:n}:void 0}(o.id,s);if(!i)return!1;if(i.id===m)return!0;t(m,n,a,u),m=i.id;const c=fn.create(o.offsetSize,e.get(),o.intersection,r.get());return i.enter(c,n.get()),!0}function f(e){const r=function(e,t,n){const r=n(e);if(r)return{id:e,enter:r};let o=t(e);for(;Je.isNodeId(o);){const e=n(o);if(e)return{id:o,enter:e};o=t(o)}}(e.id,o,i);if(!r)return!1;if(r.id===m)return!0;t(m,n,a,u),m=r.id;const s=zn.create(e,c);return r.enter(s,n.get()),!0}function p(){t(m,n,a,u),m=void 0}e.onChanged(((e,o)=>{if(!o)return t(m,n,a,u),void(m=void 0);const i=r.get();l.pick(o,i,d,f,p)}))}}(_n||(_n={})),function(e){function t(t){const r=e.create();return n(r,t),r}function n(e,t){e[0]=t.m11,e[1]=t.m21,e[2]=t.m31,e[3]=t.m41,e[4]=t.m12,e[5]=t.m22,e[6]=t.m32,e[7]=t.m42,e[8]=t.m13,e[9]=t.m23,e[10]=t.m33,e[11]=t.m43,e[12]=t.m14,e[13]=t.m24,e[14]=t.m34,e[15]=t.m44}e.create=e.identity=e.fromMatrix4=t,e.updateWithMatrix4=n,e.getPosition=function(e){return{x:e[3],y:e[7],z:e[11]}},e.getForward=function(e){return{x:e[2],y:e[6],z:e[10]}},e.getUp=function(e){return{x:e[1],y:e[5],z:e[9]}},e.getRight=e.toString=(Bn||(Bn={})),function(e){function t(e){return{x:e.m41,y:e.m42,z:e.m43}}function n(e){return{x:e.m31,y:e.m32,z:e.m33}}function r(e){return{x:e.m21,y:e.m22,z:e.m23}}.toViewMatrix=function(e){const a=t(e),c=n(e),s=r(e),u=i(e);return o.createView(c,s,u,a)},e.getPosition=t,e.getForward=n,e.getUp=r,e.getRight=i,e.createViewTransformFromRenderMatrix=function(e){const t=Bn.getPosition(e),n=Bn.getForward(e),r=Bn.getUp(e),i=Bn.getRight(e);return o.createView(n,r,i,t)},e.transformNormal=function(e,t){return{x:t.x*e.m11+t.y*e.m21+t.z*e.m31,y:t.x*e.m12+t.y*e.m22+t.z*e.m32,z:t.x*e.m13+t.y*e.m23+t.z*e.m33}},e.transpose=(Fn||(Fn={})),function(e){e.create=function(e,t){const n=a.center(t);return{center:o.transformVector3(e,n),forward:Fn.getForward(e),right:Fn.getRight(e),up:Fn.getUp(e),forwardHalfExtend:t.max.z-n.z,rightHalfExtend:t.max.x-n.x,upHalfExtend:t.max.y-n.y}},e.getSeparatingPlaneNormal=function(e,t){const n=i.subtract(t.center,e.center),r=r=>function(e,t,n,r){return Math.abs(i.dot(e,t))>n.rightHalfExtend*Math.abs(i.dot(n.right,t))+n.upHalfExtend*Math.abs(i.dot(n.up,t))+n.forwardHalfExtend*Math.abs(i.dot(n.forward,t))+(r.rightHalfExtend*Math.abs(i.dot(r.right,t))+r.upHalfExtend*Math.abs(i.dot(r.up,t))+r.forwardHalfExtend*Math.abs(i.dot(r.forward,t)))}(n,r,e,t);let o=e.right;return r(o)?o:(o=e.up,r(o)?o:(o=e.forward,r(o)?o:(o=t.right,r(o)?o:(o=t.up,r(o)?o:(o=t.forward,r(o)?o:(o=i.cross(e.right,t.right),r(o)?o:(o=i.cross(e.right,t.up),r(o)?o:(o=i.cross(e.right,t.forward),r(o)?o:(o=i.cross(e.up,t.right),r(o)?o:(o=i.cross(e.up,t.up),r(o)?o:(o=i.cross(e.up,t.forward),r(o)?o:(o=i.cross(e.forward,t.right),r(o)?o:(o=i.cross(e.forward,t.up),r(o)?o:(o=i.cross(e.forward,t.forward),r(o)?o:void 0))))))))))))))},e.distanceToPlane=function(e,t,n){const r=i.subtract(e.center,t),o=i.dot(r,n),a=e.forwardHalfExtend*Math.abs(i.dot(e.forward,n))+e.upHalfExtend*Math.abs(i.dot(e.up,n))+e.rightHalfExtend*Math.abs(i.dot(e.right,n));return[o-a,o+a]},e.intersectsRay=function(e,t){let n=0,r=Number.MAX_VALUE;const o=i.subtract(e.center,t.origin);let a=i.dot(e.right,o),c=i.dot(t.direction,e.right);if(Math.abs(c)>.001){let t=(a-e.rightHalfExtend)/c,o=(a+e.rightHalfExtend)/c;if(t>o){const e=t;t=o,o=e}if(o<r&&(r=o),t>n&&(n=t),r<n)return}else if(-a-e.rightHalfExtend>0||-a+e.rightHalfExtend<0)return;if(a=i.dot(e.up,o),c=i.dot(t.direction,e.up),Math.abs(c)>.001){let t=(a-e.upHalfExtend)/c,o=(a+e.upHalfExtend)/c;if(t>o){const e=t;t=o,o=e}if(o<r&&(r=o),t>n&&(n=t),r<n)return}else if(-a-e.upHalfExtend>0||-a+e.upHalfExtend<0)return;if(a=i.dot(e.forward,o),c=i.dot(t.direction,e.forward),Math.abs(c)>.001){let t=(a-e.forwardHalfExtend)/c,o=(a+e.forwardHalfExtend)/c;if(t>o){const e=t;t=o,o=e}if(o<r&&(r=o),t>n&&(n=t),r<n)return}else if(-a-e.forwardHalfExtend>0||-a+e.forwardHalfExtend<0)return;return n},e.shortestSquaredDistanceIntervalToPoint=function(e,t){const n=i.subtract(t,e.center);let r=0,o=0,a=0,c=0,s=i.dot(n,e.forward);return s<-e.forwardHalfExtend?(a=s+e.forwardHalfExtend,c=Math.abs(a)+2*e.forwardHalfExtend):s>e.forwardHalfExtend&&(a=s-e.forwardHalfExtend,c=Math.abs(a)+2*e.forwardHalfExtend),r+=a*a,o+=c*c,a=0,c=0,s=i.dot(n,e.right),s<-e.rightHalfExtend?(a=s+e.rightHalfExtend,c=Math.abs(a)+2*e.rightHalfExtend):s>e.rightHalfExtend&&(a=s-e.rightHalfExtend,c=Math.abs(a)+2*e.rightHalfExtend),r+=a*a,o+=c*c,a=0,c=0,s=i.dot(n,e.up),s<-e.upHalfExtend?(a=s+e.upHalfExtend,c=Math.abs(a)+2*e.upHalfExtend):s>e.upHalfExtend&&(a=s-e.upHalfExtend,c=Math.abs(a)+2*e.upHalfExtend),r+=a*a,o+=c*c,[r,o]},e.projectToScreen=function(e,t){const n=function(e){const t=e.center,n=i.multiplyScalar(e.right,e.rightHalfExtend),r=i.multiplyScalar(e.up,e.upHalfExtend),o=i.multiplyScalar(e.forward,e.forwardHalfExtend),a=i.multiplyScalar(e.right,-e.rightHalfExtend),c=i.multiplyScalar(e.up,-e.upHalfExtend),s=i.multiplyScalar(e.forward,-e.forwardHalfExtend);return[i.add(t,i.add(n,i.add(r,o))),i.add(t,i.add(n,i.add(r,s))),i.add(t,i.add(n,i.add(c,o))),i.add(t,i.add(n,i.add(c,s))),i.add(t,i.add(a,i.add(r,o))),i.add(t,i.add(a,i.add(r,s))),i.add(t,i.add(a,i.add(c,o))),i.add(t,i.add(a,i.add(c,s)))]}(e).map((e=>function(e,t){const n=u.zero();n.x=t.x*e.m11+t.y*e.m21+t.z*e.m31+e.m41,n.y=t.x*e.m12+t.y*e.m22+t.z*e.m32+e.m42;const r=t.x*e.m14+t.y*e.m24+t.z*e.m34+e.m44;return n.x=n.x/r*.5+.5,n.y=-n.y/r*.5+.5,n}(t,e))).reduce(((e,t)=>(e.minX=Math.min(e.minX,t.x),e.maxX=Math.max(e.maxX,t.x),e.minY=Math.min(e.minY,t.y),e.maxY=Math.max(e.maxY,t.y),e)),{minX:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY});return Wt.create(n.minX,n.minY,n.maxX-n.minX,n.maxY-n.minY)}}(In||(In={})),function(e){e.isVector4=e.create=e.zero=(On||(On={})),function(e){e.create=(Nn||(Nn={})),function(n){n.create=n.fromScreenCoordinates=function(n,r,o){const a=Math.tan(.5*t.toRadians(o.fov)),c=a/e.aspectRatio(r),s=.5*r.width,u=.5*r.height,l=a*(n.x/s-1),m=c*(1-n.y/u),d=i.transformByQuaternion({x:l*o.near,y:m*o.near,z:o.near},o.orientation),f=i.transformByQuaternion({x:l*o.far,y:m*o.far,z:o.far},o.orientation),p=i.normalize(i.subtract(f,d));return{origin:i.add(d,o.position),direction:p}},n.distanceToPlane=function(e,n){const r=i.dot(n.normal,e.origin),o=i.dot(n.normal,e.direction);if(Math.abs(o)<t.EPSILON)return 1/0;const a=(n.distance-r)/o;return a<0?1/0:a},n.rayCast=function(e,t,r,o){const a={normal:i.transformByQuaternion({x:0,y:0,z:1},r.orientation),distance:null!=o?o:0},c=n.fromScreenCoordinates(e,t,r),s=n.distanceToPlane(c,a);return Number.isFinite(s)?i.add(c.origin,i.multiplyScalar(c.direction,s)):i.zero()},n.distanceToTriangle=function(e,n,r,o,a=!1){const c=i.subtract(r,n),s=i.subtract(o,n),u=i.cross(e.direction,s),l=i.dot(c,u);if(a?Math.abs(l)<t.EPSILON:l<t.EPSILON)return 1/0;const m=1/l,d=i.subtract(e.origin,n),f=i.dot(d,u)*m;if(f<0||f>1)return 1/0;const p=i.cross(d,c),v=i.dot(e.direction,p)*m;return v<0||f+v>1?1/0:i.dot(s,p)*m},n.toTriangleIntersection=function(e,n,r,o,a=!1){const c=i.subtract(r,n),s=i.subtract(o,n),u=i.cross(e.direction,s),l=i.dot(c,u);if(a?Math.abs(l)<t.EPSILON:l<t.EPSILON)return;const m=1/l,d=i.subtract(e.origin,n),f=i.dot(d,u)*m;if(f<0||f>1)return;const p=i.cross(d,c),v=i.dot(e.direction,p)*m;return v<0||f+v>1?void 0:Nn.create(1-(f+v),f,v)},n.toGeometryIntersection=function(e,t,r,o,a){let c=1/0,s={a:NaN,b:NaN,c:NaN};const l=i.zero(),m=i.zero(),d=i.zero();for(let o=0;o<t.length;o+=3){const a=3*t[o],u=3*t[o+1],f=3*t[o+2];i.setFromArray(l,r,a),i.setFromArray(m,r,u),i.setFromArray(d,r,f);const p=n.distanceToTriangle(e,l,m,d);isFinite(p)&&p<c&&(c=p,s.a=t[o],s.b=t[o+1],s.c=t[o+2])}if(isFinite(c)){const t=i.fromArray(r,3*s.a),c=i.fromArray(r,3*s.b),l=i.fromArray(r,3*s.c),m=n.toTriangleIntersection(e,t,c,l);if(m){const e=pn.create(t,c,l),n=pn.interpolateVector3(e,m),r=pn.create(i.fromArray(o,3*s.a),i.fromArray(o,3*s.b),i.fromArray(o,3*s.c)),d=pn.interpolateVector3(r,m),f=pn.create(u.fromArray(a,2*s.a),u.fromArray(a,2*s.b),u.fromArray(a,2*s.c));return{position:n,normal:d,uv:pn.interpolateVector2(f,m)}}}},n.distanceToGeometry=function(e,t,r){let o=1/0;const a=i.zero(),c=i.zero(),s=i.zero();for(let u=0;u<t.length;u+=3){const l=3*t[u],m=3*t[u+1],d=3*t[u+2];i.setFromArray(a,r,l),i.setFromArray(c,r,m),i.setFromArray(s,r,d);const f=n.distanceToTriangle(e,a,c,s);o=isFinite(f)?Math.min(o,f):o}return isFinite(o)?o:1/0},n.distanceToBoundingBox=function(e,t){const n=1/e.direction.x,r=1/e.direction.y,o=1/e.direction.z,i=(t.min.x-e.origin.x)*n,a=(t.max.x-e.origin.x)*n,c=(t.min.y-e.origin.y)*r,s=(t.max.y-e.origin.y)*r,u=(t.min.z-e.origin.z)*o,l=(t.max.z-e.origin.z)*o,m=Math.max(Math.max(Math.min(i,a),Math.min(c,s)),Math.min(u,l)),d=Math.min(Math.min(Math.max(i,a),Math.max(c,s)),Math.max(u,l));return d<0||m>d?1/0:m}}(Dn||(Dn={})),function(e){function t(e,t){const n=e.x*t.m11+e.y*t.m21+e.z*t.m31+e.w*t.m41,r=e.x*t.m12+e.y*t.m22+e.z*t.m32+e.w*t.m42,o=e.x*t.m13+e.y*t.m23+e.z*t.m33+e.w*t.m43,a=e.x*t.m14+e.y*t.m24+e.z*t.m34+e.w*t.m44;return i.create(n/a,r/a,o/a)}e.fromScreenCoordinates=function(e,n,r,a,c,s){const u=2*(r.x/a.width-.5),l=-2*(r.y/a.height-.5),m=On.create(u,l,0,1),d=On.create(u,l,1,1),f=Ze.createProjectionTransform(e,a,c,s),p=Fn.createViewTransformFromRenderMatrix(n),v=o.multiply(p,f),g=o.invert(v);if(!g)return;const x=t(m,g),y=t(d,g),h=i.normalize(i.subtract(y,x));return Dn.create(x,h)},e.toLocalRay=function(e,t){const n=o.invert(t);if(!n)return;const r=i.transformByMatrix(e.origin,n),a=Fn.transformNormal(n,e.direction);return Dn.create(r,a)},e.intersectRayGeometry=function(e,t,n){let r=1/0,o=-1,a=-1,c=-1;const s=i.zero(),u=i.zero(),l=i.zero();for(let m=0;m<t.length;m+=3){const d=3*t[m],f=3*t[m+1],p=3*t[m+2];i.setFromArray(s,n,d),i.setFromArray(u,n,f),i.setFromArray(l,n,p);const v=Dn.distanceToTriangle(e,s,u,l);isFinite(v)&&v<r&&(r=v,o=d,a=f,c=p)}if(!isFinite(r))return;const m=i.fromArray(n,o),d=i.fromArray(n,a),f=i.fromArray(n,c),p=Dn.toTriangleIntersection(e,m,d,f);return p?{barycentric:p,indices:{indexA:o,indexB:a,indexC:c},distance:r}:void 0}}(Ln||(Ln={})),function(e){e.findCameraNode=function(e,t,n){const r=n.find((n=>{const r=t.get(n);return!!r&&(null==r?void 0:r.id)===e}));return r?{nodeId:r,camera:t.get(r)}:{nodeId:void 0,camera:void 0}},e.getNodesForScene=function(e,t,n,r){const o=n.getNodesForScene(e);return void 0===o?[]:o.filter((e=>r(t.nodeStores.orientedBoundingBox.get(e))))},e.getOrderedElements=function(e,t,n){const r=n.getScreenElements(t);return r?r.filter((t=>void 0!==e.order.get(t))).sort(():[]},e.getNodesForSceneByType=function(e,t,n,r){const o=[],i=[],a=t.getNodesForScene(e);if(!a)return{opaqueNodes:o,transparentNodes:i};for(const e of a){if(!r(e))continue;const t=n.layerStores.childStore.get(e)[0];if(void 0===t)continue;const a=n.materialStores.childStore.get(t)[0];void 0!==a&&(void 0===n.materialStores.blending.get(a)?o.push(e):i.push(e))}return{opaqueNodes:o,transparentNodes:i}}}(Un||(Un={})),function(e){function t(e,t,n,r,o,i,a,c,s){const u=c.getScreenNodes(t);if(!u)return!1;const{nodeId:l,camera:m}=Un.findCameraNode(e,n.nodeStores.camera,u);if(!l||!m)return!1;const d=n.nodeStores.scene.get(l),f=n.nodeStores.worldTransform.get(l);if(!d||!f)return!1;const p=Bn.fromMatrix4(f),v=Ln.fromScreenCoordinates(m.projection,p,r,o,i,a);return!!v&&function(e,t,n,r){const o=[];for(const r of e){const e=t.nodeStores.orientedBoundingBox.get(r),i=t.nodeStores.geometry.get(r),a=t.nodeStores.worldTransform.get(r);if(!e||!i||!a)continue;if(void 0===In.intersectsRay(e,n))continue;const c=i.indices,s=i.vertices.position;if(!s||3!==An[s.dataType])continue;const u=Ln.toLocalRay(n,a);if(!u)continue;const l=Ln.intersectRayGeometry(u,c,s.data);void 0!==l&&o.push({...l,id:r})}o.sort(((e,t)=>e.distance-t.distance));for(const e of o)if(r(e))return!0;return!1}(Un.getNodesForScene(d,n,c,(),n,v,s)}e.create=function(e,n,r){return{pick(o,i,a,c,s){var u;const l=n.get();if(!l)return;const m=Un.getOrderedElements(e.elementStores,l,r);if(m){for(let n=m.length-1;n>=0;n--){const s=m[n],d=e.elementStores.elementOffsetSize.get(s),f=e.elementStores.viewport.get(s);if(!d)continue;const p=Wt.intersectPoint(d,o),v=null!==(u=null==f?void 0:f.clamp)&&void 0!==u&&u;if(f&&(v&&p||!v)&&t(f.cameraId,l,e,o,i,d,v,r,c))return;if(p&&a({id:s,intersection:p,offsetSize:d}))return}s()}}}}}(Gn||(Gn={})),function(e){e.create=function(e){return{remove(t){e.remove(t)},set}}(Vn||(Vn={})),function(e){e.create=function(e,t){const n=Lt.create(),r={offset:Lt.create(),size:Lt.create(),viewport:Lt.create(),order:Lt.create(),click:Lt.create(),enter:Lt.create(),leave:Lt.create(),mouseDown:Lt.create(),mouseUp:Lt.create(),parent:n,childStore:Yt.create(n)},o={parent:n,offset:Vn.create(r.offset),size:Vn.create(r.size),viewport:Vn.create(r.viewport),order:Vn.create(r.order),click:Vn.create(r.click),enter:Vn.create(r.enter),mouseDown:Vn.create(r.mouseDown),mouseUp:Vn.create(r.mouseUp),leave:Vn.create(r.leave)};return t.onRemoved((t=>{const n=r.childStore.get(t);for(const t of null!=n?n:[])e.remove(t)})),e.onRemoved((t=>{!function(e){o.offset.remove(e),o.size.remove(e),o.viewport.remove(e),o.order.remove(e),o.click.remove(e),o.enter.remove(e),o.leave.remove(e),o.mouseDown.remove(e),o.mouseUp.remove(e)}(t);const n=r.childStore.get(t);for(const t of null!=n?n:[])e.remove(t)})),{stores:r,systems:o,create:e.create,remove:e.remove}}}(Hn||(Hn={})),function(e){e.create=function(e,t,n){const r=Lt.create(),o={order:Lt.create(),parent:r,childStore:Yt.create(r),culling:Lt.create(),clipping:Lt.create(),geometry:Lt.create()},i={order:Vn.create(o.order),parent:Vn.create(o.parent),culling:Vn.create(o.culling),clipping:Vn.create(o.clipping),geometry:Vn.create(o.geometry)};return t.onRemoved((t=>{const n=o.childStore.get(t);for(const t of null!=n?n:[])e.remove(t)})),n.onRemoved((t=>{const n=o.childStore.get(t);for(const t of null!=n?n:[])e.remove(t)})),e.onRemoved((e=>{i.order.remove(e),i.parent.remove(e),i.culling.remove(e),i.clipping.remove(e),i.geometry.remove(e)})),{stores:o,systems:i,create:e.create,remove:e.remove}}}(jn||(jn={})),function(e){e.create=function(e,t){const n=Lt.create(),r={parent:n,shader:Lt.create(),properties:Lt.create(),blending:Lt.create(),stencil:Lt.create(),colorMask:Lt.create(),childStore:Yt.create(n)},o={parent:Vn.create(r.parent),shader:Vn.create(r.shader),properties:Vn.create(r.properties),blending:Vn.create(r.blending),stencil:Vn.create(r.stencil),colorMask:Vn.create(r.colorMask)};return t.onRemoved((t=>{const n=r.childStore.get(t);for(const t of null!=n?n:[])e.remove(t)})),e.onRemoved((e=>{o.parent.remove(e),o.shader.remove(e),o.properties.remove(e),o.blending.remove(e),o.stencil.remove(e),o.colorMask.remove(e)})),{stores:r,systems:o,create:e.create,remove:e.remove}}}(Wn||(Wn={})),function(e){e.create=function(e,t){return co([e,t],((e,t)=>{const n=t?o.fromQuaternion(t):o.identity();return e?o.translate(n,e):n}))}}(Xn||(Xn={})),function(e){e.create=function(e,t){const n=function(e,t){const n=Lt.create();return e.onAdded((),e.onChanged(((e,r,o)=>{const i=t(o);n.set(e,i)})),e.onRemoved(((e,t)=>{n.remove(e)})),n}(e,(e=>{const t=function(e){const t=e.vertices.position;if(t&&"vec3"===t.dataType)return t}(e);if(t)return a.fromPositions(t.data)}));return co([t,n],((e,t)=>{if(t)return In.create(e,t)}))}}($n||($n={})),function(e){function t(e,t,n){if(tt.isSceneId(n))return n;{const t=e.get(n);if(t)return t;throw"unable to find parent scene"}}e.create=function(e){const n=Lt.create();return e.onAdded(((e,r)=>{const o=t(n,0,r);n.set(e,o)})),e.onChanged(((e,r,o)=>{const i=t(n,0,o);n.set(e,i)})),e.onRemoved(((e,t)=>{n.remove(e)})),n}}(qn||(qn={})),function(e){function t(e,t,n,r){const i=e?o.multiply(e,t):t;n.set(r,i)}e.create=function(e,n){const r=Lt.create(),i=Yt.create(e),a=co([e,n],((e,t)=>[e,null!=t?t:o.identity()]));function c(e,[n,i]){var a;tt.isSceneId(n)?r.set(e,i):t(i,null!==(a=r.get(n))&&void 0!==a?a:o.identity(),r,e)}return r.onChanged(((e,o,a)=>{const c=i.get(e);if(c)for(const e of c)t(n.get(e),a,r,e)})),a.onAdded((),a.onChanged(((e,t,n)=>c(e,n))),a.onRemoved(((e,t)=>{r.remove(e)})),r}}(Yn||(Yn={})),function(e){e.create=function(e,t){const n=Lt.create(),r=Lt.create(),o=Lt.create(),i=Xn.create(r,o),a=Yn.create(n,i),c=Lt.create(),s=$n.create(c,a),u={position:r,orientation:o,parent:n,geometry:c,camera:Lt.create(),click:Lt.create(),enter:Lt.create(),leave:Lt.create(),mouseDown:Lt.create(),mouseUp:Lt.create(),draw:Lt.create(),transparencyOrder:Lt.create(),name:Lt.create(),childStore:Yt.create(n),scene:qn.create(n),localTransform:i,worldTransform:a,orientedBoundingBox:s},l={position:Vn.create(u.position),orientation:Vn.create(u.orientation),parent:Vn.create(u.parent),geometry:Vn.create(u.geometry),camera:Vn.create(u.camera),click:Vn.create(u.click),enter:Vn.create(u.enter),mouseDown:Vn.create(u.mouseDown),mouseUp:Vn.create(u.mouseUp),leave:Vn.create(u.leave),draw:Vn.create(u.draw),transparencyOrder:Vn.create(u.transparencyOrder),name:Vn.create(u.name)};return t.onRemoved((t=>{const n=u.childStore.get(t);for(const t of null!=n?n:[])e.remove(t)})),e.onRemoved((t=>{l.position.remove(t),l.orientation.remove(t),l.parent.remove(t),l.geometry.remove(t),l.camera.remove(t),l.click.remove(t),l.enter.remove(t),l.leave.remove(t),l.draw.remove(t),l.name.remove(t),l.mouseDown.remove(t),l.mouseUp.remove(t),l.transparencyOrder.remove(t);const n=u.childStore.get(t);for(const t of null!=n?n:[])e.remove(t)})),{stores:u,systems:l,create:e.create,remove:e.remove}}}(Zn||(Zn={})),function(e){e.create=function(e,t){const n=Lt.create(),r={parent:n,properties:Lt.create(),childStore:Yt.create(n)},o={parent:Vn.create(r.parent),properties:Vn.create(r.properties)};return t.onRemoved((t=>{const n=r.childStore.get(t);for(const t of null!=n?n:[])e.remove(t)})),e.onRemoved((),{stores:r,systems:o,create:e.create,remove:e.remove}}}(Qn||(Qn={})),function(e){e.create=function(e){const t={draw:Lt.create(),size:Lt.create(),color:Lt.create()},n={draw:Vn.create(t.draw),size:Vn.create(t.size),color:Vn.create(t.color)};return e.onRemoved((),{stores:t,systems:n,create:e.create,remove:e.remove}}}(Kn||(Kn={})),function(e){e.create=function(e){const t={shader:Lt.create(),children:Yt.create(e.shader)},n={shader:Vn.create(t.shader)};return{stores:t,systems:n,create:function(e){const n=t.shader.get(e.id);return n?n.id:(t.shader.set(e.id,e),e.id)},remove:t.shader.remove}}}(Jn||(Jn={})),function(e){function t(e,t){var n=e.createFrameBuffer(t);if(!n)throw"Couldn't create WebGL framebuffer";return n}e.create=function(e,n){return Gt.create(e,n,((e,n,r)=>t(e,r)),((e,n,r,o,i)=>(i.delete(),t(e,o))),((e,t,n,r)=>{r.delete()}))}}(er||(er={})),function(e){e.create=function(e,t){const n=Ut.create(t);return{...er.create(e,n),processChanges:n.processChanges}}}(tr||(tr={})),function(e){e.create=function(e){return{toBlob:(t,n)=>e.toBlob(t,n),toImageData:()=>e.toImageData()}}}(nr||(nr={})),function(e){e.create=function(e){return{toBlob:toImageData:}}(rr||(rr={})),function(e){e.sortTransparentNodes=function(e,t,n,r){return(o,a)=>{const c=e.get(o),s=e.get(a),u=In.getSeparatingPlaneNormal(c,s);if(u){const e=i.subtract(n,c.center),t=i.subtract(n,s.center),r=Math.abs(i.dot(e,u));return Math.abs(i.dot(t,u))-r}{const e=t.get(o),i=t.get(a);if(e&&i&&e!==i)return i-e;{const e=In.distanceToPlane(c,n,r);return In.distanceToPlane(s,n,r)[0]-e[0]}}}}}(or||(or={})),function(e){e.setTextureLocation=function(e,t,n,r){let o;(void 0===t||Ke.isType("texture",t))&&(o=r(t)),o&&o.texture&&(e.setTexture(o.texture),n.minFilter=n.mipmapping&&o.mipmapped?"linearMipmapLinear":"linear",n.magFilter="linear",o.texture.setTextureParametersFromSampler(n)),e.setUniform&&e.setUniform.setBoolean(void 0!==o)},e.createProgram=function(e,t,n){var r=e.createProgram(t,n);if(!r)throw"Couldn't create WebGL program";r.use();let{samplerUniforms:o,regularUniforms:i}=r.getActiveUniforms();return{program:r,samplerUniforms:o,regularUniforms:i}}}(ir||(ir={})),function(e){function t(e,t,n){e.enableDepthMask(!1),e.setDepthRead(!1),e.setCulling("back"),e.viewport(0,0,t.width*n,t.height*n)}function n(e,t,n,r){e.enableDepthMask(!0),e.setDepthRead(!0),e.viewport(t.x*r,t.y*r,n.width*r,n.height*r),e.clear("depth")}function r(e,t,n,r,o,i,a){const s=a.layerStores.childStore.get(t);if(!a.elementStores.elementOffsetSize.get(t)||!s||0===s.length)return;const u=s[0];if(void 0!==a.materialStores.childStore.get(u))for(let u=0;u<s.length;u++){const m=s[u],f=a.materialStores.childStore.get(m);if(void 0===f)continue;const p=f[0],v=a.materialStores.properties.get(p),g=a.materialStores.shader.get(p);if(!g)continue;const x=o.get(g),y=a.materialStores.blending.get(p);if(!x||!v)continue;e.setBlending(y),x.program.use();for(const e of x.regularUniforms)c(e,t,a,r)||l(e,{},v,x.shaderDefaults);for(const e of x.samplerUniforms){const t=x.shaderDefaults[e.name];if(!t||!d.isTexture(t))throw`No value found for ${e.dataType}: ${e.name}`;const n=v[e.name];ir.setTextureLocation(e,n,t.sampler,i)}const h=a.materialStores.stencil.get(p),b=a.materialStores.colorMask.get(p);e.enableStencilTest(void 0!==h),b&&e.colorMask(b.r,b.g,b.b,b.a),void 0!==h&&e.setStencil(h),e.drawElements(n),b&&e.colorMask(!0,!0,!0,!0)}}function i(e,t,n,r,o,i){const c=e=>i.nodeStores.orientedBoundingBox.get(e);for(const s of t.opaqueNodes){const u=c(s);if(a(e,s,t,n,o,i),r&&u){const e=In.projectToScreen(u,t.viewProjectionTransformMatrix);r[s]=e}}for(const s of t.transparentNodes){a(e,s,t,n,o,i);const u=c(s);if(r&&u){const e=In.projectToScreen(u,t.viewProjectionTransformMatrix);r[s]=e}}}function a(e,t,n,r,o,i){var a,c,u;const m=i.layerStores.childStore.get(t);if(!m||0==m.length)return;const d=m[0];if(void 0!==i.materialStores.childStore.get(d))for(let d=0;d<m.length;d++){const f=m[d],p=i.materialStores.childStore.get(f);if(void 0===p)continue;const v=p[0],g=i.materialStores.properties.get(v),x=i.materialStores.shader.get(v);if(!x)continue;const y=r.get(x),h=null!==(a=i.layerStores.culling.get(f))&&void 0!==a?a:"back",b=i.layerStores.clipping.get(f),w=i.materialStores.blending.get(v),T=null!==(c=i.layerStores.geometry.get(f))&&void 0!==c?c:i.nodeStores.renderGeometry.get(t);if(!g||!T||!y)continue;const C=d>0,E=void 0===w,S=E&&0==d;y.program.use();for(const e of y.regularUniforms)!s(e,t,n,b,!E,C,h,i)&&g&&l(e,n.sceneProperties,g,y.shaderDefaults);for(const e of y.samplerUniforms)if(g){const t=y.shaderDefaults[e.name];if(!t||"cubemap"!==t.type&&"texture"!==t.type)throw`No value found for ${e.dataType}: ${e.name}`;const r=null!==(u=g[e.name])&&void 0!==u?u:n.sceneProperties[e.name];ir.setTextureLocation(e,r,t.sampler,o)}const M=i.materialStores.stencil.get(v);e.enableStencilTest(void 0!==M),void 0!==M&&e.setStencil(M),e.setBlending(w),e.setCulling(h),e.enableDepthMask(S),e.drawElements(T)}}function c(e,t,n,r){const{name:o,dataType:i}=e;if("vec2"===i){if("screenSize"==o)return e.setVector2(u.create(r.width,r.height)),!0}else if("vec4"===i&&"elementOffsetSize"==o){const r=n.elementStores.elementOffsetSize.get(t);return r&&e.setVector4(On.create(r.x,r.y,r.width,r.height)),!0}return!1}function s(e,t,n,r,o,i,a,c){const{name:s,dataType:u}=e;if("float"===u){if("depthOffset"==s){const t=i?n.depthOffset:0;return e.setFloat(t),!0}if("exposure"==s){const t=n.sceneProperties.exposure;return void 0!==t&&!Number.isNaN(t)&&(e.setFloat(t),!0)}}else if("vec2"===u);else if("vec3"===u){if("cameraPosition"==s){const t=n.cameraPosition;return e.setVector3(t),!0}}else if("vec4"===u);else if("matrix4"===u){if("nodeWorld"==s){const n=c.nodeStores.worldTransform.get(t);return void 0!==n&&(e.setMatrix(Bn.fromMatrix4(n)),!0)}if("cameraView"==s)return e.setMatrix(n.viewTransform),!0;if("cameraProjection"==s)return e.setMatrix(n.projectionTransform),!0;if("cameraViewProjection"==s)return e.setMatrix(n.viewProjectionTransform),!0;if("clippingProjection"==s)return r&&e.setMatrix(r),!0}else if("bool"===u){if("blendingEnabled"==s)return e.setBoolean(o),!0;if("clippingEnabled"==s)return e.setBoolean(void 0!==r),!0;if("invertNormal"==s)return e.setBoolean("front"===a),!0}return!1}function l(e,t,n,r){var o,i;const{name:a}=e,c=e,s=r[a];if(d.isTexture(s))return;const u=null!==(i=null!==(o=n[a])&&void 0!==o?o:t[a])&&void 0!==i?i:s.default;switch(e.dataType){case"float":if("number"==typeof u)return void c.setFloat(u);break;case"vec2":if("object"==typeof u&&"x"in u&&"y"in u)return void c.setVector2(u);break;case"vec3":if("object"==typeof u&&"z"in u){const e=u;return void c.setVector3(e)}break;case"vec4":if("object"==typeof u&&"r"in u){const e=v.rgba(u.r/255,u.g/255,u.b/255,u.a);return void c.setColor(e)}break;case"matrix4":if("object"==typeof u&&"length"in u)return void c.setMatrix(u);break;case"bool":if("boolean"==typeof u)return void c.setBoolean(u);break;case"vec3[]":if("object"==typeof u&&"length"in u)return c.setVector3Array(u),!0}throw`No value found for ${e.dataType}: ${e.name}`}function m(e,t,n,r,i,a,c){var s;const u=c.getScreenNodes(t);if(!u)return;const{nodeId:l,camera:m}=Un.findCameraNode(e,a.nodeStores.camera,u);if(!l||!m)return;const d=a.nodeStores.scene.get(l),f=a.nodeStores.worldTransform.get(l);if(!d||!f)return;const p=Bn.fromMatrix4(f),v=Ze.createProjectionTransform(m.projection,n,r,i),g=Fn.createViewTransformFromRenderMatrix(p),x=o.multiply(g,v),y=Bn.getPosition(p),h=Bn.getForward(p),b=-.0035*m.projection.near,{opaqueNodes:w,transparentNodes:T}=Un.getNodesForSceneByType(d,c,a,(e=>void 0!==a.nodeStores.orientedBoundingBox.get(e)&&void 0!==a.nodeStores.renderGeometry.get(e)));T.sort(or.sortTransparentNodes(a.nodeStores.orientedBoundingBox,a.nodeStores.transparencyOrder,y,h));const C=null!==(s=a.sceneStores.properties.get(d))&&void 0!==s?s:{};if(!C)throw"No properties found for the scene";return{sceneId:d,cameraPosition:y,viewTransform:Bn.fromMatrix4(g),projectionTransform:Bn.fromMatrix4(v),viewProjectionTransform:Bn.fromMatrix4(x),opaqueNodes:w,transparentNodes:T,sceneProperties:C,viewProjectionTransformMatrix:x,depthOffset:b}}function f(e,t){const n=Object.keys(e.nodeStores.draw.record());if(0!==n.length)return{projectedBoundingBoxes:{},nodes:n}}function p(e,t,n,r){for(const o of e){const e=g(o,t,n);e&&r.push([o,e])}}function g(e,t,n){let r=t[e];const o=n(e);if(!o)return r;for(const e of o){const o=g(e,t,n);r&&o?r=Wt.union(r,o):o&&(r=o)}return r}e.create=function(e,o,a,c,s,l){return{draw(d,g){var x,y;if(!e.available)return!1;const h=l.elementStores.renderGeometry.get("elementGeometry");if(!h)return!1;let b,{devicePixelRatio:w,...T}=e.size.get();b=a.get(d),b&&(T=b.size(),w=1,b.bind());const C=null!==(x=l.screenStores.color.get(d))&&void 0!==x?x:v.rgba(0,0,0,0);e.setClearColor(C.r,C.g,C.b,C.a),e.clear("color"),e.clear("stencil"),t(e,T,w);const E=Un.getOrderedElements(l.elementStores,d,c);if(void 0===E)return!1;const S=[];for(const a of E){r(e,a,h,T,o,s,l);const v=l.elementStores.viewport.get(a);let g=l.elementStores.elementOffsetSize.get(a);if(v&&g){const r=null!==(y=v.clamp)&&void 0!==y&&y,a=m(v.cameraId,d,T,g,r,l,c);if(!a)continue;const x=f(l);if(r){const t=u.create(g.x,g.y);t.y=T.height-t.y-g.height,n(e,t,g,w)}else n(e,{x:0,y:0},T,w);i(e,a,o,null==x?void 0:x.projectedBoundingBoxes,s,l),t(e,T,w),x&&p(x.nodes,x.projectedBoundingBoxes,(,S)}}for(const[e,t]of S){const n=l.nodeStores.draw.get(e);n&&n({screenSize:T,elementOffsetSize:Wt.create(t.x*T.width,t.y*T.height,t.width*T.width,t.height*T.height)})}if(g){const t=null!=b?b:e;g(nr.create(t))}return b&&b.unbind(),!0}}}}(ar||(ar={})),function(e){e.create=function(e,t){const n=Lt.create();return e.onAdded(((e,r)=>{const o=t(r);if(!o)throw"Cant find parent screen";n.set(e,o)})),e.onChanged(((e,r,o)=>{const i=t(o);if(!i)throw"Cant find parent screen";n.set(e,i)})),e.onRemoved(((e,t)=>{n.remove(e)})),n},e.combine=function(e){const t=Lt.create();for(const n of e)n.onAdded(((e,n)=>{t.set(e,n)})),n.onChanged((),n.onRemoved(((e,n)=>{t.remove(e)}));return t}}(cr||(cr={})),function(e){e.create=function(e,t){return function n(r){if(tt.isSceneId(r))return e.get(r);const o=t.get(r);return o?n(o):void 0}}}(sr||(sr={})),function(e){e.create=function(e){return function t(n){if(ot.isScreenId(n))return n;const r=e.get(n);return r?t(r):void 0}}}(ur||(ur={})),function(e){e.create=function(e,t){return function(n){return Je.isNodeId(n)?e(n):et.isElementId(n)?t(n):void 0}}}(lr||(lr={})),function(e){e.create=function(e,t){return function(n){const r=e.get(n);if(r)return t(r)}}}(mr||(mr={})),function(e){e.create=function(e,t,n,r,o,i){const a=sr.create(e,t),c=ur.create(n),s=lr.create(a,c),u=mr.create(r,s),l=cr.create(t,a),m=cr.create(n,c),d=cr.create(r,s),f=cr.create(o,u),p=[e,l,m,d,f],v=cr.combine(p),g=Yt.create(m),x=Yt.create(l),y=(Yt.create(d),Yt.create(f),Yt.create(i));return{getScreenId:getScreenNodes:x.get,getScreenElements:g.get,getNodesForScene:y.get}}}(dr||(dr={})),function(e){e.create=function(){{const e=Lt.create(),t={};return{get:e.get,onChanged:e.onChanged,onAdded:e.onAdded,onRemoved:e.onRemoved,entries:e.entries,increment(n,r){const o=t[n];void 0===o?(t[n]=1,e.set(n,r)):r!==e.get(n)?(e.set(n,r),t[n]=o+1):t[n]=o+1},decrement(n){const r=t[n];1===r?(e.remove(n),delete t[n]):t[n]=r-1}}}}}(fr||(fr={})),function(e){function t(e,t){const{program:n,samplerUniforms:r,regularUniforms:o}=ir.createProgram(e,t.vertex,t.fragment);return{program:n,samplerUniforms:r,regularUniforms:o,shaderDefaults:t.uniforms}}e.create=function(e,n){return Gt.create(e,n,(,((e,n,r,o,i)=>(i.program.delete(),t(e,o))),((e,t,n,r)=>{r.program.delete()}))}}(pr||(pr={})),function(e){e.create=function(e,t){const n=fr.create(),r=Ut.create(n),o=pr.create(e,r);return t.onAdded((),t.onChanged(((e,t,r)=>{n.increment(e,r),n.decrement(e)})),t.onRemoved((),{...o,processChanges:r.processChanges}}}(vr||(vr={})),function(e){e.create=function(e){const t=[],n=[],r=[];return{create(){const r=e();return t.push(r),function(e){for(const t of n)t(e)}(r),r},remove(e){const n=t.indexOf(e);!t.splice(n,1)[0])},onAdded(e){n.push(e);for(const n of t)e(n)},onRemoved(e){r.push(e)},entries:()=>t}}}(gr||(gr={})),function(e){e.toArray=function(e){const t=[];for(const n in e){const r=e[n];for(const e in r){const n=r[e];t.push(n)}}return t},e.create=function(e){return{materialStores:{...e.materialModuleStores,properties:e.materialProperties},layerStores:{...e.layerModuleStores,geometry:e.layerRenderGeometry},sceneStores:{...e.sceneModuleStores,properties:e.sceneProperties},nodeStores:{...e.nodeModuleStores,renderGeometry:e.nodeRenderGeometry},elementStores:{...e.elementModuleStores,renderGeometry:e.elementRenderGeometry,elementOffsetSize:e.elementOffsetSize},screenStores:{...e.screenModuleStores}}}}(xr||(xr={})),function(e){e.create=function(){const e=new WeakMap,t=Dt.create();function n(n){const r=e.get(n);if(void 0!==r)return r;const o=t.next();return e.set(n,o),o}return{getTextureId(e){switch(e.type){case"image":return`texture-image-${n(e.image)}`;case"url":return`texture-url-${e.url}`;case"pixelData":return`texture-pixelData-${n(e.data)}`;case"canvas":return`texture-canvas-${n(e.canvas)}`;case"cubemap":return`texture-cubemap-${e.data[0].back}`}}}}}(yr||(yr={})),function(e){e.create=function(e,t,n,r,o){const i=Lt.create();or(const t of e)t.onAdded(((e,t)=>{const r=n(e);r&&i.set(r,!0)})),t.onRemoved(((e,t)=>{const r=n(e);r&&i.set(r,!0)})),t.onChanged(((e,t)=>{const r=n(e);r&&i.set(r,!0)}));return e=>{for(const e of i.entries()){const t=e[0];if(!r(t))return;i.get(t)&&(a(t)&&i.set(t,!1))}}}}(hr||(hr={})),function(e){e.create=function(e){let t=e;const n=[];return{get:()=>t,set(e){if(e===t)return;const r=t;t=e;for(const e of n)e(r,t)},onChanged(e){n.push(e)},onNewValue(e){n.push((),e(t)}}}}(br||(br={})),function(e){e.create=function(e,t){const n=br.create(void 0);return e.onAdded((e=>{n.set(t())})),e.onRemoved((),n}}(wr||(wr={})),function(e){e.create=function(e){const t=gr.create(Dt.createFromType("screen").next),n=gr.create(Dt.createFromType("scene").next),r=gr.create(Dt.createFromType("element").next),o=gr.create(Dt.createFromType("node").next),i=gr.create(Dt.createFromType("layer").next),a=gr.create(Dt.createFromType("material").next),c=Kn.create(t),s=Qn.create(n,t),u=Hn.create(r,t),l=Zn.create(o,n),m=jn.create(i,o,r),d=Wn.create(a,i),f=Jn.create(d.stores),p=vr.create(e,f.stores.shader),v=tr.create(e,c.stores.size),g=dr.create(s.stores.parent,l.stores.parent,u.stores.parent,m.stores.parent,d.stores.parent,l.stores.scene),x=jt.connect(e),y=Qt.connect(u.stores.offset,u.stores.size,e.size,u.stores.parent,c.stores.size),h=b=yr.create(),w=dn.connect(e,d.stores.properties,g.getScreenId,t,b.getTextureId,h),T=dn.connect(e,s.stores.properties,g.getScreenId,t,b.getTextureId,h),C=Kt.connect(e,l.stores.geometry),E=Kt.connect(e,m.stores.geometry),S=xr.create({materialModuleStores:d.stores,materialProperties:w.renderShaderPropertiesStore,layerModuleStores:m.stores,layerRenderGeometry:E.renderGeometry,sceneModuleStores:s.stores,sceneProperties:T.renderShaderPropertiesStore,nodeModuleStores:l.stores,nodeRenderGeometry:C.renderGeometry,elementModuleStores:u.stores,elementRenderGeometry:x.renderGeometry,elementOffsetSize:y,screenModuleStores:c.stores}),M=ar.create(e,p,v,g,(function(e){const t=w.getRenderTexture(e);return void 0!==t?t:T.getRenderTexture(e)}),S),A=wr.create(t,(function(){const e=t.entries(),n=c.stores.size;if(1===e.length)return e[0];for(const t of e)if(void 0===n.get(t))return t})),R=Gn.create(S,A,g);Pn.create(e.click,e.buttons,e.size,l.stores.parent.get,l.stores.click.get,l.stores.geometry.get,u.stores.click.get,R),_n.create(e.location,e.buttons,e.size,l.stores.parent.get,l.stores.enter.get,l.stores.leave.get,l.stores.geometry.get,u.stores.enter.get,u.stores.leave.get,R),kn.create(e.mouse,e.buttons,e.location,e.size,l.stores.mouseUp.get,l.stores.mouseDown.get,l.stores.parent.get,u.stores.mouseUp.get,u.stores.mouseDown.get,R);const z=hr.create(xr.toArray(S),S.screenStores.draw,g.getScreenId,(,M);return e.onFrame.onChanged((e=>{x.processChanges(),v.processChanges(),p.processChanges(),C.processChanges(),E.processChanges(),w.processChanges(),T.processChanges(),z(e)})),{screen:{...c.systems,create:t.create,remove:t.remove},scene:{...s.systems,create:n.create,remove:n.remove},node:{...l.systems,create:l.create,remove:l.remove},element:{...u.systems,create:u.create,remove:u.remove},material:{...d.systems,create:d.create,remove:d.remove},layer:{...m.systems,create:m.create,remove:m.remove},shader:{...f.systems,create:f.create,remove:f.remove},shutdownEngine:}}(Tr||(Tr={})),function(e){e.create=function(e){let t={};return e.available.onChanged((e=>{e||(t={})})),{...e,setBlending(n){var r,o,i;(void 0===t.blending&&void 0!==n||void 0!==t.blending&&void 0===n||(null==n?void 0:n.destination)!==(null===(r=t.blending)||void 0===r?void 0:r.destination)||(null==n?void 0:n.source)!==(null===(o=t.blending)||void 0===o?void 0:o.source)||(null==n?void 0:n.equation)!==(null===(i=t.blending)||void 0===i?void 0:i.equation))&&(e.setBlending(n),t.blending=n)},setCulling(n){n!==t.culling&&(e.setCulling(n),t.culling=n)},setDepthRead(n){n!==t.depthTest&&(e.setDepthRead(n),t.depthTest=n)},enableDepthMask(n){n!==t.depthMask&&(e.enableDepthMask(n),t.depthMask=n)},createProgram(n,r){const o=e.createProgram(n,r);if(void 0!==o)return{...o,use(){o!==t.program&&(o.use(),t.program=o)}}},setClearColor(n,r,o,i){(void 0===t.clearColor||t.clearColor.r!==n||t.clearColor.g!==r||t.clearColor.b!==o||t.clearColor.a!==i)&&(e.setClearColor(n,r,o,i),void 0===t.clearColor&&(t.clearColor=v.rgba(0,0,0,0)),t.clearColor.r=n,t.clearColor.g=r,t.clearColor.b=o,t.clearColor.a=i)},viewport(n,r,o,i){(void 0===t.viewport||t.viewport.x!==n||t.viewport.y!==r||t.viewport.width!==o||t.viewport.height!==i)&&(e.viewport(n,r,o,i),void 0===t.viewport&&(t.viewport=Wt.create(n,r,o,i)),t.viewport.x=n,t.viewport.y=r,t.viewport.width=o,t.viewport.height=i)},enableStencilTest(n){t.stencilEnabled!==n&&(e.enableStencilTest(n),t.stencilEnabled=n)},colorMask(n,r,o,i){(void 0===t.colorMask||t.colorMask.r!==n||t.colorMask.g!==r||t.colorMask.b!==o||t.colorMask.a!==i)&&(e.colorMask(n,r,o,i),t.colorMask={r:n,g:r,b:o,a:i})},setStencil(n){(void 0===t.stencilOperation||!m.equal(n,t.stencilOperation))&&(e.setStencil(n),t.stencilOperation=n)},setStencilMask(n){t.stencilMask!==n&&(e.setStencilMask(n),t.stencilMask=n)}}}}(Cr||(Cr={})),function(e){e.create=function(e){const t={"2D":e.TEXTURE_2D,cubemap:e.TEXTURE_CUBE_MAP},n={destinationAlpha:e.DST_ALPHA,destinationColor:e.DST_COLOR,one:e.ONE,oneMinusDestinationAlpha:e.ONE_MINUS_DST_ALPHA,oneMinusDestinationColor:e.ONE_MINUS_DST_COLOR,oneMinusSourceAlpha:e.ONE_MINUS_SRC_ALPHA,oneMinusSourceColor:e.ONE_MINUS_SRC_COLOR,sourceAlpha:e.SRC_ALPHA,sourceColor:e.SRC_COLOR,zero:e.ZERO},r={add:e.FUNC_ADD,substract:e.FUNC_SUBTRACT,reverseSubstract:e.FUNC_REVERSE_SUBTRACT},o={magFilter:e.TEXTURE_MAG_FILTER,minFilter:e.TEXTURE_MIN_FILTER},i={wrapS:e.TEXTURE_WRAP_S,wrapT:e.TEXTURE_WRAP_T},a={always:e.ALWAYS,equal:e.EQUAL,never:e.NEVER},c={keep:e.KEEP,replace:e.REPLACE,zero:e.ZERO};return{attributeLocations:{position:0,normal:1,textureCoordinates:2,ambientOcclusion:3,tangent:4},textureTypes:t,textureFilterMethods:{linear:e.LINEAR,linearMipmapLinear:e.LINEAR_MIPMAP_LINEAR,nearest:e.NEAREST,nearestMipmapLinear:e.NEAREST_MIPMAP_LINEAR,nearestMipmapNearest:e.NEAREST_MIPMAP_NEAREST},textureFilters:o,textureWrapMethods:{clampToEdge:e.CLAMP_TO_EDGE,repeat:e.REPEAT},dataTypes:{unsignedByte:e.UNSIGNED_BYTE,float:e.FLOAT,vec2:e.FLOAT_VEC2,vec3:e.FLOAT_VEC3,vec4:e.FLOAT_VEC4,matrix4:e.FLOAT_MAT4,sampler2D:e.SAMPLER_2D,bool:e.BOOL,unsignedShort:e.UNSIGNED_SHORT,"vec3[]":e.FLOAT_VEC3,cubemap:e.SAMPLER_CUBE},bufferTypes:{element:e.ELEMENT_ARRAY_BUFFER,data:e.ARRAY_BUFFER},bufferUsages:{staticDraw:e.STATIC_DRAW,dynamicDraw:e.DYNAMIC_DRAW},screenBufferTypes:{color:e.COLOR_BUFFER_BIT,depth:e.DEPTH_BUFFER_BIT,stencil:e.STENCIL_BUFFER_BIT},shaderParameters:{compileStatus:e.COMPILE_STATUS},geometryLayouts:{triangles:e.TRIANGLES,points:e.POINTS,lines:e.LINES},blendFactors:n,blendEquation:r,textureWrap:i,comparison:a,stencilOp:c}}}(Er||(Er={})),function(e){e.create=function(e){const t={rgba:e.RGBA,rgba8:e.RGBA,rgb32f:e.RGB,rgba32f:e.RGBA,rgba16f:e.RGBA,rgb16f:e.RGB,rgb8:e.RGB,rgb:e.RGB,r8:e.RED_BITS,r:e.RED_BITS,luminance:e.LUMINANCE};return{...Er.create(e),textureDataFormat:t}}}(Sr||(Sr={})),function(e){e.create=function(e){const t={rgba:e.RGBA,rgba8:e.RGBA8,rgb32f:e.RGB32F,rgba32f:e.RGBA32F,rgba16f:e.RGBA16F,rgb16f:e.RGB16F,rgb8:e.RGB8,rgb:e.RGB,r8:e.R8,r:e.RED,luminance:e.LUMINANCE};return{...Er.create(e),textureDataFormat:t}}}(Mr||(Mr={})),function(e){e.create=function(e,t,n,r){return{texture:e,target:t,delete(){n.deleteTexture(e)},generateMipmap(){n.bindTexture(r.textureTypes[t],e),n.generateMipmap(r.textureTypes[t])},texImage2DFromImage(o,i,a,c,s){n.bindTexture(r.textureTypes[t],e),n.texImage2D(r.textureTypes[t],o,r.textureDataFormat[i],r.textureDataFormat[a],r.dataTypes[c],s)},setTextureParametersFromSampler(e){this.setTextureWrap("wrapS",e.wrapS),this.setTextureWrap("wrapT",e.wrapT),e.minFilter&&e.magFilter&&(this.setTextureFilter("minFilter",e.minFilter),this.setTextureFilter("magFilter",e.magFilter))},setTextureFilter(o,i){n.bindTexture(r.textureTypes[t],e),n.texParameteri(r.textureTypes[t],r.textureFilters[o],r.textureFilterMethods[i])},setTextureWrap(o,i){n.bindTexture(r.textureTypes[t],e),n.texParameteri(r.textureTypes[t],r.textureWrap[o],r.textureWrapMethods[i])}}}}(Ar||(Ar={})),function(e){e.create=function(e,t,n){const r=t.createTexture();if(null!==r)return{...Ar.create(r,e,t,n),texImage2DFromBuffer(o,i,a,c,s,u,l,m){t.bindTexture(n.textureTypes[e],r),t.getExtension("OES_texture_float")&&t.getExtension("OES_texture_float_linear")||console.error("Float textures not supported"),t.texImage2D(n.textureTypes[e],o,n.textureDataFormat[i],a,c,s,n.textureDataFormat[u],n.dataTypes[l],m)},texCubemapFromBuffer(o,i,a,c,s){t.activeTexture(t.TEXTURE0+0),t.bindTexture(n.textureTypes[e],r),"float"===c&&(t.getExtension("OES_texture_float")&&t.getExtension("OES_texture_float_linear")||console.error("Float textures not supported"));const u=[t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z];for(let e=0;e<s.data.length;e++){const r=[(l=s.data[e].faces).left,l.bottom,l.back,l.right,l.top,l.front];for(let i=0;i<r.length;i++){const s=r[i];t.texImage2D(u[i],e,n.textureDataFormat[o],n.textureDataFormat[a],n.dataTypes[c],s)}}var l;const m=Math.log2(s.data[0].width);for(let e=s.data.length;e<=m;e++){const r=m-e;for(let s=0;s<6;s++)t.texImage2D(u[s],e,n.textureDataFormat[o],Math.pow(2,r),Math.pow(2,r),i,n.textureDataFormat[a],n.dataTypes[c],null)}}}}}(Rr||(Rr={})),function(e){e.create=function(e,t,n){const r=t.createTexture();if(null!==r)return{...Ar.create(r,e,t,n),texImage2DFromBuffer(o,i,a,c,s,u,l,m){t.bindTexture(n.textureTypes[e],r),t.texImage2D(n.textureTypes[e],o,n.textureDataFormat[i],a,c,s,n.textureDataFormat[u],n.dataTypes[l],m)},texCubemapFromBuffer(o,i,a,c,s){t.activeTexture(t.TEXTURE0+0),t.bindTexture(n.textureTypes[e],r),t.texParameteri(n.textureTypes[e],t.TEXTURE_BASE_LEVEL,0),t.texParameteri(n.textureTypes[e],t.TEXTURE_MAX_LEVEL,s.data.length-1);const u=[t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z];for(let e=0;e<s.data.length;e++){const r=[(l=s.data[e].faces).left,l.bottom,l.back,l.right,l.top,l.front];for(let l=0;l<r.length;l++){const m=r[l];t.texImage2D(u[l],e,n.textureDataFormat[o],s.data[e].width,s.data[e].height,i,n.textureDataFormat[a],n.dataTypes[c],m)}}var l}}}}(zr||(zr={})),function(e){function t(e,t,n,r,o,i,a,c,s,u){const l=s.createBuffer();if(null===l)return;const m=u.bufferTypes[n];return s.bindBuffer(m,l),s.bufferData(m,e,u.bufferUsages[t]),{valuesPerVertex:r,type:n,items:o,normalized:i,stride:a,offset:c,delete(){s.deleteBuffer(l)},buffer:l}}e.createBuffer=t,e.createDataBuffer=function(e,n,r,o,i,a,c,s,u){const l=t(n,e,"data",r,o,i,a,c,s,u);if(void 0!==l)return{...l,type:"data"}},e.createIndexBuffer=function(e,n,r,o,i){const a=t(n,e,"element",1,r,!1,0,0,o,i);if(void 0!==a)return{...a,type:"element",valuesPerVertex:1,stride:0,offset:0,normalized:!1}}}(Pr||(Pr={})),function(e){function t(e,t,n){var r=document.createElement("canvas");r.width=t,r.height=n;var o=r.getContext("2d");if(!o)throw"Context not found";var i=o.createImageData(t,n);i.data.set(e),o.putImageData(i,0,0);var a=document.createElement("canvas");a.width=t,a.height=n;var c=a.getContext("2d");if(!c)throw"Context not found";return c.scale(1,-1),c.drawImage(r,0,-n,t,n),{context:c,canvas:a}}e.create=function(e,n,r,o,i){const a=n.width,c=n.height;return{...r,size:()=>n,bindunbindgetColorAttachment:()=>o,useTextures(e){var t;e.setTexture(o),null===(t=e.setUniform)||void 0===t||t.setBoolean(!0)},deletetoBlob(n,r){return new Promise(((o,i)=>{let s=new Uint8Array(a*c*4);this.bind(),e.readPixels(0,0,a,c,e.RGBA,e.UNSIGNED_BYTE,s);const{context:u,canvas:l}=t(s,a,c);l.toBlob((e=>{e?o(e):i("Can't create Blob!")}),n,r)}))},toImageData(){let n=new Uint8Array(a*c*4);this.bind(),e.readPixels(0,0,a,c,e.RGBA,e.UNSIGNED_BYTE,n);const{context:r,canvas:o}=t(n,a,c);return r.getImageData(0,0,a,c)}}}}(kr||(kr={})),function(e){e.create=function(e,t,n){const r=n.width,o=n.height,i=e.createFramebuffer();if(!i)throw"Cant create framebuffer";e.bindFramebuffer(e.FRAMEBUFFER,i);const a=zr.create("2D",e,t);if(!a)throw"Cant create texture";a.texImage2DFromBuffer(0,"rgba",r,o,0,"rgba","unsignedByte",null),a.setTextureFilter("minFilter","linear"),a.setTextureFilter("magFilter","linear"),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a.texture,0);const c=e.createRenderbuffer();if(!c)throw"Cant create renderBuffer";if(e.bindRenderbuffer(e.RENDERBUFFER,c),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH24_STENCIL8,r,o),e.bindRenderbuffer(e.RENDERBUFFER,null),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,c),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw"Attachments are not working";return e.bindFramebuffer(e.FRAMEBUFFER,null),kr.create(e,n,i,a,c)}}(_r||(_r={})),function(e){e.create=function(e,t,n){const r=n.width,o=n.height,i=e.createFramebuffer();if(!i)throw"Cant create framebuffer";e.bindFramebuffer(e.FRAMEBUFFER,i);const a=Rr.create("2D",e,t);if(!a)throw"Cant create texture";a.texImage2DFromBuffer(0,"rgba",r,o,0,"rgba","unsignedByte",null),a.setTextureFilter("minFilter","linear"),a.setTextureFilter("magFilter","linear"),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a.texture,0);const c=e.createRenderbuffer();if(!c)throw"Cant create renderBuffer";if(e.bindRenderbuffer(e.RENDERBUFFER,c),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r,o),e.bindRenderbuffer(e.RENDERBUFFER,null),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,c),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw"Attachments are not working";return e.bindFramebuffer(e.FRAMEBUFFER,null),kr.create(e,n,i,a,c)}}(Br||(Br={})),Fr||(Fr={})),function(e){e.create=function(e){const t=br.create(0),n=return e.addEventListener("mouseup",n),e.addEventListener("mousemove",n),e.addEventListener("mousedown",n),{buttons:Fr.create(t),clearElementButtons:}}(Ir||(Ir={})),function(e){e.create=function(e){const t=br.create(u.zero()),n=e=>{t.set(u.create(e.offsetX,e.offsetY))};return e.addEventListener("click",n),{click:Fr.create(t),clearElementClick:}}(Or||(Or={})),function(e){e.create=function(e){const t=br.create(void 0),n=e=>{t.set("up"),t.set(void 0)},r=e=>{t.set("down"),t.set(void 0)};return e.addEventListener("mouseup",n),e.addEventListener("mousedown",r),{mouse:Fr.create(t),clearElementMouse:function(){e.removeEventListener("mouseup",n),e.removeEventListener("mousedown",r)}}}}(Nr||(Nr={})),function(e){e.create=function(e){const t=br.create(void 0),n=r=return e.addEventListener("mousemove",n),e.addEventListener("mouseleave",r),{elementMove:Fr.create(t),clearMoveListener:}}(Dr||(Dr={})),function(e){e.create=function(e){const t=br.create(!1),n=function(e,t){return void 0===IntersectionObserver?function(e,t){const n=new IntersectionObserver((e=>{if(0===e.length)return;e.sort(();const n=e[0].isIntersecting;t(n)}));return n.observe(e),n.disconnect}(e,t):function(e,t){return t(!0),(0,t)}(e,t.set);return{visible:Fr.create(t),clearElementVisible:n}}}(Lr||(Lr={})),function(e){e.create=function(e){const t=br.create(!0),n=r=e=>{console.log("context restored"),window.requestAnimationFrame(()};return e.addEventListener("webglcontextlost",n,!1),e.addEventListener("webglcontextrestored",r,!1),{available:t,clearAvailableListener:}}(Ur||(Ur={})),function(e){e.create=function(e,t){return so(e,(e=>e?{OES_standard_derivatives:t("OES_standard_derivatives")}:{OES_standard_derivatives:!1}))}}(Gr||(Gr={})),function(e){e.create=function(e,t,n){const{visible:r,clearElementVisible:o}=Lr.create(e),{buttons:i,clearElementButtons:a}=Ir.create(e),{mouse:c,clearElementMouse:s}=Nr.create(e),{click:u,clearElementClick:l}=Or.create(e),{elementMove:m,clearMoveListener:d}=Dr.create(e),{available:f,clearAvailableListener:p}=Ur.create(e),v=Fr.create(f),g=Gr.create(v,n),x=br.create(0);return t.requestAnimationFrame((function e(n){f.get()&&r.get()&&x.set(n),t.requestAnimationFrame(e)})),{clearContext:function(){o(),l(),d(),p(),a(),s(),!1!==f.get()||console.log("Cant shutdown engine, no context available")},extensions:g,click:u,location:m,available:v,buttons:i,mouse:c,onFrame:x}}}(Vr||(Vr={})),function(e){e.createAttribute=function(e,t,n,r,o,i){return{name:e,attributeType:t,dataType:n,activate(e){o.bindBuffer(i.bufferTypes[e.type],e.buffer),o.enableVertexAttribArray(r),o.vertexAttribPointer(r,e.valuesPerVertex,i.dataTypes[this.dataType],e.normalized,e.stride,e.offset)}}}}(Hr||(Hr={})),function(e){e.create=function(e,t,n){const r=Pr.createIndexBuffer("staticDraw",e.indices,e.indices.length,t,n);if(!r)throw"Can't create buffer";const o=e.vertexCount,i=Ft.map(e.vertices,(function(e){const r=e[0],o=e[1];if(!o)throw"Can't create renderGeometry";const i=An[o.dataType],a=o.data.length/i,c=Pr.createDataBuffer("staticDraw",o.data,i,a,!1,0,0,t,n);if(!c)throw"Can't create buffer";return[r,c]})),a={vertexCount:o,indices:r,vertices:i,layout:e.layout,attributes:[],vertexArray:{}};t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.indices.buffer);let c=0;for(const r in i){const o=r,i=e.vertices[o];if(!i)throw"Can't find attribute";const s=c,u=Hr.createAttribute(o,i.dataType,"float",s,t,n);if(a.attributes[c]=u,!a.vertices[o])throw"Can't find vertex buffer";c++}return a},e.bindAttributes=function(e,t){const n=Object.keys(e.vertices);for(const t in e.attributes){const r=e.attributes[t],o=e.vertices[n[t]];if(!o)throw"Can't find vertex buffer";r.activate(o)}}}(jr||(jr={})),function(e){e.create=function(e,t,n){const r=Pr.createIndexBuffer("staticDraw",e.indices,e.indices.length,t,n);if(!r)throw"Can't create buffer";const o=e.vertexCount,i=Ft.map(e.vertices,(function(e){const r=e[0],o=e[1];if(!o)throw"Can't create renderGeometry";const i=An[o.dataType],a=o.data.length/i,c=Pr.createDataBuffer("staticDraw",o.data,i,a,!1,0,0,t,n);if(!c)throw"Can't create buffer";return[r,c]})),a={vertexCount:o,indices:r,vertices:i,layout:e.layout,attributes:[],vertexArray:{}},c=t.createVertexArray();if(null===c)throw"Can't create VAO";t.bindVertexArray(c),a.vertexArray=c,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.indices.buffer);let s=0;for(const r in i){const o=r,i=e.vertices[o];if(!i)throw"Can't find attribute";const c=n.attributeLocations[o],u=Hr.createAttribute(o,i.dataType,"float",c,t,n);a.attributes[s]=u;const l=a.vertices[o];if(!l)throw"Can't find vertex buffer";u.activate(l),s++}return t.bindVertexArray(null),a}}(Wr||(Wr={})),function(e){function t(e,t,n,r){return e.replace(new RegExp(t),"g"),n)}e.GetParsedDerivativesAndExtensions=function(e,t,n){const r="vertex"===t?"\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 textureCoordinate;\nattribute float ambientOcclusion;\nattribute vec3 tangent;\n":"",o=n?"\n#define standardDerivativesEnabled\n":"",i="#extension GL_EXT_shader_texture_lod : enable\n#extension GL_OES_standard_derivatives : enable\n",a=e.indexOf(i);let c=e,s="";return a>=0&&(s=i,c=e.substring(a+94,e.length)),s+"\nprecision highp float;\n"+o+r+"\nvec3 getView(vec3 cameraPosition, vec3 worldPosition){\n\treturn normalize(cameraPosition - worldPosition);\n}\n\nfloat getNormalDotView(vec3 normal, vec3 view){\n\treturn max(dot(normal, view), 1e-4);\n}\n\nvec4 premultiplyAlpha(vec3 color, float alpha){\n\treturn vec4(color * alpha, alpha);\n}\n\nvec3 rembrandtSmoothstep(vec3 value) {\n\tvec3 clamped = clamp(value, 0.0, 1.0);\n\treturn clamped * clamped * (3.0 - 2.0 * clamped);\n}\n\nvec4 combinePRB(vec3 diffuse, vec3 irradiance, vec3 specularity, vec3 radiance, float ambientOcclusion, vec3 emissive, float opacity, float mask){\n\tvec3 color = ((diffuse * irradiance * opacity) + (specularity * radiance)) * ambientOcclusion + emissive;\n\treturn vec4(color, opacity) * mask;\n}\n\t"+c},e.ParseShadersFromGL2ToGL1=function(e,n){var r=e,o=n;return o=t(o,"out vec4 fragColor;",""),o=t(o,"fragColor ","gl_FragColor "),o=t(o,"in ","varying "),o=t(o,"texture(cubemap","textureCube(cubemap"),o=t(o,"texture(","texture2D("),o=function(e){if(e.includes("vec3 getNormal(")){const t=e.indexOf("vec3 getNormal("),n="return normalizedWorldNormal;\n\t}\n}",r=e.indexOf(n)+n.length;return"\n#extension GL_EXT_shader_texture_lod : enable\n#extension GL_OES_standard_derivatives : enable\n"+e.substring(0,t)+"#ifdef standardDerivativesEnabled \n"+e.substring(t,r)+"\n #else \n vec3 getNormal(vec3 worldPosition, vec3 worldNormal, vec2 textureCoordinate, vec3 view){\n return normalize(worldNormal); \n}\n #endif\n"+e.substring(r)}if(e.includes("vec3 getNormalFromTexture(")){const t=e.indexOf("vec3 getNormalFromTexture("),n="if (invertNormal){\n\t\tnormal *= -1.0;\n\t}\n\treturn normal;\n}",r=e.indexOf(n)+n.length;return"\n#extension GL_EXT_shader_texture_lod : enable\n#extension GL_OES_standard_derivatives : enable\n"+e.substring(0,t)+"#ifdef standardDerivativesEnabled \n"+e.substring(t,r)+"\n #else \n vec3 getNormalFromTexture(mat3 TBN, vec2 textureCoordinate){\n return TBN[2]; \n}\n #endif\n"+e.substring(r)}return e}(o=t(o,"textureLod(","textureCubeLodEXT(")),r=t(r,"out ","varying "),{vertexShaderCode:r=t(r," varying "," out "),fragmentShaderCode:o}}}(Xr||(Xr={})),function(e){e.createWebGL2Shader=function(e,t,n,r){const o="vertex"===e?t.VERTEX_SHADER:t.FRAGMENT_SHADER,i=t.createShader(o);if(null!==i)return{source(n){const r="#version 300 es\nprecision highp float;\n"+("vertex"===e?"\nlayout(location = 0) in vec3 position;\nlayout(location = 1) in vec3 normal;\nlayout(location = 2) in vec2 textureCoordinate;\nlayout(location = 3) in float ambientOcclusion;\nlayout(location = 4) in vec3 tangent;\n":"")+"\nvec3 getView(vec3 cameraPosition, vec3 worldPosition){\n\treturn normalize(cameraPosition - worldPosition);\n}\n\nfloat getNormalDotView(vec3 normal, vec3 view){\n\treturn max(dot(normal, view), 1e-4);\n}\n\nvec4 premultiplyAlpha(vec3 color, float alpha){\n\treturn vec4(color * alpha, alpha);\n}\n\nvec3 rembrandtSmoothstep(vec3 value) {\n\tvec3 clamped = clamp(value, 0.0, 1.0);\n\treturn clamped * clamped * (3.0 - 2.0 * clamped);\n}\n\nvec4 combinePRB(vec3 diffuse, vec3 irradiance, vec3 specularity, vec3 radiance, float ambientOcclusion, vec3 emissive, float opacity, float mask){\n\tvec3 color = ((diffuse * irradiance * opacity) + (specularity * radiance)) * ambientOcclusion + emissive;\n\treturn vec4(color, opacity) * mask;\n}\n\t"+n;t.shaderSource(i,r)},compile(){if(t.compileShader(i),!1===this.getParameter("compileStatus")){var e=this.getInfoLog();const n=t.getShaderSource(i);if(null===n)throw"Could not compile WebGL shader.";throw`Could not compile WebGL shader. \n\n${e}\n\n${n.split("\n").map(((e,t)=>`${t}: ${e}`)).join("\n")}`}},delete(){t.deleteShader(i)},getParameter:e=>t.getShaderParameter(i,r.shaderParameters[e]),getInfoLog(){const e=t.getShaderInfoLog(i);return null===e?void 0:e},get:()=>i}},e.createWebGL1Shader=function(e,t,n,r){const o="vertex"===e?t.VERTEX_SHADER:t.FRAGMENT_SHADER,i=t.createShader(o);if(null!==i)return{source(r){if(!t.getExtension("EXT_shader_texture_lod"))throw"No lod support";const o=Xr.GetParsedDerivativesAndExtensions(r,e,n);t.shaderSource(i,o)},compile(){if(t.compileShader(i),!1===this.getParameter("compileStatus")){var e=this.getInfoLog();const n=t.getShaderSource(i);if(null===n)throw"Could not compile WebGL shader.";throw`Could not compile WebGL shader. \n\n${e}\n\n${n.split("\n").map(().join("\n")}`}},delete(){t.deleteShader(i)},getParameter:getInfoLog(){const e=t.getShaderInfoLog(i);return null===e?void 0:e},get:}}($r||($r={})),function(e){e.getActiveUniform=function(e,t,n,r){const o=n.getActiveUniform(t,e);if(null===o)return;let i=o.name,a=o.type,c=n.getUniformLocation(t,i);if(i.includes("[")){i=i.replace("[0]",""),c=n.getUniformLocation(t,i);const e=n.getUniform(t,c);if(null===e)return;const r="vec"+e.length+"[]";return Rn.createUniform(c,i,r,n)}if(null===c)return;const s=Object.keys(r.dataTypes).find(();return Rn.createUniform(c,i,s,n)},e.create=function(t,n,r,o,i){return{usedeletegetInfoLog(){const e=n.getProgramInfoLog(t);return null===e?void 0:e},getActiveUniforms(){const r=n.getProgramParameter(t,n.ACTIVE_UNIFORMS),o={};for(let a=0;a<r;a++){const r=e.getActiveUniform(a,t,n,i);if(!r)throw"Cant get uniform";o[r.name]=r}const a=[],c=[];var s=0,u=0,l=0;for(const e in o){const t=o[e];if("sampler2D"===t.dataType){const r=e+"Set",c=o[r];if(!c)throw`Unable to find boolean uniform: ${r} for texture uniform: ${e}`;const s=Rn.createRegularUniform(c.getUniformLocation(),c.name,"bool",n);a[u]=Rn.createSamplerUniform(t.getUniformLocation(),l++,t.name,n,s,i),u++}else"cubemap"===t.dataType?(a[u]=Rn.createSamplerUniform(t.getUniformLocation(),l++,t.name,n,void 0,i),u++):e.includes("TextureSet")||(c[s]=Rn.createRegularUniform(t.getUniformLocation(),e,t.dataType,n),s++)}return{samplerUniforms:a,regularUniforms:c}}}}}(qr||(qr={})),function(e){e.create=function(e,t,n,r){const o=n.createProgram();if(null===o)return;const i=n.getExtension("OES_standard_derivatives"),a=$r.createWebGL1Shader("vertex",n,i,r);if(void 0===a)return;const c=$r.createWebGL1Shader("fragment",n,i,r);if(void 0===c)return;const{vertexShaderCode:s,fragmentShaderCode:u}=Xr.ParseShadersFromGL2ToGL1(e,t);if(a.source(s),a.compile(),c.source(u),c.compile(),n.attachShader(o,a.get()),n.attachShader(o,c.get()),n.linkProgram(o),!1===n.getProgramParameter(o,n.LINK_STATUS))throw"Could not compile the program";return qr.create(o,n,a,c,r)}}(Yr||(Yr={})),function(e){e.create=function(e,t,n,r){const o=n.createProgram();if(null===o)return;const i=$r.createWebGL2Shader("vertex",n,null,r);if(void 0===i)return;const a=$r.createWebGL2Shader("fragment",n,null,r);if(void 0!==a){if(i.source(e),i.compile(),a.source(t),a.compile(),n.attachShader(o,i.get()),n.attachShader(o,a.get()),n.linkProgram(o),!1===n.getProgramParameter(o,n.LINK_STATUS))throw"Could not compile the program";return qr.create(o,n,i,a,r)}}}(Zr||(Zr={})),function(e){e.toBase64=(e,t,n,r="png")=>{const o=document.createElement("canvas");o.width=null!=t?t:e.width,o.height=null!=n?n:e.height;const i=o.getContext("2d");if(!i)throw"Can't create 2d context!";i.drawImage(e,0,0,o.width,o.height);const a=o.toDataURL(`image/${r}`);return Promise.resolve(a)},e.toBlob=async e=>(await fetch(e.src)).blob(),e.getSizeInBytes=e.loadImage=async function(e){return new Promise(()}}(Qr||(Qr={})),function(e){e.toBase64=async e=>new Promise((),e.toImage=e=>new Promise((t=>{const n=URL.createObjectURL(e),r=new Image;r.onload=r.src=n})),e.toJpegBase64=async function(t){const n=await e.toImage(t);return Qr.toBase64(n,void 0,void 0,"jpeg")},e.toUint8Array=async function(e){const t=await e.arrayBuffer();return new Uint8Array(t)},e.isBlob=e.trimBlob=async function(e){if("image/png"!==e.type)return e;const t=await Jr.fromBlob(e),n=Jr.trimCanvas(t);return Jr.toBlob(n)}}(Kr||(Kr={})),function(e){async function t(e,t,n){return new Promise(((r,o)=>{e.toBlob((e=>{e?r(e):o("Can't create Blob!")}),t,n)}))}function n(e){return e.filter(()}function r(e,t){const n=e.reduce(((e,n,r)=>{if(0===n)return e;const o=r%t,i=Math.floor(r/t);return void 0===e?{top:i,left:o,right:o,bottom:i}:{top:e.top,left:Math.min(e.left,o),right:Math.max(e.right,o),bottom:Math.max(e.bottom,i)}}),void 0);if(!n)throw"fully transparent image";return n}e.toBlob=t,e.fromBlob=function(e){return new Promise((t=>{const n=document.createElement("canvas"),r=n.getContext("2d",{willReadFrequently:!0}),o=new Image;o.onload=e=>{const i=e.target;i&&r&&(URL.revokeObjectURL(i.src),n.width=o.naturalWidth,n.height=o.naturalHeight,r.drawImage(i,0,0),t(n))},o.src=URL.createObjectURL(e)}))},e.toImageData=function(e){const t=e.getContext("2d")||function(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");return n?(n.drawImage(e,0,0),n):null}(e);if(!t)throw"Context not found";return t.getImageData(0,0,e.width,e.height)},e.toImage=async function(e){const n=await t(e);return await Kr.toImage(n)},e.trimCanvas=function(e){const t=e.getContext("2d",{willReadFrequently:!0});if(!t)throw"could not get canvas 2d context";const o=document.createElement("canvas").getContext("2d");if(!o)throw"could not get canvas 2d context";const i=t.getImageData(0,0,e.width,e.height),a=r(n(Array.from(i.data)),e.width),c=a.bottom-a.top+1,s=a.right-a.left+1,u=t.getImageData(a.left,a.top,s,c);return o.canvas.width=s,o.canvas.height=c,o.putImageData(u,0,0),o.canvas},e.getPixelsAlpha=n,e.getImageBounds=r}(Jr||(Jr={})),function(e){e.create=function(e,t,n){return{toBlob:(e,n)=>new Promise(((r,o)=>{t.toBlob((,e,n)})),toImageData:getExtension:clearContext(){const e=this.getExtension("WEBGL_lose_context");null==e||e.loseContext()},setClearColor(t,n,r,o){e.clearColor(t,n,r,o)},clearsetBlending(t){t?(e.enable(e.BLEND),e.blendFunc(n.blendFactors[t.source],n.blendFactors[t.destination]),e.blendEquation(n.blendEquation[t.equation])):e.disable(e.BLEND)},setCulling(t){switch(t){case"none":return void e.disable(e.CULL_FACE);case"front":return e.enable(e.CULL_FACE),void e.frontFace(e.CCW);case"back":return e.enable(e.CULL_FACE),void e.frontFace(e.CW)}},setDepthRead(t){t?(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},enableDepthMask(t){e.depthMask(t)},setStencilMaskenableStencilTestsetStencil(t){e.stencilOp(n.stencilOp[t.operation.fail],n.stencilOp[t.operation.zFail],n.stencilOp[t.operation.zPass]),e.stencilFunc(n.comparison[t.comparison.function],t.comparison.ref,t.comparison.mask),this.setStencilMask(t.writeMask)},colorMask(t,n,r,o){e.colorMask(t,n,r,o)},viewport}}(eo||(eo={})),function(e){e.create=function(e,t){const n=e.getContext("webgl",{antialias:t.antialias,alpha:!0,premultipliedAlpha:!0,stencil:!0});if(!n)throw"Can't create WebGL context";const r=Sr.create(n),o=eo.create(n,e,r),i=Vr.create(e,t,o.getExtension);return{...o,...i,size:t.size,clearContext:()=>{o.clearContext(),i.clearContext()},createRenderGeometry:e=>jr.create(e,n,r),createFrameBuffer:e=>Br.create(n,r,e),createTexture:e=>Rr.create(e,n,r),createProgram:(e,t)=>Yr.create(e,t,n,r),drawElements(e){jr.bindAttributes(e,n);const t=e.indices;n.bindBuffer(r.bufferTypes[t.type],t.buffer),n.drawElements(r.geometryLayouts[e.layout],t.items,r.dataTypes.unsignedShort,t.offset);for(let e=0;e<8;e++)n.disableVertexAttribArray(e)}}}}(to||(to={})),function(e){e.create=function(e,t){const n=e.getContext("webgl2",{antialias:t.antialias,alpha:!0,premultipliedAlpha:!0,stencil:!0});if(!n)throw"Can't create WebGL context";const r=Mr.create(n),o=eo.create(n,e,r),i=Vr.create(e,t,o.getExtension);return{...o,...i,size:t.size,clearContext:createRenderGeometry:e=>Wr.create(e,n,r),createFrameBuffer:e=>_r.create(n,r,e),createTexture:createProgram:drawElements(e){n.bindVertexArray(e.vertexArray);const t=e.indices;n.drawElements(r.geometryLayouts[e.layout],t.items,r.dataTypes.unsignedShort,t.offset),n.bindVertexArray(null)}}}}(no||(no={})),function(e){e.create=function(e,t){try{return no.create(e,t)}catch(n){try{return to.create(e,t)}catch(e){throw"Can't create WebGL context"}}}}(ro||(ro={})),function(e){e.create=function(e){const t=br.create({width:0,height:0,devicePixelRatio:1});return new ResizeObserver((e=>{const n=e.pop();if(!n)return;const r=n.contentRect.width,o=n.contentRect.height;t.set({width:r,height:o,devicePixelRatio:window.devicePixelRatio})})).observe(e),Fr.create(t)}}(oo||(oo={})),function(e){e.create=function(e,t){const{canvasElement:n,size:r}=function(e,t){const n=document.createElement("canvas");e.append(n);!function(e,t){e.style.position="relative",t&&(e.style.width="100%",e.style.height="100%")}(n,!t.resolution);const r=t.resolution?so(t.resolution,():oo.create(e);return function(e,t){t.onNewValue((({width:t,height:n,devicePixelRatio:r})=>{e.width=t*r,e.height=n*r}))}(n,r),{canvasElement:n,size:r}}(e,t),o=ro.create(n,{...t,size:r}),i=Cr.create(o);return{...i,clearcontext:}}(io||(io={})),function(e){e.isDifferent=(ao||(ao={}));const vo=[];function go(e,t,n,r,o){if(e.type===t.type){if("text"===e.type&&"text"===t.type)return function(e,t,n){t.text!==e.text&&(n.updateText(e.real,t.text),e.text=t.text)}(e,t,n),e;if("tag"===e.type&&"tag"===t.type){if(t.tag===e.tag)return function(e,t,n,r){t.attributes.ref&&(t.attributes.ref.current=e.real,delete t.attributes.ref),n.updateAttributes(e.real,e.attributes,t.attributes),e.attributes=t.attributes,bo(e,t,n,!0,r)}(e,t,n,r),e}else if("component"===e.type&&"component"===t.type&&e.render===t.render)return ao.isDifferent(e.attributes,t.attributes)&&(e.attributes=t.attributes,ho(e,n,r,o)),e}return xo(e,n,!0),yo(e.realParent,t,n,r,o)}function xo(e,t,n){switch(e.type){case"empty":break;case"text":t.removeTextFromParent(e.real,e.realParent);break;case"tag":if(n&&t.removeNodeFromParent(e.real,e.attributes,e.realParent),e.children)for(const n of e.children)xo(n,t,!1);break;case"component":xo(e.child,t,n),e.state="unmounted",function(e){for(const t of e)t.cleanup&&(t.cleanup(),t.cleanup=void 0);e.length=0}(e.effectHandles)}}function yo(e,t,n,r,o){switch(t.type){case"text":return{type:"text",real:n.createAndAddText(t.text,e,o),text:t.text,realParent:e};case"tag":{const i=t.attributes.ref;i&&delete t.attributes.ref;const a=n.createAndAddNode(t.tag,t.attributes,e,o),c={type:"tag",real:a,tag:t.tag,attributes:t.attributes,realParent:e};return i&&(i.current=a),bo(c,t,n,!1,r),c}case"component":{const i={type:"component",child:{type:"empty",realParent:e},render:t.render,attributes:{...t.attributes},real:e,realParent:e,stateHandles:[],effectHandles:[],state:"idle"};return ho(i,n,r,o),i}}}function ho(e,t,n,r){if("idle"!==e.state&&"render-scheduled"!==e.state)throw new Error(`Rendering a non-idle or non-scheduled component is not supposed to happen! ${JSON.stringify(e)}`);e.scheduledId&&n.cancelAnimationFrame(e.scheduledId),e.state="rendering";for(let o=0;o<=100;o++){if(100===o)throw new Error("Infinite re-render loop detected.");let i=!1;const a=()=>{switch(e.state){case"unmounted":throw new Error("Cannot change state for a component that has been unmounted.");case"idle":wo(e,t,n,r);break;case"render-scheduled":case"cleanUseEffect":break;default:i=!0}};po(e.stateHandles,a),mo(e.effectHandles);const c=e.render(e.attributes);if(lo=void 0,uo=void 0,!i){e.child=go(e.child,c,t,n,r),e.real=e.child.real,e.state="useEffect",fo(e.effectHandles),e.state="idle",i&&ho(e,t,n,r);break}}}function bo(e,t,n,r,o){var i,a,c;const s=null!==(i=t.children)&&void 0!==i?i:vo;null!==(a=e.children)&&void 0!==a||(e.children=[]);let u=0,l=0;for(;u<e.children.length||l<s.length;){const t=e.children[u],i=s[l];if(t)if(i){const r=go(t,i,n,o,u);e.children[u]=r,u++,l++}else xo(t,n,r),e.children.splice(u,1);else{const t=yo(e.real,i,n,o,u);e.children[u]=t,u++,l++}}0===(null===(c=e.children)||void 0===c?void 0:c.length)&&delete e.children}function wo(e,t,n,r){"render-scheduled"!==e.state&&(e.scheduledId=n.requestAnimationFrame((()=>{e.scheduledId=void 0,"render-scheduled"===e.state&&(e.state="idle",ho(e,t,n,r))})),e.state="render-scheduled")}const To=new WeakMap;var Co,Eo,So,Mo,Ao,Ro,zo,Po;(Co||(Co={})).preventDefault=(Eo||(Eo={})).create=function(e,t){let n=!1;function r(e){"none"!==t.get()&&Co.preventDefault(e)}function o(e){"none"!==t.get()&&n&&Co.preventDefault(e)}function i(t){n=function(e,t){if(t.target==e)return!0;const n=e.getBoundingClientRect();return t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom}(e,t)}return e.addEventListener("mousedown",r),e.addEventListener("wheel",o),document.addEventListener("mousemove",i),document.addEventListener("wheel",o,{passive:!1}),,(So||(So={})).create=function(e,t){function n(e){"none"!==t.get()&&Co.preventDefault(e)}function r(e){0!=e.touches.length&&Co.preventDefault(e)}return e.addEventListener("touchstart",n),document.addEventListener("touchend",r),()=>{e.removeEventListener("touchstart",n),document.removeEventListener("touchend",r)}},(Mo||(Mo={})).create=function(e,t){const n=Eo.create(e,t),r=So.create(e,t);return,(Ao||(Ao={})).create=function(e,t,n){var r;const o=function(){const e=document.createElement("div");return e.style.position="absolute",e.style.inset="0",e.onmouseenter=()=>{const t=e.querySelector("canvas");null==t||t.classList.add("rotate")},e.onmouseleave=()=>{const t=e.querySelector("canvas");null==t||t.classList.remove("rotate")},e}();e.appendChild(o);const i=function(e,t){const n=function(e){return io.create(e,{antialias:!0,requestAnimationFrame:e=>window.requestAnimationFrame(e)})}(e);return n.size.onNewValue(t),Tr.create(n)}(o,t),a=Ct.create(i),c=Nt.create(),s=null!=(r=o.querySelector("canvas"))?r:document.createElement("canvas"),u=Mo.create(s,n);return{render:e=>function(e,t,n,r,o){const i=function(e){const t=To.get(e);if(t)return t;const n={type:"empty",realParent:e};return To.set(e,n),n}(t),a=go(i,e,n,r,o);i!==a&&To.set(t,a)}(e,a,c,window),canvas:s,dispose:},(Ro||(Ro={})).create=function(){return{composition:void 0,position:i.zero(),orientation:n.identity()}};class ko{creenPointToRay(e,t){const n=Dn.fromScreenCoordinates(u.create(e,t),this.screenSize,this.camera);return{Origin:{X:n.origin.x,Y:n.origin.y,Z:n.origin.z},Direction:{X:n.direction.x,Y:n.direction.y,Z:n.direction.z}}}}(zo||(zo={})).attach=function(e,t){const n=document.createElement("div");n.className="binkies-gallery",e.appendChild(n);const r=[];for(let e=0;e<t;e++){const e=document.createElement("div");e.className="binkies-bookmark creating",e.style.overflow="hidden";const t=document.createElement("img");e.appendChild(t),n.appendChild(e),r.push(t)}return{updateGalleryImage:function(e,t){const n=r[t];n.src=e,n.parentElement.className="binkies-bookmark created"},compositionChanged:function(){r.forEach(()}}},(Po||(Po={})).attach=function(e,t){const n=document.createElement("div");n.id="binkies-scene",n.className="binkies-unselectable",n.style.userSelect="none",n.style.pointerEvents="none",e.appendChild(n),function(e,t,n){let r=Wt.create(0,0,0,0);const o=()=>setTimeout((()=>{const i=t.getBoundingClientRect(),a=e.getBoundingClientRect(),c=Wt.getRelative(a,i);c.x===r.x&&c.y===r.y&&c.width===r.width&&c.height===r.height||(r=c,n(r)),o()}),100);o()}(e,n,t)};var _o,Bo=Object.defineProperty,Fo=Object.defineProperties,Io=Object.getOwnPropertyDescriptors,Oo=Object.getOwnPropertySymbols,No=Object.prototype.hasOwnProperty,Do=Object.prototype.propertyIsEnumerable,Lo=Uo=Go=function Vo(e,t){return t?e.filter(():e}function Ho(e,t,n){const r=n.nodeOverrides.find((t=>t.nodeId===e.id));if(null==r?void 0:r.nodeHidden)return!1;const o=t.find((t=>t.id===e.parentId));return!o||Ho(o,t,n)}function jo(e,t,n){return n?e.map((e=>{const r=t.find((t=>"model"===t.content&&t.contentId===e.id));if(!r)return{...e,nodeHidden:!1};const o=n.nodeOverrides.find((e=>e.nodeId===r.id));return o?o.overrideMaterial?{...e,materialId:o.materialId,nodeHidden:o.nodeHidden}:{...e,nodeHidden:o.nodeHidden}:{...e,nodeHidden:!1}})).filter((e=>!e.nodeHidden)):e}function Wo(e,t,n){return n?e.map((e=>{const r=t.find(();if(!r)return{...e,nodeHidden:!1};const o=n.nodeOverrides.find((e=>e.nodeId===r.id));return o?o.overrideMaterial?{...e,materialId:o.materialId,nodeHidden:o.nodeHidden}:{...e,nodeHidden:o.nodeHidden}:{...e,nodeHidden:!1}})).filter(():e}(t=>{function r(e,t){if(!t)return Go(Uo({},e),{fov:25});const n=t.geometries.map((e=>a.fromPositions(e.positions[0]))).filter((e=>!(isNaN(e.min.x)||isNaN(e.min.y)||isNaN(e.min.z)||isNaN(e.max.x)||isNaN(e.max.y)||isNaN(e.max.z)))),r=a.fromBoundingBoxes(n),o=c.fromBoundingBox(r),s=c.optimalZoomDistance(o,25,1),u=i.create(e.position.x,e.position.y,-s);return Go(Uo({},e),{fov:25,position:u})}t.create=function(t,o,a,c){var u;const l=new ko(e.create(0,0),{fov:22,near:.01,far:10,position:i.create(0,0,-1),orientation:n.identity()});let m,d=[Ro.create(),Ro.create()];const f=Ao.create(t,(,c);Po.attach(t,();const p=zo.attach(t,o.length),v=o.map(((e,t)=>({orientation:e,onDraw:e=>{return n=this,null,r=function*(){const n=yield e.toBlob(),r=URL.createObjectURL(n);p.updateGalleryImage(r,t)},new Promise(();var n,r}})));let g=r(l.camera,null==(u=d[0].composition)?void 0:u.composition);function x(){const e=s.createComponent(Qe.Component,{camera:l.camera,products:d,sceneRect:m,bookmarks:v,bookmarkSize:a,bookmarkCamera:g});f.render(e)}return x(),{switchToComposition:(e,t)=>{const n=void 0===t?0:t;0===n&&(g=r(l.camera,null==e?void 0:e.composition)),d=[...d],d[n].composition=e,x(),p.compositionChanged()},updateExternalNavigation:e=>{e.products.forEach(((e,t)=>{let{position:n,orientation:r}=e;d[t].position=n,d[t].orientation=r})),l.camera=e.camera,x()},dispose:()=>f.dispose(),playerCamera:l,canvas:f.canvas}}})(_o||(_o={}));const Xo=new WeakMap;var $o;($o||($o={})).getOrCreate=function(e,t){const n=Xo.get(e);if(n)return n;const r=t();return Xo.set(e,r),r};var qo,Yo,Zo,Qo,Ko=(e=>(e[e.Unknown=-1]="Unknown",e[e.None=0]="None",e[e.Model=1]="Model",e[e.Bone=2]="Bone",e[e.Light=3]="Light",e[e.Camera=4]="Camera",e[e.Decal=5]="Decal",e))(Ko||{});function Jo(e){return{x:e.X,y:e.Y,z:e.Z}}function ei(e){return{x:e.X,y:e.Y,z:e.Z,w:e.W}}function ti(e){return{name:e.Name,value:e.Value}}function ni(e,t){return Object.keys(e).reduce(((n,r)=>{const o=e[r];return void 0!==o&&(n[r]=t(o)),n}),{})}function ri(e){return o||(qo={})).getOrientation=function(e){switch(e){case"reset":case"front":return n.identity();case"back":return n.fromRotationY(Math.PI);case"left":return n.fromRotationY(.5*Math.PI);case"right":return n.fromRotationY(-.5*Math.PI);case"top":return n.fromRotationX(.5*Math.PI);case"bottom":return n.fromRotationX(-.5*Math.PI)}},(Yo||(Yo={})).create=(Zo||(Zo={})).create=function(t,r){const o=_o.create(r,t.galleryBookmarks.map(qo.getOrientation),e.create(2*t.galleryBookmarkWidth,2*t.galleryBookmarkHeight),Qo.create(t));return{Renderer:Yo.create(o.playerCamera,o.canvas),SwitchToComposition:(e,t,n)=>{const r=e?function(e,t){const n=e.Settings.map(ti),r=e.Textures.map((e=>$o.getOrCreate(e,(()=>{return t=e,{id:Symbol(),path:t.Path,width:t.Width,height:t.Height,quality:t.Quality,compressionType:t.CompressionType,bias:t.Bias,img:t.Image,type:"file"};var t})))),o=e.Materials.map((e=>function(e,t){return{id:Symbol(),name:e.Name,type:e.ID,maps:ni(e.Maps,ri(t)),colors:ni(e.Colors,ii),values:e.Values,booleans:e.Booleans,vector2s:ni(e.Vector2s,oi),vector3s:ni(e.Vector3s,Jo),vector4s:ni(e.Vector4s,ei)}}(e,r))),i=e.Geometries.map((e=>$o.getOrCreate(e,(()=>{return t=e,{id:Symbol(),uid:t.UID,positions:t.Positions,normals:t.Normals,textureCoordinates:t.TextureCoordinates,ambientOcclusions:t.AmbientOcclusions,indices:t.Indices};var t})))),a=e.Models.map((e=>function(e,t,n){var r,o;return{id:Symbol(),materialId:null==(r=n[e.MaterialIndex])?void 0:r.id,geometryId:null==(o=t[e.GeometryIndex])?void 0:o.id,doubleSided:e.DoubleSided,ambientOcclusionGroup:e.AmbientOcclusionGroup}}(e,i,o))),c=e.Decals.map((e=>function(e,t,n){var r,o;return{id:Symbol(),materialId:null==(r=n[e.MaterialIndex])?void 0:r.id,geometryId:null==(o=t[e.GeometryIndex])?void 0:o.id,doubleSided:e.DoubleSided}}(e,i,o))),s=function(e,t,n){const r=e.map(();return e.map(((e,o)=>function(e,t,n,r,o){var i,a;let c,s="none";switch(e.content){case Ko.Decal:c=null==(i=o[e.contentIndex])?void 0:i.id,s="decal";break;case Ko.Model:c=null==(a=r[e.contentIndex])?void 0:a.id,s="model"}return{id:t,content:s,contentId:c,parentId:n[e.parentIndex],position:Jo(e.position),name:e.Name,values:e.Values}}(e,r[o],r,t,n)))}(e.Nodes,a,c),u=e.OptionGroups.map((e=>{return t=e,{id:Symbol(),name:t.Name};var t})),l=e.MaterialGroups.map((e=>function(e,t){var n;return{id:Symbol(),name:e.Name,parentId:null==(n=t[e.ParentIndex])?void 0:n.id}}(e,o))),m=e.ModelGroups.map((e=>function(e,t){return{id:Symbol(),name:e.Name,models:e.Models.map(()}}(e,a))),d=e.Options.map((e=>function(e,t,n,r){var o;return{id:Symbol(),name:e.Name,nodeOverrides:e.NodeOverrides.map((e=>function(e,t,n){var r,o;return{id:Symbol(),nodeId:null==(r=t[e.NodeIndex])?void 0:r.id,overrideTransform:e.OverrideTransform,materialId:null==(o=n[e.MaterialIndex])?void 0:o.id,overrideMaterial:e.OverrideMaterial,nodeHidden:e.NodeHidden}}(e,n,r))),groupId:null==(o=t[e.GroupIndex])?void 0:o.id,uid:e.UID}}(e,u,s,o))),f=r.reduce(((e,t)=>(t.img&&(e[t.id]=[{type:"image",image:t.img},t.bias]),e)),{});return{composition:function(e,t){const n=e.options.find((e=>e.uid===t));return{...e,nodes:Vo(e.nodes,n),decals:Wo(e.decals,e.nodes,n),models:jo(e.models,e.nodes,n),options:[],optionGroups:[]}}({nodes:s,geometries:i,decals:c,models:a,materials:o,textures:r,options:d,settings:n,modelGroups:m,materialGroups:l,optionGroups:u},t),overwriteTextures:f}}(e,t):void 0;o.switchToComposition(r,n)},UpdateExternalNavigation:e=>{const t={camera:{near:(r=e).camera.near,far:r.camera.far,fov:r.camera.fov,position:Jo(r.camera.position),orientation:ei(r.camera.orientation)},products:r.products.map((e=>({position:Jo(e.position),orientation:n.rotateY(ei(e.orientation),-Math.PI)})))};var r;o.updateExternalNavigation(t)},Pause:()=>{},Resume:()=>{},Reset:()=>{},Dispose:()=>{o.dispose()},AddEventListener:()=>{}}},(Qo||(Qo={})).create=function(e){return{get:()=>e.navigationFocus}};const ai={CreatePlayer:(e,t)=>Zo.create(e,t)};window.BinkiesPlayer=ai})();