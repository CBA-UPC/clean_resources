!function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function a(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?l(e):t}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,a=s(e);if(t){var n=s(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return d(this,i)}}function c(e,t,i){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var a=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(a){var n=Object.getOwnPropertyDescriptor(a,t);return n.get?n.get.call(i):n.value}})(e,t,i||e)}function h(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return g(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var p,f,m=(n(p={},["instream"],1),n(p,["banner"],2),n(p,["article"],3),n(p,["feed"],4),n(p,["floating"],5),n(p,["interstitial"],5),n(p,["slider"],5),p),v=(n(f={},["instream"],1),n(f,["banner"],2),n(f,["article"],3),n(f,["feed"],4),n(f,["floating"],5),n(f,["interstitial"],5),n(f,["slider"],5),f),y=new RegExp(/^[^/]*:\/\/\/?([^\/]*)/);function k(e){var t=e.match(y);return t&&t.length>1?t[1]:""}var A=new RegExp(/^[^:\/?#]+:?\/\/[^\/?#]+/);var w=/^(https?:\/\/).*.(?:ampproject.org|bing-amp.com)\/(?:.\/)*(.*)\/amp.*$/;function P(e){var t=new RegExp("[?&]".concat(e,"=([^&]*)")),i=document.location.search.match(t);if(i)return decodeURIComponent(i[1])}function b(){if(P("isAMP")){var e=P("consentValue"),t=P("consentGdpr");if(consentString||t)return{gdprApplies:t,consentData:e}}}var E=null,_={gdprApplies:!0,consentData:""},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return null===E&&(E=new Promise((function(e){var t=window.__tcfapi||C("__tcfapi");if(t)return t("getTCData",2,(function(t,i){e(!1!==i?{gdprApplies:t.gdprApplies,consentData:t.tcString}:null)}));var i=window.__cmp||C("__cmp");if(i)return i("getConsentData",null,(function(t,i){e(!1!==i?{gdprApplies:t.gdprApplies||t.isUserInEu,consentData:t.consentData}:null)}));var a=b();return e(a||{gdprApplies:!1,consentData:""})})).then((function(e){return e&&(_=e),_}))),Promise.race([E,new Promise((function(t){setTimeout(t,e,_)}))])},C=function(e){var t=function(e){for(var t=window;t;){try{if(t.frames[e])break}catch(e){}t=t===window.top?null:t.parent}return t}("".concat(e,"Locator"));return null!==t&&function(i,a,r,s){var o=R();window.addEventListener("message",(function t(i){var a=i?i.data:{};if("string"==typeof a)try{a=JSON.parse(a)}catch(e){a={}}var n="".concat(e,"Return");a[n]&&a[n].callId===o&&(removeEventListener("message",t),r(a[n].returnValue,a[n].success))}),!1);var l=void 0!==s?"version":"parameter",d=n({},["".concat(e,"Call")],n({command:i,callId:o,parameter:s},[l],a));t.postMessage(JSON.stringify(d),"*")}},R=Date.now||function(){return(new Date).getTime()};function I(e){var t=e.advertising;if(t&&t.placement){var i=t.placement.toLowerCase();if(v[i])return v[i]}return v[t&&t.outstream?"article":"instream"]}function S(){var e,t,i=null!==document.referrer.match(A)?(e=document.referrer,(t=e.match(w))&&t.length>1?"".concat(t[1]).concat(t[2]):e):"";if(window.top!==window.self){try{return{url:window.top.location.href,domain:window.top.document.domain,referrer:i}}catch(e){}return{url:i,domain:k(i),referrer:""}}return{url:document.location.href,domain:document.domain,referrer:i}}function T(e,t){var i,a=e.getPlugin("inference"),n=t.jwpseg_client_side,r=t.jwpseg||[];if(!n||!n.length||!a)return r;try{i=a.predict(n,t)}catch(e){return t.jwpseg||[]}var s=Object.keys(i).filter((function(e){return i[e]})),o=r.filter((function(e){return-1===n.indexOf(e)}));return[].concat(h(s),h(o))}var L=/^((https?:)?\/\/)?(secure)?pubads\.g\.doubleclick\.net\/gampad\/ads\?[\S]*$/;function x(e,t,i,a,n){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(!e)return Promise.resolve(e);var s=O(t,i),o=S();-1!==e.indexOf("__jwpseg__")&&(r.jwpseg=s.jwpseg),e=j(e,"__random-number__",Math.random()*Math.pow(10,18)),e=j(e,"__timestamp__",(new Date).getTime()),e=j(e,"__page-url__",encodeURIComponent(s.pageUrl||o.url)),e=j(e,"__referrer__",encodeURIComponent(s.referrer||o.referrer)),e=j(e,"__player-height__",s.playerHeight),e=j(e,"__player-width__",s.playerWidth),e=j(e,"__item-duration__",s.itemDuration),e=j(e,"__jwpseg__",s.jwpseg),e=j(e,"__domain__",encodeURIComponent(s.domain||o.domain)),e=j(e,"__placement__",s.placement),e=j(e,"__device-ua__",encodeURIComponent(s.userAgent)),e=n.companion?j(e,"__companion-div__",n.companion.id):j(e,"__companion-div__","");for(var l=Object.keys(s).filter((function(e){return-1!==e.indexOf("item")})),d=l.map((function(e){var t=e.match(/item([\w]+?)(List)?$/);if(t)return t[1].toLowerCase()})),u=null,c=/__item-([\w-]+?)(-list)?__/g,h=e;null!==(u=c.exec(h));){var g=u[0],p=u[1],f=l[d.indexOf(p)],m="";if(i.hasOwnProperty(p)&&"string"==typeof i[p]||f){m=f?s[f]:i[p];var v=!1===n.truncateMacros?4096:1e3;m.length>v&&(m=m.substring(0,v));var y=u[2]?",":null;m=m.split(y).map(encodeURIComponent)}e=j(e,g,m)}if("vast"===a){var k=t.getConfig().autostart?1:0,A=t.getMute()?1:0;e=D(e,k,A)}if("googima"===a&&i.title&&-1===e.indexOf("vid_t=")){var w=i.title.substring(0,100).replace(/[^\x00-\x7F]/g,"");e+=B(e)+"vid_t="+encodeURIComponent(w)}return-1!==e.indexOf("__gdpr__")||-1!==e.indexOf("__gdpr_consent__")?M().then((function(t){var i=t.gdprApplies,a=t.consentData;return e=j(e,"__gdpr__",i?1:0),j(e,"__gdpr_consent__",a)})).catch((function(){return e})):Promise.resolve(e)}function j(e,t,i){return e.replace(t,i)}function B(e){return-1!==e.indexOf("?")?"&":"?"}function D(e,t,i){return L.test(e)&&(e="".concat(e,"&vpa=").concat(t,"&vpmute=").concat(i)),e}function O(e,t){var i,a,n,s=e.getConfig(),o=e.getPlaylistItem()===t;return r({playerHeight:e.getHeight()||s.height||"",playerWidth:e.getWidth()||s.width||"",itemDuration:o?(i=e.getDuration(),a=3,n=Math.pow(10,a),Math.round(i*n)/n||""):"",item:t,jwpseg:T(e,t),placement:I(s),userAgent:navigator.userAgent},s.advertising?s.advertising.ampMacros:{})}var q=function(){};function U(e,t,i){if(Q(e,"VMAP","vmap").length)return function(e,t,i){var a=[];X(Q(e,"VMAP","vmap")[0],"version")||H(a,"VMAP Schema Error: version missing from VMAP tag","-1");var n=Q(e,"AdBreak","vmap");n.length||z();for(var r=e.lookupNamespaceURI("vmap"),s=0;s<n.length;s++){var o={},l={},d=n[s],u=X(d,"timeOffset"),c=X(d,"breakId"),h=X(d,"breakType"),g=X(Q(d,"AdSource","vmap")[0],"id"),p=Q(d,"AdTagURI","vmap")[0],f=Q(d,"VASTData","vmap")[0]||Q(d,"VASTAdData","vmap")[0],m=X(p,"templateType"),v=F(p),y=G(r,d,"Tracking","vmap");if(h||H(a,"VMAP Schema Error: missing breakType on AdBreak",c),f||m||H(a,"VMAP Schema Error: missing templateType on AdBreak",c),u||H(a,"VMAP Schema Error: missing timeOffset on AdBreak",c),o._type=h,o._vmap={id:g,breakid:c,timeoffset:u},f)o._adXML=V(W(f,"VAST"));else{if("vast2"!==m&&"vast3"!==m&&"vast4"!==m)continue;o._adQueue=[v],o._waterfallIndex=0}var k=[];if(y)for(var A=0;A<y.length;A++){J(l,y[A]);var w=X(y[A],"event");k.push(w)}switch((k.indexOf("breakStart")<0||k.indexOf("breakEnd")<0||k.indexOf("error")<0)&&H(a,"Tracking events are missing breakStart, breakEnd, or error for AdBreak",c),o._trackers=l,o._type=h,u){case"start":o._offSet="pre",t.setPreRoll(o);break;case"100%":case"end":o._offSet="post",t.setPostRoll(o);break;default:if(/^#/.test(u))break;/^\d\d?(?:\.\d+)?%$/.test(u)?o._offSet=u:o._offSet=i.seconds(u),t.addMidRoll(o)}}t.preRoll||t.midRolls.length||t.postRoll||z();return t.sort(null,!0),a}(e,t,i);if(Q(e,"Playlist","vmap").length)return function(e,t,i){var a=Q(e,"Playlist","vmap")[0],n=a.getElementsByTagName("Preroll")[0],r=a.getElementsByTagName("Postroll")[0],s=N(n,"pre"),o=N(r,"post");s&&t.setPreRoll(s);o&&t.setPostRoll(o);for(var l=a.getElementsByTagName("Midroll"),d=0;d<l.length;d++){var u=l[d],c=i.seconds(u.getAttribute("timeOffset")),h=N(u,c);t.addMidRoll(h)}return[]}(e,t,i);throw new Error("No VMAP tag in response")}function V(e){return e.ownerDocument instanceof Document?e.outerHTML||(new XMLSerializer).serializeToString(e):null}function N(e,t){if(!e)return null;var i=e.getElementsByTagName("Ad");if(!i.length)return null;var a={_offSet:t};if(1===i.length)a._adQueue=[i[0].textContent.trim()];else{a._pod=[];for(var n=0;n<i.length;n++)a._pod.push(i[n].textContent.trim())}return a}function H(e,t,i){e.push({message:t,code:1002,adErrorCode:70001,id:i})}function z(){var e=new Error("No AdBreaks in VMAP");throw e.adErrorCode=60005,e}function Q(e,t,i){var a=[];return e&&(a=e.getElementsByTagName(t),i&&a&&0===a.length&&(a=e.getElementsByTagName("".concat(i,":").concat(t)))),a}function W(e,t){if(e){var i=e.getElementsByTagName(t);if(i)return i[0]}return null}function G(e,t,i,a){var n=[];return e||t?n=t.getElementsByTagNameNS?t.getElementsByTagNameNS(e,i):t.getElementsByTagName("".concat(a,":").concat(i)):n}function X(e,t){return e?e.getAttribute(t):null}function J(e,t){var i=X(t,"event");if("progress"===i){var a=X(t,"offset");i="".concat(i,"_").concat(a)}!function(e,t,i){e[t]||(e[t]=[]);i&&(e[t].push(i),$(i))}(e,i,F(t))}function F(e){if(e){var t=e.textContent||e.text;if(t)return t.trim()}return""}var $=function(e){(e.indexOf("[REGULATIONS]")>=0||e.indexOf("[GDPRCONSENT]")>=0)&&(M().catch(q),$=q)};function Y(e){e.onload=e.onreadystatechange=e.onerror=null,"abort"in e&&e.abort()}var K=function(){function e(i,a){t(this,e),this.adRules=i,this.utils=a,this.preRoll=null,this.vmap=null,this.postRoll=null,this.midRolls=[],this.playedMidRolls=[],this.duration=0,this._vmapPromise=null,this._vmapXHR=null}return a(e,[{key:"load",value:function(e,t,i,a){var n=this;if(this._vmapPromise)return this._vmapPromise;null!==this._vmapXHR&&(Y(this._vmapXHR),this._vmapXHR=null);var s=x(this.getVMAP(),e,t,i,a);return"googima"===i?(this._vmapPromise=s.then((function(e){n.setPreRoll({_adQueue:[e]})})),this._vmapPromise):(this._vmapPromise=s.then((function(t){return new Promise((function(i,r){n._vmapXHR=e.utils.ajax({url:t,withCredentials:a.withCredentials,retryWithoutCredentials:!0,requireValidXML:!0,timeout:n.requestTimeout},i,(function(e,t,i,a){return r(a)}))})).then((function(a){return n._vmapXHR=null,e.trigger("adLoadedXML",{client:i,tag:t,xml:a.responseXML}),U(a.responseXML,n,e.utils).map((function(e){return r(e,{vmap:t})}))})).catch((function(i){n._vmapXHR=null;var a={id:"-1",vmap:t};if(i.message)r(a,{message:"VMAP Schema Error: ".concat(i.message),code:1002,adErrorCode:i.adErrorCode||11002});else{var s={1:{code:1007,message:"Timeout"},602:{code:1e3,message:"Invalid XML"},default:{code:1008,message:e.getConfig().localization.errors[i.key]}},o=s[i.code]||s.default;e.utils.log(o.message),r(a,{message:"Error Loading VMAP Schedule",code:o.code,adErrorCode:o.code+1e4})}throw a}))})),this._vmapPromise)}},{key:"canWaterfall",value:function(e){return e._adQueue&&e._waterfallIndex+1<e._adQueue.length}},{key:"getPreRoll",value:function(e){return e&&"none"===this.adRules.startOnSeek?null:Z(this.preRoll,this.requestTimeout,this.creativeTimeout)}},{key:"getPostRoll",value:function(e){var t=Z(this.postRoll,this.requestTimeout,this.creativeTimeout);return this.adRules.timeBetweenAdsAllowsAdPlayback(t,e)?t:null}},{key:"getMidRollAtIndex",value:function(e){return Z(this.midRolls[e],this.requestTimeout,this.creativeTimeout)}},{key:"getLastMidRollIndexBetweenTime",value:function(e,t,i){if(e>t)return null;this.sort(i);for(var a=this.midRolls.length;a--;){var n=this.midRolls[a],r=ee(this.midRolls[a]._offSet,i);if(e>=r)return null;if(t>=r){var s=Z(n,this.requestTimeout,this.creativeTimeout);if(!this.adRules.timeBetweenAdsAllowsAdPlayback(s))return null;if(!this.adRules.timeBetweenAds){if(this.playedMidRolls.indexOf(a)>=0)return null;this.playedMidRolls.push(a)}return a}}return null}},{key:"peek",value:function(e,t,i){if(this.midRolls.length>this.playedMidRolls.length){this.sort(i);for(var a=0;this.midRolls[a];){var n=ee(this.midRolls[a]._offSet,i);if(n>=e&&-1===this.playedMidRolls.indexOf(a)){var r=R()+1e3*(n-e);return n<=t&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,r)?a:null}a+=1}}var s=R()+1e3*(i-e);return this.postRoll&&t>=i&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,s)?-1:null}},{key:"getNextMidrollIndex",value:function(e,t,i){if(this.adRules.timeBetweenAds||this.adRules.startOnSeek)return this.getLastMidRollIndexBetweenTime(e,t,i);if(this.midRolls.length>this.playedMidRolls.length){var a=this.getClosestIndex(t,i);if(a>=0&&this.playedMidRolls.indexOf(a)<0)return this.playedMidRolls.push(a),a}return null}},{key:"getMidRolls",value:function(){var e=this;return this.midRolls.map((function(t){return Z(t,e.requestTimeout,e.creativeTimeout)}))}},{key:"reset",value:function(){null!==this._vmapXHR&&(Y(this._vmapXHR),this._vmapXHR=null),this.playedMidRolls=[],this.duration=0}},{key:"setPreRoll",value:function(e){this.resetBreakId(e),this.preRoll=e}},{key:"addMidRoll",value:function(e){this.resetBreakId(e),this.midRolls.push(e),this.duration=0}},{key:"setPostRoll",value:function(e){this.resetBreakId(e),this.postRoll=e}},{key:"sort",value:function(e,t){(!e||e<1)&&(e=1),(this.duration!==e||t)&&(this.duration=e,this.midRolls.sort((function(t,i){return ee(t._offSet,e)-ee(i._offSet,e)})),function(e,t){for(var i=0;i<e.length;i++){var a=e[i];t?a._vmap.item=i+1:(a._adbreak={item:i+1,breakid:a._breakId},a._pod?a._adbreak.pod=a._pod:a._adbreak.tags=a._adQueue)}}(this.getAllAds(),t))}},{key:"getAllAds",value:function(){var e=this.preRoll?[this.preRoll]:[],t=this.postRoll?[this.postRoll]:[];return e.concat(this.midRolls,t)}},{key:"setVMAP",value:function(e){this.vmap=e}},{key:"isVMAP",value:function(){return!!this.vmap}},{key:"getVMAP",value:function(){return this.vmap}},{key:"getClosestIndex",value:function(e,t){this.sort(t);for(var i=this.midRolls.length;i--;)if(e>=ee(this.midRolls[i]._offSet,t))return i;return-1}},{key:"resetBreakId",value:function(e){e.adBreakId=this.utils.genId(12)}},{key:"resetAllBreakIds",value:function(){var e=this;this.getAllAds().forEach((function(t){e.resetBreakId(t)}))}},{key:"destroy",value:function(){this.reset(),this.adRules.destroy()}}]),e}();function Z(e,t,i){var a;if(null!==e)return Object.keys(e).forEach((function(t){var i=e[t];(a=a||{})[t]="_adQueue"===t||"_pod"===t?i.slice():i})),a?(a.requestTimeout=t,a.creativeTimeout=i,a._errors=[],a._waterfallIndex=0,a._adPodIndex=0,a):void 0}function ee(e,t){return"%"===e.toString().slice(-1)?t*parseFloat(e.slice(0,-1))/100:parseFloat(e)}var te=function(){function e(i){t(this,e),this.utils=i}return a(e,[{key:"getSchedule",value:function(e,t){var i=new K(t,this.utils);if(i.requestTimeout=ae(e.requestTimeout,5e3),i.creativeTimeout=ae(e.creativeTimeout,5e3),e.tag)i.setPreRoll({_offSet:"pre",_adQueue:ie(e.tag),_waterfallIndex:0});else if("string"==typeof e.vastxml)i.setPreRoll({_offSet:"pre",_adXML:e.vastxml});else{if("string"==typeof e.schedule)return i.setVMAP(e.schedule),i;if("string"==typeof e.adschedule)return i.setVMAP(e.adschedule),i;!function(e,t,i){var a=t.schedule||t.adschedule;if(!a)return;var n={};Object.keys(a).forEach((function(e){var t=a[e];t.ad&&(r(t,t.ad),delete t.ad);var s=function(e,t){if("start"===e||"0%"===e||!e&&0!==e)return"pre";if("end"===e||"100%"===e)return"post";if("pre"===e||"post"===e||(e+"").indexOf("%")>=0)return e;var i=t.seconds(e);if("number"==typeof i)return i;return!1}(t.offset,i),o=ae(t.requestTimeout,5e3),l=ae(t.creativeTimeout,5e3),d=n[s];if(d){if("nonlinear"===t.type)return;"nonlinear"===d._type&&(d=null)}var u=n[s]=d||{_offSet:s,_type:t.type,_breakId:e,adBreakId:i.genId(12),requestTimeout:o,creativeTimeout:l};!1===s&&i.log("Error: ad offset format not supported",s);var c=t.skipoffset;if(void 0!==c&&void 0===u.skipoffset&&(u.skipoffset=c),"string"==typeof t.adm)u.adm=t.adm;else if(t.pod){var h=u._pod||[];u._pod=h.concat(t.pod)}else if(t.tag){var g=function(e,t){if(!t)return e;var i=e.indexOf("?")>=0?"&":"?",a=e.indexOf("cust_params="),n="cust_params=".length,r="",s="";if(Object.keys(t).forEach((function(e){var i=t[e];r="".concat(r).concat(s).concat(e,"=").concat(i),s="&"})),r=encodeURIComponent(r),a>=0){var o=e.substr(0,a+n),l=e.substr(a+n);return"".concat(o).concat(r,"%26").concat(l)}return"".concat(e).concat(i).concat("cust_params=").concat(r)}(t.tag,t.custParams);u._adQueue&&(u._pod=[u._adQueue[0]],delete u._adQueue),u._pod?u._pod.push(ie(g)[0]):u._adQueue=ie(g)}else{if("string"!=typeof t.vastxml)return void i.log("Error: no ad tag provided");u._adXML=t.vastxml}})),Object.keys(n).forEach((function(i){var a=n[i];switch(a.skipoffset=void 0!==a.skipoffset?a.skipoffset:t.skipoffset,i){case"pre":e.setPreRoll(a);break;case"post":e.setPostRoll(a);break;default:e.addMidRoll(a)}}))}(i,e,this.utils)}return i.sort(),i}},{key:"getOptParams",value:function(e,t){var i={cuetext:t.cuetext,dynamicMessage:t.admessage,loadingAd:t.loadingAd,podMessage:t.podmessage,skipoffset:e.skipoffset,skipMessage:t.skipmessage,skipText:t.skiptext,omidAccessMode:e.omidAccessMode||"full",omidSupport:e.omidSupport||"auto",allowedOmidVendors:e.allowedOmidVendors||[],vpaidcontrols:e.vpaidcontrols||!1,conditionaladoptout:e.conditionaladoptout||!1,requestFilter:e.requestFilter,trackingFilter:e.trackingFilter,withCredentials:void 0===e.withCredentials||e.withCredentials},a=e.companiondiv;return a&&(i.companion={id:a.id,height:a.height,width:a.width}),i}},{key:"getAdRules",value:function(e){var t=e.rules||{},i=parseInt(t.frequency,10);return{startOn:t.startOn||1,frequency:isNaN(i)?1:i,timeBetweenAds:t.timeBetweenAds||0,startOnSeek:t.startOnSeek||null,deferAds:t.deferAds||null}}}]),e}();function ie(e){return Array.isArray(e)?e.slice(0):[e]}function ae(e,t){return 0===e?1/0:e||t}function ne(e,t,i){var a=re(e,t,i);return r(a,{message:"Ad Error: bidding plugin unavailable",code:900,adErrorCode:60008}),a}function re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={client:e.client},n=e.bidding,s=e.item,o=e.player;if(e.isDestroyed()||r(a,{placement:I(o.getConfig()),viewable:o.getViewable()}),i.jwpseg&&(a.jwpseg=i.jwpseg),t){var l=e.getAdIds(t,i),d=l.adBreakId,u=l.adPlayId;if(r(a,{adBreakId:d,adPlayId:u,offset:t._offSet}),n){var c=n.getBid(u);c&&r(a,c.getEventObject())}}return a.item=s,a}function se(e,t,i,a){return{client:a,message:e,adErrorCode:t,id:"-1",placement:I(i),tag:""}}var oe=function(){function e(i,a){t(this,e),this.player=i,this.options=a,this.client=a.client,this.ignoreStartOnSeek=!1,this.reset(),a.timeBetweenAds&&i.on({adBreakStart:this.handleAdBreakStart,adSkipped:this.handleAdSkipped,adComplete:this.handleAdComplete,adBreakEnd:this.handleAdBreakEnd,destroyPlugin:this.destroy},this)}return a(e,[{key:"timeBetweenAds",get:function(){return this.options.timeBetweenAds}},{key:"startOnSeek",get:function(){return this.ignoreStartOnSeek?null:this.options.startOnSeek}},{key:"shouldDeferAds",value:function(){return this.options.deferAds&&!this.player.getConfig().activeTab}},{key:"clearStartOnSeek",value:function(){this.ignoreStartOnSeek=!0}},{key:"sendAdBreakIgnored",value:function(e,t){e&&this.player.trigger("adBreakIgnored",function(e,t){var i={};return e&&(i={id:e._breakId,tag:e._adQueue&&e._adQueue.length>0?e._adQueue[0]:e._adXML,offset:e._offSet}),r(i,{timeSinceLastAd:t,type:"adBreakIgnored"})}(e,t,this.client))}},{key:"rulesAllowAdPlayback",value:function(e){var t=this.options,i=0===t.frequency&&1===e,a=e>=t.startOn&&(e-t.startOn)%t.frequency==0;return i||a}},{key:"handleAdBreakStart",value:function(){this.adSkipped=!1,this.adComplete=!1}},{key:"handleAdComplete",value:function(){this.adComplete=!0}},{key:"handleAdSkipped",value:function(){this.adSkipped=!0}},{key:"handleAdBreakEnd",value:function(){!this.adSkipped&&this.adComplete&&(this.recentCompletedAdTime=R())}},{key:"timeBetweenAdsAllowsAdPlayback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R();if(this.options.timeBetweenAds){var i=(t-this.recentCompletedAdTime)/1e3;if(i<this.options.timeBetweenAds)return this.sendAdBreakIgnored(e,i),!1}return!0}},{key:"reset",value:function(){this.ignoreStartOnSeek=!1,this.recentCompletedAdTime=0}},{key:"destroy",value:function(){this.player.off(null,null,this)}}]),e}(),le=function(){},de=function(){function e(i,a,n){t(this,e),this.player=i,this.pluginConfig=a,this.adClient=n;var r=this.configParser=new te(i.utils),s=this.adRules=new oe(i,r.getAdRules(a),n);this.emptySchedule=new K(s,i.utils)}return a(e,[{key:"getAdRules",value:function(){return this.adRules}},{key:"resetDefaultSchedule",value:function(e){var t=void 0===this.pluginConfig.withCredentials||this.pluginConfig.withCredentials,i=this.defaultSchedule=this.configParser.getSchedule(this.pluginConfig,this.adRules);i.isVMAP()&&i.load(this.player,e,this.adClient,{withCredentials:t}).catch(le)}},{key:"getSchedule",value:function(e,t){return t>0&&!this.adRules.rulesAllowAdPlayback(t)?this.emptySchedule:e&&e.adschedule?this.configParser.getSchedule(e,this.adRules):(this.resetDefaultSchedule(e),this.defaultSchedule)}},{key:"getOptParams",value:function(e,t){return this.configParser.getOptParams(e,t)}},{key:"reset",value:function(){this.adRules.reset()}},{key:"destroy",value:function(){this.emptySchedule&&this.emptySchedule.destroy(),this.defaultSchedule&&this.defaultSchedule.destroy()}}]),e}(),ue={adPosition:"",autoplayadsmuted:!1,companiondiv:null,companionResourceType:"",customUi:null,debug:!1,omidSupport:"disabled",omidAccessModeRules:{},enablePreloading:!1,loadVideoTimeout:15e3,locale:"",maxRedirects:-1,ppid:"",preloadAds:!1,requestTimeout:1e4,truncateMacros:!0,vastLoadTimeout:1e4,vpaidcontrols:!1,vpaidmode:"insecure"};function ce(e){if("true"===e)return!0;if("false"===e)return!1;var t=parseFloat(e);return isNaN(t)?e:t}var he=function(){function i(a,n){for(var r in t(this,i),this.config=a,this.utils=n,this.bidsResponse={},ue)if(ue.hasOwnProperty(r)){var s=a[r],o=ue[r],l=e(o);if(void 0!==s){if("boolean"!==l&&"number"!==l||(s=ce(s)),e(s)!==l)throw new Error("invalid parameter: "+r+" should be a "+l);this[r]=s}else this[r]=o}}return a(i,[{key:"setLocalizationOptions",value:function(e){var t=e.admessage,i=e.cuetext,a=e.podmessage,n=e.loadingAd,r=e.skipmessage,s=e.skiptext;this.admessage=t,this.cuetext=i,this.loadingAd=n,this.podmessage=a,this.skipmessage=r,this.skiptext=s}}]),i}(),ge=function(){function e(i,a,n){t(this,e),n.addClass(i,"jw-plugin-googima");var r=document.createElement("div");r.id=a+"_ad",r.className="jw-ads-view",this.visible=!1,this.utils=n,this.div=i,this.adDiv=r,i.appendChild(r)}return a(e,[{key:"resizeNonLinear",value:function(e){this.resize(!1,e)}},{key:"resizeLinear",value:function(){this.resize(!0)}},{key:"resize",value:function(e,t){var i=this.utils;i.toggleClass(this.div,"jw-ad-non-linear",!e),i.toggleClass(this.div,"jw-ad-linear",e),i.style(this.div,{height:t?t+"px":""})}},{key:"getAdDiv",value:function(){return this.adDiv}},{key:"adSetup",value:function(){this.visible=!0,this.utils.addClass(this.div,"jw-ad-instream"),this.resize(!0)}},{key:"adTakeDown",value:function(){this.visible=!1,this.utils.removeClass(this.div,"jw-ad-instream"),this.resize(!0)}}]),e}(),pe=null;function fe(e){if(pe)return pe;if(window.google&&google.ima&&google.ima.AdDisplayContainer)return pe=Promise.resolve();var t=["//","imasdk.googleapis.com/js/sdkloader/ima3.js"];"file:"===document.location.protocol&&t.unshift("https:");var i=new(0,e.scriptloader)(t.join(""));return pe=i.load()}var me=function(){function e(i,a,n){t(this,e),i.extend(this,a),this.vol=0,this.imaProxy=null,this.view=n}return a(e,[{key:"setProxy",value:function(e){this.imaProxy=e,"boolean"==typeof this.muted&&this.mute(this.muted)}},{key:"attachMedia",value:function(){}},{key:"detachMedia",value:function(){}},{key:"mute",value:function(e){this.muted=e,this.imaProxy&&(e?this.imaProxy.setVolume(0):this.vol&&this.imaProxy.setVolume(this.vol)),this.muteAllAdContainerVideo(e)}},{key:"muteAllAdContainerVideo",value:function(e){for(var t=this.view.getAdDiv().getElementsByTagName("video"),i=0;i<t.length;i++)t[i].muted=e}},{key:"volume",value:function(e){this.vol=e/100,this.imaProxy&&this.imaProxy.setVolume(this.vol)}}]),e}(),ve=function(){},ye=function(){function e(i,a,n,s,o){t(this,e),r(this,i.Events),this.client="shared",this.player=i,this.item=n,this.config=s,this.casting=o;var l=i.utils,d=new te(l);this.adRules=new oe(i,d.getAdRules(s)),"string"==typeof a?(this.schedule=new K(this.adRules,l),this.schedule.setPreRoll({tag:a})):(this.schedule=a,a.resetAllBreakIds()),this.vmapPromise=null,this.lastTimeEvent=null,this.prerollPromise=null,this.midrollPromise={},this.postrollPromise=null,this.next=null,this.nextPlaylistItemPromise=null,this.relatedNextUp=null,this.bidding=i.getPlugin("bidding"),this.bids=[],this.bidsPromises=[],this.bidsPromise=null,this._events=[]}return a(e,[{key:"attachListeners",value:function(){this.player.on({all:this.onAll,beforePlay:this.checkPreroll,relatedReady:this.relatedReady,cast:this.onCast,destroyBidding:this.destroyBids},this)}},{key:"onAll",value:function(e,t){"time"===e?this.checkMidrolls(t):"beforeComplete"===e&&this.checkPostrolls(t)}},{key:"relatedReady",value:function(){var e=this;if(this.config.preloadAds){var t=this.player.getPlugin("related");t&&t.on("nextUp",(function(t){t&&"discovery"===t.mode&&(e.relatedNextUp=t)}))}}},{key:"onCast",value:function(e){this.casting=!!e.active}},{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1?arguments[1]:void 0;if(this.schedule.isVMAP()&&(i.requestTimeout=this.schedule.requestTimeout,i.creativeTimeout=this.schedule.creativeTimeout,this.vmapPromise=this.schedule.load(this.player,this.item,this.client,i)),this.bidsPromise=this.vmapPromise||Promise.resolve(),this.bidsPromise=null!==t?this.bidsPromise.then((function(){if(!e.isDestroyed()){if(e.bidding)return e.createBidsPromise(t,i);var a=ne(e,null,i);e.player.trigger("adError",a)}})).catch(ve):this.bidsPromise.catch(ve),this.config.preloadAds)if(1===i.playlistItemEventCount){var a=this.player.getConfig().autostart;!1===a||"viewable"===a&&0===this.player.getViewable()?this.loadPreroll(i).catch((function(t){return e.isDestroyed()?null:e.enqueueAdEvent("adError",t,{preload:!0})})):this.player.once("autostartNotAllowed",(function(){e.loadPreroll(i).catch((function(t){return e.isDestroyed()?null:e.enqueueAdEvent("adError",t,{preload:!0})}))}))}else i.preloadPreroll&&this.loadPreroll(i).catch((function(t){return e.isDestroyed()?null:e.enqueueAdEvent("adError",t,{preload:!0})}));return this.bidsPromise}},{key:"createBidsPromise",value:function(e,t){var i=this,a=this.player,n=parseInt(e.bidOnBreaks,10);return n=n>0?n:1/0,this.bids=this.schedule.getAllAds().slice(0,n).map((function(n){var s=i.getAdIds(n).adPlayId,o=a.getConfig(),l=i.config.skipoffset,d=null!=l&&l>=0,u=T(a,i.item),c={id:s,offset:e.offset,jwpseg:u,placement:I(o),tag:n._adQueue?n._adQueue[0]:n._currentTag,adClient:i.client};"vast"===i.client&&(c.skipoffset=d?l:-1);var h=i.bidding.createNewBid(c,{getURLParts:S});i.player.trigger("adBidRequest",re(i,n,r({jwpseg:u},t))),h.init();var g=h.start().then((function(e){var a=e.result;if(!i.isDestroyed()){var r=Promise.resolve();return a&&!a.error&&(n.jwpseg=u,a.adm?(n._adXML=a.adm,n._adQueue&&n._adQueue.length&&n._adQueue.unshift(a.adm)):a.tag&&(r=x(a.tag,i.player,i.item,i.client,{},n).then((function(e){"vast"===i.client?(n._adQueue=n._adQueue||[],n._adQueue.unshift(e)):n._adQueue=[e]})))),i.player.trigger("adBidResponse",re(i,n,t)),r}}));return i.bidsPromises.push(g),h})),Promise.all(this.bidsPromises)}},{key:"checkPreroll",value:function(e){var t=this;if(this.bidTimeoutStarted||(this.bidTimeoutStarted=!0,this.bids.forEach((function(e){return e.timeout()}))),!(this.casting||this.preRollPlayed||this.adRules.shouldDeferAds())){this.preRollPlayed=!0;var i=(e||{}).startTime||this.player.getPosition();this.lastTimeEvent=i||this.lastTimeEvent;var a=this.schedule.getPreRoll(i);if(a||this.vmapPromise){(null!==this.vmapPromise||a&&"nonlinear"!==a._type)&&this.startBlocking(),this.bidsPromise.then((function(){if(!t.isDestroyed()){var e=t.schedule.getPreRoll(i);e&&"nonlinear"!==e._type&&t.triggerAdBreakEvents(e,"pre")}})),i?"none"===this.adRules.startOnSeek&&(this.prerollPromise=null):this.adRules.clearStartOnSeek();var n=e&&e.playReason?e.playReason:"external";this.playPreroll({adBlock:this.adBlockErrorDetected,startTime:i,reason:n})}}}},{key:"checkMidrolls",value:function(e){var t=this;if(!this.casting&&0!==e.duration&&!this.adRules.shouldDeferAds()){var i=this.schedule.getNextMidrollIndex(this.lastTimeEvent,e.position,e.duration);if(this.lastTimeEvent=e.position,null!==i){var a=this.schedule.getMidRollAtIndex(i);"nonlinear"!==a._type&&(this.startBlocking(),this.triggerAdBreakEvents(a,"mid")),this.playMidrollAtIndex(i,{adBlock:this.adBlockErrorDetected})}else if(!this.preRollPlayed&&this.schedule.getClosestIndex(e.position,e.duration)<0)this.checkPreroll(e);else if(this.config.preloadAds){var n=e.position+5,r=this.schedule.peek(e.position,n,e.duration);if(null!==r&&r>=0)this.loadMidrollAtIndex(r,{adBlock:this.adBlockErrorDetected,preload:!0}).catch(ve);else if(-1===r){var s=R()+1e3*(e.duration-e.position);this.loadPostroll({adBlock:this.adBlockErrorDetected,preload:!0,startTime:s}).catch(ve)}else if(null===this.next&&null===this.nextPlaylistItemPromise&&n>e.duration){var o=this.player.getPlaylistIndex()+1,l=this.player.getPlaylistItem(o);if(this.nextPlaylistRelated=!!this.relatedNextUp,l||this.relatedNextUp){var d=this.relatedNextUp?-1:o;this.nextPlaylistItemPromise=Promise.resolve(this.player.getPlaylistItemPromise(d)).then((function(){t.isDestroyed()||(t.trigger("preloadNext",{item:t.player.getPlaylistItem(o)||t.relatedNextUp,index:d}),t.relatedNextUp=null,t.nextPlaylistItemPromise=null)})).catch(ve)}}}}}},{key:"checkPostrolls",value:function(e){if(!(this.casting||this.adRules.shouldDeferAds()||this.isDestroyed())){var t=this.schedule.getPostRoll();t&&("nonlinear"!==t._type&&(this.startBlocking(),this.triggerAdBreakEvents(t,"post")),this.playPostroll(e))}}},{key:"getAdIds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.tagIndex,a=t.podIndex,n=e.adRequestIds&&void 0!==i?e.adRequestIds[i]:null;if(!n){var r=a||e._adPodIndex||0,s="p".concat(r,"w").concat(e._waterfallIndex||0);"p0w0"===s?n=e.adBreakId:(e.adPlayIds=e.adPlayIds||{},n=e.adPlayIds[s]=e.adPlayIds[s]||this.player.utils.genId(12))}return{adBreakId:e.adBreakId,adPlayId:n}}},{key:"loadPreroll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.prerollPromise||(this.prerollPromise=this.bidsPromise.then((function(){if(!e.isDestroyed()){var i=e.schedule.getPreRoll(t.startTime);return i?(i._position="pre",i._preload=!0,e.loadAd(i,t)):void 0}}))),this.prerollPromise}},{key:"loadMidrollAtIndex",value:function(e,t){var i=this;return this.midrollPromise[e]||(this.midrollPromise[e]=this.bidsPromise.then((function(){if(!i.isDestroyed()){var a=i.schedule.getMidRollAtIndex(e);return a?(a._position="mid",a._preload=!0,i.loadAd(a,t)):void 0}}))),this.midrollPromise[e]}},{key:"loadPostroll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.postrollPromise||(this.postrollPromise=this.bidsPromise.then((function(){if(!e.isDestroyed()){var i=e.schedule.getPostRoll(t.startTime);return i?(i._position="post",i._preload=!0,e.loadAd(i,t)):void 0}}))),this.postrollPromise}},{key:"playPreroll",value:function(e){var t=this;this.prerollPromise?this.playPreloadedPromise(this.prerollPromise,e):this.bidsPromise.then((function(){if(!t.isDestroyed()){var i=t.schedule.getPreRoll();i?(i._position="pre",t.startAdBreak(i,e)):t.stopBlocking()}}))}},{key:"playMidrollAtIndex",value:function(e){var t=this;this.midrollPromise[e]?this.playPreloadedPromise(this.midrollPromise[e]):this.bidsPromise.then((function(){var i=t.schedule.getMidRollAtIndex(e);i&&(i._position="mid",t.startAdBreak(i))}))}},{key:"playPostroll",value:function(e){var t=this;this.postrollPromise?this.playPreloadedPromise(this.postrollPromise):this.bidsPromise.then((function(){var i=t.schedule.getPostRoll();i&&(i._position="post",t.startAdBreak(i,e))}))}},{key:"isDestroyed",value:function(){return null===this.player}},{key:"destroy",value:function(){this.destroyBids(),this.player.off(null,null,this),this.player=null}},{key:"destroyBids",value:function(){this.bids.forEach((function(e){return e.stop()})),this.bidsPromises=[],this.bids=[]}},{key:"enqueueAdEvent",value:function(e,t,i){this._events.push({type:e,event:t}),i.preload||this.dequeueAdEvents()}},{key:"dequeueAdEvents",value:function(){}},{key:"triggerAdBreakEvents",value:function(){}},{key:"startBlocking",value:function(){}},{key:"stopBlocking",value:function(){}},{key:"loadAd",value:function(){}},{key:"playPreloadedPromise",value:function(){}},{key:"startAdBreak",value:function(){}}]),e}();function ke(e){var t=e.advertising;if(t&&t.placement){var i=t.placement.toLowerCase();if(m[i])return m[i]}return m[t&&t.outstream?"article":"instream"]}function Ae(e,t){var i=function(e,t){if("start"===e||"0%"===e)return"pre";if("end"===e||"100%"===e)return"post";if("string"==typeof e&&("pre"===e||"post"===e||e.indexOf("%")>=0))return e;var i=t.seconds(e);return"number"==typeof i&&!isNaN(i)&&i}(e,t);return"pre"===i?0:"post"===i?-1:i}function we(e,t){if(e&&e[t]&&"function"==typeof e[t])try{for(var i=arguments.length,a=new Array(i>2?i-2:0),n=2;n<i;n++)a[n-2]=arguments[n];return e[t].apply(e,a)}catch(e){return null}return null}function Pe(e,t,i,a,n){var s=be(e,i,a,n),o=t.getVastErrorCode?t.getVastErrorCode():t.code,l=t.getErrorCode?t.getErrorCode():t.adErrorCode;return l=l<1e4?l+2e4:l||60900,r(s,{message:"Ad Error: "+(t.getMessage?t.getMessage():t.message),code:o>=100&&o<=1008?o:900,adErrorCode:l}),e&&(20402===l?s.timeout=e.options.loadVideoTimeout:21009===l?s.timeout=e.options.vastLoadTimeout:60004===l&&(s.timeout=e.options.requestTimeout)),void 0!==t.placement&&(s.placement=t.placement),void 0!==t.id&&(s.id=t.id),t.getInnerError&&(s.sourceError=t.getInnerError()),void 0!==t.tag&&(s.tag=t.tag),s}function be(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n={client:"googima"};if(!e)return n;var s=e.bidding,o=e.config,l=e.player;r(n,{placement:ke(l.getConfig()),viewable:l.getViewable()}),a.jwpseg&&(n.jwpseg=a.jwpseg),o.preloadAds&&(n.preloadAds=a.preload||i&&i._preload||!1);var d=we(t,"getAdPodInfo");if(d){var u=we(d,"getTotalAds");if(u>1){var c=we(d,"getAdPosition");r(n,{sequence:c,podcount:u}),a.podIndex="number"==typeof c?c-1:0}if(void 0===n.adposition){var h=we(d,"getTimeOffset");n.adposition=0===h?"pre":-1===h?"post":"mid"}}if(i){var g=e.getAdIds(i,a),p=g.adBreakId,f=g.adPlayId;if(r(n,{tag:i._adQueue&&i._adQueue.length>0?i._adQueue[0]:i._adXML||i.adm,adBreakId:p,adPlayId:f,id:p,adposition:i._position}),i.jwpseg&&(n.jwpseg=i.jwpseg),s){var m=s.getBid(f);m&&r(n,m.getEventObject())}}var v=e.adsLoaderManager||a.loader;if(t){if(v){var y=n.mediationLayerAdServer;if("dfp"===y||"jwpdfp"===y){var k=(we(t,"getWrapperAdSystem")||[]).concat(we(t,"getAdSystem")||[]);-1!==k.indexOf("SpotXJW")&&n.bidders.forEach((function(e){e.winner="SpotX"===e.name}))}var A=v.userRequestContext;r(n,{tag:n.tag||v.getTag(t),ima:{ad:t,userRequestContext:A}})}r(n,{adtitle:t.getTitle(),adsystem:t.getAdSystem(),creativetype:t.getContentType(),duration:t.getDuration(),linear:t.isLinear()?"linear":"nonlinear",description:t.getDescription(),creativeAdId:t.getCreativeAdId(),adId:t.getAdId(),universalAdId:t.getUniversalAdIds().map((function(e){return{universalAdIdRegistry:e.g,universalAdIdValue:e.h}})),advertiser:t.getAdvertiserName(),dealId:t.getDealId()});var w=t.getMediaUrl();w&&(n.mediaFile={file:w})}return void 0!==a.offset&&r(n,{adposition:n.adposition||a.offset,offset:a.offset}),n}function Ee(e){return e.isBeforePlay()||0===e.getPosition()?"pre":e.isBeforeComplete()||e.getPosition()===e.getDuration()?"post":"mid"}var _e=function(){return null},Me=function(){function e(i,a){t(this,e);var n=i.player,r=i.options,s=i.instreamProvider,o=i.view,l=i.adsLoaderManager,d=i.video,u=i.item,c=i.client;if(n.utils.extend(this,n.Events),this.playlistItemManager=i,this.player=n,this.options=r,this.instreamProvider=s,this.view=o,this.adsLoaderManager=l,this.video=d,this.item=u,this.client=c,this.reason=a,this.env=n.getEnvironment(),this.utils=n.utils,this._qoe=new n.utils.Timer,r.customUi){var h=r.customUi;this.mainContainer=n.getContainer(),this.customUiDiv=document.getElementById(h.customUiDivId),this.adClickButton=document.getElementById(h.adClickButtonId),this.customCountDownDiv=document.getElementById(h.customCountDownId),this.customSkipButton=document.getElementById(h.customSkipButtonId),this.timeTillSkip=Number.POSITIVE_INFINITY}this.initAdsManagerPromise=null,this.blockingInstreamPlayer=null,this.currentAd=null,this.progressIntervalId=-1,this.viewablePlayedTime=0,this.lastPosition=null,this.adViewableImpressionHandler=_e,this.paused=!1,this.playbackProxy={currentTime:this.player.getPosition(),duration:this.player.getDuration()},n.on("time",this.time,this),this.debugConsoleLog=_e,r.debug&&(this.debugConsoleLog=function(){var e;(e=console).log.apply(e,arguments)})}return a(e,[{key:"time",value:function(e){this.playbackProxy.currentTime=e.position,e.duration>=e.position?this.playbackProxy.duration=e.duration:this.playbackProxy.duration=1/0}},{key:"init",value:function(e,t,i){var a=this;this.requestType=e,this.requestOptions=t,this.scheduledAd=i,this.offset=i._offset;var n=this.adsLoaderManager;return this.initAdsManagerPromise=this.initAdsManagerPromise||fe().then((function(){return a.destroyed()?null:(a.debugConsoleLog("[JW DEBUG] Open adsLoaderManager"),n.open(e,t,a.video))})).then((function(e){if(a.destroyed())return null;var i=n.getAdsManager(e,a.playbackProxy,a.options);if(a.instreamProvider.setProxy(i),n.bindEvents({AD_ERROR:a.adError.bind(a),LOADED:a.adLoaded.bind(a),CONTENT_PAUSE_REQUESTED:a.pauseRequested.bind(a),CONTENT_RESUME_REQUESTED:a.resumeRequested.bind(a),LOG:a.adLog.bind(a),STARTED:a.adStarted.bind(a),IMPRESSION:a.adImpression.bind(a),LINEAR_CHANGED:a.resize.bind(a),CLICK:a.adClick.bind(a),PAUSED:a.adPaused.bind(a),RESUMED:a.adResumed.bind(a),SKIPPED:a.adSkipped.bind(a),USER_CLOSE:a.adUserClose.bind(a),ALL_ADS_COMPLETED:a.allAdsCompleted.bind(a)},a),t.preloadAds)clearTimeout(a.timeoutAdStart);else{var r=a.player.getSafeRegion(!1),s=r.width,o=r.height,l=a.getViewMode();a.debugConsoleLog("[JW DEBUG] adsManager init with",s,o,l),n.init(s,o,l)}var d=i.getCuePoints();if(d.length){var u=d.filter((function(e){return e>0})).map((function(e){return{begin:e,text:a.options.cuetext,cueType:"ads"}}));a.player.addCues(u)}return i})).catch((function(e){if(clearTimeout(a.timeoutAdStart),a.asyncError&&!i._preload&&a.asyncError(e),e&&e.getError){var t=e.getError();throw a.getAdErrorEventObject(t,e)}throw e})),this.initAdsManagerPromise}},{key:"getViewMode",value:function(){var e=google.ima.ViewMode;return this.player.getFullscreen()?e.FULLSCREEN:e.NORMAL}},{key:"beforeComplete",value:function(){var e=this.adsLoaderManager.adsManager;e&&e.getCuePoints().indexOf(-1)>-1&&this.playlistItemManager.startBlocking(),this.adsLoaderManager.unbindEvents(["CONTENT_RESUME_REQUESTED"]),this.debugConsoleLog("[JW DEBUG] Call contentComplete on IMA SDK"),this.adsLoaderManager.contentComplete()}},{key:"requestAds",value:function(){var e=this;if(!this.destroyed()){this.debugConsoleLog("[JW DEBUG] Request ads to IMA SDK");var t=Promise.resolve();if(this.scheduledAd._adQueue&&this.scheduledAd._adQueue.length){var i=this.scheduledAd._adQueue.map((function(t,i){return x(t,e.player,e.item,e.client,e.options,e.scheduledAd).then((function(t){e.scheduledAd._adQueue[i]=t}))}));t=Promise.all(i)}return t.then((function(){e.startRequestTimeout(),e.trigger("adRequest",be(e.playlistItemManager,null,e.scheduledAd)),e.adsLoaderManager.requestAds(e.requestType,e.requestOptions,e.options,e.scheduledAd)}))}}},{key:"muteInstreamProvider",value:function(){var e=this.video.muted||this.player.getMute();this.debugConsoleLog("[JW DEBUG] Setting mute on instreamProvider",e),this.instreamProvider.mute(e)}},{key:"pauseRequested",value:function(e){var t=this.playlistItemManager.schedule.isVMAP();t&&this.playlistItemManager.startBlocking();var i=e&&e.getAd();if(t){var a=we(i,"getAdPodInfo"),n=we(a,"getTimeOffset");if(n){var r=-1===n?"post":"mid";this.scheduledAd._position=r,this.playlistItemManager.triggerAdBreakEvents(this.scheduledAd,r)}}var s=be(this.playlistItemManager,i,this.scheduledAd);this.trigger("adItem",s)}},{key:"resumeRequested",value:function(){this.debugConsoleLog("[JW DEBUG] ResumeRequest from IMA SDK"),this.currentAd&&this.currentAd.isLinear()&&this.finishAd(),this.blockingInstreamPlayer&&this.view.adTakeDown(),this.trigger("stopBlocking"),this.blockingInstreamPlayer=null}},{key:"finishAd",value:function(){this.currentAd&&(this.hideCustomUi(),clearInterval(this.progressIntervalId),this.viewablePlayedTime=0,this.currentAd=null)}},{key:"discardAdBreak",value:function(e){!e&&this.adsLoaderManager&&(e=this.adsLoaderManager.adsManager),!this.destroyed()&&e&&(0===e.getCuePoints().length?this.destroy():(e.discardAdBreak(),e.stop()))}},{key:"asyncDiscardAdBreak",value:function(){var e=this;this.initAdsManagerPromise&&this.initAdsManagerPromise.then((function(t){return e.discardAdBreak(t)})).catch(_e)}},{key:"pause",value:function(e){var t=e.reason;if(!this.destroyed()){var i=this.adsLoaderManager.adsManager;i&&(this.viewablePlayedTime=0,this.debugConsoleLog("[JW DEBUG] JW Player pause ad"),this.reason=t||"external",i.pause())}}},{key:"resume",value:function(e){var t=e.reason;if(!this.destroyed()){var i=this.adsLoaderManager.adsManager;i&&(this.debugConsoleLog("[JW DEBUG] JW Player resume ad"),this.reason=t||"external",i.resume())}}},{key:"startRequestTimeout",value:function(){var e=this;clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout((function(){e.debugConsoleLog("[JW DEBUG] Ad request timeout"),e.destroyed()||(e.asyncError=null,e.handleAdError({message:"Ad Request timeout after ".concat(e.options.requestTimeout," milliseconds"),getErrorCode:function(){return 60004}}),e.asyncDiscardAdBreak())}),this.options.requestTimeout)}},{key:"startAdsLoader",value:function(e){var t=this;if(this.destroyed()||!this.initAdsManagerPromise)return Promise.reject();this.player.off("beforePlay",null,this),e&&(this.blockingInstreamPlayer=e,e.setText(this.options.loadingAd)),this.muteInstreamProvider(),this._qoe.tick("adBeforePlay"),this.startRequestTimeout(),this.initAdsManagerPromise.then((function(){if(!t.destroyed()){var e=t.adsLoaderManager;if(!e.initialized){var i=t.player.getSafeRegion(!1),a=i.width,n=i.height,r=t.getViewMode();t.debugConsoleLog("[JW DEBUG] adsManager init with",a,n,r),e.init(a,n,r)}t.debugConsoleLog("[JW DEBUG] Start adsManager"),e.start()}})).catch(_e)}},{key:"resize",value:function(){var e=this.currentAd,t=this.adsLoaderManager.adsManager;if(t){var i=e&&!e.isLinear(),a=this.player.getSafeRegion(i);if(i){var n=e.getHeight();n=this.player.getFullscreen()?a.height/2:Math.max(100,n+10),this.debugConsoleLog("[JW DEBUG] Resize adsManager",a.width,n,this.getViewMode()),t.resize(a.width,n,this.getViewMode()),this.view.resizeNonLinear(n)}else this.debugConsoleLog("[JW DEBUG] Resize adsManager",a.width,a.height,this.getViewMode()),t.resize(a.width,a.height,this.getViewMode()),this.view.resizeLinear()}}},{key:"setState",value:function(e,t,i){if(e.isLinear()){var a=be(this.playlistItemManager,e,this.scheduledAd);if(a.newstate=t,i&&(a.oldstate=i),null!==this.reason)a["playing"===t?"playReason":"pauseReason"]=this.reason,this.reason=null;this.instreamProvider.trigger("state",a)}}},{key:"customMainClickHandler",value:function(){this.adsLoaderManager.adsManager.resume()}},{key:"customSkipHandler",value:function(e){(e.stopPropagation(),this.timeTillSkip<=0)&&this.adsLoaderManager.adsManager.skip()}},{key:"customClickHandler",value:function(e){e.stopPropagation(),this.adsLoaderManager.adsManager.clicked()}},{key:"addCustomEventHandlers",value:function(){this.mainClick=this.customMainClickHandler.bind(this),this.customSkip=this.customSkipHandler.bind(this),this.customClick=this.customClickHandler.bind(this),this.mainContainer.addEventListener("click",this.mainClick),this.adClickButton&&this.adClickButton.addEventListener("click",this.customClick),this.customSkipButton&&this.customSkipButton.addEventListener("click",this.customSkip)}},{key:"removeCustomEventHandlers",value:function(){this.mainContainer.removeEventListener("click",this.mainClick),this.adClickButton&&this.adClickButton.removeEventListener("click",this.customClick),this.customSkipButton&&this.customSkipButton.removeEventListener("click",this.customSkip)}},{key:"showCustomUi",value:function(){this.customUiDiv&&(this.customUiDiv.style.display="block",this.addCustomEventHandlers())}},{key:"hideCustomUi",value:function(){this.customUiDiv&&(this.customUiDiv.style.display="none",this.removeCustomEventHandlers())}},{key:"adLoaded",value:function(e){clearTimeout(this.timeoutAdStart);var t=e.getAd();if(this.playlistItemManager.schedule.isVMAP()){var i=we(t,"getAdPodInfo"),a=we(i,"getTimeOffset");a&&(this.scheduledAd._position=-1===a?"post":"mid")}var n=be(this.playlistItemManager,t,this.scheduledAd);this.trigger("adLoaded",n)}},{key:"adStarted",value:function(e){this.player.getPip()&&this.player.requestPip(this.view.getAdDiv().querySelector("video"));var t=e.getAd();this.currentAd=t,this.paused=!1,t.isUiDisabled()&&this.showCustomUi();var i=be(this.playlistItemManager,t,this.scheduledAd);this.trigger("adStarted",i)}},{key:"adImpression",value:function(e){var t=this;this.view.adSetup();var i=e.getAd(),a=i.isLinear(),n=a&&(i.getContentType().indexOf("image")>=0||-1===i.getDuration()),r=this.isVpaidAd(i),s=a&&r&&this.options.vpaidcontrols;this.currentAd=i,this.blockingInstreamPlayer&&this.blockingInstreamPlayer.setSkipOffset(i.getSkipTimeOffset()),this.adsLoaderManager.bindEvents({COMPLETE:this.adComplete.bind(this)}),r&&this.env.OS.mobile&&this.options.autoplayadsmuted&&this.adsLoaderManager.bindEvents({VOLUME_CHANGED:function(){t.adsLoaderManager.unbindEvents(["VOLUME_CHANGED"]),t.player.setMute(0===t.adsLoaderManager.adsManager.getVolume())}}),a||this.trigger("stopBlocking",{isNonlinear:!0}),this.utils.toggleClass(this.player.getContainer(),"jw-flag-ads-vpaid",a&&(n||r)),this.utils.toggleClass(this.player.getContainer(),"jw-flag-ads-vpaid-controls",s),this.resize(),this.muteInstreamProvider(),clearTimeout(this.timeoutAdStart);var o=this.adsLoaderManager.adsManager;this.progressInterval(i,o);var l=be(this.playlistItemManager,i,this.scheduledAd),d=void 0===l.podcount||1===l.sequence;"pre"===l.adposition&&d&&(this._qoe.tick("adImpression"),l.timeLoading=this._qoe.between("adBeforePlay","adImpression")),a&&!d&&this.trigger("adItem",l),this.trigger("adImpression",l,i),this.setupViewableListener(),this.setState(i,"playing","buffering")}},{key:"progressInterval",value:function(e,t){var i=this;if(clearInterval(this.progressIntervalId),t){var a=e.getAdId(),n=e.isSkippable()&&this.customSkipButton,r=-1,s=this.options.admessage||"",o=this.options.podmessage||"",l=this.options.skipmessage||"",d=this.options.skiptext||"",u=new RegExp("__AD_POD_CURRENT__","g"),c=new RegExp("__AD_POD_LENGTH__","g");this.progressIntervalId=setInterval((function(){if(i.currentAd&&i.currentAd.getAdId()===a){var h=t.getRemainingTime();if(!(isNaN(h)||h<=0)&&r!==h){r=h;var g=i.currentAd.getDuration(),p=g-h,f=Math.round(g-p);if(n){var m=i.timeTillSkip=Math.ceil(e.getSkipTimeOffset()-p);m>0?(i.customSkipButton.innerText=l.replace(/(\b)xx(s?\b)/g,"$1".concat(m,"$2")),i.customSkipButton.style.cursor="default"):(i.customSkipButton.innerText=d,i.customSkipButton.style.cursor="pointer")}if(i.blockingInstreamPlayer){var v=s.replace(/(\b)xx(s?\b)/g,"$1".concat(f,"$2")),y=we(i.currentAd,"getAdPodInfo");if(y){var k=we(y,"getTotalAds");if(k>1){var A=we(y,"getAdPosition");v=o.replace(u,A).replace(c,k)+"  "+v}}i.blockingInstreamPlayer.setText(v),i.customCountDownDiv&&(i.customCountDownDiv.innerText=v),i.instreamProvider.trigger("time",{duration:g,position:p})}if(g>0){var w=be(i.playlistItemManager,e,i.scheduledAd);w.position=p,w.duration=g,i.adViewableImpressionHandler(w),i.trigger("adTime",w)}}}else clearInterval(i.progressIntervalId)}),250)}}},{key:"setupViewableListener",value:function(){this.player.off("viewable",this.viewableHandler,this),this.player.on("viewable",this.viewableHandler,this),this.viewableHandler({viewable:this.player.getViewable()})}},{key:"adViewableHandler",value:function(e){var t=e.position;null===this.lastPosition&&(this.lastPosition=t);var i=t-this.lastPosition;if(this.lastPosition=t,i=Math.min(Math.max(0,i),4),this.viewablePlayedTime+=i,this.viewablePlayedTime>=2){this.player.off("viewable",this.viewableHandler,this),this.adViewableImpressionHandler=_e;var a=be(this.playlistItemManager,this.currentAd,this.scheduledAd);this.trigger("adViewableImpression",a)}}},{key:"viewableHandler",value:function(e){e.viewable?(this.viewablePlayedTime=0,this.lastPosition=null,this.adViewableImpressionHandler=this.adViewableHandler):this.adViewableImpressionHandler=_e}},{key:"adComplete",value:function(e){var t=e.getAd();this.finishAd();var i=be(this.playlistItemManager,t,this.scheduledAd);this.trigger("adComplete",i),this.adsLoaderManager.unbindEvents(["VOLUME_CHANGED"])}},{key:"adClick",value:function(e){var t=this.adsLoaderManager.adsManager,i=e.getAd();this.reason="clickthrough",this.isVpaidAd(i)||(this.debugConsoleLog("[JW DEBUG] Ad paused due to ad click"),t.pause());var a=be(this.playlistItemManager,i,this.scheduledAd);this.trigger("adClick",a)}},{key:"adPaused",value:function(e){if(!this.paused){this.paused=!0;var t=e.getAd();null===this.reason&&this.isVpaidAd(t)&&(this.reason="external"),this.setState(t,"paused")}}},{key:"adResumed",value:function(e){if(this.paused){this.paused=!1;var t=e.getAd();null===this.reason&&this.isVpaidAd(t)&&(this.reason="external"),this.setState(t,"playing")}}},{key:"adSkipped",value:function(e){var t=e.getAd();this.debugConsoleLog("[JW DEBUG] AdSkipped"),this.adsLoaderManager.unbindEvents(["COMPLETE","VOLUME_CHANGED"]),this.finishAd();var i=be(this.playlistItemManager,t,this.scheduledAd);this.trigger("adSkipped",i)}},{key:"adUserClose",value:function(e){this.debugConsoleLog("[JW DEBUG] AdUserClose"),this.currentAd&&this.currentAd.isLinear()&&-1===this.currentAd.getDuration()?this.adSkipped(e):(this.adsLoaderManager.unbindEvents(["COMPLETE","VOLUME_CHANGED"]),this.finishAd())}},{key:"allAdsCompleted",value:function(){this.resumeRequested(),this.stopAdsManager(),this.trigger("allAdsComplete",{})}},{key:"stopAdsManager",value:function(){var e=this;this.initAdsManagerPromise.then((function(t){e.destroyed()||(e.debugConsoleLog("[JW DEBUG] Stop IMA SDK adsManager"),t.stop(),t.destroy(),e.initAdsManagerPromise=null)})).catch(_e)}},{key:"adLog",value:function(e){this.debugConsoleLog("[JW DEBUG]",e.type,e);var t=we(e,"getAdData"),i=t&&t.adError;if(i&&402===i.getVastErrorCode())this.handleAdError(i,e);else if(i){var a=we(e,"getAd");this.trigger("adError",Pe(this.playlistItemManager,i,a,this.scheduledAd,{jwpseg:this.adsLoaderManager.getJwpSeg(a)}))}}},{key:"adError",value:function(e){var t=e.getError();this.handleAdError(t,e)}},{key:"asyncError",value:function(e){var t=this;if(!this.destroyed())if(clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout((function(){return t.destroy()}),0),e&&e.getError){var i=e.getError();this.handleAdError(i,e,!0)}else e.target&&e.target.src?console.error("Failed to load "+e.target.src):console.error(e)}},{key:"getAdErrorEventObject",value:function(e,t){var i=we(t,"getUserRequestContext"),a=i?i.offset:void 0;return Pe(this.playlistItemManager,e,null,this.scheduledAd,{offset:a})}},{key:"handleAdError",value:function(e,t,i){var a=this;this.options.debug&&console.error(e);var n=this.getAdErrorEventObject(e,t);this.player&&0===this.player.getPosition()&&(this._qoe.tick("adError"),n.timeLoading=this._qoe.between("adBeforePlay","adError")),this.trigger("adError",n),this.destroyed()||(900===e.getErrorCode()||i?(clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout((function(){return a.destroy()}),0)):this.destroy())}},{key:"isVpaidAd",value:function(e){var t=e.getContentType();return"application/javascript"===t||"application/x-shockwave-flash"===t}},{key:"destroy",value:function(){this.debugConsoleLog("[JW DEBUG] JW Player destroy AdsPlayer"),this.trigger("stopBlocking",{isDestroyed:!0}),this.off(),this.destroyed()||(this.player.off(null,null,this),clearTimeout(this.timeoutAdStart),clearInterval(this.progressIntervalId),this.currentAd=null,this.options=null,this.adsLoaderManager.reset(null,!0),this.view.adTakeDown(),this.video=null,this.initAdsManagerPromise=null,this.instreamProvider.off(),this.instreamProvider.setProxy(null),this.instreamProvider=null,this.view=null,this.player=null)}},{key:"destroyed",value:function(){return!this.player}}]),e}(),Ce=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,e);var i=u(n);function n(e,a,r,s,o,d,u,c,h,g){var p;return t(this,n),p=i.call(this,e,a,r,s,g),e.utils.extend(l(p),e.Events),p.client="googima",p.config=s,p.options=o,p.player=e,p.env=e.getEnvironment(),p.utils=e.utils,p.adsLoaderManager=c,p.view=u,p.qoe=new e.utils.Timer,p.instreamProvider=d,p.vmapPromise=Promise.resolve(),p.fullscreenIcon=e.getContainer().querySelector(".jw-icon-fullscreen"),p.video=h,p.hasPreroll=!0,p.reason=null,p}return a(n,[{key:"checkPreroll",value:function(e){this.adsLoaderManager.initializeDisplay({restrict:!0}),this.reason=e&&e.playReason?e.playReason:"external",c(s(n.prototype),"checkPreroll",this).call(this,e)}},{key:"checkPostrolls",value:function(e){this.schedule.isVMAP()&&this.adsPlayer?this.adsPlayer.beforeComplete():c(s(n.prototype),"checkPostrolls",this).call(this,e)}},{key:"createAdsPlayer",value:function(e){var t=this;this.adsPlayer&&!this.adsPlayer.destroyed()||(this.adsPlayer=new Me(this,this.reason),this.adsPlayer.on("all",(function(i,a){return"allAdsComplete"===i?(t.adsPlayer.destroy(),void(t.adsPlayer=null)):"stopBlocking"===i?(t.stopBlocking(a&&a.isNonlinear),void(!e&&a&&a.isDestroyed&&(t.adsPlayer=null))):void("adError"!==i?(t.dequeueAdEvents(),t.trigger(i,a)):t.enqueueAdEvent(i,a,{preload:e}))})))}},{key:"initAdsPlayer",value:function(e,t,i){var a=this;return"TYPE_API"===e&&(this.reason="external"),this.createAdsPlayer(i._preload),this.player.on("resize",(function(){return a.adsPlayer.resize()}),this.adsPlayer).on("fullscreen",(function(){return a.adsPlayer.resize()}),this.adsPlayer),this.adsPlayer.init(e,t,i).then((function(e){a.trigger("adsManager",{adsManager:e,videoElement:a.video})}))}},{key:"adLoadRequest",value:function(e,t){var i=this,a=this.utils.extend({},this.config);a.ad=e,this.offset=e.offset||this.offset,a.adPosition=Ee(this.player);var n=new he(a,this.utils),r=t?"TYPE_SCHEDULE":"TYPE_API",s=this.initAdsPlayer(r,n,e);return fe().then((function(){return i.adsPlayer.requestAds(),s}))}},{key:"dequeueAdEvents",value:function(){var e=this;this._events.forEach((function(t){var i=t.type,a=t.event;e.trigger(i,a)})),this._events.splice(0)}},{key:"triggerAdBreakEvents",value:function(e,t){var i=this;e._position=e._position||t,this.blockingInstreamPlayer.once("destroyed",(function(){i.dequeueAdEvents(),i.trigger("adBreakEnd",be(i,null,e))}));var a=be(this,null,e);this.trigger("adBreakStart",a),this.dequeueAdEvents(),this.adsPlayer&&this.adsPlayer.destroyed()&&this.stopBlocking()}},{key:"exitFullscreenOnInlineIOS",value:function(){if(this.env.OS.iOS&&!(this.env.Browser.version.major<10)){var e=this.player.getContainer();e.requestFullscreen||e.webkitRequestFullscreen||(this.player.setFullscreen(!1),this.utils.style(this.fullscreenIcon,{display:"none"}))}}},{key:"startBlocking",value:function(e){if(!this.blockingInstreamPlayer&&!this.destroyed()){this.exitFullscreenOnInlineIOS(),this.qoe.tick("adLoading"),this.utils.addClass(this.player.getContainer(),"jw-flag-ads-googleima"),this.blockingInstreamPlayer=this.player.createInstream().init();var t=e?"":this.options.loadingAd;this.blockingInstreamPlayer.setText(t),this.blockingInstreamPlayer.applyProviderListeners(this.instreamProvider),this.adsPlayer&&!this.adsPlayer.destroyed()&&(this.adsPlayer.blockingInstreamPlayer=this.blockingInstreamPlayer),this.view.adSetup()}}},{key:"stopBlocking",value:function(e){this.destroyed()||(this.player.off("viewable",null,this),this.utils.style(this.fullscreenIcon,{display:""}),this.utils.removeClass(this.player.getContainer(),["jw-flag-ads-vpaid","jw-flag-ads-vpaid-controls","jw-flag-ads-googleima"]),this.blockingInstreamPlayer&&(this.instreamProvider.off(),this.blockingInstreamPlayer.destroy(),this.blockingInstreamPlayer=null),e||this.view.adTakeDown())}},{key:"loadAd",value:function(e,t){if(e)return this.adsPlayer&&this.adsPlayer.scheduledAd!==e&&this.adsPlayer.destroy(),e._preload=!0,this.adLoadRequest(e,t)}},{key:"playPreloadedPromise",value:function(e){var t=this;e.then((function(){return t.adsPlayer.startAdsLoader(t.blockingInstreamPlayer)})).catch((function(){t.stopBlocking()}))}},{key:"startAdBreak",value:function(e,t){var i=this;e&&(this.adsPlayer&&this.adsPlayer.scheduledAd!==e&&this.adsPlayer.destroy(),this.startBlocking(),this.dequeueAdEvents(),this.adLoadRequest(e,t).then((function(){i.adsPlayer.startAdsLoader(i.blockingInstreamPlayer)})).catch((function(){i.stopBlocking()})))}},{key:"destroy",value:function(){this.stopBlocking();var e=this.adsLoaderManager;e&&(e.reset(),this.adsLoaderManager=null),this.adsPlayer&&this.adsPlayer.destroy(),this.adsPlayer=null,c(s(n.prototype),"destroy",this).call(this)}},{key:"destroyed",value:function(){return null===this.adsLoaderManager}}]),n}(ye),Re=function(){function e(i,a){t(this,e),this.adsLoader=null,this.adDisplayContainer=null,this.displayInitialized=!1,this.initialized=!1,this.started=!1,this.adsRequest=null,this.userRequestContext=null,this.adsManager=null,this.adsLoaderEvents={},this.adsManagerEvents={},this.container=a,this.schedule=null,this.breakMap={},this.player=i,this.environment=i.getEnvironment()}return a(e,[{key:"getVpaidMode",value:function(e){var t=google.ima.ImaSdkSettings.VpaidMode;return"disabled"===e||"none"===e?t.DISABLED:"enabled"===e?t.ENABLED:t.INSECURE}},{key:"initializeDisplay",value:function(e){this.adDisplayContainer&&!this.displayInitialized&&(this.adDisplayContainer.initialize(),e&&e.restrict&&(this.displayInitialized=!0))}},{key:"contentComplete",value:function(){this.adsLoader&&this.adsLoader.contentComplete()}},{key:"reset",value:function(e,t){var i=this;if(t){this.adsRequest=null,this.userRequestContext=null;var a=this.adsManager;a&&(a.destroy(),this.adsManager=null),this.adsManagerEvents={},Object.keys(this.adsLoaderEvents).forEach((function(e){i.adsLoader.removeEventListener(e,i.adsLoaderEvents[e])})),this.adsLoaderEvents={}}else this.contentComplete();e&&(this.schedule=null,this.breakMap={}),this.initialized=this.started=!1}},{key:"prepare",value:function(e,t){var i=google.ima.settings;i.setDisableCustomPlaybackForIOS10Plus(!0);var a=t.locale||this.player.getConfig().language;i.setLocale(a);var n=t.ppid;return n&&i.setPpid(n),"enabled"===t.omidSupport&&i.setFeatureFlags({enableOmidBeta:!0}),t.maxRedirects>=0&&i.setNumRedirects(t.maxRedirects),null===this.adsLoader&&(this.adDisplayContainer=new google.ima.AdDisplayContainer(this.container,e),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer)),this.adsLoader}},{key:"open",value:function(e,t,i){var a=this,n=this.prepare(i,t);return new Promise((function(e,t){n.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,t,!1),n.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,e,!1),a.adsLoaderEvents[google.ima.AdErrorEvent.Type.AD_ERROR]=t,a.adsLoaderEvents[google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED]=e}))}},{key:"requestAds",value:function(e,t,i,a){if(null===this.adsRequest&&a){var n=this.player,r=this.adsRequest=new google.ima.AdsRequest,s=this.userRequestContext={requestType:e,vpaidMode:t.vpaidmode,playerVersion:n.version.split("+")[0],adPosition:t.adPosition};r.setAdWillAutoPlay(!1!==n.getConfig().autostart),r.setAdWillPlayMuted(n.getMute());var o=n.getSafeRegion(!1);r.linearAdSlotWidth=o.width,r.linearAdSlotHeight=o.height;var l=n.getSafeRegion(!0);r.nonLinearAdSlotWidth=l.width,r.nonLinearAdSlotHeight=l.height,r.forceNonLinearFullSlot=i.forceNonLinearFullSlot,r.vastLoadTimeout=i.vastLoadTimeout,"enabled"===t.omidSupport&&(r.omidAccessModeRules=t.omidAccessModeRules);var d,u,c,h,g=this.adsLoader.getSettings(),p=this.getVpaidMode(s.vpaidMode);if(g.setPlayerType("jwplayer"),g.setPlayerVersion(s.playerVersion),g.setVpaidMode(p),a._pod)r.adsResponse=s.adsResponse=(d=a._pod,u=a._offSet,c=document.implementation.createDocument("http://www.iab.net/videosuite/vmap","vmap:VMAP",null),(h=c.documentElement).setAttribute("version","1.0"),d.forEach((function(e){var t=c.createElement("vmap:AdTagURI");t.appendChild(c.createCDATASection(e));var i=h.appendChild(c.createElement("vmap:AdBreak")),a=(u+"").replace("pre","start").replace("post","end");i.setAttribute("timeOffset",a);var n=i.appendChild(c.createElement("vmap:AdSource"));n.setAttribute("allowMultipleAds","true"),n.setAttribute("followRedirects","true"),n.appendChild(t)})),h.outerHTML||(new XMLSerializer).serializeToString(h));else if(a.adm||a._adXML)r.adsResponse=s.adsResponse=a.adm||a._adXML;else if(a.tag||a._adQueue&&1===a._adQueue.length){var f=a.tag||a._adQueue[0];r.adTagUrl=s.adTagUrl=f.trim()}else{var m=a._adQueue&&a._adQueue.length?function(e){var t=document.implementation.createDocument("http://www.w3.org/2001/XMLSchema-instance","VAST",null),i=t.documentElement;return i.setAttribute("version","2.0"),e.forEach((function(e,a){var n=t.createElement("Ad");n.setAttribute("id",a);var r=t.createElement("Wrapper"),s=t.createElement("Extensions"),o=t.createElement("Extension");o.setAttribute("type","waterfall"),o.setAttribute("fallback_index",a);var l=t.createElement("VASTAdTagURI");l.appendChild(t.createCDATASection(e)),n.appendChild(r),r.appendChild(l),r.appendChild(s),s.appendChild(o),i.appendChild(n)})),i.outerHTML||(new XMLSerializer).serializeToString(i)}(a._adQueue):a.xml;r.adsResponse=s.adsResponse=m}this.adsLoader.requestAds(r,s)}}},{key:"getAdsManager",value:function(e,t,i){var a=new google.ima.AdsRenderingSettings;a.enablePreloading=i.enablePreloading||i.preloadAds,a.loadVideoTimeout=i.loadVideoTimeout,a.uiElements=null,a.useStyledNonLinearAds=!0,this.environment.OS.android&&this.environment.Browser.chrome&&this.environment.Browser.version.major>=84&&(a.mimeTypes=["video/mp4","video/webm"]);var n=this.player.getConfig().bandwidthEstimate;(a.bitrate=n?n/1e3:-1,i.customUi)&&(i.customUi.disableUi&&(a.disableUi=!0));return this.adsManager=e.getAdsManager(t,a),this.userRequestContext=e.getUserRequestContext(),this.adsManager}},{key:"init",value:function(e,t,i){null!==this.adsManager&&!1===this.initialized&&(this.adsManager.init(e,t,i),this.initialized=!0)}},{key:"start",value:function(){null!==this.adsManager&&!1===this.started&&(this.initializeDisplay({restrict:!0}),this.adsManager.start(),this.started=!0)}},{key:"bindEvents",value:function(e){var t=this,i=google.ima.AdEvent.Type,a=google.ima.AdErrorEvent.Type;Object.keys(e).forEach((function(n){var r=i[n]||a[n],s=t.adsManagerEvents[r];s&&t.adsManager.removeEventListener(r,s),t.adsManager.addEventListener(r,e[n],!1),t.adsManagerEvents[r]=e[n]}))}},{key:"unbindEvents",value:function(e){var t=this,i=google.ima.AdEvent.Type,a=google.ima.AdErrorEvent.Type;e.forEach((function(e){var n=i[e]||a[e],r=t.adsManagerEvents[n];r&&(t.adsManager.removeEventListener(n,r),delete t.adsManagerEvents[n])}))}},{key:"getTag",value:function(e){if("string"==typeof this.schedule)return this.schedule;var t=we(e,"getAdPodInfo");if(t){var i=this.breakMap[we(t,"getTimeOffset")]||{};if(i.tag)return i.tag}return this.userRequestContext?this.userRequestContext.adTagUrl||this.userRequestContext.adsResponse||"":(console.error("invalid request context",this.userRequestContext),"")}},{key:"getJwpSeg",value:function(e){var t=we(e,"getAdPodInfo");if(t){var i=we(t,"getTimeOffset");return this.breakMap[i]&&this.breakMap[i].jwpseg}return null}},{key:"getTimeoffsetFromPosition_",value:function(){var e,t=this.player.getPosition(),i=1/0;return Object.keys(this.breakMap).forEach((function(a){var n=t-a;n>=0&&n<i&&(e=a,i=n)})),i===1/0?-1:e}},{key:"skipAd",value:function(){this.adsManager&&this.adsManager.skip()}},{key:"getBid",value:function(e){var t=Ae(e,this.player.utils);return this.breakMap[t]?this.breakMap[t].bid:null}},{key:"setBid",value:function(e,t){var i=Ae(e,this.player.utils);this.breakMap[i]=this.breakMap[i]||{},this.breakMap[i].bid=t}}]),e}(),Ie={},Se={},Te={};function Le(e,t){var i=Ie[t];return i||(Ie[t]=new Promise((function(i,a){var n=new e.key(t);if("unlimited"===n.edition())return a();var r=["//","entitlements.jwplayer.com","/",n.token(),".json"];"file:"===window.location.protocol&&r.unshift("https:"),e.ajax(r.join(""),(function(e){var t=e&&e.response;t?i(t):a()}),(function(){a()}),{timeout:1e4,responseType:"json"})})))}function xe(e,t){var i=Se[t];return i||(Se[t]=Le(e,t).catch((function(){return{}})).then((function(e){if(!1===e.canUseVPB)throw new Error("Not entitled for Player Bidding")})))}var je=function(e,t,i){var a=Te[t];return a||(Te[t]=Le(e,t).catch((function(){return{}})).then((function(e){var t,a;if(!0===i.outstream?(t=!1!==e.canPlayOutstreamAds,a="Outstream Ad Limit Reached"):(t=!1!==e.canPlayAds,a="Ad Limit Reached"),!1===t)throw new Error(a);return{message:"Can Play Ads"}})))},Be=function(){};!function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");t.setAttribute("media","screen"),t.innerHTML=e,document.head.appendChild(t)}}(".jw-plugin-googima{overflow:hidden;width:100%;height:100%;display:block;visibility:hidden;pointer-events:none;opacity:0}.jw-plugin-googima.jw-ad-instream{visibility:visible;display:block;pointer-events:all;opacity:1}.jw-plugin-googima.jw-ad-instream .jw-ads-view>:not(div),.jw-plugin-googima.jw-ad-instream .jw-ads-view>div:not(:empty){width:100%;height:100%}.jw-plugin-googima.jw-ad-linear{top:0;left:0;bottom:0}.jw-plugin-googima.jw-ad-non-linear{top:auto}.jw-plugin-googima .jw-ads-view{position:absolute;width:100%;height:100%}.jwplayer.jw-flag-ads-googleima.jw-flag-touch .jw-controlbar{font-size:1em}.jwplayer.jw-flag-ads-googleima.jw-flag-touch .jw-display-icon-display,.jwplayer.jw-flag-ads-googleima.jw-flag-touch .jw-display-icon-display .jw-icon-display{pointer-events:none}.jwplayer.jw-flag-ads-googleima .jw-controlbar{background:0 0!important;pointer-events:none}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-icon{pointer-events:all}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-icon-fullscreen:not(.jw-fullscreen-ima){display:none}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-fullscreen-ima{display:flex}.jwplayer.jw-flag-ads-googleima .jw-controls-backdrop{display:none}.jwplayer.jw-flag-ads-googleima.jw-ie .jw-slider-volume,.jwplayer.jw-flag-ads-googleima.jw-ie .jw-svg-icon{background:rgba(0,0,0,.25);border-radius:3px}.jwplayer.jw-flag-ads-googleima.jw-ie .jw-slider-volume{margin:0 10px}@supports (filter:drop-shadow(0 0 3px #000)){.jwplayer.jw-flag-ads-googleima.jw-ie .jw-slider-volume,.jwplayer.jw-flag-ads-googleima.jw-ie .jw-svg-icon{background:0 0;border-radius:0}.jwplayer.jw-flag-ads-googleima.jw-ie .jw-slider-volume{margin:0}}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-svg-icon{fill:#fff;filter:drop-shadow(0 0 3px #000)}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-text{text-shadow:0 0 3px #000}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player.jw-flag-ads.jw-state-playing.jw-flag-touch:not(.jw-flag-ads-vpaid) .jw-controls .jw-controlbar{pointer-events:none}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player .jw-controlbar{flex-flow:column-reverse nowrap;height:100%;max-height:none}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player .jw-button-container{align-items:flex-end;flex-wrap:wrap;margin-bottom:7px}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player .jw-controlbar .jw-icon{height:30px}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player .jw-text{align-self:flex-start;margin:16px 0 0 16px;order:-1;width:100%}"),(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)("googima","8.1",(function(e,t,i){var a=this,n=new de(e,t,"googima"),s=e.utils,o=e.getConfig(),l=new he(t||{},s),d=n.getAdRules(),u=this,c=null,h=0,g=null,p=!1,f=!1,m=t.bids;!function(e,t,i,a){var n,r=t.key,s=e.utils,o=je(s,r,i);o.catch(Be),i.bids&&(n=xe(s,r)).catch(Be),e.on("ready",(function(){n&&n.catch((function(i){e.trigger("destroyBidding"),e.trigger("adError",se(i.message,60009,t,a))})),o.catch((function(i){e.trigger("destroyPlugin",i),e.trigger("adError",se(i.message,60002,t,a))}))}))}(e,o,t,"googima"),fe(s).catch(s.noop);var v=new ge(i,e.id,s),y=new me(s,e.Events,v),k=new Re(e,v.getAdDiv()),A=null;function w(e,t,i,a){try{return e.getCompanionAds(t,i,a)}catch(e){return[]}}function P(t){var i=t.currentAd,a=new google.ima.CompanionAdSelectionSettings;a.sizeCriteria=google.ima.CompanionAdSelectionSettings.SizeCriteria.IGNORE;var n=l.companiondiv||{width:300,height:250},r=function(e){for(var t=[],i=0;i<e.length;i++){var a=e[i];t.push({width:a.getWidth(),height:a.getHeight(),type:"html",resource:a.getContent()})}return t}(w(i,n.width,n.height,a)),s=r.length;if(s){var o=be(A,i,t.scheduledAd);o.companions=r,e.trigger("adCompanions",o)}if(l.companiondiv){a=new google.ima.CompanionAdSelectionSettings,l.companionResourceType&&(a.resourceType=google.ima.CompanionAdSelectionSettings.ResourceType[l.companionResourceType]);var d=w(i,l.companiondiv.width,l.companiondiv.height,a);s=Math.max(s,d.length),function(e){if(e&&e.length){var t=document.getElementById(l.companiondiv.id);if(t){var i=e[0];i&&("function"==typeof i.getContent?t.innerHTML=i.getContent():t.innerHTML=i.resource||i.content)}}}(d)}return s>0}function b(){M(),k&&k.adDisplayContainer&&k.adDisplayContainer.destroy(),e.off(null,null,this),e.playAd=s.noop,e.pauseAd=s.noop}function E(t){A&&A.adsPlayer&&A.adsPlayer.discardAdBreak(),k.contentComplete(),M(t),e.setCues([])}function _(i,a,s){var o=i.item||{},d=n.getSchedule(o,s.playlistItemEventCount),g=new Ce(e,d,o,t,l,y,v,k,c,f);return g.on("all",(function(t,i){if("preloadNext"!==t)e.trigger(t,i);else{var a=r({},s,{preloadPreroll:!0,playlistItemEventCount:h+1});g.next=_(i,"TYPE_SCHEDULE",a)}}),u),g.init(m,s),g.on("adStarted",(function(){return P(g.adsPlayer)})),g}function M(t){A&&(t&&(g=A.next,p=A.nextPlaylistRelated),A.off(null,null,u),A.destroy(),A=null),n.reset(),e.setCues([])}this.version="8.9.1",e.utils.extend(this,e.Events),e.pauseAd=function(e,t){A&&A.adsPlayer&&(e?A.adsPlayer.pause(t||{}):A.adsPlayer.resume(t||{}))},e.playAd=function(i){var a,n=s.extend({},t);a=e._.isArray(i)?i.slice(0):[i];var r=new he(n,s);r.setLocalizationOptions(o.localization.advertising);var l=A?A.blockingInstreamPlayer:null;l&&(l.noResume=!0),M(),(A=_({item:e.getPlaylistItem()},0,r))&&!A.destroyed()&&A.startAdBreak({_adQueue:a,_position:Ee(e),adBreakId:s.genId(12)})},e.skipAd=function(){k&&k.skipAd()},e.on("ready",(function(){o.localization=e.getConfig().localization,l.setLocalizationOptions(o.localization.advertising),c||(c=e.createInstream().getMediaElement()),fe(s).catch((function(e){e.message.match(/Failed to load/)&&C("Ad playback blocked by an ad blocker",2e4)}));var t=document.body,i=function e(){t.removeEventListener("mouseup",e),t.removeEventListener("touchend",e),k.initializeDisplay()};t.addEventListener("mouseup",i,!1),t.addEventListener("touchend",i,!1)}),this).on("playlistItem",(function(t){!function(t,i,a){fe(s).then((function(){k.prepare(c,a)}));var r=t.item||e.getPlaylistItem(t.index);E(!0);var o=n.getSchedule(r,h);!("TYPE_SCHEDULE"===i&&!d.rulesAllowAdPlayback(h))&&o&&(o.getAllAds().length||o.isVMAP())&&(g&&r!==g.item&&!1===p&&(g.off(null,null,this),g.destroy(),g=null),k.reset(!0),(A=g||_(t,0,a)).attachListeners(),g=null,p=!1)}(t,"TYPE_SCHEDULE",r({playlistItemEventCount:++h},l)),A&&!A.schedule.isVMAP()&&function(t){var i=t.getMidRolls(),a=[];i.length&&i.forEach((function(e){"nonlinear"!==e._type&&a.push({begin:e._offSet,text:l.cuetext,cueType:"ads"})}));e.addCues(a)}(A.schedule)}),this).on("playlistComplete",(function(){E(!0)}),this).on("cast",(function(e){f=!!e.active,e.active&&E()}),this).on("mute",(function(e){var t=e.mute;y.mute(t)}),this).on("destroyPlugin",(function(){a.destroy()}),this).on("destroyBidding",(function(){m=null})).on("remove",b,this);var C=function(t,i){b(),e.trigger("adError",Pe(null,{message:t,adErrorCode:i,id:"-1",placement:ke(o),tag:""}))};this.destroy=M,this.adsDebugMode=function(){l.debug=!0,A&&(A.debugConsoleLog=function(){var e;(e=console).log.apply(e,arguments)})}}))}();
