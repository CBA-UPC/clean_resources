(self.webpackChunkvulnerability_management=self.webpackChunkvulnerability_management||[]).push([[6372],{99809:56372:function(e,t,r){"use strict";r.r(t),r.d(t,{CONDITION_NOT:function(){return c},CONDITION_OR:function(){return u},CONDITION_TYPES:function(){return d},DEFAULT_MAX_NESTED_LEVEL:function(){return ye},PHRASE_SPECIAL_KEYWORDS:function(){return we},QueryBuilder:function(){return Ui},getAsyncFilterHelpersFromMeta:function(){return Vi},parseFiltersToString:);var n,i,a=r(96156),o=r(33673),s=r(96359),l={label:"AND",value:"and"},u={label:"OR",value:"or"},c={label:"NOT",value:"not"},d={AND:l.value,NOT:c.value,OR:u.value},p=[l,u],f={label:"NOT(",value:"not"},h=c.label.toLowerCase(),v=f.label.toLowerCase(),g={label:"(",value:"("},m=(0,s.getLocaleDateFormat)(),I="YYYY-MM-DD",E=/^-?P(?:(\d+)([Y|M|D])|T(\d+)(H))$/i,b=/^\+?P(?:(\d+)([Y|M|D])|T(\d+)(H))$/i,y={label:"to",value:"to"},S=[g,f],O='"',T="'",x="NONE",_="FILTER",D="OPERATOR",L="VALUE",A="CONDITION",M="CONDITION_OR_VALUE",F="ASYNC_WAITING",R="ASYNC_FAILURE",w="ERROR",C="INCOMPLETE",P="INCOMPLETE_CONDITION_BUT_VALID_FILTER",N="PHRASE_KEYWORD",U="PHRASE_KEYWORD_OR_CONDITION",V=[R,F,w,C],k="DURATION_VALUE",B="KEY_VALUE_FILTER_KEY",j="KEY_VALUE_FILTER_VALUE",Y="NONE",H="PARTIAL_DURATION_UNIT",q="CONTINUE",W="ERROR",Q="SUCCESS",G=10,K={DATE:"date",DATE_V1:"datev1",DATEV3:"datev3",KEY_VALUE_FILTER:"key-value",NUMERIC:"numeric",NUMERIC_MULTI:"numeric-multi",SELECTION:"selection",SELECTION_MULTI:"selection-multi",SELECTION_MULTI_ASYNC:"selection-multi-async",TAG:"tag",TEXT:"text",TEXT_AREA:"text-area",TEXT_MULTI:"text-multi"},z=[K.DATE,K.DATEV3],X="gt",$="within",J="wc",Z="nwc",ee=[X,"gte","lt","lte","on"],te="date",re="duration",ne="future_duration",ie="on_date",ae="between",oe="wildcard",se=["exists","nexists"],le=[X,"gte","lt","lte"],ue=[te,ie,ae],ce="H",de=(n={},(0,a.default)(n,"Y","year"),(0,a.default)(n,"M","month"),(0,a.default)(n,"D","day"),(0,a.default)(n,ce,"hour"),n),pe="INVALID_OPTION",fe="NO_ASYNC_OPTIONS",he=100,ve=[K.KEY_VALUE_FILTER,K.SELECTION_MULTI_ASYNC,K.TAG],ge=[K.NUMERIC,K.NUMERIC_MULTI,K.TEXT,K.TEXT_AREA,K.TEXT_MULTI],me=[K.NUMERIC,K.NUMERIC_MULTI,K.TEXT,K.TEXT_AREA,K.TEXT_MULTI],Ie=[K.KEY_VALUE_FILTER,K.NUMERIC_MULTI,K.SELECTION_MULTI,K.SELECTION_MULTI_ASYNC,K.TAG,K.TEXT_AREA,K.TEXT_MULTI],Ee=[K.TEXT,K.TEXT_AREA,K.TEXT_MULTI],be=[K.NUMERIC].concat(Ee),ye=2,Se="CONDITION",Oe="FILTER_BLOCK",Te="NESTED_BLOCK",xe="PHRASE_BLOCK",_e="PHRASE_NUMBER_KEYWORD",De="PHRASE_OPTION_LIST_KEYWORD",Le="PHRASE_STRING_KEYWORD",Ae=(0,s.rems)("28"),Me=(0,s.rems)("40"),Fe=(0,s.rems)("24"),Re=(0,s.rems)("36"),we={ASYNC_OPTION_LIST:"__ASYNC_OPTION_LIST__",DURATION_UNIT:"__DURATION_UNIT__",NUMBER:"__NUMBER__",OPTION_LIST:"__OPTION_LIST__"},Ce="ASYNC_OPTION_LIST",Pe="DURATION_UNIT",Ne="NUMBER",Ue="OPTION_LIST",Ve="STRING",ke=(i={},(0,a.default)(i,Ce,De),(0,a.default)(i,Pe,De),(0,a.default)(i,Ne,_e),(0,a.default)(i,Ue,De),(0,a.default)(i,Ve,Le),i),Be=[Ce,Ue,Pe],je=o.POPOVER_MENU_ITEM_TYPES,Ye=r(22122),He=r(28481),qe=r(30624),We=r.n(qe),Qe=r(25936),Ge=r(81393),Ke=r(44439),ze=r(49898),Xe=r(2753),$e=r(83269),Je=r(45450),Ze=r(11129),et=r.n(Ze),tt=r(71636),rt=tt.SYSTEM_PROPS.COMMON_SYSTEM_PROPS,nt=tt.SYSTEM_PROPS.TYPOGRAPHY_SYSTEM_PROPS,it=et().div.withConfig({displayName:"chip-input-styles__ChipInputContent",componentId:"sc-w4bv6f-0"})(["height:100%;outline:0px solid transparent;padding-left:",";padding-right:",";white-space:break-spaces;width:inherit;&[placeholder]:empty:before{content:attr(placeholder);position:absolute;color:",";color:",";background-color:transparent;}& .qb-chip-span:not(.open){background-color:",";border:1px solid;border-color:",";border-radius:",";box-sizing:border-box;padding-bottom:",";padding-left:",";padding-top:",";white-space:pre;}.qb-chip{padding-bottom:",";word-break:break-word;}& .qb-chip-span.first-nested:not(.open){margin-left:",";}& .qb-chip-span.last-nested:not(.open){margin-right:",";}& .qb-filter-chip{color:",";}& .qb-operator-chip{color:",";}& .qb-value-chip{color:",";}& .qb-condition-chip{color:",";}& .qb-parenthesis-chip{color:",";}& .qb-phrase-number-keyword-chip{color:",";}& .qb-phrase-option-list-keyword-chip{color:",";}& .qb-phrase-string-keyword-chip{color:",";}& .qb-chip.focused{background-color:",";}& .qb-remove-chip-button{cursor:pointer;margin-left:",";margin-right:",";}& .qb-chip-span.open .qb-remove-chip-button{display:none;}& .qb-chip-span:not(.open) .qb-value-chip{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;display:inline-block;max-width:",";vertical-align:top;}"],(0,s.rems)("6"),(0,s.rems)("6"),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.text-placeholder":"colors.text.placeholder")(e)}),(function(e){return e.disabled&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.text-disabled":"colors.text.disabled")(e)}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.gray-03":"colors.background.gray-03")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-base":"colors.border.base")}),(,(function(e){return(0,s.rems)(e.isUniversalDesign?"2":"1")}),(0,s.rems)("8"),(function(e){return e.isUniversalDesign?(0,s.rems)("2"):void 0}),(0,s.rems)("1"),(0,s.rems)("4"),(0,s.rems)("4"),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.blueSpruce-01":"colors.text.accessible-04")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.rose-01":"colors.text.accessible-06")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.text-body":"colors.text.background")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.neutral-03":"colors.text.accessible-10")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.honey-01":"colors.text.accessible-05")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.nebula-01":"colors.text.accessible-07")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.nebula-01":"colors.text.accessible-07")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.text-body":"colors.text.background")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.azureSkies-06":"colors.surface.azureSkies-06")}),(0,s.rems)("4"),(0,s.rems)("4"),(function(e){return e.maxValueWidth?(0,s.rems)(e.maxValueWidth):(0,s.rems)("600")}));it.displayName="ChipInputContent";var at=et().div.withConfig({displayName:"chip-input-styles__ChipInputWrapper",componentId:"sc-w4bv6f-1"})(["background-color:",";background-color:",";border:1px solid;border-color:",";border-color:",";border-color:",";border-color:",";border-radius:",";box-sizing:border-box;color:",";color:",";display:block;font-size:",";font-family:",";height:100%;line-height:",";margin:0;max-height:",";"," "," outline:none;outline:",";outline-color:",";outline-color:",";overflow:auto;position:relative;resize:none;width:inherit;:focus-within{border-color:",";border-color:",";outline:1px solid;outline-color:",";outline-color:",";}:hover{border-color:",";}"],(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.background-page":"colors.background.form.idle")}),(function(e){return e.disabled&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.background-disabled":"colors.background.form.disabled")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-base":"colors.border.form.idle")}),(function(e){return e.forcedFocus&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-form-active":"colors.outline.focus")}),(function(e){return e.error&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-error-active":"colors.outline.error")}),(function(e){return e.disabled&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-form-disabled":"colors.border.form.disabled")}),(,(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.text-body":"colors.text.background")}),(function(e){return e.disabled&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.text-disabled":"colors.text.disabled")}),(0,s.themeGet)("fontSizes.14"),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.fonts.base":"fonts.REGULAR")}),(function(e){return(0,s.rems)(e.isUniversalDesign?"36":"26")}),(function(e){return e.maxHeight}),rt,nt,(,(function(e){return e.forcedFocus&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-form-active":"colors.outline.focus")}),(function(e){return e.forcedFocus&&e.error&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-error-active":"colors.outline.error")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-form-active":"colors.outline.focus")}),(function(e){return e.error&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-error-active":"colors.outline.error")}),(function(e){return(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-form-active":"colors.outline.focus")}),(function(e){return e.error&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-error-active":"colors.outline.error")}),(function(e){return!e.error&&!e.forcedFocus&&(0,s.themeGet)(e.isUniversalDesign?"pds.colors.border-form-hover":"colors.border.form.hover")}));at.displayName="ChipInputWrapper";var ot=et().div.withConfig({displayName:"chip-input-styles__ClearIconWrapper",componentId:"sc-w4bv6f-2"})(["cursor:pointer;height:",";margin-right:",";width:",";:hover .icon-color-controlled svg{fill:"," !important;}> *{pointer-events:none;}"],(0,s.rems)("16"),(0,s.rems)("4"),(0,s.rems)("16"),();ot.displayName="ClearIconWrapper";var st,lt=r(81253),ut=r(42781),ct=r(84152),dt=function(e){var t=e.isUniversalDesign,r=void 0!==t&&t,n=(0,lt.default)(e,["isUniversalDesign"]);return We().createElement(ct.SkeletonBlock,(0,Ye.default)({height:(0,s.rems)(r?"28":"29"),width:"100%"},(0,ut.pick)(n)))},pt=r(97762),ft=r.n(pt),ht=r(10714),vt=(st={},(0,a.default)(st,_e,"qb-phrase-number-keyword-chip"),(0,a.default)(st,De,"qb-phrase-option-list-keyword-chip"),(0,a.default)(st,Le,"qb-phrase-string-keyword-chip"),st),gt=function(e,t){var r=document.createElement("span");return r.classList.add("qb-chip",t),r.setAttribute("data-string-start-index",e.stringStartIndex.toString()),r.setAttribute("data-string-end-index",e.stringEndIndex.toString()),r.textContent=e.rawText,r},mt=function(e,t){It(e.stringSpaceEndIndex-e.stringEndIndex,t)},It=function(e,t){e>0&&t.appendChild(document.createTextNode(Array(e).fill(" ").join("")))},Et=function(e,t){t.appendChild(gt(e.filter,"qb-filter-chip")),mt(e.filter,t),e.operator&&(t.appendChild(gt(e.operator,"qb-operator-chip")),se.includes(e.operator.item.name)||mt(e.operator,t)),e.value&&t.appendChild(gt(e.value,"qb-value-chip"))},bt=function(e){var t=e.chip,r=e.blockChipSpan,n=e.preventChipInputFocus,i=e.queryBuilderInput,a=document.createElement("span");a.className="qb-remove-chip-button",a.innerHTML=ft().renderToStaticMarkup(We().createElement(ht.TDSThemeProvider,null,We().createElement(Xe.CloseIcon,{size:16,mb:2}))),a.onclick=function(){var e,r=i.getText(),n=null!==(e=t.stringConditionEndIndex)&&void 0!==e?e:t.stringSpaceEndIndex,a="".concat(r.slice(0,t.stringStartIndex)).concat(r.slice(n));i.setText(a,{focusOnInput:!1})},a.onmousedown=r.appendChild(a)},yt=function(e,t,r){e.chips.forEach((function(n,i){var a=gt(n,vt[n.type]);r.appendChild(a),(t||i<e.chips.length-1)&&mt(n,r)}))},St=function(e){var t=e.chips,r=e.hasRemainingText,n=e.hasEndingParenthesis,i=void 0!==n&&n,a=e.hasNestedRemainingText,o=void 0!==a&&a,s=e.nested,l=void 0!==s&&s,u=e.parentElement,c=e.preventChipInputFocus,d=e.queryBuilderInput;t.forEach((function(e,n){switch(!l&&0===n&&e.stringStartIndex>0&&It(e.stringStartIndex,u),e.type){case Oe:!function(e){var t=e.chip,r=e.chips,n=e.hasEndingParenthesis,i=e.hasNestedRemainingText,a=e.index,o=e.nested,s=e.parentElement,l=e.preventChipInputFocus,u=e.queryBuilderInput;if(t.isComplete){var c=document.createElement("span");c.classList.add("qb-chip-span"),c.setAttribute("data-string-start-index",t.stringStartIndex.toString()),c.setAttribute("data-string-end-index",t.stringEndIndex.toString()),Et(t,c),bt({chip:t,blockChipSpan:c,preventChipInputFocus:l,queryBuilderInput:u}),0===a&&o&&c.classList.add("first-nested"),o&&a===r.length-1&&n&&!i&&c.classList.add("last-nested"),s.appendChild(c),t.value?mt(t.value,s):t.operator&&se.includes(t.operator.item.name)&&mt(t.operator,s)}else Et(t,s)}({chip:e,chips:t,hasEndingParenthesis:i,hasNestedRemainingText:o,index:n,nested:l,parentElement:u,preventChipInputFocus:c,queryBuilderInput:d});break;case Se:u.appendChild(gt(e,"qb-condition-chip")),mt(e,u);break;case Te:!function(e){var t=e.chip,r=e.hasRemainingText,n=e.parentElement,i=e.preventChipInputFocus,a=e.queryBuilderInput,o=document.createElement("span");o.classList.add("qb-nested-span");var s=document.createElement("span");if(s.classList.add("qb-chip","qb-parenthesis-chip"),s.setAttribute("data-string-start-index",t.stringStartIndex.toString()),s.setAttribute("data-string-end-index",t.leadingParenthesisStringEndIndex.toString()),s.textContent=t.rawText,o.appendChild(s),It(t.spacesAfterLeadingParenthesis,o),t.chips.length>0&&St({chips:t.chips,hasRemainingText:r,hasEndingParenthesis:t.hasEndingParenthesis,hasNestedRemainingText:t.nestedRemainingText.length>0,nested:!0,parentElement:o,preventChipInputFocus:i,queryBuilderInput:a}),t.nestedRemainingText&&o.appendChild(document.createTextNode(t.nestedRemainingText)),t.hasEndingParenthesis){var l=document.createElement("span");l.classList.add("qb-chip","qb-parenthesis-chip"),l.setAttribute("data-string-start-index",(t.stringEndIndex-1).toString()),l.setAttribute("data-string-end-index",t.stringEndIndex.toString()),l.textContent=")",o.appendChild(l),mt(t,o)}n.appendChild(o)}({chip:e,hasRemainingText:r,parentElement:u,preventChipInputFocus:c,queryBuilderInput:d});break;case xe:!function(e){var t=e.chip,r=e.chips,n=e.hasRemainingText,i=e.hasEndingParenthesis,a=e.hasNestedRemainingText,o=e.index,s=e.nested,l=e.parentElement,u=e.preventChipInputFocus,c=e.queryBuilderInput,d=!t.isComplete||t.hasPossibleOptions&&o===r.length-1&&(!s&&n||s&&a);if(d)yt(t,d,l);else{var p=document.createElement("span");p.classList.add("qb-chip-span"),p.setAttribute("data-string-start-index",t.stringStartIndex.toString()),p.setAttribute("data-string-end-index",t.stringEndIndex.toString()),0===o&&s&&p.classList.add("first-nested"),s&&o===r.length-1&&i&&!a&&p.classList.add("last-nested"),yt(t,!1,p),bt({chip:t,blockChipSpan:p,preventChipInputFocus:u,queryBuilderInput:c}),l.appendChild(p),mt(t.chips[t.chips.length-1],l)}}({chip:e,chips:t,hasRemainingText:r,hasEndingParenthesis:i,hasNestedRemainingText:o,index:n,nested:l,parentElement:u,preventChipInputFocus:c,queryBuilderInput:d})}}))},Ot=function(e){e&&(Array.from(e.getElementsByClassName("qb-chip-span")).forEach((function(e){e.classList.remove("open")})),Array.from(e.getElementsByClassName("qb-chip")).forEach(())},Tt=r(6610),xt=r(5991),_t=function(e){if(!e.anchorNode||!e.focusNode||"Caret"===e.type)return!1;var t=document.createRange();t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset);var r=t.collapsed||e.anchorNode===e.focusNode&&t.startOffset===t.endOffset;return t.detach(),r},Dt=function(e,t){for(var r=e;null!==r;){if(r===t)return!0;r=r.parentNode}return!1},Lt=function e(t,r,n){var i;if(n?i=n:((i=document.createRange()).selectNode(t),i.setStart(t,0)),0===r.count)i.setEnd(t,r.count);else if(t&&r.count>0)if(t.nodeType===Node.TEXT_NODE)t.textContent&&t.textContent.length<r.count?r.count-=t.textContent.length:(i.setEnd(t,r.count),r.count=0);else for(var a=0;a<t.childNodes.length&&(i=e(t.childNodes[a],r,i),0!==r.count);a++);return i},At=function(e,t){var r=e,n=0;for(r.nodeType!==Node.TEXT_NODE&&r.hasChildNodes()&&r.childNodes.forEach((function(e){e.textContent&&e.textContent.length>0&&(n+=e.textContent.length-1)}));r&&r!==t;)if(r.previousSibling){var i,a;r=r.previousSibling,n+=null!==(i=null===(a=r.textContent)||void 0===a?void 0:a.length)&&void 0!==i?i:0}else{if(null===r.parentNode)break;r=r.parentNode}return n},Mt=function(){eturn(0,xt.default)(e,null,[{key:"getCurrentCursorPosition",value:function(e){var t=window.getSelection();return e&&t&&t.focusNode&&Dt(t.focusNode,e)?t.focusOffset+At(t.focusNode,e):-1}},{key:"getEndCursorPosition",value:function(e){var t,r,n=window.getSelection();if(!(e&&n&&n.focusNode&&Dt(n.focusNode,e)))return-1;for(var i=n.focusNode,a=null!==(t=null===(r=i.textContent)||void 0===r?void 0:r.length)&&void 0!==t?t:0;i&&i!==e;)if(i.nextSibling){var o,s;a+=null!==(o=null===(s=(i=i.nextSibling).textContent)||void 0===s?void 0:s.length)&&void 0!==o?o:0}else{if(null===i.parentNode)break;i=i.parentNode}return a}},{key:"getSelectionStart",value:function(e){var t=window.getSelection();if(!(e&&t&&t.focusNode&&t.anchorNode&&Dt(t.focusNode,e)))return-1;var r=_t(t),n=r?t.focusNode:t.anchorNode;return(r?t.focusOffset:t.anchorOffset)+At(n,e)}},{key:"getSelectionEnd",value:function(e){var t=window.getSelection();if(!(e&&t&&t.focusNode&&t.anchorNode&&Dt(t.focusNode,e)))return-1;var r=_t(t),n=r?t.anchorNode:t.focusNode;return(r?t.anchorOffset:t.focusOffset)+At(n,e)}},{key:"setCursorToEnd",value:function(t){t.focus();var r=e.getEndCursorPosition(t);e.setCurrentCursorPosition(r,t)}},{key:"setCurrentCursorPosition",value:function(e,t){if(e>=0){var r=window.getSelection();if(!r)return;var n=Lt(t,{count:e});n&&(n.collapse(!1),r.removeAllRanges(),r.addRange(n))}}}]),e}(),Ft=function(e){if(e){var t=Mt.getCurrentCursorPosition(e);Array.from(e.getElementsByClassName("qb-chip-span")).forEach((function(e){var r,n,i=parseInt(null!==(r=e.getAttribute("data-string-start-index"))&&void 0!==r?r:""),a=parseInt(null!==(n=e.getAttribute("data-string-end-index"))&&void 0!==n?n:"");i>t||a<t?e.classList.remove("open"):e.classList.add("open")})),Array.from(e.getElementsByClassName("qb-chip")).forEach((function(e){var r,n,i=parseInt(null!==(r=e.getAttribute("data-string-start-index"))&&void 0!==r?r:""),a=parseInt(null!==(n=e.getAttribute("data-string-end-index"))&&void 0!==n?n:"");i<=t&&a>=t?e.classList.add("focused"):e.classList.remove("focused")}))}},Rt=function(e){var t=e.chipState,r=e.errorBorder,n=e.isLoading,i=e.maxHeight,a=e.maxWidth,o=e.onChipInputChange,l=e.onChipInputFocus,u=e.onChipInputKeyDown,c=e.onClearClick,d=e.placeholder,p=e.queryBuilderInput,f=e.statusIcon,h=We().useContext(s.IsUniversalDesignContext),v=We().useState(!1),g=(0,He.default)(v,2),m=g[0],I=g[1],E=We().useRef(""),b=We().useRef(!1),y=We().useRef({focusOnInput:!0,setCursorToEnd:!1,setCursorPosition:null}),S=We().useRef({chipState:t,isFocused:m,onChipInputChange:o});S.current.chipState=t,S.current.isFocused=m,S.current.onChipInputChange=o;var O=function(e){var t=e.queryBuilderInput,r=We().useRef(0),n=We().useRef([""]),i=We().useCallback((function(e){r.current>=0&&r.current<n.current.length&&(n.current=n.current.slice(0,r.current+1)),0!==n.current.length&&e===n.current[r.current]||(1e3===n.current.length&&n.current.shift(),n.current.push(e),r.current=n.current.length-1)}),[]),a=We().useCallback((function(){if(r.current-1<0||r.current-1>=n.current.length)return!1;r.current--;var e=n.current[r.current];t.setText(e,{saveChangeInHistory:!1})}),[t]),o=We().useCallback((function(){if(!(r.current<0||r.current+1>=n.current.length)){r.current++;var e=n.current[r.current];t.setText(e,{saveChangeInHistory:!1})}}),[t]);return We().useEffect((function(){var e=t.getElement();if(e){var r=function(e){switch(e.inputType){case"historyUndo":e.preventDefault(),a();break;case"historyRedo":e.preventDefault(),o()}};return e.addEventListener("beforeinput",r),function(){var e;null===(e=t.getElement())||void 0===e||e.removeEventListener("beforeinput",r)}}}),[t,o,a]),{handleUndoOrRedoKeyDown:function(e){!function(e){return!e.shiftKey&&(e.ctrlKey||e.metaKey)&&"z"===e.key}(e)?(function(e){return!e.shiftKey&&(e.ctrlKey||e.metaKey)&&"y"===e.key}(e)||function(e){return e.shiftKey&&(e.ctrlKey||e.metaKey)&&"z"===e.key}(e))&&(e.preventDefault(),o()):(e.preventDefault(),a())},saveHistory:i}}({queryBuilderInput:p}),T=O.handleUndoOrRedoKeyDown,x=O.saveHistory;We().useLayoutEffect((function(){var e=p.getElement();if(e&&t){var r=y.current.focusOnInput,n=y.current.setCursorToEnd,i=y.current.setCursorPosition,a=r?Mt.getCurrentCursorPosition(e):-1;if(function(e){var t=e.chipState,r=e.preventChipInputFocus,n=e.queryBuilderInput,i=n.getElement();if(i){i.innerHTML="";var a=t.remainingText.length>0;St({chips:t.chips,hasRemainingText:a,parentElement:i,preventChipInputFocus:r,queryBuilderInput:n}),a&&i.appendChild(document.createTextNode(t.remainingText))}}({chipState:t,preventChipInputFocus:function(){b.current=!0,requestAnimationFrame(()},queryBuilderInput:p}),!r&&!S.current.isFocused)return y.current={focusOnInput:!0,setCursorToEnd:!1,setCursorPosition:null},void Ot(e);if(n)Mt.setCursorToEnd(e);else{var o=null!=i?i:a;Mt.setCurrentCursorPosition(o,e)}y.current={focusOnInput:!0,setCursorToEnd:!1,setCursorPosition:null},Ft(e)}}),[p,t]);var _=We().useCallback((function(e,t){var r;if((null===(r=null==t?void 0:t.saveChangeInHistory)||void 0===r||r)&&x(e),E.current=e,""===e){var n=p.getElement();n&&(n.innerHTML="",n.appendChild(document.createTextNode("")))}S.current.onChipInputChange(e,null==t?void 0:t.focusOnInput,null==t?void 0:t.triggerOnChange)}),[p,x]);p.setOnSetText((function(e,t){var r,n={saveChangeInHistory:null===(r=null==t?void 0:t.saveChangeInHistory)||void 0===r||r};(0,Ke.isNil)(null==t?void 0:t.cursorPosition)&&!1!==(null==t?void 0:t.setCursorToEnd)&&(y.current.setCursorToEnd=!0),t&&!(0,Ke.isNil)(null==t?void 0:t.cursorPosition)&&(y.current.setCursorPosition=t.cursorPosition),t&&!(0,Ke.isNil)(t.focusOnInput)&&(y.current.focusOnInput=t.focusOnInput,n.focusOnInput=t.focusOnInput),t&&!(0,Ke.isNil)(t.triggerOnChange)&&(n.triggerOnChange=t.triggerOnChange),_(e,n)}));var D=a?.65*a:null;return n?h?We().createElement(at,{error:r,height:Me,isUniversalDesign:!0,maxHeight:i,ref:p.setWrapperRef},We().createElement($e.Flex,{alignItems:"center",height:"100%",width:"100%"},We().createElement(dt,{isUniversalDesign:!0,mx:16}))):We().createElement(dt,null):We().createElement(at,{error:r,isUniversalDesign:h,maxHeight:i,ref:p.setWrapperRef},We().createElement($e.Flex,{alignItems:"center"},We().createElement($e.Box,{ml:4,mb:2,alignSelf:"flex-start"},f),We().createElement($e.Box,{flex:"1"},We().createElement(it,{contentEditable:"true",isUniversalDesign:h,maxValueWidth:D,onBlur:onFocus:function(e){b.current?e.currentTarget.blur():(l(),requestAnimationFrame((function(){I(!0),Ft(p.getElement())})))},onInput:onMouseDown:function(){b.current||requestAnimationFrame((function(){S.current.chipState&&S.current.isFocused&&Ft(p.getElement())}))},onKeyDown:function(e){if(u(e)){var t=e.currentTarget.textContent;requestAnimationFrame((function(){S.current.chipState&&S.current.isFocused&&t===E.current&&Ft(p.getElement())})),T(e)}},onPaste:function(e){if(e.preventDefault(),p.isInitialized()){var t=e.clipboardData.getData("text/plain"),r=Mt.getSelectionStart(p.getElement()),n=Mt.getSelectionEnd(p.getElement()),i=p.getText(),a="".concat(i.slice(0,r)).concat(t),o="".concat(a).concat(i.slice(n));p.setText(o,{cursorPosition:a.length})}},placeholder:d,ref:p.setRef})),We().createElement($e.Box,{alignSelf:"flex-start"},We().createElement(ot,{isUniversalDesign:h,onClick:c,onDoubleClick:,We().createElement(Xe.CloseIcon,{pointerEvents:"none",className:"icon-color-controlled"})))))},wt=r(87757),Ct=r.n(wt),Pt=r(92137),Nt=r(39079),Ut=function(e,t,r){return e.includes(",")||function(e,t,r){return Boolean(t&&r&&t!==J&&t!==Z&&(r.variationName===J||r.variationName===Z)&&e.includes("*"))}(e,t,r)?e.startsWith(O)?"'".concat(e,"'"):'"'.concat(e,'"'):e.startsWith(O)?"'".concat(e,"'"):e.startsWith(T)||function(e){return e.split(" ").some((function(e){var t=e.toLowerCase();return t===d.AND||t===d.OR}))}(e)?'"'.concat(e,'"'):e},Vt=function(e){return e.includes(",")?e.startsWith(O)?"'".concat(e):'"'.concat(e):e.startsWith(O)?"'".concat(e):e.startsWith(T)?'"'.concat(e):e};function kt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var Bt=function(e){var t=e.data,r=e.filterId,n=e.setAsyncOptionsMap,i=e.setAsyncValueMaps,a=e.setMetaDataForFilter;if(t&&"displayValueToUuidMap"in t&&"displayValueToUuidMap"in t){var o=Object.keys(t.displayValueToUuidMap).reduce((function(e,r){var n=Ut(r);return e.push({label:n,value:t.displayValueToUuidMap[r]}),e}),[]).sort((0,Nt.sortAlphabetically)("label"));i(r,t.uuidToDisplayValueMap),n(r,o),"function"==typeof a&&a(r,t)}},jt=function(e){var t=e.data,r=e.filterId,n=e.setAsyncOptionsMap,i=e.setAsyncValueMaps,a=e.setMetaDataForFilter;if(Array.isArray(t)){var o=t.map((function(e){return{label:Ut(e.label),value:e.value}})).sort((0,Nt.sortAlphabetically)("label"));i(r,t.reduce((function(e,t){return e[t.value.toString()]=t.label,e}),{})),n(r,o),"function"==typeof a&&a(r,t)}},Yt=function(e){var t=e.data,r=e.filterId,n=e.setAsyncOptionsMap,i=e.setAsyncValueMaps,a=e.setMetaDataForFilter;if(Array.isArray(t)){var o=t.map((function(e){return{label:"".concat(Vt(e.label),":"),value:e.value}})).sort((0,Nt.sortAlphabetically)("label"));i(r,t.reduce((function(e,t){return e[t.value.toString()]="".concat(t.label,":"),e}),{})),n(r,o),"function"==typeof a&&a(r,t)}},Ht=function(e,t){var r=null==t?void 0:t[e];return Boolean(r&&"loading"in r&&!0===r.loading)},qt=function(e,t){var r;return"error"in(null!==(r=null==t?void 0:t[e])&&void 0!==r?r:{})},Wt=function(e){var t=e.asyncErrorMapsRef,r=e.filterId,n=e.filtersMeta;if(n&&r in n&&!Ht(r,n)&&!(qt(r,n)||t&&r in t.current)){var i=n[r];return i)?i:null}return null},Qt=function(e){var t=e.asyncErrorMapsRef,r=e.filterId,n=e.filtersMeta;if(n&&r in n&&!Ht(r,n)&&!(qt(r,n)||t&&r in t.current)){var i=n[r];return function(e){return Array.isArray(e)}(i)?i:null}return null},Gt=function(e,t){if(t&&e in t){var r=t[e];if("loading"in r&&!1===r.loading)return!0}return!1},Kt=r(58294),zt=et()($e.Box).withConfig({displayName:"use-date-picker__DatePickerWrapper",componentId:"sc-7d8263-0"})(["position:fixed;top:",";width:0;z-index:",";& .react-datepicker-wrapper{opacity:0;}& input{border:none;padding:0;}"],(,(0,s.themeGet)("zIndices.DATE_PICKER")),Xt=function(e,t,r){return null==e?void 0:e.map((function(e){var n={label:e.label},i=function(e){return"id"in e&&e.id?e.id:"name"in e&&e.name?"variation"in e&&e.variation?"".concat(e.name,".").concat(e.variation):e.name:"value"in e&&!(0,Ke.isNil)(e.value)?e.value:null}(e);return(0,Ke.isNil)(i)||(n.value=i),(0,Ke.isNil)(t)||(n.lastItemStart=t),r&&(n.appendToList=r),"type"in e&&e.type&&e.type in je&&(n.type=e.type),"icon"in e&&(n.icon=e.icon),"iconColor"in e&&(n.iconColor=e.iconColor),"textColor"in e&&(n.textColor=e.textColor),"iconTooltip"in e&&(n.iconTooltip=e.iconTooltip),n}))},$t=r(85061),Jt=(0,Ge.defineMessages)({applyButton:{id:"TDS_QUERY_BUILDER_APPLY_BUTTON",description:"The text for the Search button for the Universal Design.",defaultMessage:"Apply"},placeholder:{id:"TDS_QUERY_BUILDER_PLACEHOLDER",description:"The placeholder text for the input.",defaultMessage:"Enter filter query..."},searchButton:{id:"TDS_QUERY_BUILDER_SEARCH_BUTTON",description:"The text for the Search button.",defaultMessage:"Search"}}),Zt=(0,Ge.defineMessages)({additionalValueOptions:{id:"TDS_QUERY_BUILDER_HEADERS_ADDITIONAL_VALUE_OPTIONS",description:"The options popover header message for the additional value options.",defaultMessage:"Additional Value Options"},conditions:{id:"TDS_QUERY_BUILDER_HEADERS_CONDITION",description:"The options popover header message for the conditions.",defaultMessage:"Conditions"},filters:{id:"TDS_QUERY_BUILDER_HEADERS_FILTERS",description:"The options popover header message for the filters.",defaultMessage:"Filters"},keywords:{id:"TDS_QUERY_BUILDER_HEADERS_KEYWORDS",description:"The options popover header message for the keyword phrases keyword options.",defaultMessage:"Keywords"},nestingOperators:{id:"TDS_QUERY_BUILDER_HEADERS_NESTING_OPERATORS",description:"The options popover header message for the nesting operators.",defaultMessage:"Nesting Operators"},operators:{id:"TDS_QUERY_BUILDER_HEADERS_OPERATORS",description:"The options popover header message for the operators.",defaultMessage:"Operators"},partialFilters:{id:"TDS_QUERY_BUILDER_HEADERS_PARTIAL_FILTERS",description:"The options popover header message for the partial filters.",defaultMessage:"Partial Filters"},partialKeywords:{id:"TDS_QUERY_BUILDER_HEADERS_PARTIAL_KEYWORDS",description:"The options popover header message for the keyword phrases partial keyword options.",defaultMessage:"Partial Keywords"},partialOperators:{id:"TDS_QUERY_BUILDER_HEADERS_PARTIAL_OPERATORS",description:"The options popover header message for the partial operators.",defaultMessage:"Partial Operators"},partialValueOptions:{id:"TDS_QUERY_BUILDER_HEADERS_PARTIAL_VALUE_OPTIONS",description:"The options popover header message for the partial value options.",defaultMessage:"Partial Value Options"},valueHint:{id:"TDS_QUERY_BUILDER_HEADERS_VALUE_HINT",description:"The options popover header message for the value hint.",defaultMessage:"Value Hint"},valueOptions:{id:"TDS_QUERY_BUILDER_HEADERS_VALUE_OPTIONS",description:"The options popover header message for the value options.",defaultMessage:"Value Options"}}),er=(0,Ge.defineMessages)({enterACustomAttributeValue:{id:"TDS_QUERY_BUILDER_ENTER_A_CUSTOM_ATTRIBUTE_VALUE",description:"The info message in the options popover to instruct the user to enter the value of a custom attribute.",defaultMessage:"Enter a custom attribute value."},enterAValidNumber:{id:"TDS_QUERY_BUILDER_ENTER_A_VALID_NUMBER",description:"The info message in the options popover to instruct the user to enter a number for a keyword phrase search.",defaultMessage:"Enter a valid number."},enterAValidNumberWithLimit:{id:"TDS_QUERY_BUILDER_ENTER_A_VALID_NUMBER_WITH_LIMIT",description:"The info message in the options popover to instruct the user to enter a number for a keyword phrase search.",defaultMessage:"Enter a valid number between 1 and {range}."},additionalValuesInfo:{id:"TDS_QUERY_BUILDER_ADDITIONAL_VALUES_INFO",description:'The hover message for the info icon next to the "Additional Value Options" header in the options popover.',defaultMessage:"Select from this list or use commas to add additional values."},warnExceedsOptionDisplayLimit:{id:"TDS_QUERY_BUILDER_WARN_EXCEEDS_OPTIONS_DISPLAY_LIMIT",description:"The warning message when there are more than the limit of options to display in the options popover.",defaultMessage:"Limited to 100 results. Keep typing to refine your search."}}),tr=(0,Ge.defineMessages)({failedToParseCondition:{id:"TDS_QUERY_BUILDER_FAILED_TO_PARSE_CONDITION",description:"The hover text for the status icon when a filter condition fails to be parsed.",defaultMessage:"Failed to parse filter query. Invalid condition: {condition}<br/>Conditions must be AND/OR."},failedToParseDateValue:{id:"TDS_QUERY_BUILDER_FAILED_TO_PARSE_DATE_VALUE",description:"The hover text for the status icon when the date value for the filter and operator is invalid.",defaultMessage:'Failed to parse filter query. Filter "{filter}" has an invalid value for operator "{operator}": {value}'},failedToParseFilter:{id:"TDS_QUERY_BUILDER_FAILED_TO_PARSE_FILTER",description:"The hover text for the status icon when there is no matching filter for the query.",defaultMessage:"Failed to parse filter query. Invalid filter ID: {filterId}"},failedToParseOperator:{id:"TDS_QUERY_BUILDER_FAILED_TO_PARSE_OPERATOR",description:"The hover text for the status icon when there is no matching operator for the query.",defaultMessage:'Failed to parse filter query. Filter "{filter}" has an invalid operator: {operator}'},failedToParseOptionValue:{id:"TDS_QUERY_BUILDER_FAILED_TO_PARSE_OPTION_VALUE",description:"The hover text for the status icon when there is no matching option value for a filter in the query.",defaultMessage:'Failed to parse filter query. Filter "{filter}" has an invalid option value: {value}'}}),rr=(0,Ge.defineMessages)({cannotHaveMultipleValues:{id:"TDS_QUERY_BUILDER_CANNOT_HAVE_MULTIPLE_VALUES",description:"The hover text for the status icon when a filter has commas in the value and cannot have multiple values.",defaultMessage:'Filter "{filter}" cannot have multiple values. Remove any commas.'},cannotHaveMultipleValuesForOperator:{id:"TDS_QUERY_BUILDER_CANNOT_HAVE_MULTIPLE_VALUES_FOR_OPERATOR",description:"The hover text for the status icon when a filter has commas in the value and the operator does not allow multiple values.",defaultMessage:'Filter "{filter}" with operator "{operator}" cannot have multiple values. Remove any commas.'},cannotHaveMultipleValuesAddQuotes:{id:"TDS_QUERY_BUILDER_CANNOT_HAVE_MULTIPLE_VALUES_ADD_QUOTES",description:"The hover text for the status icon when a filter has commas in the value and cannot have multiple values, but can be wrapped in quotes.",defaultMessage:'Filter "{filter}" has commas in the value, but cannot have multiple values. Remove any commas or add double quotes around the value to include the commas.'},duplicateOptionValue:{id:"TDS_QUERY_BUILDER_DUPLICATE_OPTION_VALUE",description:"The hover text for the status icon when a filter has the same option value more than once.",defaultMessage:'Filter "{filter}" has a duplicate option: {value}<br/>An option can only be used once per filter.'},emptyOpenNotConditional:{id:"TDS_QUERY_BUILDER_EMPTY_OPEN_NOT_CONDITIONAL",description:"The hover text for the status icon when the filter query has an opening nesting parenthesis, but not filter following it.",defaultMessage:"No filter specified after a NOT conditional."},emptyOpenParenthesis:{id:"TDS_QUERY_BUILDER_EMPTY_OPEN_PARENTHESIS",description:"The hover text for the status icon when the filter query has an opening nesting parenthesis, but not filter following it.",defaultMessage:"No filter specified after an opening, nesting parenthesis."},endDateIsBeforeStartDate:{id:"TDS_QUERY_BUILDER_END_DATE_IS_BEFORE_START_DATE",description:"The hover text for the status icon when an end date is before a start date for the between operator of a date filter.",defaultMessage:'Filter "{filter}" has end date {endDate} before start date {startDate}. End date must be after start date.'},endsWithCondition:{id:"TDS_QUERY_BUILDER_ENDS_WITH_CONDITION",description:"The hover text for the status icon when the filter query ends in a condition (AND/OR).",defaultMessage:"Filter query cannot end in a condition (AND/OR). Remove condition or add additional filters."},exceededFilterLimit:{id:"TDS_QUERY_BUILDER_EXCEEDED_FILTER_LIMIT",description:"The hover text for the status icon when number of filters specified exceeds the limit of filters that can be set.",defaultMessage:"Only {limit} filters can be specified at one time."},exceededMaxNestedLimit:{id:"TDS_QUERY_BUILDER_EXCEEDED_MAX_NESTED_LIMIT",description:"The hover text for the status icon when number of filters specified exceeds the max number of nested levels of filters.",defaultMessage:"Filters may only be nested {maxNestedLevel} levels deep."},fetchingFilterOptions:{id:"TDS_QUERY_BUILDER_FETCHING_FILTER_OPTIONS",description:"The hover text for the status icon when an async filter is fetching its option values.",defaultMessage:"Fetching filter options..."},failedFetchingFilterOptions:{id:"TDS_QUERY_BUILDER_FAILED_FETCHING_FILTER_OPTIONS",description:"The hover text for the status icon when we have failed to fetch the option values for an async filter.",defaultMessage:"Failed to fetch filter options for filter: {filter}"},failedFetchingPhraseOptions:{id:"TDS_QUERY_BUILDER_FAILED_FETCHING_PHRASE_OPTIONS",description:"The hover text for the status icon when we have failed to fetch the keyword option for an async filter phrase.",defaultMessage:"Failed to fetch keyword options for phrase."},incompleteBetweenDatePreposition:{id:"TDS_QUERY_BUILDER_INCOMPLETE_BETWEEN_DATE_PREPOSITION",description:"The hover text for the status icon when the preposition for a date filter between operator is incomplete.",defaultMessage:'Filter "{filter}" has an incomplete preposition between dates: {preposition}<br/>Must be "to" in the format "{dateFormat} to {dateFormat}"'},incompleteCondition:{id:"TDS_QUERY_BUILDER_INCOMPLETE_CONDITION",description:"The hover text for the status icon when there is an incomplete condition, a partial filter match in the query.",defaultMessage:"Incomplete condition: {condition}"},incompleteDateDurationUnit:{id:"TDS_QUERY_BUILDER_INCOMPLETE_DATE_DURATION_UNIT",description:"The hover text for the status icon when there is an incomplete date duration unit for a date filter and duration operator.",defaultMessage:'Filter "{filter}" has an incomplete date duration unit: {unit}'},incompleteFilter:{id:"TDS_QUERY_BUILDER_INCOMPLETE_FILTER",description:"The hover text for the status icon when there is an incomplete filter, a partial filter match in the query.",defaultMessage:"Incomplete filter: {filter}"},incompleteKeyValuePairValue:{id:"TDS_QUERY_BUILDER_KEY_VALUE_PAIR_VALUE",description:"The hover text for the status icon when there is an key-value pair filter option value but no text value after the colon.",defaultMessage:'Filter "{filter}" expects a text value after the colon to complete the filter value.'},incompleteOperator:{id:"TDS_QUERY_BUILDER_INCOMPLETE_OPERATOR",description:"The hover text for the status icon when there is an incomplete operator, a partial operator match in the query.",defaultMessage:'Filter "{filter}" has an incomplete operator: {operator}'},incompleteOptionValue:{id:"TDS_QUERY_BUILDER_INCOMPLETE_OPTION_VALUE",description:"The hover text for the status icon when there is an incomplete filter option value, a partial filter option value match in the query.",defaultMessage:'Filter "{filter}" has an incomplete option value: {value}'},incompletePhrase:{id:"TDS_QUERY_BUILDER_INCOMPLETE_PHRASE",description:"The hover text for the status icon when there is an incomplete phrase.",defaultMessage:'Phrase "{phrase}" is incomplete.'},incompletePhraseKeyword:{id:"TDS_QUERY_BUILDER_INCOMPLETE_PHRASE_KEYWORD",description:"The hover text for the status icon when there is an incomplete keyword for a phrase.",defaultMessage:'Phrase "{phrase}" has an incomplete keyword: {keyword}'},incompletePhraseStartingKeyword:{id:"TDS_QUERY_BUILDER_INCOMPLETE_PHRASE_STARTING_KEYWORD",description:"The hover text for the status icon when there is an incomplete starting keyword for a phrase.",defaultMessage:"Phrase has an incomplete starting keyword: {keyword}"},invalidBetweenDatePreposition:{id:"TDS_QUERY_BUILDER_INVALID_BETWEEN_DATE_PREPOSITION",description:"The hover text for the status icon when the preposition for a date filter between operator is invalid.",defaultMessage:'Filter "{filter}" has an invalid preposition between dates: {preposition}<br/>Must be "to" in the format "{dateFormat} to {dateFormat}"'},invalidCondition:{id:"TDS_QUERY_BUILDER_INVALID_CONDITION",description:"The hover text for the status icon when there is no matching condition for the query.",defaultMessage:"Invalid condition: {condition}<br/>Conditions must be AND/OR."},invalidDate:{id:"TDS_QUERY_BUILDER_INVALID_DATE",description:"The hover text for the status icon when a date value is invalid for a date filter.",defaultMessage:'Filter "{filter}" has an invalid date: {date}<br/>Must be format {dateFormat}'},invalidDateDurationValue:{id:"TDS_QUERY_BUILDER_INVALID_DATE_DURATION_VALUE",description:"The hover text for the status icon when there is an invalid date duration value for a date filter.",defaultMessage:'Filter "{filter}" has an invalid date duration: {duration}<br/>Must be an integer.'},dateDurationValueExceedsMax:{id:"TDS_QUERY_BUILDER_DATE_DURATION_VALUE_EXCEEDS_MAX",description:"The hover text for the status icon when there is a date duration value that exceeds allowed maximum for the given duration unit in a date filter.",defaultMessage:'Filter "{filter}" has an invalid date duration: {duration} {durationUnit}<br/>Must be an integer between 1 and {maxValue}.'},invalidDateDurationUnit:{id:"TDS_QUERY_BUILDER_INVALID_DATE_DURATION_UNIT",description:"The hover text for the status icon when date duration unit is invalid for a date filter and duration operator.",defaultMessage:'Filter "{filter}" has an invalid date duration unit: {unit}<br/>Must be {duration, plural, one {hour, day, month, or year} other {hours, days, months, or years}}'},invalidEndDate:{id:"TDS_QUERY_BUILDER_INVALID_END_DATE",description:"The hover text for the status icon when a date value is invalid for a date filter.",defaultMessage:'Filter "{filter}" has an invalid end date: {date}<br/>Must be format {dateFormat}'},invalidFilter:{id:"TDS_QUERY_BUILDER_INVALID_FILTER",description:"The hover text for the status icon when there is no matching filter for the query.",defaultMessage:"Invalid filter: {filter}"},invalidFilterQuery:{id:"TDS_QUERY_BUILDER_INVALID_FILTER_QUERY",description:"The hover text for the status icon when there is a generic error with the filter query.",defaultMessage:"Invalid filter query."},invalidOperator:{id:"TDS_QUERY_BUILDER_INVALID_OPERATOR",description:"The hover text for the status icon when there is no matching operator for the query.",defaultMessage:'Filter "{filter}" has an invalid operator: {operator}'},invalidOptionValue:{id:"TDS_QUERY_BUILDER_INVALID_OPTION_VALUE",description:"The hover text for the status icon when there is no matching option value for a filter in the query.",defaultMessage:'Filter "{filter}" has an invalid option value: {value}'},invalidPhraseKeyword:{id:"TDS_QUERY_BUILDER_INVALID_PHRASE_KEYWORD",description:"The hover text for the status icon when there is an invalid keyword for a phrase.",defaultMessage:'Phrase "{phrase}" has an invalid keyword: {keyword}'},invalidPhraseNumber:{id:"TDS_QUERY_BUILDER_INVALID_PHRASE_NUMBER",description:"The hover text for the status icon when there is an invalid number for a phrase.",defaultMessage:'Phrase "{phrase}" expected a number and received an invalid value: {value}'},invalidStartDate:{id:"TDS_QUERY_BUILDER_INVALID_START_DATE",description:"The hover text for the status icon when a date value is invalid for a date filter.",defaultMessage:'Filter "{filter}" has an invalid start date: {date}<br/>Must be format {dateFormat}'},invalidValue:{id:"TDS_QUERY_BUILDER_INVALID_VALUE",description:"The hover text for the status icon when there is an error in the filter value for a filter in the query.",defaultMessage:'Filter "{filter}" has an invalid value: {value}<br/>{patternError}'},invalidWildcardValues:{id:"TDS_QUERY_BUILDER_INVALID_WILDCARD_VALUES",description:"The hover text for the status icon when there is a wildcard character both inside and outside quotes.",defaultMessage:'Filter "{filter}" has an invalid value.<br/>Cannot use wildcard both inside and outside of quotes within filter value.'},missingBetweenDatePreposition:{id:"TDS_QUERY_BUILDER_MISSING_BETWEEN_DATE_PREPOSITION",description:"The hover text for the status icon when the preposition for a date filter between operator is missing.",defaultMessage:'Filter "{filter}" is missing the preposition between dates. Must be "to" in the format "{dateFormat} to {dateFormat}"'},missingClosingDoubleQuote:{id:"TDS_QUERY_BUILDER_MISSING_CLOSING_DOUBLE_QUOTE",description:"The hover text for the status icon when a filter value starts with a double quote but does not end in a double quote.",defaultMessage:'Filter "{filter}" has a value that starts with a double quote, but has no ending double quote. Add a double quote to the end of the value.'},missingClosingSingleQuote:{id:"TDS_QUERY_BUILDER_MISSING_CLOSING_SINGLE_QUOTE",description:"The hover text for the status icon when a filter value starts with a single quote but does not end in a single quote.",defaultMessage:'Filter "{filter}" has a value that starts with a single quote, but has no ending single quote. Add a single quote to the end of the value.'},missingDateDurationUnit:{id:"TDS_QUERY_BUILDER_MISSING_DATE_DURATION_UNIT",description:"The hover text for the status icon when date duration unit is missing for a date filter and duration operator.",defaultMessage:'Filter "{filter}" is missing the date duration unit. Must be {duration, plural, one {hour, day, month, or year} other {hours, days, months, or years}}'},missingEndDate:{id:"TDS_QUERY_BUILDER_MISSING_END_DATE",description:"The hover text for the status icon when a date filter between operator is missing its ending date.",defaultMessage:'Filter "{filter}" is missing the end date. Must be in the format "{dateFormat} to {dateFormat}"'},missingEndingParenthesis:{id:"TDS_QUERY_BUILDER_MISSING_ENDING_PARENTHESIS",description:"The hover text for the status icon when a filter query has an opening nesting parenthesis but no matching closing parenthesis.",defaultMessage:"A nested set of filters is missing its closing parenthesis. Add a closing parenthesis to the end of the nested filters set."},missingEndingNotParenthesis:{id:"TDS_QUERY_BUILDER_MISSING_ENDING_NOT_PARENTHESIS",description:"The hover text for the status icon when a filter query has an opening NOT conditional but no matching closing parenthesis.",defaultMessage:"A NOT conditional is missing its closing parenthesis. Add a closing parenthesis to the end of the NOT conditional."},missingOperator:{id:"TDS_QUERY_BUILDER_MISSING_OPERATOR",description:"The hover text for the status icon when there is a filter with no operator.",defaultMessage:"No operator specified for filter: {filter}"},missingValue:{id:"TDS_QUERY_BUILDER_MISSING_VALUE",description:"The hover text for the status icon when there is a filter with no value.",defaultMessage:"No value specified for filter: {filter}"},multipleErrors:{id:"TDS_QUERY_BUILDER_MULTIPLE_ERRORS",description:"The starting hover text for the status icon when there are multiple errors.",defaultMessage:"Multiple parse errors:{errors}"},multipleErrorsItem:{id:"TDS_QUERY_BUILDER_MULTIPLE_ERRORS_ITEM",description:"The individual error row for the hover text for the status icon when there are multiple errors.",defaultMessage:"<br/>{error}"},nestedFiltersEndWithComma:{id:"TDS_QUERY_BUILDER_NESTED_FILTERS_END_WITH_COMMA",description:"The hover text for the status icon when there is a filter value that ends in a comma.",defaultMessage:"A nested set of filters has a comma after the closing parenthesis. Remove the comma."},noOptions:{id:"TDS_QUERY_BUILDER_NO_OPTIONS",description:"The hover text for the status icon when there is a filter with no options available.",defaultMessage:'Filter "{filter}" has no available options.'},topLevelConditionMismatch:{id:"TDS_QUERY_BUILDER_TOP_LEVEL_CONDITION_MISMATCH",description:"The hover text for the status icon when there is a mismatch in the top level conditions",defaultMessage:"The top level condition does not match between filters, must be all AND or all OR. Use parentheses to nest filters to use different conditions."},validFilterQuery:{id:"TDS_QUERY_BUILDER_VALID_FILTER_QUERY",description:"The hover text for the status icon when there is a valid filter query.",defaultMessage:"Valid filter query."},valueEndsWithComma:{id:"TDS_QUERY_BUILDER_VALUE_ENDS_WITH_COMMA",description:"The hover text for the status icon when there is a filter value that ends in a comma.",defaultMessage:'Filter "{filter}" has a comma at the end of its value. Remove the comma or add another value.'},valueLimitExceeded:{id:"TDS_QUERY_BUILDER_VALUE_LIMIT_EXCEEDED",description:"The hover text for the status icon when there is a filter that exceeds the limit for the number of values.",defaultMessage:'Filter "{filter}" can only include a maximum of {limit} values. Currently {total} values.'},valueMaxLengthExceeded:{id:"TDS_QUERY_BUILDER_VALUE_MAX_LENGTH_EXCEEDED",description:"The hover text for the status icon when there is a filter that exceeds the max length for the number of characters in its values.",defaultMessage:'Filter "{filter}" can only include a maximum of {maxLength} characters in its values. At least one value exceeds this length.'},willExceedFilterLimit:{id:"TDS_QUERY_BUILDER_WILL_EXCEED_FILTER_LIMIT",description:"The hover text for the status icon when ",defaultMessage:"Cannot add any more filters. It will exceed the limit of {limit} filters."}}),nr=function(e,t,r){var n={label:t(e),type:je.HEADER};return r&&(n.iconTooltip=t(r)),n},ir=Object.values(we),ar=or=function(e){return Object.entries(de).map((function(t){return{label:t[1]+(1!==e?"s":""),value:t[0]}})).reverse()};function sr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function lr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?sr(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ur=function e(t,r){var n=Object.keys(t.descendants),i=n.length,a=t.label,o=r;if(!t.filters&&!t.phraseId&&1===i&&!ar(n[0])){var s=n[0],l=e(t.descendants[s],s);a="".concat(a," ").concat(l.label),o=Array.isArray(l.keys)?[r].concat((0,$t.default)(l.keys)):[r,l.keys]}return{label:a,keys:o}},cr=function(e,t,r){if(!e)return{keywords:[]};for(var n,i=Object.keys(e).filter(().map((function(t){var r=ur(e[t],t),n=r.label,i=r.keys;return{label:n,type:Ve,value:i}})),a=0,o=Object.keys(e);a<o.length;a++){var s=o[a];if(s===we.DURATION_UNIT){var l,u,c=null!==(l=null==t?void 0:t.values.length)&&void 0!==l?l:0,d=c>0?Number(null==t||null===(u=t.values[c-1])||void 0===u?void 0:u.value):0,p=isNaN(d)?0:d,f=or(p).map((function(e){return lr(lr({},e),{},{type:Pe})}));i.push.apply(i,(0,$t.default)(f))}else if(s===we.OPTION_LIST)e[s].items.forEach((function(e,t){e.options.forEach((function(e){var r=lr(lr({},e),{},{itemIndex:t,type:Ue});i.push(r)}))}));else if(s===we.ASYNC_OPTION_LIST){var h=e[s];n=h.asyncFilter;var v=h.getOptions(r);if(null===v)return{asyncFilter:n,error:!0,keywords:[]};var g=v.map((function(e){return lr(lr({},e),{},{type:Ce})}));i.push.apply(i,(0,$t.default)(g))}}return{asyncFilter:n,keywords:i.sort((0,Nt.sortAlphabetically)("label"))}},dr=function(e){var t=e.allowNotCondition,r=e.expectedFieldState,n=e.filters,i=e.fieldState,a=e.phraseTree,o=(0,Ge.useIntl)().formatMessage,s=We().useState([]),l=(0,He.default)(s,2),u=l[0],c=l[1],d=We().useState((function(){var e;return null!==(e=Xt(n))&&void 0!==e?e:[]})),p=(0,He.default)(d,2),f=p[0],h=p[1],v=We().useState((function(){return t?S:[g]})),m=(0,He.default)(v,2),I=m[0],E=m[1],b=We().useState([]),y=(0,He.default)(b,2),O=y[0],T=y[1],x=We().useState((function(){return Xt(cr(a).keywords)})),F=(0,He.default)(x,2),R=F[0],C=F[1],P=We().useState((),V=(0,He.default)(P,2),k=V[0],B=V[1],j=We().useState([]),Y=(0,He.default)(j,2),H=Y[0],q=Y[1],W=We().useState([]),Q=(0,He.default)(W,2),G=Q[0],K=Q[1],z=We().useCallback((function(e){c(Xt(e.possibleConditions)),h(Xt(e.possibleFilters,e.partialLastItemStartMap.FILTER)),E(Xt(e.possibleNestingOptions)),T(Xt(e.possibleOperators,e.partialLastItemStartMap.OPERATOR)),C(Xt(e.possiblePhraseOptions)),B(Xt(e.possiblePartialPhraseOptions,e.partialLastItemStartMap.PHRASE_KEYWORD)),q(Xt(e.valueHintPopoverOptions)),K(Xt(e.possibleValueOptions,e.partialLastItemStartMap.VALUE,e.expectedFieldState===M))}),[]),X=We().useMemo((function(){return function(e){var t=e.formatMessage,r=e.valueHintOptions,n=function(e){var t=e.conditionOptions,r=e.expectedFieldState,n=e.fieldState,i=e.filterOptions,a=e.formatMessage,o=e.nestingOptions,s=e.operatorOptions,l=e.partialPhraseOptions,u=e.phraseOptions,c=e.valueOptions;if(n===w)return[];switch(r){case _:return function(e){var t=e.filterOptions,r=e.formatMessage,n=e.nestingOptions,i=e.phraseOptions,a=[];return t.length>0&&(a=[nr(Zt.filters,r)].concat((0,$t.default)(t))),i.length>0&&(a=[].concat((0,$t.default)(a),[nr(Zt.keywords,r)],(0,$t.default)(i))),n.length>0&&(a=[].concat((0,$t.default)(a),[nr(Zt.nestingOperators,r)],(0,$t.default)(n))),a}({filterOptions:i,formatMessage:a,nestingOptions:o,phraseOptions:u});case D:return function(e){var t=e.filterOptions,r=e.formatMessage,n=e.operatorOptions,i=[];return t.length>0&&(i=[nr(Zt.partialFilters,r)].concat((0,$t.default)(t))),n.length>0&&(i=[].concat((0,$t.default)(i),[nr(Zt.operators,r)],(0,$t.default)(n))),i}({filterOptions:i,formatMessage:a,operatorOptions:s});case L:return function(e){var t=e.formatMessage,r=e.operatorOptions,n=e.valueOptions,i=[];return r.length>0&&(i=[nr(Zt.partialOperators,t)].concat((0,$t.default)(r))),n.length>0&&(i=[].concat((0,$t.default)(i),[nr(Zt.valueOptions,t)],(0,$t.default)(n))),i}({formatMessage:a,operatorOptions:s,valueOptions:c});case M:case A:return function(e){var t=e.conditionOptions,r=e.expectedFieldState,n=e.formatMessage,i=e.partialPhraseOptions,a=e.phraseOptions,o=e.valueOptions;if(o.length>0&&t.length>0)return r===M?[nr(Zt.conditions,n)].concat((0,$t.default)(t),[nr(Zt.additionalValueOptions,n,er.additionalValuesInfo)],(0,$t.default)(o)):[nr(Zt.partialValueOptions,n)].concat((0,$t.default)(o),[nr(Zt.conditions,n)],(0,$t.default)(t));if(o.length>0)return[nr(Zt.partialValueOptions,n)].concat((0,$t.default)(o));var s=[];return i.length>0&&(s=[].concat((0,$t.default)(s),[nr(Zt.partialKeywords,n)],(0,$t.default)(i))),a.length>0&&(s=[].concat((0,$t.default)(s),[nr(Zt.keywords,n)],(0,$t.default)(a))),t.length>0&&(s=[].concat((0,$t.default)(s),[nr(Zt.conditions,n)],(0,$t.default)(t))),s}({conditionOptions:t,expectedFieldState:r,formatMessage:a,partialPhraseOptions:l,phraseOptions:u,valueOptions:c});case U:return function(e){var t=e.conditionOptions,r=e.formatMessage,n=e.partialPhraseOptions,i=e.phraseOptions,a=[];return n.length>0&&(a=[].concat((0,$t.default)(a),[nr(Zt.partialKeywords,r)],(0,$t.default)(n))),i.length>0&&(a=[].concat((0,$t.default)(a),[nr(Zt.keywords,r)],(0,$t.default)(i))),t.length>0&&(a=[].concat((0,$t.default)(a),[nr(Zt.conditions,r)],(0,$t.default)(t))),a}({conditionOptions:t,formatMessage:a,partialPhraseOptions:l,phraseOptions:u});case N:return function(e){var t=e.formatMessage,r=e.partialPhraseOptions,n=e.phraseOptions,i=[];return r.length>0&&(i=[].concat((0,$t.default)(i),[nr(Zt.partialKeywords,t)],(0,$t.default)(r))),n.length>0&&(i=[].concat((0,$t.default)(i),[nr(Zt.keywords,t)],(0,$t.default)(n))),i}({formatMessage:a,partialPhraseOptions:l,phraseOptions:u});default:return[]}}({conditionOptions:e.conditionOptions,expectedFieldState:e.expectedFieldState,fieldState:e.fieldState,filterOptions:e.filterOptions,formatMessage:t,nestingOptions:e.nestingOptions,operatorOptions:e.operatorOptions,partialPhraseOptions:e.partialPhraseOptions,phraseOptions:e.phraseOptions,valueOptions:e.valueOptions});return r.length>0?[nr(Zt.valueHint,t)].concat((0,$t.default)(r),(0,$t.default)(n)):n}({conditionOptions:u,expectedFieldState:r,fieldState:i,filterOptions:f,formatMessage:o,nestingOptions:I,operatorOptions:O,partialPhraseOptions:k,phraseOptions:R,valueHintOptions:H,valueOptions:G})}),[u,r,i,f,o,I,O,k,R,H,G]),$=We().useMemo((function(){return X.filter(()}),[X]);return{popoverOptions:X,selectablePopoverOptions:$,setPopoverOptions:z}},pr=function(e){var t,r,n=e.height,i=e.popoverRef,a=e.top,o=(null!==(t=null===(r=i.current)||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==t?t:{height:0}).height,s=a-o-G,l=a+n+G;return a+n+o+G>window.innerHeight&&s>=0?s:l},fr=et().div.withConfig({displayName:"options-popover-styles__Popover",componentId:"sc-7xiyow-0"})(["background-color:"," !important;border-color:",";border-radius:",";border-style:solid;border-width:1px;box-shadow:0px 2px 12px 6px ",";left:","px;line-height:",";max-height:",";max-width:",";min-width:",";opacity:1;overflow-y:auto;pointer-events:all !important;position:fixed;top:","px;z-index:"," !important;"],(0,s.themeGet)("colors.background.popover"),(0,s.themeGet)("colors.border.base"),(0,s.themeGet)("radii.3"),(function(e){return s.utils.getThemeColorWithAlpha({color:"colors.shadow.base",alpha:.25},e)}),(function(e){return e.left}),(0,s.rems)("16"),(0,s.rems)("300"),(function(e){return e.maxWidth?(0,s.rems)(e.maxWidth):(0,s.rems)("300")}),(0,s.rems)("256"),(function(e){return e.top}),(0,s.themeGet)("zIndices.TOOLTIP"));fr.displayName="Popover";var hr=et().div.withConfig({displayName:"options-popover-styles__PopoverContent",componentId:"sc-7xiyow-1"})(["padding:"," 0;"],(0,s.rems)("8")),vr=et().div.withConfig({displayName:"options-popover-styles__PopoverFooter",componentId:"sc-7xiyow-2"})(["color:",";font-family:",";font-size:",";padding-left:",";padding-right:",";padding-bottom:",";"],(0,s.themeGet)("colors.text.info-message"),(0,s.themeGet)("fonts.REGULAR"),(0,s.rems)("12"),(0,s.rems)("16"),(0,s.rems)("16"),(0,s.rems)("16")),gr=et().div.withConfig({displayName:"options-popover-styles__PdsPopover",componentId:"sc-7xiyow-3"})(["background-color:"," !important;border-color:",";border-radius:6px;border-style:solid;border-width:1px;box-shadow:0px 1px 10px ",";left:","px;line-height:",";max-height:",";max-width:",";min-width:",";opacity:1;overflow-y:auto;padding-bottom:",";padding-top:",";pointer-events:all !important;position:fixed;top:","px;z-index:"," !important;"],(0,s.themeGet)("pds.colors.background-component"),(0,s.themeGet)("pds.colors.border-base"),(,(function(e){return e.left}),(0,s.rems)("16"),(0,s.rems)("300"),(function(e){return e.maxWidth?(0,s.rems)(e.maxWidth):(0,s.rems)("300")}),(0,s.rems)("256"),(0,s.rems)("8"),(0,s.rems)("8"),(function(e){return e.top}),(0,s.themeGet)("zIndices.TOOLTIP")),mr=et().div.withConfig({displayName:"options-popover-styles__PdsPopoverFooter",componentId:"sc-7xiyow-4"})(["color:",";font-family:",";font-size:",";padding-bottom:",";padding-left:",";padding-right:",";padding-top:",";"],(0,s.themeGet)("pds.colors.text-alt"),(0,s.themeGet)("pds.fonts.base"),(0,s.rems)("12"),(0,s.rems)("16"),(0,s.rems)("16"),(0,s.rems)("16"),(0,s.rems)("8")),Ir=function(e){var t=e.currentValue,r=e.selectedLabel,n=e.queryBuilderInput,i=e.appendToList;if(""===t)n.setText("".concat(r," "));else if("("===t)n.setText("(".concat(r," "));else if(t.endsWith("("))n.setText("".concat(t).concat(r," "));else{var a=i?",":"";n.setText("".concat(t).concat(a," ").concat(r," "))}};function Er(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function br(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Er(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Er(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var yr=function(e){var t,r=e.arePopoverOptionsLoading,n=e.datePickerShowRef,i=e.exceedsAsyncOptionDisplayLimit,a=e.lastItemStart,l=e.popoverOptions,u=e.popoverRef,c=e.popoverShowRef,d=e.popoverState,p=e.onParseStringInput,f=e.queryBuilderInput,h=e.selectablePopoverOptions,v=e.selectedPopoverIndex,g=e.setPopoverState,m=e.setSelectedPopoverIndex,I=(0,Ge.useIntl)().formatMessage,E=We().useContext(s.IsUniversalDesignContext),b=h&&null!==v&&v<(null!==(t=null==h?void 0:h.length)&&void 0!==t?t:0)?h[v]:null,y=b&&"string"!=typeof b?b.value:null,S=We().useMemo((function(){return E?l:l.map(()}),[E,l]);We().useEffect((function(){var e=function(e){var t;!1!==c.current&&(!e.target||e.target===u.current||(null===(t=u.current)||void 0===t?void 0:t.contains(e.target))||e.target===f.getElement()||f.contains(e.target)||(g({show:!1,top:null,left:null,maxWidth:null}),m(null)))},t=function(){var e=f.getElement();if(e&&!1!==c.current){var t=e.getBoundingClientRect(),r=t.top,n=t.left,i=t.height,a=t.width;g({show:!0,top:r+i+G,left:n,maxWidth:a})}};return document.body.addEventListener("mousedown",e),document.addEventListener("scroll",t),),[u,c,g,m,f]),We().useEffect((function(){if(u.current&&c.current&&null!==v){var e=u.current.getElementsByClassName(o.POPOVER_MENU_ITEM_CLASS_NAME);e.length>0&&v<e.length&&e[v].scrollIntoView({block:"center"})}}),[u,c,v]),We().useLayoutEffect((function(){if(u.current&&c.current){var e=u.current.getBoundingClientRect(),t=e.bottom,r=e.height;if(t>window.innerHeight){var n=f.getElement();if(!n)return;var i=n.getBoundingClientRect().top-r-G;i>=0&&g(()}}}),[S,u,c,d.show,f,g]);var O=function(e){var t,r=null!==(t=e.lastItemStart)&&void 0!==t?t:a,n=f.getText().trim().substring(0,r).trim(),i=e.label,o=e.appendToList;Ir({currentValue:n,selectedLabel:i,queryBuilderInput:f,appendToList:o}),f.isChipMode()||(p(f.getText()),f.focus())};if(!(null==d?void 0:d.show)||n.current||!r&&0===S.length)return null;var T=E?gr:fr;return We().createElement(T,{left:d.left,maxWidth:d.maxWidth,ref:u,top:d.top},function(){if(r)return We().createElement(hr,null,We().createElement($e.Flex,{flexDirection:"column",px:8},Array(6).fill("").map((function(e,t){return We().createElement($e.Box,{mt:0!==t?8:0,key:t},We().createElement(ct.SkeletonBlock,{height:(0,s.rems)("24"),width:(0,s.rems)("256")}))}))));var e=E?mr:vr,t=i?We().createElement(e,null,I(er.warnExceedsOptionDisplayLimit)):null,n=We().createElement(o.PopoverMenuContent,{actions:S,onMenuItemClicked:O,selectedValue:y});return E?We().createElement(We().Fragment,null,n,t):We().createElement(We().Fragment,null,We().createElement(hr,null,n),t)}())},Sr=r(88469),Or=function(e){var t=e.errorMessages,r=e.fieldState,n=e.isErrorState,i=e.tooltipDirection,a=(0,Ge.useIntl)().formatMessage;return We().useEffect((),r===F?We().createElement(Xe.SyncIcon,{color:"colors.chart.status.good","data-place":i,"data-tip":a(rr.fetchingFilterOptions),size:20}):n?function(){var e;if(1===t.length){var r=t[0],n=r.message,o=r.values;e="".concat(a(n,o))}else if(t.length>1){var s=t.reduce((function(e,t){var r=t.message,n=t.values,i="".concat(a(r,n)),o=a(rr.multipleErrorsItem,{error:i});return"".concat(e).concat(o)}),"");e=a(rr.multipleErrors,{errors:s})}else e=a(rr.invalidFilterQuery);return We().createElement(Xe.ValidationIcon,{color:"colors.chart.status.bad","data-place":i,"data-tip":e,size:20})}():We().createElement(Xe.StateFixedIcon,{color:"colors.chart.status.good","data-place":i,"data-tip":a(rr.validFilterQuery),size:20})},Tr=r(8581),xr=function(e){var t=e.isErrorState,r=e.isLoading,n=e.isUniversalDesign,i=e.maxHeight,a=e.onClearClick,o=e.onTextInputChange,s=e.onTextInputFocus,l=e.onTextInputKeyDown,u=e.queryBuilderInput,c=e.statusIcon,d=(0,Ge.useIntl)().formatMessage;return r?n?We().createElement(at,{error:t,height:Me,isUniversalDesign:!0,maxHeight:i},We().createElement($e.Flex,{alignItems:"center",height:"100%",width:"100%"},We().createElement(dt,{isUniversalDesign:!0,mx:16}))):We().createElement(dt,null):We().createElement(Tr.TextArea,{borderRadius:"none",errorBorder:t,getRef:u.setRef,height:n?Me:Ae,isTextInputStyle:!0,isUniversalDesign:n,lineHeight:n?Re:Fe,leftIcon:c,maxHeight:i,onChange:o,onClear:a,onFocus:s,onKeyDown:l,placeholder:d(Jt.placeholder),showClear:!0})},_r=r(90484),Dr=function(e){return e.startsWith(T)&&e.endsWith(T)||e.startsWith(O)&&e.endsWith(O)},Lr=function Ar(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Mr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ar(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ar(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Fr=function(e){if("string"==typeof e){var t=Number(e);return t!==parseFloat(e)||isNaN(t)?e:t}return e},Rr=function e(t){var r=(0,a.default)({},t.condition.value,t.completedFilters.map((function(t){if("condition"in t)return function(e){var t,r=null!==(t=null==e?void 0:e.and)&&void 0!==t?t:null==e?void 0:e.or;return r&&1===(null==r?void 0:r.length)?e.phraseId?Mr(Mr({},r[0]),{},{phraseId:e.phraseId}):r[0]:e}(e(t));var r=t.filter,n=t.operator,i=t.value,a={id:r.id,isFilterSet:!0,operator:n.name};if(se.includes(n.name))return n.variation&&(a.operatorVariation=n.variation),a;a.value=function(e,t){var r=Array.isArray(t)?t.map((function(e){return e.value})):t.value;if(e===K.NUMERIC){if(Array.isArray(r))return Fr(r[0]);if("string"==typeof r)return Fr(r)}return e===K.NUMERIC_MULTI&&Array.isArray(r)?r.map((function(e){return Fr(e)})):e===K.KEY_VALUE_FILTER&&Array.isArray(r)&&Array.isArray(t)?r.map((function(e,r){return"object"===(0,_r.default)(e)&&"value"in e&&Dr(t[r].label)?Mr(Mr({},e),{},{value:e.value.slice(0,-1)}):e})):e!==K.SELECTION_MULTI&&e!==K.SELECTION_MULTI_ASYNC&&e!==K.TAG&&e!==K.TEXT_AREA&&Array.isArray(r)&&1===r.length?r[0]:r}(r.type,i);var o=Array.isArray(i)?i.map(():i.label;return n.variation&&n.variation!==oe&&(a.operatorVariation=n.variation),n.variation===oe&&n.variationName&&(Array.isArray(o)?o.some(Lr):Lr(o))&&(a.operator=n.variationName),a})));return t.phraseId&&(r.phraseId=t.phraseId),r},wr=function(e){return function(e,t){var r=e[t];if(1===(null==r?void 0:r.length)){var n=r[0];if(!("id"in n))return n}return e}(Rr(e),e.condition.value)},Cr=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t)switch(t.type){case K.TAG:case K.SELECTION_MULTI_ASYNC:case K.KEY_VALUE_FILTER:e[t.type].initialize(t.id,t.onLoad,r)}},Pr=r(29801),Nr=r.n(Pr),Ur=function(e){var t=e.match(e&&"+"===e.charAt(0)?b:E);if(t){var r,n,i=null!==(r=t[1])&&void 0!==r?r:t[3],a=null!==(n=t[2])&&void 0!==n?n:t[4];return!isNaN(Number(i))&&Number.isInteger(parseInt(i))&&a in de?function(e,t){var r=1===(parseInt(e)||0)?de[t]:"".concat(de[t],"s");return"".concat(e," ").concat(r)}(i,a):null}var o=Nr()(e,Nr().ISO_8601,!0);return o.isValid()?o.format(m):null},Vr=function(e,t){var r,n,i;if(e===$)return null!==(r=null==t||null===(n=t.toString)||void 0===n?void 0:n.call(t))&&void 0!==r?r:"";if("between"===e&&Array.isArray(t)&&2===t.length){var a=t.map((function(e){var t;return Nr()(null==e||null===(t=e.toString)||void 0===t?void 0:t.call(e))})),o=(0,He.default)(a,2),s=o[0],l=o[1];if(!s.isValid()||!l.isValid())return null;var u=l.diff(s,"hours");return u>0&&u<24?s.format(m):t.map((function(e){var t;return Nr()(null==e||null===(t=e.toString)||void 0===t?void 0:t.call(e)).format(m)})).join(" ".concat(y.label," "))}return"on"===e?Nr()(null==t||null===(i=t.toString)||void 0===i?void 0:i.call(t),I).format(m):"string"==typeof t?Ur(t):Array.isArray(t)&&1===t.length&&"string"==typeof t[0]?Ur(t[0]):null},kr=function(e,t,r,n){if(!t)return null;switch(t.type){case K.TAG:case K.SELECTION_MULTI_ASYNC:case K.KEY_VALUE_FILTER:return r?e[t.type].searchOptions(t.id,r,n):e[t.type].getOptions(t.id,n)}return"options"in t&&Array.isArray(t.options)?t.options:null},Br=function(e,t){if(!t)return null;switch(t.type){case K.TAG:case K.SELECTION_MULTI_ASYNC:case K.KEY_VALUE_FILTER:return e[t.type].getValueMap(t.id)}return null};function jr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Yr=function e(t,r){var n,i,a,o,s=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return jr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?jr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(null!==(n=null!==(i=null!==(a=t.and)&&void 0!==a?a:t.or)&&void 0!==i?i:t.not)&&void 0!==n?n:[]);try{for(s.s();!(o=s.n()).done;){var l=o.value;if("id"in l){if(l.id===r)return l}else{var u=e(l,r);if(u)return u}}}catch(e){s.e(e)}finally{s.f()}return null};function Hr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return qr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Wr=function(e,t,r){var n=Yr(e.filters,t.id);if(!n)return!1;if(n.type===K.DATEV3){if((n.operator.variation===re||n.operator.variation===ne)&&t.value&&!(0,Ke.isNil)(n.valueIndex)&&!(0,Ke.isNil)(n.durationUnitIndex)){var i=Vr(t.operator,t.value);if(!i)return!1;var a=i.split(" "),o=(0,He.default)(a,2),s=o[0],l=o[1];return r[n.valueIndex]=s,r[n.durationUnitIndex]=l,!0}}else if((n.type===K.SELECTION_MULTI||n.type===K.SELECTION_MULTI_ASYNC||n.type===K.TAG)&&t.value&&!(0,Ke.isNil)(n.valueIndex))return r[n.valueIndex]=t.value.toString(),!0;return!1},Qr=function e(t,r,n){if(!r)return!1;var i,a=Hr(r);try{for(a.s();!(i=a.n()).done;){var o,s,l=i.value;if(!("id"in l?Wr(t,l,n):e(t,null!==(o=null!==(s=l.and)&&void 0!==s?s:l.or)&&void 0!==o?o:l.not,n)))return!1}}catch(e){a.e(e)}finally{a.f()}return!0},Gr=function(e){var t=e.asyncFilterHelpers,r=e.indexes,n=e.keyword,i=e.phraseDefinition,a=e.phraseValues;if(!ar(n))return n;var o=a[r.valuesIndex.toString()];if(r.valuesIndex++,n===we.OPTION_LIST&&i.optionLists){var s,l,u=i.optionLists[r.optionsIndex];return r.optionsIndex++,null!==(s=null===(l=u.find((function(e){return e.value.toString()===o})))||void 0===l?void 0:l.label)&&void 0!==s?s:o}if(n===we.ASYNC_OPTION_LIST&&i.asyncFilter){var c=Br(t,i.asyncFilter);return c?c[o]:{error:fe,filter:i.asyncFilter}}return null!=o?o:""},Kr=function(e){var t=e.asyncFilterHelpers,r=e.parsedFilters,n=e.phraseDefinitions,i=e.phraseId,a=n.find((function(e){return e.phraseId===i}));if(!a)return null;var o={};if(!Qr(a,r,o))return null;var s,l=[],u={valuesIndex:0,optionsIndex:0},c=Hr(a.phrase.split(" "));try{for(c.s();!(s=c.n()).done;){var d=s.value,p=Gr({asyncFilterHelpers:t,indexes:u,keyword:d,phraseDefinition:a,phraseValues:o});if("string"!=typeof p)return p;l.push(p)}}catch(e){c.e(e)}finally{c.f()}return l.join(" ")},zr=function(e,t){return e.hasOwnProperty("value")&&Array.isArray(e.value)&&1===e.value.length&&"string"==typeof e.value[0]?t.test(e.value[0]):!(!e.hasOwnProperty("value")||"string"!=typeof e.value)&&t.test(e.value)};function Xr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return $r(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?$r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function $r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Jr=[l,c,u],Zr=function(e,t,r){return r&&"string"==typeof e&&e in r?{label:Ut(r[e]),value:e}:r&&"object"===(0,_r.default)(e)&&"id"in e&&e.id in r?{label:Ut("".concat(r[e.id]," ").concat(e.value)),value:e}:r&&"number"==typeof e&&e in r?{label:r[e],value:e}:Array.isArray(t)?t.find((function(t){return String(t.value).toLowerCase()===String(e).toLowerCase()})):void 0},en=function(e,t){return((0,Ke.isNil)(t)||""===t)&&Ee.includes(e)},tn=function(e){var t=e.asyncFilterHelpers,r=e.filters,n=e.parsedFilter,i=e.phraseDefinitions,a=n.id,o=n.operator,s=n.operatorVariation,l=n.phraseId,u=n.value,c=s;if(i&&l){var d=Kr({asyncFilterHelpers:t,parsedFilters:[n],phraseDefinitions:i,phraseId:l});if(d&&("string"==typeof d||"error"in d))return d}var p=r.find((function(e){return e.id===a}));if(!p)return{error:"INVALID_FILTER",errorMessage:{message:tr.failedToParseFilter,values:{filterId:a}}};var f=p.label,h=p.operators;p.type!==K.DATEV3||c||(c=function(e){if(e)return e.hasOwnProperty("operatorVariation")&&null!==e.operatorVariation&&void 0!==e.operatorVariation?null==e?void 0:e.operatorVariation:zr(e,E)?re:zr(e,b)?ne:function(e){return!(!e.hasOwnProperty("value")||"string"!=typeof e.value)&&Nr()(e.value,Nr().ISO_8601,!0).isValid()}(e)?te:function(e){if(!e.hasOwnProperty("value")||!Array.isArray(e.value)||2!==e.value.length)return!1;var t=(0,He.default)(e.value,2),r=t[0],n=t[1];if("string"!=typeof r||"string"!=typeof n)return!1;var i=Nr()(r,Nr().ISO_8601,!0),a=Nr()(n,Nr().ISO_8601,!0);if(!i.isValid()||!a.isValid())return!1;var o=a.diff(i,"hours");return o>=0&&o<=24}(e)?ie:function(e){if(!e.hasOwnProperty("value")||!Array.isArray(e.value)||2!==e.value.length)return!1;var t=(0,He.default)(e.value,2),r=t[0],n=t[1];if("string"!=typeof r||"string"!=typeof n)return!1;var i=Nr()(r,Nr().ISO_8601,!0),a=Nr()(n,Nr().ISO_8601,!0);return i.isValid()&&a.isValid()&&i.isBefore(a)}(e)?ae:void 0}(n));var v=function(e,t,r){return t.find((function(t){return!((r||e!==J&&e!==Z||!("variationName"in t)||e!==t.variationName)&&(r||"eq"!==e&&"neq"!==e||e!==t.name)&&!(e&&"variation"in t&&"variationName"in t&&t.variation===r&&e===t.variationName)&&(e&&r?t.name!==e||t.variation!==r:!r&&"variation"in t||t.name!==e))}))}(o,h,c);if(!v)return{error:"INVALID_OPERATOR",errorMessage:{message:tr.failedToParseOperator,values:{filter:p.label,operator:o}}};if(se.includes(v.name))return"".concat(f," ").concat(v.label);var g=null,m=null;if(ve.includes(p.type)){if(!(m=Br(t,p)))return{error:fe,filter:p}}else g=kr(t,p);var I=function(e){var t,r,n,i,a,o,s=e.filter,l=e.operator,u=e.operatorObject,c=e.options,d=e.valueMap,p=e.value,f=c,h=d;if(s.type===K.SELECTION||s.type===K.SELECTION_MULTI||s.type===K.SELECTION_MULTI_ASYNC){if(Array.isArray(c)&&(f=c.map((function(e){var t=null==e?void 0:e.value;return t&&"string"==typeof t&&(t=t.toLowerCase()),{label:e.label,value:t}}))),d&&h){var v=Object.entries(h);h=Object.fromEntries(v.map(())}Array.isArray(p)?p=p.map(():"string"==typeof p&&(p=p.toLowerCase())}if(Array.isArray(f)||h){if((0,Ke.isNil)(p)||""===p)return"";if(Array.isArray(p)){var g,m=[],I=Xr(p);try{for(I.s();!(g=I.n()).done;){var E,b,y=g.value,S=Zr(y,f,h);if(!S)return{error:pe,errorMessage:{message:tr.failedToParseOptionValue,values:{filter:s.label,value:null!==(E=null==y||null===(b=y.toString)||void 0===b?void 0:b.call(y))&&void 0!==E?E:""}}};m.push(S.label)}}catch(e){I.e(e)}finally{I.f()}return m.join(", ")}var O,T,x,_=Zr(p,f,h);return _?_.label:{error:pe,errorMessage:{message:tr.failedToParseOptionValue,values:{filter:s.label,value:null!==(O=null===(T=p)||void 0===T||null===(x=T.toString)||void 0===x?void 0:x.call(T))&&void 0!==O?O:""}}}}if(z.includes(s.type))return(0,Ke.isNil)(p)?"":Vr(l,p)||{error:"INVALID_DATE_VALUE",errorMessage:{message:tr.failedToParseDateValue,values:{filter:s.label,operator:u.label,value:null!==(i=null===(a=p)||void 0===a||null===(o=a.toString)||void 0===o?void 0:o.call(a))&&void 0!==i?i:""}}};if(Array.isArray(p))return p.map((function(e){var t,r,n=Ut(null!==(t=null==e||null===(r=e.toString)||void 0===r?void 0:r.call(e))&&void 0!==t?t:"",l,u);return en(s.type,n)?'""':n})).join(", ");if(en(s.type,p))return'""';var D=null!==(t=null===(r=p)||void 0===r||null===(n=r.toString)||void 0===n?void 0:n.call(r))&&void 0!==t?t:"";return Ee.includes(s.type)?Ut(D,l,u):D}({filter:p,operator:o,operatorObject:v,options:g,value:u,valueMap:m});return"string"!=typeof I?I:"".concat(f," ").concat(v.label," ").concat(I)},rn=function e(t){var r=t.activeFilters,n=t.asyncFilterHelpers,i=t.filters,a=t.condition,o=void 0===a?l:a,s=t.phraseDefinitions,u=t.phraseId,d=t.nestedLevel,p=void 0===d?0:d,f="",h=r;if(s&&u&&Array.isArray(h)){var v=Kr({asyncFilterHelpers:n,parsedFilters:h,phraseDefinitions:s,phraseId:u});if(v&&("string"==typeof v||"error"in v))return v}Array.isArray(h)||(h=[h]);var g,m=Xr(h);try{for(m.s();!(g=m.n()).done;){var I=g.value,E=null;if("id"in I)E=tn({asyncFilterHelpers:n,filters:i,parsedFilter:I,phraseDefinitions:s});else{var b=function(){var t=Object.keys(I)[0],r=Jr.find(();if(!r)return{v:{error:"INVALID_CONDITION",errorMessage:{message:tr.failedToParseCondition,values:{condition:t}}}};E=e({activeFilters:I[t],asyncFilterHelpers:n,filters:i,condition:r,phraseDefinitions:s,phraseId:I.phraseId,nestedLevel:p+1})}();if("object"===(0,_r.default)(b))return b.v}if("string"!=typeof E)return E;f=f.length>0?"".concat(f," ").concat(o.label," ").concat(E):E}}catch(e){m.e(e)}finally{m.f()}return o===c?f.startsWith("(")?"NOT".concat(f):"NOT(".concat(f,")"):p>1?"(".concat(f,")"):f},nn=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=t===ce?"T":"",i=r===ne?"+":"-";return"".concat(i,"P").concat(n).concat(e).concat(t)},an=function(e,t){switch(e.type){case K.DATEV3:return function(e,t){var r=e.operator.variation;if(r===re||r===ne){var n,i;if((0,Ke.isNil)(e.valueIndex)||(null!==(n=null==e?void 0:e.valueIndex)&&void 0!==n?n:0)>=t.values.length||(0,Ke.isNil)(e.durationUnitIndex)||(null!==(i=null==e?void 0:e.durationUnitIndex)&&void 0!==i?i:0)>=t.values.length)return null;var a=t.values[e.valueIndex],o=t.values[e.durationUnitIndex],s={label:"".concat(a.label," ").concat(o.label),value:nn(a.value.toString(),o.value.toString(),r)};return{filter:e,operator:e.operator,value:s}}return null}(e,t);case K.SELECTION_MULTI:case K.SELECTION_MULTI_ASYNC:case K.TAG:return function(e,t){var r;if((0,Ke.isNil)(e.valueIndex)||(null!==(r=null==e?void 0:e.valueIndex)&&void 0!==r?r:0)>=t.values.length)return null;var n=t.values[e.valueIndex];return{filter:e,operator:e.operator,value:[n]}}(e,t)}return null},on=function e(t,r){var n,i,a,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=l;t.or?s=u:t.not&&(s=c);var d={condition:s,completedFilters:[]};o&&(d.phraseId=r.phraseId);var p=null!==(n=null!==(i=null!==(a=t.and)&&void 0!==a?a:t.or)&&void 0!==i?i:t.not)&&void 0!==n?n:[];return p.forEach((function(t){if("id"in t){var n=an(t,r);n&&d.completedFilters.push(n)}else d.completedFilters.push(e(t,r,!1))})),d},sn=function(e){var t=e.condition,r=e.filter,n=e.filterState,i=e.operator,a=e.phraseData,o=e.value,s=n;return null===s&&(s={condition:null!=t?t:l,completedFilters:[]}),s.conditionDefaulted&&t&&(s.condition=t,delete s.conditionDefaulted),null===s.condition&&(s.condition=null!=t?t:l),a.filters?s.completedFilters.push(on(a.filters,a)):r&&i&&o&&s.completedFilters.push({filter:r,operator:i,value:o}),s},ln=function(e){var t=e.isError,r=e.isEmpty,n={label:e.label,icon:Xe.StateFixedIcon,iconColor:"colors.chart.status.good",textColor:"colors.text.placeholder",type:je.INFO};return r&&(n.icon=Xe.InfoIcon,n.iconColor="colors.text.placeholder",n.textColor="colors.text.placeholder"),t&&(n.icon=Xe.ValidationIcon,n.iconColor="colors.chart.status.bad",n.textColor="colors.text.status.bad"),n},un=function(e){(function(e){var t;return e.lastFilter&&e.lastOperator&&!e.incompleteCondition&&!se.includes(null===(t=e.lastOperator)||void 0===t?void 0:t.name)})(e)&&(function(e){var t;if((null===(t=e.lastFilter)||void 0===t?void 0:t.placeholder)&&function(e){var t;return(null===(t=e.lastFilter)||void 0===t?void 0:t.placeholder)&&(e.expectedFieldState===D||e.expectedFieldState===L)&&be.includes(e.lastFilter.type)}(e)){var r=0===e.lastValues.length,n=!r&&V.includes(e.fieldState),i=e.lastFilter.placeholder;e.valueHintPopoverOptions.push(ln({isEmpty:r,isError:n,label:i}))}}(e),function(e){if(function(e){var t,r,n;return!((null===(t=e.lastFilter)||void 0===t?void 0:t.type)!==K.DATEV3||e.expectedFieldState!==D&&e.expectedFieldState!==L||(null===(r=e.lastOperator)||void 0===r?void 0:r.variation)!==re&&(null===(n=e.lastOperator)||void 0===n?void 0:n.variation)!==ne||0!==e.lastValues.length||e.partialFieldState===H)}(e)){var t,r,n,i=e.partialFieldState===Y,a=e.partialFieldState===k&&V.includes(e.fieldState),o=null===(t=e.errorMessages)||void 0===t||null===(r=t[0])||void 0===r||null===(n=r.values)||void 0===n?void 0:n.durationUnit,s=e.formatMessage(er.enterAValidNumber);if(o){var l,u,c,d={range:null===(l=e.errorMessages)||void 0===l||null===(u=l[0])||void 0===u||null===(c=u.values)||void 0===c?void 0:c.maxValue};s=e.formatMessage(er.enterAValidNumberWithLimit,d)}e.valueHintPopoverOptions.push(ln({isEmpty:i,isError:a,label:s}))}}(e),function(e){if(function(e){var t;return(null===(t=e.lastFilter)||void 0===t?void 0:t.type)===K.KEY_VALUE_FILTER&&e.partialFieldState!==B&&(e.expectedFieldState===L||e.expectedFieldState===A||e.expectedFieldState===M)}(e)){var t=e.partialFieldState===j,r=e.formatMessage(er.enterACustomAttributeValue);e.valueHintPopoverOptions.push(ln({isEmpty:t,isError:!1,label:r}))}}(e))},cn=function(e,t){if(!t)return!1;switch(t.type){case K.TAG:case K.SELECTION_MULTI_ASYNC:case K.KEY_VALUE_FILTER:return e[t.type].hasFetchError(t.id)}return!1},dn=function(e,t){return e.slice(0,t).reduce((,0)},pn=function(e,t){var r=e.slice(0,t+1);return r.reduce((function(e,t,n){var i=n!==r.length-1?1:0;return e+t.length+i}),0)};function fn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var hn=function(e,t){return t+1>=e.length?"":e.slice(t+1).join(" ").trimLeft()},vn=function(e,t){var r=e.chips[e.chips.length-1];return r.type===t?r:null},gn=function(e,t,r){return e.slice(t,r).join(" ")},mn=function(e,t){var r=t+1;if(r>=e.length)return pn(e,t);for(;r<e.length-1&&""===e[r];)r++;return dn(e,r)},In=function(e,t){e.stringEndIndex+=t,e.stringSpaceEndIndex+=t,e.stringStartIndex+=t,"stringConditionEndIndex"in e&&void 0!==e.stringConditionEndIndex&&(e.stringConditionEndIndex+=t),"leadingParenthesisStringEndIndex"in e&&(e.leadingParenthesisStringEndIndex+=t)},En=function e(t,r){t.forEach((function(t){In(t,r),"filter"in t&&In(t.filter,r),"operator"in t&&t.operator&&In(t.operator,r),"value"in t&&t.value&&In(t.value,r),"chips"in t&&e(t.chips,r)}))},bn=function(e,t,r){if(e.lastFilter){var n=dn(r,t),i=pn(r,e.index),a=mn(r,e.index),o=gn(r,t,e.index+1),s={filter:{item:e.lastFilter,rawText:o,stringEndIndex:i,stringSpaceEndIndex:a,stringStartIndex:n,type:"FILTER"},isComplete:!1,rawText:o,startIndex:t,stringEndIndex:i,stringSpaceEndIndex:a,stringStartIndex:n,type:Oe};e.chipState.chips.push(s),e.chipState.remainingText=hn(r,e.index)}},yn=function(e,t,r){if(e.lastOperator){var n=dn(r,t),i=pn(r,e.index),a=mn(r,e.index),o=vn(e.chipState,Oe);o&&(o.operator={item:e.lastOperator,rawText:gn(r,t,e.index+1),stringEndIndex:i,stringSpaceEndIndex:a,stringStartIndex:n,type:"OPERATOR"},o.isComplete=se.includes(e.lastOperator.name),o.rawText=gn(r,o.startIndex,e.index+1),o.stringEndIndex=i,o.stringSpaceEndIndex=a,e.chipState.remainingText=hn(r,e.index))}},Sn=function(e,t,r){var n;if(e.lastValues){var i=vn(e.chipState,Oe);if(i)if(e.incompleteValue)i.valueStartIndex=t;else{var a=null!==(n=i.valueStartIndex)&&void 0!==n?n:t,o=dn(r,a),s=pn(r,e.index),l=mn(r,e.index);i.value={item:e.lastValues,rawText:gn(r,a,e.index+1),stringEndIndex:s,stringSpaceEndIndex:l,stringStartIndex:o,type:"VALUE"},i.isComplete=!V.includes(e.fieldState),i.rawText=gn(r,i.startIndex,e.index+1),i.stringEndIndex=s,i.stringSpaceEndIndex=l,e.chipState.remainingText=hn(r,e.index)}}},On=function(e,t,r){if(e.lastCondition){var n=dn(r,t),i=pn(r,e.index),a=mn(r,e.index),o=vn(e.chipState,Oe);if(o)o.stringConditionEndIndex=a;else{var s=vn(e.chipState,xe);s&&(s.stringConditionEndIndex=a)}e.chipState.chips.push({item:{label:e.lastCondition.label,value:e.lastCondition.value},rawText:gn(r,t,e.index+1),stringEndIndex:i,stringSpaceEndIndex:a,stringStartIndex:n,type:Se}),e.chipState.remainingText=hn(r,e.index)}},Tn=function(e){var t=e.state,r=e.hasEndingParenthesis,n=e.endingParenthesisIndex,i=e.nestedChipState,a=e.values,o=vn(t.chipState,Te);o&&(En(i.chips,o.stringStartIndex+o.rawText.length),o.chips=i.chips,o.hasEndingParenthesis=r,o.nestedRemainingText=i.remainingText.trimLeft(),r&&(o.stringEndIndex=pn(a,n),o.stringSpaceEndIndex=mn(a,n)),t.chipState.remainingText=r?hn(a,n):"")},xn=function(e,t,r){if(e.currentPhraseItem){var n=dn(r,t),i=pn(r,e.index),a=mn(r,e.index),o=gn(r,t,e.index+1),s=Boolean(e.lastPhraseData.filters&&e.lastPhraseData.phraseId),l={chips:[{rawText:o,stringEndIndex:i,stringSpaceEndIndex:a,stringStartIndex:n,type:ke[e.currentPhraseItem.type]}],isComplete:s,hasPossibleOptions:s&&e.possiblePhraseOptions.length>0,rawText:o,startIndex:t,stringEndIndex:i,stringSpaceEndIndex:a,stringStartIndex:n,type:xe};e.chipState.chips.push(l),e.chipState.remainingText=hn(r,e.index)}},_n=function(e,t,r){if(e.currentPhraseItem){var n=dn(r,t),i=pn(r,e.index),a=mn(r,e.index),o=vn(e.chipState,xe);o&&(o.chips.push({rawText:gn(r,t,e.index+1),stringEndIndex:i,stringSpaceEndIndex:a,stringStartIndex:n,type:ke[e.currentPhraseItem.type]}),o.isComplete=Boolean(e.lastPhraseData.filters&&e.lastPhraseData.phraseId),o.hasPossibleOptions=o.isComplete&&e.possiblePhraseOptions.length>0,o.rawText=gn(r,o.startIndex,e.index+1),o.stringEndIndex=i,o.stringSpaceEndIndex=a,e.chipState.remainingText=hn(r,e.index))}},Dn=function(e,t,r){var n,i=t&&ve.includes(t.type);if(!t||!i||i&&r.length<he)return!1;var a=null!==(n=Br(e,t))&&void 0!==n?n:{};return Object.keys(a).length>he},Ln=function(e,t){return null==e?void 0:e.find(()},An=function(e,t){var r;return null!==(r=null==e?void 0:e.filter((function(e){var r;return null==e||null===(r=e.label)||void 0===r?void 0:r.toLowerCase().startsWith(t)})))&&void 0!==r?r:[]},Mn=function e(t){var r=t.valueLowerCase,n=t.values,i=t.objectsList,a=t.index;if(0===n.length)return{item:null,index:a,possibleObjects:i};var o="".concat(r," ").concat(n[0]).toLowerCase(),s=An(i,o);if(0===s.length)return{item:null,index:a+1,possibleObjects:s};var l=Ln(s,o);if(!l||s.length>1){var u=e({valueLowerCase:o,values:n.slice(1),objectsList:s,index:a+1});if(u.item||!l)return u}return{item:l,index:a+1,possibleObjects:s}},Fn=function(e,t){var r=An(e,t);if(0===r.length)return{fieldState:w,possibleItems:r};var n=Ln(r,t);return n?{exactItem:n,possibleItems:r}:{fieldState:(null==r?void 0:r.length)>0?C:w,possibleItems:r}},Rn=function(e){var t=e.currentIndex,r=e.items,n=e.valueLowerCase,i=e.values,a=Fn(r,n),o=a.exactItem,s=a.possibleItems,l=a.fieldState;if(o&&1===s.length)return{index:t,foundItem:o,possibleItems:[]};if(l===w)return{fieldState:l,index:t,possibleItems:s};var u=Mn({valueLowerCase:n,values:i.slice(t+1),objectsList:s,index:t}),c=u.item,d=u.index,p=u.possibleObjects;return null===c?o?{index:t,foundItem:o,possibleItems:p.filter((function(e){return e.label!==o.label}))}:{fieldState:(null==p?void 0:p.length)>0?C:w,index:d,possibleItems:p}:{index:d,foundItem:c,possibleItems:p.filter(()}};function wn(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Cn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Cn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Cn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Pn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Nn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Pn(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Un=function(e){var t=e.isEmpty,r=void 0!==t&&t,n=e.isError,i=void 0!==n&&n,a=e.state,o=a.formatMessage(er.enterAValidNumber);a.valueHintPopoverOptions.push(ln({isError:i,isEmpty:r,label:o}))},Vn=function(e,t,r){return r.slice(t.index,e+1).join(" ")},kn=function(e,t){return cn(t.asyncFilterHelpers,e)?(t.fieldState=R,{errorMessages:[{message:rr.failedFetchingPhraseOptions}],result:W}):(t.fieldState=F,{result:W})},Bn=function(e){var t=e.index,r=e.state,n=e.values;if(!r.currentPhraseItem)return{result:W};var i=r.currentPhraseItem.descendants,a=Object.keys(i);if(r.lastPhraseData.currentPhraseString="".concat(r.lastPhraseData.currentPhraseString," ").concat(Vn(t,r,n)).trim(),a.length>0){var o=cr(i,r.lastPhraseData),s=o.asyncFilter,l=o.error,u=o.keywords;if(s&&(r.currentPhraseItem=Nn(Nn({},r.currentPhraseItem),{},{descendantAsyncFilter:s}),l))return kn(s,r);r.possiblePhraseOptions=u,r.exceedsAsyncOptionDisplayLimit=Dn(r.asyncFilterHelpers,s,r.possiblePhraseOptions)}return r.index=t,r.lastItemStart=dn(n,r.index+1),r.currentPhraseItem.filters&&r.currentPhraseItem.phraseId?(r.lastPhraseData.filters=r.currentPhraseItem.filters,r.lastPhraseData.phraseId=r.currentPhraseItem.phraseId,r.fieldState=A,{result:Q}):(r.lastPhraseData.filters&&(delete r.lastPhraseData.filters,delete r.lastPhraseData.phraseId),0===a.length?(r.fieldState=C,{result:W}):(a.some(()&&Un({isEmpty:!0,state:r}),r.fieldState=N,{result:Q}))},jn=function(e){var t=e.index,r=e.keyword,n=e.phraseTree,i=e.state,a=e.value,o=e.values,s=n[r];return new RegExp(s.pattern).test(a)?(i.lastPhraseData.values.push({label:a,value:parseFloat(a)}),i.currentPhraseItem=s,Un({state:i}),Bn({index:t,state:i,values:o})):(i.fieldState=w,Un({isError:!0,state:i}),{errorMessages:[{message:rr.invalidPhraseNumber,values:{phrase:i.lastPhraseData.currentPhraseString,value:a}}],result:W})},Yn=function(e){var t=e.foundItem,r=e.index,n=e.keyword,i=e.phraseTree,a=e.state,o=e.values,s=t.label,l=Array.isArray(t.value)?t.value[0]:t.value;a.lastPhraseData.values.push({label:s,value:l});var u=i[n];return a.currentPhraseItem="items"in u?(0,Ke.isNil)(t.itemIndex)?null:u.items[t.itemIndex]:u,n===we.ASYNC_OPTION_LIST&&a.possiblePhraseOptions.length>0&&(a.possiblePartialPhraseOptions=a.possiblePhraseOptions,a.possiblePhraseOptions=[],a.partialLastItemStartMap.PHRASE_KEYWORD=a.lastItemStart),Bn({index:r,state:a,values:o})},Hn=function(e){var t=e.phraseTree,r=e.state,n=e.value,i=e.values;r.expectedFieldState=r.fieldState===U?U:N;var a=n.toLowerCase(),o=Object.keys(t).filter((),s=cr(t,r.lastPhraseData,a),l=s.asyncFilter,u=s.error,c=s.keywords;if(l&&u)return kn(l,r);var d=Rn({currentIndex:r.index,items:c,valueLowerCase:a,values:i}),p=d.fieldState,f=d.index,h=d.foundItem,v=d.possibleItems;if(r.possiblePhraseOptions=v,r.exceedsAsyncOptionDisplayLimit=Dn(r.asyncFilterHelpers,l,r.possiblePhraseOptions),o.length>0&&(!h&&0===v.length||(null==h?void 0:h.type))){var g,m=wn(o);try{for(m.s();!(g=m.n()).done;){var I=g.value;switch(I){case we.NUMBER:if(t[I].type!==Ne)break;return jn({index:f,keyword:I,phraseTree:t,state:r,value:n,values:i});case we.ASYNC_OPTION_LIST:case we.DURATION_UNIT:case we.OPTION_LIST:if(!h||!Be.includes(h.type))break;return Yn({foundItem:h,index:f,keyword:I,phraseTree:t,state:r,value:n,values:i})}}}catch(e){m.e(e)}finally{m.f()}}if(p===w)return r.fieldState=p,{errorMessages:[{message:rr.invalidPhraseKeyword,values:{phrase:r.lastPhraseData.currentPhraseString,keyword:Vn(f,r,i)}}],result:W};if(!h){r.fieldState=C,r.lastItemStart=dn(i,r.index);var E=r.lastPhraseData.currentPhraseString,b=Vn(f,r,i);return{errorMessages:[{message:E.length>0?rr.incompletePhraseKeyword:rr.incompletePhraseStartingKeyword,values:E.length>0?{phrase:E,keyword:b}:{keyword:b}}],result:W}}return r.currentPhraseItem=function(e,t){if(Array.isArray(e)){var r,n=null,i=t,a=wn(e);try{for(a.s();!(r=a.n()).done;){var o=r.value.toString();if(!(o in i))break;if(!("descendants"in(n=i[o])))return null;i=n.descendants}}catch(e){a.e(e)}finally{a.f()}return n}var s=t[e.toString()];return"descendants"in s?s:null}(h.value,t),Bn({index:f,state:r,values:i})},qn=function(e){var t=e.state,r=e.value,n=e.values;t.expectedFieldState=A;var i=t.lastCondition;if(!i){var a=Fn(p,r.toLowerCase()),o=a.exactItem,s=a.possibleItems,l=a.fieldState;if(i=o,t.possibleConditions=s,l===w)return t.fieldState=l,t.errorMessages.push({message:rr.invalidCondition,values:{condition:r}}),W;if(!i)return t.fieldState=C,t.errorMessages.push({message:rr.incompleteCondition,values:{condition:r}}),t.lastItemStart=dn(n,t.index),W}return t.lastCondition=i,t.filterState=sn({condition:{label:i.label,value:i.value},filter:t.lastFilter,filterState:t.filterState,operator:t.lastOperator,phraseData:t.lastPhraseData,value:t.lastValues}),t.filterState&&!t.filterState.conditionDefaulted&&t.filterState.condition.value!==i.value?(t.possibleConditions=[],t.fieldState=w,t.expectedFieldState=A,t.errorMessages.push({message:rr.topLevelConditionMismatch}),W):(t.fieldState=_,Q)},Wn=function(e){var t=e.filters,r=e.state,n=e.value,i=e.values;r.expectedFieldState=_,r.partialLastItemStartMap.FILTER=null;var a=Rn({currentIndex:r.index,items:t,valueLowerCase:n.toLowerCase(),values:i});if(!a.foundItem){var o;r.lastFilter=null,r.possibleFilters=a.possibleItems,r.fieldState=null!==(o=a.fieldState)&&void 0!==o?o:w;var s=r.possibleFilters.length>0?a.index+1:a.index,l=a.fieldState===C?rr.incompleteFilter:rr.invalidFilter;return r.errorMessages.push({message:l,values:{filter:i.slice(r.index,s+1).join(" ")}}),W}return r.lastFilter=a.foundItem,r.possibleFilters=a.possibleItems,r.possibleOperators=r.lastFilter.operators,r.possibleFilters.length>0&&(r.partialLastItemStartMap.FILTER=r.lastItemStart),r.index=a.index,r.lastItemStart=dn(i,r.index+1),r.fieldState=D,Q};function Qn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Gn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Qn(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Kn=zn=function(e){for(var t=0,r=e.length;r>0;r--)")"===e[r-1]&&t++;return t},Xn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return t+"*".repeat(r.length)},$n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return"*".repeat(t.length)+r},Jn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return t+"*".repeat(r.length)+n},Zn=function(e){var t=e.allowNotCondition,r=e.enableChipMode,n=e.defaultFilterValueLimit,i=e.filterLimit,a=e.filters,o=e.maxNestedLevel,s=e.nestedLevel,u=void 0===s?0:s,d=e.phraseTree,p=e.state,m=e.value,I=e.values,E=m.toLowerCase(),b=!1,y=!1,D=p.index;if(p.possibleNestingOptions=[],t){var L=function(e,t,r){var n=t.startsWith(h),i=h.startsWith(t);if(!n&&!i)return{notConditionFound:!1,possibleNestingOptions:[]};if(!n)return{notConditionFound:!1,possibleNestingOptions:[f]};if(t.startsWith(v))return{notConditionFound:!0,possibleNestingOptions:S};var a=r.slice(e.index+1),o=a.findIndex(();if(-1!==o){if(a.slice(0,o).every((function(e){return""===e})))return{notConditionFound:!0,index:o+e.index+1,possibleNestingOptions:S}}else if(a.every((function(e){return""===e})))return{notConditionFound:!1,possibleNestingOptions:[f]};return{notConditionFound:!1,possibleNestingOptions:[]}}(p,E,I),M=L.notConditionFound,F=L.index,R=L.possibleNestingOptions;p.possibleNestingOptions=R,M&&(b=!0,F&&p.index!==F&&(y=!0,p.index=F,E=I[p.index]),p.lastItemStart=dn(I,p.index))}if(!E.startsWith("(")&&!b)return q;b||(p.possibleNestingOptions=t?S:[g]);var N=b&&!y?4:1;r&&function(e){var t,r=e.state,n=e.startIndex,i=e.startsWithNot,a=e.values,o=a.slice(n).join(" "),s=o.indexOf("(")+1,l=dn(a,n),u=l+s,c=u,d=o.slice(s));try{for(d.s();!(t=d.n()).done&&""===t.value.trim();)c++}catch(e){d.e(e)}finally{d.f()}var p="(";i&&(p=(p=gn(a,n,r.index+1)).slice(0,p.indexOf("(")+1));var f={chips:[],hasEndingParenthesis:!1,leadingParenthesisStringEndIndex:u,nestedRemainingText:"",rawText:p,spacesAfterLeadingParenthesis:c-u,stringEndIndex:u,stringSpaceEndIndex:c,stringStartIndex:l,type:Te};r.chipState.chips.push(f),r.chipState.remainingText=o.slice(s).trimLeft()}({state:p,startIndex:D,startsWithNot:b,values:I});var U=I.slice(p.index),V=function(e,t){for(var r=Kn(e),n=function(e){var t=!1,r=!1;return e.map((function(e){var n=e.trimLeft().charAt(0),i=e.replace(/('|")[\s(),]+/g,"$1");if(i.length>1){if(n===T&&i.endsWith(T)||n===O&&i.endsWith(O))return e.replace(/('|")(.+)('|")/g,Jn);if(n===T&&!i.endsWith(T))return t=!0,e.replace(/(')(.+)/g,Xn);if(n===O&&!i.endsWith(O))return r=!0,e.replace(/(")(.+)/g,Xn);if(t&&i.endsWith(T))return t=!1,e.replace(/(.+)(')/g,$n);if(r&&i.endsWith(O))return r=!1,e.replace(/(.+)(")/g,$n);if(t||r)return"*".repeat(e.length)}return e}))}(t),i=1;i<n.length;i++){var a=n[i];if(a.includes("(")&&(r+=Kn(a)),a.endsWith("),")&&(a=a.slice(0,-1)),a.endsWith(")")){if((r-=zn(a))>0)continue;return i}}return-1}(E,U),k=-1!==V;if(k&&(U=U.slice(0,V+1)),U[0]=U[0].substring(N),k){var B=U.length-1;if(U[B].endsWith(","))return p.fieldState=w,p.expectedFieldState=A,p.errorMessages.push({message:rr.nestedFiltersEndWithComma}),W;U[B]=U[B].slice(0,-1)}if(u+1>o)return p.fieldState=w,p.errorMessages.push({message:rr.exceededMaxNestedLimit,values:{maxNestedLevel:o}}),W;var j=Ti({allowNotCondition:t,asyncFilterHelpers:p.asyncFilterHelpers,defaultFilterValueLimit:n,enableChipMode:r,filterLimit:i,filters:a,formatMessage:p.formatMessage,maxNestedLevel:o,nestedLevel:u+1,phraseTree:d,values:U});if(function(e,t,r){Object.keys(r).forEach((function(n){var i=n,a=r[i];null!==a&&(e.partialLastItemStartMap[i]=e.lastItemStart+a+t)}))}(p,N,j.partialLastItemStartMap),p.lastItemStart+=j.lastItemStart+N,k&&(p.lastItemStart=dn(I,p.index+V+1)),j.fieldState===x){p.fieldState=C,p.expectedFieldState=_;var Y=b?rr.emptyOpenNotConditional:rr.emptyOpenParenthesis;return p.errorMessages.push({message:Y}),W}if(r&&Tn({state:p,hasEndingParenthesis:k,endingParenthesisIndex:k?p.index+V:-1,nestedChipState:j.chipState,values:I}),j.fieldState===C||j.fieldState===w)return Gn(Gn({},j),{},{chipState:p.chipState,fieldState:k?w:j.fieldState,lastItemStart:p.lastItemStart,partialLastItemStartMap:p.partialLastItemStartMap});var H=j.fieldState===A||j.fieldState===P;if(!k&&H){var G=j.errorMessages;return 0===G.length&&(G=[{message:b?rr.missingEndingNotParenthesis:rr.missingEndingParenthesis}]),Gn(Gn({},j),{},{errorMessages:G,chipState:p.chipState,filterState:null,fieldState:C,lastItemStart:p.lastItemStart,partialLastItemStartMap:p.partialLastItemStartMap})}return p.possiblePhraseOptions=[],p.filterState=function(e,t,r){var n=e;return t&&(null===n&&(n={condition:l,conditionDefaulted:!0,completedFilters:[]}),r?n.completedFilters.push({condition:c,completedFilters:[t]}):n.completedFilters.push(t)),n}(p.filterState,j.filterState,b),p.index=p.index+V,p.fieldState=A,Q},ei=function(e){var t,r,n,i,a=e.state,o=e.value,s=e.values;a.expectedFieldState=D,a.partialLastItemStartMap.OPERATOR=null;var l,u,c,d,p,f,h,v=Rn({currentIndex:a.index,items:null!==(t=null===(r=a.lastFilter)||void 0===r?void 0:r.operators)&&void 0!==t?t:[],valueLowerCase:o.toLowerCase(),values:s});if(!v.foundItem){var g,m;a.lastOperator=null,a.possibleOperators=v.possibleItems,a.fieldState=null!==(g=v.fieldState)&&void 0!==g?g:w;var I=v.fieldState===C?rr.incompleteOperator:rr.invalidOperator;return a.errorMessages.push({message:I,values:{filter:null===(m=a.lastFilter)||void 0===m?void 0:m.label,operator:s.slice(a.index,v.index+2).join(" ")}}),W}return a.lastOperator=v.foundItem,a.possibleOperators=v.possibleItems,!se.includes(null===(n=a.lastOperator)||void 0===n?void 0:n.name)&&(a.incompleteValue=!0,a.possibleValueOptions=null!==(l=kr(a.asyncFilterHelpers,a.lastFilter))&&void 0!==l?l:[],a.exceedsAsyncOptionDisplayLimit=Dn(a.asyncFilterHelpers,a.lastFilter,a.possibleValueOptions),a.showDatePicker=(p=null===(u=a.lastFilter)||void 0===u?void 0:u.type,f=a.lastOperator.name,h=a.lastOperator.variation,Boolean(p===K.DATE&&ee.includes(f)||p===K.DATEV3&&h&&ue.includes(h))),function(e){return e.lastFilter&&ve.includes(e.lastFilter.type)&&0===e.possibleValueOptions.length&&!cn(e.asyncFilterHelpers,e.lastFilter)&&!function(e,t){if(!t)return!1;switch(t.type){case K.TAG:case K.SELECTION_MULTI_ASYNC:case K.KEY_VALUE_FILTER:return e[t.type].isFetching(t.id)}return!1}(e.asyncFilterHelpers,e.lastFilter)}(a))?(a.fieldState=w,a.errorMessages.push({message:rr.noOptions,values:{filter:null!==(c=null===(d=a.lastFilter)||void 0===d?void 0:d.label)&&void 0!==c?c:""}}),W):(a.possibleOperators.length>0&&(a.partialLastItemStartMap.OPERATOR=a.lastItemStart),a.index=v.index,a.lastItemStart=dn(s,a.index+1),a.fieldState=se.includes(null===(i=a.lastOperator)||void 0===i?void 0:i.name)?A:L,Q)};function ti(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ri(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ti(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ti(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ni,ii=function(e,t){var r=e.startsWith(t);return r&&e.split(",").forEach((function(n,i){0===i&&e===t||!n.endsWith(t)||(r=!1)})),r},ai=r(99809),oi=(ni={},(0,a.default)(ni,"Y",99),(0,a.default)(ni,"M",99),(0,a.default)(ni,"D",9999),(0,a.default)(ni,ce,9999),ni),si=function(e,t){return t===K.DATE?e.format(I):e.toISOString()};function li(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ui(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?li(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):li(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ci(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return di(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?di(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:}ar pi=function(e){var t;return(null===(t=e.lastFilter)||void 0===t?void 0:t.type)&&ve.includes(e.lastFilter.type)},fi=hi=function(e,t){if(e.incompleteValue){if(!e.lastValueString.endsWith(",")&&e.lastValueString.includes(","))return e.lastItemStart+e.lastValueString.lastIndexOf(",")+1;if(!e.isMultiWordOptionValue){if(""===t[e.index].trim()){for(var r=e.index;""===t[r].trim();)r--;return dn(t,r)}return dn(t,e.index)}return e.lastItemStart}return e.incompleteCondition&&e.index+2>t.length?dn(t,e.index):dn(t,e.index+1)},vi=function(e,t){var r,n,i,a;if(e.lastValues.length>0&&(null===(r=e.lastOperator)||void 0===r?void 0:r.pattern)&&(null===(n=e.lastOperator)||void 0===n?void 0:n.patternError)&&e.lastFilter&&me.includes(e.lastFilter.type)){var o=e.lastOperator.pattern;e.lastOperator.variation===oe&&e.lastOperator.variationPattern&&e.lastValues.some(()&&(o=e.lastOperator.variationPattern);for(var s=Array.isArray(o)?o:[o],l=function(t){var r,n=e.lastValues[t];if(!s.some((function(e){return new RegExp(e).test(n.value.toString())})))return e.fieldState=w,e.errorMessages.push({message:rr.invalidValue,values:{filter:null===(r=e.lastFilter)||void 0===r?void 0:r.label,patternError:e.lastOperator.patternError,value:n.label}}),{v:W}},u=0;u<e.lastValues.length;u++){var c=l(u);if("object"===(0,_r.default)(c))return c.v}}if(e.lastFilter&&ge.includes(e.lastFilter.type)){var d,p="maxLength"in e.lastFilter&&e.lastFilter.maxLength?e.lastFilter.maxLength:1e3;if(e.lastValues.some(())return e.fieldState=w,e.errorMessages.push({message:rr.valueMaxLengthExceeded,values:{filter:null===(d=e.lastFilter)||void 0===d?void 0:d.label,maxLength:p}}),W}var f,h,v=e.lastFilter&&"limit"in e.lastFilter&&e.lastFilter.limit?e.lastFilter.limit:t,g=!1;return(null===(i=e.lastFilter)||void 0===i?void 0:i.type)===K.NUMERIC_MULTI&&(null==e||null===(a=e.lastOperator)||void 0===a?void 0:a.name)&&le.includes(e.lastOperator.name)&&(g=!0),e.lastValues.length>v||g&&e.lastValues.length>1?(e.fieldState=w,e.errorMessages.push({message:rr.valueLimitExceeded,values:{filter:null===(f=e.lastFilter)||void 0===f?void 0:f.label,limit:g?1:v,total:e.lastValues.length}}),W):function(e){var t;if((null===(t=e.lastOperator)||void 0===t?void 0:t.variation)!==oe||!e.lastValueString.includes("*"))return!1;var r,n=!1,i=!1,a=ci(e.lastValues);try{for(a.s();!(r=a.n()).done;){var o=r.value.label;if(o.includes("*")&&(Dr(o)?n=!0:i=!0,n&&i))return!0}}catch(e){a.e(e)}finally{a.f()}return!1}(e)?(e.fieldState=w,e.errorMessages.push({message:rr.invalidWildcardValues,values:{filter:null===(h=e.lastFilter)||void 0===h?void 0:h.label}}),W):Q},gi=function(e){var t=e.defaultFilterValueLimit,r=e.state,n=e.value,i=e.values;r.expectedFieldState=L,r.incompleteValue=!1,r.incompleteCondition=!1,r.isMultiWordOptionValue=!1,r.lastCondition=null,r.possibleConditions=p,r.lastValues=[],r.partialLastItemStartMap.VALUE=null;var a=function(e){var t=e.index,r=e.value,n=e.values,i="".concat(e.lastValueString," ").concat(r).trim(),a=[],o=ii(i,T),s=ii(i,O);if(t+1>=n.length)return{insideSingleQuotes:o,insideDoubleQuotes:s,lastValueString:i};for(var l=t;l+1<n.length;){var u=n[l+1],c=u.toLowerCase(),d=u.replace(/,/g,"");if(d.endsWith(T)?o=!1:d.endsWith(O)&&(s=!1),""!==u){if(!i.endsWith(",")&&!o&&!s){var f=Fn(p,c),h=f.exactItem;if(a=f.possibleItems,h){for(;""===n[l];)l--;return{index:l,lastCondition:ri(ri({},h),{},{rawText:u}),lastValueString:i,possibleConditions:a}}}i="".concat(i," ").concat(u).trim(),l++}else a=[],(o||s)&&(i="".concat(i," ")),l++}for(;""===n[l];)l--;return{index:l,incompleteCondition:a.length>0||null,insideSingleQuotes:o,insideDoubleQuotes:s,lastValueString:i,possibleConditions:a.length>0?a:p}}({index:r.index,lastValueString:r.lastValueString,value:n,values:i}),o=!1,s=!1;a.lastValueString&&(r.lastValueString=a.lastValueString),(0,Ke.isNil)(a.index)||(r.index=a.index),(0,Ke.isNil)(a.incompleteCondition)||(r.incompleteCondition=a.incompleteCondition),(0,Ke.isNil)(a.insideDoubleQuotes)||(o=a.insideDoubleQuotes),(0,Ke.isNil)(a.insideSingleQuotes)||(s=a.insideSingleQuotes),a.lastCondition&&(r.lastCondition=a.lastCondition),a.possibleConditions&&(r.possibleConditions=a.possibleConditions);var l=function(e){for(var t=e.trim().endsWith(","),r=e.split(","),n=[],i=function(e){var t=r[e],i=t.trimLeft().charAt(0);if(i===T&&!fi(t).endsWith(T)||i===O&&!fi(t).endsWith(O)){var o=r.slice(e).findIndex(();if(-1===o)return n.push(r.slice(e).join()),a=e,"break";n.push(r.slice(e,e+o+1).join()),e+=o}else n.push(t);a=e},a=0;a<r.length&&"break"!==i(a);a++);return t?n.filter((function(e){return e})).map(():n.filter(().map((function(e,t){return t!==n.length-1?"".concat(e.trim(),","):e.trim()}))}(r.lastValueString);if(l.length>1&&r.lastFilter){var u,c,d,f;if(!Ie.includes(r.lastFilter.type)){var h;r.fieldState=w;var v=Ee.includes(r.lastFilter.type)?rr.cannotHaveMultipleValuesAddQuotes:rr.cannotHaveMultipleValues;return r.errorMessages.push({message:v,values:{filter:null===(h=r.lastFilter)||void 0===h?void 0:h.label}}),W}if((null===(u=r.lastFilter)||void 0===u?void 0:u.type)===K.NUMERIC_MULTI&&(null==r||null===(c=r.lastOperator)||void 0===c?void 0:c.name)&&le.includes(r.lastOperator.name))return r.fieldState=w,r.errorMessages.push({message:rr.cannotHaveMultipleValuesForOperator,values:{filter:null===(d=r.lastFilter)||void 0===d?void 0:d.label,operator:null===(f=r.lastOperator)||void 0===f?void 0:f.label}}),W}var g=kr(r.asyncFilterHelpers,r.lastFilter),I=[];if(g){var E;if(function(e,t,r){var n,i=ci(t);try{var a=function(){var t,i,a,o=n.value;e.partialLastItemStartMap.VALUE=null;var s=o.replace(/,$/,"").trim(),l=s,u=null;if((null===(t=e.lastFilter)||void 0===t?void 0:t.type)===K.KEY_VALUE_FILTER){e.partialFieldState=B;var c=s.lastIndexOf(":");-1!==c&&(u=s.slice(c+1).trim(),s=s.slice(0,c+1).trim())}s=s.toLowerCase();var d=null!==(i=kr(e.asyncFilterHelpers,e.lastFilter,s,101))&&void 0!==i?i:[];e.possibleValueOptions=An(d,s);var p,f,h,v,g,m=Ln(e.possibleValueOptions,s);if(e.possibleValueOptions=e.possibleValueOptions.filter((function(e){var t=e.value;return!r.includes(t)})),m&&r.includes(m.value))return e.fieldState=e.possibleValueOptions.length>0?C:w,e.errorMessages.push({message:rr.duplicateOptionValue,values:{filter:null===(p=e.lastFilter)||void 0===p?void 0:p.label,value:m.label}}),e.fieldState===C&&(e.partialLastItemStartMap.VALUE=e.lastItemStart+e.lastValueString.lastIndexOf(",")+1),{v:W};if(0===e.possibleValueOptions.length&&e.incompleteCondition){var I,E=s;s=s.substring(0,s.lastIndexOf(" ")),d=(d=null!==(I=kr(e.asyncFilterHelpers,e.lastFilter,s,101))&&void 0!==I?I:[]).filter((function(e){var t=e.value;return!r.includes(t)})),e.possibleValueOptions=An(d,s),(m=Ln(e.possibleValueOptions,s))?(e.lastValueString=e.lastValueString.substring(0,e.lastValueString.lastIndexOf(" ")),e.possibleValueOptions=[],e.index--):(s=E,e.possibleValueOptions=[])}if((null===(a=e.lastFilter)||void 0===a?void 0:a.type)===K.KEY_VALUE_FILTER&&0===e.possibleValueOptions.length&&(s.startsWith(O)||s.startsWith(T))){var b,y=s.startsWith(O)?O:T,S=s;s=s.slice(1),d=null!==(b=kr(e.asyncFilterHelpers,e.lastFilter,s,101))&&void 0!==b?b:[],e.possibleValueOptions=An(d,s),(m=Ln(e.possibleValueOptions,s))?(m=ui(ui({},m),{},{label:"".concat(y).concat(m.label)}),e.possibleValueOptions=[]):e.possibleValueOptions.length>0?e.possibleValueOptions=e.possibleValueOptions.map((function(e){return ui(ui({},e),{},{label:"".concat(y).concat(e.label)})})):(s=S,e.possibleValueOptions=[])}if(!m)return 0===e.possibleValueOptions.length?(e.fieldState=w,e.errorMessages.push({message:rr.invalidOptionValue,values:{filter:null===(h=e.lastFilter)||void 0===h?void 0:h.label,value:l}}),{v:W}):o.includes(",")?(e.possibleValueOptions=[],e.fieldState=w,e.errorMessages.push({message:rr.invalidOptionValue,values:{filter:null===(v=e.lastFilter)||void 0===v?void 0:v.label,value:l}}),{v:W}):(e.fieldState=C,e.errorMessages.push({message:rr.incompleteOptionValue,values:{filter:null===(f=e.lastFilter)||void 0===f?void 0:f.label,value:l}}),e.incompleteValue=!0,e.isMultiWordOptionValue=s.includes(" "),"break");if((null===(g=e.lastFilter)||void 0===g?void 0:g.type)===K.KEY_VALUE_FILTER){if(e.possibleValueOptions=[],!u)return e.partialFieldState=j,e.incompleteValue=!0,e.fieldState=w,{v:W};e.partialFieldState=Y,m={label:"".concat(m.label," ").concat(u),value:{id:m.value.toString(),value:u}}}e.lastValues.push(m),r.push(m.value),e.possibleValueOptions=e.possibleValueOptions.filter((function(e){var t;return e.label!==(null===(t=m)||void 0===t?void 0:t.label)})),e.possibleValueOptions.length>0&&!o.trim().endsWith(",")&&(e.lastValueString.includes(",")?e.partialLastItemStartMap.VALUE=e.lastItemStart+e.lastValueString.lastIndexOf(",")+1:e.partialLastItemStartMap.VALUE=e.lastItemStart)};for(i.s();!(n=i.n()).done;){var o=a();if("break"===o)break;if("object"===(0,_r.default)(o))return o.v}}catch(e){i.e(e)}finally{i.f()}e.exceedsAsyncOptionDisplayLimit=Dn(e.asyncFilterHelpers,e.lastFilter,e.possibleValueOptions),pi(e)&&e.possibleValueOptions.length>he&&(e.possibleValueOptions=e.possibleValueOptions.slice(0,he))}(r,l,I)===W)return(null===(E=r.lastFilter)||void 0===E?void 0:E.type)===K.KEY_VALUE_FILTER&&r.incompleteValue?r.index+1>=i.length||i.slice(r.index+1).every((function(e){return""===e}))?(r.fieldState=w,r.errorMessages.push({message:rr.incompleteKeyValuePairValue,values:{filter:r.lastFilter.label,value:r.lastValueString}}),W):(r.fieldState=L,q):W}else{var b;if(pi(r))return cn(r.asyncFilterHelpers,r.lastFilter)?(r.fieldState=R,r.errorMessages.push({message:rr.failedFetchingFilterOptions,values:{filter:null===(b=r.lastFilter)||void 0===b?void 0:b.label}})):r.fieldState=F,W;if(r.lastFilter&&z.includes(r.lastFilter.type)){if(function(e,t){var r,n,i,a;if(e.showDatePicker=!1,!e.lastFilter||!z.includes(null===(r=e.lastFilter)||void 0===r?void 0:r.type))return w;var o=e.lastFilter.type,s=null===(n=e.lastOperator)||void 0===n?void 0:n.name,l=null===(i=e.lastOperator)||void 0===i?void 0:i.variation;return(null===(a=e.lastOperator)||void 0===a?void 0:a.name)===$?function(e,t){var r,n=t[0],i=Number.parseFloat(n);return!isNaN(Number(n))&&Number.isInteger(i)?(e.lastValues=[{label:n,value:n}],Q):(e.fieldState=w,e.errorMessages.push({message:rr.invalidDateDurationValue,values:{duration:n,filter:null===(r=e.lastFilter)||void 0===r?void 0:r.label}}),W)}(e,t):void 0===l||l===te||l===ie?function(e){var t,r=e.filterType,n=e.operator,i=e.operatorVariation,a=e.state,o=e.splitValues[0],s=Nr()(o,m,!0);if(a.incompleteCondition&&!s.isValid()&&(o=o.split(" ").slice(0,-1).join(" "),(s=Nr()(o,m,!0)).isValid()&&(a.index=a.index-1,a.lastValueString=o)),s.isValid()){if(i===ie){var l=s.clone().startOf("day"),u=s.clone().endOf("day");a.lastValues=[{label:l.format(m),value:si(l,r)},{label:u.format(m),value:si(u,r)}]}else{var c=s;n===X&&(c=s.clone().endOf("day")),a.lastValues=[{label:s.format(m),value:si(c,r)}]}return Q}return a.fieldState=w,a.showDatePicker=!0,a.errorMessages.push({message:rr.invalidDate,values:{date:o,dateFormat:m,filter:null===(t=a.lastFilter)||void 0===t?void 0:t.label}}),W}({filterType:o,operator:s,operatorVariation:l,state:e,splitValues:t}):l===ae?function(e){var t,r,n,i=e.filterType,a=e.state,o=null===(t=e.splitValues[0])||void 0===t?void 0:t.split(" "),s=(0,ai.default)(o),l=s[0],u=s[1],c=s.slice(2),d=null==c?void 0:c.join(" "),p=Nr()(l,m,!0),f=Ln([y],null==u?void 0:u.toLowerCase()),h=Nr()(d,m,!0);if(a.incompleteCondition&&!h.isValid()&&(d=d.split(" ").slice(0,-1).join(" "),(h=Nr()(d,m,!0)).isValid()&&(a.index=a.index-1,a.lastValueString="".concat(l," ").concat(u," ").concat(d))),p.isValid()&&f&&h.isValid())return h.isBefore(p)?(a.lastValues=[{label:l,value:si(p.startOf("day"),i)}],a.lastValueString="".concat(l," ").concat(u," "),a.lastItemStart+=a.lastValueString.length,a.possibleValueOptions=[],a.showDatePicker=!0,a.fieldState=w,a.errorMessages.push({message:rr.endDateIsBeforeStartDate,values:{endDate:d,filter:null===(n=a.lastFilter)||void 0===n?void 0:n.label,startDate:l}}),W):(a.lastValues=[{label:l,value:si(p.startOf("day"),i)},{label:d,value:si(h.endOf("day"),i)}],Q);if(p.isValid()){var v,g,I;if(a.lastValues=[{label:l,value:si(p.startOf("day"),i)}],f)return a.lastValueString="".concat(l," ").concat(u," "),a.lastItemStart+=a.lastValueString.length,a.possibleValueOptions=[],a.showDatePicker=!0,d?(a.fieldState=w,a.errorMessages.push({message:rr.invalidEndDate,values:{date:d,dateFormat:m,filter:null===(I=a.lastFilter)||void 0===I?void 0:I.label}}),W):(a.fieldState=C,a.errorMessages.push({message:rr.missingEndDate,values:{dateFormat:m,filter:null===(g=a.lastFilter)||void 0===g?void 0:g.label}}),W);if(a.fieldState=C,a.lastValueString="".concat(l," "),a.lastItemStart+=a.lastValueString.length,u){var E;a.possibleValueOptions=An([y],null==u?void 0:u.toLowerCase());var b=rr.incompleteBetweenDatePreposition;return 0===a.possibleValueOptions.length&&(a.fieldState=w,b=rr.invalidBetweenDatePreposition),a.errorMessages.push({message:b,values:{dateFormat:m,filter:null===(E=a.lastFilter)||void 0===E?void 0:E.label,preposition:u}}),W}return a.possibleValueOptions=[y],a.errorMessages.push({message:rr.missingBetweenDatePreposition,values:{dateFormat:m,filter:null===(v=a.lastFilter)||void 0===v?void 0:v.label}}),W}return a.fieldState=w,a.showDatePicker=!0,a.errorMessages.push({message:rr.invalidStartDate,values:{date:l,dateFormat:m,filter:null===(r=a.lastFilter)||void 0===r?void 0:r.label}}),W}({filterType:o,state:e,splitValues:t}):l===re||l===ne?function(e,t){var r,n;e.partialFieldState=k;var i=null===(r=t[0])||void 0===r?void 0:r.split(" "),a=(0,ai.default)(i),o=a[0],s=a.slice(1),l=null==s?void 0:s.join(" "),u=Number.parseFloat(o);if(!isNaN(Number(o))&&Number.isInteger(u)){var c,d;e.partialFieldState="DURATION_UNIT";var p,f,h,v=or(u),g=null===(c=l)||void 0===c?void 0:c.toLowerCase(),m=Ln(v,g);if(!m&&l&&e.incompleteCondition&&(g=(l=l.split(" ").slice(0,-1).join(" ")).toLowerCase(),e.index--,(m=Ln(v,g))||(g=(l=s.join(" ")).toLowerCase(),e.index++)),m){var I,E,b="string"==typeof m.value&&oi[m.value];return"number"==typeof b&&u>b?(e.errorMessages.push({message:rr.dateDurationValueExceedsMax,values:{duration:o,filter:null===(E=e.lastFilter)||void 0===E?void 0:E.label,durationUnit:m.label,maxValue:b}}),e.partialFieldState=k,e.fieldState=w,W):(e.partialFieldState=Y,e.possibleValueOptions=[],e.lastValues=[{label:e.lastValueString,value:nn(o,m.value.toString(),null==e||null===(I=e.lastOperator)||void 0===I?void 0:I.variation)}],Q)}if(e.lastValueString="".concat(o," "),e.lastItemStart+=e.lastValueString.length,e.fieldState=C,e.lastCondition&&(s.push(null!==(p=e.lastCondition.rawText)&&void 0!==p?p:e.lastCondition.label),g=(l=s.join(" ")).toLowerCase()),e.possibleValueOptions=(null===(d=l)||void 0===d?void 0:d.length)?An(v,g):v,l&&(e.partialFieldState=H),0===e.possibleValueOptions.length)e.fieldState=w,l?e.errorMessages.push({message:rr.invalidDateDurationUnit,values:{duration:o,filter:null===(f=e.lastFilter)||void 0===f?void 0:f.label,unit:l}}):e.errorMessages.push({message:rr.missingDateDurationUnit,values:{duration:o,filter:null===(h=e.lastFilter)||void 0===h?void 0:h.label}});else if(l){var y;e.errorMessages.push({message:rr.incompleteDateDurationUnit,values:{filter:null===(y=e.lastFilter)||void 0===y?void 0:y.label,unit:l}})}else{var S;e.errorMessages.push({message:rr.missingDateDurationUnit,values:{duration:o,filter:null===(S=e.lastFilter)||void 0===S?void 0:S.label}})}return W}return e.fieldState=w,e.errorMessages.push({message:rr.invalidDateDurationValue,values:{duration:o,filter:null===(n=e.lastFilter)||void 0===n?void 0:n.label}}),W}(e,t):(e.fieldState=w,W)}(r,l)===W)return W}else if(r.lastValues=l.map((function(e){var t=e.replace(/,$/,"").trim();return t.startsWith(T)&&t.endsWith(T)||t.startsWith(O)&&t.endsWith(O)?{label:t,value:t.slice(1,-1)}:{label:t,value:t}})),r.incompleteCondition)return function(e,t){if(vi(e,t)===W){var r,n=e.lastValues.length-1,i=null===(r=e.lastValues[n])||void 0===r?void 0:r.value;return"string"==typeof i?(e.errorMessages=[],e.lastValues[n].value=i.split(" ").slice(0,-1).join(" "),vi(e,t)===W?(e.lastValues[n].value=i,W):(e.index--,e.fieldState=A,Q)):W}return e.fieldState=P,e.expectedFieldState=A,Q}(r,t)===W?W:(r.lastItemStart=hi(r,i),Q)}if(r.lastItemStart=hi(r,i),r.incompleteValue)return r.index+1>=i.length||i.slice(r.index+1).every(()?W:(r.fieldState=L,r.errorMessages=[],q);if(o||s){var S;r.fieldState=w;var x=o?rr.missingClosingDoubleQuote:rr.missingClosingSingleQuote;return r.errorMessages.push({message:x,values:{filter:null===(S=r.lastFilter)||void 0===S?void 0:S.label}}),W}if(r.lastValueString.endsWith(",")){var _;if(r.lastFilter&&Ie.includes(r.lastFilter.type))if(r.lastFilter.type===K.NUMERIC_MULTI&&r.lastOperator&&le.includes(r.lastOperator.name)){var D,N;r.fieldState=w,r.errorMessages.push({message:rr.cannotHaveMultipleValuesForOperator,values:{filter:null===(D=r.lastFilter)||void 0===D?void 0:D.label,operator:null===(N=r.lastOperator)||void 0===N?void 0:N.label}})}else{var U,V=null==g?void 0:g.filter((function(e){var t=e.value;return!I.includes(t)}));V&&(r.possibleValueOptions=V),r.fieldState=C,r.errorMessages.push({message:rr.valueEndsWithComma,values:{filter:null===(U=r.lastFilter)||void 0===U?void 0:U.label}})}else r.fieldState=w,r.errorMessages.push({message:rr.cannotHaveMultipleValues,values:{filter:null===(_=r.lastFilter)||void 0===_?void 0:_.label}});return W}if(vi(r,t)===W)return W;if(r.fieldState=A,function(e){return kr(e.asyncFilterHelpers,e.lastFilter)&&e.lastValues.length>0&&!e.lastValueString.endsWith(",")&&0===e.possibleValueOptions.length&&e.possibleConditions.length===p.length&&e.lastFilter&&Ie.includes(e.lastFilter.type)}(r)){var G=null==g?void 0:g.filter(();r.possibleValueOptions=null!=G?G:[],r.expectedFieldState=M}return Q};r Ei=function e(t){return t.reduce((function(t,r){return"completedFilters"in r?t+e(r.completedFilters):t+1}),0)},bi=function(e,t,r){if(!t.filterState)return!1;if(Ei(t.filterState.completedFilters)+1>e){t.fieldState=w;var n=rr.willExceedFilterLimit;return t.index+1<r.length&&r.slice(t.index+1).some(()&&(n=rr.exceededFilterLimit),t.errorMessages.push({message:n,values:{limit:e}}),!0}return!1},yi=function(e){var t,r=e.allowNotCondition,n=e.asyncFilterHelpers,i=e.currentState,o=void 0===i?null:i,s=e.filters,l=e.filterString,u=void 0===l?"":l,c=e.formatMessage,d=e.phraseTree,f={currentPhraseItem:null,errorMessages:[],exceedsAsyncOptionDisplayLimit:!1,incompleteCondition:!1,lastCondition:null,lastFilter:null,lastItemStart:0,lastOperator:null,lastPhraseData:{currentPhraseString:"",values:[]},lastValues:[],lastValueString:"",partialFieldState:Y,partialLastItemStartMap:(t={},(0,a.default)(t,_,null),(0,a.default)(t,N,null),(0,a.default)(t,D,null),(0,a.default)(t,L,null),t),possiblePartialPhraseOptions:[],possibleConditions:p,possibleFilters:s,possibleNestingOptions:r?S:[g],possibleOperators:[],possiblePhraseOptions:cr(d).keywords,possibleValueOptions:[],showDatePicker:!1,valueHintPopoverOptions:[]};return o?Ii(Ii({},o),f):Ii(Ii({},f),{},{asyncFilterHelpers:n,chipState:{chips:[],remainingText:u},expectedFieldState:_,fieldState:_,filterState:null,formatMessage:c,incompleteValue:!1,index:0,isMultiWordOptionValue:!1})},Si=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return un(e),Ii({chipState:e.chipState,errorMessages:e.errorMessages,exceedsAsyncOptionDisplayLimit:e.exceedsAsyncOptionDisplayLimit,expectedFieldState:e.expectedFieldState,fieldState:e.fieldState,filterState:e.filterState,lastFilter:e.lastFilter,lastItemStart:e.lastItemStart,lastOperator:e.lastOperator,lastValues:e.lastValues,partialLastItemStartMap:e.partialLastItemStartMap,possiblePartialPhraseOptions:e.possiblePartialPhraseOptions,possibleConditions:e.possibleConditions,possibleFilters:e.possibleFilters,possibleNestingOptions:e.possibleNestingOptions,possibleOperators:e.possibleOperators,possiblePhraseOptions:e.possiblePhraseOptions,possibleValueOptions:e.possibleValueOptions,showDatePicker:e.showDatePicker,valueHintPopoverOptions:e.valueHintPopoverOptions},t)},Oi=function(e){var t=e.allowNotCondition,r=void 0===t||t,n=e.asyncFilterHelpers,i=e.defaultFilterValueLimit,a=e.enableChipMode,o=e.filterLimit,s=e.filters,l=e.filterString,u=e.formatMessage,c=e.maxNestedLevel,d=e.phraseTree,p=l.split(" ");return Ti({allowNotCondition:r,asyncFilterHelpers:n,defaultFilterValueLimit:i,enableChipMode:a,filterLimit:o,filters:s,formatMessage:u,maxNestedLevel:c,phraseTree:d,values:p})},Ti=function(e){var t,r=e.allowNotCondition,n=e.asyncFilterHelpers,i=e.defaultFilterValueLimit,a=e.enableChipMode,o=e.filterLimit,s=e.filters,l=e.formatMessage,u=e.maxNestedLevel,c=e.nestedLevel,d=void 0===c?0:c,f=e.phraseTree,h=e.values,v=yi({allowNotCondition:r,asyncFilterHelpers:n,filters:s,filterString:h.join(" "),formatMessage:l,phraseTree:f});if(0===h.length||h.every(())return Si(v,{fieldState:x,possibleConditions:[]});for(;v.index<h.length;){var g=h[v.index];if(""!==g){v.valueHintPopoverOptions=[];var m=v.index;switch(v.fieldState){case _:var I=Zn({allowNotCondition:r,enableChipMode:a,defaultFilterValueLimit:i,filterLimit:o,filters:s,maxNestedLevel:u,nestedLevel:d,phraseTree:f,state:v,value:g,values:h});if(I===W)return Si(v,{filterState:null});if(I===Q)break;if("object"===(0,_r.default)(I)&&"fieldState"in I)return I;var E,b=null;if(f&&(b=Hn({phraseTree:f,state:v,value:g,values:h})).result===Q){v.possibleFilters=[],v.currentPhraseItem&&"descendantAsyncFilter"in v.currentPhraseItem&&Cr(v.asyncFilterHelpers,v.currentPhraseItem.descendantAsyncFilter),a&&xn(v,m,h);break}if(Wn({filters:s,state:v,value:g,values:h})===W)return(v.possibleNestingOptions.length>0||v.possiblePhraseOptions.length>0)&&(v.fieldState=C,(null===(E=b)||void 0===E?void 0:E.errorMessages)&&(v.errorMessages=b.errorMessages)),Si(v,{filterState:null});Cr(v.asyncFilterHelpers,v.lastFilter),a&&bn(v,m,h);break;case D:if(ei({state:v,value:g,values:h})===W)return v.possibleFilters.length>0&&(v.fieldState=C),Si(v,{filterState:null});a&&yn(v,m,h);break;case L:if(gi({defaultFilterValueLimit:i,state:v,value:g,values:h})===W)return Si(v,{filterState:null});if(a&&Sn(v,m,h),v.fieldState===P){var y=sn({filter:v.lastFilter,filterState:v.filterState,operator:v.lastOperator,phraseData:v.lastPhraseData,value:v.lastValues});return Si(v,{filterState:y})}break;case A:if(qn({state:v,value:g,values:h})===W){if(v.currentPhraseItem&&Object.keys(v.currentPhraseItem.descendants).length>0){v.fieldState=U;continue}return Si(v,{filterState:null})}if(a&&On(v,m,h),bi(o,v,h))return Si(v,{filterState:null});(v=yi({allowNotCondition:r,asyncFilterHelpers:n,currentState:v,filters:s,formatMessage:l,phraseTree:f})).lastItemStart=dn(h,v.index+1),v.fieldState=_;break;case U:case N:if(v.possiblePhraseOptions=[],!v.currentPhraseItem)return v.fieldState=w,Si(v,{filterState:null});var S,O=Hn({phraseTree:v.currentPhraseItem.descendants,state:v,value:g,values:h});if(v.currentPhraseItem&&"descendantAsyncFilter"in v.currentPhraseItem&&Cr(v.asyncFilterHelpers,v.currentPhraseItem.descendantAsyncFilter),O.errorMessages&&(S=v.errorMessages).push.apply(S,(0,$t.default)(O.errorMessages)),O.result===W)return v.expectedFieldState===U&&v.possibleConditions.length>0&&(v.fieldState=C),Si(v,{filterState:null});a&&_n(v,m,h),v.expectedFieldState===U&&(v.possibleConditions=p,v.errorMessages=[])}v.index++}else v.index++}if(v.fieldState===L&&(null===(t=v.lastFilter)||void 0===t?void 0:t.type)&&ve.includes(v.lastFilter.type)&&0===v.possibleValueOptions.length){var T,V=F;return cn(v.asyncFilterHelpers,v.lastFilter)&&(V=R,v.errorMessages.push({message:rr.failedFetchingFilterOptions,values:{filter:null===(T=v.lastFilter)||void 0===T?void 0:T.label}})),Si(v,{fieldState:V,filterState:null,expectedFieldState:v.fieldState})}var k=v.fieldState!==A?C:v.fieldState,B=v.expectedFieldState===M?v.expectedFieldState:v.fieldState;!function(e,t,r){t===C&&(r===D&&e.lastFilter?e.errorMessages.push({message:rr.missingOperator,values:{filter:e.lastFilter.label}}):r===L&&e.lastFilter?e.errorMessages.push({message:rr.missingValue,values:{filter:e.lastFilter.label}}):r===_&&e.filterState?e.errorMessages.push({message:rr.endsWithCondition}):r===N&&e.errorMessages.push({message:rr.incompletePhrase,values:{phrase:e.lastPhraseData.currentPhraseString}}))}(v,k,B);var j=null;return k!==C&&(j=sn({filter:v.lastFilter,filterState:v.filterState,operator:v.lastOperator,phraseData:v.lastPhraseData,value:v.lastValues})),Si(v,{filterState:j,fieldState:k,expectedFieldState:B})};unction _i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Di=function(e,t){if(e in t){var r=t[e];return{phraseItem:r,phraseTree:r.descendants}}var n={descendants:{},label:"",pattern:"^\\d+$",type:Ne};return t[e]=n,{phraseItem:n,phraseTree:n.descendants}},Li=function(e,t){if(e in t){var r=t[e];return{phraseItem:r,phraseTree:r.descendants}}var n={descendants:{},label:"",type:Pe};return t[e]=n,{phraseItem:n,phraseTree:n.descendants}},Ai=function(e,t,r){if(e in t){var n,i=t[e],a=xi(i.items);try{for(a.s();!(n=a.n()).done;){var o=n.value;if((0,Ke.isEqual)(o.options,r))return{phraseItem:o,phraseTree:o.descendants}}}catch(e){a.e(e)}finally{a.f()}var s={descendants:{},label:"",options:r,type:Ue};return i.items.push(s),{phraseItem:s,phraseTree:s.descendants}}var l={descendants:{},label:"",options:r,type:Ue},u={items:[l],type:"OPTION_SET"};return t[e]=u,{phraseItem:l,phraseTree:l.descendants}},Mi=function(e){var t=e.asyncFilter,r=e.asyncFilterHelpers,n=e.currentPhraseTree,i=e.keyword;if(i in n){var a=n[i];return{phraseItem:a,phraseTree:a.descendants}}var o={asyncFilter:t,descendants:{},label:"",getOptions:type:Ce};return n[i]=o,{phraseItem:o,phraseTree:o.descendants}},Fi=function(e,t){var r=e.toLowerCase();if(r in t){var n=t[r];return{phraseItem:n,phraseTree:n.descendants}}var i={descendants:{},label:e,type:Ve};return t[r]=i,{phraseItem:i,phraseTree:i.descendants}},Ri=function(e,t,r){for(var n=e.asyncFilter,i=e.filters,a=e.optionLists,o=e.phrase,s=e.phraseId,l=o.split(" "),u=t,c=null,d=0,p=0;p<l.length;p++){var f=l[p];switch(f){case we.NUMBER:var h=Di(f,u);c=h.phraseItem,u=h.phraseTree;break;case we.DURATION_UNIT:var v=Li(f,u);c=v.phraseItem,u=v.phraseTree;break;case we.OPTION_LIST:if(!a||d>a.length-1)break;var g=a[d];d++;var m=Ai(f,u,g);c=m.phraseItem,u=m.phraseTree;break;case we.ASYNC_OPTION_LIST:if(!n)break;var I=Mi({asyncFilter:n,asyncFilterHelpers:r,currentPhraseTree:u,keyword:f});c=I.phraseItem,u=I.phraseTree;break;default:var E=Fi(f,u);c=E.phraseItem,u=E.phraseTree}}c&&(c.filters=i,c.phraseId=s)},wi=(0,Ke.debounce)((function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e.apply(void 0,r)}),300),Ci=(0,Ke.debounce)((function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e.apply(void 0,r)}),300),Pi=(0,Ke.debounce)((function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e.apply(void 0,r)}),300),Ni=(0,Ke.debounce)((,50),Ui=function(e){var t=e.activeFilters,r=e.allowNotCondition,n=void 0===r||r,i=e.dataAttr,o=e.defaultFilterValueLimit,l=void 0===o?5:o,u=e.enableChipMode,c=void 0!==u&&u,d=e.excludeOptions,p=e.filterLimit,f=void 0===p?10:p,h=e.filters,v=e.filtersMeta,g=e.maxHeight,I=void 0===g?(0,s.rems)("200"):g,E=e.maxNestedLevel,b=void 0===E?ye:E,S=e.phraseDefinitions,O=e.onChange,T=e.onResize,D=e.onSubmit,L=e.onTextChange,A=e.parseFilters,M=void 0===A?wr:A,R=e.setMetaDataForFilter,w=e.showSearchButton,N=void 0===w||w,U=e.statusIconTooltipDirection,k=void 0===U?"top":U,B=e.onChangeDebug,j=e.doNotFilterOnEmptyValueInClear,Y=void 0!==j&&j,H=(0,Ge.useIntl)().formatMessage,q=We().useContext(s.IsUniversalDesignContext),W=We().useRef(h);W.current=h;var Q=We().useState({show:!1,top:null,left:null,maxWidth:null}),z=(0,He.default)(Q,2),X=z[0],$=z[1],J=We().useRef(!1);J.current=X.show;var Z=We().useRef(null),ee=We().useRef(S);ee.current=S;var te=We().useState(null),re=(0,He.default)(te,2),ne=re[0],ie=re[1],oe=We().useState(null),se=(0,He.default)(oe,2),le=se[0],ue=se[1],ce=We().useState(0),de=(0,He.default)(ce,2),pe=de[0],ve=de[1],ge=We().useState(x),me=(0,He.default)(ge,2),Ie=me[0],Ee=me[1],be=We().useState(_),Se=(0,He.default)(be,2),Oe=Se[0],Te=Se[1],xe=We().useState(null),_e=(0,He.default)(xe,2),De=_e[0],Le=_e[1],Fe=We().useState(!1),Re=(0,He.default)(Fe,2),we=Re[0],Ce=Re[1],Pe=We().useState([]),Ne=(0,He.default)(Pe,2),Ue=Ne[0],Ve=Ne[1],ke=We().useRef(null),Be=function(e){var t=e.enableChipMode,r=We().useRef(null),n=We().useRef(null),i=We().useRef(null),a=We().useRef(null),o=We().useRef(t);return o.current=t,We().useRef({blur:function(){!o.current&&r.current?r.current.blur():o.current&&n.current&&n.current.blur()},contains:function(e){return!o.current&&r.current?r.current.contains(e):!(!o.current||!n.current)&&n.current.contains(e)},focus:function(){return!o.current&&r.current?r.current.focus():o.current&&n.current?n.current.focus():void 0},getElement:function(){return!o.current&&r.current?r.current:o.current&&n.current?n.current:null},getText:function(){return!o.current&&r.current?r.current.value:o.current&&n.current&&null!==(e=n.current.textContent)&&void 0!==e?e:"";var e},getWrapperElement:isChipMode:isInitialized:function(){return!(o.current||!r.current)||!(!o.current||!n.current)},setOnSetText:setRef:function(e){!o.current&&e&&"value"in e?r.current=e:o.current&&e&&!("value"in e)&&(n.current=e)},setText:function(e,t){!o.current&&r.current?r.current.value=e:o.current&&n.current&&a.current&&a.current(e,t)},setWrapperRef:).current}({enableChipMode:c}),je=function(e){var t=e.excludeOptions,r=e.fieldState,n=e.filtersMeta,i=e.onParseStringInputRef,o=e.queryBuilderInput,s=e.setMetaDataForFilter,l=(0,Ge.useIntl)(),u=We().useRef(!0);We().useEffect((,[]);var c=We().useRef({}),d=We().useState({isSet:!1}),p=(0,He.default)(d,2),f=p[0],h=p[1],v=We().useCallback((function(e,t){c.current[e]=t,h({isSet:!0})}),[]),g=We().useRef({}),m=We().useCallback((,[]),I=We().useRef({}),E=We().useCallback((,[]),b=We().useRef({}),y=We().useState(!1),S=(0,He.default)(y,2),O=S[0],T=S[1],x=We().useState(!1),_=(0,He.default)(x,2),D=_[0],L=_[1],A=We().useRef(D);A.current=D;var M=We().useMemo((function(){var e;return e={},(0,a.default)(e,K.TAG,{initialize:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&!(e in c.current)&&"function"==typeof t&&!Boolean(b.current[e])&&!(e in I.current)){var i=Wt({filterId:e,filtersMeta:n});if(i)Bt({data:i,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m});else{if(!Ht(e,n))return r&&T(!0),(0,Pt.default)(Ct().mark((function r(){var i,a,o,l,c;return Ct().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return b.current[e]=!0,"function"==typeof s&&Gt(e,n)&&s(e,{loading:!0}),r.prev=2,r.next=5,t();case 5:c=r.sent,o=null==c?void 0:c.data,l=null==c?void 0:c.error,r.next=13;break;case 10:r.prev=10,r.t0=r.catch(2),l=!0;case 13:if(u.current){r.next=15;break}return r.abrupt("return");case 15:if(b.current[e]=!1,T(!1),!l&&(null===(i=o)||void 0===i?void 0:i.displayValueToUuidMap)&&(null===(a=o)||void 0===a?void 0:a.uuidToDisplayValueMap)){r.next=22;break}return E(e),h({isSet:!0}),"function"==typeof s&&Ht(e,n)&&s(e,{error:!0}),r.abrupt("return");case 22:Bt({data:o,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m,setMetaDataForFilter:s});case 23:case"end":return r.stop()}}),r,null,[[2,10]])})))();L(!0)}}},getOptions:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he;if(!(e in c.current)){var i=Wt({asyncErrorMapsRef:I,filterId:e,filtersMeta:n});if(!i)return null;Bt({data:i,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m})}var a=c.current[e];return t&&e in t&&(a=a.filter((function(r){var n=r.value;return!t[e].includes(n)}))),a.slice(0,r)},searchOptions:function(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he;if(!(e in c.current)){var a=Wt({asyncErrorMapsRef:I,filterId:e,filtersMeta:n});if(!a)return null;Bt({data:a,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m})}if(c.current[e].length<=i)return c.current[e];var o=c.current[e].filter((function(e){return e.label.toLowerCase().startsWith(r)}));return t&&e in t&&(o=o.filter(()),o.slice(0,i)},getValueMap:function(e){if(!(e in g.current)){var r=Wt({asyncErrorMapsRef:I,filterId:e,filtersMeta:n});if(!r)return null;Bt({data:r,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m})}var i={},g.current[e]);return t&&e in t&&t[e].forEach((),i},hasFetchError:function(e){return e in I.current},isFetching:function(e){return e in b.current&&b.current[e]}}),(0,a.default)(e,K.SELECTION_MULTI_ASYNC,{initialize:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&!(e in c.current)&&"function"==typeof t&&!Boolean(b.current[e])&&!(e in I.current)){var i=Qt({filterId:e,filtersMeta:n});if(i)jt({data:i,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m});else{if(!Ht(e,n))return r&&T(!0),(0,Pt.default)(Ct().mark((function r(){var i,a,o;return Ct().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return b.current[e]=!0,"function"==typeof s&&Gt(e,n)&&s(e,{loading:!0}),r.prev=2,r.next=5,t({loadAll:!0,intl:l});case 5:o=r.sent,i=null==o?void 0:o.data,a=null==o?void 0:o.error,r.next=13;break;case 10:r.prev=10,r.t0=r.catch(2),a=!0;case 13:if(u.current){r.next=15;break}return r.abrupt("return");case 15:if(b.current[e]=!1,T(!1),!a&&i){r.next=22;break}return E(e),h({isSet:!0}),"function"==typeof s&&Ht(e,n)&&s(e,{error:!0}),r.abrupt("return");case 22:jt({data:i,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m,setMetaDataForFilter:s});case 23:case"end":return r.stop()}}),r,null,[[2,10]])})))();L(!0)}}},getOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he;if(!(e in c.current)){var r=Qt({asyncErrorMapsRef:I,filterId:e,filtersMeta:n});if(!r)return null;jt({data:r,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m})}return c.current[e].slice(0,t)},searchOptions:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he;if(!(e in c.current)){var i=Qt({asyncErrorMapsRef:I,filterId:e,filtersMeta:n});if(!i)return null;jt({data:i,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m})}return c.current[e].length<=r?c.current[e]:c.current[e].filter((function(e){return e.label.toLowerCase().startsWith(t)})).slice(0,r)},getValueMap:function(e){if(!(e in g.current)){var t=Qt({asyncErrorMapsRef:I,filterId:e,filtersMeta:n});if(!t)return null;jt({data:t,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m})}return g.current[e]},hasFetchError:function(e){return e in I.current},isFetching:function(e){return e in b.current&&b.current[e]}}),(0,a.default)(e,K.KEY_VALUE_FILTER,{initialize:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&!(e in c.current)&&"function"==typeof t&&!Boolean(b.current[e])&&!(e in I.current)){var i=Qt({filterId:e,filtersMeta:n});if(i)Yt({data:i,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m});else{if(!Ht(e,n))return r&&T(!0),(0,Pt.default)(Ct().mark((function r(){var i,a,o;return Ct().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return b.current[e]=!0,"function"==typeof s&&Gt(e,n)&&s(e,{loading:!0}),r.prev=2,r.next=5,t();case 5:o=r.sent,i=null==o?void 0:o.data,a=null==o?void 0:o.error,r.next=13;break;case 10:r.prev=10,r.t0=r.catch(2),a=!0;case 13:if(u.current){r.next=15;break}return r.abrupt("return");case 15:if(b.current[e]=!1,T(!1),!a&&i){r.next=22;break}return E(e),h({isSet:!0}),"function"==typeof s&&Ht(e,n)&&s(e,{error:!0}),r.abrupt("return");case 22:Yt({data:i,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m,setMetaDataForFilter:s});case 23:case"end":return r.stop()}}),r,null,[[2,10]])})))();L(!0)}}},getOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he;if(!(e in c.current)){var r=Qt({asyncErrorMapsRef:I,filterId:e,filtersMeta:n});if(!r)return null;Yt({data:r,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m})}return c.current[e].slice(0,t)},searchOptions:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he;if(!(e in c.current)){var i=Qt({asyncErrorMapsRef:I,filterId:e,filtersMeta:n});if(!i)return null;Yt({data:i,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m})}return c.current[e].length<=r?c.current[e]:c.current[e].filter(().slice(0,r)},getValueMap:function(e){if(!(e in g.current)){var t=Qt({asyncErrorMapsRef:I,filterId:e,filtersMeta:n});if(!t)return null;Yt({data:t,filterId:e,setAsyncOptionsMap:v,setAsyncValueMaps:m})}return g.current[e]},hasFetchError:isFetching:function(e){return e in b.current&&b.current[e]}}),e}),[t,n,l,E,v,m,s]),R=r===F;return We().useLayoutEffect((function(){f.isSet&&R&&"function"==typeof i.current&&o.isInitialized()&&Object.keys(b.current).every(()&&i.current(o.getText(),!1)}),[R,f,i,o]),We().useLayoutEffect((function(){A.current&&L(function(e){return Boolean(e&&Object.keys(e).some(())}(n))}),[n]),{arePopoverOptionsLoading:R,asyncFilterHelpers:M,isFiltersMetaLoading:D,waitingToParseFiltersToString:O}}({excludeOptions:d,fieldState:Ie,filtersMeta:v,onParseStringInputRef:ke,queryBuilderInput:Be,setMetaDataForFilter:R}),qe=je.arePopoverOptionsLoading,Ze=je.asyncFilterHelpers,et=je.isFiltersMetaLoading,tt=je.waitingToParseFiltersToString,rt=We().useMemo((function(){return function(e,t){if(!e)return null;var r,n={},i={},a=xi(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.phraseId;s&&s in i||(i[s]=!0,Ri(o,n,t))}}catch(e){a.e(e)}finally{a.f()}return n}(S,Ze)}),[S,Ze]),nt=function(e){var t,r=e.lastItemStart,n=e.onParseStringInputRef,i=e.queryBuilderInput,a=We().useRef(null),o=We().useState({show:!1,top:null}),s=(0,He.default)(o,2),l=s[0],u=s[1],c=We().useRef(!1);c.current=l.show;var d=We().useState(!1),p=(0,He.default)(d,2),f=p[0],h=p[1],v=We().useState(!1),g=(0,He.default)(v,2),I=g[0],E=g[1],b=We().createElement(zt,{top:"".concat(null!==(t=l.top)&&void 0!==t?t:0)},We().createElement(Kt.DatePicker,{onBlur:onSelect:function(e){var t=i.getText().trim().substring(0,r).trim();if(i.isInitialized()&&n.current){var a=I?"".concat(e.format(m)," ").concat(y.label," "):e.format(m);i.setText("".concat(t," ").concat(a)),i.isChipMode()||(n.current(i.getText()),requestAnimationFrame(())}},ref:a,shouldCloseOnSelect:!1,tabIndex:-1}));return We().useEffect((function(){var e=function(){var e=i.getElement();if(null!==e&&!1!==c.current){var t=e.getBoundingClientRect(),r=t.top,n=t.height;u({show:!0,top:r+n-28})}};return document.addEventListener("scroll",e),function(){document.removeEventListener("scroll",e)}}),[i]),{closeDatePicker:function(){a.current&&c.current&&(a.current.setOpen(!1),u({show:!1,top:null}))},datePickerComponent:b,datePickerShowRef:c,expectsDate:f,focusDatePicker:function(){var e;(null===(e=a.current)||void 0===e?void 0:e.input)&&a.current.input.focus()},openDatePicker:function(){var e=i.getElement();if(e&&a.current){var t=e.getBoundingClientRect(),r=t.height,n=t.top;u({show:!0,top:n+r-28}),a.current.setOpen(!0)}},setDatePickerState:u,setExpectsDate:h,setIsStartDate:E}}({lastItemStart:pe,onParseStringInputRef:ke,queryBuilderInput:Be}),it=nt.closeDatePicker,at=nt.datePickerComponent,ot=nt.datePickerShowRef,st=nt.expectsDate,lt=nt.focusDatePicker,ut=nt.openDatePicker,ct=nt.setDatePickerState,dt=nt.setExpectsDate,pt=nt.setIsStartDate,ft=dr({allowNotCondition:n,expectedFieldState:Oe,filters:h,fieldState:Ie,phraseTree:rt}),ht=ft.popoverOptions,vt=ft.selectablePopoverOptions,gt=ft.setPopoverOptions,mt=function(e){var t=e.datePickerShowRef,r=e.isUniversalDesign,n=e.onResize,i=e.popoverRef,a=e.popoverShowRef,o=e.queryBuilderInput,l=e.setDatePickerState,u=e.setPopoverState,c=We().useState(null),d=(0,He.default)(c,2),p=d[0],f=d[1],h=We().useState(null),v=(0,He.default)(h,2),g=v[0],m=v[1],I=We().useState(null),E=(0,He.default)(I,2),b=E[0],y=E[1],S=We().useRef(n);return S.current=n,We().useEffect((function(){var e=function(){var e=o.getElement();if(null!==e){o.isChipMode()||(e.style.height=r?Me:Ae,e.style.height=(0,s.rems)("".concat(e.scrollHeight+2)));var n=e.getBoundingClientRect(),c=n.top,d=n.left,p=n.height,f=n.width,h=c,v=p;if(o.isChipMode()){var g=o.getWrapperElement();if(g){var I=g.getBoundingClientRect(),E=I.top,b=I.height;h=E,v=b}}if(m(f),a.current&&i.current){var y=pr({height:v,popoverRef:i,top:h});u((function(e){var t={show:!0,top:y,left:d,maxWidth:f};return(0,Ke.isEqual)(t,e)?e:t}))}else t.current&&l((function(e){var t={show:!0,top:h+v-28};return(0,Ke.isEqual)(t,e)?e:t}))}};return window.addEventListener("resize",e),),[t,r,i,a,o,l,u]),We().useEffect((function(){if(o.isChipMode()){var e=o.getElement(),r=o.getWrapperElement();if(null!==e&&null!==r){var n=new ResizeObserver((function(){var n=e.getBoundingClientRect(),o=n.height,s=n.left,c=n.width,d=r.getBoundingClientRect(),p=d.top,h=d.height;if(m(c),f(o),y(h),a.current&&i.current){var v=pr({height:h,popoverRef:i,top:p});u((function(e){var t={show:!0,top:v,left:s,maxWidth:c};return(0,Ke.isEqual)(t,e)?e:t}))}else t.current&&l((function(e){var t={show:!0,top:p+h-28};return(0,Ke.isEqual)(t,e)?e:t}));var g=S.current;"function"==typeof g&&g({inputHeight:o,inputWidth:c,wrapperHeight:h})}));return n.observe(r),function(){var e=o.getWrapperElement();null!==e&&n.unobserve(e)}}}}),[t,i,a,o,l,u]),We().useEffect((function(){if(!o.isChipMode()){var e=o.getElement();if(null!==e){var t=new ResizeObserver((function(){var t=e.getBoundingClientRect(),r=t.height,n=t.width;m(n),f(r);var i=S.current;"function"==typeof i&&i({inputHeight:r,inputWidth:n,wrapperHeight:null})}));return t.observe(e),function(){var e=o.getElement();null!==e&&t.unobserve(e)}}}}),[o]),{queryBuilderInputHeight:p,queryBuilderInputWidth:g,queryBuilderWrapperHeight:b}}({datePickerShowRef:ot,isUniversalDesign:q,onResize:T,popoverRef:Z,popoverShowRef:J,queryBuilderInput:Be,setDatePickerState:ct,setPopoverState:$}),It=mt.queryBuilderInputWidth,Et=We().useRef(Ze);Et.current=Ze;var bt=We().useMemo((function(){return"function"==typeof D&&"function"==typeof M&&!V.includes(Ie)}),[Ie,D,M]),yt=function(){var e=Be.getElement();if(null!==e)if(st)ut();else{var t=e.getBoundingClientRect(),r=t.top,n=t.left,i=t.height,a=t.width;$({show:!0,top:r+i+G,left:n,maxWidth:a})}},St=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,Qe.unstable_batchedUpdates)((function(){var i,a,o=Oi({allowNotCondition:n,asyncFilterHelpers:Ze,defaultFilterValueLimit:l,enableChipMode:c,filterLimit:f,filters:h,filterString:e,formatMessage:H,maxNestedLevel:b,phraseTree:rt}),u=V.includes(o.fieldState);if(Le(o.fieldState===C||o.fieldState===P?0:null),ue(o.chipState),Ve(o.errorMessages),Ce(o.exceedsAsyncOptionDisplayLimit),Te(o.expectedFieldState),Ee(o.fieldState),ie(o.filterState),ve(o.lastItemStart),gt(o),Be.isInitialized()){var d=Be.getElement();d&&!c&&(d.style.height=q?Me:Ae,d.style.height=(0,s.rems)("".concat(d.scrollHeight+2))),t&&yt()}if(o.showDatePicker?(dt(!0),pt((null===(i=o.lastOperator)||void 0===i?void 0:i.variation)===ae&&0===(null==o||null===(a=o.lastValues)||void 0===a?void 0:a.length)),ut()):(dt(!1),it()),"function"==typeof O&&r){var p=o.filterState?M(o.filterState):null;wi(O,p,u)}"function"==typeof B&&r&&Ci(B,o),"function"==typeof L&&Be.isInitialized()&&Pi(L,u?"":Be.getText().trim())}))};ke.current=St;var Ot=function(){$({show:!1,top:null,left:null,maxWidth:null}),Le(null)},Tt=function(){if("function"==typeof D){var e=ne?M(ne):null;D(e),Ot()}},xt=function(e){if("ArrowDown"===e.key)return ot.current?(e.preventDefault(),lt(),!1):!X.show||!(null==vt?void 0:vt.length)||(e.preventDefault(),Le((function(e){var t,r=null===e?0:e+1;return!vt||0===(null!==(t=null==vt?void 0:vt.length)&&void 0!==t?t:0)||r>=(null==vt?void 0:vt.length)?0:r})),!1);if("ArrowUp"===e.key)return!X.show||!(null==vt?void 0:vt.length)||(e.preventDefault(),Le((function(e){var t,r=null===e?-1:e-1;return vt&&0!==(null!==(t=null==vt?void 0:vt.length)&&void 0!==t?t:0)?r<0?(null==vt?void 0:vt.length)-1:r:null})),!1);if("Enter"===e.key){if(e.preventDefault(),X.show&&(null==vt?void 0:vt.length)&&Be.isInitialized()&&null!==De&&De<vt.length){var t,r=vt[De];if("string"==typeof r)return!1;var n=null!==(t=r.lastItemStart)&&void 0!==t?t:pe,i=Be.getText().trim().substring(0,n).trim(),a=r.label,o=r.appendToList;Ir({currentValue:i,selectedLabel:a,queryBuilderInput:Be,appendToList:o}),Be.isChipMode()||St(Be.getText())}else bt&&Tt();return!1}return"Escape"!==e.key||(it(),Ot(),!1)},_t=Dt=function(){Be.isChipMode()?Be.setText("",{focusOnInput:!1}):St(Be.getText()),"function"==typeof D&&(Y?Be.getText()&&D(null):D(null)),Ot()},Lt=Be.isInitialized();We().useLayoutEffect((function(){if(W.current&&t&&Be.isInitialized()&&!et&&!0!==tt){var e=rn({activeFilters:t,asyncFilterHelpers:Et.current,filters:W.current,phraseDefinitions:ee.current});"string"==typeof e&&e!==Be.getText()&&ke.current?(Be.setText(e,{focusOnInput:!1,triggerOnChange:!1}),Be.isChipMode()||ke.current(Be.getText(),!1,!1)):"string"!=typeof e&&(e.error===fe?Cr(Et.current,e.filter,!0):e.errorMessage&&Ve([e.errorMessage]))}}),[t,Be,Lt,et,tt]);var At=V.includes(Ie)||(null==Ue?void 0:Ue.length)>0,Mt=We().createElement(Or,{errorMessages:Ue,fieldState:Ie,isErrorState:At,tooltipDirection:k}),Ft=tt||et;return We().createElement(We().Fragment,null,We().createElement($e.Flex,null,We().createElement($e.Box,{flex:"1"},c&&We().createElement(Rt,{chipState:le,errorBorder:At,isLoading:Ft,maxHeight:I,maxWidth:It,onChipInputChange:onChipInputFocus:yt,onChipInputKeyDown:xt,onClearClick:Dt,placeholder:H(Jt.placeholder),queryBuilderInput:Be,statusIcon:Mt}),!c&&We().createElement(xr,{isErrorState:At,isLoading:Ft,isUniversalDesign:q,maxHeight:I,onTextInputChange:onClearClick:Dt,onTextInputFocus:yt,onTextInputKeyDown:xt,queryBuilderInput:Be,statusIcon:Mt})),N&&We().createElement($e.Box,null,q?We().createElement(Je.PdsSearchButton,(0,Ye.default)({},null==i?void 0:i.searchButton,{disabled:!bt,onClick:_t}),We().createElement(Xe.SearchIcon,{size:(0,s.rems)("16"),mr:4,color:"pds.colors.icon-accent-idle"}),H(Jt.applyButton)):We().createElement(ze.Button,{dataAttr:null==i?void 0:i.searchButton,disabled:!bt,kind:"primary",ml:8,onClick:_t},H(Jt.searchButton)))),We().createElement(yr,{arePopoverOptionsLoading:qe,datePickerShowRef:ot,exceedsAsyncOptionDisplayLimit:we,lastItemStart:pe,onParseStringInput:St,popoverOptions:ht,popoverRef:Z,popoverShowRef:J,popoverState:X,queryBuilderInput:Be,selectablePopoverOptions:vt,selectedPopoverIndex:De,setPopoverState:$,setSelectedPopoverIndex:Le}),at)},Vi=function(e){var t;return t={},(0,a.default)(t,K.TAG,{initialize:function(){},getOptions:function(t){if(!e||!(t in e))return null;var r=e[t];return Object.keys(r.displayValueToUuidMap).reduce((function(e,t){var n=Ut(t);return e.push({label:n,value:r.displayValueToUuidMap[t]}),e}),[])},searchOptions:function(){return null},getValueMap:function(t){return e&&t in e?e[t].uuidToDisplayValueMap:null},hasFetchError:function(){return!1},isFetching:function(){return!1}}),(0,a.default)(t,K.SELECTION_MULTI_ASYNC,{initialize:function(){},getOptions:function(t){return e&&t in e?e[t].map(():null},searchOptions:function(){return null},getValueMap:function(t){return e&&t in e?e[t].reduce((function(e,t){return e[t.value.toString()]=t.label,e}),{}):null},hasFetchError:function(){return!1},isFetching:function(){return!1}}),(0,a.default)(t,K.KEY_VALUE_FILTER,{initialize:function(){},getOptions:function(t){return e&&t in e?e[t].map((function(e){return{label:"".concat(Vt(e.label),":"),value:e.value}})):null},searchOptions:getValueMap:function(t){return e&&t in e?e[t].reduce((,{}):null},hasFetchError:function(){return!1},isFetching:),t}}}]);