var e,t;!function(e){e.CHROME="chrome",e.FIREFOX="firefox",e.SAFARI="safari",e.OTHER="other"}(e||(e={})),function(e){e.ONE_STEP="oneStep",e.TWO_STEP="twoStep",e.OFF="off"}(t||(t={}));var i,n,o,r,s;!function(e){e.CUSTOM_BUTTONS="custom-buttons",e.FLYOUT_WIDGET="flyout-widget",e.PARTNER_JS_API="partner-js-api"}(i||(i={})),function(e){e.NOT_SHOPIFY="not_shopify",e.STORAGE_NOT_DEFINED="storage_not_defined",e.LOCALSTORAGE_NOT_AVAILABLE="localstorage_not_available",e.IN_COMAPTIBLE_BROWSER="incompatible_browser",e.NO_SERVICE_WORKER="no_service_worker",e.NO_SUBDOMAIN="no_subdomain",e.OLD_IOS_DEVICE="old_ios_device",e.MICROSOFT_EDGE="microsoft_edge",e.NOT_ADDED_TO_HOME_SCREEN="not_added_to_home_screen",e.INCOGNITO="incognito",e.NOTIFICATION_NOT_DEFINED="notification_not_defined",e.NO_FILE_SYSTEM="no_file_system",e.DISABLED_RESYNC="disable_resync"}(n||(n={})),function(e){e.NO_SUBSCRIBER_TOKEN="no_subsriber_token",e.INVALID_SUBSCRIBER_TOKEN="invalid_subscriber_token",e.PERMISSION_DENIED="permission_denied",e.PERMISSION_NOT_GRANTED="permission_not_granted",e.INVALID_STATE_ERROR="InvalidStateError",e.UNKNOWN_EVENT="unknown_event"}(o||(o={})),function(e){e.BACK_IN_STOCK="back_in_stock",e.PRICE_DROP="price_drop"}(r||(r={})),function(e){e.SILENT="silent",e.DEBUG="debug"}(s||(s={}));const a={WIDGET_CONFIG_KEY:{HOME:"home",PRICE_DROP:"price_drop",BACK_IN_STOCK:"back_in_stock"},EVENT_API_PATH:{PRICE_DROP:"price-drop",BACK_IN_STOCK:"back-in-stock"},ENVIRONMENT:{staging:"staging",production:"production"},STORAGE_KEYS:{VISITOR_TOKEN:"pushowl_visitor_token",SESSION_TOKEN:"pushowl_session_token",SUBSCRIBER_TOKEN:"pushowl_subscriber_token",SUBSCRIPTION:"pushowl_subscription",SW_SUBSCRIPTION:"pushowl_sw_subscription",SW_SUBSCRIBER_TOKEN:"pushowl_sw_subscriber_token",BACK_IN_STOCK_SUBSCRIPTIONS:"pushowl_back_in_stock_subscriptions",PRICE_DROP_SUBSCRIPTIONS:"pushowl_price_drop_subscriptions",SYNCED_CART_JSON:"pushowl_synced_cart_json",SYNCED_CUSTOMER_ID:"pushowl_synced_customer_id",SYNCED_AC_EVENTS:"pushowl_ac_events",SESSION_PAGEVIEW_COUNT:"pushowl_session_pageview_count",SESSION_SUBSCRIBER_CHECK:"pushowl_session_subscriber_check",OPTIN_DEFERRED_UNTIL:"pushowl_optin_deferred_until",LOG_LEVEL:"pushowl_log_level",HAS_RAISED_UNSUBSCRIPTION_EVENT:"pushowl_has_raised_unsubscription_event",IS_PERMISSION_GRANTED:"pushowl_is_permission_granted",REFERRER:"pushowl_referrer",LANDING_PAGE_URL:"pushowl_landing_page_url",LANDING_PAGE_URL_PARAMS:"pushowl_landing_page_url_params",ORIGINAL_URL_PARAMS:"pushowl_original_url_params",IOS_STANDALONE_MODE_LOG:"pushowl_ios_standalone_mode_log",INSTALL_PROMPT_SEEN_COUNT:"pushowl_install_prompt_seen_count",INSTALL_PROMPT_DISMISSED:"pushowl_install_prompt_dismissed",CONSENT:"pushowl_channels_consent"},NOTIFICATION_PERMISSION:{DEFAULT:"default",GRANTED:"granted",DENIED:"denied",DISMISSED:"dismissed",SERVICE_WORKER_FAILURE:"service_worker_failure"},DEFAULT_TIMEOUT:{DEFAULT:0,MOBILE:10}},c={EVENTS:{CLICK:"click",ANIMATION_END:"animationend",TRANSITION_END:"transitionend"},WIDGET_CLASSES:{MINIMIZE:"minimize",MAXIMIZE:"maximize"}},u={[a.ENVIRONMENT.staging]:"https://api-staging.pushowl.com",[a.ENVIRONMENT.production]:"https://api.pushowl.com"},d={[a.ENVIRONMENT.staging]:"https://cdn-staging.pushowl.com/config",[a.ENVIRONMENT.production]:"https://cdn.pushowl.com/config"},l={[a.ENVIRONMENT.staging]:"web.com.pushowl.staging",[a.ENVIRONMENT.production]:"web.com.pushowl.prod"},p={HOME:"home",COLLECTION:"collection",PRODUCT:"product",CART:"cart",CHECKOUT:"checkout",ORDER:"order",ORDERS:"orders"},h={CART:"cart",ACCOUNT:"account",ORDERS:"orders"},b="subscribe",g="unsubscribe",w="debug",m="disabled",_="browser-prompt",f="custom-prompt",S="optin-flyout",v="price-drop-flyout",I="back-in-stock-flyout",E="wordpress",T="prestashop",O=function(){function e(e){e=e||{};const t={url:location.href,headers:{"User-Agent":navigator.userAgent}};return{event_id:"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),platform:"javascript",release:"29c5724",extra:e,request:t}}function t(e){return Math.random()<.95?Promise.resolve():fetch("https://o79286.ingest.sentry.io/api/1527936/store/?sentry_version=7&sentry_key=8f53de1cdf86490fb8e55518e1a5d035",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function i(i,n){const o=e(n);return o.message=i,t(o)}return{log:i,logException:function(n,o){if(n)try{(o=o||{}).errorDump={str:String(n),stack:n&&n.stack};const i=e(o);return i.exception=function(e){const t=e.stack||"";if(!t)return;const i=t.split("\n").map((e=>e.trim())).filter((e=>e.startsWith("at"))).map((function(e){let t="",i=0,n=0,o="";const r=e.split(/[ ]+/);if("at"===r[0].trim()&&r.length>1){let e="";r.length>2?(t=r[1],e=r[2]):e=r[1],e=e.replace("(","").replace(")","");const s=e.split(":");s.length>1&&(i=parseInt(s[s.length-1],0),n=parseInt(s[s.length-2],0),o=s.slice(0,s.length-2).join(":"))}return{in_app:!0,function:t,colno:Number(i)||i,lineno:Number(n)||n,filename:o}}));return i.reverse(),{values:[{type:e.name||"Error",value:e.message||String(e),stacktrace:{frames:i}}]}}(n),t(i)}catch(e){i(String(e),e),i(String(n),n)}}}}();function y({position:e,device:t,customConfig:i,isExpanded:n}){if("desktop"===t){const t="15px",o="15px",r="15px",s="15px",a=68,c=`calc(50% - ${568}px / 2)`,u=`calc(50% - ${a}px / 2)`,d=`calc(50% - ${a}px / 2)`;if(i.hasOwnProperty("bottom")&&25===i.bottom&&15===i.left&&"auto"===i.right)switch(e){case"bottom-left":return{bottom:o,left:r};case"bottom-right":return{bottom:o,right:s};case"bottom-center":return n?{bottom:o,left:c}:{bottom:o,left:u};case"top-left":return{top:t,left:r};case"top-right":return{top:t,right:s};case"top-center":return n?{top:t,left:c}:{top:t,left:u};case"center-left":return{top:d,left:r};case"center-right":return{top:d,right:s};default:return i}let l={left:r};for(let e in i)l[e]=`${i[e]}px`;return l}if("mobile"===t){const t="8px",n="8px",o="8px",r="8px",s=`calc(50% - ${48}px / 2)`;if(i.hasOwnProperty("bottom")&&i.hasOwnProperty("left")&&15===i.bottom&&15===i.left)switch(e){case"bottom-left":return{bottom:n,left:o};case"bottom-right":return{bottom:n,right:r};case"top-left":return{top:t,left:o};case"top-right":return{top:t,right:r};case"center-left":return{top:s,left:o};case"center-right":return{top:s,right:r};default:return i}let a={isCustomConfig:!0};for(let e in i)a[e]=`${i[e]}px`;return a}}function P(e){let t=document.implementation.createHTMLDocument();return t.body.innerHTML=e,t.body.children[0]}function N(){let e=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)}function C(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return null}}function R(e){return[...new URLSearchParams(e).entries()].reduce(((e,[t,i])=>Object.assign(Object.assign({},e),{[t]:i})),{})}function k(e,t=null){t||(t=window.location.href);return R(new URL(t).search)[e]}function A(){let t=navigator.userAgent,i=t.search("Firefox")>=0,n=!!window.chrome;const o=void 0!==window.PushManager,r=(({ua:e,maxTouchPoints:t})=>{if(!(/iPad|iPhone|iPod|Mac OS X/.test(e)&&t>0))return!1;const i=e.match(/EdgiOS\/(\d+\.\d+)/);if(i&&i.length>=2)return parseFloat(i[1])>=112;const n=e.match(/Version\/(\d+\.\d+)/);if(n&&n.length>=2)return parseFloat(n[1])>=16.4;return!1})({ua:t,maxTouchPoints:navigator.maxTouchPoints});let s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&!r,a=!!window.safari;return{isiOS:r,isSafari:a,isApnsSafari:a&&!o,isFirefox:i,isChrome:n,isOldIOS:s,name:n?e.CHROME:a?e.SAFARI:i?e.FIREFOX:e.OTHER}}function D(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(t),n=new Uint8Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);return n}function L({method:e="GET",url:t,contentType:i="application/json",acceptType:n="application/json",payload:o}){return new Promise(((r,s)=>{let a=new XMLHttpRequest;a.open(e,t,!0),a.setRequestHeader("Content-Type",i),a.setRequestHeader("Accept",n),o?a.send(i.match(/json/)?JSON.stringify(o):o):a.send(),a.onload=function(){let e=a.responseText;if(a.status>=200&&a.status<400){const t=n.match(/json/)?JSON.parse(e):e;r(t)}else s(e)}}))}function U(e=7){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-",i="",n=e;n--;)i+=t[~~(Math.random()*t.length)];return i}function x({name:e,value:t}){document.cookie=`${e}=${encodeURIComponent(t)};domain=${window.location.hostname}`}function B({name:e,value:t,days:i=1,path:n="/"}){const o=new Date(Date.now()+864e5*i).toUTCString();document.cookie=e+"="+encodeURIComponent(t)+"; expires="+o+"; path="+n}function G(e){return document.cookie.split("; ").reduce(((t,i)=>{const n=i.split("=");return n[0]===e?decodeURIComponent(n[1]):t}),"")}function H(e,t){B({name:e,value:"",days:-1,path:t})}function M(){const e=document.createElement("div");return document.body.appendChild(e),"rtl"===window.getComputedStyle(e).direction}const K=[];function V(...e){const t=console;K.push(e),(localStorage.getItem("pushowl_log_level")===s.DEBUG||location.href.match(/poTaskType=debug/))&&t.log("%c🦉PushOwl","background: #fb446a; color: white; padding: 2px 0.5em; border-radius: 0.5em;",...e)}function F(e,t){const i=console;K.push([e,t]),(localStorage.getItem("pushowl_log_level")===s.DEBUG||location.href.match(/poTaskType=debug/))&&(e&&V(e),i.table(t))}function j(){const[e,t]=navigator.language.split("-");return{language:e,region:t}}function W(e){if([n.NOTIFICATION_NOT_DEFINED,n.OLD_IOS_DEVICE,n.MICROSOFT_EDGE,n.NO_SERVICE_WORKER,n.INCOGNITO,n.NO_FILE_SYSTEM,n.LOCALSTORAGE_NOT_AVAILABLE].includes(e))return;let t="";window.pushowl&&(t=window.pushowl.getSubdomain?window.pushowl.getSubdomain():window.pushowl.subdomain),O.logException("string"==typeof e?new Error(e):e,{breadcrumbs:K,subdomain:t,url:window.location.href})}function Y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function q(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(i),!0).forEach((function(t){X(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function $(e,t,i,n,o,r,s){try{var a=e[r](s),c=a.value}catch(e){return void i(e)}a.done?t(c):Promise.resolve(c).then(n,o)}function J(e){return function(){var t=this,i=arguments;return new Promise((function(n,o){var r=e.apply(t,i);function s(e){$(r,n,o,s,a,"next",e)}function a(e){$(r,n,o,s,a,"throw",e)}s(void 0)}))}}function X(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function z(e,t){if(null==e)return{};var i,n,o=function(e,t){if(null==e)return{};var i,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(o[i]=e[i]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}class Z{constructor(){this.configKey="pushowl_shopify_config-".concat(1.5,"-").concat(Q.guid),this.permissionKey="pushowl_permission_not_granted-".concat(1.5,"-").concat(Q.guid),this.subscriptionVerifiedKey="pushowl_subscription_verified-".concat(1.5,"-").concat(Q.guid),this.optinSeenCountKey="pushowl_optin_seen_count"}get config(){var e=window.sessionStorage.getItem(this.configKey),t=null;if(e)try{t=JSON.parse(e)}catch(e){t=null}return t}set config(e){var t="string"==typeof e?e:JSON.stringify(e);window.sessionStorage.setItem(this.configKey,t)}get isPermissionNotGranted(){return"true"===window.sessionStorage.getItem(this.permissionKey)}set isPermissionNotGranted(e){window.sessionStorage.setItem(this.permissionKey,e),window.localStorage.setItem(this.permissionKey,e)}get subscriptionVerified(){return!!window.sessionStorage.getItem(this.subscriptionVerifiedKey)}set subscriptionVerified(e){window.sessionStorage.setItem(this.subscriptionVerifiedKey,e)}get optinSeenCount(){return parseInt(window.sessionStorage.getItem(this.optinSeenCountKey)||0,10)}set optinSeenCount(e){window.sessionStorage.setItem(this.optinSeenCountKey,e)}static get installPromptSeenCount(){return parseInt(window.sessionStorage.getItem(a.STORAGE_KEYS.INSTALL_PROMPT_SEEN_COUNT)||0,10)}static set installPromptSeenCount(e){window.sessionStorage.setItem(a.STORAGE_KEYS.INSTALL_PROMPT_SEEN_COUNT,e)}static get landingPageURL(){return sessionStorage.getItem(a.STORAGE_KEYS.LANDING_PAGE_URL)}static set landingPageURL(e){sessionStorage.setItem(a.STORAGE_KEYS.LANDING_PAGE_URL,e)}static get referrer(){return sessionStorage.getItem(a.STORAGE_KEYS.REFERRER)}static set referrer(e){sessionStorage.setItem(a.STORAGE_KEYS.REFERRER,e)}static get landingPageURLParams(){return sessionStorage.getItem(a.STORAGE_KEYS.LANDING_PAGE_URL_PARAMS)}static set landingPageURLParams(e){sessionStorage.setItem(a.STORAGE_KEYS.LANDING_PAGE_URL_PARAMS,e)}}class Q{static get scriptUrl(){let e=document.getElementsByTagName("script");for(let t=0;t<e.length;t++){let i=e[t].src||"";if(i.match(/pushowl-\w+.js/))return i.match(/^http/)||(i=i.replace(/^\/\//,"https://")),i}return window.location.href}static get environment(){if(!Q.scriptUrl)return a.ENVIRONMENT.production;let e=R(new URL(Q.scriptUrl).search.substring(1)).environment;return e&&(e=a.ENVIRONMENT[e]),window.pushowlEnvironment||e||a.ENVIRONMENT.production}static get isProduction(){return Q.environment==a.ENVIRONMENT.production}static get apiEndpoint(){return u[Q.environment]}static get configApiEndpoint(){return d[Q.environment]}static get subdomain(){let e={};Q.scriptUrl&&(e=R(new URL(Q.scriptUrl).search.substring(1))),window.pushowl&&window.pushowl.subdomain&&(window.pushowlSubdomain=window.pushowl.subdomain);const t=window.pushowlSubdomain||e.subdomain;return window.pushowlSubdomain=t,window.pushowlSubdomain||e.subdomain}static get platform(){if(!Q.scriptUrl)return"shopify";const e=R(new URL(Q.scriptUrl).search.substring(1)).platform;return e&&!["shopify","sendinblue","bigcommerce"].includes(e)&&Q.logToServer({message:"unknown platform detected",subdomain:Q.subdomain,data:{platform:e,script_url:Q.scriptUrl}}),e||"shopify"}static get plugin(){if(!Q.scriptUrl)return null;return R(new URL(Q.scriptUrl).search.substring(1)).plugin}static get guid(){if(!Q.scriptUrl)return null;let e=R(new URL(Q.scriptUrl).search.substring(1));return window.pushowlGUID||e.guid}static get visitorId(){if(!Q.scriptUrl)return null;return R(new URL(Q.scriptUrl).search.substring(1)).visitor_id}static get shopUrl(){return location.protocol+"//"+location.host}static serviceWorkerUrl(e={}){if("bigcommerce"===Q.platform)return`${Q.shopUrl}/pushowl-service-worker.js?v=2&subdomain=${this.subdomain}`;if("headless"===Q.mode){const t=Q.platform,i=Q.plugin;return"enabled"===e.root_service_worker?`${window.location.origin}/service-worker.js?v=2&subdomain=${this.subdomain}`:"sendinblue"===t&&window.__st&&window.Shopify?`${Q.shopUrl}/apps/sendinblue/service-worker.js?v=2&subdomain=${this.subdomain}`:"sendinblue"===t&&i===E?`${Q.shopUrl}/wp-content/plugins/mailin/js/service-worker.js?v=2&subdomain=${this.subdomain}`:"sendinblue"===t&&i===T?`${Q.shopUrl}/modules/sendinblue/views/js/service-worker.js?v=2&subdomain=${this.subdomain}`:`${Q.shopUrl}/${"sendinblue"===t?"sendinblue":"pushowl"}/service-worker.js?v=2&subdomain=${this.subdomain}`}return"enabled"===e.should_log?`${Q.shopUrl}/apps/pushowl/sdks/service-worker-logsink.js?v=2&subdomain=${this.subdomain}`:`${Q.shopUrl}/apps/pushowl/sdks/service-worker.js?v=2&subdomain=${this.subdomain}`}static get isWorkerAvailable(){return A().isApnsSafari?Promise.resolve(!0):new Promise((e=>{const t=((new Z).config||{}).flags,i=Q.serviceWorkerUrl(t),n="enabled"===t.sw_get_request;fetch(i,{method:n?"GET":"HEAD"}).then((t=>{if(t.status>=200&&t.status<300)return e(!0);e(!1)}))}))}static get webPushId(){return l[this.environment]||l[a.ENVIRONMENT.production]}static getServiceWorkerUrlWithIntergrations(e,t={}){const i=Object.keys(t).filter((e=>"enabled"===t[e].status));if(!i.length)return e;return`${e}${new URL(e).search?"&":"?"}integrations=${i.join(",")}`}static logToServer({message:e,subdomain:t,sessionHash:i="session",data:n}){return L({url:`${Q.apiEndpoint}/logs/v1/`,method:"POST",acceptType:"text/plain",payload:[{level:"warn",subscriber_token:window.localStorage&&window.localStorage.getItem("pushowl_subscriber_token"),subdomain:t,message:e,session_hash:i,timestamp:(new Date).toISOString(),data:Object.assign({release:"29c5724"},n)}]})}static getPreviewLib(e){const t=Q.getPreviewBranch(),i=Q.environment;return sessionStorage.setItem("pushowl_branch",t),"local"===t?`https://localhost:3008/latest/sdks/${e}?environment=staging&platform=${Q.platform}`:`https://cdn-pushowl-com-git-${t}-pushowl.vercel.app/sdks/${e}?environment=${i}&platform=${Q.platform}`}static loadPreviewLib(e){const t=document.createElement("script"),i=this.getPreviewLib(e);t.onload=()=>{},t.src=i,t.setAttribute("async",""),document.head.appendChild(t),window.pushowlPreviewLoaded=!0}static getPreviewBranch(){const e=new URLSearchParams(window.location.search).get("pushowl_branch")||sessionStorage.getItem("pushowl_branch");return window.pushowlPreviewLoaded?null:e}static isDisabled(){const e=new URLSearchParams(window.location.search).get("poTaskType")||sessionStorage.getItem("poTaskType");sessionStorage.setItem("pushowl_task_type",e);return e===m}}const ee=()=>"shopify"!==Q.platform||!Q.guid||!!window.Shopify.customerPrivacy&&window.Shopify.customerPrivacy.userCanBeTracked();function te(e){return new Promise((function(t,i){e.oncomplete=e.onsuccess=function(){return t(e.result)},e.onabort=e.onerror=function(){return i(e.error)}}))}var ie;function ne(){return ie||(ie=function(e,t){var i=indexedDB.open(e);i.onupgradeneeded=function(){return i.result.createObjectStore(t)};var n=te(i);return function(e,i){return n.then((function(n){return i(n.transaction(t,e).objectStore(t))}))}}("keyval-store","keyval")),ie}function oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ne();return t("readonly",(function(t){return te(t.get(e))}))}function re(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ne();return i("readwrite",(function(i){return i.put(t,e),te(i.transaction)}))}class se{constructor(e){this.key=e,window.localStorage.getItem(e)?this.subscriptions=window.localStorage.getItem(this.key).split(","):this.subscriptions=[]}subscribe(e){this.isSubscribed(e)||(this.subscriptions.push(e.id.toString()),window.localStorage[this.key]=this.subscriptions)}isSubscribed(e){return this.subscriptions.indexOf(e.id.toString())>-1}}class ae{constructor(){this.back_in_stock=new se(a.STORAGE_KEYS.BACK_IN_STOCK_SUBSCRIPTIONS),this.price_drop=new se(a.STORAGE_KEYS.PRICE_DROP_SUBSCRIPTIONS),Promise.all([oe(a.STORAGE_KEYS.SW_SUBSCRIPTION),oe(a.STORAGE_KEYS.SW_SUBSCRIBER_TOKEN)]).then((e=>{var[t,i]=e;t&&i&&(this.sw_subscription_data=t,this.sw_subscriber_token=i)}))}static getOrCreateToken(e,t){var i=e.getItem(t);if(i)return i;var n=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},o="".concat(n()+n(),"-").concat(n(),"-4").concat(n().substr(0,3),"-").concat(n(),"-").concat(n()).concat(n()).concat(n()).toLowerCase();return e.setItem(t,o),o}static get consent(){var e=localStorage.getItem(a.STORAGE_KEYS.CONSENT);if(e)try{return JSON.parse(e)}catch(e){return[]}return[]}static set consent(e){localStorage.setItem(a.STORAGE_KEYS.CONSENT,JSON.stringify(e))}static get subscriberToken(){return this.sw_subscriber_token||localStorage.getItem(a.STORAGE_KEYS.SUBSCRIBER_TOKEN)}static set subscriberToken(e){localStorage.setItem(a.STORAGE_KEYS.SUBSCRIBER_TOKEN,e),re(a.STORAGE_KEYS.SUBSCRIBER_TOKEN,e)}static get installPromptDismissed(){return Boolean(localStorage.getItem(a.STORAGE_KEYS.INSTALL_PROMPT_DISMISSED))}static set installPromptDismissed(e){localStorage.setItem(a.STORAGE_KEYS.INSTALL_PROMPT_DISMISSED,"".concat(e))}static get hasLoggediOSStandaloneMode(){return localStorage.getItem(a.STORAGE_KEYS.IOS_STANDALONE_MODE_LOG)}static set hasLoggediOSStandaloneMode(e){localStorage.setItem(a.STORAGE_KEYS.IOS_STANDALONE_MODE_LOG,e)}static get originalURLParams(){return localStorage.getItem(a.STORAGE_KEYS.ORIGINAL_URL_PARAMS)}static set originalURLParams(e){localStorage.setItem(a.STORAGE_KEYS.ORIGINAL_URL_PARAMS,e)}static get visitorToken(){return ee()?this.getOrCreateToken(localStorage,a.STORAGE_KEYS.VISITOR_TOKEN):(localStorage.removeItem(a.STORAGE_KEYS.VISITOR_TOKEN),null)}static get sessionToken(){return this.getOrCreateToken(sessionStorage,a.STORAGE_KEYS.SESSION_TOKEN)}static get syncedCustomerId(){return localStorage.getItem(a.STORAGE_KEYS.SYNCED_CUSTOMER_ID)}static set syncedCustomerId(e){localStorage.setItem(a.STORAGE_KEYS.SYNCED_CUSTOMER_ID,e.toString())}static get synced_cart_json(){var e=localStorage.getItem(a.STORAGE_KEYS.SYNCED_CART_JSON);return e?JSON.parse(e):void 0}static set synced_cart_json(e){e&&("[object String]"!==Object.prototype.toString.call(e)&&(e=JSON.stringify(e)),localStorage.setItem(a.STORAGE_KEYS.SYNCED_CART_JSON,e))}static get ac_events(){try{return JSON.parse(localStorage.getItem(a.STORAGE_KEYS.SYNCED_AC_EVENTS))||[]}catch(e){return[]}}static set ac_events(e){var t="string"==typeof e?e:JSON.stringify(e);localStorage.setItem(a.STORAGE_KEYS.SYNCED_AC_EVENTS,t)}static get subscription(){var e=this.sw_subscription_data||localStorage.getItem(a.STORAGE_KEYS.SUBSCRIPTION),t=null;if(e)try{t=JSON.parse(e)}catch(i){t=e}return t}static set subscription(e){var t="string"==typeof e?e:JSON.stringify(e);localStorage.setItem(a.STORAGE_KEYS.SUBSCRIPTION,t),re(a.STORAGE_KEYS.SW_SUBSCRIPTION,t)}static get optinDeferredUntil(){return parseInt(localStorage.getItem(a.STORAGE_KEYS.OPTIN_DEFERRED_UNTIL)||0,10)}static set optinDeferredUntil(e){localStorage.setItem(a.STORAGE_KEYS.OPTIN_DEFERRED_UNTIL,e)}static get logLevel(){return localStorage.getItem(a.STORAGE_KEYS.LOG_LEVEL)}static set logLevel(e){localStorage.setItem(a.STORAGE_KEYS.LOG_LEVEL,e)}static get hasRaisedUnsubscriptionEvent(){return localStorage.getItem(a.STORAGE_KEYS.HAS_RAISED_UNSUBSCRIPTION_EVENT)}static set hasRaisedUnsubscriptionEvent(e){localStorage.setItem(a.STORAGE_KEYS.HAS_RAISED_UNSUBSCRIPTION_EVENT,e)}static get isPermissionGranted(){return"true"===localStorage.getItem(a.STORAGE_KEYS.IS_PERMISSION_GRANTED)}static set isPermissionGranted(e){e?localStorage.setItem(a.STORAGE_KEYS.IS_PERMISSION_GRANTED,e):localStorage.removeItem(a.STORAGE_KEYS.IS_PERMISSION_GRANTED)}static handlePostSubscription(e,t){ae.subscription=e,ae.subscriberToken=t,ae.hasRaisedUnsubscriptionEvent=""}}class ce extends class{constructor(){}}{constructor(e){super(),this.id=e.id,this.name=e.name,this.price=e.price/100,this.available=e.available}}class ue extends class{constructor(){}currentVariant(){}}{constructor(e){super(),this.id=e.id,this.title=e.title;var t=e.variants;this.variants=t.map((e=>new ce(e)))}getVariant(e){return e=parseInt(e),this.variants.find((t=>t.id==e))}currentVariant(){var e=k("variant");if(!e){for(var t of this.variants)if(t.available)return t;return this.variants[0]}return this.getVariant(e)}}class de extends class{constructor(){this.product=null}static get section(){}static get productAlias(){}static get customerId(){}static getCart(){}getProductDetails(){}getRawCurrentProductDetails(){}}{constructor(){super(),this.productCache={}}static get section(){try{var{pageType:e}=window.ShopifyAnalytics.meta.page;if(e)return e!==p.PRODUCT&&/\/products\/(\S)/.test(location.pathname)&&(e=p.PRODUCT),e}catch(e){}var{hostname:t}=location,i=location.pathname,n=i.split("/")[0],o=i.split("/")[1];if(""===n)return p.HOME;if(n===h.CART)return p.CART;if(n===h.ACCOUNT&&o===h.ORDERS)return p.ORDER;if("account"===n&&!n)return p.ORDERS;if("checkout.shopify.com"===t||"checkouts"===o||i.indexOf("checkouts")>=0)return p.CHECKOUT;if("undefined"!=typeof __st&&__st.s){var r=__st.s.split("-")[0];if("collections"===r)return p.COLLECTION;if("products"===r)return p.PRODUCT}}static get productAlias(){var e=location.pathname.split("/"),t=(e=e.filter((e=>e))).map((e=>e.toLocaleLowerCase())).lastIndexOf("products");return-1===t?"":e[t+1]}static get customerId(){if("headless"===Q.mode)return window.pushowl?window.pushowl.customerId:"";var e=null;return"undefined"!=typeof __st&&__st.cid?e=__st.cid:void 0!==window.Shopify&&void 0!==window.Shopify.checkout&&window.Shopify.checkout.customer_id&&(e=Shopify.checkout.customer_id.toString()),e}static getCart(){return L({url:"/cart.js?random=".concat(Date.now())}).then((e=>(e.updated_at=(new Date).toISOString(),e)),(()=>"Cart API failed"))}getProductDetails(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(arguments.length>1?arguments[1]:void 0)||de.productAlias;return this.productCache[t]&&!e?Promise.resolve(this.productCache[t]):L({url:"/products/".concat(t,".js")}).then((e=>this.productCache[t]=new ue(e)))}getRawCurrentProductDetails(){return Promise.resolve(window.ShopifyAnalytics.meta.product)}}function le(e){const t=`pushowl_ab_test_${e}_variation`;let i;return window.localStorage.getItem(t)?i=window.localStorage.getItem(t):(i=Math.floor(2*Math.random()),window.localStorage.setItem(t,i),window.poAnalytics.track("ABTestVariationDecided",{testId:e,variation:i})),parseInt(i,10)}function pe(e,t){return t.flags&&"enabled"===t.flags[`abtest_${e}`]&&A().isChrome&&!N()}function he(){const e=Object.keys(window.localStorage),t={};return e.filter((e=>!!e.match(/pushowl_ab_test_.*_variation/)&&e)).forEach((e=>{let i=window.localStorage.getItem(e);i=Number.isNaN(i)?i:parseInt(i,10),t[e.replace("pushowl_","")]=i})),t}const be={1:{title:"custom vs native prompt",isRunning:e=>pe(1,e),getValue:()=>[t.ONE_STEP,t.TWO_STEP][le(1)]},2:{title:"top-left vs top-center",isRunning:e=>pe(2,e),getValue:()=>["top-left","top-center"][le(2)]},3:{title:"35s vs 15s timeout",isRunning:e=>e.flags&&"enabled"===e.flags.abtest_3,getValue:()=>[35,15][le(3)]},4:{title:"custom (with custom config) vs native",isRunning:e=>e.flags&&"enabled"===e.flags.abtest_4,getValue:()=>[{optinType:t.TWO_STEP,optinConfig:{title:"Never miss a sale 🛍️",description:"Subscribe to get updates on our new products and exclusive promotions",timeout:{default:5,mobile:10},yesButton:{label:"Allow"},noButton:{label:"Later"},position:{default:"top-center",mobile:"top"}}},{optinType:t.ONE_STEP,optinConfig:{timeout:{default:5,mobile:10}}}][le(4)]},5:{title:"custom prompt mobile top vs bottom position",isRunning:e=>e.flags&&"enabled"===e.flags.abtest_5&&N(),getValue:()=>["top","bottom"][le(5)]},6:{title:"custom vs native prompt (all devices)",isRunning:e=>e.flags&&"enabled"===e.flags.abtest_6,getValue:()=>[t.ONE_STEP,t.TWO_STEP][le(6)]},7:{title:"Browser prompt 5s vs 10s",isRunning:e=>e.flags&&"enabled"===e.flags.abtest_7,getValue:()=>[{optinType:t.ONE_STEP,optinConfig:{timeout:5}},{optinType:t.ONE_STEP,optinConfig:{timeout:10}}][le(7)]},8:{title:"(5,10)s vs (10,15)s timeout",isRunning:e=>e.flags&&"enabled"===e.flags.abtest_8,getValue:()=>[{default:5,mobile:10},{default:10,mobile:15}][le(8)]},9:{title:"browser prompt without vs with new pre-prompt",isRunning:e=>e.flags&&"enabled"===e.flags.abtest_9&&A().isChrome,getValue:()=>[{optinType:t.ONE_STEP,optinConfig:{timeout:{default:5,mobile:10}}},{optinType:t.TWO_STEP,optinConfig:{title:"Click Allow to get updates from our store",timeout:{default:5,mobile:10}}}][le(9)]}};class ge{constructor(){var{subdomain:e}=Q;this.endpoint=Q.apiEndpoint,this.config_endpoint="".concat(Q.configApiEndpoint,"/api/v1/").concat(e,"/subscriber/config/widget/"),this.config_endpoint_sdk="".concat(this.endpoint,"/api/v1/").concat(e,"/subscriber/config/widget/"),this.subscriber_endpoint="".concat(this.endpoint,"/api/v1/accounts/").concat(e,"/subscriber/"),this.subscriber_endpoint_v2="".concat(this.endpoint,"/api/v2/accounts/").concat(e,"/subscribers/webpush/"),this.subscriber_refresh_endpoint="".concat(this.endpoint,"/api/v1/accounts/").concat(e,"/subscriber/refresh/"),this.unsubscribe_endpoint="".concat(this.endpoint,"/api/v1/accounts/").concat(e,"/subscriber/unsubscribe/"),this.popup_subscription_endpoint="".concat(this.endpoint,"/api/v1/").concat(e,"/dashboard/optin-flows"),this.event_endpoint="".concat(this.endpoint,"/api/v1/").concat(e,"/subscriber/event"),this.cart_sync_endpoint="".concat(this.endpoint,"/api/v1/").concat(e,"/subscriber/event/cart-sync/"),this.product_view_endpoint="".concat(this.endpoint,"/api/v1/").concat(e,"/subscriber/event/product-view/"),this.checkout_sync_endpoint="".concat(this.endpoint,"/api/v1/").concat(e,"/subscriber/event/checkout-sync/"),this.debug_endpoint="".concat(this.endpoint,"/api/v1/").concat(e,"/subscriber/debug/"),re("subscriber_refresh_endpoint",this.subscriber_refresh_endpoint),Z.landingPageURL||(Z.landingPageURL=document.URL),Z.referrer||(Z.referrer=document.referrer),Z.landingPageURLParams||(Z.landingPageURLParams=window.location.search),ae.originalURLParams||(ae.originalURLParams=window.location.search)}request(e){var{method:t="POST",url:i,payload:n}=e;return(i=new URL(i)).searchParams.append("platform",Q.platform),L({method:t,url:i.href,payload:n})}config(){var e="".concat("headless"===Q.mode?this.config_endpoint_sdk:this.config_endpoint,"?guid=").concat(Q.guid);return this.request({method:"GET",url:e})}sendSubscription(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=new Z;if(s.config&&s.config.flags&&"enabled"===s.config.flags.disable_resync&&t)return Promise.reject(n.DISABLED_RESYNC);var a={};Z.landingPageURLParams.slice(1).split("&").filter((e=>e.includes("utm_"))).forEach((e=>{var[t,i]=e.split("=");a[t]=i}));var c={};ae.originalURLParams.slice(1).split("&").filter((e=>e.includes("po_"))).forEach((e=>{var[t,i]=e.split("=");c[t]=i}));var u=window.location.href,d=new URLSearchParams(window.location.search),l=!0;if(d.get("po_url")&&(l=!1,u=d.get("po_url")),A().isOldIOS)return V("PushOwl does not support iOS before 16.4","platform: ".concat(navigator.platform),"Browser: ".concat(A().name)),Promise.reject(n.OLD_IOS_DEVICE);var p={subscription:e,browser:A().name,previous_token:ae.subscriberToken,website_push_id:i||Q.webPushId,customer_id:s.config.privacy?de.customerId:null,language:window.navigator.language,timezone:C(),dispatch_method:A().isApnsSafari?"apns":"vapid",user_agent:navigator.userAgent,guid:Q.guid,optin_seen_count:s.optinSeenCount,context:q(q({isPushowlThemeAppExtentionEnabled:!!window.isPushowlThemeAppExtentionEnabled,isiOS:A().isiOS,is_resync:t,subscribe_url:u,session_token:ae.sessionToken,visitor_token:ae.visitorToken,sib_visitor_id:Q.visitorId,widget_source:window.poSubscriptionSource,worker_available:l},a),{},{permanent:q({},c),temporary:{referrer:Z.referrer,landing_url:Z.landingPageURL}}),source:o,source_id:r},h=he();return p.context=q(q({},p.context),h),this.request({method:"POST",url:this.subscriber_endpoint_v2,payload:p}).then((e=>(e&&e.result||V("Invalid /subscribe response. response:",e),e.result.token)),(()=>Promise.reject("Send Subscription API Failed")))}refreshSubscription(e,t,i){var o={previous_token:e,previous_subscription:t,current_subscription:i};return o.context={subscribe_url:window.location.href,session_token:ae.sessionToken,visitor_token:ae.visitorToken,sib_visitor_id:Q.visitorId},A().isOldIOS?(V("PushOwl does not support iOS before 16.4","platform: ".concat(navigator.platform),"Browser: ".concat(A().name)),Promise.reject(n.OLD_IOS_DEVICE)):this.request({method:"POST",url:this.subscriber_refresh_endpoint,payload:o}).then((e=>e.result.token),(()=>Promise.reject("Refresh Subscription API Failed")))}syncSubscriber(){var e={data:[{key:"customer_id",value:de.customerId}],token:ae.subscriberToken,context:{subscribe_url:window.location.href,session_token:ae.sessionToken,visitor_token:ae.visitorToken}};return this.request({method:"PUT",url:this.subscriber_endpoint,payload:e})}syncCart(e,t){var i=new Z,n={subscriber_token:ae.subscriberToken,customer_id:i.config.privacy?t||de.customerId:null,browser:A().name,cart_json:e,origin:window.location.origin,store_root:((window.Shopify||{}).routes||{}).root||"/"};return this.request({method:"POST",url:this.cart_sync_endpoint,payload:n}).then((e=>e.status>=200&&e.status<400?e:Promise.reject()))}syncProductView(e){var t={subscriber_token:ae.subscriberToken,session:ae.sessionToken,viewed_time:~~(Date.now()/1e3),product_data:e,store_root:((window.Shopify||{}).routes||{}).root||"/"};return this.request({method:"POST",url:this.product_view_endpoint,payload:t}).then((e=>e.status>=200&&e.status<400?e:Promise.reject()))}sendEvent(e,t){var i="".concat(this.event_endpoint,"/").concat(e,"/");return this.request({method:"POST",url:i,payload:t}).then((e=>e),(()=>"Event Update failed"))}unsubscribe(e){return this.request({method:"POST",url:this.unsubscribe_endpoint,payload:{token:e,sib_visitor_id:Q.visitorId}})}syncSubscriberTokenAndCheckoutId(e){var t=JSON.stringify({subscriber_token:ae.subscriberToken,checkout_token:e});navigator.sendBeacon(this.checkout_sync_endpoint,t)}debugLog(e){return this.request({method:"POST",url:this.debug_endpoint,payload:e})}subscribeThroughPopup(e){var{subscriptionData:t,flowId:i,nodeId:n}=e,o={subscription_data:t,token:ae.subscriberToken,source:"optin_flows",source_id:n};return this.request({method:"POST",url:"".concat(this.popup_subscription_endpoint,"/").concat(i,"/subscribers/"),payload:o})}}class we{constructor(e){this.inclusions=e.inclusions,this.exclusions=e.exclusions}}class me{constructor(e){this.url=new we(e.url)}processCondition(e,t){var i=t.inclusions,n=t.exclusions;return i.some((t=>new RegExp(t).test(e)))&&!n.some((t=>new RegExp(t).test(e)))}processUrlActivationRule(){try{var e=this.url,t=window.location.href,i=this.processCondition(t,e);return V("[Checking page url condition]","Condition: ",this.url," / Result: ".concat(i?"✅":"❌")),i}catch(e){return!0}}}class _e{constructor(e){this.flyout=new Ce(e.flyout)}}class fe{constructor(e){this.type=e.type,e.config&&(this.config=e.config,this.config.overlay=new Se(this.config.overlay))}}class Se{constructor(e){this.enabled=e.enabled,this.title=e.title,this.subtitle=e.description||e.subtitle,this.branding=e.branding}}class ve{constructor(e){this.money_format=e.money_format}}class Ie{constructor(e){this.enabled=e.enabled,this.text=e.text}}class Ee{constructor(e){this.unsubscribe=new Ie(e.unsubscribe),this.access_data=new Ie(e.access_data),this.delete_data=new Ie(e.delete_data)}}class Te{constructor(e){this.enabled=e.enabled,this.message=e.message,this.actions=new Ee(e.actions)}}class Oe{constructor(e){this.notification_preference=new Te(e.notification_preference),this.customer_id=e.customer_id}}class ye{constructor(e){this.bottom=e.bottom||15,this.diameter=e.diameter||68,this.left=e.left||15,this.right=e.right||"auto"}}class Pe{constructor(e){this.bottom=e.bottom||15,this.left=e.left||15,this.diameter=e.diameter||48}}class Ne{constructor(e){this.desktop=new ye(e.desktop),this.mobile=new Pe(e.mobile),this.color=e.color||"rgb(51, 51, 51)",this.overlay=e.overlay}}class Ce{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.enabled=e.enabled,this.title=e.title,this.buttonText=e.button_text||e.buttonText,this.postSubscriptionTitle=e.post_subscription_message||e.postSubscriptionTitle,this.theme=e.theme,this.position=e.position,this.overlay=e.overlay}static create_instance(e){var t=new Ce;t.enabled=e.enabled;var i=e.metadata;return t.metadata=i,t.title=e.title||i.title,t.buttonText=e.buttonText||i.yes_button.text,t.postSubscriptionTitle=e.postSubscriptionTitle||i.post_subscription.post_subscription_widget.title,t}}class Re{constructor(e){e=this.preProcess(e),this.home=new _e(e.home),this.optin=e.optin?new fe(e.optin):null,this.price_drop=Ce.create_instance(e.price_drop),this.back_in_stock=Ce.create_instance(e.back_in_stock),this.shop=new ve(e.shop),this.abandoned_cart_enabled=e.abandoned_cart_enabled,this.browse_abandonment_enabled=e.browse_abandonment_enabled,this.optin_report_enabled=e.optin_report_enabled,this.is_beta=e.is_beta||!1,this.privacy=new Oe(e.privacy),this.vapid_public_key=e.vapid_public_key,this.activation_rule=e.activation_rule&&new me(e.activation_rule),this.flyout_config=e.flyout_config&&new Ne(e.flyout_config),this.branding=void 0===e.branding||e.branding,this.logo=e.logo,this.flags=e.flags,this.wid=e.wid,this.integrations=e.integrations,this.website_push_id=e.website_push_id,this.service_worker=e.service_worker,this.ios_prompt=e.ios_prompt,this.optin_flows=e.optin_flows}preProcess(e){var t=void 0===e.branding||e.branding;return e.optin&&e.optin.config&&e.optin.config.overlay&&(e.optin.config.overlay.branding=t),e}}var ke={get(e){var t=new Z,i=new ge;return new Promise((n=>{var o=e?null:t.config,r=()=>i.config().then((e=>{var i=new Re(e.result);t.config=i,n(i),V("Config fetched: from backend.",i)})).catch((e=>{V("Error on fetching config",e),W(e)}));if(o){V("Config fetched: from local cache.",o);try{n(new Re(o))}catch(e){r()}}else r()}))}};function Ae(e){var{subdomain:t}=e;return new Promise(((e,i)=>{"undefined"==typeof Storage&&i(n.STORAGE_NOT_DEFINED),!0!==function(){let e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}()&&i(n.LOCALSTORAGE_NOT_AVAILABLE),/Edge/.test(navigator.userAgent)&&i(n.MICROSOFT_EDGE),t||i(n.NO_SUBDOMAIN),e()}))}var De=()=>void 0===window.Notification?(V(n.NOTIFICATION_NOT_DEFINED),!1):A().isOldIOS||A().isApnsSafari||"serviceWorker"in navigator?A().isOldIOS?(V(n.OLD_IOS_DEVICE),!1):!(A().isiOS&&!navigator.standalone)||(V(n.NOT_ADDED_TO_HOME_SCREEN),!1):(V(n.NO_SERVICE_WORKER),!1);function Le(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=new ge;return new Promise(((s,c)=>{r.sendSubscription(e,t,i,n,o).then((t=>{ae.handlePostSubscription(e,t),x({name:a.STORAGE_KEYS.SUBSCRIBER_TOKEN,value:t}),s(t)})).catch((e=>{V("🔴 Send Subscription Failed",e),c(e)}))}))}class Ue{constructor({endpoint:e,props:t}){this.endpoint=e,this.meta={},this.initVisitor(),this.setVisitorProperties(t);let i=null;ee()?i=G("po_visitor"):H("po_visitor","/"),this.setVisitorProperties({sessionId:i,language:navigator.language})}initVisitor(){let e=null;ee()?e=G("po_visitor"):H("po_visitor","/"),e||(this.meta.isNewVisitor=!0,e=U(12),ee()&&B({name:"po_visitor",value:e,days:365})),this.visitorId=e}setVisitorProperties(e){this.properties=Object.assign(Object.assign({},this.properties),e)}track(e,t,i){const n=he();if(t=Object.assign(Object.assign({},t),n),ee()&&this.visitorId&&this.properties.visitorToken)if(i){const i={sessionId:this.visitorId,sessionToken:this.properties.sessionToken,visitorToken:ae.visitorToken,subdomain:Q.subdomain,wid:this.properties.wid,language:this.properties.language,flowId:t.flowId,formId:t.formId,nodeId:t.nodeId,channelType:t.channelType,optinType:t.optinType,formStepType:t.formStepType,event:e,platform:Q.platform,timestamp:(new Date).toISOString(),uuid:U()};L({method:"POST",url:this.endpoint,acceptType:"text/plain",payload:i})}else this.properties.wid?L({method:"POST",url:this.endpoint,acceptType:"text/plain",payload:Object.assign(Object.assign({event:e,sessionId:this.visitorId,uuid:U(15),properties:t},this.properties),{platform:Q.platform,timestamp:(new Date).toISOString()})}):L({url:`${Q.apiEndpoint}/logs/v1/`,method:"POST",acceptType:"text/plain",payload:[{level:"warn",subscriber_token:window.localStorage&&window.localStorage.getItem("pushowl_subscriber_token"),subdomain:this.properties.subdomain,message:"wid empty",session_hash:this.properties.sessionToken,timestamp:(new Date).toISOString(),data:Object.assign(Object.assign({},t),{breadcrumbs:K})}]})}}class xe{constructor(e){var{wid:t,websitePushId:i}=e;this.wid=t,this.subdomain=Q.subdomain,this.webPushId=i||Q.webPushId,this.getSubscription=this.getSubscription.bind(this)}webServiceUrl(){return"".concat(Q.apiEndpoint,"/safari/v2/").concat(this.wid)}getSubscription(){return new Promise(((e,t)=>{var i=n=>{V("PermissionData:",n.permission),"default"===n.permission?setTimeout((()=>window.safari.pushNotification.requestPermission(this.webServiceUrl(),this.webPushId,{domain:window.location.origin},i)),0):"denied"===n.permission?t(a.NOTIFICATION_PERMISSION.DENIED):"granted"===n.permission&&e(n.deviceToken)},n=window.safari.pushNotification.permission(this.webPushId);i(n)}))}}class Be{constructor(e){var{vapidPublicKey:t,integrations:i,serviceWorkerConfig:n}=e;this.getSubscription=this.getSubscription.bind(this),this.vapid_public_key=t,this.integrations=i,this.serviceWorkerConfig=n}getServiceWorkerParams(e){return this.serviceWorkerConfig?{url:this.serviceWorkerConfig.url,options:{scope:this.serviceWorkerConfig.scope}}:{url:Q.getServiceWorkerUrlWithIntergrations(Q.serviceWorkerUrl(e),this.integrations),options:{}}}getSubscription(e){return new Promise(((t,i)=>{("granted"===Notification.permission?Promise.resolve("granted"):Notification.requestPermission()).then((n=>{if(n===a.NOTIFICATION_PERMISSION.GRANTED){var o=this.getServiceWorkerParams(e),r=o.options;0!==o.url.indexOf("http")&&(o.url="".concat(location.protocol,"//").concat(location.host).concat(o.url)),navigator.serviceWorker.register(o.url,o.options).then((e=>{var n;"shopify"===Q.platform&&("/"===r.scope?navigator.serviceWorker.getRegistrations().then((function(e){e.forEach((function(e){e.scope.match(/pushowl\/sdks\//)&&(e.unregister(),V("Found stale service worker on subpath scope",e))}))})):navigator.serviceWorker.getRegistrations().then((function(e){e.forEach((function(e){e.active&&e.active.scriptURL.match(/pushowl/)&&!e.scope.match(/pushowl\//)&&(e.unregister(),V("Found stale service worker on root scope",e))}))}))),e.installing?n=e.installing:e.waiting?n=e.waiting:e.active&&(n=e.active),n&&("activated"===n.state?this._serviceWorkerSubscriber(e,t,i):n.addEventListener("statechange",(n=>{"activated"===n.target.state&&this._serviceWorkerSubscriber(e,t,i)})))})).catch((e=>{W(e),i(e)}))}else n!==a.NOTIFICATION_PERMISSION.DENIED&&n!==a.NOTIFICATION_PERMISSION.DEFAULT||i(n)}))}))}_serviceWorkerSubscriber(e,t,i){var n={userVisibleOnly:!0,applicationServerKey:D(this.vapid_public_key)};e.pushManager.subscribe(n).then((e=>{t(e)})).catch((n=>{n.toString().indexOf("InvalidStateError")>=0?e.pushManager.getSubscription().then((n=>{n.unsubscribe().then((n=>{e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:D(this.vapid_public_key)}).then((e=>{t(e)})).catch((e=>{i(e)}))})).catch((e=>{i(e)}))})):(W(n),i(n))}))}}class Ge{constructor(e){var{flags:t,vapidPublicKey:i,integrations:n,websitePushId:o,wid:r,serviceWorkerConfig:s}=e;if(this.getSubscription=null,A().isApnsSafari){var a=new xe({websitePushId:o,wid:r});this.getSubscription=a.getSubscription.bind(this,t)}else{var c=new Be({vapidPublicKey:i,integrations:n,serviceWorkerConfig:s});this.getSubscription=c.getSubscription.bind(this,t)}}get isPermissionGranted(){return window.Notification&&window.Notification.permission===a.NOTIFICATION_PERMISSION.GRANTED||ae.isPermissionGranted}}var He=e=>{var{channels:t,consent:i}=e;return t.every((e=>i.includes(e)))},Me=(e,t)=>N()?void 0!==e.mobile?e.mobile:t:void 0!==e.default?e.default:t;const Ke=({nodeId:e,flowId:t,channelType:i,optinType:n})=>({formId:o,event:r,stepType:s})=>{window.poAnalytics.track(r,{flowId:t,nodeId:e,formId:o,channelType:i,optinType:n,formStepType:s},!0)},Ve=({event:e,optinType:t,flowId:i,nodeId:n,formId:o})=>{Ke({optinType:t,channelType:["webpush"],flowId:i,nodeId:n})({stepType:"step_1",event:e,formId:o})};var Fe=e=>{e>0&&(ae.optinDeferredUntil=Date.now()+86400*parseInt(e,10)*1e3)},je={showNativePrompt(e){var{hintScreenConfig:t,subscribeCallback:i,source:n,nodeId:o,trackWebPushDenied:r,trackWebPushSubmission:s}=e;function a(){return window.poSubscriptionSource=_,i(t,n,o,r,s)}var{isSafari:c,isFirefox:u,isiOS:d}=A();if(!c&&!u&&!d)return a();var l=document.querySelector("body");return V("This is Safari/Firefox browser. The prompt will only show after the website is clicked somewhere"),new Promise((e=>{l.addEventListener("click",(()=>{a().then(e)}))}))},oldRender(e){var i,{config:n,subscribeCallback:o}=e,r=new Z;if(!r.isPermissionNotGranted&&window.Notification&&window.Notification.permission===a.NOTIFICATION_PERMISSION.DEFAULT){if(n.optin.type!==t.OFF){var s=n.optin.config,c=s.timeout,u=c.default,d=n.optin.type,l=s.overlay;N()&&(u=c.mobile);var p=r.optinSeenCount;if(be[1].isRunning(n)?(V("ab test: 1 (".concat(be[1].title,") running")),d=be[1].getValue()):be[6].isRunning(n)&&(V("ab test: 6 (".concat(be[6].title,") running")),d=be[6].getValue()),be[3].isRunning(n)&&(V("ab test: 3 (".concat(be[3].title,") running")),u=be[3].getValue(),d=t.ONE_STEP),be[8].isRunning(n)){V("ab test: 8 (".concat(be[8].title,") running"));var h=be[8].getValue();u=N()?h.mobile:h.default}if(be[4].isRunning(n)){V("ab test: 4 (".concat(be[4].title,") running"));var{optinType:b,optinConfig:g}=be[4].getValue();d=b,s=q(q({},s),g),u=N()?s.timeout.mobile:s.timeout.default}if(be[7].isRunning(n)){V("ab test: 7 (".concat(be[7].title,") running"));var{optinType:w,optinConfig:m}=be[7].getValue();d=w,u=m.timeout}if(be[9].isRunning(n)){V("ab test: 9 (".concat(be[9].title,") running"));var{optinType:_,optinConfig:S}=be[9].getValue();d=_,s=q(q({},s),S),u=N()?s.timeout.mobile:s.timeout.default}-1===u?V('🟠 Optin prompt was not shown. Reason: timeout set to "never"'):p>=s.maxCountPerSession?V("🟠 Optin prompt was not shown. Reason: maximum count per session limit reached (".concat(p," / ").concat(s.maxCountPerSession,")")):Date.now()<ae.optinDeferredUntil?V("🟠 Optin prompt was not shown. Reason: deferred till ".concat(new Date(ae.optinDeferredUntil))):setTimeout((()=>{Notification.permission!==a.NOTIFICATION_PERMISSION.DEFAULT||ae.isPermissionGranted?V("🟠 Optin prompt was not shown. Reason: permission not default"):d===t.TWO_STEP?Promise.all([import("./OptinPrompt-1230bc4e.js"),import("./NewCustomPrompt-57d52450.js")]).then((e=>{var[{OptinPromptWidget:t},{NewCustomPromptWidget:i}]=e,{position:a}=s;be[2].isRunning(n)&&(V("ab test: 2 (".concat(be[2].title,") running")),a.default=be[2].getValue()),be[5].isRunning(n)&&(V("ab test: 5 (".concat(be[5].title,") running")),a.mobile=be[5].getValue());var c=t;be[9].isRunning(n)&&(c=i);var u=new c;if(c===i)u.setState(q(q({},s),{},{logo:n.logo})),setTimeout((()=>{o(null),u.changeState(N()?"mobile-fade":"down"),setTimeout(N()?u.destroy.bind(u):()=>{u.changeState("fade-top"),setTimeout(u.destroy.bind(u),300)},5e3)}),5e3);else{var d=document.querySelector(".pushowl-optin");d&&(L({url:"".concat(Q.apiEndpoint,"/logs/v1/"),method:"POST",acceptType:"text/plain",payload:[{level:"warn",subscriber_token:window.localStorage&&window.localStorage.getItem("pushowl_subscriber_token"),subdomain:Q.subdomain,message:"duplicate custom prompt",timestamp:(new Date).toISOString(),data:{breadcrumbs:K}}]}),d.remove()),u.setState({multilingual_title:s.multilingual_title,multilingual_description:s.multilingual_description,yesButton:s.yesButton,noButton:s.noButton,theme:s.theme,logo:n.logo,branding:n.branding,position:a,autoFocus:n.flags.custom_prompt_screenreader_support,yesButtonListener:()=>{o(l),setTimeout((()=>{u.destroy()}),100),window.poSubscriptionSource=f,n.optin_report_enabled&&window.poAnalytics.track("PNOptinAllowClicked",{optinSeenCount:r.optinSeenCount})},noButtonListener:()=>{setTimeout((()=>{u.destroy()}),100),r.isPermissionNotGranted=!0,n.optin_report_enabled&&window.poAnalytics.track("PNOptinLaterClicked",{optinSeenCount:r.optinSeenCount})}})}r.optinSeenCount+=1,n.optin_report_enabled&&window.poAnalytics.track("PNOptinShown",{optinSeenCount:r.optinSeenCount}),V("Custom Prompt shown. Config: ",n.optin),Fe(s.deferForDays)})).catch((e=>{V("Error encountered in loading Optin prompt: ".concat(e.message))})):(this.showNativePrompt({hintScreenConfig:l,subscribeCallback:o}),r.optinSeenCount+=1,V("Browser Prompt shown. Config: ",n.optin),Fe(s.deferForDays))}),1e3*u)}}else r.isPermissionNotGranted?i="prompt was dismissed in this session":window.Notification&&window.Notification.permission!==a.NOTIFICATION_PERMISSION.DEFAULT&&(i="permission already ".concat(window.Notification.permission)),"enabled"===n.flags.log_optin_not_shown&&Q.logToServer({message:"optin now shown",subdomain:Q.subdomain,data:{reason:i,permission:window.Notification&&window.Notification.permission,url:window.location.href}}),V("🟠 Optin prompt was not shown. Reason: ".concat(i))},renderPopup:e=>J((function*(){var{showNextForm:t,deferForDays:i,node:n,shouldIncrementFrequency:o,waitTime:r,flowId:s}=e;try{var{OptinForm:a}=yield import("./index-28c1f491.js"),c=new a(n,t,s,Ke({nodeId:n.id,flowId:s,channelType:n.channels,optinType:"popup"}));if(setTimeout((()=>c.render()),1e3*r),Fe(i),o)(new Z).optinSeenCount+=1}catch(e){V("Error encountered in loading New Optin: ".concat(e.message))}}))(),showBrowserPrompt(e){var{subscribeCallback:t,hintScreenConfig:i,shouldIncrementFrequency:n,deferForDays:o,waitTime:r,flowId:s,nodeId:a,formId:c}=e;if(De()){Ve({event:"optin_viewed",optinType:"browser_webpush",flowId:s,nodeId:a,formId:c});var u=()=>Ve({event:"optin_submitted",optinType:"browser_webpush",flowId:s,nodeId:a,formId:c}),d=()=>Ve({event:"optin_denied",optinType:"browser_webpush",flowId:s,nodeId:a,formId:c});if(setTimeout((()=>{this.showNativePrompt({hintScreenConfig:i,subscribeCallback:t,source:"optin_flows",nodeId:a,trackWebPushDenied:d,trackWebPushSubmission:u})}),1e3*r),n)(new Z).optinSeenCount+=1;Fe(o)}},showCustomPrompt:e=>J((function*(){var{waitTime:t,shouldIncrementFrequency:i,flowId:n,deferForDays:o,config:r,subscribeCallback:s,custom_prompt_screenreader_support:a,nodeId:c,formId:u,logo:d}=e;try{if(!De())return;var{OptinPromptWidget:l}=yield import("./OptinPrompt-1230bc4e.js"),p=()=>Ve({event:"optin_submitted",optinType:"custom_webpush",flowId:n,nodeId:c,formId:u}),h=()=>Ve({event:"optin_denied",optinType:"custom_webpush",flowId:n,nodeId:c,formId:u}),b=new l,g=new Z;if(setTimeout((()=>b.setState(q(q({},r),{},{autoFocus:a,yesButtonListener:()=>{s(r.overlay,"optin_flows",c,h,p),setTimeout((()=>{b.destroy()}),100),window.poSubscriptionSource=f},noButtonListener:()=>{h(),setTimeout((()=>{b.destroy()}),100),g.isPermissionNotGranted=!0},logo:d}))),1e3*t),Ve({event:"optin_viewed",optinType:"custom_webpush",flowId:n,nodeId:c,formId:u}),Fe(o),i)(new Z).optinSeenCount+=1}catch(e){V("Error encountered in loading Custom prompt: ".concat(e.message))}}))(),processNewConfig(e){var t=e.find((e=>"active"===e.status));if(!t)return[];for(var i=[],n=t.flow_nodes||[],o=0;o<n.length;o+=1){var r=n[o-1];if(o%2!=0){var s=r.wait_times?Me(r.wait_times,r.wait_time):r.wait_time;n[o].wait_time=s,i.push(n[o])}}return[q(q({},t),{},{flow_nodes:i})]},newRender(e){var{config:t,shouldIncrementFrequency:i,subscribeCallback:n}=e,o=this.processNewConfig(t.optin_flows||[]).find((e=>"active"===e.status))||{};if(o.flow_nodes){var{flow_nodes:r}=o,{activation_rule:s}=t,c=new Z,{optinSeenCount:u}=c,{consent:d}=ae,l=o&&r&&(e=>{var{activation_rule:t}=e;return!t||new me(t).processUrlActivationRule()})({activation_rule:s})&&(e=>{var{deferForDays:t,shouldIncrementFrequency:i}=e;return!(i&&t>0&&Date.now()<ae.optinDeferredUntil&&(V("🟠 Optin prompt was not shown. Reason: deferred till ".concat(new Date(ae.optinDeferredUntil))),1))})({deferForDays:o.defer_for_days,shouldIncrementFrequency:i})&&(e=>{var{frequency:t,optinSeenCount:i,shouldIncrementFrequency:n}=e;return!n||i<t||(V("🟠 Optin prompt was not shown. Reason: Optin seen count exceeded"),!1)})({frequency:o.frequency,optinSeenCount:u,shouldIncrementFrequency:i});V("Can Optin Render",l);for(var p=()=>{this.newRender({config:t,shouldIncrementFrequency:!1,subscribeCallback:n})},h=0;h<r.length;h+=1){var b=r[h];if(l&&!He({consent:d,channels:b.channels})){if(-1===b.wait_time)continue;if("popup"===b.optin_type)return V("Can render popup"),void this.renderPopup({node:b,shouldIncrementFrequency:i,showNextForm:p,deferForDays:o.defer_for_days,waitTime:b.wait_time,flowId:o.id});if("browser_webpush"===b.optin_type)return void this.showBrowserPrompt({subscribeCallback:n,waitTime:b.wait_time,hintScreenConfig:b.forms[0].config.oneStep.overlay,shouldIncrementFrequency:i,deferForDays:o.defer_for_days,flowId:o.id,nodeId:b.id,formId:b.forms[0].id});if("custom_webpush"===b.optin_type&&window.Notification&&window.Notification.permission===a.NOTIFICATION_PERMISSION.DEFAULT&&!ae.isPermissionGranted){var g=b.forms[0];return void this.showCustomPrompt({config:q(q({},g.config.twoStep),{},{position:{default:g.desktop_position,mobile:g.mobile_position}}),waitTime:b.wait_time,flowId:o.id,shouldIncrementFrequency:i,deferForDays:o.defer_for_days,subscribeCallback:n,custom_prompt_screenreader_support:t.flags.custom_prompt_screenreader_support,nodeId:b.id,formId:b.forms[0].id,logo:t.logo})}}}}else V("Optin is set to OFF")}},We={validateOrSyncSubscription(e){var{subscription:t,websitePushId:i}=e;return new Promise(((e,n)=>{var o=ae.subscription;if(o)if(t.endpoint===o.endpoint)e();else{var r=new ge;V("Refreshing old subscription on server..."),r.refreshSubscription(ae.subscriberToken,o,t).then((i=>{ae.handlePostSubscription(t,i),x({name:a.STORAGE_KEYS.SUBSCRIBER_TOKEN,value:i}),e()})).catch((e=>{n(e)}))}else V("Syncing new subscription to server"),Le(t,!1,i).then(e)}))},verifySubscriber(e){var{browserHandler:t}=e,i=new Z;return V("Verifying subscriber..."),new Promise(((e,n)=>{ae.subscriberToken?ae.subscriberToken.match(/failed/i)?(V("🔴 Subscriber could not be verified. Reason: ",o.INVALID_SUBSCRIBER_TOKEN),n(o.INVALID_SUBSCRIBER_TOKEN)):i.subscriptionVerified?e():A().isApnsSafari?t.isPermissionGranted?e():n():Q.isWorkerAvailable.then((i=>{i?t.getSubscription().then((t=>{this.validateOrSyncSubscription({subscription:t}).then((()=>{e(),V("🟢 Subscriber verified.")})).catch((()=>{n(),V("🔴 Subscriber could not be verified.")}))})).catch(((e,t)=>{n(e,t),V("🔴 Subscription could not be fetched.",e,t)})):t.isPermissionGranted?e():n()})):(n(o.NO_SUBSCRIBER_TOKEN),V("🔴 Subscriber could not be verified. Reason: ",o.NO_SUBSCRIBER_TOKEN))}))},handleSubscription(e){var{browserHandler:t,resolve:i,reject:n,areWeResyncing:o,websitePushId:r,showHintScreenOnError:s,hintscreenHandler:a,enableHintScreen:c,source:u,source_id:d}=e,l=new Z,p=new Date;t.getSubscription().then((e=>{c&&a.purge(),Le(e,o,r,u,d).then((()=>{var{subscriberToken:e}=ae;i({subscriberToken:e}),new BroadcastChannel("pushowl").postMessage({subscriberToken:e,subdomain:Q.subdomain})})).catch(n),o?V("🟢 Resync-subscription successfull. (bcoz permission was granted but didn't have a valid subscription)",e):(V("🟢 Subscription successfull",e),document.dispatchEvent(new Event("SubscribedToPushOwl")),this.trackBrowserPromptAnalytics(new Date-p,"allowed"))})).catch((e=>{a&&a.purge(),s&&a.show(),l.isPermissionNotGranted=!0,V("🔴 Subscription failed",e),o||this.trackBrowserPromptAnalytics(new Date-p,e),n(e)}))},subscribe(e){var{enableHintScreen:t=!1,hintScreenData:i=null,showHintScreenOnError:n=!1,websitePushId:o,browserHandler:r,source:s,source_id:a}=e,c=new Z,u=r.isPermissionGranted;return new Promise(((e,d)=>{var l;t?import("./PushowlHintScreenHandler-937e7610.js").then((p=>{var{PushowlHintScreenHandler:h}=p;(l=new h({onDismiss:()=>{c.isPermissionNotGranted=!0,c.config.optin_report_enabled&&window.poAnalytics.track("BrowserPromptOverlayDismissed",{optinSeenCount:c.optinSeenCount})}})).show(i),this.handleSubscription({browserHandler:r,resolve:e,reject:d,areWeResyncing:u,websitePushId:o,showHintScreenOnError:n,hintscreenHandler:l,enableHintScreen:t,source:s,source_id:a})})):this.handleSubscription({browserHandler:r,resolve:e,reject:d,areWeResyncing:u,websitePushId:o,showHintScreenOnError:n,hintscreenHandler:null,enableHintScreen:t,source:s,source_id:a})})).catch((e=>{V("Error encountered in loading Pushowl Hint Screen: ".concat(e.message))}))},subscribeIfNotAlready(e){var{enableHintScreen:t=!1,showHintScreenOnError:i=!0,websitePushId:n,browserHandler:o,hintScreenData:r=null}=e;return new Promise(((e,s)=>{o.isPermissionGranted?ae.subscriberToken?e(!0):this.subscribe({enableHintScreen:!1,showHintScreenOnError:!1,websitePushId:n,browserHandler:o,hintScreenData:r}).then((()=>e(!0))).catch((e=>s(e))):this.subscribe({enableHintScreen:t,showHintScreenOnError:i,websitePushId:n,browserHandler:o,hintScreenData:r}).then((()=>e(!0))).catch((e=>s(e)))}))},update(e,t){var i=new ge;return t.subscriber_token=ae.subscriberToken,i.sendEvent(e,t)},subscribeProduct(e){var{context:t,automation:i,product:n,variant:o,source:r}=e;return this.subscribeIfNotAlready({enableHintScreen:!0,websitePushId:t.config.website_push_id,browserHandler:t.browserHandler}).then((()=>this.update(i,{product_id:n.id,product:n,variant:o,source:r,permission:window.Notification&&window.Notification.permission}).then((e=>{var{token:t}=e.result;t&&(ae.subscriberToken=t),V("Product subscribed for ".concat(i,". Product ").concat(n.id,". Variant ").concat(o.id,". Source: ").concat(r))})).catch(W)))},unsubscribe(e){var t=new ge;e.isPermissionGranted?t.unsubscribe(ae.subscriberToken).then((()=>{V("🟢 Unsubscription successfull")})).catch((e=>{V("🔴 Unsubscription failed",e)})):V("🟢 Unsubscription successfull")},trackBrowserPromptAnalytics(e,t){var i=new Z;if(i.config.optin_report_enabled){window.poAnalytics.track("BrowserPromptShown",{delay:e,optinSeenCount:i.optinSeenCount});var n={allowed:"BrowserPromptAllowClicked",denied:"BrowserPromptDenyClicked",default:"BrowserPromptCloseClicked"};n[t]&&window.poAnalytics.track(n[t],{delay:e,optinSeenCount:i.optinSeenCount})}}};const Ye=(e,t,i)=>{let n=i.replace("{{amount}}",parseFloat(t).toFixed(2));return e.replace("{{product_price}}",n).replace("{{variant_price}}",n)};var qe={renderFlyout(e){var{flyoutHandler:t,title:i,buttonText:n,automationType:o,buttonListener:r,theme:s,position:a,overlay:c}=e;document.querySelectorAll(".pushowl-widget-node").forEach((e=>{e&&e.remove()})),i&&(t.setState({title:i,buttonText:n,buttonListener:r,theme:s,position:a,overlay:c}),V("Product flyout shown for: ",o),V("🟠 Optin prompt was not shown. Reason: Product flyout shown"))},renderOptin(e){var{rootContext:t,flyoutHandler:i}=e,n=t.config.home.flyout,{title:o,theme:r,position:s,buttonText:a,overlay:c}=n;i.setState({title:o,buttonText:a,theme:r,position:s,overlay:c,buttonListener:()=>{window.poSubscriptionSource=S,We.subscribeIfNotAlready({enableHintScreen:!0,websitePushId:t.config.website_push_id,browserHandler:t.browserHandler,hintScreenData:c}).then((()=>{i.setState({title:n.postSubscriptionTitle,position:s,theme:r})})).catch((e=>{W(e)}))}}),V("Flyout shown.","Config: ",n)},renderBackInStock(e){var{rootContext:t,flyoutHandler:n,product:o,variant:s}=e,c=new ae,{back_in_stock:u,flyout_config:d}=t.config,l=u.enabled,p=c.back_in_stock.isSubscribed(s);if(l)if(window.Notification&&window.Notification.permission===a.NOTIFICATION_PERMISSION.GRANTED&&p){var h=Ye(u.postSubscriptionTitle,s.price,t.config.shop.money_format),{theme:b,position:g,overlay:w}=u.metadata;this.renderFlyout({flyoutHandler:n,title:h,theme:b,position:g,overlay:w,automationType:r.BACK_IN_STOCK})}else{var{theme:m,position:_,overlay:f}=u.metadata;this.renderFlyout({flyoutHandler:n,title:u.title,buttonText:u.buttonText,theme:m,position:_,overlay:f,buttonListener:()=>{n.setState({title:u.postSubscriptionTitle,position:_,theme:m});var{overlay:e}=u.metadata;window.Notification&&"default"===window.Notification.permission&&(window.poSubscriptionSource=I),We.subscribeIfNotAlready({enableHintScreen:!!d.overlay,showHintScreenOnError:!!d.overlay,websitePushId:t.config.website_push_id,browserHandler:t.browserHandler,hintScreenData:e}).then((()=>{We.update(a.EVENT_API_PATH.BACK_IN_STOCK,{product_id:o.id,product:o,variant:s,source:i.FLYOUT_WIDGET,permission:window.Notification&&window.Notification.permission}).then((e=>{c.back_in_stock.subscribe(s);var{token:t}=e.result;t&&(ae.subscriberToken=t),V("Product subscribed for ".concat(a.EVENT_API_PATH.BACK_IN_STOCK,". Product ").concat(o.id,". Variant ").concat(s.id,". Source: ").concat(i.FLYOUT_WIDGET))})).catch((e=>{W(e)}))}))},automationType:r.BACK_IN_STOCK})}},renderPriceDrop(e){var{rootContext:t,flyoutHandler:n,product:o,variant:s}=e,c=new ae,{price_drop:u,flyout_config:d}=t.config,l=u.enabled,p=c.price_drop.isSubscribed(s);if(l)if(window.Notification&&window.Notification.permission===a.NOTIFICATION_PERMISSION.GRANTED&&p){var{theme:h,position:b,overlay:g}=u.metadata;this.renderFlyout({flyoutHandler:n,theme:h,position:b,overlay:g,title:u.postSubscriptionTitle,automationType:r.PRICE_DROP})}else{var w=t.config.price_drop.metadata,{theme:m,position:_,overlay:f}=w;this.renderFlyout({theme:m,position:_,overlay:f,flyoutHandler:n,title:Ye(u.title,s.price,t.config.shop.money_format),buttonText:u.buttonText,buttonListener:()=>{n.setState({title:u.postSubscriptionTitle,position:_,theme:m});var{overlay:e}=u.metadata;window.Notification&&"default"===window.Notification.permission&&(window.poSubscriptionSource=v),We.subscribeIfNotAlready({enableHintScreen:!!d.overlay,showHintScreenOnError:!!d.overlay,websitePushId:t.config.website_push_id,browserHandler:t.browserHandler,hintScreenData:e}).then((()=>{We.update(a.EVENT_API_PATH.PRICE_DROP,{product_id:o.id,product:o,variant:s,subscribed_price:s.price,source:i.FLYOUT_WIDGET,permission:window.Notification&&window.Notification.permission}).then((e=>{c.price_drop.subscribe(s);var{token:t}=e.result;t&&(ae.subscriberToken=t),V("Product subscribed for ".concat(a.EVENT_API_PATH.PRICE_DROP,". Product ").concat(o.id,". Variant ").concat(s.id,". Source: ").concat(i.FLYOUT_WIDGET))})).catch((e=>{W(e)}))}))},automationType:r.PRICE_DROP})}}},$e={isSubscribed(e){var{context:t,product:i,featureStorageManager:n}=e;if(!i)return t.browserHandler.isPermissionGranted;if(n){var o=i.currentVariant();return t.browserHandler.isPermissionGranted&&n.isSubscribed(o)}return!1},handlePushOwlButtons(e){var{buttons:t,onClick:i,isSubscribed:n}=e;for(var o of Array.from(t)){var r=o.dataset.pushowlPreDisplay,s=o.dataset.pushowlPreVisibility,a=o.dataset.pushowlPostDisplay,c=o.dataset.pushowlPostVisibility,u=o.dataset.pushowlPostSubscriptionMessage;n?(a&&(o.style.display=a),c&&(o.style.visibility=c),u&&(o.innerText=u)):("none"===o.style.display&&(o.style.display=r||"block"),"hidden"===o.style.visibility&&(o.style.visibility=s||"visible")),o.addEventListener("click",i)}},subscribeButtons(e){var{context:t}=e,i=document.querySelectorAll(".js-pushowl--subscribe");V("".concat(i.length," custom subscribe button(s) detected."),i),document.addEventListener("SubscribedToPushOwl",(()=>{i.forEach((e=>{var t=e.dataset.pushowlPostSubscriptionMessage;t&&(e.innerText=t)}))})),this.handlePushOwlButtons({buttons:i,onClick:e=>{We.subscribeIfNotAlready({enableHintScreen:"false"!==e.target.dataset.pushowlOverlay,websitePushId:t.config.website_push_id,browserHandler:t.browserHandler}).then((()=>{var t=e.target.dataset.pushowlPostSubscriptionMessage;t&&(e.target.innerText=t)}),null)},isSubscribed:this.isSubscribed({context:t})})},priceDropButtons(e){var{context:t,onSuccess:n}=e,o=document.querySelectorAll(".js-pushowl--pd");o.length&&(V("".concat(o.length," custom price drop button(s) detected."),o),t.storeLib.getProductDetails().then((e=>{this.handlePushOwlButtons({buttons:o,onClick:o=>{var r=e.currentVariant();We.subscribeProduct({context:t,automation:a.EVENT_API_PATH.PRICE_DROP,product:e,variant:r,source:i.CUSTOM_BUTTONS}).then((()=>{t.storageManager.price_drop.subscribe(r);var i=o.target.dataset.pushowlPostSubscriptionMessage;i&&(o.target.innerText=i),n(e)})).catch(W)},isSubscribed:this.isSubscribed({context:t,product:e,featureStorageManager:t.storageManager.price_drop})})})))},backInStockButtons(e){var{context:t,onSuccess:n}=e,o=document.querySelectorAll(".js-pushowl--bis");o.length&&(V("".concat(o.length," custom back-in-stock button(s) detected."),o),t.storeLib.getProductDetails().then((e=>{this.handlePushOwlButtons({buttons:o,onClick:o=>{var r=e.currentVariant();We.subscribeProduct({context:t,automation:a.EVENT_API_PATH.BACK_IN_STOCK,product:e,variant:r,source:i.CUSTOM_BUTTONS}).then((()=>{t.storageManager.back_in_stock.subscribe(r);var i=o.target.dataset.pushowlPostSubscriptionMessage;i&&(o.target.innerText=i),n(e)})).catch(W)},isSubscribed:this.isSubscribed({context:t,product:e,featureStorageManager:t.storageManager.back_in_stock})})})))}};const Je={name:"Pushowl Web Notifications",short_name:"PushOwl",description:"",icons:[],start_url:"/",scope:"/",display:"standalone",orientation:"portrait",background_color:"#fff",theme_color:"#000000"};if(!window.poAnalytics){var Xe={storeConfigGUID:Q.guid,subdomain:Q.subdomain,visitorToken:ae.visitorToken,sessionToken:ae.sessionToken};window.poAnalytics=new Ue({endpoint:"".concat(Q.apiEndpoint,"/event/v1/events")}),window.poAnalytics.setVisitorProperties(Xe),V("Analytics initialized with data: ",Xe)}class ze extends class{constructor(){}get cartId(){}}{constructor(e){super(),this.token=e.token,this.checkout_token=e.checkout_token,this.item_count=e.item_count,this.items=e.items}get cartId(){var e=[this.token||this.checkout_token||""],t=[],i={};for(var n of this.items)t.push(n.variant_id),i[n.variant_id]=n.quantity;for(var o of t=t.sort(((e,t)=>e-t))){var r=i[o];e.push("".concat(o,":").concat(r))}return e.concat(e).join("-")}}var Ze={decodeBase64Id(e){if(e&&"string"==typeof e){var t=e.split("::").shift();return window.atob(t).replace(/\?.*/,"").split("/").pop()}return e},detectAjaxCartUpdate(e){var t=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(i,n){this.addEventListener("readystatechange",(function(){var t=i.toUpperCase();("GET"===t&&"/cart/add.js"===n||"POST"===t&&("/cart/add.js"===n||"/cart/update.js"===n||"/cart/change.js"===n))&&4===this.readyState&&"function"==typeof e&&e()})),t.apply(this,arguments)}},detectAjaxCartUpdate2:e=>{var t=window.fetch;window.fetch=function(){var i=arguments.length<=0?void 0:arguments[0],n=t(...arguments);return i.match(/api\/.*\/graphql/)?(n.then((e=>e.clone())).then((t=>{try{t.json().then((t=>{var i;if(t&&t.data&&(t.data.checkoutLineItemsUpdate&&t.data.checkoutLineItemsUpdate.checkout?i=t.data.checkoutLineItemsUpdate.checkout:t.data.checkoutLineItemsAdd&&t.data.checkoutLineItemsAdd.checkout&&(i=t.data.checkoutLineItemsAdd.checkout),i)){var n=i.lineItems.edges.map((e=>({variant_id:parseInt(Ze.decodeBase64Id(e.node.variant.id),10),product_id:parseInt(Ze.decodeBase64Id(e.node.variant.product.id),10),quantity:e.node.quantity})));"function"==typeof e&&e({checkout_token:Ze.decodeBase64Id(i.id),item_count:n.length,items:n,updated_at:(new Date).toISOString()})}}))}catch(e){}})),n):n}},detectAjaxCartUpdate3:e=>{var t=window.fetch;window.fetch=function(){var i=arguments.length<=0?void 0:arguments[0],n="string"==typeof i?i:i instanceof URL?i.pathname:i instanceof Request?i.url:"",o=(arguments.length<=1?void 0:arguments[1])||{},r=o.method||"GET",s=t(...arguments);return("GET"===r&&n.includes("/cart/add")||"POST"===r&&(n.includes("/cart/add")||n.includes("/cart/update")||n.includes("/cart/change")))&&s.then((()=>{e()})),s}},detectBigCAjaxCartUpdate:e=>{var t=window.fetch;window.fetch=function(){var i=(arguments.length<=0?void 0:arguments[0])||"",n=(arguments.length<=1?void 0:arguments[1])||{},o=n.method||"GET",r=t(...arguments);return"POST"===o&&(i.includes("/cart/add")||i.includes("/cart/update"))&&r.then((()=>{e()})),r}},detectBigCAjaxCartUpdate2:e=>{var t=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(i,n){this.addEventListener("readystatechange",(function(){"POST"===i.toUpperCase()&&(n.includes("/cart/add")||n.includes("/cart/update"))&&4===this.readyState&&"function"==typeof e&&e()})),t.apply(this,arguments)}}},Qe=["type"];class et extends class{constructor(){var e;this.subdomain=Q.subdomain,this.environment=Q.environment,this.apiEndpoint=Q.apiEndpoint,this.apiClient=new ge,this.webPushId=Q.webPushId,this.config=null,this.storageManager=new ae,this.sessionManager=new Z,this.storeLib=new(this.getStoreLibClass()),this.subscriberTokenExists=!!ae.subscriberToken,this.tokenType=this.subscriberTokenExists?"subscriber":"visitor",this.tokenValue=this.subscriberTokenExists?ae.subscriberToken:ae.visitorToken,this.customLog=console,window.sessionStorage&&navigator.serviceWorker&&(e=this.getConfig()).then((e=>{this.config=e,(({logoURL:e})=>{try{const t=Object.assign(Object.assign({},Je),{name:document.title,short_name:document.title}),i=document.querySelector('meta[name="theme-color"]');i&&(t.theme_color=i.getAttribute("content")||Je.theme_color);const n=document.querySelector('meta[property="og:site_name"]');if(n){const e=n.getAttribute("content")||document.title;t.name=e,t.short_name=e}const o=document.querySelector('meta[property="og:description"]');o&&(t.description=o.getAttribute("content")||"");const r=JSON.stringify(t),s=new Blob([r],{type:"application/json"}),a=URL.createObjectURL(s),c=document.createElement("link");c.rel="manifest",c.href=a;const u=document.getElementsByTagName("head")[0];document.querySelector("link[rel=manifest]")||u.insertBefore(c,u.firstChild);const d=document.querySelector("link[rel=apple-touch-icon]");if(e&&!d){const t=document.createElement("link");t.rel="apple-touch-icon",t.href=e,u.insertBefore(t,u.firstChild)}}catch(e){V("Unable to create manifest")}})({logoURL:e.logo}),F("Status",{ACR:e.abandoned_cart_enabled?"🟢":"🔴","Browse abandonment":e.browse_abandonment_enabled?"🟢":"🔴","Price drop":e.price_drop.enabled?"🟢":"🔴","Back in stock":e.back_in_stock.enabled?"🟢":"🔴","optin type":{off:"🔴",oneStep:"Browser prompt",twoStep:"Custom prompt"}[e.optin.type],"Notification permission":window.Notification?Notification.permission:null,"Store section":this.getStoreLibClass().section,"Notification Preferences":e.privacy.notification_preference.enabled?"🟢":"🔴"}),this.handleIOS(),this.load3PIntegrations()})),this.ready=new Promise((t=>{this.init(e).then((()=>{if((!this.config.flags||"disabled"!==this.config.flags.status)&&((this.environment!==a.ENVIRONMENT.production||!this.config.flags||!1!==this.config.flags.console_message&&"disabled"!==this.config.flags.console_message)&&this.customLog.log("[PushOwl Web Push Notifications] Starting up"),this.browserHandler=new Ge({flags:this.config.flags,vapidPublicKey:this.config.vapid_public_key,integrations:this.config.integrations,websitePushId:this.config.website_push_id,wid:this.config.wid,serviceWorkerConfig:this.config.service_worker}),this.isAllowed())){var e={subdomain:this.subdomain,browserHandler:this.browserHandler,config:this.config,storeLib:this.storeLib,storageManager:this.storageManager,sessionManager:this.sessionManager};this.context=e,this.browserHandler.isPermissionGranted||!ae.subscriberToken||ae.hasRaisedUnsubscriptionEvent||(this.config.optin_report_enabled&&window.poAnalytics.track("Unsubscribed"),ae.hasRaisedUnsubscriptionEvent=!0),this.browserHandler.isPermissionGranted&&We.verifySubscriber({browserHandler:this.browserHandler}).then((()=>{this.syncCustomerId(),this.onSubscriberVerifiedOnPageLoad()})).catch(((e,t)=>{V(e),e===o.NO_SUBSCRIBER_TOKEN||e===o.INVALID_SUBSCRIBER_TOKEN?We.subscribe({browserHandler:this.browserHandler,websitePushId:this.config.website_push_id}).catch((e=>{W(e)})):e===o.INVALID_STATE_ERROR&&We.validateOrSyncSubscription({subscription:t,websitePushId:this.config.website_push_id})})),this.customTasks(),$e.subscribeButtons({context:e}),this.checkPushowlSession(),this.onCanRun(),t()}})).catch((e=>{W(e)}))})),this.debugCustomTask(),this.onScriptLoad()}handleIOS(){var e;A().isiOS&&navigator.standalone&&!ae.subscriberToken&&!ae.hasLoggediOSStandaloneMode&&(Q.logToServer({message:"Opening the store in iOS standalone mode",subdomain:Q.subdomain,data:{userAgent:navigator.userAgent,url:window.location.href}}),ae.hasLoggediOSStandaloneMode=!0),this.isAllowed()&&A().isiOS&&!navigator.standalone&&Z.installPromptSeenCount<3&&!ae.installPromptDismissed&&null!==(e=this.config.ios_prompt)&&void 0!==e&&e.enabled&&(import("./IOSInstallWidget-ed1e5ca9.js").then((e=>{var t,i,{IOSInstallWidget:n}=e,o=new n({title:null===(t=this.config.ios_prompt)||void 0===t?void 0:t.title,description:null===(i=this.config.ios_prompt)||void 0===i?void 0:i.description});setTimeout((()=>{o.init()}),2e3)})),"enabled"===this.config.flags.log_ios_prompt&&Q.logToServer({message:"iOS prompt",subdomain:Q.subdomain,data:{userAgent:navigator.userAgent,url:window.location.href,maxTouchPoints:navigator.maxTouchPoints,platform:navigator.platform,devicePixelRatio:window.devicePixelRatio,innerHeight:window.innerHeight,innerWidth:window.innerWidth}}),Z.installPromptSeenCount+=1)}get flyoutHandler(){return new Promise((e=>{import("./FlyoutWidgetHandler-790c1e79.js").then((t=>{var{FlyoutWidgetHandler:i}=t;e(new i(this.config.flyout_config))})).catch((e=>{V("Error encountered in loading Flyout widget: ".concat(e.message))}))}))}onScriptLoad(){}onConfigLoaded(){}onCanRun(){}onSubscriberVerifiedOnPageLoad(){}onSuccessfullSubscription(){}getStoreLibClass(){}getStoreCartClass(){}getCurrentProduct(){}isAllowed(){var{activation_rule:e}=this.config;return!e||e.processUrlActivationRule()}init(e){return new Promise((t=>{this.isEnabled().then((()=>{(e||this.getConfig()).then((e=>{this.config=e,"enabled"===e.flags.subscriber_tracking&&ae.subscriberToken&&(window.poAnalytics.setVisitorProperties({wid:this.config.wid,pagePath:window.location.href,pageURL:window.location.origin+window.location.pathname,subscriberToken:ae.subscriberToken,browserNotificationPermission:window.Notification?window.Notification.permission:null}),window.poAnalytics.track("subscriber_page_visited")),window.poAnalytics.setVisitorProperties({wid:this.config.wid,optinConfig:this.config.optin}),V("Analytics visitor props set: ",{wid:this.config.wid,optinConfig:this.config.optin}),window.poAnalytics.meta.isNewVisitor&&this.config.optin_report_enabled&&window.poAnalytics.track("SessionCreated"),t(e)}))})).catch((e=>{W(e),V("🔴 Shutting down. Reason: ".concat(e))}))}))}getConfig(){return ke.get()}isEnabled(){return Ae({subdomain:this.subdomain})}debugCustomTask(){var e=k("poTaskType");e===w&&(V("Task type",e),this.isEnabled().then((e=>{!function(e){var{subdomain:t,StoreLibClass:i,isEnabled:n}=e,o=a.STORAGE_KEYS,r=new Z,s=new ae,c=new ge,u={notification_permission:window.Notification&&window.Notification.permission};u.localStorage={[o.VISITOR_TOKEN]:ae.visitorToken,[o.SESSION_TOKEN]:ae.sessionToken,[o.SUBSCRIBER_TOKEN]:ae.subscriberToken,[o.SUBSCRIPTION]:ae.subscription,[o.BACK_IN_STOCK_SUBSCRIPTIONS]:s.back_in_stock.subscriptions,[o.PRICE_DROP_SUBSCRIPTIONS]:s.price_drop.subscriptions,[o.SYNCED_CART_JSON]:ae.synced_cart_json,[o.SYNCED_CUSTOMER_ID]:ae.syncedCustomerId,[o.SYNCED_AC_EVENTS]:ae.ac_events,[o.OPTIN_DEFERRED_UNTIL]:ae.optinDeferredUntil},u.sessionStorage={[r.subscriptionVerifiedKey]:r.subscriptionVerified,[r.permissionKey]:r.isPermissionNotGranted,[r.optinSeenCountKey]:r.optinSeenCount},u.subdomain=t,u.debug_url=window.location.href,u.user_agent=navigator.userAgent,u.logs=K,Promise.all([new Promise((e=>{navigator.serviceWorker.getRegistrations().then((function(t){e(t.map((function(e){return{scope:e.scope,active:e.active}})))}))})),n,i?i.getCart():Promise.resolve()]).then((e=>{var[t,i,n]=e;n&&(u.current_cart_json=n),t&&t.length&&(u.serviceWorkers=t),"string"==typeof i&&(u.pushowl_not_enabled_reason=i),c.debugLog(u),window.prompt("Send this to PushOwl Support",JSON.stringify(u,!1,2))}))}({subdomain:this.subdomain,StoreLibClass:this.getStoreLibClass(),isEnabled:e})})))}customTasks(){var e=k("poTaskType");e&&(V("Task type",e),e===b?We.subscribeIfNotAlready({enableHintScreen:!0,websitePushId:this.config.website_push_id,browserHandler:this.browserHandler}):e===g&&We.unsubscribe(this.browserHandler))}checkPushowlSession(){"pushowl"===k("utm_source")&&function(e){var{privacy:t}=e.config;if(t.notification_preference.enabled){var i=document.querySelector("body"),n={subdomain:e.subdomain,subscriberToken:ae.subscriberToken};Promise.all([import("./NotificationPreference-af8c475a.js"),import("./NotificationPreferenceToggle-bc4a6f6b.js")]).then((e=>{var[{NotificationPreference:o},{NotificationPreferenceToggle:r}]=e,s=new o(i,n,t.notification_preference);new r(i,t.notification_preference,s).render(),V("Notification Preference shown.")})).catch((e=>{V("Error encountered in loading Notif preferences: ".concat(e.message))}))}}(this.context)}syncCustomerId(){var e=this.getStoreLibClass();if(e.customerId&&e.customerId!==ae.syncedCustomerId&&this.config.privacy.customer_id){if(window.Shopify&&!ae.subscriberToken){var t=G(a.STORAGE_KEYS.SUBSCRIBER_TOKEN);t&&(ae.subscriberToken=t)}this.apiClient.syncSubscriber().then((()=>{ae.syncedCustomerId=e.customerId})).catch((()=>{W("Subscriber not synced")}))}}initiateDefaultPrompt(e,t,i,n,o){var r=!(!e||N())&&e.enabled;return Q.isWorkerAvailable.then((s=>{if(s)return We.subscribe({enableHintScreen:r,hintScreenData:e,websitePushId:this.config.website_push_id,browserHandler:this.browserHandler,source:t,source_id:i}).then((e=>{if(e&&e.subscriberToken){var{consent:t}=ae;return ae.consent=[...t,"webpush"],o&&o(),this.onSuccessfullSubscription(),e}return n&&n(),e})).catch((e=>{})).finally((()=>{var e=document.querySelector(".js-custom-prompt-2");e&&e.remove()}));var a=this.subdomain.replace(/\./g,"-");return window.open("https://".concat(a,".powl.co/subscribe?po_url=").concat(encodeURIComponent(window.location.href),"&env=").concat(this.environment,"&subdomain=").concat(this.subdomain,"&platform=").concat(Q.platform),"","width=700,height=500"),new Promise((e=>{window.addEventListener("message",(t=>{var i=t.data;if(i&&"subscriptionFinish"===i.type){var n=i.data;n&&"granted"===n.status&&(ae.subscriberToken=n.subscriberToken,ae.isPermissionGranted=!0,e({subscriberToken:n.subscriberToken}))}}))}))}))}render(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.getStoreLibClass();if(!this.config)throw"Pushowl Config not initialised";i.section===p.HOME?this.defaultRender(t):i.section===p.PRODUCT?this.storeLib.getProductDetails(e).then((e=>{this.productSectionRender(e)})):i.section===p.CHECKOUT?V("🟠 Optin prompt was not shown. Reason: Checkout page"):this.defaultRender(t)}optinFlows(e){je.newRender({config:this.config,shouldIncrementFrequency:e,subscribeCallback:this.initiateDefaultPrompt.bind(this)})}defaultRender(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t={isOptinRendered:!1,isFlyoutRendered:!1};"sendinblue"===Q.platform?je.oldRender({config:this.config,subscribeCallback:this.initiateDefaultPrompt.bind(this)}):this.optinFlows(e),t.isOptinRendered=!0;var i=this.config.home.flyout;return De()&&i.enabled&&window.Notification.permission!==a.NOTIFICATION_PERMISSION.GRANTED?(this.flyoutHandler.then((e=>{qe.renderOptin({rootContext:{config:this.config,browserHandler:this.browserHandler},flyoutHandler:e})})),t.isFlyoutRendered=!0):V("Flyout was not shown. Reason: ".concat(i.enabled?"permission already granted":"flyout is disabled"),"Config: ",this.config.home.flyout),t}productSectionRender(e){if(De()){var t=e.currentVariant();F("Current product",{id:t.id,name:t.name,"Is in stock?":t.available?"✅":"❌",price:t.price});var{back_in_stock:i,price_drop:n}=this.config,o={config:this.config,browserHandler:this.browserHandler};this.flyoutHandler.then((r=>{var s={rootContext:o,flyoutHandler:r,product:e,variant:t};if(!t.available&&i.enabled)qe.renderBackInStock(s);else if(t.available&&n.enabled)qe.renderPriceDrop(s);else{var{isFlyoutRendered:a}=this.defaultRender();a||r.remove()}}))}}showBrowserPrompt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{overlay:{enabled:!1}};return je.showNativePrompt({hintScreenConfig:e,subscribeCallback:e=>this.initiateDefaultPrompt(e)})}showCustomPrompt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;import("./OptinPrompt-1230bc4e.js").then((i=>{var{OptinPromptWidget:n}=i,o=this.config.optin.config,r=new n,s={multilingual_title:e.title?{default:e.title}:o.multilingual_title,multilingual_description:e.description?{default:e.description}:o.multilingual_description,yesButton:e.yesButton&&e.yesButton.label?{multilingual_label:{default:e.yesButton.label}}:o.yesButton,noButton:e.noButton&&e.noButton.label?{multilingual_label:{default:e.noButton.label}}:o.noButton};r.setState(q(q({},s),{},{theme:e.theme||o.theme,logo:e.logo||o.logo,position:e.position||o.position,autoFocus:this.config.flags.custom_prompt_screenreader_support,yesButtonListener:()=>{t&&(window.poSubscriptionSource=f,this.config.optin_report_enabled&&window.poAnalytics.track("PNOptinAllowClicked",{optinSeenCount:this.sessionManager.optinSeenCount})),this.initiateDefaultPrompt(void 0===e.overlay?o.overlay:e.overlay).then((()=>{"function"==typeof e.yesButtonListener&&e.yesButtonListener()})),setTimeout((()=>{r.destroy()}),100)},noButtonListener:()=>{setTimeout((()=>{r.destroy()}),100),this.sessionManager.isPermissionNotGranted=!0,t&&this.config.optin_report_enabled&&window.poAnalytics.track("PNOptinLaterClicked",{optinSeenCount:this.sessionManager.optinSeenCount}),"function"==typeof e.noButtonListener&&o.noButtonListener()}})),t&&this.config.optin_report_enabled&&window.poAnalytics.track("PNOptinShown",{optinSeenCount:this.sessionManager.optinSeenCount})})).catch((e=>{V("Error encountered in loading Optin Prompt widget (API): ".concat(e.message))}))}load3PIntegrations(){}syncAbandonedCart(e){(e?Promise.resolve(e):this.getStoreLibClass().getCart()).then((e=>{!function(e){var{cartJson:t,CartClass:i}=e;if(t){var n=new i(t),o=new ge,r=n.token?"token":"checkout_token",s=["Cart Token:",n[r],"Cart Items",n.item_count,"Last synced Cart:",ae.synced_cart_json,"AC Events:",ae.ac_events],a=ae.synced_cart_json,c=a?new i(a):null;t.updated_at=t.updated_at||(new Date).toISOString(),n.item_count>0&&(!c||n.cartId!==c.cartId)||0===n.item_count&&c&&c[r]===n[r]&&c.cartId!==n.cartId?o.syncCart(n).then((e=>{ae.synced_cart_json=t,ae.ac_events=e.result;var{token:i}=e.result;i&&(ae.subscriberToken=i),V("Cart synced successfully. Response: ",e)})).catch((e=>{W(e),V("🔴 Cart sync failed. Error: request failed. ",e,...s)})):V("Cart was not synced. Reason: No change since last sync.",...s)}}({cartJson:e,CartClass:this.getStoreCartClass()})})).catch((e=>{W(e),V("🔴 Cart sync failed. Error: cart could not be synced.  ",e)}))}syncCart(e){this.browserHandler.isPermissionGranted&&this.config.abandoned_cart_enabled&&We.verifySubscriber({browserHandler:this.browserHandler}).then((()=>{this.syncAbandonedCart(e)}))}syncProductView(){this.getStoreLibClass().section===p.PRODUCT&&this.config.browse_abandonment_enabled&&this.getCurrentProduct().then((e=>{this.apiClient.syncProductView(e).then((e=>{var{token:t}=e.result;t&&(ae.subscriberToken=t),V("Product synced",e)})).catch((e=>{W(e)}))})).catch((e=>{W(e)}))}subscriberLog(e){var t=Object.entries(e).map((e=>{var[t,i]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(i))})).join("&");return L({url:"".concat(this.apiEndpoint,"/api/v1/").concat(this.subdomain,"/log/?").concat(t)}).then((e=>e),(()=>"Logging failed"))}setCustomerId(e){window.pushowl.customerId=e,this.browserHandler.isPermissionGranted&&We.verifySubscriber({browserHandler:this.browserHandler}).then((()=>{this.syncCustomerId()}))}setCheckoutId(e){this.browserHandler.isPermissionGranted&&We.verifySubscriber({browserHandler:this.browserHandler}).then((()=>{this.apiClient.syncSubscriberTokenAndCheckoutId(e)}))}showBackInStock(e,t){this.flyoutHandler.then((i=>{qe.renderBackInStock({rootContext:this.context,flyoutHandler:i,product:e,variant:t})}))}showPriceDrop(e,t){this.flyoutHandler.then((i=>{qe.renderPriceDrop({rootContext:this.context,flyoutHandler:i,product:e,variant:t})}))}}{onCanRun(){var{context:e}=this;this.render(),$e.backInStockButtons({context:e,onSuccess:e=>{this.productSectionRender(e)}}),$e.priceDropButtons({context:e,onSuccess:e=>{this.productSectionRender(e)}}),this.config.abandoned_cart_enabled&&this.initAjaxCartDetection(),this.handleVariantChange()}onSubscriberVerifiedOnPageLoad(){this.config.abandoned_cart_enabled&&this.syncAbandonedCart(),this.syncProductView()}onScriptLoad(){this.recoveredCartManager()}onSuccessfullSubscription(){this.render(!1,!1)}getStoreLibClass(){return de}getStoreCartClass(){return ze}getCurrentProduct(){return this.storeLib.getRawCurrentProductDetails()}isEnabled(){return Ae({subdomain:this.subdomain}).then((()=>"undefined"==typeof __st&&void 0===window.Shopify?Promise.reject(n.NOT_SHOPIFY):Promise.resolve()))}initAjaxCartDetection(){var e=e=>{this.browserHandler.isPermissionGranted&&We.verifySubscriber({browserHandler:this.browserHandler}).then((()=>{V("[AJAX CART] Detected Add to Cart"),this.syncAbandonedCart(e)}))};Ze.detectAjaxCartUpdate(e),this.config.flags&&this.config.flags.enable_cart_detection_2&&Ze.detectAjaxCartUpdate2(e),Ze.detectAjaxCartUpdate3(e)}handleVariantChange(){if(de.section===p.PRODUCT&&(this.config.back_in_stock.enabled||this.config.price_drop.enabled)){var e=document.querySelector('form[action$="cart/add"]'),t=document.querySelector('select[name="id"]');if(!e&&t&&(e=t.closest("form")),!e)return;var i=!1,n=()=>{i||(i=!0,setTimeout((()=>{V("In-page variant change detected"),this.render(),i=!1}),500))};e.addEventListener("change",n),e.onchange||(e.onchange=n)}}load3PIntegrations(){var e=[];e.length?window.Notification&&window.Notification.permission===a.NOTIFICATION_PERMISSION.GRANTED||navigator.serviceWorker.register("".concat(Q.serviceWorkerUrl(),"&integrations=").concat(e.join(","))):window.Notification&&window.Notification.permission===a.NOTIFICATION_PERMISSION.GRANTED||navigator.serviceWorker.getRegistrations().then((function(e){e.forEach((e=>{e.active&&e.active.scriptURL.match(/pushowl/)&&e.unregister()}))}))}recoveredCartManager(){var e=k("poCartData");if(e)try{var t=JSON.parse(window.atob(e));de.getCart().then((e=>{if(0===new ze(e).item_count){var{cart:i}=t;L({method:"POST",url:"/cart/update.js",payload:{updates:i}}).then((()=>{V("Cart Update Done"),window.location.href=window.location.origin+window.location.pathname}))}}))}catch(e){W(e)}}}var tt=Object.freeze({__proto__:null,bootstrap:()=>{if(Q.isDisabled())V("Pushowl is disabled in your store");else{var e=new et,t=(c=e,u={LOG_LEVELS:s,setLogLevel:e=>{ae.logLevel=e,V("Log level set to: ".concat(e))},push(e){c.ready.then((()=>{e()}))},getSubdomain:()=>c.subdomain,isEnabled:()=>c.isEnabled(),subscriberLog:e=>c.subscriberLog(e),subscribe(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return We.subscribeIfNotAlready({enableHintScreen:e,websitePushId:c.config.website_push_id,browserHandler:c.browserHandler})},registerForEvent(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((s,u)=>{We.subscribeIfNotAlready({enableHintScreen:t,websitePushId:c.config.website_push_id,browserHandler:c.browserHandler}).then((()=>{c.storeLib.getProductDetails(!1,n.productAlias).then((t=>{var d=n.productVariantId?t.getVariant(n.productVariantId):t.currentVariant(),l=null,p=null;if(e===r.BACK_IN_STOCK)l=a.EVENT_API_PATH.BACK_IN_STOCK,p=c.storageManager.back_in_stock;else{if(e!==r.PRICE_DROP)return void u(o.UNKNOWN_EVENT);l=a.EVENT_API_PATH.PRICE_DROP,p=c.storageManager.price_drop}We.update(l,{product_id:t.id,product:t,variant:d,source:i.PARTNER_JS_API,permission:window.Notification&&window.Notification.permission}).then((()=>{c.productSectionRender(t),p.subscribe(d);var e={};e[a.STORAGE_KEYS.SUBSCRIBER_TOKEN]=ae.subscriberToken,s(e)})).catch((e=>{W(e)}))}))})).catch((()=>{u({error_code:o.PERMISSION_NOT_GRANTED})}))}))},isProductVariantSubscribed:(e,t)=>"price_drop"===e?c.storageManager.price_drop.isSubscribed({id:t}):"back_in_stock"===e&&c.storageManager.back_in_stock.isSubscribed({id:t}),showBrowserPrompt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{overlay:{enabled:!1}};return c.showBrowserPrompt(e)},showCustomPrompt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.overlay=null,c.showCustomPrompt(e)},showWidget(e){var{type:t}=e,i=z(e,Qe);switch(t){case"browserPrompt":return c.showBrowserPrompt(i);case"customPrompt":return c.showCustomPrompt(i,!0);case"priceDrop":return i.variant.name=i.variant.title,delete i.variant.title,c.showPriceDrop(i.product,i.variant);case"backInStock":return i.variant.name=i.variant.title,delete i.variant.title,c.showBackInStock(i.product,i.variant);case"optinFlows":return c.optinFlows(!0)}},syncCart:e=>(e.item_count=e.items.length,e.items.map((e=>{e.variant_id=e.variantId,delete e.variantId,e.product_id=e.productId,delete e.productId})),e.checkout_token=e.checkoutToken,delete e.checkoutToken,c.syncCart(e)),syncProductView:e=>(e.id=e.productId,delete e.productId,c.syncProductView(e)),setCustomerId:e=>c.setCustomerId(e),setCheckoutId:e=>c.setCheckoutId(e),getCurrentPermission:()=>ae.isPermissionGranted?Promise.resolve(a.NOTIFICATION_PERMISSION.GRANTED):window&&window.Notification?Promise.resolve(Notification.permission):void 0},d={get(e,t){if(!e[t]&&c[t]){V("🟠 Internal property accessed: ".concat(t));var i=c[t];return"function"==typeof i?i.bind(c):i}return Reflect.get(...arguments)}},new Proxy(u,d)),n=[];window.pushowl&&(Array.isArray(window.pushowl)?V("Existing PushOwl found in queue mode with following tasks queued: ",n=window.pushowl):V("Existing PushOwl found and will be reused. Pushowl seems to be loading twice on this page. Please check page source.")),window.pushowl&&!Array.isArray(window.pushowl)||(window.poSubscriptionSource="",window.pushowl=t,V("PushOwl instance created")),n.length&&e.ready.then((()=>{V("PushOwl ready to execute API functions."),n.forEach((e=>e())),V("Tasks from PushOwl queue executed. No. of tasks: ".concat(n.length))}))}var c,u,d}});export{ge as A,c as P,ae as S,Z as a,N as b,j as c,V as d,A as e,a as f,y as g,tt as h,M as i,P as p};
