!function(e){ar n={},r={0:0};.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise(();t.push(n[2]=o);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.src=function(e){return i.p+""+e+"."+{1:"ae1c2e79179012631550",2:"db9d31152af7b4dcb4a7",3:"5ee7941440d3cddb2b3c"}[e]+".js"}(e);var c=new Error;a=var u=setTimeout((,12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(t)},i.m=e,i.c=n,i.d=i.r=i.t=i.n=i.o=i.p="/widget/js/",i.oe=var o=window.libraryh3lpwebpackjsonp=window.libraryh3lpwebpackjsonp||[],a=o.push.bind(o);o.push=t,o=o.slice();for(var s=0;s<o.length;s++)t(o[s]);var c=a;i(i.s=13)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(20);function o(e,t,n){var o,a,s,c={};if(void 0!==n?(c=t,i.array(n)?o=n:i.primitive(n)?a=n:n&&n.sel&&(o=[n])):void 0!==t&&(i.array(t)?o=t:i.primitive(t)?a=t:t&&t.sel?o=[t]:c=t),void 0!==o)for(s=0;s<o.length;++s)i.primitive(o[s])&&(o[s]=r.vnode(void 0,void 0,void 0,o[s],void 0));return"s"!==e[0]||"v"!==e[1]||"g"!==e[2]||3!==e.length&&"."!==e[3]&&"#"!==e[3]||function e(t,n,r){if(t.ns="http://www.w3.org/2000/svg","foreignObject"!==r&&void 0!==n)for(var i=0;i<n.length;++i){var o=n[i].data;void 0!==o&&e(o,n[i].children,n[i].sel)}}(c,o,e),r.vnode(e,c,o,a,void 0)}t.h=o,t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=window.messages||{},i=r.domain||"widget";r&&(r=r.locale_data),r&&(r=r[i]),t.default=function(e){var t=null;return r&&(t=r[e]),t&&t.length>0?t[0]:e}},function(e,t,n){"use strict";function r(){return"Notification"in window&&"https:"===location.protocol&&!)}function i(){var e=navigator.userAgent.match(/Trident.*rv[ :]*11\./);return e&&e.length>=1}function o(e,t){var n=navigator.userAgent.match(e);return n&&n.length>=t?parseInt(n[t],10):-1}Object.defineProperty(t,"__esModule",{value:!0}),t.canShareScreen=function(){return"https:"==location.protocol&&((!/constructor/i.test(window.HTMLElement)&&"[object SafariRemoteNotification]"!==(!window.safari||void 0!==window.safari&&window.safari.pushNotification).toString()||!(o(/Safari\/(\d+)\./,1)<13))&&(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.getDisplayMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.getUserMedia))},t.canShowDesktopNotifications=r,t.desktopNotificationPermissionGranted=t.askDesktopNotificationPermission=function(e){r()&&(!function(){try{Notification.requestPermission().then()}catch(e){return!1}return!0}()?Notification.requestPermission((function(t){e(t)})):Notification.requestPermission().then(())},t.isEdge=function(){var e=navigator.userAgent.match(/Edge/);return e&&e.length>=1},t.isInternetExplorer=i,t.getUrlParameterByName=function(e){if(i()){for(var t=window.location.search.substring(1).split("&"),n=void 0,r=0;r<t.length;r++){var o=t[r].split("="),a=o[0],s=o[1];a===e&&(n=s&&decodeURIComponent(s))}return n}return new URL(window.location.href).searchParams.get(e)},t.withStorageAccess=function(e){e&&(document.hasStorageAccess?document.hasStorageAccess().then((function(t){t?e():document.requestStorageAccess().then(e).catch(()})):e())}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=i||{};i.Utils=i.Utils||{},i.Utils.IgnoreUtilFocusChanges=!1,i.Utils.isFocusable=function(e){if(e.tabIndex<0)return!1;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&"ignore"!==e.rel;case"INPUT":return"hidden"!==e.type;case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},i.Utils.focusFirstDescendant=i.Utils.focusLastDescendant=i.Utils.attemptFocus=var o=function(){function e(){this.lastFocusedElement=null,this.returnFocusElement=null,document.activeElement instanceof HTMLElement&&(this.lastFocusedElement=document.activeElement,this.returnFocusElement=document.activeElement),document.addEventListener("focus",this.trapFocus,!0)}return e.prototype.trapFocus=function(e){if(!i.Utils.IgnoreUtilFocusChanges){var t=document.getElementById("modal-dialog");t.contains(e.target)?this.lastFocusedElement=e.target:(i.Utils.focusFirstDescendant(t),this.lastFocusedElement==document.activeElement&&i.Utils.focusLastDescendant(t),document.activeElement instanceof HTMLElement&&(this.lastFocusedElement=document.activeElement))}},e.prototype.returnFocus=function(){this.returnFocusElement&&(this.returnFocusElement.focus(),this.returnFocusElement=null),document.removeEventListener("focus",this.trapFocus,!0)},e.openLinksInNewTab=function(e){var t=e.target.href;t&&0===t.indexOf("http")&&(e.preventDefault(),open(t))},e.prototype._render=function(){var e=this.renderButtons(),t=this.renderBody(),n=this.renderHeader();return r.default("div#modal-dialog",{attrs:{"aria-hidden":t?"false":"true"},style:{display:t?"block":"none"}},[r.default("div#before-modal-dialog",{attrs:{tabindex:"0"}}),r.default("div",{attrs:{autofocus:!0,role:"dialog",tabindex:"-1"},hook:{insert:},[r.default("div#modal-content",{attrs:{role:"document"}},[r.default("div#modal-header",{style:{display:n?"block":"none"}},n),t,r.default("div#modal-footer",{},e)])]),r.default("div#after-modal-dialog",{attrs:{tabindex:"0"}})])},e}();t.default=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=;Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),s=n(0),c=function(e){eturn i(t,e),t.prototype.renderBody=function(){return this.message},t.prototype.renderButtons=function(){var e=this;return[s.default("button",{attrs:{type:"button"},on:{click:},a.default("OK"))]},t.prototype.renderHeader=t.prototype.render=t}(o.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=function(){function e(t,n,r,i){this.sender=t,this.body=n,this.url=r,this.preview=i,this.id=e.nextId++,this.timestamp=Date.now()}return e.prototype.isOTRErrorMessage=e.prototype.substituteSpecial=e.prototype.timeDifference=function(e){return e?Math.abs(e.timestamp-this.timestamp):void 0},e.prototype.toJSON=e.fromJSON=function(t){var n=t.id,r=t.timestamp,i=t.sender,o=t.body,a=t.url,s=t.preview,c=e.makeMessage(i,o,a,s,void 0);return c.timestamp=r,n&&(c.id=n,e.nextId=Math.max(e.nextId,c.id+1)),c},e.makeMessage=function(t,n,r,i,o){var a=0!==n.indexOf("data:image/png;base64,")?new e(t,n,r,i):null;return o&&o(a),a},e.replaceSpecial=e.nextId=0,e}();t.default=i},function(e,t,n){"use strict";function r(e){var t=parseInt(e,16);return String.fromCodePoint(t)}Object.defineProperty(t,"__esModule",{value:!0});var i={};t.default=function(e){for(var t in i)if(i.hasOwnProperty(t)){var n=r(i[t]),o=new RegExp("(^|\\s)"+t+"($|\\s)","g");e=e.match(o)?e.replace(o," "+n+" "):e}return e},i[":-\\)"]=i[":\\)"]="1F642",i[":-D"]=i[":D"]="1F600",i[":#\\("]="1F637",i["\\(;"]=i["\\(-;"]=i[";-\\)"]=i[";\\)"]="1F609",i[":-\\|"]=i[":\\|"]="1F611",i["B-\\)"]=i["B\\)"]="1F60E",i[":o\\)"]="1F601",i[":-d"]=i[":d"]="1F61B",i[":'-D"]=i[":'D"]="1F923",i["8-D"]=i["8D"]="1F60B",i[":-p"]=i[":p"]="1F61C",i[":zany:"]="1F92A",i[":-P"]=i[":P"]="1F61B",i["B-\\|"]=i["B\\|"]="1F642",i[":-o"]=i[":o"]="1F632",i[":-S"]=i[":S"]="1F630",i["#-\\("]=i["#\\("]="1F635",i["8-\\/"]=i["8\\/"]="1F633",i[":\\*\\)"]="1F633",i[":-O"]=i[":O"]="1F62E",i[":-0"]=i[":0"]="1F628",i[":-X"]=i[":X"]=i[":-x"]=i[":x"]="1F636",i["\\?-\\|"]=i["\\?\\|"]="1F914",i["8-s"]=i["8s"]="1F928",i[":-s"]=i[":s"]="1F615",i[":-\\&lt;"]=i[":\\&lt;"]=i[":-\\<"]=i[":\\<"]="1F641",i[":'-\\("]=i[":'\\("]="1F625",i["\\):"]=i["\\)-:"]=i[":-\\("]=i[":\\("]="1F622",i["8-\\("]=i["8\\("]="1F61E",i["&gt;:-\\|"]=i[">:-\\|"]=i["&gt;:\\|"]=i[">:\\|"]="1F620",i["\\>:-o"]=i["\\>:o"]=i["\\&gt;:-o"]=i["\\&gt;:o"]="1F624",i["8-\\["]=i["8\\["]="1F971",i["8-\\|"]=i["8\\|"]="1F971",i["3-\\|\\{"]=i["3\\|\\{"]="1F62A",i["\\&gt;:-\\)"]=i["\\&gt;:\\)"]=i["\\>:-\\)"]=i["\\>:\\)"]="1F925",i["@-\\)"]=i["@\\)"]="1F47D",i[":skull:"]="1F480",i["\\(l\\)"]=i["\\(L\\)"]=i["\\(u\\)"]=i["\\(U\\)"]=i[":heart:"]="1F496",i[":bheart:"]="1F494",i[":star:"]="2B50",i[":100:"]=i[":hundred:"]="1F4AF",i[":trophy:"]="1F3C6",i[":party:"]="1F389",i[":flag:"]="1F3C1",i["\\(i\\)"]=i["\\(I\\)"]=i[":jabber:"]=i[":lamp:"]="1F4A1",i["\\(n\\)"]=i["\\(N\\)"]=i[":no:"]="1F44E",i["\\(y\\)"]=i["\\(Y\\)"]=i[":yes:"]="1F44D",i[":check:"]="2714",i[":cancel:"]="274C",i[":warning:"]="26A0",i[":fire:"]="1F525",i[":chart:"]="1F4CA",i[":microscope:"]="1F52C",i[":movie:"]="1F3A5",i[":cap:"]="1F393",i["\\(t\\)"]=i["\\(T\\)"]=i[":mobile:"]="1F4F1",i["\\(p\\)"]=i["\\(P\\)"]=i[":camera:"]=i[":photo:"]="1F4F7",i["\\(8\\)"]=i[":note:"]=i[":pencil:"]="1F4DD",i[":snake:"]="1F40D",i[":dog:"]="1F436",i[":dragon:"]="1F409",i[":fish:"]="1F421",i[":koala:"]="1F428",i[":tux:"]=i[":linux:"]=i[":penguin:"]="1F427",i[":octopus:"]="1F419",i[":books:"]="1F4DA",i[":recycle:"]="267B",i[":clock:"]="1F550",i[":world:"]="1F30D",i[":hammer:"]="1F528",i[":magnify:"]="1F50D",i[":eyes:"]="1F440",i["\\(8\\)"]=i[":note:"]=i[":music:"]="1F3B5",i[":apple:"]="1F34E",i[":cherry:"]="1F352",i[":mushroom:"]="1F344",i["\\(z\\)"]=i["\\(Z\\)"]=i["\\(c\\)"]=i["\\(C\\)"]=i[":coffee:"]="2615",i[":flower:"]="1F33C",i[":bee:"]="1F41D",i[":cat:"]="1F431",i[":snail:"]="1F40C",i[":bike:"]="1F682",i[":car:"]="1F697",i[":ghost:"]="1F47B",i[":helicopter:"]="1F681",i[":television:"]=i[":tv:"]="1F4FA",i[":pumpkin:"]="1F383",t.uniqueEmoji=[["1F44D","thumbs up"],["1F44E","thumbs down"],["1F44F","clapping hands"],["1F600","grinning face"],["1F603","grinning face with big eyes"],["1F604","grinning face with smiling eyes"],["1F601","beaming face with smiling eyes"],["1F606","grinning squinting face"],["1F605","grinning face with sweat"],["1F923","rolling on the floor laughing"],["1F602","face with tears of joy"],["1F642","slightly smiling face"],["1F643","upside-down face"],["1F609","winking face"],["1F60A","smiling face with smiling eyes"],["1F607","smiling face with halo"],["1F970","smiling face with hearts"],["1F60D","smiling face with heart-eyes"],["1F929","star-struck"],["1F618","face blowing a kiss"],["1F617","kissing face"],["1F61A","kissing face with closed eyes"],["1F619","kissing face with smiling eyes"],["1F60B","face savoring food"],["1F61B","face with tongue"],["1F61C","winking face with tongue"],["1F92A","zany face"],["1F61D","squinting face with tongue"],["1F911","money-mouth face"],["1F917","hugging face"],["1F92D","face with hand over mouth"],["1F92B","shushing face"],["1F914","thinking face"],["1F910","zipper-mouth face"],["1F928","face with raised eyebrow"],["1F610","neutral face"],["1F611","expressionless face"],["1F636","face without mouth"],["1F60F","smirking face"],["1F612","unamused face"],["1F644","face with rolling eyes"],["1F62C","grimacing face"],["1F925","lying face"],["1F60C","relieved face"],["1F614","pensive face"],["1F62A","sleepy face"],["1F924","drooling face"],["1F634","sleeping face"],["1F637","face with medical mask"],["1F912","face with thermometer"],["1F915","face with head-bandage"],["1F922","nauseated face"],["1F92E","face vomiting"],["1F927","sneezing face"],["1F975","hot face"],["1F976","cold face"],["1F974","woozy face"],["1F635","knocked-out face"],["1F92F","exploding head"],["1F920","cowboy hat face"],["1F973","partying face"],["1F60E","smiling face with sunglasses"],["1F913","nerd face"],["1F9D0","face with monocle"],["1F615","confused face"],["1F61F","worried face"],["1F641","slightly frowning face"],["1F62E","face with open mouth"],["1F62F","hushed face"],["1F632","astonished face"],["1F633","flushed face"],["1F97A","pleading face"],["1F626","frowning face with open mouth"],["1F627","anguished face"],["1F628","fearful face"],["1F630","anxious face with sweat"],["1F625","sad but relieved face"],["1F622","crying face"],["1F62D","loudly crying face"],["1F631","face screaming in fear"],["1F616","confounded face"],["1F623","persevering face"],["1F61E","disappointed face"],["1F613","downcast face with sweat"],["1F629","weary face"],["1F62B","tired face"],["1F971","yawning face"],["1F624","face with steam from nose"],["1F621","pouting face"],["1F620","angry face"],["1F92C","face with symbols on mouth"],["1F480","skull"],["1F47D","alien"],["1F47B","ghost"],["1F916","robot"],["1F496","sparkling heart"],["1F494","broken heart"],["1F4AF","hundred points"],["1F4A5","collision"],["1F4A4","zzz"],["1F440","eyes"],["1F436","dog"],["1F431","cat"],["1F428","koala"],["1F427","penguin"],["1F989","owl"],["1F40D","snake"],["1F409","dragon"],["1F996","t-rex"],["1F421","blowfish"],["1F419","octopus"],["1F40C","snail"],["1F41D","honeybee"],["1F33C","blossom"],["1F340","four leaf clover"],["2615","hot beverage"],["1F34E","apple"],["1F352","cherry"],["1F344","mushroom"],["1F30D","globe"],["1F697","automobile"],["1F6B2","bicycle"],["1F6E9","airplane"],["1F681","helicopter"],["1F550","clock"],["1F31F","glowing star"],["2728","sparkles"],["1F308","rainbow"],["1F525","fire"],["1F4A7","droplet"],["1F383","jack-o-lantern"],["1F389","party popper"],["1F3C6","trophy"],["1F3B5","musical note"],["1F4F1","mobile phone"],["1F4BB","laptop"],["1F5A5","desktop computer"],["1F4FA","television"],["1F4F7","camera"],["1F3A5","movie camera"],["1F52C","microscope"],["267B","recycling symbol"],["1F4DA","books"],["1F4DD","memo"],["1F50D","magnifying glass"],["1F528","hammer"],["1F3C1","chequered flag"],["1F4A1","light bulb"],["1F393","graduation cap"],["1F4CA","bar chart"],["2714","check mark"],["274C","cross mark"],["26A0","warning"]].map(()},function(e,t,n){"use strict";bject.defineProperty(t,"__esModule",{value:!0}),t.jidNode=function(e){return e.indexOf("@")>=0?e.split("@")[0]:null},t.bareEq=,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),i=n(28),o=n(2),a=n(1),s=n(7),c=n(0),u=n(29),l=n(30),d=n(31),f=n(4),p=function(){function e(t,n,a){var s=this;this.chat=t,this.setDirty=a,this.isPopout=parent===window,this.chatPolicy=n.policy,this.chatPolicyAgreement=n.policyAgreement,this.disableSendFile=n.disableSendFile,this.greeting=n.greeting,this.isMobile=n.mobile||!1,this.modalDialog=null,this.offline=n.offline||{},this.typeyText=n.typeyText||"Type here to chat. Press ENTER to send.",this.widgetTitle=n.title||"​";var c=document.getElementById("recv");this.textDirection=c.getAttribute("dir")||"ltr",this.presenceTheme=n.theme||"gota",this.parseTheme(),e.preserveVCard(),this.serverConnection=new i.default(this.chat,this.setDirty),this.composing=new r.default(this.serverConnection,this.chat),o.isInternetExplorer()&&document.addEventListener("keydown",(function(e){return s.handleKeyDown(e)})),document.addEventListener("dragover",(function(e){return s.handleDragOver(e)})),document.addEventListener("drop",(function(e){return s.handleDrop(e)})),document.addEventListener("paste",(function(e){return s.handlePaste(e)}))}return e.formatTimestamp=function(e){var t=new Date(e),n="0"+t.getHours(),r="0"+t.getMinutes();return(n=n.substring(n.length-2))+":"+(r=r.substring(r.length-2))},e.openLinksInNewTab=function(e){var t=e.target.href;t&&0===t.indexOf("http")&&(e.preventDefault(),open(t))},e.preserveVCard=function(){try{opener&&"vCard"in opener&&(window.vCard=opener.vCard)}catch(e){}},e.prototype.clearHistory=function(){var e=this;this.modalDialog=new u.default(null,c.default("span",{},a.default("Clear Chat History")),(function(){e.closeDialog(),e.serverConnection.shutdown(),e.chat.clearHistory(),location.reload()}),(function(){return e.closeDialog()})),this.setDirty()},e.prototype.emailTranscript=function(e){var t=this;this.composing.guestSentMessage&&(e.preventDefault(),this.modalDialog=new d.default(c.default("span",{},a.default("Sends chat history in an email.")),c.default("span",{},a.default("Send transcript to:")),(function(e){t.closeDialog(),(e=e&&e.split(" ")[0])&&e.match(/\S+@\S+\.\S+/)?t.chat.emailTranscript(e):e&&(t.modalDialog=new f.default(null,c.default("span",{},a.default("Email was not sent. Please use a valid email address. Example: username@your.domain")),(function(){return t.closeDialog()})),t.setDirty())})})),this.setDirty())},e.prototype.generateWidgetComponents=function(){return[this.renderChat(!!this.modalDialog),this.renderModal()]},e.prototype.renderModal=function(){this.modalDialog||(this.serverConnection.invite.length>0?this.onCobrowseInvite():this.serverConnection.screensharingEnded&&this.onCobrowseEnded());var e=null;return this.modalDialog&&(e=this.modalDialog.render()),e},e.prototype.closeDialo},e.prototype.parseTheme=function(){var e=document.getElementById("presence").src.split("/");this.presenceTheme=e[5]},e.prototype.handleDragOve},e.prototype.handleDrop=function(e){try{e.preventDefault();var t=e.dataTransfer.files.item(0);this.sendFile(t)}catch(e){}},e.prototype.handleKeyDown=function(e){var t=this;try{if(86===e.which&&e.ctrlKey){var n=document.activeElement,r=document.getElementsByTagName("body").item(0),i=document.createElement("div");i.setAttribute("contenteditable","true"),i.style.left="-1000px",i.style.position="absolute",r.appendChild(i),i.addEventListener("paste",(function(e){return t.handlePaste(e)})),i.focus(),setTimeout}),100)}}catch(e){}return!1},e.prototype.handlePaste=function(e){try{for(var t=e.clipboardData?e.clipboardData.items:window.clipboardData.files,n=0;n<t.length;++n){var r=t[n];if("image/png"===r.type){e.preventDefault(),e.stopPropagation();var i=r.getAsFile?r.getAsFile():r;this.sendFile(i)}}0===t.length&&o.isInternetExplorer()&&this.composing.handleInput({target:{value:window.clipboardData.getData("Text")}})}catch(e){}},e.prototype.popout=function(){var e=innerWidth||document.documentElement.offsetWidth,t=innerHeight||document.documentElement.offsetHeight,n=location.href;n+=n.indexOf("?")>=0?"&":"?",n+="popout=1&sounds="+(this.chat.playSounds?"1":"0"),this.chat.addPopout(n,"chat","resizable=1,width="+e+",height="+t)},e.prototype.onSendFile=function(e){var t=this;e.preventDefault(),!this.disableSendFile&&this.composing.guestSentMessage&&(this.modalDialog=new l.default(null,a.default("send file")+":"})})),this.setDirty())},e.prototype.sendFile=function(e){var t=this;e&&!this.disableSendFile&&this.chat.encryptFile(e,(function(e){e&&t.serverConnection.send(["chat:message",{body:e}])}),(function(e){e&&t.serverConnection.send(["chat:sendfile",{id:e,url:e}])}))},e.prototype.render=function(){var e=this,t=this.generateWidgetComponents();return[c.default("div",{on:{keydow}}},t)]},e.prototype.renderHeader=function(){return c.default("div#header",[c.default("img#presence",{props:{alt:a.default("Chat is "+this.chat.availability+"."),src:["/presence/image",this.presenceTheme,this.chat.availability].join("/")}}),c.default("h1#title",{props:{innerHTML:this.widgetTitle}})])},e.prototype.renderChat=function(e){var t,n=this.renderTranscript(),r=c.default("div#layout",[n]);t=this.renderButtons();var i,o=c.default("div#status",{props:{innerHTML:"&nbsp;"}});return i=c.default("iframe",{props:{name:"filetarget",width:"0",height:"0"},style:{display:"none"}}),c.default("div#chat-box",{attrs:{"aria-hidden":e?"true":"false"}},[this.renderHeader(),r,t,this.renderTypey(),o,i,c.default("audio#widget-beep",[c.default("source",{props:{src:"/widget/snd/widget-beep.ogg",type:"audio/ogg"}}),c.default("source",{props:{src:"/widget/snd/widget-beep.mp3",type:"audio/mpeg"}})])])},e.prototype.onCobrowseEnded=function(){var e=this;this.modalDialog=new f.default(null,c.default("span",{},a.default("Screensharing has ended."))}))},e.prototype.onCobrowseInvite=function(){var e=this;this.modalDialog=new u.default(c.default("span",{},a.default("screensharing invitation")),c.default("p",{},this.serverConnection.invite),(function(){e.serverConnection.acceptInvite(),e.closeDialog()})}))},e.prototype.renderMessages=function(){var t=this,n=null;!0===this.chat.isSecure&&(n=c.default("div.end-to-end-encryption",[c.default("span",{},a.default("This chat uses end-to-end encryption."))]));var r=null;this.greeting&&(r=c.default("div.greeting",[c.default("span",{on:{click:e.openLinksInNewTab},props:{innerHTML:this.greeting}})]));var i=null;if(this.chat.notification)i=c.default("div.notification",[c.default("span.status",{attrs:{role:"status"}},this.chat.notification)]);else{var o=null;switch(this.chat.availability){case"chat":case"available":case"dnd":o=null;break;case"away":case"xa":o=a.default("Chat is away.");break;default:o=a.default("Chat is offline.")}o&&(i=c.default("div.notification",[c.default("span.status",{attrs:{role:"status"}},o)]))}var s=null;this.serverConnection.transcriptRequested&&(s=c.default("div",[c.default("hr"),c.default("div",[c.default("p",a.default("The chat operator requests permission to see your prior messages. Would you like to send your prior messages to the operator?")),c.default("input",{on:{click:function(){t.serverConnection.respondToTranscriptRequest(!0)}},props:{type:"button",value:a.default("Yes, send")}}),c.default("span",{props:{innerHTML:"&nbsp;"}}),c.default("input",{on:{clic}},props:{type:"button",value:a.default("No, do not send")}})]),c.default("hr")]));var u=this.chat.transcript.messages.map}));return u.unshift(r),u.unshift(n),u.push(i),u.push(s),u},e.prototype.renderMessage=function(t){if(t.preview&&!t.objectURL)return this.renderImageMessage(t);if(void 0!==t.objectURL)return this.renderObjectURLMessage(t);var n=s.bareEq(t.sender,this.chat.guestJid);return c.default("div",{props:{className:n?"guest":"operator",dir:this.textDirection},key:t.id},[c.default("span",[this.renderSender(t)]),c.default("span",{props:{innerHTML:"&nbsp;"}}),c.default("span",{on:{click:e.openLinksInNewTab},props:{innerHTML:t.substituteSpecial()}})])},e.prototype.renderImageMessage=function(e){var t=s.bareEq(e.sender,this.chat.guestJid);return c.default("div",{props:{className:t?"guest":"operator",dir:this.textDirection},key:e.id},[c.default("span",[this.renderSender(e)]),c.default("div",[c.default("a",{props:{href:e.url,target:"_blank"}},[c.default("img",{props:{src:e.preview},style:{border:"2px solid blue",marginLeft:"20px"}})])])])},e.prototype.renderObjectURLMessage=function(e){var t=s.bareEq(e.sender,this.chat.guestJid);return e.objectURL?c.default("div",{props:{className:t?"guest":"operator",dir:this.textDirection},key:e.id},[c.default("span",[this.renderSender(e)]),c.default("span",{props:{innerHTML:"&nbsp;"}}),c.default("span",e.preview?"":a.default("file shared")+":"),c.default("span",{props:{innerHTML:"&nbsp;"}}),c.default("a",{props:{href:e.objectURL,download:""}},e.preview?c.default("img",{props:{src:e.objectURL},style:{border:"2px solid blue",maxHeight:"200px",marginLeft:"20px"}}):c.default("span",a.default("download file")))]):c.default("div",{props:{className:t?"guest":"operator",dir:this.textDirection},key:e.id},[c.default("span",[this.renderSender(e)]),c.default("span",{props:{innerHTML:"&nbsp;"}}),c.default("span",a.default("file shared"))])},e.prototype.renderSender=function(t){var n=s.bareEq(t.sender,this.chat.guestJid),r=n?a.default("me"):this.chat.operatorIdentity||s.jidNode(t.sender),i=e.formatTimestamp(t.timestamp);return c.default("span",{props:{className:n?"me":"you"}},i+" "+r)},e.prototype.renderTypey=function(){var e=this,t=function(){if(e.chat.isOnline&&(e.serverConnection.connecting||e.chat.connecting))return a.default("Connecting")+"...";if(e.composing.isActive)return e.composing.message;switch(e.chat.availability){case"chat":case"available":return a.default(e.typeyText);case"dnd":return a.default("Chat is busy.");case"away":case"xa":return a.default("Chat is away.");default:return a.default("Chat is offline.")}};return c.default("div#send",{props:{dir:this.textDirection}},[c.default("form",{on:{submi}}},[c.default("textarea#msg",{attrs:{"data-gramm":"false","aria-label":a.default("Chat message area. Press ENTER to focus and type your message. Press ENTER to send your message.")},hook:{updat}},on:{focus:function(t){return e.composing.handleFocus(t)},input:function(t){return e.composing.handleInput(t)},keydow}},props:{value:t()||" B"}})])])},e}();t.default=n},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(14).polyfill(),String.fromCodePoit}}(String.fromCharCode);var r,i=n(16),o=n(18),a=n(32),s=n(()}var u=new i.default(libraryh3lp_jid,settings,c),l="legacy"===settings.layout?new a.default(u,settings,c):new o.default(u,settings,c);r=new s.default((function(){return l.render()}))},function(e,t,n){(function(t,n){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4+314e4831
 */var r;r=function(){"use stri e}var r=Array.isArray?Array.isAre)},i=0,o=void 0,a=void ))},c="undefined"!=typeof window?window:void 0,u=c||{},l=u.MutationObserver||u.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChan)}}var h=new Array(1=0}var m,y,v,b,w=voit}g)}:l?(y=0,v=new l(g),b=document.createTextNode(""),v.observe(b,{characterData:!0}%2}):f?((m=new MessageChannel).port1.onmessage=0)}):w=void 0=)}}():p();var C=Math.random().toString(36).substring(2);function T(){}var k={error:nu]}va,e}(,e}();return I.prototype.then=_,I.se},I.r))},I.resolve=F,I.rej,t},I._setScheduler=function(e){a=e},I._setA=e},I._asap=s,I.polyf=I},I.Promise=I,I},e.exports=r()}).call(this,n(15),n(100}},function(e,t,n){"use strict";var r=this&&this.__await))},i=this&&this.__generat}}};Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(5),s=n(17),c=n(2),u=n(7),l=n(1),d=function(){function e(e,t,n){var r=this;this.guestJid=e,this.setDirty=n,this.transcript=new s.default,this.connecting=!1,this.guestHasAgreedToChatPolicy=!1,this.queueAvailability="unavailable",this.sentFiles={},this.playSounds=t.sounds||!1,this.popOut=null,this.showDesktopNotifications=!t.disableDesktopNotifications&&c.desktopNotificationPermissionGranted();var i=location.pathname.match(/[^/]+@(chat\.)?[^/?#]+/);this.queueJid=decodeURIComponent(i[0]),this.operatorIdentity=t.identity||u.jidNode(this.queueJid),this.otrFingerprint=t.otrFingerprint,this.readFromLocalStorage(),this.parseAvailability(),addEventListener("message",(function(e){return r.onMessage(e)}),!1)}return e.prototype.start=function(e){var t=this;!this.channel&&(this.channel_cookie||this.otrFingerprint&&!c.isInternetExplorer())?(this.connecting=!0,n.e(3).then(function(r){o=n(11),!t.channel&&t.channel_cookie&&(t.channel=o.Channel.restore(t.channel_cookie),t.channel_cookie=null),t.channel||(t.channel=new o.Channel(null,t.otrFingerprint)),t.connecting=!1,e()}.bind(null,n)).catch(n.oe)):e()},Object.defineProperty(e.prototype,"agreedToChatPolicy",{get:function(){return this.guestHasAgreedToChatPolicy},set:function(e){this.guestHasAgreedToChatPolicy=e,this.setDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availability",{get:function(){return this.queueAvailability},set:function(e){this.queueAvailability=e,this.setDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOnline",{ty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOTR",{get:function(){return!!this.otrFingerprint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isQueueChat",{=0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSecure",{get:function(){return this.isOTR&&this.isOnline&&this.transcript.didOperatorAnswer(this.guestJid)?this.channel&&this.channel.secure:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"notification",{get:function(){return this.currentNotification},set:function(e){this.currentNotification=e,this.setDirty()},enumerable:!0,configurable:!0}),e.prototype.handleComposing=function(){this.notification=this.operatorIdentity+" "+l.default("is typing")},e.prototype.handleMessage=function(e){var t,n=e.body;if(n&&this.channel)try{n=(t=o.decode_channel(this.channel,n)).recv?t.recv[0]:null}catch(e){n=null}if(n&&!this.transcript.containsFile(e.url)){var r=e.url&&-1!==Object.keys(this.sentFiles).indexOf(e.url)?this.guestJid:this.queueJid;if(this.addIncoming(r,n,e.url),this.showDesktopNotifications){var i=new Notification(this.operatorIdentity,{body:n,icon:"https://s3.amazonaws.com/libraryh3lp.com/us/buttons/ask-a-librarian/chat-bubble-white-grey-background.png"});i.oncl()}}}return t},e.prototype.encode=function(e,t){if(!this.channel)return[e];try{var n=o.encode_channel(this.channel,e,t);if(n.send)return n.send}catch(e){return null}},e.prototype.handlePaull},e.prototype.handlePreseow},e.prototype.playBeep=function(){if(this.playSounds){var e=document.getElementById("widget-beep"),t=e&&e.play();void 0!==t&&t.then((function(e){})).cat){}))}},e.prototype.toggleDesktopNotifications=function(){var e=this;this.showDesktopNotifications?(this.showDesktopNotifications=!1,this.setDirty()):c.desktopNotificationPermissionGranted()?(this.showDesktopNotifications=!0,this.setDirty()):c.askDesktopNotificationPermission((function(t){e.showDesktopNotifications="granted"===t,e.setDirty()}))},e.prototype.toggleSou()},e.prototype.addIncoming=function(e,t,n){var r=this,i=this.handleRouterMessage(t);this.addMessage(e,i,n).then((function(){return r.playBeep()}))},e.prototype.addOutgoing=function(e){this.addMessage(this.guestJid,e);var t=JSON.stringify(["popout:guestMessage",e]);window.opener&&window.opener.postMessage(t,location.origin),this.popOut&&this.popOut.postMessage(t,location.origin)},e.prototype.addMessage=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o,a,s,c,l=this;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),o=this.sentFiles[n],[4,this.transcript.addMessage(e,t,n,o)];case 1:return r=i.sent(),u.bareEq(e,this.guestJid)||(this.currentNotification=void 0),this.saveToLocalStorage(),this.setDirty(),r&&n&&(this.isOTR?o?this.createThumbnail(r,o):((a=new XMLHttpRequest).open("GET",n),a.responseType="blob",a.onload=function(){l.decryptFile(a.response).then((function(e){var t=l.sentFiles[n];r.objectURL=t||URL.createObjectURL(e),l.saveToLocalStorage(),l.setDirty(),l.createThumbnail(r,r.objectURL)})).cate)}))},a.send()):("width=200&height=200",s=n,n.indexOf("?")>=0?s+="&width=200&height=200":s+="?width=200&height=200",this.createThumbnail(r,s))),[3,3];case 2:return c=i.sent(),console.log("Failed to add message to transcript",c),[3,3];case 3:return[2,r]}}))}))},e.prototype.addPopout=function(e,t,n){var r=this;this.popOut&&this.popOut.close();var i=open(e,t,n);i&&(this.isOTR||i.addEventListener("load",(function(){var e=r.transcript.messages.slice(Math.max(0,r.transcript.messages.length-100)),t=r.channel?r.channel.save():null,n=JSON.stringify(["popout:settings",{guest:r.guestJid,messages:e,channel:t}]);i.postMessage(n,location.origin),r.saveToLocalStorage()}),!1),this.popOut=i)},e.prototype.clearHist()},e.prototype.emailTranscript=function(e){var t=encodeURIComponent(this.queueJid.replace(/@chat.*/,"")),n=encodeURIComponent(this.guestJid),r=new XMLHttpRequest;r.open("POST","/api/guest/"+t+"/"+n+"/_email_transcript"),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.setRequestHeader("X-Api-Version","2017-01-20"),r.setRequestHeader("X-Timezone-Offset",""+-60*(new Date).getTimezoneOffset()),r.send("email="+encodeURIComponent(e))},e.prototype.transcriptAsDataUrl=function(){var t=this,n=this.transcript.messages.map((function(n){var r=u.bareEq(n.sender,t.guestJid),i=r?l.default("me"):t.operatorIdentity||u.jidNode(n.sender);return'<div><span style="color:'+(r?"#0000FF":"#AD0000")+';">'+e.formatTimestamp(n.timestamp)+" "+i+"</span> <span>"+a.default.replaceSpecial(n.body)+"</span></div>"}));return"data:text/plain;charset=utf-8,"+encodeURIComponent("<!DOCTYPE html><html><body>"+n.join("")+"</body></html>")},e.prototype.handleSendFile=function(e){this.transcript.containsFile(e.url)||this.addIncoming(this.queueJid,e.url,e.url)},e.prototype.encryptFile=function(e,t,n){var r=this;if(this.isOTR)if(this.channel.otr){if(!this.sending_key){var i=o.new_sending_key(this.channel);this.sending_key=i.key,t(i.send[0])}var a=new FileReader;a.onload=function(t){for(var i=new Uint8Array(a.result),s=[],c=0;c!=i.length;++c)s.push(String.fromCharCode(i[c]));var u=s.join(""),l=o.encrypt_aes(u,r.sending_key),d=[];for(c=0;c!=l.length;++c){var f=l.charCodeAt(c);if(isNaN(f))return void n(null);d.push(f)}var p=new File([Uint8Array.from(d)],e.name,{type:e.type}),h=URL.createObjectURL(e);r.sendFile(p,h).then((function(e){n(e)})).catch((function(){return n(null)}))},a.readAsArrayBuffer(e)}else n(null);else this.sendFile(e).then((function(e){n(e)})).catl)}))},e.prototype.decryptFile=function(e){var t=this;return new Promise((function(n,r){var i=t.channel.receiving_key;if(i){var a=new FileReader;a.onload=function(t){for(var s=new Uint8Array(a.result),c=[],u=0;u!=s.length;++u)c.push(String.fromCharCode(s[u]));var l=c.join(""),d=o.decrypt_aes(l,i),f=[];for(u=0;u!=d.length;++u){var p=d.charCodeAt(u);if(isNaN(p))return void r("Could not decrypt file.");f.push(p)}n(new Blob([Uint8Array.from(f)],{type:e.type}))},a.readAsArrayBuffer(e)}else r("Did not receive key data from operator")}))},e.prototype.createThumbnail=function(e,t){var n=this,r=new Image;r.onerror=function(){},r.onl()},r.src=t},e.prototype.sendFile=function(e,t){var n=this;return void 0===t&&(t=null),new Promise((function(r,i){var o=encodeURIComponent(n.guestJid),a=e.name?e.name.split(".").reverse()[0]:"png",s=o+"_"+Date.now()+"."+a,c=new FormData;c.append("file",e,s);var u=new XMLHttpRequest;u.open("POST",n.sendFileAction()),u.onload=function(){if(4===u.readyState&&201===u.status){var o=JSON.parse(u.responseText),a=o.url;n.sentFiles[a]=t;var s="image"===e.type.split("/")[0]?t:null;n.transcript.updateFile({sender:n.guestJid,objectURL:t,preview:s,url:o.url}),n.saveToLocalStorage(),n.setDirty(),r(a)}else i(null)},u.send(c)}))},e.prototype.sendFileAction=function(){return"/api/guest/"+encodeURIComponent(this.queueJid.replace(/@chat.*/,""))+"/"+encodeURIComponent(this.guestJid)+"/_send_file"},e.prototype.sendOfflineMessage=function(e,t){var n=new XMLHttpRequest,r=encodeURIComponent(this.queueJid.replace(/@chat.*/,"")),i=encodeURIComponent(this.guestJid);n.open("POST","/api/guest/"+r+"/"+i+"/_send_email"),n.onload=function(){4===n.readyState&&t&&t(204===n.status)},n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("X-Api-Version","2017-01-20");var o=encodeURIComponent(e.email),a=encodeURIComponent(e.message),s=encodeURIComponent(e.name);n.send("jid="+this.guestJid+"&email="+o+"&message="+a+"&name="+s)},e.prototype.saveToLocalStorage=function(){try{var e=this.transcript.messages.slice(Math.max(0,this.transcript.messages.length-100)),t=this.channel?this.channel.save():null;localStorage&&(localStorage[this.queueJid]=JSON.stringify({agreedToChatPolicy:this.agreedToChatPolicy,guest:this.guestJid,messages:e,channel:t}))}catch(e){}},e.prototype.transcriptRollback=function(t){var n=this;return this.transcript.messages.filty)})).map((function(e){var r=new Date(e.timestamp).toISOString(),i=e.sender===n.guestJid,o=i?t.syntheticJid:n.queueJid,a=i?n.queueJid:t.syntheticJid;return"\n<result xmlns='urn:xmpp:mam:2' queryid='"+t.queryid+"'>\n<forwarded xmlns='urn:xmpp:forward:0'>\n<delay xmlns='urn:xmpp:delay' stamp='"+r+"'/>\n<message xmlns='jabber:client' from='"+o+"' to='"+a+"' type='chat'>\n<body>"+e.body+"</body>\n</message>\n</forwarded>\n</result>\n"}))},e.formatTimestamp=function(e){var t=new Date(e),n="0"+t.getHours(),r="0"+t.getMinutes();return(n=n.substring(n.length-2))+":"+(r=r.substring(r.length-2))},e.isRouterMessage=function(e){return e===l.default("message not received")||e===l.default("transferring... please wait")||e===l.default("download from")+e.substring(13,e.length)},e.prototype.handleRouterMessage=function(e){var t=new RegExp("^download from "+location.origin+"/go/[A-Za-z0-9]+\\?t\\=[A-Za-z0-9]+$");return"message not received"===e?(this.isOTR&&(this.channel=null,this.start((function(){}))),l.default(e)):"transferring... please wait"===e?(this.isOTR&&this.channel&&(this.channel.receiving_key=null,this.sending_key=null),l.default(e)):null!==t.exec(e)?l.default("download from")+e.substring(13,e.length):e},e.prototype.readFromLocalStorage=function(){try{var e=JSON.parse(localStorage[this.queueJid],(function(e,t){return t&&t.sender&&t.body?a.default.fromJSON(t):t}));if(!u.bareEq(e.guest,this.guestJid))return void localStorage.clear();"agreedToChatPolicy"in e&&(this.agreedToChatPolicy=e.agreedToChatPolicy),this.transcript.messages=e.messages,this.channel_cookie=e.channel}catch(e){}},e.prototype.parseAvailability=function(){var e=document.getElementById("presence").src.split("/");this.queueAvailability=e[6]},e.prototype.onMessage=function(e){if(e&&e.origin===location.origin&&e.data)try{var t=JSON.parse(e.data);"popout:guestMessage"===t[0]&&this.addMessage(this.guestJid,t[1]),"popout:settings"===t[0]&&(this.channel_cookie=t[1].channel,this.guestJid=t[1].guest,this.transcript.messages=t[1].messages.map(a.default.fromJSON),this.setDirty())}catch(e){}},e}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=functio[]}return e.prototype.addMessage=function(e,t,n,i){var o=this;return new Promise((function(a,s){r.default.makeMessage(e,t,n,void 0,(function(e){e&&(i&&(e.objectURL=i),o.messages.push(e)),a(e)}))}))},e.prototype.clear=function(){this.messages.forEaL)})),this.messages.length=0},e.prototype.containsFile=function(e){return!!e&&this.messages.so=e}))},e.prototype.updateFile=function(e){this.messages.forEach((function(t){t.url===e.url&&(e.objectURL&&(t.objectURL&&URL.revokeObjectURL(t.objectURL),t.objectURL=e.objectURL),t.preview=e.preview,t.sender=e.sender)}))},e.prototype.didOperatorAnswer=function(e){var t=!1;return this.messages.forEa0)})),t},e.prototype.hasOTRErrorLoop=function(){for(var e=0,t=null,n=null,r=this.messages.length-1;r>-1;r--)if((n=this.messages[r]).isOTRErrorMessage())if(n.timeDifference(t)<1001){if(6===++e)return!0}else e=1,t=n;else e=0,t=null;return!1},e}();t.default=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(19),a=n(21),s=n(23),c=n(9),u=n(2),l=n(1),d=n(0),f=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.chat=t,i.setDirty=r,i.offlineFormSubmitted=!1,i.remainOffline=null,i}return i(t,e),t.prototype.showEmojiPicker=function(){var e=this;this.modalDialog=new s.defaut)}),(function(){return e.closeDialog()})),this.setDirty()},t.prototype.showChatPolicy=function(){var e=this;this.modalDialog=new o.default(this.chatPolicyAgreement,this.chatPolicy,this.chat.agreedToChatPoli=t}),(function(){return e.closeDialog()})),this.setDirty()},t.prototype.getOfflineOptions=function(){var e=null;if(this.offline)switch(this.remainOffline||this.chat.availability){case"away":case"xa":e=this.offline.away||this.offline.offline;break;case"dnd":e=this.offline.busy||this.offline.offline;break;case"unavailable":e=this.offline.offline}return e},t.prototype.renderOfflineForm=function(){var e=this,t=this.getOfflineOptions();if(!t||!t.form)return null;var n=new a.default(t.form,{className:"guest-form"},this.offlineFormSubmitted);return d.default("div.offline",{},[d.default("p.guest-form-title",{style:{display:t.form.title?"block":"none"}},t.form.title),n.render((function(t){e.chat.sendOfflineMessage))}))()}))])},t.prototype.renderOfflineMessage=function(){var e=this.getOfflineOptions();return e&&e.message&&!this.offlineFormSubmitted?d.default("div#offline-message.offline",{props:{innerHTML:e.message},style:{flex:e.form?"0 0 auto":"1 1 auto"}},[]):null},t.prototype.generateWidgetComponents=function(){this.composing.isActive&&this.chatPolicyAgreement&&!this.chat.agreedToChatPolicy&&!this.modalDialog&&this.showChatPolicy();var e=this.renderChat(!!this.modalDialog),t=this.renderOfflineForm(),n=this.renderOfflineMessage(),r=[];return this.remainOffline||!this.chat.isOnline&&(t||n)?(n&&r.push(n),t&&(r.push(t),this.remainOffline=this.chat.availability)):(r.push(e),r.push(this.renderModal())),r},t.prototype.renderHeader=function(){var e=this;return d.default("div#header",[d.default("div",{style:{display:"flex"}},[d.default("img#presence",{props:{alt:l.default("Chat is "+this.chat.availability+"."),src:["/presence/image",this.presenceTheme,this.chat.availability].join("/")}}),d.default("h1#title",{props:{innerHTML:this.widgetTitle}})]),this.renderButton({id:"popout",icon:"link-ext",onClick:function(t){t.preventDefault(),e.popout()},show:!this.isPopout,title:"Opens chat in new window."})])},t.prototype.renderTranscript=function(){var e=this.renderMessages();return d.default("div#recv",{attrs:{"aria-label":l.default("chat history"),"aria-live":"polite",role:"main"},hook:{postpatch:function(e,t){t.elm.scrollTop=t.elm.scrollHeight}},props:{dir:this.textDirection}},e)},t.prototype.renderButtons=function(){var e=this;return d.default("div#buttons",{attrs:{role:"toolbar"}},[d.default("div",{},[d.default("a#sounds",{attrs:{"aria-pressed":this.chat.playSounds?"true":"false",role:"button"},on:{click:function(t){t.preventDefault(),e.chat.toggleSounds(),e.setDirty()}},props:{className:this.chat.playSounds?"icon-bell-alt":"icon-bell-off",href:"#",title:l.default("Plays alert noise when operator sends new message.")}}),d.default("a#desktop-notifications",{attrs:{"aria-pressed":this.chat.showDesktopNotifications?"true":"false",role:"button"},on:{cl()}},props:{className:this.chat.showDesktopNotifications?"icon-eye":"icon-eye-off",href:"#",title:l.default("Shows alert when operator sends new message.")},style:{display:u.canShowDesktopNotifications()?"inline-block":"none"}}),d.default("a#emoji.icon-smile",{attrs:{"aria-pressed":!!this.modalDialog,role:"button"},on:{click:function(t){t.preventDefault(),e.showEmojiPicker()}},props:{href:"#",title:l.default("Insert an emoji.")},style:{display:this.composing.isActive?"inline-block":"none"}}),d.default("a#clear-chat-history.icon-trash",{attrs:{role:"button"},on:{click:function(){return e.clearHistory()}},props:{href:"#",title:l.default("Clear Chat History")}})]),d.default("div",{},[this.renderButton({id:"chat-policy",icon:"help-circled",onClick:function(t){t.preventDefault(),e.showChatPolicy()},show:!!this.chatPolicy,title:"View chat policy."}),this.renderButton({id:"file",icon:"attach",onClick:function(t){return e.onSendFile(t)},show:!this.disableSendFile&&this.composing.guestSentMessage&&this.chat.isQueueChat,title:"Sends a file to the operator."}),this.renderButton({download:"chat.html",href:this.chat.transcriptAsDataUrl(),id:"download",icon:"download",show:this.chat.isOTR&&!u.isInternetExplorer(),title:"Download transcript as a file"}),this.renderButton({id:"mail",icon:"mail-alt",onClick:function(t){return e.emailTranscript(t)},show:this.composing.guestSentMessage&&this.chat.isQueueChat&&!this.chat.isOTR,title:"Sends chat history in an email."})])])},t.prototype.renderButton=function(e){return d.default("a",{attrs:{"aria-hidden":!e.show,role:"button"},on:{click:e.onClick},props:{className:"icon-"+e.icon,download:e.download,href:e.href||"#",id:e.id,title:l.default(e.title)},style:{display:e.show?"inline-block":"none"}})},t}(c.default);t.default=f},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(3),s=n(4),c=n(1),u=c.default("View chat policy.").replace(".",""),l=function(e){function t(t,n,r,i,s){var c=e.call(this,o.default("span","View chat policy"===u?"Chat Policy":u),o.default("div#chat-policy",{on:{click:a.default.openLinksInNewTab},props:{innerHTML:n}}),s)||this;return c.policyAgreement=t,c.policy=n,c.hasGuestAgreed=r,c.onAgree=i,c.onClose=s,c.agreed=r,c}return i(t,e),t.prototype.renderCheckbox=function(){var e=this,t=null;return this.policyAgreement&&(t=o.default("div",{style:{"flex-flow":"row wrap","padding-bottom":"15px"}},[o.default("input",{on:{change:function(t){t.preventDefault(),e.agreed=!e.agreed,e.onAgree(e.agreed)}},props:{checked:this.agreed,id:"chat-policy-agreement",name:"chat-policy-agreement",type:"checkbox"}}),o.default("span",{props:{innerHTML:"&nbsp;"}}),o.default("label",{props:{for:"chat-policy-agreement"}},this.policyAgreement)])),t},t.prototype.renderButtons=function(){var e=this,t=!!this.policyAgreement,n=[o.default("button",{attrs:{disabled:t&&!this.agreed,type:"button"},on:{click:function(n){n.preventDefault(),t&&!e.agreed||(e.returnFocus(),e.onClose())}}},c.default("OK"))],r=this.renderCheckbox();return r&&n.unshift(r),[o.default("div",{},n)]},t}(s.default);t.defaulte}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=n(0),s=n(1),c=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.formOptions=t,i.formProps=n,i}return i(t,e),t.prototype.renderFields=function(){var t=e.prototype.renderFields.call(this);return t.push(a.default("div.form-group",{},[a.default("label",{attrs:{for:"guest-name"}},s.default("Name")),a.default("input#guest-name",{props:{name:"guest-name",type:"text"}})])),t.push(a.default("div.form-group",{},[a.default("label",{attrs:{for:"guest-reply"}},s.default("Email")+" ("+s.default("required")+")"),a.default("input#guest-reply",{attrs:{"aria-required":"true"},props:{name:"guest-reply",required:"true",type:"email"}})])),t.push(a.default("div.form-group.message-area",{},[a.default("label",{attrs:{for:"guest-message"}},s.default("Message")+" ("+s.default("required")+")"),a.default("textarea#guest-message",{attrs:{"aria-required":"true"},props:{name:"guest-message",required:"true",rows:"1"}})])),t.push(a.default("input",{props:{type:"submit",value:s.default("Send")}})),t},t.prototype.render=function(e,t){return this._render((function(t){var n=t.querySelector("[name='guest-reply']"),r=t.querySelector("[name='guest-message']"),i=t.querySelector("[name='guest-name']");e({email:n.value,message:r.value,name:i.value})}),t)},t}(o.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(1),o=functio=n}return e.prototype.renderResponse=function(e){return r.default("div.guest-form",{props:this.formProps},[r.default("div.guest-form-submitted",{props:{innerHTML:this.formOptions.response}}),r.default("button",{attrs:{"data-text":i.default("OK")},on:{cl()}}},i.default("OK"))])},e.prototype.renderFields=function(){return[r.default("input",{props:{name:"hp-email",type:"hidden"}})]},e.prototype.renderForm=function(e){var t=this.renderFields();return r.default("form.guest-form",{on:{submit:function(t){t.preventDefault();var n=t.target,r=n.querySelector("input[name='hp-email']");r&&r.value||(n.removeChild(r),e(n))}},props:this.formProps},t)},e.prototype._render=function(e,t){return this.submitted?this.renderResponse(t):this.renderForm(e)},e}();t.default=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(4),s=n(1),c=n(6),u=function(e){function t(t,n){var r=e.call(this,o.default("span",{},s.default("Insert an emoji.").replace(".","")),null,n)||this;return r.onEmoji=t,r}return i(t,e),t.prototype.generateEmoji=function(){for(var e=this,t=[],n=function(n){var r=c.uniqueEmoji[n][0],i=s.default(c.uniqueEmoji[n][1]);t.push(o.default("button",{attrs:{"aria-label":i,role:"menuitem",type:"button"},props:{title:i},on:{click:function(){var t=document.getElementById("msg");t&&(e.returnFocusElement=t),e.onEmoji(r)}}},o.default("span",r)))},r=0;r<c.uniqueEmoji.length;++r)n(r);return t},t.prototype.renderBody=function(){var e=this.generateEmoji();return o.default("div#emoji-picker",{},[o.default("div#emoji-picker-label",{attrs:{"aria-hidden":!0}},s.default("emoji")),o.default("div",{attrs:{"aria-labelledby":"emoji-picker-label",role:"menu"}},e)])},t}(a.default);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(25),o=functio!1}return Object.defineProperty(e.prototype,"connected",{ng},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this.composing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"guestSentMessage",{get:function(){return this.sentMessage},enumerable:!0,configurable:!0}),e.prototype.handleFocus=function(e){this.isActive||(this.connection.start(),this.isActive=!0,this.composing="",this.chat.setDirty())},e.prototype.appendInput=function(e){this.connected&&(this.composing+=" "+e),this.chat.setDirty()},e.prototype.handleInput=function(e){this.connected&&(this.composing=e.target.value),this.chat.setDirty()},e.prototype.handleKeydown=function(e){e.altKey||e.ctrlKey||e.metaKey||27===e.keyCode||(this.isActive||(this.connection.start(),this.isActive=!0,this.chat.setDirty()),this.connected?10===e.keyCode||13===e.keyCode?(e.preventDefault(),this.send()):this.typing():e.preventDefault())},e.prototype.send=function(){if(!r.isInternetExplorer()||!this.chat.isOTR){this.pausedTimer&&(window.clearTimeout(this.pausedTimer),this.pausedTimer=null);var e=this.composing;this.composing="",e&&"​"===e.charAt(0)&&(e=e.substring(1)),(e=i.sanitize(e))&&(this.connection.sendMessage(e),this.chat.addOutgoing(e),this.sentMessage=!0),this.chat.setDirty()}},e.prototype.typing=function(){var e=this;if(this.lastKeyEvent=Date.now(),!this.pausedTimer){this.connection.sendComposing();var t=function(){Date.now()>=e.lastKeyEvent+5e3?(e.connection.sendPaused(),e.pausedTimer=null):e.pausedTimer=window.setTimeout(t,1e3)};this.pausedTimer=window.setTimeout(t,1e3)}},e}();t.default=o},function(e,t,n){var r=n(26),i=n(27);if("i"!=="I".toLowerCase())throw"I/i problem";var o=function(e){var t,n;"undefined"!=typeof window&&(t=window.parseCssDeclarations,n=window.sanitizeCssProperty,window.cssSchema);var r={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:" "},o=/^#(\d+)$/,a=/^#x([0-9A-Fa-f]+)$/,s=/^[A-Za-z][A-za-z0-9]+$/,c="undefined"!=typeof window&&window.document?window.document.createElement("textarea""}(t)}var l=/\0/g;var d=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,f=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|,u):e}var h=/&/g,g=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,m=/[<]/g,y=/>/g,v"):e}var _=new RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?","i"),F=3==="a,b".split(/(,)/).length,C=e.eflags.CDATA|e.eflags.t,n)}}vath}va1,i}}function M(e){var t=e.charCodeAt(0);return 34!==t&&39!==t||(e=e.substr(1,e.length-2)),p(e.replace(")}})}var j=/^(?:https?|mail 0)}function U(t,n){return I(e.LOADERTYPE,t,n)}function B(r,i,o,a,s){for(var c=0;c<i.length;c+=2){var u,l=i[c],d=i[c+1],f=d,p=null;if(u=r+"::"+l,(e.ATTRIBS.hasOwnProperty(u)||(u="*::"+l,e.ATTRIBS.hasOwnProperty(u)))&&(p=e.ATTRIBS[u]),null!==p)switch(p){case e.atype.NONE:break;case e.atype.SCRIPT:d=null,s&&L(s,r,l,f,d);break;case e.atype.STYLE:if(void 0===t){d=null,s&&L(s,r,l,f,d);break}var h=[];t(d,{decla" "))}}),d=h.length>0?h.join(" ; "):null,s&&L(s,r,l,f,d);break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:d=a?a(d):d,s&&L(s,r,l,f,d);break;case e.atype.URI:d=N(d,q(r,l),U(r,l),{TYPE:"MARKUP",XML_ATTR:l,XML_TAG:r},o),s&&L(s,r,l,f,d);break;case e.atype.URI_FRAGMENT:d&&"#"===d.charAt(0)?(d=d.substring(1),null!=(d=a?a(d):d)&&(d="#"+d)):d=null,s&&L(s,r,l,f,d);break;default:d=null,s&&L(s,r,l,f,d)}else d=null,s&&L(s,r,l,f,d);i[c+1]=d}re("")}var J={};return J.escapeAttrib=J.escapeAttrib=b,J.makeHtmlSanitizer=J.makeHtmlSanitizer=R,J.makeSaxParser=J.makeSaxParser=T,J.makeTagPolicy=J.makeTagPolicy=H,J.normalizeRCData=J.normalizeRCData=w,J.sanitize=J.san,r))},J.sanitizeAttribs=J.sanitizeAttribs=B,J.sanitizeWithPolicy=J.sanitizeWithPolicy=z,J.unescapeEntities=J.unescapeEntities=p,J}(r),a=o.sanitize;"undefined"!=typeof window&&(window.html=o,window.html_sanitize=a);var s={};s.escapeAttrib=o.escapeAttrib,s.makeHtmlSanitizer=o.makeHtmlSanitizer,s.makeSaxParser=o.makeSaxParser,s.makeTagPolicy=o.makeTagPolicy,s.normalizeRCData=o.normalizeRCData,s.sanitizeAttribs=o.sanitizeAttribs,s.sanitizeWithPolicy=o.sanitizeWithPolicy,s.unescapeEntities=o.unescapeEntities,s.escape=o.escapeAttrib,s.sanitize=function(e,t,n,r){return"string"==typeof e&&(e=e.replace(/<([a-zA-Z]+)([^>]*)\/>/g,"<$1$2></$1>")),e?o.sanitize(e,t,n,r):e},e.exports&&(t=e.exports=s),t.Sanitizer=s},function(e,t,n){var r={atype:{NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},ATTRIBS:{"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},eflags:{OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},ELEMENTS:{a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,var:0},URIEFFECTS:{},LOADERTYPES:{}};e.exports&&(t=e.exports=r),t.URI=r},function(e,t,n){var r=funct)}var i=new RegExp("(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)"),o=new RegExp(i),a=/^(?:\.\.\/)*(?:\.ll}u.prototype.ton("")},u.prototypeent_)},u.prototype.getase()},u.prototype.getRawScheme=function(){return this.scheme_},u.prototype.setScheme=function(e){return this.scheme_=n(e,f),this},u.prototype.setRawScheme=function(e){return this.scheme_=e||null,this},u.prototype.hasScheme=function(){return null!==this.scheme_},u.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},u.prototype.getRawCredentials=function(){return this.credentials_},u.prototype.setCrede,this},u.prototype.setRawCredentials=function(e){return this.credentials_=e||null,this},u.prototype.hasCredentials=function(){return null!==this.credentials_},u.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},u.prototype.getRawDomain=function(){return this.domain_},u.prototype.sett(e))},u.prototype.setRawath_)},u.prototype.hasDomain=function(){return null!==this.domain_},u.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},u.prototype.s this},u.prototype.hasPort=function(){return null!==this.port_},u.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},u.prototype.getRawPath=function(){return this.path_},u.prototype.se,p))},u.prototype.setR,this},u.prototype.hasPath=function(){return null!==this.path_},u.prototype.ge," ")},u.prototype.getRawQuery=function(){return this.query_},u.prototype.se,this},u.prototype.setRa,this},u.prototype.hasQuery=function(){return null!==this.query_},u.prototype.setAllParameters=function(e){if("object"==typeof e&&!(e instanceof Array)&&(e instanceof Object||"[object Array]"!==Object.prototype.toString.call(e))){var t=[],n=-1;for(var r in e){"string"==typeof(s=e[r])&&(t[++n]=r,t[++n]=s)}e=t}this.paramCache_=null;for(var i=[],o="",a=0;a<e.length;){r=e[a++];var s=e[a++];i.push(o,encodeURIComponent(r.toString())),o="&",s&&i.push("=",encodeURIComponent(s.toString()))}return this.query_=i.join(""),this},u.prototype.checkParameter_=[]}},u.prototype.setParameter,this},u.prototype.removePare,[])},u.prototype.getAllParangth)},u.prototype.getParameterurn t},u.prototype.getParameurn t},u.prototype.getParamete null},u.prototype.getFrent_)},u.prototype.getRawFragment=function(){return this.fragment_},u.prototype.setFr,this},u.prototype.setRawFr,this},u.prototype.hasFrment_};var d=new RegExp("^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),f=/[#\/\?@]/g,p=/[\#\?]/g;return u.parse=e,u.c)),d},u.resolve=c,u.collapse_dots=s,u.utils={mimeript"},r:""+n}},u}();e.exports&&(t=e.exports=r),t.URI=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(e,t){this.chat=e,this.setDirty=t,this.retries=0,this.lastPong=Date.now(),this.outgoing=[],this.chat.transcript.messages.length>0&&this.start(),this.cobrowseEnded=!1,this.transcriptRequest=null}return Object.defineProperty(e.prototype,"invitege:"ty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screensharingEnded",{get:function(){return this.cobrowseEnded},set:function(e){this.cobrowseEnded=e,this.setDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transcriptRequested",{get:function(){return!!this.transcriptRequest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startedocket},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connected.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectingected},enumerable:!0,configurable:!0}),e.prototype()}))},e.prototype.shutdown=function(){if(this.connected)try{this.socket.send(JSON.stringify(["chat:gone"]))}catch(e){}this.stopReconnects(),this.disconnect()},e.prototype.withCobrowse=function(e){var t=this;this.cobrowse?e(this.cobrowse):Promise.all([n.e(1),n.e(2)]).then(function(r){var i=n(12).default;t.cobrowse=new i(t),e(t.cobrowse)}.bind(null,n)).catch(n.oe)},e.prototype.acceptInvite=function(){var e=this;this.withCobte=""}))},e.prototype.declineInvite=function(){this.send(["cobrowse:reject"]),this.invite=""},e.prototype.sendComposing=function(){this.send(["chat:composing"])},e.prototype.sendEncrypted=function(e,t){var n=this.chat.encode(e,t);if(n&&!this.chat.transcript.hasOTRErrorLoop())for(var r=0;r<n.length;++r)this.send(["chat:message",{body:n[r]}])},e.prototype.sendMessage=function(e){this.connected?this.sendEncrypted(e,null):(this.outgoing.push(e),this.socket||this.reconnect())},e.prototype.forwardEncrypted=function(e,t){var n=this.chat.encode(null,t.body);if(n)for(var r=0;r<n.length;++r)this.send(["chat:forward",{id:e,message:{body:n[r]},sender:t.sender,timestamp:t.timestamp,recipient:t.recipient}])},e.prototype.forwardM(e,t)},e.prototype.sended"])},e.prototype.onClose=function(e){var t=this;this.disconnect(),this.chat.saveToLocalStorage(),1e3!==e.code&&setTimeout((function(){return t.reconnect()}),0)},e.prototype.oect()},e.prototype.stopReconnects=function(){this.reconnectTimer&&(window.clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0),this.retries=0},e.prototype.reconnect=function(){var e=this;if(this.connected)this.stopReconnects();else try{this.connect()}catch(t){if(this.disconnect(),++this.retries,this.retries>=25)return void this.stopReconnects();this.reconnectTimer=window.setTimeout((function(){return e.reconnect()}),this.nextReconnect())}},e.prototype.nextReconnect=function(){var e=1e3*Math.pow(2,Math.min(5,this.retries))/2;return e+Math.random()*e},e.prototype.connect=function(){this.disconnect(),this.socket=new WebSocket("wss://"+location.host+"/widget/ws"),this.addListeners()},e.prototype.disconnect=function(){if(this.socket){this.stopPings(),this.removeListeners();try{this.socket.close()}catch(e){}this.socket=void 0}},e.prototype.addListeners=function(){var e=this;this.socket&&(this.socket.onclose=function(t){return e.onClose(t)},this.socket.onerror=function(t){return e.onError(t)},this.socket.onmessage=function(t){return e.onMessage(t)},this.socket.onopen=function(){return e.onOpen()})},e.prototype.removeListeners=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.onopen=null)},e.prototype.startPings=function(){var e=this;this.pingTimer||(this.lastPong=Date.now(),this.pingTimer=window.setInterval((function(){Date.now()>=e.lastPong+57e3?(e.disconnect(),e.reconnect()):e.send(["chat:ping"])}),19e3))},e.prototype.stoid 0)},e.prototype.handleInvite=function(e){var t=null!=e.message;t&&!r.canShareScreen()?this.send(["cobrowse:error",{error:"screensharing not supported"}]):t&&(this.cobrowseInvite=e,this.setDirty())},e.prototype.handnow()},e.prototype.send=function(e){if(this.connected)try{this.socket.send(JSON.stringify(e))}catch(e){this.disconnect(),this.reconnect()}},e.prototype.onOpen=function(){var e=this;try{"vCard"in window||(window.vCard={}),r.canShareScreen()&&(window.vCard["X-CAN-SHARE-SCREEN"]=!0),window.vCard["X-USER-AGENT"]=navigator.userAgent,this.socket.send(JSON.stringify(["chat:register",{guest:this.chat.guestJid,queue:this.chat.queueJid,vCard:window.vCard}]));var t=this.outgoing.slice();setTimeout((function(){t.fonull)}))}),250),this.outgoing.length=0,this.stopReconnects(),this.startPings()}catch(e){this.disconnect(),this.reconnect()}},e.prototype.onMessage=function(e){var t=JSON.parse(e.data);switch(t[0]){case"chat:composing":return this.chat.handleComposing();case"chat:filereceipt":return;case"chat:message":return this.handleMessage(t[1]);case"chat:paused":return this.chat.handlePaused();case"chat:pong":return this.handlePong();case"chat:presence":return this.chat.handlePresence(t[1]);case"chat:sendfile":return this.handleSendFile(t[1]);case"chat:transcript":return this.handleTranscriptRequest(t[1]);case"cobrowse:answer":return this.handleAnswer(t[1]);case"cobrowse:about":return this.handleAbout();case"cobrowse:candidate":return this.handleCandidate(t[1]);case"cobrowse:invite":return this.handleInvite(t[1]);case"cobrowse:shutdown":return this.handleShutdown()}},e.prototype.handleAnswer=function(e){this.withCobrowse((function(t){return t.handleAnswer(e)}))},e.prototype.handl()}))},e.prototype.handleCane)}))},e.prototype.handleShutdown=function(){var e=this;this.withCobown()}))},e.prototype.handleMessage=function(e){var t=this,n=this.chat.handleMessage(e);n&&n.send&&!this.chat.transcript.hasOTRErrorLoop()&&n.send.forEach((function(e){t.socket.send(JSON.stringify(["chat:message",{body:e}]))}))},e.prototype.handleSendFile=function(e){this.chat.handleSendFile(e),this.send(["chat:filereceipt",{id:e.id}])},e.prototype.handleTranscriptRrty()},e.prototype.respondToTranscriptRequest=function(e){var t=this;this.send(["chat:transcript",{agree:e,id:this.transcriptRequest.id}]),e&&this.chat.transcriptRollback(this.transcriptRequest).foll,e)})),this.transcriptRequest=null,this.setDirty()},e}();t.default=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),s=n(0),c=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.header=t,o.message=n,o.onOk=r,o.onCancel=i,o}return i(t,e),t.prototype.renderBody=function(){return this.message},t.prototype.renderButtons=function(){var e=this,t=[s.default("button",{attrs:{type:"button"},on:{click:function(t){t.preventDefault(),e.returnFocus(),e.onCancel()}}},a.default("Cancel")),s.default("button",{attrs:{type:"button"},on:{click:function(t){t.preventDefault(),e.returnFocus(),e.onOk()}}},a.default("OK"))];return[s.default("div",{},t)]},t.prototype.renderHeader=function(){return this.header},t.prototype.render=function(){return this._render()},t}(o.default);t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),s=n(0),c=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.header=t,o.label=n,o.onOk=r,o.onCancel=i,o}return i(t,e),t.prototype.renderBody=function(){return s.default("form",{enctype:"multipart/form-data",method:"post",target:"filetarget"},[s.default("span",this.label),s.default("input",{props:{name:"file",type:"file"},style:{width:"100%"}})])},t.prototype.renderButtons=function(){var e=this,t=[s.default("button",{attrs:{type:"button"},on:{click:function(t){t.preventDefault(),e.returnFocus(),e.onCancel()}}},a.default("Cancel")),s.default("button",{attrs:{type:"button"},on:{click:function(t){t.preventDefault(),e.returnFocus();var n=document.querySelector("form input[type=file]");n||e.onCancel();var r=n.files[0];e.onOk(r)}}},a.default("OK"))];return[s.default("div",{},t)]},t.prototype.renderHeader=function(){return this.header},t.prototype.render=function(){return this._render()},t}(o.default);t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),s=n(0),c=functl=i,o}return i(t,e),t.prototype.renderBody=function(){return s.default("div.form-group",{},[s.default("label",{attrs:{for:"prompt-answer"}},this.message),s.default("span",{props:{innerHTML:"&nbsp;"}}),s.default("input#prompt-answer",{props:{name:"prompt-answer",type:"text"},style:{width:"100%"}})])},t.prototype.renderButtons=function(){var e=this,t=[s.default("button",{attrs:{type:"button"},on:{click:function(t){t.preventDefault(),e.returnFocus(),e.onCancel()}}},a.default("Cancel")),s.default("button",{attrs:{type:"button"},on:{click:function(t){t.preventDefault(),e.returnFocus();var n=document.querySelector("#prompt-answer").value;e.onOk(n)}}},a.default("OK"))];return[s.default("div",{},t)]},t.prototype.renderHeader=function(){return this.header},t.prototype.render=function(){return this._render()},t}(o.default);t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=n(33),s=n(1),c=n(0),u=a.default((function(e){var t=e.target,n=t.getElementsByTagName("button");if(n.length>0){var r=t.scrollTop>=n[0].offsetHeight,i=n[0].style.position,o=t.scrollTop<2*n[0].offsetHeight?"relative":"fixed";"fixed"===i&&"relative"===o&&r&&(o="fixed"),n[0].style.position=o}}),100,!1),l=functy=r,i}return i(t,e),t.prototype.render=function(){var e,t=this,n=this.renderTranscript(),r=c.default("div#layout",[n]);e=this.renderButtons();var i,o=c.default("div#status",{props:{innerHTML:"&nbsp;"}});return i=c.default("iframe",{props:{name:"filetarget",width:"0",height:"0"},style:{display:"none"}}),[c.default("div#chat-box",{attrs:{"aria-hidden":this.modalDialog?"true":"false"},on:{keydown:function(e){t.modalDialog&&"Escape"===e.key&&t.closeDialog()}}},[this.renderHeader(),r,e,this.renderTypey(),o,i,c.default("audio#widget-beep",[c.default("source",{props:{src:"/widget/snd/widget-beep.ogg",type:"audio/ogg"}}),c.default("source",{props:{src:"/widget/snd/widget-beep.mp3",type:"audio/mpeg"}})])]),this.renderModal()]},t.prototype.renderTranscript=function(){var e=this,t=null;this.chat.transcript.messages.length>0&&(t=c.default("div",[c.default("button#clear-chat-history",{on:{click:function(t){t.preventDefault(),e.clearHistory()}}},s.default("Clear Chat History"))]));var n=this.renderMessages();return n.unshift(t),c.default("div#recv",{attrs:{"aria-label":s.default("chat history"),"aria-live":"polite",role:"main"},hook:{poseight}},on:{,u(e)}},props:{dir:this.textDirection}},n)},t.prototype.renderButtons=function(){var e=this;return c.default("div#buttons",{attrs:{role:"toolbar"}},[c.default("a#sounds",{attrs:{"aria-pressed":this.chat.playSounds?"true":"false",role:"button"},on:rty()}},props:{href:"#",title:s.default("Plays alert noise when operator sends new message.")},style:{display:"inline-block"}},[c.default("span.sprite",{style:{backgroundPosition:this.chat.playSounds?"-10px 0":"0 0",width:this.chat.playSounds?"18px":"10px"}})]),c.default("span",{style:{float:"right"}},[this.renderButton({id:"file",onClick:function(t){return e.onSendFile(t)},show:!this.disableSendFile&&this.composing.guestSentMessage&&this.chat.isQueueChat,title:"Sends a file to the operator."}),this.renderButton({id:"mail",onClick:function(t){return e.emailTranscript(t)},show:this.composing.guestSentMessage&&this.chat.isQueueChat&&!this.chat.isOTR,title:"Sends chat history in an email."}),this.renderButton({id:"popout",oout()},show:!this.isPopout,title:"Opens chat in new window."})])])},t.prototype.renderButton=function(e){return c.default("a",{attrs:{"aria-hidden":!e.show,role:"button"},on:{click:e.onClick},props:{href:"#",id:e.id,title:s.default(e.title)},style:{display:e.show?"inline-block":"none"}},[c.default("span.sprite")])},t}(o.default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r,i,oll)))};return function(u){a=this,o=arguments,r=Date.now(),i||(i=setTimeout(c,t));var l=n&&!i;return l&&(s=e.apply(a,o),a=o=null),s}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(41),i=n(35),o=n(36),a=n(0),s=n(37),c=n(38),u=n(39),l=function(){function e(e){this.paint=e,this.patch=r.init([i.default,o.default,s.default,c.default]),this.isDirty=!1,this.oldVNode=u.default(document.body),this.render()}return e.prototype.setDirty=function(){var e=this;this.isDirty||(requestAnimationFrame((function(){return e.render()})),this.isDirty=!0)},e.prototype.render=function(){var e=a.default("body",this.paint());this.oldVNode=this.patch(this.oldVNode,e),this.isDirty=!1},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function r(e,t){var n,r=t.elm,i=e.data.attrs,o=t.data.attrs;if((i||o)&&i!==o){for(n in i=i||{},o=o||{}){var a=o[n];i[n]!==a&&(!0===a?r.setAttribute(n,""):!1===a?r.removeAttribute(n):120!==n.charCodeAt(0)?r.setAttribute(n,a):58===n.charCodeAt(3)?r.setAttributeNS("http://www.w3.org/XML/1998/namespace",n,a):58===n.charCodeAt(5)?r.setAttributeNS("http://www.w3.org/1999/xlink",n,a):r.setAttribute(n,a))}for(n in i)n in o||r.removeAttribute(n)}}t.attributesModule={create:r,update:r},t.default=t.attributesModule},function(e,t,n){"use strict";function r(e,t){var n=e.type,r=t.data.on;r&&r[n]&&function e(t,n,r){if("function"==typeof t)t.call(n,r,n);else if("object"==typeof t)if("function"==typeof t[0])if(2===t.length)t[0].call(n,t[1],r,n);else{var i=t.slice(1);i.push(r),i.push(n),t[0].apply(n,i)}else for(var o=0;o<t.length;o++)e(t[o])}(r[n!1)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.eventListenersModule={create:i,update:i,destroy:i},t.default=t.eventListenersModule},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="undefined"!=typeof window&&window.requestAnimationFrame||setTimeout,i=!1;function o(e,t,n){v[t]{r(i)}))}function a(e,t){var n,r,i=t.elm,a=e.data.style,s=t.data.style;if((a||s)&&a!==s){s=s||{};var c="delayed"in(a=a||{});for(r in a)s[r]||("-"===r[0]&&"-"===r[1]?i.style.removeProperty(r):i.style[r]="");for(r in s)if(n=s[r],"delayed"===r&&s.delayed)for(var u in s.delayed)n=s.delayed[u],c&&n===a.delayed[u]||o(i.style,u,n);else"remove"!==r&&n!==a[r]&&("-"===r[0]&&"-"===r[1]?i.style.setProperty(r,n):i.style[r]=n)}}t.styleModul{i=!1},create:a,update:a,destroy:function(e){var t,n,r=e.elm,i=e.data.style;if(i&&(t=i.destroy))for(n in t)r.style[n]=t[n]},remove:function(e,t){var n=e.data.style;if(n&&n.remove){i||(getComputedStyle(document.body).transform,i=!0);var r,o=e.elm,a=0,s=n.remove,c=0,u=[];for(r in s)u.push(r),o.style[r]=s[r];for(var l=getComputedStyle(o)["transition-property"].split(", ");a<l.length;++a)-1!==u.indexOf(l[a])&&c++;o.addEventListener("transitio&&t()}))}else t()}},t.default=t.styleModule},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(40);function o(e,t){var n,a=void 0!==t?t:i.default;if(a.isElement(e)){var s,c=e.id?"#"+e.id:"",u=e.getAttribute("class"),l=u?"."+u.split(" ").join("."):"",d=a.tagName(e).toLowerCase()+c+l,f={},p=[],h=void 0,g=void 0,m=e.attributes,y=e.childNodes;for(h=0,g=m.length;h<g;h++)"id"!==(s=m[h].nodeName)&&"class"!==s&&(f[s]=m[h].nodeValue);for(h=0,g=y.length;h<g;h++)p.push(o(y[h],t));return r.default(d,{attrs:f},p,void 0,e)}return a.isText(e)?(n=a.getTextContent(e),r.default(void 0,void 0,void 0,n,e)):a.isComment(e)?(n=a.getTextContent(e),r.default("!",{},[],n,e)):r.default("",{},[],void 0,e)}t.toVNode=o,t.defaomApi},function(e,t,n){"use s.key}}n.r(t),n.d(t,"h",(function(){return c})),n.d(t,"thunk",(function(){return f})),n.d(t,"urn b}));var i=r,o=Array.ieof e}var s={createElement:function(e){return document.createElement(e)},createEle(e,t)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insert(t,n)},removeChild:function(e,t){e.removeChild(t)},appenld(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextCent=t},getTextCntent},isElement:function(e){return 1===e.nodeType},isText:function(e){return 3===e.nodeType},isCeType}};function c(e,t,n){var i,s,c,u={};if(void 0!==n?(u=t,o(n)?i=n:a(n)?s=n:n&&n.sel&&(i=[n])):void 0!==t&&(o(t)?i=t:a(t)?s=t:t&&t.sel?i=[t]:u=t),void 0!==i)for(c=0;c<i.length;++c)a(i[c])&&(i[c]=r(void 0,void 0,void 0,i[c],void 0));return"s"!==e[0]||"v"!==e[1]||"g"!==e[2]||3!==e.length&&"."!==e[3]&&"#"!==e[3]||function e(t,n,r){if(t.ns="http://www.w3.org/2000/svg","foreignObject"!==r&&void 0!==n)for(var i=0;i<n.length;++i){var o=n[i].data;void 0!==o&&e(o,n[i].children,n[i].sel)}}(u,i,e),r(e,u,i,s,v,t)}var f=function(e,t,n,r){return void 0===r&&(r=n,n=t,t=void 0),c(e,{key:t,hook:{init:l,prepatch:d},fn:n,arg!==e}var g=i("",{},[],void 0,vrn a}var v=["create","update","remove","destroy","pre","post"];function b(e,t){var n,r,c={},u=void 0!==t?t:s;for(n=0;n<v.length;++n)for(c[v[n]]=[],r=0;r<e.length;++r){var l=e[r][v[n]];void 0!==l&&c[v[n]].p,e)}}}function f(e,t){var n,r=e.data;void 0!==r&&h(n=r.hook)&&h(n=n.init)&&(n(e),r=e.data);var i=e.children,s=e.sel;if("!"===s)p(e.text)&&(e.text=""),e.elm=u.createComment(e.text);else if(void 0!==s){var l=s.indexOf("#"),d=s.indexOf(".",l),m=l>0?l:s.length,y=d>0?d:s.length,v=-1!==l||-1!==d?s.slice(0,Math.min(m,y)):s,b=e.elm=h(r)&&h(n=r.ns)?u.createElementNS(n,v):u.createElement(v);for(m<y&&b.setAttribute("id",s.slice(m+1,y)),d>0&&b.setAttribute("class",s.slice(y+1).replace(/\./g," ")),n=0;n<c.create.length;++n)c.create[n](g,e);if(o(i))for(n=0;n<i.length;++n){var w=i[n];null!=w&&u.appendChild(b,f(w,t))}else a(e.text)&&u.appendChild(b,u.createTextNode(e.text));h(n=e.data.hook)&&(n.create&&n.create(g,e),n.insert&&t.push(e))}else e.elm=u.createTextNode(e.text);returnm)}}function F(e,t,n){var r,i;h(r=t.data)&&h(i=r.hook)&&h(r=i.prepatch)&&r(e,t);var o=t.elm=e.elm,a=e.children,s=t.children;if(e!==t){if(void 0!==t.data){for(r=0;r<c.update.length;++r)c.update[r](e,t);h(r=t.data.hook)&&h(r=r.update)&&r(e,t)}p(t.text)?h(a)&&h(s)?a!==s&&function(e,t,n,r){for(var i,o,a,s=0,c=0,l=t.length-1,d=t[0],h=t[l],g=n.length-1,v=n[0],w=n[g];s<=l&&c<=g;)null==d?d=t[++s]:null==h?h=t[--l]:null==v?v=n[++c]:null==w?w=n[--g]:m(d,v)?(F(d,v,r),d=t[++s],v=n[++c]):m(h,w)?(F(h,w,r),h=t[--l],w=n[--g]):m(d,w)?(F(d,w,r),u.insertBefore(e,d.elm,u.nextSibling(h.elm)),d=t[++s],w=n[--g]):m(h,v)?(F(h,v,r),u.insertBefore(e,h.elm,d.elm),h=t[--l],v=n[++c]):(void 0===i&&(i=y(t,s,l)),p(o=i[v.key])?(u.insertBefore(e,f(v,r),d.elm),v=n[++c]):((a=t[o]).sel!==v.sel?u.insertBefore(e,f(v,r),d.elm):(F(a,v,r),t[o]=void 0,u.insertBefore(e,a.elm,d.elm)),v=n[++c]));(s<=l||c<=g)&&(s>l?b(e,null==n[g+1]?null:n[g+1].elm,n,c,g,r):_(e,t,s,l))}(o,a,s,n):h(s)?(h(e.text)&&u.setTextContent(o,""),b(o,null,s,0,s.length-1,n)):h(a)?_(o,a,0,a.length-1):h(e.text)&&u.setTextContent(o,""):e.text!==t.text&&u.setTextContent(o,t.text),h(i)&&h(r=i.postpatch)&&r(e,t)}}return function(e,t){var n,r,o,a=[];for(n=0;n<c.pre.length;++n)c.pre[n]e.sel}(e)||(e=function(e){var t=e.id?"#"+e.id:"",n=e.className?"."+e.className.split(" ").join("."):"";return i(u.tagName(e).toLowerCase()+t+n,{},[],void 0,e)}(e)),m(e,t)?F(e,t,a):(r=e.elm,o=u.parentNode(r),f(t,a),null!==o&&(u.insertBefore(o,t.elm,u.nextSibling(r)),_(o,[e],0,0))),n=0;n<a.length;++n)a[n].data.hook.insert(a[n]);for(n=0;n<c.post.length;++n)c.post[n]();return t}}}]);