;
(self.AMP=self.AMP||[]).push({m:1,v:"2312191621000",n:"amp-form",ev:"0.1",l:!0,f:function(t,i){(()=>{var i;ar s=function n(t){return new Promise(()}ar{isArray:o}=Array,{hasOwnProperty:c,toString:u}=Object.prototype;ction f(t,i,e,s,n,r,o,c,u,a,h){return t}var d="amp:dom-update",m="amp:form-value-change",p="name";ction P(t,i){return A(i),i=i.toUpperCase(),function(t,e){const s=[];for(let e=t.parentElement;e;e=e.parentElement)e.tagName==i&&s.push(e);return s}(t)}nction T(t,i){const{length:e}=t;for(let s=0;s<e;s++)i(t[s],s)}unction y(t){const{elements:i}=t,e={},s=/^(?:input|select|textarea)$/i,n=/^(?:submit|button|image|file|reset)$/i,r=/^(?:checkbox|radio)$/i;for(let t=0;t<i.length;t++){const o=i[t],{checked:c,multiple:u,name:a,options:h,tagName:l,type:f,value:d}=o;!a||V(o)||!s.test(l)||n.test(f)||r.test(f)&&!c||(void 0===e[a]&&(e[a]=[]),u?T(h,():e[a].push(d))}const o=R(t);if(null!=o&&o.name){const{name:t,value:i}=o;void 0===e[t]&&(e[t]=[]),e[t].push(i)}return Object.keys(e).forEach((t=>{0==e[t].length&&delete e[t]})),e}function R(t){const{elements:i}=t,{activeElement:e}=t.ownerDocument,s=r(i).filter(g);return s.includes(e)?e:s[0]||null}function g(t){const{tagName:i,type:e}=t;return"BUTTON"==i||"submit"==e}function V(t){return t.disabled||P(t,"fieldset").some(()}function w(t){const i=t,e=t;switch(t.type){case"select-multiple":case"select-one":return r(i.options).every((({defaultSelected:t,selected:i})=>i===t));case"checkbox":case"radio":const{checked:t,defaultChecked:s}=e;return t===s;default:const{defaultValue:n,value:o}=e;return o===n}}var M=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;unction S(t){const i=h();if(!t)return i;let e;for(;e=M.exec(t);){const t=x(e[1],e[1]),s=e[2]?x(e[2].replace(/\+/g," "),e[2]):"";i[t]=s}return i}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var O=self.__AMP_LOG;H(t,i){return function(t,i){const e=B(t,i);if(e)return e;const n=J(t);return n[i]=function(){const t=new s,{promise:i,reject:e,resolve:n}=t;return i.catch((()=>{})),{obj:null,promise:i,resolve:n,reject:e,context:null,ctor:null}}(),n[i].promise}(G(t),i)}n K(t,i,e,s){const n=L(t,i);if(n)return n;const r=z(t);return r.whenExtensionsKnown().then(().then((e=>e?s?L(t,i):H(t,i):null))}var Y,Z=t=>z(t),Q=t=>C(t,"mutator"),tt=t=>U(t,"url"),it=function et(t,i,e,s){let n=t,r=e,o=const c=),u=!(null==s||!s.capture);return n.addEventListener(i,o,c?s:u),()=>{null==n||n.removeEventListener(i,o,c?s:u),r=null,n=null,o=null}}function st(t,i,e,s){const n={detail:e};return Object.assign(n,s),new t.CustomEvent(i,n)}unction rt(t,i,e,s){let n;const r=new Promise((s=>{n=function(t,i,e,s){let n=e;const r=et(t,i,(t=>{try{n(t)}finally{n=null,r()}}),s);return r}(t,i,s,e)}));return r.then(n,n),s&&s(n),r}nction ut(t,i){const e=D(t,"platform");return e.isIos()&&11==e.getMajorVersion()?new ft(i):FormData.prototype.entries&&FormData.prototype.delete?new lt(i):new ht(i)}var at,ht=class{constructor(t){this.VG=t?y(t):h()}append(t,i,e){const s=String(t);this.VG[s]=this.VG[s]||[],this.VG[s].push(String(i))}ntries(){const t=[];Object.keys(this.VG).forEach((i=>{this.VG[i].forEach(()}));let i=0;return{next:()=>i<t.length?{value:t[i++],done:!1}:{value:void 0,done:!0}}}getFormData(){const t=new FormData;return Object.keys(this.VG).forEach((i=>{this.VG[i].forEach(()})),t}},lt=class{constructor(t){this.SG=new FormData(t),this.FG(t)}FG(t){if(!t)return;const i=R(t);i&&i.name&&this.append(i.name,i.value)}elete(t){this.SG.delete(t)}etFormData(){return this.SG}},ft=class extends lt{constructor(t){super(t),t&&T(t.elements,(t=>{"file"==t.type&&0==t.files.length&&(this.SG.delete(t.name),this.SG.append(t.name,new Blob([]),""))}))}append(t,i,e){var s;i&&"object"==typeof i&&""==(s=i).name&&0==s.size?this.SG.append(t,new Blob([]),e||""):this.SG.append(t,i)}},dt=((),mt=new Set(["c","v","a","ad"]),pt="__amp_source_origin",_t=function bt(t,i){return at||(at=self.document.createElement("a")),at,t)}function At(t,i,e){if(!i)return t;const s=t.split("#",2),n=s[0].split("?",2);let r=n[0]+(n[1]?e?`?${i}&${n[1]}`:`?${n[1]}&${i}`:`?${i}`);return r+=s[1]?`#${s[1]}`:"",r}unction vt(t){const i=[];for(const s in t){let n=t[s];if(null!=n){n=o(e=n)?e:[e];for(let t=0;t<n.length;t++)i.push(Pt(s,n[t]))}}var e;return i.join("&")}function Et(t){return dt.cdnProxyRegex.test(_t(t).origin)}var Tt,It=["GET","POST"];function yt(t,i){const e={},i);if((s=i.body)&&"function"==typeof s.getFormData){const t=i.body;e.headers["Content-Type"]="multipart/form-data;charset=utf-8",e.body=function(t){const i=[];for(let e=t.next();!e.done;e=t.next())i.push(e.value);return i}(t.entries())}var s;return{input:t,init:e}}var Rt=["Webkit","webkit","Moz","moz","ms","O","o"],gt={"getPropertyPriority":()=>"","getPropertyValue":()=>""};St="autoexpand",Ot=class t{static install(i){const e=i.getRootNode();let s=null;const n=()=>{const n=e.querySelector("textarea[autoexpand]");if(!n||s)return!n&&s?(s.dispose(),void(s=null)):void 0;s=new t(i)};nt(e,d,n),n()}constructor(t){const i=t.getRootNode();this.Pf=i.ownerDocument||i,this.i=N(this.Pf.defaultView),this.Uu=it(t),this.c_=[],this.c_.push(nt(i,"input",(t=>{const i=t.target;"TEXTAREA"==i.tagName&&i.hasAttribute(St)&&Ft(i)}))),this.c_.push(nt(i,"mousedown",(t=>{if(1!=t.which)return;const i=t.target;"TEXTAREA"==i.tagName&&function(t){const i=Q(t);Promise.all([i.measureElement((),rt(t,"mouseup")]).then((e=>{const s=e[0];let n=0;return i.measureMutateElement(t,(()=>{n=t.scrollHeight}),(()=>{!function(t,i,e){i!=e&&t.removeAttribute(St)}(t,s,n)}))}))}(i)})));let e=i.querySelectorAll("textarea");this.c_.push(nt(i,d,());const s=function(t,i,e){let s=0,n=null;function r(e){n=null,s=t.setTimeout(o,100),i.apply(null,e)}eturn function(...t){s?n=t:r(t)}}(this.i,(t=>{t.relayoutAll&&e.forEach((t=>{"TEXTAREA"==t.tagName&&t.hasAttribute(St)&&Ft(t)}))}));var n;this.c_.push(this.Uu.onResize(s)),n=e,Promise.all(r(n).map((t=>function(t){return Q(t).measureElement(()}(t).then(())))};function Ft(t){const i=Q(t),e=N(t.ownerDocument.defaultView);let s=0,n=0,r=0;const o=function(t){const i=N(t.ownerDocument),e=N(i.defaultView),s=N(i.body),n=Q(t),r=t.cloneNode(!1);r.classList.add("i-amphtml-textarea-clone");let o=0,c=0,u=!1;return n.measureMutateElement(s,(()=>{const i=xt(e,t),s=parseInt(i.getPropertyValue("max-height"),10);o=parseInt(i.getPropertyValue("width"),10),u=isNaN(s)||t.scrollHeight<s}),(()=>{u&&(t.scrollTop=0),Vt(r,"width",Mt(o)),i.body.appendChild(r)})).then((()=>n.measureMutateElement(s,(,())).then(()}(t);return i.measureMutateElement(t,(()=>{const i=xt(e,t);n=t.scrollHeight;const o=parseInt(i.getPropertyValue("max-height"),10);r=isNaN(o)?1/0:o,s="content-box"==i.getPropertyValue("box-sizing")?-parseInt(i.getPropertyValue("padding-top"),10)-parseInt(i.getPropertyValue("padding-bottom"),10):parseInt(i.getPropertyValue("border-top-width"),10)+parseInt(i.getPropertyValue("border-bottom-width"),10)}),(()=>o.then((i=>{const o=i+s;t.classList.toggle("i-amphtml-textarea-max",o>r);const c="iAmphtmlHasExpanded"in t.dataset,u=/google/i.test(e.navigator.vendor)?3:0;(c||n<=i+u)&&(t.dataset.iAmphtmlHasExpanded="",Vt(t,"height",Mt(i+s)))}))))}var $t={"INPUT":!0,"SELECT":!0,"TEXTAREA":!0},jt="submit",kt=1,Nt=2,Xt=1,Dt=2,Ct=3,Ut={"acceptCharset":{access:kt,attr:"accept-charset"},"accessKey":{access:kt,attr:"accesskey"},"action":{access:kt,type:Xt},"attributes":{access:Nt},"autocomplete":{access:kt,def:"on"},"children":{access:Nt},"dataset":{access:Nt},"dir":{access:kt},"draggable":{access:kt,type:Dt,def:!1},"elements":{access:Nt},"encoding":{access:Nt},"enctype":{access:kt},"hidden":{access:kt,type:Ct,def:!1},"id":{access:kt,def:""},"lang":{access:kt},"localName":{access:Nt},"method":{access:kt,def:"get"},"name":{access:kt},"noValidate":{access:kt,attr:"novalidate",type:Ct,def:!1},"prefix":{access:Nt},"spellcheck":{access:kt},"style":{access:Nt},"target":{access:kt,def:""},"title":{access:kt},"translate":{access:kt}};function Ht(t){t.bubbleElement.removeAttribute("aria-alert"),t.bubbleElement.removeAttribute("role"),E(t.bubbleElement),wt(t.bubbleElement,!1)}function Lt(t){t.targetRect=t.viewport.getLayoutRect(t.targetElement)}function zt(t){E(t.bubbleElement);const i=t.bubbleElement.ownerDocument.createElement("div");i.id=`bubble-message-${t.id}`,i.textContent=t.message,t.bubbleElement.setAttribute("aria-labeledby",i.id),t.bubbleElement.setAttribute("role","alert"),t.bubbleElement.setAttribute("aria-live","assertive"),t.bubbleElement.appendChild(i),wt(t.bubbleElement,!0),t.bubbleElement,{top:t.targetRect.top-10+"px",left:`${t.targetRect.left+t.targetRect.width/2}px`})}var Gt,qt,Bt="Please match the requested format.",Jt=0,Wt=class{constructor(t){this.form=t,this.ampdoc=Z(t),this.mutator=Q(t),this.root=this.ampdoc.getRootNode(),this.$G=null}nBlur(t){}eckInputValidity(t){if("TEXTAREA"===t.tagName&&t.hasAttribute("pattern")&&(t.checkValidity()||t.validationMessage===Bt)){const i=t.getAttribute("pattern"),e=new RegExp(`^${i}$`,"m").test(t.value);t.setCustomValidity(e?"":Bt)}return t.checkValidity()}checkFormValidity(t){return this.kG(t),t.checkValidity()}reportFormValidityG(t){T(t.elements,()}fireValidityEventIfNecessary(){const t=this.$G;if(this.$G=this.checkFormValidity(this.form),t!==this.$G){const t=st(_(this.form),this.$G?"valid":"invalid",null,{bubbles:!0});this.form.dispatchEvent(t)}}},Kt=class extends Wt{,Yt=class extends Wt{constructor(t){super(t);const i="i-amphtml-validation-bubble-"+Jt++;this.XG=new class{constructor(t,i){this.di=i,this.Uu=it(t),this.ar=D(t.win,"vsync"),this.DG=null,this.CG="",this.rs=!1,this.UG=t.win.document.createElement("div"),wt(this.UG,!1),this.UG.classList.add("i-amphtml-validation-bubble"),this.UG.__BUBBLE_OBJ=this,t.getBody().appendChild(this.UG)}isActiveOn(t){return this.rs&&t==this.DG}hide(){this.rs&&(this.rs=!1,this.DG=null,this.CG="",this.ar.run({measure:void 0,mutate:Ht},{bubbleElement:this.UG}))}show(t,i){if(this.isActiveOn(t)&&i==this.CG)return;this.rs=!0,this.DG=t,this.CG=i;const e={message:i,targetElement:t,bubbleElement:this.UG,viewport:this.Uu,id:this.di};this.ar.run({measure:Lt,mutate:zt},e)}}(this.ampdoc,i)}report(){const t=this.inputs();for(let i=0;i<t.length;i++)if(!this.checkInputValidity(t[i])){t[i].focus(),this.XG.show(t[i],t[i].validationMessage);break}this.fireValidityEventIfNecessary()}onBlur(t){"submit"!=t.target.type&&this.XG.hide()}onInput(t){const i=t.target;this.XG.isActiveOn(i)&&(this.checkInputValidity(i)?(i.removeAttribute("aria-invalid"),this.XG.hide()):(i.setAttribute("aria-invalid","true"),this.XG.show(i,i.validationMessage)))}},Zt=class extends Wt{constructor(t){super(t),this.HG=this.form.id?this.form.id:String(Date.now()+Math.floor(100*Math.random())),this.LG=0}reportInput(t){const i=function(t){const i=["badInput"];for(const e in t.validity)i.includes(e)||i.push(e);const e=i.filter(();return e.length?e[0]:null}(t);i&&this.showValidationFor(t,i)}ideAllValidations(){const t=this.inputs();for(let i=0;i<t.length;i++)this.hideValidationFor(t[i])}getValidationFor(t,i){if(!t.id)return null;const e=this.GG(t,i),s="__AMP_VALIDATION_"+e;if(!(s in t)){const i=`[visible-when-invalid=${e}][validation-for=${t.id}]`;t[s]=this.root.querySelector(i)}return t[s]}GG(t,i){const{tagName:e,validationMessage:s}=t;return"TEXTAREA"===e&&"customError"===i&&s===Bt?"patternMismatch":i}showValidationFor(t,i){const e=this.getValidationFor(t,i);if(!e)return;e.textContent.trim()||(e.textContent=t.validationMessage),t.__AMP_VISIBLE_VALIDATION=e;let s=e.getAttribute("id");s||(s=this.zG(),e.setAttribute("id",s)),t.setAttribute("aria-invalid","true"),t.setAttribute("aria-describedby",s),this.mutator.mutateElement(e,(()=>e.classList.add("visible")))}hideValidationFor(t){const i=this.getVisibleValidationFor(t);i&&(delete t.__AMP_VISIBLE_VALIDATION,t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),this.mutator.mutateElement(i,())}Interaction(t){const i=t.target,e=!!i.checkValidity&&this.shouldValidateOnInteraction(i);this.hideValidationFor(i),e&&!this.checkInputValidity(i)&&this.reportInput(i)}onBlur(t){this.onInteraction(t)},Qt=class extends Zt{report(){this.hideAllValidations();const t=this.inputs();for(let i=0;i<t.length;i++)if(!this.checkInputValidity(t[i])){this.reportInput(t[i]),t[i].focus();break}this.fireValidityEventIfNecessary()}shouldValidateOnInteraction(t){return!!this.getVisibleValidationFor(t)}},ti=class extends Zt{report(){this.hideAllValidations();let t=null;const i=this.inputs();for(let e=0;e<i.length;e++)this.checkInputValidity(i[e])||(t=t||i[e],this.reportInput(i[e]));t&&t.focus(),this.fireValidityEventIfNecessary()},ii=class extends Zt{shouldValidateOnInteraction(t){return!0}onInteraction(t){super.onInteraction(t),this.fireValidityEventIfNecessary()}},ei=class extends ti{si="__amp_form_verify",ni=class{nCommit(){return this.BG(),this.JG()?this.MN():Promise.resolve({updatedElements:[],errors:[]})}MNG(){const{elements:t}=this.qG;for(let i=0;i<t.length;i++){const e=t[i];if(!e.disabled&&!w(e))return!0}return!1}BG(){const{elements:t}=this.qG;t&&T(t,()}},ri=oi=class extends ni{constructor(t,i){super(t),this.WG=i,this.KG=null,this.YG=[]}MN(){const t=this.WG().then((()=>[]),(t=>function(t){const{response:i}=t;return i?i.json().then((,():Promise.resolve([])}(t)));return this.ZG(t).then(()}ZG(t){if(!this.KG){this.KG=new class{constructor(t){if(this.Xq=new s,this.Hq=0,t)for(const i of t)this.add(i)}add(t){const i=++this.Hq;return t.then((t=>{this.Hq===i&&this.Xq.resolve(t)}),(t=>{this.Hq===i&&this.Xq.reject(t)})),this.Xq.promise};const t=this.KG.then(t,t)}return this.KG.add(t)}QG(t){const i=[],e=this.YG;this.YG=t;for(let e=0;e<t.length;e++){const s=t[e],n=$().assertString(s.name,"Verification errors must have a name property"),r=$().assertString(s.message,"Verification errors must have a message property"),o=$().assertElement(this.qG.querySelector(`[name="${n}"]`),"Verification error name property must match a field name");o.checkValidity()&&(o.setCustomValidity(r),i.push(o))}const s=e.filter(().map(();return{updatedElements:i.concat(s),errors:t}}};r ai="amp-form",hi=["amp-selector"],li="initial",fi="verifying",di="submitting",mi="valid",pi="invalid",_i="AMP-Redirect-To";function bi(t,i=!1){if(!t.checkValidity)return!0;let e=!1;const s=function(t){return t.classList.contains("user-valid")?mi:t.classList.contains("user-invalid")?pi:"none"}(t),n=t.checkValidity();if(s!=mi&&n?(t.classList.add("user-valid"),t.classList.remove("user-invalid"),e=s==pi):s==pi||n||(t.classList.add("user-invalid"),t.classList.remove("user-valid"),e=!0),function(t){if(t.validity)for(const i in t.validity)t.classList.toggle(i,t.validity[i])}(t),i&&e){const i=P(t,"fieldset");for(let t=0;t<i.length;t++)bi(i[t]);t.form&&bi(t.form)}return n}.registerServiceForDoc("form-submit-service",class{constructor(){this._u=new class{dd(t){return this.Vt||(this.Vt=[]),this.Vt.push(t),remove(t){this.Vt&&this.Vt,t)}ire(t){if(this.Vt)for(const i of this.Vt.slice())i(t)}},t.registerServiceForDoc(ai,class{constructor(t){this.Kq=this.Yq(t).then(()}q(t){const i=new s;return function(t,i,e,s,n){const r=t.getHeadNode(),o=r,r,'form.amp-form-submit-error [submit-error],form.amp-form-submit-success [submit-success],form.amp-form-submitting [submitting]{display:block}textarea[autoexpand]:not(.i-amphtml-textarea-max){overflow:hidden!important}.i-amphtml-textarea-clone{visibility:hidden;position:absolute;top:-9999px;left:-9999px;height:0!important}.i-amphtml-validation-bubble{transform:translate(-50%,-100%);background-color:#fff;box-shadow:0 5px 15px 0 rgba(0,0,0,.5);max-width:200px;position:absolute;display:block;box-sizing:border-box;padding:10px;border-radius:5px}.i-amphtml-validation-bubble:after{content:" ";position:absolute;bottom:-8px;left:30px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid #fff}[visible-when-invalid]{color:red}\n/*# sourceURL=/extensions/amp-form/0.1/amp-form.css*/'),0,"amp-form");if(e){const i=t.getRootNode();if(ui(i,o))return e(o),o;const s=setInterval((()=>{ui(i,o)&&(clearInterval(s),e(o))}),4)}}(t,0,i.resolve),i.promise}Zq(t){return t.whenReady().then((()=>{const i=t.getRootNode();this.Qq(i.querySelectorAll("form")),Ot.install(t),this.cB(i),this.uB(i)}))}Qq(t){t&&t.forEach(((t,i)=>{I(t)||new class{constructor(t,i){try{!function(t){const i=((s=_(t)).FormProxy||(s.FormProxy=function(t){onst e=i.prototype,{Object:s}=t,n=s.prototype;return[t.HTMLFormElement,t.EventTarget].reduce(((t,i)=>{let e=i&&i.prototype;for(;e&&e!==n&&!(t.indexOf(e)>=0);)t.push(e),e=s.getPrototypeOf(e);return t}),[]).forEach((i=>{for(const s in i){const r=t.Object.getOwnPropertyDescriptor(i,s);if(r&&s.toUpperCase()!=s&&!s.startsWith("on")&&!n.hasOwnProperty.call(e,s))if("function"==typeof r.value){const t=r.value;e[s]=else{const i={};r.get&&(i.get=,r.set&&(i.set=,t.Object.defineProperty(e,s,i)}}})),i}(s)),s.FormProxy),e=new i(t);var s;"action"in e||function(t,i){const e=t.ownerDocument.defaultView.HTMLFormElement.prototype.cloneNode.call(t,!1);for(const s in e){if(s in i||s.toUpperCase()==s||s.startsWith("on"))continue;const e=Ut[s],n=t[s];if(e)if(e.access==Nt){let e;if(n&&n.nodeType){const i=n,{nextSibling:r,parentNode:o}=i;o.removeChild(i);try{e=t[s]}finally{o.insertBefore(i,r)}}else e=n;Object.defineProperty(i,s,{get:()=>e})}else if(e.access==kt){const n=e.attr||s;Object.defineProperty(i,s,{get(){const s=i.getAttribute(n);if(null==s&&void 0!==e.def)return e.def;if(e.type==Dt)return"true"===s;if(e.type==Ct)return null!=s;if(e.type==Xt){const i=s||"";return tt(t).parse(i).href}return s},set(t){e.type==Ct&&(t=t?"":null),null!=t?i.setAttribute(n,t):i.removeAttribute(n)}})}else N(!1);else Object.defineProperty(i,s,{get:()=>t[s],set)}}(t,e),t.$p=e}(t)}catch(t){k().error(ai,"form proxy failed to install",t)}!t,this),this.di=i,this.Pf=t.ownerDocument,this.i=this.Pf.defaultView,this.Re=q(this.i,"timer"),this.qG=t,this.Ni=Z(this.qG),this.hB=null,this.lB=(t=>U(this.Ni,"url-replace"))(),this.tM=C(this.Ni,"templates"),this.s$=(t=>D(this.i,"xhr"))(),this.Iv=(t=>U(this.Ni,"action"))(),this.oc=Q(this.Ni),this.Fe=(t=>C(this.Ni,"viewer"))(),this.iJ=new class{sEnabledssertTrustedViewer(t){return this.Fe.isTrustedViewer().then(()}ssr(t,i,e=null,s={}){let n;return e||(n=this.tM.maybeFindTemplate(t)),this.assertTrustedViewer(t).then((()=>this.Fe.sendMessageAwaitResponse("viewerRenderTemplate",this.sJ(i,n,e,s))))}applySsrOrCsrTemplate(t,i){let e;return this.isEnabled()?(X("string"==typeof i.html,"Skipping template rendering due to failed fetch"),e=this.assertTrustedViewer(t).then(()):e=o(i)?this.tM.findAndRenderTemplateArray(t,i):this.tM.findAndRenderTemplate(t,i),e}sJ(t,i,e,s={}){const n={"type":this.eJ},r=e&&e.successTemplate?e.successTemplate:i;r&&(n.successTemplate={"type":"amp-mustache","payload":r.innerHTML});const o=e&&e.errorTemplate?e.errorTemplate:null;return o&&(n.errorTemplate={"type":"amp-mustache","payload":o.innerHTML}),s&&Object.assign(n,s),{"originalRequest":yt(t.xhrUrl,t.fetchOpt),"ampComponent":n}}}(ai,this.Fe,this.tM),this.DM=(this.qG.getAttribute("method")||"GET").toUpperCase(),this.o=this.qG.getAttribute("target"),this.fB=this.dB("action-xhr"),this.mB=this.dB("verify-xhr"),this.pB=this._B("enctype"),this.bB=!this.qG.hasAttribute("novalidate"),this.qG.setAttribute("novalidate",""),this.bB||this.qG.setAttribute("amp-novalidate",""),this.qG.classList.add("i-amphtml-form"),this.Ai=li;const e=this.qG.elements;for(let t=0;t<e.length;t++){const{name:i}=e[t];X(i!=pt&&i!=si,"Illegal input name, %s found: %s",i,e[t])}var s,n,r;this.AB=new class{constructor(t,i){this.qG=t,this.i=i,this.PB=0,this.vB=h(),this.EB=null,this.TB=!1,this.IB=!1,this.DP(),this.yB()}onSubmitting(){this.TB=!0,this.RB()}B(){const t=this.PB>0&&!this.TB;if(t!==this.IB){this.qG.classList.toggle("amp-form-dirty",t);const i=st(this.i,"amp:form-dirtiness-change",{"isDirty":t},{bubbles:!0});this.qG.dispatchEvent(i)}this.IB=t}DP(){this.qG.addEventListener("input",this.wB.bind(this)),this.qG.addEventListener("reset",this.MB.bind(this)),this.qG.addEventListener(m,this.wB.bind(this))}yB(){for(let t=0;t<this.qG.elements.length;++t)this.xB(this.qG.elements[t]);this.RB()}(t){(function(t){const{hidden:i,name:e,tagName:s}=t;return!$t[s]||!e||i||V(t)})(t)||(function(t){switch(t.tagName){case"INPUT":return"checkbox"==t.type||"radio"==t.type?!t.checked:!t.value;case"TEXTAREA":return!t.value;case"SELECT":return!1;default:throw new Error(`isFieldEmpty: ${t.tagName} is not a supported field element.`)}}(t)||w(t)||this.SB(t)?this.OB(t.name):this.FB(t.name))}SB(t){if(!this.EB)return!1;const{name:i,value:e}=t;return this.EB.get(i)===e}FB(t){this.vB[t]||(this.vB[t]=!0,++this.PB)}OB(t){this.vB[t]&&(this.vB[t]=!1,--this.PB)}(this.qG,this.i),this.fN=function(t){switch(t.getAttribute("custom-validation-reporting")){case"as-you-go":return new ii(t);case"show-all-on-submit":return new ti(t);case"interact-and-submit":return new ei(t);case"show-first-on-submit":return new Qt(t)}return t.ownerDocument&&void 0===Gt&&(Gt=!!document.createElement("form").reportValidity),Gt?new Kt(t):new Yt(t)}(this.qG),this.$B=(n=()=>this.jB(),(s=this.qG).hasAttribute("verify-xhr")?new oi(s,n):new ri(s)),this.Iv.addToAllowlist("FORM",["clear","submit"],["email"]),this.Iv.installActionHandler(this.qG,this.kB.bind(this)),this.DP(),this.NB(),this.XB(),this.DB=null,this.CB=null,this.UB=null,(r=t,H(r,"form-submit-service")).then((),this.HB=this.Pf&&function(t,i){const e=i.documentElement;return["âš¡4email","amp4email"].some((t=>e.hasAttribute(t)))}(0,this.Pf)}dB(t){const i=this.qG.getAttribute(t);if(i){const e=tt(this.Ni);e.assertHttpsUrl(i,this.qG,t),X(!e.isProxyOrigin(i),"form %s should not be on AMP CDN: %s",t,this.qG)}return i}_B(t){const i=this.qG.getAttribute(t);return"application/x-www-form-urlencoded"===i||"multipart/form-data"===i?i:"multipart/form-data"}getXssiPrefix(){return this.qG.getAttribute("xssi-prefix")}requestForFormFetch(t,i,e,s){let n,r,o={"Accept":"application/json"};if("GET"==i||"HEAD"==i){this.LB();const i=this.zB();s&&s.forEach])),e&&function(t,i,e=10){const s=[],n=[];for(n.push({t:t,s:i,d:0});n.length>0;){const{d:t,s:i,t:r}=n.shift();if(s.includes(i))throw new Error("Source object has a circular reference.");if(s.push(i),r!==i)if(t>e)Object.assign(r,i);else for(const e of Object.keys(i)){const s=i[e];if(l(r,e)){const i=r[e];if(a(s)&&a(i)){n.push({t:i,s:s,d:t+1});continue}}r[e]=s}}}(i,e),}(t,i)}else{n=t,"application/x-www-form-urlencoded"===this.pB?(r=vt(this.zB()),o={"Accept":"application/json","Content-Type":"application/x-www-form-urlencoded"}):(N("multipart/form-data"===this.pB),r=ut(this.i,this.qG)),s&&s.forEach((t=>r.delete(t)));for(const t in e)r.append(t,e[t])}return{xhrUrl:n,fetchOpt:{"body":r,"method":i,"credentials":"include","headers":o}}}setXhrAction(t){this.fB=t}kB(t){return t.satisfiesTrust(2)?"submit"==t.method?this.GB().then((()=>this.qB(t))):("clear"===t.method&&this.BB(),null):null}GB(){if(this.hB)return this.hB;const t=r(this.qG.querySelectorAll(hi.join(","))).map((t=>t.build()));return this.hB=this.JB(t,2e3)}DP(){this.Ni.whenNextVisible().then((()=>{const t=this.qG.querySelector("[autofocus]");t}(t)})),this.qG.addEventListener("submit",this.WB.bind(this),!0),this.qG.addEventListener("blur",(t=>{Ai(t.target),this.fN.onBlur(t)}),!0),this.qG.addEventListener(m,(t=>{Ai(t.target),this.fN.onInput(t)}),!0),this.iJ.isEnabled()||this.qG.addEventListener("change",(t=>{this.$B.onCommit().then((i=>{const{errors:e,updatedElements:s}=i;s.forEach(Ai),this.fN.onBlur(t),this.Ai===fi&&(e.length?(this.ES("verify-error"),this.KB({"verifyErrors":e}).then((()=>{this.YB("verify-error",e,2)}))):this.ES(li))}))})),this.qG.addEventListener("input",(t=>{Ai(t.target),this.fN.onInput(t)}))}NB(){var t;(t=this.Ni,K(t,"inputmask","amp-inputmask")).then}))}ZB(t){this.QB(!1,"Form analytics not supported");const i={},e=this.zB();for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i["formFields["+t+"]"]=e[t].join(","));i.formId=this.qG.id;try{this.tW(t,i)}catch(t){k().error(ai,"Sending analytics failed:",t)}}qB(t){return this.Ai!=di&&this.iW()?this.eW(t.trust,null):Promise.resolve(null)}BB(){this.qG.reset(),this.ES(li),this.qG.classList.remove("user-valid"),this.qG.classList.remove("user-invalid"),this.qG.querySelectorAll(".user-valid, .user-invalid").forEach})),this.qG.querySelectorAll(".visible[validation-for]").forEach})),function(t){const i=document.createElement("input");for(const e in i.validity)t.querySelectorAll(`.${b(e)}`).forEach}))}(this.qG)}WB(t){return this.Ai!=di&&this.iW()?((this.fB||"POST"==this.DM)&&t.preventDefault(),this.eW(3,t)):(t.stopImmediatePropagation(),t.preventDefault(),Promise.resolve(null))}eW(t,i){try{const t={form:this.qG,actionXhrMutator:this.setXhrAction.bind(this)};N(this.UB).fire(t)}catch(t){k().error(ai,"Form submit service failed: %s",t)}const s=this.sW(),n=this.qG.getElementsByClassName("i-amphtml-async-input");if(this.AB.onSubmitting(),!this.fB&&"GET"==this.DM){if(this.QB(!1,"Non-XHR GETs not supported."),this.LB(),0===n.length){for(let t=0;t<s.length;t++)this.lB.expandInputValueSync(s[t]);const t=!i;return this.nW(t),this.AB.onSubmitSuccess(),e()}i&&i.preventDefault()}this.ES(di);const r=[],o=[];return o.push(this.rW(s)),T(n,(t=>{const i=this.oW(t);t.classList.contains("i-async-require-action")?r.push(i):o.push(i)})),Promise.all(r).then((()=>this.JB(o,1e4).then((()=>this.cW(t)),(i=>this.uW(i,t)))),(i=>this.uW(i,t)))}uW(t,i){const e={};return t&&t.message&&(e.error=t.message),this.aW(t,e,i)}sW(){return this.qG.querySelectorAll('[type="hidden"][data-amp-replace]')}cW(t){return this.fB?this.hW(t):("POST"==this.DM?this.lW():"GET"==this.DM&&this.nW(!0),e())}jB(){return this.Ai===di?e():(this.ES(fi),this.YB("verify",null,3),this.rW(this.sW()).then))))}hW(t){let i;return this.iJ.isEnabled()?i=this.dW(t):(this.mW(t),i=this.pW().then((i=>this._W(i,t)),(i=>this.bW(i,t)))),i}dW(t){const i=this.zB();return this.KB(i).then((()=>this.Iv.trigger(this.qG,jt,null,t))).then((()=>{const t=this.requestForFormFetch(this.fB,this.DM);var i,e,s;return t.fetchOpt=function(t,i){const e=t||{},s=e.credentials;return f(void 0===s||"include"==s||"omit"==s),e.method=void 0===(n=e.method)?"GET":(n=n.toUpperCase(),f(It.includes(n)),n),e.headers=e.headers||{},f(null!==e.body),e;var n}(t.fetchOpt),t.fetchOp}(this.i,t.xhrUrl,t.fetchOpt),t.xhrUrl=(i=this.i,e=t.xhrUrl,s=t.fetchOpt,f("string"==typeof e),!1!==s.ampCors&&(e=function(t,i){return function(t){const i=S(bt(t).search);X(!(pt in i),"Source origin is not allowed in %s",t)}(i}(i,0,function(t){return bt(function(t){if(!Et(t=_t(t)))return t.href;const i=t.pathname.split("/"),e=i[1];X(mt.has(e),"Unknown path prefix in url %s",t.href);const s=i[2],n="s"==s?"https://"+decodeURIComponent(i[3]):"http://"+decodeURIComponent(s);return X(n.indexOf(".")>0,"Expected a . in origin %s",n),i.splice(1,"s"==s?3:2),n+i.join("/")+function(t,i){if(!t||"?"==t)return"";const e=new RegExp("[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\\b[^&]*","g"),s=t.replace(e,"").replace(/^[?&]/,"");return s?"?"+s:""}(t.search)+(t.hash||"")}(t)).origin}(t.location.href))}(i,e)),e),this.iJ.ssr(this.qG,t,this.AW())})).then((i=>this.PW(i,t)),(i=>{const e={};return i&&i.message&&(e.error=i.message),this.aW(i,e,t)}))}AW(){let t;const i=this.qG.querySelector("[submit-success]");let e;i&&(t=this.tM.maybeFindTemplate(i));const s=this.qG.querySelector("[submit-error]");return s&&(e=this.tM.maybeFindTemplate(s)),{successTemplate:t,errorTemplate:e}}PW(t,i){const e=t.init,s=function(t,i){try{retur}(t)}catch(t){return null==i||i(t),null}}(t.body,(t=>$().error(ai,"Failed to parse response JSON: %s",t)));if(e){const n=e.status;if(n>=300)return this.aW(n,t,i,s)}return this.vW(t,i,s)}mW(t){this.ZB("amp-form-submit");const i=this.zB();this.KB(i).then}))}rW(t){const i=[];for(let e=0;e<t.length;e++)i.push(this.lB.expandInputValueAsync(t[e]));return this.JB(i,100)}oW(t){return t.getImpl().then))).then((i=>{const e=t.getAttribute(p);let s=this.qG.querySelector(`input[name=${b(e)}]`);var n,r;s||(n=this.i.document,r={"name":t.getAttribute(p),"hidden":"true"},}(n.createElement("input"),r)),s.setAttribute("value",i),this.qG.appendChild(s)})}fW(){const t=r(this.qG.querySelectorAll(`[${b("no-verify")}]`)).mapd));return this.WG(this.mB,this.DM,{[si]:!0},t)}WG(t,i,e,s){this.QB(!1,"XHRs should be proxied.");const n=this.requestForFormFetch(t,i,e,s);return this.s$.fetch(n.xhrUrl,n.fetchOpt)}}_W(t,i){return this.s$.xssiJson(t,this.getXssiPrefix()).then))))).then((()=>{this.ZB("amp-form-submit-success"),this.TW(t)}))}vW(t,i,e){return this.ES("submit-success"),n((()=>{this.KB(t||{}).then((()=>{const s=this.EW(i);this.YB("submit-success",void 0===e?t:e,s),this.AB.onSubmitSuccess()}))}))}bW(t,i){let e;if(t&&t.response){const i=t;e=this.s$.xssiJson(i.response,this.getXssiPrefix()).catchl))}else e=Promise.resolve(null);return e.then((e=>{this.aW(t,e,i),this.ZB("amp-form-submit-error"),this.TW(t.response)}))}aW(t,i,e,s){return this.ES("submit-error"),$().error(ai,"Form submission failed: %s",t),n((()=>{this.KB(i).then((()=>{const t=this.EW(e);this.YB("submit-error",void 0===s?i:s,t),this.AB.onSubmitError()}))}))}lW(){X(!1,"Only XHR based (via action-xhr attribute) submissions are supported for POST requests. %s",this.qG)}nW(t){this.ZB("amp-form-submit"),t&&this.qG.submit(),this.ES(li)}QB(t,i){X(this.iJ.isEnabled()===t,"[amp-form]: viewerRenderTemplate | %s",i)}LB(){X(0==this.qG.querySelectorAll("input[type=password],input[type=file]").length,"input[type=password] or input[type=file] may only appear in form[method=post]")}iW(){if(i=this.i.document,void 0===qt&&(qt=!!i.createElement("input").checkValidity),qt){const i=((t=this.qG).querySelectorAll("input,select,textarea,fieldset").forEach))),bi(t));if(this.bB)return this.fN.report(),i}var t,i;return!0}TW(t){if(this.QB(!1,"Redirects not supported."),!t||!t.headers)return;const i=t.headers.get(_i);if(i){X(!this.HB,"Redirects not supported in AMP4Email.",this.qG),X("_blank"!=this.o,"Redirecting to target=_blank using AMP-Redirect-To is currently not supported, use target=_top instead. %s",this.qG);try{const t=tt(this.Ni);t.assertAbsoluteHttpOrHttpsUrl(i),t.assertHttpsUrl(i,"AMP-Redirect-To","Url")}catch(t){X(!1,"The `AMP-Redirect-To` header value must be an absolute URL starting with https://. Found %s",i)}(e=this.Ni,C(e,"navigation")).navigateTo(this.i,i,_i)}var e}YB(t,i,e){const s=st(this.i,`${ai}.${t}`,{"response":i});this.Iv.trigger(this.qG,t,s,e)}JB(t,i){return Promise.race([Promise.all(t),this.Re.promise(i)])}tW(t,i){!function(t,i,e={},s=!0){var n;(n=t,K(n,"amp-analytics-instrumentation","amp-analytics")).then((n=>{n&&n.triggerEventForTarget(t,i,e,s)}))}(this.qG,t,i}ES(t){const i=this.Ai;this.qG.classList.remove(`amp-form-${i}`),this.qG.classList.add(`amp-form-${t}`),this.IW(i),this.Ai=t}KB(t){o(t)&&(t={});const i=this.qG.querySelector(`[${this.Ai}]`);let s=e();if(i){const e=`rendered-message-${this.di}`;i.setAttribute("role","alert"),i.setAttribute("aria-labeledby",e),i.setAttribute("aria-live","assertive"),this.tM.hasTemplate(i)?s=this.iJ.applySsrOrCsrTemplate(N(i),t).then((t=>{let s;return o(t)?1===t.length?s=t[0]:(s=document.createElement("div"),t.forEach)))):s=t,s.id=e,s.setAttribute("i-amphtml-rendered",""),this.oc.mutateElement(i,(()=>{i.appendChild(s);const t=st(this.i,d,null,{bubbles:!0});i.dispatchEvent(t)}))})):this.oc.mutateElement(i}))}return s}IW(t){const i=this.qG.querySelector(`[${t}]`);if(!i)return;const e=(s=i,A("i-amphtml-rendered"),"> [i-amphtml-rendered]",s.querySelecto}("> [i-amphtml-rendered]")));var s;e&&v(e)}XB(){if(Et(this.i.location)||!this.qG.hasAttribute("data-initialize-from-url"))return;const t=["SELECT","TEXTAREA"],i=["color","date","datetime-local","email","hidden","month","number","range","search","tel","text","time","url","week"],e=["checkbox","radio"],s=(s,r)=>{if(s.hasAttribute("data-amp-replace"))return;if(!s.hasAttribute("data-allow-initialization"))return;const o=n[r]||"",c=s.getAttribute("type")||"text",u=s.tagName;if("INPUT"===u){if(i.includes(c.toLocaleLowerCase()))s.value!==o&&(s.value=o);else if(e.includes(c)){const t=s.value===o;s.checked!==t&&(s.checked=t)}}else t.includes(u)&&s.value!==o&&(s.value=o)},n=S(this.i.location.search);Object.keys(n).forEach((t=>{const i=this.qG.elements[t];i&&(i.nodeType===Node.ELEMENT_NODE?s(i,t):i.length&&i.forEach))))}))}renderTemplatePromiseForTesting(){return this.CB}xhrSubmitPromiseForTesting(){return this.DB}}(t,`amp-form-${i}`)}))}cB(t){t.addEventListener(d}))}uB(t){t.addEventListener("keydown",(t=>{if(t.defaultPrevented||"Enter"!=t.key||!t.ctrlKey&&!t.metaKey||"TEXTAREA"!==t.target.tagName)return;const{form:i}=t.target,e=i?I(i):null;e&&(e.WB(t),t.preventDefault())}))}})})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-form-0.1.mjs.map