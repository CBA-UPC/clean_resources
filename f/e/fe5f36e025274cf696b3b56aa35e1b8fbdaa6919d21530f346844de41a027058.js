(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1101],{51783:61543:function(e,t,n){"use strict";n.d(t,{I8:function(){return formatReviewShareLink},Lp:function(){return removeStartSlash},U4:function(){return previewFlowUrl},V7:function(){return formatURLForDisplay},fJ:function(){return projectPlayerUrl},fP:function(){return formatShareLinkWithPath},fy:function(){return r},m$:function(){return formatScreenshotUrl},s1:function(){return replaceSubdomainInHost},wn:function(){return removeHttpFromUrl}});var l,r,a=n(42906),o=n(89720),i=n(1991);let previewFlowUrl=(e,t,n)=>"".concat((0,i.e9)({flow_id:e}),"?s=").concat(null!=t?t:0).concat(n?"&lang=".concat(n):""),projectPlayerUrl=formatScreenshotUrl=e=>"".concat(o._.CAPTURE_SCREENSHOT_URL.PROD,"/nv_static/").concat(e),replaceSubdomainInHost=formatURLForDisplay=removeWWWFromUrl=removeHttpFromUrl=(l=r||(r={})).G2="g2",l.TrustRadius="trustRadius",l.Capterra="capterra",l.Gartner="gartner";let formatReviewShareLink=et formatShareLinkWithPath=,14504:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return tB}});var l,r,a,o,i,s,d,c,u=n(52322),p=n(2784),h=n(21038);function flowBuilderReducer(e,t){switch(t.type){case"toggle-selecting-steps":return{...e,selectingSteps:!e.selectingSteps,selectedStepIndices:new Set};case"exit-selecting-steps":return{...e,selectingSteps:!1,selectedStepIndices:new Set};case"toggle-step-selected":{let{stepIndex:n}=t.payload,l=e.selectedStepIndices.has(n);return l?e.selectedStepIndices.delete(n):e.selectedStepIndices.add(n),{...e}}case"set-language":{let{language:n}=t.payload;return{...e,language:n}}default:return e}}var g=n(61036),x=n(73235),m=n(23094),f=n(66548),v=n(82851),y=n(28165),b=n(2397),j=n(12853),w=n(71209),C=n(99219),S=n(47330),k=n(47819),E=n(83122),N=n(98269),B=n(20851),I=n(6676),T=n.n(I),R=n(5632),F=n(15366),_=n(71942),L=n(91957);function FlowAddButtons(e){let{flowDoc:t,stepIndex:n,triggers:l,beacons:r,handleChange:a}=e,{openSidePanel:o,closeSidePanel:i}=(0,j.u)();return(0,u.jsxs)("div",{"data-no-dnd":"true",className:"mb-10 mt-4 flex justify-between text-base",children:[(0,u.jsxs)("button",{"data-attr":"guide-builder-add-trigger",className:"btn-transparent p-0 text-blue-400 opacity-50 hover:opacity-100",onClick:()=>{let e={id:T()(),actions:[{id:T()(),type:S.yo.NextStep}]},r=(null==l?void 0:l.length)||0;a({type:"append-trigger",payload:{stepIndex:n,trigger:e}}),o({panelType:"TRIGGER",props:{stepIndex:n,triggerIndex:r,trigger:e,flowDoc:t,handleClose:i,handleChange:a}})},children:[(0,u.jsx)(C.jrq,{className:"mr-1 h-4 w-4"})," Add trigger"]}),(0,u.jsxs)("button",{"data-attr":"guide-builder-add-beacon",className:"btn-transparent p-0 text-purple-500 opacity-50 hover:opacity-100",onClick:()=>{var e;let l={id:T()(),selector:{},actions:[{id:T()(),type:S.yo.NextStep}]},s=null!==(e=null==r?void 0:r.length)&&void 0!==e?e:0;a({type:"append-beacon",payload:{stepIndex:n,beacon:l}}),o({panelType:"BEACON",props:{flowDoc:t,stepIndex:n,beaconIndex:s,handleChange:a,handleClose:i}})},children:[(0,u.jsx)("div",{className:"mr-3 h-2 w-2 rounded-full bg-purple-500",style:{boxShadow:"0 0 0 5px rgba(121, 27, 131, 0.15)"}}),"Add beacon"]})]})}var A=n(99135),P=n(8275);function PositionIcon_PositionIcon(e){let{position:t,...n}=e,getColor=return(0,u.jsx)("svg",{width:"1rem",height:"1rem",viewBox:"0 0 20 20",...n,children:(0,u.jsx)("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:(0,u.jsxs)("g",{id:"marquee-2",transform:"translate(-3.000000, -3.000000)",children:[(0,u.jsx)("polygon",{id:"Path",points:"0 0 24 0 24 24 0 24"}),(0,u.jsx)("path",{d:"M4,6 L4,5 C4,4.44771525 4.44771525,4 5,4 L6,4",id:"Path",stroke:getColor(S.Rh.TopStart),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)("line",{x1:"11",y1:"4",x2:"13",y2:"4",id:"Path",stroke:getColor(S.Rh.Top),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)("path",{d:"M18,4 L19,4 C19.5522847,4 20,4.44771525 20,5 L20,6",id:"Path",stroke:getColor(S.Rh.RightStart),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)("line",{x1:"20",y1:"11",x2:"20",y2:"13",id:"Path",stroke:getColor(S.Rh.Right),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)("path",{d:"M20,18 L20,19 C20,19.5522847 19.5522847,20 19,20 L18,20",id:"Path",stroke:getColor(S.Rh.BottomEnd),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)("line",{x1:"13",y1:"20",x2:"11",y2:"20",id:"Path",stroke:getColor(S.Rh.Bottom),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)("path",{d:"M6,20 L5,20 C4.44771525,20 4,19.5522847 4,19 L4,18",id:"Path",stroke:getColor(S.Rh.BottomStart),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)("line",{x1:"4",y1:"13",x2:"4",y2:"11",id:"Path",stroke:getColor(S.Rh.Left),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)("circle",{cx:"12",cy:"12",r:"1",stroke:getColor(S.Rh.Center),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})})}let Badges=e=>{let{defaultPosition:t}=e;return(0,u.jsx)("div",{className:"flex",children:t&&(0,u.jsx)(PositionIcon_PositionIcon,{position:t})})};function AnchorBlock(e){let{handleChange:t,flowDoc:n,stepIndex:l,openPanel:r,canEdit:a}=e,{closeSidePanel:o}=(0,j.u)(),i=n.steps[l];return(0,u.jsx)(A.Z,{onClick:()=>r({panelType:"ANCHOR",props:{flowDoc:n,stepIndex:l,handleClose:o,handleChange:t}}),bannerColor:"#222",bannerName:"Anchor",bannerIcon:(0,u.jsx)(C.iLY,{className:"h-3 w-3"}),bannerBadges:(0,u.jsx)(Badges,{defaultPosition:i.defaultPosition}),children:(0,u.jsx)(P.Z,{selector:i.selector,step:i,canEdit:a,context:{target:"tooltip",stepIndex:l,targetIndex:void 0}})})}var D=n(57574);function _templateObject(){let e=(0,x._)(["\n  border-radius: 50%;\n  width: 8px;\n  background-color: #fff;\n  height: 8px;\n  box-shadow: 0 0 0 5px rgba(255, 255, 255, 0.15);\n  margin-right: 5px;\n  margin-left: 8px;\n"]);return _templateObject=function(){return e},e}let M=b.Z.div(_templateObject()),Beacon_Badges=e=>{let{defaultPosition:t}=e;return(0,u.jsx)("div",{className:"flex",children:t&&(0,u.jsx)(PositionIcon_PositionIcon,{position:t})})};function BeaconBlock(e){var t;let{flowDoc:n,stepIndex:l,beaconIndex:r,openPanel:a,handleChange:o,canEdit:i=!0}=e,s=n.steps[l],d=null===(t=s.beacons)||void 0===t?void 0:t[r],{selector:c,position:p}=d||{},{closeSidePanel:h}=(0,j.u)();return(0,u.jsxs)(A.Z,{bannerColor:"#791B83",bannerName:"Beacon",bannerIcon:(0,u.jsx)(M,{}),bannerBadges:(0,u.jsx)(Beacon_Badges,{defaultPosition:p}),onClick:()=>{a({panelType:"BEACON",props:{flowDoc:n,stepIndex:l,beaconIndex:r,handleChange:o,handleClose:h}})},children:[(0,u.jsx)(P.Z,{canEdit:i,selector:null!=c?c:void 0,step:s,context:{target:"beacon",stepIndex:l,targetIndex:r}}),(0,u.jsx)(D.ol,{flowDoc:n,handleChange:o,target:"beacon",targetIndex:r,stepIndex:l})]})}var O=n(55653),Z=n(77815),V=n(53954),W=n(70443);let FormField=e=>{let{field:t,metaLookup:n}=e,{label:l,placeHolder:r,metadataId:a}=t,{type:o,displayName:i}=a&&n.get(a)||{},s=i||l;return o===S.ew.Checkbox||o===S.ew.LegalConsent?(0,u.jsxs)(W.__,{mt:"3px",mb:"-3px",sx:{fontSize:"13px"},children:[(0,u.jsx)(W.XZ,{}),s?(0,u.jsx)("span",{dangerouslySetInnerHTML:{__html:(0,k.jw)(s)}}):"Missing label"]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(W.__,{children:s||"Add label"}),(0,u.jsx)(W.II,{placeholder:r||void 0})]})};function FormBlock(e){var t;let{idx:n,flowDoc:l,language:r,openPanel:a,handleChange:o}=e,{workspace:i}=(0,V.cF)(),s=(0,V.NK)(i,S.TT.Multilingual),d=l.steps[n],{buttons:c,form:p}=d,h=s?(0,N._k)(null==p?void 0:p.multilingualTitle,r):null==p?void 0:p.title,g=s?(0,N._k)(null==p?void 0:p.multilingualSubtitle,r):null==p?void 0:p.subTitle,{fields:x}=p||{},{closeSidePanel:m}=(0,j.u)(),[{data:f}]=(0,Z.x)({variables:{workspaceId:i.id},pause:!(null==i?void 0:i.id)}),v=(null==f?void 0:f.formFieldMetadata)||[],y=new Map(v.map();return(0,u.jsx)(W.xu,{variant:"styles.Dialog",sx:{width:"100%",marginBottom:"12px"},children:(0,u.jsx)(W.xu,{variant:"styles.DialogContainer",children:(0,u.jsx)(W.xu,{variant:"styles.DialogFrameRoot",children:(0,u.jsxs)(W.xu,{px:"1rem",py:"1.5rem",children:[(0,u.jsxs)("div",{onClick:()=>{a({panelType:"FORM",props:{index:n,handleChange:o,handleClose:m,flowDoc:l,language:r}})},className:"-mt-2 mb-3 cursor-pointer rounded border border-dashed border-transparent px-2 py-2 hover:border-gray-200",children:[(0,u.jsx)(W.X6,{as:"h3",sx:{fontSize:20},children:h||"Untitled"}),g&&(0,u.jsx)(W.xv,{variant:"subtitle",sx:{fontSize:15},children:g})]}),(null==p?void 0:p.fields)&&(null==p?void 0:null===(t=p.fields)||void 0===t?void 0:t.length)?(0,u.jsx)(u.Fragment,{children:p.fields.map((e,t)=>(0,u.jsx)("div",{className:"-ml-2 -mr-2 cursor-pointer rounded border border-dashed border-transparent p-2 px-4 pt-0 hover:border-gray-200",onClick:()=>{a({panelType:"INPUT",props:{stepIndex:n,fieldIndex:t,handleChange:o,handleClose:m,flowDoc:l}})},children:(0,u.jsx)("div",{className:"pointer-events-none",children:(0,u.jsx)(FormField,{metaLookup:y,field:e})})},e.id))}):null,(0,u.jsx)("div",{className:"mt-2 p-2 pt-0",children:(0,u.jsxs)("button",{className:"btn-gray-dashed flex w-full items-center justify-center border-gray-200 py-3 text-center text-base hover:border-gray-300 hover:text-gray-500",onClick:()=>{var e;let t={id:T()(),label:"",placeHolder:"",type:S.ew.Input,required:!0},r=null!==(e=null==x?void 0:x.length)&&void 0!==e?e:0;o({type:"append-form-field",payload:{index:n,formField:t}}),a({panelType:"INPUT",props:{stepIndex:n,fieldIndex:r,handleChange:o,handleClose:m,flowDoc:l}})},children:[(0,u.jsx)(C.pOD,{height:"16px"}),"Add Field"]})}),(null==c?void 0:c.length)?(0,u.jsx)(W.kC,{sx:{flexWrap:"wrap",alignItems:"center",justifyContent:"center",width:"100%"},children:c.map((e,t)=>(0,u.jsx)("div",{className:"w-full cursor-pointer rounded border border-dashed border-transparent p-2 hover:border-gray-200",onClick:()=>{a({panelType:"BUTTON",props:{buttonIndex:t,stepIndex:n,flowDoc:l,canDelete:!1,handleChange:o,handleClose:m,language:r}})},children:(0,u.jsx)(W.zx,{sx:{width:"100%",padding:"10px 0"},children:s&&r?(0,N._k)(null==e?void 0:e.multilingualText,r):null==e?void 0:e.text})},e.id))}):""]})})})})}var U=n(32517),K=n(61543);function PreviewButtonBlock(e){let{capture:t,stepIdx:n,id:l}=e;return(0,u.jsx)("div",{"data-no-dnd":"true",className:"flex cursor-pointer",onClick:()=>{if(!t||!t.id){(0,U.Rn)("No capture selected for this step");return}window.open((0,K.U4)(l,n))},children:(0,u.jsx)(C.o1U,{className:"hover:text-blue-primary text-gray-200 transition duration-200",height:"21px"})})}n(3863),n(86072),n(87527);var z=n(68349),H=n(41191),X=n(60200),q=n(95797),J=n(92168),G=n(93453),$=n(23212),Y=n(37892),Q=n(24595);let requestFlowMediaUploadToken=async e=>{let{guideId:t}=e,n=await Q.Z.requestSessionToken({guideId:t,action:"EDIT","max-age":300,mode:"product-demo"});return n};var ee=n(73750),et=n(22146),en=n(98751),el=n(89370),er=n(1503),ea=n(43913),eo=n(68810),ei=n(39708),es=n(61907),ed=n(86414);let ec=new Map([["audio/m4a","m4a"],["audio/wave","wav"],["audio/midi","mid"]]),getAudioExtensionFromMime=var eu=n(89720),ep=n(46085),eh=n(77512);function LinkBlockStyle(e){let{editorState:t,setEditorState:n,setPopoverOpen:l}=e,[r,a]=(0,p.useState)(""),o=t.getCurrentContent(),findLinkSelection=()=>{let e=t.getSelection(),n=e.getStartKey(),l=e.getEndKey(),r=t.getCurrentContent(),a=r.getBlockForKey(n),o=r.getBlockForKey(l),i=e.getStartOffset(),s=e.getEndOffset();return a.findEntityRanges(e=>{let t=e.getEntity();return!!t&&t===a.getEntityAt(i)},,o.findEntityRanges(e=>{let t=e.getEntity();return!!t&&t===o.getEntityAt(s)},,new er.SelectionState({anchorKey:a.getKey(),focusKey:o.getKey(),anchorOffset:i,focusOffset:s})},removeLink=()=>{let e=findLinkSelection(),l=t.getCurrentContent(),r=er.Modifier.applyEntity(l,e,null),a=er.EditorState.set(t,{currentContent:r});n(er.RichUtils.toggleLink(a,e,null))};return(0,u.jsxs)(ea.J,{className:"relative w-full",children:[(0,u.jsx)(ea.J.Button,{className:"mx-1 flex cursor-pointer items-center rounded p-[2px] hover:bg-gray-100",onClick:()=>{let e=t.getSelection().getStartKey(),n=t.getSelection().getStartOffset(),l=o.getBlockForKey(e),r=l.getEntityAt(n);if(r){let e=o.getEntity(r);a(e.getData().url)}else a("")},children:(0,u.jsx)(C.xPt,{})}),(0,u.jsx)(eo.u,{leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",beforeEnter:()=>l(!0),afterLeave:()=>l(!1),children:(0,u.jsx)(ea.J.Panel,{className:"fixed left-1/2 z-10 mt-2 w-full -translate-x-1/2 translate-y-0 transform rounded-md bg-white text-base text-lg shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:(0,u.jsx)("div",{className:"p-4",children:(0,u.jsx)("div",{className:"flex",children:(0,u.jsx)(eh.oi,{className:"flex-1",labelText:"Insert link",value:r,placeholder:"https://example.com",autoFocus:!0,onChange:styles:{right:{padding:0}},right:(0,u.jsxs)(ea.J.Button,{className:"inline-flex h-full w-full items-center px-6 text-sm",onClick:()=>{if(r){let e=o.createEntity("LINK","MUTABLE",{url:(0,ep.oz)(r)}),l=e.getLastCreatedEntityKey(),a=er.EditorState.set(t,{currentContent:e});n(er.RichUtils.toggleLink(a,findLinkSelection(),l))}else removeLink()},children:[(0,u.jsx)(C.xPt,{className:"mr-1"}),"Save link"]})})})})})})]})}var eg=n(83389),ex=n(80163),em=n(78066);function PersonalizationModal(e){let{open:t,handleClose:n,editorState:l,setEditorState:r}=e,{setVariable:a}=(0,eg.oY)();return(0,u.jsx)(em.Z,{isRaw:!0,open:t,handleClose:()=>{n(),a({})},children:(0,u.jsx)("div",{className:"inline-block w-full max-w-md transform rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:align-middle",children:(0,u.jsx)(ex.Z,{onSave:e=>{let{variable:t,fallback:o}=e,i=l.getSelection(),s=l.getCurrentContent(),d=er.Modifier.replaceText(s,i,"{{".concat(t," | ").concat(o,"}}")),c=er.EditorState.push(l,d,"insert-attribute");r(er.EditorState.forceSelection(c,d.getSelectionAfter())),n(),a({})}})})})}let ef=[{value:"header-one",icon:C.LV},{value:"header-two",icon:C.bMP},{value:"header-three",icon:C.g3B},{value:"header-four",icon:C.fwT},{value:"header-five",icon:C.Zrf},{value:"header-six",icon:C.mFx}],ev=[{value:"blockquote",icon:C.kn2},{value:"unordered-list-item",icon:C.kXm},{value:"ordered-list-item",icon:C.sQN}],ey=[{label:"Bold",value:"BOLD",icon:C.mY4},{label:"Italic",value:"ITALIC",icon:C.h32},{label:"Underline",value:"UNDERLINE",icon:C.Adg}];(l=i||(i={})).IMAGE="image",l.VIDEO="video",l.AUDIO="audio";let Spacer=function BlockStyles(e){let{editorState:t,setEditorState:n,onAddButton:l,textAlign:r,toggleAlignCenter:a,isFocused:o,allowAddButton:i,popoverOpen:s,setPopoverOpen:d,guideId:c,defaultTextColor:h="#000000"}=e,[g,x]=(0,p.useState)(!1),[m,f]=(0,p.useState)(!1),{workspace:v}=(0,V.cF)(),y=(0,V.NK)(v,S.TT.AudioPlayer);(0,p.useEffect)(()=>{if(o)x(o);else{let e=setTimeout(()=>x(o),100);return},[o]);let b=t.getSelection(),j=t.getCurrentContent().getBlockForKey(b.getStartKey()).getType(),w=t.getCurrentInlineStyle(),toggleBlockType=e=>{n(er.RichUtils.toggleBlockType(t,e))},toggleInlineStyle=e=>{n(er.RichUtils.toggleInlineStyle(t,e))},createEntity=(e,l,r)=>{let a=t.getCurrentContent(),o=a.createEntity(e,l,r),i=o.getLastCreatedEntityKey(),s=er.EditorState.set(t,{currentContent:o});n(er.AtomicBlockUtils.insertAtomicBlock(s,i," "))},onAddMedia=e=>{if("video"===e){let t=window.prompt("Paste Video Link (youtube, vimeo, loom, wistia and vidyard accepted)");if(!t)return;createEntity(e,"IMMUTABLE",{src:t});return}let t=document.createElement("input");t.type="file",t.accept="image"===e?"image/*":"audio/*",t.onchange=async()=>{var n;let l=null===(n=t.files)||void 0===n?void 0:n[0];if(!l||!c)return;let r=await requestFlowMediaUploadToken({guideId:c});if(!r)return;let{body:a,base64:o,mime:i}=await (0,ee.K)(l),s=(0,en.SS)(a),d=await et.Z.uploadCaptureStaticResource({key:s,contentType:i,body:a,base64Encoded:o},r);if(!d.key)return;let u="".concat(eu._.CAPTURE_PLAYER_URL.PROD,"/nv_static/").concat(d.key),p=getAudioExtensionFromMime(i),h=p?"".concat(u,".").concat(p):u;createEntity(e,"IMMUTABLE",{src:h})},t.click()},k=[{name:"Button",hidden:!i,icon:C.QBF,onClick:l,eventName:"flow_step_button"},{name:"Image",icon:C.u3,onClick:()=>onAddMedia("image"),eventName:"flow_step_image"},{name:"Video",icon:C.Odl,onClick:()=>onAddMedia("video"),eventName:"flow_step_video"},{name:"Audio",hidden:!y,icon:C.S6n,onClick:eventName:"audio_player"},{name:"Personalization",icon:C.IhO,onClick:()=>f(!0),eventName:"flow_step_personalization"}],N=(e=>{if(e.startsWith("header-")){var t;return null===(t=ef.find()||void 0===t?void 0:t.icon}return C.LV})(j),B="bg-gray-100 text-gray-900",blockClass=e=>(0,E.AK)(e?B:"hover:bg-gray-100","flex items-center cursor-pointer p-1 rounded mx-1"),[I,T]=(0,p.useState)(()=>{var e,n;return null!==(n=null===(e=t.getCurrentInlineStyle().find(e=>!!(null==e?void 0:e.startsWith("COLOR-"))))||void 0===e?void 0:e.split("-")[1])&&void 0!==n?n:h}),handleSaveColor=e=>{let l=t.getCurrentInlineStyle(),r=l.find(e=>!!(null==e?void 0:e.startsWith("COLOR-")));if(ed.Z.track("text_color_changed_flow_builder",{color:e}),!r){n(er.RichUtils.toggleInlineStyle(t,"COLOR-".concat(e)));return}let a=er.RichUtils.toggleInlineStyle(t,r);n(er.RichUtils.toggleInlineStyle(a,"COLOR-".concat(e)))};return(0,u.jsxs)("div",{onMouseDown:className:(0,E.AK)(g||s?"flex":"hidden","-top-[3px] -mb-[30px] -ml-[1px]","animate-simpleEnter absolute left-0 box-content w-full items-center justify-between rounded-t-lg border border-gray-100 bg-white py-1 text-gray-500"),children:[(0,u.jsxs)("div",{className:"flex items-center",children:[ey.map(e=>(0,u.jsxs)(p.Fragment,{children:[(0,u.jsx)("div",{className:blockClass(w.has(e.value)),style:{padding:"2px"},onClick:()=>toggleInlineStyle(e.value),children:(0,u.jsx)(e.icon,{className:"h-4 w-4"})}),(0,u.jsx)(Spacer,{})]},e.value)),(0,u.jsxs)(ea.J,{className:"relative w-full",children:[(0,u.jsx)(ea.J.Button,{className:"mx-1 flex cursor-pointer items-center rounded p-[2px] hover:bg-gray-100",children:(0,u.jsx)("div",{className:blockClass(w.some(e=>!!(null==e?void 0:e.startsWith("COLOR-")))),style:{padding:"2px"},onClick:()=>{var e,n;T(null!==(n=null===(e=t.getCurrentInlineStyle().find(e=>!!(null==e?void 0:e.startsWith("COLOR-"))))||void 0===e?void 0:e.split("-")[1])&&void 0!==n?n:h),ed.Z.track("color_picker_opened_flow_builder")},children:(0,u.jsx)(C.MwZ,{className:"h-4 w-4"})})}),(0,u.jsx)(eo.u,{leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",beforeEnter:()=>d(!0),afterLeave:()=>d(!1),children:(0,u.jsx)(ea.J.Panel,{className:"fixed left-1/2 z-10 mt-2 w-fit -translate-x-1/2 translate-y-0 transform rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:(0,u.jsx)("div",{className:"px-3 py-2",children:(0,u.jsxs)("div",{className:"flex w-52",children:[(0,u.jsx)(es.Z,{value:I,mt:"0",mb:"0",outerClass:"flex-1 mr-2",className:"flex-1",onChange:(e,t)=>{let n=null!=t?t:h;T(n),handleSaveColor(n)}}),I!==h?(0,u.jsx)(ea.J.Button,{className:"btn-zinc text-sm font-medium",onClick:()=>{let e=t.getCurrentInlineStyle(),l=e.find(e=>!!(null==e?void 0:e.startsWith("COLOR-")));if(ed.Z.track("text_color_reset_flow_builder"),!l)return;let r=er.RichUtils.toggleInlineStyle(t,l);n(r)},children:"Reset"}):null]})})})})]}),(0,u.jsx)(Spacer,{}),(0,u.jsx)("div",{className:"flex items-center",children:(0,u.jsxs)(ei.v,{as:"div",className:"relative w-full",children:[(0,u.jsxs)(ei.v.Button,{className:(0,E.AK)(blockClass(j.startsWith("header-")),"p-[1px]"),children:[N&&(0,u.jsx)(N,{style:{height:"20px",width:"20px"}}),(0,u.jsx)(C.VAA,{className:"-ml-1 mt-2 h-2"})]}),(0,u.jsx)(eo.u,{leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",beforeEnter:()=>d(!0),beforeLeave:()=>d(!1),children:(0,u.jsx)(ei.v.Items,{className:"absolute right-0 z-10 mt-2 w-[45px] w-full origin-top-right divide-y divide-gray-100 overflow-hidden rounded-md border border-gray-200 bg-white pb-3 text-base text-lg shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:ef.map(e=>(0,u.jsx)(ei.v.Item,{children:(0,u.jsx)("button",{className:(0,E.AK)(j.startsWith(e.value)?B:"text-gray-500","flex w-full cursor-pointer items-center justify-center py-1 hover:bg-gray-50"),onClick:()=>toggleBlockType(e.value),children:(0,u.jsx)(e.icon,{})})},e.value))})})]})}),(0,u.jsx)(Spacer,{}),ev.map(e=>(0,u.jsxs)(p.Fragment,{children:[(0,u.jsx)("div",{className:(0,E.AK)(blockClass(j==e.value),"p-[2px]"),onClick:children:(0,u.jsx)(e.icon,{className:"h-4"})}),(0,u.jsx)(Spacer,{})]},e.value)),(0,u.jsx)(LinkBlockStyle,{editorState:t,setEditorState:n,setPopoverOpen:d}),(0,u.jsx)(Spacer,{}),(0,u.jsx)("div",{className:(0,E.AK)(blockClass("CENTER"===r),"p-[1px]"),onClick:a,children:(0,u.jsx)(C.UPo,{className:"h-4"})})]}),(0,u.jsx)("div",{className:"-ml-3 flex pr-1",children:(0,u.jsxs)(ei.v,{as:"div",className:"relative w-full",children:[(0,u.jsxs)(ei.v.Button,{className:"flex",children:[(0,u.jsx)(C.pOD,{className:"h-4"}),(0,u.jsx)(C.VAA,{className:"-ml-[6px] mt-[10px] h-2"})]}),(0,u.jsx)(eo.u,{leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",beforeEnter:()=>d(!0),beforeLeave:()=>d(!1),children:(0,u.jsx)(ei.v.Items,{className:"preserve-font absolute right-0 z-10 z-[20] mt-2 w-56 w-[150px] origin-top-right divide-y divide-gray-100 overflow-hidden rounded-md border border-gray-200 bg-white pb-3 text-base text-lg shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:k.map(e=>(0,u.jsx)(ei.v.Item,{children:(0,u.jsxs)("button",{onClick:()=>{e.onClick(),ed.Z.track("".concat(e.eventName,"_opened"),{flowId:c})},className:(0,E.AK)(e.hidden&&"hidden","m-0 flex w-full cursor-pointer items-center px-3 py-2 text-sm hover:bg-gray-50"),children:[(0,u.jsx)(e.icon,{className:"mr-2 shrink-0 text-gray-500"}),e.name]})},e.name))})})]})}),(0,u.jsx)(PersonalizationModal,{editorState:t,setEditorState:n,open:m,handleClose:)]})}var eb=n(368);function VideoBlock(e){let{src:t}=e,n=(0,eb.a)(t),l="".concat(100/(16/9),"%"),handleClick=return(0,u.jsx)(()=>(0,u.jsxs)("div",{style:{position:"relative"},children:[(0,u.jsx)("div",{style:{display:"block",width:"100%",padding:"".concat(l," 0 0 0"),margin:0}}),(0,u.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,padding:0,margin:0},children:(0,u.jsx)("iframe",{width:"100%",height:"100%",src:n||void 0,frameBorder:"0",allowFullScreen:!0})}),(0,u.jsx)("div",{style:{top:0,left:0,width:"100%",height:"100%",position:"absolute",cursor:"pointer",boxShadow:"0 0 0 3px rgba(69,121,228,0.2)",borderRadius:"0.125rem"},onClick:handleClick})]}),{})}(r=s||(s={})).IMAGE="image",r.VIDEO="video",r.AUDIO="audio";let Audio=Image=unction DialogRichEditor_templateObject(){let e=(0,x._)(["\n  a {\n    color: #1890ff;\n    font-weight: 600;\n    border-bottom: 1px solid #1890ff;\n  }\n  img {\n    max-width: 100%;\n  }\n  blockquote {\n    border-left: 2px solid #1738fa;\n    padding-left: 24px;\n    margin-left: 0px;\n  }\n"]);return DialogRichEditor_templateObject=function(){return e},e}let ej=b.Z.div(DialogRichEditor_templateObject()),ew=(0,J.Z)(),eC=(0,$.Z)({horizontal:"absolute",vertical:"absolute",initialWidth:"auto",initialHeight:"auto"}),eS=(0,H.Z)(),ek=(0,z.Z)(),{AlignmentTool:eE}=ek,eN=(0,q.lM)(eC.decorator,ek.decorator,ew.decorator,eS.decorator),eB=(0,G.Z)({decorator:eN}),eI=[{strategy:findEntities("LINK"),component:e=>{let{contentState:t,entityKey:n,children:l}=e,{url:r}=t.getEntity(n).getData();return(0,u.jsx)("a",{href:r,children:l})}},{strategy:findEntities("PERSONALIZATION"),component:function(e){let{children:t}=e;return(0,u.jsx)("span",{children:t})}}];et getBlockStyle=function DialogRichEditor(e){let{textAlign:t,stepIndex:n,content:l,multilingualContent:r,handleChange:a,addButton:o,allowAddButton:i,isEscapeView:s,guideId:d,defaultTextColor:c,language:h}=e,{workspace:g}=(0,V.cF)(),x=(0,V.NK)(g,S.TT.Multilingual),m=(0,p.useMemo)(()=>{let handleUpload=async(e,t,n,l)=>{let r=null==e?void 0:e.files[0];if(!r||!d)return;let a=await requestFlowMediaUploadToken({guideId:d});if(!a)return;let{body:o,base64:i,mime:s}=await (0,ee.K)(r),c=(0,en.SS)(o),u=await et.Z.uploadCaptureStaticResource({key:c,contentType:s,body:o,base64Encoded:i},a);if(!u.key)return;let p="https://c.navattic.com/nv_static/".concat(u.key);return t([{...await (0,X.pJ)(r),src:p}]),p},e=(0,X.ZP)({handleUpload,addImage:eB.addImage});return[e,eS,ew,ek,eC,eB]},[d]),[f,v]=(0,p.useState)(!1),[y,b]=(0,p.useState)(t||S.PH.Left),[j,w]=(0,p.useState)(!1),C=(0,p.useRef)(null),formatContent=e=>{let t="string"==typeof(null==e?void 0:e.valueOf())?JSON.parse(e):e;return C.current=t,er.EditorState.createWithContent((0,er.convertFromRaw)(t))},[k,E]=(0,p.useState)(()=>l?formatContent(l):er.EditorState.createEmpty()),N=(0,p.useRef)(null),B=(0,Y.Z)(k,300),I=(0,p.useCallback)(e=>{let t=e.getCurrentContent(),n=(0,er.convertToRaw)(t);return n.blocks.map(n=>{n.entityRanges.map(l=>{let r=t.getBlockForKey(n.key).getEntityAt(l.offset);if(r){let a=t.getEntity(r).getType();if("PERSONALIZATION"===a){let r=er.SelectionState.createEmpty(n.key),a=r.merge({anchorOffset:l.offset,focusOffset:l.length-l.offset}),o=er.Modifier.applyEntity(t,a,null),i=er.EditorState.push(e,o,"apply-entity");t=i.getCurrentContent()}}})}),t},[]),T=(0,p.useCallback)((e,t)=>{let n=(0,er.convertToRaw)(t),l=null,r=el.$s,a=[];return n.blocks.map(e=>{for(;null!==(l=r.exec(e.text));){let t=l[1].trim(),n=l[3].trim();a.push({blockKey:e.key,startIdx:l.index,endIdx:r.lastIndex,variable:t,fallback:n})}}),a.map(n=>{let l=er.SelectionState.createEmpty(n.blockKey),r=l.merge({anchorOffset:n.startIdx,focusOffset:n.endIdx}),a=t.createEntity("PERSONALIZATION","MUTABLE",{attribute:{variable:n.variable,fallback:n.fallback}}),o=a.getLastCreatedEntityKey(),i=er.Modifier.applyEntity(a,r,o),s=er.EditorState.push(e,i,"apply-entity");t=s.getCurrentContent()}),t},[]),R=(0,p.useCallback)([T,I]);return((0,p.useEffect)(()=>{if(!B)return;let e=R(B),t=(0,er.convertToRaw)(e);JSON.stringify(t)!==JSON.stringify(C.current)&&(s?(a({type:"update-escape-view",payload:{patch:{content:t}}}),h&&a({type:"update-multilingual-escape-view-content",payload:{language:h,content:t}})):(a({type:"update-step",payload:{index:n,patch:{content:t}}}),h&&a({type:"update-multilingual-step-content",payload:{stepIndex:n,language:h,content:t}})),C.current=t)},[B,R,a,n,s,h]),(0,p.useEffect)(()=>{var e;if(!r||!x)return;let t=null===(e=r.find(e=>e.language===h))||void 0===e?void 0:e.content;t&&E(formatContent(t))},[x,h,r]),k)?(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(ej,{children:[(0,u.jsx)(BlockStyles,{editorState:k,setEditorState:E,onAddButton:o,isFocused:j,textAlign:y,toggleAlignCenter:()=>{let e=y===S.PH.Center?S.PH.Left:S.PH.Center;b(e),s?a({type:"update-escape-view",payload:{patch:{textAlign:e}}}):a({type:"update-step",payload:{index:n,patch:{textAlign:e}}})},allowAddButton:i,popoverOpen:f,setPopoverOpen:v,guideId:d,defaultTextColor:c}),(0,u.jsxs)("div",{className:"navattic-exclude px-6 pt-10",children:[(0,u.jsx)(q.ZP,{customStyleFn:customStyleFn,readOnly:f,blockStyleFn:getBlockStyle,blockRendererFn:e=>{let t=e.getType();if("atomic"===t)return{component:BlockRenderer,editable:!1,props:{setPopoverOpen:v,setEditorState:E,editorState:k}}},placeholder:"Write text here...",textAlignment:y?y.toLowerCase():S.PH.Left.toLowerCase(),editorState:k,onChange:E,handleKeyCommand:(e,t)=>{let n=er.RichUtils.handleKeyCommand(t,e);return n?(E(n),"handled"):"not-handled"},onFocus:()=>w(!0),onBlur:()=>w(!1),spellCheck:!0,decorators:eI,plugins:m,ref:N}),(0,u.jsx)(eE,{})]})]})}):(0,u.jsx)("div",{})}unction RichEditorBlock(e){var t,n,l,r,a;let{stepIndex:o,isEscapeView:i,openPanel:s,handleChange:d,flowDoc:c,flowId:p,language:h}=e,{workspace:g}=(0,V.cF)(),x=(0,V.NK)(g,S.TT.Multilingual),m=c.steps[o],f=c.steps.length,{hasNavigationBtns:v,hasNavigationCompleteBtn:y,completeBtn:b,hasStepCount:w}=c,{appearance:k,content:E,multilingualContent:B,textAlign:I,backBtn:R,nextBtn:F,hasNextBtn:_=!0,hasBackBtn:L=!0,hideNavigationBtns:A,disableEscapeView:P}=m||{},D=!!c.escapeView&&!P,{closeSidePanel:M}=(0,j.u)(),O=i?null===(t=c.escapeView)||void 0===t?void 0:t.buttons:m.buttons,Z=i?null===(n=c.escapeView)||void 0===n?void 0:n.content:E,U=i?null===(l=c.escapeView)||void 0===l?void 0:l.multilingualContent:B,K=x?(0,N._k)(null==b?void 0:b.multilingualText,h):null==b?void 0:b.text,z=x?(0,N._k)(null==R?void 0:R.multilingualText,h):null==R?void 0:R.text,H=x?(0,N._k)(null==F?void 0:F.multilingualText,h):null==F?void 0:F.text,X=o===f-1,q=v&&!A&&!i,J=null===(a=c.theme)||void 0===a?void 0:null===(r=a.published)||void 0===r?void 0:r.dialogTextColor;return(0,u.jsxs)(W.xu,{variant:"styles.Dialog",mb:".8rem",sx:{width:"100%"},children:[(0,u.jsx)(W.xu,{variant:"styles.DialogContainer",children:(0,u.jsxs)(W.xu,{variant:"styles.DialogFrameRoot",sx:{overflow:"visible"},children:[D&&(i?(0,u.jsx)(W.zx,{className:"escape-btn back","aria-label":"Back",children:(0,u.jsx)(C.xCe,{height:"1.3rem",width:"1.3rem"})}):(0,u.jsx)(W.kC,{sx:{justifyContent:"flex-end"},children:(0,u.jsx)(W.zx,{className:"escape-btn close","aria-label":"Close",children:(0,u.jsx)(C.Two,{height:"1.5rem",width:"1.5rem"})})})),(0,u.jsx)(W.xu,{pb:"1.5rem",children:(0,u.jsx)(DialogRichEditor,{stepIndex:o,allowAddButton:!q,addButton:()=>{let e={id:T()(),actions:[{id:T()(),type:S.yo.NextStep}],appearance:S.lu.Primary,text:"Next",multilingualText:[{language:S.sp.En,content:"Next"}]};i?d({type:"append-escape-view-button",payload:{button:e}}):d({type:"append-dialog-button",payload:{stepIndex:o,button:e}})},content:Z,multilingualContent:U,textAlign:I,handleChange:d,isEscapeView:i,guideId:p,defaultTextColor:J,language:h})}),q?(0,u.jsxs)(W.kC,{onClick:()=>{s({panelType:"NAVIGATION_BUTTONS",props:{stepIndex:o,flowDoc:c,language:h,handleChange:d,handleClose:M}})},className:"cursor-pointer hover:border-dashed hover:border-gray-400",variant:"styles.NavigationBtnsContainer",children:[0===o||!1===L?(0,u.jsx)("div",{}):(0,u.jsx)(W.zx,{sx:{margin:0},className:"navattic-btn-secondary",children:z||"Back"}),w&&(0,u.jsxs)(W.xu,{variant:"styles.NavigationBtnsStepCount",children:[o+1," of ",f]}),X||!1===_?(0,u.jsx)("div",{}):(0,u.jsx)(W.zx,{sx:{margin:0},children:H||"Next"}),X&&y&&!A&&(0,u.jsx)(W.zx,{sx:{margin:0},children:K||"Complete"})]}):(null==O?void 0:O.length)?(0,u.jsx)(W.kC,{pt:".5rem",px:"2rem",pb:"1.5rem",sx:{alignItems:"center",justifyContent:"center",flexWrap:"wrap"},children:O.map((e,t)=>(0,u.jsx)("div",{className:"cursor-pointer rounded border border-dashed border-transparent p-2 hover:border-gray-300",onClick:()=>{s({panelType:"BUTTON",props:{flowDoc:c,stepIndex:o,isEscapeView:i,buttonIndex:t,handleChange:d,handleClose:M,canDelete:!0,language:h}})},children:(0,u.jsx)(W.zx,{sx:{margin:0},className:e.appearance==S.lu.Secondary?"navattic-btn-secondary":"",children:x?(0,N._k)(e.multilingualText,h):e.text})},e.id))}):null]})}),k===S.XB.Tooltip&&(0,u.jsx)(W.xu,{variant:"styles.ArrowTip",className:"navattic-arrow-placement-top"})]})}var eT=n(31024),eR=n(37074);let eF="flex items-center justify-center rounded-full h-6 w-6",FlagTag=()=>(0,u.jsx)("div",{className:(0,E.AK)(eF,"bg-[#DEF8DD] text-[#027E52]"),children:(0,u.jsx)(C.U65,{})}),BackdropTag=()=>(0,u.jsx)("div",{className:(0,E.AK)(eF,"bg-slate-100 text-slate-800"),children:(0,u.jsx)(C.Ixs,{})}),TriggerTag=()=>(0,u.jsx)("div",{className:(0,E.AK)(eF,"bg-[#099fe3] text-white"),children:(0,u.jsx)(C.jrq,{})}),BeaconTag=()=>(0,u.jsx)("div",{className:(0,E.AK)(eF,"bg-[#791B83] text-white"),children:(0,u.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-white",style:{boxShadow:"0 0 0 4px rgba(255, 255, 255, 0.15)"}})}),HideNavigationBtnsTag=()=>(0,u.jsx)("div",{className:(0,E.AK)(eF,"bg-[#FEE2E2] text-[#F87171]"),children:(0,u.jsx)(C.aK0,{})}),ModalPositionTag=e=>{let{position:t}=e;return(0,u.jsx)("div",{children:t?(0,u.jsx)(C.jU6,{position:t}):(0,u.jsx)(C.ndL,{})})},StepAppearanceActions=e=>{let{idx:t,flowDoc:n,handleChange:l,addStep:r,duplicateStep:a}=e,o=n.steps[t],i=[{icon:C.pOD,name:"Insert step right",onClick:()=>{r({indx:t+1})}},{icon:C.TIy,name:"Duplicate step",onClick:,{color:"#f76f68",icon:C.pJl,name:"Delete step",onClick:()=>{let e=(0,k.Lz)(n,t);if(e.length>0){(0,U.Rn)((0,u.jsx)(eR.Z,{dependentSteps:e}));return}l({type:"delete-step",payload:{index:t}})}}];return(0,u.jsx)(eT.Z,{tabs:i,"data-testid":"step-more-actions"})};function StepAppearanceBlock(e){let{idx:t,flowDoc:n,flowBuilderState:l,openPanel:r,handleChange:a,addStep:o,duplicateStep:i,canEdit:s}=e,d=n.steps[t],{appearance:c,markCompleted:p,showBackdrop:h,modalPosition:g,triggers:x,beacons:m,hideNavigationBtns:f}=d,{closeSidePanel:v}=(0,j.u)();if(!c)return null;let y=c.toLowerCase(),b="w-full flex mb-2 border border-gray-100 rounded bg-white transition-border duration-200 focus:outline-none focus:ring-2 focus:border-blue-primary focus:ring-blue-200",w={[S.XB.Form]:C.KjN,[S.XB.Tooltip]:C.nw3,[S.XB.Invisible]:C.Tr8,[S.XB.Embed]:C.dNJ,[S.XB.Modal]:C.OQg},k=w[c];return(0,u.jsx)("div",{role:"button",tabIndex:0,className:s?(0,E.AK)(b,"hover:border-gray-300","cursor-pointer"):b,onClick:()=>{r({panelType:"STEP",props:{handleChange:a,handleClose:v,index:t,flowDoc:n,flowBuilderState:l}})},"data-no-dnd":"true",children:(0,u.jsxs)("div",{className:s?"flex flex-1 cursor-pointer items-center p-4":"flex flex-1 items-center p-4",children:[(0,u.jsxs)("div",{className:"flex flex-1 items-center",children:[(0,u.jsx)(k,{className:"mr-4 h-5 w-5 text-blue-500"}),(0,u.jsx)("div",{className:"text-base capitalize",children:y})]}),(0,u.jsxs)("div",{className:"mr-2 flex gap-x-2",children:[x&&x.length>0&&(0,u.jsx)(TriggerTag,{}),m&&m.length>0&&(0,u.jsx)(BeaconTag,{}),h&&(0,u.jsx)(BackdropTag,{}),p&&(0,u.jsx)(FlagTag,{}),f&&(0,u.jsx)(HideNavigationBtnsTag,{}),g&&c===S.XB.Modal&&(0,u.jsx)(ModalPositionTag,{position:g})]}),s&&(0,u.jsx)(StepAppearanceActions,{idx:t,flowDoc:n,addStep:o,duplicateStep:i,handleChange:a})]})})}let EscapeViewAppearanceActions=e=>{let{handleChange:t}=e,n=[{color:"#f76f68",icon:C.pJl,name:"Delete view",onClick:];return(0,u.jsx)(eT.Z,{tabs:n})};function EscapeViewAppearanceBlock(e){let{handleChange:t,canEdit:n}=e,l="w-full flex mb-2 border border-gray-100 rounded bg-white transition-border duration-200 focus:outline-none focus:ring-2 focus:border-blue-primary focus:ring-blue-200";return(0,u.jsx)("div",{role:"button",tabIndex:0,className:n?(0,E.AK)(l,"hover:border-gray-300","cursor-pointer"):l,children:(0,u.jsxs)("div",{className:n?"flex flex-1 cursor-pointer items-center p-4":"flex flex-1 items-center p-4",children:[(0,u.jsxs)("div",{className:"flex flex-1 items-center",children:[(0,u.jsx)(C.TcU,{className:"mr-4 h-5 w-5 text-blue-500"}),(0,u.jsx)("div",{children:"Escape"})]}),n&&(0,u.jsx)(EscapeViewAppearanceActions,{handleChange:t})]})})}var e_=n(74503);function TriggerBlock(e){let{flowDoc:t,stepIndex:n,triggerIndex:l,trigger:r,openPanel:a,handleChange:o,canEdit:i}=e,{type:s}=r,{closeSidePanel:d}=(0,j.u)();return(0,u.jsx)(A.Z,{bannerColor:"#099fe3",bannerName:"Trigger",bannerIcon:(0,u.jsx)(C.jrq,{className:"h-4 w-4"}),onClick:children:s?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(e_.D,{trigger:r,handleChange:o,editMode:!1,stepIndex:n,triggerIndex:l,step:t.steps[n]}),(0,u.jsx)(D.ol,{handleChange:o,target:"trigger",targetIndex:l,stepIndex:n,flowDoc:t})]}):i?(0,u.jsxs)("button",{className:"btn-gray-dashed flex w-full items-center justify-center border p-10 text-center",children:[(0,u.jsx)(C.pOD,{className:"mr-1"}),"Select trigger condition"]}):(0,u.jsx)(u.Fragment,{})})}function EscapeViewBuilder_templateObject(){let e=(0,x._)(["\n  0% {\n    opacity: 0;\n    transform: translateX(-5px);\n  }\n  100% {\n    opacity: 1;\n  }\n"]);return EscapeViewBuilder_templateObject=function(){return e},e}function _templateObject1(){let e=(0,x._)(["\n  animation: "," 0.25s ease;\n"]);return _templateObject1=function(){return e},e}let eL=(0,y.F4)(EscapeViewBuilder_templateObject()),eA=b.Z.div(_templateObject1(),eL);function EscapeViewBuilder(e){let{flowDoc:t,theme:n,previewEscapeWidth:l,handleChange:r,canEdit:a,language:o}=e,i=(null==n?void 0:n.published)||F.LIGHT_THEME.config,s=(0,_.Is)(i),d=(0,R.useRouter)(),c=d.query.flow_id,{openSidePanel:p}=(0,j.u)();return(0,u.jsx)(eA,{"data-guide-builder-escape-view":!0,className:(0,E.AK)(a?"relative mr-1 cursor-grab border-l border-r border-gray-100 bg-white":"relative mr-1 border-l border-r border-gray-100 bg-white"),style:{width:l},children:(0,u.jsxs)("div",{className:"px-5 pb-1 pt-2",children:[(0,u.jsx)("div",{className:"mt-2",children:(0,u.jsx)(EscapeViewAppearanceBlock,{handleChange:r,canEdit:a})}),(0,u.jsx)(L.f,{theme:s,children:(0,u.jsx)("div",{className:"relative z-10 cursor-auto py-2",children:(0,u.jsx)(RichEditorBlock,{flowDoc:t,handleChange:r,openPanel:e=>a&&p(e),stepIndex:0,isEscapeView:!0,flowId:c,language:o})})})]})})}var eP=n(18318);function IframeBlock(e){let{label:t,placeholder:n,value:l,onChange:r}=e;return(0,u.jsx)(eh.oi,{labelText:t+" URL","data-no-dnd":"true",className:"rounded p-2 text-sm",placeholder:n,onChange:r,value:l})}(a=d||(d={})).Calendly="Calendly",a.ChiliPiper="Chili Piper";let eD=[{type:"Calendly",name:"Calendly",placeholder:"https://calendly.com/...",value:e=>e.calendlyURL,icon:()=>(0,u.jsx)("img",{src:"/logos/calendly.png",className:"mr-2 h-4 w-4"})},{type:"Chili Piper",name:"ChiliPiper",placeholder:"https://acme.chilipiper.com/...",value:icon:];function ExternalBlock(e){let t=e.flowDoc.steps[e.idx],[n,l]=(0,p.useState)(eD[0]);return(0,u.jsxs)("div",{className:"w-100 mb-2 flex flex-col space-y-3 rounded border p-3 shadow-lg",children:[(0,u.jsx)("div",{"data-no-dnd":"true",children:(0,u.jsx)(eP.Z,{items:eD.map(,selected:n.type,renderOption:e=>(0,u.jsxs)("div",{className:"flex",children:[e&&e.icon(),(0,u.jsx)("span",{children:e.name})]}),renderSelectedIcon:onChange:e=>{let t=eD.find(;t&&l(t)}})}),(0,u.jsx)(IframeBlock,{label:n.name,placeholder:n.placeholder,value:n.value(t)||"",onChange:t=>e.handleChange({type:"update-step",payload:{index:e.idx,patch:{calendlyURL:"Calendly"===n.type?t:null,chiliPiperURL:"Chili Piper"===n.type?t:null}}})})]})}function StepBuilder(e){let{theme:t,idx:n,addStep:l,duplicateStep:r,handleChange:a,removeAnchors:o,canEdit:i,flow:s,flowBuilderState:d,selectingSteps:c,stepSelected:p,toggleStepSelected:h}=e,g=s.editVersion.doc,x=g.steps[n],{appearance:m,name:f="",triggers:v,beacons:y,capture:b}=x,w=(0,R.useRouter)(),C=w.query.flow_id,{openSidePanel:k}=(0,j.u)(),openSidePanel=N=(null==t?void 0:t.published)||F.LIGHT_THEME.config,B=(0,_.Is)(N);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:(0,E.AK)("flex items-center px-4 pt-3"),children:[c&&(0,u.jsx)(eh.XZ,{className:"mr-1","data-no-dnd":"true",checked:p,onChange:h}),(0,u.jsx)("div",{className:"ml-2 mr-1 text-xl",children:"".concat(n+1,".")}),(0,u.jsx)(eh.oi,{"data-no-dnd":"true",disabled:!i,placeholder:"Untitled Step",name:"name",value:null!=f?f:void 0,onChange:styles:{wrapper:{borderWidth:0}},className:"mx-1 w-full border-0 text-xl",size:"md"}),C&&(0,u.jsx)(PreviewButtonBlock,{capture:(0,O.P)(b),stepIdx:n,id:C})]}),(0,u.jsxs)("div",{className:"px-5 pb-1 pt-2",children:[(0,u.jsx)("div",{className:"mt-2",children:(0,u.jsx)(StepAppearanceBlock,{idx:n,flowDoc:g,flowBuilderState:d,openPanel:openSidePanel,handleChange:a,addStep:l,duplicateStep:r,canEdit:i})}),m!==S.XB.Invisible&&m!=S.XB.Embed&&(0,u.jsx)(L.f,{theme:B,children:(0,u.jsx)("div",{"data-no-dnd":"true",className:"relative z-10 cursor-auto py-2",children:m===S.XB.Form?(0,u.jsx)(FormBlock,{idx:n,flowDoc:g,language:d.language,openPanel:openSidePanel,handleChange:a}):(0,u.jsx)(RichEditorBlock,{flowDoc:g,stepIndex:n,openPanel:openSidePanel,handleChange:a,isEscapeView:!1,flowId:C,language:d.language})})}),m===S.XB.Embed&&(0,u.jsx)(ExternalBlock,{idx:n,flowDoc:g,handleChange:a}),m===S.XB.Tooltip&&(0,u.jsx)(AnchorBlock,{openPanel:openSidePanel,canEdit:i,flowDoc:g,stepIndex:n,handleChange:a}),(0,u.jsx)(O.Z,{stepIndex:n,step:x,openPanel:openSidePanel,removeAnchors:o,canEdit:i,handleChange:a,flow:s}),null==v?void 0:v.map((e,t)=>(0,u.jsx)(TriggerBlock,{trigger:e,openPanel:openSidePanel,handleChange:a,canEdit:i,stepIndex:n,flowDoc:g,triggerIndex:t},null==e?void 0:e.id)),null==y?void 0:y.map((e,t)=>(0,u.jsx)(BeaconBlock,{openPanel:openSidePanel,handleChange:a,canEdit:i,flowDoc:g,stepIndex:n,beaconIndex:t},e.id)),i&&(0,u.jsx)(FlowAddButtons,{flowDoc:g,triggers:v,beacons:y,stepIndex:n,handleChange:a})]})]})}function FlowBuilder_templateObject(){let e=(0,x._)(["\n  0% {\n    opacity: 0;\n    transform: translateX(-5px);\n  }\n  100% {\n    opacity: 1;\n  }\n"]);return FlowBuilder_templateObject=function(){return e},e}et eM=(0,y.F4)(FlowBuilder_templateObject()),eO=b.Z.div(FlowBuilder_templateObject1(),eM,500);function SortableItem(e){let{attributes:t,listeners:n,setNodeRef:l,transform:r,transition:a}=(0,f.nB)({id:e.id}),o={zIndex:e.active?1:0,transform:v.ux.Transform.toString(r),transition:a};return(0,u.jsx)(eO,{"data-guide-builder-step":e.idx,className:(0,E.AK)(e.canEdit?"relative mr-1 cursor-grab border-l border-r border-gray-100 bg-white":"relative mr-1 border-l border-r border-gray-100 bg-white"),ref:l,style:o,...t,...n,children:(0,u.jsx)(StepBuilder,{...e})})}let updateEditVersion=e=>{let{flow:t,flowDocument:n}=e;t&&t.editVersion&&(t.editVersion.doc=n)};function cleanAnchor(e){if(e)for(let t=0;t<e.length;t++)Object.keys(e[t]).forEach(n=>{"selector"==n&&(e[t][n]={})})}function FlowBuilder(e){var t;let{flow:n,flowBuilderState:l,updateFlow:r,handleChange:a,dispatchFlowBuilder:o,canEdit:i,selectingSteps:s,selectedStepIndices:d}=e,{openSidePanel:c,closeSidePanel:h}=(0,j.u)(),g=(0,R.useRouter)(),x=(0,E.K7)(g.query.s),[v,y]=(0,p.useState)(null),b=null==n?void 0:null===(t=n.editVersion)||void 0===t?void 0:t.doc,updateFlowDoc=e=>{n&&(updateEditVersion({flow:n,flowDocument:e}),r(n))},I=(0,p.useMemo)([null==b?void 0:b.steps]),addStep=e=>{var t,n;if(!b||!b.steps)return;let r=null!==(t=null==e?void 0:e.indx)&&void 0!==t?t:b.steps.length,o=S.XB.Modal,i=null!==(n=l.language)&&void 0!==n?n:S.sp.En,s={id:T()(),appearance:o,showBackdrop:!1,backdropStyle:null,buttons:[{id:T()(),actions:[{id:T()(),type:S.yo.NextStep}],appearance:S.lu.Primary,text:"Next",multilingualText:[{language:i,content:N._b.Next[i]}]}]};a({type:"insert-step",payload:{step:s,index:r}}),c({panelType:"STEP",props:{index:r,flowDoc:b,handleChange:a,handleClose:h,flowBuilderState:l}}),setTimeout(200)},scrollStepIntoView=e=>{let t=document.querySelector('[data-guide-builder-step="'.concat(e,'"]')),n=document.querySelector('[data-attr="guide-builder-scroll-container"]');if(!t||!n)return;let l=t.getBoundingClientRect(),r=l.left+n.scrollLeft-30;n.scroll({top:0,left:r,behavior:"smooth"})};(0,p.useEffect)(()=>{x&&(null==b?void 0:b.steps)&&scrollStepIntoView(parseInt(x))},[x,b]);let duplicateStep=(e,t)=>{if(!b||!b.steps)return;let n=structuredClone(b.steps),l=structuredClone(e);l.commonId=T()(),(0,E.gz)(l,{whitelist:["webCapture","screenshotCapture"]}),n.splice(t,0,l),a({type:"set-steps",payload:n})},removeAnchors=e=>{if(!b||!b.steps)return;let t=b.steps[e];t&&(t.selector={},cleanAnchor(t.beacons),cleanAnchor(t.triggers),b.steps[e]=t,updateFlowDoc(b))},F=(0,m.Dy)((0,m.VT)(w.L));return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(m.LB,{sensors:F,collisionDetection:m.pE,onDragEnd:e=>{var t,n;y(null);let{active:l,over:r}=e;if(!r)return;let{id:a}=l,{id:o}=r;if(!b)return;let i=null===(t=b.steps)||void 0===t?void 0:t.findIndex(e=>e.id===o),d=null===(n=b.steps)||void 0===n?void 0:n.findIndex(;void 0!==i&&void 0!==d&&(b.steps=(0,k.yz)((0,B.qY)(b.steps||[],d,i)),updateFlowDoc(b),s||h())},onDragStart:e=>{let{active:t}=e;t&&y(t.id)},children:(0,u.jsx)(f.Fo,{items:I,strategy:f.PG,children:b&&I.length>0?I.map((e,t)=>(0,u.jsx)(SortableItem,{flow:n,flowBuilderState:l,id:e.id,active:v===e.id,idx:t,theme:b.theme,handleChange:a,addStep:addStep,duplicateStep:duplicateStep,removeAnchors:removeAnchors,canEdit:i,selectingSteps:s,stepSelected:d.has(t),toggleStepSelected:,"step-".concat(e.id))):null})}),I.length>=0&&i&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)("div",{className:"p-4",children:(0,u.jsx)("button",{type:"button",className:"relative flex h-full w-80 justify-center rounded border border-dashed border-gray-300 bg-gray-50 p-12 text-center text-gray-500 hover:border-gray-400","data-attr":"guide-builder-add-next-step",onClick:children:(0,u.jsxs)("div",{className:"mt-40 flex items-center text-sm font-semibold",children:[(0,u.jsx)(C.pOD,{}),(0,u.jsx)("span",{className:"ml-1 ",children:"Add next step"})]})})})}),(null==b?void 0:b.escapeView)&&(0,u.jsx)(EscapeViewBuilder,{flowDoc:b,previewEscapeWidth:500,theme:b.theme||void 0,handleChange:a,canEdit:i,language:l.language})]})}var eZ=n(73459),eV=n(6781),eW=n(1821);let calculateScreenshotScale=e=>{let{viewport:t,deviceScreenshotWidth:n}=e;if(!t.offsetWidth)return 1;let l=t.clientWidth/(n||1);return l};var eU=n(73749);(o=c||(c={})).Move="move",o.Resize="resize";var DraggableSelector_Draggable=e=>{let{style:t,targets:n,rect:l,boxRef:r,boxSelRef:a,status:o,boundary:i,element:s,capturePlayerFrame:d}=e,c=(0,p.useRef)(!1),h=(0,p.useCallback)((e,t,n)=>{var r,a,o,d;if(!l.current)return;let{height:c,top:u,width:p,left:h}=l.current;switch(e){case"top":{let e=c-n+u,t=null!==(r=null==s?void 0:s.getBoundingClientRect().top)&&void 0!==r?r:0;e>20&&n-t>=0&&(l.current={...l.current,top:n,height:e});break}case"left":{let e=p-t+h,n=null!==(a=null==s?void 0:s.getBoundingClientRect().left)&&void 0!==a?a:0;e>20&&t-n>=0&&(l.current={...l.current,left:t,width:e});break}case"bottom":{let e=n-u,t=null!==(o=null==s?void 0:s.getBoundingClientRect().top)&&void 0!==o?o:0;e>20&&u-t<=i.y-e&&(l.current={...l.current,height:e});break}case"right":{let e=t-h,n=null!==(d=null==s?void 0:s.getBoundingClientRect().left)&&void 0!==d?d:0;e>20&&h-n<=i.x-e&&(l.current={...l.current,width:e})}}},[l,s,i.y,i.x]),g=(0,p.useCallback)(e=>{if(!isInBounds({x:e.clientX,y:e.clientY,element:s,capturePlayerFrame:d})){c.current=!1,o.current="move";return}c.current&&"resize"===o.current&&(n.forEach(t=>{if(a.current){let{left:n,top:l}=a.current.getBoundingClientRect(),r=e.pageX-n,o=e.pageY-l;h(t,r,o)}}),drawRect(l.current,r))},[s,d,o,n,l,r,a,h]),x=(0,p.useCallback)(e=>{e.preventDefault(),c.current=!1,o.current="move"},[o]);(0,p.useEffect)([g,x]);let m={zIndex:el.dw-2,position:"absolute",borderColor:"#18a9f7",backgroundColor:"white",borderWidth:1,borderRadius:"100%",width:8,height:8,...t};return n.includes("top")?m.top=-5:n.includes("bottom")?m.bottom=-5:m.top="calc(50% - ".concat(5,"px)"),n.includes("left")?m.left=-5:n.includes("right")?m.right=-5:m.left="calc(50% - ".concat(5,"px)"),(0,u.jsx)("div",{className:"border-2",style:m,onMouseDown:)};let drawRect=(e,t)=>{if(!t.current){console.error("No box ref");return}let n=t.current.style;for(let t of["left","top","width","height"]){let l=e[t]+"px";n[t]!==l&&(n[t]=l)}},eK=[{targets:["top","left"],style:{cursor:"nwse-resize"}},{targets:["top"],style:{cursor:"ns-resize"}},{targets:["top","right"],style:{cursor:"nesw-resize"}},{targets:["right"],style:{cursor:"ew-resize"}},{targets:["bottom","right"],style:{cursor:"nwse-resize"}},{targets:["bottom"],style:{cursor:"ns-resize"}},{targets:["bottom","left"],style:{cursor:"nesw-resize"}},{targets:["left"],style:{cursor:"ew-resize"}}],ez={left:100,top:100,width:100,height:80};var MediaCaptureEditControls_DraggableSelector=e=>{let{borderWidth:t=1.5,color:n,className:l,onChange:r,initialDimensions:a,boundary:o,element:i,capturePlayerFrame:s}=e,d=(0,p.useRef)(null),h=(0,p.useRef)(null),g=(0,p.useRef)(a),x=(0,p.useRef)({x:0,y:0}),m=(0,p.useRef)(!1),f=(0,p.useRef)(c.Move);(0,p.useEffect)(()=>{g.current=a,drawRect(g.current,h)},[a]);let v=(0,p.useCallback)(()=>{g.current.width>0&&g.current.height>0&&r(g.current)},[r]),y=(0,p.useCallback)(e=>{e.preventDefault(),m.current=!1,f.current=c.Move,v()},[v]),b=(0,p.useCallback)(e=>{if(e.preventDefault(),m.current&&f.current===c.Move&&d.current){var t,n;if(!isInBounds({x:e.clientX,y:e.clientY,element:i,capturePlayerFrame:s})){m.current=!1,f.current=c.Move;return}let{left:l,top:r}=d.current.getBoundingClientRect(),a=e.pageX-l-x.current.x,u=e.pageY-r-x.current.y,p=o.x-g.current.width,v=o.y-g.current.height,y=null!==(t=o.left)&&void 0!==t?t:0,b=null!==(n=o.top)&&void 0!==n?n:0;g.current.left=(0,B.IV)({value:a,min:y,max:p+y}),g.current.top=(0,B.IV)({value:u,min:b,max:v+b}),drawRect(g.current,h)}},[o.left,o.top,o.x,o.y,s,i]);return(0,p.useEffect)(()=>(drawRect(g.current,h),window.addEventListener("mouseup",y),window.addEventListener("mousemove",b),null==i||i.addEventListener("mouseup",y),,[y,b,i]),(0,u.jsx)("div",{className:l,ref:d,id:"boxframe",children:(0,u.jsx)("div",{id:"box",className:"absolute z-10 select-none",ref:h,style:{borderWidth:"".concat(t,"px"),borderColor:n},onMouseDown:e=>{if(m.current=!0,f.current===c.Move&&d.current){f.current=c.Move;let{left:t,top:n}=d.current.getBoundingClientRect();x.current.x=e.pageX-t-g.current.left,x.current.y=e.pageY-n-g.current.top,h.current&&(h.current.style.cursor=c.Move)}},children:eK.map(e=>(0,u.jsx)(DraggableSelector_Draggable,{targets:e.targets,style:e.style,rect:g,boxRef:h,boxSelRef:d,status:f,boundary:o,element:i,capturePlayerFrame:s},e.targets.join("")))})})};function isInBounds(e){let{x:t,y:n,element:l,capturePlayerFrame:r}=e;if(!l||!r)return!0;let a=l.getBoundingClientRect(),o=r.getBoundingClientRect();return t>=a.x+o.x&&t<=a.right+o.x&&n<=a.bottom+o.y&&n>=a.y+o.y}var eH=n(78979),eX=n(3710),eq=n(65940);function MediaAnchorSelectorBar(e){let{selectAnchorMode:t,handleSave:n}=e;return(0,u.jsxs)("div",{className:"flex h-16 w-full items-center justify-between bg-slate-50 px-5",children:[(0,u.jsxs)("div",{className:"flex-1 text-[14px] font-medium text-slate-500",children:["Selecting ",t," anchor"]}),(0,u.jsx)("div",{className:"flex items-center gap-x-5",children:(0,u.jsx)("div",{className:"flex flex-1 justify-end",children:(0,u.jsx)("button",{className:"btn-blue",onClick:children:"Save anchor"})})})]})}var eJ=n(81559);let scaleDimensions=e=>{let{dimensions:t,reverse:n,scale:l}=e;if(!t)return;let r={};return Object.keys(t).forEach(,r};function MediaCaptureModalContent(e){var t;let{capture:n,handleClose:l,handleChange:r}=e,{initialSelector:a,selectAnchorMode:o,setSelectAnchorMode:i,selectorContext:s}=(0,eZ.nW)(),d=(0,p.useRef)(null),[c,h]=(0,p.useState)(void 0),[{data:g,fetching:x}]=(0,eW.U)({variables:{id:n.id}}),m=null==g?void 0:g.getMediaCapture,f=d.current?calculateScreenshotScale({viewport:d.current,deviceScreenshotWidth:null!==(t=null==m?void 0:m.deviceScreenshotWidth)&&void 0!==t?t:void 0}):1,[v,y]=(0,p.useState)(eJ.L.View),b=o===eZ.vm.Position,j=b?eJ.L.ViewOnly:v,w=(0,p.useRef)(null);(0,p.useEffect)(()=>{var e;if(a&&(null==a?void 0:a.dimensions)&&(null==a?void 0:null===(e=a.dimensions)||void 0===e?void 0:e.height)){let e=scaleDimensions({dimensions:null==a?void 0:a.dimensions,reverse:!1,scale:f});h(e)}else{let e=((null==m?void 0:m.deviceScreenshotWidth)||0)/2-75,t=((null==m?void 0:m.deviceScreenshotHeight)||0)/2-50,n=scaleDimensions({dimensions:{top:t,left:e,right:e,bottom:t,height:100,width:150},reverse:!1,scale:f});h(n)}},[a,h,f,m]);let C=(0,p.useCallback)(()=>{if(!w.current||!d.current||!s)return;let{height:e,width:t,left:n,top:a}=w.current,o=((null==m?void 0:m.deviceScreenshotWidth)||0)*f-(n+t),i=((null==m?void 0:m.deviceScreenshotHeight)||0)*f-(a+e);r({type:"set-selector",payload:{...s,selector:{imageUrl:null==m?void 0:m.deviceScreenshot,dimensions:scaleDimensions({dimensions:{height:e,width:t,left:n,top:a,right:o,bottom:i},reverse:!0,scale:f}),screenshotHeight:null==m?void 0:m.deviceScreenshotHeight,screenshotWidth:null==m?void 0:m.deviceScreenshotWidth,pixelRatio:1}}}),l()},[s,null==m?void 0:m.deviceScreenshotWidth,null==m?void 0:m.deviceScreenshotHeight,null==m?void 0:m.deviceScreenshot,f,r,l]);return x?(0,u.jsx)(eV.Z,{}):m?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(eH.Z,{capture:m,mode:j,handleClose:l,onClickEdit:),(0,u.jsx)(eX.Z,{ref:d,capture:m,containerClass:"h-[65vh]",deviceHeightClass:"h-[65vh]",renderInsideTemplate:c&&b?(0,u.jsx)(MediaCaptureEditControls_DraggableSelector,{className:"absolute left-0 top-0 z-10",initialDimensions:c,onChange:boundary:{x:((null==m?void 0:m.deviceScreenshotWidth)||0)*f,y:((null==m?void 0:m.deviceScreenshotHeight)||0)*f},color:"#18a9f7"}):null}),j===eJ.L.Edit&&(0,u.jsx)(eU.Z,{capture:m,exitEditMode:),b&&(0,u.jsx)(MediaAnchorSelectorBar,{selectAnchorMode:o,handleSave:C})]}):null}function MediaCaptureModal(e){let{capture:t,handleChange:n}=e,{closeCaptureModal:l}=(0,eZ.nW)(),r=(0,p.useCallback)([l]);return(0,u.jsx)(em.Z,{open:!0,handleClose:r,isRaw:!0,hideFooter:!0,children:(0,u.jsx)(eq.Z,{children:(0,u.jsx)(MediaCaptureModalContent,{handleChange:n,handleClose:r,capture:t})})})}var eG=n(83777),e$=n(19894),eY=n(67569),eQ=n(15993),e0=n(30797),e1=n(70535),e2=n(38145),e5=n(46877);let e4=p.forwardRef((e,t)=>{let{children:n,capture:l,mode:r,handleChange:a,handleClose:o,onClickEdit:i,fetchingOrBuilding:s,errorMessage:d}=e,[c,h]=p.useState(1);return l?r===eJ.L.Edit?(0,u.jsx)(e0.Z,{ref:t,handleClose:o,capture:l}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(e1.Z,{capture:l,onClickEdit:i,handleClose:o,mode:r}),(0,u.jsxs)("div",{className:"relative w-full flex-1 overflow-hidden",children:[(0,u.jsx)(e5.Z,{ref:t,updateTransformScalar:h,fetchingOrBuilding:s,errorMessage:d,scaleStrategy:l.scaleStrategy}),(0,u.jsx)(e2.Z,{transformScalar:c,children:n})]})]}):null});e4.displayName="WebCaptureModalContent";let e3=["CANVAS"];function ElementFreeSelector(e){let{element:t,playerFrameRef:n,isPlayerLoaded:l,isOpen:r=!0,onPlayerMouseMove:a,onChange:o,...i}=e,{selectAnchorMode:s}=(0,eZ.nW)(),d=(0,p.useMemo)(()=>{if(!t)return null;let{top:e,left:n,width:l,height:r}=t.getBoundingClientRect();return{x:l,y:r,left:n,top:e}},[t]),c=(0,p.useCallback)(e=>{let t=d?{...e,left:e.left-d.left,top:e.top-d.top}:e;null==o||o(t)},[d,o]),h=(0,p.useCallback)(e=>{let t=(0,eQ.VB)(e);e.isOverFreeSelectElement=e3.includes(t.nodeName),null==a||a(e)},[a]);(0,p.useEffect)(()=>{var e;let t=null===(e=n.current)||void 0===e?void 0:e.contentWindow;if(!t||!l||!r)return;let a=(0,eQ.IF)(t,[{type:"mousemove",listener:h}],{includeWin:!0});return a},[n,l,h,r]);let g=r&&t&&d&&l&&n.current&&s===eZ.vm.Position,x=(0,p.useMemo)(()=>{var e,t;return{...ez,left:null!==(e=null==d?void 0:d.left)&&void 0!==e?e:ez.left,top:null!==(t=null==d?void 0:d.top)&&void 0!==t?t:ez.top}},[d]);return g?(0,u.jsx)(MediaCaptureEditControls_DraggableSelector,{className:"absolute left-0 top-0 z-10",initialDimensions:x,boundary:d,color:"#18a9f7",element:t,capturePlayerFrame:n.current,onChange:c,...i}):null}var e7=n(83193),e8=n(34296),e6=n(97015),e9=n(2877);function WebAnchorSelectorBar(e){let{selectedElement:t,playerFrame:n,showTraverseButtons:l=!0,freeSelectDimensionsRef:r,handleChange:a,handleClose:o,handleSelectElement:i}=e,{selectAnchorMode:s,selectorContext:d}=(0,eZ.nW)(),[c,h]=(0,p.useState)(!1),g=(0,R.useRouter)(),{id:x}=g.query,{workspace:m}=(0,V.cF)(),f=(0,p.useCallback)(()=>{if(!n)return;let e=n.contentDocument;if(!t||!e)return;let l=r.current?{...r.current}:null;h(!0);let i=(0,e9.Z)({el:t}),s=(0,e6.Ti)({el:t}),handleScreenshot=async e=>{if(!e||!d)return;let{url:t,screenshotHeight:n,screenshotWidth:r,pixelRatio:c}=e;a({type:"set-selector",payload:{stepIndex:d.stepIndex,target:d.target,targetIndex:d.targetIndex,selector:{imageUrl:t,dimensions:{top:s.top,right:s.right,bottom:s.bottom,left:s.left,width:s.width,height:s.height,x:s.x,y:s.y},freeSelectDimensions:l,screenshotHeight:Math.floor(n),screenshotWidth:Math.floor(r),pixelRatio:c,nv_id:i.nv_id,nv_roots:i.nv_roots}}}),(0,e7.l)({workspaceId:m.id,guideId:x,base64Data:t}).then(e=>{a({type:"set-selector-image-url",payload:{url:null!=e?e:"",...d}})}),o(),h(!1)};(0,e7.X)({playerFrame:n,callback:handleScreenshot})},[n,t,r,d,a,m.id,x,o]),v=!!(s===eZ.vm.Position&&r.current);return(0,u.jsx)(AnchorSelectorBar,{selectedElement:t,disabled:!t,handleSave:f,handleSelectElement:i,showTraverseButtons:l,isSaving:c,isFreeSelecting:v})}function AnchorSelectorBar(e){let{selectedElement:t,disabled:n,handleSave:l,isSaving:r,handleSelectElement:a,showTraverseButtons:o=!0,isFreeSelecting:i=!1}=e,{selectAnchorMode:s,capture:d}=(0,eZ.nW)();return(0,u.jsxs)("div",{className:"flex h-16 w-full items-center justify-between bg-slate-50 px-5",children:[(0,u.jsxs)("div",{className:"flex-1 text-[14px] font-medium text-slate-500",children:["Selecting ",s," anchor"]}),(0,u.jsxs)("div",{className:"flex items-center gap-x-5",children:[t&&a&&(0,u.jsxs)("div",{className:"flex h-full items-center gap-x-3 rounded-md px-2 py-1".concat(o?" border bg-white":""),children:[(0,u.jsx)("span",{className:"rounded bg-blue-100 px-2.5 py-1 text-sm font-medium uppercase text-blue-800",children:null==t?void 0:t.nodeName}),o&&s!==eZ.vm.Input&&(0,u.jsx)(e8.Z,{selectedElement:t,onSelectElement:a})]}),(0,u.jsx)("div",{className:"flex flex-1 justify-end",children:(0,u.jsx)("button",{disabled:n||r,className:"btn-blue",onClick:()=>{i&&ed.Z.track("free_select_anchor_saved",{captureId:null==d?void 0:d.id}),ed.Z.track("element_selected"),l()},children:r?"Saving anchor":"Save anchor"})})]})]})}var Builder_WebCaptureModal=e=>{var t,n;let{capture:l,handleChange:r}=e,{closeCaptureModal:a,selectAnchorMode:o,allowedTagsForSelection:i,setSelectAnchorMode:s}=(0,eZ.nW)(),[{data:d}]=(0,eG.A)({variables:{id:l.id}}),c=null!==(n=null==d?void 0:d.getWebBasedCapture)&&void 0!==n?n:void 0,h=(0,p.useRef)(null),{built:g,fetching:x,error:m,rebuild:f}=(0,e$.Z)({nodeKey:null==c?void 0:null===(t=c.version)||void 0===t?void 0:t.nodeKey,playerElement:h.current,pause:!l}),[v,y]=(0,p.useState)(!1),[b,j]=(0,p.useState)(),w=(0,p.useRef)(null),C=(0,p.useRef)(!1),S=(0,p.useRef)(!1),k=!!(g&&(null==c?void 0:c.id)&&h.current),E=o===eZ.vm.Element||o===eZ.vm.Input,N=g&&E&&!C.current,[B,I]=(0,p.useState)(,T=E?eJ.L.ViewOnly:B,R=(0,p.useCallback)(e=>{let{el:t}=e;S.current=!0,j(t)},[]),F=(0,p.useCallback)(()=>{I(eJ.L.View),j(void 0),w.current=null,C.current=!1,S.current=!1,null==a||a()},[a]),_=(0,p.useCallback)(e=>{let{isOverFreeSelectElement:t}=e;if(!o||o===eZ.vm.None||o===eZ.vm.Input||S.current)return;let n=(0,eQ.VB)(e);t?(j(n),null==s||s(eZ.vm.Position)):C.current||(j(void 0),null==s||s(eZ.vm.Element))},[o,s]),L=(0,p.useCallback)([]);return(0,u.jsx)(em.Z,{open:!0,handleClose:F,hideFooter:!0,isRaw:!0,children:(0,u.jsxs)(eq.Z,{children:[(0,u.jsxs)(e4,{mode:T,ref:h,capture:c,handleClose:F,onClickEdit:fetchingOrBuilding:!g||x,errorMessage:m,children:[N&&(0,u.jsx)(eY.Z,{root:h.current,anchorEl:b,onSelect:R,allowedTags:i,style:{boxShadow:"0 0 4px 0 rgba(124, 148, 166, 0.8), 0 0 0 1000vw rgba(218, 228, 235, 0.7)"}}),N&&b&&(0,u.jsx)(eY.Z,{root:h.current,onSelect:R,allowedTags:i,style:{boxShadow:"0 0 4px 0 rgba(124, 148, 166, 0.4)"}}),(0,u.jsx)(ElementFreeSelector,{element:b,playerFrameRef:h,isPlayerLoaded:g,isOpen:k,onPlayerMouseMove:_,onChange:L})]}),o!==eZ.vm.None&&(0,u.jsx)(WebAnchorSelectorBar,{handleChange:r,selectedElement:b,freeSelectDimensionsRef:w,showTraverseButtons:o===eZ.vm.Element,playerFrame:h.current,handleClose:F,handleSelectElement:R})]})})};function CaptureModal(e){let{handleChange:t}=e,{capture:n}=(0,eZ.nW)();return n?n.type===S.TG.Web?(0,u.jsx)(Builder_WebCaptureModal,{capture:n,handleChange:t}):(0,u.jsx)(MediaCaptureModal,{capture:n,handleChange:t}):null}var te=n(19627),tt=n(31899);function CreateCollectionModal(e){let{projectId:t}=e,{collectionNewModalOpen:n,closeNewCollectionModal:l}=(0,tt.ST)();return t?(0,u.jsx)(te.Z,{projectId:t,open:n,handleClose:l}):null}var tn=n(27783);let BulkEditorButton=e=>{let{flowDoc:t,canEdit:n,handleChange:l,dispatchFlowBuilder:r}=e,{openSidePanel:a,closeSidePanel:o}=(0,j.u)(),i=(0,V.T4)(S.TT.MassEditor);return i&&n&&t?(0,u.jsxs)("button",{className:"mr-3 flex items-center gap-1.5 px-1 py-2 text-sm font-medium text-gray-400 hover:text-gray-300",onClick:()=>{a({panelType:"BULK_EDITOR",props:{flowDoc:t,handleChange:l,dispatchFlowBuilder:r,handleClose:o}}),ed.Z.track("bulk_editor_opened")},children:[(0,u.jsx)(C.cMY,{className:"h-3.5 w-3.5 text-gray-400"}),"Bulk Editor"]}):null};var tl=n(15127),BuilderNav_PreviewFlowButton=e=>{let{flow:t,language:n}=e,{workspace:l}=(0,V.cF)(),r=(0,V.NK)(l,S.TT.Multilingual),a=r?n:void 0,o=(0,p.useCallback)(()=>window.open((0,K.U4)(null==t?void 0:t.id,void 0,a)),[null==t?void 0:t.id,a]);return(0,u.jsxs)("button",{onClick:o,className:"inline-flex items-center rounded-md border border-gray-500 px-3 py-1 text-base font-medium text-white shadow-sm",children:[(0,u.jsx)(C.xiD,{className:"mr-1 h-2.5 w-2.5 text-gray-300"}),"Preview"]})},tr=n(27907),ta=n(2715),to=n(66547),ti=n(26806);function updateFlowName_templateObject(){let e=(0,x._)(["\n    mutation UpdateFlowName($flowId: String!, $name: String!) {\n  updateFlowName(flowId: $flowId, name: $name) {\n    id\n    name\n  }\n}\n    "]);return updateFlowName_templateObject=function(){return e},e}let ts=(0,to.ZP)(updateFlowName_templateObject());function FlowBuilderNav(e){var t,n;let{flow:l,canEdit:r,isDirty:a,isSaving:o,concurrentEditingWarningText:i,saveDraft:s,heightClass:d,handleChange:c,dispatchFlowBuilder:p,flowBuilderState:h}=e,[,g]=ti.Db(ts),x=!a&&!o,m=function(e){let{isSaving:t,isWarningVisible:n}=e;return n?"Save conflict":t?"Saving...":"Draft saved"}({isSaving:o,isWarningVisible:!!i});return(0,u.jsxs)(tn.Z,{heightClass:d,concurrentEditingWarningText:i,children:[l?(0,u.jsx)(tn.o,{itemName:l.name,onItemNameChange:):(0,u.jsx)("div",{}),(0,u.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,u.jsx)(tl.Z,{selectedLanguage:h.language,onChange:e=>{p({type:"set-language",payload:{language:e}}),ed.Z.track("product_demo_multilingual_flow_edited",{language:e})}}),(0,u.jsx)(BulkEditorButton,{flowDoc:null==l?void 0:null===(t=l.editVersion)||void 0===t?void 0:t.doc,canEdit:r,handleChange:c,dispatchFlowBuilder:p}),(0,u.jsx)(tr.H,{flowDoc:null==l?void 0:null===(n=l.editVersion)||void 0===n?void 0:n.doc,flowBuilderState:h,canEdit:r,handleChange:c}),(0,u.jsx)("div",{className:"w-20 text-sm text-gray-500",children:m}),(0,u.jsxs)("div",{className:"flex gap-x-2",children:[l&&(0,u.jsx)(BuilderNav_PreviewFlowButton,{flow:l,language:h.language}),r&&(0,u.jsx)(ta.Z,{documentType:"flow",upToDate:x,saveDraft:s,disabled:!!i})]})]})]})}var td=n(17415),tc=n(43744),tu=n(52484),tp=n(82057);let th="top-12";function FlowBuilderLayout(e){var t,n,l;let{isSaving:r,isDirty:a,canEdit:o,concurrentEditingWarningText:i,flow:s,flowBuilderState:d,handleChange:c,dispatchFlowBuilder:p,saveDraft:h,fetching:g,children:x}=e,{dialogFontFamily:m,dialogFontUrl:f}=(null==s?void 0:null===(l=s.editVersion)||void 0===l?void 0:null===(n=l.doc)||void 0===n?void 0:null===(t=n.theme)||void 0===t?void 0:t.published)||{};return(0,tu.j)({fontFamily:m,url:f}),(0,u.jsx)(eZ.ZP,{children:(0,u.jsxs)(tt.ZP,{children:[(0,u.jsx)(FlowBuilderNav,{handleChange:c,dispatchFlowBuilder:p,flowBuilderState:d,heightClass:"h-12",flow:s,canEdit:o,concurrentEditingWarningText:i,isDirty:a,saveDraft:h,isSaving:r}),g?(0,u.jsx)("div",{className:(0,E.AK)("fixed bottom-0 h-full w-full",th),children:(0,u.jsx)(eV.Z,{})}):(0,u.jsx)(td.Z,{topClassName:th,"data-attr":"guide-builder-scroll-container",children:x}),(0,u.jsx)(tc.Z,{}),(0,u.jsx)(tp.Z,{flowBuilderState:d}),(0,u.jsx)(CaptureModal,{handleChange:c}),(0,u.jsx)(CreateCollectionModal,{projectId:null==s?void 0:s.projectId})]})})}var tg=n(38524),tx=n(97185),tm=n(22918),tf=n(81291),tv=n(54532);et ty=(0,to.ZP)(updateEditFlowVersion_templateObject());var tb=n(68793),tj=n(59606);et tw=(0,to.ZP)(projectFlowDraft_templateObject(),tj.V);var tC=n(44565),tS=n(69260),tk=n(49830),tE=n(5546);let tN=new tC.d(1e3);function FlowBuilderPage(){var e;let t=(0,R.useRouter)(),n=(0,E.H8)(t.query),l=n.id,r=n.workspace_slug,[{data:a,fetching:o,error:i}]=(e={variables:{data:{projectId:l,flowId:n.flow_id}},requestPolicy:"network-only"},ti.aM({query:tw,...e})),[{data:s}]=(0,tb.N)({variables:{projectId:l}}),d=null==s?void 0:s.projectDefaultLanguage,[c,x]=(0,p.useState)(0),[m,f]=(0,p.useState)(-1),[v,y]=(0,p.useState)(!1),[b,w]=(0,p.useState)(!1),[C,N]=(0,p.useState)(),[,B]=ti.Db(ty),[I,T]=(0,p.useReducer)(g.Z,null==a?void 0:a.projectFlowDraft),[F,_]=(0,p.useReducer)(flowBuilderReducer,function(e){let{flow:t,language:n}=e;return{flow:t,selectingSteps:!1,selectedStepIndices:new Set,language:n}}({flow:I,language:d})),L=(0,p.useRef)(),[A,P]=(0,p.useState)(null),[D]=(0,p.useState)(tk.MW),M=(0,V.j_)(S.KG.Projects),O=M===S.KA.Edit,Z=c-1>m;(0,p.useEffect)(()=>{(null==a?void 0:a.projectFlowDraft)&&!(null==I?void 0:I.id)&&T({type:"set-flow",payload:a.projectFlowDraft})},[a,null==I?void 0:I.id]),(0,p.useEffect)(()=>{d&&!F.language&&_({type:"set-language",payload:{language:d}})},[F.language,d]),(0,p.useEffect)(()=>{var e,t;!L.current&&(null==a?void 0:null===(t=a.projectFlowDraft)||void 0===t?void 0:null===(e=t.editVersion)||void 0===e?void 0:e.entityTag)&&(L.current=a.projectFlowDraft.editVersion.entityTag)},[a]),(0,p.useEffect)([i]);let W=(0,p.useCallback)(e=>{T({type:"set-flow",payload:e}),x(},[]),K=(0,p.useCallback)(async()=>{let e=await D.acquire();try{var t,n;let e=c-1;if(f(e),!I)return;let{id:l,editVersion:a}=I,o=null==a?void 0:a.doc,{theme:i,...s}=o||{},d=JSON.parse(JSON.stringify(s));(0,k.lJ)(d),(0,k.ww)(d);let u=await B({flowId:l,flowVersion:{doc:d},lastEntityTag:L.current});if(u.error)return(e=>{var t,n;let l=null===(t=e.graphQLErrors)||void 0===t?void 0:t.find(;if(l){ed.Z.track("concurrency_warning",{workspaceSlug:r});let e=l.extensions.lastEditedBy;P("".concat(e," has made new changes"));return}let a="Error saving flow draft";console.error(e),(0,U.Rn)(a),tE.u.error(a,{workspace_slug:null!=r?r:null,guideId:null!==(n=null==I?void 0:I.id)&&void 0!==n?n:null,error:e.message})})(u.error),u;let p=null===(n=u.data)||void 0===n?void 0:null===(t=n.updateEditFlowVersion)||void 0===t?void 0:t.entityTag;return L.current=p,u}finally{D.release(e)}},[c,I,D,B,r]),z=(0,p.useCallback)(async()=>(await D.isAvailable(),tN.call(async()=>{if(!A)try{return y(!0),await K()}finally{y(!1)}})),[A,D,K]),H=(0,p.useCallback)(()=>(y(!0),Z)?z():tN.promise,[Z,z]);(0,p.useEffect)(()=>{let e=c-1;e!==m&&z()},[z,m,c]),(0,p.useEffect)(()=>{let handleRouteChange=e=>{if(Z)throw N(e),w(!0),t.events.emit("routeChangeError"),"routeChange aborted. This error can be safely ignored - https://github.com/zeit/next.js/issues/2476."};return t.events.on("routeChangeStart",handleRouteChange),,[t.events,Z]);let X=(0,p.useCallback)(e=>{var t,n,l;T(e),I&&((null==I?void 0:null===(l=I.editVersion)||void 0===l?void 0:null===(n=l.doc)||void 0===n?void 0:null===(t=n.steps)||void 0===t?void 0:t.length)&&(I.editVersion.doc.steps=(0,k.yz)(I.editVersion.doc.steps)),W(I))},[I,W]),q=I||(null==a?void 0:a.projectFlowDraft);return(0,u.jsx)(j.Z,{dispatchFlowBuilder:_,children:(0,u.jsxs)(tv.Z,{workspaceItem:S.KG.Projects,children:[(0,u.jsx)(tf.Z,{title:(null==q?void 0:q.name)||"Untitled Flow",includeSlug:!0}),(0,u.jsx)(FlowBuilderLayout,{fetching:o,canEdit:O,isSaving:v,isDirty:Z,concurrentEditingWarningText:A,flow:q,flowBuilderState:F,handleChange:X,dispatchFlowBuilder:_,saveDraft:H,children:(0,u.jsx)(FlowBuilder,{canEdit:O,flow:q,flowBuilderState:F,updateFlow:W,handleChange:X,dispatchFlowBuilder:_,selectingSteps:F.selectingSteps,selectedStepIndices:F.selectedStepIndices})}),(0,u.jsx)(h.Z,{saveDraft:z,open:b,handleClose:path:C}),(0,u.jsx)(tm.Z,{}),(0,u.jsx)(tg.Z,{})]})})}FlowBuilderPage.getLayout=function(e){return(0,u.jsx)(tx.Z,{blockLayout:!0,fixedLayout:!0,children:e})};var tB=FlowBuilderPage}},function(e){e.O(0,[3211,8426,3265,1617,4637,5837,696,8834,9391,9623,6349,1732,2865,8842,5634,6548,309,1695,4054,7330,9219,5306,6870,7156,6456,7185,3712,555,5342,7644,4082,7231,4225,1463,9774,2888,179],,_N_E=e.O()}]);
//# sourceMappingURL=builder-c13fdfc6de68edf1.js.map