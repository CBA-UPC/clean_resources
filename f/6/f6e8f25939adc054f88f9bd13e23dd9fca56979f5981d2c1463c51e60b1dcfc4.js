!this,function(){"use strict";function e(){this.elementVisibleTree={},this.report=function(){},this.reportConfig={},this.mutationRecord=[],this.pageConfig=null,this.delay=0}var t=new(e.prototype.checkVisibleAndCurrentPage=e.prototype.checkHideAndCurrentPage=function(e,t){return!this.checkDomIsVisibility(e)&&this.checkPageIsReportPage(t)},e.prototype.checkPageIsReportPage=function(e){var r=this.pageConfig;if(!r)return!0;if(!e)return!1;var o=location.href||"";return"*"===e||("string"==typeof e&&(e=[e]),!(!Array.isArray(e)||!e.length)&&e.some(function(e){var t=r[e];if("string"==typeof t)return new RegExp(t).test(o);e=null==t?void 0:t.path;return t&&t.exact?e&&e===o:!(!t||t.exact)&&(e&&new RegExp(e).test(o))}))},e.prototype.checkDomIsVisibility=function(e){e=window.getComputedStyle(e,null);return"0"!==e.width&&"0"!==e.height&&"0"!==e.opacity&&"none"!==e.display&&"hidden"!==e.visibility},e.prototype.classifyReport=function(t,r){var o=this,e=t.report,e=void 0===e?"midasbuy":e;"string"==typeof e&&(e=[e]),Array.isArray(e)&&e.forEach(function(e){o.classifyAction(e,r,t)})},e.prototype.classifyAction=function(t,e,r){var o=this,i=r.action,e=i&&i[t]||i||e;"string"==typeof e&&(e=[e]),Array.isArray(e)&&e.forEach(},e.prototype.handleReport=function(e,t,r){var o=r.format,i=r.params,r=this.getReportParams(e,i),i=this.report;"function"==typeof i&&i({action:t,format:o,params:r,reportTo:e})},e.prototype.getReportParams=function(e,t){return"string"==typeof(t=t&&t[e]?t[e]:t)&&(t=[t]),Array.isArray(t)?t:[]},e.prototype.loopSeletor=function(e,t){var r=[];Array.isArray(e)?r=e:r.push(e),r.forEach(},e.prototype.changeChildList=function(e,i){var n=this;i=i||{};for(var t=Object.keys(i),r=0,o=e.addedNodes;r<o.length;r++)!function(o){if(!(o instanceof HTMLElement))return;t.forEach(function(r){n.loopSeletor(i[r],function(e){var t=e.page;o.matches(r)&&n.checkVisibleAndCurrentPage(o,t)&&(n.addReportId(o,r,t),n.changeElementVisibleTree(r,!0),n.classifyReport(e,"view"))})})}(o[r]);for(var s=0,a=e.removedNodes;s<a.length;s++)!function(r){if(!(r instanceof HTMLElement))return;t.forEach(function(t){n.loopSeletor(i[t],function(e){e=e.page;!document.querySelector(t)&&r.dataset.reportid===n.getReportId(t,e)&&n.checkPageIsReportPage(e)&&n.changeElementVisibleTree(t,!1)})})}(a[s])},e.prototype.changeAttributes=function(e,t){var n=this,s=e.target;s&&(t=t||{},Object.keys(t).forEach(function(i){n.loopSeletor(t[i],function(t){var r=t.page;s.matches(i)&&n.handleChangeAttributes(t,i,s,r);var e=s.querySelectorAll(i),o=!1;e&&e.forEach(function(e){o=o||n.handleChangeAttributes(t,i,e,r)})})}))},e.prototype.changeElementVisibleTree=e.prototype.handleChangeAttributes=function(e,t,r,o){return!this.elementVisibleTree[t]&&this.checkVisibleAndCurrentPage(r,o)?(this.changeElementVisibleTree(t,!0),this.classifyReport(e,"view"),!0):(this.elementVisibleTree[t]&&this.checkHideAndCurrentPage(r,o)&&this.changeElementVisibleTree(t,!1),!1)},e.prototype.traverseAndHandleDom=function(e,t,r){var o=document.getElementsByTagName("body")[0];t&&(t.matches(r)?this.classifyReport(e,"click"):t!==o&&(t=t.parentNode,this.traverseAndHandleDom(e,t,r)))},e.prototype.observeBody=function(t){var i=this,e=document.getElementsByTagName("body")[0];e?e.addEventListener("click",function(e){var o=e.target;o&&(t=t||{},Object.keys(t).forEach(function(r){i.loopSeletor(t[r],function(e){var t=e.page;i.checkPageIsReportPage(t)&&i.traverseAndHandleDom(e,o,r)})}))},!0):window.setTimeout(function(){i.observeBody(t)},100)},e.prototype.observeCallback=function(n,s){var a=this;return function(e){for(var o={childList:a.changeChildList,attributes:a.changeAttributes,characterData:function(){}},i=["childList","attributes","characterData"],t=0,r=e;t<r.length;t++)!function(e){if(!0===s)return a.mutationRecord.push(e);var t,r=e.type;i.includes(r)&&(t=o[r].bind(a),setTimeout(1e3))}(r[t])}},e.prototype.observeDom=function(e,t){var r=document.body||document.documentElement,t=this.observeCallback(e,t).bind(this);new MutationObserver(t).observe(r,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["class","style"]})},e.prototype.getReportId=function(e,t){var r="";return""+(r=t?Array.isArray(t)?t.join("-"):t:r)+e.split(" ").join("")},e.prototype.addReportId=function(e,t,r){var o="";r&&(o=Array.isArray(r)?r.join("-"):r),e.dataset.reportid=""+o+t.split(" ").join("")},e.prototype.beforeObserve=function(e){var i=this;Object.keys(e).forEach(function(o){i.loopSeletor(e[o],function(e){var t=e.page,r=document.querySelector(o);r&&r instanceof HTMLElement&&(i.addReportId(r,o,t),i.checkVisibleAndCurrentPage(r,t)&&(i.changeElementVisibleTree(o,!0),i.classifyReport(e,"view")))})})},e.prototype.startObserve=function(e){if(this.reportConfig){var t=this.reportConfig,r=t.click,r=void 0===r?{}:r,t=t.view,t=void 0===t?{}:t;if(!e)return this.observeBody(r),void this.observeDom(t);"click"===e?this.observeBody(r):this.observeDom(t)}},e.prototype.init=function(e){var t,r,o;e&&"object"==typeof e&&(t=e.report,r=e.pages,o=e.config,e=void 0===(e=e.delay)?0:e,this.report=void 0===t?t,this.reportConfig=o,this.pageConfig=r,this.delay=e)},e.prototype.observe=function(e){var t,r=this;this.reportConfig&&(t=this.reportConfig.view,this.beforeObserve(void 0===t?{}:t),this.delay?setTimeout(this.delay):this.startObserve(e))},e);return window.autoReport=t});
//# sourceMappingURL=auto-report2.0.2.umd.js.map
