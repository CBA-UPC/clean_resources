!this,function(f){"use strict";f=f&&f.hasOwnProperty("default")?f.default:f;unction d(e,t,n){s(0,n),e.trigger({type:t+n.type,originalEvent:n})}function l(e){var t,n,o,a,r,i;"playing"===e.type?(i=e,(r=this).ads.isInAdMode()&&(r.ads.isContentResuming()?r.ads._contentEnding&&d(r,"content",i):d(r,"ad",i))):"ended"===e.type?(a=e,(o=this).ads.isInAdMode()?o.ads.isContentResuming()?(s(0,a),o.trigger("resumeended")):d(o,"ad",a):o.ads._contentHasEnded||(d(o,"content",a),o.trigger("readyforpostroll"))):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?this,e):"play"===e.type?(n=e,(t=this).ads.inAdBreak()?d(t,"ad",n):t.ads.isContentResuming()&&d(t,"content",n)):this.ads.isInAdMode()&&(this.ads.isContentResuming()?d(this,"content",e):d(this,"ad",e))}var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},u="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t={},n=(Object.freeze||Object)({default:t}),o=n?t:n,a=void 0!==e?e:"undefined"!=typeof window?window:{},c="undefined"!=typeof document?document:a["__GLOBAL_DOCUMENT_CACHE@4"]||(a["__GLOBAL_DOCUMENT_CACHE@4"]=o),p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?"function"==typeof Symbol&&Symbol.asyncIterator&&(r.prototype[Symbol.asyncIterator]=,r.prototype.next=function(e){return this._invoke("next",e)},r.prototype.throw=function(e){return this._invoke("throw",e)},r.prototype.return=on m(e,t,n){if(e&&e[n])for(var o=e[n],a=Object.keys(o),r=0;r<a.length;r++){t["{mediainfo."+n+"."+a[r]+"}"]=o[a[r]]}}var A={processMetadataTracks:setMetadataTrackMode:getSupportedAdCue:isSupportedAdCue:getCueId:;function _(){var e=this;!1!==e.ads._shouldBlockPlay&&(e.paused()||(e.ads.debug("Playback was canceled by cancelContentPlay"),e.pause()),e.ads._cancelledPlay=!0)}A.processAdTrack=function(e,t,n,o){e.ads.includedCues={};for(var a=0;a<t.length;a++){var r=t[a],i=this.getSupportedAdCue(e,r);if(!this.isSupportedAdCue(e,r))return void f.log.warn("Skipping as this is not a supported ad cue.",r);var s=this.getCueId(e,r),d=r.startTime;if(c=e,void 0!==(p=s)&&c.ads.includedCues[p])return void f.log("Skipping ad already seen with ID "+s);o&&o(e,i,s,d),n(e,i,s,d),l=e,void 0!==(u=s)&&""!==u&&(l.ads.includedCues[u]=!0)}var l,u,c,p};var b={},k=f;b.isMiddlewareMediatorSupported=b.playMiddleware=function(t){return{setSource:callPlay:play:function(e){t.ads&&t.ads._playBlocked&&e&&(t.ads.debug("Play call to Tech was terminated."),t.trigger("play"),t.addClass("vjs-has-started"),t.ads._playBlocked=!1)}}},b.testHook=var T=(C._getName=function(){return"Anonymous State"},C.prototype.transitionTo=function(e){var t=this.player;this.cleanup(t);var n=new e(t);t.ads._state=n,t.ads.debug(this.constructor._getName()+" -> "+n.constructor._getName());for(var o=arguments.length,a=Array(1<o?o-1:0),r=1;r<o;r++)a[r-1]=arguments[r];n.init.apply(n,[t].concat(a))},C.prototype.init=function(){},C.prototype.cleanup=function(){},C.prototype.onPlay=function(){},C.prototype.onPlaying=function(){},C.prototype.onEnded=function(){},C.prototype.onAdsReady=function(){f.log.warn("Unexpected adsready event")},C.prototype.onAdsError=function(){},C.prototype.onAdsCanceled=function(){},C.prototype.onAdTimeout=function(){},C.prototype.onAdStarted=function(){},C.prototype.onContentChanged=function(){},C.prototype.onContentResumed=function(){},C.prototype.onReadyForPostroll=function(){f.log.warn("Unexpected readyforpostroll event")},C.prototype.onNoPreroll=function(){},C.prototype.onNoPostroll=function(){},C.prototype.startLinearAdMode=function(){f.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},C.prototype.endLinearAdMode=function(){f.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},C.prototype.skipLinearAdMode=C.prototype.isAdState=C.prototype.isWaitingForAdBreak=function(){return!1},C.prototype.isContentResuming=function(){return!1},C.prototype.inAdBreak=function(){return!1},C.prototype.handleEvent=function(e){var t=this.player;"play"===e?this.onPlay(t):"adsready"===e?this.onAdsReady(t):"adserror"===e?this.onAdsError(t):"adscanceled"===e?this.onAdsCanceled(t):"adtimeout"===e?this.onAdTimeout(t):"ads-ad-started"===e?this.onAdStarted(t):"contentchanged"===e?this.onContentChanged(t):"contentresumed"===e?this.onContentResumed(t):"readyforpostroll"===e?this.onReadyForPostroll(t):"playing"===e?this.onPlaying(t):"ended"===e?this.onEnded(t):"nopreroll"===e?this.onNoPreroll(t):"nopostroll"===e&&this.onNoPostroll(t)},C);ar P,S=(y(w,P=T),w.prototype.isAdState=function(){return!0},w.prototype.onPlaying=function(){this.contentResuming&&this.transitionTo(G)},w.prototype.onContentResumed=w.prototype.isWaitingForAdBreak=function(){return this.waitingForAdBreak},w.prototype.isContentResuming=w.prototype.inAdBreak=w);function w(e){i(this,w);var t=g(this,P.call(this,e));return t.contentResuming=!1,t.waitingForAdBreak=!1,t}var R,L=(y(B,R=T),B.prototype.isAdState=B.prototype.onContentChanged=B);function B(){return i(this,B),g(this,R.apply(this,arguments))}var M=void 0;function j(n,o,e){if(void 0===e&&(e=function(){}),!0===n.ads.disableNextSnapshotRestore)return n.ads.disableNextSnapshotRestore=!1,void e();function t(){for(var e=0;e<d.length;e++)(l=d[e]).track.mode=l.mode}function a(){var e=void 0;if(f.browser.IS_IOS&&n.ads.isLive(n))o.currentTime<0&&(e=0<n.seekable().length?n.seekable().end(0)+o.currentTime:n.currentTime(),n.currentTime(e));else if(o.ended)n.currentTime(n.duration());else{n.currentTime(o.currentTime);var t=n.play();t&&t.catch&&t.catch(function(e){f.log.warn("Play promise rejected in snapshot resume",e)})}n.ads.shouldRemoveAutoplay_&&(n.autoplay(!1),n.ads.shouldRemoveAutoplay_=!1)}function r(){if(n.off("contentcanplay",r),M&&n.clearTimeout(M),1<(i=n.el().querySelector(".vjs-tech")).readyState)return a();if(void 0===i.seekable)return a();if(0<i.seekable.length)return a();if(s--)n.setTimeout(r,50);else try{a()}catch(e){f.log.warn("Failed to resume the content after an advertisement",e)}}var i=n.$(".vjs-tech"),s=20,d=o.suppressedTracks,l=void 0;if("style"in o&&i.setAttribute("style",o.style||""),n.ads.videoElementRecycled())n.one("resumeended",e),n.one("contentloadedmetadata",t),f.browser.IS_IOS&&!n.autoplay()&&(n.autoplay(!0),n.ads.shouldRemoveAutoplay_=!0),n.src({src:o.currentSrc,type:o.type}),n.one("contentcanplay",r),M=n.setTimeout(r,2e3);else{if(t(),!n.ended()){var u=n.play();u&&u.catch&&u.catch(function(e){f.log.warn("Play promise rejected in snapshot restore",e)})}e()}}var E,N={start:function(e){e.ads.debug("Starting ad break"),e.ads._inLinearAdMode=!0,e.trigger("adstart"),e.ads.shouldPlayContentBehindAd(e)||(e.ads.snapshot=function(e){var t=void 0;t=f.browser.IS_IOS&&e.ads.isLive(e)&&0<e.seekable().length?e.currentTime()-e.seekable().end(0):e.currentTime();var n=e.$(".vjs-tech"),o=e.textTracks?e.textTracks():[],a=[],r={ended:e.ended(),currentSrc:e.currentSrc(),src:e.tech_.src(),currentTime:t,type:e.currentType()};n&&(r.style=n.getAttribute("style"));for(var i=0;i<o.length;i++){var s=o[i];a.push({track:s,mode:s.mode}),s.mode="disabled"}return r.suppressedTracks=a,r}(e)),e.ads.shouldPlayContentBehindAd(e)&&(e.ads.preAdVolume_=e.volume(),e.volume(0)),e.addClass("vjs-ad-playing"),e.hasClass("vjs-live")&&e.removeClass("vjs-live"),e.ads.removeNativePoster()},end:function(e,t){e.ads.debug("Ending ad break"),void 0===t&&(t=function(){}),e.ads.adType=null,e.ads._inLinearAdMode=!1,e.trigger("adend"),e.removeClass("vjs-ad-playing"),e.ads.isLive(e)&&e.addClass("vjs-live"),e.ads.shouldPlayContentBehindAd(e)?(e.volume(e.ads.preAdVolume_),t()):j(e,e.ads.snapshot,t)}},I=(y(x,E=S),x._getName=function(){return"Preroll"},x.prototype.init=x.prototype.onAdsReady=x.prototype.handleAdsReady=x.prototype.afterLoadStart=x.prototype.noPreroll=x.prototype.readyForPreroll=x.prototype.onAdsCanceled=x.prototype.onAdsError=x.prototype.startLinearAdMode=function(){var e=this.player;!this.adsReady||e.ads.inAdBreak()||this.isContentResuming()?f.log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(e.clearTimeout(this._timeout),e.ads.adType="preroll",this.waitingForAdBreak=!1,N.start(e),e.ads._shouldBlockPlay=!1)},x.prototype.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},x.prototype.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(e.removeClass("vjs-ad-loading"),e.addClass("vjs-ad-content-resuming"),N.end(e),this.contentResuming=!0)},x.prototype.skipLinearAdMode=x.prototype.onAdTimeout=x.prototype.onNoPreroll=x.prototype.resumeAfterNoPreroll=x.prototype.cleanup=x);function x(){return i(this,x),g(this,E.apply(this,arguments))}var O,D=(y(F,O=S),F._getName=function(){return"Midroll"},F.prototype.init=F.prototype.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},F.prototype.endLinearAdMode=F.prototype.onAdsError=F.prototype.cleanup=F);function F(){return i(this,F),g(this,O.apply(this,arguments))}var U,V=(y(H,U=S),H._getName=function(){return"Postroll"},H.prototype.init=function(e){if(this.waitingForAdBreak=!0,e.ads._contentEnding=!0,e.ads.nopostroll_)this.resumeContent(e),this.transitionTo(K);else{e.addClass("vjs-ad-loading");var t=e.ads.settings.timeout;"number"==typeof e.ads.settings.postrollTimeout&&(t=e.ads.settings.postrollTimeout),this._postrollTimeout=e.setTimeout(function(){e.trigger("adtimeout")},t)}},H.prototype.startLinearAdMode=H.prototype.onAdStarted=H.prototype.endLinearAdMode=function(){var e=this,t=this.player;this.inAdBreak()&&(t.removeClass("vjs-ad-loading"),this.resumeContent(t),N.end(t,)},H.prototype.skipLinearAdMode=H.prototype.onAdTimeout=function(e){e.ads.debug("Postroll abort (adtimeout)"),this.abort(e)},H.prototype.onAdsError=H.prototype.onContentChanged=function(){this.isContentResuming()?this.transitionTo(W):this.inAdBreak()||this.transitionTo(I)},H.prototype.onNoPostroll=H.prototype.resumeContent=H.prototype.abort=H.prototype.cleanup=H);function H(){return i(this,H),g(this,U.apply(this,arguments))}var q,W=(y(z,q=L),z._getName=function(){return"BeforePreroll"},z.prototype.init=z.prototype.onAdsReady=function(e){e.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},z.prototype.onPlay=z.prototype.onAdsCanceled=z.prototype.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)"),this.shouldResumeToContent=!0},z.prototype.onNoPreroll=z.prototype.skipLinearAdMode=z.prototype.onContentChanged=z);function z(){return i(this,z),g(this,q.apply(this,arguments))}var $,G=(y(Y,$=L),Y._getName=function(){return"ContentPlayback"},Y.prototype.init=Y.prototype.onAdsReady=Y.prototype.onReadyForPostroll=Y.prototype.startLinearAdMode=Y);function Y(){return i(this,Y),g(this,$.apply(this,arguments))}var J,K=(y(Q,J=L),Q._getName=Q.prototype.init=Q.prototype.startLinearAdMode=Q);unction X(e){var t,n,o,a=this,r=f.mergeOptions(ne,e),i=te.concat(["firstplay","loadedalldata","playing"]);function s(){var e=a.textTracks();if(!a.ads.shouldPlayContentBehindAd(a)&&a.ads.inAdBreak()&&a.tech_.featuresNativeTextTracks&&f.browser.IS_IOS&&!Array.isArray(a.textTracks()))for(var t=0;t<e.length;t++){var n=e[t];"showing"===n.mode&&(n.mode="disabled")}}a.on(i,l),ee()&&r.debug?f.log("ADS:","Play middleware has been registered with videojs"):(t=a,r.debug&&f.log("ADS:","Using cancelContentPlay to block content playback"),t.on("play",_)),a.setTimeout(5e3),a.on("ended",,a.on("contenttimeupdate",,a.on(["addurationchange","adcanplay"],,a.on("nopreroll",function(){a.ads.debug("Received nopreroll event"),a.ads.nopreroll_=!0}),a.on("nopostroll",,a.on("playing",,a.on("play",function(){a.ads._playRequested=!0}),a.one("loadstart",function(){a.ads._hasThereBeenALoadStartDuringPlayerLife=!0}),a.on("loadeddata",function(){a.ads._hasThereBeenALoadedData=!0}),a.on("loadedmetadata",,a.ads=(n=a,{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:"6.4.1",reset:startLinearAdMode:function(){n.ads._state.startLinearAdMode()},endLinearAdMode:function(){n.ads._state.endLinearAdMode()},skipLinearAdMode:stitchedAds:videoElementRecycled:isLive:function(e){return"boolean"==typeof e.ads.settings.contentIsLive?e.ads.settings.contentIsLive:e.duration()===1/0||"8"===f.browser.IOS_VERSION&&0===e.duration()},shouldPlayContentBehindAd:function(e){return!f.browser.IS_IOS&&!f.browser.IS_ANDROID&&e.duration()===1/0},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:removeNativePoster:debug:),a.ads.settings=r,a.ads._state=new W(a),a.ads._state.init(a),a.ads.stitchedAds(r.stitchedAds),a.ads.cueTextTracks=A,a.ads.adMacroReplacement=function(e,s,t){var n=this,d={};e=e.replace(/{([^}=]+)=([^}]+)}/g,,void 0===s&&(s=!1);var o={};for(var a in void 0!==t&&(o=t),o["{player.id}"]=this.options_["data-player"],o["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",o["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",o["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",o["{player.duration}"]=this.duration(),o["{timestamp}"]=(new Date).getTime(),o["{document.referrer}"]=c.referrer,o["{window.location.href}"]=u.location.href,o["{random}"]=Math.floor(1e12*Math.random()),["description","tags","reference_id","ad_keys"].forEach(,m(this.mediainfo,o,"custom_fields"),m(this.mediainfo,o,"customFields"),o)e=e.split(a).join(v(o[a],s));for(var r in e=e.replace(/{pageVariable\.([^}]+)}/g,function(e,t){for(var n=void 0,o=u,a=t.split("."),r=0;r<a.length;r++)r===a.length-1?n=o[a[r]]:o=o[a[r]];var i=void 0===n?"undefined":p(n);return null===n?"null":void 0===n?d["{pageVariable."+t+"}"]?d["{pageVariable."+t+"}"]:(f.log.warn('Page variable "'+t+'" not found'),""):"string"!==i&&"number"!==i&&"boolean"!==i?(f.log.warn('Page variable "'+t+'" is not a supported type'),""):v(String(n),s)}),d)e=e.replace(r,d[r]);return e}.bind(a),(o=a).ads.contentSrc=o.currentSrc(),o.ads._seenInitialLoadstart=!1,o.on("loadstart",,a.on("contentchanged",a.ads.reset),a.ready(function(){a.textTracks().addEventListener("change",s)}),a.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","ads-ad-started","contentchanged","contentresumed","readyforpostroll","nopreroll","nopostroll"],,a.on("dispose",}var Z=b.playMiddleware,ee=b.isMiddlewareMediatorSupported,te=f.getTech("Html5").Events,ne={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1,contentIsLive:void 0};return(f.registerPlugin||f.plugin)("ads",X),ee()&&f.use("*",Z),X});
