(function(){var h;try{var s=Microsoft.Maps,r=s.Internal,ir=r.__assign,p=r.__extends,rr=r.__spreadArray,u=s.globalConfig,ur=r.coreConfig,f=u.features,fr=f.advertising,er=f.autosuggest,or=f.calendar,n=f.collections,ht=f.directions,sr=f.feedback,hr=f.flyover,cr=f.landmarks3D,lr=f.map3D,ar=f.richMapsInfobox,vr=f.labels,yr=f.layerManager,pr=f.localGuide,wr=f.localSearch,br=f.mapBuilder,kr=f.mapDelay,dr=f.optIn,gr=f.print,nu=f.sharing,tu=f.streetside,iu=f.taskBar,ru=f.taskFramework,uu=f.trafficControl,fu=f.traffic,eu=f.trafficExperiences,ou=f.mapBuilderExperiences,su=f.transit,hu=f.travel,cu=f.xsr,lu=atlas.math,au=atlas.data,vu=atlas.layer,yu=atlas.Pixel,pu=atlas.data.BoundingBox,wu=r.AzureMapEvents,bu=r.AzureMapInteractions,ku=r.Binding,du=r.BoundsAccumulator,gu=r.Debug,rt=r.Gimme,d=r.AtlasHelper,nf=r.EntityHelper,gt=r.Helper,tf=r.LocationRectHelper,w=r.LocalStorageCache,rf=r.LruCache,pt=r.MapMath,fi=r.Network,b=r.JSEvent,uf=r.ObjectWithId,ff=r.Observable,c=r.ObservableCollection,tt=r.ObservableObject,ef=r.Overlay,sf=r.PyramidTileSpatialIndex,hf=r.TaskDataHandlerHelper,cf=r.TileSystemHelper,lf=r.PerfV2Logger,af=r.VectorMath,ni=r.TimeoutWrapper,vf=s.Anchor,yf=s.BingMapStyle,pf=s.Color,ei=s.globalContainer,wf=r.InstrumentationBase,ct=s.LatLonCrs,l=s.Location,bf=r.ObservableObjectChangedArgs,kf=s.Point,df=s.Rectangle,gf=s.ResourceManager,ne=s.SimpleAreaPrimitive,te=s.SimpleLinePrimitive,oi=s.SimplePointPrimitive,ie=s.Size,si=r.TaskData,g=s.ResourceManager.MapCore,a=s.ResourceManager.Collections,re=s.ResourceManager.Travel,wt=s.GlobalDataEventHandler,hi=s.SignInState,ci=si.TravelAttractionEntity,ti=r.UserTipControl,li=r.SaveOnSerpConfirmationTip,ai='<div class="bm_newCollectionRoot cardified myPlacesV2 oneMap" data-tag="newCollectionRoot" event:click="onNameEditBoxClick">    <div class="titleEditEntryRow" data-tag="titleEditEntryRow" style:top="{Binding TopPosition}" style:right="{Binding RightPosition}" style:left="{Binding LeftPosition}">        <div class="newCollectionControlTitle">            <TextBlock Text="{Binding _isSavingTempCollection Converter=getTitleText}" />        <\/div>        <div class="editNicknameText">            <TextBlock Text="{Binding resources.L_NewCollectionTitle}" />        <\/div>        <input type="text" class="nameEditBox nameDescriptionWidth" data-tag="nameEditBox" maxlength="100" value="{Binding TempName Mode=TwoWay}" />        <div class="titleEditSpacingCollection"><\/div>        <div class="editDescriptionText">            <TextBlock Text="{Binding resources.L_DescriptionTitle}" />        <\/div>        <textarea class="descriptionEditBox nameDescriptionWidth" data-tag="descriptionEditBox" placeholder="{Binding resources.L_NewCollectionDescription_Watermark}" contenteditable="true" rows="4" maxlength="1000" value="{Binding TempDescription Mode=TwoWay}"><\/textarea>        <div class="editRowButtonContainer">            <a role="button" class="cancelEditButton commonButtonControl" data-tag="cancelEdit" event:click="onCancelTitleEditClick" href="#" aria-label="{Binding resources.L_CancelTitleEdit}">                <TextBlock Text="{Binding resources.L_CancelButton_Text}" />            <\/a>            <a role="button" class="confirmEditButton commonButtonControl" data-tag="confirmEdit" event:click="onConfirmTitleEditClick" href="#" aria-label="{Binding resources.L_ConfirmTitleEdit}">                <TextBlock Text="{Binding resources.L_EditModeDone_Text}" />            <\/a>        <\/div>    <\/div><\/div>',vi='<div role="dialog" aria-labelledby="tipTitle" class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipsText">        <div class="tooltipsLinkMessage">            <span class="boldedText" id="tipTitle">                <TextBlock Text="{TemplateBinding Title}" />            <\/span>            <TextBlock Text="{TemplateBinding PreLink}" />            <a role="button" aria-label="{Binding resources.NewCollectionConfirmationLabel}" href="#" event:click="onLinkClicked" class="tooltipsLink" target="_blank">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <TextBlock Text="{TemplateBinding PostLink}" />        <\/div>    <\/div><\/div>',yi='<div class="{Binding ShowSaveButton Converter=saveRootClass}" data-tag="saveRoot">    <div class="auxillaryButtons" style:display="{Binding ShowSaveButton Converter=boolToDisplay}">        <a class="saveButton" data-tag="saveButton" event:click="onSaveClick" href="#">            <span class="saveButtonIcon"><\/span>        <\/a>    <\/div>    <div class="saveDropdown popOutTop" style:display="{Binding ShowDropdown Converter=boolToDisplay}" style:top="{Binding TopPosition}" style:left="{Binding LeftPosition}">        <div class="popOutInner" data-tag="popOutInner">            <a class="saveEntry bm_dropdownEntry" data-tag="saveEntry" event:click="onFavoritesClick" href="#" style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}">                <span class="saveButton saveIcon"><\/span>                <TextBlock Text="{Binding resources.L_FavoriteTitle_Text}" />            <\/a>            <div class="transientLensSeparator" style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}"><\/div>            <ItemsControl ItemsSource="{Binding Itineraries}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <a class="saveEntry bm_dropdownEntry" data-tag="saveEntry" data-entityid="{Binding collectionId}" event:click="onItineraryClick" href="#">                            <span class="saveButton saveIcon"><\/span>                            <TextBlock Text="{Binding Name}" />                        <\/a>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>            <div class="transientLensSeparator" style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}"><\/div>            <a class="saveEntry bm_dropdownEntry" data-tag="saveEntry" event:click="onTemporaryCollectionClick" href="#">                <span class="saveButton saveIcon"><\/span>                <TextBlock Text="{Binding resources.L_TemporaryCollectionTitle}" />            <\/a>            <ItemsControl ItemsSource="{Binding Collections}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <a class="saveEntry bm_dropdownEntry" data-tag="saveEntry" data-entityid="{Binding id}" event:click="onCollectionClick" href="#" style="{Binding collectionId Converter=collectionIdToDisplayNone}">                            <span class="saveButton saveIcon"><\/span>                            <TextBlock Text="{Binding name}" />                        <\/a>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div><\/div>';"use strict";var lt=function(n){function t(){var t=n.call(this)||this;return t.geometryType=1,t.crs=ct.instance,t}return p(t,n),t.prototype.dispose=function(){this.entity.dispose();this.entity=null;this.geometry=null;this.crs=null;this.updated=new b},t.prototype.getGeometry=function(){return this.geometry},t.prototype.setGeometry=t.prototype.getArea=function(){return 0},t.prototype.getLength=function(){return 0},t.prototype.createPointFromSimplePoint=function(n){var t=this;return n.entity&&(n.entity.name&&n.entity.name.length>0||n.entity.originalName&&n.entity.originalName.length>0)?(this.entity=new bt,this.entity.createFavoriteFromCollectionEntity(n.entity),this.setGeometry(n.getGeometry()),this.geometry=n.geometry,this.geometryType=1,this.entity.geometry=n.geometry,this.entity.geometryType=1,this.entity.updated.add(function(n){t.updated.invoke(n)}),this.geometry!==null):!1},t.prototype.getSimplePoint=function(){var n=new v;return n.geometry=this.geometry,n.geometryType=this.geometryType,n.entity=this.entity.ToCollectionEntity(),n},t.prototype.isTapEnabled=function(){return!0},t}(tt),i=function(n){function i(i,r,u){var f=n.call(this)||this;return f.primitives=new c,f._privates.defineProperty("itemCount"),f.id=i,f.name=r,f.disposed=new b,f.eTag="0",f.dateCreated=t.convertJavascriptDateToDateInTicks(new Date),f.dateModified=f.dateCreated,f.dateAccessed=f.dateCreated,f.primitives.changed.add(,f.collageImages=new c,f.isAutoCollection=u,f}return p(i,n),i.deserialize=function(n,t){var r,o,e,f,u;if(t)return i.deserializeCgCollection(n);if(r=void 0,n&&n.id&&n.name&&(r=new i(n.id,n.name),r.description=n.description,r.isPublic=n.isPublic,n.primitives))for(o=n.primitives.length,e=0;e<o;e++){f=n.primitives[e];u=void 0;switch(f.geometryType){case 1:u=v.deserialize(f);break;case 2:u=ot.deserialize(f);r.containsPolyshapes=!0;break;case 3:u=et.deserialize(f);r.containsPolyshapes=!0}u&&r.primitives.insert(u)}return r},i.deserializeCgCollection=function(n){var r,e,y,h,o,l,p,w,s,a,u,f;if(n&&n.CollectionId&&(n.Name||t.isDefaultCollectionId(n.CollectionId))){if(r=new i(n.CollectionId,i._getCollectionName(n)),r.description=n.Description,r.isPublic=n.CanShare,r.eTag=n.ETag,r.dateAccessed=n.DateAccessed,r.dateCreated=n.DateCreated,r.dateModified=n.DateModified,r.setItemCount(n.ItemsCount),e=n.Properties&&n.Properties.ImageUrls,e&&e.length){for(y=JSON.parse(e),h=new c,o=0,l=y;o<l.length;o++)p=l[o],h.insert(p);r.collageImages=h}if(n.Items)for(w=n.Items.length,r.setItemCount(w),s=0,a=n.Items;s<a.length;s++){if(u=a[s],f=void 0,u.Geometry)switch(u.Geometry.$type){case"GeometryPoint":f=v.deserialize(u,!0);break;case"GeometryLine":f=ot.deserialize(u,!0);r.containsPolyshapes=!0;break;case"GeometryPolygon":f=et.deserialize(u,!0);r.containsPolyshapes=!0}else f=v.deserialize(u,!0);f&&(f.AdditionalType=u.AdditionalType,r.primitives.insert(f))}}return r},i.serialize=function(n,t){var r,o,e,f,u;if(t)return i.serializeCgCollection(n);if(r=void 0,n&&(r={},r.id=n.id,r.name=n.name,r.description=n.description,r.isPublic=n.isPublic,r.primitives=[],n.primitives))for(o=n.primitives.length,e=0;e<o;e++){f=n.primitives[e];u=void 0;switch(f.geometryType){case 1:u=v.serialize(f);break;case 2:u=ot.serialize(f);break;case 3:u=et.serialize(f)}u&&(u.AdditionalType=f.AdditionalType,r.primitives.push(u))}return r},i.serializeCgCollection=function(n){var i,e,o,f,u,r;if(n){if(e=t.convertJavascriptDateToDateInTicks(new Date),i={$type:"GeoAnnotationsCollection",Name:n.name,Description:n.description,CanShare:n.isPublic,Items:[],AlwaysShowPOI:!0,CopyAllowed:!0,DisplayOrder:1,DateCreated:n.dateCreated,DateModified:e,DateAccessed:e},i.Properties={ImageUrls:JSON.stringify(n.collageImages.slice())},n.id&&(i.CollectionId=n.id),n.primitives)for(o=n.primitives.length,f=0;f<o;f++){u=n.primitives[f];r=void 0;switch(u.geometryType){case 1:r=v.serialize(u,!0);break;case 2:r=ot.serialize(u,!0);break;case 3:r=et.serialize(u,!0)}r&&i.Items.push(r)}i.ItemsCount=i.Items.length}return i},i.prototype.copy=function(){var n=new i(this.id,this.name);return n.description=this.description,n.isPublic=this.isPublic,n.primitives=new c,n},i._getCollectionName=function(n){return n.Name?n.Name:n.CollectionId===i.favoritesCollectionId?a.L_FavoriteTitle_Text:n.CollectionId===i.keyPlacesCollectionId?a.L_KeyPlacesTitle_Text:a.L_UpcomingEventsName},i.localCollectionId="0",i.upcomingEventsId="default.user.upcomingevents",i.favoritesCollectionId="default.user.favorites",i.keyPlacesCollectionId="default.user.keyplaces",i}(tt),at=function(){eturn n.prototype.sortCollections=function(){var n,t,r,u,i;if(this.collections.length!==0)for(n=this.collections,t=1;t<n.length;t++)if(r=n[t],u=r.dateModified,!(u<n[t-1].dateModified)){for(n.removeAt(t),i=t-2,i;i>=0;i--)if(u<n[i].dateModified)break;n.insert(r,i+1)}},n.deserialize=function(t,r){var f,o,u,e;if(t)for(f=new n,o=t.length,u=0;u<o;u++)e=i.deserialize(t[u],r),e&&f.collections.insert(e);return f},n.serialize=function(n,t){var u=[],f,r;if(n&&n.collections)for(f=n.collections.length,r=0;r<f;r++)u[r]=i.serialize(n.collections[r],t);return u},n.getAllCollectionNamesAndIds=function(n){var i=[],r,t,u;if(n&&n.collections)for(r=n.collections.length,t=0;t<r;t++)u={name:n.collections[t].name,id:n.collections[t].id},i[t]=u;return i},n}(),t;(function(n){function ut(n,t){var i={logData:{feature:"CX",action:n,data:t},impressionGuid:u.dynamicProperties.mapsIG};wt.invokeHandler("data-instrumentation",i)}function f(n){var r,t,i;return n&&(t=n,t.rings&&t.rings.length>0?r={x:t.rings[0].x,y:t.rings[0].y}:(i=n,i.x&&i.y&&(r={x:i.x,y:i.y}))),r}function o(n){var t=[0,0],i=f(n);return i&&i.x.length>=3&&(t[0]=(n.bounds[0]+n.bounds[2])/2,t[1]=(n.bounds[1]+n.bounds[3])/2),t}function ft(t){var i=(t||"").toLowerCase(),r=i.match(n.ypidRegex);return r&&r.length>0||i.indexOf("sid")!==-1||i.indexOf("eventId")!==-1}function et(t){var i=(t||"").toLowerCase(),r=i.match(n.sidRegex);return r&&r.length>0||i.indexOf("sid")!==-1}function ot(t){var i=(t||"").toLowerCase(),r=i.match(n.eventIdRegex)||i.match(n.sidRegex);return r&&r.length>0||i.indexOf("eventId")!==-1}function st(t){return n.hasSatoriId(t)?t.indexOf("sid:")===-1&&(t="sid:"+t):n.hasEventId(t)?t.indexOf("eventId:")===-1&&(t="eventId:"+t):n.hasSearchId(t)&&t.indexOf("ypid:")===-1&&(t="ypid:"+t),t}function ht(n){for(var i="",t=0;t<n.length;t++)i+=n[t],t<n.length-1&&(i+=",");return i}function ct(n){var i,r,u,f;if(!n)return t;switch(n.toUpperCase()){case"SOLID":i=t;break;case"SHORTDASH":i=v;break;case"SHORTDOT":i=y;break;case"SHORTDASHDOT":i=p;break;case"SHORTDASHDOTDOT":i=w;break;case"DOT":i=b;break;case"DASH":i=k;break;case"LONGDASH":i=nt;break;case"DASHDOT":i=tt;break;case"LONGDASHDOT":i=it;break;case"LONGDASHDOTDOT":i=rt;break;default:if(r=n.split(","),r.length===1||r.length===0||r.length%2!=0)i=t;else{for(i=[],u=0;u<r.length;u++)f=parseInt(r[u]),isNaN(f)||i.push(f);i.length===0&&(i=t)}}return i}unction at(n){if(!n)return 1;var i,t;return n.indexOf("px")!==-1?(t=parseInt(n.substr(0,n.length-2)),i=t):n.indexOf("em")!==-1?(t=parseFloat(n.substr(0,n.length-2)),i=8*t):n.indexOf("en")!==-1?(t=parseFloat(n.substr(0,n.length-2)),i=6*t):n.indexOf("pt")!==-1?(t=parseFloat(n.substr(0,n.length-2)),i=2*t):n.indexOf("%")!==-1?(t=parseFloat(n.substr(0,n.length-1)),i=1):(t=parseInt(n),i=t),i}function vt(n){var t=(new Date).getTimezoneOffset()*6e4;return new Date(n/1e4-e+t)}function yt(n){var t=(new Date).getTimezoneOffset()*6e4;return(n.getTime()+e-t)*1e4}function bt(n){if(!n)return!1;switch(n){case i.upcomingEventsId:case i.favoritesCollectionId:case i.keyPlacesCollectionId:return!0;default:return!1}}function kt(n){if(n){if(n===i.keyPlacesCollectionId)return!0}else return!1;return!1}function dt(n,t,i){var f=i||g.L_LengthFieldString,r=g.L_FormatFieldString.replace("{0}",f),u;return n<0?r.replace("{1}",g.L_IncorrectValue_text):(u=gt._readableTextFromDistance(n,t),r.replace("{1}",u))}function ni(n,t){var i,r=1;return t?n<.1?(n*=1e6,i=g.L_DistanceUnitMetersSquare_Text,r=0):i=g.L_DistanceUnitKmSquare_Text:n<.1?(n*=27878400,i=g.L_DistanceUnitFeetSquareShort_Text,r=0):i=g.L_DistanceUnitMilesSquareShortText_Text,d._formatString(g.L_Distance_Format,d._toFixed(n,r),i)}function ti(n,t){var i=n/1e6;return t||(i*=.385641),ni(i,t)}function ii(n,t,i){var f=i||g.L_AreaFieldString,r=g.L_FormatFieldString.replace("{0}",f),u;return n<0?r.replace("{1}",g.L_IncorrectValue_text):(u=ti(n,t),r.replace("{1}",u))}function s(n){if(n){var t=n.split(":");if(t.length>1)return parseInt(t[0])*60+parseInt(t[1])}return 0}function h(n,t,i){var u,r,f;return t===void 0&&(t=0),i===void 0&&(i=0),u=t+i/60,u+=s(n),r=Math.floor(u/60),f=u%60,f>30&&r++,r=r%24,[r,f]}function ri(n,t,i){t===void 0&&(t=0);i===void 0&&(i=0);var r=h(n,t,i),f=r[0],u=r[1],e=f.toString();return e+(u>0&&u<=30?":30:00":":00:00")}function ui(n,t,i){var o;if(t===void 0&&(t=0),i===void 0&&(i=0),n){var u=h(n,t,i),r=u[0],f=u[1],e=(r%12||12).toString();return e+=f>0&&f<=30?":30":":00",o=r<12||r===24?" AM":" PM",e+o}return""}function r(n,t,i,r){return pt.greatCircleDistance(new l(n,t),new l(i,r))}function c(n,t){var i=[0,0,0],r=Math.PI/180;return i[0]=Math.cos(n*r),i[1]=i[0]*Math.sin(t*r),i[0]=i[0]*Math.cos(t*r),i[2]=Math.sin(n*r),i}function fi(n){var t=[0,0,0],u=[0,0,0],e=[t,u],r=0,i=1,f;return Math.abs(n[2])>Math.abs(n[0])?(r=2,Math.abs(n[0])>Math.abs(n[1])&&(i=0)):Math.abs(n[2])>Math.abs(n[1])&&(i=2),f=Math.sqrt(n[r]*n[r]+n[i]*n[i]),t[r]=-n[i]/f,t[i]=n[r]/f,u[0]=n[1]*t[2]-n[2]*t[1],u[1]=n[2]*t[0]-n[0]*t[2],u[2]=n[0]*t[1]-n[1]*t[0],e}function a(n,t,i,r,u){var e=[],f=c(r,u),o=f[0]*n[0]+f[1]*n[1]+f[2]*n[2];return o>0&&(f[0]=f[0]-n[0],f[1]=f[1]-n[1],f[2]=f[2]-n[2],e[0]=(f[0]*t[0]+f[1]*t[1]+f[2]*t[2])/o,e[1]=(f[0]*i[0]+f[1]*i[1]+f[2]*i[2])/o),e}function ei(n,t,i,u,f,e){var s=r(n,t,i,u)/6378137,o=(f+e+s)/2;return o=Math.tan(o/2)*Math.tan((o-f)/2)*Math.tan((o-e)/2)*Math.tan((o-s)/2),o>0?(o=Math.sqrt(o),o=4*Math.atan(o)):o=0,o}function oi(n,t,i){return t[0]*i[1]-i[0]*t[1]>0?n:-n}function si(n){var u=0,t,e,i;if(n&&(t=f(n),t&&t.x.length>=2))for(e=t.x.length,i=0;i<e-1;i++)u+=r(t.y[i],t.x[i],t.y[i+1],t.x[i+1]);return u}function hi(n){var p=0,t,i;if(n&&(t=f(n),t&&t.x.length>=3)){var u=o(n),h=c(u[0],u[1]),w=fi(h),b=w[0],k=w[1],l=0,d=0,v=r(u[0],u[1],t.y[d],t.x[d])/6378137,y=void 0,e=a(h,b,k,t.y[0],t.x[0]),s=void 0;if(e.length===0)return-1;var nt=v,tt=e,g=t.x.length;for(i=1;i<g;i++){if(y=r(u[0],u[1],t.y[i],t.x[i])/6378137,s=a(h,b,k,t.y[i],t.x[i]),s.length===0)return-1;l=l+oi(ei(t.y[i-1],t.x[i-1],t.y[i],t.x[i],v,y),e,s);e=s;v=y}p=Math.abs(l)*40680631590769}return p}n.ypidRegex="yn\\d+x[A-Z,a-z,0-9]+";n.eventIdRegex="f\\d{9}";n.sidRegex="^[A-Z,a-z,0-9]{8}-[A-Z,a-z,0-9]{4}-[A-Z,a-z,0-9]{4}-[A-Z,a-z,0-9]{4}-[A-Z,a-z,0-9]{12}";var t=[0],v=[6,2],y=[2,2],p=[6,2,2,2],w=[6,2,2,2,2,2],b=[2,6],k=[10,6],nt=[20,6],tt=[10,6,2,6],it=[20,6,2,6],rt=[20,6,2,6,2,6],e=621355968e5;n.logAction=ut;n.getMedianCentroid=o;n.hasSearchId=ft;n.hasSatoriId=et;n.hasEventId=ot;n.addIdPrefix=st;n.convertDashesToStrokeDashStyle=ht;n.convertStrokeDashStyleToDashes=ct;n.convertLineWidthToStrokeWeight=lt;n.convertStrokeWeightToLineWidth=at;n.convertDateInTicksToJavascriptDate=vt;n.convertJavascriptDateToDateInTicks=yt;n.isDefaultCollectionId=bt;n.isKeyPlacesCollectionId=kt;n._createLengthText=dt;n._createAreaText=ii;n.computeTimeInMinutes=s;n.computeStartTime=ri;n.createStartTimeInAPM=ui;n.calculateLength=si;n.calculateArea=hi})(t||(t={}));var e=function(){function r(){}return r.makeCgRetrieveAllCollectionsMetadataRequest=function(t,i){var e={RequestType:1,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},f=null;u.testHooksEnabled&&(f=n.retrieveAllCollectionsBag);r._makeCgRequest(t,i,e,f)},r.makeCgRetrieveAllCollectionsRequest=function(t,i){var u={RequestType:2,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion};r._makeCgRequest(t,i,u)},r.makeCgRetrieveCollectionRequest=function(t,i,f,e){var s={RequestType:3,CollectionId:t,ClientETag:i,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},o=null;u.testHooksEnabled&&(o=n.retrieveCollectionBag);r._makeCgRequest(f,e,s,o)},r.makeCgRetrieveUpcomingEventsRequest=function(f,e){var h=t.convertJavascriptDateToDateInTicks(new Date),s={RequestType:3,CollectionId:i.upcomingEventsId,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},o;s.EventTimeRangeFilterUTC={StartTime:h};o=null;u.testHooksEnabled&&(o=n.retrieveCollectionBag);r._makeCgRequest(f,e,s,o,n.testUser)},r.makeCgRetrieveSharedCollectionRequest=function(t,i,f,e,o){var h={RequestType:10,CollectionId:t,ClientETag:i,ExternalUserId:f,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},s=null;u.testHooksEnabled&&(s=n.retrieveCollectionBag);r._makeCgRequest(e,o,h,s)},r.makeCgCreateCollectionRequest=function(t,f,e){var s={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.eTag,CollectionToBeWritten:i.serialize(t,!0)},o=null;u.testHooksEnabled&&(o=n.insertCollectionBag);r._makeCgRequest(f,e,s,o)},r.makeCgUpdateCollectionRequest=function(t,f,e){var s={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.eTag,CollectionId:t.id,CollectionToBeWritten:i.serialize(t,!0)},o=null;u.testHooksEnabled&&(o=n.updateCollectionBag);r._makeCgRequest(f,e,s,o)},r.makeCgUpdateCollectionMetadataRequest=function(t,f,e){var s=i.serialize(t,!0),h,o;s.Items=null;h={RequestType:6,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.eTag,CollectionId:t.id,MetaToBeWritten:s};o=null;u.testHooksEnabled&&(o=n.updateCollectionMetaBag);r._makeCgRequest(f,e,h,o)},r.makeCgAddPrimitiveRequest=function(i,f,e,o,s){var c,h,l;if(f){c=void 0;switch(f.geometryType){case 1:c=v.serialize(f,!0);break;case 2:c=ot.serialize(f,!0);break;case 3:c=et.serialize(f,!0);break;default:o&&o(1);return}h={RequestType:4,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:i.eTag,CollectionId:i.id,ItemToBeWritten:c};t.isDefaultCollectionId(i.id)&&(h.CollectionType=3,h.EntityId=c.EntityId,h.ItemToBeWritten.Geometry=null,h.ItemToBeWritten.DisplayCoordinates.$type=undefined,h.ItemToBeWritten.RoutableCoordinates=null);l=null;u.testHooksEnabled&&(l=n.insertItemBag);s&&(h.ItemId=f.entity.id);r._makeCgRequest(e,o,h,l)}},r.makeCgDeleteCollectionRequest=function(t,i,f){var o={RequestType:7,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.eTag,CollectionId:t.id},e=null;u.testHooksEnabled&&(e=n.deleteCollectionBag);r._makeCgRequest(i,f,o,e)},r.makeCgDeletePrimitiveRequest=function(i,f,e,o){var s={RequestType:8,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:f.eTag,CollectionId:f.id,ItemId:i},h;t.isDefaultCollectionId(f.id)&&(s.CollectionType=3,s.EntityId=i);h=null;u.testHooksEnabled&&(h=n.deleteItemBag);r._makeCgRequest(e,o,s,h)},r._getMarket=r._makeCgRequest=function(i,r,f,e,o){function c(n){i&&i(JSON.parse(n))}function l(n,i,u){r&&(n&&n!==" "&&!!i?(i===404&&u.indexOf("No Collection found for the user")!==-1||t.logAction("PDPERR",{status:i,statusText:u,reqType:f.RequestType,colId:f.CollectionId}),r(1,JSON.parse(n),i)):i===304?r(0,null):(t.logAction("PDPERR",{status:i,statusText:u,reqType:f.RequestType,colId:f.CollectionId}),r(1,null)))}var h,s;if(!n.isEnabled){r&&r(1);return}h=n.cgApiUrl;e&&(h=e);o&&(s={"Test-User-AuthToken":o});n.enableFDSessionInCloudgraphCalls&&u.dynamicProperties.fdSessionID&&(s||(s={}),s["X-CLOUDGRAPH-CSRF"]=u.dynamicProperties.fdSessionID);fi.doPost(h,JSON.stringify(f),{onError:l,onSuccess:c,headers:s})},r}(),vt=function(){function r(n){if(this._invalidIndex=-1,this._collectionAlreadyLogged=!1,this._myPlacesAlreadyLogged=!1,this._favoritesAlreadyLogged=!1,r.instance&&!n)return r.instance;this.favoritesLoaded=new b;this.favoritePrimitivesChanged=new b;this.homeOrWorkChanged=new b;this.favoritesFailedToLoad=new b;this.upcomingEventsSet=new b;this.collectionAdded=new b;this.autoCollectionsGenerated=new b;this._favoritesSynced=!1}return r.prototype.doesMyPlacesExist=r.prototype.findCollectionById=function(n){var r=null,u,t,i;if(n&&this._myPlaces)for(u=this._myPlaces.collections.length,t=0;t<u;t++)if(i=this._myPlaces.collections[t],i.id.toLowerCase()===n.toLowerCase()){r=i;break}return r},r.prototype.syncFavorites=function(r,f){var e=this,o=function(n){n===200?(e.favoriteErrorCode=0,e.favoritesLoaded.invoke(),e._favoritesAlreadyLogged||(t.logAction("CNT",{FAV:e.favorites.length}),e._favoritesAlreadyLogged=!0),e.favoritePrimitivesChanged.invoke(),e._favoritesSynced=!0,r(0)):(e.favoriteErrorCode=9,e.favoritesFailedToLoad.invoke(),r(9))},s;u.testHooksEnabled?(!n.returnMockFavorites||this.favorites&&this.favorites.length||this._mockFavoritesForJsonEndpoint(),o(200)):!this._favoritesSynced||f?(s=function(n,t){n&&t===0?(e._convertFavoritesCollectionsFromJsonEndpoint(n),o(200)):o(t)},this.retrieveCollection(i.favoritesCollectionId,s)):r(0)},r.prototype.setHome=function(n,i){var r=this,f=function(n,t){t===0||t===10&&n!==r.work?(r.home&&r.favorites.indexOf(r.home)===-1&&r.home.entity.removePlace(),r.home=n,r.home.entity.setIsHomeOrWork("home"),r.homeOrWorkChanged.invoke(!1),r.favoritePrimitivesChanged.invoke(),i(n,0)):i(n,t)},e=function(i){i===200?(f(n,0),t.logAction("FAV",{SHM:"True"})):(t.logAction("FAV",{SHM:"False",ERR:i}),f(n,9))};u.testHooksEnabled?e(200):(n.entity.id=n.entity.getPlaceId(),this.home?(n.AdditionalType="category/Home",this._updateHomeOrWork(n,this.home,f)):this.isExistingFavorite(n.entity.getPlaceId())?this.removeFavorite(n,function(t){t===0?(n.AdditionalType="category/Home",r.createFavorite(n,f)):f(n,t)}):(n.AdditionalType="category/Home",this.createFavorite(n,f)))},r.prototype.setWork=function(n,i){var r=this,f=function(n,t){t===0||t===10&&n!==r.home?(r.work&&r.favorites.indexOf(r.work)===-1&&r.work.entity.removePlace(),r.work=n,r.work.entity.setIsHomeOrWork("work"),r.homeOrWorkChanged.invoke(!1),r.favoritePrimitivesChanged.invoke(),i(n,0)):i(n,t)},e=function(i){i===200?(f(n,0),t.logAction("FAV",{SWK:"True"})):(t.logAction("FAV",{SWK:"False",ERR:i}),f(n,9))};u.testHooksEnabled?e(200):(n.entity.id=n.entity.getPlaceId(),this.work?(n.AdditionalType="category/Work",this._updateHomeOrWork(n,this.work,f)):this.isExistingFavorite(n.entity.getPlaceId())?this.removeFavorite(n,function(t){t===0?(n.AdditionalType="category/Work",r.createFavorite(n,f)):f(n,t)}):(n.AdditionalType="category/Work",this.createFavorite(n,f)))},r.prototype.createFavorite=function(n,f,e){var s=this,o,h,l,a,c;n&&n.entity&&(o=n.entity.getPlaceId(),n.entity.id=o,h=this.getExistingFavorite(o),h!==null?f(h,12):(l=this.favorites.length,l>=r._maxFavorites?f(null,4):(o=t.addIdPrefix(o),n.entity.setBusinesslistingid(o),this.favorites.indexOf(n)===-1&&(a=function(t,i){i!==0||n.AdditionalType||(s.favorites.insert(n,0),s.favoritePrimitivesChanged.invoke());f(n,0)},c=n.AdditionalType?i.keyPlacesCollectionId:i.favoritesCollectionId,u.testHooksEnabled?(n.entity.updateCollectionEntityProperties(),n.entity.createPlaceFromFavorite(),this.favorites.insert(n,0),this.favoritePrimitivesChanged.invoke(),f(n,0)):this.retrieveCollection(c,function(t,i){i===0&&t&&(n.entity.updateCollectionEntityProperties(),n.entity.createPlaceFromFavorite(),s._registerForUpdateEvent(n,t),n.entity.updated.add(,s.addPrimitive(c,n,a))})),t.logAction("FAV",{CFA:"True",SL:e?e:1}))))},r.prototype.removeFavorite=function(n,r){var u=this,f=!1;this.home===n?(this.home=null,f=!0,this._removeHomeOrWork(n,function(n){n===0&&u.homeOrWorkChanged.invoke(!1);r(n)})):this.work===n&&(this.work=null,f=!0,this._removeHomeOrWork(n,function(n){n===0&&u.homeOrWorkChanged.invoke(!1);r(n)}));f||this.retrieveCollection(i.favoritesCollectionId,function(f,e){e===0&&f?u.deletePrimitive(i.favoritesCollectionId,n.entity.id,function(i){if(i===0){for(var f=0;f<u.favorites.length;f++)if(n.entity.id===u.favorites[f].entity.id){u.favorites.removeAt(f);break}u.favoritePrimitivesChanged.invoke();r(0);t.logAction("FAV",{DEL:"True"})}}):r(e)})},r.prototype.isExistingFavorite=r.prototype.getExistingFavorite=function(n){if(this.home&&this.home.entity.id.indexOf(n)!==-1)return this.home;if(this.work&&this.work.entity.id.indexOf(n)!==-1)return this.work;if(this.favorites)for(var t=0;t<this.favorites.length;t++)if(this.favorites[t]&&this.favorites[t].entity.id.indexOf(n)!==-1)return this.favorites[t];return null},r.prototype.retrieveAllCollectionsMetaData=function(n){var t=this;this._myPlaces&&r._customCollectionsSynced?(this._myPlaces.sortCollections(),n&&n(this._myPlaces,0)):(r._customCollectionsSynced=!0,e.makeCgRetrieveAllCollectionsMetadataRequest(function(i,r,u){r===null||r.CollectionsMetaMap?n&&n(null,i?9:0):t._handleCollectionsServiceRetrieveAllResponse(r,n,u,!0)}));this.home&&this.work&&this.favorites?this.favoritesLoaded.invoke():this.syncFavorites(function(){})},r.prototype.retrieveAllCollections=function(n){var t=this;e.makeCgRetrieveAllCollectionsRequest(function(i){return t._handleCollectionsServiceRetrieveAllResponse(i,n)},function(i,r,u){r===null||r.CollectionsMap?n&&n(null,i?9:0):t._handleCollectionsServiceRetrieveAllResponse(r,n,u)})},r.prototype.retrieveCollection=function(n,t,i){var f=this,r,u,o,s;!n&&t?t(null,7):(r=this._getCollectionIndexFromCache(n),u=null,r!==this._invalidIndex&&this._myPlaces.collections[r].primitivesRetrieved&&(u=this._myPlaces.collections[r].eTag),o=s=function(n,i){i&&!i.CollectionsMap?f._handleSingleCollectionResponse(i,t,r,!0):n===0?t&&t(f._myPlaces.collections[r],0):t&&t(null,n?9:0)},i?e.makeCgRetrieveSharedCollectionRequest(n,u,i,o,s):e.makeCgRetrieveCollectionRequest(n,u,o,s))},r.prototype.retrieveUpcomingEvents=function(n){var t=this,i=function(i){var r=function(i,r){r===0&&(t._sortEvents(i),t.upcomingEvents=i,t.upcomingEventsSet.invoke());n(i,r)};return t._handleSingleCollectionResponse(i,r,-1,!0)},r=function(i,r){r===null||r.CollectionsMap||t._handleSingleCollectionResponse(r,n,-1,!0)};e.makeCgRetrieveUpcomingEventsRequest(i,r)},r.prototype.createCollection=function(n,t){var i=this,u;!n&&t?t(null,7):(u=this._getCollectionIndexFromCache(n.id),this._myPlaces&&this._myPlaces.collections.length>=r._getMaxAllowedCollections()?t&&t(null,2):u===this._invalidIndex?e.makeCgCreateCollectionRequest(n,function(r){i._myPlaces||(i._myPlaces=new at,i._addAutoCollectionsToMyPlaces());i._myPlaces.collections&&i._myPlaces.collections.insert(n,0);n.id=r.CollectionId;n.eTag=r.ServerETag;n.primitivesRetrieved=!0;n.externalUserId=r.ExternalUserId;ut.instance.pushCollection(n);t(n,0)},function(n){t&&t(null,n?9:0)}):t&&t(null,8))},r.prototype.deleteCollection=function(n,t){var i,r;!n&&t?t(7):(i=this._getCollectionIndexFromCache(n),i!==this._invalidIndex?(r=this._myPlaces.collections[i],this._myPlaces.collections.removeAt(i),e.makeCgDeleteCollectionRequest(r,function(){ut.instance.removeCollection(r);r.disposed.invoke();t(0)},function(n){t&&t(n?9:0)})):t&&t(5))},r.prototype.updateCollection=function(n,t){var r=this,i;!n&&t?t(null,7):(i=this._getCollectionIndexFromCache(n.id),n.primitivesRetrieved?e.makeCgUpdateCollectionRequest(n,function(n){return r._handleUpdateCollectionResponse(n,t,i)},function(n){t&&t(null,n?9:0)}):n.primitives.length?this.retrieveCollection(n.id,function(u,f){if(f===0){for(var o=0;o<u.primitives.length;o++)n.primitives.insert(u.primitives[o]);e.makeCgUpdateCollectionRequest(n,function(n){t&&t(null,n?9:0)})}else t&&t(null,f)}):e.makeCgUpdateCollectionMetadataRequest(n,function(n){return r._handleUpdateCollectionResponse(n,t,i)},function(n){t&&t(null,n?9:0)}))},r.prototype.updateCollectionMeta=function(n,t){var r=this,i;!n&&t?t(null,7):(i=this._getCollectionIndexFromCache(n.id),e.makeCgUpdateCollectionMetadataRequest(n,function(n){return r._handleUpdateCollectionResponse(n,t,i)},function(n){t&&t(null,n?9:0)}))},r.prototype.addPrimitive=function(n,i,u){var h=this,s,f,c;u&&(n?i?(s=this._getCollectionIndexFromCache(n),s===this._invalidIndex?u(null,5):i.entity&&i.entity.id!==o.localEntityId&&!t.isDefaultCollectionId(n)?u(null,10):(f=this._myPlaces.collections[s],c=this._checkIfRequestShouldBeDone(f,i),f.primitivesRetrieved&&f.primitives.length>=r._getMaxAllowedCollectionEntites()||f.getItemCount()>=r._getMaxAllowedCollectionEntites()?u(null,3):c?e.makeCgAddPrimitiveRequest(f,i,function(r){r.ItemId&&(i.entity.id=r.ItemId);f.primitives.insert(i,0);r.ServerETag&&(f.eTag=r.ServerETag);h._filterOutPolylinesAndPolygons(f,!1);t.isDefaultCollectionId(n)||h._updateCollectionMetaWithAddedImageCollage(f,i);ut.instance.pushCollection(f);u&&u(f,0,r.ItemId)},function(n){u(null,n===0?0:9)}):u(f,12))):u(null,10):u(null,7))},r.prototype.deletePrimitive=function(n,i,r){var s=this,f,o,u;r&&(n?i?(f=this._getPrimitiveIndexFromCollection(n,i),f!==this._invalidIndex?(o=this._getCollectionIndexFromCache(n),u=this._myPlaces.collections[o],e.makeCgDeletePrimitiveRequest(i,u,function(i){i.ServerETag&&(u.eTag=i.ServerETag);var e=u.primitives[f].entity.photoUrl;u.primitives.removeAt(f);t.isDefaultCollectionId(n)||s._updateCollectionMetaWithRemovedImageCollage(u,e);u.primitives.changed.invoke();r(0)},function(){r(9)})):r(11)):r(10):r(7))},r.prototype.updatePrimitive=function(n,t,i){if(i)if(n)if(t){var r=this._getPrimitiveIndexFromCollection(n.id,t.entity.id);r===this._invalidIndex?i(11):e.makeCgAddPrimitiveRequest(n,t,function(t){t.ServerETag&&(n.eTag=t.ServerETag);i&&i(0)},function(n){i(n===0?0:9)},!0)}else i(10);else i(7)},r.prototype._updateCollectionMetaWithAddedImageCollage=function(n,t){var i=t.entity.photoUrl;i&&n.collageImages.length<3&&n.collageImages.insert(i,0);this.updateCollectionMeta(n,function(t,i){i===0&&n.changed.invoke()})},r.prototype._updateCollectionMetaWithRemovedImageCollage=function(n,t){var i,r;if(n.collageImages.remove(t),n.collageImages.length<3&&n.primitives.length>=3)for(i=0;i<n.primitives.length;i++)if(r=n.primitives[i].entity.photoUrl,r&&n.collageImages.indexOf(r)===-1){n.collageImages.insert(r);break}this.updateCollectionMeta(n,function(t,i){i===0&&n.changed.invoke()})},r.prototype._handleCollectionsServiceRetrieveAllResponse=function(n,r,u,f){var e=new at,s=n.RequestType===1?n.CollectionsMetaMap:n.CollectionsMap,o,h,l,a;if(s){for(o=0,h=Object.keys(s);o<h.length;o++){var v=h[o],y=s[v],c=i.deserialize(y,!0);c&&(c.externalUserId=n.ExternalUserId,e.collections.insert(c))}e.sortCollections();f&&(l=this._getCollectionIndexFromCache(i.favoritesCollectionId),l!==this._invalidIndex&&e.collections.insert(this._myPlaces.collections[l]),a=this._getCollectionIndexFromCache(i.keyPlacesCollectionId),a!==this._invalidIndex&&e.collections.insert(this._myPlaces.collections[a]));this._myPlaces=e;this._addAutoCollectionsToMyPlaces();this._myPlacesAlreadyLogged||(t.logAction("CNT",{COL:e.collections.length}),this._myPlacesAlreadyLogged=!0);r&&r(this._myPlaces,0)}else n&&u===404?(this._myPlaces=e,r&&r(this._myPlaces,0)):r&&r(this._myPlaces,9)},r.prototype._handleSingleCollectionResponse=function(n,t,r,u,f){var o=n.CollectionsMap,l=this._myPlaces&&this._myPlaces.collections[r],s=l&&o[l.id],h,e,c;if(s||(h=Object.keys(o),h.length>0&&(s=o[h[0]])),e=i.deserialize(s,!0),!e){t&&t(null,5);return}e.externalUserId=n.ExternalUserId;n.ServerETag&&(e.eTag=n.ServerETag);c=9;e&&(r!==this._invalidIndex?(this._myPlaces.collections[r]=e,this._myPlaces.collections[r].primitivesRetrieved=!f,this._myPlaces.collections.changed.invoke()):r===this._invalidIndex&&e.id===i.keyPlacesCollectionId&&this._myPlaces.collections.insert(e,0),this._filterOutPolylinesAndPolygons(e,u),c=0);t&&t(e,c)},r.prototype._handleUpdateCollectionResponse=function(n,t,i,r){var u=this._myPlaces.collections[i];r&&(u.primitives=r.primitives);n.ServerETag&&(u.eTag=n.ServerETag);t&&t(u,0)},r.prototype.instantiateAutoCollections=function(){var n=this;ei.instanceAsync("AutoCollectionGenerator",function(t){n.autoCollectionGenerator=t;n.autoCollectionGenerator.generateAutoCollections(n.favorites,n.home,n.work);n._autoCollections=[];n.autoCollectionGenerator.labeledCollection.primitives.length&&n._autoCollections.push(n.autoCollectionGenerator.labeledCollection);n.autoCollectionGenerator.nearHomeCollection.primitives.length&&n._autoCollections.push(n.autoCollectionGenerator.nearHomeCollection);n.autoCollectionGenerator.nearWorkCollection.primitives.length&&n._autoCollections.push(n.autoCollectionGenerator.nearWorkCollection);for(var i=0,r=n.autoCollectionGenerator.nearbyCollections.length;i<r;i++)n._autoCollections.push(n.autoCollectionGenerator.nearbyCollections[i].collection);n._myPlaces&&n._addAutoCollectionsToMyPlaces();n.autoCollectionsGenerated.invoke()})},r.prototype._checkIfRequestShouldBeDone=function(n,t){for(var r,u=!0,f=t.entity,i=0;i<n.primitives.length;i++)if(r=n.primitives[i].entity,r.businesslistingid&&f.businesslistingid&&r.businesslistingid===f.businesslistingid){u=!1;break}return u},r.prototype._getCollectionIndexFromCache=function(n){var i=this._invalidIndex,r,t,u;if(n&&this._myPlaces)for(r=this._myPlaces.collections.length,t=0;t<r;t++)if(u=this._myPlaces.collections[t],u.id.toLowerCase()===n.toLowerCase()){i=t;break}return i},r.prototype._getPrimitiveIndexFromCollection=function(n,t){var u=this._getCollectionIndexFromCache(n),f=this._invalidIndex,r,e,i,o;if(u!==this._invalidIndex)for(r=this._myPlaces.collections[u],e=r.primitives.length,i=0;i<e;i++)if(o=r.primitives[i],o.entity.id.toLowerCase()===t.toLowerCase()){f=i;break}return f},r.prototype._filterOutPolylinesAndPolygons=function(i){var r;if(i&&i.primitives){var f=0,u=i.primitives,e=u.length;for(r=u.length-1;r>=0;r--)u[r].geometryType!==1&&(f++,n.enablePolyshapes||u.removeAt(r));n.enablePolyshapes||(i.containsPolyshapes=!1);this._collectionAlreadyLogged||(t.logAction("CNT",{PRI:e,DRG:f}),this._collectionAlreadyLogged=!0);t.logAction("PSS",{PUB:i.isPublic})}},r.prototype._sortEvents=function(n){for(var u,f,r,t=n.primitives,i=1;i<t.length;i++)if(u=t[i],f=u.entity.startDate,!(f.valueOf()>t[i-1].entity.startDate.valueOf())){for(t.removeAt(i),r=i-2,r;r>=0;r--)if(f.valueOf()>t[r].entity.startDate.valueOf())break;t.insert(u,r+1)}},r._getMaxAllowedCollections=function(){return n.maxAllowedCollections},r._getMaxAllowedCollectionEntites=r.prototype._mockFavoritesForJsonEndpoint=function(){var s=new i(i.favoritesCollectionId,"Favorites",!1),n=new v,t,r,u,f,e;n.AdditionalType="category/Home";n.geometryType=1;n.geometry={x:-122.329498,y:47.603569,bounds:[]};n.entity=new o("5fbba6b8-85e1-4d41-9444-d9055436e473","Seattle","My Home City");n.entity.AdditionalType="category/Home";n.entity.originalName="Seattle";n.entity.businesslistingid="47.603569_-122.329498";n.entity.id="5fbba6b8-85e1-4d41-9444-d9055436e473";n.entity.labelLocation=new l("47.603569","-122.329498");n.entity.address="Seattle, WA";n.entity.addressFields={addressLine:"Seattle, WA",city:"Seattle",country:"United States",formattedAddress:"Seattle, WA",neighborhood:"Madison Park",postalCode:"98112",stateMunicipality:"WA"};t=new v;t.AdditionalType="category/Work";t.geometryType=1;t.geometry={x:-122.1939697265625,y:47.61492538452,bounds:[]};t.entity=new o(null,"Microsoft CCP","On the 9th floor");t.entity.AdditionalType="category/Work";t.entity.originalName="Microsoft Bravern";t.entity.businesslistingid="47.61492538452_-122.1939697265625";t.entity.labelLocation=new l("47.614925384521484","-122.1939697265625");t.entity.address="500 108th Ave Ne Ste 1810, Bellevue, WA 98004";t.entity.addressFields={addressLine:"500 108th Ave Ne Ste 1810",city:"Bellevue",country:"United States",formattedAddress:"500 108th Ave Ne Ste 1810, Bellevue, WA 98004",neighborhood:"Downtown Bellevue",postalCode:"98004",stateMunicipality:"WA"};r=new v;r.AdditionalType="";r.geometryType=1;r.geometry={x:-122.317802,y:47.657768,bounds:[]};r.entity=new o("YN926x15799544","Portage Bay Cafe","My favorite sea food place");r.entity.AdditionalType="";r.entity.originalName="Portage Bay Cafe";r.entity.businesslistingid="YN926x15799544";r.entity.labelLocation=new l("47.657768","-122.317802");r.entity.address="4130 Roosevelt Way Ne, Seattle, WA, United States";r.entity.addressFields={addressLine:"4130 Roosevelt Way Ne",city:"Seattle",country:"United States",formattedAddress:"4130 Roosevelt Way Ne, Seattle, WA, United States",neighborhood:"University District",postalCode:"98105",stateMunicipality:"WA"};u=new v;u.AdditionalType="";u.geometryType=1;u.geometry={x:-122.349297,y:47.620491,bounds:[]};u.entity=new o("YN873x112609011","Space Needle","");u.entity.AdditionalType="";u.entity.originalName="Space Needle";u.entity.businesslistingid="YN873x112609011";u.entity.labelLocation=new l("47.620491","-122.349297");u.entity.address="400 Broad Street, Seattle, WA, United States";u.entity.addressFields={addressLine:"400 Broad Street",city:"Seattle",country:"United States",formattedAddress:"400 Broad Street, Seattle, WA, United States",neighborhood:"Queen Anne",postalCode:"98109",stateMunicipality:"WA"};f=new v;f.AdditionalType="";f.geometryType=1;f.geometry={x:-122.295097,y:47.624046,bounds:[]};f.entity=new o("YN926x15812295","Cafe Flora","");f.entity.AdditionalType="";f.entity.originalName="Cafe Flora";f.entity.businesslistingid="YN926x15812295";f.entity.labelLocation=new l("47.624046","-122.295097");f.entity.address="2901 E Madison St, Seattle, WA 98112s";f.entity.addressFields={addressLine:"2901 E Madison St",city:"Seattle",country:"United States",formattedAddress:"2901 E Madison St, Seattle, WA 98112",neighborhood:"Stevens",postalCode:"98112",stateMunicipality:"WA"};e=new v;e.AdditionalType="";e.geometryType=1;e.geometry={x:-122.129797,y:47.640049,bounds:[]};e.entity=new o(null,"Microsoft Main Campus","Microsoft Home office");e.entity.AdditionalType="";e.entity.originalName="Microsoft Main Campus";e.entity.businesslistingid="47.640049_-122.129797";e.entity.labelLocation=new l("47.640049","-122.129797");e.entity.address="1 Microsoft Way, Redmond, WA";e.entity.addressFields={addressLine:"1 Microsoft Way",city:"Redmond",country:"United States",formattedAddress:"1 Microsoft Way, Redmond, WA",neighborhood:"University District",postalCode:"98052",stateMunicipality:"WA"};s.primitives=new c;s.primitives.insert(n);s.primitives.insert(t);s.primitives.insert(r);s.primitives.insert(u);s.primitives.insert(f);s.primitives.insert(e);this._convertFavoritesCollectionsFromJsonEndpoint(s)},r.prototype._addAutoCollectionsToMyPlaces=function(){if(this._autoCollections&&this._myPlaces)for(var n=this._autoCollections.length-1;n>=0;n--)this._myPlaces.autocollections.insert(this._autoCollections[n],0)},r.prototype._convertFavoritesCollectionsFromJsonEndpoint=function(n){var u,r,t,f;if(this.favorites=new c,n.primitives&&n.primitives.length>0){for(u=n.primitives.length-1;u>=0;u--)r=new lt,t=n.primitives[u],t.geometry&&(t.AdditionalType===null||t.AdditionalType===""?r.createPointFromSimplePoint(t)&&(this.favorites.insert(r),this._registerForUpdateEvent(r,n)):t.AdditionalType==="category/Home"?r.createPointFromSimplePoint(t)&&(this.home=r,this.home.entity.setIsHomeOrWork("home")):t.AdditionalType==="category/Work"&&r.createPointFromSimplePoint(t)&&(this.work=r,this.work.entity.setIsHomeOrWork("work")));f=this._getCollectionIndexFromCache(i.favoritesCollectionId);f===this._invalidIndex&&(this._myPlaces||(this._myPlaces=new at),this._myPlaces.collections.insert(n,0))}},r.prototype._registerForUpdateEvent=function(n,t){n.updated=new b;n.updated.add(function(i){e.makeCgAddPrimitiveRequest(t,n,function(r){n.entity.id=r.ItemId;r.ServerETag&&(t.eTag=r.ServerETag);i&&i(0)},function(n){i(n===0?0:9)},!0)})},r.prototype._removeHomeOrWork=function(n,t){var u=this,r=this._getCollectionIndexFromCache(i.keyPlacesCollectionId);r!==this._invalidIndex&&this._myPlaces.collections[r].eTag?this._sendDeletePrimitiveForHomeOrWork(n,this._myPlaces.collections[r],t):this.retrieveCollection(i.keyPlacesCollectionId,function(i,r){r===0&&i?u._sendDeletePrimitiveForHomeOrWork(n,i,t):t(r)})},r.prototype._sendDeletePrimitiveForHomeOrWork=function(n,t,i){e.makeCgDeletePrimitiveRequest(n.entity.id,t,function(n){n.ServerETag&&(t.eTag=n.ServerETag);i(0)},function(){i(9)})},r.prototype._updateHomeOrWork=function(n,t,i){var r=this;this._removeHomeOrWork(t,function(t){t===0?r.isExistingFavorite(n.entity.getPlaceId())?r.removeFavorite(n,function(t){t===0?r.createFavorite(n,function(n,t){i(n,t)}):i(n,t)}):r.createFavorite(n,:i(n,t)})},r._maxFavorites=1200,r._customCollectionsSynced=!1,r.instance=new r,r}(),bt=function(n){function i(){var t=n.call(this)||this,i=t._privates;return i.defineProperty("name",function(n,i){t._onNameChanged(n,i)}),i.defineProperty("originalName",function(n,i){t._onOriginalNameChanged(n,i)}),i.defineProperty("description",function(n,i){t._onDescriptionChanged(n,i)}),i.defineProperty("address",function(n,i){t._onAddressChanged(n,i)}),i.defineProperty("addressFields",function(n,i){t._onAddressFieldsChanged(n,i)}),i.defineProperty("phone",function(n,i){t._onPhoneChanged(n,i)}),i.defineProperty("businesslistingid",function(n,i){t._onBusinesslistingidChanged(n,i)}),i.defineProperty("photoUrl",function(n,i){t._onPhotoUrlChanged(n,i)}),i.defineProperty("url",function(n,i){t._onUrlChanged(n,i)}),i.defineProperty("geometry",function(n,i){t._onGeometryChanged(n,i)}),i.defineProperty("isHomeOrWork",function(n,i){t._onIsHomeOrWorkChanged(n,i)}),i.defineProperty("showOnMap",function(n,i){t._onShowOnMapChanged(n,i)}),i.defineProperty("iconText"),i.defineProperty("iconSource"),i.defineProperty("displayOrder"),t.id="",t._place=null,t.setIsHomeOrWork(""),t.updated=new b,t}return p(i,n),i.prototype.dispose=i.prototype.getTitle=function(){switch(this.getIsHomeOrWork()){case"home":return a.L_HomeFavorite_Text;case"work":return a.L_WorkFavorite_Text;default:return this.getName()}},i.prototype.getPlace=function(){return this._place},i.prototype.getPlaceId=function(){return this._place?this._place.Id:(this._isBusiness=this._checkIsBusiness(this.getBusinesslistingid()),this.getBusinesslistingid()&&this.getBusinesslistingid()!=="0"?this.getBusinesslistingid().replace("ypid:","").replace("sid:",""):this.getGeometry()&&this.getGeometry().y+"_"+this.getGeometry().x)},i.prototype.createFavoriteFromCollectionEntity=function(n){n&&(this.id=n.id?n.id:n.entityId,this.setOriginalName(n.originalName),this.setName(n.name),!this.getName()&&this.getOriginalName()&&this.setName(this.getOriginalName()),this.setGeometry({x:n.labelLocation.longitude,y:n.labelLocation.latitude,bounds:[n.labelLocation.latitude,n.labelLocation.longitude,n.labelLocation.latitude,n.labelLocation.longitude]}),this.setAddress(n.address),this.setAddressFields(n.addressFields),this.setDescription(n.description),n.businesslistingid?this.setBusinesslistingid(n.businesslistingid):this.setBusinesslistingid(n.entityId),this.entityId=this.id,this.entityIdType=n.entityIdType,this.setPhotoUrl(n.photoUrl),this.segmentType=n.segmentType,this.categoryId=n.categoryId,this.setShowOnMap(!0),this.setDisplayOrder(n.displayOrder),this.updateCollectionEntityProperties(),this.createPlaceFromFavorite())},i.prototype.updateCollectionEntityProperties=function(){this.originalName=this.getOriginalName();this.address=this.getAddress();this.addressFields=this.getAddressFields();this.description=this.getDescription();this.businesslistingid=this.getBusinesslistingid();this.photoUrl=this.getPhotoUrl();this.displayOrder=this.getDisplayOrder()},i.prototype.ToCollectionEntity=function(){var i={name:this.getName(),originalName:this.getOriginalName(),description:this.getDescription(),address:this.getAddress(),addressFields:this.getAddressFields(),photoUrl:this.getPhotoUrl(),categoryId:this.categoryId},u=this.getGeometry(),r,n;return u&&(i.routableLocation=i.labelLocation=new l(u.y,u.x)),n=this.getBusinesslistingid(),n&&(n.indexOf("ypid:")!==-1||n.indexOf("sid:")!==-1?r=n:n!=="0"&&(t.hasSearchId(n)?r="ypid:"+n:n.split("_").length!==2&&(r="sid:"+n)),r&&(i.businesslistingid=n)),i},i.prototype.createPlaceFromFavorite=i.prototype.removePlace=i.prototype._onNameChanged=function(n,t){var i=this;this.name=this.getTitle();this._updatePlaceFields(function(n){n&&(i._place.Name={Value:t})})},i.prototype._onOriginalNameChanged=function(n,t){var i=this;this.originalName=this.getOriginalName();this._updatePlaceFields(function(n){n&&(i._place.OriginalName={Value:t})})},i.prototype._onDescriptionChanged=function(n,t){var i=this;this.description=this.getDescription();this._updatePlaceFields(function(n){n&&(i._place.Description={Value:t})})},i.prototype._onAddressChanged=function(n,t){var i=this;this.address=this.getAddress();this._updatePlaceFields(function(n){n&&(i._place.Address.AddressSingleLine={Value:t})})},i.prototype._onAddressFieldsChanged=function(n,t){var i=this;this.addressFields=this.getAddressFields();this._updatePlaceFields(function(n){n&&(i._place.Address.AddressLocality={Value:t.city},i._place.Address.AddressRegion={Value:t.stateMunicipality},i._place.Address.AddressCountry={Value:t.country},i._place.Address.PostalCode={Value:t.postalCode},i._place.Address.StreetAddress={Value:t.addressLine})})},i.prototype._onPhoneChanged=function(n,t){var i=this;this.phone=this.getPhone();this._updatePlaceFields(function(n){n&&(i._place.Phone={Value:t})})},i.prototype._onBusinesslistingidChanged=function(n,t){var i=this;this.businesslistingid=this.getBusinesslistingid();this._updatePlaceFields(function(n){if(n){i._isBusiness=i._checkIsBusiness(t);i._isBusiness&&(i._place.IsBusiness={Value:!0});var r=t.replace("ypid:","").replace("sid:","");i._place.BingEntityId={Value:r}}})},i.prototype._onPhotoUrlChanged=function(n,t){var i=this;this.photoUrl=this.getPhotoUrl();this._updatePlaceFields(function(n){n&&(i._place.ImageUri={Value:t})})},i.prototype._onUrlChanged=function(n,t){var i=this;this.url=this.getUrl();this._updatePlaceFields(function(n){n&&(i._place.Url={Value:t})})},i.prototype._onGeometryChanged=function(n,t){var i=this;this.geometry=this.getGeometry();this._updatePlaceFields(function(n){n&&(i._place.Geometry={Latitude:{Value:t.y},Longitude:{Value:t.x}},i._place.DisplayCoordinates=i._place.Geometry)})},i.prototype._onIsHomeOrWorkChanged=function(n,t){this.name=this.getTitle();this.homeOrWork=t},i.prototype._onShowOnMapChanged=function(n,t){var i=this;this.showOnMap=this.getShowOnMap();this._updatePlaceFields(function(n){n&&(i._place.ShowOnMap={Value:t})})},i.prototype._updatePlaceFields=function(n){if(this._place){var t=function(t){n(t===200)};u.testHooksEnabled?t(200):this.updated.invoke(t);return}n(!1)},i.prototype._checkIsBusiness=function(n){return n&&(n.indexOf("ypid:")!==-1||t.hasSearchId(n)&&n.indexOf("sid:")===-1)},i.prototype._createJsonApiPlaceFromFavorite=function(){var n=new di,t,i;return n.Id=this.getPlaceId(),this.id=n.Id,n.IsEntity=!0,this.getName()&&(n.Name={Value:this.getName()}),this.getOriginalName()&&(n.OriginalName={Value:this.getOriginalName()}),this.getDescription()&&(n.Description={Value:this.getDescription()}),t=this.getAddressFields(),t&&(n.Address={AddressSingleLine:{Value:t.formattedAddress},StreetAddress:{Value:t.addressLine},PostalCode:{Value:t.postalCode},AddressRegion:{Value:t.stateMunicipality},AddressLocality:{Value:t.city},AddressCountry:{Value:t.country}}),this.getPhone()&&(n.Phone={Value:this.getPhone()}),n.IsBusiness={Value:this._isBusiness},n.Id&&(n.BingEntityId={Value:n.Id}),this.categoryId&&(n.BusinessType={Value:this.categoryId}),this.getPhotoUrl()&&(n.ImageUri={Value:this.getPhotoUrl()}),this.getUrl()&&(n.Url={Value:this.getUrl()}),i=this.getGeometry(),i&&(n.DisplayCoordinates={Latitude:{Value:i.y},Longitude:{Value:i.x}}),n},i}(tt),pi=function(){function t(n){if(t._instance)return t._instance;this.labeledCollection=new i("labeled",a.AutoCollections_LabeledPlaces,!0);this.nearHomeCollection=new i("nearHome",a.AutoCollections_NearHome,!0);this.nearWorkCollection=new i("nearWork",a.AutoCollections_NearWork,!0);this.nearbyCollections=new c;this._reverseGeocoder=n;t._instance=this}return t.prototype.generateAutoCollections=function(n,t,i){n&&!this.favorites&&(this.favorites=n);t&&!this.home&&(this.home=t);i&&!this.work&&(this.work=i);this._generateLabeledCollection();this._generateNearHomeCollection();this._generateNearWorkCollection();this._generateClusteredCityCollections();this._updateImageUrls()},t.prototype._generateLabeledCollection=function(){var n,r,t,i;for(this.labeledCollection.primitives.clear(),this.home&&this.labeledCollection.primitives.insert(this.home),this.work&&this.labeledCollection.primitives.insert(this.work),n=0,r=this.favorites.length;n<r;n++)t=this.favorites[n],i=t.entity,i.getName()!==i.getOriginalName()&&this.labeledCollection.primitives.insert(t)},t.prototype._generateNearHomeCollection=function(){if(this.nearHomeCollection.primitives.clear(),this.home){var n=this.home.geometry,t=new l(n.y,n.x);this._populateNearHomeOrWorkCollection(this.nearHomeCollection,t)}},t.prototype._generateNearWorkCollection=function(){if(this.nearWorkCollection.primitives.clear(),this.work){var n=this.work.geometry,t=new l(n.y,n.x);this._populateNearHomeOrWorkCollection(this.nearWorkCollection,t)}},t.prototype._populateNearHomeOrWorkCollection=function(t,i){for(var r=0,u=this.favorites.length;r<u;r++){var f=this.favorites[r],e=f.geometry,o=new l(e.y,e.x),s=pt.greatCircleDistance(o,i);s<n.nearHomeWorkDistance&&t.primitives.insert(f)}},t.prototype._generateClusteredCityCollections=function(){var i,r,t,u;for(this.nearbyCollections.clear(),this._seedInitialClusters(),i=!0,r=0;i&&r<n.maxIterations;)i=this._iterateCluster(),r++;for(this._pruneClusters(),t=0;t<this.nearbyCollections.length;t++)u=this.nearbyCollections[t],u.collection.id="nearby"+t,this._setClusterName(u)},t.prototype._seedInitialClusters=function(){for(var n,r,u,t=0,f=this.favorites.length;t<f;t++)if(n=this.favorites[t],r=this._findClosestCluster(n),r)this._insertAndUpdateCenterpoint(r,n);else{u=new i("nearby"+this.nearbyCollections.length,a.AutoCollections_Nearby.replace("{0}",n.entity.getName()),!0);u.primitives.insert(n);var e=n.geometry,o=new l(e.y,e.x),s={centerpoint:o,collection:u};this.nearbyCollections.insert(s)}},t.prototype._iterateCluster=function(){for(var n,t,i,u,f=!1,r=this.nearbyCollections.length-1;r>=0;r--)for(n=this.nearbyCollections[r],t=n.collection.primitives.length-1;t>=0;t--)i=n.collection.primitives[t],u=this._findClosestCluster(i,n),u&&(this._insertAndUpdateCenterpoint(u,i),n.collection.primitives.remove(i),f=!0);return f},t.prototype._pruneClusters=function(){for(var t,i=this.nearbyCollections.length-1;i>=0;i--)t=this.nearbyCollections[i],t.collection.primitives.length<n.minimumClusterSize&&(t.collection.primitives.clear(),this.nearbyCollections.remove(t),t.collection.dispose(),t.collection=null,t.centerpoint=null)},t.prototype._findClosestCluster=function(t,i){for(var o,u,s=t.geometry,h=new l(s.y,s.x),f=-1,e=-1,r=0,c=this.nearbyCollections.length;r<c;r++)(o=this.nearbyCollections[r],o!==i)&&(u=pt.greatCircleDistance(h,o.centerpoint),u<n.maxNearbyDistance&&(f===-1||u<f)&&(f=u,e=r));return e===-1?null:this.nearbyCollections[e]},t.prototype._insertAndUpdateCenterpoint=function(n,t){n.collection.primitives.insert(t);n.centerpoint=this._computeCenterpoint(n.collection.primitives)},t.prototype._computeCenterpoint=function(n){var t=s.SpatialMath,i=t.Geometry;return i.centroid(n.slice())},t.prototype._setClusterName=function(n){this._reverseGeocoder.reverseGeocode(n.centerpoint.getPosition(),function(t){t&&t.addressList&&t.addressList.length>0&&(n.collection.name=a.AutoCollections_Nearby.replace("{0}",t.addressList[0].locality||t.addressList[0].adminDistrict2),n.collection.changed.invoke())},["PopulatedPlace","Postcode1","AdminDivision1","AdminDivision2"])},t.prototype._updateImageUrls=function(){this._addImagesToCollectionMeta(this.labeledCollection);this._addImagesToCollectionMeta(this.nearHomeCollection);this._addImagesToCollectionMeta(this.nearWorkCollection);for(var n=0,t=this.nearbyCollections.length;n<t;n++)this._addImagesToCollectionMeta(this.nearbyCollections[n].collection)},t.prototype._addImagesToCollectionMeta=function(n){for(var u,i,r=n.collageImages.length,t=0,f=n.primitives.length;t<f&&r<3;t++)u=n.primitives[t],i=u.entity.getPhotoUrl(),i&&(n.collageImages.insert(i),r++)},t}(),k;(function(n){function r(t){var f,i,h,e,c,o,r,l,u,a,s;if(!t)return null;if(f=t.Days?t.Days.length:0,i={$type:"ItineraryCollection",Name:t.Name,CollectionId:t.CollectionId,Description:t.Description,ItineraryDays:f||t.DayCount,Properties:{ItineraryDays:f||t.DayCount},InterestTypes:t.InterestTypes,Url:t.SeeAllPoisUrl,Image:t.Image&&t.Image.Url,ETag:t.ETag,ItineraryMetaETag:t.ItineraryMetaETag,CanShare:!0,Items:[],Version:typeof t.Version!="undefined"?t.Version:0},t.CollageImages)if(Array.isArray(t.CollageImages))i.Properties.ImageUrls=JSON.stringify(t.CollageImages.slice());else{for(h=[],e=0;e<t.CollageImages.length;e++)h.push(t.CollageImages[e]);i.Properties.ImageUrls=JSON.stringify(h)}if(t.ItineraryAttractions&&(i.Properties.AttractionNames=JSON.stringify(t.ItineraryAttractions.slice())),t.gettyID&&(i.Properties.GettyId=t.gettyID,i.Properties.Photographer=t.photographer),t.ItineraryExtraInfo&&t.ItineraryExtraInfo.Highlights&&(i.Properties.HighlightText=t.ItineraryExtraInfo.Highlights),t.startDate&&(i.Properties.StartDate=""+t.startDate),t.endDate&&(i.Properties.EndDate=""+t.endDate),t.Destinations&&t.Destinations.length){for(c=[],o=0;o<t.Destinations.length;o++)c.push(n.convertTravelItemToPlace(t.Destinations[o]));i.Properties.Destinations=JSON.stringify(c)}for(r=0;r<f;r++)for(l=t.Days[r],u=0;u<l.length;u++)a=l[u],s=n.convertTravelItemToPlace(a),s.ItineraryInformation.DayIndex=r+1,s.DisplayOrder=u,i.Items.push(s);return i.ItemsCount=i.Items.length,i}function u(n){var u={$type:"GeometryPoint",Latitude:n.Lat,Longitude:n.Lon},f={InterestTypes:n.InterestTypes,StayDurationInMinutes:n.StayDurationInMinutes,TimeToNextInSeconds:n.TimeToNext,KmToNext:n.KmToNext,ModeToNext:n.ModeToNext,DayIndex:n.DayIndex+1},i={$type:"Place",RoutableCoordinates:u,DisplayCoordinates:u,Geometry:u,ShowOnMap:!0,Name:n.Name,OriginalName:n.OriginalName||n.Name,Description:n.Description,Image:n.Image&&n.Image.Url,ItineraryInformation:f,ItemId:n.CloudGraphId,DisplayOrder:n.ItemIndex,BusinessType:n.CategoryId},r;return n.EntityTypes&&n.EntityTypes.length&&(i.EntityType=n.EntityTypes[0]),r=n.Id,t.hasSatoriId(r)?(i.EntityIdType="SatoriID",i.EntityId=r):t.hasSearchId(r)&&(i.EntityIdType="YPID",i.EntityId=r),i}function i(n,t,i){var f=t.Properties&&(n==="collage"?t.Properties.ImageUrls:t.Properties.AttractionNames),e,r,u;if(f&&f.length){for(e=JSON.parse(f),r=new c,u=0;u<e.length;u++)r.insert(e[u]);n==="collage"?i.CollageImages=r:i.ItineraryAttractions=r}}function f(t){var h,r,e,c,l,o,a,y,s,f,u;if(!t)return null;if(h=t.ItineraryDays||t.Properties.ItineraryDays,r={Image:{Url:t.Image},InterestTypes:t.InterestTypes,Name:t.Name,CollectionId:t.CollectionId,SeeAllPoisUrl:t.Url,Description:t.Description,ETag:t.ETag,ItineraryMetaETag:t.ItineraryMetaETag,GuideUrl:"",DayCount:h,AttractionCount:t.ItemsCount,Days:[],ItineraryExtraInfo:{Highlights:t.Properties.HighlightText,StateName:null,ImageUrls:null},Version:t.Version},i("collage",t,r),i("attractions",t,r),t.Properties.GettyId&&(r.gettyID=t.Properties.GettyId,r.photographer=t.Properties.Photographer),t.Properties.StartDate&&(r.startDate=parseInt(t.Properties.StartDate)),t.Properties.EndDate&&(r.endDate=parseInt(t.Properties.EndDate)),e=t.Properties.Destinations,e&&e.length){for(c=JSON.parse(e),l=[],o=0;o<c.length;o++)l.push(n.convertPlaceToTravelItem(c[o]));r.Destinations=l}for(a=0;a<h;a++)r.Days.push([]);for(y=t.Items?t.Items.length:0,s=0;s<y;s++){for(var p=t.Items[s],v=n.convertPlaceToTravelItem(p),w=p.ItineraryInformation.DayIndex-1;w>=r.Days.length;)r.Days.push([]);if(f=r.Days[w],f){for(u=0;u<v.ItemIndex;)if(f[u]&&f[u].ItemIndex<v.ItemIndex)u++;else break;f.splice(u,0,v)}}return r}function e(n){var t=n.Geometry,i={Name:n.Name,OriginalName:n.OriginalName||n.Name,Description:n.Description,Id:n.EntityId,Lat:t&&t.Latitude,Lon:t&&t.Longitude,Image:{Url:n.Image},InterestTypes:n.ItineraryInformation.InterestTypes,StayDurationInMinutes:n.ItineraryInformation.StayDurationInMinutes,TimeToNext:n.ItineraryInformation.TimeToNextInSeconds,KmToNext:n.ItineraryInformation.KmToNext,ModeToNext:n.ItineraryInformation.ModeToNext,CloudGraphId:n.ItemId,ItemIndex:n.DisplayOrder,CategoryId:n.BusinessType};return n.EntityType&&(i.EntityTypes=[n.EntityType]),i}n.convertTravelItineraryToItineraryCollection=r;n.convertTravelItemToPlace=u;n.convertItineraryCollectionToTravelItinerary=f;n.convertPlaceToTravelItem=e})(k||(k={}));var nt=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return p(i,t),i.makeRetrieveAllItinerariesMetadataRequest=function(t,i){var f={RequestType:1,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,CollectionType:"ItineraryCollection"},r=null;u.testHooksEnabled&&(r=n.retrieveAllItinerariesBag);e._makeCgRequest(t,i,f,r)},i.makeRetrieveItineraryRequest=function(t,i,r,f,o){var h={RequestType:o?10:3,CollectionId:t,ClientETag:i,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,CollectionType:"ItineraryCollection"},s;o&&(h.ExternalUserId=o);s=null;u.testHooksEnabled&&(s=n.retrieveItineraryBag);e._makeCgRequest(r,f,h,s)},i.makeCreateItineraryRequest=function(t,i,r){var o={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:"0",ItineraryMetaClientETag:"0",CollectionToBeWritten:t,MetaToBeWritten:{},CollectionType:"ItineraryCollection"},f=null;u.testHooksEnabled&&(f=n.insertItineraryBag);e._makeCgRequest(i,r,o,f)},i.makeUpdateItineraryRequest=function(t,i,r){var o={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,CollectionToBeWritten:t,CollectionType:"ItineraryCollection"},f=null;u.testHooksEnabled&&(f=n.updateItineraryBag);e._makeCgRequest(i,r,o,f)},i.makeUpdateItineraryMetadataRequest=function(t,i,r){t.Items=null;var o={RequestType:6,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,MetaToBeWritten:t,CollectionType:"ItineraryCollection"},f=null;u.testHooksEnabled&&(f=n.updateItineraryMetaBag);e._makeCgRequest(i,r,o,f)},i.makeDeleteItineraryRequest=function(t,i,r){var o={RequestType:7,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,CollectionType:"ItineraryCollection"},f=null;u.testHooksEnabled&&(f=n.deleteItineraryBag);e._makeCgRequest(i,r,o,f)},i.makeItineraryUpsertPrimitiveRequest=function(t,i,r,f,o){if(i){var s={RequestType:4,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,ItemToBeWritten:i,CollectionType:"ItineraryCollection"},h=null;u.testHooksEnabled&&(h=n.insertItineraryItemBag);o&&(s.ItemId=i.ItemId);e._makeCgRequest(r,f,s,h)}},i.makeItineraryDeletePrimitiveRequest=function(t,i,r,f){var s={RequestType:8,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:i.ETag,ItineraryMetaClientETag:i.ItineraryMetaETag,CollectionId:i.CollectionId,ItemId:t,CollectionType:"ItineraryCollection"},o=null;u.testHooksEnabled&&(o=n.deleteItineraryItemBag);e._makeCgRequest(r,f,s,o)},i}(e),st=function(n){function t(){return t.itineraryInstance?t.itineraryInstance:n.call(this,!0)||this}return p(t,n),t.prototype.retrieveAllItinerariesMetaData=function(n){var t=this;this._itineraries&&this._itinerariesRetrieved?n&&n(this._itineraries,0):nt.makeRetrieveAllItinerariesMetadataRequest(function(i,r,u){r===null||r.CollectionsMetaMap?n&&n(null,i?9:0):t._handleItineraryRetrieveAllResponse(r,n,u)})},t.prototype.retrieveItinerary=function(n,t,i){var u=this,r,f,e,o;!n&&t?t(null,7):(r=this.getItineraryIndexFromCache(n),f=null,r!==this._invalidIndex&&this._itineraries[r].itemsRetrieved&&(f=this._itineraries[r].eTag),e=o=function(n,i){i!==null&&i.CollectionsMap?u._handleSingleItineraryResponse(i,t):n===0?t&&t(u._itineraries[r],0):t&&t(null,n?9:0)},nt.makeRetrieveItineraryRequest(n,f,e,o,i))},t.prototype.createItinerary=function(n,t){var i=this,r,u;!n&&t?t(null,7):(r=this.getItineraryIndexFromCache(n.collectionId),this._itineraries&&this._itineraries.length>=vt._getMaxAllowedCollections()?t&&t(null,2):r===this._invalidIndex?(this._compareItineraryNames(n),u=k.convertTravelItineraryToItineraryCollection(it.serialize(n)),nt.makeCreateItineraryRequest(u,function(r){var e,u,s,o,f,h,l;for(i._itineraries||(i._itineraries=new c),n.collectionId=r.CollectionId,n.eTag=r.ServerETag,n.itineraryMetaETag=r.ItineraryMetaServerETag,n.itemsRetrieved=!0,n.externalUserId=r.ExternalUserId,e=n.getDays(),u=0,s=e.length;u<s;u++)for(o=e[u],f=0,h=o.length;f<h;f++)l=o[f],l.setCollectionId(r.CollectionId);i._itineraries.insert(n,0);ut.instance.pushItinerary(n);t(n,0)},function(n){t&&t(null,n?9:0)})):t&&t(null,8))},t.prototype.deleteItinerary=function(n,t){var f=this,r,i,u;!n&&t?t(7):(r=this.getItineraryIndexFromCache(n),r!==this._invalidIndex?(i=this._itineraries[r],u=k.convertTravelItineraryToItineraryCollection(it.serialize(i)),nt.makeDeleteItineraryRequest(u,function(){ut.instance.removeItinerary(i);i.collectionId="";i.changed.invoke();f._itineraries.removeAt(r);t(0)},function(n){t&&t(n?9:0)})):t&&t(5))},t.prototype.updateItinerary=function(n,t){var u=this,i,r;!n&&t?t(null,7):(i=this.getItineraryIndexFromCache(n.collectionId),r=k.convertTravelItineraryToItineraryCollection(it.serialize(n)),nt.makeUpdateItineraryRequest(r,function(n){t&&t(null,n?9:0)}))},t.prototype.updateItineraryMeta=function(n,t){var u=this,i,r;!n&&t?t(null,7):(i=this.getItineraryIndexFromCache(n.collectionId),r=k.convertTravelItineraryToItineraryCollection(it.serialize(n)),nt.makeUpdateItineraryMetadataRequest(r,function(n){var r=function(n){var i=function(i){i.ServerETag&&(n.eTag=i.ServerETag);i.ItineraryMetaServerETag&&(n.itineraryMetaETag=i.ItineraryMetaServerETag);t&&t(n,0)},r=function(n){t&&t(null,n?9:0)};nt.makeRetrieveItineraryRequest(n.collectionId,n.eTag,i,r)};return u._handleUpdateItineraryResponse(n,r,i)},function(n){t&&t(null,n?9:0)}))},t.prototype.addItineraryItem=function(n,t,i){var u,r,f;if(i){if(n){if(!t){i(null,10);return}}else{i(null,7);return}if(u=this.getItineraryIndexFromCache(n),u===this._invalidIndex){i(null,5);return}if(r=this._itineraries[u],r.itemsRetrieved&&r.getAttractionCount()>=vt._getMaxAllowedCollectionEntites()){i(null,3);return}f=k.convertTravelItineraryToItineraryCollection(it.serialize(r));nt.makeItineraryUpsertPrimitiveRequest(f,k.convertTravelItemToPlace(t.getItineraryItemMeta()),function(n){t.cloudGraphId=n.ItemId;n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);ut.instance.pushItinerary(r);i&&i(r,0,n.ItemId)},function(n){i(null,n===0?0:9)})}},t.prototype.deleteItineraryItem=function(n,t,i){if(i){if(!n){i(7);return}if(!t){i(10);return}var u=this.getItineraryIndexFromCache(n),r=this._itineraries[u],f=k.convertTravelItineraryToItineraryCollection(it.serialize(r));nt.makeItineraryDeletePrimitiveRequest(t,f,function(n){n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);i(0)},}},t.prototype.updateItineraryItem=function(n,t,i){if(i){if(!n){i(7);return}if(!t){i(10);return}var u=this.getItineraryIndexFromCache(n),r=this._itineraries[u],f=k.convertTravelItineraryToItineraryCollection(it.serialize(r));nt.makeItineraryUpsertPrimitiveRequest(f,k.convertTravelItemToPlace(t.getItineraryItemMeta()),function(n){n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);i&&i(0)},function(n){i(n===0?0:9)},!0)}},t.prototype._handleItineraryRetrieveAllResponse=function(n,t,i){var u=new c,e=n&&n.CollectionsMetaMap,f,o,l,r;if(e){for(f=0,o=Object.keys(e);f<o.length;f++){var a=o[f],s=e[a],v=k.convertItineraryCollectionToTravelItinerary(s),h=this.getItineraryIndexFromCache(s.CollectionId);h!==this._invalidIndex?(l=this._itineraries[h],u.insert(l)):(r=new it(v),r&&(r.externalUserId=n.ExternalUserId,r.eTag="",r.itineraryMetaETag=s.ETag,u.insert(r)))}this._itinerariesRetrieved=!0;this._itineraries=u;t&&t(this._itineraries,0)}else n&&i===404?(this._itinerariesRetrieved=!0,this._itineraries=u,t&&t(this._itineraries,0)):t&&t(this._itineraries,9)},t.prototype._handleSingleItineraryResponse=function(n,t){var u=n.CollectionsMap,r=u[n.CollectionId],f,e,i,o;if(r||(f=Object.keys(u),f.length>0&&(r=u[f[0]])),this._itineraries||(this._itineraries=new c),e=this.getItineraryIndexFromCache(r.CollectionId),r&&(o=k.convertItineraryCollectionToTravelItinerary(r),e!==this._invalidIndex?(i=this._itineraries[e],i.deserializeItineraryProperties(o)):(i=new it(o),this._itineraries.insert(i))),!i){t&&t(null,5);return}i.externalUserId=n.ExternalUserId;i.eTag=n.ServerETag;i.itineraryMetaETag=n.ItineraryMetaServerETag;t&&t(i,0)},t.prototype._handleUpdateItineraryResponse=function(n,t,i){var r=this._itineraries[i];n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);t&&t(r,0)},t.prototype.getItineraryIndexFromCache=function(n){var i,r=this._invalidIndex,u,t,f;if(n&&this._itineraries)for(u=this._itineraries.length,t=0;t<u;t++)if(f=this._itineraries[t],((i=f.collectionId)===null||i===void 0?void 0:i.toLowerCase())===n.toLowerCase()){r=t;break}return r},t.prototype._compareItineraryNames=function(n){var e=this._invalidIndex,r,i,t,u,f;if(n&&this._itineraries)for(r=1,i=n.getName(),t=0,u=this._itineraries.length;t<u;t++)f=this._itineraries[t],f.getName().indexOf(i)!==-1&&n.setName(i+" "+ ++r)},t.itineraryInstance=new t,t}(vt),ut=function(){function n(){if(n.instance)return n.instance;this._mostRecentlyUsed=new c}return n.prototype.pushItinerary=function(n){var t={IsItinerary:!0,Itinerary:n};this._dedupeItem(t);this._pushItem(t);this._trimList()},n.prototype.pushCollection=function(n){var t={IsItinerary:!1,Collection:n};this._dedupeItem(t);this._pushItem(t);this._trimList()},n.prototype.removeCollection=function(n){for(var i,t=0,r=this._mostRecentlyUsed.length;t<r;t++)if(i=this._mostRecentlyUsed[t],!i.IsItinerary&&i.Collection.id===n.id){this._mostRecentlyUsed.removeAt(t);break}},n.prototype.pushOpenItinerary=function(n,t,i){var r={IsItinerary:!0,IsOpenTask:!0,TaskId:n,TaskTitle:t,ItineraryCollectionId:i};this._dedupeItem(r);this._pushItem(r);this._trimList()},n.prototype.removeItinerary=function(n){for(var i,t=0,r=this._mostRecentlyUsed.length;t<r;t++)if(i=this._mostRecentlyUsed[t],i.IsItinerary&&i.Itinerary.collectionId===n.collectionId){this._mostRecentlyUsed.removeAt(t);break}},n.prototype.removeOpenItinerary=function(n){for(var i,t=0,r=this._mostRecentlyUsed.length;t<r;t++)if(i=this._mostRecentlyUsed[t],i.IsOpenTask&&i.TaskId===n){this._mostRecentlyUsed.removeAt(t);break}},n.prototype.getLength=n.prototype.getList=n.prototype._pushItem=n.prototype._dedupeItem=function(n){for(var i,r=n.IsItinerary,u=n.IsOpenTask,t=0,f=this._mostRecentlyUsed.length;t<f;t++)if(i=this._mostRecentlyUsed[t],r&&!u&&i.Itinerary===n.Itinerary||!r&&i.Collection===n.Collection){this._mostRecentlyUsed.removeAt(t);break}},n.prototype._trimList=function(){var n=this._mostRecentlyUsed.length;n>3&&this._mostRecentlyUsed.removeAt(3,n-3)},n.instance=new n,n}(),o=function(){function n(n,i,r){this.description=r;this.id=n;this.name=i;this.originalName=i;this.dateCreated=t.convertJavascriptDateToDateInTicks(new Date);this.dateModified=this.dateCreated;this.dateAccessed=this.dateCreated;this.addressFields={addressLine:"",formattedAddress:"",city:"",stateMunicipality:"",country:"",postalCode:"",neighborhood:""}}return n.deserialize=function(t){var i;return t&&t.id&&t.name&&(i=new n(t.id,t.name,t.description),i.displayOrder=t.displayOrder,i.routableLocation=t.routableLocation,i.routableLocation||(i.routableLocation=new l(0,0)),i.labelLocation=t.labelLocation,i.photoId=t.photoId,i.photoUrl=t.photoUrl||t.photourl,i.businesslistingid=t.businesslistingid,i.address=t.address,i.originalName=t.originalName),i},n.deserializeCgEntity=function(i,r){var f=i.Name?i.Name:i.OriginalName,u;if(r||(r=new n(i.ItemId,f,i.Description)),i.OriginalName&&(r.originalName=i.OriginalName),r.routableLocation=new l(0,0),u=i.DisplayCoordinates||i.RoutableCoordinates||i.Geometry,r.routableLocation.latitude=u.Latitude,r.routableLocation.longitude=u.Longitude,r.displayOrder=i.DisplayOrder,r.labelLocation=r.routableLocation,r.photoUrl=i.Image,r.metadataString=i.Properties&&i.Properties.MetadataString,r.segmentType=i.Properties&&i.Properties.SegmentType,i.DateAccessed&&(r.dateAccessed=i.DateAccessed),i.DateCreated&&(r.dateCreated=i.DateCreated),i.DateModified&&(r.dateModified=i.DateModified),r.categoryId=i.BusinessType,r.AdditionalType=i.AdditionalType,i.Address&&(r.address=i.Address.SingleLine,r.addressFields={formattedAddress:i.Address.SingleLine,city:i.Address.Locality,stateMunicipality:i.Address.Region,country:i.Address.Country,addressLine:i.Address.StreetAddress,postalCode:i.Address.PostalCode,neighborhood:""}),i.EntityIdType){switch(i.EntityIdType.toLowerCase()){case"ypid":r.businesslistingid="ypid:";i.EntityId.toLowerCase().indexOf("yn")===-1&&(r.businesslistingid+="YN");r.businesslistingid+=i.EntityId;break;case"satoriid":r.businesslistingid="sid:";r.businesslistingid+=i.EntityId;break;case"eventid":r.businesslistingid="eventId:";r.businesslistingid+=i.EntityId}r.entityId=i.EntityId;r.entityIdType=i.EntityIdType}else t.hasSatoriId(i.EntityId)?r.businesslistingid="sid:"+i.EntityId:t.hasEventId(i.EntityId)?r.businesslistingid="eventId:"+i.EntityId:t.hasSearchId(i.EntityId)&&(r.businesslistingid="ypid:"+i.EntityId),r.id=i.EntityId,r.entityId=i.EntityId;return r},n.serialize=function(n){var t,i,r;return n&&(t={id:n.id},t.name=n.name,t.address=n.address,t.description=n.description,t.displayOrder=n.displayOrder,t.routableLocation=n.routableLocation,t.labelLocation=n.labelLocation,t.photoId=n.photoId,t.originalName=n.originalName,n.photoUrl&&n.photoUrl!==""&&(i=n.photoUrl,r=n.photoUrl.match("^/th/?"),r&&r.length>-1&&(i=location.protocol+"//"+location.hostname+n.photoUrl),t.photourl=i),t.businesslistingid=n.businesslistingid),t},n.serializeCgEntity=function(n,i){var r="Unknown",u,f,e;n.entityId&&n.entityIdType?(r=n.entityIdType,i.EntityId=n.entityId):n.businesslistingid&&(n.businesslistingid.indexOf("ypid")!==-1?r="YPID":n.businesslistingid.indexOf("sid")!==-1?r="SatoriID":n.businesslistingid.indexOf("eventId")!==-1&&(r="EventID"),i.EntityId=n.businesslistingid.replace("ypid:","").replace("sid:","").replace("eventId:",""));i.Name=n.name;i.OriginalName=n.originalName;i.ItemId=n.id;i.Description=n.description;i.EntityIdType=r;i.Address=n.addressFields?{SingleLine:n.address,Locality:n.addressFields.city,Region:n.addressFields.stateMunicipality,Country:n.addressFields.country,PostalCode:n.addressFields.postalCode,StreetAddress:n.addressFields.addressLine}:{SingleLine:n.address};i.DisplayOrder=n.displayOrder;i.BusinessType=n.categoryId;u=t.convertJavascriptDateToDateInTicks(new Date);i.DateCreated=n.dateCreated;i.DateModified=u;i.DateAccessed=u;i.Properties={MetadataString:n.metadataString,SegmentType:n.segmentType};n.photoUrl&&n.photoUrl!==""&&(f=n.photoUrl,e=n.photoUrl.match("^/th/?"),e&&e.length>-1&&(f=location.protocol+"//"+location.hostname+n.photoUrl),i.Image=f)},n.buildEntityDataTaskOptions=function(n){var i={},t={};return t.entryPoint="Collections",t.descriptionList=[],n&&(n.businesslistingid&&(n.businesslistingid.indexOf("ypid:")!==-1||n.businesslistingid.indexOf("sid:")!==-1||n.businesslistingid.indexOf("eventId:")!==-1?t.id=n.businesslistingid:n.businesslistingid!=="0"&&(t.id="ypid:"+n.businesslistingid)),t.query=!t.id&&n.routableLocation?n.routableLocation.latitude.toFixed(6)+", "+n.routableLocation.longitude.toFixed(6):n.originalName,t.taskTitle=n.name,n.name!==n.originalName&&(t.originalName=n.originalName),n.description&&n.name!==n.description&&t.descriptionList.push(n.description),n.categoryId&&(t.selectedCategoryId=n.categoryId)),i.type="LocalDetailsTask",i.state=t,i},n.prototype.getTitle=function(){return this.name},n.prototype.getOriginalName=function(){return this.originalName},n.prototype.getDescription=function(){return this.description},n.prototype.getAddress=function(){return this.address},n.prototype.getPhotoUrl=function(){return this.photoUrl},n.localEntityId="",n}(),wi=function(n){function t(){var t=n.call(this)||this,i=t._privates;return i.defineProperty("confirmDelete"),i.defineProperty("photoUrl"),i.defineProperty("thumbnailPhotoUrl"),i.defineProperty("submittedOn"),i.defineProperty("displaySubmittedOn"),t.setDisplaySubmittedOn(!1),t.setConfirmDelete(!1),t.onContributionDeleted=new b,t}return p(t,n),t.prototype.onDeleteClick=function(n){n.stopPropagation();n.preventDefault();this.setConfirmDelete(!0)},t.prototype.onCancelDeleteClick=function(n){n.stopPropagation();n.preventDefault();this.setConfirmDelete(!1)},t.prototype.onConfirmDeleteClick=function(n){n.stopPropagation();n.preventDefault();this.setConfirmDelete(!1);this.onContributionDeleted.invoke(this)},t.prototype.onImageMouseOver=function(n){n.stopPropagation();n.preventDefault();this.setDisplaySubmittedOn(!0)},t.prototype.onImageMouseOut=function(n){n.stopPropagation();n.preventDefault();this.setDisplaySubmittedOn(!1)},t.prototype.onContributionFocused=function(n){n.stopPropagation();n.preventDefault();this.setDisplaySubmittedOn(!0)},t.prototype.onContributionBlurred=function(n){n.stopPropagation();n.preventDefault();this.setDisplaySubmittedOn(!1)},t}(lt),kt=function(n){function i(t,i,r){var u=n.call(this,t,i,r)||this;return u.entityShown=!0,u}return p(i,n),i.deserializeCgEntity=function(r,u){if(r){var f=r.Name?r.Name:r.OriginalName;return u||(u=new i(r.ItemId||r.EntityId,f,r.Description)),n.deserializeCgEntity.call(this,r,u),u.type=r.$type,r.TimeInformationLocal&&(u.startDate=t.convertDateInTicksToJavascriptDate(r.TimeInformationLocal.StartTime),u.endDate=t.convertDateInTicksToJavascriptDate(r.TimeInformationLocal.EndTime)),r.ReservationDetails&&(u.emailLink=r.ReservationDetails.EmailDeepLinkId,u.reservationId=r.ReservationDetails.BookingConfirmationId),u}return null},i.prototype.getPrimaryLabelText=function(){return this.name},i.prototype.getSecondaryLabelText=function(){return a.L_UpcomingEventEntity_TimeLabelFormat.replace("{date}",d._formatLongDateString(this.startDate)).replace("{time}",d._formatTimeString(this.startDate))},i}(o),ii=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return p(t,n),t.deserializeCgEntity=function(i){var r,u;return i?(r=new t(i.ItemId||i.EntityId,i.Name,i.Description),n.deserializeCgEntity.call(this,i,r),i.ArrivalAirport&&(i.ArrivalAirport.$type="Airport",r.arrivalAirport=v.deserialize(i.ArrivalAirport,!0),r.arrivalAirport.entity.flight=r,r.arrivalAirport.entity.startDate=r.endDate),i.DepartureAirport&&(i.DepartureAirport.$type="Airport",r.departureAirport=v.deserialize(i.DepartureAirport,!0),r.departureAirport.entity.flight=r,r.name=r.departureAirport.entity.name,r.departureAirport.entity.startDate=r.startDate),i.FlightSegmentEvents&&i.FlightSegmentEvents.length>0&&(u=i.FlightSegmentEvents[0].FlightSegmentInformation,u&&(r.flightNumber=u.FlightNumber,r.airline=u.AirlineName)),r):null},t}(kt),bi=function(n){eturn p(t,n),t.deserializeCgEntity=function(i){if(i){var u=i.Name?i.Name:i.OriginalName,r=new t(i.ItemId||i.EntityId,u,i.Description);return n.deserializeCgEntity.call(this,i,r),r.airportCode=i.AirportCode,r.city=i.Address.Locality,r}return null},t.prototype.getSecondaryLabelText=function(){return a.L_UpcomingEventEntity_TimeLabelFormat.replace("{date}",d._formatLongDateString(this.startDate)).replace("{time}",d._formatTimeString(this.startDate))},t}(o),ki=function(){eturn t.deserializeEntity=function(t){var r=null,u,i;if(t&&t.$type){for(u=n.filteredEvents.split(";"),i=0;i<u.length;i++)if(t.$type===u[i])return r;r=t.$type.indexOf("Events")===0?t.$type.indexOf("FlightEvent")!==-1?ii.deserializeCgEntity(t):kt.deserializeCgEntity(t):t.$type.indexOf("Airport")===0?bi.deserializeCgEntity(t):o.deserializeCgEntity(t)}return r},t}(),di=function(){eturn n.prototype.IsValid=function(){return this._isValid},n.prototype.Delete=n}(),et=function(n){function i(){var t=n.call(this)||this;return t.geometryType=3,t.crs=ct.instance,t}return p(i,n),i.prototype.getGeometry=function(){return this.geometry},i.prototype.setGeometry=function(n){this.geometry=n;this._length=t.calculateLength(this.geometry);this._area=t.calculateArea(this.geometry)},i.prototype.getArea=function(){return this._area||(this._area=t.calculateArea(this.geometry)),this._area},i.prototype.getLength=function(){return this._length||(this._length=t.calculateLength(this.geometry)),this._length},i.prototype.getLengthText=function(){return t._createLengthText(this.getLength(),ht.unit===2)},i.prototype.getAreaText=function(){return t._createAreaText(this.getArea(),ht.unit===2)},i.deserialize=function(n,t){if(t)return i.deserializeCgPolygon(n);var r=void 0;return n&&(r=new i,r.setGeometry(n.geometry),r.entity=o.deserialize(n.entity),r.polyShapeStyle=n.style,r.entity.routableLocation.latitude&&r.entity.routableLocation.longitude||(r.entity.routableLocation.latitude=r.geometry.rings[0].y[0],r.entity.routableLocation.longitude=r.geometry.rings[0].x[0])),r},i.deserializeCgPolygon=function(n){var c,e,r,u,f,s,h,l;if(n&&n.Geometry){for(e=n.Geometry,r=e.OuterBoundary,c=new i,u={rings:[{x:[r[0].Longitude],y:[r[0].Latitude]}],bounds:[r[0].Latitude,r[0].Longitude,r[0].Latitude,r[0].Longitude]},f=1;f<r.length;f++)s=r[f].Latitude,h=r[f].Longitude,u.rings[0].x[f]=h,u.rings[0].y[f]=s,s>u.bounds[0]?u.bounds[0]=s:s<u.bounds[2]&&(u.bounds[2]=s),h>u.bounds[1]?u.bounds[1]=h:h<u.bounds[3]&&(u.bounds[3]=h);if(r=e.InnerBoundary,r&&r.length)for(u.rings[1]={x:[],y:[]},f=0;f<r.length;f++)s=r[f].Latitude,h=r[f].Longitude,u.rings[1].x[f]=h,u.rings[1].y[f]=s;c.setGeometry(u);c.entity=o.deserializeCgEntity(n);e.Style?(l=t.convertStrokeWeightToLineWidth(e.Style.StrokeWeight),c.polyShapeStyle={fillStyle:e.Style.FillColor,strokeStyle:e.Style.StrokeColor,lineWidth:l,strokeWidth:l,dashes:t.convertStrokeDashStyleToDashes(e.Style.StrokeDashStyle)}):c.polyShapeStyle=ri}return c},i.serialize=function(n,t){if(t)return i.serializeCgPolygon(n);var r=void 0;return n&&(r={},r.geometryType=n.geometryType,r.geometry=n.getGeometry(),r.entity=o.serialize(n.entity),r.style=n.polyShapeStyle),r},i.serializeCgPolygon=function(n){var u,f,r,i;if(n){for(f=n.entity,r={$type:"GeometryPolygon",OuterBoundary:[],InnerBoundary:[],Style:{FillColor:n.polyShapeStyle.fillStyle,StrokeColor:n.polyShapeStyle.strokeStyle,StrokeWeight:t.convertLineWidthToStrokeWeight(n.polyShapeStyle.lineWidth),StrokeDashStyle:t.convertDashesToStrokeDashStyle(n.polyShapeStyle.dashes)}},i=0;i<n.geometry.rings[0].x.length;i++)r.OuterBoundary[i]={Latitude:n.geometry.rings[0].y[i],Longitude:n.geometry.rings[0].x[i]};if(n.geometry.rings[1])for(i=0;i<n.geometry.rings[1].x.length;i++)r.InnerBoundary[i]={Latitude:n.geometry.rings[1].y[i],Longitude:n.geometry.rings[1].x[i]};u={$type:"GeoAnnotation",Geometry:r,RoutableCoordinates:r.OuterBoundary[0],DisplayCoordinates:r.OuterBoundary[0],ShowOnMap:!0};o.serializeCgEntity(f,u)}return u},i.prototype.isTapEnabled=function(){return!0},i}(tt),ri={fillStyle:"rgba(189, 213, 245, .3)",strokeStyle:"#00ff00",lineWidth:6,dashes:[0]},ot=function(n){function i(){var t=n.call(this)||this;return t.geometryType=2,t.crs=ct.instance,t}return p(i,n),i.prototype.getGeometry=function(){return this.geometry},i.prototype.setGeometry=i.prototype.getArea=function(){return 0},i.prototype.getLength=i.prototype.getLengthText=function(){return t._createLengthText(this.getLength(),ht.unit===2)},i.deserialize=function(n,t){if(t)return i.deserializeCgPolyline(n);var r=void 0;return n&&(r=new i,r.setGeometry(n.geometry),r.entity=o.deserialize(n.entity),r.polyShapeStyle=n.style,r.entity.routableLocation.latitude&&r.entity.routableLocation.longitude||(r.entity.routableLocation.latitude=r.geometry.y[0],r.entity.routableLocation.longitude=r.geometry.x[0])),r},i.deserializeCgPolyline=function(n){var s,f,u,r,e,h,c,l;if(n&&n.Geometry){for(f=n.Geometry,u=f.Points,s=new i,r={x:[u[0].Longitude],y:[u[0].Latitude],bounds:[u[0].Latitude,u[0].Longitude,u[0].Latitude,u[0].Longitude]},e=1;e<u.length;e++)h=u[e].Latitude,c=u[e].Longitude,r.x[e]=c,r.y[e]=h,h>r.bounds[0]?r.bounds[0]=h:h<r.bounds[2]&&(r.bounds[2]=h),c>r.bounds[1]?r.bounds[1]=c:c<r.bounds[3]&&(r.bounds[3]=c);s.setGeometry(r);s.entity=o.deserializeCgEntity(n);f.LineStyle?(l=t.convertStrokeWeightToLineWidth(f.LineStyle.StrokeWeight),s.polyShapeStyle={fillStyle:f.LineStyle.FillColor,strokeStyle:f.LineStyle.StrokeColor,strokeWidth:l,lineWidth:l,dashes:t.convertStrokeDashStyleToDashes(f.LineStyle.StrokeDashStyle)}):s.polyShapeStyle=ri}return s},i.serialize=function(n,t){if(t)return i.serializeCgPolyline(n);var r=void 0;return n&&(r={},r.geometryType=n.geometryType,r.geometry=n.getGeometry(),r.entity=o.serialize(n.entity),r.style=n.polyShapeStyle),r},i.serializeCgPolyline=function(n){var u,f,r,i;if(n){for(f=n.entity,r={$type:"GeometryLine",Points:[],LineStyle:{FillColor:n.polyShapeStyle.fillStyle,StrokeColor:n.polyShapeStyle.strokeStyle,StrokeWeight:t.convertLineWidthToStrokeWeight(n.polyShapeStyle.lineWidth),StrokeDashStyle:t.convertDashesToStrokeDashStyle(n.polyShapeStyle.dashes)}},i=0;i<n.geometry.x.length;i++)r.Points[i]={Latitude:n.geometry.y[i],Longitude:n.geometry.x[i]};u={$type:"GeoAnnotation",Geometry:r,RoutableCoordinates:r.Points[0],DisplayCoordinates:r.Points[0],ShowOnMap:!0};o.serializeCgEntity(f,u)}return u},i.prototype.isTapEnabled=function(){return!0},i}(tt),v=function(n){function t(){var t=n.call(this)||this;return t.geometryType=1,t.crs=ct.instance,t}return p(t,n),t.simplePointFactory=function(n){var e=n.location,u=e?+e.latitude.toFixed(6):0,f=e?+e.longitude.toFixed(6):0,h=n.title?n.title:u+", "+f,v=n.description?n.description:"",c=n.photoUrl?n.photoUrl:"",i=new o(o.localEntityId,h,v),r,s;if(i.address=n.address,n.addressFields&&(i.addressFields=n.addressFields),i.metadataString=n.metadataString,i.segmentType=n.segmentType,c!==""&&(i.photoUrl=c),i.routableLocation=i.labelLocation=new l(u,f),i.displayOrder=1,i.categoryId=n.categoryId,r=n.id,r&&r.length<=50){var a=r.toLowerCase().indexOf("ypid")===0,y=r.toLowerCase().indexOf("sid")===0,p=r.toLowerCase().indexOf("eventId".toLowerCase())===0;a&&r.toLowerCase().indexOf("yn")===-1&&(r=r.replace(":",":YN"));(a||y||p)&&(i.businesslistingid=r)}return n.nickName&&(i.originalName=h,i.name=n.nickName),s=new t,s.setGeometry({x:f,y:u,bounds:[u,f,u,f]}),s.entity=i,s},t.createSimplePointFromSearchEntity=function(n){var s=n.getTitle(),h=n.getAddress(),c=n.getDescription(),a=n.id&&n.id.length<=50&&(n.id.toLowerCase().indexOf("ypid")===0||n.id.toLowerCase().indexOf("sid")===0)?n.id:null,r=n.getLocation(),u=r?r.latitude:0,f=r?r.longitude:0,i=new o(o.localEntityId,s,c),e;return i.address=h,i.routableLocation=i.labelLocation=new l(u,f),i.displayOrder=1,i.businesslistingid=a,e=new t,e.setGeometry({x:f,y:u,bounds:[u,f,u,f]}),e.entity=i,e},t.prototype.getGeometry=function(){return this.geometry},t.prototype.setGeometry=function(n){this.geometry=n},t.prototype.getArea=function(){return 0},t.prototype.getLength=t.deserialize=function(n,i){var r,u;return i?t.deserializeCgPoint(n):(r=void 0,n&&(r=new t,r.setGeometry(n.geometry),r.entity=o.deserialize(n.entity),r.entity.routableLocation.latitude&&r.entity.routableLocation.longitude&&(r.entity.routableLocation.latitude!==0||r.entity.routableLocation.longitude!==0)||(r.entity.routableLocation.latitude=r.geometry.y,r.entity.routableLocation.longitude=r.geometry.x),u=r.entity),r)},t.deserializeCgPoint=function(n){var r,i,u;if(n)if(i=n.Geometry||n.DisplayCoordinates||n.RoutableCoordinates,r=new t,r.setGeometry({x:i.Longitude,y:i.Latitude,bounds:[i.Latitude,i.Longitude,i.Latitude,i.Longitude]}),u=ki.deserializeEntity(n),u)r.entity=u;else return null;return r},t.serialize=function(n,i){if(i)return t.serializeCgPoint(n);var r=void 0;return n&&(r={},r.geometryType=n.geometryType,r.geometry=n.getGeometry(),r.entity=o.serialize(n.entity)),r},t.serializeCgPoint=function(n){var i,r,t;return n&&(r=n.entity,t={$type:"GeometryPoint",Latitude:n.geometry.y,Longitude:n.geometry.x},i={$type:"Place",RoutableCoordinates:t,DisplayCoordinates:t,Geometry:t,ShowOnMap:!0,AdditionalType:n.AdditionalType},o.serializeCgEntity(r,i)),i},t.prototype.isTapEnabled=t}(tt),y;((y||(y={}));var it=function(n){function t(t){var i=n.call(this)||this,r=i._privates;return r.defineProperty("days",,r.defineProperty("cityName"),r.defineProperty("image"),r.defineProperty("guideUrl"),r.defineProperty("interestTypes"),r.defineProperty("attribution"),r.defineProperty("itineraryId"),r.defineProperty("gettyID"),r.defineProperty("photographer"),r.defineProperty("name",function(n,t){i._metaChangedHandler(n,t)}),r.defineProperty("description",function(n,t){i._metaChangedHandler(n,t)}),r.defineProperty("dayCount",,r.defineProperty("attractionCount"),r.defineProperty("destinations",function(n,t){i._destinationsChangedHandler(n,t)}),r.defineProperty("startDate",function(n,t){i._travelDatesChangedHandler(n,t)}),r.defineProperty("endDate",,i._dataManager=new st,i.disposables=[],i._updateQueue=[],i.errorEvent=new b,i.itemsRetrieved=!1,i.isActive=!1,i.activeDay=0,i.HighlightsText=t.ItineraryExtraInfo?t.ItineraryExtraInfo.Highlights:null,i.version=t.Version,i.satoriId=t.SatoriId,t&&(i.deserializeItineraryProperties(t),i._initialized=!0),i.collageImages=t.CollageImages?t.CollageImages:new c,i.itineraryAttractions=t.ItineraryAttractions?t.ItineraryAttractions:new c,i}return p(t,n),t.prototype.dispose=t.deserialize=t.serialize=function(n){var t={CityName:n.getCityName(),GuideUrl:n.getGuideUrl(),InterestTypes:n.getInterestTypes(),Attribution:n.getAttribution(),ItineraryId:n.getItineraryId(),SeeAllPoisUrl:n.seeAllPoisUrl,CollectionId:n.collectionId,Name:n.getName(),Description:n.getDescription(),Image:{Url:n.getImage()},ETag:n.eTag,ItineraryMetaETag:n.itineraryMetaETag,Days:[],gettyID:n.getGettyID(),photographer:n.getPhotographer(),startDate:n.getStartDate(),endDate:n.getEndDate(),Version:n.version,SatoriId:n.satoriId},r,o,u,h,f,i,s,e;for(n.HighlightsText&&(t.ItineraryExtraInfo={Highlights:n.HighlightsText,StateName:null,ImageUrls:null}),n.collageImages&&(t.CollageImages=n.collageImages),n.itineraryAttractions&&(t.ItineraryAttractions=n.itineraryAttractions),r=n.getDays(),o=0,u=0,h=r.length;u<h;u++){var c=r[u],l=c.length,a=[];for(f=0;f<l;f++)a.push(c[f].getItineraryItemMeta());t.Days.push(a);o+=l}if(t.DayCount=r.length,t.AttractionCount=o,i=n.getDestinations(),i&&i.length){for(s=[],e=0;e<i.length;e++)s.push(i[e].getItineraryItemMeta());t.Destinations=s}return t},t.prototype.deserializeItineraryProperties=function(n){var p=this,v,s,f,y,t,h,u,e,i,l;this.setCityName(n.CityName);this.setImage(n.Image&&n.Image.Url);this.setGuideUrl(n.GuideUrl);this.setInterestTypes(n.InterestTypes);this.setAttribution(n.Attribution);this.setItineraryId(n.ItineraryId);this.setName(n.Name);this.setDescription(n.Description||"");this.setGettyID(n.gettyID);this.setPhotographer(n.photographer);n.startDate&&this.setStartDate(n.startDate);n.endDate&&this.setEndDate(n.endDate);this.seeAllPoisUrl=n.SeeAllPoisUrl;this.collectionId=n.CollectionId;this.eTag=n.ETag;this.itineraryMetaETag=n.ItineraryMetaETag;var r=n.Days,o=[],a=0;if(this.HighlightsText=n.ItineraryExtraInfo?n.ItineraryExtraInfo.Highlights:null,this.version=n.Version,this.satoriId=n.SatoriId,n.CollageImages&&(this.collageImages=n.CollageImages),n.ItineraryAttractions&&(this.itineraryAttractions=n.ItineraryAttractions),!this.itemsRetrieved&&n.Destinations){for(v=new c,s=0;s<n.Destinations.length;s++)v.insert(new yt(n.Destinations[s],-1,0));this.setDestinations(v)}else this.itemsRetrieved||this.setDestinations(new c);if(r)if(f=this.getDays(),this.itemsRetrieved&&f&&f.length&&f.length===r.length&&this.getAttractionCount()===n.AttractionCount)for(t=0,h=r.length;t<h;t++)for(y=f[t],u=r[t],i=0,l=u.length;i<l;i++)y[i].cloudGraphId=u[i].CloudGraphId;else{for(t=0,h=r.length;t<h;t++){for(u=r[t],e=new c,i=0,l=u.length;i<l;i++)e.insert(new yt(u[i],t,i,this.collectionId));this.disposables.push(e.changed.add(function(n){return p._dayChangedHandler(n)}));o.push(e);a+=e.length}o.length&&n.AttractionCount===a&&(this.itemsRetrieved=!0);this.setDays(o);this.setDayCount(n.DayCount||o.length);this.setAttractionCount(n.AttractionCount||a)}},t.prototype.copy=function(n){var i=t.serialize(this);return n&&(i.Days=[]),new t(i)},t.prototype.addDay=function(){var i=this,n=new c,t;return this.disposables.push(n.changed.add(),t=this.getDays(),t.push(n),this.setDayCount(t.length),n},t.prototype.removeDay=function(n){var r=this.getDays(),t,i,f,u;if(n>=0&&n<r.length){for(t=r.splice(n,1)[0],this.setDayCount(r.length),i=0,f=t.length;i<f;i++)u=t[i],this._removeMetadataForEntity(!0,u),this._removeMetadataForEntity(!1,u);return t}return null},t.prototype.startReorder=t.prototype.endReorder=function(){if(this.collectionId&&this._initialized){this._isReordering=!1;var n={UpdateType:y.ItineraryUpdate};this._updateQueue.push(n);this._requestOut||this._checkUpdateQueue()}},t.prototype.routeInfoUpdated=function(){if(this.collectionId&&this._initialized){var n={UpdateType:y.ItineraryUpdate};this._updateQueue.push(n);this._requestOut||this._checkUpdateQueue()}},t.prototype._checkUpdateQueue=function(){if(this._updateQueue.length>0){var n=this._updateQueue.splice(0,1)[0];switch(n.UpdateType){case y.AddItem:this._makeAddCall(n.ChangeEvent);break;case y.DeleteItem:this._makeDeleteCall(n.ChangeEvent);break;case y.MetaUpdate:this._makeUpdateMetaDataCall();break;case y.ItineraryUpdate:this._makeUpdateItineraryCall()}}},t.prototype._metaChangedHandler=function(n,t){if(t!==n&&this.collectionId&&this._initialized){var i={UpdateType:y.MetaUpdate};this._updateQueue.push(i);this._requestOut||this._checkUpdateQueue()}},t.prototype._travelDatesChangedHandler=function(n,t){if(t!==n&&this.collectionId&&this._initialized){var i={UpdateType:y.MetaUpdate};this._updateQueue.push(i);this._requestOut||this._checkUpdateQueue()}},t.prototype._destinationsChangedHandler=function(n,t){if(t&&t.length!==0&&this.collectionId&&this._initialized){var i={UpdateType:y.MetaUpdate};this._updateQueue.push(i);this._requestOut||this._checkUpdateQueue()}},t.prototype._dayCountChangedHandler=function(n,t){var i=null,r;(t>n?i=y.MetaUpdate:t<n&&(i=y.ItineraryUpdate),i&&this.collectionId&&this._initialized)&&(r={UpdateType:i},this._updateQueue.push(r),this._requestOut||this._checkUpdateQueue())},t.prototype._dayChangedHandler=function(n){var i,r,t=null,u,f;if(((i=n.added)===null||i===void 0?void 0:i.length)?t=y.AddItem:((r=n.removed)===null||r===void 0?void 0:r.length)&&(t=y.DeleteItem),!t||!this.collectionId||!this._initialized||this._isReordering){t&&!this.collectionId&&this._initialized&&!this._isReordering&&(u=this.getAttractionCount()+(t===y.AddItem?1:-1),this.setAttractionCount(u));return}f={UpdateType:t,ChangeEvent:n};this._updateQueue.push(f);this._requestOut||this._checkUpdateQueue()},t.prototype._makeUpdateMetaDataCall=function(){var n=this;this._requestOut=!0;this._dataManager.updateItineraryMeta(this,function(t,i){n._requestOut=!1;i===0?n._checkUpdateQueue():n.errorEvent.invoke(i)})},t.prototype._makeUpdateItineraryCall=function(){for(var r,t,f,e,i=this,u=this.getDays(),n=0,o=u.length;n<o;n++)for(r=u[n],t=0,f=r.length;t<f;t++)e=r[t],e.dayIndex=n;this._requestOut=!0;this._dataManager.updateItinerary(this,function(n,t){i._requestOut=!1;t===0?i._checkUpdateQueue():i.errorEvent.invoke(t)})},t.prototype._makeAddCall=function(n){var t=this,i=n.added[0];this._requestOut=!0;this._dataManager.addItineraryItem(this.collectionId,i,function(r,u){if(t._requestOut=!1,u===0){t._updateItineraryMetaWithNewImageAndInformation(!0,i);t._updateItineraryMetaWithNewImageAndInformation(!1,i);var f={UpdateType:y.MetaUpdate};t._updateQueue.push(f);t.setAttractionCount(t.getAttractionCount()+n.added.length);t._checkUpdateQueue()}else t.errorEvent.invoke(u)})},t.prototype._makeDeleteCall=function(n){var t=this,i=n.removed[0];this._requestOut=!0;this._dataManager.deleteItineraryItem(this.collectionId,i.cloudGraphId,function(r){if(t._requestOut=!1,r===0){t.setAttractionCount(t.getAttractionCount()-n.removed.length);t._removeMetadataForEntity(!0,i);t._removeMetadataForEntity(!1,i);var u={UpdateType:y.MetaUpdate};t._updateQueue.push(u);t._checkUpdateQueue()}else t.errorEvent.invoke(r)})},t.prototype._updateAttractionCount=function(){for(var t=this.getDays(),i=0,n=0,r=t.length;n<r;n++)i+=t[n].length;this.setAttractionCount(i)},t.prototype._removeMetadataForEntity=function(n,t){var r=n?this.collageImages:this.itineraryAttractions,h,c,o,u,s,f,i,e;if(r.remove(n?t.imageUrl:t.getOriginalName()),h=this.getAttractionCount(),c=this.getDays(),r.length<3&&h>=3)for(o=!1,u=0,s=c;u<s.length;u++){for(f=s[u],i=0;i<f.length;i++)if(e=n?f[i].imageUrl:f[i].getOriginalName(),e&&r.indexOf(e)===-1){r.insert(e);o=!0;break}if(o)break}},t.prototype._updateItineraryMetaWithNewImageAndInformation=function(n,t){var i=n?t.imageUrl:t.getOriginalName(),u=n?this.collageImages.length:this.getAttractionCount(),r;i&&u<3&&(r=n?this.collageImages:this.itineraryAttractions,r.insert(i,0))},t}(tt),dt=function(){eturn n.prototype.processStars=function(){for(var t,n=0;n<5;n++)t=1,this.Rating>n&&(t=this.Rating>n+.5?3:2),n===0?this.Star1=[t,this.Provider]:n===1?this.Star2=[t,this.Provider]:n===2?this.Star3=[t,this.Provider]:n===3?this.Star4=[t,this.Provider]:n===4&&(this.Star5=[t,this.Provider])},n}(),gi=),yt=function(n){function i(t,r,u,f,e,o){var s=n.call(this)||this,h,a,v,c;return s._useKm=ht.unit===2,s.openHoursData=t.OpenHoursData,h=s._privates,h.defineProperty("name",function(n,t){return s._updateItineraryItem(n,t)},null,{defaultValue:t.Name||t.OriginalName}),h.defineProperty("originalName",null,null,{defaultValue:t.OriginalName||t.Name}),h.defineProperty("description",function(n,t){return s._updateItineraryItem(n,t)},null,{defaultValue:t.Description||""}),h.defineProperty("interestTypes",null,null,{defaultValue:t.InterestTypes}),h.defineProperty("stayDuration",null,null,{defaultValue:t.StayDuration||t.StayDurationInMinutes&&d._formatDurationString(t.StayDurationInMinutes*60)||d._formatDurationString(5400)}),h.defineProperty("modeToNext",function(){s._updatePrimitiveModeToNext()},null,{defaultValue:t.ModeToNext}),h.defineProperty("itemIndex",function(){s._updatePrimitiveIndex()},null,{defaultValue:u}),h.defineProperty("timeToNext",function(){s._updateDirectionsText()},null,{defaultValue:t.TimeToNext}),h.defineProperty("kmToNext",null,{defaultValue:t.KmToNext}),h.defineProperty("directionsText"),h.defineProperty("startTime",null,null,{defaultValue:"10:00"}),h.defineProperty("isStartTimeSelected"),h.defineProperty("isValidStartTime"),h.defineProperty("timeOptions"),h.defineProperty("address"),h.defineProperty("phoneNo"),h.defineProperty("category"),h.defineProperty("openHour"),h.defineProperty("actionName"),h.defineProperty("actionUrl"),h.defineProperty("priceInfo"),h.defineProperty("stayDurationInMinutes"),s._dataManager=new st,s._updateDirectionsText(),s.errorEvent=new b,a=t.Image&&t.Image.Url,a=s._formatImageUrl(a),s.imageUrl=a,s.cloudGraphId=t.CloudGraphId||"",s._collectionId=f||"",s.setStayDurationInMinutes(t.StayDurationInMinutes),s.dayIndex=r,s.categoryId=t.CategoryId,s.entityTypes=t.EntityTypes,s.destination=t.Destination,s.openingTime=t.OpeningTime,t.Rating&&(s.rating=new dt(t.Rating.Rating,t.Rating.TotalNo,t.Rating.Provider)),s.setCategory(t.InterestTypes?t.InterestTypes[0]:null),s.setAddress(t.Address),s.setPhoneNo(t.PhoneNo),s.setOpenHour(i._formatOpenHoursData(t.OpenHoursData)),s.setActionName(t.ActionName),s.setActionUrl(t.ActionUrl),t.StartTime&&s.setStartTime(t.StartTime),s.setTimeOptions(s.createTimeOptions()),s.setStayDurationInMinutes(t.StayDurationInMinutes?t.StayDurationInMinutes:90),s.setStayDuration(s.getStayDuration()?s.getStayDuration():d._formatDurationString(5400)),s.setPriceInfo(t.PriceInfo),s.setIsValidStartTime(i.isValidStartTime(t.StartTime,o,r,t.OpenHoursData)),s.setIsStartTimeSelected(t.IsStartTimeSelected),t.Lat&&t.Lon&&(v=new l(t.Lat,t.Lon),c=new ci(t.Name,"",t.Id,v),c.modeToNext=t.ModeToNext,c.dayIndex=r,c.itemIndex=s.getItemIndex(),c.iconText=(s.getItemIndex()+1).toString(),c.isActiveDay=e,c.originalName=s.getOriginalName(),c.imageUrl=s.imageUrl,c.poiType=e?3:12,(!c.getPrimaryCategoryPath||c.getPrimaryCategoryPath().length===0&&t.CategoryId&&t.CategoryId.length>0)&&c.setPrimaryCategoryPath(t.CategoryId),s._primitive=new oi(v,c),s._primitive.bucket=e?"1941":"1374"),s}return p(i,n),i.getItemFromLocalSearchEntity=function(n){var f=n.getImageUrl()||"",u=f.match("/th/?\\?"),r,t;return u&&u.length>-1&&n.setImageUrl(f.substr(u.index)),r={Name:n.getTitle(),Id:n.id,Lat:n.getLocation().latitude,Lon:n.getLocation().longitude,Image:{Url:n.getImageUrl()},CategoryId:n.getSelectedCategoryForIcon()},t=n.addressFields,r.Destination=t&&(t.city||t.stateMunicipality||t.country),r.EntityTypes=n.getSegmentTypes(),new i(r,-1,0)},i.prototype.setIsActive=function(n){this._primitive&&this._primitive.entity&&(this._primitive.entity.isActiveDay=n)},i.prototype.updatePrimitiveHTMLElement=i.prototype.updatePrimitivePoiType=function(){if(this._primitive&&this._primitive.entity){var n=this._primitive.entity;n.poiType=n.isActiveDay?3:12}},i.prototype.getPrimitive=function(){return this._primitive},i.prototype.getPrimitiveLocation=function(){var n=this._primitive&&this._primitive.entity&&this._primitive.entity;return n&&n.getLocation()},i.prototype.getId=function(){var n=this._primitive&&this._primitive.entity&&this._primitive.entity;return n&&n.id},i.prototype.dispose=i.prototype.getItineraryItemMeta=function(){var i=this._primitive&&this._primitive.entity&&this._primitive.entity,t,n;return i?(t={Url:this.imageUrl},n={Name:this.getName(),OriginalName:this.getOriginalName(),Description:this.getDescription(),Id:this._primitive.entity.id,Lat:this._primitive.getLocation().latitude,Lon:this._primitive.getLocation().longitude,StayDuration:this.getStayDuration(),StayDurationInMinutes:this.getStayDurationInMinutes(),Image:t,InterestTypes:this.getInterestTypes()||(this.getCategory()?[this.getCategory()]:null),TimeToNext:this.getTimeToNext(),KmToNext:this.getKmToNext(),ModeToNext:this.getModeToNext(),CloudGraphId:this.cloudGraphId,DayIndex:this.dayIndex,ItemIndex:this.getItemIndex(),CategoryId:this.categoryId,EntityTypes:this.entityTypes,Destination:this.destination,OpeningTime:this.openingTime,StartTime:this.getStartTime(),PhoneNo:this.getPhoneNo(),OpenHour:this.getOpenHour(),OpenHoursData:this.openHoursData,ActionName:this.getActionName(),ActionUrl:this.getActionUrl(),PriceInfo:this.getPriceInfo(),IsValidStartTime:this.getIsValidStartTime(),IsStartTimeSelected:this.getIsStartTimeSelected(),Address:this.getAddress()},this.rating&&(n.Rating={Rating:this.rating.Rating,TotalNo:this.rating.TotalNo,Provider:this.rating.Provider}),n):null},i.prototype.setItineraryItemMeta=function(n){n.Name&&this.setName(n.Name);n.OriginalName&&this.setOriginalName(n.OriginalName);n.Description&&this.setDescription(n.Description);n.StayDuration&&this.setStayDuration(n.StayDuration);n.StayDurationInMinutes&&this.setStayDurationInMinutes(n.StayDurationInMinutes);this.imageUrl=n.Image?n.Image.Url:null;n.InterestTypes&&this.setInterestTypes(n.InterestTypes);n.InterestTypes&&this.setCategory(n.InterestTypes[0]);n.TimeToNext&&this.setTimeToNext(n.TimeToNext);n.KmToNext&&this.setKmToNext(n.KmToNext);n.ModeToNext&&this.setModeToNext(n.ModeToNext);n.CloudGraphId&&(this.cloudGraphId=n.CloudGraphId);n.DayIndex&&(this.dayIndex=n.DayIndex);n.ItemIndex&&this.setItemIndex(n.ItemIndex);n.CategoryId&&(this.categoryId=n.CategoryId);n.EntityTypes&&(this.entityTypes=n.EntityTypes);n.Destination&&(this.destination=n.Destination);n.OpeningTime&&(this.openingTime=n.OpeningTime);n.StartTime&&this.setStartTime(n.StartTime);this.rating=n.Rating?new dt(n.Rating.Rating,n.Rating.TotalNo,n.Rating.Provider):null;n.Rating&&(this.rating=new dt(n.Rating.Rating,n.Rating.TotalNo,n.Rating.Provider));n.Address&&this.setAddress(n.Address);n.PhoneNo&&this.setPhoneNo(n.PhoneNo);n.OpenHoursData&&this.setOpenHour(i._formatOpenHoursData(n.OpenHoursData));n.OpenHoursData&&(this.openHoursData=n.OpenHoursData);n.ActionName&&this.setActionName(n.ActionName);n.ActionUrl&&this.setActionUrl(n.ActionUrl);n.PriceInfo&&this.setPriceInfo(n.PriceInfo);this.setIsValidStartTime(n.IsValidStartTime);this.setIsStartTimeSelected(n.IsStartTimeSelected)},i.prototype.setCollectionId=function(n){this._collectionId=n},i.prototype._updateDirectionsText=function(){var n=d._formatDurationString(this.getTimeToNext())+"  "+gt._readableTextFromDistance(this.getKmToNext()*1e3,this._useKm);this.setDirectionsText(n)},i.prototype._updatePrimitiveIndex=function(){if(this._primitive&&this._primitive.entity){var n=this._primitive.entity;n.itemIndex=this.getItemIndex();n.iconText=(this.getItemIndex()+1).toString()}},i.prototype._updatePrimitiveModeToNext=function(){if(this._primitive&&this._primitive.entity){var n=this._primitive.entity;n.modeToNext=this.getModeToNext()}},i.prototype._updateItineraryItem=function(n,t,i){var r=this;(t!==n||i)&&this._collectionId&&(this._updateRequestOut?this._updateAgain=!0:(this._updateAgain=!1,this._updateRequestOut=!0,this._dataManager.updateItineraryItem(this._collectionId,this,function(n){n===0?(r._updateRequestOut=!1,r._updateAgain&&r._updateItineraryItem("","",!0)):r.errorEvent.invoke(n)})))},i.prototype._formatImageUrl=function(n){var i,r,t,u,f;return n&&(i=n.indexOf("&h="),r=n.indexOf("&w="),i>0&&r>0?(t=n.indexOf("&",i+3),t===-1&&(t=n.length),u=n.substring(i,t),n=n.replace(u,"&h=120"),t=n.indexOf("&",r+3),t===-1&&(t=n.length),f=n.substring(r,t),n=n.replace(f,"&w=120")):(n+="&h=120&w=120",n.indexOf("&c=")===-1&&(n+="&c=7"))),n},i._formatOpenHoursData=function(n){var r;if(!n||n.length===0)return null;var e="",s="",t=n[0];if(t.ClosedDays&&t.ClosedDays.length>0){for(r=0;r<t.ClosedDays.length;r++)s+=t.ClosedDays[r],r<t.ClosedDays.length-1&&(s+=", ");s+=": "+Microsoft.Maps.ResourceManager.Travel.Closed}if(t.Hours&&t.Hours.length>0){var h="",f=0,c=0,o="",u="";for(r=0;r<t.Hours.length;r++)o=i._getHoursRangeString(t.Hours[r].HoursRanges),o===h||h===""?(f===0&&(u=t.Hours[r].Day),f++):f===0?(c++,u=t.Hours[r].Day+": "+o,r<t.Hours.length-1&&(u+=", "),e+=u):(c+=f,f=1,u+=" - "+t.Hours[r-1].Day+": "+h,r<t.Hours.length-1&&(u+=", "),e+=u,u=t.Hours[r].Day),h=o;f>1&&c+f===t.Hours.length&&u!==""&&o!==""?e+=u+" - "+t.Hours[t.Hours.length-1].Day+": "+o:f===1&&c+f===t.Hours.length&&u!==""&&o!==""&&(e+=", "+u+": "+o)}return s.length>0&&(e.length>0?e+=", "+s:e=s),e},i._getHoursRangeString=function(n){var t="",r,u;if(!n||n.length===0)return t;for(r=0;r<n.length;r++)u=n[r],u.Start&&u.End&&(t+=i._getHourString(u.Start),t+=" - ",t+=i._getHourString(u.End)),r<n.length-1&&(t+=", ");return t},i._getHourString=function(n){var t="",i=!1;return n.Hour===0||n.Hour===24?t="12":n.Hour>=12?(i=!0,t=n.Hour>12?(n.Hour-12).toString():n.Hour.toString()):t=n.Hour.toString(),n.Minute>0&&(t+=":"+n.Minute),t+(i?" PM":" AM")},i.prototype.createTimeOptions=function(n){var i=new c,t;for(n||(n=this.getStartTime());n&&n!=="23:30:00"&&n!=="24:00:00";)t=this.computeStartTime(n,30),i.insert(new gi(t[0],t[1],!1)),n=t[0];return i},i.prototype.computeStartTime=function(n,i,r){var u=[];return u.push(t.computeStartTime(n,i,r)),u.push(t.createStartTimeInAPM(n,i,r)),u},i.isValidStartTime=function(n,i,r,u){var v,h,e,c,y,p,l,s,f;if(r===void 0&&(r=0),!u||u.length===0)return!0;if(v=["sun","mon","tue","wed","thu","fri","sat"],h=new Date,i&&(h=new Date(i)),e=new Date(h.getTime()),e.setDate(e.getDate()+r),c=v[e.getDay()],y=e.getMonth()+1+"-"+e.getDate(),u[0].ClosedDays&&u[0].ClosedDays.length>0&&(p=u[0].ClosedDays&&u[0].ClosedDays.filter(function(n){return!!(n.replace("/","-").toLowerCase()===y||n.toLowerCase()===c)}),p.length>0))return!1;if(l=u[0].Hours.filter),l.length===0)return!0;var o=!1,w=t.computeTimeInMinutes(n),a=l[0];if(a.IsClosed)o=!1;else for(s=0;s<a.HoursRanges.length;s++)if(f=a.HoursRanges[s],f.End.Hour=f.Start.Hour*60+f.Start.Minute>=f.End.Hour*60+f.End.Minute?f.End.Hour+24:f.End.Hour,o=o||w>=f.Start.Hour*60+f.Start.Minute&&w<f.End.Hour*60+f.End.Minute,o)break;return o},i}(tt),nr=function(r){function u(n){var t=r.call(this)||this,i=t._privates;return i.defineProperty("tempName"),i.defineProperty("tempDescription"),i.defineProperty("topPosition"),i.defineProperty("leftPosition"),i.defineProperty("rightPosition"),i.defineProperty("messageText"),t.controlTemplateFactory=n,t._templateName=ai,t.disposables=[],t.resources=a,t._dataManager=new st,t.finished=new b,t}return p(u,r),u.prototype.setEntityData=function(n){this._taskState=n;this._primitiveToAdd=v.simplePointFactory(n.data)},u.prototype.setSavingTempCol,u.prototype.getTitleText,u.prototype.boolToDisplay=function(n){return n?"":"none"},u.prototype.boolToNotDisplay=function(n){return n?"none":""},u.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw new Error("control template factory must be defined.");var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=rt(n.applyDataTemplate(this));this.disposables.push(n)}return this._control},u.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},u.prototype.AddCollection=function(t,r,u){var e=this,f=new i(i.localCollectionId,t),s,h,l,c,o;for(f.description=r,f.isPublic=!1,this._isSavingTempCollection?this.tempCol&&this.tempCol.primitives.length&&f.primitives.insertAll(this.tempCol.primitives.slice()):this._primitiveToAdd&&f.primitives.insert(this._primitiveToAdd),s=0,h=0;h<f.primitives.length;h++)if(l=f.primitives[h].entity.photoUrl,s<3&&l)f.collageImages.insert(l),s++;else if(s===3)break;if(n.enableOneClickSave&&this._taskState&&this._taskState.removeEntityAndPerformAction&&this._taskState.entityId)if(this._taskState.removeEntityFromCollectionId)this._dataManager.deletePrimitive(this._taskState.removeEntityFromCollectionId,this._taskState.entityId,function(n){n!==0?e.setMessageText(e.resources.L_CollectionError_Adding_Text):e._makeAddCollectionCall(f,u)});else{for(c=void 0,o=0;o<this._dataManager.favorites.length;o++)this._dataManager.favorites[o].entity.id===this._taskState.entityId&&(c=this._dataManager.favorites[o]);c||this.setMessageText(this.resources.L_CollectionError_Adding_Text);this._dataManager.removeFavorite(c,function(n){n!==0?e.setMessageText(e.resources.L_CollectionError_Adding_Text):e._makeAddCollectionCall(f,u)})}else this._makeAddCollectionCall(f,u)},u.prototype.onCancelTitleEditClick=function(n){n.stopPropagation();n.preventDefault();this.setTempName("");this.setTempDescription("");this.finished.invoke(!1);this.dispose()},u.prototype.onConfirmTitleEditClick=function(n){this._validateTitleAndDescription()&&this._createCollection(n);n.stopPropagation();n.preventDefault()},u.prototype.onNameEditBoxClick,u.prototype._createCollection=function(i){var r=this,u=rt(i.target);u.add_class("inactive");this.AddCollection(this.getTempName(),this.getTempDescription(),function(i,f){if(u.has_class("inactive")&&u.remove_class("inactive"),f===0)t.logAction("NCS",{SUCCESS:"True"}),i.primitivesRetrieved=!1,r._dataManager.retrieveCollection(i.id,function(n){r._isSavingTempCollection&&(ft.clearCollection(),r._isSavingTempCollection=!1);n.changed.invoke();r._dataManager.collectionAdded.invoke(!0);r._addConfirmationTip(n.id,n.name);r.finished.invoke(!0);r.dispose()});else{t.logAction("NCS",{SUCCESS:"False",ERR:f});switch(f){case 2:r.setMessageText(r.resources.L_Max_Collections_Message.replace("{0}",n.maxAllowedCollections+""));break;default:r.setMessageText(r.resources.L_CollectionError_Adding_Text)}r.finished.invoke(!1);r.dispose()}})},u.prototype._validateTitleAndDescription=function(){var n=this.getTempName(),t;return n&&(n=n.trim()),t=this.getTempDescription(),n&&n.length!==0?n.length>100?(this.setMessageText(this.resources.L_TitleLengthError_Text),!1):t.length>1e3?(this.setMessageText(this.resources.L_DescLengthError_Text),!1):!0:(this.setMessageText(this.resources.L_CollectionNameMissing_Text),!1)},u.prototype._addConfirmationTip=function(n,t){var e=this,o=[a.NewCollectionConfirmationText.replace("{0}",t)],i=new ti(null,a.NewCollectionConfirmationTitle,o,!0,!0,!1,!0,vi);i.setShowClose(!1);i.disposables.push(i.messageLinkClicked.add));var r=i.getRootElement(),u=this.getControl(),f=u&&u.length&&u[0].parentElement;f&&r&&(r.style.top=this.getTopPosition(),r.style.left=this.getLeftPosition(),f&&f.appendChild(r))},u.prototype._openNewCollection=function(n){var t={action:2,entryPoint:2,collectionId:n},i={type:"CollectionsTask",state:t};wt.invokeHandler("data-task",i)},u.prototype._makeAddCollectionCall=function(n,t){var i=this;this._dataManager.retrieveAllCollectionsMetaData)},u}(tt),tr=function(n){function i(t){var i=n.call(this)||this,r=i._privates;return r.defineProperty("showDropdown"),r.defineProperty("showSaveButton",null,null,{defaultValue:!0}),r.defineProperty("itineraries"),r.defineProperty("collections"),r.defineProperty("entityName"),r.defineProperty("entityAddress"),r.defineProperty("entityId"),r.defineProperty("entityLat"),r.defineProperty("entityLong"),r.defineProperty("entityCatId"),r.defineProperty("entityImage"),r.defineProperty("topPosition"),r.defineProperty("leftPosition"),i.signInState=new hi,i._preventDefaultSave=!1,i.controlTemplateFactory=t,i._templateName=yi,i.disposables=[],i.resources=a,i._dataManager=new st,i._savedText=i.resources.SaveOnSerp_SavedButtonText,i._windowClickEventHandler,i}return p(i,n),i.prototype.getPreventDefaultClick,i.prototype.setPreventDefaultClick,i.prototype.setEntityInformation=function(n){var t,i;if(this._currentEntityState=n,t=n.data,t){this.setEntityName(t.title);i=t.id;switch(t.entityIdType){case 2:i="sid:"+i;break;case 1:default:i="ypid:"+i}this.setEntityId(i);this.setEntityLat(t.location.latitude);this.setEntityLong(t.location.longitude);this.setEntityCatId(t.categoryId);this.setEntityImage(t.photoUrl);this.setEntityAddress(t.address)}},i.prototype.saveOnSerpClicked=function(n,r,u,f){var e=this,o=this.signInState.getIsSignedIn();if(t.logAction("SOSC",{SI:o}),o){if(!this._isSaved||r)this.onFavoritesClick(null,function(){e._isSaved=!0;f||e._launchConfirmationTip(u);n&&n(e._savedText)})}else w.isEnabled()&&w.setItem(i.localStorageKey,JSON.stringify(this._currentEntityState)),r&&w&&w.isEnabled()&&w.setItem(i.multiSaveKey,"true"),sj_cook&&sj_cook.set("SRCHUSR","POEX","W",!0,"/"),window.location.assign(this.signInUrl)},i.prototype.saveOnInfoboxClicked=function(n,t,i){var f=this,e,r,u;if(n.preventDefault(),n.stopImmediatePropagation(),e=this.signInState.getIsSignedIn(),e)this.onFavoritesClick(n,function(n){f._isSaved=!0;f._buildCollectionsTaskData(n.entity);i||f._launchConfirmationTip(null,!0);t&&t(f._savedText)});else{this.onTemporaryCollectionClick(n);r=ft.getCollection();r&&r.primitives&&r.primitives.length>0?(u=r.primitives[0].entity,u&&this._buildCollectionsTaskData(u,!1)):(u={name:this.getEntityName(),id:this.getEntityId(),photoId:this.getEntityImage(),address:this.getEntityAddress(),routableLocation:new l(this.getEntityLat(),this.getEntityLong())},this._buildCollectionsTaskData(u,!1));i||this._launchConfirmationTip(null,!0);t&&t(this._savedText)}},i.prototype.saveOnSerpMouseEnter=function(){if(this._isSaved)this._launchConfirmationTip();else{var n=rt("bm_save_overlay").select("a.b_saveOnLocal");n.length===0&&this._showHoverTip()}},i.prototype.saveOnSerpMouseLeave=function(){var n=this;this._isSaved?this._hoverTimeout=ni.setTimeout,100):this.hoverTip&&this.hoverTip.removeTip()},i.prototype.checkSignInSave=function(n){var r,u,t;w.isEnabled()&&(r=w.getItem(i.localStorageKey),r&&this.signInState.getIsSignedIn()&&(this.setEntityInformation(JSON.parse(r)),u=w&&w.isEnabled()&&w.getItem(i.multiSaveKey),t=u==="true",this.saveOnSerpClicked(t?null:n,t,null,t),w.removeItem(i.localStorageKey)))},i.prototype.boolToDisplay=function(n){return n?"":"none"},i.prototype.boolToNotDisplay,i.prototype.collectionIdToDisplayNone,i.prototype.fetchItineraries=function(){var n=this;this._dataManager.retrieveAllItinerariesMetaData)},i.prototype.fetchCollections=function(){var n=this;this._dataManager.retrieveAllCollectionsMetaData)},i.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw new Error("control template factory must be defined.");var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=rt(n.applyDataTemplate(this));this.disposables.push(n)}return this._control},i.prototype.dispose,i.prototype.onSaveClick=function(n){this.getPreventDefaultClick()||(this.setShowDropdown(!0),n.stopPropagation(),n.preventDefault())},i.prototype.onItineraryClick=function(n){var f=this,i,u;if(n){n.stopPropagation();n.preventDefault();var e=n.currentTarget,r=e.getAttribute("data-entityId"),o=function(n,i){var u=i[n],e={Name:t.getEntityName(),Id:t.getEntityId(),Lat:t.getEntityLat(),Lon:t.getEntityLong(),StayDuration:"",InterestTypes:[],Image:{Url:t.getEntityImage()},CategoryId:t.getEntityCatId()};u.collectionId===r&&t._dataManager.retrieveItinerary(r,function(n,t){n&&t===0&&f._dataManager.addItineraryItem(r,new yt(e,0,0),function(){f.setShowDropdown(!1)})})},t=this;for(i=0,u=this.getItineraries();i<u.length;i++)o(i,u)}},i.prototype.onCollectionClick=function(n){var u=this,t,r,f;if(n){n.stopPropagation();n.preventDefault();var e=n.currentTarget,i=e.getAttribute("data-entityId"),o=v.simplePointFactory({title:this.getEntityName(),id:this.getEntityId(),categoryId:this.getEntityCatId(),location:new l(this.getEntityLat(),this.getEntityLong()),photoUrl:this.getEntityImage()});for(t=0,r=this.getCollections();t<r.length;t++)f=r[t],f.id===i&&this._dataManager.retrieveCollection(i,function(n,t){n&&t===0&&u._dataManager.addPrimitive(i,o)})}},i.prototype.onTemporaryCollectionClick=function(n,t){var i,r,u;t===void 0&&(t=!1);n&&(n.stopPropagation(),n.preventDefault(),i=v.simplePointFactory({title:this.getEntityName(),id:this.getEntityId(),categoryId:this.getEntityCatId(),location:new l(this.getEntityLat(),this.getEntityLong()),photoUrl:this.getEntityImage()}),r=Math.floor(Math.random()*1e3)+"_"+Math.floor(Math.random()*1e3),i.entity.id=r,t?(u=ft.getCollection(),u.primitives.find)||ft.addPoint(i)):ft.addPoint(i),this.setShowDropdown(!1))},i.prototype.onFavoritesClick=function(n,t){var i=this;n&&(n.stopPropagation(),n.preventDefault());this._dataManager.syncFavorites(function(n){var e,s;if(n===0){var u=i.getEntityLat(),f=i.getEntityLong(),o=i.getEntityName(),r=new lt;r.entity=new bt;r.entity.setOriginalName(o);r.entity.setName(o);r.entity.categoryId=i.getEntityCatId();r.entity.setAddress(i.getEntityAddress());e=i.getEntityId();e&&r.entity.setBusinesslistingid(e);r.entity.setPhotoUrl(i.getEntityImage());r.setGeometry({x:f,y:u,bounds:[u,f,u,f]});s=function(n){i.setShowDropdown(!1);t&&t(n)};i._dataManager.createFavorite(r,s,2)}})},i.prototype.saveRootClass,i.prototype._onShowPopOutChanged=function(n,t){var r=this,i=rt(window);t?ni.setTimeout,1):n&&i.remove_event("click,contextmenu",this._windowClickEventHandler)},i.prototype._hideDropdown=function(){this.getShowDropdown()?this.setShowDropdown(!1):rt(window).remove_event("click,contextmenu",this._windowClickEventHandler)},i.prototype._launchConfirmationTip=function(n,t){var u=this,i=new li(a.SaveOnSerp_SavedButtonText,a.SaveOnSerp_ConfirmationLink),f=rt(i.getRootElement()),r,e;this.disposables.push(i.tipRemoved.add),i.tipHovered.add),i.messageLinkClicked.add(function(){if(u.confirmationTip.removeTip(),t){var n=u._taskOptions;n&&wt.invokeHandler("data-task",n)}else sj_evt.fire("ShowSaveMapOverlay")}));this._control.append(f);r=_d.querySelector("a.b_saveOnLocal");f.set_style({top:r.offsetTop+r.offsetHeight,left:r.offsetLeft+r.offsetWidth/2-f[0].offsetWidth/2});e=rt(".tooltipsLink",f[0]);e.length&&e[0].focus();this.confirmationTip&&this.confirmationTip.removeTip();this.confirmationTip=i},i.prototype._showHoverTip=function(){var r=this,n=new ti(null,null,[a.SaveOnSerp_HoverTip],!0,!0,!0,!1),i,t;n.setShowBeak(!0);n.setShowClose(!1);i=rt(n.getRootElement());this.disposables.push(n.tipRemoved.add));this._control.append(i);t=_d.querySelector("a.b_saveOnLocal");i.set_style({top:t.offsetTop+t.offsetHeight,left:t.offsetLeft+t.offsetWidth/2-i[0].offsetWidth/2});this.hoverTip&&this.hoverTip.removeTip();this.hoverTip=n},i.prototype._buildCollectionsTaskData=function(n,t){t===void 0&&(t=!0);var i={};i.action=t?15:17;i.entityId=n.id;i.entryPoint=14;this._taskOptions={action:"activate",type:"CollectionsTask",state:i}},i.localStorageKey="MyPlacesSaveOnSerp",i.multiSaveKey="MultiEntitySaveOnSerp",i}(tt),ft;(function(r){function v(){f?(f.primitives.clear(),f.description=""):f=new i("TEMP",a.L_TemporaryCollectionTitle)}function e(){return(u.isMapsVertical||u.dynamicProperties.isMapsOverlay)&&w.isEnabled()}function h(n){var i,r,t;if(f)for(i=f.primitives,r=i?i.length:0,t=0;t<r;t++)if(i[t].entity.id===n)return t;return-1}function y(n){for(var t,i=new c,r=0;r<n.length;r++)t=n[0],t.Image&&i.insert(t.Image);f.collageImages=i}function p(t){if(e()){f&&s||r.getCollection();var i=h(t.entity.id);return i===-1?(f.primitives.insert(t),r.commitChanges(),n.enableOneClickSave&&ut.instance.pushCollection(f),0):12}return 1}function b(n){if(e()){var t=h(n);t!==-1&&f.primitives.removeAt(t);r.commitChanges()}}function k(n,t,i){var o,u;e()&&(o=h(n),o!==-1&&(u=f.primitives[o],u.entity.name=t,u.entity.description=i,u.changed.invoke(),f.primitives.changed.invoke()),r.commitChanges())}function d(){if(e()){if(f||v(),!s){var r=w.getItem(o),t=JSON.parse(r),u=t&&t.$type==="GeoAnnotationsCollection",n=i.deserialize(t,u);n&&n.primitives&&(f.primitives=n.primitives,y(n.primitives));s=!0}return f}return null}function g(){if(e()){var n=JSON.stringify(i.serialize(f,!0));w.setItem(o,n)}}function nt(){e()&&(n.enableOneClickSave&&ut.instance.removeCollection(f),w.removeItem(o),v())}function tt(){if(e()&&!l){var u=w.getItem(o),n=JSON.parse(u),f=n&&n.$type==="GeoAnnotationsCollection",r=i.deserialize(n,f);r&&r.primitives&&t.logAction("TCS",{ENT:r.primitives.length});l=!0}}var o="BingMapsUserCollections",f=new i("TEMP",a.L_TemporaryCollectionTitle),s=!1,l=!1;r.addPoint=p;r.removePoint=b;r.updatePoint=k;r.getCollection=d;r.commitChanges=g;r.clearCollection=nt;r.logTemporaryCollection=tt})(ft||(ft={}));h=s.CloudGraphDataManager={};h.AutoCollectionGenerator=pi;h.Collection=i;h.CollectionEntity=o;h.CollectionsDataManager=vt;h.CollectionsLocalStorageHelper=ft;h.Contribution=wi;h.EventEntity=kt;h.FavoriteEntity=bt;h.FavoritePoint=lt;h.FlightEntity=ii;h.Itinerary=it;h.ItineraryConverter=k;h.ItineraryDataManager=st;h.ItineraryItem=yt;h.ItineraryRequestFactory=nt;h.MostRecentlyUsedList=ut;h.MyPlaces=at;h.NewCollectionControl=nr;h.Polygon=et;h.Polyline=ot;h.SaveDropdownControl=tr;h.ServerRequestFactory=e;h.SimplePoint=v;h.Utilities=t}catch(ui){if(s&&s.logger)s.logger.logCriticalError(ui);else throw ui;}}).call(window)