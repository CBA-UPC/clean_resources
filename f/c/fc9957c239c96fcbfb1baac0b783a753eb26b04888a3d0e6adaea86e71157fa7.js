(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[9343,4807,7046],{94807:function(e,t,n){"use strict";n.r(t);var i=n(18487),r=n(62414),o=n(95272),s=1e3,a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.prefixClass},[n("k-loading"),e._v(" "),n("div",{class:e.prefixClass+"_content"},[n("div",{class:e.prefixClass+"_content-text"},[e._v(e._s(e.text))]),e._v(" "),e.tips?n("div",{class:e.prefixClass+"_content-tips"},[e._v(e._s(e.tips))]):e._e(),e._v(" "),e.hasButton?n("k-button",{class:e.prefixClass+"_content-button",attrs:{type:e.buttonConfig.type||"primary",useNewLayout:e.buttonConfig.useNewLayout},on:{click:e.handleClick}},[e._v("\n      "+e._s(e.buttonConfig.text)+"\n      "),e.hasCountdown?[e._v(e._s(e.countdownText))]:e._e()],2):e._e()],1)],1)},staticRenderFns:[],name:"KImportDataLoading",components:{KLoading:o.Z,KButton:r.Z},props:{text:{type:String,default:"å¯¼å…¥ä¸­..."},tips:{type:String,default:""},buttonConfig:{type:Object,default:function(){return{}}},countdown:{type:Number,default:0},countdownOffCb:{type:Function,default:function(){}}},computed:{hasBtext},hasCountdown:function(){return Number(this.countdown)>s},countdownText:function(){return"(".concat((this.second/s).toFixed(0),"s)")}}d:0}},mown()},methods:{se")},handleCountdown:function(){var e=this;if(this.countdown){this.second=this.countdown;setTimeout((function t(){e.second-=s,e.second<0?(e.countdownOffCb(),e.close()):setTimeout(t,s)}),s)}},handlese()}},beforeDemer)}},c=(0,i.Z)({entry:a,pages:[{useNewLayout:!0,hideHeader:!0,className:["k-dialog-import-data-loading"],width:"360px",body:a,showClose:!1,footer:null,closeOnClickModal:!1}]});t.default=c},87046:function(e,t,n){"use strict";n.r(t);var i=n(18487),r=n(49200),o=n(45578),s=n.n(o),a=n(43800),c=n(87936),u=n(19731),l=n(16548),p=n(96133),f=n(62414),d=n(95272),m=n(47390),h=n(54464),v=n(41838),_=n(37021),g=n(47189);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b="å¯¼å…¥å·²å®Œæˆï¼",C="å…±äº«æ–‡ä»¶å¤¹å‡çº§å®Œæˆï¼",x=3,w={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:[e.prefixClass,{loading:e.loading}]},[e.loading?n("k-loading"):[n("div",{class:e.prefixClass+"_title"},[e._v(e._s(e.resultTitle))]),e._v(" "),n("div",{class:e.prefixClass+"_error-content"},[n("div",{directives:[{name:"dompurify-html",rawName:"v-dompurify-html",value:e.taskResultText,expression:"taskResultText"}],class:e.prefixClass+"_error-content-desc"}),e._v(" "),e.failList.length?n("div",{class:e.prefixClass+"_error-content-list"},[n("k-scroll",e._l(e.failList,(function(t){return n("div",{key:t.origin_group_id,class:e.prefixClass+"_error-content-list-item"},[n("group-logo",{attrs:{size:"24"}}),e._v(" "),n("div",{class:e.prefixClass+"_error-content-list-item-name"},[e._v("\n              "+e._s(t.origin_group_name)+"\n            ")]),e._v(" "),n("div",{class:e.prefixClass+"_error-content-list-item-fail"},[e._v("\n              "+e._s(t.fail_reason)+"\n              "),n("warn-icon")],1)],1)})),0),e._v(" "),n("div",{class:e.prefixClass+"_error-content-list-tips"},[e._v("\n          æç¤ºï¼šå¯¼å…¥å¤±è´¥åï¼Œå¯è¿›å…¥ä¼ä¸šå›¢é˜Ÿç‚¹å‡»"),n("strong",[e._v("ã€Œå¯¼å…¥ã€")]),e._v("åŠŸèƒ½ï¼Œé‡æ–°å¯¼å…¥æ–‡ä»¶\n        ")])],1):e._e()]),e._v(" "),n("div",{class:e.prefixClass+"_invite"},[e.invite.members.length>0?n("div",{class:e.prefixClass+"_invite-members"},[n("div",{class:e.prefixClass+"_invite-members-desc"},[e._v("\n          "+e._s(e.policy.data.text)+"\n        ")]),e._v(" "),n("div",{class:e.prefixClass+"_invite-members-content"},[n("div",{class:e.prefixClass+"_invite-members-content-list"},[e._l(e.displayInviteMembers,(function(t){var i=t.avatar,r=t.user_id;return n("img",{key:"invited-member-"+r,class:e.prefixClass+"_invite-members-content-list-item",attrs:{src:i}})})),e._v(" "),e.invite.members.length>4?n("more-icon",{class:e.prefixClass+"_invite-members-content-list-more",attrs:{size:"12",fill:"var(--kd-color-icon-secondary)"}}):e._e()],2),e._v(" "),n("div",{class:e.prefixClass+"_invite-members-content-view",on:{click:e.viewInviteMembers}},[e._v("\n            æŸ¥çœ‹é‚€è¯·åå•\n          ")])])]):e._e(),e._v(" "),n("div",{class:e.prefixClass+"_invite-link"},[n("div",{class:e.prefixClass+"_invite-link-tips"},[e._v("\n          "+e._s(e.policy.data.copyurl_desc)+"\n        ")]),e._v(" "),n("div",{class:e.prefixClass+"_invite-link-inner"},[n("link-icon",{attrs:{size:"16"}}),e._v(" "),n("div",{class:e.prefixClass+"_invite-link-inner-url",attrs:{title:e.invite.link}},[e._v("\n            "+e._s(e.invite.link)+"\n          ")]),e._v(" "),n("k-button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:e.invite.link+"\n"+e.inviteLinkSuffixText,expression:"`${invite.link}\\n${inviteLinkSuffixText}`"}],attrs:{useNewLayout:"",type:"primary"},on:{success:e.onCopySuccess}},[e._v(e._s(e.policy.data.invite_button||"å¤åˆ¶é“¾æ¥"))])],1)])])]],2)},staticRenderFns:[],name:"KMigrateDataResult",components:{KScroll:p.Z,KButton:f.Z,KLoading:d.Z,LinkIcon:m.Z,MoreIcon:h.Z,WarnIcon:v.Z,GroupLogo:_.Z},directives:{clipboard:a.B,DompurifyHtml:c.Z},props:{taskType:{type:String,required:!0},companyId:{type:Number,default:0},groupId:{type:Number,default:0},userId:{type:Number,default:0},userRole:{type:String,default:""},from:{type:String,default:"group_import_result"}},data:function(){return{prefixClass:"k-migrate-task-result",failList:[],taskResultList:[],totalFileCounts:0,loading:!0,policy:{id:0,taskId:0,data:{title:"upgrade"===this.taskType?C:b,text:"å·²å‘åŸä¸ªäººå›¢é˜Ÿ/å…±äº«æ–‡ä»¶å¤¹çš„æˆå‘˜å‘é€åŠ å…¥ä¼ä¸šå›¢é˜Ÿçš„é‚€è¯·ï¼Œå¾…æˆå‘˜æ¥å—é‚€è¯·åå¯æ­£å¸¸è®¿é—®ä¼ä¸šå›¢é˜Ÿ",invite_button:"å¤åˆ¶é“¾æ¥ï¼Œé‚€è¯·æˆå‘˜",invite_text:"é‚€è¯·ä½ åŠ å…¥ã€${companyGroup}ã€‘ï¼Œä¸€èµ·æ–‡æ¡£åä½œ",copyurl_desc:"åˆ†äº«é“¾æ¥é‚€è¯·æ›´å¤šæˆå‘˜åŠ å…¥ä¼ä¸šè¿›è¡Œåä½œ"}},invite:{link:"",suffixText:"",members:[]},migrateTask:{},upgradeTask:{}}},computed:{taskResultText:function(){var e=this.taskResultList.length,t=this.failList.length,n=this.totalFileCounts,i=t?"æˆåŠŸï¼š".concat(e-t,"ä¸ªï¼Œå¤±è´¥ï¼š<font color=var(--kd-color-t´¥åŸå› å¦‚ä¸‹");return"æœ¬æ¬¡å¯¼å…¥".concat(e,"ä¸ªå›¢é˜Ÿï¼Œ").concat(i)},inviteLinkSuffixText:function(){var e=this.invite.suffixText,t=e.match(/ã€Œ(.*)ã€/);return t?this.replacePlaceholder(this.policy.data.invite_text,{companyGroup:t[1]}):e},displayInviteMembers:function(){return this.invite.members.slice(0,4)},isUpgradeTask:function(){return"upgrade"===this.taskType},resultTitle:function(){return"migrate"===this.taskType?(this.migrateTask.rewarded?this.policy.data.title_gift:this.policy.data.title)||b:this.policy.data.title||C},userRoleMap",3:"member"}[this.userRole]||"membervar e;return this.isUpgradeTask?"move":(null===(e=this.taskResultList[0])||void 0===e?void 0:e.sync_type)||"move"}},created:function(){var e=this;Promise.all([this.fetchInviteLink(),this.fetchPolicy().finally((function(){return e.fetchTaskResult().then((function(){e.eventReport({operate:"show"})}))}))]).then((function(){e.$nextTick((function(){e.loading=!1})),e.postCollections()})).catch((function(){e.$emit("close"),l.T.warning("ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åç‚¹å‡»å³ä¸Šè§’ã€Œå¯¼å…¥å›¢é˜Ÿã€é‡è¯•"),e.eventReport({operate:"error_show"})}))},beforeDestroy:functie"})},methods:{fetchTaskResult:function(){var e=thiseturn(0,g.SNf)({detail:!0}).then((function(t){var n=t.data,i=Object.freeze(n||{});e.migrateTask=i;var r=i.task_results||[];e.taskResultList=r,e.invite.members=e.uniqueMembers(r.map((function(e){return e.invited_members})).flat(1));var o=r.filter((function(e){var t=e.fail_reason,n=e.task_status;return t&&n===x}));o.length?e.failList=o:e.totalFileCounts=r.reduce((function(e,t){return e+t.file_counts}),0)}));case"upgrade":return(0,g.EGk)(this.groupId).then((function(t){var n=t.data,i=Object.freeze(.invite.members=e.uniqueMembers(i.invited_members||[]),e.totalFileCounts=i.file_counts||0}))}},fetchInviteLink:function(){var e=this,t=(0,u.at)(window)||"docsWeb";switch(this.taskType){case"migrate":return(0,g.nei)(this.companyId,{params:{source:JSON.stringify({invite_info:{scene:"import_invite",invite_source:t}})}}).then((function(t){e.invite.link=t.invitelink,e.invite.suffixText=t.invite_content}));case"upgrade":return(0,g.ZB8)(this.groupId).then((function(n){var i,r=n.data;e.invite.suffixText=r.title;var o=r.invite_url,s=null===(i=r.invite_link)||void 0===i?void 0:i.key;return s?(0,g.d1X)(e.companyId,{context:{encs_group_linkid:s},credential:{encs_group_linkid:s},source:window.btoa(JSON.stringify({invite_info:{scene:"upgrade_invite",invite_source:t}})).replace(/=+$/,"")}).then((function(t){var n=t.data;null!=n&&n.url?e.invite.link=n.url:e.invite.link=o})):void(e.invite.link=o)}))}},fetchPolicy:function(){var e=this,t=this.isUpgradeTask?{group_id:this.groupId,window_key:"personal_upgrade_complete"}:{company_id:this.companyId,window_key:"personal_move_complete"};return(0,g.SPt)(t).then((function(t){var n=t.data;if(n){var i=n.data,r=void 0===i?[]:i,o=n.policy_id,s=n.task_id;if(r.length){var a=r.reduce((function(e,t){var n=t.key,i=t.value;return e[n]=i,e}),{});e.policy=Object.freeze({id:o,taskId:s,data:a})}}}))},viewInviteMembers:function(){this.$emit("change","KMigrateTaskInviteMembers",{members:this.invite.members}),this.eventReport({operate:"invite_list"})},uniqueMembers:function(e){return Object.freeze(s()(e,"user_id"))},replacePlaceholder:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{start:"${",end:"}"};if("string"!=typeof e)return e;for(var i in e=decodeURIComponent(e),t)e=e.replace(new RegExp("\\".concat(n.start)+i+"\\".concat(n.end),"g"),"".concat(t[i]||""));return e},postCollections:function(){if("upgrade"===this.taskType)(0,g.A6_)({entity_id:this.groupId,collection_type:"group_create",collection_data:[{key:"event_sharefile_move_complete_pop_show",value:"true"}]})},eventReport:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t=this.taskResultList.length,n=this.failList.length,i=this.from;this.report(i,k(k({},e),{},{company_id:"".concat(this.companyId),account_id:"".concat(this.userId),role:this.userRoleMapping,policy_id:"".concat(this.policy.id),task_id:"".concat(this.policy.taskId),group_num:t,group_success:t-n,group_failure:n,user_num:this.invite.members.length,source:(0,u.at)(window),task_type:this.taskType,import_type:this.importType}))}catch(e){}},onCopySuccess:function(){l.T.info("å¤åˆ¶æˆåŠŸ"),this.eventReport({operate:"copy_link"})}}},O={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{cla"k-scrov",{key:i,class:e.prefixClass+"_item"},[n("img",{class:e.prefixClass+"_item-avatar",attrs:{src:r,alt:""}}),e._v(" "),n("div",{class:e.prefixClass+"_item-name"},[e._v(e._s(o))])])})),0)],1)},staticRenderFns:[],name:"KMigrateTaskInviteMembers",components:{KScroll:p.Z},props:{members:{type:Array,default:function(){return[]}}},data:function(){return Object.freeze({prefixClass:"k-migrate-task-invite-members"})}},I=(0,i.Z)({:!0,hideHeader:!0,className:["k-dialog-migrate-task-result"],width:"480px",body:w,showClose:!0,footer:null,closeOnClickModal:!1},{title:"é‚€è¯·æˆå‘˜åå•",useNewLayout:!0,hideHeader:!0,className:["k-dialog-migrate-task-invite-member"],width:"480px",body:O,showClose:!0,footer:null,closeOnClickModal:!1}]});I.dw={KMigrateDataResult:[{trigger:"mounted",listener:function(e){var t=this;e.report=function(e,n){t.track(e,n)}}}]},t.default=I},57153:function(e,t,n){"use strict";var i=n(56451),r=n(49200),o=n(80862),s=n(62414),a=n(94807),c=n(87046),u=n(47189),l=n(2969),p=n(16548),f=n(19731);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=2e3,v={created:0,running:1,succeeded:2,failed:3},_={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.freezeData.prefixClass},[n("ul",{class:e.freezeData.prefixClass+"_list"},e._l(e.freezeData.instructions,(function(t,i){return n("li",{key:"item-"+i,class:e.freezeData.prefixClass+"_list-item"},[e._v("\n      "+e._s(i+1)+". "+e._s(t)+"\n    ")])})),0),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_tips"},[n("info-shape",{attrs:{fill:["var(--kd-color-icon-secondary, #757575)"]}}),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_tips-text"},[e._v("\n      è‹¥ä»æƒ³åœ¨ä¸ªäººå›¢é˜Ÿ/å…±äº«æ–‡ä»¶å¤¹ä¿ç•™æ–‡æ¡£ï¼Œå¯é€‰æ‹©å¤åˆ¶è‡³ä¼ä¸š\n    ")])],1),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_bu,{class:e.freezeData.prefixClass+"_buttons-import",attrs:{type:"primary",useNewLayout:""},on:{click:function(t){return e.confirm("move")}}},[e._v("\n      å·²äº†è§£ï¼Œç¡®å®šå¯¼å…¥\n    ")]),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_buttons-copy",on:{click:function(t){return e.confirm("copy")}}},[e._v("\n      å¤åˆ¶ä¸ªäººå›¢é˜Ÿ/å…±äº«æ–‡ä»¶å¤¹\n    ")])],1)])},staticRenderFns:[],name:"KImportDataNotice",components:{KButton:s.Z,InfoShape:o.Z},props:{params:{type:Object,default:function(){return{}}},companyId:{type:Number,required:!0},userId:{type:Number,default:0},groupId:{type:Number,default:0},userRole:{type:String,default:""},ignoreReward:{type:Boolean,default:!1},onUpgrading:{type:Function,default:function(){}},onFinished:{type:Funct:function(){}},onError:{type:Function,default:function(){}},from:{type:String,default:"group_import_result"}},computed:{userRoleMapping:function(){return{1:"superadm",2:"admin",3:"member"}[this.userRole]||"member"}},data:function(){return{timer:0,pollingCancel:!1,freezeData:Object.freeze({prefixClass:"k-import-data-notice",instructions:["å·²é€‰å›¢é˜Ÿ/å…±äº«æ–‡ä»¶å¤¹ä¸å†ä¿ç•™æ–‡æ¡£ï¼Œæ‰€æœ‰æ–‡æ¡£ç§»å…¥ä¼ä¸šï¼Œæ–‡æ¡£é“¾æ¥ä¸å˜","å¯¼å…¥åï¼Œæ–‡æ¡£å°†æ— æ³•å†è¿ç§»å›ä¸ªäººå›¢é˜Ÿ/å…±äº«æ–‡ä»¶å¤¹","å¯¼å…¥åï¼Œå°†è‡ªåŠ¨å‘ä¸ªäººå›¢é˜Ÿ/å…±äº«æ–‡ä»¶å¤¹æˆå‘˜å‘é€åŠ å…¥ä¼ä¸šå›¢é˜Ÿçš„é‚€è¯·"]})}},mounted:function(){this.eventReport({operate:"show",pop_name:"notice"})},befasClickCloseBtn&&this.eventReport({operate:"close",pop_name:"notice"})},methods:{confirm:function(e){var t=this,n=this;this.$emit("close"),a.default.show({tips:"è¯·å‹¿åˆ‡æ¢æˆ–é€€å‡ºè´¦å·ï¼Œä»¥å…å½±å“æ“ä½œè¿›ç¨‹",buttonConfig:{text:"åå°å¯¼å…¥",useNewLayout:!0,onClick:function(){n.stopPollingTask(),n.onBackgroundExec(),a.default.hide(),n.eventReport({operate:"background",pop_name:"loading"})}}}),(0,l.Qq)(m(m({},this.params),{},{sync_type:e,ignore_reward:this.ignoreReward})).then((function(e){switch(e.result){case"ok":t.startPollingTask(a.default.close);break;case"ERR_TASK_RUNNING":t.handleImportError("å·²æœ‰å¯¼å…¥æ“ä½œæ­£åœ¨æ‰§è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆåå†è¿›è¡Œå¯¼å…¥");break;default:t.handleImportError()}})).catch((function(){t.handleImportError()})),[["show","loading"],["move"===e?"import":e,"notice"]].forEach((function(e){var n=(0,i.Z)(e,2),r=n[0],o=n[1];t.eventReport({operate:r,pop_name:o})}))},startPollingTask:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this.pollingCancel)this.onUpgrading();else{var n=function n(){(0,u.SNf)().then((function(i){var r=i.data;[v.succeeded,v.failed].includes(r.task_status)?(t(),e.stopPollingTask(!1),r.task_status===v.succeeded?(e.onFinished(),e.showMigrateTaskResult()):e.handleImportError()):e.timer=setTimeout(n,h)}))};this.timer=setTimeout(n,h)}},stopPollingTask:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.pollingCancel=!0,this.timer&&(clearTimeout(this.timer),e&&this.onUpgrading(),this.TaskResult:function(){c.default.show({taskType:"migrate",userId:this.userId,groupId:this.groupId,userRole:this.userRole,companyId:this.companyId,from:this.from})},handleImportError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åç‚¹å‡»åc=n.n(a),u=n(13235),l=n.n(u),p=n(96133),f=n(62414),d=n(95272),m=n.p+"s1/static/images/7cbfa88efde608b18e45.svg",h=n.p+"s1/static/images/3e9b33a370b3574e8a02.svg",v=n(37021),_=n(19731),g=n(16548),y=n(87936),k=n(47189),b=n(2969);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.enable?n("div",{class:[e.freezeData.prefixClass,{loading:e.loading}],style:{"--loading-height":e.-loading"):[n("div",{class:e.freezeData.prefixClass+"_title"},[e._v("\n      "+e._s(e.policy.data.title)+"\n    ")]),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_desc"},[e._v("\n      "+e._s(e.policy.data.function_text)+"\n    ")]),e._v(" "),e.showPolicyGiftInterest?n("div",{directives:[{name:"dompurify-html",rawName:"v-dompurify-html",value:e.policy.data.right_text,expression:"policy.data.right_text"}],class:e.freezeData.prefixClass+"_gift",style:{"--icon":"url("+e.freezeData.giftIcon+")"}}):e._e(),e._v(" "),n("k-scroll",{class:e.freezeData.prefixClass+"_list",style:{height:e.importListHeight},attrs:{loadingText:"åŠ è½½ä¸­",loading:e.groupConfig.lock,onLoad:e.fetchGroupDetail}},[n("el-checkbox-group",{on:{change:e.handleChecked},model:{value:e.checkedGroups,callback:function(t){e.checkedGroups=t},expression:"checkedGroups"}},e._l(e.groupConfig.displayList,(function(t){return n("el-checkbox",{key:t.id,class:e.freezeData.prefixClass+"_list-item",attrs:{label:t.label}},[n("group-logo",{attrs:{size:"24"}}),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_list-item-info"},[n("div",{class:e.freezeData.prefixClass+"_list-item-info-name"},[e._v("\n              "+e._s(t.name)+"\n            ")]),e._v(" "),t.file_space?n("div",{class:e.freezeData.prefixClass+"_list-item-info-space"},[e._v("\n              å·²å­˜å‚¨"+e._s(e._f("formatSize")(t.file_space))+"æ–‡ä»¶\n            ")]):e._e()]),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_list-item-member"},[e._l(t.member_info,(function(i){return n("div",{key:t.id+"-"+i.user_id,class:e.freezeData.prefixClass+"_list-item-member-avatar"},[n("img",{attrs:{src:i.avatar}})])})),e._v(" "),t.member_count>4?n("div",{class:e.freezeData.prefixClass+"_list-item-member-count"},[e._v("\n              "+e._s(t.member_count)+"\n            ")]):e._e()],2)],1)})),1)],1),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_footer"},[n("k-button",{adisabled:!e.checkedGroups.length},on:{click:e.handleConfirm}},[e._v("\n        "+e._s(e.policy.data.import)+"\n      ")]),e._v(" "),n("k-button",{attrs:{useNewLayout:""},on:{click:e.handleCancel}},[e._v("\n        "+e._s(e.policy.data.cancel)+"\n      ")])],1)]],2):n("div",{class:[e.freezeData.prefixClass,"unable"]},[n("div",{class:e.freezeData.prefixClass+"_title"},[e._v("å¯¼å…¥å›¢é˜Ÿ")]),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_empty-content"},[n("div",{class:e.freezeData.prefixClass+"_empty-content-placeholder",style:{"--img":"url("+e.freezeData.contentsEmptyIcon+")"}}),e._v(" "),n("div",{class:e.freezeData.prefixClass+"_empty-content-tip"},[e._v("\n      å½“å‰è®¾å¤‡æœªç™»å½•å…³è”çš„ä¸ªäººè´¦å· æˆ– å½“å‰ç™»å½•çš„ä¸ªäººè´¦å·æ— å›¢é˜Ÿ/å…±äº«æ–‡ä»¶å¤¹\n    ")]),e._v(" "),n("k-button",{attrs:{useNewLayout:"",type:"primary"},on:{click:function(t){return e.$emit("close")}}},[e._v(" çŸ¥é“äº† ")])],1)])ectives:{DompurifyHtml:y.Z},components:{KScroll:p.Z,KButton:f.Z,KLoading:d.Z,GroupLogo:v.Z,ElCheckbox:c(),ElCheckboefault:!0},companyId:{tault:0},userRole:{type:String,default:""},visualEntryCount:{type:Number,default:3},loadingHeight:{type:String,default:"432px"},independent:{type:Boolean,default:!0},policyWindowKey:{type:String,default:"group_import_pop"},onCancel:{type:Function,default:function(){}},onConfirm:{type:Function,default:function(){}},onFinished:{type:Function,default:function(){}},onUpgrading:{type:Function,default:function(){}},onBackgroundExec:{type:Function,default:function(){}},onError:{type:Function,default:function(){}},useNewLayout:{type:Boolean,default:!1},from:{type:String,default:"group_import_result"}},computed:{importMulti:function(){return"false"===this.policy.data.is_select},importListHeight:function(){var e=Number(this.visualEntryCount)||3;return"".concat(68*e+8*e,"px")},maxCheckedCount:function(){return this.importMulti?10:1},showPolicyGiftInterest:function(){return!!this.policy.data.right_text},userRoleMapping:function(){return{1:"superadm",2:"admin",3:"member"}[this.userRole]||"member"},legalPolicyWindowKey:function(){return["group_import_pop","group_import_guid"].includes(this.policyWindowKey)?this.policyWindowKey:"group_import_pop"}},data:function(){return{loading:!0,accocon:m,contentsEmptyIcon:h,prefixClass:"k-import-personal-team-data"}),policy:{id:0,taskId:0,data:{}},groupConfig:{totalList:[],displayList:[],offset:0,count:5,end:!1,lock:!1,next:function(){}}}},fin"0B";var t=parseFloat(e),n=Math.floor(Math.log(t)/Math.log(1024(t/Math.pow(1024,n),2)+["B","KB","MB","GB","TB"][n]}},created:function(){var e=this;this.enable?this.fetchAccount().then((function(){Promise.all([e.fetchAllPersonalShareFolders(),e.fetchAllPersonalGroups(),e.fetchPolicy()]).then((fufig.totalList=Object.freeze(i.concat(o)),e.fetchGroupDetail().then((function(){e.loading=!1,e.eventReport({operate:"show",group_num:e.groupConfig.totalList.length})}))}))})):this.eventReport({operate:"no_show"})},beforeDestroy:function(){this.$root.hasClickCloseBtn&&this.eventReport({operate:"close"})},methods:{fetchAccount:function(){var e=this;return(0,k.Nqn)({auth_types:["email","phousers||[],i=n.find((function(e){return e.is_current}))||{},r=n.find((function(e){return!e.is_company_account}))||{};e.account=Object.freeze({current:i,personal:r})})).catch((function(){}))},fetchPolicy:function(){var e=this;return(0,k.SPt)({window_key:this.legalPolicyWindowKey,company_id:this.account.current.company_id}).then((function(t){var n=t.data,i=n.data,r=void 0===i?[]:i,o=n.policy_id,s=n.task_id,a=r.reduce((function(e,t){var n=t.key,i=t.value;return e[n]=i,e}),{});e.policy=Object.freeze({id:o,taskId:s,data:a}),e.$emit("policy-data",e.policy.tion(){var e=this.account.personal.userid;return new Promise((function(t){var n={list:[],offset:0,count:100,next:function(n){var r=arguments.length>1&&void 0!==arguments[1]?argumentsn,i()):t(this.list.filter((function(t){return t.share_creator.id===e})).map((function(e){var t=e.share_name,n=e.share_creator;return{name:t,type:"share_folder",id:e.file.linkgroupid,creatorId:n.id}})))}};function i(){var t={count:n.count,offset:n.offset,"x-kso-su-user":e};(0,b.tr)(t).then((function(e){var t=e.next_offset,i=e.share;n.next(t,i)})).catch((function(){n.next(n.offset,[])}))}i()}))},fetchAll{var e=this.account.personal.userid;return new Promise((function(t){var n={offset:0,count:100,list:[],next:function(e,n){e>0?(this.offset=e,this.list=this.list.concat(n),i()):t(this.list.filter((function(e){return"creator"===e.user_role})).map((function(e){var t=e.name;return{id:e.id,name:t,creatorId:e.creatorId,type:"team"}})))}};function iffset,"x-kso-su-user":e};(0,b.Ol)(t).then((function(e){var t=e.nextOffset,i=e.teams;n.next(t,i)})).catch((function(){n.next(n.offset,[])}))}i()}))},fetchGroupDetail:function(){var e=this;if(!this.groupConfig.lock&&!this.groupConfig.end)return this.groupConfig.lock=!0,new Promise((function(t){var n=e.groupConfig.totalList.slice(e.groupConfig.oConfig.count);if(!n.length)return e.groupConfig.end=!0,e.groupConfig.lock=!1,t();(0,k.f5W)(e.account.personal.userid,n.map((function(e){return e.id}))).then((function(i){var r=i.data;e.groupConfig.displayList=Object.freeze(e.groupConfig.displayList.concat(n.map((function(e){var t=e.id,n=e.name,i=e.type,o=r[t];return o?(e.label=JSON.stringify({id:t,name:n,type:i,count:o.member_count}),Object.assign(e,o)):e})))),e.groupConfig.offset+=e.groupConfig.count,e.groupConfig.lock=!1,t()})).catch((function(){e.groupConfig.lock=!1}))}))},handleChecked:function(e){e.length>this.maxCheckedCount&&(this.checkedGroups=e.slice(0,this.maxCheckedCount),g.T.warning("æ¯æ¬¡æœ€å¤šå¯å¯¼å…¥".concat(this.maxªå›¢é˜Ÿ/å…±äº«æ–‡ä»¶ï¼Œè¯·æŒ‰éœ€é€‰æ‹©")))},handleCancel:function(){this.$emit("close"),this.erate:"skip"})},handleConfirm:function(){var e=this,t=this.checkedGroups.map((function(e){return JSON.parse(e)})),n=[],i={utm:(0,_.at)(window)||"docsWeb",origin_groups:t.map((function(e){var t=e.id,i=e.name,r=e.type,o=e.count;return n.push(o),{origin_group_id:t,origin_group_name:i,origin_group_type:r}})),origin_user_id:this.account.personal.userid};if(this.independent){var r=function(){e.$emit("replace","KIm.groupId,userRole:e.userRole,companyId:e.companyId,userId:e.account.current.userid,ignoreReor,onFinished:e.onFentRepeduce((function(e,t){return e+(t||0)}),0)})},eventReport:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t=this.account.current,n=t.userid,i=t.company_id;this.report(x(x({},e),{},{account_id:"".concat(n),company_id:"".concat(i),role:this.userRoleMapping,policy_id:"".concat(this.policy.id),task_id:"".concat(this.policy.taskId),source:(0,_.at)(window),is_tip:this.showPolicyGiftInterest}))}catch(e){}}}};w.install=function(e){e.component(w.name,w)},w.dw={KImportPersonalTeamData:[{trigger:"mounted",listener:function(e){var t=this;e.report=function(e){t.track("group_import_select",e)}}}]};var O=w},89179:function(e,t,n){var i=n(55639),r=n(40554),o=n(14841),s=n(79833),a=i.isFinite,c=Math.min;e.exports=function(e){var t=Math[e];return function(e,n){if(e=o(e),(n=null==n?0:c(r(n),292))&&a(e)){var i=(s(e)+"e").split("e"),u=t(i[0]+"e"+(+i[1]+n));return+((i=(s(u)+"e").split("e"))[0]+"e"+(+i[1]-n))}return t(e)}}},59854:function(e,t,n){var i=n(89179)("round");e.exports=i}}]);
