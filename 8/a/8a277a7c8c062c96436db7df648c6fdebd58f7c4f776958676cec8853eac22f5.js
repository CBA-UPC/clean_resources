!function(){"use strict";var Oe={d:o:r:p:""};!);var fs={};Oe.r(fs),Oe.d(fs,{SandboxHost:function(){return FS},SandboxPromise:function(){return MS},SandboxPromise2:function(){return DS},SandboxPromiseHandler:function(){return AS},createSandboxHost:function(){return IS},exportCreateSandboxToGlobal:function(){return PS},exportOnSecurityPolicyViolationToGlobal:function(){return NS},formatModeRelayUIEvents:function(){return of},injectCustomVisual:function(){return _S},onSecurityPolicyViolation:function(){return TS},relayKeyboardEvents:function(){return nf},relayMouseEvents:function(){return wS},relayTouchEvents:function(){return xS},relayUIEventProps:function(){return sf},relayUIEvents:function(){return af}});var ds=ar de=n=window;gn.powerbi||(gn.powerbi={});var ff="True"===gn.useCDN&&gn.hashMappings?gn.cdnUrl:gn.powerbi.build;Oe.p=ff?ff+"/scripts/":"",_.constant(Oe.p);var rt=function(t){return t[t.Grouping=0]="Grouping",t[t.Measure=1]="Measure",t[t.GroupingOrMeasure=2]="GroupingOrMeasure",t}({}),lr=function(t){return t[t.Create=0]="Create",t[t.Append=1]="Append",t[t.Segment=2]="Segment",t[t.None=3]="None",t}({}),xt={}),OS=function(t){return{}}();function Ht(t){var e=t.type||xt.Data;return e&xt.Resize&&2===t.resizeMode&&(e|=xt.ResizeEnd),e}var HS={version:"1.0.0",overloads:hostAdapter:,u=),df=!1;function pf(t,e,r){u.assert(function(){return e>=0&&e<t.length},"startIndex is out of range."),u.assert("endIndex is out of range.");for(var n=[],i=e;i<=r;++i)n.push(t[i]);return n}function cr(t,e){u.assert(function(){return e>=0},"Count is negative."),u.assert("Count is too large.");for(var r=[],n=0;n<e;++n)r.push(t[n]);return r}function hf(t){return u.assertValue(t,"source"),cr(t,t.length)}nction ps(t){u.assertValue(t,"array");var e=t;return e.withName=XS,e}function XS(t){return function(t,e){var r=function(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r].name===e)return r;return-1}(t,e);if(r>=0)return t[r]}(this,t)}function vf(t,e){u.assertValue(t,"values"),u.assertValue(e,"compareFunction");var r=t.length;if(r>=2)for(var n=1;n<r;n++)if(e(t[n-1],t[n])>0)return!1;return!0}function hs(t,e){return u.assertValue(t,"values"),u.assertAnyValue(e,"descendingOrder"),vf(t,e?function(n,i){return i-n}:}||(window.debug=u,window.DEBUG=!1,df=!0);var Nr=1e-4,nE=Math.log(10),yf=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13,1e14,1e15,1e16,1e17,1e18,1e19,1e20,1e21,1e22,1e23,1e24,1e25,1e26,1e27,1e28,1e29,1e30,1e31,1e32,1e33,1e34,1e35,1e36,1e37,1e38,1e39,1e40,1e41,1e42,1e43,1e44,1e45,1e46,1e47,1e48,1e49,1e50,1e51,1e52,1e53,1e54,1e55,1e56,1e57,1e58,1e59,1e60,1e61,1e62,1e63,1e64,1e65,1e66,1e67,1e68,1e69,1e70,1e71,1e72,1e73,1e74,1e75,1e76,1e77,1e78,1e79,1e80,1e81,1e82,1e83,1e84,1e85,1e86,1e87,1e88,1e89,1e90,1e91,1e92,1e93,1e94,1e95,1e96,1e97,1e98,1e99,1e100,1e101,1e102,1e103,1e104,1e105,1e106,1e107,1e108,1e109,1e110,1e111,1e112,1e113,1e114,1e115,1e116,1e117,1e118,1e119,1e120,1e121,1e122,1e123,1e124,1e125,1e126,1e127,1e128,1e129,1e130,1e131,1e132,1e133,1e134,1e135,1e136,1e137,1e138,1e139,1e140,1e141,1e142,1e143,1e144,1e145,1e146,1e147,1e148,1e149,1e150,1e151,1e152,1e153,1e154,1e155,1e156,1e157,1e158,1e159,1e160,1e161,1e162,1e163,1e164,1e165,1e166,1e167,1e168,1e169,1e170,1e171,1e172,1e173,1e174,1e175,1e176,1e177,1e178,1e179,1e180,1e181,1e182,1e183,1e184,1e185,1e186,1e187,1e188,1e189,1e190,1e191,1e192,1e193,1e194,1e195,1e196,1e197,1e198,1e199,1e200,1e201,1e202,1e203,1e204,1e205,1e206,1e207,1e208,1e209,1e210,1e211,1e212,1e213,1e214,1e215,1e216,1e217,1e218,1e219,1e220,1e221,1e222,1e223,1e224,1e225,1e226,1e227,1e228,1e229,1e230,1e231,1e232,1e233,1e234,1e235,1e236,1e237,1e238,1e239,1e240,1e241,1e242,1e243,1e244,1e245,1e246,1e247,1e248,1e249,1e250,1e251,1e252,1e253,1e254,1e255,1e256,1e257,1e258,1e259,1e260,1e261,1e262,1e263,1e264,1e265,1e266,1e267,1e268,1e269,1e270,1e271,1e272,1e273,1e274,1e275,1e276,1e277,1e278,1e279,1e280,1e281,1e282,1e283,1e284,1e285,1e286,1e287,1e288,1e289,1e290,1e291,1e292,1e293,1e294,1e295,1e296,1e297,1e298,1e299,1e300,1e301,1e302,1e303,1e304,1e305,1e306,1e307,1e308],ys=[1,.1,.01,.001,1e-4,1e-5,1e-6,1e-7,1e-8,1e-9,1e-10,1e-11,1e-12,1e-13,1e-14,1e-15,1e-16,1e-17,1e-18,1e-19,1e-20,1e-21,1e-22,1e-23,1e-24,1e-25,1e-26,1e-27,1e-28,1e-29,1e-30,1e-31,1e-32,1e-33,1e-34,1e-35,1e-36,1e-37,1e-38,1e-39,1e-40,1e-41,1e-42,1e-43,1e-44,1e-45,1e-46,1e-47,1e-48,1e-49,1e-50,1e-51,1e-52,1e-53,1e-54,1e-55,1e-56,1e-57,1e-58,1e-59,1e-60,1e-61,1e-62,1e-63,1e-64,1e-65,1e-66,1e-67,1e-68,1e-69,1e-70,1e-71,1e-72,1e-73,1e-74,1e-75,1e-76,1e-77,1e-78,1e-79,1e-80,1e-81,1e-82,1e-83,1e-84,1e-85,1e-86,1e-87,1e-88,1e-89,1e-90,1e-91,1e-92,1e-93,1e-94,1e-95,1e-96,1e-97,1e-98,1e-99,1e-100,1e-101,1e-102,1e-103,1e-104,1e-105,1e-106,1e-107,1e-108,1e-109,1e-110,1e-111,1e-112,1e-113,1e-114,1e-115,1e-116,1e-117,1e-118,1e-119,1e-120,1e-121,1e-122,1e-123,1e-124,1e-125,1e-126,1e-127,1e-128,1e-129,1e-130,1e-131,1e-132,1e-133,1e-134,1e-135,1e-136,1e-137,1e-138,1e-139,1e-140,1e-141,1e-142,1e-143,1e-144,1e-145,1e-146,1e-147,1e-148,1e-149,1e-150,1e-151,1e-152,1e-153,1e-154,1e-155,1e-156,1e-157,1e-158,1e-159,1e-160,1e-161,1e-162,1e-163,1e-164,1e-165,1e-166,1e-167,1e-168,1e-169,1e-170,1e-171,1e-172,1e-173,1e-174,1e-175,1e-176,1e-177,1e-178,1e-179,1e-180,1e-181,1e-182,1e-183,1e-184,1e-185,1e-186,1e-187,1e-188,1e-189,1e-190,1e-191,1e-192,1e-193,1e-194,1e-195,1e-196,1e-197,1e-198,1e-199,1e-200,1e-201,1e-202,1e-203,1e-204,1e-205,1e-206,1e-207,1e-208,1e-209,1e-210,1e-211,1e-212,1e-213,1e-214,1e-215,1e-216,1e-217,1e-218,1e-219,1e-220,1e-221,1e-222,1e-223,1e-224,1e-225,1e-226,1e-227,1e-228,1e-229,1e-230,1e-231,1e-232,1e-233,1e-234,1e-235,1e-236,1e-237,1e-238,1e-239,1e-240,1e-241,1e-242,1e-243,1e-244,1e-245,1e-246,1e-247,1e-248,1e-249,1e-250,1e-251,1e-252,1e-253,1e-254,1e-255,1e-256,1e-257,1e-258,1e-259,1e-260,1e-261,1e-262,1e-263,1e-264,1e-265,1e-266,1e-267,1e-268,1e-269,1e-270,1e-271,1e-272,1e-273,1e-274,1e-275,1e-276,1e-277,1e-278,1e-279,1e-280,1e-281,1e-282,1e-283,1e-284,1e-285,1e-286,1e-287,1e-288,1e-289,1e-290,1e-291,1e-292,1e-293,1e-294,1e-295,1e-296,1e-297,1e-298,1e-299,1e-300,1e-301,1e-302,1e-303,1e-304,1e-305,1e-306,1e-307,1e-308,1e-309,1e-310,1e-311,1e-312,1e-313,1e-314,1e-315,1e-316,1e-317,1e-318,1e-319,1e-320,1e-321,1e-322,1e-323,0];function dr(t){return u.assertValue(t,"exp"),t>=0?t<yf.length?yf[t]:1/0:(t=-t)>0&&t<ys.length?ys[t]:0}function pr(t){return u.assert(function(){return t>=0},"val"),t>1&&t<1e16?t<1e8?t<1e4?t<100?t<10?0:1:t<1e3?2:3:t<1e6?t<1e5?4:5:t<1e7?6:7:t<1e12?t<1e10?t<1e9?8:9:t<1e11?10:11:t<1e14?t<1e13?12:13:t<1e15?14:15:t>1e-16&&t<1?t<1e-8?t<1e-12?t<1e-14?t<1e-15?-16:-15:t<1e-13?-14:-13:t<1e-10?t<1e-11?-12:-11:t<1e-9?-10:-9:t<1e-4?t<1e-6?t<1e-7?-8:-7:t<1e-5?-6:-5:t<.01?t<.001?-4:-3:t<.1?-2:-1:Zn(Math.log(t)/nE)}function kr(t,e){if(void 0===e?e=12:u.assert(function(){return e>=0},"decimalDigits"),t&&isFinite(t)){var r=pr(Math.abs(t));return r<-308?0:dr(Math.max(r-e,1-ys.length))}}function Zn(t,e){e=null!=e?e:Nr,u.assert(function(){return e>=0},"precision");var r=Math.round(t);return Math.abs(t-r)<e?r:Math.floor(t)}function Lr(t,e){e=Gt(e,Nr),u.assert(function(){return e>=0},"precision");var r=Math.round(t);return Math.abs(t-r)<e?r:Math.ceil(t)}function mf(t,e){return e=Gt(e,Nr),u.assert(function(){return e>=0},"precision"),0===e||0===t?t:Math.floor(t/e)*e}function Sf(t,e){return e=Gt(e,Nr),u.assert(function(){return e>=0},"precision"),0===e||0===t?t:Math.ceil(t/e)*e}function aa(t,e){if(e=Gt(e,Nr),u.assert(function(){return e>=0},"precision"),0===e||0===t)return t;var r=Math.round(t/e)*e,n=Math.round(pr(Math.abs(t))-pr(e))+1;return n>0&&n<16&&(r=parseFloat(r.toPrecision(n))),r}function ei(t,e,r){return u.assert(function(){return e<=r},"min must be less or equal to max"),null==t?t:t<e?e:t>r?r:t}nction sE(t,e){if(0===e)return t;var r=Br(t);if(r){var n=function(t){if(t){var e,r,n=t.R/255,i=t.G/255,a=t.B/255,o=Math.min(n,Math.min(i,a)),s=Math.max(n,Math.max(i,a)),c=s-o;return 0===s||0===c?(e=0,r=0):(e=c/s,r=n===s?(i-a)/c:i===s?2+(a-n)/c:4+(n-i)/c),(r/=6)<0&&(r+=1),{H:r,S:e,V:s}}}(r);if(n){var i=n,e);if(i){var a=function(t){var e,r,n,s,l,c,f,d,p,a=t.S,o=t.V;if(0===a)e=o,r=o,n=o;else switch(s=o*(1-a),l=o*(1-a*(f=(p=6*t.H)-(d=Math.floor(p)))),c=o*(1-a*(1-f)),d){case 0:e=o,r=c,n=s;break;case 1:e=l,r=o,n=s;break;case 2:e=s,r=o,n=c;break;case 3:e=s,r=l,n=o;break;case 4:e=c,r=s,n=o;break;case 5:e=o,r=s,n=l;break;default:return void u.assertFail("unexpected")}return{R:Math.floor(255*e),G:Math.floor(255*r),B:Math.floor(255*n)}}(i);if(a)return zr(a)}}}}nction Es(t){var r=ei(t,0,255).toString(16).toUpperCase();return 1===r.length?"0"+r:r}function ti(t,e,r){u.assert(function(){return t.length===e.length},"createLinearColorScale - domain and range must be the same size"),u.assert(function(){return t.length>1},"createLinearColorScale - domain and range must contain at least 2 values");var n=e.map(function(i){return Br(i)});return ar hE={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Cf=function(){eturn t.prototype.getColorScaleByKey=t.prototype.getNewColorScale=function(){return this.createScale()},t.prototype.getColorByIndex=function(e){var r=this;return u.assert("index is out of bounds"),this.colors[e]},t.prototype.getSentimentColors=function(){return this.sentimentColors},t.prototype.getGradientColors=function(){return this.gradientColors},t.prototype.getBasePickerColors=function(){return this.basePickerColors},t.prototype.getBaseColors=t.prototype.getAllColors=function(){return this.colors},t.prototype.createScale=function(){return gE.createFromColors(this.colors)},t}(),gE=function(){function t(e){this.scale=e}return t.prototype.getColor=t.prototype.clearAndRotateScale=function(){var e=this.scale.domain().length,r=function(t,e){if(0===e)return t.slice();var r=t.slice(e);return Array.prototype.push.apply(r,t.slice(0,e)),r}(this.scale.range(),e);this.scale=d3.scaleOrdinal().range(r)},t.prototype.clone=t.prototype.getDomain=function(){return this.scale.domain()},t.createFromColors=t}(),je=function(){function t(){}return t.getDefaultColors=function(){if(!t.defaultColors){t.defaultColors=[];for(var e=t.defaultBaseColors,r=0;r<t.colorSectorCount;++r)for(var n=0,i=e.length;n<i;++n){var a=sE(e[n].value,r/t.colorSectorCount);t.defaultColors.push({value:null!=a?a:e[n].value})}}return t.defaultColors},t.colorSectorCount=12,t.defaultBaseColors=[{value:"#01B8AA"},{value:"#374649"},{value:"#FD625E"},{value:"#F2C80F"},{value:"#5F6B6D"},{value:"#8AD4EB"},{value:"#FE9666"},{value:"#A66999"},{value:"#3599B8"},{value:"#DFBFBF"},{value:"#4AC5BB"},{value:"#5F6B6D"},{value:"#FB8281"},{value:"#F4D25A"},{value:"#7F898A"},{value:"#A4DDEE"},{value:"#FDAB89"},{value:"#B687AC"},{value:"#28738A"},{value:"#A78F8F"},{value:"#168980"},{value:"#293537"},{value:"#BB4A4A"},{value:"#B59525"},{value:"#475052"},{value:"#6A9FB0"},{value:"#BD7150"},{value:"#7B4F71"},{value:"#1B4D5C"},{value:"#706060"},{value:"#0F5C55"},{value:"#1C2325"},{value:"#7D3231"},{value:"#796419"},{value:"#303637"},{value:"#476A75"},{value:"#7E4B36"},{value:"#52354C"},{value:"#0D262E"},{value:"#544848"}],t.defaultSentimentColors={bad:{value:"#E81123"},neutral:{value:"#F2C811"},good:{value:"#3bb44a"}},t.defaultGradientColors={minColor:{value:"#FD625E"},midColor:{value:"#F5D33F"},maxColor:{value:"#01B8AA"},nullColor:{value:"#FF7F48"}},t}(),Or=function(){function t(e){u.assertValue(e,"factoryMethod"),this.factoryMethod=e}return t.prototype.getValue=t}();unction bf(t){return new Vf(t)}var Vf=function(){function t(e){var r=this;this.kind=0,u.assertNonEmpty(e,"roles"),this._roles=e,this._key=new Or(function(){return JSON.stringify(r.roles)})}return Object.defineProperty(t.prototype,"roles",{get:function(){return this._roles},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();function Pt(t){return u.assertValue(t,"expr"),2===t.kind}function Re(t){return u.assertValue(t,"expr"),17===t.kind}function wf(t){return u.assertValue(t,"expr"),Re(t)&&t.type.numeric}function xf(t){return u.assertValue(t,"expr"),Re(t)&&t.type.bool}function yn(t){return u.assertValue(t,"expr"),Re(t)&&t.type.dateTime}function bs(t){return u.assertValue(t,"expr"),Re(t)&&t.type.text}function sa(t){return u.assertValue(t,"expr"),Re(t)&&0===t.type.primitiveType&&null===t.value}function mn(t){return u.assertValue(t,"expr"),0===t.kind}function ri(t){return u.assertValue(t,"expr"),6===t.kind}function qr(t){return u.assertValue(t,"expr"),7===t.kind}function dt(t){return u.assertValue(t,"expr"),10===t.kind}function $e(t){return u.assertValue(t,"expr"),4===t.kind}function Sn(t){return u.assertValue(t,"expr"),3===t.kind}function Mf(t){return u.assertValue(t,"expr"),43===t.kind}function Vs(t){return u.assertValue(t,"expr"),44===t.kind}function ua(t){return u.assertValue(t,"expr"),28===t.kind}function ni(t){return u.assertValue(t,"expr"),5===t.kind}function jt(t){return u.assertValue(t,"expr"),30===t.kind}function Ur(t){return u.assertValue(t,"expr"),26===t.kind}function ii(t){return u.assertValue(t,"expr"),41===t.kind}function ws(t){return u.assertValue(t,"expr"),1===t.kind}function Df(t){return u.assertValue(t,"expr"),27===t.kind}function Af(t){return u.assertValue(t,"expr"),32===t.kind}function xs(t){return u.assertValue(t,"expr"),34===t.kind}function Tf(t){return u.assertValue(t,"expr"),36===t.kind}function If(t){return u.assertValue(t,"expr"),37===t.kind}function Ms(t){return u.assertValue(t,"expr"),9===t.kind}function En(t){return u.assertValue(t,"expr"),8===t.kind}function Wt(t){return u.assertValue(t,"expr"),11===t.kind}function Cn(t){return u.assertValue(t,"expr"),13===t.kind}function _f(t){return u.assertValue(t,"expr"),12===t.kind}function hr(t){return u.assertValue(t,"expr"),18===t.kind}function bn(t){return u.assertValue(t,"expr"),19===t.kind}function vr(t){return u.assertValue(t,"expr"),16===t.kind}function Ds(t){return u.assertValue(t,"expr"),20===t.kind}function Ff(t){return u.assertValue(t,"expr"),22===t.kind}function As(t){return u.assertValue(t,"expr"),21===t.kind}function Pf(t){return u.assertValue(t,"expr"),14===t.kind}function Ts(t){return u.assertValue(t,"expr"),46===t.kind}function ai(t){return u.assertValue(t,"expr"),47===t.kind}function la(){return window.powerbi||(window.powerbi={}),window.powerbi}function Rf(){var t=la();return t.common||(t.common={}),t.common}function ca(){var t=la();return t.visuals||(t.visuals={}),t.visuals}function Is(){return window.jsCommon||(window.jsCommon={}),window.jsCommon}Qt(Vf.prototype);var Nf=Error),_s=function(t){eturn T(e,t),e}(Nf),Mt=void 0!==window.performance&&window.performance.now&&window.performance.timeOrigin?Date.now;r fa=),da={}),kE=),pa=new kE,nt=function(){function t(){}return t.assertFail=function(e){u.assertValue(e,"message"),u.assertFail(e),this.error(e,!0)},t.warning=function(e,r,n){u.assertValue(e,"text"),this.logTraceInternal(new fa(e,da.Warning,this.sessionId,r,n))},t.error=function(e,r,n,i){u.assertValue(e,"text"),r&&(e=Ne("{0}.\nStack:\n{1}",e,function(t){var e,r;void 0===t&&(t=1);try{throw new Error}catch(n){null!=(e=n.stack)&&((r=e.split("\n")).splice(1,t),e=r.join("\n"))}return e}())),this.logTraceInternal(new fa(e,da.Error,this.sessionId,n,i))},t.information=function(e,r,n){u.assertValue(e,"text"),this.logTraceInternal(new fa(e,da.Information,this.sessionId,r,n))},t.verbose=function(e,r,n){u.assertValue(e,"text"),this.logTraceInternal(new fa(e,da.Verbose,this.sessionId,r,n))},t.addListener=function(e){u.assertValue(e,"listener"),_.find(this.listeners,function(r){return r===e})||this.listeners.push(e)},t.removeListener=function(e){u.assertValue(e,"listener");var r=this.listeners.indexOf(e);r>=0&&this.listeners.splice(r,1)},t.resetListeners=t.reset=t.getTraces=t.disableDefaultListener=function(){this.removeListener(pa)},t.enableDefaultListener=t.logTraceInternal=t.traces=new Array(1e3),t.lastTraceIndex=-1,t.listeners=new Array(pa),t}();Is().Trace=nt;var LE=window,BE=window.location.protocol+"//"+window.location.host;nction Gr(t,e,r){if(!e)return t;var n=function(t){return t.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}(e);return t.replace(new RegExp(n,"gi"),r)}function va(t,e,r,n){u.assertValue(t,"usedNames"),u.assertValue(e,"baseName"),u.assert("startSuffix == null || startSuffix >= 0");var i=n?" ":"",a=r||0,o=e;for(r&&(o+=i+r);qE(t,o);)o=e+i+ ++a;return o}unction Fs(t,e,r){if(!t||0===t.length)return"";null==r&&(r=Number.MAX_VALUE);for(var n=Math.min(r,t.length),i=[],a=0;a<2;a++)for(var o="{"+a+"}",s="_|_<"+a+">_|_",l=0;l<n;l++)t[l].indexOf(o)>-1&&(t[l]=t[l].replace(o,s),i.push({targetValue:o,replaceValue:s}));var c="";for(l=0;l<n;l++)c=0===l?t[l]:Ne(e.get("PowerBI_TwoStrings_SeperateWithCommaAndVisualSpace"),c,t[l]);for(var f=0,d=i;f<d.length;f++){var p=d[f];c=c.replace(p.replaceValue,p.targetValue)}return c}var pt=function(){function t(){}return t.ensureError=t.throwIfNullOrUndefined=function(e,r,n,i){null===e?this.throwException(function(t){return new _s("argumentNull","Argument was null",t)}(this.getComponentName(r)+n+"."+i)):void 0===e&&this.throwException(function(t){return new _s("argumentUndefined","Argument was undefined",t)}(this.getComponentName(r)+n+"."+i))},t.throwIfNullOrEmptyString=function(e,r,n,i){this.throwIfNullOrUndefined(e,r,n,i),e.length<1&&this.throwException(this.getComponentName(r)+n+"."+i))},t.valueOrDefault=t.urlCombine=function(e,r){if(this.throwIfNullOrUndefined(e,t,"urlCombine","baseUrl"),this.throwIfNullOrUndefined(r,t,"urlCombine","path"),Vn(r))return e;if(Vn(e))return r;var n=e;return"/"===n.charAt(n.length-1)?"/"===r.charAt(0)&&(r=r.slice(1)):"/"!==r.charAt(0)&&(r="/"+r),n+r},t.getAbsoluteUri=t.getStaticResourceUri=t.getComponentName=t.throwException=function(e){throw nt.error("Throwing exception: ".concat(JSON.stringify(e)),null==e.stack),this.ensureError(e)},t.createClassSelector=function(e){return this.throwIfNullOrEmptyString(e,null,"CreateClassSelector","className"),"."+e},t.createIdSelector=t.clampValue=function(e,r,n){return u.assert(function(){return r<=n},"min value must be less than or equal the max value"),e=Math.min(e,n),Math.max(e,r)},t.generateGuid=t.getCookieValue=t.getDomainForUrl=t.getHostNameForUrl=t.getUrlWithoutQueryString=t.getProtocolFromUrl=t.getHrefObjectFromUrl=t.getDateFromWcfJsonString=t.isValidImageDataUrl=function(e){return this.ImageDataRegex.test(e)},t.encodeUriForImageDataSvg=t.isLocalUrl=t.extractFileNameFromPath=t.is64BitOperatingSystem=t.isWindows10=t.parseNumber=t.getURLParamValue=t.getLocalTimeZoneString=t.ImageDataRegex=new RegExp("data:(image/(png|jpg|jpeg|gif|svg))"),t.ImageDataSvgRegex=new RegExp("data:(image/svg)"),t}(),zf=0;function oi(t){var e=window.performance;if(!e||!e.mark)return function(){return 0};var r="Begin "+(t=++zf+" "+t);e.mark(r);var n=Mt();return function(){var i="End "+t;return e.mark(i),e.measure&&e.measure(t,r,i),Mt()-n}}function We(t){var e=Mt();return t(),Mt()-e}var Of=!1;function(){if(!Of){var t=Ne;(function(){var t=Is();return t.StringExtensions||(t.StringExtensions={}),t.StringExtensions}()).format=Of=!0}}();var Rs,jE=function(){function t(e,r,n){this.ignoreCase=e,this.ignoreVariables=r,this.ignoreAnnotations=n}return t.getInstance=t.run=function(e,r,n,i,a){return(e=e||null)===(r=r||null)||!e==!r&&(u.assertValue(e,"x"),u.assertValue(r,"y"),e.accept(t.getInstance(n,i,a),r))},t.prototype.visitColumnRef=function(e,r){return!(!Pt(r)&&!xs(r))&&e.ref===r.ref&&this.equals(e.source,r.source)&&this.equalAnnotations(e,r)},t.prototype.visitMeasureRef=function(e,r){return!(!Sn(r)||!this.equalAnnotations(e,r))&&e.ref===r.ref&&this.equals(e.source,r.source)},t.prototype.visitNativeMeasure=function(e,r){if(!Mf(r)||e.language!==r.language||e.expression!==r.expression||e.dataType!==r.dataType||e.format!==r.format||e.proposedName!==r.proposedName||!this.equalAnnotations(e,r))return!1;var n=e.expressionContentCache,i=r.expressionContentCache;return!n&&!i||!(!n||!i)&&n.unrecognizedIdentifiers===i.unrecognizedIdentifiers&&this.equalsAll(n.dependencies,i.dependencies)},t.prototype.visitNativeColumn=function(e,r){if(!Vs(r)||e.language!==r.language||e.expression!==r.expression||e.dataType!==r.dataType||e.proposedName!==r.proposedName||e.format!==r.format||!this.equals(e.source,r.source)||!this.equalAnnotations(e,r))return!1;var n=e.expressionContentCache,i=r.expressionContentCache;return!n&&!i||!(!n||!i)&&n.unrecognizedIdentifiers===i.unrecognizedIdentifiers&&this.equalsAll(n.dependencies,i.dependencies)},t.prototype.visitAggr=function(e,r){return $e(r)&&this.equalAnnotations(e,r)&&e.func===r.func&&this.equals(e.arg,r.arg)},t.prototype.visitPercentile=function(e,r){return!(!ua(r)||!this.equalAnnotations(e,r))&&e.exclusive===r.exclusive&&e.k===r.k&&this.equals(e.arg,r.arg)},t.prototype.visitRangePercent=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),29===t.kind}(r)||!this.equalAnnotations(e,r))&&e.percent===r.percent&&this.equals(e.min,r.min)&&this.equals(e.max,r.max)},t.prototype.visitGroupRef=function(e,r){var n=!1;return(xs(r)||Pt(r))&&(n=e.ref===r.ref&&this.equals(e.source,r.source)&&this.equalAnnotations(e,r)),xs(r)&&this.equalAnnotations(e,r)&&(n=n&&this.equalsAll(e.groupedExprs,r.groupedExprs)),n},t.prototype.visitHierarchy=function(e,r){return!(!ri(r)||!this.equalAnnotations(e,r))&&e.hierarchy===r.hierarchy&&this.equals(e.arg,r.arg)},t.prototype.visitHierarchyLevel=function(e,r){return!(!qr(r)||!this.equalAnnotations(e,r))&&e.level===r.level&&this.equals(e.arg,r.arg)},t.prototype.visitPropertyVariationSource=function(e,r){return!(!ni(r)||!this.equalAnnotations(e,r))&&e.name===r.name&&e.property===r.property&&this.equals(e.arg,r.arg)},t.prototype.visitSelectRef=function(e,r){return!(!jt(r)||!this.equalAnnotations(e,r)||e.expressionName!==r.expressionName||e.attributeKind!==r.attributeKind&&this.isNullOrUndefined(e.attributeKind)!==this.isNullOrUndefined(r.attributeKind))},t.prototype.isNullOrUndefined=t.prototype.visitBetween=function(e,r){return!(!Ms(r)||!this.equalAnnotations(e,r))&&this.equals(e.arg,r.arg)&&this.equals(e.lower,r.lower)&&this.equals(e.upper,r.upper)},t.prototype.visitIn=function(e,r){if(!dt(r)||!this.equalsAll(e.args,r.args)||!this.equalAnnotations(e,r))return!1;var n=r,i=e.values;if(i){var a=n.values;if(!a||i.length!==a.length)return!1;for(var o=0,s=i.length;o<s;o++)if(!this.equalsAll(i[o],a[o]))return!1}else if(u.assert(function(){return!!e.table},"either values or table must be non-null for an In operator"),!n.table||!this.equals(e.table,n.table))return!1;return!0},t.prototype.visitEntity=function(e,r){return!(!mn(r)||!this.equalAnnotations(e,r))&&e.schema===r.schema&&e.entity===r.entity&&(this.ignoreVariables||this.optionalEqual(e.variable,r.variable))},t.prototype.visitSubqueryRef=function(e,r){return!(!ws(r)||!this.equalAnnotations(e,r)||!e.query&&r.query||e.query&&!r.query)&&(e.query&&r.query?e.variable===r.variable&&Ps(e.query,r.query):e.variable===r.variable)},t.prototype.visitNamedQueryRef=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),39===t.kind}(r)||!this.equalAnnotations(e,r))&&e.queryName===r.queryName&&(this.ignoreVariables||this.optionalEqual(e.variable,r.variable))},t.prototype.visitAnd=function(e,r){return!(!En(r)||!this.equalAnnotations(e,r))&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitOr=function(e,r){return!(!Wt(r)||!this.equalAnnotations(e,r))&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitCompare=function(e,r){return!(!Cn(r)||!this.equalAnnotations(e,r))&&e.comparison===r.comparison&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitConditional=function(e,r){var n=this;return!(!function(t){return u.assertValue(t,"expr"),42===t.kind}(r)||!this.equalAnnotations(e,r))&&xe(e.cases,r.cases,function(i,a){return n.visitCase(i,a)})&&this.equalsNullableObject(e.defaultValue,r.defaultValue,function(i,a){return n.equals(i,a)})},t.prototype.visitCase=t.prototype.visitContains=function(e,r){return!(!_f(r)||!this.equalAnnotations(e,r))&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitDateSpan=function(e,r){return!(!hr(r)||!this.equalAnnotations(e,r))&&e.unit===r.unit&&this.equals(e.arg,r.arg)},t.prototype.visitDateAdd=function(e,r){return!(!bn(r)||!this.equalAnnotations(e,r))&&e.unit===r.unit&&e.amount===r.amount&&this.equals(e.arg,r.arg)},t.prototype.visitExists=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),15===t.kind}(r)||!this.equalAnnotations(e,r))&&this.equals(e.arg,r.arg)},t.prototype.visitNot=function(e,r){return!(!vr(r)||!this.equalAnnotations(e,r))&&this.equals(e.arg,r.arg)},t.prototype.visitNow=function(e,r){return!!this.equalAnnotations(e,r)&&Ds(r)},t.prototype.visitDefaultValue=function(e,r){return!!this.equalAnnotations(e,r)&&Ff(r)},t.prototype.visitAnyValue=function(e,r){return!!this.equalAnnotations(e,r)&&As(r)},t.prototype.visitResourcePackageItem=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),25===t.kind}(r)||!this.equalAnnotations(e,r))&&e.packageName===r.packageName&&e.packageType===r.packageType&&e.itemName===r.itemName},t.prototype.visitStartsWith=function(e,r){return!(!Pf(r)||!this.equalAnnotations(e,r))&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitConstant=function(e,r){return!!(Re(r)&&e.type.equals(r.type)&&this.equalAnnotations(e,r))&&(e.type.text&&this.ignoreCase?e.valueEncoded,r.valueEncoded):e.valueEncoded===r.valueEncoded)},t.prototype.visitFillRule=function(e,r){var n=this;if(!function(t){return u.assertValue(t,"expr"),24===t.kind}(r)||!this.equals(e.input,r.input)||!this.equalAnnotations(e,r))return!1;var i=e.rule,a=r.rule;return i===a||this.equalsNullableObject(i.linearGradient2,a.linearGradient2,function(o,s){return n.visitLinearGradient2(o,s)})&&this.equalsNullableObject(i.linearGradient3,a.linearGradient3,function(o,s){return n.visitLinearGradient3(o,s)})},t.prototype.visitLinearGradient2=function(e,r){var n=this;return u.assertValue(e,"left"),u.assertValue(r,"right"),this.equalsFillRuleStop(e.min,r.min)&&this.equalsFillRuleStop(e.max,r.max)&&this.equalsNullableObject(e.nullColoringStrategy,r.nullColoringStrategy,function(i,a){return n.equalsNullStrategy(i,a)})},t.prototype.visitLinearGradient3=function(e,r){var n=this;return u.assertValue(e,"left"),u.assertValue(r,"right"),this.equalsFillRuleStop(e.min,r.min)&&this.equalsFillRuleStop(e.mid,r.mid)&&this.equalsFillRuleStop(e.max,r.max)&&this.equalsNullableObject(e.nullColoringStrategy,r.nullColoringStrategy,function(i,a){return n.equalsNullStrategy(i,a)})},t.prototype.visitThemeDataColor=function(e,r){return u.assertValue(e,"expr"),u.assertValue(r,"comparand"),function(t){return u.assertValue(t,"expr"),33===t.kind}(r)&&e.colorId===r.colorId&&e.percent===r.percent},t.prototype.equalsFillRuleStop=function(e,r){return u.assertValue(e,"stop1"),u.assertValue(r,"stop2"),this.equals(e.color,r.color)&&this.equalsNullable(e.value,r.value)},t.prototype.equalsNullStrategy=function(e,r){return u.assertValue(e,"equalsNullStrategy - left"),u.assertValue(r,"equalsNullStrategy - right"),this.equals(e.strategy,r.strategy)&&this.equalsNullable(e.color,r.color)},t.prototype.visitArithmetic=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),23===t.kind}(r)||!this.equalAnnotations(e,r))&&e.operator===r.operator&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitFloor=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),35===t.kind}(r)||!this.equalAnnotations(e,r))&&e.timeUnit===r.timeUnit&&e.size===r.size&&this.equals(e.arg,r.arg)},t.prototype.visitScopedEval=function(e,r){return!(!Ur(r)||!this.equalAnnotations(e,r))&&this.equals(e.expression,r.expression)&&this.equalsAll(e.scope,r.scope)},t.prototype.visitFilteredEval=function(e,r){return!(!ii(r)||!this.equalAnnotations(e,r))&&this.equals(e.expression,r.expression)&&e.filters.length===r.filters.length&&_.every(e.filters,},t.prototype.visitWithRef=function(e,r){return!(!Df(r)||!this.equalAnnotations(e,r))&&e.expressionName===r.expressionName},t.prototype.visitTransformTableRef=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),31===t.kind}(r)||!this.equalAnnotations(e,r))&&e.source===r.source},t.prototype.visitTransformOutputRoleRef=function(e,r){return!(!Af(r)||!this.equalAnnotations(e,r))&&e.role===r.role&&e.transform===r.transform},t.prototype.visitRoleRef=function(e,r){return!(!Tf(r)||!this.equalAnnotations(e,r))&&e.role===r.role},t.prototype.visitSummaryValueRef=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),45===t.kind}(r)||!this.equalAnnotations(e,r))&&e.name===r.name},t.prototype.visitAllRolesRef=function(e,r){return If(r)},t.prototype.visitDiscretize=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),38===t.kind}(r)||!this.equalAnnotations(e,r))&&e.count===r.count&&this.equals(e.source,r.source)},t.prototype.visitMember=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),40===t.kind}(r)||!this.equalAnnotations(e,r))&&e.member===r.member&&this.equals(e.source,r.source)},t.prototype.visitSparklineData=function(e,r){return!!Ts(r)&&this.equals(e.measure,r.measure)&&this.equalsAll(e.grouping,r.grouping)&&!!(!e.scalarKey&&!r.scalarKey||e.scalarKey&&r.scalarKey&&this.equals(e.scalarKey,r.scalarKey))&&e.pointsPerSparkline===r.pointsPerSparkline&&e.includeMinGroupingInterval===r.includeMinGroupingInterval},t.prototype.optionalEqual=t.prototype.equals=function(e,r){return e.accept(this,r)},t.prototype.equalsNullable=t.prototype.equalsNullableObject=t.prototype.equalsAll=function(e,r){var n=this;return xe(e,r,function(i,a){return n.equals(i,a)})},t.prototype.equalAnnotations=t.prototype.visitNativeVisualCalc=t.instances=[],t}();function si(t,e){return u.assertAnyValue(t,"leftFilter"),u.assertAnyValue(e,"rightFilter"),t||(t=null),e||(e=null),t===e||!(!!t!=!!e||!qf(t,e))&&H(t.condition,e.condition)}function qf(t,e){return u.assertValue(t,"leftFilter"),u.assertValue(e,"rightFilter"),xe(t.target,e.target,H)}function Uf(t,e){return u.assertAnyValue(t,"filters"),u.assertValue(e,"searchTarget"),!_.isEmpty(t)&&_.some(t,function(r){return si(r,e)})}nction Hf(t,e){return!t&&!e||!(!t||!e)&&xe(t.columns,e.columns,}function $E(t,e){return!t&&!e||!(!t||!e)&&t.algorithm===e.algorithm&&function(t,e){return!t&&!e||!(!t||!e)&&xe(t.parameters,e.parameters,function(r,n){return ga(r,n)})&&Hf(t.table,e.table)}(t.input,e.input)&&t.output,e.output)}function Ps(t,e){return u.assertValue(t,"x SemanticQuery"),u.assertValue(e,"y SemanticQuery"),t.from().equals(e.from())&&xe(t.where(),e.where(),si)&&xe(t.orderBy(),e.orderBy(),WE)&&xe(t.select(),e.select(),ga)&&xe(t.groupBy(),e.groupBy(),ga)&&xe(t.transforms(),e.transforms(),$E)&&t.top()===e.top()}var ya=function(){function t(){}return t.getLanguage=t.isChrome=t.isInternetExplorerOrEdge=t.isInternetExplorer11=t.isEdgeLegacy=t.isWindows10=t.isKeyboardClick=t.isCtrlOrMeta=t.noModifierPressed=t.isPointerTypeTouch=function(e){return"touch"===e.pointerType},t.getInternetExplorerVersion=t.isFirefox=function(){return this.navigator.userAgent.toLowerCase().indexOf("firefox")>-1},t.isMacOs=t.isSafari=t.isSafari11OrHigher=t.isIOSWebView=t.isAndroidWebView=t.focus=function(e,r){if(e)if(e.focus)r?e.focus(r):e.focus();else try{HTMLElement.prototype.focus.apply(e)}catch(n){u.assertFail("BrowserUtils.focus: failed to set focus on element: "+n)}},t.setBrowserSupportsHttp2=function(e){this.browserSupportsHttp2=e},t.calculateBrowserSupportsHttp2=t.navigator=window.navigator,t.browserSupportsHttp2=t}();ction Ls(t,e,r){return u.assertValue(t,"regex"),t.lastIndex=r||0,t.exec(e)}var k={}),Bs=function(){function t(){}return t.canFormat=function(e){return e instanceof Date},t.format=function(e,r,n){r=r||"G",Ns(e)&&(e=ke.fromTimeValue(e.epochTimeStamp));var o=1===r.length;try{return o?Yf(e,r,n):function(t,e,r){var n,i=[];if((e=ui(e,i)).indexOf("F")>-1){e=Gr(e,"FFFF","FFF");var a=t.getMilliseconds();if(a%10>=1&&(e=Gr(e,"FFF","fff")),e=Gr(e,"FFF","FF"),a%100/10>=1&&(e=Gr(e,"FF","ff")),e=Gr(e,"FF","F"),a%1e3/100>=1&&(e=Gr(e,"F","f")),""===(e=Gr(e,"F",""))||"%"===e)return""}var o=e);e=e);var s=r.calendar;return o&&(r.calendar=r.calendars.Japanese),n=Globalize.format(t,e,r),o&&(r.calendar=s),ma(n=Bs.localize(n,r.calendar),i,!1)}(e,r,n)}catch(s){return Yf(e,"G",n)}},t.localize=t}(),wn=function(){function t(){}return t.canFormat=t.format=function(e,r,n){r=r||"G";try{return ci(r)?function(t,e,r){var n,i=e.length>1?parseInt(e.substr(1,e.length-1),10):void 0,a=r.numberFormat,o=e.charAt(0);switch(o){case"e":case"E":void 0===i&&(i=6);var s=_.repeat("0",i);n=Us(t,e="0."+s+o+"+000",r);break;case"f":case"F":n=t.toFixed(void 0!==i?i:a.decimals),n=wn.localize(n,a);break;case"g":case"G":var l=Math.abs(t);if(0===l||1e-4<=l&&l<1e15)n=void 0!==i?t.toPrecision(i):t.toString();else{if(u.assert(function(){return"number"==typeof t},"value must be a number"),"number"!=typeof t)return String(t);n=(n=void 0!==i?t.toExponential(i):t.toExponential()).replace("e","E")}n=wn.localize(n,a);break;case"r":case"R":n=t.toString(),n=wn.localize(n,a);break;case"x":case"X":if(n=t.toString(16),"X"===o&&(n=n.toUpperCase()),void 0!==i){var c=n.length,f=t<0;f&&c--;var d=i-c,p=void 0;d>0&&(p=_.repeat("0",d)),n=f?"-"+p+n.substr(1):p+n}n=wn.localize(n,a);break;default:n=Globalize.format(t,e,r)}return n}(e,r,n):Us(e,r,n)}catch(i){return Globalize.format(e,void 0,n)}},t.localize=t}(),ke=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.setInternalDate=function(r){this.date=r},e.fromTimeValue=function(r){var n=new e(r);return"function"!=typeof n.setInternalDate&&nt.information("epochTimeStamp is '".concat(r,"' of type '").concat(typeof r,"'")),n.setInternalDate(new Date(r)),n},e.fromDateParts=e.fromString=function(r){u.assert("Only ISO 8601 is guaranteed to be parsed as UTC");var n=new Date(r),i=new e(n.getTime());return i.setInternalDate(n),i},e.fromDateWithEpochValue=function(r){return e.fromTimeValue(r.epochTimeStamp)},e.isDate=e.prototype.getDate=function(){return this.date.getUTCDate()},e.prototype.getDay=function(){return this.date.getUTCDay()},e.prototype.getFullYear=function(){return this.date.getUTCFullYear()},e.prototype.getHours=function(){return this.date.getUTCHours()},e.prototype.getMilliseconds=function(){return this.date.getUTCMilliseconds()},e.prototype.getMinutes=function(){return this.date.getUTCMinutes()},e.prototype.getMonth=function(){return this.date.getUTCMonth()},e.prototype.getSeconds=function(){return this.date.getUTCSeconds()},e.prototype.setDate=function(r){return this.date.setUTCDate.apply(this.date,arguments)},e.prototype.setFullYear=function(r,n,i){return this.date.setUTCFullYear.apply(this.date,arguments)},e.prototype.setHours=function(r,n,i,a){return this.date.setUTCHours.apply(this.date,arguments)},e.prototype.setMilliseconds=function(r){return this.date.setUTCMilliseconds.apply(this.date,arguments)},e.prototype.setMinutes=function(r,n,i){return this.date.setUTCMinutes.apply(this.date,arguments)},e.prototype.setMonth=function(r,n){return this.date.setUTCMonth.apply(this.date,arguments)},e.prototype.setSeconds=function(r,n){return this.date.setUTCSeconds.apply(this.date,arguments)},e.prototype.toString=e.prototype.getTime=function(){return this.date.getTime()},e.prototype.getTimezoneOffset=function(){return this.date.getTimezoneOffset()},e.prototype.getUTCDate=function(){return this.date.getUTCDate()},e.prototype.getUTCDay=function(){return this.date.getUTCDay()},e.prototype.getUTCFullYear=function(){return this.date.getUTCFullYear()},e.prototype.getUTCHours=function(){return this.date.getUTCHours()},e.prototype.getUTCMilliseconds=function(){return this.date.getUTCMilliseconds()},e.prototype.getUTCMinutes=function(){return this.date.getUTCMinutes()},e.prototype.getUTCMonth=function(){return this.date.getUTCMonth()},e.prototype.getUTCSeconds=function(){return this.date.getUTCSeconds()},e.prototype.setUTCDate=function(r){return this.date.setUTCDate.apply(this.date,arguments)},e.prototype.setUTCFullYear=function(r,n,i){return this.date.setUTCFullYear.apply(this.date,arguments)},e.prototype.setUTCHours=e.prototype.setUTCMilliseconds=e.prototype.setUTCMinutes=e.prototype.setUTCMonth=function(r,n){return this.date.setUTCMonth.apply(this.date,arguments)},e.prototype.setUTCSeconds=e.prototype.toDateString=function(){return this.date.toDateString()},e.prototype.toISOString=function(){return this.date.toISOString()},e.prototype.toJSON=function(){return this.date.toJSON()},e.prototype.toLocaleDateString=function(){return this.date.toLocaleDateString()},e.prototype.toLocaleString=function(){return this.date.toLocaleString()},e.prototype.toLocaleTimeString=function(){return this.date.toLocaleTimeString()},e.prototype.toTimeString=function(){return this.date.toTimeString()},e.prototype.toUTCString=function(){return this.date.toUTCString()},e.prototype.valueOf=function(){return this.date.valueOf()},e}(Date),Qr=new RegExp(["'[^']*'",'"[^"]*"',"\\\\.","'[^']*$",'"[^"]*$',"\\\\$"].join("|"),"g"); Kf,Jf,iC=/({{)|(}})|{(\d+[^}]*)}/g,gr="#",Wf=new RegExp(["0",gr].join("|"),"g"),sC=function(){function t(){}return t.prototype.formatValue=t.prototype.format=t.prototype.isStandardNumberFormat=function(e){return ci(e)},t.prototype.formatNumberWithCustomOverride=function(e,r,n,i){return function(t,e,r,n){return u.assertValue(t,"value"),u.assert(function(){return"number"==typeof t},"value must be a number"),u.assertValue(e,"format"),u.assertValue(r,"nonScientificOverrideFormat"),u.assertValue(n,"culture"),u.assert(function(){return!ci(e)},"Standard format"),Us(t,e,n,r)}(e,r,n,this.getCulture(i))},t.prototype.dateFormatString=t.prototype.setCurrentCulture=t.prototype.normalizeCultureSelector=t.prototype.getCulture=t.prototype.parseFloat=t.prototype.parseDate=function(e){var r=Globalize.parseDate(e,null,this.getCulture());return r&&ks(r)},t.prototype.getCurrentCulture=t.prototype.initialize=t.prototype.getCurrentLocale=function(){var e=ya.getLanguage()||Globalize.culture().name,r=Rf().cultureInfo;return e=Rf().formattingLocale||r||e,this.getUrlParam("formatLocale")||this.getUrlParam("language")||e},t.prototype.getUrlParam=t}();ar Ea,dC=/^\{.+\}.*/,pC=/\{.+\}/,hC=/e[+-]*[0#]+/i,vC=/^[a-z]\d{0,2}$/i,gC=/0+$/,yC=/([,]*)\.([0#]*)/g,mC=/[0#,\.]+[0,#]*/g,SC=/([0#])(?=[^0#]*$)/;unction Sa(t){var e=Ls(mC,t);return e?e[0]:t}function qs(t,e,r){if(null==e)return t;if(null==t&&(t="0"),Zf(t)){for(var n=li(t),s=[n.positive,n.negative,n.zero],l=0;l<s.length;l++)s[l]=Xf(s[l],e,r);return s.join(";")}return Xf(t,e,r)}function Xf(t,e,r){if((e=Math.abs(e))>=0){var n=[];t=ui(t,n);var a=_.repeat(r?"0":gr,Math.abs(e)),o=Ls(yC,t);if(o){var s=t.substr(0,o.index+o[1].length),l=t.substr(o.index+o[1].length+1,o[2].length),c=o[1],f=t.substr(o.index+o[0].length);if(r)l=a;else{var d=a.length-l.length;d>0?l+=a.slice(-d):d<0&&(l=l.slice(0,d))}l.length>0?l="."+l:c.length>0&&(l="."),t=s+l+f}else a.length>0&&(t=t.replace(SC,"$1."+a));0!==n.length&&(t=ma(t,n))}return t}nction ci(t){return u.assertValue(t,"format"),vC.test(t)}function Us(t,e,r,n){var i,a=r.numberFormat;if(!isFinite(t))return Globalize.format(t,void 0);var o=li(e);e=t>0?o.positive:0===t?o.zero:o.negative,o.hasNegative&&(t=Math.abs(t));var s=fi(e,!0),l=[];if(s.hasLiterals&&(e=ui(e,l)),s.hasE&&!n){var c=Ls(hC,e);if(c){var f=e.substr(0,c.index),d=e.substr(c.index+2),p=Gs(f,s);if(1!==(h=Qs(f,s))&&(t*=h),u.assert(function(){return"number"==typeof t},"value must be a number"),"number"!=typeof t)return String(t);var v=t.toExponential(p),g=v.indexOf("e"),y=v.substr(0,g),m=v.substr(g+1),S=js(y,f,a),E=js(m,d,a);"+"===E.charAt(0)&&"+"!==c[0].charAt(1)&&(E=E.substr(1)),i=S+c[0].charAt(0)+E}}if(void 0===i){var h,b=void 0,V=!1;if(p=Gs(e,s),1!==(h=Qs(e,s))&&(t*=h),t=parseFloat(Hs(t,p)),!isFinite(t))return Globalize.format(t,void 0);n?(n=n,$f(t,e)),b=qe.format(n,[t],r.name),V=!0):(b=Hs(t,p),b=t,b,p,e,s))),i=js(b,e,a,n,V)}return s.hasLiterals&&(i=ma(i,l,!1)),Ea=s,i}function Hs(t,e){var r="",n=0;e>16&&(n=e-16,e=16);var i=pr(Math.abs(t))+1;if(i<16){if(i>0){var a=16-i;e>a&&(n+=e-a,e=a)}r=t,e)}else if(16===i)r=t.toFixed(0),(n+=e)>0&&(r+=".");else{if(u.assert(function(){return"number"==typeof t},"value must be a number"),"number"!=typeof t)return String(t);var o=(r=t.toExponential(15)).indexOf("e");if(o>0){var s=r.indexOf("."),l=r.substr(0,o),c=r.substr(o+1),f=parseInt(c,10)-(l.length-s-1);r=l.replace(".","")+_.repeat("0",f),e>0&&(r=r+"."+_.repeat("0",e))}}return n>0&&(r+=_.repeat("0",n)),r}ion js(t,e,r,n,i){var a=!!n,o=e.split(".",2);if(2===o.length){var s=o[0],l=o[1],c="";n&&(u.assert(function(){return dC.test(n)},"Number should always precede the display unit"),c=n.replace(pC,""),t=t.replace(c,""));var f=r["."],p=t.split(i?f:".",2),h=1===p.length?p[0]+c:p[0],v=2===p.length?p[1]+c:"";v=v.replace(gC,"");var g=rd(h,s,r,a),y=function(t,e,r){var n=0,i=e.length,a=t.length;if(r){u.assert(function(){return i>0},"Empty formatting string");var o=e.charAt(i-1);return o.match(Wf)?{value:t,fmtOnly:""===t}:{value:t+o,fmtOnly:""===t}}for(var s="",l=!0,c=0;c<i;c++){var f=e.charAt(c);if(n<a)switch(f){case"0":case gr:s+=t[n++],l=!1;break;default:s+=f}else f!==gr&&(s+=f,l=l&&"0"!==f)}return{value:s,fmtOnly:l}}(v,l,a);return y.fmtOnly||""===y.value?g+y.value:g+f+y.value}return rd(t,e,r,a)}function rd(t,e,r,n){var i=e.indexOf(","),a=i>-1&&i<Math.max(e.lastIndexOf("0"),e.lastIndexOf("#"))&&r[","],o=0,s=0,l=r.groupSizes||[3],c=l[0],f=r[","],d="",p=t.charAt(0);("+"===p||"-"===p)&&(d=r[p],t=t.substr(1));for(var h="0"===t,v="",g="",y=t.length-1,m=!0,S=e.length-1;S>-1;S--){var E=e.charAt(S);switch(E){case"0":case gr:m=!1,""!==g&&(v=g+v,g=""),n||((y>-1||"0"===E)&&a&&(o===c?(v=f+v,++s<l.length&&(c=l[s]),o=1):o++),y>-1?(h&&E===gr||(v=t.charAt(y)+v),y--):E!==gr&&(v=E+v));break;case",":break;default:g=E+g}}if(!n){if(y>-1&&""!==v)if(a)for(;y>-1;)o===c?(v=f+v,++s<l.length&&(c=l[s]),o=1):o++,v=t.charAt(y)+v,y--;else v=t.substr(0,y+1)+v;return d+g+v}return m?d+g+v:d+g+t+v}var AC=function(){eturn t.prototype.getFormatString=function(e){switch(e){case k.Year:return this.YearPattern;case k.Month:return this.MonthPattern;case k.Week:case k.Day:return this.DayPattern;case k.Hour:return this.HourPattern;case k.Minute:return this.MinutePattern;case k.Second:return this.SecondPattern;case k.Millisecond:return this.MillisecondPattern}u.assertFail("Unexpected unit: "+e)},t}(),qe=new sC;function ee(t,e){return u.assert(function(){return!!e},"flag must be specified and nonzero."),(t&e)===e}ar Le,P,L=function(){function t(e,r,n,i,a,o){u.assert("type"),u.assert("category"),u.assert(function(){return 26214401!==e||!!n},"enumType"),u.assert("flagsEnumType"),this.underlyingType=e,this.category=r,ee(e,512)&&(this.temporalType=new IC(e)),ee(e,1024)&&(this.geographyType=new _C(e)),ee(e,2048)&&(this.miscType=new Ws(e,o)),ee(e,4096)&&(this.formattingType=new Ks(e)),ee(e,26214401)&&(this.enumType=n),ee(e,26280196)&&(this.flagsEnumType=i),ee(e,8192)&&(this.scriptingType=new TC(e)),ee(e,16384)&&(this.referenceType=new FC(e)),ee(e,13)&&(this.variationTypes=a)}return t.isValueTypeDescriptor=t.fromDescriptor=t.fromExtendedType=function(e){var r=Ys(e=e||0),n=function(t){if(t))return null;var e=Ca[t];if(!e)return null;var r=e.lastIndexOf("_");if(r>0){var n=e.slice(0,r);n in Js&&(u.assert("Unexpected value for ExtendedType base member of "+t),e=n)}return e}(e);return u.assert("Cannot create ValueType for abstract extended type. Consider using fromDescriptor instead."),t.fromPrimitiveTypeAndCategory(r,n)},t.fromPrimitiveTypeAndCategory=function(e,r){r=r||null;var n=(e=e||0).toString();return r&&(n+="|"+r),t.typeCache[n]||(t.typeCache[n]=new t(function(t,e){var r=PC[t],n=Js[r];if(null==n&&(u.assertFail("Unexpected primitiveType "+t),n=0),t&&e){var i=Js[e];if(i){var a=Ys(i);0===a?Ca[i|=n]&&(u.assert("Unexpected name for ExtendedType member "+i),n=i):a===t&&(n=i)}}return n}(e,r),r))},t.fromEnum=function(e){return u.assertValue(e,"enumType"),new t(26214401,null,e)},t.fromFlagsEnum=function(e){return u.assertValue(e,"enumType"),new t(26280196,null,null,e)},t.fromVariant=function(e){return u.assertValue(e,"variantTypes"),new t(13,null,null,null,e)},t.fromSparklineType=t.isCompatibleFromAny=function(e,r,n){u.assertValue(e,"type"),u.assertValue(r,"otherType");var i=t.fromDescriptor(e);return!!t.isCompatibleTo(i,[r],n)||i&&i.isCompatibleFrom(t.fromDescriptor(r),n)},t.isCompatibleTo=function(e,r,n){u.assertValue(e,"type"),u.assertValue(r,"otherTypes");for(var i=t.fromDescriptor(e),a=0,o=r;a<o.length;a++)if(t.fromDescriptor(o[a]).isCompatibleFrom(i,n))return!0;return!1},t.prototype.isCompatibleFrom=function(e,r){if(u.assertValue(e,"other"),this===e)return!0;if(e.variant)for(var n=0,i=e.variant;n<i.length;n++)if(!this.isCompatibleFrom(i[n],r))return!1;if(this.variant)for(var o=0,s=this.variant;o<s.length;o++)if(s[o].isCompatibleFrom(e,r))return!0;var c=e.primitiveType;return this.primitiveType===c||0===c||this.numeric&&e.numeric&&(!r||!this.integer||e.integer)},t.prototype.equals=Object.defineProperty(t.prototype,"primitiveType",{get:enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"extendedType",{get:function(){return this.underlyingType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"categoryString",{get:function(){return this.category},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return 1===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numeric",{get:function(){return ee(this.underlyingType,256)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"integer",{get:function(){return 4===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bool",{get:function(){return 5===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dateTime",{get:enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return 10===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"binary",{get:function(){return 11===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"json",{get:function(){return 14===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return 12===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"temporal",{get:function(){return this.temporalType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"geography",{get:function(){return this.geographyType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"misc",{get:function(){return this.miscType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formatting",{get:function(){return this.formattingType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enum",{get:function(){return this.enumType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flagsEnum",{get:function(){return this.flagsEnumType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scripting",{get:function(){return this.scriptingType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reference",{get:function(){return this.referenceType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"variant",{get:function(){return this.variationTypes},enumerable:!1,configurable:!0}),t.typeCache={},t}();Qt(L.prototype);var TC=function(){function t(e){u.assert(function(){return!!e&&ee(e,8192)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"source",{get:function(){return re(this.underlyingType,32776193)},enumerable:!1,configurable:!0}),t}(),IC=function(){function t(e){u.assert(function(){return!!e&&ee(e,512)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"year",{get:function(){return re(this.underlyingType,66048)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"quarter",{get:function(){return re(this.underlyingType,262656)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"month",{get:function(){return re(this.underlyingType,131584)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"day",{get:function(){return re(this.underlyingType,328192)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paddedDateTableDate",{get:function(){return re(this.underlyingType,197127)},enumerable:!1,configurable:!0}),t}(),_C=function(){function t(e){u.assert(function(){return!!e&&ee(e,1024)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"address",{get:function(){return re(this.underlyingType,6554625)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"city",{get:function(){return re(this.underlyingType,6620161)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"continent",{get:function(){return re(this.underlyingType,6685697)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"country",{get:function(){return re(this.underlyingType,6751233)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"county",{get:function(){return re(this.underlyingType,6816769)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"region",{get:function(){return re(this.underlyingType,6882305)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"postalCode",{get:function(){return re(this.underlyingType,6947840)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateOrProvince",{get:function(){return re(this.underlyingType,7013377)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"place",{get:function(){return re(this.underlyingType,7078913)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"latitude",{get:function(){return re(this.underlyingType,7144448)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return re(this.underlyingType,7209984)},enumerable:!1,configurable:!0}),t}(),Ws=function(){function t(e,r){u.assert(function(){return!!e&&ee(e,2048)},"type"),this.underlyingType=e,this.sparklineType=r}return Object.defineProperty(t.prototype,"image",{get:function(){return re(this.underlyingType,13109259)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageUrl",{get:function(){return re(this.underlyingType,13174785)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"webUrl",{get:function(){return re(this.underlyingType,13240321)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barcode",{get:function(){return re(this.underlyingType,13305856)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sparkline",{get:enumerable:!1,configurable:!0}),t}();Object.getOwnPropertyNames(Ws.prototype).forEach(function(t){"constructor"!==t&&Object.defineProperty(Ws.prototype,t,{enumerable:!0})});var FC=function(){function t(e){u.assert(function(){return!!e&&ee(e,16384)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"bookmark",{get:function(){return re(this.underlyingType,39337985)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bookmarkGroup",{get:function(){return re(this.underlyingType,39534593)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"section",{get:function(){return re(this.underlyingType,39403521)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"perspective",{get:function(){return re(this.underlyingType,39469057)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowRefText",{get:function(){return re(this.underlyingType,39600129)},enumerable:!1,configurable:!0}),t}(),Ks=function(){function t(e){u.assert(function(){return!!e&&ee(e,4096)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"color",{get:function(){return re(this.underlyingType,19664897)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formatString",{get:function(){return re(this.underlyingType,19730433)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alignment",{get:function(){return re(this.underlyingType,20058113)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"labelDisplayUnits",{get:function(){return re(this.underlyingType,20123649)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayUnitsWithoutAuto",{get:function(){return re(this.underlyingType,20516865)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return re(this.underlyingType,20385793)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return re(this.underlyingType,20189443)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"altText",{get:function(){return re(this.underlyingType,20451329)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stylePreset",{get:enumerable:!1,configurable:!0}),t}();Object.getOwnPropertyNames(Ks.prototype).forEach(;var PC=((Le={})[0]="Null",Le[1]="Text",Le[2]="Decimal",Le[3]="Double",Le[4]="Integer",Le[5]="Boolean",Le[6]="Date",Le[7]="DateTime",Le[8]="DateTimeZone",Le[9]="Time",Le[10]="Duration",Le[11]="Binary",Le[12]="None",Le[13]="Variant",Le[14]="Json",Le),Ca=((P={})[256]="Numeric",P[512]="Temporal",P[1024]="Geography",P[2048]="Miscellaneous",P[4096]="Formatting",P[8192]="Scripting",P[0]="Null",P[1]="Text",P[258]="Decimal",P[259]="Double",P[260]="Integer",P[5]="Boolean",P[518]="Date",P[519]="DateTime",P[520]="DateTimeZone",P[521]="Time",P[10]="Duration",P[11]="Binary",P[12]="None",P[13]="Variant",P[66048]="Years",P[66049]="Years_Text",P[66308]="Years_Integer",P[66054]="Years_Date",P[66055]="Years_DateTime",P[131584]="Months",P[131585]="Months_Text",P[131844]="Months_Integer",P[131590]="Months_Date",P[131591]="Months_DateTime",P[197127]="PaddedDateTableDates",P[262656]="Quarters",P[262657]="Quarters_Text",P[262916]="Quarters_Integer",P[262662]="Quarters_Date",P[262663]="Quarters_DateTime",P[328192]="DayOfMonth",P[328193]="DayOfMonth_Text",P[328452]="DayOfMonth_Integer",P[328198]="DayOfMonth_Date",P[328199]="DayOfMonth_DateTime",P[6554625]="Address",P[6620161]="City",P[6685697]="Continent",P[6751233]="Country",P[6816769]="County",P[6882305]="Region",P[6947840]="PostalCode",P[6947841]="PostalCode_Text",P[6948100]="PostalCode_Integer",P[7013377]="StateOrProvince",P[7078913]="Place",P[7144448]="Latitude",P[7144706]="Latitude_Decimal",P[7144707]="Latitude_Double",P[7209984]="Longitude",P[7210242]="Longitude_Decimal",P[7210243]="Longitude_Double",P[13109259]="Image",P[13174785]="ImageUrl",P[13240321]="WebUrl",P[13305856]="Barcode",P[13305857]="Barcode_Text",P[13306116]="Barcode_Integer",P[19664897]="Color",P[19730433]="FormatString",P[20058113]="Alignment",P[20123649]="LabelDisplayUnits",P[20516865]="DisplayUnitsWithoutAuto",P[20385793]="FontFamily",P[20451329]="AltText",P[20189443]="FontSize",P[26214401]="Enumeration",P[26280196]="FlagsEnumeration",P[32776193]="ScriptSource",P[65541]="SearchEnabled",P[39337985]="BookmarkRef",P[39534593]="BookmarkGroupRef",P[39403521]="SectionRef",P[20582401]="StylePreset",P[39469057]="PerspectiveRef",P[16384]="Reference",P[14]="Json",P[13371406]="Sparkline",P[39600129]="RowRefText",P),Js={Numeric:256,Temporal:512,Geography:1024,Miscellaneous:2048,Formatting:4096,Scripting:8192,Null:0,Text:1,Decimal:258,Double:259,Integer:260,Boolean:5,Date:518,DateTime:519,DateTimeZone:520,Time:521,Duration:10,Binary:11,None:12,Variant:13,Years:66048,Years_Text:66049,Years_Integer:66308,Years_Date:66054,Years_DateTime:66055,Months:131584,Months_Text:131585,Months_Integer:131844,Months_Date:131590,Months_DateTime:131591,PaddedDateTableDates:197127,Quarters:262656,Quarters_Text:262657,Quarters_Integer:262916,Quarters_Date:262662,Quarters_DateTime:262663,DayOfMonth:328192,DayOfMonth_Text:328193,DayOfMonth_Integer:328452,DayOfMonth_Date:328198,DayOfMonth_DateTime:328199,Address:6554625,City:6620161,Continent:6685697,Country:6751233,County:6816769,Region:6882305,PostalCode:6947840,PostalCode_Text:6947841,PostalCode_Integer:6948100,StateOrProvince:7013377,Place:7078913,Latitude:7144448,Latitude_Decimal:7144706,Latitude_Double:7144707,Longitude:7209984,Longitude_Decimal:7210242,Longitude_Double:7210243,Image:13109259,ImageUrl:13174785,WebUrl:13240321,Barcode:13305856,Barcode_Text:13305857,Barcode_Integer:13306116,Color:19664897,FormatString:19730433,Alignment:20058113,LabelDisplayUnits:20123649,DisplayUnitsWithoutAuto:20516865,FontFamily:20385793,AltText:20451329,FontSize:20189443,Enumeration:26214401,FlagsEnumeration:26280196,ScriptSource:32776193,SearchEnabled:65541,BookmarkRef:39337985,BookmarkGroupRef:39534593,SectionRef:39403521,StylePreset:20582401,PerspectiveRef:39469057,Reference:16384,Json:14,Sparkline:13371406,RowRefText:39600129},ba=4294901760;nction ge(t){var e=Se(t,B0.instance);return u.assertValue(e,"Failed to convert FieldExprPattern into SQExpr"),e}var Y=function(t){return t[t.Last=0]="Last",t[t.Current=1]="Current",t[t.Next=2]="Next",t}({}),z={}),Wr=function(t){return t[t.Unsupported=0]="Unsupported",t[t.Time=1]="Time",t[t.Date=2]="Date",t}({});ar id=function(){function t(){}return t.convertRelativeDateUnitToRelativeFilterType=function(e){switch(e){case z.Second:case z.Minute:case z.Hour:return Wr.Time;case z.Day:case z.Week:case z.CalendarWeek:case z.Month:case z.CalendarMonth:case z.Year:case z.CalendarYear:return Wr.Date;default:return void u.assertNever(e)}},t.convertTimeUnitToRelativeFilterType=function(e){switch(e){case 5:return Wr.Unsupported;case 6:case 7:return Wr.Time;case 0:case 1:case 2:case 3:case 4:return Wr.Date;default:return void u.assertNever(e)}},t.getDateRange=function(e,r){switch(r.relativeUnit){case z.Minute:return this.getMinutesRange(e,r);case z.Hour:return this.getHoursRange(e,r);case z.Day:return this.getDaysRange(e,r);case z.Week:return this.getWeeksRange(e,r);case z.CalendarWeek:return this.getCalendarWeekRange(e,r);case z.Month:return this.getMonthRange(e,r);case z.CalendarMonth:return this.getCalendarMonthRange(e,r);case z.Year:return this.getYearRange(e,r);case z.CalendarYear:return this.getCalendarYearRange(e,r);default:return void u.assertFail("Unexpected RelativeDateUnit: "+r.relativeUnit)}},t.getMinutesRange=t.getHoursRange=t.getDaysRange=t.getWeeksRange=t.getCalendarWeekRange=t.getMonthRange=function(e,r){var n={min:null,max:null};switch(r.relativeQualifier){case Y.Last:n.max=r.includeToday?e:this.addDays(e,-1),n.min=this.addMonths(n.max,-r.duration);break;case Y.Current:n=this.getCalendarMonth(e);break;case Y.Next:n.min=r.includeToday?e:this.addDays(e,1),n.max=this.addMonths(n.min,r.duration)}return n},t.getCalendarMonthRange=t.getYearRange=t.getCalendarYearRange=t.getTimeRangeRestatement=t.getDetailedTimeRestatement=function(e){return Math.abs(e.max.valueOf()-e.min.valueOf())/864e5>1||e.max.getUTCDate()!==e.min.getUTCDate()?qe.format("{0} - {1}",[e.min,e.max]):qe.format("{0:T} - {1:T}",[e.min,e.max])},t.getSimplifiedTimeRestatement=function(e,r){switch(e.relativeQualifier){case Y.Current:switch(e.relativeUnit){case z.Minute:return r("RelativeTimeRestatement_this_Minute");case z.Hour:return r("RelativeTimeRestatement_this_Hour");default:u.assertFail("The following relative unit is not a relative time unit: ".concat(e.relativeUnit))}break;case Y.Last:switch(e.relativeUnit){case z.Minute:return 1===e.duration?r("RelativeTimeRestatement_last_Minute"):r("RelativeTimeRestatement_last_Minutes",e.duration);case z.Hour:return 1===e.duration?r("RelativeTimeRestatement_last_Hour"):r("RelativeTimeRestatement_last_Hours",e.duration);default:u.assertFail("The following relative unit is not a relative time unit: ".concat(e.relativeUnit))}break;case Y.Next:switch(e.relativeUnit){case z.Minute:return 1===e.duration?r("RelativeTimeRestatement_next_Minute"):r("RelativeTimeRestatement_next_Minutes",e.duration);case z.Hour:return 1===e.duration?r("RelativeTimeRestatement_next_Hour"):r("RelativeTimeRestatement_next_Hours",e.duration);default:u.assertFail("The following relative unit is not a relative time unit: ".concat(e.relativeUnit))}break;default:u.assertFail("The following is an Unsupported relativeQualifer: ".concat(e.relativeQualifier))}return""},t.getDateRangeRestatement=function(e){return qe.format("{0:d} - {1:d}",[e.min,e.max])},t.getRestatement=function(e,r,n,i){var a;if(xn(e.relativeUnit)?(u.assert(function(){return!!i},"For Relative time restatement, anchor time should be defined"),a=i||new Date):a=new Date,e.anchorDate&&e.relativeUnit)){var o=e.anchorDate;a=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds()))}var s=this.getDateRange(a,e);return s.min.epochTimeStamp=s.min.getTime(),s.max.epochTimeStamp=s.max.getTime(),xn(e.relativeUnit)?this.getTimeRangeRestatement(e,r,s,n):t.getDateRangeRestatement(s)},t.addMinutes=t.addHours=t.addDays=t.addMonths=t.addYears=t.getDurationMax=t.getCalendarWeek=t.getCalendarMonth=t.getCalendarYear=t}();function $s(t){return new OC(t)}var OC=function(){function t(e){u.assertValue(e,"allMembers"),this.allMembers=e}return t.prototype.members=t}(),Xs="asZero",ad="noColor",od="specificColor",qC=$s([{value:Xs,displayName:function(e){return e.get("ConditionalFormattingDialog_FormatNull_AsZero")}},{value:ad,displayName:function(e){return e.get("ConditionalFormattingDialog_FormatNull_NoFormat")}},{value:od,displayName:]);function sd(t,e){u.assertValue(t,"fillRule"),t.linearGradient2?function(t,e){u.assertValue(t,"gradient2"),di(t.min,e),di(t.max,e),ud(t.nullColoringStrategy,e)}(t.linearGradient2,e):t.linearGradient3?function(t,e){u.assertValue(t,"gradient3"),di(t.min,e),di(t.mid,e),di(t.max,e),ud(t.nullColoringStrategy,e)}(t.linearGradient3,e):u.assertFail("Unsupported FillRuleDefinition")}function di(t,e){u.assertValue(t,"stop"),e.visitExpr(t.color);var r=t.value;r&&e.visitExpr(r)}ar Va=function(){function t(e,r){this.exprVisitor=e,this.valueRefVisitor=r}return t.prototype.visitExpr=function(e){return u.assertValue(e,"expr"),u.assertValue(this.exprVisitor,"exprVisitor"),e.accept(this.exprVisitor)},t.prototype.visitValueRef=t}(),pi=),Ke=pi),Kt=function(){function t(){}return t.prototype.visitEntity=function(e){this.visitDefault(e)},t.prototype.visitSubqueryRef=function(e){this.visitDefault(e)},t.prototype.visitNamedQueryRef=function(e){this.visitDefault(e)},t.prototype.visitColumnRef=function(e){e.source.accept(this)},t.prototype.visitMeasureRef=function(e){e.source.accept(this)},t.prototype.visitAggr=function(e){e.arg.accept(this)},t.prototype.visitPercentile=function(e){e.arg.accept(this)},t.prototype.visitRangePercent=function(e){e.min.accept(this),e.max.accept(this)},t.prototype.visitGroupRef=function(e){e.source.accept(this);for(var r=0,n=e.groupedExprs;r<n.length;r++)n[r].accept(this)},t.prototype.visitHierarchy=function(e){e.arg.accept(this)},t.prototype.visitHierarchyLevel=function(e){e.arg.accept(this)},t.prototype.visitPropertyVariationSource=function(e){e.arg.accept(this)},t.prototype.visitSelectRef=function(e){this.visitDefault(e)},t.prototype.visitBetween=t.prototype.visitIn=t.prototype.visitAnd=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitOr=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitCompare=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitConditional=function(e){u.assertValue(e,"expr"),u.assertNonEmpty(e.cases,"expr.cases");for(var r=0,n=e.cases;r<n.length;r++){var i=n[r];i.condition.accept(this),i.value.accept(this)}e.defaultValue&&e.defaultValue.accept(this)},t.prototype.visitContains=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitExists=function(e){e.arg.accept(this)},t.prototype.visitNot=function(e){e.arg.accept(this)},t.prototype.visitStartsWith=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitConstant=function(e){this.visitDefault(e)},t.prototype.visitDateSpan=function(e){e.arg.accept(this)},t.prototype.visitDateAdd=function(e){e.arg.accept(this)},t.prototype.visitNow=function(e){this.visitDefault(e)},t.prototype.visitDefaultValue=function(e){this.visitDefault(e)},t.prototype.visitAnyValue=function(e){this.visitDefault(e)},t.prototype.visitArithmetic=t.prototype.visitFloor=function(e){e.arg.accept(this)},t.prototype.visitFillRule=function(e){e.input.accept(this),sd(e.rule,new Va(this,null))},t.prototype.visistExists=t.prototype.visitThemeDataColor=function(e){this.visitDefault(e)},t.prototype.visitResourcePackageItem=function(e){this.visitDefault(e)},t.prototype.visitScopedEval=t.prototype.visitFilteredEval=t.prototype.visitWithRef=function(e){this.visitDefault(e)},t.prototype.visitTransformTableRef=function(e){this.visitDefault(e)},t.prototype.visitTransformOutputRoleRef=function(e){this.visitDefault(e)},t.prototype.visitRoleRef=function(e){this.visitDefault(e)},t.prototype.visitSummaryValueRef=function(e){this.visitDefault(e)},t.prototype.visitAllRolesRef=function(e){this.visitDefault(e)},t.prototype.visitDiscretize=function(e){this.visitDefault(e)},t.prototype.visitMember=function(e){this.visitDefault(e)},t.prototype.visitNativeMeasure=function(e){this.visitDefault(e)},t.prototype.visitNativeColumn=t.prototype.visitSparklineData=t.prototype.visitNativeVisualCalc=t.prototype.visitDefault=function(e){},t}();function Zs(t){u.assertValue(t,"expr");var e=new ld;return t.accept(e),e.analyze().filterKind}var ld=function(t){eturn T(e,t),e.prototype.analyze=e.prototype.visitMeasureRef=function(r){this.filterKind=1,r.source.accept(this)},e.prototype.visitExists=function(r){this.filterKind=2,r.arg.accept(this)},e.prototype.visitAggr=e.prototype.visitSubqueryRef=e.prototype.visitEntity=e}(Kt),eu=function(){function t(){}return t.prototype.visitColumnRef=function(e){var r=e.source,n=r.accept(this);return r===n?e:new Sr(n,e.ref,void 0,e.getAnnotations())},t.prototype.visitMeasureRef=function(e){var r=e.source,n=r.accept(this);return r===n?e:new Kd(n,e.ref,e.getAnnotations())},t.prototype.visitNativeMeasure=function(e){var r=e.expressionContentCache&&e.expressionContentCache.dependencies,n=r&&this.rewriteAll(r);return r===n?e:new Jd(e.language,e.expression,e.dataType,e.proposedName,de(de({},e.expressionContentCache),{dependencies:n}),e.format,e.getAnnotations())},t.prototype.visitNativeColumn=function(e){var r=e.expressionContentCache&&e.expressionContentCache.dependencies,n=r&&this.rewriteAll(r),i=e.source.accept(this);if(r===n&&e.source===i)return e;var a=e.expressionContentCache?de(de({},e.expressionContentCache),{dependencies:n}):void 0;return new Yd(e.language,e.expression,e.dataType,i,e.proposedName,a,e.format,e.getAnnotations())},t.prototype.visitAggr=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new $r(n,e.func,e.includeAllTypes,e.getAnnotations())},t.prototype.visitSelectRef=function(e){return e},t.prototype.visitPercentile=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new $d(n,e.k,e.exclusive,e.getAnnotations())},t.prototype.visitRangePercent=function(e){var r=e.min,n=r.accept(this),i=e.max,a=i.accept(this);return r===n&&i===a?e:new Xd(n,a,e.percent,e.getAnnotations())},t.prototype.visitGroupRef=function(e){for(var r=e.source,n=e.source.accept(this),i=e.groupedExprs,a=new Array(i.length),o=0;o<i.length;o++)a[o]=i[o].accept(this);return r===n&&function(t,e){u.assertValue(t,"x"),u.assertValue(e,"y");var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(!H(t[n],e[n]))return!1;return!0}(i,a)?e:new ep(e.ref,n,a,e.getAnnotations())},t.prototype.visitHierarchy=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new tp(n,e.hierarchy,e.getAnnotations())},t.prototype.visitHierarchyLevel=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new rp(n,e.level,e.getAnnotations())},t.prototype.visitPropertyVariationSource=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new Zd(n,e.name,e.property,e.getAnnotations())},t.prototype.visitEntity=function(e){return e},t.prototype.visitSubqueryRef=function(e){return e},t.prototype.visitNamedQueryRef=function(e){return e},t.prototype.visitAnd=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new Dn(n,a,e.getAnnotations())},t.prototype.visitBetween=function(e){var r=e.arg,n=r.accept(this),i=e.lower,a=i.accept(this),o=e.upper,s=o.accept(this);return r===n&&i===a&&o===s?e:new np(n,a,s,e.getAnnotations())},t.prototype.visitIn=function(e){var a,r=e.args,n=this.rewriteAll(r),i=e.values,o=e.table,s=o;if(i){u.assert(function(){return!o},"values and table cannot be both specified for the In operator");for(var l=0,c=i.length;l<c;l++){var f=i[l],d=this.rewriteAll(f);f!==d&&!a&&(a=cr(i,l)),a&&a.push(d)}}return o&&(u.assert("values and table cannot be both specified for the In operator"),s=o.accept(this)),r!==n||a||o!==s?new Xr(n,a||i,s,e.getAnnotations()):e},t.prototype.rewriteAll=function(e){var r=this;return u.assertValue(e,"origExprs"),function(t,e){u.assertValue(t,"array");for(var r,n=0,i=t.length;n<i;n++){var a=t[n],o=e(a);a!==o&&!r&&(r=cr(t,n)),r&&r.push(o)}return r||t}(e,function(n){return n.accept(r)})},t.prototype.visitOr=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new Na(n,a,e.getAnnotations())},t.prototype.visitCompare=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new fu(e.comparison,n,a,e.getAnnotations())},t.prototype.visitConditional=function(e){u.assertNonEmpty(e.cases,"orig.cases");for(var a,r=e.defaultValue,n=r&&r.accept(this),i=e.cases,o=0,s=i.length;o<s;o++){var l=i[o],c=this.visitCase(l);l!==c&&!a&&(a=cr(i,o)),a&&a.push(c)}return a||(a=i),n===r&&a===i?e:new ip(a,n,e.getAnnotations())},t.prototype.visitCase=t.prototype.visitContains=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new ka(n,a,e.getAnnotations())},t.prototype.visitExists=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new op(n,e.getAnnotations())},t.prototype.visitNot=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new du(n,e.getAnnotations())},t.prototype.visitStartsWith=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new ap(n,a,e.getAnnotations())},t.prototype.visitConstant=function(e){return e},t.prototype.visitFloor=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new Qd(n,e.size,e.timeUnit,e.getAnnotations())},t.prototype.visitDateSpan=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new sp(e.unit,n,e.getAnnotations())},t.prototype.visitDateAdd=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new up(e.unit,e.amount,n,e.getAnnotations())},t.prototype.visitNow=function(e){return e},t.prototype.visitDefaultValue=function(e){return e},t.prototype.visitAnyValue=function(e){return e},t.prototype.visitArithmetic=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new Gd(n,a,e.operator,e.getAnnotations())},t.prototype.visitScopedEval=function(e){var r=e.expression,n=r.accept(this),i=e.scope,a=this.rewriteAll(i);return r===n&&i===a?e:new Ra(n,a,e.getAnnotations())},t.prototype.visitFilteredEval=function(e){for(var r=e.expression,n=r.accept(this),i=!1,a=[],o=0,s=e.filters;o<s.length;o++){var l=s[o],c=l.target,f=void 0;_.isEmpty(c)||(f=this.rewriteAll(c));var d=l.condition,p=l.condition.accept(this);(c!==f||d!==p)&&(i=!0),a.push({target:f,condition:p})}return r!==n||i?new jd(n,a,e.getAnnotations()):e},t.prototype.visitWithRef=function(e){return e},t.prototype.visitTransformTableRef=function(e){return e},t.prototype.visitTransformOutputRoleRef=function(e){return e},t.prototype.visitRoleRef=function(e){return e},t.prototype.visitSummaryValueRef=function(e){return e},t.prototype.visitAllRolesRef=function(e){return e},t.prototype.visitFillRule=function(e){var r=e.input,n=r.accept(this),i=e.rule,a=i.linearGradient2,o=a;a&&(o=this.visitLinearGradient2(a));var s=i.linearGradient3,l=s;if(s&&(l=this.visitLinearGradient3(s)),r!==n||a!==o||s!==l){var c={};return o&&(c.linearGradient2=o),l&&(c.linearGradient3=l),new lp(n,c,e.getAnnotations())}return e},t.prototype.visitLinearGradient2=function(e){u.assertValue(e,"origGradient");var r=e.min,n=this.visitFillRuleStop(r),i=e.max,a=this.visitFillRuleStop(i),o=e.nullColoringStrategy,s=this.visitFillNullStrategy(o);if(r!==n||i!==a||o!==s){var l={min:n,max:a};return s&&(l.nullColoringStrategy=s),l}return e},t.prototype.visitLinearGradient3=function(e){u.assertValue(e,"origGradient");var r=e.min,n=this.visitFillRuleStop(r),i=e.mid,a=this.visitFillRuleStop(i),o=e.max,s=this.visitFillRuleStop(o),l=e.nullColoringStrategy,c=this.visitFillNullStrategy(l);if(r!==n||i!==a||o!==s||l!==c){var f={min:n,mid:a,max:s};return c&&(f.nullColoringStrategy=c),f}return e},t.prototype.visitFillRuleStop=function(e){u.assertValue(e,"stop");var r=e.color,n=e.color.accept(this),i=e.value,a=i;if(i&&(a=i.accept(this)),r!==n||i!==a){var o={color:n};return a&&(o.value=a),o}return e},t.prototype.visitFillNullStrategy=t.prototype.visitThemeDataColor=function(e){return e},t.prototype.visitResourcePackageItem=function(e){return e},t.prototype.visitDiscretize=function(e){var r=e.source.accept(this);return r===e.source?e:new fp(r,e.count,e.getAnnotations())},t.prototype.visitMember=function(e){var r=e.source.accept(this);return r===e.source?e:new dp(r,e.member,e.getAnnotations())},t.prototype.visitSparklineData=function(e){var r,n=e.measure.accept(this),i=this.rewriteAll(e.grouping),a=null===(r=e.scalarKey)||void 0===r?void 0:r.accept(this),o=e.pointsPerSparkline,s=e.includeMinGroupingInterval;return n===e.measure&&i===e.grouping&&e.scalarKey===a&&e.pointsPerSparkline===o&&e.includeMinGroupingInterval===s?e:new pp(n,i,a,o,s)},t.prototype.visitNativeVisualCalc=function(e){return e},t}();function Kr(t){return u.assertValue(t,"source"),null!=t.subquery}var hi=function(){function t(e,r){this.schema=e,this.entity=r}return t.prototype.accept=function(e,r){return e.visitEntity(this,r)},t.prototype.equals=function(e){return e&&this.entity===e.entity&&this.schema===e.schema},t}(),cd=),yr=function(){function t(e){this.subquery=e}return t.prototype.accept=function(e,r){return e.visitSubquery(this,r)},t.prototype.equals=function(e){return e&&Ps(this.subquery,e.subquery)},t}(),tu=function(){eturn t.prototype.accept=function(e,r){return e.visitExpr(this,r)},t.prototype.equals=function(e){return e&&H(this.expr,e.expr)},t}(),Jr=function(){eturn t.prototype.keys=function(){return Object.keys(this.items)},t.prototype.source=function(e){return this.items[e]},t.prototype.sources=function(){return this.items},t.prototype.usedSourceNames=function(){return this.usedNames},t.prototype.ensureSource=function(e,r){u.assertValue(e,"source");var n=this.getSourceKeyFromItems(e);return n?{name:n}:{name:this.addSource(e,r),new:!0}},t.prototype.remove=t.prototype.getSourceKeyFromItems=t.prototype.addSource=function(e,r){var i=r||e.accept(new QC,null);return i=va(this.usedNames,i),this.items[i]=e,this.usedNames[i]=!0,i},t.prototype.clone=t.prototype.equals=function(e){var r=this;if(!e)return!1;var n=this.keys(),i=e.keys();return n.length===i.length&&xe(n,i,},t.prototype.renameSources=function(e){for(var n,r=this.items,i=Object.keys(r),a=0,o=i.length;a<o;a++){var s=i[a],l=s;if(e[s]&&(l=va(e,s),!n)){n={};for(var c=0;c<a;c++){var f=i[c];n[f]=r[f]}}e[l]=!0,n&&(n[l]=r[s])}return n?new t(n):this},t}();function fd(t,e){if(t===e)return!0;if(t&&e){if(wa(t)&&wa(e)||ru(t)&&ru(e))return t.equals(e);if(Kr(t)&&Kr(e))return t.equals(e);if(xa(t)&&xa(e))return t.equals(e)}return!1}function wa(t){return u.assertValue(t,"source"),null!=t.entity}function ru(t){return u.assertValue(t,"source"),null!=t.pod}function xa(t){return u.assertValue(t,"source"),null!=t.expr}var QC=function(){function t(){}return t.prototype.visitEntity=function(e){return this.getShortName(e.entity)},t.prototype.visitPod=function(e){return this.getShortName(e.pod)},t.prototype.visitSubquery=function(e){return"q"},t.prototype.visitExpr=function(e){return"x"},t.prototype.getShortName=function(e){var r=e,n=r.lastIndexOf(".");return n>=0&&n!==r.length-1&&(r=r.substr(n+1)),r.charCodeAt(0))?r.charAt(0).toLowerCase():"a"},t}(),jC=function(){function t(){this.entities=[]}return t.prototype.visitEntity=function(e,r){this.entities.push(new Pa(e.schema,e.entity,r))},t.prototype.visitPod=function(e,r){},t.prototype.visitSubquery=function(e,r){},t.prototype.visitExpr=function(e,r){},t}(),WC=function(){function t(e){this.exprRewriter=e}return t.prototype.visitEntity=function(e,r){var i=Ge(e.schema,e.entity,r).accept(this.exprRewriter);return new hi(i.schema,i.entity)},t.prototype.visitPod=function(e,r){var i=Ge(e.schema,e.pod,r).accept(this.exprRewriter);return new cd(i.schema,i.entity)},t.prototype.visitSubquery=function(e,r){var i=e.subquery.rewrite(this.exprRewriter);return new yr(i)},t.prototype.visitExpr=t}();function dd(t,e){u.assertValue(t,"items"),u.assertValue(e,"searchElement");for(var r=0,n=t.length;r<n;r++){var i=t[r];if(i&&H(i.expr,e))return r}return-1} $C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitEntity=function(r){return r.entity},e.prototype.visitNamedQueryRef=function(r){return"QueryRef(".concat(r.queryName,")")},e.prototype.visitColumnRef=function(r){return r.source.accept(this)+"."+r.ref},e.prototype.visitGroupRef=function(r){return r.source.accept(this)+"."+r.ref},e.prototype.visitMeasureRef=function(r){return r.source.accept(this)+"."+r.ref},e.prototype.visitNativeMeasure=function(r){return"NativeMeasure(".concat(r.proposedName,")")},e.prototype.visitNativeColumn=e.prototype.visitHierarchy=function(r){return r.arg.accept(this)+"."+r.hierarchy},e.prototype.visitHierarchyLevel=e.prototype.visitPropertyVariationSource=e.prototype.visitAggr=function(r){return function(t){switch(t){case 0:return"Sum";case 1:return"Avg";case 2:return"Count";case 3:return"Min";case 4:return"Max";case 5:return"CountNonNull";case 6:return"Median";case 7:return"StandardDeviation";case 8:return"Variance";default:u.assert(function(){return null==t},"Unrecognized aggregate function.")}}(r.func)+"("+r.arg.accept(this)+")"},e.prototype.visitPercentile=e.prototype.visitRangePercent=e.prototype.visitArithmetic=function(r){return function(t){switch(t){case 0:return"Add";case 1:return"Subtract";case 2:return"Multiply";case 3:return"Divide"}return Da("Unexpected ArithmeticOperatorKind: "+t)}(r.operator)+"("+r.left.accept(this)+", "+r.right.accept(this)+")"},e.prototype.visitConstant=function(r){return"const"},e.prototype.visitTransformOutputRoleRef=e.prototype.visitScopedEval=e.prototype.visitFilteredEval=e.prototype.visitRoleRef=function(r){return"Role."+r.role},e.prototype.visitSummaryRef=e.prototype.visitAllRolesRef=function(r){return"AllRoles"},e.prototype.visitDiscretize=function(r){return"Discretize(".concat(r.source.accept(this),", ").concat(r.count,")")},e.prototype.visitMember=e.prototype.visitCompare=e.prototype.visitSparklineData=e.prototype.visitDefault=e.instance=new e,e}(pi);function XC(t,e,r){u.assertValue(t,"namedItems");for(var n={},i=0,a=t.length;i<a;i++)n[t[i].name]=!0;return va(n,r||pd(e))}function Aa(t){return u.assertValue(t,"expr"),t.accept(ZC.instance)}var ZC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitMeasureRef=function(r){return!0},e.prototype.visitNativeMeasure=function(r){return!0},e.prototype.visitNativeVisualCalc=function(r){return!0},e.prototype.visitAggr=function(r){return!0},e.prototype.visitArithmetic=function(r){return!0},e.prototype.visitFilteredEval=function(r){return r.expression.accept(this)},e.prototype.visitSparklineData=function(r){return!0},e.prototype.visitDefault=function(r){return!1},e.instance=new e,e}(Ke),t0=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitCompare=function(r){return 0===r.comparison&&r.right.accept(this)},e.prototype.visitAnd=function(r){return r.left.accept(this)&&r.right.accept(this)},e.prototype.visitAnyValue=function(r){return!0},e.prototype.visitDefault=function(r){return!1},e.instance=new e,e}(Ke),n0=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitCompare=e.prototype.visitAnd=e.prototype.visitDefaultValue=function(r){return!0},e.prototype.visitDefault=function(r){return!1},e.instance=new e,e}(Ke);function vi(t,e){u.assert(function(){return t.length===e.length},"fileds and values need to be the same size");for(var r=[],n=0;n<t.length;n++)r.push(An(0,t[n],e[n]));if(!_.isEmpty(r)){for(var i,a=0,o=r;a<o.length;a++)i=it(i,o[a]);return i}}var Ta=function(){function t(e){this.exprRewriter=e}return t.rewriteFrom=function(e,r){for(var n,i=e,a=i.keys(),o=0,s=a.length;o<s;o++){var l=a[o],c=i.source(l),f=c.accept(r,l);(c!==f||n)&&(n||(n=_.pick(i.sources(),a.slice(0,o))),n[l]=f)}return n?new Jr(n):i},t.prototype.rewriteFrom=function(e){return t.rewriteFrom(e,new WC(this.exprRewriter))},t.prototype.rewriteSelect=function(e,r){return u.assertValue(e,"selectItems"),u.assertValue(r,"from"),this.rewriteNamedSQExpressions(e,r)},t.prototype.rewriteGroupBy=function(e,r){if(u.assertAnyValue(e,"groupByitems"),u.assertValue(r,"from"),!_.isEmpty(e))return this.rewriteNamedSQExpressions(e,r)},t.prototype.rewriteNamedSQExpressions=function(e,r){var n=this;return u.assertValue(e,"expressions"),_.map(e,},t.prototype.rewriteOrderBy=function(e,r){if(u.assertAnyValue(e,"orderByItems"),u.assertValue(r,"from"),!_.isEmpty(e)){for(var n=[],i=0,a=e.length;i<a;i++){var o=e[i],s=He.rewrite(o.expr.accept(this.exprRewriter),r,r);n.push({direction:o.direction,expr:s})}return n}},t.prototype.rewriteWhere=function(e,r){var n=this;if(u.assertAnyValue(e,"whereItems"),u.assertValue(r,"from"),!_.isEmpty(e)){for(var i=[],a=0,o=e.length;a<o;a++){var s=e[a],l={condition:He.rewrite(s.condition.accept(this.exprRewriter),r,r)};s.target&&(l.target=_.map(s.target,),s.annotations&&(l.annotations=s.annotations),i.push(l)}return i}},t.prototype.rewriteTransform=function(e,r){var n=this;if(u.assertAnyValue(e,"transformItems"),u.assertAnyValue(r,"from"),!_.isEmpty(e)){for(var i=[],a=0,o=e;a<o.length;a++){var s=o[a],l=void 0;s.input.table&&!_.isEmpty(s.input.table.columns)&&(l=_.map(s.input.table.columns,);var c={name:s.name,algorithm:s.algorithm,input:{parameters:s.input.parameters},output:s.output};s.input.table&&(c.input.table={name:s.input.table.name,columns:l}),i.push(c)}return i}},t}(),hd=function(){function t(e,r,n,i,a,o,s){u.assertValue(e,"from"),u.assertValue(i,"select"),this.fromValue=e,this.whereItems=r,this.orderByItems=n,this.selectItems=i,this.groupByItems=a,this.transformItems=o,null!=s&&(this.topValue=s)}return t.create=function(){return t.empty||(t.empty=new t(new Jr,null,null,[],null,null,null)),t.empty},t.createWith=function(e,r){return u.assertValue(e,"clauses"),r||(e=t.normalize(e)),new t(e.from,e.where,e.orderBy,e.select,e.groupBy,e.transforms,e.top)},t.prototype.createModified=t.normalize=t.removeUnreferencedKeys=t.renameSources=t.renameSourcesInSubqueries=t.renameSourcesInQuery=t.prototype.from=t.prototype.select=function(e){return _.isEmpty(arguments)?this.getSelect():this.setSelect(e)},t.prototype.getSelect=function(){return t.createNamedExpressionArray(this.selectItems)},t.createNamedExpressionArray=t.prototype.setSelect=function(e){var r=this.fromValue.clone(),n=t.rewriteExpressionsWithSourceRenames(e,r);return this.createModified({from:r,select:n})},t.rewriteExpressionsWithSourceRenames=t.prototype.removeSelect=function(e){u.assertValue(e,"expr");for(var r=this.selectItems,n=[],i=0,a=r.length;i<a;i++){var o=r[i];H(o.expr,e)||n.push(o)}return this.createModified({select:n})},t.prototype.removeOrderBy=function(e){for(var r=this.orderBy(),n=r.length-1;n>=0;n--)H(r[n].expr,e)&&r.splice(n,1);return this.createModified({orderBy:r})},t.prototype.removeTransform=t.prototype.selectNameOf=function(e){var r;return null===(r=this.getSelectFor(e))||void 0===r?void 0:r.name},t.prototype.selectNativeReferenceNameOf=t.prototype.getSelectFor=function(e){var r=dd(this.selectItems,e);if(r>=0)return this.selectItems[r]},t.prototype.setSelectAt=function(e,r,n){if(u.assertValue(r,"expr"),!(e>=this.selectItems.length)){var i=this.select(),a=this.fromValue.clone(),s=null!=n?n:i[e].nativeReferenceName;return i[e]={name:i[e].name,expr:He.rewrite(r,null,a),nativeReferenceName:s},this.createModified({from:a,select:i})}},t.prototype.addSelect=function(e,r,n){u.assertValue(e,"expr");var i=this.select(),a=this.fromValue.clone();return i.push(this.createNamedExpr(i,a,e,r,n)),this.createModified({from:a,select:i})},t.prototype.setNativeReferenceNameAt=function(e,r){var n=this;u.assert(function(){return 0<=e&&e<n.selectItems.length},"index should be within the length of the selectedItems"),this.selectItems[e].nativeReferenceName=r},t.prototype.getNativeReferenceNameAt=function(e){var r=this;return u.assert("index should be within the length of the selectedItems"),this.selectItems[e].nativeReferenceName},t.prototype.getNativeReferenceNames=function(e){var r=this.selectItems.map(function(n){return n.nativeReferenceName});return e?_.filter(r,function(n){return!Vn(n)}):r},t.prototype.createNamedExpr=t.prototype.groupBy=function(e){return _.isEmpty(arguments)?this.getGroupBy():this.setGroupBy(e)},t.prototype.getGroupBy=function(){return t.createNamedExpressionArray(this.groupByItems)},t.prototype.setGroupBy=t.prototype.addGroupBy=function(e){u.assertValue(e,"expr");var r=this.groupBy(),n=this.fromValue.clone();return r.push(this.createNamedExpr(r,n,e)),this.createModified({from:n,groupBy:r})},t.prototype.orderBy=function(e){return _.isEmpty(arguments)?this.getOrderBy():this.setOrderBy(e)},t.prototype.getOrderBy=t.prototype.setOrderBy=function(e){u.assertValue(e,"values");for(var r=[],n=this.fromValue.clone(),i=0,a=e.length;i<a;i++){var o=e[i];r.push({expr:He.rewrite(o.expr,n,n),direction:o.direction})}return this.createModified({from:n,orderBy:r})},t.prototype.where=t.prototype.getWhere=t.prototype.setWhere=function(e,r,n){u.assertValue(e,"existingFilters"),u.assertValue(r,"newFilters");for(var i=_.clone(e),a=this.fromValue.clone(),o=0,s=r;o<s.length;o++){var l=s[o],c={condition:He.rewrite(l.condition,n,a)};l.target&&(c.target=_.map(l.target,),l.annotations&&(c.annotations=l.annotations),i.push(c)}return this.createModified({from:a,where:i})},t.prototype.addWhere=t.prototype.addSemanticFilter=function(e){return u.assertValue(e,"filter"),this.setWhere(this.where(),e.where(),e.from())},t.prototype.transforms=t.prototype.getTransforms=t.prototype.setTransforms=function(e){for(var r=this,n=this.fromValue.clone(),i=[],a=0,o=e;a<o.length;a++){var s=o[a],l=void 0;s.input.table&&!_.isEmpty(s.input.table.columns)&&(l=_.map(s.input.table.columns,function(f){return{role:f.role,expression:r.createNamedExpr(ps([]),n,f.expression.expr,f.expression.name)}}));var c={name:s.name,algorithm:s.algorithm,input:{parameters:s.input.parameters},output:s.output};s.input.table&&(c.input.table={name:s.input.table.name,columns:l}),i.push(c)}return this.createModified({from:n,transforms:e})},t.prototype.top=t.prototype.setTop=function(e){return u.assert("if top is specified, it must be positive"),this.createModified({top:e})},t.prototype.rewrite=t.prototype.hasVisualCalculations=function(){for(var e=0,r=this.selectItems;e<r.length;e++)if(ai(r[e].expr))return!0;return!1},t.prototype.getClauses=t.rewriteClauses=t.willFiltersAffectQuery=function(e){return u.assertValue(e,"query"),new i0(e).willFilterAffectQuery()},t}(),Ue=function(){function t(e,r){u.assertValue(e,"from"),u.assertValue(r,"where"),this.fromValue=e,this.whereItems=r}return t.fromSQExpr=t.fromSQFromAndSQExpr=function(e,r){return u.assertValue(e,"from"),u.assertValue(r,"condition"),new t(e,[{condition:He.rewrite(r,e,e)}])},t.fromSQFromAndSQFilters=function(e,r){return new t(e,r)},t.clone=t.fromMeasureFilters=function(e,r,n){u.assertValue(e,"query"),u.assert(function(){return!_.isEmpty(r)},"measureFilters not empty"),u.assert(function(){return _.every(r,},"Require measure filter");for(var i,a=[],o=e.where(),s=function(m){var S=_.find(o,function(E){return H(E.condition,m.condition)});if(!S||!S.target)return{value:void 0};i=i||S.target,u.assert(function(){return function(){for(var E=0;E<i.length;E++)if(!H(i[E],S.target[E]))return!1;return!0}()},"Expected targets to be the same."),a.push(S)},l=0,c=r;l<c.length;l++){var d=s(c[l]);if("object"==typeof d)return d.value}var p=_.filter(o,,h=_.map(i,function(y){return _.find(e.select(),});n&&h.push.apply(h,this.getMeasuresForJoinPredicates(e,n)||[]);var v=hd.createWith({from:e.from(),select:h,where:me(me([],p||[],!0),a||[],!0)});return function(t,e){var r=_.filter(_.map(e.select(),function(o){return o.expr}),function(o){return!Aa(o)});if(_.isEmpty(r))return t;var n=_.map(r,function(o){return{condition:Tn(o,Ei(!0))}}),i=t.from(),a=nu.ensureFiltersInSubqueries(i,n,i);return i===a?t:Ue.fromSQFromAndSQFilters(a,t.where())}(t.fromMeasuresQuery(v,i),e)},t.fromMeasuresQuery=function(e,r){var n=new yr(e),i=new Jr,o=Su(r,Zr(i.ensureSource(n,"subquery").name)),s=He.rewrite(o,i,i),l=[];return l.push({condition:s}),t.fromSQFromAndSQFilters(i,l)},t.getDefaultValueFilter=function(e){return t.getDataViewScopeIdentityComparisonFilters(e,Ua())},t.getAnyValueFilter=t.getDefaultAnyValueFilter=function(e,r){if(_.isEmpty(e))return t.getAnyValueFilter(r);if(_.isEmpty(r))return t.getDefaultValueFilter(e);var n=Array.apply(null,Array(e.length)).map(function(){return Ua()}),i=Array.apply(null,Array(e.length)).map(function(){return Ei()}),s=it(vi(e,n),vi(r,i));return t.fromSQExpr(s)},t.getDataViewScopeIdentityComparisonFilters=function(e,r){if(u.assertValue(e,"fieldSQExprs"),u.assertValue(r,"value"),e instanceof Array){var n=Array.apply(null,Array(e.length)).map(function(){return r});return t.fromSQExpr(vi(e,n))}return t.fromSQExpr(Tn(e,r))},t.prototype.from=function(){return this.fromValue.clone()},t.prototype.conditions=t.prototype.where=t.prototype.rewrite=t.prototype.validate=function(e,r,n){var i=new Tp(e,r,n);return this.rewrite(i),i.errors},t.merge=function(e){if(_.isEmpty(e))return null;if(1===e.length)return e[0];for(var r=e[0],n=r.from(),i=cr(r.whereItems,r.whereItems.length),a=1,o=e.length;a<o;a++)t.applyFilter(e[a],n,i);return new t(n,i)},t.unmerge=t.removeUnreferencedKeys=t.getMeasuresForJoinPredicates=function(e,r){for(var n=e.select(),i=[],a=function(c){var f=n[c];if(Aa(f.expr)){if(_.some(r.SuppressedJoinPredicates,function(d){return d===c}))return"continue";(o.isSelectProjected(r.Primary,c)||o.isSelectProjected(r.Secondary,c))&&i.push(f)}},o=this,s=0;s<n.length;s++)a(s);return i},t.isSelectProjected=t.isDefaultFilter=function(e){return!(!e||1!==e.where().length)&&function(t){return u.assertValue(t,"expr"),t.accept(n0.instance)}(e.where()[0].condition)},t.isAnyFilter=function(e){return!(!e||1!==e.where().length)&&function(t){return u.assertValue(t,"expr"),t.accept(t0.instance)}(e.where()[0].condition)},t.isSameFilter=function(e,r){return e===r||!!(e&&r&&e.from().equals(r.from())&&xe(e.where(),r.where(),function(n,i){return si(n,i)}))&&!(t.isDefaultFilter(e)&&t.isAnyFilter(r)||t.isAnyFilter(e)&&t.isDefaultFilter(r))},t.isInFilter=function(e){return!(!e||1!==e.where().length)&&dt(e.where()[0].condition)},t.applyFilter=function(e,r,n){u.assertValue(e,"filter"),u.assertValue(r,"from"),u.assertValue(n,"where");for(var a=0,o=e.whereItems;a<o.length;a++){var s=o[a],l={condition:He.rewrite(s.condition,e.fromValue,r)};s.target&&(l.target=_.map(s.target,function(c){return He.rewrite(c,e.fromValue,r)})),n.push(l)}},t.prototype.setIgnoreMParameter=t}(),He=function(t){function e(r,n){var i=this;return u.assertValue(n,"destinationFrom"),(i=t.call(this)||this).sourceFrom=r,i.destinationFrom=n,i}return T(e,t),e.prototype.visitEntity=function(r){var n=this.destinationFrom.source(r.variable);if(n&&wa(n)&&n.schema===r.schema&&n.entity===r.entity)return r;var i=this.destinationFrom.ensureSource(new hi(r.schema,r.entity),r.variable);return i.name!==r.variable?new Pa(r.schema,r.entity,i.name):r},e.prototype.visitSubqueryRef=function(r){if(!this.sourceFrom)return u.assertFail("A source From clause must be provided to rewrite an expression containing a subquery reference."),r;var n=this.sourceFrom.source(r.variable);if(!n)return r;var i=this.destinationFrom.source(r.variable);if(i&&Kr(i)&&Ps(n.subquery,i.subquery))return r;var a=this.destinationFrom.ensureSource(new yr(n.subquery),r.variable);return a.name!==r.variable?new cu(a.name):r},e.prototype.visitNamedQueryRef=function(r){var n=this.destinationFrom.source(r.variable);if(n&&xa(n)&&H(n.expr,r))return r;var a=this.destinationFrom.ensureSource(new tu(r),r.variable);return a.name!==r.variable?new Hd(r.queryName,a.name):void 0},e.rewrite=function(r,n,i){u.assertValue(r,"expr"),u.assertValue(i,"destinationFrom");var a=new e(n,i);return r.accept(a)},e}(eu),vd=function(t){function e(r){var n=this;return u.assertValue(r,"keys"),(n=t.call(this)||this).keys=r,n}return T(e,t),e.prototype.visitEntity=function(r){this.removeKey(r.variable)},e.prototype.visitSubqueryRef=function(r){this.removeKey(r.variable)},e.prototype.visitNamedQueryRef=e.prototype.removeKey=e.prototype.result=function(){return this.keys},e}(Kt),i0=function(t){eturn T(e,t),e.prototype.visitEntity=function(r){this.containsEntityRefs=!0},e.prototype.visitPropertyVariationSource=function(r){this.containsEntityRefs=!0},e.prototype.visitSubqueryRef=function(r){this.containsSubqueries=!0},e.prototype.willFilterAffectQuery=e}(Kt),a0=function(){function t(e,r,n){this.renameSources=e,this.from=r,this.usedSourceNames=n,u.assertValue(e,"renameSources"),u.assertValue(r,"from"),u.assertValue(n,"usedSourceNames")}return t.renameSources=t.prototype.visitEntity=function(e,r){return e},t.prototype.visitPod=function(e,r){return e},t.prototype.visitSubquery=function(e,r){var n=e.subquery,i=this.renameSources(n,this.usedSourceNames);return i===n?e:new yr(i)},t.prototype.visitExpr=function(e,r){return e},t}(),nu=function(){function t(e,r){this.filtersToEnsure=e,this.filtersToEnsureFrom=r,this.modifiedSubquery=!1,u.assertNonEmpty(e,"expected filters to ensure exist in each subquery")}return t.ensureFiltersInSubqueries=function(e,r,n){var i=new t(r,n),a=Ta.rewriteFrom(e,i);return u.assert("expected to rewrite the from clause if and only if we modified a subquery"),a},t.prototype.visitEntity=function(e,r){return e},t.prototype.visitPod=function(e,r){return e},t.prototype.visitSubquery=function(e,r){for(var n=e.subquery.where(),i=[],a=function(f){_.find(n,function(d){return si(f,d)})||i.push(f)},o=0,s=this.filtersToEnsure;o<s.length;o++)a(s[o]);return 0===i.length?e:(this.modifiedSubquery=!0,new yr(e.subquery.addWhere(i,this.filtersToEnsureFrom)))},t.prototype.visitExpr=function(e,r){return e},t}();ar s0=function(t){eturn T(e,t),e.prototype.visitColumnRef=e.prototype.visitMeasureRef=e.prototype.visitEntity=function(r){var n={schema:r.schema,entity:r.entity};return r.variable&&(n.entityVar=r.variable),{entity:n}},e.prototype.visitAggr=e.prototype.visitPercentile=e.prototype.visitGroupRef=e.prototype.visitHierarchy=function(r){var n=r.arg.accept(Mn.instance);if(n){if(n.entity)return{hierarchy:{entity:n.entity.entity,name:r.hierarchy,schema:n.entity.schema}};if(n.variation&&n.variation.column){var i=n.variation;if(ni(r.arg)){var a=r.arg;if(mn(a.arg)){var o=a.arg,s=this.schema.schema(i.column.schema).findTargetEntityOfVariation(o.entity,i.column.name,i.variationName);if(s)return{columnHierarchyVariation:{source:de({},i.column),hierarchy:{schema:i.column.schema,entity:s.name,name:r.hierarchy},variationName:n.variation.variationName}}}}}}},e.prototype.visitHierarchyLevel=e.prototype.visitArithmetic=function(r){if(!Ur(r.right))return{arithmetic:{left:r.left.accept(this),right:r.right.accept(this),operator:r.operator}};var n={percentOfGrandTotal:{baseExpr:r.left.accept(this)}};if(H(r,ge(n)))return n;var i=r.right.scope;return!_.isEmpty(i)&&_.every(i,function(a){return Tf(a)})?{percentOfRoleTotal:{baseExpr:r.left.accept(this),roles:_.map(i,function(a){return a.role})}}:void 0},e.prototype.visitSelectRef=function(r){return{selectRef:{expressionName:r.expressionName}}},e.prototype.visitTransformOutputRoleRef=e.prototype.visitFilteredEval=function(r){var n=this,i=_.map(r.filters,function(a){var o=function(t,e){if(t){var r=t.where();if(r){var n=new D0(e),i=t.from();return r.map(function(a){var o=n.tryMatchPattern(a,i);if(o){var s={condition:o};return _.isEmpty(a.target)||(s.target=_.map(a.target,function(l){return pe(l)})),s}})}}}(Ue.fromSQFromAndSQFilters(new Jr,[a]),n.schema);if(o)return u.assert(function(){return 1===o.length},"There are more than one filter pattern in this Semantic Filter"),o[0]});return{filteredEval:{baseExpr:r.expression.accept(this),filters:i}}},e.prototype.visitConstant=e.prototype.visitSparklineData=e.prototype.visitNativeVisualCalc=e}(Ke),Mn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitEntity=e.prototype.visitPropertyVariationSource=function(r){var n=r.arg;if(mn(n)){var i={schema:n.schema,entity:n.entity,name:r.property};return n.variable&&(i.entityVar=n.variable),{variation:{column:i,variationName:r.name}}}},e.prototype.visitSubqueryRef=e.prototype.visitTransformTableRef=function(r){return u.assertValue(r,"expr"),u.assertValue(r.source,"source"),{transform:{name:null==r?void 0:r.source}}},e.instance=new e,e}(Ke),u0=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitHierarchy=e.instance=new e,e}(Ke),ht=function(){function t(){}return t.supportsArithmetic=t.indexOfExpr=function(e,r){u.assertValue(e,"items"),u.assertValue(r,"searchElement");for(var n=0,i=e.length;n<i;n++)if(H(e[n],r))return n;return-1},t.sequenceEqual=function(e,r){u.assertValue(e,"x"),u.assertValue(r,"y");var n=e.length;if(n!==r.length)return!1;for(var i=0;i<n;i++)if(!H(e[i],r[i]))return!1;return!0},t.isSubset=function(e,r){u.assertValue(e,"x"),u.assertValue(r,"y");for(var n=function(c){if(-1===_.findIndex(r,function(d){return H(d,c)}))return{value:!1}},i=0,a=e;i<a.length;i++){var s=n(a[i]);if("object"==typeof s)return s.value}return!0},t.isFromVariation=function(e){return u.assertValue(e,"expr"),ri(e)&&ni(e.arg)||qr(e)&&this.isFromVariation(e.arg)},t.discourageAggregation=t.getAggregateBehavior=function(e,r){u.assertValue(e,"expr"),u.assertValue(r,"schema");var n=this.getConceptualColumn(e,r);if(n)return n.aggregateBehavior},t.getSchemaCapabilities=function(e,r){u.assertValue(e,"expr"),u.assertValue(r,"schema");var n=pe(e,r);if(n){var i=uu(n);return _.chain(i).map(.filter(function(a){return!!a}).value()}},t.getKpiMetadata=t.getParameterMetadata=t.getWhatIfParameterMetadata=t.getFieldParameterQuerySelects=function(e,r){var n;if(!_.isEmpty(e)){var i=e.getConceptualProperty(r);if(i){var a=i.column;if(a&&2===e.kind&&2===(null===(n=a.parameterMetadata)||void 0===n?void 0:n.kind)){var o=e.getTargetEntity(),s=r.schema(o.schema).entities.withName(o.entity),l=_.some(s.properties,;u.assert(function(){return l},"A key should always exist within the fieldParameter entity");for(var c=0,f=s.properties;c<f.length;c++){var d=f[c];if(d.column&&d.column.keys&&1===d.column.keys.length){var p=d.column.keys[0];if(p===i)return{parameterColumn:e,labelColumn:Ie(o,d.name)};if(i===d)return{labelColumn:e,parameterColumn:Ie(o,p.name)}}}return{parameterColumn:e}}}}},t.getFieldParameters=t.getParameterValuesOrder=function(e,r){if(!_.isEmpty(e))for(var n=0,i=e;n<i.length;n++){var a=i[n],o=null==a?void 0:a.conditions();if(!_.isEmpty(o)){var s=Kb(r,o[0]);if(!_.isEmpty(s))return s}}return[]},t.isFilterForFieldParameter=t.shouldUseAsFieldParameter=function(e,r,n,i,a){return!(!e||a||!i||qr(n)||!t.getFieldParameterQuerySelects(n,r))},t.getDataViewParameterColumnMetadata=t.getDataViewParameterKind=function(e){if(null!=e){var r=e.kind;if(null==r)return 0;switch(r){case 0:return 0;case 1:return 1;case 2:return 2;default:return void u.assertNever(r)}}},t.hasMappedMParameter=t.isSupportMulitpleValuesEnabled=function(e,r){var n=this.getConceptualParameterMetadata(e,r);return null==n?void 0:n.supportsMultipleValues},t.getConceptualParameterMetadata=t.getConceptualEntity=function(e,r){return u.assertValue(e,"entityExpr"),r.schema(e.schema).entities.withName(e.entity)},t.hasMappedColumn=function(e,r){return l0.hasMappedColumn(e,r)},t.getColumnnsWithKey=function(e,r){u.assertValue(e,"keyExpr"),u.assertValue(r,"schema");var n=e.getTargetColumnRef(r);if(n){var i=n.getConceptualProperty(r);if(i&&i.column){var a=n.getTargetEntity();if(a){var o=this.getConceptualEntity(a,r);if(o){for(var s=[],l=0,c=o.properties;l<c.length;l++){var f=c[l];f.column&&f.column.keys&&_.includes(f.column.keys,i)&&s.push(Ie(a,f.name))}return s}}}}},t.tryGetExprFromFilter=function(e){if(dt(e.condition)&&1===_.size(e.condition.args))return e.condition.args[0];if(Cn(e.condition)){if(Re(e.condition.left))return e.condition.right;if(Re(e.condition.right))return e.condition.left}},t.checkExprForValidMParameters=t.checkExprForMapped=function(e,r){return Cn(e)?this.checkComparsionForMapped(e,r):dt(e)?this.checkInForMapped(e,r):Wt(e)?this.checkOrForMapped(e,r):{isValidSQExpr:!t.hasMappedColumn(e,r)}},t.checkComparsionForMapped=function(e,r){if(!Pt(e.left))return{isValidSQExpr:!0};var a,n=t.getConceptualParameterMetadata(e.left,r);if(1===(null==n?void 0:n.kind)){if(0!==e.comparison||sa(e.right))return{isValidSQExpr:!1};if(!n.supportsSelectAll&&As(e.right))return{isValidSQExpr:!1};a=e.left}return{isValidSQExpr:!0,columnExpr:a}},t.checkInForMapped=function(e,r){for(var i,n=e.args,a=!1,o=!1,s=0,l=n;s<l.length;s++){var c=l[s];if(Pt(c)){var f=t.getConceptualParameterMetadata(c,r);if(a=1===(null==f?void 0:f.kind)){i=c,o=null==f?void 0:f.supportsMultipleValues;break}}}if(a){if(n.length>1||e.table&&ws(e.table)||e.values.length>1&&!o)return{isValidSQExpr:!1};if(_.some(e.values,)return{isValidSQExpr:!1}}return{isValidSQExpr:!0,columnExpr:i}},t.checkOrForMapped=function(e,r){var n=this.checkExprForMapped(e.left,r),i=this.checkExprForMapped(e.right,r),a=n.columnExpr,o=i.columnExpr;return H(a,o)?a&&!t.isSupportMulitpleValuesEnabled(a,r)||o&&!t.isSupportMulitpleValuesEnabled(o,r)?{isValidSQExpr:!1}:{isValidSQExpr:n.isValidSQExpr&&i.isValidSQExpr,columnExpr:a}:{isValidSQExpr:!1}},t.getKpiStatusProperty=function(e,r){var n=e.getConceptualProperty(r);if(n){var i=n.kpiValue;if(i&&i.measure.kpi.status===n)return n}},t.getKpiTrendProperty=t.getDefaultValue=t.getConceptualColumn=function(e,r){if(e&&r){var n=pe(e);if(n){var i=n.column||n.groupingColumn;if(i){if(r.schema(i.schema)&&i.name){var a=r.schema(i.schema).findProperty(i.entity,i.name);if(a)return a.column}}else{var o=n.hierarchyLevel;if(o){var s=mr(n),l=s.schema;if(r.schema(l)){var c=r.schema(l).findHierarchy(s.entity,o.name);if(c){var f=c.levels.withName(o.level);if(f&&f.column)return f.column.column}}}}}}},t.getDefaultValues=t.getPrimitiveValuesFromSQConstantExpr=function(e){if(Re(e)){if(bs(e))return Te.getTextValue(e);if(yn(e))return Te.getDateValue(e);if(wf(e))return Te.getNumericValue(e);if(xf(e))return Te.getBooleanValue(e)}},t.convertSemanticFilterToDataViewScopeIdentity=function(e){var r=[],n=e.conditions();if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i],s=new _n;if(o.accept(s),s.keys&&s.values&&s.values.length>0&&s.keys.length>0&&s.values.length%s.keys.length==0)for(var l=0;l<s.values.length;l+=s.keys.length){for(var c=[],f=[],d=0;d<s.keys.length;d++)c.push(s.keys[d]),f.push(s.values[l+d]);var h=mt(vi(c,f));r.push(h)}}return r},t.getActiveTablesNames=function(e){var n=new jC;if(e){var i=e.from();if(void 0!==i)for(var a=0,o=i.keys();a<o.length;a++)i.source(o[a]).accept(n,null)}return _.map(n.entities,function(l){return l.entity})},t.isRelatedToMany=function(e,r,n,i){return this.isRelated(e,r,n,0,2,i)||this.isRelated(e,n,r,2,0,i)},t.isRelatedToOne=t.isRelated=function(e,r,n,i,a,o){var s=t.getConceptualEntity(r,e);if(u.assertValue(s,"could not resolve conceptual entity form sourceExpr."),_.isEmpty(s.navigationProperties))return!1;var l=t.getConceptualEntity(n,e);u.assertValue(l,"could not resolve conceptual entity form targetExpr.");var c=[];for(c.push(s);!_.isEmpty(c);){var d=c.shift().navigationProperties;if(!_.isEmpty(d))for(var p=0,h=d;p<h.length;p++){var v=h[p];if(v.isActive&&(null==o||v.behavior===o)&&v.targetMultiplicity===a&&v.sourceMultiplicity===i){if(v.targetEntity===l)return!0;c.push(v.targetEntity)}}}return!1},t.isRelatedOneToOne=function(e,r,n,i){var a=t.getConceptualEntity(r,e);u.assertValue(a,"could not resolve conceptual entity form sourceExpr.");var o=t.getConceptualEntity(n,e);u.assertValue(o,"could not resolve conceptual entity form targetExpr.");var s=a.navigationProperties,l=o.navigationProperties;return(!_.isEmpty(s)||!_.isEmpty(l))&&(this.hasOneToOneNavigation(s,o,i)||this.hasOneToOneNavigation(l,a,i))},t.haveTheSameSchema=function(e){u.assertNonEmpty(e,"exprs should not be null, undefined, or empty");var r=e[0].schema;return _.chain(e).drop(1).every(function(n){return n.schema===r}).value()},t.areHierarchicallyRelated=t.buildEntityGraph=t.addTraversalNodes=t.multiplicityPairMatches=t.findEntityPath=t.getEntityLoopPatterns=t.endsWith=t.hasOneToOneNavigation=t.concatUnique=function(e,r){u.assertValue(e,"leftExprs"),u.assertValue(r,"rightExprs");for(var n=hf(e),i=0,a=r;i<a.length;i++){var o=a[i];-1===this.indexOfExpr(n,o)&&n.push(o)}return n},t.detectTransformExpr=function(e){u.assertValue(e,"expr");var r=new c0;return e.accept(r),r.sawTransformOutputRoleRef},t.isExprValidForAggregation=function(e){return u.assertValue(e,"expr"),!this.isFromVariation(e)&&!ri(e)},t.isExprValidForSorting=function(e){return u.assertValue(e,"expr"),!ii(e)},t.isExprValidForFiltering=function(e){return u.assertValue(e,"expr"),!(ii(e)||Af(e)||Ts(e)||ai(e))},t.isExprValidForClustering=function(e){return u.assertValue(e,"expr"),!(ii(e)||ri(e)||qr(e)||Ts(e)||ai(e))},t.isExprValidForAnalysisTransform=function(e){return u.assertValue(e,"expr"),!ii(e)},t.getSubqueryExpression=function(e,r){var i,a,n=pe(e);if(n.columnSubquery)n.columnSubquery.subqueryRef?i=n.columnSubquery.subqueryRef:n.columnSubquery.subquery?a=new yr(n.columnSubquery.subquery):u.assertFail("fieldExpr needs to contain either a subquery reference or an inlined query");else{if(!n.columnAggrSubquery)return void u.assertFail("invalid fieldExpr in subquery");n.columnAggrSubquery.subqueryRef?i=n.columnAggrSubquery.subqueryRef:n.columnAggrSubquery.subquery?a=new yr(n.columnAggrSubquery.subquery):u.assertFail("fieldExpr needs to contain either a subquery reference or an inlined query")}a||(u.assert(function(){return!(!r||!r.sources)},"context sources should be available for evaluating subquery source"),r.sources[i]?(a=r.sources[i],u.assert("column referencing source should be available and be a subquery source")):u.assertFail("No context for the subquery ref.  Cannot construct SQFromSubquerySource without underlying reference."));var o=a;if(o){var s=function(t){return su(t)||mr(t).entity}(n),l=void 0;if(o.subquery&&(l=o.subquery.select().withName(s)),l)return l.expr}},t.buildExprEvaluationContext=function(e){u.assertValue(e,"from");var r=e.sources();if(r)return{sources:r}},t.transformToVisualQueryField=t.isSQExprArray=function(e){return e[0]instanceof B},t.syncSQExprWithFilterIdenities=function(e,r){var n=new d0(e,vr(r)),i=r.accept(n);if(i)return i.accept(new f0)},t.validate=function(e,r,n){u.assertValue(r,"schema");var i=[];if(e&&(i=e.validate(r,n,i)),!_.isEmpty(i))return i},t.allowedHierarchicalMultiplicityPairForTraversal=[[0,2],[0,0]],t}(),l0=function(t){eturn T(e,t),e.prototype.visitIn=e.prototype.visitColumnRef=e.hasMappedColumn=e}(Kt),c0=function(t){eturn T(e,t),e.prototype.visitTransformOutputRoleRef=function(r){this.sawTransformOutputRoleRef=!0},e}(Kt),f0=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitIn=function(r){return en(r.args,this.removeDuplicates(r.values),r.getAnnotations())},e.prototype.visitAnd=function(r){var n=r.right.accept(this);return it(r.left.accept(this),n,r.getAnnotations())},e.prototype.visitOr=function(r){var n=r.right.accept(this);return Si(r.left.accept(this),n,r.getAnnotations())},e.prototype.visitDefault=function(r){return r},e.prototype.removeDuplicates=function(r){return _.uniqWith(r,function(n,i){for(var a=n.length,o=0;o<a;o++)if(!H(n[o],i[o]))return!1;return!0})},e}(Ke),d0=function(t){eturn T(e,t),e.prototype.visitIn=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){if(this.noChangeRequired(r.args))return r;var n=this.tryToRemoveColumnsToMatchVisual(r),i=n.newArgs,a=n.newValues;if(!this.shouldDropWholeSQExpr()&&0!==i.length)return en(i,a,r.getAnnotations())}},e.prototype.visitDefault=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){var n=r.left,i=r.right;if(n&&_.some(this.filterIdentities,function(a){return H(a,n)})||i&&_.some(this.filterIdentities,function(a){return H(a,i)}))return r;this.hasBeenModified=!0}},e.prototype.visitAnd=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){var n=r.right.accept(this),i=r.left.accept(this);if(!this.shouldDropWholeSQExpr()){if(i&&n)return it(i,n,r.getAnnotations());if(i)return i;if(n)return n}}},e.prototype.visitOr=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){var n=r.right.accept(this),i=r.left.accept(this);if(!this.shouldDropWholeSQExpr()){if(i&&n)return Si(i,n,r.getAnnotations());if(i)return i;if(n)return n}}},e.prototype.visitNot=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){var n=r.arg.accept(this);if(n&&(this.isRootNotExpr||!this.hasBeenModified))return qa(n,r.getAnnotations())}},e.prototype.verifyIsSupportedSQExpr=function(r){this.isSupportedSQExpr=Wt(r)?dt(r.right)&&(Wt(r.left)||dt(r.left)):En(r)?vr(r.right)&&(dt(r.left)||Wt(r.left)):vr(r)?Wt(r.arg)||vr(r.arg):!dt(r)||!!r.values&&r.values.length>0},e.prototype.shouldDropWholeSQExpr=e.prototype.noChangeRequired=function(r){var n=this,i=r.map(function(a){return{expr:[a],index:_.findIndex(n.filterIdentities,function(s){return H(s,a)})}});return 0===i[0].index&&i.every(},e.prototype.tryToRemoveColumnsToMatchVisual=function(r){var n=this,i=[],a=[],s=r.values,l=r.args.map(function(h){return{expr:[h],index:_.findIndex(n.filterIdentities,function(g){return H(g,h)})}});if(l[0].index>0)return this.hasBeenModified=!0,{newArgs:i,newValues:a};s=_.unzip(s);var c=l.map(function(h,v){return{expr:s[v],index:h.index}});i=l.filter(function(h){return h.index>-1}).map(,a=c.filter(function(h){return h.index>-1}).map(function(h){return h.expr}),l=l.filter(;for(var f=0;f<l.length-1;f++)if(l[f].index+1<l[f+1].index){i=i.splice(0,f+1),a=a.splice(0,f+1);break}return a=_.unzip(a),this.hasBeenModified=!0,{newArgs:i,newValues:a}},e}(Ke);function gd(t){if(t&&Kr(t)){var e=t.subquery.orderBy();if(!e||1!==e.length)return;var r=e[0],n=new p0;return n.visitOrderBy(r.expr)?{orderByField:n.orderByField,isTop:2===r.direction,itemCount:t.subquery.top()}:void 0}}var p0=function(t){eturn T(e,t),e.prototype.visitOrderBy=function(r){return r.accept(this,0)},e.prototype.visitAggr=function(r,n){return 0===n&&(u.assertValue(pe(r),"expected field pattern"),this.orderByField=r,!0)},e.prototype.visitMeasureRef=function(r,n){return 0===n&&(this.orderByField=r,!0)},e}(pi);function yd(t,e){var r=new v0;e.accept(r);var n={fieldsBeingFiltered:_.uniqWith(r.fieldsBeingFiltered,H),isSubquery:!1};if(r.subqueryName){n.isSubquery=!0;var i=t.sources(),o=gd(i&&i[r.subqueryName]);o&&(n.orderByField=o.orderByField,n.itemCount=o.itemCount,n.isTop=o.isTop)}return n}var v0=function(t){eturn T(e,t),e.prototype.visitColumnRef=function(r){this.fieldsBeingFiltered.push(r)},e.prototype.visitHierarchyLevel=function(r){this.fieldsBeingFiltered.push(r)},e.prototype.visitGroupRef=function(r){this.fieldsBeingFiltered.push(r)},e.prototype.visitSubqueryRef=function(r){r.variable?this.subqueryName=r.variable:u.assertFail("SubqueryRef with a inlined subquery not expected here")},e.prototype.visitAggr=e.prototype.visitPropertyVariationSource=function(r){this.fieldsBeingFiltered.push(r)},e.prototype.visitMeasureRef=e}(Kt);function Ia(t,e){void 0===e&&(e=!1);var r=t.field,n=t.options,i=null,a=Cu();if(t.options.anchorDate&&!xn(n.relativeUnit)){var o=t.options.anchorDate;o.epochTimeStamp=Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds()),a=Xt(t.options.anchorDate)}var s=function(t){switch(t){case z.CalendarYear:case z.Year:return 3;case z.CalendarMonth:case z.Month:return 2;case z.CalendarWeek:case z.Week:return 1;case z.Day:return 0;case z.Hour:return 7;case z.Minute:return 6;case z.Second:return 5;default:return void u.assertFail("Unsupported RelativeDateUnit")}}(n.relativeUnit),l=function(t,e){switch(void 0===e&&(e=!1),t){case z.Second:case z.Minute:case z.Hour:case z.Year:case z.Month:case z.Week:return!1;case z.Day:return e;case z.CalendarYear:case z.CalendarMonth:case z.CalendarWeek:return!0;default:return void u.assertFail("Unsupported RelativeDateUnit")}}(n.relativeUnit,e);switch(n.relativeQualifier){case Y.Current:i=An(0,r,yt(s,a));break;case Y.Last:if(l)i=md(-n.duration,-1,s,a,r);else if(xn(n.relativeUnit)){var f=a;i=Er(r,vt(s,-n.duration,a),f)}else{var p=n.includeToday?a:vt(0,-1,a);f=yt(0,p),i=Er(r,yt(0,vt(s,-n.duration,vt(0,1,p))),f)}break;case Y.Next:if(l)i=md(1,n.duration,s,a,r);else if(xn(n.relativeUnit))i=Er(r,a,f=vt(s,n.duration,a));else{var h=n.includeToday?a:vt(0,1,a);i=Er(r,yt(0,h),f=yt(0,vt(s,n.duration,vt(0,-1,h))))}}return i}function md(t,e,r,n,i){return Er(i,yt(r,vt(r,t,n)),yt(r,vt(r,e,n)))}function _a(t,e){switch(t){case 0:return z.Day;case 1:return e?z.CalendarWeek:z.Week;case 2:return e?z.CalendarMonth:z.Month;case 3:return e?z.CalendarYear:z.Year;case 7:return z.Hour;case 6:return z.Minute;case 5:return z.Second;default:return}}var Ed=function(){function t(e){this.relativeFilterType=e}return t.prototype.tryExtractParametersFrom=t.prototype.tryExtractCurrent=function(e){if(Cn(e)){var r=e;if((Pt(r.left)||qr(r.left))&&(this.field=r.left,hr(r.right))){var n=r.right,i=id.convertTimeUnitToRelativeFilterType(n.unit);if(this.relativeFilterType!==i)return!1;if(void 0!==_a(n.unit,!1)&&(Ds(n.arg)||yn(n.arg))&&(this.options={duration:1,includeToday:!0,includeTodayFromDefault:!0,relativeQualifier:Y.Current,relativeUnit:_a(n.unit,!1)},yn(n.arg)&&(this.options.anchorDate=n.arg.value),this.validateOptions(e)))return!0}}return!1},t.prototype.tryExtractLastOrNext=function(e){if(Ms(e)){var r=e;if(Pt(r.arg)||qr(r.arg))if(this.field=r.arg,hr(r.upper)&&hr(r.lower)){if(this.options=this.getOptionsFromDateSpan(r.lower,Y.Last),this.validateOptions(e)||(this.options=this.getOptionsFromDateSpan(r.upper,Y.Next),this.validateOptions(e)))return!0}else if(bn(r.upper)||bn(r.lower)){var n=r.lower,i=r.upper;if(this.options=this.getOptionsFromDateAdd(n,n.unit,Y.Last),this.validateOptions(e)||(this.options=this.getOptionsFromDateAdd(i,i.unit,Y.Next),this.validateOptions(e)))return!0}}return!1},t.prototype.getOptionsFromDateSpan=function(e,r){if(hr(e))return this.getOptionsFromDateAdd(e.arg,e.unit,r)},t.prototype.getOptionsFromDateAdd=function(e,r,n){if(bn(e)){var i=e,a=id.convertTimeUnitToRelativeFilterType(i.unit);if(this.relativeFilterType!==a)return;var o=r===i.unit&&0!==r,s=!!o||this.getIncludeToday(i.arg),l=this.getAnchorDate(i);switch(n){case Y.Last:if(i.amount<0)return{duration:-i.amount,includeToday:s,relativeQualifier:n,relativeUnit:_a(i.unit,o),anchorDate:l};break;case Y.Next:if(i.amount>0)return{duration:i.amount,includeToday:s,relativeQualifier:n,relativeUnit:_a(i.unit,o),anchorDate:l}}}},t.prototype.getAnchorDate=function(e){for(var r=e;bn(r);)r=r.arg;if(yn(r))return r.value},t.prototype.getIncludeToday=function(e){if(bn(e)){var r=e;return Ds(r.arg)||yn(r.arg)}return!1},t.prototype.validateOptions=function(e){if(!this.field||!this.options)return!1;var r={field:this.field,options:this.options};return H(e,Ia(r))||this.options.relativeUnit===z.Day&&!this.options.includeToday&&H(e,Ia(r,!0))},t}();function Cd(t,e){u.assertValue(t,"from"),u.assertValue(e,"condition");var r=new V0;if(r.visitCondition(e)){var n=t.sources(),i=n&&n[r.subqueryName],a=gd(i);if(a&&Kr(i))return{fieldBeingFiltered:r.fieldBeingFiltered,isTop:a.isTop,itemCount:i.subquery.top(),orderByField:a.orderByField}}}var V0=function(t){eturn T(e,t),e.prototype.visitCondition=e.prototype.visitIn=e.prototype.visitColumnRef=function(r,n){return 1===n&&(this.fieldBeingFiltered=r,!0)},e.prototype.visitHierarchyLevel=function(r,n){return 1===n&&(this.fieldBeingFiltered=r,!0)},e.prototype.visitGroupRef=e.prototype.visitSubqueryRef=function(r,n){return 2===n&&(r.variable?this.subqueryName=r.variable:u.assertFail("SubqueryRef with a direct subquery not expected here"),!0)},e}(pi),x0=function(){function t(){}return t.prototype.visitIn=function(e){return en(_.map(e.args,function(r){return ge(r)}),_.map(e.values,function(r){return _.map(r,}))},t.prototype.visitBetween=function(e){if(e&&e.lower&&e.upper){var r=yt(e.lower.unit,Xt(e.lower.value)),n=yt(e.upper.unit,Xt(e.upper.value));return Er(ge(e.arg),r,n)}},t.prototype.visitRelativeDateRange=function(e){return Ia({field:ge(e.arg),options:e.options})},t.prototype.visitComposite=function(e){return null},t.prototype.visitTopN=function(e){return null},t.prototype.visitComplex=t.prototype.visitAdvanced=function(e){},t.prototype.visitCompare=function(e){},t.prototype.visitHierarchical=function(e){},t.instance=new t,t}(),D0=function(){function t(e){this.schema=e}return t.prototype.tryMatchPattern=function(e,r){var n;if(u.assert(function(){return void 0!==e},"There is no SQFilter for this Semantic filter"),n=this.matchTopN(e,r))return n;var i=e&&e.condition;if(i){if((n=this.tryMatchExpr(i,2))||(n=this.tryMatchComplex(e,r)))return n;u.assert(function(){return null==n},"There is no pattern that currently matches `expr`")}},t.prototype.tryMatchExpr=function(e,r){var n;if((n=this.matchBasicFilter(e))||(n=this.matchRelativeRange(e,Wr.Date))||(n=this.matchRelativeRange(e,Wr.Time))||(n=this.matchDateRange(e))||(n=this.matchAdvanced(e))||(n=this.matchCompareOperator(e))||1!==r&&(n=this.tryMatchHierarchical(e))||(n=this.matchComposite(e,r)))return n;u.assert("There is no pattern that currently matches `expr`")},t.prototype.tryMatchComplex=function(e,r){var n=function(t,e){if(t){if(t instanceof Ue){var r=t.conditions();return _.isEmpty(r)||r.length>1?void 0:yd(t.from(),r[0])}return yd(e,t.condition)}}(e,r);if(n)return{complex:{args:_.map(n.fieldsBeingFiltered,function(i){return pe(i)})}}},t.prototype.matchBasicFilter=function(e){var r=!1;if(vr(e)&&(r=!0,e=e.arg),dt(e)&&!e.table&&e.values)return{in:{args:_.map(e.args,function(n){return pe(n)}),values:_.map(e.values,,not:r}}},t.prototype.matchDateRange=function(e){if(Ms(e)&&hr(e.lower)&&hr(e.upper))return{between:{arg:pe(e.arg),lower:{value:e.lower.arg.value,unit:e.lower.unit},upper:{value:e.upper.arg.value,unit:e.upper.unit}}}},t.prototype.matchTopN=function(e,r){if(e&&r){var n=function(t,e){if(t){if(t instanceof Ue){var r=t.conditions();return u.assertValue(r,"conditions"),u.assert(function(){return 1===r.length},"should be exactly one filter condition for a TopN filter"),Cd(t.from(),r[0])}return Cd(e,t.condition)}}(e,r);if(n)return{topN:{fieldBeingFiltered:pe(n.fieldBeingFiltered),isTop:n.isTop,itemCount:n.itemCount,orderByField:pe(n.orderByField)}}}},t.prototype.matchRelativeRange=function(e,r){var n=function(t,e){var r=new Ed(e);if(r.tryExtractParametersFrom(t))return{field:r.field,options:r.options}}(e,r);if(n)return{relativeDateRange:{arg:pe(n.field),options:n.options}}},t.prototype.matchCompareOperator=function(e){var r=e,n=!1;if(vr(e)&&(r=e.arg,n=!0),Cn(r)||_f(r)||Pf(r)){var i=this.getValuePattern(r.left,r.right);if(i)return{compareOperator:{arg:pe(r.left),filterOperator:this.mapFromSQExprKindToFilterOperator(r,n),condition:i}}}},t.prototype.getValuePattern=function(e,r){if(hr(r)){var n=r.arg;if(Re(n))return{dateSpan:{value:n.value,unit:r.unit}}}if(Re(r))return{constant:{value:r.value,type:r.type}};if(Ff(r)){var i=ht.getDefaultValue(e,this.schema);return{defaultValue:{value:i.value,type:i.type}}}return As(r)?{anyValue:{}}:void 0},t.prototype.matchAdvanced=function(e){if(En(e)||Wt(e)){var r=En(e)?0:1,n=this.matchAdvanced(e.left)||this.matchCompareOperator(e.left);if(n){var i=this.matchAdvanced(e.right)||this.matchCompareOperator(e.right);if(i)return{advancedOperator:{logicalOperator:r,left:n.advancedOperator||n.compareOperator,right:i.advancedOperator||i.compareOperator}}}}},t.prototype.mapFromSQExprKindToFilterOperator=function(e,r){var i=0;switch(e.kind){case 12:i=r?6:5;break;case 14:i=r?8:7;break;case 13:var a=e;0===a.comparison?i=Re(a.right)&&null==a.right.value?r?12:11:Re(a.right)&&""===a.right.value?r?14:13:r?10:9:1===a.comparison?i=3:2===a.comparison?i=4:3===a.comparison?i=1:4===a.comparison&&(i=2);break;default:i=0}return i},t.prototype.tryMatchHierarchical=function(e){var a,o,r=[],n=[],i={hierarchical:{included:r,excluded:n}};if(e instanceof Dn){if(a=this.tryGetHierarchicalNode(e.left,!1)||this.tryGetHierarchicalNode(e.right,!1),o=this.tryGetHierarchicalNode(e.left,!0)||this.tryGetHierarchicalNode(e.right,!0),!a||!o)return}else if(a=this.tryGetHierarchicalNode(e,!1),o=this.tryGetHierarchicalNode(e,!0),!a&&!o)return;return a&&!this.matchHierarchicalNode(a,!1,r)||o&&!this.matchHierarchicalNode(o,!0,n)?void 0:i},t.prototype.tryGetHierarchicalNode=function(e,r){if(r){if(e instanceof du){if(e.arg instanceof Xr||e.arg instanceof Dn)return e.arg}else if(e instanceof Dn)return e}else if(e instanceof Na||e instanceof Xr)return e},t.prototype.matchHierarchicalNode=function(e,r,n){if(e instanceof Xr)return this.matchHierarchicalExpr(e,r,n);var i=this.tryGetHierarchicalNode(e,r);if(!i)return!1;u.assert(function(){return i instanceof Na||i instanceof Dn},".matchHierarchicalNode does not expect any other expr type");var a=i;return this.matchHierarchicalExpr(a.left,r,n)&&this.matchHierarchicalExpr(a.right,r,n)},t.prototype.matchHierarchicalExpr=function(e,r,n){if(e instanceof Xr){var i=this.matchBasicFilter(e);return!!i&&(n.push(i.in),i.in.not=r,!0)}return this.matchHierarchicalNode(e,r,n)},t.prototype.matchComposite=function(e,r){var n=!1;vr(e)&&(n=!0,e=e.arg);var i=Wt(e);if((!i||0!==r)&&(Wt(e)||En(e))){var a=i?1:0,o=this.tryMatchExpr(e.left,a),s=this.tryMatchExpr(e.right,a);if(o&&s)return{composite:{not:n,operator:a,filters:[o,s]}}}},t}();function A0(t,e){u.assertValue(t,"filterPattern"),u.assertValue(e,"visitor");var r=t.condition;return r.in?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitIn(t)}(r.in,e):r.between?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitBetween(t)}(r.between,e):r.relativeDateRange?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitRelativeDateRange(t)}(r.relativeDateRange,e):r.compareOperator?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitCompare(t)}(r.compareOperator,e):r.advancedOperator?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitAdvanced(t)}(r.advancedOperator,e):r.composite?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitComposite(t)}(r.composite,e):r.topN?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitTopN(t)}(r.topN,e):r.complex?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitComplex(t)}(r.complex,e):r.hierarchical?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitHierarchical(t)}(r.hierarchical,e):void u.assertFail("Failed to visit filterPattern")}function bd(t){return Yt(iu(t),t.aggregate)}function iu(t){return Ie(Jt(t),t.name)}function Vd(t){return Yt(Ba(t.name,Jt(t),kd(t.groupedColumns)),t.aggregate)}function wd(t){return Ba(t.name,Jt(t),kd(t.groupedColumns))}unction xd(t){return Yt(Jt(t),t.aggregate)}function Md(t){return mi(za(Jt(t.source),t.variationName,t.source.name),t.hierarchy.name)}function Dd(t){return Oa(mi(za(Jt(t.source),t.variationName,t.source.name),t.level.name),t.level.level)}function Ad(t){return t.subqueryRef?Ie(Zr(t.subqueryRef),t.name):t.subquery?Ie(Zr(t.subquery),t.name):void 0}function Td(t){return Yt(Ie(Zr(t.subqueryRef),t.name),t.aggregate)}function Id(t){return Ie(gu(t.transformTable.name),t.name)}function _d(t){return Yt(au(t),t.aggregate)}function au(t){return Oa(ou(t),t.level)}ction Rd(t){return bu(ge(t.measure),_.map(t.grouping,function(e){return ge(e)}))}r B0=function(){function t(){}return t.prototype.visitColumn=function(e){return iu(e)},t.prototype.visitColumnAggr=function(e){return bd(e)},t.prototype.visitGroupingColumn=function(e){return wd(e)},t.prototype.visitGroupingColumnAggr=function(e){return Vd(e)},t.prototype.visitColumnHierarchyVariation=function(e){return Md(e)},t.prototype.visitColumnHierarchyLevelVariation=function(e){return Dd(e)},t.prototype.visitColumnSubquery=function(e){return Ad(e)},t.prototype.visitColumnAggrSubquery=function(e){return Td(e)},t.prototype.visitColumnTransformRef=function(e){return Id(e)},t.prototype.visitEntity=function(e){return Jt(e)},t.prototype.visitEntityAggr=function(e){return xd(e)},t.prototype.visitHierarchy=function(e){return ou(e)},t.prototype.visitHierarchyLevel=function(e){return au(e)},t.prototype.visitHierarchyLevelAggr=function(e){return _d(e)},t.prototype.visitMeasure=function(e){return pu(this.visitEntity(e),e.name)},t.prototype.visitPercentile=function(e){return hu(ge(e.arg),e.k,e.exclusive)},t.prototype.visitPercentOfGrandTotal=function(e){var r=ge(e.baseExpr);return yi(r,La(r,[]),3)},t.prototype.visitPercentOfRoleTotal=function(e){var r=ge(e.baseExpr);return yi(r,La(r,_.map(e.roles,function(n){return mu(n)})),3)},t.prototype.visitSelectRef=function(e){return gi(e.expressionName)},t.prototype.visitTransformOutputRoleRef=t.prototype.visitFilteredEval=function(e){return vu(ge(e.baseExpr),_.map(e.filters,function(r){return function(t){var e={condition:A0(t,x0.instance)};return _.isEmpty(t.target)||(e.target=_.map(t.target,function(r){return ge(r)})),e}(r)}))},t.prototype.visitArithmetic=function(e){return Fd(e)},t.prototype.visitConstant=function(e){return Pd(e)},t.prototype.visitSparklineData=function(e){return Rd(e)},t.prototype.visitNativeVisualCalc=function(e){return Nd(e)},t.instance=new t,t}();function Se(t,e){return u.assertValue(t,"expr"),u.assertValue(e,"visitor"),u.assertValue(t,"expected sqExpr to conform to a fieldExprPattern"),t.column?function(t,e){return u.assertValue(t,"column"),u.assertValue(e,"visitor"),e.visitColumn(t)}(t.column,e):t.columnAggr?function(t,e){return u.assertValue(t,"columnAggr"),u.assertValue(e,"visitor"),e.visitColumnAggr(t)}(t.columnAggr,e):t.groupingColumn?function(t,e){return u.assertValue(t,"column"),u.assertValue(e,"visitor"),e.visitGroupingColumn(t)}(t.groupingColumn,e):t.groupingColumnAggr?function(t,e){return u.assertValue(t,"columnAggr"),u.assertValue(e,"visitor"),e.visitGroupingColumnAggr(t)}(t.groupingColumnAggr,e):t.columnHierarchyVariation?function(t,e){return u.assertValue(t,"columnHierarchyVariation"),u.assertValue(e,"visitor"),e.visitColumnHierarchyVariation(t)}(t.columnHierarchyVariation,e):t.columnHierarchyLevelVariation?function(t,e){return u.assertValue(t,"columnHierarchyLevelVariation"),u.assertValue(e,"visitor"),e.visitColumnHierarchyLevelVariation(t)}(t.columnHierarchyLevelVariation,e):t.columnSubquery?function(t,e){return u.assertValue(t,"columnSubquery"),u.assertValue(e,"visitor"),e.visitColumnSubquery(t)}(t.columnSubquery,e):t.columnAggrSubquery?function(t,e){return u.assertValue(t,"columnAggrSubquery"),u.assertValue(e,"visitor"),e.visitColumnAggrSubquery(t)}(t.columnAggrSubquery,e):t.columnTransformRef?function(t,e){return u.assertValue(t,"columnTransformRef"),u.assertValue(e,"visitor"),e.visitColumnTransformRef(t)}(t.columnTransformRef,e):t.entity?function(t,e){return u.assertValue(t,"entity"),u.assertValue(e,"visitor"),e.visitEntity(t)}(t.entity,e):t.entityAggr?function(t,e){return u.assertValue(t,"entityAggr"),u.assertValue(e,"visitor"),e.visitEntityAggr(t)}(t.entityAggr,e):t.hierarchy?function(t,e){return u.assertValue(t,"hierarchy"),u.assertValue(e,"visitor"),e.visitHierarchy(t)}(t.hierarchy,e):t.hierarchyLevel?function(t,e){return u.assertValue(t,"hierarchyLevel"),u.assertValue(e,"visitor"),e.visitHierarchyLevel(t)}(t.hierarchyLevel,e):t.hierarchyLevelAggr?function(t,e){return u.assertValue(t,"hierarchyLevelAggr"),u.assertValue(e,"visitor"),e.visitHierarchyLevelAggr(t)}(t.hierarchyLevelAggr,e):t.measure?function(t,e){return u.assertValue(t,"measure"),u.assertValue(e,"visitor"),e.visitMeasure(t)}(t.measure,e):t.percentile?function(t,e){return u.assertValue(t,"percentile"),u.assertValue(e,"visitor"),e.visitPercentile(t)}(t.percentile,e):t.percentOfGrandTotal?function(t,e){return u.assertValue(t,"percentOfGrandTotal"),u.assertValue(e,"visitor"),e.visitPercentOfGrandTotal(t)}(t.percentOfGrandTotal,e):t.percentOfRoleTotal?function(t,e){return u.assertValue(t,"percentOfRoleTotal"),u.assertValue(e,"visitor"),e.visitPercentOfRoleTotal(t)}(t.percentOfRoleTotal,e):t.selectRef?function(t,e){return u.assertValue(t,"selectRef"),u.assertValue(e,"visitor"),e.visitSelectRef(t)}(t.selectRef,e):t.transformOutputRoleRef?function(t,e){return u.assertValue(t,"transformOutputRoleRef"),u.assertValue(e,"visitor"),e.visitTransformOutputRoleRef(t)}(t.transformOutputRoleRef,e):t.filteredEval?function(t,e){return u.assertValue(t,"filteredEval"),u.assertValue(e,"visitor"),e.visitFilteredEval(t)}(t.filteredEval,e):t.arithmetic?function(t,e){return u.assertValue(t,"arithmetic"),u.assertValue(e,"visitor"),e.visitArithmetic(t)}(t.arithmetic,e):t.constant?function(t,e){return u.assertValue(t,"constant"),u.assertValue(e,"visitor"),e.visitConstant(t)}(t.constant,e):t.sparklineData?function(t,e){return u.assertValue(t,"sparkline"),u.assertValue(e,"visitor"),e.visitSparklineData(t)}(t.sparklineData,e):t.nativeVisualCalc?function(t,e){return u.assertValue(t,"nativeVisualCalc"),u.assertValue(e,"visitor"),e.visitNativeVisualCalc(t)}(t.nativeVisualCalc,e):void u.assertFail("failed to visit a fieldExprPattern.")}function su(t){var e=Se(t,Ld.instance);return u.assert(function(){return!e||1===_.size(e)},"If there are more than 1 property names, then use getPropertyNames instead"),null==e?void 0:e[0]}function mr(t){var e=Se(t,Fa.instance);return u.assert("If there are more than 1 entity, then use toFieldExprEntityItemPatterns instead"),null==e?void 0:e[0]}ar Fa=function(){function t(){}return t.prototype.visitColumn=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitColumnAggr=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitGroupingColumn=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitGroupingColumnAggr=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitColumnHierarchyVariation=function(e){return[t.toEntityItemExprPattern(e.source)]},t.prototype.visitColumnHierarchyLevelVariation=t.prototype.visitColumnSubquery=function(e){},t.prototype.visitColumnAggrSubquery=function(e){},t.prototype.visitColumnTransformRef=function(e){},t.prototype.visitEntity=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitEntityAggr=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitHierarchy=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitHierarchyLevel=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitHierarchyLevelAggr=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitMeasure=t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){return Se(e.arg,this)},t.prototype.visitPercentOfGrandTotal=function(e){return Se(e.baseExpr,this)},t.prototype.visitPercentOfRoleTotal=function(e){return Se(e.baseExpr,this)},t.prototype.visitTransformOutputRoleRef=function(e){},t.prototype.visitFilteredEval=function(e){return Se(e.baseExpr,this)},t.prototype.visitArithmetic=function(e){var r=Se(e.left,this),n=Se(e.right,this),i=r&&n?me(me([],r,!0),n,!0):null!=r?r:n;return _.isEmpty(i)?void 0:i},t.prototype.visitConstant=function(e){},t.prototype.visitSparklineData=function(e){var r=this;return me(me([],Se(e.measure,this),!0),_.chain(e.grouping).map(function(n){return Se(n,r)}).flatten().value(),!0)},t.prototype.visitNativeVisualCalc=function(e){},t.toEntityItemExprPattern=function(e){u.assertValue(e,"exprPattern");var r={schema:e.schema,entity:e.entity};return e.entityVar&&(r.entityVar=e.entityVar),r},t.instance=new t,t}(),Ld=function(){function t(){}return t.prototype.visitColumn=function(e){return[e.name]},t.prototype.visitColumnAggr=function(e){return[e.name]},t.prototype.visitGroupingColumn=function(e){return[e.name]},t.prototype.visitGroupingColumnAggr=function(e){return[e.name]},t.prototype.visitColumnHierarchyVariation=function(e){},t.prototype.visitColumnHierarchyLevelVariation=function(e){},t.prototype.visitColumnSubquery=function(e){return[e.name]},t.prototype.visitColumnAggrSubquery=function(e){return[e.name]},t.prototype.visitColumnTransformRef=function(e){return[e.name]},t.prototype.visitEntity=function(e){},t.prototype.visitEntityAggr=function(e){},t.prototype.visitHierarchy=function(e){},t.prototype.visitHierarchyLevel=function(e){},t.prototype.visitHierarchyLevelAggr=function(e){},t.prototype.visitMeasure=function(e){return[e.name]},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){return Se(e.arg,this)},t.prototype.visitPercentOfGrandTotal=function(e){return Se(e.baseExpr,this)},t.prototype.visitPercentOfRoleTotal=function(e){return Se(e.baseExpr,this)},t.prototype.visitTransformOutputRoleRef=function(e){},t.prototype.visitFilteredEval=t.prototype.visitArithmetic=function(e){var r=Se(e.left,this),n=Se(e.right,this),i=r&&n?me(me([],r,!0),n,!0):null!=r?r:n;return _.isEmpty(i)?void 0:i},t.prototype.visitConstant=function(e){},t.prototype.visitSparklineData=function(e){var r=this;return me(me([],Se(e.measure,this),!0),_.chain(e.grouping).map(function(n){return Se(n,r)}).flatten().value(),!0)},t.prototype.visitNativeVisualCalc=t.instance=new t,t}(),hb=/'/g,vb=/\.000$/;function Bd(t){return u.assertValue(t,"value"),"'"+t.replace(hb,"''")+"'"}ar lu=function(e){return null!=e&&1===e["PowerBI.SQExprEvaluationKind"]};ar Yr=),B=function(){function t(e,r){u.assertValue(e,"kind"),u.assertAnyValue(r,"annotations"),this._kind=e,this._annotations=r}return t.prototype.validate=t.prototype.accept=Object.defineProperty(t.prototype,"kind",{get:function(){return this._kind},enumerable:!1,configurable:!0}),t.prototype.getMetadata=function(e,r){u.assertValue(e,"federatedSchema");var n=pe(this,e);if(n)return n.column||n.columnAggr||n.groupingColumn||n.groupingColumnAggr||n.measure?this.getMetadataForProperty(n,e):n.hierarchyLevel||n.hierarchyLevelAggr?this.getMetadataForHierarchyLevel(n,e):n.columnHierarchyLevelVariation?this.getMetadataForVariation(n,e):n.columnSubquery||n.columnAggrSubquery?this.getMetadataForSubqueryColumn(n,e,r):n.columnTransformRef?this.getMetadataForColumnTransformRef():t.getMetadataForEntity(n,e)},t.prototype.isOrdinalEvaluation=function(){return!1},t.prototype.getAnnotations=function(){return this._annotations},t.prototype.getKeyColumns=t.prototype.hasGroupOnKeys=function(e){var r=this.getTargetColumnRef(e);if(r){var n=this.getPropertyKeys(e);return!(!n||n.length<1)&&(n.length>1||!H(Ie(r.source,n[0].name),this))}},t.prototype.getPropertyKeys=t.prototype.getOrderByColumns=t.prototype.getConceptualProperty=function(e,r){var n=pe(this,e);if(n){var i=uu(n);if(i&&1===_.size(i)){var a=su(n);if(a){var o=e.schema(i[0].schema);return o?o.findProperty(i[0].entity,a):void 0}if(r){var l,s=void 0;if(n.columnHierarchyLevelVariation)(s=n.columnHierarchyLevelVariation.level)&&(l=e.schema(s.schema).findHierarchy(s.entity,s.name));else if(s=n.hierarchyLevel||n.hierarchyLevelAggr){var c=mr(n);l=e.schema(c.schema).findHierarchy(c.entity,s.name)}if(l){var f=l.levels.withName(s.level);if(f)return f.column}}}}},t.prototype.getTargetEntityForVariation=t.prototype.getTargetEntity=function(){return Ub.getEntityExpr(this)},t.prototype.getTargetSchemaName=t.prototype.getTargetColumnRef=function(e){return u.assertValue(e,"schema"),Mu.getColumnRefSQExpr(e,this)},t.prototype.getMetadataForVariation=function(e,r){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema");var n=e.columnHierarchyLevelVariation,i=mr(e),a=r.schema(i.schema).findProperty(i.entity,n.source.name);if(a&&a.column&&a.column.variations)for(var o=0,s=a.column.variations;o<s.length;o++){var l=s[o];if(l.defaultHierarchy&&l.defaultHierarchy.levels)for(var c=0,f=l.defaultHierarchy.levels;c<f.length;c++){var d=f[c];if(d.name===n.level.level){var p=d.column;return{kind:1===p.kind?1:0,type:p.type,format:p.format,idOnEntityKey:!!p.column&&p.column.idOnEntityKey,defaultAggregate:p.column?p.column.defaultAggregate:null}}}}},t.prototype.getMetadataForHierarchyLevel=function(e,r){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema");var n=this.getConceptualProperty(r,!0);if(n)return this.getPropertyMetadata(e,n)},t.prototype.getPropertyMetadata=t.prototype.getMetadataForProperty=function(e,r){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema");var n=this.getConceptualProperty(r);if(n)return this.getPropertyMetadata(e,n)},t.prototype.getFormatAndTypeForAggregate=function(e,r,n){var i=r,a=n;switch(e){case 2:case 5:a=L.fromExtendedType(260),i=void 0;break;case 1:case 7:case 8:a.integer&&(a=L.fromExtendedType(259),i=function(t){return!t||ci(t)||fi(t).hasDots?t:qs(t,2,!0)}(i))}return{format:i,type:a}},t.prototype.getMetadataForSubqueryColumn=function(e,r,n){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema"),u.assert("context sources should be available for evaluating subquery source");var i=ht.getSubqueryExpression(this,n);u.assertValue(i,"could not find original select expr of subquery from context");var a=i.getMetadata(r,n);if(a){if(a.kind=0,e.columnAggrSubquery){var o=this.getFormatAndTypeForAggregate(e.columnAggrSubquery.aggregate,a.format,a.type);a.type=o.type,a.format=o.format,a.aggregate=e.columnAggrSubquery.aggregate}else e.columnSubquery?a.aggregate=void 0:u.assertFail("invalid field expression for subquery column");return a}},t.prototype.getMetadataForColumnTransformRef=function(){return{idOnEntityKey:!1,kind:0,type:L.fromVariant([L.fromPrimitiveTypeAndCategory(5),L.fromPrimitiveTypeAndCategory(7),L.fromPrimitiveTypeAndCategory(2),L.fromPrimitiveTypeAndCategory(3),L.fromPrimitiveTypeAndCategory(4),L.fromPrimitiveTypeAndCategory(1)])}},t.getMetadataForEntity=function(e,r){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema");var n=mr(e);if(r.schema(n.schema).entities.withName(n.entity)&&e.entityAggr)switch(e.entityAggr.aggregate){case 2:case 5:return{kind:1,type:L.fromExtendedType(260),format:void 0,idOnEntityKey:!1,aggregate:e.entityAggr.aggregate}}},t}();Qt(B.prototype);var Pa=function(t){function e(r,n,i,a){var o=this;return u.assertValue(n,"entity"),(o=t.call(this,0,a)||this).schema=r,o.entity=n,i&&(o.variable=i),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitEntity(this,n)},e.prototype.as=e}(B),Ud=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"name"),(o=t.call(this,47,a)||this).name=r,o.language=n,o.expression=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitNativeVisualCalc(this,n)},e.prototype.getMetadata=function(r){return u.assertValue(r,"federatedSchema"),{kind:1,type:L.fromPrimitiveTypeAndCategory(3)}},e}(B),cu=function(t){function e(r,n){var i=this;return u.assertValue(r,"source"),u.assertAnyValue(n,"annotations"),i=t.call(this,1,n)||this,_.isString(r)?i.variable=r:i.query=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitSubqueryRef(this,n)},e.prototype.as=function(r,n){return new e(r,n)},e}(B),Hd=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"source"),(a=t.call(this,39,i)||this).queryName=r,n&&(a.variable=n),a}return T(e,t),e.prototype.accept=function(r,n){return r.visitNamedQueryRef(this,n)},e.prototype.as=e}(B),Gd=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),u.assertValue(i,"operator"),(o=t.call(this,23,a)||this).left=r,o.right=n,o.operator=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitArithmetic(this,n)},e.prototype.getMetadata=function(r){var n=this,i=this.left.getMetadata(r);if(Ur(this.right))return i?(u.assert("unexpected usage of scoped eval with arithmetic"),i.format="#,##0.00%",i.type=L.fromExtendedType(259),i):void 0;var l,a=this.right.getMetadata(r),o=null==i?void 0:i.type,s=null==a?void 0:a.type;l=o&&s?this.getArithmeticResultType(o,s):null!=o?o:s,u.assertValue(l,"SQExpr - cannot get proper type for arithmetic expression");var d,c=null==i?void 0:i.format;return(0===this.operator||1===this.operator)&&(d=c===(null==a?void 0:a.format)?c:void 0),{format:d,type:l,kind:1}},e.prototype.getArithmeticResultType=function(r,n){return 0!==this.operator&&1!==this.operator&&2!==this.operator&&3!==this.operator&&u.assertNever(this.operator),2===r.primitiveType?L.fromPrimitiveTypeAndCategory(3===this.operator&&2===n.primitiveType?3:2):3===r.primitiveType?L.fromPrimitiveTypeAndCategory(3!==this.operator&&2===n.primitiveType?2:3):4===r.primitiveType?3===this.operator&&4===n.primitiveType?L.fromPrimitiveTypeAndCategory(3):n:void u.assertFail("unsupported arithmetic expression type")},e}(B),Qd=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"size"),(o=t.call(this,35,a)||this).arg=r,o.size=n,null!=i&&(o.timeUnit=i),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitFloor(this,n)},e}(B),Ra=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"expression"),u.assertValue(n,"scope"),(a=t.call(this,26,i)||this).expression=r,a.scope=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitScopedEval(this,n)},e.prototype.getMetadata=function(r){return this.expression.getMetadata(r)},e.prototype.hasGlobalScope=function(){return u.assertValue(this.scope,"scope"),0===this.scope.length},e.prototype.hasInnerMostScope=function(){return u.assertValue(this.scope,"scope"),1===this.scope.length&&If(this.scope[0])},e.createGlobalAggregateOfScopedExpr=e.prototype.decomposeGlobalAggregateOfScopedExpr=function(){if(this.hasGlobalScope()){var r=this.expression;if($e(r)){var n=r.arg;if(Ur(n)&&n.hasInnerMostScope())return{source:n.expression,func:r.func}}}},e}(B),jd=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"expression"),u.assertValue(n,"filters"),(a=t.call(this,41,i)||this).expression=r,a.filters=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitFilteredEval(this,n)},e.prototype.getMetadata=function(r){return this.expression.getMetadata(r)},e}(B),Vb=function(t){function e(r,n){var i=this;return u.assertValue(r,"expressionName"),(i=t.call(this,27,n)||this).expressionName=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitWithRef(this,n)},e}(B),Wd=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"kind"),u.assertValue(n,"source"),u.assertValue(i,"ref"),(o=t.call(this,r,a)||this).source=n,o.ref=i,o}return T(e,t),e}(B),Sr=function(t){eturn T(e,t),e.prototype.accept=function(r,n){return r.visitColumnRef(this,n)},e}(Wd),Kd=function(t){eturn T(e,t),e.prototype.accept=function(r,n){return r.visitMeasureRef(this,n)},e}(Wd),Jd=function(t){function e(r,n,i,a,o,s,l){var c=t.call(this,43,l)||this;return u.assertValue(r,"language"),u.assertValue(n,"expression"),u.assertValue(i,"dataType"),u.assertAnyValue(a,"proposedName"),u.assertAnyValue(o,"expressionContentCache"),u.assertAnyValue(s,"format"),c.language=r,c.expression=n,c.dataType=i,c.proposedName=a,c.expressionContentCache=o,c.format=s,c}return T(e,t),e.prototype.getMetadata=function(r){return u.assertValue(r,"federatedSchema"),{kind:1,type:L.fromPrimitiveTypeAndCategory(this.dataType),format:this.format}},e.prototype.accept=function(r,n){return r.visitNativeMeasure(this,n)},e}(B),Yd=function(t){function e(r,n,i,a,o,s,l,c){var f=t.call(this,44,c)||this;return u.assertValue(r,"language"),u.assertValue(n,"expression"),u.assertValue(i,"dataType"),u.assertValue(a,"source"),u.assertAnyValue(o,"proposedName"),u.assertAnyValue(s,"expressionContentCache"),u.assertAnyValue(l,"format"),f.language=r,f.expression=n,f.dataType=i,f.source=a,f.proposedName=o,f.expressionContentCache=s,f.format=l,f}return T(e,t),e.prototype.getMetadata=function(r){return u.assertValue(r,"federatedSchema"),{kind:0,type:L.fromPrimitiveTypeAndCategory(this.dataType),format:this.format}},e.prototype.accept=function(r,n){return r.visitNativeColumn(this,n)},e}(B),$r=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"func"),(o=t.call(this,4,a)||this).arg=r,o.func=n,o.includeAllTypes=i,u.assert("includeAllTypes has a value and the aggregate is not min/max - not a valid combination."),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitAggr(this,n)},e.prototype.getMetadata=function(r,n){if(u.assertValue(r,"federatedSchema"),Vs(this.arg)){var i=this.getFormatAndTypeForAggregate(this.func,this.arg.format,L.fromPrimitiveTypeAndCategory(this.arg.dataType));return{kind:1,type:i.type,format:i.format}}return t.prototype.getMetadata.call(this,r,n)},e}(B),$d=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"k"),u.assert("0 <= k && k <= 1"),u.assertValue(i,"exclusive"),(o=t.call(this,28,a)||this).arg=r,o.k=n,o.exclusive=i,o}return T(e,t),e.prototype.getMetadata=function(r){u.assertValue(r,"federatedSchema");var n=this.arg.getMetadata(r);if(n)return{kind:1,type:n.type}},e.prototype.accept=function(r,n){return r.visitPercentile(this,n)},e}(B),Xd=function(t){function e(r,n,i,a){var o=t.call(this,29,a)||this;return o.min=r,o.max=n,o.percent=i,u.assert("Invalid percent value. Valid values are 0 to 1"),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitRangePercent(this,n)},e.overRangeOf=e.prototype.decomposeOverRangePattern=function(){var r=this.min,n=this.max;if(Ur(r)&&Ur(n)){var i=r.decomposeGlobalAggregateOfScopedExpr(),a=n.decomposeGlobalAggregateOfScopedExpr();if(i&&a&&3===i.func&&4===a.func&&H(i.source,a.source))return{sourceExpr:i.source,percent:this.percent}}},e}(B),Zd=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"name"),u.assertValue(i,"property"),(o=t.call(this,5,a)||this).arg=r,o.name=n,o.property=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitPropertyVariationSource(this,n)},e}(B),ep=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"name"),u.assertValue(i,"groupedExprs"),u.assert("groupedExprs.length > 0"),(o=t.call(this,n,r,34,a)||this).groupedExprs=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitGroupRef(this,n)},e}(Sr),tp=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"arg"),u.assertValue(n,"hierarchy"),(a=t.call(this,6,i)||this).arg=r,a.hierarchy=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitHierarchy(this,n)},e}(B),rp=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"arg"),u.assertValue(n,"level"),(a=t.call(this,7,i)||this).arg=r,a.level=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitHierarchyLevel(this,n)},e}(B),wb=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"expressionName"),(a=t.call(this,30,i)||this).expressionName=r,a.attributeKind=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitSelectRef(this,n)},e}(B),Dn=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),(a=t.call(this,8,i)||this).left=r,a.right=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitAnd(this,n)},e}(B),np=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"lower"),u.assertValue(i,"upper"),(o=t.call(this,9,a)||this).arg=r,o.lower=n,o.upper=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitBetween(this,n)},e}(B),Xr=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"args"),u.assert("values or table"),(o=t.call(this,10,a)||this).args=r,n&&(o.values=n),i&&(o.table=i),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitIn(this,n)},e}(B),Na=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),(a=t.call(this,11,i)||this).left=r,a.right=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitOr(this,n)},e}(B),fu=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"kind"),u.assertValue(n,"left"),u.assertValue(i,"right"),(o=t.call(this,13,a)||this).comparison=r,o.left=n,o.right=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitCompare(this,n)},e.prototype.isOrdinalEvaluation=function(){return lu(this.getAnnotations())},e}(B),ip=function(t){function e(r,n,i){var a=this;return u.assertNonEmpty(r,"cases"),u.assertAnyValue(n,"defaultValue"),(a=t.call(this,42,i)||this).cases=r,a.defaultValue=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitConditional(this,n)},e}(B),ka=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),(a=t.call(this,12,i)||this).left=r,a.right=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitContains(this,n)},e.prototype.isOrdinalEvaluation=function(){return lu(this.getAnnotations())},e}(B),ap=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),(a=t.call(this,14,i)||this).left=r,a.right=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitStartsWith(this,n)},e.prototype.isOrdinalEvaluation=e}(B),op=function(t){function e(r,n){var i=this;return u.assertValue(r,"arg"),u.assert("Exists only supports Entity argument"),(i=t.call(this,15,n)||this).arg=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitExists(this,n)},e}(B),du=function(t){function e(r,n){var i=this;return u.assertValue(r,"arg"),(i=t.call(this,16,n)||this).arg=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitNot(this,n)},e}(B),Te=function(t){function e(r,n,i,a,o){var s=this;return u.assertValue(r,"type"),(s=t.call(this,17,o)||this).type=r,s.value=n,s.typeEncodedValue=i,a&&(s.rawValue=a),s}return T(e,t),Object.defineProperty(e.prototype,"valueEncoded",{get:function(){return void 0===this.typeEncodedValue&&(this.typeEncodedValue=function(t,e){if(null===t)return"null";switch(e.primitiveType){case 4:return u.assert(function(){return _.isString(t)||_.isNumber(t)},"Expected either a string or number value to encode for type ".concat(e)),t+"L";case 2:return u.assert(function(){return _.isString(t)||_.isNumber(t)},"Expected either a string or number value to encode for type ".concat(e)),t+"M";case 3:return u.assert("Expected either a string or number value to encode for type ".concat(e)),t+"D";case 7:case 6:var n=void 0;return t instanceof Date?(n=Ns(t)?new Date(t.epochTimeStamp).toISOString():new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString(),_.endsWith(n,"Z")&&(n=n.substr(0,n.length-1)),n=n.replace(vb,"")):(u.assert(function(){return _.isString(t)},"Expected a string or a Date value for type ".concat(e)),n=t),"datetime'".concat(n,"'");case 1:return u.assert(function(){return _.isString(t)},"Expected a string value to encode for type ".concat(e)),Bd(t);case 5:return u.assert(function(){return _.isBoolean(t)},"Expected boolean values for type ".concat(e)),Od(t);case 13:return u.assert("Expected string values to encode for type ".concat(e)),t;default:u.assertFail("unsupported dsrValue for type ".concat(e))}}(this.rawValue||this.value,this.type)),this.typeEncodedValue},enumerable:!1,configurable:!0}),e.prototype.accept=function(r,n){return r.visitConstant(this,n)},e.prototype.getMetadata=e.getNumericValue=function(r){if(wf(r)&&_.isNumber(r.value))return r.value;u.assertFail("SQConstantExpr.getNumericValue - Unexpected SQExpr kind/value")},e.getTextValue=function(r){if(bs(r)&&_.isString(r.value))return r.value;u.assertFail("SQConstantExpr.getTextValue - Unexpected SQExpr kind/value")},e.getBooleanValue=function(r){if(xf(r)&&_.isBoolean(r.value))return r.value;u.assertFail("SQConstantExpr.getBooleanValue - Unexpected SQExpr kind/value")},e.getDateValue=function(r){if(yn(r)&&_.isDate(r.value))return r.value;u.assertFail("SQConstantExpr.getDateValue - Unexpected SQExpr kind/value")},e}(B);Qt(Te.prototype);var sp=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"unit"),u.assertValue(n,"arg"),(a=t.call(this,18,i)||this).unit=r,a.arg=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitDateSpan(this,n)},e}(B),up=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"unit"),u.assertValue(n,"amount"),u.assertValue(i,"arg"),(o=t.call(this,19,a)||this).unit=r,o.arg=i,o.amount=n,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitDateAdd(this,n)},e.prototype.getMetadata=e}(B),xb=function(t){function e(r){return t.call(this,20,r)||this}return T(e,t),e.prototype.accept=function(r,n){return r.visitNow(this,n)},e.prototype.getMetadata=e}(B),Mb=function(t){eturn T(e,t),e.prototype.accept=function(r,n){return r.visitDefaultValue(this,n)},e}(B),Db=function(t){function e(r,n){var i=this;return u.assertAnyValue(r,"defaultValueOverridesAncestors"),(i=t.call(this,21,n)||this).defaultValueOverridesAncestors=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitAnyValue(this,n)},e}(B),lp=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"input"),u.assertValue(n,"fillRule"),(a=t.call(this,24,i)||this).input=r,a.rule=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitFillRule(this,n)},e}(B),Ab=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"SQThemeDataColorExpr - colorId"),u.assertValue(n,"SQThemeDataColorExpr - percent"),u.assertValue(-1<=n&&n<=1,"percent"),(a=t.call(this,33,i)||this).colorId=r,a.percent=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitThemeDataColor(this,n)},e}(B),Tb=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"packageName"),u.assertValue(i,"itemName"),(o=t.call(this,25,a)||this).packageName=r,o.packageType=n,o.itemName=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitResourcePackageItem(this,n)},e}(B),Ib=function(t){function e(r,n){var i=this;return u.assertValue(r,"source"),(i=t.call(this,31,n)||this).source=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitTransformTableRef(this,n)},e}(B),_b=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"role"),(a=t.call(this,32,i)||this).role=r,n&&(a.transform=n),a}return T(e,t),e.prototype.accept=e.prototype.getMetadata=function(r){},e}(B),Fb=function(t){function e(r,n){var i=this;return u.assertValue(r,"role"),(i=t.call(this,36,n)||this).role=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitRoleRef(this,n)},e}(B),Pb=function(t){function e(r,n){var i=this;return u.assert(function(){return!_.isEmpty(r)},"name"),u.assertAnyValue(n,"annotations"),(i=t.call(this,45,n)||this).name=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitSummaryValueRef(this,n)},e}(B),cp=function(t){function e(r){return t.call(this,37,r)||this}return T(e,t),e.prototype.accept=function(r,n){return r.visitAllRolesRef(this,n)},e}(B),fp=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"source"),(a=t.call(this,38,i)||this).source=r,a.count=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitDiscretize(this,n)},e}(B),dp=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"source"),u.assertValue(n,"member"),(a=t.call(this,40,i)||this).source=r,a.member=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitMember(this,n)},e}(B),pp=function(t){function e(r,n,i,a,o,s){var l=t.call(this,46,s)||this;return u.assertValue(r,"measure"),u.assertValue(n,"grouping"),u.assertAnyValue(i,"scalarKey"),u.assert("exactly 1 grouping is allowed"),l.measure=r,l.grouping=n,l.scalarKey=i,l.pointsPerSparkline=a,l.includeMinGroupingInterval=o,l}return T(e,t),e.prototype.getMetadata=function(r){var i,n=this;return u.assertValue(r,"federatedSchema"),u.assert(function(){return 1===_.size(n.grouping)},"exactly 1 grouping is allowed"),{kind:1,type:L.fromDescriptor({misc:{sparkline:{groupingType:null===(i=this.grouping[0].getMetadata(r))||void 0===i?void 0:i.type}}})}},e.prototype.accept=function(r,n){return r.visitSparklineData(this,n)},e}(B);function Ge(t,e,r,n){return new Pa(t,e,r,n)}unction hp(t,e,r){return new Hd(t,e,r)}function Ie(t,e,r){return new Sr(t,e,null,r)}function pu(t,e,r){return new Kd(t,e,r)}nction Yt(t,e,r,n){return new $r(t,e,r,n)}function gi(t,e,r){return new wb(t,e,r)}function hu(t,e,r,n){return new $d(t,e,r,n)}function yp(t,e,r,n){return new Xd(t,e,r,n)}function yi(t,e,r,n){return new Gd(t,e,r,n)}function mp(t,e,r,n){return new Qd(t,e,r,n)}function La(t,e,r){return new Ra(t,e,r)}function vu(t,e,r){return new jd(t,e,r)}function Sp(t,e){return new Vb(t,e)}function Ba(t,e,r,n){return new ep(t,e,r,n)}function mi(t,e,r){return new tp(t,e,r)}function za(t,e,r,n){return new Zd(t,e,r,n)}function Oa(t,e,r){return new rp(t,e,r)}function gu(t,e){return new Ib(t,e)}function yu(t,e,r){return new _b(t,e,r)}function mu(t,e){return new Fb(t,e)}function Ep(t,e){return new Pb(t,e)}function Cp(t){return new cp(t)}unction Er(t,e,r,n){return new np(t,e,r,n)}unction Su(t,e,r){return new Xr(t,null,e,r)}function Si(t,e,r){if(!t)return e;if(!e)return t;if(dt(t)&&dt(e)){var n=function(t,e,r){if(t.args&&e.args&&t.values&&e.values){var n=t.args.length;if(n===e.args.length){for(var a=0;a<n;++a)if(!H(t.args[a],e.args[a]))return;var o=t.values.concat(e.values);return en(t.args,o,r)}}}(t,e,r);if(n)return n}return new Na(t,e,r)}function An(t,e,r,n){return new fu(t,e,r,n)}function Eu(t,e,r){return new ip(t,e,r)}function bp(t,e,r){return new ka(t,e,r)}function Vp(t,e){return new op(t,e)}unction qa(t,e){return new du(t,e)}function wp(t,e,r){return new ap(t,e,r)}var Nb=new Te(L.fromExtendedType(0),null,"null");function Rt(){return Nb}var kb=new Te(L.fromExtendedType(1),"");function Lb(){return kb}function Cu(t){return new xb(t)}function Ua(t){return new Mb(t)}function Ei(t,e){return new Db(t,e)}function $t(t,e){return new Te(L.fromExtendedType(5),t,Od(t),void 0,e)}function vt(t,e,r,n){return new up(t,e,r,n)}function Xt(t,e,r){return new Te(L.fromExtendedType(519),t,e,void 0,r)}function yt(t,e,r){return new sp(t,e,r)}function Ha(t,e,r){return new Te(L.fromExtendedType(258),t,e,void 0,r)}function tn(t,e,r){return new Te(L.fromExtendedType(259),t,e,void 0,r)}function In(t,e,r){return new Te(L.fromExtendedType(260),t,e,void 0,r)}function Ee(t,e,r){return u.assert(function(){return!e||e===Bd(t)},"Incorrect encoded value specified."),new Te(L.fromExtendedType(1),t,e,void 0,r)}function rn(t,e){return null==t?Rt():_.isBoolean(t)?$t(t):_.isString(t)?Ee(t):_.isNumber(t)?e.integer&&Ef(t)?In(t):tn(t):t instanceof Date?Xt(t):void 0}function Ci(t,e,r,n){return new Te(L.fromExtendedType(t),e,void 0,r,n)}unction Bb(t){return Gb.rewrite(t)}function zb(t,e,r){if(ai(t))return Qb.rewrite(t,e,r)}function xp(t,e,r){return u.assertValue(t,"expr"),u.assertValue(e,"rule"),new lp(t,e,r)}function Vu(t,e,r){return u.assertValue(t,"themeDataColor - colorId"),u.assertValue(e,"themeDataColor - percent"),new Ab(t,e,r)}unction Dp(t,e,r){return new fp(t,e,r)}unction Ob(t,e,r){return u.assertValue(null==t||function(t){return/^#([0-9a-f]{6}|[0-9a-f]{3})$/i.test(t)}(t),"SQExprBuilder.color - hexCode has to either not exist or be a valid hex code"),u.assertValue(e,"SQExprBuilder.color - colorName has to exist"),Ee(t||e,void 0,r)}unction xu(t){if(u.assertValue(t,"expr"),Re(t)&&t.type.text)return t.value}var Tp=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"schema"),u.assertValue(n,"aggrUtils"),(o=t.call(this)||this).schema=r,o.aggrUtils=n,o.context=a,i&&(o.errors=i),o}return T(e,t),e.prototype.visitIn=function(r){var n=t.prototype.visitIn.call(this,r),i=n.args,a=n.values;if(a){u.assert(function(){return!n.table},"values and table cannot both be specified for the In operator");for(var o=function(h){u.assert(function(){return h.length===i.length},"args and value tuple are not the same length");for(var v=0,g=h.length;v<g;++v)s.validateCompatibleType(i[v],h[v])},s=this,l=0,c=a;l<c.length;l++)o(c[l])}else{var d=n.table;u.assert(function(){return!!d},"either values or table must be non-null for an In operator"),this.validateIsTableRef(d)}return n},e.prototype.visitCompare=e.prototype.visitColumnRef=function(r){if(ws(r.source))return ht.getSubqueryExpression(r,this.context)||this.register(18),r;var i=pe(r);return i&&this.validateColumnExpr(i),r},e.prototype.visitMeasureRef=function(r){var n=pe(r);if(n){var i=mr(n),a=this.validateEntity(i.schema,i.entity);if(a){var o=a.properties.withName(n.measure.name);(!o||1!==o.kind||!this.isQueryable(n))&&this.register(5)}}return r},e.prototype.visitAggr=e.prototype.visitGroupRef=function(r){var n=pe(r);if(n){var i=mr(n),a=this.validateEntity(i.schema,i.entity);if(a){var o=a.properties.withName(n.groupingColumn.name);(!o||0!==o.kind||!this.validateExprSequence(r.groupedExprs)||!o.column.groupingMetadata||!this.isQueryable(n))&&this.register(4)}}return r},e.prototype.visitHierarchy=function(r){var n=pe(r);if(n){var i=n.hierarchy;i?this.validateHierarchy(i.schema,i.entity,i.name):this.register(6)}return r},e.prototype.visitHierarchyLevel=function(r){var n=pe(r);if(n){var i=n.hierarchyLevel,a=n.columnHierarchyLevelVariation;i?this.validateHierarchyLevel(i.schema,i.entity,i.name,i.level):a?this.validateHierarchyLevelVariation(a):this.register(7)}return r},e.prototype.visitPercentile=e.prototype.visitRangePercent=e.prototype.visitDiscretize=e.prototype.visitEntity=function(r){return this.validateEntity(r.schema,r.entity),r},e.prototype.visitSubqueryRef=function(r){return r},e.prototype.visitNamedQueryRef=function(r){return r},e.prototype.visitContains=function(r){return this.validateStartOrContainsArgs(r.left,r.right),r},e.prototype.visitStartsWith=e.prototype.visitArithmetic=e.prototype.visitScopedEval=function(r){if(r.hasGlobalScope()||r.hasInnerMostScope())return r;for(var n=0,i=r.scope;n<i.length;n++){var a=i[n];Df(a)||Pt(a)||this.register(14)}return r},e.prototype.visitFilteredEval=e.prototype.visitWithRef=function(r){return r},e.prototype.visitTransformTableRef=function(r){return r},e.prototype.visitTransformOutputRoleRef=function(r){return r},e.prototype.visitRoleRef=function(r){return r},e.prototype.visitSummaryValueRef=function(r){return r},e.prototype.visitAllRolesRef=function(r){return r},e.prototype.visitSparklineData=function(r){if(Aa(r.measure)){var n=r.measure.getMetadata(this.schema),i=null==n?void 0:n.type;(null==i||!i.numeric)&&(null==i||!i.integer)&&this.register(5)}else this.register(5);u.assert(function(){return 1===_.size(r.grouping)},"Only support 1 grouping for now"),_.some(r.grouping,function(l){return Aa(l)})&&this.register(3),r.measure.accept(this);for(var a=0,o=r.grouping;a<o.length;a++)o[a].accept(this);return r.scalarKey&&r.scalarKey.accept(this),r},e.prototype.visitNativeVisualCalc=function(r){return r},e.prototype.validateExprSequence=e.prototype.validateStartOrContainsArgs=function(r,n){r.accept(this),n.accept(this),_.isEmpty(this.errors)&&(Re(n)&&n.type.text?this.validateCompatibleType(r,n,!0):this.register(10))},e.prototype.validateArithmeticTypes=function(r,n,i){ht.supportsArithmetic(r,n,this.schema)||this.register(9),ht.supportsArithmetic(r,i,this.schema)||this.register(10)},e.prototype.validateCompatibleType=e.prototype.validateEntity=e.prototype.validateIsTableRef=e.prototype.validateHierarchy=e.prototype.validateHierarchyLevel=e.prototype.validateHierarchyLevelVariation=e.prototype.validateColumnExpr=e.prototype.register=e.prototype.isQueryable=function(r){var n=mr(r);if(r.hierarchyLevel||r.hierarchyLevelAggr){var i=function(t,e){var r=e);if(r)return qd(t,r.schema,r.entity,r.name,r.level)}(this.schema,r);return i&&1!==i.column.queryable}return 1!==this.schema.schema(n.schema).findProperty(n.entity,su(r)).queryable},e}(eu),Mu=function(t){function e(r){var n=t.call(this)||this;return n.schema=r,n}return T(e,t),e.prototype.visitColumnRef=function(r){return r},e.prototype.visitGroupRef=function(r){return r},e.prototype.visitHierarchyLevel=function(r){var n=r.level,i=r.arg,a=i.accept(this);if(i&&ni(i.arg)){var s=a.getTargetEntityForVariation(this.schema,i.arg.name);if(a&&s){var l=a.source.schema,c=Ge(l,s),f=this.schema.schema(l).findHierarchy(s,i.hierarchy);if(f)for(var d=0,p=f.levels;d<p.length;d++){var h=p[d];if(h.name===n)return new Sr(c,h.column.name)}}}else{var v=i.arg,g=qd(this.schema,v.schema,v.entity,i.hierarchy,r.level);if(g)return new Sr(i.arg,g.column.name)}},e.prototype.visitHierarchy=function(r){return r.arg.accept(this)},e.prototype.visitPropertyVariationSource=function(r){return new Sr(r.arg,r.property)},e.prototype.visitAggr=e.prototype.visitDefault=function(r){},e.getColumnRefSQExpr=e}(Ke),Ub=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitEntity=function(r){var n=this.result;this.result=void 0===n||H(n,r)?r:null},e.prototype.visitFilteredEval=function(r){r.expression.accept(this)},e.getEntityExpr=e}(Kt),Hb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitNativeVisualCalc=function(r){},e.prototype.visitDefault=function(r){return r.getTargetEntity().schema},e.getSchemaName=function(r){return r.accept(e.instance)},e.instance=new e,e}(Ke),Gb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitEntity=e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.instance=new e,e}(eu),Qb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r,n,i){return u.assertValue(r,"expr"),u.assert(function(){return ai(r)},"should be a native visual calc"),r.accept(e.instance,{expression:n,name:i})},e.prototype.visitNativeVisualCalc=e.instance=new e,e}(Yr);function bi(t){var e=new _n;return t.accept(e),e.malformed?null:Rr(e.keys)}function Ga(t){var e=new _n;return t.accept(e),e.malformed?null:Rr(e.values)}function Ip(t){var e=new _n;return t.accept(e),e.malformed?null:Rr(e.pairs)}function jb(t){if(dt(t))return t;var e=new _n;if(t.accept(e),!e.malformed){var r=Rr(e.keys),n=Rr(e.values);if(r&&n)return en(r,[n])}}function Wb(t,e){u.assertValue(t,"expr"),u.assertNonEmpty(e,"subsetFieldExprs");var r=new Yb(e);return t.accept(r),r.getResult()}ar _n=function(t){eturn T(e,t),e.prototype.visitAnd=function(r){r.left.accept(this),r.right.accept(this)},e.prototype.visitCompare=function(r){0===r.comparison?(u.assert(function(){return r.left instanceof B&&r.right instanceof Te},"invalid compare expr operands"),this.pairs.push(r),r.left.accept(this),r.right.accept(this)):this.visitDefault(r)},e.prototype.visitIn=e.prototype.visitSelectRef=function(r){this.keys.push(r)},e.prototype.visitColumnRef=function(r){this.keys.push(r)},e.prototype.visitGroupRef=function(r){this.keys.push(r)},e.prototype.visitHierarchyLevel=function(r){this.keys.push(r)},e.prototype.visitConstant=function(r){this.values.push(r)},e.prototype.visitArithmetic=function(r){this.keys.push(r)},e.prototype.visitDefault=function(r){this.malformed=!0},e}(Ke),Yb=function(t){function e(r){var n=t.call(this)||this;return u.assertNonEmpty(r,"identityFieldExprs"),n.identityFieldExprs=r,n.identityComparisonExprs=[],n.identityComparisonExprCount=0,n}return T(e,t),e.prototype.getResult=function(){var r=this;if(u.assert("invariant: this.identityComparisonExprCount should equal to the number of defined elements in this.identityComparisonExprs array"),!this.malformed&&this.identityComparisonExprCount===this.identityFieldExprs.length){for(var n,i=0,a=this.identityComparisonExprs;i<a.length;i++){var o=a[i];n=n?it(n,o):o}return n}},e.prototype.visitAnd=function(r){r.left.accept(this),r.right.accept(this)},e.prototype.visitCompare=function(r){if(0===r.comparison){var n=_.findIndex(this.identityFieldExprs,;n>=0&&!this.identityComparisonExprs[n]&&(this.identityComparisonExprs[n]=r,this.identityComparisonExprCount++)}else this.visitDefault(r)},e.prototype.visitDefault=function(r){this.malformed=!0},e}(Ke),$b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitSelectRef=function(r){this.containsSelectRef=!0},e}(Kt),Xb=function(t){eturn T(e,t),e.prototype.getValues=function(){return _.uniq(this.orderedValues)},e.prototype.visitAnd=function(r){r.left.accept(this),r.right.accept(this)},e.prototype.visitOr=function(r){r.left.accept(this),r.right.accept(this)},e.prototype.visitCompare=function(r){0===r.comparison&&(r.right instanceof Sr&&H(r.right,this.targetExpr)&&r.left instanceof Te&&this.orderedValues.push(r.left.value),r.left instanceof Sr&&H(r.left,this.targetExpr)&&r.right instanceof Te&&this.orderedValues.push(r.right.value))},e.prototype.visitIn=function(r){var n=-1;if(!r.table){for(var i=0;i<r.args.length;i++)if(H(r.args[i],this.targetExpr)){n=i;break}if(-1!==n)for(var a=0,o=r.values;a<o.length;a++){var l=o[a][n];l instanceof Te&&this.orderedValues.push(l.value)}}},e}(Ke);r Zb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitColumnRef=function(r){return{col:{s:r.source.accept(this),r:r.ref}}},e.prototype.visitMeasureRef=function(r){return{measure:{s:r.source.accept(this),r:r.ref}}},e.prototype.visitNativeMeasure=e.prototype.visitNativeColumn=e.prototype.visitAggr=e.prototype.visitEntity=function(r){return u.assertValue(r,"expr"),u.assertValue(r.entity,"expr.entity"),{e:r.entity}},e.prototype.visitHierarchyLevel=function(r){return{h:r.arg.accept(this),l:r.level}},e.prototype.visitHierarchy=e.prototype.visitPropertyVariationSource=e.prototype.visitAnd=function(r){return u.assertValue(r,"expr"),{and:{l:r.left.accept(this),r:r.right.accept(this)}}},e.prototype.visitCompare=function(r){return u.assertValue(r,"expr"),{comp:{k:r.comparison,l:r.left.accept(this),r:r.right.accept(this)}}},e.prototype.visitConstant=function(r){return u.assertValue(r,"expr"),{const:{t:r.type.primitiveType,v:eV(r.value)}}},e.prototype.visitArithmetic=function(r){return u.assertValue(r,"expr"),{arithmetic:{o:r.operator,l:r.left.accept(this),r:r.right.accept(this)}}},e.prototype.visitScopedEval=function(r){return u.assertValue(r,"expr"),{scopedEval:{e:r.expression.accept(this),s:Cr(r.scope)}}},e.prototype.visitFilteredEval=function(r){var n=this;return u.assertValue(r,"expr"),{filteredEval:{e:r.expression.accept(this),f:"[".concat(_.map(r.filters,.join(", "),"]")}}},e.prototype.visitWithRef=function(r){return u.assertValue(r,"expr"),{withRef:{e:r.expressionName}}},e.prototype.visitTransformTableRef=function(r){return u.assertValue(r,"expr"),{transformTableRef:{source:r.source}}},e.prototype.visitTransformOutputRoleRef=function(r){u.assertValue(r,"expr");var n={transformOutputRoleRef:{role:r.role}};return r.transform&&(n.transformOutputRoleRef.transform=r.transform),n},e.prototype.visitFloor=function(r){u.assertValue(r,"expr");var n={floor:{a:r.arg.accept(this),s:r.size}};return null!=r.timeUnit&&(n.floor.timeunit=r.timeUnit),n},e.prototype.visitRoleRef=function(r){return u.assertValue(r,"expr"),{roleRef:{role:r.role}}},e.prototype.visitSummaryValueRef=function(r){return u.assertValue(r,"expr"),{summaryValueRef:{name:r.name}}},e.prototype.visitAllRolesRef=function(r){return u.assertValue(r,"expr"),{allRolesRef:{}}},e.prototype.visitNot=function(r){return u.assertValue(r,"expr"),{not:r.arg.accept(this)}},e.prototype.visitIn=function(r){return u.assertValue(r,"expr"),{in:{c:Cr(r.args),v:_.map(r.values,function(n){return Cr(n)})}}},e.prototype.visitSelectRef=function(r){return u.assertValue(r,"expr"),{n:r.expressionName}},e.prototype.visitSparklineData=function(r){var n;return u.assertValue(r,"expr"),{sparklineData:{m:r.measure.accept(this),g:Cr(r.grouping),s:null===(n=r.scalarKey)||void 0===n?void 0:n.accept(this)}}},e.prototype.visitDefault=function(r){u.assertFail("Unexpected expression type found in DataViewScopeIdentity.")},e.instance=new e,e}(Ke);unction Vi(t,e,r){return(t=t||null)===(e=e||null)||!t==!e&&(u.assertValue(t,"x"),u.assertValue(e,"y"),H(t.expr,e.expr,r))}function mt(t){return new Fp(t)}var Fp=function(){function t(e){this.kind=1,u.assertValue(e,"expr"),this._expr=e,this._key=new Or(function(){return Du(e)})}return Object.defineProperty(t.prototype,"expr",{get:function(){return this._expr},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();Qt(Fp.prototype);var Pp=function(){function t(e){this.kind=2,u.assertValue(e,"scopeExprs"),this._exprs=e,this._key=new Or(function(){return Cr(e)})}return Object.defineProperty(t.prototype,"exprs",{get:function(){return this._exprs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();function aV(t,e){var r=bi(e.expr);return!!r&&ht.sequenceEqual(t.exprs,r)}function Rp(t){return new Np(t)}Qt(Pp.prototype);var Np=function(){function t(e){this.kind=3,u.assertValue(e,"exprs"),this._exprs=e,this._key=new Or(function(){return Cr(e)})}return Object.defineProperty(t.prototype,"exprs",{get:function(){return this._exprs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();function kp(t,e){switch(u.assertValue(t,"DataViewWildcard.matches - wildcard"),t.matchingOption){case 0:return!0;case 1:return!e;case 2:return e;default:u.assertFail("DataViewWildcard.matches - Unsupported matchingOption")}}t(Np.prototype);var Lp=function(){function t(e){var r=this;this.kind=4,u.assertValue(e,"matchingOption"),this._matchingOption=e,this._key=new Or(function(){return JSON.stringify(r._matchingOption)})}return Object.defineProperty(t.prototype,"matchingOption",{get:function(){return this._matchingOption},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();function Nt(t){return null!=t&&1===t.kind}function br(t){return null!=t&&3===t.kind}function Zt(t){return null!=t&&2===t.kind}function er(t){return null!=t&&0===t.kind}function Vr(t){return null!=t&&4===t.kind}nction uV(t){if(t&&t.dataMap){var e=[];for(var r in t.dataMap){var n=fr(t.dataMap[r]);e.push.apply(e,n||[])}return e}}function Tu(t,e){if(!_.isEmpty(t)){var r=Op(t);if(!_.isEmpty(r))return function(t,e){if(!_.isEmpty(t)){for(var r,n=0,i=t;n<i.length;n++){var a=i[n],o=jb(a);r=r?Si(r,o):o||a}return r&&e&&(r=qa(r)),function(t){var e=new $b;return t.accept(e),!!e.containsSelectRef}(r)?void u.assertFail("SelectRef based identities can not be translated into a filter without additional context."):Ue.fromSQExpr(r)}}(r,e)}}unction Op(t){if(!_.isEmpty(t)){for(var e=[],r=function(o,s){var l=t[o];u.assert(function(){return!!l},"There is an undefined selector in a list of selectors");var c=null==l?void 0:l.data,f=void 0;if(!_.isEmpty(c))for(var d=0,p=c.length;d<p;d++)f=it(f,(null==l?void 0:l.data[d]).expr);f&&e.push(f)},n=0,i=t.length;n<i;n++)r(n);return e}}unction St(t,e,r){return(t=t||null)===(e=e||null)||!(!t!=!e||(u.assertValue(t,"x"),u.assertValue(e,"y"),t.metadata!==e.metadata)||!qp(t.data,e.data)||t.highlightMatching!==e.highlightMatching||(null==r||!r.skipId)&&t.id!==e.id||(null==r||!r.skipOrder)&&t.order!==e.order)}ction Iu(t,e){return Nt(t)&&Nt(e)?Vi(t,e):br(t)&&br(e)||Zt(t)&&Zt(e)?function(t,e){return t===e||ht.sequenceEqual(t.exprs,e.exprs)}(t,e):er(t)&&er(e)?function(t,e){return t.key&&e.key&&t.key===e.key&&xe(t.roles,e.roles,function(r,n){return r===n})}(t,e):!(!Vr(t)||!Vr(e))&&function(t,e){return!t&&!e||!(!t||!e)&&(u.assertValue(t,"x"),u.assertValue(e,"y"),t===e||t.matchingOption===e.matchingOption)}(t,e)}unction _u(t,e){if(_.isEmpty(t.data))return["{}"];var r=[];if(e)r=_.map(t.data,function(s){return s.key});else for(var n=0,i=t.data;n<i.length;n++){var a=i[n];if(Nt(a)){var o=bi(a.expr);o=o||Ga(a.expr),_.forEach(o,}}return r}function Qa(t){u.assertValue(t,"selector");var e=t.data;return!!e&&_.some(e,}function ja(t){u.assertValue(t,"selector");var e=t.data;if(_.isEmpty(e))return!1;for(var r=0,n=e;r<n.length;r++)if(er(n[r]))return!0;return!1}function wr(t){if(t){var e=[];for(var r in t.dataMap)for(var i=0,a=fr(t.dataMap[r]);i<a.length;i++)e.push(a[i]);var s={};return e.length>0&&(s.data=e),t.metadata&&(s.metadata=_.head(t.metadata)),t.id&&(s.id=t.id),s}}function tr(t,e){if(t&&t.metadata){u.assertNonEmpty(e,"getSelectorTargetExpr - selectTransforms");var r=_.find(e,function(n){return n.queryName===t.metadata});if(r)return r.expr}}function dV(t){return u.assertAnyValue(t,"selector"),t&&t.data?{data:t.data}:t}function pV(t){var e={};return t.data&&(e.data=me([],t.data,!0)),t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),void 0!==t.highlightMatching&&(e.highlightMatching=t.highlightMatching),null!=t.order&&(e.order=t.order),e}t(Lp.prototype);var Wa={});function Pu(t,e,r,n){if(u.assertAnyValue(t,"object"),u.assertValue(e,"propertyName"),!t)return r;if(n){var i=t.$instances;if(!i)return r;var a=i[n];if(!a)return r;t=a}var o=t[e];return void 0===o?r:o}function rr(t,e,r,n){return u.assertAnyValue(t,"objects"),u.assertValue(e,"propertyId"),u.assert("Properties starting with $ are reserved."),t?Pu(t[e.objectName],e.propertyName,r,n):r}function Je(t,e,r,n){var i;for(var a in u.assertValue(t,"DataViewObjects.mergeObjects - destination"),u.assertValue(e,"DataViewObjects.mergeObjects - source"),e){var o=e[a];if(null!=o){var s=t[a];if(!s){null==r?t[a]=o:(t[a]={$instances:(i={},i[r]=o,i)},null!=n&&(t[a].$instances[r].$order=n));continue}Gp(s,o,r,n)}}}function Gp(t,e,r,n){if(u.assertValue(t,"DataViewObjects.mergeObject - destination"),u.assertValue(e,"DataViewObjects.mergeObject - source"),u.assert("DataViewObjects.mergeObject - source should not include $instances"),r){var i=t.$instances;null==i&&(i=t.$instances={});var a=i[r];a||(a=i[r]={}),Gp(a,e,null),null!=n&&(a.$order=n)}else for(var o in e)"$instances"!==o&&"$order"!==o&&null!=e[o]&&(t[o]=e[o])}var wi=function(){function t(){}return t.prototype._ensureIncludeZero=t.prototype._ensureNotEmpty=function(){if(this.min===this.max)if(this.min){var e=this.min,r=pr(Math.abs(e)),n=void 0;r>=0&&r<4?(n=.5,this.forcedSingleStop=e):(n=dr(r)/2,this.forcedSingleStop=null),this.min=e-n,this.max=e+n}else this.min=0,this.max=t.DEFAULT_MAX,this.hasFixedMin=!0,this.hasFixedMax=!0},t.prototype._ensureDirection=t.prototype.getSize=t.prototype.shrinkByStep=function(e,r){u.assertValue(e,"range"),u.assert(function(){return r>0},"step");var n=this.min/r,i=e.min/r,a=Math.floor(i-n);this.min+=a*r,n=this.max/r,i=e.max/r,a=Math.ceil(i-n),this.max+=a*r},t.calculate=function(e,r,n,i,a){u.assert("dataMin should be less or equal to dataMax."),u.assert("fixedMin should be less or equal to fixedMax.");var o=new t;return o.includeZero=!!a,o.hasDataRange=Pn(e)&&Pn(r),o.hasFixedMin=Pn(n),o.hasFixedMax=Pn(i),e=ei(e,t.MIN_SUPPORTED_DOUBLE,t.MAX_SUPPORTED_DOUBLE),r=ei(r,t.MIN_SUPPORTED_DOUBLE,t.MAX_SUPPORTED_DOUBLE),o.hasFixedMin&&o.hasFixedMax?(o.min=n,o.max=i):o.hasFixedMin?(o.min=n,o.max=r>n?r:n):o.hasFixedMax?(o.min=e<i?e:i,o.max=i):o.hasDataRange?(o.min=e,o.max=r):(o.min=0,o.max=0),o._ensureIncludeZero(),o._ensureNotEmpty(),o._ensureDirection(),0===o.min?o.hasFixedMin=!0:0===o.max&&(o.hasFixedMax=!0),o},t.calculateDataRange=t.calculateFixedRange=function(e,r,n){u.assertValue(e,"fixedMin"),u.assertValue(r,"fixedMax");var i=new t;return i.hasDataRange=!1,i.includeZero=n,i.min=e,i.max=r,i._ensureIncludeZero(),i._ensureNotEmpty(),i._ensureDirection(),i.hasFixedMin=!0,i.hasFixedMax=!0,i},t.DEFAULT_MAX=10,t.MIN_SUPPORTED_DOUBLE=-1e307,t.MAX_SUPPORTED_DOUBLE=1e307,t}();ar xr=function(){function t(){}return t.calculate=function(e,r,n,i,a,o){u.assertValue(e,"range"),u.assert(function(){return void 0===r||r>=t.MIN_COUNT&&r<=t.MAX_COUNT},"expectedCount"),u.assert(function(){return void 0===i||i>=-308&&i<=308},"minPower"),u.assert("maxAllowedMargin");var s=new t;if(r=void 0===r?10:ei(r,t.MIN_COUNT,t.MAX_COUNT),void 0===i&&(i=-308),void 0===a&&(a=!1),void 0===n&&(n=1),void 0===o&&(o=[1,2,5]),e.forcedSingleStop)return s.interval=e.getSize(),s.intervalOffset=s.interval-(e.forcedSingleStop-e.min),s.min=e.min,s.max=e.max,s.sequence=[e.forcedSingleStop],s;var m,l=0,c=0,f=9,d=n>0&&!e.hasFixedMin,p=n>0&&!e.hasFixedMax,v=pr(e.getSize()),g=pr(o[0]);if(v-=g,v-=pr(r),v=Math.max(v,i-g+1),0!==l){var S=dr(v),E=mf(e.min,S),C=Sf(e.max,S);(b=wi.calculateFixedRange(E,C)).shrinkByStep(e,l),c=b.min,f=b.max,m=Math.floor(b.getSize()/l)}else{var V=void 0;for(V=0;V<3;V++){for(var x=v+V,w=(S=dr(x),E=mf(e.min,S),C=Sf(e.max,S),o.length),D=dr(x-1),A=0;A<w;A++){var b,I=o[A]*D;if((b=wi.calculateFixedRange(E,C,a)).shrinkByStep(e,I),d&&e.min===b.min&&n>=1&&(b.min-=I),p&&e.max===b.max&&n>=1&&(b.max+=I),(m=Lr(b.getSize()/I,Nr))<=r||2===V&&A===w-1||1===r&&2===m&&(I>e.getSize()||e.min<0&&e.max>0&&2*I>=e.getSize())){l=I,c=b.min,f=b.max;break}}if(0!==l)break}}(m>32*r||m>t.MAX_COUNT)&&(l=(f-c)/(m=Math.min(32*r,t.MAX_COUNT))),s.min=c,s.max=f,s.interval=l,s.intervalOffset=c-e.min,s.maxAllowedMargin=n,s.canExtendMin=d,s.canExtendMax=p;var F=kr(l,0);s.precision=F;var R=[],W=aa(c,F);for(R.push(W),A=0;A<m;A++)W=aa(W+l,F),R.push(W);return s.sequence=R,s.trimMinMax(e.min,e.max),s},t.calculateUnits=function(e,r,n,i){n=ei(n,t.MIN_COUNT,t.MAX_COUNT),e===r&&(r=e+1);for(var o=0,s=0,l=i;s<l.length&&!(Lr(r/(o=l[s]))-Zn(e/o)<=n);s++);var d=-e;d%=o;var p=new t;p.sequence=[];for(var h=e+d;p.sequence.push(h),!(h>=r);h+=o);return p.interval=o,p.intervalOffset=d,p.min=p.sequence[0],p.max=p.sequence[p.sequence.length-1],p},t.prototype.trimMinMax=t.MIN_COUNT=1,t.MAX_COUNT=1e3,t}(),SV=function(){eturn t.prototype.add=t.prototype.moveToCover=t.calculate=function(e,r,n,i){switch(i||(i=t.getIntervalUnit(e,r,n)),i){case k.Year:return t.calculateYears(e,r,n);case k.Month:return t.calculateMonths(e,r,n);case k.Week:return t.calculateWeeks(e,r,n);case k.Day:return t.calculateDays(e,r,n);case k.Hour:return t.calculateHours(e,r,n);case k.Minute:return t.calculateMinutes(e,r,n);case k.Second:return t.calculateSeconds(e,r,n);case k.Millisecond:return t.calculateMilliseconds(e,r,n);default:u.assertFail("Unsupported DateTimeUnit")}},t.calculateYears=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert("Expected count is out of range");var i=wi.calculateDataRange(e.getFullYear(),r.getFullYear(),!1),a=xr.calculate(wi.calculate(0,i.max-i.min),n,0,null,null,[1,2,5]),o=Math.floor(i.min/a.interval)*a.interval,s=ke.fromDateParts(o,0,1);return t.fromNumericSequence(s,a,k.Year)},t.calculateMonths=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=e.getFullYear(),a=r.getFullYear(),o=e.getMonth(),s=12*(a-i)+r.getMonth(),l=ke.fromDateParts(i,0,1),c=xr.calculateUnits(o,s,n,[1,2,3,6,12]);return t.fromNumericSequence(l,c,k.Month)},t.calculateWeeks=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var o=(e.getDay()-0+7)%7,s=e.getDate()-o,l=ke.fromDateParts(e.getFullYear(),e.getMonth(),s),f=Lr(t.getDelta(l,r,k.Week)),d=xr.calculateUnits(0,f,n,[1,2,4,8]);return t.fromNumericSequence(l,d,k.Week)},t.calculateDays=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=ke.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate()),o=Lr(t.getDelta(e,r,k.Day)),s=xr.calculateUnits(0,o,n,[1,2,7,14]);return t.fromNumericSequence(i,s,k.Day)},t.calculateHours=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=ke.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate()),a=Zn(t.getDelta(i,e,k.Hour)),o=Lr(t.getDelta(i,r,k.Hour)),s=xr.calculateUnits(a,o,n,[1,2,3,6,12,24]);return t.fromNumericSequence(i,s,k.Hour)},t.calculateMinutes=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=ke.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),a=Zn(t.getDelta(i,e,k.Minute)),o=Lr(t.getDelta(i,r,k.Minute)),s=xr.calculateUnits(a,o,n,[1,2,5,10,15,30,60,120,180,360,720,1440]);return t.fromNumericSequence(i,s,k.Minute)},t.calculateSeconds=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=ke.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()),a=Zn(t.getDelta(i,e,k.Second)),o=Lr(t.getDelta(i,r,k.Second)),s=xr.calculateUnits(a,o,n,[1,2,5,10,15,30,60,120,300,600,900,1800,3600]);return t.fromNumericSequence(i,s,k.Second)},t.calculateMilliseconds=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert("expected count is out of range");var i=ke.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()),a=t.getDelta(i,e,k.Millisecond),o=t.getDelta(i,r,k.Millisecond),s=xr.calculate(wi.calculate(a,o),n,0);return t.fromNumericSequence(i,s,k.Millisecond)},t.addInterval=function(e,r,n){switch(r=Math.round(r),n){case k.Year:return function(t,e){var r=t.getFullYear(),n=t.getMonth(),i=t.getDate(),a=2===n&&29===i,o=ke.fromTimeValue(t.getTime());return r+=e,a&&!Qp(r)&&(i=28),o.setUTCFullYear(r,n,i),o}(e,r);case k.Month:return function(t,e){var r=t.getFullYear(),n=t.getMonth(),i=t.getDate(),a=ke.fromTimeValue(t.getTime());return r+=(e-e%12)/12,(n+=e%12)>11&&(n%=12,r++),i=Math.min(i,r,n)),a.setUTCFullYear(r,n,i),a}(e,r);case k.Week:return e,r);case k.Day:return jp(e,r);case k.Hour:return function(t,e){return ke.fromTimeValue(t.getTime()+36e5*e)}(e,r);case k.Minute:return function(t,e){return ke.fromTimeValue(t.getTime()+6e4*e)}(e,r);case k.Second:return e,r);case k.Millisecond:return e,r)}},t.fromNumericSequence=t.getDelta=function(e,r,n){var i=0;switch(n){case k.Year:i=r.getFullYear()-e.getFullYear();break;case k.Month:i=12*(r.getFullYear()-e.getFullYear())+r.getMonth()-e.getMonth();break;case k.Week:i=(r.getTime()-e.getTime())/6048e5;break;case k.Day:i=(r.getTime()-e.getTime())/864e5;break;case k.Hour:i=(r.getTime()-e.getTime())/36e5;break;case k.Minute:i=(r.getTime()-e.getTime())/6e4;break;case k.Second:i=(r.getTime()-e.getTime())/1e3;break;case k.Millisecond:i=r.getTime()-e.getTime()}return i},t.getIntervalUnit=function(e,r,n){n=Math.max(n,2);var i=t.getDelta(e,r,k.Day);if(i>356&&i>=180*n)return k.Year;if(i>60&&i>7*n)return k.Month;if(i>14&&i>2*n)return k.Week;var a=t.getDelta(e,r,k.Hour);if(i>2&&a>12*n)return k.Day;if(a>=24&&a>=n)return k.Hour;var o=t.getDelta(e,r,k.Minute);if(o>2&&o>=n)return k.Minute;var s=t.getDelta(e,r,k.Second);if(s>2&&s>=.8*n)return k.Second;if(t.getDelta(e,r,k.Millisecond)>0)return k.Millisecond;var c=e;return 0!==c.getMilliseconds()?k.Millisecond:0!==c.getSeconds()?k.Second:0!==c.getMinutes()?k.Minute:0!==c.getHours()?k.Hour:1!==c.getDate()?k.Day:0!==c.getMonth()?k.Month:k.Year},t.MIN_COUNT=1,t.MAX_COUNT=1e3,t}(),EV=[31,28,31,30,31,30,31,31,30,31,30,31],CV=[31,29,31,30,31,30,31,31,30,31,30,31];unction jp(t,e){var r=t.getFullYear(),n=t.getMonth(),i=t.getDate(),a=ke.fromTimeValue(t.getTime());return a.setUTCFullYear(r,n,i+e),a}var at={NullValue:"(Blank)",BooleanTrue:"True",BooleanFalse:"False",NaNValue:"NaN",InfinityValue:"+Infinity",NegativeInfinityValue:"-Infinity",RestatementComma:"{0}, {1}",RestatementCompoundAnd:"{0} and {1}",RestatementCompoundOr:"{0} or {1}",DisplayUnitSystem_EAuto_Title:"Auto",DisplayUnitSystem_E0_Title:"None",DisplayUnitSystem_E3_LabelFormat:"{0}K",DisplayUnitSystem_E3_Title:"Thousands",DisplayUnitSystem_E6_LabelFormat:"{0}M",DisplayUnitSystem_E6_Title:"Millions",DisplayUnitSystem_E9_LabelFormat:"{0}bn",DisplayUnitSystem_E9_Title:"Billions",DisplayUnitSystem_E12_LabelFormat:"{0}T",DisplayUnitSystem_E12_Title:"Trillions",Percentage:"#,0.##%",Percentage1:"#,0.#%",TableTotalLabel:"Total",Tooltip_HighlightedValueDisplayName:"Highlighted",Funnel_PercentOfFirst:"Percent of first",Funnel_PercentOfPrevious:"Percent of previous",Funnel_PercentOfFirst_Highlight:"Percent of first (highlighted)",Funnel_PercentOfPrevious_Highlight:"Percent of previous (highlighted)",GeotaggingString_Continent:"continent",GeotaggingString_Continents:"continents",GeotaggingString_Country:"country",GeotaggingString_Countries:"countries",GeotaggingString_State:"state",GeotaggingString_States:"states",GeotaggingString_City:"city",GeotaggingString_Cities:"cities",GeotaggingString_Town:"town",GeotaggingString_Towns:"towns",GeotaggingString_Province:"province",GeotaggingString_Provinces:"provinces",GeotaggingString_County:"county",GeotaggingString_Counties:"counties",GeotaggingString_Village:"village",GeotaggingString_Villages:"villages",GeotaggingString_Post:"post",GeotaggingString_Zip:"zip",GeotaggingString_Code:"code",GeotaggingString_Place:"place",GeotaggingString_Places:"places",GeotaggingString_Address:"address",GeotaggingString_Addresses:"addresses",GeotaggingString_Street:"street",GeotaggingString_Streets:"streets",GeotaggingString_Longitude:"longitude",GeotaggingString_Longitude_Short:"lon",GeotaggingString_Longitude_Short2:"long",GeotaggingString_Latitude:"latitude",GeotaggingString_Latitude_Short:"lat",GeotaggingString_PostalCode:"postal code",GeotaggingString_PostalCodes:"postal codes",GeotaggingString_ZipCode:"zip code",GeotaggingString_ZipCodes:"zip codes",GeotaggingString_Territory:"territory",GeotaggingString_Territories:"territories"},FV={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},Kp=1e15,kV=/^([0\#,]*\.[0\#]+|[0\#,]+|g)$/i,LV=function(){function t(){}return t.prototype.project=function(e){return this.value?e/this.value):e},t.prototype.isApplicableTo=function(e){var r=kr(e=Math.abs(e),3);return function(t,e,r){return r=Gt(r,t,e),u.assert(function(){return r>=0},"precision"),t>e||Math.abs(t-e)<r}(e,this.applicableRangeMin,r)&&function(t,e,r){return r=Gt(r,t,e),u.assert(function(){return r>=0},"precision"),t<e&&Math.abs(t-e)>r}(e,this.applicableRangeMax,r)},t.prototype.isScaling=t}(),Ka=function(){eturn t.prototype.getUnits=Object.defineProperty(t.prototype,"title",{get:enumerable:!1,configurable:!0}),t.prototype.update=t.prototype.findApplicableDisplayUnit=t.prototype.format=function(e,r,n,i){u.assert(function(){return"number"==typeof e},"value must be a number"),n=this.getNumberOfDecimalsForFormatting(n);var a="";return this.isFormatSupported(r)&&!this.hasScientificFormat(r)&&this.isScalingUnit()&&this.shouldRespectScalingUnit()&&(e=this.displayUnit.project(e),a=this.displayUnit.labelFormat),this.formatHelper(e,a,r,n,i)},t.prototype.isFormatSupported=function(e){return!t.UNSUPPORTED_FORMATS.test(e)},t.prototype.isPercentageFormat=t.prototype.shouldRespectScalingUnit=function(){return!0},t.prototype.getNumberOfDecimalsForFormatting=function(e){return e},t.prototype.isScalingUnit=function(){return this.displayUnit&&this.displayUnit.isScaling()},t.prototype.formatHelper=function(e,r,n,i,a){if(("g"===n||"G"===n)&&null!=i&&(n="#,0.00"),(n=qs(n,i,a))&&!qe.isStandardNumberFormat(n))return qe.formatNumberWithCustomOverride(e,n,r);n||(n="G"),r||(r="{0}");var o=qe.formatValue(e,n);return qe.format(r,[o])},t.prototype.formatSingleValue=function(e,r,n,i){return this.update(this.shouldUseValuePrecision(e)?kr(e,8):e),this.format(e,r,n,i)},t.prototype.shouldUseValuePrecision=t.prototype.isScientific=function(e){return e<-Kp||e>Kp||-1e-4<e&&e<1e-4&&0!==e},t.prototype.hasScientificFormat=t.prototype.supportsScientificFormat=t.prototype.shouldFallbackToScientific=t.prototype.getScientificFormat=function(e,r,n,i){if(this.isFormatSupported(r)&&this.shouldFallbackToScientific(e,r)){var a=$f(e,r);return n&&(a=qs(a||"0",Math.abs(n),i)),a?a+"E+0":"0.##E+0"}return r},t.UNSUPPORTED_FORMATS=/^(p\d*)|(e\d*)$/i,t}(),BV=function(t){eturn T(e,t),e}(Ka),Ja=function(t){function e(r){return t.call(this,e.getUnits(r))||this}return T(e,t),e.prototype.format=function(r,n,i,a){return n=this.getScientificFormat(r,n,i,a),t.prototype.format.call(this,r,n,i,a)},e.reset=function(){e.units=null},e.getUnits=function(r){return e.units||(e.units=Ru(r,).length>=1&&(e.units[e.units.length-1].applicableRangeMax=1/0),e.units},e}(Ka),$p=function(t){function e(r){return t.call(this,e.getUnits(r))||this}return T(e,t),e.reset=e.getUnits=function(r){return e.units||(e.units=Ru(r)).length>=1&&(e.units[e.units.length-1].applicableRangeMax=1/0),e.units},e.prototype.format=function(r,n,i,a){return n=this.getScientificFormat(r,n,i,a),t.prototype.format.call(this,r,n,i,a)},e}(Ka),Xp=function(t){eturn T(e,t),e.prototype.isFormatSupported=e.getUnits=function(r){if(!e.units){var n=[],i=a=r(-1);Nu(n,0,a.title,a.format,i),Nu(n,1,(a=r(0)).title,a.format,i),(e.units=n.concat(Ru(r,i))).length>=1&&(e.units[e.units.length-1].applicableRangeMax=1/0)}return e.units},e.prototype.format=e.UNSUPPORTED_FORMATS=/^(e\d*)$/i,e}(Ka);function Ru(t,e){for(var r=[],n=3;n<24;n++){var i=t(n);i&&Nu(r,dr(n),i.title,i.format,e)}return r}unction Zp(t){ku||(nt.information("allowFormatBeautification used",void 0,{key:t}),ku=!0)}var ku=!1;ar Me={null:at.NullValue,true:at.BooleanTrue,false:at.BooleanFalse,NaN:at.NaNValue,infinity:at.InfinityValue,negativeInfinity:at.NegativeInfinityValue,beautify:function(e){return function(t){var e=FV[t];return e?(Zp(e),at[e]||t):t}(e)},describe:function(e){return function(t){var e=-1===t?"Auto":t.toString(),i=at["DisplayUnitSystem_E"+e+"_Title"],a=t<=0?"{0}":at["DisplayUnitSystem_E"+e+"_LabelFormat"];if(i||a)return{title:i,format:a}}(e)},restatementComma:at.RestatementComma,restatementCompoundAnd:at.RestatementCompoundAnd,restatementCompoundOr:at.RestatementCompoundOr},jV={displayName:"",type:L.fromPrimitiveTypeAndCategory(7)};function WV(t){return fi(t)}function KV(t){u.assertValue(t,"options"),Me=t,Ja.reset(),$p.reset()}unction JV(t){u.assertValue(t,"options");var e=t.allowFormatBeautification?Me.beautify(t.format):t.format;if(function(t){var e=t.value,r=t.value2,n=t.format,i=t.columnType;if(t.formatSingleValues&&n&&Math.abs(e)<1e4)if(ci(n)){if(Ef(e))return!1}else if(fi(n,!0).precision<2)return!1;if("number"==typeof e||"number"==typeof r)return!(i&&i.temporal&&i.temporal.year)}(t)){var r=th(t.displayUnitSystemType),n=!!t.formatSingleValues;r.update(Math.max(Math.abs(t.value||0),Math.abs(t.value2||0)));var a,i=null!=t.precision;return i?a=-t.precision:r.displayUnit&&r.displayUnit.value>1&&(a=-2),{format:function(l){var c=ah(l,!0);if(!Vn(c))return c;var f=Number(l);return f&&!r.isScalingUnit()&&Math.abs(f)<1e3&&!i&&(l=aa(f)),n?r.formatSingleValue(f,e,a,i):r.format(f,e,a,i)},displayUnit:r.displayUnit,options:t}}if(t.value,t.value2,t.tickCount)){var o=SV.getIntervalUnit(t.value,t.value2,t.tickCount);return{format:function(l){return null==l?Me.null:xi(l,qe.dateFormatString(o))},options:t}}return eh(e)}nction th(t){if(null==t)return new Ja(Me.describe);switch(t){case Wa.Default:return new Ja(Me.describe);case Wa.WholeUnits:return new $p(Me.describe);case Wa.Verbose:return new BV;case Wa.DataLabels:return new Xp(Me.describe);default:return u.assertFail("Unknown display unit system type"),new Ja(Me.describe)}}unction Ya(t,e,r){if(t){if(e){var n=rr(t.objects,e);if(n)return n}if(!r&&t.type)return rh(t.type)}}function rh(t){return u.assertValue(t,"type must be defined"),t.dateTime?"d":t.integer?t.temporal&&t.temporal.year?"0":"g":t.numeric?"#,0.00":void 0}function ew(t,e){if(u.assertAnyValue(e,"format"),void 0!==t)return t;if("g"!==e&&"G"!==e){if(e){var n=fi(li(e).positive,!0);if(n.hasDots)return n.optionalPrecision?void 0:n.precision}return 0}}function nh(t,e,r,n){return rr(t,r)||Ya(e,r,n)}function ih(t,e){var r;if(!t)return null;var n=t.length;if(n>0){r=t[0];for(var i=n-1,a=1,o=i;a<o;a++)r=Ne(Me.restatementComma,r,t[a]);n>1&&(r=Ne(e,r,t[i]))}else r=null;return r}function tw(t){return ih(t,Me.restatementCompoundAnd)}function rw(t){return ih(t,Me.restatementCompoundOr)}function xi(t,e,r){var n=ah(t,r||!1);return Vn(n)?qe.formatValue(t,e):n}ar $a=function(){function t(e,r,n){this.selector=t.ensureSelector(e),this.highlight=r,this._columnLevelKeys=new Or(function(){if(e)return _u(e,!1)}),this._identityLevelKeys=new Or(function(){if(e)return _u(e,!0)}),this.selectorsByColumn=n}return t.fromSelectorsByColumn=function(e){return new t(wr(e),!1,e)},t.fromSelectorsByColumnAndRoles=function(e,r){var i=new t(wr(e),!1,e);return i.role=r,i},t.prototype.equals=function(e){return this.selector&&e.selector?this.highlight===e.highlight&&St(this.selector,e.selector):!this.selector==!e.selector&&this.highlight===e.highlight},t.isEqual=t.prototype.includes=function(e,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),!e)return!1;var i=this.selector,a=e.selector;if(!i||!a)return!1;var o=i.data,s=a.data;if(!o&&i.metadata&&i.metadata!==a.metadata||!r&&this.highlight!==e.highlight)return!1;if(o){if(!s)return!1;if(o.length>0)for(var l=function(h,v){var g=o[h];if(n){var y=g.expr;if(!_.some(s,function(m){return function(t,e,r){if(!(t=t||null)!=!(e=e||null))return!1;u.assertValue(t,"thisComparisonExpr"),u.assertValue(e,"otherComparisonIdentity");var i=t,a=Ip(e.expr),o=Ip(i);if(!a||!o)return Vi(mt(i),e,r);for(var s=function(h){if(!_.some(a,)return{value:!1}},l=0,c=o;l<c.length;l++){var d=s(c[l]);if("object"==typeof d)return d.value}return!0}(y,m)}))return{value:!1}}else if(!s.some(function(m){return Vi(g,m)}))return{value:!1}},c=0,f=o.length;c<f;c++){var d=l(c);if("object"==typeof d)return d.value}}return!0},t.prototype.getKey=t.prototype.getDecomposedKeys=t.prototype.getKeyWithoutHighlight=t.prototype.hasIdentity=t.prototype.getSelector=function(){return this.selector},t.prototype.getSelectorsByColumn=function(){return this.selectorsByColumn},t.prototype.getSelectorKey=function(){return void 0===this._selectorKey&&(this._selectorKey=Hp(this.selector)),this._selectorKey},t.createNull=t.createWithId=t.createWithMeasure=function(e,r){void 0===r&&(r=!1),u.assertValue(e,"measureId");var i=new t({metadata:e},r);return i.selectorsByColumn={metadata:[e]},i},t.createWithIdAndMeasure=t.createWithIdAndMeasureAndCategory=t.createWithIds=t.createWithIdsAndMeasure=t.createWithSelectorForColumnAndMeasure=function(e,r,n,i){void 0===n&&(n=!1),void 0===i&&(i=[]);var a={};return _.isEmpty(e)||(a.dataMap=e),r&&(a.metadata=[r]),!e&&!r&&(a=null),_.isEmpty(i)||(a.valueDetails=i),new t(wr(a),n,a)},t.createWithSelectorForColumnAndMeasures=function(e,r,n,i){void 0===i&&(i=!1);var a={};return _.isEmpty(e)||(a.dataMap=e),_.isEmpty(r)||(a.metadata=r),n&&(a.valueDetails=n),!e&&_.isEmpty(r)&&(a=null),new t(wr(a),i,a)},t.createWithHighlight=function(e){u.assertValue(e,"original"),u.assert(function(){return!e.highlight},"!original.highlight");var r=new t(e.getSelector(),!0);return r.selectorsByColumn=e.selectorsByColumn,r},t.idArray=t.ensureSelector=function(e){return e&&e.data&&(e.data=_.uniqWith(e.data,Iu)),e},t}();function Rn(t,e,r){var i,n=t.format;return{expr:t.expr,get formattedValuevalue:e,identity:r,queryName:t.queryName}}var Xe=function(){function t(){}return t.builder=function(){return new t},t.prototype.withColumnIdentity=t.prototype.withCategoryIdentity=t.prototype.withCategory=function(e,r,n,i){if(void 0===i&&(i=!1),e)){if(i&&n)for(var a=0,o=e;a<o.length;a++)this.addCategoryValueDetails(o[a],r);e[0]&&n&&e[0].identity&&this.addItemToDataMap(n,e[0].identity[r])}else i&&this.addCategoryValueDetails(e,r),e&&e.source&&e.source.queryName&&e.identity&&this.addItemToDataMap(e.source.queryName,e.identity[r]);return this},t.prototype.addCategoryValueDetails=t.prototype.withSeries=function(e,r,n){return void 0===n&&(n=!1),e&&e.source&&e.source.queryName&&r&&(n&&function(t){return t&&t.values&&t.values[0]&&!!t.values[0].values}(r)&&(this.ensureValueDetails(),this.valueDetails.push(Rn(e.source,r.name,r.identity))),this.addItemToDataMap(e.source.queryName,r.identity)),this},t.prototype.withMeasure=t.prototype.withMeasures=t.prototype.createSelectionId=t.prototype.clone=function(){var e=new t,r=this.dataMap;if(r){var n=e.dataMap={};for(var i in this.dataMap)n[i]=me([],r[i]||[],!0)}return this.measures&&(e.measures=me([],this.measures||[],!0)),e},t.prototype.ensureMeasures=function(){void 0===this.measures&&(this.measures=[])},t.prototype.ensureValueDetails=t.prototype.addItemToDataMap=t}();ar Xa="noQueryName",ie=function(){eturn t.prototype.withCategory=t.prototype.withSeries=t.prototype.withMeasure=t.prototype.withMatrixNode=t.prototype.withTable=t.prototype.equals=t.prototype.createSelectionId=t.prototype.getKey=function(){return this.key},t.prototype.includes=t.prototype.hasIdentity=t.prototype.compareMeasures=t.prototype.compareMetadata=t.prototype.addItemToDataMap=t.prototype.getSelector=function(){var e=this,r={data:void 0,metadata:_.head(this.measures)};if(this.dataMap){r.data=[];var n=function(s){u.assert("dataMap can only have one selector per column"),r.data.push(i.dataMap[s][0])},i=this;for(var a in this.dataMap)n(a)}return r},t.prototype.getSelectorsByColumn=function(){return null},t}();function kt(t,e,r){if(u.assertValue(t,"fullString"),u.assertValue(e,"from"),u.assertValue(r,"length"),u.assert(function(){return e>=0},"from >= 0"),u.assert(function(){return r>=0},"length >= 0"),u.assert("(from + length) <= fullString.length"),0===r)return null;for(var n=0,i=0,a=e+r-1;i<r;i++,a--){var o=t.charCodeAt(a)-48;if(o<0||9<o)return null;n+=o*dr(i)}return n}var nw={major:0,minor:0,patch:0};function Lt(t){u.assertValue(t,"versionString");for(var i,e=0,r=0,n=0,a=0,o=0,s=0,l=t.length;o<=l;o++){var c=o===l?46:t.charCodeAt(o);switch(c){case 46:case 45:if(o===s)return;var f=kt(t,s,o-s);if(null==f)return;switch(a){case 0:e=f;break;case 1:r=f;break;case 2:n=f;break;default:return}if(a++,s=o+1,45===c){if(3!==a||!iw(i=t.substr(o+1)))return;o=l}break;default:if(c<48||c>57)return}}var d={major:e,minor:r,patch:n};return i&&(d.prerel=i),d}function iw(t){u.assertValue(t,"prerel");for(var e=0,r=t.length;e<r;e++){var n=t.charCodeAt(e);if(!(65<=n&&n<=90||97<=n&&n<=122||48<=n&&n<=57||45===n||46===n))return!1}return!0}function nn(t,e){return u.assertValue(t,"v1"),u.assertValue(e,"v2"),Za(Ct(t),Ct(e))>0}function Mr(t,e){return u.assertValue(t,"v1"),u.assertValue(e,"v2"),Za(Ct(t),Ct(e))<0}function oh(t,e){return u.assertValue(t,"v1"),u.assertValue(e,"v2"),Za(Ct(t),Ct(e))>=0}function sh(t,e){return u.assertValue(t,"v1"),u.assertValue(e,"v2"),t=Ct(t),e=Ct(e),!Za(Ct(t),Ct(e))}unction Za(t,e){var r=eo(t.major,e.major);return r||(r=eo(t.minor,e.minor))||(r=eo(t.patch,e.patch))?r:function(t,e){var r=_.isEmpty(t),n=_.isEmpty(e);if(r)return n?0:1;if(n)return-1;var i=kt(t,0,t.length),a=kt(e,0,e.length);return null!=i?null!=a?eo(i,a):-1:null!=a?1:t.localeCompare(e)}(t.prerel,e.prerel)}function eo(t,e){var r=(t=t||0)-(e=e||0);return 0===r?0:r<0?-1:(u.assert("diff > 0"),1)}var Be=function(){eturn t.prototype.select=t.prototype.showContextMenu=t.prototype.toggleExpandCollapse=t.prototype.hasSelection=t.prototype.clear=t.prototype.getSelectionIds=function(){return this.selectedIds},t.prototype.setSelectionIds=function(e){this.selectedIds=e},t.prototype.sendSelectionToHost=function(e,r){if(this.noIframe||!this.apiVersion||Mr(this.apiVersion,"2.0.0")){var n=this.dataPointObjectName,i={type:0,visualObjects:_.chain(e).filter(function(o){return o.hasIdentity()}).map(.value(),selectors:void 0,selectionMode:r?3:0},a=!1;_.isEmpty(e)||(a=e[0].getSelector()&&!e[0].getSelectorsByColumn()),a&&(i.selectors=_.chain(e).filter(function(o){return o.hasIdentity()}).map(function(o){return o.getSelector()}).value()),this.hostServices.onSelect(i)}else this.hostServices.sendSelectionIdsToHost(this.prepareCustomVisualSelectEventArgs(e,r))},t.prototype.sendContextMenuToHost=t.prototype.sendExpandCollapseToHost=t.prototype.selectInternal=t.containsSelection=t.getSelectorsByColumn=function(e){return e&&e[0]instanceof ie?e:_(e).filter(.map(function(r){return r.getSelectorsByColumn()}).compact().value()},t.createChangeForFilterProperty=t.prototype.getFilterFromSelectors=function(){if(this.hasSelection())return Tu(_.chain(this.selectedIds).filter(function(r){return r.hasIdentity()}).map(function(r){return r.getSelector()}).value(),!1)},t.prototype.prepareCustomVisualSelectEventArgs=t.prototype.applySelectionFilter=t.prototype.registerOnSelectCallback=function(e){this.onSelectCallback=e},t.prototype.invokeOnSelectCallback=t}(),uw={version:"1.1.0",overloads:hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return new Be({hostServices:e.host})},colors:Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()}}};function bt(t){return new uh(t)}function ue(t){return new lw(t)}var uh=),lw=function(t){eturn T(e,t),e}(uh),dw={version:"1.2.0",overloads:hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return new Be({hostServices:e.host})},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)}}}};function ot(t){return new pw(t)}var pw=function(){eturn t.prototype.enabled=t.prototype.show=function(e){if(this.enabled()){var r={coordinates:e.coordinates,dataItems:e.dataItems,isTouchEvent:e.isTouchEvent,identities:Be.getSelectorsByColumn(e.identities)};this.tooltipService.show(r)}},t.prototype.move=function(e){if(this.enabled()){var r={coordinates:e.coordinates,dataItems:e.dataItems,isTouchEvent:e.isTouchEvent,identities:Be.getSelectorsByColumn(e.identities)};this.tooltipService.move(r)}},t.prototype.hide=t}(),vw={version:"1.3.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return new Be({hostServices:e.host})},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host})}}},yw={version:"1.4.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return new Be({hostServices:e.host})},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),locale:e.host.locale()}}},Sw={version:"1.5.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return new Be({hostServices:e.host})},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive}}},bw={version:"1.6.0",overloads:hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return new Be({hostServices:e.host})},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive}}};function X(t){return new Vw(t)}var Vw=);function ww(t){switch(t){case 3:return"VisualEventError";case 2:return"VisualEventTrace";case 0:return"VisualEventRenderStarted";case 1:return"VisualEventRenderCompleted";default:return void u.assertFail("Unknown VisualEventType: "+t)}}var Mw={version:"1.7.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return new Be({hostServices:e.host})},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),telemetry:X({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:}},Aw={version:"1.8.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return new Be({hostServices:e.host})},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),telemetry:X({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()}}}};function te(t){return new Tw(t)}var Tw=),_w={version:"1.9.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return new Be({hostServices:e.host})},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()}}}},ne=),Pw={version:"1.10.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)}}}},Nw={version:"1.11.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){var i=e.host;return i.selectionManager=new Be({hostServices:i}),i.selectionManager},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)}}}},Bw={version:"1.12.0",overloads:hostAdapter:function(e){var r=e.host;return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return r.selectionManager=new Be({hostServices:r}),r.selectionManager},colorPalette:bt(Et(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():je.getDefaultColors()),persistProperties:function(a){return e.host.persistProperties(a)},tooltipService:ot({hostServices:e.host}),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(a,o,s,l){if(a){var c=[];c.push(a),e.host.applyJsonFilter(c,o,s,l)}else e.host.applyJsonFilter(null,o,s,l)},launchUrl:function(a){return e.host.launchUrl(a)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}},Ow={version:"1.13.0",hostAdapter:function(e){var r=e.host;return{createSelectionIdBuilder:function(){return new Xe},createSelectionManager:function(){return r.selectionManager=new Be({hostServices:r}),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}},Bu="2.0.0",Uw={version:Bu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Bu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=new Be({hostServices:r,apiVersion:Bu}),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:ot({hostServices:e.host}),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}},zu="2.1.0",Qw={version:zu,overloads:hostAdapter:function(e){var r=e.host;return r.apiVersion=zu,{createSelectionIdBuilder:function(){return r.createSelectionIdBuilder()},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(zu),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}},Ou="2.2.0",Ww={version:Ou,hostAdapter:function(e){var r=e.host;return r.apiVersion=Ou,{createSelectionIdBuilder:function(){return r.createSelectionIdBuilder()},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Ou),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}};function he(t){return new Kw(t)}var Kw=);function ve(t){return new Jw(t)}var Jw=),qu="2.3.0",Xw={version:qu,overloads:hostAdapter:function(e){var r=e.host;return r.apiVersion=qu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(qu),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:ve(r),eventService:he(r)}}},Uu="2.4.0",ex={version:Uu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Uu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Uu),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:ve(r),eventService:he(r)}}},Hu="2.5.0",rx={version:Hu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Hu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Hu),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:ve(r),eventService:he(r)}}},Gu="2.6.0",ax={version:Gu,overloads:hostAdapter:function(e){var r=e.host;return r.apiVersion=Gu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Gu),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:ve(r),eventService:he(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)}}}},Qu="3.2.0",sx={version:Qu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Qu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Qu),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:ve(r),eventService:he(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},ju="3.3.0",lx={version:ju,hostAdapter:function(e){var r=e.host;return r.apiVersion=ju,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(ju),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:ve(r),eventService:he(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},Wu="3.4.0",fx={version:Wu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Wu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Wu),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(i){return r.fetchMoreData(i)},storageService:ve(r),eventService:he(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},Ku="3.5.0",px={version:Ku,hostAdapter:function(e){var r=e.host;return r.apiVersion=Ku,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Ku),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(i){return r.fetchMoreData(i)},storageService:ve(r),eventService:he(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},Ju="3.6.0",vx={version:Ju,hostAdapter:function(e){var r=e.host;return r.apiVersion=Ju,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Ju),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(i){return r.fetchMoreData(i)},storageService:ve(r),eventService:he(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},Yu="3.7.0",yx={version:Yu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Yu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Yu),r.selectionManager},colorPalette:ue(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(i){return r.fetchMoreData(i)},storageService:ve(r),eventService:he(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv,displayWarningIcon:function(i,a){return r.displayWarningIcon(i,a)}}}},$u="3.8.0",Sx={version:$u,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=$u,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager($u),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}};function Fe(t){return new Ex(t)}var Ex=),Xu="3.9.0",bx={version:Xu,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=Xu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(Xu),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}},Zu="4.0.0",wx={version:Zu,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=Zu,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(Zu),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}},el="4.1.0",Mx={version:el,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=el,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(el),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}},tl="4.2.0",Ax={version:tl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=tl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(tl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}},rl="4.3.0",Ix={version:rl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=rl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(rl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}};function st(t){return new _x(t)}var _x=),nl="4.4.0",Px={version:nl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=nl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(nl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i)}}},il="4.5.0",Nx={version:il,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=il,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(il),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i)}}};ar kx=),al="4.6.0",Bx={version:al,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=al,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(al),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i)}}},ol="4.7.0",Ox={version:ol,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=ol,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(ol),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)}}}},sl="5.0.0",Ux={version:sl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=sl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(sl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)}}}},ul="5.1.0",Gx={version:ul,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=ul,{createSelectionIdBuilder:createSelectionManager:colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:launchUrl:instanceId:e.host.instanceId,refreshHostData:createLocalizationManager:fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:hostEnv:e.hostEnv,openModalDialog:displayWarningIcon:licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)}}}},ll="5.2.0",jx={version:ll,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=ll,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(ll),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)}}}},cl="5.3.0",Kx={version:cl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=cl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(cl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)}}}},fl="5.4.0",Yx={version:fl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=fl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(fl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)}}}};function to(t){return new $x(t)}var $x=function(){function t(e){this.storageV2Service=e&&e.localStorageV2Service&&e.localStorageV2Service(),this.promiseFactory=e.promiseFactory()}return t.prototype.status=function(){return null!=this.storageV2Service?this.storageV2Service.getStorageStatus():this.promiseFactory.resolve(2)},t.prototype.get=function(e){return null!=this.storageV2Service&&e?this.storageV2Service.getStorageData(e):this.promiseFactory.reject()},t.prototype.set=function(e,r){return null!=this.storageV2Service&&e&&r?this.storageV2Service.setStorageData(e,r):this.promiseFactory.reject()},t.prototype.remove=function(e){null!=this.storageV2Service&&e&&this.storageV2Service.removeStorageData(e)},t}(),dl="5.5.0",Zx={version:dl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=dl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(dl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:to(i)}}};function pl(t){return new eM(t)}var eM=),hl="5.6.0",rM={version:hl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=hl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(hl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:to(i),acquireAADTokenService:pl(i)}}},vl="5.7.0",iM={version:vl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=vl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(vl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:to(i),acquireAADTokenService:pl(i),setCanDrill:function(o){return i.setCanDrill(o)}}}},oM=function(){function t(e){var r;this.subSelectionService=null===(r=null==e?void 0:e.visualHostSubSelectionService)||void 0===r?void 0:r.call(e)}return t.prototype.subSelect=function(e){this.subSelectionService&&this.subSelectionService.subSelect(e)},t.prototype.updateRegionOutlines=function(e){this.subSelectionService&&this.subSelectionService.updateRegionOutlines(e)},t}(),gl="5.8.0",lM={version:gl,overloads:function(e,r){return{update:function(i){if(e.update){var a={viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,editMode:i.editMode,isInFocus:!!i.isInFocus,operationKind:i.operationKind,jsonFilters:i.jsonFilters,type:Ht(i),updateId:i.updateId,subSelections:i.subSelections,formatMode:i.formatMode};r.colorPalette.reset();var o=e.constructor.__transform__;_.isFunction(o)?e.update(a,o(a.dataViews)):e.update(a)}},getSubSelectionStyles:function(i){if(e.visualOnObjectFormatting&&_.isFunction(e.visualOnObjectFormatting.getSubSelectionStyles))return e.visualOnObjectFormatting.getSubSelectionStyles(i)},getSubSelectionShortcuts:getSubSelectables:function(i){if(e.visualOnObjectFormatting&&e.visualOnObjectFormatting.getSubSelectables&&_.isFunction(e.visualOnObjectFormatting.getSubSelectables))return e.visualOnObjectFormatting.getSubSelectables(i)}}},hostAdapter:function(e){var r,n,t,i=e.host;return i.apiVersion=gl,{createSelectionIdBuilder:function(){return new ie},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(gl),i.selectionManager},colorPalette:ue(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:X({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new ne(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:ve(i),downloadService:Fe(i),eventService:he(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:st(i),webAccessService:Dt(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:to(i),acquireAADTokenService:pl(i),setCanDrill:function(o){return i.setCanDrill(o)},subSelectionService:(t=i,new oM(t))}}},cM=[HS,uw,dw,vw,yw,Sw,bw,Mw,Aw,_w,Pw,Nw,Bw,Ow,Uw,Qw,Ww,Xw,ex,rx,ax,sx,lx,fx,px,vx,yx,Sx,bx,wx,Mx,Ax,Ix,Px,Nx,Bx,Ox,Ux,Gx,jx,Kx,Yx,Zx,rM,iM,lM];unction N(t){return null===t?null:(function(t){if(null==t)return!1;var e=Object.getPrototypeOf(t);return e!==Object.prototype&&e!==Array.prototype}(t)||(t=fe(t)),t)}ar yl=[];yl[1]="RegisteredResources",yl[2]="SharedResources";var dh={};function ro(t){return Mi(t,function(e){var r=L.fromDescriptor(e.type).formatting;return r&&r.formatString})}function ml(t,e){if(u.assertValue(t,"descriptors"),u.assertValue(e,"propertyId"),!_.isEmpty(t)){var r=t[e.objectName];if(r&&!_.isEmpty(r.properties))return r.properties[e.propertyName]}}function Mi(t,e){if(u.assertAnyValue(t,"descriptors"),u.assertAnyValue(e,"propPredicate"),t)for(var r in t){var n=t[r].properties;for(var i in n)if(e(n[i]))return{objectName:r,propertyName:i}}}dh[1]=!0,dh[2]=!0;var vh,BM={objectName:"general",propertyName:"filter"};function Di(){return new HM}var Ln=function(t){return t[t.pending=0]="pending",t[t.resolved=1]="resolved",t[t.rejected=2]="rejected",t}({}),HM=),GM=function(){function t(e){u.assertValue(e,"deferred"),this.deferred=e,this.promise=new Sl(e.promise())}return t.prototype.resolve=function(e){this.deferred.resolveWith(this.deferred.promise,[e])},t.prototype.reject=t}(),Sl=function(){function t(e){this[vh]="Promise",u.assertValue(e,"promise"),this.promise=e}return t.prototype.then=t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=t.wrapCallback=t}();vh=Symbol.toStringTag;var Qe=function(){ar e;return t.prototype.then=t.prototype.catch=t.prototype.finally=function(r){return this.defer.promise.finally(r)},t.init=function(r,n,i,a){u.assertValue(r,"promiseFactory"),u.assertAnyValue(n,"exceptionHandler"),u.assert("powerbi.Promise was used before being initialized - that is legitimate in test scenarios only"),null!=a&&(t.useNativePromise=a),t.factory=r,t.exceptions=n,t.defaultFactoryWasProvided=!1},t.setUseNativePromise=function(r){t.useNativePromise=r},t.ensureFactory=function(){var r=t.factory;return r||(r=t.factory=Di(),t.defaultFactoryWasProvided=!0),r},t.resolve=function(r){return t.useNativePromise?window.Promise.resolve(r):new t(function(n,i){return n(r)})},t.reject=t.allSettled=t.prototype.onResolve=function(r){var n=this;u.assertAnyValue(r,"value"),r)?r.then(function(i){return n.onResolve(i)},function(i){return n.onReject(i)}):this.defer.resolve(r)},t.prototype.onReject=function(r){if(u.assertAnyValue(r,"error"),!this.hasRejectionHandling&&r instanceof Error&&!r.suppressExceptionHandler){var n=t.exceptions;n&&(r.suppressExceptionHandler=!0,n(r))}this.defer.reject(r)},e=Symbol.toStringTag,t.useNativePromise=!0,t}(),jM=function(){function t(e,r){var n=this;this.wrappedVisual=e,this.run=r,u.assertValue(r,"run must be defined in VisualOutsideZoneAdapter"),e.update&&(this.update=,e.onResizing&&(this.onResizing=,e.onDataChanged&&(this.onDataChanged=,e.onSelectionStateChanged&&(this.onSelectionStateChanged=function(i){n.apply(function(){return n.wrappedVisual.onSelectionStateChanged(i)})})}return t.prototype.init=function(e){return this.apply(this.wrappedVisual.init,e)},t.prototype.destroy=function(){this.apply(this.wrappedVisual.destroy)},t.prototype.onViewModeChanged=t.prototype.onClearSelection=t.prototype.onRestoreSelection=function(e){return this.apply(this.wrappedVisual.onRestoreSelection,e)},t.prototype.canResizeTo=function(e){return this.apply(this.wrappedVisual.canResizeTo,e)},t.prototype.enumerateObjectInstances=function(e){return this.apply(this.wrappedVisual.enumerateObjectInstances,e)},t.prototype.enumerateObjectInstancesAsync=function(e){return this.apply(this.wrappedVisual.enumerateObjectInstancesAsync,e)},t.prototype.enumerateObjectRepetition=function(){return this.apply(this.wrappedVisual.enumerateObjectRepetition)},t.prototype.enumerateObjectRepetitionAsync=function(){return this.apply(this.wrappedVisual.enumerateObjectRepetitionAsync)},t.prototype.visualHasMethod=t.prototype.unwrap=function(){var e=this.wrappedVisual;return e.unwrap?e.unwrap():e},Object.defineProperty(t.prototype,"sandbox",{get:enumerable:!1,configurable:!0}),t.prototype.getTelemetryInformation=function(){return this.apply(this.wrappedVisual.getTelemetryInformation)},t.prototype.getFormattingModel=function(){return this.apply(this.wrappedVisual.getFormattingModel)},t.prototype.getFormattingModelAsync=t.prototype.resolveFormattingPlaceholder=function(e){var r=this;return this.run(function(){return r.wrappedVisual.resolveFormattingPlaceholder(e)})},t.prototype.getSubSelectionStyles=function(e){var r=this;return this.run(function(){return r.wrappedVisual.getSubSelectionStyles(e)})},t.prototype.getSubSelectionShortcuts=function(e,r){var n=this;return this.run(function(){return n.wrappedVisual.getSubSelectionShortcuts(e,r)})},t.prototype.getSubSelectables=function(e){var r=this;return this.run(function(){return r.wrappedVisual.getSubSelectables(e)})},t.prototype.getNextSubSelectable=function(e,r){var n=this;return this.run(function(){return n.wrappedVisual.getNextSubSelectable(e,r)})},t.prototype.getSubSelectionStylesAsync=function(e){var r=this;return this.run(function(){return r.wrappedVisual.getSubSelectionStylesAsync(e)})},t.prototype.getSubSelectionShortcutsAsync=t.prototype.getSubSelectablesAsync=t.prototype.onDataViewObjectChanged=t.prototype.apply=t}();function WM(t,e){void 0===e&&(e=!1);try{if(!t)return;var r=t.stack;if(!r)return;var n=r.indexOf("\n");return-1===n?void 0:(r=r.substring(n+1),e&&(r=r.replace(/\s*((ms-pbi|https):\/\/\S*|\(.*?\))/g,),r)}catch(i){return"Error at cleanExceptionStack"}}ar O={},gh=pt.generateGuid;function q(t,e){return function(r){return de(de({name:t,time:Mt(),id:gh()},e),{info:r,formatted:)}}var mh="BaseEvent",Sh=(O[mh]=q(mh),"TimedEvent"),Eh=(O[Sh]=q(Sh),"Verbose"),Ch=(O[Eh]=q(Eh),"VerboseTimedEvent"),wh=(O[Ch]=q(Ch),O.Trace=q("Trace"),O.Error=q("Error"),"ErrorWithStackTrace"),xh=(O[wh]=q(wh),"ErrorWithStackTraceAndSourceDetails"),Mh=(O[xh]=q(xh),"CustomerAction"),Dh=(O[Mh]=q(Mh),"PBI.Dashboard.RootSession"),Ah=(O[Dh]=q(Dh),"PBI.WFE.Error"),Th=(O[Ah]=q(Ah),"PBI.Dashboard.ErrorDialog"),Ih=(O[Th]=q(Th),"PBI.Dashboard.UnhandledAngularException"),_h=(O[Ih]=q(Ih),"PBI.Data.Exception"),El=(O[_h]=q(_h),"PBI.Visual.Exception"),Fh=O[El]=q(El),Ph="PBI.Dashboard.UnhandledException",Rh=(O[Ph]=q(Ph),"PBI.HandledException"),Nh=(O[Rh]=q(Rh),"PBI.Dashboard.ReportTilePopulateException"),kh=(O[Nh]=q(Nh),"PBI.Dashboard.UnhandledStacklessException"),Lh=(O[kh]=q(kh,{logRatio:1e-4}),"PBI.Visual.Error"),Bh=(O[Lh]=q(Lh),"PBI.WFE.ReopenUserAccount"),zh=(O[Bh]=q(Bh),"PBI.WFE.AccountClosedPage"),Oh=(O[zh]=q(zh),"PBI.WFE.AbtSignoutRedirectPage"),qh=(O[Oh]=q(Oh),"PBI.Visual.Warning"),Cl=(O[qh]=q(qh),"PBI.Visual.ApiUsage"),Uh=O[Cl]=q(Cl),Hh="PBI.Visual.CustomVisualsGenericEvent",Gh=(O[Hh]=q(Hh),"PBI.EX.CopyActionClicked"),Qh=(O[Gh]=q(Gh),"StartActivity"),jh=(O[Qh]=q(Qh),"EndActivity"),Wh=(O[jh]=q(jh),"PBI.App.SignInError"),Kh=(O[Wh]=q(Wh),"PBI.App.TokenRefreshError"),Jh=(O[Kh]=q(Kh),"PBI.Storytelling.BrowserNotSupportedLoaded"),ZM=(O[Jh]=q(Jh),function(){function t(e,r,n,i,a,o,s){this.wrappedVisual=e,this.visualPlugin=r,this.promiseFactory=n,this.telemetryService=i,this.isPluginInError=a,this.certifiedEventsService=o,this.silent=s,this.initCalled=!1,this.visualLoadStartTime=Mt(),this.startTimeISO=(new Date).toISOString()}return t.prototype.init=t.prototype.checkInit=t.prototype.destroy=function(){var e=this;this.wrappedVisual.destroy&&this.executeSafely(function(){return e.wrappedVisual.destroy()})},t.prototype.update=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.update)return this.executeSafelyAsync(function(){return et(r,void 0,Qe,function(){var n,i,a,o,s,l,c,f,d,p,h;return tt(this,function(v){switch(v.label){case 0:return[4,this.wrappedVisual.update(e)];case 1:return v.sent(),this.telemetryService&&this.startTimeISO&&this.visualPlugin.custom&&(i=(n=this.visualPlugin).version,a=n.apiVersion,o=(new Date).toISOString(),this.telemetryService.logEvent(Uh,{name:this.visualPlugin.name,apiVersion:a,custom:!!this.visualPlugin.custom,visualVersion:i,visualName:this.visualName,instanceId:this.instanceId,start:this.startTimeISO,end:o,isError:this.isPluginInError,errorSource:"User"}),this.startTimeISO=null,this.visualLoadStartTime&&(null===(s=this.certifiedEventsService)||void 0===s||s.logTimedStandardizedFeatureEvent({activityAttributes:{apiMajorVersion:a&&(null===(l=Lt(a))||void 0===l?void 0:l.major),apiMinorVersion:a&&(null===(c=Lt(a))||void 0===c?void 0:c.minor),visualMajorVersion:i&&(null===(f=Lt(i))||void 0===f?void 0:f.major),visualMinorVersion:i&&(null===(d=Lt(i))||void 0===d?void 0:d.minor)},activityName:Cl,correlationId:null===(h=null===(p=this.telemetryService)||void 0===p?void 0:p.root)||void 0===h?void 0:h.id,operationEndTime:Mt(),operationStartTime:this.visualLoadStartTime,visualId:this.visualPlugin.name}),this.visualLoadStartTime=null)),[2]}})})})},t.prototype.onResizing=t.prototype.onDataChanged=function(e){var r=this;this.checkInit(),this.wrappedVisual.onDataChanged&&this.executeSafely(function(){return r.wrappedVisual.onDataChanged(e)})},t.prototype.onViewModeChanged=function(e){var r=this;this.checkInit(),this.wrappedVisual.onViewModeChanged&&this.executeSafely(function(){return r.wrappedVisual.onViewModeChanged(e)})},t.prototype.onSelectionStateChanged=t.prototype.onClearSelection=t.prototype.onRestoreSelection=t.prototype.canResizeTo=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.canResizeTo)return this.executeSafely(function(){return r.wrappedVisual.canResizeTo(e)})},t.prototype.enumerateObjectInstances=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.enumerateObjectInstances)return this.executeSafely(function(){return r.wrappedVisual.enumerateObjectInstances(e)})},t.prototype.enumerateObjectRepetition=function(){var e=this;if(this.checkInit(),this.wrappedVisual.enumerateObjectRepetition)return this.executeSafely(function(){return e.wrappedVisual.enumerateObjectRepetition()})},t.prototype.enumerateObjectInstancesAsync=function(e){var r=this;return this.checkInit(),this.visualAdapter.enumerateObjectInstancesAsync?this.executeSafely(function(){return r.visualAdapter.enumerateObjectInstancesAsync(e)}):this.promiseFactory.resolve(this.enumerateObjectInstances(e))},t.prototype.enumerateObjectRepetitionAsync=function(){var e=this;return this.checkInit(),this.visualAdapter.enumerateObjectRepetitionAsync?this.executeSafely(function(){return e.visualAdapter.enumerateObjectRepetitionAsync()}):this.promiseFactory.resolve(this.enumerateObjectRepetition())},Object.defineProperty(t.prototype,"sandbox",{get:function(){return this.visualAdapter&&this.visualAdapter.sandbox},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visualAdapter",{get:function(){return this.wrappedVisual},enumerable:!1,configurable:!0}),t.prototype.unwrap=function(){var e=this.wrappedVisual;return e.unwrap?e.unwrap():e},t.prototype.visualHasMethod=function(e){var r=this.wrappedVisual;return r&&r.visualHasMethod(e)},t.prototype.getTelemetryInformation=function(){var e=this;if(this.checkInit(),this.wrappedVisual.getTelemetryInformation)return this.executeSafely(function(){return e.wrappedVisual.getTelemetryInformation()})},t.prototype.getFormattingModel=t.prototype.getFormattingModelAsync=t.prototype.resolveFormattingPlaceholder=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.resolveFormattingPlaceholder)return this.executeSafely(function(){return r.wrappedVisual.resolveFormattingPlaceholder(e)})},t.prototype.getSubSelectionStyles=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.getSubSelectionStyles)return this.executeSafely(function(){return r.wrappedVisual.getSubSelectionStyles(e)})},t.prototype.getSubSelectionShortcuts=function(e,r){var n=this;if(this.checkInit(),this.wrappedVisual.getSubSelectionShortcuts)return this.executeSafely(function(){return n.wrappedVisual.getSubSelectionShortcuts(e,r)})},t.prototype.getSubSelectables=t.prototype.getNextSubSelectable=function(e,r){var n=this;if(this.checkInit(),this.wrappedVisual.getNextSubSelectable)return this.executeSafely(function(){return n.wrappedVisual.getNextSubSelectable(e,r)})},t.prototype.getSubSelectionStylesAsync=function(e){var r=this;return this.checkInit(),this.wrappedVisual.getSubSelectionStylesAsync?this.executeSafely(function(){return r.wrappedVisual.getSubSelectionStylesAsync(e)}):this.promiseFactory.resolve(this.getSubSelectionStyles(e))},t.prototype.getSubSelectionShortcutsAsync=t.prototype.getSubSelectablesAsync=t.prototype.onDataViewObjectChanged=t.prototype.executeSafely=t.prototype.executeSafelyAsync=function(e){return et(this,void 0,Qe,function(){var r;return tt(this,})},t.prototype.logVisualExceptionEvent=function(e){!function(t,e,r,n,i,a){var o,s,l,c,f,d=!(null==e||!e.custom),p=e||{},h=p.version,v=p.apiVersion;i.logEvent(Fh,{visualType:e.name,isCustom:d,apiVersion:v,visualName:r,instanceId:n,isDeprecated:!!e.isDeprecated,source:t.fileName,lineNumber:t.lineNumber,columnNumber:t.columnNumber,message:d?void 0:KM(t),stack:d?void 0:WM(t)}),d&&(null==a||a.logStandardizedFeatureEvent({activityAttributes:{apiMajorVersion:v&&(null===(o=Lt(v))||void 0===o?void 0:o.major),apiMinorVersion:v&&(null===(s=Lt(v))||void 0===s?void 0:s.minor),visualMajorVersion:h&&(null===(l=Lt(h))||void 0===l?void 0:l.major),visualMinorVersion:h&&(null===(c=Lt(h))||void 0===c?void 0:c.minor),isDeprecated:!(null==e||!e.isDeprecated)},activityName:El,activityStatus:"Failed",correlationId:null===(f=null==i?void 0:i.root)||void 0===f?void 0:f.id,visualId:null==e?void 0:e.name}))}(e,this.visualPlugin,this.visualName,this.instanceId,this.telemetryService,this.certifiedEventsService)},t}()),tD=function(){eturn t.prototype.init=function(e){var r=this;if(this.wrappedVisual.init)return this.trackVisualTime(function(){return r.wrappedVisual.init(e)})},t.prototype.destroy=function(){var e=this;this.wrappedVisual.destroy&&this.trackVisualTime(function(){return e.wrappedVisual.destroy()})},t.prototype.onViewModeChanged=t.prototype.onClearSelection=t.prototype.onRestoreSelection=t.prototype.canResizeTo=function(e){var r=this;if(this.wrappedVisual.canResizeTo)return this.trackVisualTime(function(){return r.wrappedVisual.canResizeTo(e)})},t.prototype.enumerateObjectInstances=function(e){var r=this;if(this.wrappedVisual.enumerateObjectInstances)return this.trackVisualTime(function(){return r.wrappedVisual.enumerateObjectInstances(e)})},t.prototype.enumerateObjectRepetition=function(){var e=this;if(this.wrappedVisual.enumerateObjectRepetition)return this.trackVisualTime(function(){return e.wrappedVisual.enumerateObjectRepetition()})},t.prototype.enumerateObjectInstancesAsync=function(e){var r=this;return this.visualAdapter.enumerateObjectInstancesAsync?this.trackVisualTime(function(){return r.visualAdapter.enumerateObjectInstancesAsync(e)}):Qe.resolve(this.enumerateObjectInstances(e))},t.prototype.enumerateObjectRepetitionAsync=function(){var e=this;return this.visualAdapter.enumerateObjectRepetitionAsync?this.trackVisualTime(function(){return e.visualAdapter.enumerateObjectRepetitionAsync()}):Qe.resolve(this.enumerateObjectRepetition())},Object.defineProperty(t.prototype,"sandbox",{get:function(){return this.visualAdapter&&this.visualAdapter.sandbox},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visualAdapter",{get:function(){return this.wrappedVisual},enumerable:!1,configurable:!0}),t.prototype.unwrap=t.prototype.visualHasMethod=t.prototype.getTelemetryInformation=function(){var e=this;if(this.wrappedVisual.getTelemetryInformation)return this.trackVisualTime(function(){return e.wrappedVisual.getTelemetryInformation()})},t.prototype.getFormattingModel=t.prototype.getFormattingModelAsync=function(){var e=this;return this.visualAdapter.getFormattingModelAsync?this.trackVisualTime(function(){return e.visualAdapter.getFormattingModelAsync()}):Qe.resolve(this.getFormattingModel())},t.prototype.resolveFormattingPlaceholder=function(e){var r=this;if(this.wrappedVisual.resolveFormattingPlaceholder)return this.trackVisualTime(function(){return r.wrappedVisual.resolveFormattingPlaceholder(e)})},t.prototype.getSubSelectionStyles=function(e){var r=this;if(this.wrappedVisual.getSubSelectionStyles)return this.trackVisualTime(function(){return r.wrappedVisual.getSubSelectionStyles(e)})},t.prototype.getSubSelectionShortcuts=function(e,r){var n=this;if(this.wrappedVisual.getSubSelectionShortcuts)return this.trackVisualTime(function(){return n.wrappedVisual.getSubSelectionShortcuts(e,r)})},t.prototype.getSubSelectables=t.prototype.getNextSubSelectable=function(e,r){var n=this;if(this.wrappedVisual.getNextSubSelectable)return this.trackVisualTime(function(){return n.wrappedVisual.getNextSubSelectable(e,r)})},t.prototype.getSubSelectionStylesAsync=function(e){var r=this;return this.wrappedVisual.getSubSelectionStylesAsync?this.trackVisualTime(function(){return r.wrappedVisual.getSubSelectionStylesAsync(e)}):Qe.resolve(this.getSubSelectionStyles(e))},t.prototype.getSubSelectionShortcutsAsync=function(e,r){var n=this;return this.wrappedVisual.getSubSelectionShortcutsAsync?this.trackVisualTime(function(){return n.wrappedVisual.getSubSelectionShortcutsAsync(e,r)}):Qe.resolve(this.getSubSelectionShortcuts(e))},t.prototype.getSubSelectablesAsync=function(e){var r=this;return this.wrappedVisual.getSubSelectablesAsync?this.trackVisualTime(:Qe.resolve(this.getSubSelectables(e))},t.prototype.onDataViewObjectChanged=t.prototype.trackVisualTime=t}(),bl=[];unction Bn(){return bl}cM.forEach(;var Yh=function(){function t(r,n,i,a,o,s){this.plugin=r,this.creator=n,this.promiseFactory=i,this.telemetryService=a,this.module=o,this.certifiedEventsService=s,this.initialized=!1,this.destroyed=!1,this.isPluginInError=!1,u.assertValue(r,"plugin"),u.assertValue(n||this.plugin.createES6,"creator"),u.assertValue(i,"promiseFactory"),u.assertAnyValue(this.telemetryService,"telemetryService"),u.assertAnyValue(o,"module"),u.assertAnyValue(this.certifiedEventsService,"certifiedEventsService");var l=r.apiVersion,c=this.getVersionIndex(l);l?c>-1?(this.apiVersionIndex=c,this.legacy=!1):(u.assertFail("The API version '"+l+"' is invalid."),this.isPluginInError=!0):this.legacy=!0}var e;return t.prototype.init=function(r){return et(this,void 0,Qe,function(){return tt(this,})},t.prototype.initImpl=function(r){return et(this,void 0,Qe,function(){var n,i,a,o,s=this;return tt(this,function(l){switch(l.label){case 0:return u.assert(function(){return!s.initialized},"Unexpected `init` after already initialized"),u.assertValue(r.element,"options.element"),u.assertValue(r.host,"options.host"),r.element.empty(),r=fe(r),this.legacy?(a={module:this.module,featureSwitches:r.featureSwitches},this.plugin.createES6?(n=this,[4,this.plugin.createES6(a)]):[3,2]):[3,5];case 1:return n.visual=l.sent(),this.destroyed?[2]:[3,3];case 2:this.visual=this.creator(a),l.label=3;case 3:return[4,this.visualLegacy.init(r)];case 4:return l.sent(),this.destroyed?[2]:[3,9];case 5:return i=this.host=bl[this.apiVersionIndex].hostAdapter(r),a={element:r.element.get(0),host:i,module:this.module,featureSwitches:r.featureSwitches},this.plugin.createES6?(o=this,[4,this.plugin.createES6(a)]):[3,7];case 6:return o.visual=l.sent(),this.destroyed?[2]:[3,8];case 7:this.visual=this.creator(a),l.label=8;case 8:this.overloadMethods(),l.label=9;case 9:return this.initialized=!0,[2]}})})},t.prototype.update=function(r){return et(this,void 0,Qe,function(){var n,i=this;return tt(this,function(a){switch(a.label){case 0:return u.assertValue(function(){return i.initialized},"Expected `init` before `update`"),n=this.initializedPromise,[4,this.initializedPromise];case 1:return a.sent(),u.assert(function(){return i.initializedPromise===n},"Unexpected re-initialize during update"),this.destroyed||!this.initialized?[2]:(this.plugin.systemVisual||((r=fe(r)).visualDefinitionData=void 0,r.dataTransforms=void 0),(r.type&xt.Resize)===xt.Resize&&this.visualHasMethod("onResizing")?this.plugin.custom&&this.visualHasMethod("update")?[4,this.visualLegacy.update(r)]:[3,3]:[3,4]);case 2:if(a.sent(),this.destroyed)return[2];a.label=3;case 3:return this.onResizing(r.viewport,r.resizeMode),[3,7];case 4:return this.visualHasMethod("update")?[4,this.visualLegacy.update(r)]:[3,6];case 5:return a.sent(),this.destroyed?[2]:[3,7];case 6:(!r.type||r.type&xt.Data)&&this.onDataChanged(_.pick(r,["dataViews","operationKind"])),r.type&xt.ViewMode&&this.onViewModeChanged(r.viewMode),a.label=7;case 7:return[2]}})})},t.prototype.destroy=t.prototype.enumerateObjectInstances=function(r){if(this.visualHasMethod("enumerateObjectInstances"))return this.visualLegacy.enumerateObjectInstances(r)},t.prototype.enumerateObjectRepetition=function(){if(this.visualHasMethod("enumerateObjectRepetition"))return this.visualLegacy.enumerateObjectRepetition()},t.prototype.enumerateObjectInstancesAsync=function(r){return this.visualHasMethod("enumerateObjectInstancesAsync")?this.visualAdapter.enumerateObjectInstancesAsync(r):this.promiseFactory.resolve(this.enumerateObjectInstances(r))},t.prototype.enumerateObjectRepetitionAsync=function(){return this.visualHasMethod("enumerateObjectRepetitionAsync")?this.visualAdapter.enumerateObjectRepetitionAsync():this.promiseFactory.resolve(this.enumerateObjectRepetition())},Object.defineProperty(t.prototype,"sandbox",{get:enumerable:!1,configurable:!0}),t.prototype.onResizing=t.prototype.onDataChanged=function(r){this.visualHasMethod("onDataChanged")&&this.visualLegacy.onDataChanged(r)},t.prototype.onViewModeChanged=function(r){this.visualHasMethod("onViewModeChanged")&&this.visualLegacy.onViewModeChanged(r)},t.prototype.onSelectionStateChanged=t.prototype.onClearSelection=t.prototype.onRestoreSelection=function(r){if(this.visualHasMethod("onRestoreSelection"))return this.visualLegacy.onRestoreSelection(r)},t.prototype.canResizeTo=function(r){if(this.visualHasMethod("canResizeTo"))return this.visualLegacy.canResizeTo(r)},t.prototype.unwrap=function(){return this.visual},t.prototype.getTelemetryInformation=function(){if(this.visualHasMethod("getTelemetryInformation"))return this.visualLegacy.getTelemetryInformation()},t.prototype.getFormattingModel=t.prototype.getFormattingModelAsync=t.prototype.resolveFormattingPlaceholder=function(r){if(this.visualHasMethod("resolveFormattingPlaceholder"))return this.visualLegacy.resolveFormattingPlaceholder(r)},t.prototype.getSubSelectionStyles=function(r){if(this.visualHasMethod("getSubSelectionStyles"))return this.visualAdapter.getSubSelectionStyles(r)},t.prototype.getSubSelectionShortcuts=function(r,n){if(this.visualHasMethod("getSubSelectionShortcuts"))return this.visualAdapter.getSubSelectionShortcuts(r,n)},t.prototype.getSubSelectables=t.prototype.getNextSubSelectable=function(r,n){if(this.visualHasMethod("getNextSubSelectable"))return this.visualAdapter.getNextSubSelectable(r,n)},t.prototype.getSubSelectionStylesAsync=function(r){return this.visualHasMethod("getSubSelectionStylesAsync")?this.visualAdapter.getSubSelectionStylesAsync(r):this.promiseFactory.resolve(this.getSubSelectionStyles(r))},t.prototype.getSubSelectionShortcutsAsync=t.prototype.getSubSelectablesAsync=t.prototype.onDataViewObjectChanged=Object.defineProperty(t.prototype,"visualNew",{get:enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visualLegacy",{get:enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visualAdapter",{get:function(){return this.visual},enumerable:!1,configurable:!0}),t.prototype.visualHasMethod=function(r){var n=this.legacy?this.visualLegacy:this.visualNew;return this.plugin.name)?n&&_.isFunction(n[r])&&n.visualHasMethod(r):n&&_.isFunction(n[r])},t.prototype.getVersionIndex=t.prototype.overloadMethods=t.prototype.getCompiledOverloads=Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",Object)],t.prototype,"enumerateObjectInstancesAsync",null),Q([j(),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Object)],t.prototype,"enumerateObjectRepetitionAsync",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object,Number]),M("design:returntype",void 0)],t.prototype,"onResizing",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"onDataChanged",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Number]),M("design:returntype",void 0)],t.prototype,"onViewModeChanged",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Boolean]),M("design:returntype",void 0)],t.prototype,"onSelectionStateChanged",null),Q([j(),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",void 0)],t.prototype,"onClearSelection",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",Boolean)],t.prototype,"canResizeTo",null),Q([j(),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Object)],t.prototype,"getTelemetryInformation",null),Q([j(),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Object)],t.prototype,"getFormattingModelAsync",null),Q([j(),M("design:type",Function),M("design:paramtypes",["function"==typeof(e="undefined"!=typeof TFormattingPlaceholder&&TFormattingPlaceholder)?e:Object]),M("design:returntype",Object)],t.prototype,"resolveFormattingPlaceholder",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Array]),M("design:returntype",Object)],t.prototype,"getSubSelectionStyles",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Array,String]),M("design:returntype",Array)],t.prototype,"getSubSelectionShortcuts",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Number]),M("design:returntype",Array)],t.prototype,"getSubSelectables",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object,Boolean]),M("design:returntype",Object)],t.prototype,"getNextSubSelectable",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Array]),M("design:returntype",Object)],t.prototype,"getSubSelectionStylesAsync",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Array,String]),M("design:returntype",Object)],t.prototype,"getSubSelectionShortcutsAsync",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Number]),M("design:returntype",Object)],t.prototype,"getSubSelectablesAsync",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Array,Number]),M("design:returntype",Array)],t.prototype,"onDataViewObjectChanged",null),t}();ar $h=!1;!function(){if(!$h){var t=no;ca().createColorAllocatorFactory=function(){return t()},$h=!0}}();var sD=);unction wl(t){switch(t.strategy){case ad:return;case od:return t.color;case Xs:u.assertFail("getColorFromNullStrategy - called with asZero");break;default:u.assertFail("getColorFromNullStrategy - Unexpected null strategy: "+t.strategy)}}var uD=function(){function t(e,r){this.options=e,this.source=r,u.assertValue(e,"options"),u.assertValue(r,"source");var n=e.min,i=e.max;this.scale=ti([n.value,i.value],[n.color,i.color],!0)}return t.prototype.color=function(e){var r=this.options.nullColoringStrategy;if(null===e&&r){if(!Vl(r))return wl(r);e=0}return this.scale(e)},t.prototype.getRule=function(){return{linearGradient2:this.options}},t.prototype.getSource=function(){return this.source},t}(),lD=function(){function t(e,r){this.options=e,this.source=r,u.assertValue(e,"options"),u.assertValue(r,"source"),this.options=e;var n=e.min,i=e.mid,a=e.max;this.scale=ti([n.value,i.value,a.value],[n.color,i.color,a.color],!0)}return t.prototype.color=t.prototype.getRule=function(){return{linearGradient3:this.options}},t.prototype.getSource=function(){return this.source},t}(),cD=function(){function t(e,r){this.options=e,this.source=r,u.assertValue(e,"options"),u.assertValue(r,"source"),this.options=e;var n=e.min,i=e.mid,a=e.max;this.scale1=ti([n.value,i.value],[n.color,i.color],!0),this.scale2=ti([i.value,a.value],[i.color,a.color],!0)}return t.prototype.color=t.prototype.getRule=t.prototype.getSource=function(){return this.source},t}(),dD=function(){function t(e,r){if(u.assertValue(e,"plugins"),r){var n=function(o){u.assert("plugin extension type '".concat(o,"' extends a plugin '").concat(r[o].extends,"' which doesn't exist")),u.assert("Cannot register plugin extension type '".concat(o,"'. A plugin with that name already exists."))};for(var i in r)n(i)}this.plugins=e,this.extensions=r||{}}return t.prototype.getPlugin=t.prototype.getExtension=function(e){return this.extensions[e]},t}();function io(t){return u.assertValue(t,"reference"),Zh(t.type)}ar gD=function(){function t(e,r){u.assertValue(e,"factory"),u.assertValue(r,"hostServices"),this.factory=e,this.hostServices=r,this.readers={},this.queryGen={},this.schemaReaders={}}return t.prototype.reader=function(e){var r=this;return u.assertAnyValue(e,"typeOrTypes"),this.findSinglePropertyDefinition(fr(e),function(n){return n.reader(r.hostServices)},_.noop,this.readers)},t.prototype.readerType=function(e){var r=this;u.assertAnyValue(e,"typeOrTypes");var n=this.resolvePluginProperty(fr(e),function(i){return i.reader(r.hostServices)},_.noop,this.readers);return n&&n.type},t.prototype.queryGenerator=function(e){return u.assertAnyValue(e,"typeOrTypes"),this.findSinglePropertyDefinition(fr(e),_.noop,this.queryGen)},t.prototype.queryExtensionLookup=function(e){u.assertAnyValue(e,"referenceOrReferences");var r=fr(e),n=_.chain(r).map(function(o){return io(o)}).uniq().value(),i=this.findSingleBasePropertyDefinition(n,function(o){return o.queryExtensionProvider&&ev(o.name,r,o.queryExtensionProvider)});return this.findSingleExtensionPropertyDefinition(n,,i)},t.prototype.schemaReader=function(e){var r=this;return u.assertAnyValue(e,"type"),this.findSinglePropertyDefinition([e],function(n){return n.schemaReader&&n.schemaReader(r.hostServices)},this.schemaReaders)},t.prototype.getCacheKey=function(e){var r=fr(e);return r.length<2?r[0]:"["+r.join(",")+"]"},t.prototype.findSinglePropertyDefinition=t.prototype.findSingleExtensionPropertyDefinition=t.prototype.findSingleBasePropertyDefinition=t.prototype.resolvePluginProperty=t.prototype.resolveProperty=t}();function ev(t,e,r){for(var n=[],i=0,a=e;i<a.length;i++){var o=a[i],s=io(o);s===t&&n.push(o[s])}return r(n)}var tv={},ao=);ar nv=!1;unction CD(t,e,r){return void 0===e&&(e=3),void 0===r&&(r=0),function(n,i,a){u.assertValue(n,"target"),u.assertValue(i,"propertyKey");var o=a.value;return a.value=function(){for(var s=this,l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];u.assert(function(){return!_.isEmpty(t)},"eventName"),u.assert("activityAction");for(var f=SD();!(f==window.top||f.featureSwitchService&&f.telemetryService);)f=f.parent;var v,d=f.featureSwitchService,p=f.telemetryService,h=!1;if(d&&d.isFeatureSwitchesRegistered()&&d.featureSwitches&&d.featureSwitches.telemetryV2&&p||(h=!0),h)return v=o.apply(this,l);var g=Zone&&Zone.current,y=g&&g.get("data"),m=y&&y.monitoredActivity;ee(e,1)&&(m=p.startMonitoredActivity(m,t,{baseVersion:"v2",isFireAndForget:1===r||void 0}),g=m.currentZone),u.assertValue(g,"currentZone");try{g.run(}catch(S){if(ee(e,2))return void oo(m,S);throw S}return ee(e,2)&&(u.assert("Event name should be same as the current zone name"),v&&_.isObject(v)&&v.then&&_.isFunction(v.then)?v.then(:(u.assertValue(m,"Decorated method called without a start action"),oo(m))),v},a}}function oo(t,e){u.assertValue(t,"Decorated method called without a start action"),t&&(e?t.reject(e):t.resolve())}!);var t,zn=(t={},window.powerbi||(window.powerbi={}),window.powerbi.visuals||(window.powerbi.visuals={}),window.powerbi.visuals.plugins?t=window.powerbi.visuals.plugins:window.powerbi.visuals.plugins=t,t),At={}),iv="PBI.ApprovedResource.FailLoaded",av=(O[iv]=q(iv),"PBI.ApprovedResource.SuccessfulLoad"),ov=(O[av]=q(av),"PBI.ApprovedResource.EndpointDown"),sv=(O[ov]=q(ov),"PBI.ApproveResource.LoadResourcePackage"),uv=(O[sv]=q(sv),"PBI.AppSourceResource.EndpointDown"),lv=(O[uv]=q(uv),"PBI.VisualConsent.Register"),cv=(O[lv]=q(lv),"PBI.VisualConsent.Set"),fv=(O[cv]=q(cv),"PBI.VisualConsent.Get"),dv=(O[fv]=q(fv),"PBI.VisualEvent.DownloadContentEvent"),pv=(O[dv]=q(dv),"PBI.TrustedVisual.Load"),hv=(O[pv]=q(pv),"PBI.TrustedVisual.GetConsent"),vv=(O[hv]=q(hv),"PBI.VisualAuthentication.GetResourceUrl"),gv=(O[vv]=q(vv),"PBI.VisualAuthentication.GetAADToken"),yv=(O[gv]=q(gv),"PBI.VisualAuthentication.GetWACToken"),xl=(O[yv]=q(yv),"PBI.LocalResource.LoadResourcePackageItem"),mv=(O[xl]=q(xl),"PBI.VisualAuthentication.BlockAccessToken"),Sv=(O[mv]=q(mv),"PBI.AdminControl.Initialized"),Ev=(O[Sv]=q(Sv),"PBI.Pbiviz.UnzipFailed"),Cv=(O[Ev]=q(Ev),"PBI.CustomVisualsLicense.LicensesLoaded"),bv=(O[Cv]=q(Cv),"PBI.CustomVisualsLicense.GetServicePlansCalled"),Vv=(O[bv]=q(bv),"PBI.CustomVisualsLicense.PrefetchServicePlansCalled"),wv=(O[Vv]=q(Vv),"PBI.VisualEvent.LocalStorageV2Event"),xv=(O[wv]=q(wv),"PBI.VisualEvent.AcquireAADToken"),On=(O[xv]=q(xv),{});function so(t,e){var r=yl[t]||e;return u.assertValue(r,"Invalid package name for resource package"),r}[At.BaseTheme]=function(t){return"BaseThemes/".concat(t,".json")},On[At.CustomTheme]=function(t){return"BuiltInThemes/".concat(t,".json")},On[At.HighContrastTheme]=function(t){return"HighContrastThemes/".concat(t,".json")},On[At.Image]=On[At.ShapeMap]=function(t){return"Shapemaps/".concat(t,".json")};var DD=["displayName","description","placeHolderText"],AD={get:function(e){return e},getOptional:function(e){return e},format:function(e){return e}};function uo(t){t.apiVersion?function(t){!function(t){t&&(function(t){for(var e in t){var r=t[e];if(r){var n=r.properties;if(n)for(var i in n){var a=n[i];if(a){var o=a.type;o&&o.enumeration&&(o.enumeration=$s(o.enumeration))}}}}}(t.objects),t.dataRoles),t.dataViewMappings))}(t.capabilities)}(t):function(t){!function(t){t&&(function(t){for(var e in t){var r=t[e];if(r){var n=(r=t[e]=_.mapValues(r,lo)).properties;if(n)for(var i in n){var a=n[i];if(a){var o=(a=n[i]=_.mapValues(a,lo)).type;if(o&&o.enumeration&&_.isFunction(o.enumeration.members)){var s=o.enumeration.members().map(function(l){return _.mapValues(l,lo)});o.enumeration=$s(s)}}}}}}(t.objects),t.dataRoles))}(t.capabilities)}(t)}function Dv(t){switch(t.toLowerCase()){case"grouping":case rt.Grouping.toString():return rt.Grouping;case"measure":case rt.Measure.toString():return rt.Measure;case"groupingormeasure":case rt.GroupingOrMeasure.toString():return rt.GroupingOrMeasure}}function lo(t,e){return _.isString(t)||-1===_.indexOf(DD,e)?t:Dr(t,AD)}function co(t,e,r,n){void 0===r&&(r=!1),void 0===n&&(n=null);var i={major:1,minor:8,patch:0},a=document.createElement("script");a.innerHTML=r?n&&nn(n,i)||sh(n,i)?function(t){return"\n                (function(powerbi) {\n                    var window = this;\n\n                    //These 2 lines are needed to trick lodash into using this as global scope\n                    var self = this;\n                    self.Object = Object;\n\n                    //de-reference powerbi loaded modules\n                    var $, jQuery, _;\n                    window.jQuery = window.$ = undefined;\n                    window._ = undefined;\n\n                    ".concat(t,";\n\n                    //overwrite global variables with window values for PowerBI libraries\n                    $ = jQuery = window.$;\n                    _ = window._\n                }).call(\n                    //generate isolated clone of window object\n                    (function(w) {\n                        var wKeys = Object.getOwnPropertyNames(w);\n                        var nextW = w;\n                        while ((nextW = Object.getPrototypeOf(nextW))) {\n                            wKeys = wKeys.concat(Object.getOwnPropertyNames(nextW));\n                        }\n                        var newWindow = Object.create(w);\n                        //rebuild some of the window properties so they work correctly\n                        for (var i = 0; i < wKeys.length; i++) {\n                            try {\n                                var key = wKeys[i];\n                                var item = w[key];\n                                //rebind native functions to proper window context\n                                if (typeof item === 'function') {\n                                    if ((/\\{\\s*\\[native code\\]\\s*\\}/).test('' + Function.prototype.toString.call(item))) {\n                                        newWindow[key] = item.bind(w);\n                                        //remap prototype\n                                        newWindow[key].prototype = item.prototype;\n                                        //remap own properties\n                                        var fKeys = Object.getOwnPropertyNames(item);\n                                        for (var j = 0; j < fKeys.length; j++) {\n                                            var fKey = fKeys[j];\n                                            if(fKey === 'arguments' || fKey === 'caller') continue;\n                                            try {\n                                                newWindow[key][fKey] = item[fKey];\n                                            } catch (e) { /* catch protected function properties */}\n                                        }\n                                    }\n                                //map getters to proper context (needed for firefox only)\n                                } else if (typeof item === 'object') {\n                                \t\tif (key ===\"window\" || key === \"self\"){\n                                            Object.defineProperty(newWindow, key, {\n                                                get: (function(newWindow) {\n                                                    return function() {\n                                                        return newWindow;\n                                                    }\n                                                })(newWindow),\n                                                set: function() { }\n                                        });\n                                    } else {\n                                        Object.defineProperty(newWindow, key, {\n                                            get: (function(item) {\n                                                return function() {\n                                                    return item;\n                                                }\n                                            })(item),\n                                            set: function() { }\n                                        });\n                                    }\n                                } else if (typeof item === 'number' || typeof item === 'boolean' || typeof item === 'string') {\n                                      Object.defineProperty(newWindow, key, {\n                                          get: (function(w, keyString) {\n                                              return function() {\n                                                  return w[keyString];\n                                              }\n                                          })(w, key.toString()),\n                                          set: (function(w, keyString) {\n                                              return function(newValue) {\n                                                  w[keyString] = newValue;\n                                              }\n                                          })(w, key.toString())\n                                      });\n                                }\n                            } catch (e) { /* catch sandbox security exceptions */ }\n                        }\n                        return newWindow;\n                    })(window),\n                    powerbi || (powerbi = {})\n                );\n            ")}(e):e):e,a.id="js-"+t,a.setAttribute("name",t),document.body.appendChild(a)}unction po(t,e){u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t&&(an(t,e,"CategoricalCategory"),Vt(t,e,"CategoricalCategory"),Ai(t,e,"CategoricalCategory"),on(t,e))}function Al(t,e){if(u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t){an(t,e,"CategoricalValue"),Vt(t,e,"CategoricalValue"),Ai(t,e,"CategoricalValue");var r=t.group;if(r)for(var n=0,i=r.select;n<i.length;n++){var a=i[n];an(a,e,"CategoricalValueGroup"),Vt(a,e,"CategoricalValueGroup")}}}function Tl(t,e){!function(t,e,r){if(u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t){Vt(t,e,r),function(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.select;if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];an(o,e,r),Vt(o,e,r),KD(o,e,r)}}(t,e,r),on(t,e);var n=t.values;if(!n)return;Vt(n,e,"MatrixRowsScopedValue"),Ai(n,e,"MatrixRowsScopedValue")}}(t,e,"MatrixRowsGroup")}function Av(t,e){!function(t,e,r){u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t&&(Vt(t,e,r),Ai(t,e,r),on(t,e))}(t,e,"MatrixIntersection")}function an(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.bind;n&&e.visitRole(n.to,r)}function Vt(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.for;n&&e.visitRole(n.in,r)}function KD(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.composite;if(n){e.enterComposite&&e.enterComposite();for(var i=0,a=n;i<a.length;i++){var o=a[i];an(o,e,r),Vt(o,e,r)}e.exitComposite&&e.exitComposite()}}function Ai(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.select;if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];an(o,e,r),Vt(o,e,r)}}function on(t,e){if(u.assertValue(t,"mapping"),u.assertValue(e,"visitor"),e.visitReduction){var r=t.dataReductionAlgorithm;r&&e.visitReduction(r)}}ar un=function(){eturn t.prototype.visitRole=t.fromMatrixRows=function(e,r){var n=new this(r);return Tl(e,n),n.roleNames},t.fromMatrixColumns=function(e){var r=new this;return Tl(e,r),r.roleNames},t.fromMatrixValues=function(e){var r=new this;return Av(e,r),r.roleNames},t.FromCategoricalValues=function(e){var r=new this;return Al(e,r),r.roleNames},t.fromCategoricalCategories=function(e){var r=new this;return po(e,r),r.roleNames},t}();function _v(t,e){if(u.assertValue(t,"categoricalRoleMappings"),u.assertValue(e,"rolesGetter"),0!==_.size(t)){var r=_.map(t,function(i){return e(i)}),n=r[0];if(!(r.length>=2)||_.every(r,function(i){return xe(i,n,}))return n}}function Fv(t){if(u.assertValue(t,"categoricalRoleMapping"),!t.categories)return[];var e=[];return po(t.categories,{visitRole:function(n){e.push(n)}}),e}function Ti(t){if(u.assertAnyValue(t,"roleMappings"),!t)return 0;for(var e=0,r=0,n=t;r<n.length;r++){var i=n[r];i.categorical&&(e|=1),i.matrix&&(e|=2),i.single&&(e|=8),i.table&&(e|=8),i.tree&&(e|=16)}return e}nction ze(t,e){var r;if(e)return t&&(r=t[e.propertyIdentifier.objectName]),Pu(r,e.propertyIdentifier.propertyName,e.defaultValue)}unction ho(t,e){var r=function(t){return{ar:"ar-SA",bg:"bg-BG",ca:"ca-ES",cs:"cs-CZ",da:"da-DK",de:"de-DE",el:"el-GR","en-US":"en-US",es:"es-ES",et:"et-EE",eu:"eu-ES",fi:"fi-FI",fr:"fr-FR",gl:"gl-ES",he:"he-IL",hi:"hi-IN",hr:"hr-HR",hu:"hu-HU",id:"id-ID",it:"it-IT",ja:"ja-JP",kk:"kk-KZ",ko:"ko-KR",lt:"lt-LT",lv:"lv-LV",ms:"ms-MY",no:"nb-NO",nl:"nl-NL",pl:"pl-PL",br:"pt-BR",pt:"pt-PT",ro:"ro-RO",ru:"ru-RU",sk:"sk-SK",si:"sl-SI","sr-Cyrl":"sr-Cyrl-RS","sr-Latn":"sr-Latn-RS",sv:"sv-SE",th:"th-TH",tr:"tr-TR",uk:"uk-UA",vi:"vi-VN","zh-Hans":"zh-CN","zh-Hant":"zh-TW"}[t]||t||navigator.language}(e);return t&&t.stringResources?t.stringResources[r]:null} Bv,mA=function(){function t(e){this.promiseFactory=e}return t.prototype.get=function(e,r,n){return u.assertFail("Referenced omitted sharedResourceItemProxy"),this.promiseFactory.reject()},t.prototype.getBlob=function(e,r,n){return u.assertFail("Referenced omitted sharedResourceItemProxy"),this.promiseFactory.reject()},t}(),SA=function(){eturn t.prototype.loadTrustedResourcePackages=function(e){return u.assertFail("Not supported"),this.promiseFactory.reject()},t.prototype.loadResourcePackages=function(e){u.assertValue(e,"resourcePackages");for(var r=[],n=0,i=e;n<i.length;n++)r.push(this.loadResourcePackage(i[n]));return this.promiseFactory.all(r)},t.prototype.loadResourcePackage=function(e){u.assertValue(e,"resourcePackage");var r=[];if(e&&e.items)for(var n=0,i=e.items;n<i.length;n++)r.push(this.loadCustomVisualResourcePackageItem(i[n],e));return this.promiseFactory.all(r)},t.prototype.loadResourcePackageItem=function(e,r){var n=function(t,e){return u.assertAnyValue(t,"It's possible it doesn't exist, lodash returns undefined for us."),_.find(t&&t.items,function(r){return r.name===e})}(e,r);return n?n.content?this.promiseFactory.resolve(n.content):this.loadBlob(e.id,e.name,n):(nt.warning("loadResourcePackageItem: item not found in package"),this.promiseFactory.resolve(null))},t.prototype.loadSharedResource=function(e,r){return r===At.Image?this.sharedResourceItemProxy.getBlob(null,so(2),e,{retries:1}):this.sharedResourceItemProxy.get(null,so(2),e,{retries:1})},t.prototype.loadVisualPlugin=function(e){var r=this;u.assertValue(e,"resourcePackage");var n=this.promiseFactory.defer();return e&&e.items&&e.items.length>0?this.loadResourcePackage(e).then(function(){var i=zn[e.name];i?(i.iconUrl=r.getIconUrl(e),n.resolve(i)):n.reject("Unable to load visual plugin from resource package")}).catch(function(){n.reject("failed to resolve all promises")}):n.resolve(null),n.promise},t.prototype.destroy=function(){},t.prototype.loadVisualPlugins=function(e){u.assertValue(e,"resourcePackages");var r=[];if(e)for(var n=0,i=e;n<i.length;n++)r.push(this.loadVisualPlugin(i[n]));return this.promiseFactory.all(r)},t.prototype.getIconUrl=t.prototype.loadCustomVisualResourcePackageItem=function(e,r){switch(e.type){case At.CustomVisualJavascript:return this.loadCustomVisualJS(r.id,r.name,e);case At.CustomVisualsCss:return this.loadCustomVisualCss(r.id,r.name,e);case At.CustomVisualMetadata:return this.loadCustomVisualMetadata(r.id,r.name,e)}},t.prototype.loadCustomVisualJS=function(e,r,n){var i=this,a=this.promiseFactory.defer();return n.content?(co(r,n.content),a.resolve(n.content)):(u.assertValue(this.provider,"resourceItemProxy is undefined"),this.provider.get(e,r,n.path,{retries:1}).then(function(o){co(r,o),n.content=o,i.transformPlugin(r).then(function(){return a.resolve(o)},function(s){return a.reject(s)})}).catch(function(o){a.reject(o)})),a.promise},t.prototype.transformPlugin=function(e){var r=zn[e];return r?(uo(r),this.promiseFactory.resolve()):this.promiseFactory.reject("Unable to load visual plugin from resource package: "+e)},t.prototype.loadCustomVisualCss=function(e,r,n){var i=this.promiseFactory.defer();return n.content?(fo(r,n.content),i.resolve(n.content)):(u.assertValue(this.provider,"resourceItemProxy is undefined"),this.provider.get(e,r,n.path,{retries:1}).then(function(a){fo(r,a),n.content=a,i.resolve(a)}).catch(function(a){i.reject(a)})),i.promise},t.prototype.loadCustomVisualMetadata=t.prototype.createPlugin=function(e,r){u.assertAnyValue(r,"pbivizJsonString");var n=r;"object"!=typeof r&&(n=JSON.parse(r));var i=function(t,e,r){u.assertAnyValue(t,"pbivizjson"),u.assertAnyValue(t.content,"content"),u.assertAnyValue(t.content.iconBase64,"iconBase64"),t=e?hA(t,e):t;var n=e?ho(t,e):null,i=ho(t,"en-US"),o={name:t.visual.guid,apiVersion:t.apiVersion,class:t.visual.visualClassName,displayName:t.visual.displayName,capabilities:t.capabilities,custom:!0,iconUrl:'url("'+t.content.iconBase64+'")',content:t.content,version:t.visual.version,create:function(){return null},customizeQuery:localizationResources:n||i?{enUSStrings:i,localizedStrings:n}:null,supportUrl:t.visual.supportUrl,source:0,publisher:t.author?t.author.name:void 0};return t.capabilities&&(t.capabilities.subtotals||t.capabilities.dataReductionCustomization)&&(o.customizeQuery=function(s){return function(t,e){e&&e.subtotals&&e.subtotals.matrix&&e.subtotals)&&function(t,e){u.assert(function(){return!!t},"options not defined"),u.assert("dataViewMappings not defined");var r=t.dataViewMappings[0];if(r&&r.matrix&&r.metadata){var n=r.matrix;((r,n,e),r,n,e)}}(t,e.subtotals.matrix),e&&e.dataReductionCustomization&&function(t,e){var r,n,i,a,o,s,l,c,f,d,p,h,v,g=null===(r=null==t?void 0:t.dataViewMappings)||void 0===r?void 0:r[0],y=null===(n=null==g?void 0:g.metadata)||void 0===n?void 0:n.objects,m=Ti(t.dataViewMappings);if(function(t,e,r){var n=!0;if(!e||!e.dataReductionCustomization)return!1;switch(t){case 2:if(r.matrix){var i=ze(e,r.matrix.rowCount),a=ze(e,r.matrix.columnCount);void 0!==i&&(n=n&&i>=15&&i<=3e4),void 0!==a&&(n=n&&a>=1&&a<=2e3)}break;case 8:r.table&&void 0!==(i=ze(e,r.table.rowCount))&&(n=n&&i>=15&&i<=3e4);break;case 1:if(r.categorical){var o=ze(e,r.categorical.categoryCount),s=ze(e,r.categorical.groupedValuesCount);void 0!==o&&(n=n&&o>=15&&o<=3e4),void 0!==s&&(n=n&&s>=1&&s<=2e3)}}return n}(m,y,e))switch(m){case 2:var E=ze(y,e.matrix.rowCount),C=ze(y,e.matrix.columnCount),b=null===(a=null===(i=g.matrix)||void 0===i?void 0:i.columns)||void 0===a?void 0:a.dataReductionAlgorithm,V=null===(s=null===(o=g.matrix)||void 0===o?void 0:o.rows)||void 0===s?void 0:s.dataReductionAlgorithm;C&&b&&(b[Ii(b)].count=C),E&&V&&(V[Ii(V)].count=E);break;case 8:E=ze(y,e.table.rowCount),V=null===(c=null===(l=null==g?void 0:g.table)||void 0===l?void 0:l.rows)||void 0===c?void 0:c.dataReductionAlgorithm,E&&V&&(V[Ii(V)].count=E);break;case 1:var D=ze(y,e.categorical.categoryCount),A=ze(y,e.categorical.groupedValuesCount);b=null===(p=null===(d=null===(f=null==g?void 0:g.categorical)||void 0===f?void 0:f.values)||void 0===d?void 0:d.group)||void 0===p?void 0:p.dataReductionAlgorithm,V=null===(v=null===(h=null==g?void 0:g.categorical)||void 0===h?void 0:h.categories)||void 0===v?void 0:v.dataReductionAlgorithm,A&&b&&(b[Ii(b)].count=A),D&&V&&(V[Ii(V)].count=D)}}(t,e.dataReductionCustomization)}(s,t.capabilities)}),o}(n,this.locale);uo(i);var a=zn[i.name];return a&&!a.custom&&(i.custom=!1),a&&(i.favoriteId=a.favoriteId,i.isOutOfBox=a.isOutOfBox),zn[i.name]=i,i},t.prototype.loadBlob=Q([CD(xl),M("design:type",Function),M("design:paramtypes",[Object,String]),M("design:returntype",Object)],t.prototype,"loadResourcePackageItem",null),t}(),CA=),bA=function(){function t(e,r){this.certifiedEventsService=e,this.event=_.cloneDeep(r),this.event.operationStartTime=Mt()}return t.prototype.setAttributes=function(e){this.event.activityAttributes=de({},e)},t.prototype.setAttribute=t.prototype.getAttributes=t.prototype.complete=function(e,r){this.event.resultCode=r,this.event.activityStatus=e,this.event.operationEndTime=Mt(),this.certifiedEventsService.logTimedStandardizedFeatureEvent(this.event)},t}(),MA=function(){function t(e){this.windowMessageProxy=e}return t.prototype.getOpenActivityById=function(e){},t.prototype.suspend=function(){},t.prototype.resume=function(){},t.prototype.flush=function(){},t.prototype.restart=function(){},t.prototype.stopActivity=function(e,r,n){},t.prototype.startPerfEventDeprecated=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={info:{}};return new zt(o)},t.prototype.logEvent=function(e,r){return u.assert("Parameters has to be an object and instance of some telemetry factory arguments"),e===Uh?this.windowMessageProxy.postMessageAsync({eventName:"logEvent",arguments:["VisualApiUsage",r]}):e===Fh?this.windowMessageProxy.postMessageAsync({eventName:"logEvent",arguments:["VisualException",r]}):u.assertFail("Unknown eventFactory name ["+e+"]: sandboxTelemetryProxyService.ts#logEvent"),null},t.prototype.logTelemetryData=function(e,r,n){return null},t.prototype.logChildEvent=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i]},t.prototype.startActivity=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={info:{}};return new zt(o)},t.prototype.startChildActivity=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i]},t.prototype.startEvent=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a={info:{}};return new zt(a)},t.prototype.startMonitoredActivity=function(e,r,n){var a={info:{}};return{activityEvent:a,activityDeferred:new zt(a)}},t.prototype.startChildEvent=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={info:{}};return new zt(o)},t.prototype.logTrace=function(e){},Object.defineProperty(t.prototype,"sessionId",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appInstanceId",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){},enumerable:!1,configurable:!0}),t.prototype.setHostInfo=function(e,r){},t.prototype.getHostData=function(){},t.prototype.setExpAssignmentContext=function(e){},t}(),zt=function(){function t(e){var r=this;u.assertValue(e,"event"),this.event=e,this.promise=new Qe(}return t.prototype.resolve=t.prototype.cancel=t.prototype.reject=t.prototype.isActive=t}(),AA=);function Fi(t){return new zv(t)}var zv=function(){function t(e){var r=this;this[Bv]="Promise",u.assertValue(e,"deferred"),this.deferred=e,this.state=0,e.promise.then(function(){return r.state=1},}return t.prototype.then=t.prototype.catch=function(e){return this.deferred.promise.catch(e)},t.prototype.finally=t.prototype.resolved=function(){return 1===this.state},t.prototype.rejected=function(){return 2===this.state},t.prototype.pending=t.prototype.reject=t}();Bv=Symbol.toStringTag;var Ov="PBI.Data.QueryData",qv=(O[Ov]=q(Ov),"PBI.Data.QueryCancellation"),IA=O[qv]=q(qv,{logRatio:1e-4}),Uv="PBI.Data.ClientCacheHit",Hv=O[Uv]=q(Uv,{logRatio:1e-4}),Gv="PBI.Data.GetConceptualSchema",Qv=(O[Gv]=q(Gv),"PBI.Data.ClearConceptualSchemaCache"),jv=(O[Qv]=q(Qv),"PBI.Data.ExecuteQuery"),Pl=O[jv]=q(jv),Wv="PBI.Data.DsrToDataView",_A=O[Wv]=q(Wv,{logRatio:1e-4}),ln="Client Error Code",Kv="Error Code",Jv="Error Details",Rl="HTTP Request Id",Yv=function(){function t(e){this.code=e,this.ignorable=!1,u.assertValue(e,"code")}return t.prototype.getDetails=t}(),$v={additionalInfoKey:"Rls_Unauthorized_VisualErrorTitle",additionalInfoValue:"Rls_Unauthorized_VisualErrorMessage",localizedMessage:"Rls_Unauthorized_VisualError",helpLinkInfo:{helpLink:"https://go.microsoft.com/fwlink/?LinkID=785016",helpLinkType:1}},kA={RLSNotAuthorizedForModel:$v,NotAuthorizedForImpersonation:$v},BA=function(){function t(e,r,n,i,a){this.statusCode=e,this.httpRequestId=r,this.detailedErrorCode=n,this.detailedMessage=i,this.source=a,u.assertValue(e,"httpStatusCode")}return Object.defineProperty(t.prototype,"code",{get:enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requestId",{get:function(){return this.httpRequestId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpStatusCode",{get:function(){return this.statusCode},enumerable:!1,configurable:!0}),t.prototype.getDetails=t.prototype.getGenericErrorDetails=t}(),zA=function(){eturn Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getDetails=t}(),OA=function(){function t(){}return Object.defineProperty(t.prototype,"code",{get:function(){return"EmptyData"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){return{message:e.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:e.get("InvalidDataFormat_DataFormatIsInvalid")}],debugErrorInfo:[{errorInfoKey:ln,errorInfoValue:this.code}]}},t}(),qA=function(){function t(){}return Object.defineProperty(t.prototype,"code",{get:function(){return"InvalidDataResponse"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){return{message:e.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:e.get("InvalidDataResponse_ServerError")}],debugErrorInfo:[{errorInfoKey:ln,errorInfoValue:this.code}]}},t}(),GA=function(){eturn t.prototype.execute=function(e){return u.assertValue(e,"options"),this.getReader(e.type).execute(e.query,e.kinds,e.perfId)},t.prototype.getReader=function(e){var r=this.dataReaders[e];if(r)return r;var n=this.dataReaderProvider.reader(e);return u.assertValue(n,"Could not find data reader for type: ".concat(e)),this.dataReaders[e]=new jA(e,n,this.promiseFactory,this.telemetryService)},t.prototype.stopCommunication=function(e){this.getReader(e).stopCommunication()},t.prototype.resumeCommunication=t.prototype.clearCache=t.prototype.rewriteCacheEntries=t.prototype.setLocalCacheResult=t}(),jA=function(){function t(e,r,n,i){u.assertAnyValue(e,"pluginName"),u.assertValue(r,"reader"),u.assertValue(n,"promiseFactory"),u.assertValue(i,"telemetryService"),this.name=e,this.reader=r,this.promiseFactory=n,this.telemetryService=i}return t.prototype.execute=function(e,r,n){var i=this;u.assertValue(e,"options"),u.assertAnyValue(n,"perfId");var a=this.promiseFactory.defer(e.telemetryV2Enabled),o=this.reader;if(o.execute){var s=o.execute(e,n);s.then(function(c){if(c){var f=i.transform(c,r,n,e.performanceActivity),d=f.error;if(f.performanceActivities&&d&&(d.performanceActivities=f.performanceActivities),d)return a.reject(d),void i.telemetryService.logEvent(Pl,{requestId:c.requestId,isError:!0,errorSource:"PowerBI",errorCode:d.code});a.resolve({dataReaderResult:f,dataViewSource:{data:c}})}else a.reject(new OA),i.telemetryService.logEvent(Pl,{isError:!0,errorSource:"PowerBI",errorCode:"DataProxy_EmptyData"})},function(c){a.reject(c),(!c||!c.ignorable)&&i.telemetryService.logEvent(Pl,{requestId:null==c?void 0:c.requestId,isError:!0,errorSource:"PowerBI",errorCode:c?c.code:"DataProxy_ProviderError"})}).catch(;var l=Fi(a);return l.catch(function(c){c=c||new qA,s.reject(c)}),l}return e.command?a.resolve({dataReaderResult:this.transform(e.command,r,n)}):a.reject(),Fi(a)},t.prototype.stopCommunication=function(){var e=this.reader;e.stopCommunication&&e.stopCommunication()},t.prototype.resumeCommunication=t.prototype.clearCache=t.prototype.rewriteCacheEntries=t.prototype.setLocalCacheResult=t.prototype.transform=t}(),WA=function(){function t(e,r){void 0===r&&(r={}),u.assertNonEmpty(e,"Empty roles"),this.roles=e,this.root={identityValues:null,children:[],parent:null},this.levels=[];var i=r.canCollapseRoot,a=r.collapseParentAfterRemovingChildLevel;this.supportsMerge=!!r.supportsMerge,this.canCollapseRoot=!!i,this.collapseParentAfterRemovingChildLevel=!!a}return t.prototype.updateLevels=function(e,r){if(!_.isEmpty(e)&&(0!==r||this.canCollapseRoot)){u.assert("Number of active projections cannot be greater than the number of projections");var n=e.length,i=this.levels;this.levels=new Array(n);for(var a=0;a<n;a++){var o=a>=r-1,s=i[a],l=[e[a]];s&&_.isEqual(s.queryRefs,l)?(this.levels[a]=s,s.isCollapsed=o):this.levels[a]={isCollapsed:o,queryRefs:l,toggledNodes:[]}}this.canCollapseRoot&&(0===r?this.root.isToggled=!0:delete this.root.isToggled),this.pinLevels(r)}},t.prototype.clone=t.prototype.isStateModified=t.prototype.addLevel=function(e,r){var n=this;u.assert(function(){return n.supportsMerge});var i=_.findLastIndex(this.levels,function(c){return c.isPinned}),a={isCollapsed:!0,queryRefs:[e],toggledNodes:[],isPinned:r<=i||void 0};u.assert(function(){return r<=_.size(n.levels)},"position > count of levels");for(var o=_.findIndex(this.levels,function(c){return!_.isEmpty(c.toggledNodes)},r),l=-1===o?r:o;l<_.size(this.levels);l++)this.setLevelState(l,!0);if(this.levels.splice(r,0,a),this.unlockLevels(r),a.isPinned)for(l=0;l<r;l++)delete this.levels[l].AIInformation},t.prototype.removeLevel=function(e){var n,r=this;u.assert(function(){return r.supportsMerge}),u.assert("invalid level position"),this.collapseParentAfterRemovingChildLevel&&(n=this.getVisibleDescendentsDepth(this.root,-1)),this.removeIntermediateNodes(this.root,-1,,this.levels.splice(e,1),this.collapseParentAfterRemovingChildLevel&&e>0&&e===n-1&&this.setLevelState(e-1,!0),e<_.size(this.levels)&&this.unlockLevels(e)},t.prototype.moveLevels=function(e,r,n){var i,a=this;u.assert(function(){return a.supportsMerge}),u.assert(function(){return e<_.size(a.levels)},"sourceIndex >= count of level"),u.assert(function(){return r<_.size(a.levels)},"targetIndex >= count of level");var o=_.findLastIndex(this.levels,function(p){return p.isPinned}),s=Math.min(e,r);if(r>e){u.assert("sourceIndex + count exceeds level count"),this.removeIntermediateNodes(this.root,-1,;for(var l=e;l<Math.min(e+n,_.size(this.levels));l++)this.levels[l].toggledNodes=[]}var c=this.levels.splice(e,n);(i=this.levels).splice.apply(i,me([r,0],c||[],!1));var f=_.findIndex(this.levels,r);for(l=-1===f?r:f;l<_.size(this.levels);l++)this.setLevelState(l,!0);if(this.unlockLevels(s),e>o&&r<=o?_.forEach(c,function(p){return p.isPinned=!0}):e<=o&&r>o&&_.forEach(c,,_.forEach(c,,this.levels[r].isPinned)for(l=0;l<r;l++)delete this.levels[l].AIInformation},t.prototype.getVisibleDescendentsDepth=function(e,r){var n=this.levels.length;if(u.assert("node out of bounds"),-1===r&&this.canCollapseRoot&&e.isToggled)return 0;for(var i=[e];;){if(r===n-1)return r+1;for(var a=this.levels[r]&&this.levels[r].isCollapsed,o=void 0,s=[],l=0,c=i;l<c.length;l++){var f=c[l];!a==!f.isToggled&&(s.push.apply(s,f.children||[]),o=!0)}if(o&&r++,!(s.length>0))break;i=s}for(;r<n-1&&(-1===r||!this.levels[r].isCollapsed);)r++;return r+1},t.prototype.removeIntermediateNodes=function(e,r,n){var i=this;if(n(r)){var a=!!e.isToggled!=!!this.levels[r].isCollapsed;_.pull(e.parent.children,e),_.forEach(e.children,}_.forEach(me([],e.children||[],!0),},t.prototype.cloneExpansionLevel=t.prototype.cloneExpansionNode=t.prototype.cloneExpressionList=t.prototype.setNodeState=function(e,r){var n=this;if(e&&_.isEmpty(e.data))return u.assert(function(){return n.canCollapseRoot},"Collapse to root capability is not enabled"),r?this.root.isToggled=!0:delete this.root.isToggled,this.root;var i=zp(e);if(i){for(var a=i.length,o=this.root,s=0;s<a;s++){var l=i[s],c=bi(l.expr);if(!this.ensureLevel(s,c))return;var d=Ga(l.expr);o=this.ensureChildNode(s,o,d,s===a-1?r:void 0)}if(!this.pruneNonToggledLeaf(o))return o}},t.prototype.ensureLevel=function(e,r){var n=this.levels[e];if(u.assertValue(n,"level does not exist"),n.identityKeys){if(!xe(n.identityKeys,r,H))return}else n.identityKeys=r;return n},t.prototype.ensureChildNode=function(e,r,n,i){u.assertValue(r,"parent"),u.assertValue(n,"identityValues"),u.assertValue(e>=0,"levelIdx >= 0");var a=this.levels[e];u.assertValue(a,"level does not exist");var o=this.findNodeMatchingIdentities(r.children,n);return o||r.children.push(o={children:[],identityValues:n,parent:r}),void 0!==i&&(i!==!!a.isCollapsed?(o.isToggled=!0,_.indexOf(a.toggledNodes,o)<0&&a.toggledNodes.push(o)):(delete o.isToggled,a.toggledNodes=_.filter(a.toggledNodes,function(s){return s!==o}))),o},t.prototype.pruneNonToggledLeaf=function(e){u.assertValue(e,"node");for(var r=!1;e.parent&&!e.isToggled&&_.isEmpty(e.children);)e.parent.children=_.filter(e.parent.children,,e=e.parent,r=!0;return r},t.prototype.setLevelState=function(e,r){var n=this;if(-1===e)return u.assert(function(){return n.canCollapseRoot},"Collapse to root capability is not enabled"),void(r?this.root.isToggled=!0:delete this.root.isToggled);u.assert("levelIdx");var i=this.levels[e];if(i){i.isCollapsed=r;for(var a=0,o=i.toggledNodes;a<o.length;a++){var s=o[a];delete s.isToggled,this.pruneNonToggledLeaf(s)}i.toggledNodes=[]}},t.prototype.pinLevels=function(e){var r=this;u.assert(function(){return e<=_.size(r.levels)},"Requested pinning of too many levels");for(var n=0;n<Math.min(e,_.size(this.levels));n++)this.levels[n].isPinned=!0},t.prototype.unpinLevels=function(e){var r=this;u.assert(function(){return e<_.size(r.levels)},"Level does not exist");var n=this.getVisibleDescendentsDepth(this.root,-1);u.assert("cannot unpin projected level");for(var i=Math.max(e,n-1);i<_.size(this.levels);i++)delete this.levels[i].isPinned},t.prototype.lockLevels=function(e){var r=this;u.assert("Requested locking of too many levels");for(var n=0;n<Math.min(e,_.size(this.levels));n++)this.levels[n].isLocked=!0},t.prototype.unlockLevels=function(e){var r=this;u.assert(function(){return e<_.size(r.levels)},"Level does not exist");for(var n=e;n<_.size(this.levels);n++)delete this.levels[n].isLocked},t.prototype.setAILevelInformation=function(e,r){var n=this;u.assert(function(){return e<_.size(n.levels)},"Level does not exist"),r?this.levels[e].AIInformation=_.cloneDeep(r):delete this.levels[e].AIInformation},t.prototype.getAILevelInformation=function(e){var r=this;return u.assert("Level does not exist"),_.cloneDeep(this.levels[e].AIInformation)},t.prototype.isWholeLevelExpanded=t.prototype.isHierarchyExpanded=function(){var e=this;u.assertNonEmpty(this.levels,"levels"),u.assert("Last level should be collapsed");for(var r=0;r<this.levels.length-1;r++)if(!this.isWholeLevelExpanded(r))return!1;return!0},t.prototype.isWholeLevelCollapsed=t.prototype.getNodeLevelState=function(e,r,n){if(u.assertNonEmpty(e,"identities"),u.assert(function(){return n>=0},"levelIndex >= 0"),n>=this.levels.length)return{isNodeCollapsed:!1,levelHasToggledNodes:!1};var i=e[0],a=this.ensureLevel(n,bi(i.expr));if(a){var l,o=!_.isEmpty(a.toggledNodes),s=Ga(i.expr);return r&&(l=this.findNodeMatchingIdentities(r.children,s)),1===e.length?l?{isNodeCollapsed:l.isToggled?!a.isCollapsed:a.isCollapsed,levelHasToggledNodes:o}:{isNodeCollapsed:a.isCollapsed,levelHasToggledNodes:o}:(e.splice(0,1),this.getNodeLevelState(e,l,n+1))}},t.prototype.rewrite=t.prototype.rewriteNodeExpansionState=t.prototype.findNodeMatchingIdentities=function(e,r){return _.find(e,function(n){return xe(n.identityValues,r,H)})},t}();tion vo(t){return"Icon"===t.kind}unction Pi(t){return null!=t&&"ErrorRange"===t.kind}nction ql(t,e){for(var r={data:[],id:t.id,metadata:t.metadata,order:t.order},n=0,i=t.data;n<i.length;n++){var a=i[n];if(er(a)){var o=e(a.roles);if(!_.isEmpty(o)){for(var s=0,l=o;s<l.length;s++)r.data.push(Rp(l[s]));continue}}else r.data.push(a)}return r}unction ut(t,e,r,n,i){var a;u.assertValue(e,"evalContext"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefns");for(var o,s=0,l=n;s<l.length;s++){var c=l[s],f=c.name;i&&(i.objectName=f);var d=t.run(f,e,r[f],c.properties,i);d&&(o||(o={}),o[f]?Je(o,((a={})[f]=d,a)):o[f]=d)}return o}function aT(t,e){var r;u.assertValue(t,"grouped"),u.assertAnyValue(e,"selector"),e&&e.data?r=t.data:e&&e.metadata?(t.metadata||(t.metadata=[]),r=t.metadata):(t.metadataOnce||(t.metadataOnce=[]),r=t.metadataOnce),u.assert("GroupedObjects is not defined.  Indicates malformed selector.");for(var n=0,i=r;n<i.length;n++){var a=i[n];if(St(e,a.selector))return a}var o={selector:e,objects:[]};return r.push(o),o}unction cT(t,e,r,n){n&&tg(t,e,{metadata:r},Ee(n))}unction tg(t,e,r,n){var i;if(r){var a=t.metadata;a||(a=t.metadata=[]),i=a}else{var o=t.metadataOnce;o||(o=t.metadataOnce=[{selector:r,objects:[]}]),i=o}var l,s=function(t,e){u.assertValue(t,"objects"),u.assertAnyValue(e,"selector");for(var r=0,n=t.length;r<n;r++){var i=t[r];if(St(i.selector,e))return i}}(i,r);if(s){var c=s.objects;if(l=function(t,e){u.assertValue(t,"objectDefns"),u.assertValue(e,"objectName");for(var r=0,n=t.length;r<n;r++){var i=t[r];if(i.name===e)return i}}(c,e.objectName),l){if(l.properties[e.propertyName])return}else c.push(l={name:e.objectName,properties:{}})}else i.push({selector:r,objects:[l={name:e.objectName,properties:{}}]});l.properties[e.propertyName]=n}function hT(t,e){u.assertValue(t,"metadataColumn"),u.assertValue(e,"targetRoles");var r=t.roles;return!!r&&_.some(e,function(n){return r[n]})}function vT(t,e){if(u.assertAnyValue(t,"roles"),u.assertValue(e,"targetRole"),!t||!t[e])return!1;if(_.size(t)>=2)for(var r in t)if(r!==e&&t[r])return!1;return!0}function go(t,e,r){u.assertAnyValue(t,"columnSources"),u.assertValue(e,"projectionOrdering"),u.assertAnyValue(r,"filterByRoles");var n=[];if(!_.isEmpty(t))for(var i=function(t){u.assertValue(t,"selectIndicesByProjectionOrder");for(var e={},r=0,n=t.length;r<n;r++){var i=t[r],a=e[i];a||(a=e[i]=[]),a.push(r)}return e}(e),a=0,o=t.length;a<o;a++){var s=t[a];if(!r||hT(s,r)){var l=i[s.index];if(_.isEmpty(l))n.push({metadataColumn:s,sourceIndex:a,projectionOrderIndex:void 0});else for(var c=0,f=l;c<f.length;c++)n.push({metadataColumn:s,sourceIndex:a,projectionOrderIndex:f[c]})}}return n}function ir(t,e,r){if(u.assertValue(t,"expr"),u.assertNonEmpty(e,"columns"),!jt(t))return _.find(e,;var n=_.find(e,;return n?0!==t.attributeKind?n:n.formatSource&&n.formatSource.formatString?n.formatSource.formatString:void 0:void 0}function yo(t,e){u.assertValue(t,"column"),u.assertValue(e,"aggrFunc");var r=t.aggregates;if(r)switch(e){case 3:return r.min;case 4:return r.max;case 2:return r.count;case 1:return r.average;case 6:return r.median;default:return}}function Hl(t){return new mT(t)}var mT=function(){function t(e){var r;this.dataView=e,u.assertValue(e,"dataView"),this.columnsByRole={},this.valueSources=[];var n={};if(this.dataView.values)for(var i=0,a=this.dataView.values;i<a.length;i++){var o=a[i];this.valueSources.push(o.source);var s=o.source.rootSource;s&&(n[o.source.index]=s)}(r=this.valueSources).unshift.apply(r,_.values(n))}return t.prototype.getExprColumn=function(e,r){return ir(e,this.valueSources,r?void 0:this.groupName)},t.prototype.getScopedEvalExprValue=function(e){var r=e.decomposeGlobalAggregateOfScopedExpr();if(r){var n=_.chain(this.valueSources).filter(.value(),i=ir(r.source,n);return i?yo(i,r.func):void 0}if(e.hasInnerMostScope())return this.getExprValue(e.expression);e.hasGlobalScope()?u.assertFail("Attempt to evaluate a scoped expression within the Global scope"):u.assertFail("Evaluation of Partial-Scope expressions is not supported")},t.prototype.getExprValue=function(e){var r=this.index;if(_.isNumber(r)){var n=this.dataView.values;if(n){var i=ir(e,this.valueSources,this.groupName),a=_.find(n,;if(a)return this.useHighlightValues?a.highlights[r]:a.values[r]}}},t.prototype.getRoleValues=function(e){var r=this,n=this.columnsByRole,i=n[e];if(i||(i=n[e]=function(t,e){return u.assertValue(t,"dataViewCategorical"),rg(t.values,e)||rg(t.categories,e)}(this.dataView,e)),i&&null!=this.index)return _.map(i,},t.prototype.setCurrentRowIndex=function(e){u.assertValue(e,"index"),this.index=e},t.prototype.resetCurrentRowIndex=t.prototype.setCurrentColumnGroupName=function(e){u.assertValue(void 0!==e,"groupName"),this.groupName=e},t.prototype.useHighlights=t}();function rg(t,e){if(u.assertAnyValue(t,"columns"),t){for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n],o=a.source.roles;!o||!o[e]||r.push(a)}return r}}ar ET=function(){function t(e){var r;if(u.assertValue(e,"selector"),u.assertValue(e.data,"selector.data"),this.dataParts=e.data,Fn(e))this.isWildcard=!0;else{var n=_.last(e.data);this.totalIdentity=Zt(n)?n:null,this.totalIdentity&&(this.dataParts=this.dataParts.slice(0,e.data.length-1)),this.selectorDataExprs=t.flattenDataParts(this.dataParts),this.keys=_.map(this.selectorDataExprs,function(i){return i.key}),this.totalIdentity&&(r=this.keys).push.apply(r,this.totalIdentity.exprs||[])}}return t.prototype.matches=function(e,r){if(this.isWildcard)return kp(this.dataParts[0],!_.isEmpty(r));if(e.length!==this.dataParts.length||_.isEmpty(r)&&this.totalIdentity||!_.isEmpty(r)&&!this.totalIdentity||this.totalIdentity&&!vs(this.totalIdentity.exprs,r,H))return!1;if(_.isEmpty(e)&&_.isEmpty(this.dataParts))return!0;var n=t.flattenDataParts(e);return!_.isEmpty(n)&&vs(this.selectorDataExprs,n,t.isDataExprsMatch)},t.prototype.matchesKeys=function(e,r){if(this.isWildcard)return e.length===r;var n=_.flatten(e);return 0!==this.keys.length&&0!==n.length&&this.keys.length===n.length&&vs(n,this.keys,H)},t.flattenDataParts=function(e){for(var r=[],n=0,i=e;n<i.length;n++){var a=i[n];if(Nt(a)){var o=new _n;a.expr.accept(o);for(var s=0;s<o.pairs.length;s++)r.push({value:o.values[s],key:o.keys[s]})}else if(br(a))for(var l=0,c=a.exprs;l<c.length;l++)r.push({key:c[l]});else{if(!Zt(a))return u.assertFail("unexpected Selector data item kind: "+a.kind.toString()),[];u.assertFail("Selector.matchesData: ScopeTotal should appear at the end of Selector.Data elements")}}return r},t.isDataExprsMatch=function(e,r){return u.assert("isDataExprsMatch cant have two dataExprs with values not defined. It means they are both wildcards."),e.value&&r.value?H(e.key,r.key)&&H(e.value,r.value):H(e.key,r.key)},t}(),CT=function(){function t(e){var r;if(this.selector=e,u.assertValue(this.selector,"selector"),u.assertValue(this.selector.data,"selector.data"),this.isWildcard=Fn(this.selector),this.dataParts=this.selector.data,this.keys=[],!this.isWildcard)for(var n=0,i=this.dataParts;n<i.length;n++){var o=t.getDataRepetitionIdentityKeys(i[n]);if(!o){this.keys=[];break}(r=this.keys).push.apply(r,o)}}return t.prototype.matches=function(e,r){u.assertValue(e,"identities");var n=this.dataParts,i=n.length,a=e.length,o=!_.isEmpty(r);if(o&&a++,this.isWildcard)return kp(n[0],o);if(i!==a)return!1;for(var s=0,l=e.length;s<l;s++){var c,f=e[s];if(er(c=n[s]))return u.assertFail("Selector.matchesData: RoleWildCard should be converted to ScopeWildCards before matching"),!1;if(Nt(c)){if(!Vi(c,f))return!1}else{if(!br(c))return Zt(c)?(_.isEmpty(r)||u.assertFail("Selector.matchesData: ScopeTotal should appear at the end of Selector.Data elements"),!1):(u.assertFail("unexpected Selector data item kind: "+c.kind.toString()),!1);if(!aV(c,f))return!1}}return!!_.isEmpty(r)||Zt(c=_.last(n))&&function(t,e){return!_.isEmpty(e)&&ht.sequenceEqual(t.exprs,e)}(c,r)},t.prototype.matchesKeys=function(e,r){if(u.assertValue(e,"keysList"),u.assert("expected keysList to be within the hierarchy levels"),this.isWildcard)return e.length===r;var n=_.flatten(e),i=this.keys.length;if(0===i||0===n.length||i!==n.length)return!1;for(var a=0;a<i;a++)if(!H(n[a],this.keys[a]))return!1;return!0},t.getDataRepetitionIdentityKeys=function(e){return Nt(e)?bi(e.expr):br(e)||Zt(e)?e.exprs:void(er(e)?u.assertFail("Selector.matchesData: RoleWildCard should be converted to ScopeWildCards before matching"):Vr(e)?u.assertFail("Selector.matchesData: Wildcard should match anything without identity check"):u.assertNever(e))},t}();function VT(t,e,r,n,i,a,o,s){if(u.assertValue(t,"dataViewCategorical"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"selector"),u.assertValue(n,"containsWildcard"),u.assertValue(i,"objectDefns"),t.categories&&0!==t.categories.length){var l=function(t,e,r){u.assertValue(t.categories[0],"dataViewCategorical.categories[0]");for(var n=t.categories[0].identity,i=[],a=0,o=t.categories;a<o.length;a++){var s=o[a];if(!s.identityFields||!r.matchesKeys([s.identityFields],1))return;i.push(s)}u.assert("Column length mismatch");var l=e.metadata;if(l){var c=t.values;if(c)for(var f=0,d=c.length;f<d;f++){var p=c[f];if(p.source.queryName===l){i=[p];break}}}return{columns:i,identities:n}}(t,r,a);if(l){var d,c=t),f=l.identities,p=Hl(t);if(f){for(var h,v,g=0,y=f.length;g<y;g++)if(n||a.matches([f[g]])){switch(p.setCurrentRowIndex(g),r.highlightMatching){case void 0:case 0:h=!0,v=!1;break;case 1:h=!0,v=c;break;case 2:h=!c,v=c;break;default:u.assertNever(r.highlightMatching)}if(h){p.useHighlights(!1);var S=ut(o,p,e,i,s);if(S)for(var E=0,C=l.columns;E<C.length;E++){var V=(b=C[E]).objects;V||(V=b.objects=new Array(y)),V[g]||(V[g]={}),Je(V[g],S,r.id,r.order)}d=!0}if(v){p.useHighlights(!0);var x=ut(o,p,e,i,s);if(x)for(var w=0,D=l.columns;w<D.length;w++){var b,A=(b=D[w]).highlightObjects;A||(A=b.highlightObjects=new Array(y)),A[g]||(A[g]={}),Je(A[g],x,r.id,r.order)}d=!0}if(!n)return d}return d}}}}function ng(t,e,r){return u.assertAnyValue(e,"propertyDefn"),!!(e instanceof B&&jt(e)&&0===e.attributeKind)||t,e,r)||Pi(e)||t,e,r)}function MT(t,e,r,n,i,a,o,s,l){u.assertValue(t,"dataViewCategorical"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"selector"),u.assertValue(n,"containsWildcard"),u.assertValue(i,"objectDefns");var c=t.values;if(c&&c.identityFields&&a.matchesKeys([c.identityFields],1)){var f=c.grouped();if(f){for(var v,d=Hl(t),p=r.metadata,h=ag(i,ng,l),g=0,y=f;g<y.length;g++){var m=y[g];if(void 0!==m.name){_.isEmpty(h)||(d.setCurrentColumnGroupName(m.name),TT(e,r,h,o,s,d,m,l));var S=m.values;if(n||a.matches([m.identity])){var E=ut(o,d,e,i,s);if(E)if(p)for(var C=0,b=S.length;C<b;C++){var V=S[C],x=V.source;if(x.queryName===p){var w=fe(x),D=w.objects;D||(D=w.objects={}),Je(D,E,r.id,r.order),V.source=w,v=!0;break}}else{var A=m.objects;A||(A=m.objects={}),Je(A,E,r.id,r.order),ig(c,f),v=!0}if(!n)return!0}}}return v}}}function ig(t,e){t.grouped=e?function(){return e}:function(){return function(t){u.assertValue(t,"values");for(var r,e=[],n=0,i=t.length;n<i;n++){var a=t[n];if(!r||r.identity!==a.identity){if(r={values:[]},a.identity){r.identity=a.identity;var o=a.source;void 0!==o.groupName?r.name=o.groupName:o.displayName&&(r.name=o.displayName)}e.push(r)}r.values.push(a)}return e}(t)}}function AT(t,e,r,n,i,a,o){if(u.assertValue(t,"dataViewCategorical"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"selector"),u.assertValue(n,"objectDefns"),_.isEmpty(t.categories)){var s=t.values;if(!s||_.isEmpty(s.identityFields)){var l=function(t,e){var r=e.metadata;if(void 0!==r&&t)return u.assert("Only one column has to match"),_.find(t,}(t.values,r);if(l){var c=Hl(t),f=Fn(r);if(n=ag(n,ng,o),!_.isEmpty(n)&&f){u.assert("dataViewCategorical.values.length > 0"),u.assert("There has to be max 1 row since there are no category groupings"),c.setCurrentRowIndex(0);var p=ut(i,c,e,n,a);if(p){var h=l.objects;h||(h=l.objects=[]),h[0]||(h[0]={}),Je(h[0],p,r.id,r.order)}}}}}}function TT(t,e,r,n,i,a,o,s){if(u.assertValue(t,"objectDescriptors"),u.assertValue(e,"selector"),u.assertValue(r,"objectDefns"),u.assertValue(a,"evalContext"),u.assertValue(o,"valueGrouping"),Fn(e))for(var l=o.values,e,s),c=0,f=l;c<f.length;c++){var d=f[c];u.assertValue(d.source.groupName===o.name,"targetColumn.source.groupName");for(var p=d.values.length,h=0;h<p;h++){a.setCurrentRowIndex(h),a.useHighlights(!1);var v=ut(n,a,t,r,i);if(v){var g=d.objects;g||(g=d.objects=new Array(p)),g[h]||(g[h]={}),Je(g[h],v,e.id,e.order)}if(null!=d.highlights){a.useHighlights(!0);var y=ut(n,a,t,r,i);if(y){var m=d.highlightObjects;m||(m=d.highlightObjects=new Array(p)),m[h]||(m[h]={}),Je(m[h],y,e.id,e.order)}}a.resetCurrentRowIndex()}}}function IT(t,e){return ja(e)&&(e=ql(e,function(r){return function(t,e){if(e.categories)for(var r=0,n=e.categories;r<n.length;r++){var i=n[r];if(i.source&&Ul([i.source],t))return[i.identityFields]}}(r,t)})),e}function ag(t,e,r){return u.assertValue(t,"objectDefns"),_.chain(t).map(function(n){return de(de({},n),{properties:_.pickBy(n.properties,})}).filter(.value()}unction Gl(t){return u.assertValue(t,"node"),_.isEmpty(t.children)}function So(t,e){if(u.assertAnyValue(t,"rootNodes"),u.assertValue(e,"callback"),t)if(function(t){return function(t){u.assertValue(t,"obj");for(var e=t;null!=e;){if(_.isArray(e))return!0;e=Object.getPrototypeOf(e)}return!1}(t)}(t))for(var r=0,n=t;r<n.length;r++){var i=n[r];i&&Ql(i,[],e)}else Ql(t,[],e)}function Ql(t,e,r){u.assertValue(t,"matrixNode"),u.assertValue(e,"traversalPath"),u.assertValue(r,"callback"),u.assert("pre-condition: traversalPath must not already contain matrixNode"),e.push(t);var n=r(t,e),i=null!=n&&0!==n;if(1===n){var a=t.children;if(!_.isEmpty(a))for(var o=0,s=a;o<s.length;o++){var l=s[o];if(l&&!(i=Ql(l,e,r)))break}}return u.assert("pre-condition: the callback given to forEachNodeDepthFirst() is not supposed to modify the traversalPath argument array."),e.pop(),i}function og(t,e,r){if(u.assertValue(t,"node"),u.assert(function(){return e>=0},"targetLevel >= 0"),u.assertValue(r,"callback"),t.level!==e){var n=t.children;if(n&&n.length>0)for(var i=0,a=n.length;i<a;i++)og(n[i],e,r)}else r(t)}function Ni(t,e,r){u.assertValue(t,"node"),u.assert("deepestLevelToInherit >= 0"),u.assertValue(r,"useInheritSingle");var n=t,i=void 0===t.level;if(i||t.level<=e){var o=r?N:fe,s=o(t);if((i||t.level<e)&&!_.isEmpty(t.children)){s.children=o(t.children);for(var c=0,f=s.children.length;c<f;c++)s.children[c]=Ni(s.children[c],e,r)}n=s}return n}function Eo(t){u.assertAnyValue(t,"matrixOrHierarchy");var e=!1;if(t)if(t))e=Eo(t.rows)||Eo(t.columns);else{var r=t.levels;if(!_.isEmpty(r))for(var n=0,i=r;n<i.length;n++){var a=i[n];if(a.sources&&a.sources.length>=2&&(u.assert("pre-condition: in a valid DataViewMatrix, the source columns in each of its hierarchy levels must either be all non-measure columns (i.e. a grouping level) or all measure columns (i.e. a measure headers level)"),!a.sources[0].isMeasure)){e=!0;break}}}return e}function sg(t){return u.assertValue(t,"levels"),_.map(t,}unction ki(t){return u.assertAnyValue(t,"columnHierarchyLevels"),!_.isEmpty(t)&&lg(_.last(t))}function lg(t){return u.assertAnyValue(t,"columnHierarchyLevel"),t&&_.every(t.sources,function(e){return e.isMeasure})}function Co(t){u.assertValue(t,"undefined Level");var e=t.valueSources;if(e)return u.assert("There is no support for Measures with a Scope containing any column levels"),u.assertValue(e[0],"Empty Scoped measures metadata"),e[0]}function bo(t){if(u.assertValue(t,"getNodeScopedValues called for an Undefined node"),u.assertAnyValue(t.nodeValues,"Synchronized nodes have undefined nodeValues"),t.nodeValues)return u.assert("There is no support for Measures with a Scope containing any column levels"),t.nodeValues[0]}var UT=function(){function t(e,r){if(this.dataView=e,u.assertValue(e,"dataView"),e){this.columnLeavesPath=function(t){if(u.assertAnyValue(null==t?void 0:t.children,"A Matrix with Column Totals off and all data filtered out has undefined columns root"),!t||_.isEmpty(t.children))return[];var e=[];return function(t,e){u.assertAnyValue(t,"rootNodes"),u.assertValue(e,"callback"),So(t,function(n,i){return Gl(n)&&e(0,0,i),1})}(t,,e}(e.columns.root),this.hasColumnGrouping=ug(this.dataView.columns)>0,this.valueSourcesQueryNames=_.map(e.valueSources,function(o){return o.queryName}),this.scopedValueSourcesByLevel={},this.scopedValuesQueryNamesByLevel={};var n=e.rows.levels;if(u.assertAnyValue(n,"A Matrix without Row groupings will not have a Row level"),!_.isEmpty(n))for(var i=0;i<n.length;i++){var a=Co(n[i]);this.scopedValueSourcesByLevel[i]=a,a&&(this.scopedValuesQueryNamesByLevel[i]=_.map(a,function(o){return o.queryName}))}}}return t.prototype.setAsRowNode=function(e){u.assertNonEmpty(e,"Invalid context: Empty rowPath"),this.rowPath=e,this.nodeValue=void 0,this.columnPath=void 0,this.nodeValueIndex=void 0,this.forHighlight=void 0,this.isScopedValue=!1},t.prototype.setAsColumnNode=function(e){u.assertNonEmpty(e,"Invalid context: Empty columnPath"),this.columnPath=e,this.nodeValue=void 0,this.rowPath=void 0,this.nodeValueIndex=void 0,this.forHighlight=void 0,this.isScopedValue=!1},t.prototype.setAsIntersection=function(e,r,n,i,a){void 0===a&&(a=!1),u.assertValue(e,"Invalid context: Undefined intersection"),u.assertNonEmpty(r,"Intersection context must have a rowPath"),u.assertNonEmpty(n,"Intersection context must have a columnPath"),u.assert("Intersection context must have a valid nodeValueIndex"),u.assertAnyValue(a,"By default, FALSE"),this.nodeValue=e,this.rowPath=r,this.columnPath=n,this.nodeValueIndex=i,this.forHighlight=!!a,this.isScopedValue=!1},t.prototype.setAsScopedValue=function(e,r,n,i){void 0===i&&(i=!1),u.assertValue(e,"Invalid context: Undefined intersection"),u.assertNonEmpty(r,"Intersection context must have a rowPath"),u.assertAnyValue(i,"By default, FALSE"),this.nodeValue=e,this.rowPath=r,this.columnPath=void 0,this.nodeValueIndex=n,this.forHighlight=!!i,this.isScopedValue=!0,u.assert("Scoped Values are expected to be grouped by Rows only")},t.prototype.getScopedEvalExprValue=function(e){var r=e.decomposeGlobalAggregateOfScopedExpr();if(r){var n=ir(r.source,this.getContextValueSources());return n?yo(n,r.func):void 0}if(e.hasInnerMostScope())return this.getExprValue(e.expression);e.hasGlobalScope()?u.assertFail("Attempt to evaluate a scoped expression within the Global scope"):u.assertFail("Evaluation of Partial-Scope expressions is not supported")},t.prototype.getExprValue=function(e){return u.assertValue(e,"matrixEvalContext - Undefined expr"),this.nodeValue?this.evaluateMatrixMeasure(e):this.rowPath?this.evaluateRowHeader(e):this.columnPath?this.evaluateColumnHeader(e):void u.assertFail("getExprValue - context is empty")},t.prototype.getExprColumn=t.prototype.findExprValueSourceIndex=function(e){var r=this.getContextValueSources();if(u.assertAnyValue(r,"For ScopedValues, DataView may contain cached Data without Value Sources"),!r)return-1;var n=ir(e,r);return n?r.indexOf(n):-1},t.prototype.evaluateMatrixMeasure=function(e){u.assertValue(this.rowPath,"matrixEvalContext.evaluateIntersection - Undefined this.rowNode"),u.assertValue(this.isScopedValue||this.columnPath,"matrixEvalContext.evaluateIntersection - Undefined this.columnNode");var r=this.nodeValue.valueSourceIndex||0,n=this.findExprValueSourceIndex(e);if(!(n<0)){var i;if(n===r)i=this.nodeValue;else{var a=n-r+this.nodeValueIndex,o=_.last(this.rowPath),s=this.isScopedValue?bo(o):o.values;if(!(i=null==s?void 0:s[a]))return}return this.forHighlight?i.highlight:i.value}},t.prototype.evaluateRowHeader=function(e){var r=this;u.assert(function(){return!r.columnPath},"matrixEvalContext.evaluateRowHeader - context has columnNode"),u.assert(function(){return!r.nodeValue},"matrixEvalContext.evaluateRowHeader - context has value");var n=this.findExprValueSourceIndex(e);if(!(n<0)){var a,i=_.last(this.rowPath);if(i&&(a=this.shouldConsiderScopedValues(i.level)?bo(i):i.values,u.assertAnyValue(a,"node.values or node.nodeValues may be undefined (e.g. for Synchronized Nodes) even if ValueSources exist"),a))return a[n].value}},t.prototype.evaluateColumnHeader=function(e){var r=this;u.assert(function(){return!r.rowPath},"matrixEvalContext.evaluateColumnHeader - context has rowNode"),u.assert(function(){return!r.nodeValue},"matrixEvalContext.evaluateColumnHeader - context has value"),u.assertFail("matrixEvalContext.evaluateColumnHeader - only constant exprs are supported")},t.prototype.getRoleValues=function(e){var r=this;u.assert("getRoleValues returns values for row groupings only"),u.assert("getRoleValues is unimplemented for ScopedMeasures");var n=_.last(this.rowPath);if(n&&!n.isSubtotal){for(var i=this.dataView.valueSources,a=[],o=0,s=i.length;o<s;o++)Ri(i[o],e)&&a.push(n.values[o].value);if(a.length>0)return a}},t.prototype.getDataView=function(){return this.dataView},t.prototype.getValueSourcesQueryNames=t.prototype.getScopedValueSourcesQueryNames=t.prototype.getContextValueSourcesQueryNames=function(){return this.isScopedValue?(u.assertValue(this.nodeValue,"Checking for a Scoped Measure is only supported within a ScopedMeasure value"),this.scopedValuesQueryNamesByLevel[_.last(this.rowPath).level]):this.valueSourcesQueryNames},t.prototype.getContextValueSources=function(){if(this.nodeValue)return u.assertNonEmpty(this.rowPath,"Hierarchy Root doesn't have a scope"),this.isScopedValue?this.scopedValueSourcesByLevel[this.getRowLevelIndex()]:this.dataView.valueSources;if(this.rowPath){var e=this.getRowLevelIndex();return this.shouldConsiderScopedValues(e)?this.scopedValueSourcesByLevel[e]:this.dataView.valueSources}u.assertFail(this.columnPath?"Only constant exprs are supported":"Context is empty")},t.prototype.shouldConsiderScopedValues=t.prototype.getRowLevelIndex=function(){return u.assertValue(this.rowPath,"this.rowPath"),_.last(this.rowPath).level},t}();nction dg(t,e,r,n,i,a,o,s,l){if(u.assertAnyValue(n,"dataViewMatrixHierarchy"),u.assertValue(i,"objectDescriptors"),u.assertValue(o,"selector"),u.assertValue(a,"objectDefns"),n){var c=n.root;if(c){var f=pg(t,e,r,[c],i,a,o,s,l);if(f){var d=N(n);return d.root=f,d}}}}function pg(t,e,r,n,i,a,o,s,l){return u.assertValue(e,"evalContext"),u.assertValue(n,"nodePath"),u.assertValue(i,"objectDescriptors"),u.assertValue(o,"selectorInfo"),u.assertValue(a,"objectDefns"),Gl(_.last(n))?"Rows"===t&&(o.canMatchScopedValue||o.canMatchIntersection)?function(t,e,r,n,i,a,o,s){u.assertNonEmpty(r,"evaluateDataRepetitionMatrixNodeValues - no row leaves"),u.assert("Unexpected Selector");var l=_.last(r),c=N(l),f=a.canMatchScopedValue,d=a.selector,p=f?bo(l):l.values,h=f?t.getScopedValueSourcesQueryNames(l.level)||[]:t.getValueSourcesQueryNames(),v=f?h.length:t.columnLeavesPath.length;if(!_.isEmpty(p)){p=N(p);for(var g=!1,y=function(E){var C=p[E];if(u.assertAnyValue(C,"By-Design, ValueCollection can be sparse"),!C)return"continue";var x,b=f?void 0:t.columnLeavesPath[E];if(!a.selector,h[C.valueSourceIndex||0],r,b,f,a.selectorComparer))return"continue";s&&(x={warnings:s,selector:d,targetExpr:tr(d,e)});var w=function(I){f?t.setAsScopedValue(C,r,E,I):t.setAsIntersection(C,r,b,E,I);var F=ut(o,t,n,i,x);if(F){var R=N(C);I&&!R.highlightObjects?R.highlightObjects={}:!I&&!R.objects&&(R.objects={}),Je(I?R.highlightObjects:R.objects,F,d.id,d.order),g=!0,C=p[E]=R}},D=void 0!==C.highlight;switch(d.highlightMatching){case void 0:case 0:w(!1);break;case 1:w(!1),D&&w(!0);break;case 2:w(!!D);break;default:u.assertNever(d.highlightMatching)}},m=0;m<v;m++)y(m);if(g)return f?c.nodeValues={0:p}:c.values=p,c}}(e,r,n,i,a,o,s,l):void 0:function(t,e,r,n,i,a,o,s,l){var p,c=o.selector,f=o.selectorComparer,d=e.getDataView();n[0]===d.rows.root?p=d.rows:n[0]===d.columns.root?p=d.columns:u.assertFail("dataViewTransform.evaluateDataRepetitionMatrixNodeChildren: incorrect nodePath");var h=_.last(n),v=h.children;u.assertNonEmpty(v,"evaluateDataRepetitionMatrixNodeChildren - empty children list");var g=!1,y=!1,m=h.childIdentityFields,S=[],E=v[0].level;u.assert("evaluateDataRepetitionMatrixNodeChildren: childLevel exceeding hierarchy levels");var C=d.valueSources.length>1&&p===d.columns,b=C&&E===p.levels.length-1;if(!_.isEmpty(p.levels)){var V=p.levels[E],x=V.sources;if(b){S=e.getValueSourcesQueryNames();var w=_.compact(_.map(n,function(ft){return ft.identity})),D=void 0;h.isSubtotal&&n.length>1&&(D=n[n.length-2].childIdentityFields),g=null!=o.selector.metadata&&_.some(S,&&f.matches(w,D),y=!1}else if(!_.isEmpty(m)){S=_.map(x,function(ft){return ft.queryName});var A=_.map(n,;g=null==c.metadata&&f.matchesKeys(A,p.levels.length-(C?1:0));var F=Co(V);u.assert("Scoped measures on Column nodes are not supported"),y=F&&null!=c.metadata&&null!=_.find(F,,u.assert("A Selector can't match nodes and Scoped measures")}}for(var R=!1,W=vg(h),ae=0,oe=v.length;ae<oe;ae++){var K=!1,Ce=v[ae],De=vg(Ce),be=n.concat(De),_e=!1;if(g||y){p===d.rows?g&&e.setAsRowNode(be):p===d.columns?e.setAsColumnNode(be):u.assertFail("dataViewTransform.evaluateDataRepetitionMatrixNodeChildren: incorrect nodePath");for(var se=[],Ae=0,ct=be;Ae<ct.length;Ae++){var Yn=ct[Ae];Yn.identity&&se.push(Yn.identity)}var Pr=void 0;_.isEmpty(S)||(Pr=S[Ce.levelSourceIndex||0]);var ra=void 0;if(Ce.isSubtotal&&(b?n.length>1&&(ra=n[n.length-2].childIdentityFields):ra=m),(null==c.metadata||c.metadata===Pr&&!o.isWildcard)&&f.matches(se,ra)){_e=!0;var Xn=void 0;l&&(Xn={warnings:l,selector:c,targetExpr:tr(c,r)});var na=ut(s,e,i,a,Xn);na&&(K=!0,De.objects||(De.objects={}),Je(De.objects,na,c.id,c.order))}}if(_e&&!o.isWildcard||pg(t,e,r,be,i,a,o,s,l)&&(K=!0),K&&(R=!0,W.children[ae]=De,!o.containsWildcard))break}if(R)return W}(t,e,r,n,i,a,o,s,l)}unction vg(t){if(Object.getPrototypeOf(t)!==Object.prototype)return t;var e=N(t);return t.children&&(e.children=N(t.children)),e}function gg(t,e){if(!t||!e)return[];for(var r=[],n=0,i=e.levels;n<i.length;n++){for(var o=[],s=0,l=i[n].sources;s<l.length;s++){var c=l[s];c.identityExprs&&Ul([c],t)&&o.push.apply(o,c.identityExprs||[])}_.isEmpty(o)||r.push(o)}return r}ar YT=);function jl(t){var e=t;return u.assertValue(e,"textRunDefinition"),_.isString(e.value)||Tt(e.value)||e.value instanceof B}function yg(t){var e=t;return u.assertValue(e,"textRunDefinitionGeneric"),_.isString(e.value)||function(t){return t&&t.expr}(e.value)||Tt(e.value)}function Wl(t){var e=t;return u.assertValue(e,"textRunConditionalDefinition"),_.isArray(e.cases)&&void 0!==e.defaultCase&&_.isArray(e.defaultCase.textRuns)&&Tt(e.expression)}function mg(t){var e=t;return u.assertValue(e,"conditionalDefinitionGeneric"),_.isArray(e.cases)&&void 0!==e.defaultCase&&void 0!==e.expression}function ZT(t,e){if(u.assertValue(t,"paragraph"),!_.isEmpty(t.textRuns))for(var r=0,n=t.textRuns;r<n.length;r++){var i=n[r];jl(i)?Kl(i,e):Wl(i)?eI(i,e):u.assertNever(i)}}function Kl(t,e){u.assertValue(t,"textRun"),u.assertValue(t.value,"textRun.value"),!_.isString(t.value)&&Sg(t.value,e)}function Sg(t,e){if(Tt(t))return e.visitValueRef(t);e.visitExpr(t)}function eI(t,e){u.assertValue(t,"textRunConditional"),u.assertValue(t.expression,"expression"),u.assertValue(t.defaultCase,"defaultCase"),u.assertValue(t.cases,"cases");for(var r=0,n=t.cases;r<n.length;r++)for(var a=0,o=n[r].textRuns;a<o.length;a++)Kl(o[a],e);for(var l=0,c=t.defaultCase.textRuns;l<c.length;l++)Kl(c[l],e);Tt(t.expression)&&Sg(t.expression,e)}unction tI(t){u.assertAnyValue(t,"DataViewObjectDefinition.reduce - defn can have any value.");var e=t&&t.properties;if(e){for(var r in e)_.isEmpty(e[r])&&Eg(t,r);if(!_.isEmpty(e))return t}}function Jl(t,e,r){u.assertValue(t,"defns");var n=t[e];n||(t[e]=[],n=t[e]);for(var i=0,a=n.length;i<a;i++){var o=n[i];if(St(o.selector,r))return o}return n.push({selector:r,properties:{}}),n[n.length-1]}function rI(t,e,r,n){u.assertValue(t,"defns");var i=_.find(t[e],function(a){return St(a.selector,r)});i&&(i.selector=n)}function nI(t,e,r){u.assertValue(t,"defns");var n=t[e];if(!n)return!1;var i=_.remove(n,function(a){return St(a.selector,r)}).length>0;return _.isEmpty(n)&&delete t[e],i}unction aI(t,e,r){if(u.assertValue(t,"Trying to cascade into undefined DataViewObjectDefinitions"),t&&e)for(var n in e){var i=e[n];if(i){var a=t[n];a||(a=t[n]=[]),sI(a,i,r)}}}unction sI(t,e,r){var n;if(r)t.splice.apply(t,me([0,0],e||[],!1));else for(var i=0,a=e;i<a.length;i++){var o=a[i];n=!1;for(var s=0,l=t;s<l.length;s++){var c=l[s];if(St(c.selector,o.selector)){Cg(c.properties,o.properties),n=!0;break}}if(!n){var f={selector:o.selector,properties:{}};Cg(f.properties,o.properties),t.push(f)}}}unction Yl(t,e,r,n){u.assertValue(t,"defns");var i=Bi(t,e,r),a=_.sumBy(i,;return function(t,e,r){if(null==(null==r?void 0:r.order))return!1;var n=Bi(t,e.objectName,r,{skipId:!0,skipOrder:!0}).filter(,i=_.map(n,.filter(function(d){return null!=d}).sort();i=_.uniq(i);for(var a=o=0,s=function(p){var h=_.filter(n,;if(u.assert(function(){return!!h.length},"should find definitions that match given order"),1===h.length)o=a(h[0],o);else{var v=_.findIndex(h,function(S){return St(S.selector,r)});v>=0&&(o=a(h[v],o),h.splice(v,1));for(var g=0,y=h;g<y.length;g++)o=a(y[g],o)}_.pullAll(n,h)},l=0,c=i;l<c.length;l++)s(c[l])}(t,{objectName:e,propertyName:n},r),a}function Li(t,e,r,n){u.assertValue(t,"defns"),u.assertValue(e,"propertyId"),Jl(t,e.objectName,r).properties[e.propertyName]=n}function lI(t,e,r,n,i){var a=wg(e,r);a?i?Li(t,a,n,i):Yl(t,a.objectName,n,a.propertyName):u.assertFail("Property does not have an associated format string object")}nction cI(t,e,r,n){var i=wg(e,r);if(i){var a=$l(t,i,n);if(a){if(Zl(a)&&bs(a))return a;u.assertFail("Format value is not of the expected type")}}else u.assertFail("Property does not have an associated format string object")}function Vg(t,e,r){if(u.assertAnyValue(t,"defns"),u.assertValue(e,"objectName"),u.assertAnyValue(r,"selector"),t){var n=t[e];if(n)for(var i=0,a=n.length;i<a;i++){var o=n[i];if(St(o.selector,r))return o}}}function Bi(t,e,r,n){if(u.assertAnyValue(t,"defns"),u.assertValue(e,"objectName"),u.assertAnyValue(r,"selector"),!t)return[];var i=t[e];return i?_.filter(i,function(a){return St(a.selector,r,n)}):[]}function wg(t,e){var r=ml(t,e);if(r)return r.formatStringProperty;u.assertFail("Property is missing from the object descriptors")}function Vo(t,e){return t===e||(t instanceof Ue&&e instanceof Ue?Ue.isSameFilter(t,e):t instanceof B&&e instanceof B?H(t,e):Gf(t,e))}function fI(t,e){if(u.assertValue(t,"a"),u.assertValue(e,"b"),Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(!Vo(t[r],e[r]))return!1;return!0}function dI(t,e){u.assertValue(t,"a"),u.assertValue(e,"b");var r=[];for(var n in t)Vo(t[n],e[n])||r.push(n);for(var n in e)_.includes(r,n)||Vo(t[n],e[n])||r.push(n);return r}function Xl(t,e){u.assertAnyValue(t,"value"),u.assertValue(e,"DataViewObjectDefinition.encodePropertyValue - typeDescriptor should exist");var r=e,n=e;if(r.variantDeleteEmpty&&r.variant&&null==t)return t;if(r.bool||r.operations&&r.operations.searchEnabled)return"boolean"!=typeof t&&(t=!1),$t(!!t);if(r.text||r.duration||r.scripting&&r.scripting.source)return Ee(t?t.toString():"");if(r.numeric){if($.isNumeric(t))return tn(+t)}else if(r.integer){if($.isNumeric(t))return In(Math.floor(+t))}else if(n.fill){if(t){var i=t;return null==i.id||null==i.shade?{solid:{color:Ee((i.value||t).toString())}}:{solid:{color:Vu(i.id,i.shade)}}}if(null===t&&n.fill.solid&&n.fill.solid.color){var a=!1,o=n.fill.solid.color;if("boolean"!=typeof o&&(a=o.nullable),a)return{solid:{color:Rt()}}}}else if(r.formatting){if(!(r.formatting.labelDisplayUnits||r.formatting.displayUnitsWithoutAuto||r.formatting.fontSize))return Ee(t?t.toString():"");if(null!=t)return tn(+t)}else{if(r.enumeration||r.flagsEnumeration)return $.isNumeric(t)?tn(+t):Ee(t?t.toString():"");if(r.misc)t=t?Ee(t.toString()):null;else if(r.dateTime)t=t?Xt(t):null;else if(!r.variant)if(n.image){if(t){var s=t,l={name:Ee(s.name.toString()),url:Ee(s.url.toString())};return s.scaling&&(l.scaling=Ee(s.scaling.toString())),l}}else if(n.geoJson){if(t){var c=t;return{type:Ee(c.type.toString()),name:Ee(c.name.toString()),content:c.content?Ee(c.content.toString()):Rt()}}}else if(r.reference)(r.reference.bookmark||r.reference.section||r.reference.perspective||r.reference.bookmarkGroup||r.reference.rowRefText)&&(t=Ee(t?t.toString():""));else if(n.filter)u.assert(function(){return t instanceof Ue},"DataViewObjectDefinition.encodePropertyValue - When encoding a filter it should be of type Semantic Filter");else{if(n.paragraphs){var d=t,p=[];if(_.isEmpty(d))return p;for(var h=0,v=d;h<v.length;h++){var g=v[h],y=de(de({},g),{textRuns:[]});if(_.isEmpty(g.textRuns))p.push(y);else{for(var m=0,S=g.textRuns;m<S.length;m++){var E=S[m];if(yg(E))y.textRuns.push(E);else if(mg(E)){var C=void 0;_.isNumber(E.expression)?C=Xl(E.expression,{integer:!0}):Tt(E.expression)?C=E.expression:u.assertNever(E.expression);var b={cases:[],defaultCase:E.defaultCase,expression:C};if(!_.isEmpty(E.cases))for(var V=0,x=E.cases;V<x.length;V++){var w=x[V],D={pattern:Xl(w.pattern,{integer:!0}),textRuns:w.textRuns};b.cases.push(D)}y.textRuns.push(b)}else u.assertNever(E)}p.push(y)}}return p}if(!n.queryTransform){if(n.exprList){var I={exprs:[],kind:"ExprList"};return I.exprs=_.map(t.exprs,function(W){return W}),I}if(n.itemLocation){var F=t,R={kind:"ItemLocation",byReference:{itemId:Ee(F.byReference.itemId)}};return F.byReference.workspaceId&&(R.byReference.workspaceId=Ee(F.byReference.workspaceId)),F.byReference.folderId&&(R.byReference.folderId=Ee(F.byReference.folderId)),R}u.assertFail("DataViewObjectDefinition.encodePropertyValue - The value couldn't be encoded, make sure that the descriptor is valid and handled in here.")}}}return t}ction vI(t){return u.assertValue(t,"original"),_.clone(t)}function gI(t){return!!t&&!!(t instanceof B||function(t){return!!t&&(t instanceof Ue||Ll(t)||Bl(t)||function(t){return!!t.identityFieldsValues}(t)||function(t){return t.name instanceof B&&t.url instanceof B}(t)||zl(t)||function(t){return t.name instanceof B&&t.content instanceof B&&t.type instanceof B}(t)||t)||Ol(t)||vo(t)||Xv(t)||Pi(t)||Zv(t)||eg(t))}(t))}unction mI(t){var e=t.definitions,r=t.descriptors,n=t.visitor,i=t.structuralObjectVisitor;u.assertValue(e,"dataViewObjectDefinition.visitPropertyExprs - definitions"),u.assertAnyValue(r,"dataViewObjectDefinition.visitPropertyExprs - if descriptors exist we only visit valid objects, otherwise everything"),u.assertAnyValue(n,"dataViewObjectDefinition.visitPropertyExprs - visitor"),u.assertAnyValue(i,"dataViewObjectDefinition.visitPropertyExprs - visitor"),u.assert("Either sqExprVisitor or structuralObjectVisitor are required");var a=[],o={stopVisiting:!1};function s(y,m,S){var E=y[m];if(n&&E instanceof B)n(E,y,m,S,a,o);else if("object"==typeof E&&(i&&i(E,y,m,S,a,o),n))for(var C in E){if(o.stopVisiting)return;a.push(C),s(E,C,S),a.pop()}}for(var l in e){var c=r&&r[l];if(!_.isEmpty(e[l])&&(c||!r)){for(var f=0,d=e[l];f<d.length;f++){var h=d[f].properties;if(h)for(var v in h){if(o.stopVisiting)return;var g=c&&c.properties[v];(g||!r)&&s(h,v,g&&g.type)}}u.assert(function(){return _.isEmpty(a)},"DataViewObjectDefinition.visitPropertyExprs - propertyPath should be empty after iterating through object properties")}}}function SI(t){if(u.assertAnyValue(t,"DataViewObjectDefinitions.reduce - objects can be undefined"),!_.isEmpty(t)){for(var e in t)if(t[e]){for(var r=[],n=0,i=t[e];n<i.length;n++){var o=tI(i[n]);o&&r.push(o)}_.isEmpty(r)?delete t[e]:t[e]=r}else delete t[e];if(!_.isEmpty(t))return t}}unction wo(t){return t&&"ExprWithContext"===t.propertyDefinitionKind}var ar=),Ot={light:new ar(["Segoe UI Light","wf_segoe-ui_light","helvetica","arial","sans-serif"]),semilight:new ar(["Segoe UI Semilight","wf_segoe-ui_semilight","helvetica","arial","sans-serif"]),regular:new ar(["Segoe UI","wf_segoe-ui_normal","helvetica","arial","sans-serif"]),semibold:new ar(["Segoe UI Semibold","wf_segoe-ui_semibold","helvetica","arial","sans-serif"]),bold:new ar(["Segoe UI Bold","wf_segoe-ui_bold","helvetica","arial","sans-serif"]),lightSecondary:new ar(["wf_standard-font_light","helvetica","arial","sans-serif"]),regularSecondary:new ar(["wf_standard-font","helvetica","arial","sans-serif"]),boldSecondary:new ar(["wf_standard-font_bold","helvetica","arial","sans-serif"]),glyphs:new ar(["PowerVisuals"])},EI={"Segoe UI Light":Ot.light,"Segoe UI Semilight":Ot.semilight,"Segoe UI":Ot.regular,"Segoe UI Semibold":Ot.semibold,"Segoe (Bold)":Ot.bold,"Segoe UI Bold":Ot.bold,DIN:Ot.regularSecondary,"DIN Light":Ot.lightSecondary,Heading:Ot.light,Body:Ot.regular};unction qt(t,e,r,n,i){if(t?null==t.color&&(t.color=r||e.color):t={color:r||e.color},null==t.fontSize){var a=_.toNumber(e.fontSize);u.assert(function(){return!isNaN(a)},"visualStyle > applyTextClassDefaults: given textClass fontSize is NaN; cannot transform"),t.fontSize=(null==n?a:Math.round(a*n*10)/10)+""}if(null==t.fontWeight&&null!=i)switch(i){case"700":t.fontWeight="700";break;case"600":t.fontWeight="600";break;default:t.fontWeight=e.fontWeight}return t.fontFace=t.fontFace||e.fontFace,t}var ec={misc:{imageUrl:!0}},II=function(){function t(e,r,n,i,a,o,s,l,c,f){this.featureSwitches=e,this.warningType=r,this.propertyId=n,this.selector=i,this.objectDisplayNameGetter=a,this.propertyDisplayNameGetter=o,this.valueExpr=s,this.value=l,this.expectedValueType=c,this.columnExpr=f,1===this.warningType?(u.assertValue(c,"expectedValueType"),this.titleKey="DataBoundExprWarning_InvalidType_Title",this.hintKey="DataBoundExprWarning_InvalidType_Message"):2===this.warningType?(this.titleKey="DataBoundExprWarning_MissingReference_Title",this.hintKey="DataBoundExprWarning_MissingReference_Message"):(this.titleKey="VisualWarning_PropertyEvaluation_Tooltip_Header",this.hintKey="VisualWarning_PropertyEvaluation_Tooltip_Hint_Color")}return Object.defineProperty(t.prototype,"code",{get:function(){switch(this.warningType){case 1:return"DataBoundExprWarningTypeInvalidType";case 2:return"DataBoundExprWarningTypeMissingReference";case 0:return"DataBoundExprWarningTypeInvalidValue";default:u.assertNever(this.warningType)}},enumerable:!1,configurable:!0}),t.prototype.getMessages=function(e,r){if(r){if(this.cachedMessage)return this.cachedMessage;var i=e.get("NamePattern_Colon"),a=[],o=this.propertyDisplayNameGetter instanceof Function?this.propertyDisplayNameGetter(e):this.propertyDisplayNameGetter,s=Ne(e.get(this.titleKey),o),l=this.objectDisplayNameGetter instanceof Function?this.objectDisplayNameGetter(e):this.objectDisplayNameGetter;if(!this.featureSwitches.useModernFormatPane){var c=Ne(i,e.get("VisualWarning_PropertyEvaluation_Tooltip_Section"),l);a.push(c)}var f=r(this.valueExpr);if(f){var d=Ne(i,e.get("Field_Source"),f);a.push(d)}if(void 0!==this.columnExpr){var p=r(this.columnExpr),h=Ne(i,e.get("Field_Target"),p);a.push(h)}if(1===this.warningType&&this.expectedValueType){var v=Ne(i,e.get("DataBoundExprWarning_ExpectedDataType"),t.getPrimitiveValueType(this.expectedValueType,e));a.push(v)}if(0===this.warningType&&this.value){var g=Ne(i,e.get("Value"),this.value.toString());a.push(g)}var y=e.get(this.hintKey);return a.push(y),this.cachedMessage={title:s,message:y,detail:a.join("\n")},this.cachedMessage}u.assertFail("DataViewObjectEvaluationWarning - getMessages - setSQExprTranslator needed for correct warning")},t.prototype.getTitle=function(e){var r=this.propertyDisplayNameGetter instanceof Function?this.propertyDisplayNameGetter(e):this.propertyDisplayNameGetter;return Ne(e.get(this.titleKey),r)},t.prototype.getMessage=t.getPrimitiveValueType=function(e,r){switch(e.primitiveType){case 1:return r.get("Text");case 2:case 3:case 4:return r.get("ConditionalFormattingDialog_Number");case 5:return r.get("ConditionalFormattingDialog_Boolean");case 6:case 7:return r.get("ConditionalFormattingDialog_Date");default:u.assertFail("Invalid expected data type")}},t}(),FI=function(){eturn t.prototype.get=function(e){u.assertValue(e,"key");for(var r=0,n=this.cache;r<n.length;r++){var i=n[r];if(i.key===e)return i.allocator}},t.prototype.register=function(e,r){var n=this;return u.assertValue(e,"key"),u.assert(function(){return void 0!==r},"colorAllocator (it can be null, but not undefined)"),u.assert("Trying to re-register for same key expr."),this.cache.push({key:e,allocator:r}),this},t}();ar tc=function(){function t(){}return t.prototype.evaluate=function(e){u.assertFail("Abstract method RuleEvaluation.evaluate not implemented.")},t}(),qn=function(){function t(e,r){var n=this;this.featureSwitches=e,this.visualStyle=r,u.assertValue(this.featureSwitches,"featureSwitches"),this.colorAllocatorCache=new FI,this.expressionEvaluator=new PI(function(i){return n.evaluateThemeDataColor(i)},function(i,a){return n.ensureColorAllocator(i,a)})}return t.prototype.getObjectsRules=function(){return this.objectsRules},t.prototype.run=function(e,r,n,i,a){if(u.assertValue(r,"evalContext"),u.assertAnyValue(n,"objectDescriptor"),u.assertValue(i,"propertyDefinitions"),n){var o,s=n.properties;for(var l in i){this.propertyId={objectName:e,propertyName:l};var c=i[l],f=s[l];if(f){a&&(a.objectDescriptor=n,a.propertyName=l);var d=this.evaluateProperty(r,f,c);void 0!==d&&(o||(o={}),o[l]=d)}}return this.propertyId=void 0,o}},t.prototype.evaluateProperty=function(e,r,n,i){var a,o,s;u.assertValue(e,"evalContext"),u.assertValue(r,"propertyDescriptor"),u.assertValue(n,"propertyDefinition");var l=r.type;if(l&&l.expression)return n;var f,c=this.evaluateValue(e,n,L.fromDescriptor(r.type));return void 0!==c||n instanceof tc?c:(l.fillRule?f=this.evaluateFillRule(n):null!==(o=null===(a=l.fill)||void 0===a?void 0:a.solid)&&void 0!==o&&o.color&&null!==(s=null==n?void 0:n.solid)&&void 0!==s&&s.color?f=this.evaluateSolidColorFill(e,n,l.fill.solid.color.nullable):l.dataBars&&(f=this.evaluateDataBars(e,n)),f?(i&&f.error&&i.warnings.push(new II(this.featureSwitches,0,{objectName:i.objectName,propertyName:i.propertyName},i.selector,i.objectDescriptor.displayName,r.displayName,f.error.expr,f.error.value,null,i.targetExpr)),f.value):l.image?this.evaluateImage(e,n):l.paragraphs?this.evaluateParagraphs(e,n):l.geoJson?this.evaluateGeoJson(e,n):l.filter?this.evaluateSemanticFilter(n):l.icon?this.evaluateIcon(e,n):l.exprList?this.evaluateExprList(n):l.errorRange?this.evaluateErrorRange(e,n):l.qnaVisualLink?this.evaluateQnaVisualLink(e,n):l.itemLocation?this.evaluateItemLocation(e,n):void 0)},t.prototype.evaluateSemanticFilter=function(e){return e},t.prototype.evaluateSolidColorFill=t.prototype.ensureColorAllocator=t.prototype.addObjectRule=t.prototype.createColorAllocator=function(e,r){var n=r.getExprColumn(e.input,this.featureSwitches.categoricalSecondaryCF);if(!n)return null;var i=this.evaluateFillRule(e.rule).value;return i?no().fromFillRule(i,n):null},t.prototype.evaluateFillRule=function(e){var n,r=Ag();if(e.linearGradient2){if((a=this.evaluateColorStop(r,(i=e.linearGradient2).min)).error)return a;if((o=this.evaluateColorStop(r,i.max)).error)return o;if(n={linearGradient2:{min:a.value,max:o.value}},s=this.evaluateNullStrategy(r,i.nullColoringStrategy)){if(s.error)return s;n.linearGradient2.nullColoringStrategy=s.value}}else if(e.linearGradient3){var i,a;if((a=this.evaluateColorStop(r,(i=e.linearGradient3).min)).error)return a;var o,s,c=this.evaluateColorStop(r,i.mid);if(c.error)return c;if((o=this.evaluateColorStop(r,i.max)).error)return o;if(n={linearGradient3:{min:a.value,mid:c.value,max:o.value}},s=this.evaluateNullStrategy(r,i.nullColoringStrategy)){if(s.error)return s;n.linearGradient3.nullColoringStrategy=s.value}}return{value:n}},t.prototype.evaluateColorStop=function(e,r){u.assertValue(e,"evalContext"),u.assertValue(r,"colorStop");var n=this.evaluateColor(e,r.color,!1);if(n.error)return n;var i={color:n.value},a=this.evaluateValue(e,r.value,t.numericType);return null!=a&&(i.value=a),{value:i}},t.prototype.evaluateColor=function(e,r,n){u.assertValue(e,"evalContext"),u.assertValue(r,"evaluateColor - color");var i=this.evaluateValue(e,r,t.colorValueType),a=null!=i?function(t,e){u.assertValue(e,"EvalContext.getThemeColor - colorName should't be null");var r=t.colorPalette,n=r.dataColors.getGradientColors(),i=r.dataColors.getSentimentColors(),a=r[e]||n[e]||i[e];return u.assertAnyValue(a,"getThemeColor - If this is not a theme color it's likely a custom color (like rgba),\n                we should consider updating dataViewObjectEvaluator logic to only call this if it's a theme color."),null==a?void 0:a.value}(this.visualStyle,i):i;if(null!=a)return{value:a};if(null===i&&n)return{value:null};if(!i)return{value:void 0};var o=i.toString();return o&&(o=function(t){return/(#([\da-f]{3}){1,2}|(rgb|hsl)a\((\d{1,3}%?,\s?){3}(1.0|1|0|0?\.\d+)\)|(rgb|hsl)\(\d{1,3}%?(,\s?\d{1,3}%?){2}\))/gi.test(t)}(o=o.replace(/\s+/g,""))?o:function(t){return u.assertValue(t,"getWebColorValue - colorName"),hE[t.toLocaleLowerCase()]}(o)),void 0===o?{error:{expr:r,value:i}}:{value:o}},t.prototype.evaluateNullStrategy=function(e,r){if(r){u.assertValue(e,"evaluateNullStrategy - undefined evalContext"),u.assertValue(r.strategy,"evaluateNullStrategy - undefined strategy");var n={strategy:this.evaluateValue(e,r.strategy,t.nullStrategyType)};if(r.color){var i=this.evaluateColor(e,r.color,!1);if(i.error)return i;n.color=i.value}return{value:n}}},t.prototype.evaluateImage=function(e,r){if(u.assertValue(e,"evalContext"),u.assertAnyValue(r,"definition"),r){var n={name:this.evaluateValue(e,r.name,t.textType),url:this.evaluateValue(e,r.url,L.fromDescriptor(ec))};return r.scaling&&(n.scaling=this.evaluateValue(e,r.scaling,t.textType)),n}},t.prototype.evaluateParagraphs=function(e,r){var n=this;if(u.assertValue(e,"evalContext"),u.assertAnyValue(r,"definition"),r)return this.evaluateArrayCopyOnChange(e,r,function(i,a){return n.evaluateParagraph(i,a)})},t.prototype.evaluateParagraph=function(e,r){var n=this;u.assertValue(e,"evalContext"),u.assertValue(r,"definition");var i,a=r.textRuns,o=this.evaluateArrayCopyOnChange(e,a,function(s,l){return n.evaluateTextRun(s,l)});return a!==o&&((i=_.clone(r)).textRuns=o),i||r},t.prototype.evaluateTextRun=function(e,r){return u.assertValue(e,"evalContext"),u.assertValue(r,"definition"),jl(r)?this.evaluateTextRunDefinition(e,r):Wl(r)?this.evaluateTextRunConditional(e,r):void u.assertNever(r)},t.prototype.evaluateTextRunDefinition=function(e,r){var n,i;r.value instanceof B?(n=r.value,i=this.evaluateValue(e,r.value,t.textType)):i=r.value;var a={value:i};return r.textStyle&&(a.textStyle=r.textStyle),r.url&&(a.url=r.url),r.mentionEmail&&(a.mentionEmail=r.mentionEmail),n&&(a.valueExpr=n),a},t.prototype.evaluateTextRunConditional=t.prototype.evaluateTextRunConditionalCase=function(e,r){return de({pattern:this.evaluateValue(e,r.pattern,t.textType)},this.evaluateTextRunCaseValue(e,r))},t.prototype.evaluateTextRunCaseValue=t.prototype.evaluateTextRunConditionalExpression=function(e,r){return r instanceof B?this.evaluateValue(e,r,t.textType):Tt(r)?r:void u.assertNever(r)},t.prototype.evaluateGeoJson=function(e,r){if(u.assertValue(e,"evalContext"),u.assertAnyValue(r,"definition"),r)return{name:this.evaluateValue(e,r.name,t.textType),type:this.evaluateValue(e,r.type,t.textType),content:this.evaluateValue(e,r.content,t.textType)}},t.prototype.evaluateDataBars=t.prototype.evaluateIcon=function(e,r){var n;if(u.assertValue(e,"evalContext"),u.assertAnyValue(r,"definition"),vo(r)){var i={kind:"Icon"};if(r.layout&&(i.layout=this.evaluateValue(e,r.layout,t.textType)),r.verticalAlignment&&(i.verticalAlignment=this.evaluateValue(e,r.verticalAlignment,t.textType)),r.value){var a=this.evaluateValue(e,r.value,t.textType);if(null===a)i.value=null;else if(void 0===a)i.value=null;else{var o=function(t,e){return u.assertValue(t,"getThemeIcon - visualStyle"),u.assertValue(e,"getThemeIcon - iconId"),t.icons[e]}(this.visualStyle,a);if(o)if(o.svgId){var s=null===(n=o.description)||void 0===n?void 0:n.resourceKey;i.value={svgId:o.svgId},s&&(i.value.descriptionKey=s)}else o.url?i.value={url:o.url}:u.assertFail("incorrect themeIcon");else i.value={url:a}}}return i}},t.prototype.evaluateThemeDataColor=function(e){return function(t,e){var r;return u.assertValue(t,"getThemeDataColor - visualStyle"),u.assertValue(e,"getThemeDataColor - colorIdx"),null===(r=t.colorPalette.dataColors.getBasePickerColors()[e])||void 0===r?void 0:r.value}(this.visualStyle,e)},t.prototype.evaluateExprList=function(e){if(u.assertAnyValue(e,"definition"),Xv(e))return{exprs:e.exprs,kind:"ExprList"}},t.prototype.evaluateArrayCopyOnChange=function(e,r,n){u.assertValue(e,"evalContext"),u.assertValue(r,"definitions"),u.assertValue(n,"evaluator");for(var i,a=0,o=r.length;a<o;a++){var s=r[a],l=n(e,s);!i&&s!==l&&(i=_.take(r,a)),i&&i.push(l)}return i||r},t.prototype.evaluateErrorRange=function(e,r){if(u.assertValue(e,"evalContext"),u.assertValue(r,"definition"),Pi(r)){if(r.explicit)return this.evaluateExplicitErrorRange(e,r.explicit);if(r.symmetricalExplicit)return this.evaluateSymmetricalErrorRange(e,r.symmetricalExplicit);if(r.standardDeviation)return this.evaluateStandardDeviationErrorRange(e,r.standardDeviation);if(r.percentage)return this.evaluatePercentageErrorRange(e,r.percentage);if(r.percentile)return this.evaluatePercentileErrorRange(e,r.percentile)}},t.prototype.evaluateExplicitErrorRange=t.prototype.evaluateSymmetricalErrorRange=t.prototype.evaluateStandardDeviationErrorRange=function(e,r){return{standardDeviation:{value:this.evaluateValue(e,r.value,t.numericType),multiplier:this.evaluateValue(e,r.multiplier,t.numericType)}}},t.prototype.evaluatePercentageErrorRange=function(e,r){return{percentage:{lowerBoundDelta:this.evaluateValue(e,r.lowerBoundDelta,t.numericType),upperBoundDelta:this.evaluateValue(e,r.upperBoundDelta,t.numericType)}}},t.prototype.evaluatePercentileErrorRange=t.prototype.evaluateQnaVisualLink=function(e,r){if(u.assertValue(e,"evalContext"),u.assertValue(r,"definition"),Zv(r))return{suggestedUtterances:_.map(r.suggestedUtterances,function(n){return{utterance:n.utterance}})}},t.prototype.evaluateItemLocation=function(e,r){if(u.assertValue(e,"evalContext"),u.assertValue(r,"definition"),eg(r)&&r.byReference){var n={byReference:{itemId:this.evaluateValue(e,r.byReference.itemId,t.textType)}};return r.byReference.workspaceId&&(n.byReference.workspaceId=this.evaluateValue(e,r.byReference.workspaceId,t.textType)),r.byReference.folderId&&(n.byReference.folderId=this.evaluateValue(e,r.byReference.folderId,t.textType)),n}},t.prototype.evaluateValue=function(e,r,n){return r instanceof B?this.expressionEvaluator.evaluate(r,e):r instanceof tc?r.evaluate(e):void 0},t.boolType=L.fromDescriptor({bool:!0}),t.colorValueType=L.fromDescriptor({formatting:{color:!0}}),t.numericType=L.fromDescriptor({numeric:!0}),t.textType=L.fromDescriptor({text:!0}),t.nullStrategyType=L.fromDescriptor({enumeration:qC}),t}(),PI=function(t){eturn T(e,t),e.prototype.evaluate=e.prototype.visitColumnRef=function(r,n){return n.getExprValue(r)},e.prototype.visitConstant=e.prototype.visitMeasureRef=function(r,n){return n.getExprValue(r)},e.prototype.visitArithmetic=function(r,n){return n.getExprValue(r)},e.prototype.visitNativeMeasure=function(r,n){return n.getExprValue(r)},e.prototype.visitAggr=function(r,n){return n.getExprValue(r)},e.prototype.visitScopedEval=function(r,n){return n.getScopedEvalExprValue(r)},e.prototype.visitFillRule=e.prototype.visitPercentile=function(r,n){return n.getExprValue(r)},e.prototype.visitRangePercent=e.prototype.visitSelectRef=function(r,n){return n.getExprValue(r)},e.prototype.visitThemeDataColor=function(r,n){var i=this.dataColorEvaluator(r.colorId);if(i)return i,r.percent)},e.prototype.visitNot=e.prototype.visitAnd=e.prototype.visitContains=function(r,n){if(!r.isOrdinalEvaluation())return u.assertFail("Contains expression should be evaluated as ordinal"),!1;var i=this.getExprString(r.left,n),a=this.getExprString(r.right,n);return _.isString(i)?ha(i,a):(u.warn("Contains expression should only be applied to string types"),!1)},e.prototype.visitStartsWith=function(r,n){if(!r.isOrdinalEvaluation())return u.assertFail("StartsWith expression should be evaluated as ordinal"),!1;var i=this.getExprString(r.left,n),a=this.getExprString(r.right,n);return _.isString(i)?function(t,e){return null!=t&&0===t.indexOf(e)}(i,a):(u.warn("StartsWith expression should only be applied to strings"),!1)},e.prototype.getExprString=function(r,n){var i;if(null!==r)return null!==(i=xu(r))&&void 0!==i?i:this.evaluate(r,n)},e.prototype.visitCompare=function(r,n){var i=this.evaluate(r.left,n);if(_.isNaN(i))return!1;var a=this.evaluate(r.right,n);if(_.isNaN(a))return!1;var o=r.comparison;if(r.isOrdinalEvaluation())return 0===o?i===a:(u.assertFail("An ordinal comparison with QueryExpressionKind other than 'Equal' is not supported"),!1);if(null===a||null===i)return a===i&&(0===o||2===o||4===o);switch(o){case 0:return i===a;case 1:return i>a;case 2:return i>=a;case 3:return i<a;case 4:return i<=a}},e.prototype.visitConditional=function(r,n){var i=r.cases;if(u.assertNonEmpty(i,"ExpressionEvaluator.visitConditional - Empty cases"),!_.isEmpty(i))for(var a=0,o=i;a<o.length;a++){var s=o[a],c=s.value;if(!0===this.evaluate(s.condition,n))return this.evaluate(c,n)}return this.evaluate(r.defaultValue,n)},e}(pi),_g=function(){function t(e,r,n,i){u.assertValue(e,"items"),this.items=e,this._activeProjectionRefs=r,this._showAll=n,this.parameters=i||[]}return t.prototype.all=function(){return this.items},t.prototype.resetHiddenState=t.prototype.toggleHidden=t.prototype.resetAllHiddenState=t.prototype.projected=t.prototype.addProjection=t.prototype.removeProjection=function(e){var r,n,i;e&&(r=e.fieldIndex,n=e.parameter,i=e.indexInParameter),u.assert("When removing a projection we expect field index or the parameter options to be complete.");var a=this.getProjectionIndex(r,n,i);this.fixUpParameterIndices(n,r,-1),this.items.splice(a,1)},t.prototype.fixUpParameterIndices=t.prototype.moveFields=function(e,r,n){var i,o,s,l,a=this;if(0===this.parameters.length)o=e,s=n,l=r;else{if(u.assert("Should use valid field indices"),u.assert(function(){return e+n<=a.getFieldCount()},"Should not attempt to move more fields than exist in collection"),u.assert("Moving projections should not change the length of collection"),n<=0||e===r)return[];o=this.convertFieldIndexToProjectionIndex(e);var f=this.indexOfLastProjectionInField(e+n-1);s=f-o+1,l=this.convertFieldIndexToProjectionIndex(r),r>e&&(l+=this.indexOfLastProjectionInField(r+n-1)-l+1-s);for(var v=0,g=this.parameters;v<g.length;v++){var y=g[v];y.index>=e&&y.index<=e+n-1?y.index=r+y.index-e:y.index>e&&y.index<=r+n-1?y.index-=n:y.index<e&&y.index>=r&&(y.index+=n)}if(f<o)return[]}var m=this.items.splice(o,s);return(i=this.items).splice.apply(i,me([l,0],m||[],!1)),m},t.prototype.assignProjection=t.prototype.updateQueryRef=function(e,r){this.items[e].queryRef=r},t.prototype.getQueryRefs=t.prototype.getFieldParameters=function(){return this.parameters},t.prototype.addFieldParameter=t.prototype.getColumnProjectionIndex=function(e){var r=this;return u.assert("Should not be called on parameters"),this.convertFieldIndexToProjectionIndex(e)},t.prototype.getProjectionsByProjectionIndex=t.prototype.getProjectionsByFieldIndex=function(e){var r=this.getParameterByFieldIndex(e);if(r){var n=this.getParameterProjections(r),i=_.filter(n,function(s){return null!=s});return i.length!==n.length&&u.assertFail("The projection should exist, but in some extraordinary scenario it does not exist"),i}var a=this.convertFieldIndexToProjectionIndex(e),o=this.items[a];return null==o?(u.assertFail("The projection should exist, but in some extraordinary scenario it does not exist"),[]):[o]},t.prototype.convertProjectionIndexToFieldIndex=t.prototype.doesParameterExist=function(e){return _.some(this.parameters,function(r){return r.index===e})},t.prototype.getParameterProjectionIndex=function(e,r){var n=this;return u.assert("Parameter and indexInParameter should both be defined"),u.assert(function(){return n.doesParameterExist(e.index)},"Parameter should exist for this projection"),this.convertFieldIndexToProjectionIndex(e.index)+r},t.prototype.getColumnProjection=t.prototype.getParameterProjections=t.prototype.removeFieldParameters=function(e){for(var r=function(c){var f=_.findIndex(n.parameters,function(y){return y.index===c.index&&H(y.expr,c.expr)});if(f<0)return{value:!1};var d=n.parameters.splice(f,1)[0],p=d.index;u.assert("there should be no projections for this removed parameter");for(var h=0,v=n.parameters;h<v.length;h++){var g=v[h];g.index>p&&g.index--}},n=this,i=0,a=e;i<a.length;i++){var s=r(a[i]);if("object"==typeof s)return s.value}return!0},t.prototype.findParameterBySQExpr=function(e){return _.isEmpty(this.parameters)?[]:this.parameters.filter(function(r){return H(r.expr,e)})},t.prototype.getParameterByFieldIndex=Object.defineProperty(t.prototype,"activeProjectionRefs",{get:function(){return this._activeProjectionRefs},set:enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showAll",{get:function(){return this._showAll},set:function(r){this._showAll=r},enumerable:!1,configurable:!0}),t.prototype.addActiveQueryReference=t.prototype.getLastActiveQueryReference=t.prototype.replaceQueryRef=function(e,r){var n=this;u.assertValue(e,"oldQueryRef"),u.assertValue(r,"newQueryRef"),u.assert("oldQueryRef !== newQueryRef"),u.assert(function(){return _.isEmpty(n._activeProjectionRefs)},"replaceQueryRef(...) is not supported on the QueryProjectionCollection of a drillable role");for(var i=0,a=this.items;i<a.length;i++){var o=a[i];o.queryRef===e&&(o.queryRef=r)}},t.prototype.clone=t.prototype.getProjectionIndex=function(e,r,n){var i,a;if(r){var o=null!==(i=r.length)&&void 0!==i?i:0;null!=n?(u.assert(function(){return n<=o},"indexInParameter should not exceed the current length of the parameter's projections."),a=this.convertFieldIndexToProjectionIndex(r.index)+n):a=this.convertFieldIndexToProjectionIndex(r.index)+o}else a=null!=e?this.convertFieldIndexToProjectionIndex(e):this.items.length;return a},t.prototype.convertFieldIndexToProjectionIndex=function(e){return function(t,e){for(var r,n=_.filter(e,,i=t,a=0,o=n;a<o.length;a++)i+=(null!==(r=o[a].length)&&void 0!==r?r:0)-1;return i}(e,this.parameters)},t.prototype.indexOfLastProjectionInField=t.prototype.getFieldCount=t}();function cn(t,e,r){if(u.assertValue(t,"expr"),u.assertAnyValue(e,"selectTransforms"),!e)return-1;var n;jt(t)&&(n=t.expressionName);for(var i=r||0,a=e.length;i<a;i++){var o=e[i];if(o&&(!n||o.queryName))if(n){if(o.queryName===n)return i}else if(H(o.expr,t))return i}return-1}function Mo(t,e){return new zI(t,e)}Qt(_g.prototype);var zI=function(){function t(e,r){this.dataView=e,this.selectTransforms=r,u.assertValue(e,"dataView"),u.assertAnyValue(r,"selectTransforms")}return t.prototype.getExprColumn=function(e){var r=cn(e,this.selectTransforms);if(!(r<0))return _.find(this.dataView.metadata.columns,function(n){return n.index===r})},t.prototype.getScopedEvalExprValue=function(e){var r=e.decomposeGlobalAggregateOfScopedExpr();if(r){var n=ir(r.source,this.dataView.metadata.columns);return n?yo(n,r.func):void 0}if(e.hasGlobalScope())return this.getExprValue(e.expression);e.hasInnerMostScope()?u.assertFail("Attempt to evaluate a scoped expression within the Global scope"):u.assertFail("Evaluation of Partial-Scope expressions is not supported")},t.prototype.getExprValue=function(e){var r=this.dataView,n=this.selectTransforms;if(r&&n){if($e(e)||ua(e)||Sn(e)||Mf(e)){var i=function(t,e,r){u.assertValue(t,"expr"),u.assertValue(e,"selectTransforms"),u.assertValue(r,"columns");var n,i=-1;do{if((i=cn(t,e,i+1))<0)break;if(n=_.find(r,)return n.aggregates.single}while(i<e.length);if($e(t)||ua(t)){var a=t.arg;if(Ur(a)&&a.hasInnerMostScope()?i=cn(a.expression,e):(jt(a)||Sn(a)||$e(a)||Vs(a))&&(i=cn(a,e)),!(i<0)&&(n=_.find(r,))return function(t,e){var r,n;if(u.assertValue(t,"aggregates"),u.assertValue(e,"expr"),ua(e)){var i=_.find(t.percentiles,;if(i)return i.value}else if($e(e))switch(u.assertValue(e.func,"func"),e.func){case 3:return null!==(r=t.min)&&void 0!==r?r:t.minLocal;case 4:return null!==(n=t.max)&&void 0!==n?n:t.maxLocal;case 6:return t.median;case 1:return t.average}u.assertFail("Only Percentile, Min, Max, Median, Average are supported as Aggregate of Aggregates")}(n.aggregates,t)}}(e,n,r.metadata.columns);if(void 0!==i)return i}if(r.table)return _.isEmpty(r.table.columns)||_.isEmpty(r.table.rows)||!_.isEmpty(r.table.identityFields)?void 0:(u.assert(function(){return 1===r.table.rows.length},"A data view with no identity fields should have a single row"),Fg(e,n,r.table.columns,r.table.rows[0]));if(r.categorical&&!_.isEmpty(r.metadata.columns)&&!_.isEmpty(r.categorical.values))return function(t,e,r){u.assertValue(t,"expr"),u.assertValue(e,"selectTransforms"),u.assertValue(r,"categorical");var n=r.values;if(u.assertValue(n,"categorical.values"),1===n.grouped().length&&!r.categories){var i=cn(t,e);if(!(i<0)){var a=_.findIndex(n,function(s){return s.source.index===i});if(-1!==a){var o=n[a].values;if(o&&1===o.length)return o[0]}}}}(e,n,r.categorical);r.matrix||r.tree||u.assert(function(){return _.isEqual(Object.getOwnPropertyNames(r),["metadata"])},"staticEvalContext.getExprValue received a dataView that is not currently supported (only table and categorical are implemented)")}},t.prototype.getRoleValues=function(e){},t}();function Fg(t,e,r,n){if(u.assertValue(t,"expr"),u.assertValue(e,"selectTransforms"),u.assertNonEmpty(r,"tableColumns"),u.assertValue(n,"tableRow"),1===n.length&&null===n[0])return null;var i=cn(t,e);if(!(i<0)){var a=_.findIndex(r,function(l){return l.index===i});if(!(a<0)){if(jt(t)&&0===t.attributeKind){var o=r[a];if((a=r.indexOf(o.formatSource&&o.formatSource.formatString))<0)return}return u.assert("Cannot get expr value from table row. Row values don't contain an element for the matching data column"),n[a]}}}function GI(t,e){return new QI(t,e)}var QI=function(){function t(e,r){this.dataView=e,this.selectTransforms=r,u.assertValue(e,"dataView"),u.assertValue(r,"selectTransforms")}return t.prototype.getExprColumn=t.prototype.getScopedEvalExprValue=function(e){var r=e.decomposeGlobalAggregateOfScopedExpr();if(r){var n=ir(r.source,this.dataView.columns);return n?yo(n,r.func):void 0}if(e.hasInnerMostScope())return this.getExprValue(e.expression);e.hasGlobalScope()?u.assertFail("Attempt to evaluate a scoped expression within the Global scope"):u.assertFail("Evaluation of Partial-Scope expressions is not supported")},t.prototype.getExprValue=function(e){u.assertValue(e,"expr");var r=this.row;if(null!=r)return Fg(e,this.selectTransforms,this.dataView.columns,r)},t.prototype.getRoleValues=function(e){},t.prototype.setCurrentRow=function(e){u.assertValue(e,"row"),this.row=e},t}();function WI(t,e,r,n,i,a,o,s,l,c,f,d,p){if(u.assertValue(t,"evalContext"),u.assertValue(r,"columns"),u.assertValue(n,"rows"),u.assertAnyValue(i,"identities"),u.assertAnyValue(a,"identityFields"),u.assertValue(o,"objectDescriptors"),u.assertValue(s,"selector"),u.assertValue(c,"objectDefns"),s.metadata&&!_.isEmpty(s.data)){var h=_.findIndex(r,function(w){return w.queryName===s.metadata});if(!(h<0)&&f.matchesKeys([a],1)){var v;if(_.every(r,function(w){return w.isMeasure})){u.assert(function(){return _.isEmpty(i)},"table identity mismatch with identityFields"),u.assert(function(){return _.isEmpty(a)},"table identity mismatch with identityFields"),u.assert(function(){return 1===n.length},"table without identity has incorrect row count");var g=Pg(t,e,r,n[0],a,o,s,c,f,d,p);g&&((v=N(n))[0]=g)}else{if(_.some(s.data,)return;u.assert(function(){return n.length===i.length},"row length mismatch");for(var y=r.length,m=0,S=i.length;m<S;m++)if(l||f.matches([i[m]])){t.setCurrentRow(n[m]);var C=void 0;p&&(C={warnings:p,selector:s,targetExpr:tr(s,e)});var b=ut(d,t,o,c,C);if(b){v||(v=N(n));var V=v[m]=N(v[m]),x=V.objects;x||(V.objects=x=new Array(y)),x[h]||(x[h]={}),Je(x[h],b,s.id,s.order)}if(!l)break}}return v}}}function KI(t,e){return ja(e)&&(e=ql(e,function(r){return function(t,e){if(!t)return[];for(var r=[],n=0,i=e.columns;n<i.length;n++){var a=i[n];a.identityExprs&&Ul([a],t)&&r.push(me([],a.identityExprs||[],!0))}return r}(r,t)})),e}function Pg(t,e,r,n,i,a,o,s,l,c,f){u.assertValue(t,"evalContext"),u.assertValue(r,"columns"),u.assertValue(n,"row"),u.assertValue(a,"objectDescriptors"),u.assertValue(o,"selector"),u.assertValue(s,"objectDefns");var d=_.isEmpty(i)?void 0:i;if(o.metadata&&l.matches([],d)){var p=_.findIndex(r,function(S){return S.queryName===o.metadata});if(!(p<0)){var v,g,h=r.length;t.setCurrentRow(n),f&&(g={warnings:f,selector:o,targetExpr:tr(o,e)});var y=ut(c,t,a,s,g);if(y){var m=(v=N(n)).objects;m||(v.objects=m=new Array(h)),m[p]||(m[p]={}),Je(m[p],y)}return v}}}var YI=function(t){function e(r,n){var i=this;return u.assertValue(r,"inputRole"),u.assertValue(n,"allocator"),(i=t.call(this)||this).inputRole=r,i.allocator=n,i}return T(e,t),e.prototype.evaluate=function(r){u.assertValue(r,"evalContext");var n=r.getRoleValues(this.inputRole);u.assert("Color Rule Evaluation can run with only one value");var i=_.head(n);if(void 0!==i)return this.allocator.color(i)},e}(tc);function Ar(t,e,r){void 0===t&&(t=[]);var n=t;return ig(n),e&&(n.identityFields=e),r&&(n.source=r),n}function Do(t,e,r,n,i,a,o,s,l){if(u.assertValue(t,"dataView"),u.assertValue(e,"targetDataViewKinds"),u.assertAnyValue(r,"objectDescriptors"),u.assertAnyValue(n,"objectDefinitions"),u.assertAnyValue(i,"selectTransforms"),r){var c=function(t,e,r,n){var i;u.assertValue(t,"dataView"),u.assertValue(e,"objectDescriptors"),u.assertAnyValue(r,"prototype");var a=ro(e);if(a&&t.metadata&&!_.isEmpty(t.metadata.columns)){for(var s,o=!1,l=0,c=t.metadata.columns;l<c.length;l++){var f=c[l],d=f.queryName;if(f.formatSource&&(null===(i=null==f?void 0:f.aggregates)||void 0===i||!i.single)){o||(s=r?N(r):{},o=!0);var p={metadata:f.queryName,data:[Au()],highlightMatching:1},h=gi(d,0);if(Li(s,a,p,h),null!=n&&n.cardReferenceLabels&&f.relatedObjects)for(var v=0,g=Object.keys(f.relatedObjects);v<g.length;v++)for(var y=g[v],m=f.relatedObjects[y],S=0,E=Object.keys(m);S<E.length;S++){var C=E[S],b=ml(e,{objectName:y,propertyName:C});if(null!=b&&b.formatStringProperty)for(var V=0,x=m[C];V<x.length;V++)Li(s,b.formatStringProperty,x[V],h)}}}return s}}(t,r,n,o);c&&(n=c);var f=function(t){u.assertAnyValue(t,"objectDefinitions");var e={data:[]};if(t)for(var r in t)for(var n=t[r],i=0,a=n.length;i<a;i++){var o=n[i];aT(e,o.selector).objects.push({name:r,properties:o.properties})}return e}(n);!function(t,e,r,n){u.assertValue(t,"objectsForAllSelectors"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"columns"),u.assertAnyValue(n,"selectTransforms"),n&&(function(t,e,r,n){u.assertValue(t,"objectsForAllSelectors"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"columns"),u.assertValue(n,"selectTransforms");var i=ro(e);if(i)for(var a=0,o=n.length;a<o;a++){var s=n[a];s&&(u.assertValue(s.queryName,"selectTransform.queryName"),cT(t,i,s.queryName,s.format||lT(r,a)))}}(t,e,r,n),function(t,e,r){u.assertValue(t,"objectsForAllSelectors"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"selectTransforms");var n=function(t){return Mi(t,}(e);if(n)for(var i=0,a=r;i<a.length;i++){var o=a[i];o&&(u.assertValue(o.queryName,"selectTransform.queryName"),fT(t,n,o.queryName,o.defaultValue))}}(t,e,n))}(f,r,t.metadata.columns,i);var d=f.metadataOnce,p=f.data;d&&function(t,e,r,n,i,a,o,s,l){var c;u.assertValue(t,"dataView"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector"),u.assertValue(i,"dataObjects"),u.assertValue(a,"targetDataViewKinds");for(var f=new qn(s,o),d=0,p=n;d<p.length;d++){var h=p[d],v=h.selector&&h.selector.id,g=null===(c=h.selector)||void 0===c?void 0:c.order,y=h.objects;u.assertValue(!_.isEmpty(y),"objectDefns");var m=Mo(t,e),S=void 0;l&&(S={warnings:l,selector:h.selector,targetExpr:tr(h.selector,e)});var E=ut(f,m,r,y,S);if(E){var C=t.metadata.objects;for(var b in C||(C=t.metadata.objects={}),Je(C,E,v,g),E){var V=E[b],x=r[b];for(var w in V){var D=x.properties[w],A=D.rule;if(A){var I=e_(t,A,b,V[w],D.type);_.isEmpty(I)||i.push.apply(i,I||[])}}}}}}(t,i,r,d,p,e,a,o,s);var h=f.metadata;_.isEmpty(h)||function(t,e,r,n,i,a,o){u.assertValue(t,"dataView"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");for(var s=new qn(a,i),l=0,c=n;l<c.length;l++){var f=c[l],d=f.selector,p=f.objects;u.assertValue(d,"selector"),u.assertValue(p,"objectDefns");for(var h=t.metadata.columns,v=d.metadata,g=Mo(t,e),y=0,m=h.length;y<m;y++){var S=h[y];if(S.queryName===v){var E=void 0;o&&(E={warnings:o,selector:d,targetExpr:tr(d,e)});var C=ut(s,g,r,p,E);C&&(S.objects||(S.objects={}),Je(S.objects,C,d.id,d.order))}}}}(t,i,r,h,a,o,s),_.isEmpty(p)||function(t,e,r,n,i,a,o,s,l){u.assertValue(t,"dataView"),u.assertValue(e,"targetDataViewKinds"),u.assertAnyValue(r,"selectTransforms"),u.assertValue(n,"objectDescriptors"),u.assertValue(i,"dataViewObjectDefnsForSelector"),u.assertValue(a,"DataViewTransform.evaluateDataRepetition - visualStyle");var c=new qn(s,a);t.categorical&&ee(e,1)&&function(t,e,r,n,i,a,o,s){u.assertValue(t,"dataViewCategorical"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");for(var l=0,c=n;l<c.length;l++){var f=c[l],d=f.selector,p=f.rules,h=f.objects;u.assertValue(d,"selector"),u.assertAnyValue(p,"rules"),u.assertValue(h,"objectDefns");var v=Qa(d),g=mo(d=IT(t,d),i);o&&(o.selector=d,o.targetExpr=tr(d,e)),VT(t,r,d,v,h,g,a,o),MT(t,r,d,v,h,g,a,o,s),AT(t,r,d,h,a,o,s)}}(t.categorical,r,n,i,o,c,l&&{warnings:l},s);var d=t.matrix;if(d&&ee(e,2)){var p=function(t,e,r,n,i,a,o,s){u.assertValue(t,"dataViewMatrix"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");var l=t.valueSources,c=l.length,f=function(t,e){return new UT(t,e)}(t,a),d=t.rows.levels;u.assertAnyValue(d,"A Matrix with no Row groupings has empty Row levels");var p=cg(d),h=cg(t.columns.levels),v=[];v.push.apply(v,p||[]),v.push.apply(v,h||[]);for(var g=!1,y=N(t),m=function(V){u.assertValue(V.selector,"selector"),u.assertAnyValue(V.rules,"rules");var x=V.objects;u.assertValue(x,"objectDefns");var w=function(t,e){return ja(e)&&(e=ql(e,),e}(t,V.selector),D=mo(w,i),A=Qa(w),I=Fn(w),F=null==w.metadata&&fg(p,D),R=function(t,e,r,n){if(u.assertAnyValue(t,"A Matrix with no Row groupings has empty Row levels and can't hold ScopedValues"),_.isEmpty(t)||(u.assertValue(r,"selectorComparer"),u.assertAnyValue(n,"selectorMetadata"),u.assert(function(){return t.length===e.length},"levels identity keys mismatch"),!n))return!1;for(var i=0;i<t.length;i++)if(r.matchesKeys(_.take(e,i+1),i+1)){var a=Co(t[i]);if(!_.isEmpty(a)&&_.find(a,function(o){return o.queryName===n}))return!0}return!1}(d,p,D,w.metadata),W=(c>1||c<=1&&null==w.metadata)&&fg(h,D),ae=null!=w.metadata&&c>0&&_.some(l,function(De){return De.queryName===w.metadata})&&D.matchesKeys(v,v.length),oe={selector:w,selectorComparer:D,containsWildcard:A,isWildcard:I,canMatchColumnNode:W,canMatchRowNode:F,canMatchIntersection:ae,canMatchScopedValue:R},K=void 0,Ce=void 0;W&&(Ce=dg("Columns",f,e,y.columns,r,x,oe,o,s)),(ae||R||F)&&(K=dg("Rows",f,e,y.rows,r,x,oe,o,s)),(K||Ce)&&(g=!0,K&&(y.rows=K),Ce&&(y.columns=Ce))},S=0,E=n;S<E.length;S++)m(E[S]);if(g)return y}(d,r,n,i,o,s,c,l);p&&(t.matrix=p)}var h=t.table;if(h&&ee(e,8)){var v=function(t,e,r,n,i,a,o){u.assertValue(t,"dataViewTable"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");for(var s=!1,l=0,c=n;l<c.length;l++){var f=c[l],d=f.selector,p=f.objects;u.assertValue(d,"selector"),u.assertValue(p,"objectDefns");var h=Qa(d),v=mo(d=KI(t,d),i),g=GI(t,e),y=void 0;_.isEmpty(t.rows)||(y=WI(g,e,t.columns,t.rows,t.identity,t.identityFields,r,d,h,p,v,a,o));var m=void 0;t.totals&&(m=Pg(g,e,t.columns,t.totals,t.identityFields,r,d,p,v,a,o)),(y||m)&&(s=!0,t=N(t),y&&(t.rows=y),m&&(t.totals=m))}if(s)return t}(h,r,n,i,o,c,l);v&&(t.table=v)}var g=t.single;if(u.assert("DataViewTable should be always present with DataViewSingle"),g&&h&&ee(e,4)){var y=function(t,e,r,n,i,a,o){u.assertValue(t,"dataView"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");for(var s,l=Mo(t,e),c=0,f=n;c<f.length;c++){var d=f[c],p=d.selector,h=d.objects,v=mo(p,i);if(u.assertValue(p,"selector"),u.assertValue(h,"objectDefns"),p.metadata===t.single.column.queryName&&v.matches([])){var g=void 0;o&&(g={warnings:o,selector:p,targetExpr:tr(p,e)});var y=ut(a,l,r,h,g);y&&(s||(s=N(t.single)),s.objects||(s.objects={}),Je(s.objects,y,p.id,p.order))}}return s}(t,r,n,i,o,c,l);y&&(t.single=y)}t.metadata.objectsRules=c.getObjectsRules()}(t,e,i,r,p,a,l,o,s)}}function e_(t,e,r,n,i){u.assertValue(t,"dataView"),u.assertValue(e,"ruleDesc"),u.assertValue(n,"propertyValue"),u.assertValue(i,"ruleType");var a=e.output;if(a){var o=function(t){return u.assertValue(t,"selectorRoles"),[{data:[bf(t)]}]}(a.selector);if(i.fillRule)return function(t,e,r,n,i){u.assertValue(t,"dataView"),u.assertValue(e,"ruleDesc"),u.assertValue(r,"selectorsToCreate"),u.assertValue(i,"propertyValue");var a=function(t,e,r){u.assertValue(t,"dataView"),u.assertValue(e,"identifier"),u.assertValue(1,"identifierKind");var n=t.metadata.columns;return _.find(n,function(i){return i.roles&&i.roles[e]})}(t,e.inputRole);if(a){var o=no().fromFillRule(i,a);if(o){var s=new YI(e.inputRole,o),l={};l[e.output.property]={solid:{color:s}};for(var c=[],f=0,d=r.length;f<d;f++)c.push({selector:r[f],rules:[s],objects:[{name:n,properties:l}]});return c}}}(t,e,o,r,n)}}nction Rg(t){return u.assertValue(t,"categories"),!_.isEmpty(t)&&t[0].objects}function ic(t){u.assertValue(t,"dataViewCategorical");var e=_.isEmpty(t.categories)?_.isEmpty(t.values)?0:t.values[0].values.length:t.categories[0].values.length;return u.assert(function(){return _.every(t.categories,function(r){return r.values.length===e})},"Invariant: every category column is expected to have the same number of values."),u.assert(function(){return _.every(t.categories,function(r){return r.identity.length===e})},"Invariant: every category column is expected to have the same number of identities as there are values."),u.assert("Invariant: every value column is expected to have the same number of values."),e}function Ng(t){u.assertValue(t,"categorical");var e=t.values;if(e){var n;if(e.source){n=N(e.grouped());var i=0===ic(t),a=e.length>=1&&(i||void 0!==_.head(e).identity);if(!_.isEmpty(e)&&a)for(var s,o=0,l=function(h,v){var g=e[h];if(rc(g))return"continue";if(!s||g.identity!==s.identity){var y=n[o];y?s=N(y):(u.assert(function(){return!g.identity},"!currentValueColumn.identity -- Extra valueGroup items should be statics (no identity)."),s=y=n[o]={values:null}),n[o]=s,s.values=[],o++,u.assert(function(){return g.identity===s.identity},"expecting the value columns are sequenced by series groups")}s.values.push(g)},c=0,f=e.length;c<f;c++)l(c);else for(c=0,f=n.length;c<f;c++){var d=n[c];_.isEmpty(d.values)||(n[c]=d=N(d),d.values=[])}}else n=[{values:e}];e.grouped=function(){return n},t.values=e}}function kg(t,e){u.assertValue(t,"measureSources"),u.assertValue(e,"projectionOrder");var r=go(t,e);if(!xe(t,r=_.chain(r).filter(function(i){return void 0!==i.projectionOrderIndex}).sortBy(function(i){return i.projectionOrderIndex}).value(),)return r}function Lg(t){if(u.assertValue(t,"groups"),!_.isEmpty(t))return _.chain(t[0].values).map(function(r){return r.source}).filter(function(r){return void 0!==r.index}).value()}function E_(t,e,r,n,i){u.assertValue(t,"dataView"),u.assertAnyValue(e,"objectDescriptors"),u.assertAnyValue(r,"applicableRoleMappings"),u.assertAnyValue(n,"projectionActiveItems");var a=t,o=t.categorical;if(o){var s=function(t,e,r){u.assertValue(t,"dataViewCategorical"),u.assertAnyValue(e,"applicableRoleMappings");var n,i=_.chain(e).filter(function(c){return!sn(c)}).map(function(c){return c.categorical}).value(),a=!_.isEmpty(i)&&_.every(i,function(c){return!!c});if(a){var o=function(t){u.assertNonEmpty(t,"categoricalRoleMappings"),u.assert(function(){return _.every(t,function(r){return!!r})},"categoricalRoleMappings must not contain falsy element");var e=_v(t,Fv);if(1===_.size(e))return _.head(e)}(i);if(o&&_.includes(r,o)&&function(t,e){u.assertValue(t,"categoricalRoleName"),u.assertNonEmpty(e,"roleMappings"),u.assert("All specified roleMappings are expected to target categorical");var r=_.every(e,;return r}(o,e)){var s=_.filter(t.categories,;if(!_.isEmpty(s)){var l=_.every(s,;l&&(n={roleName:o,categories:s})}}}return n}(o,r,i),l=function(t){var e=_.find(t,;if(e){var n=e.expr.arg;if(ri(n)){var i=n.arg;if(ni(i))return i.property}}}(t.metadata.columns);if(s&&(s.categories.length>=2||l)){var c=_.chain(n&&n[s.roleName]).filter(function(d){return d.suppressConcat}).map(function(d){return d.queryRef}).value();a=function(t,e,r,n,i,a,o){void 0===o&&(o=!1),u.assert("dataView && dataView.categorical && _.size(dataView.categorical.categories) >= 1"),u.assertAnyValue(e,"formatStringPropId"),u.assertValue(r,"roleName"),u.assert(function(){return!_.isEmpty(n)},"!_.isEmpty(columnsSortedByProjectionOrdering)"),u.assert("every column in columnsSortedByProjectionOrdering should exist in dataView.categorical.categories");var c,f,s=n.length-1,l=_.filter(n,;1===n.length?(o||(c=l[0].values),f=l[0].source.type):(o||(c=function(t,e){u.assertValue(t,"columnsSortedByProjectionOrdering"),u.assertAnyValue(e,"formatStringPropId");for(var r=[],n=0,i=t;n<i.length;n++)for(var a=i[n],o=Ya(a.source,e),s=0,l=a.values.length;s<l;s++){var f=Lu(a.values&&a.values[s],o);r[s]=void 0===r[s]?f:r[s]+" "+f}return r}(l,e)),f=L.fromDescriptor({text:!0}));var p=function(t,e,r,n){var i;if(u.assertValue(t,"roleName"),u.assertNonEmpty(e,"sourceColumnsSortedByProjectionOrdering"),u.assert("pre-condition: caller code should not attempt to combine a mix of measure columns and non-measure columns"),n)i=n,_.last(e).displayName);else for(var o=0,s=e;o<s.length;o++){var l=s[o];i=null==i?l.displayName:i+" "+l.displayName}var c={};c[t]=!0;var f={displayName:i,roles:c,type:r},d=_.last(e);return void 0!==d.isMeasure&&(f.isMeasure=d.isMeasure),f.queryName=d.queryName,f}(r,_.map(l,function(x){return x.source}),f,a),h=N(t);if(function(t,e){u.assertValue(t,"transformedDataView"),u.assertValue(e,"newColumn");var r=N(t.metadata.columns);r.push(e);var n=N(t.metadata);n.columns=r,t.metadata=n}(h,p),!o){var v=t.categorical,y=function(t,e,r,n){u.assert("sourceColumnsSortedByProjectionOrdering && sourceColumnsSortedByProjectionOrdering.length >= 1"),u.assertValue(e,"columnMetadata"),u.assertValue(r,"concatenatedValues"),u.assertAnyValue(n,"dataViewObjects");var i={source:e,values:r},a=t[0];return a.identity&&(i.identity=a.identity),a.identityFields&&(i.identityFields=a.identityFields),n&&(i.objects=n),i}(l,p,c,Rg(v.categories)),m=_.last(n),S=_.findIndex(v.categories,function(x){return x===m}),E=N(v.categories);E.splice(S,0,y);for(var C=b=E.length-1;b>=0;b--)C(b);var V=N(v);V.categories=E,h.categorical=V}return h}(t,ro(e),s.roleName,s.categories,c,l)}}return a}var zg={objectName:"scalarKey",propertyName:"min"};function F_(t,e,r){if(u.assertValue(e,"Category type is not specified"),!_.isDate(t)||!e||!e.temporal)return null;var n=t;return e.temporal.year?function(t){return u.assertValue(t,"date"),t.getFullYear()}(n):e.temporal.quarter?function(t,e){u.assertValue(t,"date");return Ne(e,Math.floor((t.getMonth()+3)/3).toLocaleString())}(n,r):e.temporal.month?function(t){return u.assertValue(t,"date"),qe.formatValue(t,"MMMM")}(n):e.temporal.day?function(t){return u.assertValue(t,"date"),t.getDate()}(n):void 0}function L_(t,e){u.assertValue(t,"dataViewMatrix"),e.columnHierarchyRewritten||(t.columns=fe(t.columns));var r=t.columns;e.rowHierarchyRewritten||(t.rows=fe(t.rows));var n=t.rows;if(!(r.levels.length>1)){var i={level:0},a=r.root.children,o=_.size(a),s=n.levels.length;if(o>0){var l=0,c=e.hierarchyTreesRewritten?Og(n.root,c):t.columns.root=ac(n.root,c)}else e.hierarchyTreesRewritten||(t.columns.root=function(t){return ac(t)}(n.root));if(o>1&&(n.levels.push({sources:r.levels[0].sources}),r.levels.length=0),e.hierarchyTreesRewritten)t.columns.root=n.root,t.rows.root={children:[i]};else{var d=fe(t.rows.root);d.children=[i],t.rows.root=d}t.columns.levels=n.levels,t.rows.levels=[]}}nction oc(t,e){var r,n,i=fe(t),a=t.children;if(!(e.nodeProcessor&&e.nodeProcessor(i),_.isEmpty(a)||null!==(n=null===(r=e.skipChildren)||void 0===r?void 0:r.call(e,t))&&void 0!==n&&n))for(var s=a.length,l=i.children=new Array(s),c=0;c<s;c++)l[c]=oc(a[c],e);return i}function qg(t,e,r){if(_.isEmpty(r))return[];var n=un.fromMatrixValues(e);if(_.isEmpty(n))return[];var a=go(r,sc(t,n),n);return _.chain(a).filter(function(o){return void 0!==o.projectionOrderIndex}).sortBy(function(o){return o.projectionOrderIndex}).value()}function sc(t,e){u.assertValue(t,"projectionOrdering"),u.assertValue(e,"roles");for(var r=[],n=0,i=e;n<i.length;n++){var o=t[i[n]];_.isEmpty(o)||r.push.apply(r,o||[])}return r}function Ug(t,e){return u.assertValue(t,"valueSources"),u.assertValue(e,"valueProjectionOrdering"),xe(t,e,}function Hg(t,e,r,n,i){u.assertValue(t,"prototypeRowHierarchy"),u.assertNonEmpty(e,"originalValueSources"),u.assertValue(r,"projectedValueSourceEntries"),u.assert("staticValueSources are not supported with Scoped Measures");var s,c,a=e.length,o=r.length,l=N(t),f=function(h,v){var g=v?h.values:bo(h);if(g&&0!==a){if(!c){c=0;var y={};for(var m in g)c++,y[g[m].valueSourceIndex||0]=!0;a=Object.keys(y).length}if(void 0===s){if(a>o&&n.length>0&&(a-=n.length,0==(c-=n.length)))return;u.assert("expecting the intersection values to have one value per measure column per column group instance"),s=c/a}else u.assert("expecting every interaction values collection to have the same length");var S;if(o>0){S={};for(var E=0;E<s;E++)for(var C=E*a,b=E*o,V=0;V<o;V++)V!==((w=g[C+r[V].sourceIndex]).valueSourceIndex||0)&&((w=N(w)).valueSourceIndex=V||void 0),S[b+V]=w;for(var D=o,A=Object.keys(S).length,I=c+n.length,F=c;F<I;F++){var w;(w=g[F]).valueSourceIndex=D++||void 0,S[A++]=w}}else S=void 0;v?h.values=S:h.nodeValues=S?{0:S}:void 0}};return l.root=void 0===i?ac(l.root,:oc(l.root,{nodeProcessor:skipChildren:),l}function Gg(t,e){u.assertValue(t,"matrixHierarchy"),u.assertValue(e,"projectionOrdering");var n,r=t.levels,i=_.chain(r).map(function(d,p){return p}).filter(function(d){var p=r[d];return _.size(p.sources)>=2&&!lg(p)}).value();if(!_.isEmpty(i)){for(var a=_.uniq(e),o=i.length-1;o>=0;o--){var s=i[o],l=t.levels[s],c=H_(l,a);if(!_.isEmpty(c)){void 0===n&&((n=N(t)).levels=N(t.levels),n.root=Ni(t.root,s,!0));var f=N(l);n.levels[s]=G_(f,c),Q_(n.root,s,c)}}return n}}function H_(t,e){u.assertValue(t,"hierarchyLevel"),u.assertValue(e,"hierarchyProjection");var r,n=t.sources;if(n&&n.length>=2){var i=go(n,e);u.assert("Removed grouping during Matrix Projection ordering");var a=_.sortBy(i,function(o){return o.projectionOrderIndex});r=_.map(a,}return r}function G_(t,e){u.assertValue(t,"transformingHierarchyLevel"),u.assertNonEmpty(e,"levelSourceIndexMappings");var r=t.sources;t.sources=r.slice(0);for(var n=function(l){u.assert("pre-condition: The value in every mapping in the specified levelSourceIndicesReorderingMap must be a valid index to the specified hierarchyLevel.sources array property"),t.sources[l.newSourceIndex]=r[l.originalSourceIndex]},i=0,a=e;i<a.length;i++)n(a[i]);return t}function Q_(t,e,r){u.assertValue(t,"transformingHierarchyRootNode"),u.assertNonEmpty(r,"levelSourceIndexMappings"),u.assert("levelSourceIndexMappings must not contain duplicate originalSourceIndex");var n=_.reduce(r,{});return og(t,e,function(i){var a=i.levelValues;if(!_.isEmpty(a)){u.assert("Invalid levelSourceIndexMappings or transformingHierarchyRootNode: levelSourceIndexMappings should contain an entry for every levelSourceIndex in the matrix hierarchy.");for(var o=_.sortBy(a,,s=0,l=o.length;s<l;s++){var c=N(o[s]),f=n[c.levelSourceIndex];c.levelSourceIndex=f&&f.newSourceIndex,o[s]=c}i.levelValues=o;var d=_.last(o);i.value!==d.value&&(i.value=d.value),(i.levelSourceIndex||0)!==d.levelSourceIndex&&(i.levelSourceIndex=d.levelSourceIndex)}}),t}function Qg(t,e){u.assert("node must be defined and all of its child nodes must have the same level value."),u.assertValue(e,"measureHeadersLevelIndex");var r=t.children;return!_.isEmpty(r)&&r[0].level===e}function jg(t,e,r,n){for(var i=new Array(e),a=0,o=e;a<o;a++){var s=void 0,l=n&&n[a].sourceIndex;null!=l&&(s=r.children&&r.children[l]);var c=s?N(s):{};c.level=t,r.isSubtotal&&(c.isSubtotal=!0),c.levelSourceIndex=a>0?a:void 0,i[a]=c}return i}function Y_(t){u.assertValue(t,"options");var e=_.filter(t.dataRoles,function(r){return!_.isEmpty(r.requiredTypes)});!function(t,e,r){if(u.assertValue(t,"dataview"),!_.isEmpty(e)&&!_.isEmpty(r)){for(var n=t.metadata.columns,r),i=t.metadata.columns,r),a={},o=0,s=e;o<s.length;o++){var l=s[o];l.table&&t.table&&(a.table=!0),l.matrix&&t.matrix&&(a.matrix=!0),l.categorical&&t.categorical&&(a.categorical=!0),l.tree&&t.tree&&(a.tree=!0),l.single&&t.single&&(a.single=!0)}a.categorical&&t.categorical,n,i),a.table&&t.table,n,i),a.tree&&Wg(t.tree.root,n,i),a.matrix&&t.matrix,n,i),a.single&&t,e,r,i)}}(t.dataview,t.dataViewMappings,e)}function eF(t,e){var r=function(t,e){var r=[],n=t&&t.roles;if(!n)return r;for(var i=0,a=e;i<a.length;i++){var o=a[i];if(n[o.name])for(var s=0,l=o.requiredTypes;s<l.length;s++){var f=L.fromDescriptor(l[s]);r.push(f)}}return r}(t,e);if(!_.isEmpty(r))return nction Un(t,e,r,n){if(t){var i=t[e];return null!==i&&!n(r,i)&&((t=N(t))[e]=null),t}}ar lF=function(){eturn t.prototype.trackOriginalDynamicFormatColumn=t.prototype.addPivotedDynamicFormatColumn=function(e,r,n){var i=this;void 0===this.categoryIndexToDynamicFormatColumn[e]&&(this.categoryIndexToDynamicFormatColumn[e]=[]),u.assert("categoryIndexToDynamicFormatColumn[".concat(e,"][").concat(r,"] === undefined")),this.categoryIndexToDynamicFormatColumn[e][r]=n},t.prototype.getPivotedDynamicFormatColumn=function(e,r){var n=this.getValueColumnIndex(e);if(void 0!==n)return u.assertValue(this.categoryIndexToDynamicFormatColumn[n][r],"categoryIndexToDynamicFormatColumn[".concat(n,"][").concat(r,"]")),this.categoryIndexToDynamicFormatColumn[n][r]},t.prototype.getValueColumnIndex=t}();function fF(t,e,r,n,i){if(!function(t,e,r,n,i){if(_.isEmpty(e)||!t||_.isEmpty(i))return!1;var a=_.filter(i,function(m){return!sn(m)});if(1!==a.length)return!1;var o=a[0].categorical;if(!o)return!1;var s=t.matrix;if(!s||!s.rows||!s.rows.levels||2!==s.rows.levels.length)return!1;var l=[],c=[],f=function(S,E){var C=n[S];if(C)for(var b=0,V=C.all();b<V.length;b++){var x=V[b];r[x.queryRef]===rt.Grouping&&E.push(x.queryRef)}};if(po(o.categories,{visitRole:function(S){f(S,l)}}),function(t,e){if(u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t){var r=t.group;r&&(e.visitRole(r.by,"CategoricalSeries"),on(r,e))}}(o.values,{visitRole:function(S){f(S,c)}}),Al(o.values,{visitRole:function(S){f(S,c)}}),_.isEmpty(l)||_.isEmpty(c))return!1;for(var d=0,p=s.columns.levels;d<p.length;d++)for(var v=0,g=p[d].sources;v<g.length;v++)if(!g[v].isMeasure)return!1;return!0}(t,e,r,n,i))return t;var a={metadata:{columns:hf(t.metadata.columns)}};if(t.single&&(a.single=t.single),t.table&&(a.table=t.table),t.matrix){var o=function(t){var se,Ae,e=t.rows,r=e.root,n=r.children,i=[],a=e.levels[0],o=r.childIdentityFields,s={},l=[],c=e.levels[1],f=_.isEmpty(n)?void 0:n[0].childIdentityFields,d=t.valueSources.length,p=function(se){var Ae=s[se.key];return u.assert(function(){return void 0!==Ae},"findcat() !== undefined"),Ae};if(n)for(var v=0,g=n;v<g.length;v++){i.push(y=g[v]);for(var m=0,S=y.children;m<S.length;m++)se=E=S[m],Ae=void 0,void 0,void 0===s[Ae=se.identity.key]&&(s[Ae]=l.length,l.push(se))}for(var C=new Array(l.length),b=0;b<i.length;++b)for(var y,V=0,x=(y=n[b]).children;V<x.length;V++){var E;C[w=p((E=x[V]).identity)]||(C[w]=new Array(i.length)),C[w][b]=E.values}var D={root:{children:_.map(i,function(_e){var se=N(_e);return se.level=0,se.children=void 0,se.childIdentityFields=void 0,se}),childIdentityFields:o},levels:[a]};if(d>0){for(var A=_.map(t.columns.root.children,,I=0,F=D.root.children;I<F.length;I++)F[I].children=A;D.levels.push(t.columns.levels[0])}var W={root:{children:_.map(l,function(_e){var se=N(_e);return se.level=0,se.children=void 0,se.childIdentityFields=void 0,se}),childIdentityFields:f},levels:[c]};if(d>0)for(var w=0;w<l.length;++w){var ae=W.root.children[w],oe={};for(b=0;b<i.length;++b)for(var K=C[w]&&C[w][b],Ce=0;Ce<d;++Ce)oe[b*d+Ce]=K?K[Ce]:0===Ce?{value:null}:{value:null,valueSourceIndex:Ce};ae.values=oe}return{rows:W,columns:D,valueSources:t.valueSources}}(t.matrix);_.isEmpty(o.valueSources)||Eo(o.columns)||(a.categorical=function(t,e){for(var r=t.columns.root.children.length,n=t.valueSources,i=n.length,a=function(t){u.assertValue(t,"unpivotedMatrix"),u.assert("pre-condition: unpivotedMatrix should have exactly one level in row hierarchy");for(var e=_.map(t.rows.root.children,function(l){return l.identity}),r=t.rows.root.childIdentityFields,n=t.rows.levels[0].sources,i=[],a=0,o=n.length;a<o;a++){var s=_.map(t.rows.root.children,function(l){var c=l.levelValues;if(void 0!==c)return u.assert("pre-condition: DataViewMatrixNode.levelValues is expected to have one DataViewMatrixGroupValue node per level source column, sorted by levelSourceIndex."),c[a].value});i.push({source:n[a],values:s,identity:e,identityFields:r})}return i}(t),o=[],s=0;s<r;++s){var l=t.columns.root.children[s];o.push(c={values:[],identity:l.identity,name:null!=l.value?l.value:null});for(var f=0;f<i;++f){var p=de({},n[f]);p.groupName=c.name,e.push(p);var h={source:p,values:[],identity:c.identity};c.values.push(h);for(var v=f+s*i,g=0,y=t.rows.root.children;g<y.length;g++)h.values.push(y[g].values[v].value)}}for(var E=[],C=0,b=o;C<b.length;C++){var c=b[C];for(f=0;f<i;++f)E.push(c.values[f])}return E.grouped=function(){return o},E.identityFields=t.columns.root.childIdentityFields,E.source=t.columns.levels[0].sources[0],{categories:a,values:E}}(o,a.metadata.columns))}return a}function Yg(){return new SF}var SF=function(){eturn t.prototype.withCategory=t.prototype.withCategories=t.prototype.withValues=function(e){u.assertValue(e,"options");var r=e.columns;u.assertValue(r,"columns");for(var n=0,i=r;n<i.length;n++)this.staticMeasureColumns.push(i[n].source);return this.staticSeriesValues=r,this},t.prototype.withGroupedValues=function(e){u.assertValue(e,"options");var r=e.groupColumn;u.assertValue(r,"groupColumn"),this.dynamicSeriesMetadata={column:r.source,identityFrom:r.identityFrom,values:r.values};for(var i=0,a=e.valueColumns;i<a.length;i++)this.dynamicMeasureColumns.push(a[i].source);return this.dynamicSeriesValues=e.data,this},t.prototype.fillData=function(e){var r=this,n=_.head(this.categories),i=n&&n.values?n.values.length:0;if(this.hasDynamicSeries())for(var a=function(h,v){var g=o.dynamicSeriesValues[h];u.assert(function(){return g.length===r.dynamicMeasureColumns.length},"seriesMeasures.length === this.dynamicMeasureColumns.length");for(var y=0,m=o.dynamicMeasureColumns.length;y<m;y++)Xg(e[h*m+y],g[y],i)},o=this,s=0,l=this.dynamicSeriesMetadata.values.length;s<l;s++)a(s);if(this.hasStaticSeries())for(var c=this.hasDynamicSeries()?this.dynamicSeriesValues.length*this.dynamicMeasureColumns.length:0,f=0,d=this.staticMeasureColumns.length;f<d;f++)Xg(e[c+f],this.staticSeriesValues[f],i)},t.prototype.build=function(){for(var e,r,n=[],i={},o=this.dynamicSeriesMetadata,s=0,l=this.categories;s<l.length;s++)zi(n,l[s].source);if(this.hasDynamicSeries()){zi(n,o.column),i.values=Ar([],o.identityFrom.fields,o.column);for(var f=o.values,d=new Map,p=0,h=this.dynamicMeasureColumns;p<h.length;p++)null!==(e=(v=h[p]).formatSource)&&void 0!==e&&e.formatString&&d.set(v.formatSource.formatString,new Map);for(var g=0;g<f.length;g++)for(var y=f[g],m=$g(o.identityFrom,g,y,o.column.type),S=0,E=this.dynamicMeasureColumns;S<E.length;S++){var v=E[S];(C=_.toPlainObject(v)).groupName=y,d.has(v)&&d.get(v).set(C.groupName,C),C.rolesIndex&&delete C.rolesIndex,zi(n,C),i.values.push({source:C,values:[],identity:m})}if(d.size>0)for(var b=function(W){null!==(r=W.formatSource)&&void 0!==r&&r.formatString&&(u.assert("formatString column must be in dynamicFormatStringMappings"),W.formatSource={formatString:d.get(W.formatSource.formatString).get(W.groupName)})},V=0,x=n;V<x.length;V++)b(C=x[V]);if(0===f.length)for(var w=0,D=this.dynamicMeasureColumns;w<D.length;w++){var C;v=D[w],zi(n,C=_.toPlainObject(v)),i.values.push({source:C,values:[]})}if(this.hasStaticSeries()){var A=i.values.grouped();i.values.grouped=function(){return A},this.appendStaticMeasureColumns(n,i.values)}}else i.values=Ar(),this.appendStaticMeasureColumns(n,i.values);var I=this.categories;_.isEmpty(I)||(i.categories=I),this.fillData(i.values);var F={metadata:{columns:n},categorical:i};if(this.isLegalDataView(F))return F},t.prototype.appendStaticMeasureColumns=function(e,r){if(u.assertValue(e,"metadataColumns"),u.assertValue(r,"valueColumns"),!_.isEmpty(this.staticMeasureColumns))for(var n=0,i=this.staticMeasureColumns;n<i.length;n++){var a=i[n];zi(e,a),r.push({source:a,values:[]})}},t.prototype.isLegalDataView=t.isVisualDataView=t.prototype.hasDynamicSeries=function(){return!!this.dynamicSeriesMetadata},t.prototype.hasStaticSeries=function(){return!!this.staticSeriesValues},t}();function $g(t,e,r,n){var i=t.identities;return i?i[e]:(u.assert("Inferring identity, expect exactly one field."),mt(Tn(t.fields[0],rn(r,n))))}unction Xg(t,e,r){u.assertValue(t,"target"),u.assertValue(e,"source"),u.assertValue(r,"categoryLength");var n=e.values;u.assert("categoryLength === values.length || categoryLength === 0"),t.values=n;var i=e.highlights;i&&(u.assert(function(){return r===i.length},"categoryLength === highlights.length"),t.highlights=i);var o,a=e.objects;a&&(u.assert("categoryLength === objects.length"),t.objects=a),void 0!==e.minLocal&&(o||(o={}),o.minLocal=e.minLocal),void 0!==e.maxLocal&&(o||(o={}),o.maxLocal=e.maxLocal),o&&(t.source.aggregates=o,_.extend(t,o))}var Zg="RegressionX",ey="RegressionSeries",ty="RegressionY";function CF(t,e,r,n,i,a,o,s){return u.assertValue(e,"applicableDataViewMappings"),2===Ti(e)?function(){function t(s,l,c,f,d,p,h){u.assertValue(s,"sourceDataView"),u.assertValue(s.matrix,"sourceDataView.matrix"),u.assertValue(l,"dataRoles"),u.assertValue(f,"objectDescriptors"),u.assertValue(d,"objectDefinitions");var v=s.matrix;if(v&&v.rows&&v.rows.root&&0!==_.size(v.rows.root.children)&&!(_.size(v.rows.levels)>2)){var g=e(0,v,l),y=e(1,v,l);if(void 0!==g&&void 0!==y){var m=g.valuesCol,S=y.valuesCol,E=s,g.getValues,y.getValues),C=!0,b=sn(c);if(b&&s.metadata.objects){var V=b.combineSeries;V&&(C=rr(s.metadata.objects,V,!0))}var x=E;C&&(x=E));var w=uc(x);if(lc(w)){for(var D=w.xMin,A=w.xMax,I=[],F=0,R=w.lineDefs;F<R.length;F++)I.push(cc(R[F],+D,+A));return function(s,l,c,f,d,p,h,v,g,y){var m,S,E;u.assertValue(s,"xColumnSource"),u.assertValue(l,"yColumnSource"),u.assertValue(f,"categories"),u.assertValue(d,"values"),u.assertValue(h,"objectDescriptors"),u.assertValue(v,"objectDefinitions");var I,b=p.matrix.rows.select[1].bind.to,V=p.matrix.values.select[0].for.in,x=((m={})[p.matrix.rows.select[0].bind.to]=!0,m),w=((S={})[V]=!0,S),D=((E={})[b]=!0,E),A={columns:[]},F={levels:[],root:{children:[]}},R={metadata:A,matrix:{rows:F,columns:I,valueSources:[]}},W=Hn(s,Zg,!1,"",x),ae=Hn(l,ey,l.isMeasure,"Regression",D),oe=Hn(l,ty,l.isMeasure,"",w);A.columns.push(ae),A.columns.push(W),A.columns.push(oe),F.levels.push({sources:[ae]}),F.levels.push({sources:[W]}),R.matrix.valueSources.push(oe);for(var K=Ie(Ge("s","RegressionEntity"),"RegressionSeries"),Ce=Ie(Ge("s","RegressionEntity"),"RegressionCategories"),De=0;De<c.length;De++){var be=c[De],_e={level:0,value:be,levelValues:[{levelSourceIndex:0,value:be}],children:[],childIdentityFields:[Ce],identity:mt(it(K,rn(be,ae.type)))};_.isEmpty(F.root.childIdentityFields)&&(F.root.childIdentityFields=[K]),F.root.children.push(_e);for(var se=0;se<f.length;se++){var Ae=f[se],ct={level:1,value:Ae,levelValues:[{levelSourceIndex:1,value:Ae}],values:{},identity:mt(it(Ce,rn(Ae,W.type)))};ct.values[0]={value:d[De][se]},_e.children.push(ct)}}return Do(R,1,h,v,[],g,y),R}(m,S,C?["combinedRegressionSeries"]:2===v.rows.levels.length?_.chain(v.rows.root.children).filter(function(K){return!K.isSubtotal}).map(function(K){return K.value}).value():["combinedRegressionSeries"],[D,A],I,c,f,d,p,h)}}}}eturn{apply:function(l,c,f,d,p,h,v){return t(l,c,f,d,p,h,v)}}}().apply(t,r,n,i,a,o,s):function(){function t(l,c,f,d,p,h,v){if(u.assertValue(l,"sourceDataView"),u.assertValue(l.categorical,"sourceDataView.categorical"),u.assertValue(c,"dataRoles"),u.assertValue(d,"objectDescriptors"),u.assertValue(p,"objectDefinitions"),l.categorical){var g=e(0,l.categorical,c),y=e(1,l.categorical,c);if(!_.isEmpty(g)&&!_.isEmpty(y)){var m=g[0].source,S=y[0].source,E=!0,C=sn(f);if(C&&l.metadata.objects){var b=C.combineSeries;b&&(E=rr(l.metadata.objects,b,!0))}var x=uc(a(g,y,E,!1));if(lc(x)){var I,K,be,w=x.xMin,D=x.xMax,A=s(y)||s(g);A&&(lc(I=uc(a(g,y,E,!0)))?(w=_.min([w,I.xMin]),D=_.max([D,I.xMax])):A=!1);for(var R=[],W=0,ae=x.lineDefs;W<ae.length;W++)R.push(cc(ae[W],+w,+D));if(A){K=[];for(var Ce=0,De=I.lineDefs;Ce<De.length;Ce++)K.push(cc(De[Ce],+w,+D))}if(E)be=["combinedRegressionSeries"];else if(l.categorical.values.source){var _e=l.categorical.values.grouped();be=_.map(_e,function(Ae){return Ae.name})}else be=_.map(y,function(Ae){return Ae.source.queryName});return function(l,c,f,d,p,h,v,g,y,m,S){var E,C,b;u.assertValue(l,"xColumnSource"),u.assertValue(c,"yColumnSource"),u.assertValue(d,"categories"),u.assertValue(p,"values"),u.assertValue(g,"objectDescriptors"),u.assertValue(y,"objectDefinitions"),u.assertAnyValue(h,"highlights"),u.assert("highlights should have the same length as values");var w,D,V=v.categorical.categories.for.in,x=v.categorical.values.group;if(x&&!_.isEmpty(x.select)&&(w=x.select[0].for?x.select[0].for.in:x.select[0].bind.to,D=x.by),w&&D){var A=((E={})[V]=!0,E),I=((C={})[w]=!0,C),F=((b={})[D]=!0,b),R=[];for(var W in p){var ae={values:p[W]};h&&(ae.highlights=h[W]),R.push([ae])}var oe=Yg().withCategory({source:Hn(l,Zg,!1,"",A),values:d,identityFrom:{fields:[Ie(Ge("s","RegressionEntity"),"RegressionCategories")]}}).withGroupedValues({groupColumn:{source:Hn(c,ey,c.isMeasure,"Regression",F),values:f,identityFrom:{fields:[Ie(Ge("s","RegressionEntity"),"RegressionSeries")]}},valueColumns:[{source:Hn(c,ty,c.isMeasure,"",I)}],data:R}).build();return Do(oe,1,g,y,[],m,S),oe}}(m,S,be,[w,D],R,K,f,d,p,h,v)}}}}function e(l,c,f){u.assertValue(l,"roleKind"),u.assertValue(c,"categorical");var d=r(l,c.values,f);if(!_.isEmpty(d))return d;var p=c.categories;if(!_.isEmpty(p)){var h=p[0],v=r(l,[h],f);if(!_.isEmpty(v)&&(1===p.length||_.isEmpty(h.values)||!_.isEmpty(h.objects)&&void 0!==n(h.objects[0])))return v}}n{apply:}().apply(t,r,n,i,a,o,s)}tion wF(t,e){u.assertValue(t,"unsortedXValues"),u.assertValue(e,"unsortedYValues");var r=_.zip(t,e),n=_.chain(r).filter(.sortBy(.unzip().value(),i=n[0],a=n[1];return{xValues:i=_.map(i,_.toNumber),yValues:a=_.map(a,_.toNumber)}}function xF(t,e,r){void 0===r&&(r=!1),u.assertValue(t,"xValues"),u.assertValue(e,"yValues");var n=_.sum(t),i=_.sum(e),a=n/t.length,o=i/e.length,s=_.chain(t).map(.sum().value();if(0!==s){var d,c=_.chain(t).map(.sum().value()/s,f=o-a*c;if(r){var p=_.size(t),h=_.chain(t).map(.sum().value(),v=_.chain(t).map(function(m){return m*m}).sum().value(),g=_.chain(e).map(.sum().value(),y=Math.sqrt((p*v-Math.pow(n,2))*(p*g-Math.pow(i,2)));0!==y&&(d=Math.pow((p*h-n*i)/y,2))}return{incline:c,intercept:f,rSquared:d}}}unction ny(t,e,r){for(var n=fe(t),i=0,a=r;i<a.length;i++){var o=a[i];n[o]=e[o]}return n}var Tr={});function PF(t,e){u.assertValue(e,"dataViewMapping");var i,r=e.categorical,n=t.categorical;if(!n)return{isValid:!1};if(r.rowCount&&(i=r.rowCount.supported)&&i.max){var a=void 0,o=n.categories,s=i.max,l=void 0;if(o)for(var c=0,f=o.length;c<f;c++){var d=o[c];if(l=d.values.length,void 0!==s&&l>s){var p=pf(d.values,0,s-1);(a=a||{categories:[]}).categories.push({source:d.source,values:p})}}if(n.values&&n.values.length>0&&s&&(l||(l=n.values[0].values.length),void 0!==s&&l>s))for((a=a||{}).values=Ar(),c=0,f=n.values.length;c<f;c++){var h=n.values[c],v={source:h.source,values:pf(h.values,0,s-1)};void 0!==h.min&&(v.min=h.min),void 0!==h.max&&(v.max=h.max),void 0!==h.subtotal&&(v.subtotal=h.subtotal),a.values.push(v)}a&&(t={metadata:t.metadata,categorical:a})}return iy(t,e)?{dataView:t,isValid:!0}:null}function RF(t,e){return u.assertValue(t,"dataView"),u.assertValue(e,"singleRoleMapping"),t.single?{dataView:t,isValid:!0}:{isValid:!1}}function NF(t,e){return u.assertValue(t,"dataView"),u.assertValue(e,"treeRoleMapping"),ay(t,e)?{dataView:t,isValid:!0}:{isValid:!1}}function kF(t,e){return u.assertValue(t,"dataView"),u.assertValue(e,"tableRoleMapping"),t.table?{dataView:t,isValid:!0}:{isValid:!1}}unction LF(t,e,r){return!(!e||!t||e.scriptResult&&!function(t,e){return u.assertValue(e,"scriptResultRoleMapping"),!(!t||!t.payloadBase64)}(t.scriptResult,e.scriptResult)||e.categorical&&!iy(t,e.categorical,r)||e.tree&&!ay(t,e.tree,r)||e.single&&!function(t,e){return u.assertValue(e,"singleRoleMapping"),!!t}(t.single,e.single)||e.table&&!function(t,e,r){if(u.assertValue(e,"tableRoleMapping"),!t)return!1;if(e.rowCount){var n=e.rowCount.supported;if(r&&e.rowCount.preferred&&(n=e.rowCount.preferred),n){var i=0;if(t.rows&&t.rows.length&&(i=t.rows.length),null!=Ao(i,n))return!1}}return!0}(t.table,e.table,r))}function iy(t,e,r){u.assertValue(e,"categoryRoleMapping");var n=t.categorical;if(!n)return!1;if(e.rowCount){var i=e.rowCount.supported;if(r&&e.rowCount.preferred&&(i=e.rowCount.preferred),i){var a=0;if(n.values&&n.values.length?a=n.values[0].values.length:n.categories&&n.categories.length&&(a=n.categories[0].values.length),null!=Ao(a,i))return!1}}return!0}function ay(t,e,r){u.assertValue(e,"treeRoleMapping");var i=e.depth,a=i&&r?i.preferred:i.supported;return null==Ao(fc(t.metadata.columns),a)}function Ao(t,e,r){if(u.assertValue(t,"value"),e){if(!r&&void 0!==e.min&&e.min>t)return Tr.conditionRangeTooSmall;if(void 0!==e.max&&e.max<t)return Tr.conditionRangeTooLarge}}function qF(t,e,r,n){if(t&&void 0!==t.kind){var i=t.kind,a=r[e];if(a)for(var s=0,l=a.all();s<l.length;s++)if(n[l[s].queryRef]!==i)switch(i){case rt.Measure:return Tr.conditionKindExpectedMeasure;case rt.Grouping:return Tr.conditionKindExpectedGrouping;case rt.GroupingOrMeasure:return Tr.conditionKindExpectedGroupingOrMeasure}}}function UF(t,e,r,n){if(t&&t.areHierarchicallyRelated&&!_.isEmpty(e)&&!_.isEmpty(r)&&n){var a=oy(_.map(e,function(o){return o.queryRef}),r);if(!ht.areHierarchicallyRelated(n,a))return Tr.conditionNotHierarchicallyRelated}}function HF(t,e,r){if(u.assertAnyValue(t,"can be called with empty role"),u.assertNonEmpty(e,"must have selects"),u.assertValue(r,"must have Schema"),1!==_.chain(e).map(function(l){return l.name}).uniq().value().length){var a=oy(_.map(t,function(l){return l.queryRef}),e),o=_.chain(a).map(function(l){return r.schema(l.schema)}).uniq().value(),s=_.uniqWith(a,;if(u.assertNonEmpty(s,"uniqueEntityExprs"),s.length<2)return _.some(o,?Tr.conditionSchemaCapabilities_TupleFilters_InstanceFilters:void 0;if(_.some(o,)return Tr.conditionSchemaCapabilities_TupleFilters_InstanceFilters}}unction QF(t,e,r,n,i,a){u.assertValue(t,"projections"),u.assertValue(e,"condition");for(var o=Object.keys(e),s=[],l=0,c=o.length;l<c;l++){var f=o[l],d=t[f]&&!_.isEmpty(t[f].activeProjectionRefs),p=e[f],h=!p.suppressDrill,m=Ao(WF(f,t,h&&(null!=n?n:d)&&h),p);null!=m&&s.push({code:m,roleName:f}),null!=(m=qF(p,f,t,r))&&s.push({code:m,roleName:f});var S=t[f]&&t[f].projected(),E=void 0;_.isEmpty(i)||(E=_.map(S,function(C){return i.withName(C.queryRef)})),null!=(m=UF(p,S,E,a))&&s.push({code:m,roleName:f}),p.multiTableTupleFiltersSupported&&a&&!_.isEmpty(i)&&!_.isEmpty(E)&&null!=(m=HF(S,E,a))&&s.push({code:m,roleName:f})}return s}function jF(t,e,r,n){if(_.isEmpty(t))return!0;if(!e||!n)return!1;var i=function(t,e){void 0===t&&(t=new Cf);var r={foreground:{value:"#333333"},foregroundLight:{value:"#FFF"},foregroundDark:{value:"#000"},foregroundNeutralLight:{value:"#EAEAEA"},foregroundNeutralDark:{value:"#212121"},foregroundNeutralSecondary:{value:"#666666"},foregroundNeutralSecondaryAlt:{value:"#777777"},foregroundNeutralSecondaryAlt2:{value:"#888888"},foregroundNeutralTertiary:{value:"#A6A6A6"},foregroundNeutralTertiaryAlt:{value:"#C8C8C8"},foregroundSelected:{value:"#333333"},foregroundButton:{value:"#666666"},background:{value:"#FFF"},backgroundLight:{value:"#EAEAEA"},backgroundNeutral:{value:"#C8C8C8"},backgroundDark:{value:"#000"},tableAccent:{value:t.getColorByIndex(0).value},hyperlink:{value:"#1F3A93"},visitedHyperlink:{value:"#551A8B"},mapPushpin:{value:"#FF5F00"},shapeStroke:{value:"#01B8AA"},disabledText:{value:"#8C8C8C"},dataColors:t},n=function(t,e,r){var n,i,a,o;if(void 0===r&&(r=!1),e)){e.callout.fontFace=xo(null!==(n=e.callout.fontFace)&&void 0!==n?n:""),e.label.fontFace=xo(null!==(i=e.label.fontFace)&&void 0!==i?i:""),e.title.fontFace=xo(null!==(a=e.title.fontFace)&&void 0!==a?a:""),e.header.fontFace=xo(null!==(o=e.header.fontFace)&&void 0!==o?o:"");var f={callout:e.callout,label:e.label,title:e.title,header:e.header,largeTitle:qt(e.largeTitle,e.title,void 0,7/6),dataTitle:qt(e.dataTitle,e.title,t.dataColors.getColorByIndex(0)),boldLabel:qt(e.boldLabel,e.label,void 0,void 0,"700"),largeLabel:qt(e.largeLabel,e.label,void 0,1.2),largeLightLabel:qt(e.largeLightLabel,e.label,t.foregroundNeutralSecondary,1.2),lightLabel:qt(e.lightLabel,e.label,t.foregroundNeutralSecondary),semiboldLabel:qt(e.semiboldLabel,e.label,void 0,void 0,"600"),smallLabel:qt(e.smallLabel,e.label,void 0,.9),smallLightLabel:qt(e.smallLightLabel,e.label,t.foregroundNeutralSecondary,.9),smallDataLabel:qt(e.smallDataLabel,e.label,t.dataColors.getColorByIndex(0),.9)};if(r){var d=t.foreground.value,p=void 0;for(p in f){var h=f[p];h.color?h.color.value=d:h.color={value:d}}}return f}}(r,e);return{isHighContrast:!1,colorPalette:r,textClasses:n,icons:{SignLow:{svgId:"SignLow",description:{resourceKey:"Icon_SignLow"}},SignMedium:{svgId:"SignMedium",description:{resourceKey:"Icon_SignMedium"}},CircleGreenPatternFill:{svgId:"CircleGreenPatternFill",description:{resourceKey:"Icon_CircleGreenPatternFill"}},CircleYellowPatternFill:{svgId:"CircleYellowPatternFill",description:{resourceKey:"Icon_CircleYellowPatternFill"}},CircleRedPatternFill:{svgId:"CircleRedPatternFill",description:{resourceKey:"Icon_CircleRedPatternFill"}},CircleBlackFill:{svgId:"CircleBlackFill",description:{resourceKey:"Icon_4CircleLow"}},CircleGrayPatternFill:{svgId:"CircleGrayPatternFill",description:{resourceKey:"Icon_CircleGrayPatternFill"}},CirclePurplePatternFill:{svgId:"CirclePurplePatternFill",description:{resourceKey:"Icon_CirclePurplePatternFill"}},CircleHigh:{svgId:"CircleHigh",description:{resourceKey:"Icon_CircleHigh"}},CircleMedium:{svgId:"CircleMedium",description:{resourceKey:"Icon_CircleMedium"}},CircleLow:{svgId:"CircleLow",description:{resourceKey:"Icon_4CircleHigh"}},"4CircleLow":{svgId:"4CircleLow",description:{resourceKey:"Icon_4CircleLow"}},CircleMedium1:{svgId:"CircleMedium1",description:{resourceKey:"Icon_CircleMedium1"}},"4CircleMedium2":{svgId:"4CircleMedium2",description:{resourceKey:"Icon_4CircleMedium2"}},CircleEmpty:{svgId:"CircleEmpty",description:{resourceKey:"Icon_CircleEmpty"}},Circle25:{svgId:"Circle25",description:{resourceKey:"Icon_Circle25"}},CircleHalf:{svgId:"CircleHalf",description:{resourceKey:"Icon_CircleHalf"}},Circle75:{svgId:"Circle75",description:{resourceKey:"Icon_Circle75"}},CircleFilled:{svgId:"CircleFilled",description:{resourceKey:"Icon_CircleFilled"}},CircleGreenBlackBackgroundPatternFill:{svgId:"CircleGreenBlackBackgroundPatternFill",description:{resourceKey:"Icon_CircleGreenBlackBackgroundPatternFill"}},CircleYellowBlackBackgroundPatternFill:{svgId:"CircleYellowBlackBackgroundPatternFill",description:{resourceKey:"Icon_CircleYellowBlackBackgroundPatternFill"}},CircleRedBlackBackgroundPatternFill:{svgId:"CircleRedBlackBackgroundPatternFill",description:{resourceKey:"Icon_CircleRedBlackBackgroundPatternFill"}},TrafficLow:{svgId:"TrafficLow",description:{resourceKey:"Icon_TrafficLow"}},TrafficMedium:{svgId:"TrafficMedium",description:{resourceKey:"Icon_TrafficMedium"}},TrafficHigh:{svgId:"TrafficHigh",description:{resourceKey:"Icon_TrafficHigh"}},TrafficBlackRimmed:{svgId:"TrafficBlackRimmed",description:{resourceKey:"Icon_TrafficBlackRimmed"}},CircleRedBlackOutlinePatternFill:{svgId:"CircleRedBlackOutlinePatternFill",description:{resourceKey:"Icon_CircleRedBlackOutlinePatternFill"}},CircleYellowBlackOutlinePatternFill:{svgId:"CircleYellowBlackOutlinePatternFill",description:{resourceKey:"Icon_CircleYellowBlackOutlinePatternFill"}},CircleGreenBlackOutlinePatternFill:{svgId:"CircleGreenBlackOutlinePatternFill",description:{resourceKey:"Icon_CircleGreenBlackOutlinePatternFill"}},TrafficLowLight:{svgId:"TrafficLowLight",description:{resourceKey:"Icon_TrafficLowLight"}},TrafficMediumLight:{svgId:"TrafficMediumLight",description:{resourceKey:"Icon_TrafficMediumLight"}},TrafficHighLight:{svgId:"TrafficHighLight",description:{resourceKey:"Icon_TrafficHighLight"}},TrafficBlackRimmedLight:{svgId:"TrafficBlackRimmedLight",description:{resourceKey:"Icon_TrafficBlackRimmedLight"}},ColoredArrowDown:{svgId:"ColoredArrowDown",description:{resourceKey:"Icon_ColoredArrowDown"}},ColoredArrowDownRight:{svgId:"ColoredArrowDownRight",description:{resourceKey:"Icon_ColoredArrowDownRight"}},ColoredArrowRight:{svgId:"ColoredArrowRight",description:{resourceKey:"Icon_ColoredArrowRight"}},ColoredArrowUpRight:{svgId:"ColoredArrowUpRight",description:{resourceKey:"Icon_ColoredArrowUpRight"}},ColoredArrowUp:{svgId:"ColoredArrowUp",description:{resourceKey:"Icon_ColoredArrowUp"}},ColoredArrowUpRed:{svgId:"ColoredArrowUpRed",description:{resourceKey:"Icon_ColoredArrowUpRed"}},ColoredArrowDownGreen:{svgId:"ColoredArrowDownGreen",description:{resourceKey:"Icon_ColoredArrowDownGreen"}},GreyArrowDown:{svgId:"GreyArrowDown",description:{resourceKey:"Icon_GreyArrowDown"}},GreyArrowDownRight:{svgId:"GreyArrowDownRight",description:{resourceKey:"Icon_GreyArrowDownRight"}},GreyArrowRight:{svgId:"GreyArrowRight",description:{resourceKey:"Icon_GreyArrowRight"}},GreyArrowUpRight:{svgId:"GreyArrowUpRight",description:{resourceKey:"Icon_GreyArrowUpRight"}},GreyArrowUp:{svgId:"GreyArrowUp",description:{resourceKey:"Icon_GreyArrowUp"}},FlagRedPatternFill:{svgId:"FlagRedPatternFill",description:{resourceKey:"Icon_FlagLow"}},FlagYellowPatternFill:{svgId:"FlagYellowPatternFill",description:{resourceKey:"Icon_FlagMedium"}},FlagGreenPatternFill:{svgId:"FlagGreenPatternFill",description:{resourceKey:"Icon_FlagHigh"}},FlagLow:{svgId:"FlagLow",description:{resourceKey:"Icon_FlagLow"}},FlagMedium:{svgId:"FlagMedium",description:{resourceKey:"Icon_FlagMedium"}},FlagHigh:{svgId:"FlagHigh",description:{resourceKey:"Icon_FlagHigh"}},FlagBlack:{svgId:"FlagBlack",description:{resourceKey:"Icon_FlagBlack"}},SymbolLow:{svgId:"SymbolLow",description:{resourceKey:"Icon_SymbolLow"}},SymbolMedium:{svgId:"SymbolMedium",description:{resourceKey:"Icon_SymbolMedium"}},SymbolHigh:{svgId:"SymbolHigh",description:{resourceKey:"Icon_SymbolHigh"}},CircleSymbolLow:{svgId:"CircleSymbolLow",description:{resourceKey:"Icon_CircleSymbolLow"}},CircleSymbolMedium:{svgId:"CircleSymbolMedium",description:{resourceKey:"Icon_CircleSymbolMedium"}},CircleSymbolHigh:{svgId:"CircleSymbolHigh",description:{resourceKey:"Icon_CircleSymbolHigh"}},StarLow:{svgId:"StarLow",description:{resourceKey:"Icon_StarLow"}},StarMedium:{svgId:"StarMedium",description:{resourceKey:"Icon_StarMedium"}},StarHigh:{svgId:"StarHigh",description:{resourceKey:"Icon_StarHigh"}},StarMediumLight:{svgId:"StarMediumLight",description:{resourceKey:"Icon_StarMediumLight"}},StarHighLight:{svgId:"StarHighLight",description:{resourceKey:"Icon_StarHighLight"}},TriangleLow:{svgId:"TriangleLow",description:{resourceKey:"Icon_TriangleLow"}},TriangleMedium:{svgId:"TriangleMedium",description:{resourceKey:"Icon_TriangleMedium"}},TriangleHigh:{svgId:"TriangleHigh",description:{resourceKey:"Icon_TriangleHigh"}},SignalBarEmpty:{svgId:"SignalBarEmpty",description:{resourceKey:"Icon_SignalBarEmpty"}},SignalBarLow:{svgId:"SignalBarLow",description:{resourceKey:"Icon_SignalBarLow"}},SignalBarMedium:{svgId:"SignalBarMedium",description:{resourceKey:"Icon_SignalBarMedium"}},SignalBarMedium2:{svgId:"SignalBarMedium2",description:{resourceKey:"Icon_SignalBarMedium2"}},SignalBarFull:{svgId:"SignalBarFull",description:{resourceKey:"Icon_SignalBarFull"}},SignalBarLowColored:{svgId:"SignalBarLowColored",description:{resourceKey:"Icon_SignalBarLow"}},SignalBarMediumColored:{svgId:"SignalBarMediumColored",description:{resourceKey:"Icon_SignalBarMediumColored"}},SignalBarMedium2Colored:{svgId:"SignalBarMedium2Colored",description:{resourceKey:"Icon_SignalBarMedium2Colored"}},SignalBarFullColored:{svgId:"SignalBarFullColored",description:{resourceKey:"Icon_SignalBarFullColored"}},QuadrantEmpty:{svgId:"QuadrantEmpty",description:{resourceKey:"Icon_QuadrantEmpty"}},Quadrant25:{svgId:"Quadrant25",description:{resourceKey:"Icon_Quadrant25"}},Quadrant50:{svgId:"Quadrant50",description:{resourceKey:"Icon_Quadrant50"}},Quadrant75:{svgId:"Quadrant75",description:{resourceKey:"Icon_Quadrant75"}},QuadrantFull:{svgId:"QuadrantFull",description:{resourceKey:"Icon_QuadrantFull"}},Quadrant25Colored:{svgId:"Quadrant25Colored",description:{resourceKey:"Icon_Quadrant25Colored"}},Quadrant50Colored:{svgId:"Quadrant50Colored",description:{resourceKey:"Icon_Quadrant50Colored"}},Quadrant75Colored:{svgId:"Quadrant75Colored",description:{resourceKey:"Icon_Quadrant75Colored"}},QuadrantFullColored:{svgId:"QuadrantFullColored",description:{resourceKey:"Icon_QuadrantFullColored"}}}}}(),a=Ag(),o=new qn(r,i);return _.every(t,function(s){var l=null,c=n[s.objectName];if(!c)return!1;var d,f=e[s.objectName];return f&&(l=f.properties[s.propertyName]),!_.isEmpty(c)&&c[0]&&(d=$l(n,s,c[0].selector)),!(!l||!d)&&o.evaluateProperty(a,l,d)})}function WF(t,e,r){u.assertValue(t,"roleName"),u.assertValue(e,"projections");var n=e[t];return n?r?1:n.projected().length:0}var JF=["Series","Category"],YF=["Series","X","Y"];function uy(t,e,r,n){u.assertValue(t,"groupingLevelSelectIndices"),u.assertValue(e,"selectTransforms"),u.assertAnyValue(r,"drillableRoles"),u.assertValue(n,"rolesToMatch");for(var i=0,a=t.length,o=0,s=n;o<s.length;o++){var l=s[o];if(a<=i)return!1;var c=eP(t,e,l);if(0===c)return!1;if(c>=2&&!_.includes(r,l))return!1;i+=c}return!(i<a)}function eP(t,e,r){u.assertValue(t,"selectIndices"),u.assertValue(e,"selectTransforms"),u.assertValue(r,"roleToMatch");for(var n=0,i=0,a=t;i<a.length;i++){var o=a[i];if(vT(e[o]&&e[o].roles,r))n++;else if(n>0)break}return n}var ly_quarterPrefix="Qtr {0}";function dc(t){u.assertValue(t,"options");var e=t.prototype,r=t.objectDescriptors,n=t.transforms,i=t.visualStyle,a=t.withWarnings?[]:void 0;if(!e)return{dataViews:aP(r,n,i,t.featureSwitches)};if(!n)return{dataViews:[e]};var o=function(t,e,r,n,i,a,o,s,l,c){u.assertValue(t,"queryDataViewMetadata"),u.assertAnyValue(e,"objectDescriptors"),u.assertAnyValue(r,"dataViewMappings"),u.assertAnyValue(n,"dataRoles"),u.assertAnyValue(i,"drillCapabilities"),u.assertValue(o,"transforms"),u.assertValue(s,"DataViewTransformContext.create - visualStyle");var f=o.selects,d=o.roles&&o.roles.activeItems,p=_.isEmpty(f)?{}:function(t,e){for(var r={},n=0,i=e.columns;n<i.length;n++){var a=i[n];if(!(!a.index&&0!==a.index||a.index<0||a.index>=t.length)){var o=t[a.index];if(o){var s=o.queryName;s&&void 0===r[s]&&(r[s]=a.isMeasure?rt.Measure:rt.Grouping)}}}return r}(f,t),h=function(t,e){if(u.assertAnyValue(t,"selects"),u.assertAnyValue(e,"projectionActiveItems"),_.isEmpty(t))return{};for(var r={},n=0,i=t;n<i.length;n++){var a=i[n];if(a){var o=a.roles;if(o)for(var s in o)if(o[s]){var l=r[s];l||(l=r[s]=new _g([])),l.addProjection({queryRef:a.queryName}),e&&e[s]&&(l.activeProjectionRefs=_.map(e[s],function(c){return c.queryRef}))}}}return r}(f,d),v=function(t,e,r,n,i,a,o,s){u.assertValue(t,"projections"),u.assertAnyValue(e,"mappings"),u.assert("precondition: prototypal inheritance on DataViewMapping is not supported by DataViewAnalysis");var l=[],c=[];if(!_.isEmpty(e))for(var f=0,d=e.length;f<d;f++){var p=e[f],h=p.conditions,g=jF(p.requiredProperties,i,n,a),y=[];if(_.isEmpty(h))y.push({});else for(var m=0,S=h.length;m<S;m++){var E=h[m],C=QF(t,E,r,void 0,void 0,void 0);if(_.isEmpty(C))y.push(E);else for(var b=0,V=C;b<V.length;b++){var x=V[b];x.mappingIndex=f,x.conditionIndex=m,c.push(x)}}if(!_.isEmpty(y)&&g){var w=_.cloneDeep(p);w.single&&(w={table:{rows:{for:{in:w.single.role}}}});var A=_.filter(y,;_.isEmpty(A)||(w.conditions=A),l.push(w)}}return{supportedMappings:Rr(l),mappingErrors:Rr(c)}}(h,r,p,c,e,o.objects),g=v.supportedMappings;return{queryDataViewMetadata:t,objectDescriptors:e,dataRoles:n,drillCapabilities:i,expandCollapseCapabilities:a,transforms:o,selectTransforms:f,projectionOrdering:o.roles&&o.roles.ordering,projectionActiveItems:d,roleKindByQueryRef:p,queryProjectionsByRole:h,visualCapabilitiesRoleMappings:r,visualCapabilitiesDataViewKinds:Ti(r),applicableRoleMappings:g,applicableDataViewKinds:Ti(g),visualStyle:s,visualCapabilitiesKeepAllMetadataColumns:l}}(e.metadata,r,t.dataViewMappings,t.dataRoles,t.drillCapabilities,t.expandCollapseCapabilties,n,i,t.keepAllMetadataColumnsCapability,t.featureSwitches),s=function(t,e){var r,n;u.assertValue(t,"prototype"),u.assertValue(e,"transformContext");var i=e.transforms,a=e.applicableRoleMappings,o=fF(t,e.selectTransforms,e.roleKindByQueryRef,e.queryProjectionsByRole,a),s=null===(n=null===(r=e.transforms)||void 0===r?void 0:r.roles)||void 0===n?void 0:n.isDrillDisabled;return function(t,e,r,n){if(!function(t,e,r,n){if(_.isEmpty(e)||!t||_.isEmpty(r))return!1;var i=t.matrix;if(!i||!i.rows||_.isEmpty(i.rows.levels)||!i.columns||_.isEmpty(i.columns.levels))return!1;for(var a=[],o=0,s=i.columns.levels;o<s.length;o++)for(var c=0,f=s[o].sources;c<f.length;c++)(d=f[c]).isMeasure||a.push(d);for(var p=[],h=0,v=i.rows.levels;h<v.length;h++)for(var g=0,y=v[h].sources;g<y.length;g++)(d=y[g]).isMeasure||p.push(d);for(var m=[],S=0,E=i.rows.levels;S<E.length;S++)for(var C=0,b=E[S].sources;C<b.length;C++){var d;(d=b[C]).isMeasure&&m.push(d)}if(!_.isEmpty(m)||1!==a.length||p.length<1)return!1;var V=_.filter(r,function(R){return!sn(R)});if(1!==V.length)return!1;if(2!==Ti(V))return!1;var w=V[0].matrix;if(!w)return!1;var D=un.fromMatrixRows(w.rows),A=un.fromMatrixColumns(w.columns);if(_.size(D)<2||0!==_.size(A))return!1;var I=_.uniq([].concat.apply([],_.map(p,function(R){return Object.keys(e[R.index].roles)}))),F=_.uniq([].concat.apply([],_.map(a,));return _.isEqual(D,[].concat(F,I))&&_.isEqual(n,I)}(t,e,n,r))return t;var i={metadata:{columns:me([],t.metadata.columns||[],!0)}};if(t.single&&(i.single=t.single),t.table&&(i.table=t.table),t.matrix){var a=function(t){var e=t.rows,r=t.columns,n=e.root,i=n.children;u.assert("oldRows.levels.length ===1"),u.assert("oldColumns.levels.length >=1"),u.assert("oldColumns.levels[0].sources.length === 1");var a={levels:[],root:{children:[]}},s={rows:a,columns:{levels:[],root:{children:[]}},valueSources:t.valueSources},l=a.root.children;a.levels.push(r.levels[0]),a.root.childIdentityFields=r.root.childIdentityFields;for(var c=0,f=r.root.children;c<f.length;c++){var d=f[c];void 0!==d.levelValues&&void 0!==d.value&&l.push({children:[],value:d.value,levelValues:d.levelValues,identity:d.identity,level:0})}var p=_.size(t.valueSources);if(a.levels.push(e.levels[0]),_.isEmpty(l))return s;for(var h in i){var v=i[h];for(var g in v.values){var m=l[Math.floor(g/p)];m.childIdentityFields||(m.childIdentityFields=n.childIdentityFields);var S=v.values[g];if(null!=S){var E=m.children[h];E||m.children.push(E={level:m.level+1,value:v.value,levelValues:v.levelValues,values:{},identity:v.identity}),E.values[g%p]=S}}}return s}(t.matrix);_.isEmpty(a.valueSources)||Eo(a.columns)||(i.matrix=a)}return i}(o=function(t,e,r,n){if(u.assertValue(t,"prototype"),u.assertValue(e,"transformActions"),u.assertAnyValue(r,"applicableRoleMappings"),u.assertAnyValue(n,"drillableRoles"),!_.isEmpty(e.splits))return t;var i=t.matrix;if(!i)return t;var a=_.chain(r).map(function(c){return function(t){u.assertValue(t,"dataViewMapping");var e=t.matrix;if(e&&e.rows&&!e.columns&&!e.values){var r=un.fromMatrixRows(e.rows);if(xe(r,JF,function(i,a){return i===a})||xe(r,YF,function(i,a){return i===a}))return{primaryAxisRoles:r.slice(1),secondaryAxisRole:r[0]}}}(c)}).filter(function(c){return!!c}).value();if(1!==a.length)return t;var o=function(t){u.assertValue(t,"matrix");var e=t.rows&&t.rows.levels,r=t.columns&&t.columns.levels,n=t.valueSources;return{primaryAxis:!_.isEmpty(e)&&sg(e),secondaryAxis:!_.isEmpty(r)&&sg(r),intersection:!_.isEmpty(n)&&_.map(n,function(a){return a.index})}}(i);if(!function(t,e,r,n){u.assertValue(t,"dataViewSelectIndices"),u.assertValue(e,"transformActions"),u.assertAnyValue(r,"drillableRoles"),u.assertValue(n,"matchingUpgradeSourceRolesStructure");var i=t.primaryAxis,a=t.secondaryAxis;if(!_.isEmpty(t.intersection)||1!==_.size(i)||1!==_.size(a))return!1;var o=e.selects;return!(!uy(i[0].selectIndices,o,r,n.primaryAxisRoles)||!uy(a[0].selectIndices,o,r,[n.secondaryAxisRole]))}(o,e,n,a[0]))return t;var s=function(t){u.assertValue(t,"dataViewMatrix"),u.assert(function(){return 1===t.columns.levels.length},"dataViewMatrix.columns.levels.length === 1"),u.assert("dataViewMatrix.rows.levels.length === 1"),u.assert(function(){return _.isEmpty(t.valueSources)},"_.isEmpty(dataViewMatrix.valueSources)");var e=N(t),r=e.rows=N(t.rows),n=e.columns=N(t.columns),a=(n.levels=N(n.levels)).splice(0,1)[0];(r.levels=N(r.levels)).splice(0,0,a);var s=t.rows.root,l=r.root=N(n.root);n.root={children:[]};var c=Bt(l.children,function(f){var d=N(f);return d.childIdentityFields=s.childIdentityFields,d.children=function(t){if(u.assertAnyValue(t,"nodes"),!t)return t;var e=Bt(t,function(r){var n=fe(r);return n.level+=1,n});return e||fe(t)}(s.children),d});return c&&(l.children=c),e}(i),l=N(t);return l.matrix=s,l}(o,i,a,vc(e.drillCapabilities,s)),e.selectTransforms,vc(e.drillCapabilities,s),a)}(e,o),l=function(t,e,r,n,i,a){u.assertValue(e,"transformContext");var o=[],s=e.transforms.splits;if(_.isEmpty(s))o.push(cy(t,e,r,n,null,i,a));else for(var l=0,c=s;l<c.length;l++){var d=cy(t,e,r,n,c[l].selects,null,a);o.push(d)}return o}(s,o,t.featureSwitches,a,t.bypassConcatenation,t.orderIndependentSelectorMatching);return l=function(t){u.assertValue(t,"options");var e=t.visualDataViews,r=t.dataRoles,n=t.objectDescriptors,i=t.objectDefinitions,a=t.transformSelects,o=t.applicableDataViewMappings,s=t.roleKindByQueryRef,l=t.queryProjectionsByRole,c=t.visualStyle,f=t.featureSwitches;if(!_.isEmpty(e)&&a){if(!s||!l||_.isEmpty(o)||!n||!i)return e;var d=_.find(o,;if(d){for(var p=[],h=0,v=e;h<v.length;h++){var y=CF(v[h],o,r,d,n,i,c,f);y&&p.push(y)}_.isEmpty(p)||e.push.apply(e,p||[])}}return e}({visualDataViews:l,dataRoles:o.dataRoles,objectDescriptors:r,objectDefinitions:n.objects,transformSelects:n.selects,applicableDataViewMappings:o.applicableRoleMappings,roleKindByQueryRef:o.roleKindByQueryRef,queryProjectionsByRole:o.queryProjectionsByRole,visualStyle:o.visualStyle,featureSwitches:t.featureSwitches}),{dataViews:l,warnings:a}}function aP(t,e,r,n){if(e&&e.objects){var i={metadata:{columns:[]}};return Do(i,0,t,e.objects,e.selects,r,n),[i]}return[]}function cy(t,e,r,n,i,a,o){var s,l;u.assertValue(t,"prototype"),u.assertValue(e,"transformContext"),u.assert("If selectsToInclude is specified, every included Select must have a corresponding Select Transform.");var c=fe(t);c.metadata=fe(t.metadata),c=function(t,e){if(u.assertValue(t,"prototype"),u.assertValue(e,"transformContext"),nd(e.visualCapabilitiesDataViewKinds)<=1)return t;var n=e.applicableDataViewKinds;if(0===nd(n))return t;var a=N(t);return a.categorical&&!ee(n,1)&&(a.categorical=void 0),a.matrix&&!ee(n,2)&&(a.matrix=void 0),a.table&&!ee(n,8)&&(a.table=void 0),a.tree&&!ee(n,16)&&(a.tree=void 0),a.single&&!ee(n,4)&&(a.single=void 0),a}(c,e);var f=e.visualCapabilitiesDataViewKinds,d=e.visualCapabilitiesRoleMappings,p=e.selectTransforms,h=e.expandCollapseCapabilities,v=e.objectDescriptors,g=e.visualStyle,y=null===(s=e.transforms)||void 0===s?void 0:s.roles,m=null==y?void 0:y.isDrillDisabled,S={rowHierarchyRewritten:!1,columnHierarchyRewritten:!1,hierarchyTreesRewritten:!1},E=[];return c=function(t,e,r,n,i,a,o,s,l){u.assertValue(t,"prototype"),u.assertValue(e,"targetDataViewKinds"),u.assert("if targetDataViewKinds !== None, then roleMappings must be non-empty"),u.assertAnyValue(n,"selectTransforms"),u.assertValue(i,"columnRewrites"),u.assertValue(a,"matrixTransformationContext"),u.assertValue(o,"DataViewTransform.transformSelects - visualStyle");var c=new qn(l,o);return i.length=0,n&&(t.metadata.columns=function(t,e,r,n){if(u.assertValue(t,"columns"),!e)return t;for(var i=fe(t),a={},o=s=0,l=t.length;s<l;s++)o(s);if(n)for(s=0;s<e.length;s++)if(!a[s]){var c=e[s];f=dy(c,f={displayName:c.displayName,index:s,identityExprs:c.identityExprs}),i.push(f)}for(var d={},p=0,h=i;p<h.length;p++){var f;if((f=h[p]).roles&&!f.groupName&&f.index)for(var v in f.rolesIndex||(f.rolesIndex={}),f.roles)void 0===d[v]&&(d[v]=0),f.roles[v]&&(f.rolesIndex[v]=[d[v]++])}return u.assert("post-condition: DataViewMetadataColumn.index is not expected to be rewritten by select transforms."),i}(t.metadata.columns,n,i,s),function(t,e,r){if(u.assertValue(t,"dataView"),u.assertAnyValue(r,"selects"),r)for(var i,n=t.metadata.columns,a=0,o=r.length;a<o;a++){var s=r[a],l=s&&s.aggregateSources;if(l){i||(i=Mo(t,r));var c=hP(n,a,s),f=c.aggregates={},d=L.fromDescriptor(c.type),p=py(e,i,r,d,l.min);void 0!==p&&(f.min=p),void 0!==(p=py(e,i,r,d,l.max))&&(f.max=p)}}}(t,c,n)),t.categorical&&ee(e,1)&&(t.categorical=function(t,e){u.assertValue(t,"prototype"),u.assertValue(e,"columnRewrites");var r=fe(t);function n(s){var l=s,e),c=l.source,f=l.rootSource;if(c){var d=fe(s);return d.source=c,f&&(d.source.rootSource=f),d}}var i=Bt(t.categories,n);if(i&&(r.categories=i),t.values){var a=Bt(t.values,n)||N(t.values);if(r.values=a,a.source){var o=To(a.source,e);o&&(a.source=o)}}return Ng(r),r}(t.categorical,i),t=function(t,e){u.assertValue(t,"dataView");var r,n=function(t,e){if(t&&!_.isEmpty(e)){var r=t.categories;if(!_.isEmpty(r)){var n=t.values;if(!_.isEmpty(n)&&!n.grouped().some(function(l){return!!l.identity}))for(var i=function(c,f){var d=e[c].categorical;if(!d)return"continue";u.assert("There should never be more than one column with the secondary axis group role in a DataViewCategorical, let alone columns in DataViewCategorical.categories.");for(var p=0,h=r;p<h.length;p++){var v=h[p],g=v.source.roles;if(gy(g,d.values)){var y=d.categories;if(IP(g,y)||hc(g,y))return{value:{type:2,selfCrossJoinCategory:v}};if(1===r.length)return{value:{type:1}}}}},a=0,o=e.length;a<o;a++){var s=i(a);if("object"==typeof s)return s.value}}}}(t.categorical,e);if(n)switch(n.type){case 1:r=function(t){var e;u.assertValue(t,"dataView");var r=t.categorical;if(!r)return null;var n=r.categories;if(!n||1!==n.length)return null;var i=r.values;if(_.isEmpty(i)||i.source)return null;for(var a=n[0],o=a.identity,s=a.values,l=[],c=[],f=new lF,d=0,p=s.length;d<p;d++)for(var h=s[d],v=o[d],g=0,y=i.length;g<y;g++){var m=i[g],S=f.getPivotedDynamicFormatColumn(m.source,d);if(void 0===S&&(S=fe(m.source)),m.identity)return null;if(S.groupName=h,S.rootSource=m.source,null!==(e=S.formatSource)&&void 0!==e&&e.formatString){var E=S.formatSource.formatString;f.trackOriginalDynamicFormatColumn(g,E);var C=fe(E);S.formatSource={formatString:C},f.addPivotedDynamicFormatColumn(g,d,C)}var b={source:S,values:[m.values[d]],identity:v,min:m.min,max:m.max,subtotal:m.subtotal},V=m.highlights;V&&(b.highlights=[V[d]]),l.push(S),c.push(b)}var x=fe(t.metadata);return x.columns=l,{metadata:x,categorical:{values:i=Ar(c,a.identityFields,a.source)},matrix:t.matrix}}(t);break;case 2:u.assertValue(n.selfCrossJoinCategory,"selfCrossJoinCategory is expected to be defined when type is SelfCrossJoin"),r=function(t,e){if(u.assertValue(t,"dataView"),u.assert("!selfCrossJoinCategory || _.includes(dataView.categorical.categories, selfCrossJoinCategory)"),t.categorical&&e){var r=t.categorical;if(!(_.isEmpty(r.categories)||r.values&&r.values.source)){var n=function(t,e){return u.assertValue(t,"dataViewCategorical"),u.assertValue(e,"selfCrossJoinCategory"),u.assert("_.includes(dataViewCategorical.categories, selfCrossJoinCategory)"),e.source.identityExprs||(1===t.categories.length?e.identityFields:void 0)}(r,e);if(!_.isEmpty(n))return function(t,e,r,n){u.assertValue(t,"dataViewMetadata"),u.assertValue(e,"dataViewCategorical"),u.assertValue(e.categories,"dataViewCategorical.categories"),u.assertValue(r,"selfCrossJoinCategory"),u.assert(function(){return _.size(r.values)===_.size(r.identity)},"_.size(selfCrossJoinCategory.values) === _.size(selfCrossJoinCategory.identity)"),u.assertValue(n,"seriesGroupIdentityFields");var a=r.values.length;if(0!==a){var o=e.values?e.values.grouped()[0].values:[],s=function(t,e,r,n){u.assertValue(t,"category"),u.assertValue(e,"categoryLength"),u.assertValue(r,"measures"),u.assertValue(n,"seriesGroupIdentityFields");var i=function(t){u.assertValue(t,"length");for(var e=new Array(t),r=0;r<t;r++)e[r]=null;return e}(e),a=function(t,e){u.assertValue(t,"category"),u.assert("_.size(category.values) === _.size(category.identity)"),u.assertValue(!_.isEmpty(e),"!_.isEmpty(seriesGroupIdentityFields)");for(var r=t.identity,n=t.values,i=[],a={},o=0,s=_.size(r);o<s;o++){var c=Wb(r[o].expr,e),f=c&&mt(c),d=f&&f.key,p=a[d],h=void 0;void 0===p?(i.push(h={identity:f,groupValue:n[o],groupIndex:i.length,valueRowIndices:[]}),a[d]=h.groupIndex):h=i[p],h.valueRowIndices.push(o)}return u.assert(function(){return vf(i,},"post-condition: seriesGroups is sorted by group index"),i}(t,n);if(!_.isEmpty(a)){var o=_.map(a,;return{groupColumn:{source:t.source,identityFrom:{fields:n,identities:_.map(a,function(s){return s.identity})},values:_.map(a,function(s){return s.groupValue})},valueColumns:_.map(r,function(s){return{source:s.source}}),data:o}}}(r,a,o,n);if(s){var l=Yg().withCategories(e.categories).withGroupedValues(s).build();return(t=fe(t)).columns=l.metadata.columns,{metadata:t,categorical:l.categorical}}}}(t.metadata,r,e,n)}}}(t,n.selfCrossJoinCategory)}return r||t}(t,r)),t.matrix&&ee(e,2)&&(t.matrix=function(t,e,r){u.assertValue(t,"prototype"),u.assertValue(e,"columnRewrites");var n=fe(t),i=function(f){return To(f,e)};function a(c){var f=null,d=Bt(c.levels,function(p){var h=null,v=Bt(p.sources,i);if(v&&(h=pc(h,p,function(y){return y.sources=v})),p.valueSources){u.assert(function(){return _.isEqual(_.keys(p.valueSources),["0"])},"Scoped Measures with column groupings are not supported"),u.assertValue(p.valueSources[0],"Empty Scoped measures metadata");var g=Bt(p.valueSources[0],i);g&&(h=pc(h,p,)}return h});return d&&(f=pc(f,c,),f}var o=a(n.rows);o&&(n.rows=o,r.rowHierarchyRewritten=!0);var s=a(n.columns);s&&(n.columns=s,r.columnHierarchyRewritten=!0);var l=Bt(n.valueSources,i);return l&&(n.valueSources=l),n}(t.matrix,i,a)),t.table&&ee(e,8)&&(t.table=function(t,e){u.assertValue(t,"prototype"),u.assertValue(e,"columnRewrites");var r=fe(t),i=Bt(t.columns,function(o){return To(o,e)});return i&&(r.columns=i),r}(t.table,i)),t.single&&ee(e,4)&&(t.single=function(t,e){var r=To(t.column,e);return r&&((t=N(t)).column=r),t}(t.single,i)),t}(c,f,d,p,E,S,g,e.visualCapabilitiesKeepAllMetadataColumns,r),Do(c,e.visualCapabilitiesDataViewKinds,v,e.transforms.objects,p,g,r,n,o),c=function(t,e,r,n,i){u.assertValue(t,"prototype"),u.assertValue(e,"transformContext"),u.assertValue(n,"matrixTransformationContext"),u.assertAnyValue(i,"selectsToInclude");var a=e.projectionOrdering,o=e.applicableRoleMappings,s=N(t);if(s.metadata.columns,a,r),s.table&&ee(e.applicableDataViewKinds,8)&&function(t,e,r){if(!e)return t;var n=function(t,e){var r=Object.keys(t);if(1===r.length){var n=r[0],i=_.map(e,function(o){return o.from.index});return function(t,e){if(!xe(t,e,function(o,s){return o===s})){for(var r=[],n=0,i=e.length;n<i;++n)r[n]=t.indexOf(e[n]);return r}}(i,t[n])}}(e,r);if(!n)return t;var i=if((t=N(t)).columns=i(t.columns),_.isEmpty(t.rows)||(t.rows=Bt(t.rows,),t.totals){var a=i(t.totals);t.totals.objects&&(a.objects=i(t.totals.objects)),t.totals=a}}(s.table,a,r),s.matrix&&ee(e.applicableDataViewKinds,2)){var l=_.filter(o,function(c){return!!c.matrix});u.assertValue(0!==l.length,"transformContext.applicableDataViewKinds should not have included Matrix if none of the applicableRoleMappings targets matrix."),u.assertValue(l.length<2,"This logic needs to be enhanced if there is more than one applicable DataViewMapping that targets matrix."),s.matrix=function(t,e,r,n){var i;u.assertValue(t,"prototype"),u.assertValue(e,"matrixMapping"),u.assertAnyValue(r,"projectionOrdering"),u.assertValue(n,"context");var a=t;if(r){a=function(t,e,r,n){u.assertValue(t,"prototype"),u.assertValue(e,"matrixRoleMapping"),u.assertValue(r,"projectionOrdering"),u.assertValue(n,"context");var i=t.valueSources,a=qg(r,e.values,i);if(Ug(i,a))return t;u.assert("Nothing to re-order!");var o=N(t),s=o.columns.levels,l=[];s.length>0&&(l=s[0].sources.filter(),o.rows=Hg(o.rows,o.valueSources,a,l);var c=_.map(a,function(f){return f.metadataColumn});return o.valueSources=c,o.valueSources=o.valueSources.concat(l),o.columns=function(t,e,r,n){u.assertValue(t,"prototypeColumnHierarchy"),u.assertValue(e,"newValueSources");var l,i=t.levels,a=ki(i),s=(a?_.size(i)>=2:_.size(i)>=1)?e.length>=2:e.length>=1;return l=a?s?function(t,e,r,n){u.assert(function(){return t&&ki(t.levels)},"prototypeColumnHierarchy && hasExistingMeasureHeadersLevel(prototypeColumnHierarchy.levels)"),u.assertValue(e,"newValueSources");var i=N(t),a=i.levels=N(i.levels),o=a.length-1,s=a[o]=N(a[o]);return s.sources=e,i.root=Ni(i.root,o,!0),So(i.root,,i}(t,e,r,n):function(t){u.assert("prototypeColumnHierarchy && hasExistingMeasureHeadersLevel(prototypeColumnHierarchy.levels)");var e=N(t),r=e.levels=N(e.levels),n=r.length-1;return r.splice(n,1),e.root=Ni(e.root,n,!0),So(e.root,,e}(t):s?function(t,e){u.assert("prototypeColumnHierarchy && !hasExistingMeasureHeadersLevel(prototypeColumnHierarchy.levels)"),u.assertValue(e,"newValueSources");var r=N(t),n=r.levels=N(r.levels);n.push({sources:e});var a=n.length-1;return r.root=Ni(r.root,a,!0),So(r.root,function(o){return Gl(o)?(o.children=jg(a,e.length,o),2):1}),r}(t,e):t,l}(o.columns,me([],c||[],!0),l,a),n.hierarchyTreesRewritten=!0,o}(a,e,r,n),a=function(t,e,r){u.assertValue(t,"prototype"),u.assertValue(e,"applicableDataViewMapping"),u.assertValue(r,"projectionOrdering");var c,i=sc(r,un.fromMatrixRows(e.rows)),a=Gg(t.rows,i),s=sc(r,un.fromMatrixColumns(e.columns)),l=Gg(t.columns,s);return(a||l)&&((c=N(t)).rows=a||c.rows,c.columns=l||c.columns),c||t}(a,e,r);var o=null===(i=e.rows)||void 0===i?void 0:i.values;_.isEmpty(o)||(a=function(t,e,r,n){u.assertValue(t,"prototype"),u.assertValue(e,"scopedMeasuresRoleMapping"),u.assertValue(r,"projectionOrdering"),u.assertValue(n,"context");for(var i=t,a=0;a<t.rows.levels.length;a++){var s=Co(t.rows.levels[a]);if(!_.isEmpty(s)){var l=[];a===t.rows.levels.length-1&&(u.assert(function(){return ug(t.columns)>0},"Scoped measures at last row level aren't expected without Column grouping"),l=qg(r,e,s)),Ug(s,l)||((i=N(i)).rows=Hg(i.rows,s,l,[],a),i.rows.levels=N(i.rows.levels),(i.rows.levels[a]=N(i.rows.levels[a])).valueSources=l.length>0?{0:_.map(l,function(f){return f.metadataColumn})}:void 0,n.hierarchyTreesRewritten=!0)}}return i}(a,o,r,n))}return a}(s.matrix,l[0].matrix,a,n),s.matrix,o)&&L_(s.matrix,n)}return function(t,e,r,n,i){u.assertValue(t,"prototype"),u.assertAnyValue(e,"applicableRoleMappings"),u.assertAnyValue(r,"dataRoles"),u.assertAnyValue(n,"projectionOrdering"),u.assertAnyValue(i,"splitSelects");var a,o=_.chain(e).filter(function(c){return c.categorical&&!sn(c)}).map(function(c){return c.categorical}).value();if(t.categorical&&o.length>=1){var s=t.categorical,l=function(t,e,r,n){if(u.assertValue(t,"prototypeCategorical"),u.assertValue(e,"categoricalRoleMappingsWithoutRegression"),u.assert("categoricalRoleMappingsWithoutRegression must not contain falsy elements"),u.assertAnyValue(r,"projectionOrdering"),u.assertAnyValue(n,"splitSelects"),!_.isEmpty(t.categories)){var i=_v(e,Fv);if(i){var a=function(t,e,r){if(u.assertValue(t,"roles"),u.assertAnyValue(e,"projectionOrdering"),u.assertAnyValue(r,"splitSelects"),e){var n=_.reduce(t,[]);return n}}(i,r,n);if(a)return function(t,e,r){u.assertValue(t,"prototypeCategorical"),u.assertValue(e,"projectionOrder"),u.assertValue(r,"categoryRoles");var n=t.categories;if(_.isEmpty(n))u.assert(function(){return _.isEmpty(e)},"If DataViewCategory.categories is empty but projectionOrder of primary axis is non-empty, then something went wrong when projectionOrder was getting deserialized or reconstructed.  If projectionOrder for primary axis is truly non-empty, then the DSR and DataView should have some data there.");else if(!function(t,e){return u.assertValue(t,"categories"),u.assertValue(e,"selectIndexOrder"),t.length===e.length&&_.every(e,}(n,e)){var a=go(_.map(n,function(f){return f.source}),e,r),o=_.chain(a).filter(.sortBy(function(f){return f.projectionOrderIndex}).value(),s=_.map(o,,l=N(t);if(_.isEmpty(s))l.categories=void 0;else{var c=Rg(n);c&&(s=function(t,e){if(u.assertValue(t,"prototypeCategories"),u.assertValue(e,"objects"),!_.isEmpty(t)){var r=N(t);return(r[0]=N(r[0])).objects=e,r}}(s,c)||s),l.categories=s}return l}}(t,a,i)}}}(s,o,n,i);l=function(t,e,r,n){u.assertValue(t,"prototypeCategorical"),u.assertAnyValue(e,"dataRoles"),u.assertAnyValue(r,"projectionOrdering"),u.assertAnyValue(n,"splitSelects");var i=t.values;if(i){var a=function(t){if(nc(t)){var e=Ar(t.filter(function(r){return!rc(r)}),void 0,t.source);return e.grouped=t.grouped.bind(e),e}}(i),o=function(t){u.assertValue(t,"values"),u.assert(function(){return!nc(t)},"Dynamic format values should have already been removed");var r,n,i,a,e=t.source,o=t.grouped();if(e){n=Lg(o);var l=(r=o.length)*_.size(n),c=t.length-l;c>0&&(i=l,a=_.chain(t).takeRight(c).map(function(f){return f.source}).value())}else i=0,a=Lg(o);return{secondaryAxisSource:e,dynamicSeriesGroupCount:r,dynamicSeriesMeasureSources:n,staticSeriesMeasureStartingIndex:i,staticSeriesMeasureSources:a}}(a||i),s=function(t,e,r,n){if(u.assertValue(t,"valueColumnsInfo"),u.assertAnyValue(e,"dataRoles"),u.assertAnyValue(r,"projectionOrdering"),u.assertAnyValue(n,"splitSelects"),!r)return function(t,e){u.assertValue(t,"valueColumnsInfo"),u.assertAnyValue(e,"splitSelects");var i=(t.dynamicSeriesMeasureSources||[]).concat(t.staticSeriesMeasureSources||[]),a=_.chain(i).filter(function(o){return!e||!!e[o.index]}).map(function(o){return o.index}).uniq().value();return a}(t,n);var i=_.reduce(e,{}),s=(t.dynamicSeriesMeasureSources||[]).concat(t.staticSeriesMeasureSources||[]),l=_.chain(s).filter(.uniqBy(function(f){return f.index}).map(.flatten().uniq().sortBy(function(f){return i[f]}).value(),c=_.chain(l).map(.flatten().filter(.uniq().value();return c}(o,e,r,n);if(a=function(t,e,r){u.assertValue(t,"prototypeValues"),u.assertValue(e,"prototypeValueColumnsInfo"),u.assertValue(r,"measureRolesProjectionOrder"),u.assert("Dynamic format values should have already been removed");var n=function(t,e,r){if(u.assertValue(t,"prototypeValues"),u.assertValue(e,"prototypeValueColumnsInfo"),u.assertValue(r,"measureRolesProjectionOrder"),e.dynamicSeriesGroupCount&&!_.isEmpty(e.dynamicSeriesMeasureSources)){var n=kg(e.dynamicSeriesMeasureSources,r);if(n){var i=n.length;if(0===i)return[];for(var a=e.dynamicSeriesMeasureSources.length,o=e.dynamicSeriesGroupCount,s=[],l=0;l<o;l++)for(var c=l*a,f=0;f<i;f++)s.push(t[c+n[f].sourceIndex]);return s}}}(t,e,r),i=function(t,e,r){if(u.assertValue(t,"prototypeValues"),u.assertValue(e,"prototypeValueColumnsInfo"),u.assertValue(r,"measureRolesProjectionOrder"),!_.isEmpty(e.staticSeriesMeasureSources)){var n=kg(e.staticSeriesMeasureSources,r);if(n){var i=n.length;if(0===i)return[];for(var a=e.staticSeriesMeasureStartingIndex,o=[],s=0;s<i;s++)o.push(t[a+n[s].sourceIndex]);return o}}}(t,e,r);if(n||i){var a=N(t);return n?i?(u.assert(function(){return _.isEmpty(n)||_.isEmpty(i)},"At least one of the two arrays should be empty, because visual DataView should not have a mix of dynamic and static measures."),a.splice(0,a.length),a.push.apply(a,n||[]),a.push.apply(a,i||[])):(u.assertValue(e.dynamicSeriesGroupCount,"prototypeValueColumnsInfo.dynamicSeriesInstanceCount should have been populated if dynamic series measures got transformed"),u.assertValue(e.dynamicSeriesMeasureSources,"prototypeValueColumnsInfo.dynamicSeriesMeasureSources should have been populated if dynamic series measures got transformed"),a.splice.apply(a,me([0,e.dynamicSeriesMeasureSources.length*e.dynamicSeriesGroupCount],n||[],!1))):i&&(u.assertValue(e.staticSeriesMeasureSources,"prototypeValueColumnsInfo.staticSeriesMeasureSources should have been populated if static series measures got transformed"),u.assertValue(e.staticSeriesMeasureStartingIndex,"prototypeValueColumnsInfo.staticSeriesMeasureStartingIndex should have been populated if static series measures got transformed"),a.splice.apply(a,me([e.staticSeriesMeasureStartingIndex,e.staticSeriesMeasureSources.length],i||[],!1))),a}}(a||i,o,s)||a,a=function(t,e){if(u.assertValue(t,"prototypeValues"),u.assertAnyValue(e,"splitSelects"),e&&t.source&&!e[t.source.index]){var n=N(t);return n.source=void 0,n.identityFields=void 0,n}}(a||i,n)||a,a){var l=!!a.source,c=a.length>0,f=N(t);return l||c?(f.values=a,Ng(f)):f.values=void 0,f}}}(l||s,r,n,i),l&&((a=N(t)).categorical=l)}return a||t}(s,o,e.dataRoles,a,i)}(c,e,E,S,i),c=function(t,e,r,n,i,a,o){if(_.isEmpty(r)||!i)return t;var s=i&&i.roles;if(_.isEmpty(s)||o)return t;u.assertValue(t,"dataView"),u.assertValue(e,"targetDataViewKinds"),u.assertNonEmpty(n,"selectTransforms"),u.assertAnyValue(a,"expansionStates");var l=i.addDataViewFlags;if(u.assertValue(l,"addDataViewFlags"),!0!==(l.propertyIdentifier?rr(t.metadata.objects,l.propertyIdentifier,l.defaultValue):l.defaultValue))return t;var f=_.find(r,function(h){return h.matrix}),d=f&&f.matrix;if(d&&t.matrix&&ee(e,2)){var p=function(t,e,r,n,i,a,o){u.assertNonEmpty(n,"Expand/Collapse is not supported");var s=un.fromMatrixRows(e.rows),l=i&&function(t,e){return u.assertValue(t,"ExpansionStates"),u.assertNonEmpty(e,"Empty roles"),_.find(t,}(i,s),c=function(t,e,r,n,i,a,o){if(u.assertAnyValue(i,"dataViewTransform.applyExpansionStatesToHierarchy - expansionState may not exist"),!_.some(e,){for(var s=0,l=c=0,f=r;c<f.length;c++)l(f[c]);if(s>0){(t=N(t)).levels=N(t.levels),u.assertValue(t.levels,"hierarchy.levels");for(var p=0;p<t.levels.length;p++)p<s-1&&(t.levels[p]=N(t.levels[p]),t.levels[p].canBeExpanded=!0);var h=hy(t.root,t.levels,i&&i.root,i&&i.levels,s);return h&&(t.root=h),o&&i&&function(t,e,r){u.assertValue(t,"hierarchy"),u.assertValue(e,"metadataColumns"),u.assertValue(r,"expansionState");var n=r.levels;if(!_.isEmpty(n)){for(var i={},a=0,o=e;a<o.length;a++){var s=o[a];i[s.queryName]=s}for(var l=new Array(n.length),c=t.levels,f=0,d=function(m){var S=m.queryRefs;if(!_.isEmpty(S)&&!_.isEmpty(c)&&c[f])for(var E=c[f].sources,C=function(D){u.assert("ExpansionState levels should match matrix levels.")},b=0,V=S;b<V.length;b++)C(V[b]);l[f++]={isCollapsed:m.isCollapsed,isPinned:m.isPinned,isLocked:m.isLocked,AIInformation:_.cloneDeep(m.AIInformation),sources:_.map(S,function(w){return i[w]})}},p=0,h=n;p<h.length;p++)d(h[p]);var g=vy(r.root,l,void 0,ht.getPrimitiveValuesFromSQConstantExpr);t.expansionStates=[{levels:l,root:g}]}}(t,a,i),t}}}(t.rows,s,r,n,l,a,o);if(c)return(t=N(t)).rows=c,t}(t.matrix,d,n,s,a,t.metadata.columns,i.addDataViewExpansionState);p&&((t=N(t)).matrix=p)}return t}(c,f,d,p,h,e.transforms.expansionStates,!!m),c=c=function(t,e){u.assertValue(t,"prototype"),u.assertValue(e,"quarterPrefix");var r=t.categorical;if(!r||_.isEmpty(r.categories))return t;var n=r.categories,i=function(t,e){var r;if(t&&(r=t.objects),!_.isEmpty(r)){for(var n=void 0,i=r.length,a=0;a<i;a++){var s=rr(r[a],e);void 0!==s&&(n||(n={values:new Array(i)}),n.values[a]={min:s})}return n}}(n[0],zg);if(!i||_.isEmpty(i.values))return t;for(var a,o,s,c,l=[],f=0,d=n.length;f<d;f++)for(var p=n[f],h=p.source.type,v=p.values,g=void 0,y=void 0,m=0,S=_.size(v);m<S;m++){var C=i.values[m];if(null==v[m]&&null!=C){a||(o=(a=N(t)).categorical=N(r),s=o.categories=N(n)),g||(y=(g=s[f]=N(p)).values=N(v));var b=F_(C.min,h,e);y[m]=b,l[m]||(c||(c=m),l[m]=[]),l[m][f]=rn(b,h)}}var V=function(w,D){for(var A=s[w],I=function(ae,oe){var K=l[ae];K&&(u.assert(function(){return K.length===A.identityFields.length},"category values must match category identities"),A.identity[ae]=mt(vi(A.identityFields,K)))},F=c,R=_.size(A.identity);F<R;F++)I(F)};for(f=0,d=_.size(s);f<d;f++)V(f);return a||t}(c,ly_quarterPrefix)),a||(c=E_(c,v,e.applicableRoleMappings,e.projectionActiveItems,vc(e.drillCapabilities,m))),Y_({dataview:c,dataViewMappings:d,dataRoles:e.dataRoles}),c.metadata&&!(null===(l=null==e?void 0:e.transforms)||void 0===l)&&l.isDataFilterApplied&&(c.metadata.isDataFilterApplied=!0),y&&c.metadata&&(y.drillableRoles&&(c.metadata.dataRoles||(c.metadata.dataRoles={}),c.metadata.dataRoles.drillableRoles=y.drillableRoles),void 0!==m&&(c.metadata.dataRoles||(c.metadata.dataRoles={}),c.metadata.dataRoles.isDrillDisabled=m)),c}function fy(t,e){return u.assertValue(t,"prototypeColumn"),u.assertValue(e,"select"),dy(e,fe(t))}unction hP(t,e,r){u.assertValue(t,"columns"),u.assertValue(e,"selectIdx"),u.assertValue(r,"select");for(var n=0,i=t;n<i.length;n++){var a=i[n];if(a.index===e&&void 0===a.groupName)return a}var o=fy({displayName:r.displayName},r);return t.push(o),o}function py(t,e,r,n,i){u.assertValue(e,"evalContext"),u.assertValue(r,"selects"),u.assertValue(n,"type"),u.assertValue(i,"source");var a=r[i.index];if(a)return t.evaluateValue(e,a.expr,n)}unction pc(t,e,r){return t||(t=fe(e)),r&&r(t),t}function hy(t,e,r,n,i){if(!t.isSubtotal&&t.level!==i-1){var a=!1;if(void 0!==t.level){if(t=N(t),n){var s=n[t.level];t.isCollapsed=!!(+!(!s||!s.isCollapsed)^+!(!r||!r.isToggled))}else t.isCollapsed=_.isEmpty(t.children)||1===t.children.length&&!!t.children[0].isSubtotal;a=!0}if(!_.isEmpty(t.children))for(var c=function(p){var h=t.children[p],v=h.identity,g=v&&Ga(v.expr),y=g&&_.find(r&&r.children,function(S){return xe(S.identityValues,g,H)}),m=hy(h,e,y,n,i);m&&((t=N(t)).children=N(t.children),t.children[p]=m,a=!0)},f=0;f<t.children.length;f++)c(f);return a?t:void 0}u.assert("Leaf node with children")}unction IP(t,e){if(t&&e&&e.bind)return t[e.bind.to]}function hc(t,e){if(t&&e&&e.for)return t[e.for.in]}ction Io(t){var e=function(t){if(t){var e=t.length;if(!(e<=18||e>28)){var r=t[10];if("-"===t[4]&&"-"===t[7]&&("T"===r||" "===r)&&":"===t[13]&&":"===t[16]){var n=kt(t,0,4),i=kt(t,5,2),a=kt(t,8,2),o=kt(t,11,2),s=kt(t,14,2),l=kt(t,17,2),c="Z"===t.charAt(e-1);c&&e--;var f=0;if(e>19){if("."!==t[19])return;var d=e-20,p=kt(t,20,d);if(null===p)return;f=p*dr(3-d)}if(null!==n&&null!==i&&null!==a&&null!==o&&null!==s&&null!==l&&null!==f)return c?new Date(Date.UTC(n,i-1,a,o,s,l,f)):function(t,e,r,n,i,a,o){void 0===e&&(e=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0);var s=new Date(t,e,r,n,i,a,o);return s.epochTimeStamp=Date.UTC(t,e,r,n,i,a,o),s}(n,i-1,a,o,s,l,f)}}}}(t);if(e)return e;u.assert(function(){return mc()},"Moment.js should be loaded for non-fast parseIsoDate.");var r=moment(t);return r.isValid()?r.toDate():null}var NP=/''/g,yy="base64'",kP=/\.000'$/;function my(t){return _o(t)}unction Ec(t,e){if(u.assert("Undefined dsrValue indicates a DSR parsing bug"),null===t)return null;switch(e){case 4:return u.assert(function(){return"string"==typeof t||"number"==typeof t},"Expected only string or number values for type ".concat(e)),"number"==typeof t?t:parseInt(t,10);case 2:case 3:return u.assert(function(){return"string"==typeof t||"number"==typeof t},"Expected only string or number values for type ".concat(e)),"number"==typeof t?t:bc(t);case 7:case 6:if(u.assert(function(){return"string"==typeof t||"number"==typeof t},"Expected only string or number values for type ".concat(e)),"number"==typeof t){u.assert(function(){return t>=0},"Expected positive miliseconds since UNIX epoch for type ".concat(e));var r=new Date(t),n=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds()),i=new Date(r.getTime()+6e4*n.getTimezoneOffset());return i.epochTimeStamp=t,i}var a=Io(t);return a&&ks(a);case 1:return u.assert("Expected only string values for type ".concat(e)),t;case 5:return u.assert(function(){return"number"==typeof t||"boolean"==typeof t},"Expected number or boolean values for type ".concat(e)),"number"==typeof t?1===t:t;case 13:return u.assert("Expected only string or boolean values for type ".concat(e)),_o(t);default:u.assertFail("unsupported dsrValue for type ".concat(e))}}function Cc(t,e,r){if(null===t)return Rt();switch(r){case 4:return"number"==typeof e?In(+t):Ci(260,+t,e.toString());case 2:return"number"==typeof e?Ha(+t):Ci(258,+t,e.toString());case 3:return"number"==typeof e?tn(+t):Ci(259,+t,e.toString());case 7:case 6:return"number"==typeof e?new Te(L.fromExtendedType(519),t):Ci(519,t,e.toString());case 1:return Ee(t.toString());case 5:return $t(!!t);case 13:return _o(e,!0);default:u.assertFail("unsupported dsrValue for type ".concat(r))}}function _o(t,e){var r=typeof t;if("string"===r){if(_.endsWith(t,"L")){var n=parseInt(t,10);return e?In(n,t):n}if(_.endsWith(t,"D")){var i=bc(t);return e?tn(i,t):i}if(_.endsWith(t,"M")){var a=bc(t);return e?Ha(a,t):a}if(_.endsWith(t,"'")){if("'"===t.charAt(0)){var o=t.substring(1,t.length-1).replace(NP,"'");return e?Ee(o,t):o}if(0===t.indexOf("datetime'")){var s=t.replace(kP,"'"),c=Io(t.substring(9,s.length-1));return e?Xt(c,s):c}}if("null"===t)return e?Rt():null;if("true"===t)return!e||$t(!0);if("false"===t)return!!e&&$t(!1)}return"boolean"===r?e?$t(t):t:null===t?e?Rt():null:t}ar Sy=function(){function t(e){u.assertValue(e,"from"),this.clauses={from:e,select:[]}}return t.prototype.addWhere=function(e){u.assertValue(e,"filter");var r=this.clauses;r.where||(r.where=[]),r.where.push(e)},t.prototype.addWheres=function(e){u.assertValue(e,"filters");var r=this.clauses;r.where||(r.where=[]);for(var n=0,i=e;n<i.length;n++)r.where.push(i[n])},t.prototype.addOrderBy=function(e){u.assertValue(e,"sort");var r=this.clauses;r.orderBy||(r.orderBy=[]),r.orderBy.push(e)},t.prototype.addSelect=function(e){u.assertValue(e,"select"),this.clauses.select.push(e)},t.prototype.addGroupBy=function(e){u.assertValue(e,"groupBy");var r=this.clauses;r.groupBy||(r.groupBy=[]),r.groupBy.push(e)},t.prototype.addTransform=function(e){u.assertValue(e,"transformItem");var r=this.clauses;r.transforms||(r.transforms=[]),r.transforms.push(e)},t.prototype.setTop=t.prototype.toQuery=t.prototype.toFilter=function(){var e=this.clauses;if(u.assert("toFilter must not have orderBy/select specified."),e.from&&e.where)return new Ue(e.from,e.where)},t}(),fn={}),G=function(){function t(){}return t.serializeQuery=function(e,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1),u.assertValue(e,"query");var i=[],a=e.from();this.serializeFrom(a,i);var s,o=this.serializeQueryFilters(e.where(),or.create,!1),l=e.transforms();if(!_.isEmpty(l)){s=[];for(var c=0,f=l;c<f.length;c++){var d=f[c],p=_.map(d.input.parameters,function(w){return or.createNamed(w,r)}),h={Name:d.name,Algorithm:d.algorithm,Input:{Parameters:p},Output:void 0};if(d.input.table){var v=this.serializeTransformTableColumns(d.input.table.columns);h.Input.Table={Name:d.input.table.name,Columns:v}}if(d.output&&d.output.table){var g=this.serializeTransformTableColumns(d.output.table.columns);h.Output={Table:{Name:d.output.table.name,Columns:g}}}s.push(h)}}for(var y=this.serializeSortDefinitions(e.orderBy(),r),m=[],S=e.select(),E=0,C=S.length;E<C;E++)m.push(or.createNamed(S[E],r,n));var b,V=e.groupBy();if(V&&V.length)for(b=[],E=0,C=V.length;E<C;E++)b.push(or.createNamed(V[E],r));var x={Version:fn.Version2,From:i,Select:m};return o&&(x.Where=o),s&&(x.Transform=s),y&&(x.OrderBy=y),b&&(x.GroupBy=b),e.top()&&(x.Top=e.top()),x},t.serializeSortDefinitions=t.tryDeserializeQuery=t.isMalformed=t.serializeQueryFilters=t.deserializeQuery=function(e){u.assertValue(e,"contract");var r=e.Version?e.Version:fn.Version0,n=r<fn.Version1,i=It.from(e.From),a=new Sy(i),o=e.Where;if(o)for(var s=0,l=o.length;s<l;s++){var c=It.filter(o[s],i);c&&(n&&(c=Ey.Upgrade(r,c)),a.addWhere(c))}var f=e.Transform,d=i;if(!_.isEmpty(f)){for(var p={},v=0,g=i.keys();v<g.length;v++){var y=g[v];p[y]=i.source(y)}for(s=0,l=f.length;s<l;s++){var m;f[s].Input&&f[s].Input.Table&&(p[m=f[s].Input.Table.Name]=new hi(void 0,m)),f[s].Output&&f[s].Output.Table&&(p[m=f[s].Output.Table.Name]=new hi(void 0,m))}for(d=new Jr(p),s=0,l=f.length;s<l;s++)a.addTransform(It.transform(f[s],d))}var S=e.OrderBy;if(S)for(s=0,l=S.length;s<l;s++)a.addOrderBy(It.sort(S[s],i));var E=e.Select,C={};for(s=0,l=E.length;s<l;s++)a.addSelect(It.select(E[s],C,d));var b=e.GroupBy;if(b){var V={};for(s=0,l=b.length;s<l;s++)a.addGroupBy(It.groupBy(b[s],V,i))}return e.Top&&a.setTop(e.Top),a.toQuery()},t.deserializeSortDefinitions=t.serializeFilter=function(e){var r=[],n=e.from();this.serializeFrom(n,r);var i=this.serializeQueryFilters(e.where(),or.create,!1);return{Version:fn.Version2,From:r,Where:i}},t.serializeFrom=t.deserializeFrom=function(e){return It.from(e)},t.deserializeFilter=function(e,r){u.assertValue(e,"contract");var n=e.Version?e.Version:fn.Version0,i=n<fn.Version1,a=It.from(e.From),o=new Sy(a),s=e.Where;if(s)for(var l=0,c=s.length;l<c;l++){var f=It.filter(s[l],a);f?(i&&(f=Ey.Upgrade(n,f)),o.addWhere(f)):r&&(_.isEmpty(r.RemovedIndexes)&&(r.RemovedIndexes=[]),r.RemovedIndexes.push(l))}return o.toFilter()},t.serializeExpr=function(e,r){return void 0===r&&(r=!1),u.assertValue(e,"contract"),u.assertValue(r,"serializeAnnotations"),or.create(e,!0,r)},t.serializeExprWithRef=function(e,r){return void 0===r&&(r=!1),u.assertValue(e,"contract"),u.assertValue(r,"serializeAnnotations"),or.create(e,!1,r)},t.deserializeExpr=t.deserializeExprWithRef=function(e,r){return u.assertValue(e,"input"),U(e,r)},t.serializeTransformTableColumns=function(e){return u.assertValue(e,"columns"),_.map(e,},t}(),It=function(){function t(){}return t.from=function(e){u.assertValue(e,"contract");var r={};if(e)for(var n=0,i=e.length;n<i;n++){var a=e[n];switch(a.Type){case 2:r[a.Name]=a.Expression.Subquery?new yr(G.deserializeQuery(a.Expression.Subquery.Query)):new tu(OP(a.Expression));break;case 1:r[a.Name]=new cd(a.Schema,a.Entity);break;default:r[a.Name]=new hi(a.Schema,a.Entity)}}return new Jr(r)},t.filter=function(e,r){u.assertValue(e,"contract");var n=r?U(e.Condition,r):Fo(e.Condition);if(n){var i={condition:n};if(e.Target){i.target=[];for(var a=0,o=e.Target;a<o.length;a++){var s=o[a],l=r?U(s,r):Fo(s);if(!l)return;i.target.push(l)}}return e.Annotations&&(i.annotations=e.Annotations),i}},t.sort=function(e,r){return u.assertValue(e,"contract"),{direction:e.Direction,expr:U(e.Expression,r)}},t.select=function(e,r,n){return t.toNamedQueryExpression(e,r,n)},t.groupBy=function(e,r,n){return t.toNamedQueryExpression(e,r,n)},t.transform=t.toNamedQueryExpression=function(e,r,n){u.assertValue(e,"contract"),u.assertValue(n,"from");var i=U(e,n),a=e.Name||va(r,pd(i));r[a]=!0;var o={name:a,expr:i};return e.NativeReferenceName&&(o.nativeReferenceName=e.NativeReferenceName),o},t.deserializeTransformTableColumns=function(e,r){u.assertValue(e,"columns");var n={};return _.map(e,},t}(),BP=),or=function(){function t(e,r){this.standalone=e,this.serializeAnnotations=r}return t.getInstance=t.create=t.createNamed=t.prototype.visitColumnRef=function(e){return this.addAnnotations(e,{Column:{Expression:e.source.accept(this),Property:e.ref}})},t.prototype.visitMeasureRef=function(e){return this.addAnnotations(e,{Measure:{Expression:e.source.accept(this),Property:e.ref}})},t.prototype.visitNativeMeasure=t.prototype.visitNativeColumn=t.prototype.visitAggr=t.prototype.visitPercentile=t.prototype.visitRangePercent=t.prototype.visitHierarchy=function(e){return this.addAnnotations(e,{Hierarchy:{Expression:e.arg.accept(this),Hierarchy:e.hierarchy}})},t.prototype.visitPropertyVariationSource=t.prototype.visitHierarchyLevel=function(e){return this.addAnnotations(e,{HierarchyLevel:{Expression:e.arg.accept(this),Level:e.level}})},t.prototype.visitSelectRef=function(e){return u.assert("Serialization of expr.attributeKind is not supported."),this.addAnnotations(e,{SelectRef:{ExpressionName:e.expressionName}})},t.prototype.visitBetween=t.prototype.visitIn=t.prototype.visitEntity=function(e){var r;return u.assertValue(e,"expr"),this.standalone?r={Schema:e.schema,Entity:e.entity}:(u.assertValue(e.variable,"expr.variable"),r={Source:e.variable}),this.addAnnotations(e,{SourceRef:r})},t.prototype.visitSubqueryRef=function(e){return u.assertValue(e,"expr"),e.variable&&!e.query?this.addAnnotations(e,{SourceRef:{Source:e.variable}}):this.standalone?this.addAnnotations(e,{Subquery:{Query:G.serializeQuery(e.query,!1,this.serializeAnnotations)}}):void u.assertFail("The inlined subquery is only expected to be there in standalone mode.")},t.prototype.visitNamedQueryRef=function(e){return this.standalone?this.addAnnotations(e,{NamedQueryReference:{Name:e.queryName}}):(u.assertValue(e.variable,"expr.variable"),this.addAnnotations(e,{SourceRef:{Source:e.variable}}))},t.prototype.visitAnd=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{And:{Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitOr=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Or:{Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitCompare=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Comparison:{ComparisonKind:e.comparison,Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitConditional=function(e){var r=this;u.assertValue(e,"expr");var n=this.addAnnotations(e,{Conditional:{Cases:_.map(e.cases,function(a){return r.visitCase(a)})}}),i=e.defaultValue;return i&&(n.Conditional.DefaultValue=i.accept(this)),n},t.prototype.visitCase=t.prototype.visitContains=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Contains:{Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitDateAdd=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{DateAdd:{Expression:e.arg.accept(this),Amount:e.amount,TimeUnit:e.unit}})},t.prototype.visitDateSpan=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{DateSpan:{Expression:e.arg.accept(this),TimeUnit:e.unit}})},t.prototype.visitExists=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Exists:{Expression:e.arg.accept(this)}})},t.prototype.visitNot=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Not:{Expression:e.arg.accept(this)}})},t.prototype.visitNow=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Now:{}})},t.prototype.visitDefaultValue=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{DefaultValue:{}})},t.prototype.visitAnyValue=function(e){u.assertValue(e,"expr");var r={};return null!=e.defaultValueOverridesAncestors&&(r.DefaultValueOverridesAncestors=e.defaultValueOverridesAncestors),this.addAnnotations(e,{AnyValue:r})},t.prototype.visitFillRule=function(e){u.assertValue(e,"expr");var r={},n=e.rule;return n.linearGradient2&&(r.linearGradient2=this.visitLinearGradient2(n.linearGradient2)),n.linearGradient3&&(r.linearGradient3=this.visitLinearGradient3(n.linearGradient3)),this.addAnnotations(e,{FillRule:{Input:e.input.accept(this),FillRule:r}})},t.prototype.visitLinearGradient2=function(e){u.assertValue(e,"visitLinearGradient2 - gradient");var r={min:this.visitRuleStop(e.min),max:this.visitRuleStop(e.max)},n=this.visitNullColoringStrategy(e.nullColoringStrategy);return n&&(r.nullColoringStrategy=n),r},t.prototype.visitLinearGradient3=function(e){u.assertValue(e,"visitLinearGradient3 - gradient");var r={min:this.visitRuleStop(e.min),mid:this.visitRuleStop(e.mid),max:this.visitRuleStop(e.max)},n=this.visitNullColoringStrategy(e.nullColoringStrategy);return n&&(r.nullColoringStrategy=n),r},t.prototype.visitRuleStop=function(e){u.assertValue(e,"stop");var r={color:e.color.accept(this)};return e.value&&(r.value=e.value.accept(this)),r},t.prototype.visitNullColoringStrategy=function(e){if(e){u.assertValue(e.strategy,"visitNullColoringStrategy - input.strategy");var r={strategy:e.strategy.accept(this)};return e.color&&(r.color=e.color.accept(this)),r}},t.prototype.visitThemeDataColor=function(e){return this.addAnnotations(e,{ThemeDataColor:{ColorId:e.colorId,Percent:e.percent}})},t.prototype.visitStartsWith=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{StartsWith:{Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitGroupRef=function(e){var r=this;return u.assertValue(e,"expr"),this.addAnnotations(e,{GroupRef:{Expression:e.source.accept(this),Property:e.ref,GroupedColumns:_.map(e.groupedExprs,function(n){return n.accept(r)})}})},t.prototype.visitConstant=function(e){switch(u.assertValue(e,"expr"),e.type.primitiveType){case 5:case 7:case 2:case 4:case 3:case 0:case 1:return this.addAnnotations(e,{Literal:{Value:e.valueEncoded}});default:u.assertFail("Unrecognized kind: "+e.type.primitiveType)}},t.prototype.visitArithmetic=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Arithmetic:{Left:e.left.accept(this),Right:e.right.accept(this),Operator:e.operator}})},t.prototype.visitFloor=function(e){u.assertValue(e,"expr");var r=this.addAnnotations(e,{Floor:{Expression:e.arg.accept(this),Size:e.size}});return null!=e.timeUnit&&(r.Floor.TimeUnit=e.timeUnit),r},t.prototype.visitResourcePackageItem=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{ResourcePackageItem:{PackageName:e.packageName,PackageType:e.packageType,ItemName:e.itemName}})},t.prototype.visitScopedEval=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{ScopedEval:{Expression:e.expression.accept(this),Scope:this.serializeAll(e.scope)}})},t.prototype.visitFilteredEval=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{FilteredEval:{Expression:e.expression.accept(this),Filters:G.serializeQueryFilters(e.filters,t.create,this.standalone)}})},t.prototype.visitWithRef=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{WithRef:{ExpressionName:e.expressionName}})},t.prototype.visitTransformTableRef=t.prototype.visitTransformOutputRoleRef=t.prototype.visitRoleRef=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{RoleRef:{Role:e.role}})},t.prototype.visitSummaryValueRef=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{SummaryValueRef:{Name:e.name}})},t.prototype.visitAllRolesRef=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{AllRolesRef:{}})},t.prototype.visitDiscretize=function(e){return this.addAnnotations(e,{Discretize:{Expression:e.source.accept(this),Count:e.count}})},t.prototype.visitMember=t.prototype.visitSparklineData=t.prototype.serializeAll=t.prototype.visitNativeVisualCalc=t.prototype.addAnnotations=t.instances=[],t}(),Ey=function(){function t(){}return t.Upgrade=function(e,r){if(!r||!r.condition)return null;var n=Zs(r.condition);return e===fn.Version0&&2!==n?{condition:r.condition}:r},t}();function U(t,e){return u.assertValue(t,"contract"),function(t,e){if(t.Column){var r=U(t.Column.Expression,e);if(r)return Ie(r,t.Column.Property,t.Annotations)}}(t,e)||function(t,e){if(t.Measure){var r=U(t.Measure.Expression,e);if(r)return pu(r,t.Measure.Property,t.Annotations)}}(t,e)||function(t,e){if(t.NativeMeasure){var r=void 0;return t.NativeMeasure.ExpressionContentCache&&(r={unrecognizedIdentifiers:t.NativeMeasure.ExpressionContentCache.UnrecognizedIdentifiers,dependencies:dn(t.NativeMeasure.ExpressionContentCache.Dependencies)}),"dax"!==t.NativeMeasure.Language&&u.assertFail("QueryNativeMeasure is using unexpected language: "+t.NativeMeasure.Language),vp(t.NativeMeasure.Language,t.NativeMeasure.Expression,t.NativeMeasure.DataType,t.NativeMeasure.ProposedName,r,t.NativeMeasure.Format,t.Annotations)}}(t)||function(t,e){if(t.NativeColumn){var r=void 0;if(t.NativeColumn.ExpressionContentCache&&(r={unrecognizedIdentifiers:t.NativeColumn.ExpressionContentCache.UnrecognizedIdentifiers,dependencies:dn(t.NativeColumn.ExpressionContentCache.Dependencies)}),"dax"!==t.NativeColumn.Language)return void u.assertFail("QueryNativeColumn is using unexpected language: "+t.NativeColumn.Language);if(!t.NativeColumn.Source)return void u.assertFail("QueryNativeColumn should have a source");var n=U(t.NativeColumn.Source,e);return gp(t.NativeColumn.Language,t.NativeColumn.Expression,t.NativeColumn.DataType,n,t.NativeColumn.ProposedName,r,t.NativeColumn.Format,t.Annotations)}}(t,e)||function(t,e){if(t.SourceRef){if(!e){var a=t.SourceRef;return Ge(a.Schema,a.Entity,void 0,t.Annotations)}var n=t.SourceRef.Source,i=e.source(n);if(i)return wa(i)?Ge(i.schema,i.entity,n,t.Annotations):ru(i)?Ge(i.schema,i.pod,n):Kr(i)?Zr(n,t.Annotations):(u.assert(function(){return xa(i)},"Expected an ExpressionSource"),i.expr.as(n))}}(t,e)||function(t,e){if(t.Aggregation){var r=U(t.Aggregation.Expression,e);if(r)return Yt(r,t.Aggregation.Function,void 0,t.Annotations)}}(t,e)||function(t,e){if(t.Min){var r=U(t.Min.Expression,e);if(r)return Yt(r,3,t.Min.IncludeAllTypes,t.Annotations)}}(t,e)||function(t,e){if(t.Max){var r=U(t.Max.Expression,e);if(r)return Yt(r,4,t.Max.IncludeAllTypes,t.Annotations)}}(t,e)||function(t,e){if(t.SelectRef)return gi(t.SelectRef.ExpressionName,void 0,t.Annotations)}(t)||function(t,e){if(t.Percentile){var r=U(t.Percentile.Expression,e);if(r)return hu(r,t.Percentile.K,t.Percentile.Exclusive||!1,t.Annotations)}}(t,e)||function(t,e){if(t.RangePercent){var r=U(t.RangePercent.Min,e),n=U(t.RangePercent.Max,e);if(r&&n)return yp(r,n,t.RangePercent.Percent,t.Annotations)}}(t,e)||function(t,e){if(t.Arithmetic){var r=U(t.Arithmetic.Left,e),n=U(t.Arithmetic.Right,e);if(r&&n)return yi(r,n,t.Arithmetic.Operator,t.Annotations)}}(t,e)||function(t,e){if(t.Floor){var r=U(t.Floor.Expression,e);if(r)return mp(r,t.Floor.Size,t.Floor.TimeUnit,t.Annotations)}}(t,e)||function(t,e){if(t.Discretize){var r=U(t.Discretize.Expression,e);if(r)return Dp(r,t.Discretize.Count,t.Annotations)}}(t,e)||function(t,e){if(t.Member){var r=U(t.Member.Expression,e);if(r)return Ap(r,t.Member.Member,t.Annotations)}}(t,e)||function(t,e){if(t.Hierarchy){var r=U(t.Hierarchy.Expression,e);if(r)return mi(r,t.Hierarchy.Hierarchy,t.Annotations)}}(t,e)||function(t,e){if(t.HierarchyLevel){var r=U(t.HierarchyLevel.Expression,e);if(r)return Oa(r,t.HierarchyLevel.Level,t.Annotations)}}(t,e)||function(t,e){if(t.PropertyVariationSource){var r=U(t.PropertyVariationSource.Expression,e);if(r)return za(r,t.PropertyVariationSource.Name,t.PropertyVariationSource.Property,t.Annotations)}}(t,e)||function(t,e){if(t.And){var r=U(t.And.Left,e),n=U(t.And.Right,e);if(r&&n)return it(r,n,t.Annotations)}}(t,e)||function(t,e){if(t.Between){var r=U(t.Between.Expression,e),n=U(t.Between.LowerBound,e),i=U(t.Between.UpperBound,e);if(r&&n&&i)return Er(r,n,i,t.Annotations)}}(t,e)||function(t,e){if(t.In){if(t.In.Values)return en(dn(t.In.Expressions,e),_.map(t.In.Values,function(n){return dn(n,e)}));var r=U(t.In.Table,e);if(r)return Su(dn(t.In.Expressions,e),r,t.Annotations)}}(t,e)||function(t,e){if(t.Or){var r=U(t.Or.Left,e),n=U(t.Or.Right,e);if(r&&n)return Si(r,n,t.Annotations)}}(t,e)||function(t,e){if(t.Contains){var r=U(t.Contains.Left,e),n=U(t.Contains.Right,e);if(r&&n)return bp(r,n,t.Annotations)}}(t,e)||function(t,e){if(t.Comparison){var r=U(t.Comparison.Left,e),n=U(t.Comparison.Right,e);if(r&&n)return An(t.Comparison.ComparisonKind,r,n,t.Annotations)}}(t,e)||function(t,e){if(t.Conditional){for(var r=t.Conditional.Cases,n=r.length,i=new Array(n),a=0;a<n;a++){var o=d1(r[a]);if(!o){i=void 0;break}i[a]=o}if(t.Conditional.DefaultValue){var s=U(t.Conditional.DefaultValue);if(i&&s)return Eu(i,s,t.Annotations)}else if(i)return Eu(i,void 0,t.Annotations)}}(t)||function(t,e){if(t.DateAdd){var r=U(t.DateAdd.Expression,e);if(r)return vt(t.DateAdd.TimeUnit,t.DateAdd.Amount,r,t.Annotations)}}(t,e)||function(t,e){if(t.DateSpan){var r=U(t.DateSpan.Expression,e);if(r)return yt(t.DateSpan.TimeUnit,r,t.Annotations)}}(t,e)||function(t,e){if(t.Exists){var r=U(t.Exists.Expression,e);if(r)return Vp(r,t.Annotations)}}(t,e)||function(t,e){if(t.Not){var r=U(t.Not.Expression,e);if(r)return qa(r,t.Annotations)}}(t,e)||function(t){if(t.Now)return Cu(t.Annotations)}(t)||function(t){if(t.DefaultValue)return Ua(t.Annotations)}(t)||function(t){if(t.AnyValue)return Ei(t.AnyValue.DefaultValueOverridesAncestors,t.Annotations)}(t)||function(t,e){if(t.StartsWith){var r=U(t.StartsWith.Left,e),n=U(t.StartsWith.Right,e);if(r&&n)return wp(r,n,t.Annotations)}}(t,e)||function(t,e){if(t.FillRule){var r=U(t.FillRule.Input,e),n=t.FillRule,i={},a=n.FillRule.linearGradient2,o=n.FillRule.linearGradient3;if(a)i.linearGradient2={min:Oi(a.min,e),max:Oi(a.max,e)},(s=Cy(a.nullColoringStrategy,e))&&(i.linearGradient2.nullColoringStrategy=s);else if(o){var s;i.linearGradient3={min:Oi(o.min,e),mid:Oi(o.mid,e),max:Oi(o.max,e)},(s=Cy(o.nullColoringStrategy,e))&&(i.linearGradient3.nullColoringStrategy=s)}return xp(r,i,t.Annotations)}}(t,e)||function(t){if(t.ThemeDataColor)return Vu(t.ThemeDataColor.ColorId,t.ThemeDataColor.Percent,t.Annotations)}(t)||function(t,e){if(t.ResourcePackageItem)return Mp(t.ResourcePackageItem.PackageName,t.ResourcePackageItem.PackageType,t.ResourcePackageItem.ItemName,t.Annotations)}(t)||function(t,e){if(t.ScopedEval){var r=U(t.ScopedEval.Expression,e);if(r)return La(r,dn(t.ScopedEval.Scope,e),t.Annotations)}}(t,e)||function(t,e){if(t.FilteredEval)return vu(U(t.FilteredEval.Expression,e),_.map(t.FilteredEval.Filters,function(n){return It.filter(n,e)}),t.Annotations)}(t,e)||function(t,e){if(t.WithRef)return Sp(t.WithRef.ExpressionName,t.Annotations)}(t)||function(t,e){if(t.TransformTableRef)return gu(t.TransformTableRef.Source,t.Annotations)}(t)||function(t,e){if(t.TransformOutputRoleRef)return yu(t.TransformOutputRoleRef.Role,t.TransformOutputRoleRef.Transform,t.Annotations)}(t)||function(t){if(t.Literal)return Sc(t.Literal.Value)}(t)||function(t,e){if(t.GroupRef){var r=U(t.GroupRef.Expression,e),n=_.map(t.GroupRef.GroupedColumns,function(i){return U(i,e)});if(r&&!_.isEmpty(n))return Ba(t.GroupRef.Property,r,n,t.Annotations)}}(t,e)||function(t){if(t.RoleRef)return mu(t.RoleRef.Role,t.Annotations)}(t)||t)||function(t){if(t.NamedQueryReference)return hp(t.NamedQueryReference.Name,void 0,t.Annotations)}(t)||function(t){if(t.Subquery)return Zr(G.deserializeQuery(t.Subquery.Query),t.Annotations)}(t)||function(t){return function(t){if(t.Boolean)return $t(t.Boolean.Value,t.Annotations)}(t)||by(t)||function(t){if(t.DateTimeSecond)return yt(5,Xt(Vy(t.DateTimeSecond)),t.Annotations)}(t)||by(t)||function(t){if(t.Decimal)return Ha(t.Decimal.Value,void 0,t.Annotations)}(t)||function(t){if(t.Integer)return In(t.Integer.Value,void 0,t.Annotations)}(t)||function(t){if(t.Null)return Rt()}(t)||function(t){if(t.Number)return Sc(t.Number.Value)}(t)||function(t){if(t.String)return Ee(t.String.Value,void 0,t.Annotations)}(t)}(t)||function(t){if(t.SummaryValueRef)return Ep(t.SummaryValueRef.Name,t.Annotations)}(t)||function(t,e){var r=t.SparklineData;if(r)return bu(U(r.Measure,e),dn(r.Groupings,e),r.ScalarKey?U(t.SparklineData.ScalarKey,e):void 0,r.PointsPerSparkline,r.IncludeMinGroupingInterval)}(t,e)||function(t,e){var r=t.NativeVisualCalculation;if(r)return wu(r.Name,r.Expression,t.Annotations)}(t)}tion Oi(t,e){if(t){var r={color:U(t.color,e)};return t.value&&(r.value=U(t.value,e)),r}}unction by(t){var e=t.DateTime||t.Date;if(e){var r=Vy(e);if(r)return Xt(r,void 0,t.Annotations)}}function Vy(t){return u.assertValue(t,"contract"),function(t){try{return function(t){if(pt.throwIfNullOrEmptyString(t,null,"deserializeDate","Cannot deserialize empty string"),Ma(0===t.indexOf("/Date(")&&_.endsWith(t,")/"),"Cannot deserialize empty string"),mc()){var e=moment(t);return Ma(e.isValid(),"parsedValue.isValid must be true"),e.toDate()}var r=t.substring("/Date(".length,t.length-")/".length);Ma(/^\-?\d+$/.test(r),"Cannot deserialize invalid date");var n=parseInt(r,10);return Ma(!isNaN(n),"Cannot deserialize invalid date"),new Date(n)}(t)}catch(e){}}(t.Value)}function Vc(t){return{scopeId:G.serializeExpr(t.expr)}}function wy(t){if(t.scopeId){var e=G.deserializeExpr(t.scopeId);if(e)return mt(e)}}function Po(t,e,r){En(t)?(xy(r),Po(t.left,e,r.left),Po(t.right,e,r.right)):Cn(t)?(u.assert(function(){return mn(t.left)||Sn(t.left)||Pt(t.left)||$e(t.left)},"expression.left should be fieldRef: entity/measure/column/aggregate"),xy(r,t.left),u.assert("expression.right should be constant"),e.push(t.right)):u.assertFail("identities should consists of COMPARE, AND, and should not reach to fieldRef(ENTITY/MEASURE/COLUMN/AGGREGATE) and CONSTANT exprs")}unction Ro(t,e){return!(!t||!e)&&(t.left&&t.right?!(!e.left||!e.right)&&Ro(t.left,e.left)&&Ro(t.right,e.right):t.value?!!e.value&&H(t.value,e.value):(u.assertFail("CompareTreeNode failed, invalid tree structure"),!1))}function My(t){if(Nt(t))return t.expr;u.assertFail("selectors should be scoped identities")}function No(t,e,r){if(e.left&&e.right)return it(No(t,e.left,r),No(t,e.right,r));if(e.value){var a=e.value,o=t[r.index++];return u.assert(function(){return mn(a)||Sn(a)||Pt(a)||$e(a)},"expression.left should be fieldRef: entity/measure/column/aggregate"),u.assert("expression.right should be constant"),An(0,a,o)}u.assertFail("DecomposedTree should either have left and right Tree, or a valid value")}function W1(t){for(var e=[],n=0,i=t.values;n<i.length;n++){for(var o=[],s=0,l=i[n];s<l.length;s++){var f=_.mapValues(l[s],function(d){return _.map(d,function(p){return G.deserializeExpr(p)})});o.push(f)}e.push(o)}return{values:e,columns:_.map(t.columns,function(d){return wc(d)})}}function wc(t){var e={};if(t.left&&t.right)return e.left=wc(t.left),e.right=wc(t.right),e;if(t.value){var r=G.deserializeExpr(t.value);return mn(r)||Sn(r)||Pt(r)||$e(r)?e.value=r:u.assertFail("Value should be fieldRef: entity/measure/column/aggregate"),e}u.assertFail("DecomposedTree should either have left and right Tree, or a valid value")}function J1(t){if(u.assertAnyValue(t,"contract"),t){var e={expressions:_.map(t.expressions,function(r){return G.serializeExpr(r)})};return t.decomposedIdentities&&(e.decomposedIdentities=function(t){if(u.assertAnyValue(t,"contract"),t){for(var e=[],n=0,i=t.values;n<i.length;n++){for(var o=[],s=0,l=i[n];s<l.length;s++){var f=_.mapValues(l[s],;o.push(f)}e.push(o)}return{values:e,columns:_.map(t.columns,function(d){return xc(d)})}}}(t.decomposedIdentities)),t.valueMap&&(e.valueMap=t.valueMap),t.jsonFilter&&(e.jsonFilter=t.jsonFilter),e}}function xc(t){var e={};return t.left&&t.right?(e.left=xc(t.left),e.right=xc(t.right),e):t.value?(e.value=G.serializeExpr(t.value),e):void u.assertFail("DecomposedTree should either have left and right Tree, or a valid value")}function Z1(t,e){var r;if(u.assertValue(t,"input"),!_.isEmpty(t.expressions)){if(e){var n=function(t){if(u.assertValue(t,"filterExpressionMetadata"),t){var e={expressions:t.expressions},r=[],n=[],i=[];if(t.cachedValueItems){for(var a=0,o=t.cachedValueItems;a<o.length;a++){var s=o[a];i.push(s.valueMap);for(var l=[],c=0,f=s.identities;c<f.length;c++){var p={},h=[],v={};Po(My(f[c]),h,p);for(var g=-1,y=0;y<n.length;y++)if(Ro(p,n[y])){g=y;break}g<0&&(n.push(p),g=n.length-1),v[g]=h,l.push(v)}r.push(l)}e.decomposedIdentities={values:r,columns:n},e.valueMap=i}return e}}(t);r=J1(n)}else r=function(t){if(u.assertValue(t,"input"),!_.isEmpty(t.expressions)){var e={expressions:_.map(t.expressions,function(r){return G.serializeExpr(r)})};return _.isEmpty(t.cachedValueItems)||(e.cachedValueItems=function(t){if(t&&!(t.length<1)){for(var e=[],r=0,n=t;r<n.length;r++){var i=n[r];if(!_.isEmpty(i.identities)){var a=_.map(i.identities,function(o){return Vc(o)});a&&e.push({identities:a,valueMap:i.valueMap})}}return e}}(t.cachedValueItems)),t.jsonFilter&&(e.jsonFilter=t.jsonFilter),e}}(t);return r}}function eR(t){if(u.assertValue(t,"input"),!_.isEmpty(t.expressions)){if(function(t){return!!t.decomposedIdentities}(t)){var e=function(t){if(u.assertAnyValue(t,"input"),t){var e={expressions:_.map(t.expressions,function(r){return G.deserializeExpr(r)})};return t.decomposedIdentities&&(e.decomposedIdentities=W1(t.decomposedIdentities)),t.valueMap&&(e.valueMap=t.valueMap),t.jsonFilter&&(e.jsonFilter=t.jsonFilter),e}}(t);return function(t){if(u.assertValue(t,"decomposedSelectors"),t){var e={expressions:t.expressions},r=t.decomposedIdentities&&t.decomposedIdentities.values,n=t.decomposedIdentities&&t.decomposedIdentities.columns,i=[];if(r&&n){for(var a=0;a<r.length;a++){for(var s=[],l=0,c=r[a];l<c.length;l++){var f=c[l];for(var d in f){var g=mt(No(f[d],n[d],{index:0}));s.push(g)}}i.push({identities:s,valueMap:t.valueMap[a]})}_.isEmpty(i)||(e.cachedValueItems=i),t.jsonFilter&&(e.jsonFilter=t.jsonFilter)}return e}}(e)}return function(t){if(u.assertValue(t,"input"),!_.isEmpty(t.expressions)){var e={expressions:_.map(t.expressions,function(r){return G.deserializeExpr(r)})};return _.isEmpty(t.cachedValueItems)||(e.cachedValueItems=function(t){if(t&&!(t.length<1)){for(var e=[],r=0,n=t;r<n.length;r++){var i=n[r];if(!_.isEmpty(i.identities)){var a=_.map(i.identities,function(o){return wy(o)});a&&e.push({identities:a,valueMap:i.valueMap})}}return e}}(t.cachedValueItems)),t.jsonFilter&&(e.jsonFilter=t.jsonFilter),e}}(t)}}var Mc,pn=L.fromDescriptor({bool:!0}),lt=L.fromDescriptor({numeric:!0}),ye=L.fromDescriptor({text:!0}),Ir={fill:{solid:{color:!0}}};ction sR(t){if(t)return new L(t.underlyingType,t.category)}function uR(t,e,r){if(u.assertAnyValue(t,"input"),u.assertAnyValue(e,"descriptor"),t){var n={properties:cR(t.properties,e?e.properties:null,r)},i=function(t){if(u.assertAnyValue(t,"input"),null===t)return null;if(t){var e={};return t.data&&(e.data=_.chain(t.data).map(function(r){return _y(r)}).filter(function(r){return null!=r}).value()),t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),void 0!==t.highlightMatching&&(e.highlightMatching=t.highlightMatching),null!=t.order&&(e.order=t.order),e}}(t.selector);return i&&(n.selector=i),n}}function _y(t){return u.assertValue(t,"input"),t.scopeId?wy(t):t.wildcard?Rp(_.map(t.wildcard,G.deserializeExpr)):t.roles?bf(t.roles):t.total?function(t){return new Pp(t)}(_.map(t.total,G.deserializeExpr)):t.dataViewWildcard?Au(t.dataViewWildcard.matchingOption):void 0}function cR(t,e,r){if(u.assertAnyValue(t,"input"),u.assertAnyValue(e,"propertyDescriptors"),t){var n={};for(var i in t){var a=fR(t[i],e?e[i]:null,r);void 0!==a&&(n[i]=a)}return n}}function fR(t,e,r){if(u.assertAnyValue(t,"input"),u.assertAnyValue(e,"propertyDescriptor"),e){var n=Ny(e.type);return Dy(t)?{propertyDefinitionKind:"ExprWithContext",value:Ve(t.value,n.value),context:Fy(t.context)}:0,n)?Ve(t,n.value):qi(t,n.structural)}if(r&&t){if(Dy(t))return{propertyDefinitionKind:"ExprWithContext",value:G.deserializeExpr(t.value.expr),context:Fy(t.context)};if(t.expr)return G.deserializeExpr(t.expr);if(t.solid)return qi(t,Ir);if(t.filter)return G.deserializeFilter(t.filter)}}function Ve(t,e){if(u.assertValue(e,"type"),void 0!==e.primitiveType&&t.expr)return G.deserializeExpr(t.expr)}function qi(t,e){if(u.assertValue(e,"type"),e.fill&&e.fill.solid&&e.fill.solid.color&&t)return t.solid&&t.solid.color?{solid:{color:Ve(t.solid.color,L.fromPrimitiveTypeAndCategory(1))}}:void 0;if(e.fillRule){var i=ky(t,Ve);if(i)return i}var a=t;return e.filter&&a&&a.filter?G.deserializeFilter(a.filter):e.image&&a&&a.image?function(t){u.assertValue(t,"input");var e={name:Ve(t.name,ye),url:Ve(t.url,L.fromDescriptor(ec))};return t.scaling&&(e.scaling=Ve(t.scaling,ye)),e}(a.image):e.geoJson&&a&&a.geoJson?function(t){return u.assertValue(t,"input"),{type:Ve(t.type,ye),name:Ve(t.name,ye),content:Ve(t.content,ye)}}(a.geoJson):e.paragraphs&&t?function(t){return u.assertValue(t,"input"),_.map(t,function(e){var r={textRuns:_.map(e.textRuns,function(n){return yg(n)?Tc(n):mg(n)?n):void 0})};return e.horizontalTextAlignment&&(r.horizontalTextAlignment=e.horizontalTextAlignment),e.listType&&(r.listType=e.listType),e.indent&&(r.indent=e.indent),r})}(t):e.queryTransform&&t?function(t){return u.assertValue(t,"input"),{algorithm:t.algorithm,parameters:_.map(t.parameters,}}(t):e.dataBars&&t?function(t){return u.assertValue(t,"input"),{minValue:t.minValue?Ve(t.minValue,lt):void 0,maxValue:t.maxValue?Ve(t.maxValue,lt):void 0,positiveColor:qi(t.positiveColor,Ir),negativeColor:qi(t.negativeColor,Ir),axisColor:qi(t.axisColor,Ir),reverseDirection:Ve(t.reverseDirection,pn),hideText:Ve(t.hideText,pn)}}(t):e.icon&&t&&"Icon"===t.kind?function(t){u.assertValue(t,"input");var e={kind:"Icon"};return t.layout&&(e.layout=Ve(t.layout,ye)),t.verticalAlignment&&(e.verticalAlignment=Ve(t.verticalAlignment,pn)),t.value&&(e.value=Ve(t.value,ye)),e}(t):e.exprList&&t&&"ExprList"===t.kind?function(t){u.assertValue(t,"input");var e={exprs:[],kind:"ExprList"};return e.exprs=_.map(t.exprs,,e}(t):e.errorRange&&t&&"ErrorRange"===t.kind?function(t){u.assertValue(t,"input");var e={kind:"ErrorRange"};if(t.explicit)e.explicit={isRelative:G.deserializeExpr((r=t.explicit).isRelative.expr)},r.lowerBound&&(e.explicit.lowerBound=G.deserializeExpr(r.lowerBound.expr)),r.upperBound&&(e.explicit.upperBound=G.deserializeExpr(r.upperBound.expr));else if(t.symmetricalExplicit)e.symmetricalExplicit={delta:G.deserializeExpr((r=t.symmetricalExplicit).delta.expr)};else if(t.standardDeviation)e.standardDeviation={value:G.deserializeExpr((r=t.standardDeviation).value.expr),multiplier:G.deserializeExpr(r.multiplier.expr)};else if(t.percentage)e.percentage={lowerBoundDelta:G.deserializeExpr((r=t.percentage).lowerBoundDelta.expr),upperBoundDelta:G.deserializeExpr(r.upperBoundDelta.expr)};else if(t.percentile){var r;u.assertValue((r=t.percentile).lowerBound.expr.Percentile,"Percentile lowerBound must be a Percentile expression"),u.assertValue(r.upperBound.expr.Percentile,"Percentile lowerBound must be a Percentile expression"),e.percentile={lowerBound:G.deserializeExpr(r.lowerBound.expr),upperBound:G.deserializeExpr(r.upperBound.expr)}}return e}(t):e.qnaVisualLink&&t?function(t){u.assertValue(t,"input");var e={};return t.suggestedUtterances&&(e.suggestedUtterances=_.map(t.suggestedUtterances,),_.isEmpty(e)?void 0:e}(t):e.itemLocation&&t&&"ItemLocation"===t.kind?function(t){if(u.assertValue(t,"input"),t.byReference){var e={kind:"ItemLocation",byReference:{itemId:Ve(t.byReference.itemId,ye)}};return null!=t.byReference.workspaceId&&(e.byReference.workspaceId=Ve(t.byReference.workspaceId,ye)),null!=t.byReference.folderId&&(e.byReference.folderId=Ve(t.byReference.folderId,ye)),e}}(t):void u.assertFail("Deserializing a structural type failed")}function Fy(t){u.assertValue(t,"input");var e={};return _.isEmpty(t.filterContext)||(e.filterContext=_.map(t.filterContext,function(r){return{filter:G.deserializeFilter(r.filter),metadata:r.metadata?eR(r.metadata):void 0}})),e}function Tc(t){var e={value:vR(t.value)};return t.textStyle&&(e.textStyle=t.textStyle),t.url&&(e.url=t.url),t.mentionEmail&&(e.mentionEmail=t.mentionEmail),e}function vR(t){var e;if(_.isString(t))e=t;else if(!(e=Ve(t,ye))){var r=t;Tt(r)&&(e=r)}return e}function yR(t){var e;if(!(e=Ve(t,ye))){var r=t;Tt(r)&&(e=r)}return e}function MR(t,e,r,n,i){if(u.assertAnyValue(t,"contract"),u.assertAnyValue(e,"descriptor"),t){var a=function(t,e,r,n,i){if(u.assertAnyValue(t,"contract"),u.assertAnyValue(e,"descriptors"),t){var a={};for(var o in t){var s=e?e[o]:null;if(!(i&&null!=s&&s.transient||!r&&!s)){var l=_R(t[o],s,r,n);void 0===l?u.assertFail("DataViewObjectSerializer: failed to serialize property: "+o+" due to malformed property value."):a[o]=l}}return a}}(t.properties,e?e.properties:null,r,n,i);if(a){var o={properties:a},s=Gn(t.selector);return s&&(o.selector=s),o}}}function Gn(t){if(u.assertAnyValue(t,"contract"),null===t)return null;if(t){var e={};return t.data&&(e.data=_.chain(t.data).map(function(r){return Py(r)}).filter(function(r){return null!=r}).value()),t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),void 0!==t.highlightMatching&&(e.highlightMatching=t.highlightMatching),null!=t.order&&(e.order=t.order),e}}function ko(t){if(u.assertAnyValue(t,"contract"),t){var e={};if(t.dataMap)for(var r in e.dataMap={},t.dataMap){var n=fr(t.dataMap[r]);e.dataMap[r]=_.chain(n).map(function(i){return Py(i)}).filter(function(i){return null!=i}).value()}return t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),e}}unction Py(t){return u.assertValue(t,"contract"),Nt(t)&&t.expr?Vc(t):br(t)&&t.exprs?{wildcard:_.map(t.exprs,function(e){return G.serializeExpr(e)})}:er(t)&&t.roles?{roles:t.roles}:Zt(t)&&t.exprs?{total:_.map(t.exprs,function(e){return G.serializeExpr(e)})}:Vr(t)?{dataViewWildcard:TR(t)}:void u.assertFail("serializeDataRepetitionSelector - Selector did not match type and constraints.")}unction _R(t,e,r,n){if(u.assertAnyValue(t,"contract"),u.assertAnyValue(e,"descriptor"),e){var i=Ny(e.type);return wo(t)?{propertyDefinitionKind:"ExprContext",value:le(t.value,i.value),context:Ry(t.context,n)}:i.value?le(t,i.value):Ui(t,i.structural)}if(r&&t){if(wo(t))return{propertyDefinitionKind:"ExprContext",value:{expr:G.serializeExpr(t.value)},context:Ry(t.context,n)};if(t instanceof B)return{expr:G.serializeExpr(t)};if(t instanceof Ue)return{filter:G.serializeFilter(t)};if(t.solid)return Ui(t,Ir)}}function le(t,e){if(u.assertValue(e,"type"),void 0!==e.primitiveType&&t instanceof B)return{expr:G.serializeExpr(t,!0)}}function Ui(t,e){if(u.assertValue(e,"type"),t){if(e.fill&&e.fill.solid&&e.fill.solid.color)return{solid:{color:le(t.solid.color,ye)}};if(e.fillRule){var i=ky(t,le);if(i)return i}if(e.filter)return{filter:G.serializeFilter(t)};if(e.image)return{image:FR(t)};if(e.geoJson)return{geoJson:PR(t)};if(e.paragraphs)return function(t){return u.assertValue(t,"definition"),_.map(t,function(e){var r={textRuns:_.map(e.textRuns,function(n){return jl(n)?Ic(n):Wl(n)?{cases:_.map(n.cases,,defaultCase:{textRuns:_.map(n.defaultCase.textRuns,function(a){return Ic(a)})},expression:kR(n.expression)}:void 0})};return e.horizontalTextAlignment&&(r.horizontalTextAlignment=e.horizontalTextAlignment),e.listType&&(r.listType=e.listType),e.indent&&(r.indent=e.indent),r})}(t);if(e.queryTransform)return function(t){return{algorithm:t.algorithm,parameters:_.map(t.parameters,function(e){var r=G.serializeExpr(e.expr);return r.Name=e.name,r})}}(t);if(e.dataBars)return t);if(e.icon&&"Icon"===t.kind)return t);if(e.exprList&&"ExprList"===t.kind)return function(t){u.assertValue(t,"input");var e={exprs:[],kind:"ExprList"};return e.exprs=_.map(t.exprs,,e}(t);if(e.errorRange&&"ErrorRange"===t.kind)return function(t){u.assertValue(t,"input");var e={kind:"ErrorRange"};if(t.explicit)e.explicit={isRelative:le((r=t.explicit).isRelative,pn)},r.lowerBound&&(e.explicit.lowerBound=le(r.lowerBound,lt)),r.upperBound&&(e.explicit.upperBound=le(r.upperBound,lt));else if(t.symmetricalExplicit)e.symmetricalExplicit={delta:le((r=t.symmetricalExplicit).delta,lt)};else if(t.standardDeviation)e.standardDeviation={value:le((r=t.standardDeviation).value,lt),multiplier:le(r.multiplier,lt)};else if(t.percentage)e.percentage={lowerBoundDelta:le((r=t.percentage).lowerBoundDelta,lt),upperBoundDelta:le(r.upperBoundDelta,lt)};else if(t.percentile){var r;e.percentile={lowerBound:le((r=t.percentile).lowerBound,lt),upperBound:le(r.upperBound,lt)}}return e}(t);if(e.qnaVisualLink)return function(t){u.assertValue(t,"input");var e={};if(t.suggestedUtterances){e.suggestedUtterances=_.map(t.suggestedUtterances,}return _.isEmpty(e)?void 0:e}(t);if(e.itemLocation)return function(t){if(u.assertValue(t,"input"),t.byReference){var e=t.byReference,r={kind:"ItemLocation",byReference:{itemId:le(e.itemId,ye)}};return null!=e.workspaceId&&(r.byReference.workspaceId=le(e.workspaceId,ye)),null!=e.folderId&&(r.byReference.folderId=le(e.folderId,ye)),r}}(t);u.assertFail("Serializing a structural type failed")}}function Ry(t,e){u.assertValue(t,"contract");var r={};return _.isEmpty(t.filterContext)||(r.filterContext=_.map(t.filterContext,function(n){return{filter:G.serializeFilter(n.filter),metadata:n.metadata?Z1(n.metadata,e):void 0}})),r}function FR(t){u.assertValue(t,"definition");var e={name:le(t.name,ye),url:le(t.url,L.fromDescriptor(ec))};return t.scaling&&(e.scaling=le(t.scaling,ye)),e}function PR(t){return u.assertValue(t,"definition"),{type:le(t.type,ye),name:le(t.name,ye),content:le(t.content,ye)}}unction NR(t){var e;return t instanceof B?e=le(t,ye):_.isString(t)||Tt(t)?e=t:u.assertNever(t),e}function kR(t){var e;return t instanceof B?e=le(t,ye):Tt(t)?e=t:u.assertNever(t),e}function Ny(t){u.assertValue(t,"typeDescriptor");var e=L.fromDescriptor(t);return 0!==e.primitiveType?{value:e}:{structural:t}}function ky(t,e){if(t.linearGradient2){var n={min:{color:e((r=t.linearGradient2).min.color,L.fromPrimitiveTypeAndCategory(1))},max:{color:e(r.max.color,L.fromPrimitiveTypeAndCategory(1))}};return r.min.value&&(n.min.value=e(r.min.value,L.fromPrimitiveTypeAndCategory(3))),r.max.value&&(n.max.value=e(r.max.value,L.fromPrimitiveTypeAndCategory(3))),r.nullColoringStrategy&&(n.nullColoringStrategy={strategy:e(r.nullColoringStrategy.strategy,L.fromPrimitiveTypeAndCategory(1))},r.nullColoringStrategy.color&&(n.nullColoringStrategy.color=e(r.nullColoringStrategy.color,L.fromPrimitiveTypeAndCategory(1)))),{linearGradient2:n}}var r;return t.linearGradient3?(n={min:{color:e((r=t.linearGradient3).min.color,L.fromPrimitiveTypeAndCategory(1))},mid:{color:e(r.mid.color,L.fromPrimitiveTypeAndCategory(1))},max:{color:e(r.max.color,L.fromPrimitiveTypeAndCategory(1))}},r.min.value&&(n.min.value=e(r.min.value,L.fromPrimitiveTypeAndCategory(3))),r.mid.value&&(n.mid.value=e(r.mid.value,L.fromPrimitiveTypeAndCategory(3))),r.max.value&&(n.max.value=e(r.max.value,L.fromPrimitiveTypeAndCategory(3))),r.nullColoringStrategy&&(n.nullColoringStrategy={strategy:e(r.nullColoringStrategy.strategy,L.fromPrimitiveTypeAndCategory(1))},r.nullColoringStrategy.color&&(n.nullColoringStrategy.color=e(r.nullColoringStrategy.color,L.fromPrimitiveTypeAndCategory(1)))),{linearGradient3:n}):null}function QR(t){return _.filter(_.map(t,function(e){return function(t){if(u.assertValue(t,"expansionState"),u.assertValue(!_.isEmpty(t.roles),"expansionState.roles"),function(t){return!_.isEmpty(t.root.children)||!_.isEmpty(t.root.identityValues)}(t)||function(t){return _.findIndex(t.levels,function(e){return e.isPinned})>=0}(t)){var e={roles:t.roles};return _.isEmpty(t.levels)||(u.assertValue(t.root,"expansionState.root"),e.levels=_.map(t.levels,function(r){return function(t){if(u.assertAnyValue(t,"level"),t){u.assertNonEmpty(t.queryRefs,"level.queryRefs");var e={queryRefs:_.clone(t.queryRefs)};return t.isCollapsed&&(e.isCollapsed=!0),t.identityKeys&&(e.identityKeys=_.map(t.identityKeys,function(r){return G.serializeExpr(r)})),t.isPinned&&(e.isPinned=t.isPinned),t.isLocked&&(e.isLocked=t.isLocked),t.AIInformation&&(e.AIInformation=_.cloneDeep(t.AIInformation)),e}}(r)}),e.root=Ly(t.root)),e}}(e)}),function(e){return e})}function Ly(t){u.assertValue(t,"node");var e={identityValues:t.identityValues?_.map(t.identityValues,function(o){return G.serializeExpr(o)}):null};if(t.isToggled&&(e.isToggled=!0),!_.isEmpty(t.children)){e.children=[];for(var r=function(s){u.assert(function(){return!_.isEmpty(s.identityValues)},"child.identityValues");var l=Ly(s);e.children.push(l)},n=0,i=t.children;n<i.length;n++)r(i[n])}return e}function KR(t,e){if(t){for(var r=[],n=function(l){if(!l)return"continue";u.assert("serializedHierarchy.roles");var c=new WA(l.roles,e);_.isEmpty(l.levels)||(u.assertValue(l.root,"serializedHierarchy.root"),c.levels=_.map(l.levels,function(f){return function(t){var e={queryRefs:_.clone(t.queryRefs),isCollapsed:!!t.isCollapsed,toggledNodes:[],isPinned:t.isPinned,isLocked:t.isLocked,AIInformation:_.cloneDeep(t.AIInformation)};return t.identityKeys&&(e.identityKeys=_.map(t.identityKeys,function(r){return G.deserializeExpr(r)})),e}(f)}),c.root=By(l.root,-1,null,c.levels,!!e.canCollapseRoot)),r.push(c)},i=0,a=t;i<a.length;i++)n(a[i]);return r}}function By(t,e,r,n,i){u.assertValue(t,"serializedNode");var a={identityValues:t.identityValues?_.map(t.identityValues,function(s){return G.deserializeExpr(s)}):null,parent:r,children:[]};if(t.isToggled&&(a.isToggled=!0,e>=0?n[e].toggledNodes.push(a):u.assert(function(){return i},"Collapse to root capability not enabled")),!_.isEmpty(t.children)){var o=e+1;a.children=_.map(t.children,}return a}var zy=function(){eturn t.deserializeDataViewSelectTransforms=function(e){return u.assertValue(e,"input"),e),_.map(e,function(r){var n={displayName:r.displayName,format:r.format,kpi:r.kpi,queryName:r.queryName,roles:r.roles,sort:r.sort,sortOrder:r.sortOrder,type:sR(r.type)};return r.expr&&(n.expr=G.deserializeExpr(r.expr)),r.aggregateSources&&(n.aggregateSources=r.aggregateSources),r.relatedSelects&&(n.relatedSelects=r.relatedSelects),r.relatedObjects&&(n.relatedObjects=r.relatedObjects),n})},t.serializeDataViewSelectTransforms=function(e){return u.assertValue(e,"input"),_.map(e,function(r){var n={displayName:r.displayName,format:r.format,kpi:r.kpi,queryName:r.queryName,roles:r.roles,sort:r.sort,sortOrder:r.sortOrder,type:oR(r.type)};return r.expr&&(n.expr=G.serializeExpr(r.expr)),r.aggregateSources&&(n.aggregateSources=r.aggregateSources),r.relatedSelects&&(n.relatedSelects=r.relatedSelects),r.relatedObjects&&(n.relatedObjects=r.relatedObjects),n})},t.serializeDataViewTransformActions=function(e,r){u.assertAnyValue(r,"objectDescriptors");var n={objects:(e=e||{}).objects,projectionOrdering:e.roles&&e.roles.ordering,projectionActiveItems:e.roles&&e.roles.activeItems,splits:e.splits,queryMetadata:null,visualElements:null};return e&&e.objects&&(n.objects=function(t,e,r,n){if(u.assertAnyValue(t,"contract"),u.assertAnyValue(e,"descriptors"),t){var i={};for(var a in t){var o=void 0;if(!e||(o=e[a]))for(var s=t[a],l=i[a]=[],c=0,f=s.length;c<f;c++)l.push(MR(s[c],o,!e,undefined,false))}return i}}(e.objects,r)),e&&e.selects&&(n.selects=t.serializeDataViewSelectTransforms(e.selects)),e&&!_.isEmpty(e.expansionStates)&&(n.expansionStates=QR(e.expansionStates)),n},t.deserializeDataViewTransformActions=function(e,r){var n=r&&r.objects;u.assertValue(e,"actions"),u.assertAnyValue(n,"objectDescriptors");var i=e.objects?function(t,e){if(u.assertAnyValue(t,"input"),u.assertAnyValue(e,"descriptors"),t){!Mc&&!e&&(Mc=!0,nt.error("deserializeObjects called with no descriptors - ",!0));var r={};for(var n in t){var i=void 0;if(!e||(i=e[n]))for(var a=t[n],o=r[n]=[],s=0,l=a.length;s<l;s++)o.push(uR(a[s],i,!e))}return r}}(e.objects,n):null,a=t.createTransformActions(e.queryMetadata,e.visualElements,n,i)||{},o=e&&e.projectionActiveItems;return _.isEmpty(o)||this.upgradeActiveItemsIfNeeded(o),a.roles={ordering:e.projectionOrdering,activeItems:o},a.splits=e.splits,e.selects&&(a.selects=t.deserializeDataViewSelectTransforms(e.selects)),e.expansionStates&&(a.expansionStates=KR(e.expansionStates,{supportsMerge:r&&r.expandCollapse&&r.expandCollapse.supportsMerge,canCollapseRoot:r&&r.noDefaultProjections,collapseParentAfterRemovingChildLevel:r&&r.expandCollapse&&r.expandCollapse.collapseParentAfterRemovingChildLevel})),this.upgradeComboChartFromCY16SU04AndPrior(a),a},t.isStringArray=t.upgradeActiveItemsIfNeeded=t.upgradeComboChartFromCY16SU04AndPrior=function(e){var r;u.assertValue(e,"transformActions");var a=e.roles&&e.roles.ordering;if(a){var o=a.Y&&1===a.Y.length&&_.includes(a.Y2,a.Y[0])?a.Y[0]:void 0;if(void 0!==o){var s=e.splits&&2===e.splits.length&&!e.splits[0].selects[o]&&e.splits[1].selects[o]?e.splits[0]:void 0;if(s){var l=_.chain(Object.keys(s.selects)).filter(function(h){return s.selects[h]}).map(.maxBy(function(h){return h}).value();if(l!==Number.NEGATIVE_INFINITY&&e.selects&&e.selects.length===l){var f=e.selects[o];if(f&&f.roles.Y&&f.roles.Y2){delete f.roles.Y;var p=de({},f);p.roles=((r={}).Y=!0,r),p.queryName=f.queryName,e.selects[l]=p,e.roles.ordering.Y=[l]}}}}}},t.serializeTransformActions=function(e){return JSON.stringify(e)},t.createTransformActions=function(e,r,n,i){if(u.assertAnyValue(e,"queryMetadata"),u.assertAnyValue(r,"visualElements"),u.assertAnyValue(n,"objectDescs"),u.assertAnyValue(i,"objectDefns"),e&&!_.isEmpty(e.Select)||!_.isEmpty(r)||i){var a={};if(e){var o=e.Select;if(o)for(var s=a.selects=[],l=function(g,y){var m=o[g];if(!m)return s.push(null),"continue";var S=c.toTransformSelect(m,g);if(s.push(S),S.format&&n){u.assert(function(){return!!S.queryName},"selectTransform.queryName should be defined (or defaulted).");var E=ro(n);E&&(i||(i={}),Li(i,E,{metadata:S.queryName},Ee(S.format)))}},c=this,f=0,d=o.length;f<d;f++)l(f)}if(r){var p=(r=_.unionBy(r,function(v){return JSON.stringify(v)})).length;for(p>1&&(a.splits=[]),f=0;f<p;f++){var h=r[f];h.Settings&&0===f&&(i=this.upgradeSettingsToObjects(h.Settings,i)),h.DataRoles&&(a.selects||(a.selects=[]),a.roles||(a.roles={ordering:{}}),this.populateDataRoles(h.DataRoles,a.selects,a.roles.ordering)),a.splits&&a.splits.push(this.populateSplit(h.DataRoles))}}return i&&(a.objects=i),a}},t.toTransformSelect=function(e,r){u.assertValue(e,"select");var n={};return e.Restatement&&(n.displayName=e.Restatement),e.Name?n.queryName=e.Name:n.queryName||(n.queryName="$select"+r),e.Format&&(n.format=e.Format),e.Type&&(n.type=this.describeDataType(e.Type,e.DataCategory))),e.kpi&&(n.kpi=e.kpi),e.kpiStatusGraphic&&(n.kpi={graphic:e.kpiStatusGraphic}),n},t.describeDataType=function(e,r){var n=0;switch(e=e||0){case 2048:n=1;break;case 1:n=3;break;case 3:n=4;break;case 4096:n=5;break;case 20:n=6;break;case 4:n=7;break;case 8:n=9;break;case 67:n=4,u.assert(function(){return!r||"Year"===r},"Unexpected category for Year type."),r="Year";break;case 35:n=4,u.assert(function(){return!r||"Month"===r},"Unexpected category for Month type."),r="Month"}return L.fromPrimitiveTypeAndCategory(n,r)},t.populateDataRoles=function(e,r,n){u.assertValue(e,"roles"),u.assertValue(r,"selects"),u.assertValue(n,"projectionOrdering");for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.Projection,l=o.Name,c=r[s];void 0===c&&(this.fillArray(r,s),c=r[s]={});var f=c.roles;void 0===c.roles&&(f=c.roles={}),f[l]=!0;var d=n[l];void 0===d&&(d=n[l]=[]),d.push(s)}},t.fillArray=function(e,r){u.assertValue(e,"selects"),u.assertValue(r,"length");for(var n=e.length;n<r;n++)e[n]={}},t.populateSplit=function(e){u.assertAnyValue(e,"roles");var r={},n={selects:r};if(e)for(var i=0,a=e.length;i<a;i++)r[e[i].Projection]=!0;return n},t.upgradeSettingsToObjects=function(e,r){if(e){var n;for(n in r||(r={}),e){var i=e[n],a=n,o=i,s="general";switch(n){case"hasScalarCategoryAxis":s="categoryAxis",a="axisType",o=Ee(i?"Scalar":"Categorical");break;case"Totals":a="totals",o=$t(!!i);break;case"textboxSettings":a="paragraphs",i&&i.paragraphs&&(o=i.paragraphs);break;case"VisualType1":a="visualType1",o=Ee(i);break;case"VisualType2":a="visualType2",o=Ee(i);break;case"imageVisualSettings":a="imageUrl",i&&i.imageUrl&&(o=Ee(i.imageUrl));break;default:continue}this.setObjectDefinition(r,s,a,o)}return r}},t.setObjectDefinition=function(e,r,n,i){u.assertValue(e,"objects"),u.assertValue(r,"objectName"),u.assertValue(n,"propertyName");var a=e[r];void 0===a&&(a=e[r]=[]);var o=a[0];void 0===o&&(o=a[0]={properties:{}}),o.properties[n]=i},t}();unction eN(t){return new Cf(t.colors,t.sentimentColors,t.gradientColors)}function _c(t,e){u.assertValue(t,"collection"),u.assertValue(e,"toRemove");var r=t.indexOf(e);u.assert(function(){return r>=0},"the metadata column to be removed should exist in the collection before the removal"),r>=0&&t.splice(r,1)}function Oy(t,e){u.assertValue(e,"dataViewCategorical");var r=e.categories;if(r)for(var n=0,i=r;n<i.length;n++){var a=i[n];a.values.splice(0),a.identity.splice(0)}var o=e.values;if(o){var s=o.grouped();if(!_.isEmpty(s)){for(var l=s[0],c=t.columns,f=d=0,p=l.values;d<p.length;d++)f(p[d]);var v=[{values:l.values,objects:l.objects}];if(o.grouped=function(){return v},s.length>=2){var g=l.values.length;if(g>0){for(var m=g*(s.length-1),S=g,E=g+m;S<E;S++)_c(c,o[S].source);o.splice(g,m)}}}for(var b=0,V=o;b<V.length;b++){var x=V[b];x.values.splice(0),delete x.identity}}u.assert("values and identity should be cleared in all category columns"),u.assert("name and identity should be cleared in all series instances"),u.assert("All values in measure columns should be removed")}function Lo(t,e){if(u.assertValue(t,"values"),u.assertValue(e,"indicesToRemove"),u.assert(function(){return hs(e,!0)},"indicesToRemove is expected to be in descending order"),u.assert(function(){return _.uniq(e).length===e.length},"indicesToRemove is not expected to contain any duplicate"),!_.isEmpty(e)){if(u.assert("elements in indicesToRemove must be valid indices to the values array."),t.length===e.length)return void t.splice(0);for(var r,n=0,i=0,a=e;i<a.length;i++){var o=a[i];void 0===r||r===o+1?(r=o,n++):(t.splice(r,n),r=o,n=1)}u.assertValue(r,"nextSpliceStart must be defined because this function returns early if indicesToRemove is empty."),t.splice(r,n)}}function qy(t,e){if(u.assertValue(t,"queryDataView"),u.assertAnyValue(e,"clientSideFilters"),!_.isEmpty(e)&&!_.isEmpty(t.metadata.columns)){u.assert("Client-side filtering on measure columns is not yet implemented; only attribute filters are supported at the moment.");var r=t.categorical;if(r){var n=function(t,e){if(u.assertAnyValue(t,"seriesMetadataColumn"),u.assertValue(e,"clientSideFilters"),t){var r=Hy(e,[t]);if(!_.isEmpty(r))return }(r.values&&r.values.source,e),i=function(t,e){u.assertValue(t,"categories"),u.assertValue(e,"clientSideFilters");var r=Hy(e,_.map(t,function(i){return i.source}));if(!_.isEmpty(r))return (r.categories,e);!function(t,e,r,n){u.assertValue(e,"dataViewCategorical"),u.assertAnyValue(r,"categoryRemovalPredicate"),u.assertAnyValue(n,"seriesRemovalPredicate"),n&&function(t,e,r){u.assertValue(e,"dataViewCategorical"),u.assertValue(r,"removalPredicate");var n=e.values&&e.values.grouped();if(!_.isEmpty(n)){var a=function(t,e,r){u.assertAnyValue(t,"seriesMetadataColumn"),u.assertValue(e,"seriesInstances"),u.assertValue(r,"removalPredicate");for(var n=[],i=e.length-1;i>=0;i--)r(e[i],t)&&n.push(i);return n}(e.values&&e.values.source,n,r);!function(t,e,r){if(u.assertValue(e&&e.values&&!_.isEmpty(e.values.grouped()),"dataViewCategorical must be defined and the grouped() function must return non-empty result"),u.assertValue(r,"seriesIndicesToRemove"),u.assert(function(){return hs(r,!0)},"seriesIndicesToRemove is expected to be in descending order"),u.assert(function(){return _.uniq(r).length===r.length},"seriesIndicesToRemove must not contain duplicate values"),!_.isEmpty(r)){var n=e.values,i=n.grouped();if(i.length===r.length)return void Oy(t,e);var a=i[0].values.length;if(u.assert(function(){return _.every(i,function(d){return d.values.length===a})},"all series instances returned by grouped() are expected to have the same number of measure columns"),a>0)for(var o=t.columns,s=function(p){var h=p*a;u.assert("Verifying that the index of the last column in this series instance is a valid index to the seriesAndMeasures array.");for(var v=h,g=h+a;v<g;v++)_c(o,n[v].source);n.splice(h,a)},l=0,c=r;l<c.length;l++)s(c[l]);Lo(i,r),n.grouped=function(){return i}}}(t,e,a)}}(t,e,n),r&&function(t,e,r){u.assertValue(e,"dataViewCategorical"),u.assertValue(r,"removalPredicate");var n=e.categories;if(!_.isEmpty(n)){var i=function(t,e){u.assertNonEmpty(t,"categories"),u.assertValue(e,"removalPredicate");var r=t[0].values.length;u.assert("Expecting all category columns to have the same number of values.");for(var n=[],i=r-1;i>=0;i--)e(i,t)&&n.push(i);return n}(n,r);!function(t,e,r){if(u.assertValue(e,"dataViewCategorical"),u.assertValue(r,"rowIndicesToRemove"),u.assert("rowIndicesToRemove is expected to be in descending order"),u.assert("rowIndicesToRemove must not contain duplicate values"),!_.isEmpty(r)){if(ic(e)===r.length)return void Oy(t,e);u.assert("If rowIndicesToRemove is non-empty, then the categorical must have at least 1 row.");var n=e.categories;if(!_.isEmpty(n))for(var i=0,a=n;i<a.length;i++){var o=a[i];Lo(o.values,r),Lo(o.identity,r)}var s=e.values;if(!_.isEmpty(s))for(var l=0,c=s;l<c.length;l++)Lo(c[l].values,r)}}(t,e,i)}}(t,e,r)}(t.metadata,r,i,n)}return t}}function Uy(t){u.assertValue(t,"clientSideFilter");var e=t.Condition;if(e.Contains)return e.Contains.SelectIndex;u.assertFail("Unknown filter condition type: "+JSON.stringify(e))}function Hy(t,e){if(u.assertValue(t,"clientSideFilters"),u.assertValue(e,"metadataColumns"),_.isEmpty(t)||_.isEmpty(e))return[];for(var r={},n=0,i=e;n<i.length;n++)r[i[n].index]=!0;return _.filter(t,}function Gy(t,e){u.assertValue(t,"filter");var r=!1,n=t.Condition;return n.Contains?(u.assert("condition.Contains.LiteralValue is expected to have been normalized."),r=!_.isString(e)||!ha(Hi(e),n.Contains.LiteralValue)):u.assertFail("ClientSideFilter condition type not implemented: "+JSON.stringify(n)),r}ar pN=function(t){function e(r){var n=t.call(this)||this;return u.assertNonEmpty(r,"selects"),n.clientSideFilters=[],n.selects=r,n}return T(e,t),e.prototype.visitContains=function(r){if(!this.hasUnsupportedFilter()){var n=!1,i=Fc(r);if(i){var a=i.constantValue,o=dd(this.selects,i.otherSide);if(o>=0&&a){var s={Condition:{Contains:{SelectIndex:o,LiteralValue:Hi(a)}}};this.clientSideFilters.push(s),n=!0}}n||this.setUnsupportedFilter()}},e.prototype.visitAnd=e.prototype.visitDefault=e.prototype.getClientSideFiltersIfAllSupported=e.prototype.hasUnsupportedFilter=e.prototype.setUnsupportedFilter=e}(Ke);function Fc(t){if(t){var e=xu(t.left);return e?{constantValue:e,otherSide:t.right}:{constantValue:e=xu(t.right),otherSide:t.left}}}var J=function(){function t(){}return t.findAndParseCalculation=function(e,r){var n=this.findCalculation(e,r);if(n)return my(n.Value)},t.findAndParseCalculationToSQExpr=function(e,r){var n=this.findCalculation(e,r);if(n)return Sc(n.Value)},t.findCalculation=function(e,r){u.assertValue(e,"calcs");for(var n=0,i=e.length;n<i;n++){var a=e[n];if(a.Id===r)return a}},t.describeDataType=function(e,r){var n=0;switch(e=e||0){case 2048:n=1;break;case 1:n=3;break;case 3:n=4;break;case 4096:n=5;break;case 20:n=6;break;case 4:n=7;break;case 8:n=9;break;case 67:n=4,u.assert(function(){return!r||"Years"===r},"Unexpected category for Year type."),r="Years";break;case 35:n=4,u.assert("Unexpected category for Month type."),r="Months"}return L.fromPrimitiveTypeAndCategory(n,r)},t.getTopLevelSecondaryDynamicMember=function(e,r){u.assertValue(e,"DsrV1.DataShape");var n=e.SecondaryHierarchy;return n?r&&r.Secondary?t.getDynamicMember(n,r.Secondary.Groupings,0):t.getDynamicMemberFallback(n):null},t.getTopLevelPrimaryDynamicMember=function(e,r,n){u.assertValue(e,"DsrV1.DataShape");var a,i=e.PrimaryHierarchy;return i?(n&&(a=void 0!==e.Calculations),r&&r.Primary?t.getDynamicMember(i,r.Primary.Groupings,0,a):t.getDynamicMemberFallback(i,a)):null},t.getDynamicMember=function(e,r,n,i){if(u.assertValue(e,"dataShapeMembers"),0===e.length)return null;if(!r||0===r.length)return t.getDynamicMemberFallback(e,i);var a=r[n].Member;if(!a)return t.getDynamicMemberFallback(e,i);for(var o=0,s=e;o<s.length;o++){var l=s[o];if(l.Id===a)return l}return null},t.getDynamicMemberFallback=t.fillMetadataColumnAggregate=function(e,r,n){void 0===n&&(n=!0),u.assertValue(r,"aggregateMetdata");var i=r.source.aggregates;switch(i||(r.source.aggregates=i={}),r.aggregateKind){case 1:return void(i.subtotal=e);case 2:return void(i.max=e);case 3:return void(i.min=e);case 4:return void(n||(i.single=e));case 5:return u.assert(function(){return"number"==typeof e},"unexpected count calc value"),void(i.count=e);case 6:return void(i.average=e);case 8:return void(i.median=e);case 7:var a=r.aggregate.Percentile,o=i.percentiles;o||(o=i.percentiles=[]);var s={k:a.K,value:e};return null!=a.Exclusive&&(s.exclusive=a.Exclusive),void o.push(s);default:u.assertFail("unknown AggregateKind")}},t.copyAggregates=function(e,r){u.assertValue(e,"source Aggregates"),u.assertValue(r,"target Aggregates"),void 0!==e.subtotal&&(r.subtotal=e.subtotal),void 0!==e.min&&(r.min=e.min),void 0!==e.max&&(r.max=e.max),void 0!==e.minLocal&&(r.minLocal=e.minLocal),void 0!==e.maxLocal&&(r.maxLocal=e.maxLocal),void 0!==e.count&&(r.count=e.count)},t.computeAggIdx=t}(),Pc=),Rc=),Gi=function(){function t(e){this.context=e,this.measureValueAggregatorsBySelectIdx=[]}return t.prototype.read=function(e,r){void 0===r&&(r=!0);for(var n=this.context,i=n.selects,a=new Array(i.length),o=new Array(i.length);e.nextCalc();){var s=n.aggregateCalcMetadata[e.calcId()];s&&s.aggregateKind&&(J.fillMetadataColumnAggregate(e.calcValue(),s,!1),3===s.aggregateKind&&(a[s.selectIdx]=!0),2===s.aggregateKind&&(o[s.selectIdx]=!0))}r&&this.addLocalAggregators(a,o)},t.prototype.addLocalAggregators=function(e,r){for(var n=this.measureValueAggregatorsBySelectIdx,i=this.context.measureSelectIndices,a=i.length,o=!1,s=0;s<a;s++){var l=i[s];e[l]||(o=!0,n[l]||(n[l]=[]),n[l].push(new Rc)),r[l]||(o=!0,n[l]||(n[l]=[]),n[l].push(new Pc))}this.hasLocalAggregators=o},t.prototype.update=t.prototype.copyToColumns=t}(),Qi=function(){eturn t.prototype.initialize=function(e){var n,r=this,i=this.context,a=i.selects,o=i.dataMemberIdToMetadata[e];this.identityFields=o.identityFields,this.identityFieldsCount=this.identityFields.length;var l=o.axisGrouping.Keys;u.assert(function(){return l.length===r.identityFieldsCount},"Mismatch in Identity Keys count");for(var c=0;c<this.identityFieldsCount;c++){var f=l[c],d=void 0;f.Calc?d=f.Calc:null!=f.Select&&f.Select>=0?d=o.forSynchronization?null===(n=a[f.Select].Synchronized)||void 0===n?void 0:n.Value:a[f.Select].Value:u.assertFail("unexpected grouping key value"),this.calcIdToGroupingKeysIndex[d]=c}},t.prototype.reset=t.prototype.addExpr=function(e,r){var n=this.calcIdToGroupingKeysIndex[e],i=this.identityFields[n];i&&(this.identityParts[n]=Tn(i,r))},t.prototype.getIdentity=function(){for(var n,e=this.identityParts,r=this.identityFieldsCount,i=0;i<r;i++)n=it(n,e[i]);var a=mt(n);return u.assertValue(a,"identity"),a},t.prototype.getIdentityFields=function(){return this.identityFields},t}();ar Z=function(t){return t[t.None=0]="None",t[t.Group=1]="Group",t[t.Measure=2]="Measure",t}({}),jy=function(){function t(){}return t.prototype.run=function(e,r,n){this.metadata=n,this.context=e,this.dsrParser=r,this.selectIndexToCategoryColumn={},this.selectIndexToPrimaryValueColumn={},this.selectIndexToDynamicFormatColumn={},this.intersectionValueColumnsMap=[],this.intersectionDynamicFormatColumnsMap=[],this.primaryMeasureCount=0,this.intersectionMeasureCount=0,this.seriesSelectIndex=-1,this.primaryMeasureSelectIndexMap=[],this.intersectionMeasuresSelectIndexMap=[],this.selectIndexToValueColumnsMap=[],r.reset(),this.aggregator=new Gi(e);var i=this.dsrParser.dataShapes();i.next();var a={};if(0===e.maxPrimaryDepth){this.readSelectsAndCreateCategoryColumns(void 0,void 0);var o=a.values=Ar();this.readMeasuresWithNoGrouping(i,o)}else{var s=[],l=[];a.categories=s,this.readSelectsAndCreateCategoryColumns(s,l),o=void 0,(this.intersectionMeasureCount>0||this.primaryMeasureCount>0||this.seriesSelectIndex>=0)&&(a.values=o=Ar()),this.readSecondaryAndCreateValueColumns(o);var c={};this.readData(i,o,l,c),void 0!==c.value&&(a.lastMergeIndex=c.value)}return a},t.isCompatible=t.prototype.readSelectsAndCreateCategoryColumns=function(e,r){var n=this.context,i=n.selectIndexToColumn,a=n.selects,o=a.length,s=this.dsrParser.dataShapes().secondaryHierarchy();this.primaryMeasureSelectIndexMap=new Array(a.length),this.intersectionMeasuresSelectIndexMap=new Array(a.length);for(var l=!!s,c=0;c<o;c++){var f=a[c];if(f&&f.Value)if(f.Kind===Z.Group){if(null!=f.SecondaryDepth){this.seriesSelectIndex=c;continue}if(null!=f.Depth){u.assert(function(){return null!=r},"Expected truthy value for identities"),u.assert("Expected truthy value for categories");var p={source:i[c],values:[],identity:r};e.push(p),this.selectIndexToCategoryColumn[c]=p}}else f.Kind===Z.Measure&&(l&&null==f.Depth?this.intersectionMeasuresSelectIndexMap[this.intersectionMeasureCount++]=c:this.primaryMeasureSelectIndexMap[this.primaryMeasureCount++]=c)}},t.prototype.readSecondaryAndCreateValueColumns=t.prototype.addIntersectionValueColumns=function(e,r){for(var i,n=new Array,a=this.context,o=function(){var c=r.id(),f=r.instances();if(2===a.dataMemberIdToMetadata[c].kind){for(;f.next(););return"continue"}var d=a.dataMemberIdToIdentityBuilder[c];d||(d=new Qi(a,c),a.dataMemberIdToIdentityBuilder[c]=d),i=d.getIdentityFields();for(var p=-1;f.next();){p++,d.reset();for(var h=void 0,v=void 0;f.nextCalc();){v=f.calcId();var g=s.context.calcInfo[v];g.isGroupKeyButNotSelect||(h=f.calcValue()),g.forIdentity&&d.addExpr(v,f.calcValueAsExpr())}s.addIntersectionValueColumnsCore(e,n,v,h,p,d.getIdentity()),u.assert(function(){return null==f.intersections()},"unexpected secondary intersections"),u.assert(function(){return null==f.members()},"unexpected secondary nested members")}0===e.length&&0===n.length&&s.addIntersectionValueColumnsCore(e,n,void 0,void 0,0,void 0),e.grouped=function(){return n},e.source=s.context.selectIndexToColumn[s.seriesSelectIndex],e.identityFields=i},s=this;r.next();)o()},t.prototype.addIntersectionValueColumnsCore=function(e,r,n,i,a,o){for(var s,l,c,f=this.context,d=f.selects,p=this.intersectionMeasureCount,h=new Array(p),v=this.metadata.columns,g=function(C){var b=void 0,V=y.intersectionMeasuresSelectIndexMap[C];void 0!==i?((b=f.createColumns(v,V).column).groupName=i,b.rootSource=f.selectIndexToColumn[V]):b=_.find(v,function(W){return W.index===V});var x=y.createValueColumn(b,o,V,!!d[V].Highlight,!1);e.push(x),h[C]=x;var w=d[V],D=y.intersectionValueColumnsMap[a];D||(D=y.intersectionValueColumnsMap[a]={}),D[w.Value]=x;var A=w.Highlight&&w.Highlight.Value;if(A&&(D[A]=x),b.formatSource&&b.formatSource.formatString){u.assertValue(null===(s=w.DynamicFormat)||void 0===s?void 0:s.Format,"select.DynamicFormat.Format");var I=y.createValueColumn(b.formatSource.formatString,void 0,V,!!d[V].Highlight,!0),F=y.intersectionDynamicFormatColumnsMap[a];F||(F=y.intersectionDynamicFormatColumnsMap[a]={}),F[w.DynamicFormat.Format]=I,e.push(I);var R=null===(c=null===(l=w.Highlight)||void 0===l?void 0:l.DynamicFormat)||void 0===c?void 0:c.Format;R&&(F[R]=I)}},y=this,m=0;m<p;m++)g(m);var S={values:h};void 0!==i&&(S.name=i),void 0!==o&&(S.identity=o),r.push(S)},t.prototype.addPrimaryValueColumns=t.prototype.createValueColumn=t.prototype.readData=function(e,r,n,i){var a=this.context,o=e.primaryHierarchy();this.aggregator.read(e,0===this.intersectionMeasureCount);for(var s=function(){var f=o.id(),d=a.dataMemberIdToMetadata[f];if(d){var p=1===d.kind,h=a.dataMemberIdToIdentityBuilder[f];!h&&p&&(h=new Qi(a,f),a.dataMemberIdToIdentityBuilder[f]=h);for(var v=o.instances();v.next();){for(h&&h.reset(),1===v.restartFlagKind()&&(i.value=v.currentIndex());v.nextCalc();)l.readPrimaryHierarchyCalc(v,h);h&&n.push(h.getIdentity()),l.parseIntersections(v),u.assert("unexpected nested members to parse")}if(p)for(var g=h.getIdentityFields(),y=0;y<a.selects.length;y++){var m=l.selectIndexToCategoryColumn[y];m&&(m.identityFields=g)}}},l=this;o.next();)s();this.aggregator.copyToColumns(),this.copyAggregatesToValueColumns()},t.prototype.copyAggregatesToValueColumns=function(){for(var e=this.context.measureSelectIndices,r=this.context.selectIndexToColumn,n=e.length,i=0;i<n;i++){var a=e[i],o=r[a].aggregates;if(o){var s=this.selectIndexToPrimaryValueColumn[a];s&&J.copyAggregates(o,s);var l=this.selectIndexToValueColumnsMap[a];if(l)for(var c=0,f=l;c<f.length;c++)J.copyAggregates(o,f[c])}}},t.prototype.readPrimaryHierarchyCalc=function(e,r){var n=e.calcId(),i=this.context.aggregateCalcMetadata[n];if(i&&1===i.aggregateKind)J.fillMetadataColumnAggregate(e.calcValue(),i);else{var a=this.context.calcInfo[n];if(a){var o=e.calcValue();if(a.kind===Z.Group)u.assert(function(){return!!r},"Must have an identity builder when parsing grouping values"),a.isGroupKeyButNotSelect||this.selectIndexToCategoryColumn[a.selectIdx].values.push(o),a.forIdentity&&r.addExpr(n,e.calcValueAsExpr());else if(a.kind===Z.Measure){var s=a.calcKind;1===s?(this.selectIndexToPrimaryValueColumn[a.selectIdx].values.push(o),this.aggregator.update(o,a.selectIdx)):4===s?this.selectIndexToDynamicFormatColumn[a.selectIdx].values.push(o):3===s?this.selectIndexToPrimaryValueColumn[a.selectIdx].highlights.push(o):6===s&&this.selectIndexToDynamicFormatColumn[a.selectIdx].highlights.push(o)}}}},t.prototype.parseIntersections=t.prototype.parseIntersectionCalc=function(e,r,n,i){var a=e.calcId(),o=i[a];if(o)switch(u.assert(function(){return o.kind===Z.Measure},"unexpected select kind found in intersection"),o.calcKind){case 1:return r[a].values.push(e.calcValue()),!0;case 3:return r[a].highlights.push(e.calcValue()),!0;case 4:return n[a].values.push(e.calcValue()),!0;case 6:return n[a].highlights.push(e.calcValue()),!0;case 2:case 5:return!1}},t.prototype.readMeasuresWithNoGrouping=function(e,r){this.aggregator.read(e),this.aggregator.copyToColumns();var n=e.primaryHierarchy();if(n.next()){this.addPrimaryValueColumns(r,!0);for(var i=this.context.calcInfo,a=n.instances();a.next();)for(var o=function(){var c=a.calcId(),f=i[c];f&&(u.assert("expect a selectIdx for all measures when there is no grouping"),1===f.calcKind?s.selectIndexToPrimaryValueColumn[f.selectIdx].values.push(a.calcValue()):3===f.calcKind?s.selectIndexToPrimaryValueColumn[f.selectIdx].highlights.push(a.calcValue()):4===f.calcKind?s.selectIndexToDynamicFormatColumn[f.selectIdx].values.push(a.calcValue()):6===f.calcKind&&s.selectIndexToDynamicFormatColumn[f.selectIdx].highlights.push(a.calcValue()))},s=this;a.nextCalc();)o()}},t}(),gN=function(){function t(e){u.assertValue(e,"Null RestartIdentities list"),u.assertNonEmpty(e,"Empty RestartIdentities list"),this.restartValuesCount=e.length,this.calcIdToRestartIdentityIndex={};for(var r=0;r<this.restartValuesCount;r++)this.calcIdToRestartIdentityIndex[e[r]]=r}return t.prototype.getRestartValues=function(e){u.assertValue(e,"getRestartValues called with undefined instanceParser");var r=new Array(this.restartValuesCount);for(e.restartCalcs();e.nextCalc();){var n=this.calcIdToRestartIdentityIndex[e.calcId()];void 0!==n&&(r[n]=e.calcValueAsExpr())}return u.assert(function(){return _.every(r,function(i){return!!i})},"Missing calcs for RestartValues"),r},t}(),yN=function(){eturn t.prototype.getCalcValue=function(e,r){if(!(e>=this.parsedValues.length)){var n=this.parsedValues[e];return void 0===n&&(n=Ec(this.values[e],r),this.parsedValues[e]=n),n}},t.prototype.getCalcValueExpr=function(e,r,n){if(!(r>=this.parsedValues.length)){var i=this.parsedValueExprs[r];return void 0===i&&(i=Cc(e,this.values[r],n),this.parsedValueExprs[r]=i),i}},t}(),mN=function(){eturn t.prototype.getCalcValue=function(e,r,n){if(r&&"number"==typeof e){u.assertValue(this.resolvedValueDictionaries,"this.context.resolvedValueDictionaries");var i=this.resolvedValueDictionaries[r];return u.assertValue(i,"dictionary"),i.getCalcValue(e,n)}},t.prototype.getCalcValueExpr=function(e,r,n,i){if(n&&"number"==typeof r){u.assertValue(this.resolvedValueDictionaries,"this.resolvedValueDictionaries");var a=this.resolvedValueDictionaries[n];return u.assertValue(a,"dictionary"),a.getCalcValueExpr(e,r,i)}},t}();function EN(t,e){u.assertValue(t.Expressions.Primary,"No primary groupings."),u.assertValue(t,"synchronizedGroup");for(var r=t.Expressions.Primary.Groupings,n=t.Select,i={},a=[],o=e.Groupings,s=0;s<o.length;s++)Nc(i,r[o[s]].SynchronizedGroup,s,a,n,!0);return{dataMemberIdToMetadata:i,selects:n,maxPrimaryDepth:_.size(o),primaryDataMemberIdCache:a,memberInstanceCalcMetadataCache:{},calcIdToCalcMetadata:{},locked:!1,intersectionCalcMetadataCache:{},maxSecondaryDepth:0,secondaryDataMemberIdCache:void 0,instancesCalcCache:{},lastIntersectionCalcCache:{},intersectionMeasureToSelectIndex:[],secondaryLeafDataMemberId:void 0}}unction Wy(t,e,r){u.assertValue(t,"key"),u.assertAnyValue(e,"selectIndex"),u.assertValue(r,"selectBindings");var n=t.Source;if(!n){u.assert("selectIndex should be within range");var i=r[e].Name;return i?gi(i):void u.assertFail("selectName should be defined")}return Ie(Ge(Qy(n),n.Entity||n.EntitySet),n.Property)}var kc=function(){function t(e,r,n,i,a){u.assertValue(e,"targets"),u.assert(function(){return null!=r.Select||null!=r.ScriptVisualBinding},"descriptor"),this.targets=e,this.descriptor=r,this.selects=r.Select,this.selectIndexToColumn={},this.aggregateCalcMetadata={},this._calcInfo={},this.calcIdToColumnIndices={},this.dataMemberIdToIdentityBuilder={};var o=r.Expressions;this._primaryAxisGroupings=o&&o.Primary&&o.Primary.Groupings,this._secondaryAxisGroupings=o&&o.Secondary&&o.Secondary.Groupings,this.measureSelectIndices=[],this.dataMemberIdToMetadata=n.dataMemberIdToMetadata,this.maxPrimaryDepth=n.maxPrimaryDepth,this.maxSecondaryDepth=n.maxSecondaryDepth,this.primarySynchronizedGroups=n.primarySynchronizedGroups,this.scopedAggregatesEnabled=i,this.dataShapeParser=a}return Object.defineProperty(t.prototype,"primaryAxisGroupings",{get:function(){return this._primaryAxisGroupings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"secondaryAxisGroupings",{get:function(){return this._secondaryAxisGroupings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"calcInfo",{get:function(){return this._calcInfo},enumerable:!1,configurable:!0}),t.prototype.createContextForPrimarySynchronizedGroup=t.prototype.includes=function(e){return u.assertValue(e,"kind"),ee(this.targets,e)},t.prototype.createDataViewMetadataColumns=function(){var e=this,r=this.selects;if(!_.isEmpty(r)){var n=[],i=r.length;this.selectIndexToColumnIndex=new Array(i);for(var a=function(h,v){var g=r[h];if(!g)return"continue";u.assert("Expecting every select never to be of SelectKind.None");var y=o.createColumns(n,h),m=y.column,S=y.columnIdx,E=y.dynamicFormatColumn;o.selectIndexToColumn[h]=m,o.selectIndexToColumnIndex[h]=S,g.Kind===Z.Measure&&o.measureSelectIndices.push(h);var C=g.Aggregates;if(C)for(var b=0,V=C;b<V.length;b++){var x=V[b],w=o.getAggregateKind(x.Aggregate);o.createAggregateCalcMetadata(x.Ids,w,m,h,x.Aggregate)}var D=g.Value;D&&(o.calcIdToColumnIndices[D]||(o.calcIdToColumnIndices[D]=[]),o.calcIdToColumnIndices[D].push(S),(null==g.Depth||null==g.SecondaryDepth)&&(o.aggregateCalcMetadata[D]={source:m,aggregateKind:4,selectIdx:h})),g.Kind===Z.Measure&&(g.Subtotal&&o.createAggregateCalcMetadata(g.Subtotal,1,m,h),g.SubtotalDynamicFormat&&o.createAggregateCalcMetadata(_.map(g.SubtotalDynamicFormat,function(A){return A&&A.Format}),1,E,h),g.Count&&(u.assert("dataView cannot represent aggregates other than subtotal at different scopes yet"),o.createAggregateCalcMetadata(g.Count,5,m,h)),g.Max&&o.createAggregateCalcMetadata(g.Max,2,m,h),g.Min&&o.createAggregateCalcMetadata(g.Min,3,m,h))},o=this,s=0,l=i;s<l;s++)a(s);this.parseAxisGroupings(this.primaryAxisGroupings),this.parseAxisGroupings(this.secondaryAxisGroupings);var c=function(h){_.size(f.calcIdToColumnIndices[h])>1&&(f.calcInfo[h].hasDuplicateColumnIndices=!0,u.assert("calcs which represent group keys cannot have duplicate column indices"))},f=this;for(var d in this.calcIdToColumnIndices)c(d);return this.scopedAggregatesEnabled&&(this.createScopedAggregateMetadata(),this.fillDataShapeScopeAggregateValues()),n}},t.prototype.parseAxisGroupings=function(e){if(e)for(var r=0,n=e;r<n.length;r++){var i=n[r],a=i.SynchronizedGroup;if(a){this.parseGroupingKeys(a.Keys,!0);var o=i.SynchronizationIndex;o&&(this.calcInfo[o]={kind:Z.Measure,calcKind:10})}this.parseGroupingKeys(i.Keys,!1)}},t.prototype.parseGroupingKeys=function(e,r){for(var n,i,a=this.calcInfo,o=this.selects,s=0,l=e;s<l.length;s++){var c=l[s],f=o[c.Select];null!=f?r?(u.assertValue(null===(n=f.Synchronized)||void 0===n?void 0:n.Value,"Key of a Synchronized AxisGrouping should refer to Select with Synchronization"),a[null===(i=f.Synchronized)||void 0===i?void 0:i.Value].forIdentity=!0):a[f.Value].forIdentity=!0:c.Calc?a[c.Calc]={kind:Z.Group,forIdentity:!0,isGroupKeyButNotSelect:!0}:u.assertFail("Unexpected DataShapeExpressionAxisGroupingKey without select or calc")}},t.prototype.createAggregateCalcMetadata=t.prototype.getAggregateKind=t.prototype.createColumns=function(e,r){var n=e.length,i=this.createMetadataColumn(r);e.push(i);var a=this.selects[r],o=a.Kind,s=this.calcInfo;s[a.Value]={kind:o,columnIndex:n,selectIdx:r,calcKind:1};var l=a.Synchronized;if(l&&(u.assert(function(){return o===Z.Group},"Synchronization Auxiliary Select is expected only for Grouping Selects"),u.assertValue(l.Value,"Synchronization Auxiliary Select must have a Value"),u.assertValue(l.GroupKeys,"Synchronization Auxiliary Select must have GroupKeys"),s[l.Value]={kind:o,columnIndex:n,selectIdx:r,calcKind:1},s[a.Value].isSynchronized=!0),a.Subtotal){u.assert(function(){return o===Z.Measure},"Subtotal SelectKind");for(var c=0,f=a.Subtotal;c<f.length;c++)s[d=f[c]]={columnIndex:n,kind:o,selectIdx:r,calcKind:2}}if(a.Highlight){u.assert(function(){return o===Z.Measure},"Highlight SelectKind");var p=a.Highlight.Value;p&&(s[p]={columnIndex:n,kind:o,selectIdx:r,calcKind:3});var h=a.Highlight.Subtotal;if(h)for(var v=0,g=h;v<g.length;v++)s[d=g[v]]={columnIndex:n,kind:o,selectIdx:r,calcKind:9}}if(this.scopedAggregatesEnabled){if(!_.isEmpty(a.Aggregates))for(var y=0,m=a.Aggregates;y<m.length;y++)if((S=m[y]).Aggregate.Scope)for(var E=0,C=S.Ids;E<C.length;E++)s[C[E]]={columnIndex:n,kind:o,selectIdx:r,calcKind:7};var V=a.Highlight;if(V&&!_.isEmpty(V.Aggregates))for(var w=0,D=V.Aggregates;w<D.length;w++){var S;if((S=D[w]).Aggregate.Scope)for(var A=0,I=S.Ids;A<I.length;A++)s[I[A]]={columnIndex:n,kind:o,selectIdx:r,calcKind:8}}}var F=this.tryCreateDynamicFormatColumnMetadata(r,i);if(F){u.assert(function(){return o===Z.Measure},"Dynamic Format SelectKind");var R=n+1;if(e.push(F),s[a.DynamicFormat.Format]={columnIndex:R,kind:Z.Measure,selectIdx:r,calcKind:4},a.SubtotalDynamicFormat)for(var W=0,ae=a.SubtotalDynamicFormat;W<ae.length;W++){var d,oe=(d=ae[W])&&d.Format;oe&&(s[oe]={columnIndex:R,kind:Z.Measure,selectIdx:r,calcKind:5})}var K=a.Highlight&&a.Highlight.DynamicFormat&&a.Highlight.DynamicFormat.Format;K&&(s[K]={columnIndex:R,kind:Z.Measure,selectIdx:r,calcKind:6})}return{column:i,columnIdx:n,dynamicFormatColumn:F}},t.prototype.createMetadataColumn=function(e){var r=this.selects[e],n={displayName:"",index:e};r.Format&&(n.format=r.Format),n.type=J.describeDataType(r.Type,r.DataCategory),r.Kind===Z.Measure&&(n.isMeasure=!0);var i=r.GroupKeys;if(i)for(var a=n.identityExprs=new Array(i.length),o=0;o<i.length;o++)a[o]=Wy(i[o],e,this.selects);return n},t.prototype.tryCreateDynamicFormatColumnMetadata=t.prototype.createScopedAggregateMetadata=t.prototype.createScopedAggregateCalcMetadata=function(e,r){var n=e.Aggregate,i=n.Scope;if(i){var a=this.selectIndexToColumn,o=i.PrimaryDepth;u.assert("Scoped Aggregates not supports secondary depth for now.");for(var s=new Array(o),l=this.primaryAxisGroupings,c=0,f=0;f<o;f++)for(var p=0,h=l[f].Keys;p<h.length;p++){var g=h[p].Select;u.assertValue(g,"select");var y=a[g];u.assertValue(y,"inputScopeColumn"),s[c++]=y}for(var m={column:r,inputScope:s,respectInstanceFilters:n.RespectInstanceFilters},E=this.calcInfo,C=0,b=e.Ids;C<b.length;C++){var x=E[b[C]];u.assertValue(x,"aggregateCalcInfo"),x.scopedAggregateCalcMetadata={metadata:m,aggregateKind:this.getAggregateKind(n)}}}},t.prototype.fillDataShapeScopeAggregateValues=function(){var e=this.dataShapeParser;if(e){var r=this.calcInfo;e.reset();var n=e.next();u.assert(function(){return n},"There must be a DataShape");for(var i=function(){var o=r[e.calcId()];if(!o||!o.scopedAggregateCalcMetadata)return"continue";var s=o.scopedAggregateCalcMetadata,l=s.metadata,c=l.column,f=l.inputScope,d=l.respectInstanceFilters,p={inputScope:f,respectInstanceFilters:d,values:{},highlight:{}};if(c.scopedAggregates){var h=_.find(c.scopedAggregates,;h?p=h:c.scopedAggregates.push(p)}else c.scopedAggregates=[p];var v=void 0;switch(o.calcKind){case 7:v=p.values;break;case 8:v=p.highlight;break;default:u.assertFail("Invalid CalcKind.")}var g=e.calcValue();switch(s.aggregateKind){case 3:v.min=g;break;case 2:v.max=g;break;case 6:v.avg=g;break;default:u.assertFail("Invalid scoped aggregate function.")}};e.nextCalc();)i()}},t.sameScopedAggregatesInputScope=t}(),VN=function(){function t(e,r,n,i){this.context=e,this.dsrParser=r,this.metadata=n,u.assertValue(e,"context"),u.assertValue(r,"dsrParser"),u.assertValue(n,"metadata"),u.assertNonEmpty(n.columns,"metadata.columns"),this.aggregator=new Gi(e),this.scopedAggregatesEnabled=i}return t.prototype.run=function(){var e=this,r=this.aggregator,n=this.dsrParser;n.reset();var i=n.dataShapes();this.calcInfoCache={};var a=i.next();u.assert(function(){return a},"There must be a DataShape"),this.createHierarchiesLevels(),this.readValueSources(i),u.assert("DSR is not compatible with Matrix"),r.read(i,1===this.context.maxPrimaryDepth&&0===this.context.maxSecondaryDepth);var o=i.secondaryHierarchy(),s=this.readHierarchy(1,o,i),l=i.primaryHierarchy(),c=this.readHierarchy(0,l,i);return r.copyToColumns(),{rows:c,columns:s,valueSources:this.valueSources}},t.prototype.createHierarchiesLevels=function(){var e=this.context.selects,r=this.context.maxPrimaryDepth,n=this.context.maxSecondaryDepth;this.primaryHierarchyLevels=new Array(r),this.secondaryHierarchyLevels=new Array(n);for(var i=0;i<r;i++)this.primaryHierarchyLevels[i]={sources:[]};for(i=0;i<n;i++)this.secondaryHierarchyLevels[i]={sources:[]};var a=this.metadata.columns,o=a.length,s=this.columnIndexToZoneIndex=new Array(o);for(i=0;i<o;i++){var l=a[i],c=l.index;if(null!=c){var f=e[c],d=void 0;f.Kind===Z.Group&&(null!=f.Depth?d=this.primaryHierarchyLevels[f.Depth].sources:null!=f.SecondaryDepth&&(d=this.secondaryHierarchyLevels[f.SecondaryDepth].sources),u.assertValue(d,"Grouping Select not belonging to either Hierarchy"),s[i]=d.length,d.push(l))}}},t.prototype.readHierarchy=function(e,r,n){var i,a,o=this.valueSources.length;switch(e){case 0:if(a=this.context.maxPrimaryDepth,!(i=this.context.primaryAxisGroupings))return u.assert(function(){return 0===a},"No primary groupings"),u.assert(function(){return o>0},"Matrix without groups needs at least a measure"),this.createRowHierarchyForNoGroupings(r);break;case 1:if(a=this.context.maxSecondaryDepth,!(i=this.context.secondaryAxisGroupings))return u.assert(function(){return 0===a},"No secondary groupings"),0===o?{levels:[],root:{children:[]}}:this.createColumnHierarchyForNoGroupings();break;default:u.assertFail("Unexpected DataShapeHierarchy")}u.assert("Groupings-Hierarchy mismatch");var s={levels:0===e?this.primaryHierarchyLevels:this.secondaryHierarchyLevels,root:{}};1===e&&o>1&&s.levels.push(this.createColumnHierarchyMeasuresLevel());var l=this.context.primarySynchronizedGroups;0===e&&l&&this.readRowsSynchronizedGroups(l,s,n);var c=this.context;return this.readNodeChildren(c,c.calcInfo,this.columnIndexToZoneIndex,c.dataMemberIdToIdentityBuilder,c.dataMemberIdToMetadata,s.root,r,0,e,o,this.context.maxSecondaryDepth,s.levels),!_.isEmpty(s.root.children)&&!_.isEmpty(s.synchronizedGroups)&&this.ensureRowNodeSynchronization(s.root,0),s},t.prototype.readRowsSynchronizedGroups=function(e,r,n){u.assertNonEmpty(e,"No Primary Synchronized Groups"),u.assertValue(r,"hierarchy");var i=e.length;r.synchronizedGroups=new Array(i),this.primarySynchronizedGroupByLevel=new Array(r.levels.length);for(var a=n.nestedDataShapes(),o=function(f){var d=e[f],p=d.groupings;u.assert(function(){return!_.isEmpty(p)},"Empty synchronized group");var h=a[d.dataShapeId];u.assertValue(h,"no dataShapeParser for a SynchronizedGroup");var v=h.next();u.assert(function(){return v},"Nested DataShape not found");var g=h.primaryHierarchy();u.assertValue(g,"Nested DataShape of a Synchronized Group has no Primary Hierarchy");for(var y=r.synchronizedGroups[f]={levels:new Array,root:{}},m=0;m<p.length;m++){var S=p[m],E=y.levels[m]=r.levels[S];E.valueSources&&((r.levels[S]=fe(E)).valueSources=E.valueSources,delete E.valueSources)}s.primarySynchronizedGroupByLevel[p[0]]=y;for(var b=s.metadata.columns,V=new Array(b.length),x=w=0;w<b.length;w++)x(w);var D=s.context.createContextForPrimarySynchronizedGroup(d,h);s.readNodeChildren(D,D.calcInfo,V,D.dataMemberIdToIdentityBuilder,D.dataMemberIdToMetadata,y.root,g,0,0,0,D.maxSecondaryDepth,y.levels,{currentIndex:0})},s=this,l=0;l<i;l++)o(l)},t.prototype.readNodeChildren=t.prototype.readNode=function(e,r,n,i,a,o,s,l,c,f,d,p,h,v,g,y,m,S){u.assert("Unexpected IdentityBuilder"),u.assert("Subtotal nodes should not have RestartValues");var E=e.aggregateCalcMetadata,C={level:l};r.forSynchronization&&(u.assertValue(S,"undefined synchronizedGroupLeafIndex while parsing Master List"),C.synchronizationIndex=S.currentIndex),1===s.restartFlagKind()&&(C.isMerge=!0),c?C.isSubtotal=!0:g.reset();for(var b=[],V=r.isSynchronized,x=function(ae){var oe=s.calcId(),K=d[ae];if(!K){if(!(K=a[oe]))return"continue";d[ae]=K}if(10===K.calcKind){var Ce=s.calcValue();return u.assert(function(){return"number"==typeof Ce},"Synchronization Index is expected to be a number"),C.synchronizationIndex=Ce,"continue"}var De=K.columnIndex;u.assert(function(){return!0===K.isGroupKeyButNotSelect==(null==De)},"Unexpected columnIndex");var be=o[De];u.assert("Unexpected zoneIndex");var _e=K.kind,se=void 0;if(_e===Z.Group){if(!V){var Ae=s.calcValueAsExpr();se=Ae.value,K.isGroupKeyButNotSelect||(b[be]={value:se,levelSourceIndex:be}),g.addExpr(oe,Ae)}}else if(_e===Z.Measure){u.assertValue(K.selectIdx,"Measure Calc ".concat(oe," on DataMember instances must be related to a Select"));var ct=w.measuresGroupingScopeBySelectIndex[K.selectIdx];u.assertValue(ct,"Calc ".concat(oe," has an undefined grouping scope")),u.assert(function(){return 0===ct.secondary},"Calc ".concat(oe," is grouped by Secondary while appearing on DataMember")),u.assert(function(){return 0===p},"Measure Calcs cannot appear on Secondary Hierarchy DataMembers");var Yn,Pr=void 0;0===v&&ct.primary===m.length?(Yn=h,null==C.values&&(Pr=C.values={}),Pr=C.values):(Yn=m[l].valueSources[0].length,C.nodeValues||(C.nodeValues={0:{}}),Pr=C.nodeValues[0]),u.assert(function(){return be<Yn},"Measure index out-of-bound");var $n=Pr[be];$n||($n=Pr[be]={},be>0&&($n.valueSourceIndex=be)),se=s.calcValue(),w.readNodeValueCalc($n,se,K),w.scopedAggregatesEnabled&&K.scopedAggregateCalcMetadata&&w.setScopeAggregateValue(C,se,K,m[l-1]),f&&(2===K.calcKind||5===K.calcKind)&&(u.assertValue(e.aggregateCalcMetadata[oe],"Grand Total AggregateMetadata is undefined"),J.fillMetadataColumnAggregate(se,E[oe]))}else u.assertFail("Unexpected SelectKind");if(!V&&K.hasDuplicateColumnIndices)for(var Xn=0,na=e.calcIdToColumnIndices[oe];Xn<na.length;Xn++){var ft=o[na[Xn]];b[ft]||(b[ft]={value:se,levelSourceIndex:ft})}},w=this,D=0;s.nextCalc();D++)x(D);if(!c&&!V){C.levelValues=b,C.value=b[0].value,C.identity=g.getIdentity();var A=s.restartKind();A&&(1===A?C.restartKind=1:2===A?C.restartKind=2:3===A&&(C.restartKind=3),C.restartKind&&(u.assertValue(y,"An instance with RestartKind must belong to a DataMember with RestartIdentity"),C.restartValues=y.getRestartValues(s)))}var I=s.intersections(),F=s.members();if(I)u.assert(function(){return null==F},"non-leaf node with intersections"),this.readIntersectionsValues(a,o,h,C,I);else if(F){if(u.assert(function(){return null==I},"non-leaf node with intersections"),this.readNodeChildren(e,a,o,n,i,C,F,l+1,p,h,v,m,S),r.isSynchronized&&!_.isEmpty(C.children)){var R=C.children[0].synchronizationIndex;void 0!==R&&(C.synchronizationIndex=R)}}else 1===p&&h>1&&(l===v-1||C.isSubtotal)&&this.createColumnHierarchyMeasuresNodes(C);return C},t.prototype.setScopeAggregateValue=function(e,r,n,i){u.assertValue(e,"node"),u.assert(function(){return void 0!==r},"calcValue"),u.assertValue(n,"calcInfo");var s,a=n.scopedAggregateCalcMetadata,o=this.findDataViewNodeAggregates(e,a.metadata);switch(n.calcKind){case 7:s=o.values;break;case 8:s=o.highlight;break;default:u.assertFail("Invalid Aggregate CalcInfo.")}switch(a.aggregateKind){case 2:s.max=r;break;case 3:s.min=r;break;case 6:s.avg=r;break;default:u.assertFail("Unexpected DataViewAggregateKind.")}var l=a.metadata,c=i.aggregates;c?_.some(c,||c.push(l):i.aggregates=[l]},t.prototype.findDataViewNodeAggregates=t.prototype.readIntersectionsValues=function(e,r,n,i,a){if(0!==n)for(var o=i.values={},s=0;a.next();){for(var l=0;l<n;l++){var c=o[n*s+l]={};l>0&&(c.valueSourceIndex=l)}for(;a.nextCalc();){var f=e[a.calcId()];if(f){var d=r[f.columnIndex];u.assertValue(d,"Intersection calculation has no matching column index"),u.assertValue(c=o[n*s+d],"nodeValue not found"),this.readNodeValueCalc(c,a.calcValue(),f)}}s++}},t.prototype.readNodeValueCalc=function(e,r,n){switch(u.assertValue(e,"nodeValue"),u.assert(function(){return void 0!==r},"calcValue"),u.assertValue(n,"calcInfo"),n.calcKind){case 1:case 4:e.value=r,this.aggregator.update(r,n.selectIdx);break;case 2:case 5:e.value=r;break;case 3:case 6:case 9:e.highlight=r;break;case 7:case 8:case 10:break;default:u.assertNever(n.calcKind)}},t.prototype.createRowHierarchyForNoGroupings=function(e){var r={level:0,values:{}},n={levels:[],root:{children:[r]}};u.assert(function(){return 1===e.count()},"DSR with no groupings should have one DataMember"),e.next();var i=e.instances();return u.assertValue(i,"instancesParser"),this.readNodeForNoGroupings(r,i),n},t.prototype.readNodeForNoGroupings=function(e,r){u.assert(function(){return 1===r.count()},"DSR with no groupings should have one Instance");var n=this.context.calcInfo,i=this.columnIndexToZoneIndex;r.next();for(var a=e.values={};r.nextCalc();){var s=n[r.calcId()];if(s){var l=i[s.columnIndex],c=a[l];c||(c=a[l]={},l>0&&(c.valueSourceIndex=l)),this.readNodeValueCalc(c,r.calcValue(),s)}}},t.prototype.createColumnHierarchyForNoGroupings=t.prototype.createColumnHierarchyMeasuresLevel=t.prototype.createColumnHierarchyMeasuresNodes=t.prototype.readValueSources=function(e){var r=this,n=this.context,i=n.selects,a=n.measureSelectIndices,o=a.length,s=n.selectIndexToColumn,l=n.selectIndexToColumnIndex,c=this.columnIndexToZoneIndex;u.assertValue(a,"measureSelectIndices"),this.valueSources=[],this.measuresGroupingScopeBySelectIndex={};var f={};if(e.calcCount()>0){for(;e.nextCalc();)f[e.calcId()]=!0;e.restartCalcs()}for(var d=function(g){var y=a[g],m=i[y];u.assert("Expected a Measure Select"),u.assertValue(m.Value,"Every Measure Select must have a Calc Id");var S=l[y],E=p.measuresGroupingScopeBySelectIndex[y]=p.getMeasureGroupingScope(m,f[m.Value]);if(!E)return"continue";var C=E.primary,b=E.secondary,V=void 0;if(C===p.context.maxPrimaryDepth&&b===p.context.maxSecondaryDepth)V=p.valueSources;else{u.assert("Currently, Arbitrary-scoping of measures only supports suppresing projections on all Secondary"),u.assert("Arbitrary-scope cannot be more specific than inner-most scope");var x=p.primaryHierarchyLevels[C-1];x.valueSources||(x.valueSources={0:[]}),V=x.valueSources[0]}var w=s[y];if(u.assertValue(w,"Measure column not found"),c[S]=V.length,V.push(w),m.DynamicFormat&&m.DynamicFormat.Format){var D=w.formatSource&&w.formatSource.formatString;u.assertValue(D,"DynamicFormat column not found"),c[S+1]=V.length,V.push(D)}},p=this,h=0;h<o;h++)d(h)},t.prototype.getMeasureGroupingScope=t.prototype.ensureRowNodeSynchronization=function(e,r){var n=this;if(u.assert(function(){return!n.isRowLeaf(e)},"Attempting to traverse Hierarchy beyond leaves"),!this.isRowLeaf(e)){var i=this.primarySynchronizedGroupByLevel[r];if(i)return void this.synchronizeNodeChildren(e,i.root);var a=e.children;u.assertNonEmpty(a,"Jagged hierarcy found!");for(var o=r+1,s=0,l=a;s<l.length;s++)this.ensureRowNodeSynchronization(l[s],o)}},t.prototype.synchronizeNodeChildren=function(e,r){if(!this.isRowLeaf(e)){var n=e.level+1,i=r.children;if(_.isEmpty(i))return void this.ensureRowNodeSynchronization(e,n);var a=i.length,o=e.children||[],s=new Array(a);e.children=s;var c,f,l=0;f=null==(c=l<o.length?o[l]:void 0)?void 0:c.synchronizationIndex;for(var d=0;d<a;d++){var p=i[d],h=p.synchronizationIndex,v=this.copyFromMasterNode(p);v.level=n,s[d]=v,c&&f===h?(u.assert(function(){return c.level===n},"A child node's level must come immediately after its parents level"),this.copyFromExistingNode(c,v),this.synchronizeNodeChildren(v,p),l++,f=null==(c=l<o.length?o[l]:void 0)?void 0:c.synchronizationIndex):void 0===f||h<f?this.isRowLeaf(v)||(v.children=[],this.synchronizeNodeChildren(v,p)):u.assertFail("Unsynchronized nodes should be a subset of master list nodes.")}}},t.prototype.copyFromMasterNode=t.prototype.copyFromExistingNode=function(e,r){e.aggregateValues&&(r.aggregateValues=e.aggregateValues),e.values&&(r.values=e.values),e.nodeValues&&(r.nodeValues=e.nodeValues),u.assert("A non-leaf master node matches a leaf node"),e.children&&(r.children=e.children),e.childIdentityFields&&!r.childIdentityFields&&(r.childIdentityFields=e.childIdentityFields)},t.prototype.isRowLeaf=function(e){return!(e.level!==this.context.maxPrimaryDepth-1&&!e.isSubtotal||(u.assert(function(){return _.isEmpty(e.children)},"A leaf node should not have children"),0))},t}(),Ky=function(){eturn t.prototype.run=function(){return this.parseSingle()},t.prototype.parseSingle=function(){var e=this.dsrParser;e.reset();var r=e.dataShapes(),n=r.next();return u.assert(function(){return n},"There must be a DataShape"),this.aggregator.read(r,!1),this.aggregator.copyToColumns(),0===this.context.maxPrimaryDepth?this.parseMeasureValue(r.primaryHierarchy()):this.parseSubtotal(r.primaryHierarchy())},t.prototype.parseMeasureValue=function(e){for(u.assert(function(){return 1===e.count()},"call parseMeasureValue only when there's one datamember with no grouping");e.next();)return this.parseInstance(e.instances())},t.prototype.parseSubtotal=t.prototype.parseInstance=function(e){for(var i,a,r=this.context,n=r.calcInfo;e.next();)for(;e.nextCalc();){var o=e.calcId(),s=n[o];if(s){var l=s.calcKind,c=2===l;(1===l||c)&&(i=e.calcValue(),a=s.selectIdx,c&&(u.assertValue(r.aggregateCalcMetadata[o],"AggregateCalcMetadata for calc must exist."),J.fillMetadataColumnAggregate(i,r.aggregateCalcMetadata[o])))}}if(void 0!==i)return{column:r.selectIndexToColumn[a],value:i}},t.isCompatible=t}(),MN=function(){function t(e,r,n){this.context=e,this.dsrParser=r,this.metadata=n,u.assertValue(e,"context"),u.assertValue(r,"dsrParser"),u.assertValue(n,"metadata"),this.aggregator=new Gi(e)}return t.prototype.run=function(){if(this.isCompatible()){var r={columns:this.metadata.columns},n=this.dsrParser;n.reset();var i=n.dataShapes(),a=i.next();u.assert(function(){return a},"There must be a DataShape");var o=this.aggregator;o.read(i);var s=i.primaryHierarchy();return 1===this.context.maxPrimaryDepth?this.readRows(r,s):0===this.context.maxPrimaryDepth?this.readRowWithoutGrouping(r,s):u.assert(function(){return!1},"Upsupported maxPrimaryDepth value"),o.copyToColumns(),r}},t.prototype.readRows=function(e,r){var i,o,n=this.context,a=this.getRowCellsCount(r);for(r.reset();r.next();){var s=r.id(),l=n.dataMemberIdToMetadata[s];if(l){var c=l.kind,f=r.instances(),d=[];if(1===c){var p=n.dataMemberIdToIdentityBuilder[s];p||(p=n.dataMemberIdToIdentityBuilder[s]=new Qi(n,s));var h=l.axisGrouping,v=f.count();i=new Array(v);for(var g=new Array(v),y=0;f.next();y++)1===f.restartFlagKind()&&(o=y),p.reset(),i[y]=this.readRow(f,h,d,a,p,!1),g[y]=p.getIdentity();_.isEmpty(g)||(e.identity=g),e.identityFields=p.getIdentityFields()}else if(2===c){if(0===a)continue;for(;f.next();){u.assert(function(){return null==e.totals},"Totals can only be assigned once.");var m=this.readRow(f,null,d,a,null,!0),S=m.length;for(y=0;y<S;y++)void 0===m[y]&&(m[y]=null);e.totals=m}}else u.assert(function(){return!1},"Unsupported DataMemberKind");e.rows=i,void 0!==o&&(e.lastMergeIndex=o)}}},t.prototype.readRow=function(e,r,n,i,a,o){var c,s=this.aggregator,l=new Array(i),f=0===n.length;f&&r&&(u.assert("No DataShape with a single primary DataMember should ever have a DataMember instance with no calculations."),c=this.createCalcIdToGroupingIdentityIndexMap(r),n.length=e.calcCount());for(var d=this.context,p=d.aggregateCalcMetadata,h=0;e.nextCalc();h++){var v=e.calcId();if(f){var g=c&&c[v],y=d.calcInfo[v],m=y&&y.columnIndex;y&&(3===y.calcKind||6===y.calcKind||9===y.calcKind)&&(m=null),n[h]={axisGroupingIndex:g,columnIndex:m,hasDuplicateColumnIndices:y&&y.hasDuplicateColumnIndices,isGroupKeyOnly:null!=g&&null==m,selectIndex:y&&y.selectIdx,aggregateMetadata:p[v]}}var E=n[h];if(null!=E.columnIndex){var C=e.calcValue();if(l[E.columnIndex]=C,o?J.fillMetadataColumnAggregate(C,E.aggregateMetadata):s.update(C,E.selectIndex),E.hasDuplicateColumnIndices)for(var b=0,V=d.calcIdToColumnIndices[v];b<V.length;b++){var x=V[b];void 0===l[x]&&(l[x]=C)}}a&&a.addExpr(v,e.calcValueAsExpr())}return l},t.prototype.readRowWithoutGrouping=function(e,r){if(u.assert(function(){return r.count()<=1},"There must be maximum one DataMember, because SubTotalMember are not supported without grouping."),r.next()){var n=r.instances(),i=[];if(u.assert("There must be maximum one DataMemberInstance since there is no grouping."),n.next()){for(var a=[];n.nextCalc();){var o=n.calcId(),s=this.context.calcInfo[o];s&&3!==s.calcKind&&(a[s.columnIndex]=n.calcValue())}i.push(a)}e.rows=i}},t.prototype.getRowCellsCount=t.prototype.createCalcIdToGroupingIdentityIndexMap=t.prototype.isCompatible=t}(),AN=function(){eturn t.prototype.run=t.prototype.parseTree=function(e){var r=this.dsrParser;r.reset();var n=r.dataShapes(),i=n.next();u.assert(function(){return i},"There must be a DataShape");var a=this.context.maxPrimaryDepth;this.aggregator.read(n,1===a),0===a?this.parseDataMembersWithNoGrouping(e,n.primaryHierarchy()):this.parseDataMembers(e,n.primaryHierarchy(),0),this.parseAggregates(e)},t.prototype.parseDataMembers=function(e,r,n){for(;r.next();){var i=this.context,a=r.id(),o=i.dataMemberIdToMetadata[a];if(o){var s=r.instances(),l=this.calcIndexToCalcMetadataDictionary[a];switch(l||(this.calcIndexToCalcMetadataDictionary[a]=l=[]),o.kind){case 1:var c=i.dataMemberIdToIdentityBuilder[a];c||(c=new Qi(i,a),i.dataMemberIdToIdentityBuilder[a]=c);var f=c.getIdentityFields();f&&(e.childIdentityFields=f),this.parseInstances(e,s,l,c,!1,n);break;case 2:this.parseInstances(e,s,l,null,!0,n);break;default:u.assert(function(){return!1},"Unsupported DataMemberKind")}}}},t.prototype.parseInstances=function(e,r,n,i,a,o){var s=this.context,l=this.aggregator,c=s.aggregateCalcMetadata,f=e.children;for(a||(u.assertValue(i,"identityBuilder"),!f&&r.count()>0&&(f=e.children=new Array(r.count())));r.next();){var d=void 0,p=void 0,h=void 0;a||i.reset();var v=0===n.length;v&&(n.length=r.calcCount());for(var g=function(b){a&&(d=e.values),d||(d={});var V=r.calcId();v&&(n[b]=s.calcInfo[V]);var w=n[b];if(!w)return"continue";var D=r.calcValue(),A=w.calcKind,I=w.kind,F=w.selectIdx;if(a)u.assert("subtotal cannot be of grouping kind."),y.addTreeNodeMeasureValues(d,F,A,D),0===o&&J.fillMetadataColumnAggregate(D,c[V]);else{var R=w.isGroupKeyButNotSelect;R||y.addTreeNodeMeasureValues(d,F,A,D),I===Z.Group?(R||(h=D),i.addExpr(V,r.calcValueAsExpr())):I===Z.Measure&&1===A&&(p=D,u.assertValue(F,"selectIndex"),l.update(D,F))}},y=this,m=0;r.nextCalc();m++)g(m);if(a)e.values=d,1===r.restartFlagKind()&&(e.isMerge=!0);else{var S={values:d,identity:i.getIdentity()};void 0!==h&&(S.name=h),void 0!==p&&(S.value=p),1===r.restartFlagKind()&&(S.isMerge=!0);var E=r.members();E&&this.parseDataMembers(S,E,o+1),f[r.currentIndex()]=S}}},t.prototype.addTreeNodeMeasureValues=function(e,r,n,i){u.assertValue(r,"selectIndex");var a=e[r];switch(!a&&this.isSupportedMeasureType(n)&&(a=e[r]={}),n){case 1:a.value=i;break;case 2:a.subtotal=i;break;case 3:a.highlight=i}},t.prototype.isSupportedMeasureType=t.prototype.parseDataMembersWithNoGrouping=function(e,r){u.assert(function(){return 1===r.count()},"There can only be one datamember with no grouping"),r.next();var n=r.instances();u.assert("There can only be one instance for datamember with no grouping"),n.next();for(var i,a=this.context.calcInfo;n.nextCalc();){e.values||(e.values=i={});var o=a[n.calcId()];if(o){var s=o.calcKind,l=n.calcValue();this.addTreeNodeMeasureValues(i,o.selectIdx,s,l),1===s&&(e.value=l)}}},t.prototype.isCompatible=t.prototype.parseAggregates=function(e){var r=this.context;this.aggregator.copyToColumns();for(var n=r.measureSelectIndices,i=n.length,a=0;a<i;a++){var o=n[a],s=r.selectIndexToColumn[o].aggregates,l=e.values;if(s){l||(l=e.values={});var c=l[o];c||(c=l[o]={}),J.copyAggregates(s,c)}}},t}(),Jy=function(){function t(e,r,n){u.assertValue(e,"queryBindingDescriptor"),u.assert("Expected a non-empty array of exceeded limits."),this.computeMetadata(e,n,r)}return Object.defineProperty(t.prototype,"code",{get:function(){return"DsrLimitsWarning"},enumerable:!1,configurable:!0}),t.prototype.computeMetadata=t.prototype.getDetails=t.getExceededLimitsDetails=t.prototype.getErrorInfoValue=function(e,r,n){if(!e||0===e.length)return null;for(var i=[],a=0,o=e.length;a<o;a++){var l=this.getGroupingNameFromGroupingKeys(e[a]);l&&i.push(l)}var f=i.length;return 0===f?null:Ne(r,1===f?i[0]:i.join(n.get("ListJoin_Separator")))},t.prototype.getGroupingNameFromGroupingKeys=t.getMessage=function(e,r){switch(e){case 2:return r.get("DsrLimitWarning_RepresentativeSampleMessage");case 3:case 4:return r.get("DsrLimitWarning_HighDensitySampleMessage");default:return r.get("DsrLimitWarning_TooMuchDataMessage")}},t.getKey=t.getDetailedMessageFormatForOneColumn=t.getHelpLink=t.getLimitMetadata=t.getLimitCount=function(e,r){if(e.Calc&&r){var n=J.findCalculation(r,e.Calc);if(n){var i=my(n.Value);if(_.isNumber(i))return i}}return e.Count},t.getBinnedLineSampleCount=function(e){return e.MaxTargetPointCount},t}();ar Bo={"ForecastErrorType.DataIsTooSmall":{localizedMessage:"DsrMessage_NotEnoughDataMessage",localizedTitle:"DsrMessage_NotEnoughDataTitle",localizedContent:"DsrMessage_NotEnoughDataContent",isTransformMessage:!0},"ForecastErrorType.TooManyMissingValues":{localizedMessage:"DsrMessage_DataIsTooRandomOrMissingValuesMessage",localizedTitle:"DsrMessage_DataIsTooRandomOrMissingValuesTitle",localizedContent:"DsrMessage_DataIsTooRandomOrMissingValuesContent",isTransformMessage:!0},"ForecastErrorType.NoDominantStepDetected":{localizedMessage:"DsrMessage_DataIsTooRandomOrMissingValuesMessage",localizedTitle:"DsrMessage_DataIsTooRandomOrMissingValuesTitle",localizedContent:"DsrMessage_DataIsTooRandomOrMissingValuesContent",isTransformMessage:!0},"ForecastErrorType.InputTimeStampsNotSorted":{localizedMessage:"DsrMessage_UnsortedDataMessage",localizedTitle:"DsrMessage_UnsortedDataTitle",localizedContent:"DsrMessage_UnsortedDataContent",isTransformMessage:!0},"ForecastErrorType.XAxisIsNull":{localizedMessage:"DsrMessage_ForecastXValueNullMessage",localizedTitle:"DsrMessage_ForecastXValueNullTitle",localizedContent:"DsrMessage_ForecastXValueNullContent",isTransformMessage:!0},"ForecastErrorType.InvalidSeasonality":{localizedMessage:"DsrMessage_ForecastInvalidSeasonalityMessage",localizedTitle:"DsrMessage_ForecastInvalidSeasonalityTitle",localizedContent:"DsrMessage_ForecastInvalidSeasonalityContent",isTransformMessage:!0},"ForecastErrorType.InvalidDataType":{localizedMessage:"DsrMessage_ForecastVariantDataTypeMessage",localizedTitle:"DsrMessage_ForecastVariantDataTypeTitle",localizedContent:"DsrMessage_ForecastVariantDataTypeContent",isTransformMessage:!0},"ForecastErrorType.Unexpected":{localizedMessage:"DsrMessage_ForecastErrorMessage",localizedTitle:"DsrMessage_ForecastErrorTitle",localizedContent:"DsrMessage_ForecastErrorContent",isTransformMessage:!0},ForecastTransformUnsupported:{localizedMessage:"DsrMessage_ForecastNotSupportedMessage",localizedTitle:"DsrMessage_ForecastNotSupportedTitle",localizedContent:"DsrMessage_ForecastNotSupportedContent",isTransformMessage:!0},"ClusteringErrorType.LessThanKDataPoints":{localizedMessage:"DsrMessage_ClusterTooManyClustersTitle",localizedTitle:"DsrMessage_ClusterTooManyClustersTitle",localizedContent:"DsrMessage_ClusterTooManyClustersContent",isTransformMessage:!0},"ClusteringErrorType.TooManyDataPoints":{localizedMessage:"DsrMessage_ClusterExceedsLimitTitle",localizedTitle:"DsrMessage_ClusterExceedsLimitTitle",localizedContent:"DsrMessage_ClusterExceedsLimitContent",isTransformMessage:!0},"ClusteringErrorType.InvalidDataType":{localizedMessage:"DsrMessage_ClusterVariantDataTypeTitle",localizedTitle:"DsrMessage_ClusterVariantDataTypeTitle",localizedContent:"DsrMessage_ClusterVariantDataTypeContent",isTransformMessage:!0}},$y=function(){function t(e){this.dataShapeMessage=e}return Object.defineProperty(t.prototype,"code",{get:function(){return this.dataShapeMessage.Code},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){var r=Bo[this.dataShapeMessage.Code];return u.assertValue(r,"message to show should be a known message"),{message:e.get(r.localizedMessage),displayableErrorInfo:[{errorInfoKey:e.get(r.localizedTitle),errorInfoValue:e.get(r.localizedContent)}]}},t.prototype.isTransformMessage=t}();function FN(t,e){for(var r=[],n={},i=0,a=t;i<a.length;i++){var o=a[i],s={id:o.Id,name:o.Name,component:o.Component,pageHidden:void 0,start:Io(o.Start).valueOf(),end:o.End?Io(o.End).valueOf():void 0,metrics:o.Metrics,status:1,rootId:e,parentId:o.ParentId};o.ParentId?(n[o.ParentId]||(n[o.ParentId]=[]),n[o.ParentId].push(s)):r.push(s)}return Xy(r,n),r}ar sr=function(){eturn t.prototype.reset=function(e){var r=this;this.currentIndex=-1,e&&(u.assert("Resetting with same elements"),this.elements=e)},t.prototype.count=function(){return _.size(this.elements)},t.prototype.current=function(){var e=this;return u.assert("Invalid Iterator index"),this.elements[this.currentIndex]},t.prototype.done=t.prototype.next=t.prototype.index=function(){return this.currentIndex},t}();function Zy(t,e){return new PN(t,e)}var PN=function(){function t(e,r){this.dsrParserContext=r,u.assertValue(e,"dsr"),u.assertAnyValue(r,"dsrParserContext"),this.parser=new RN(e.DS,this.dsrParserContext)}return t.prototype.dataShapes=function(){return this.parser},t.prototype.reset=function(){this.parser.reset()},t.prototype.lockCache=t}(),em=function(){eturn t.prototype.initialize=t.prototype.getCurrentCalc=function(e,r,n,i){var o,a=this;return u.assert(function(){return e>=0},"unexpected position input"),n?void 0!==(o=this.repeatedValuesHandler.tryRead(e))?o:void 0!==(o=this.nullValuesHandler.tryRead(e))?(this.lastContainerCalculations[e]=null,o):(r?r.next()&&(o=r.current(),this.lastContainerCalculations[e]=o):(u.assert(function(){return!!i},"Unexpected calcId"),void 0===(o=n[i])&&(o=null),this.lastContainerCalculations[e]=o),o):(u.assert(function(){return 3===a.calculationContainerKind},"Unexpected Empty DataShape/DataMemberInstance as calc container"),null)},t}(),tm=function(){eturn t.prototype.setCalculations=function(e){u.assertAnyValue(e,"calculationContainerParser:setCalculation calculationContainer can be any value"),this.calculationContainer=e;var r=this.context;if(r){var n=this.calcMetadataCacheKey,i=e.S;i&&(this.metadata=i,n&&!r.locked&&(r.memberInstanceCalcMetadataCache[n]=i),this.lastContainerCalculations||(this.lastContainerCalculations=new Array(i.length))),r.instancesCalcCache[n]&&(this.lastContainerCalculations=r.instancesCalcCache[n]),this.baseCalculationParser.initialize(e,this.lastContainerCalculations);var a=e.C;(i=this.getCalcMetadata())?this.calcMetadataIt=new sr(i):this.calcMetadataIt&&this.calcMetadataIt.reset(),this.calcIt=_.size(a)>0?new sr(a):void 0}},t.prototype.restartCalcs=function(){u.assertValue(this.calcMetadataIt,"restartCalcs called before setCalculations"),u.assertAnyValue(this.calcIt,"CalcIt is created only if Calcs are not included as properties"),this.calcIt&&this.calcIt.reset(),this.calcMetadataIt.reset(),delete this.dsrCalcValue},t.prototype.nextCalc=t.prototype.calcId=t.prototype.getCalcMetadata=t.prototype.calcValue=function(){var e=this.metadata[this.calcMetadataIt.index()],r=this.context.valueDictionaryHandler.getCalcValue(this.dsrCalcValue,e.DN,e.T);return void 0===r&&(r=Ec(this.dsrCalcValue,e.T)),r},t.prototype.calcValueAsExpr=function(){var e=this;u.assert("Unexpected parsedCalcValue");var r=this.calcMetadataIt.current(),n=this.calcValue(),i=this.context.valueDictionaryHandler.getCalcValueExpr(n,this.dsrCalcValue,r.DN,r.T);return i||(i=Cc(n,this.dsrCalcValue,r.T)),i},t.prototype.calcCount=t}(),RN=function(t){function e(r,n,i){var a=t.call(this,n,1)||this;return a.parserContext=n,a.rootDataShape=i,u.assertValue(r,"dataShapes"),u.assertAnyValue(n,"parserContext"),a.it=new sr(r),a}return T(e,t),e.prototype.reset=function(){this.it.reset()},e.prototype.index=function(){return this.it.index()},e.prototype.count=function(){return this.it.count()},e.prototype.next=function(){var r;this.primaryHierarchyParser=this.secondaryHierarchyParser=this.messageParser=void 0;var n=this.it.next();if(n){var i=this.it.current();this.setCalculations(i),this.context&&(this.context.valueDictionaryHandler=new mN(i.ValueDicts||(null===(r=this.rootDataShape)||void 0===r?void 0:r.ValueDicts)))}return n},e.prototype.id=function(){return this.it.current().N},e.prototype.nestedDataShapes=function(){u.assertValue(this.context.primarySynchronizedGroups,"Reading Nested DataShapes other than Synchronized Groups ones is currently unsupported");var r=this.it.current(),n=r.DS;if(!_.isArray(n)||n.length<1)return{};for(var i={},a=function(d){var p=_.find(n,function(h){return h.N===d.dataShapeId});u.assertValue(p,"No DataShape with ID "+d.dataShapeId),p&&(i[p.N]=new e([p],d.context,o.rootDataShape||r))},o=this,s=0,l=this.context.primarySynchronizedGroups;s<l.length;s++)a(l[s]);return i},e.prototype.primaryHierarchy=function(){var r=this;if(u.assert(function(){return null!=r.parserContext},"Parser Context is needed to parse DataShape Hierarchy"),!this.primaryHierarchyParser&&this.parserContext){var n=this.it.current().PH;this.primaryHierarchyParser=n&&new Lc(n,this.parserContext,0,0)}return this.primaryHierarchyParser},e.prototype.secondaryHierarchy=function(){var r=this;if(u.assert(function(){return null!=r.parserContext},"Parser Context is needed to parse DataShape Hierarchy"),!this.secondaryHierarchyParser&&this.parserContext){var n=this.it.current().SH;this.secondaryHierarchyParser=n&&new Lc(n,this.parserContext,1,0)}return this.secondaryHierarchyParser},e.prototype.messages=e.prototype.hasRestartTokens=e.prototype.restartTokens=function(){var r=this.it.current(),n=r.DW;return _.isEmpty(n)?r.RT:(u.assert(function(){return 1===n.length},"Multiple data windows are not yet handled"),n[0].RT)},e.prototype.complete=function(){var r=this.it.current(),n=r.DW;return _.isEmpty(n)?r.IC:(u.assert(function(){return 1===n.length},"Multiple data windows are not yet handled"),n[0].IC)},e.prototype.hasAllData=function(){return this.it.current().HAD},e.prototype.limitsExceeded=e.prototype.limits=e}(tm),NN=function(){function t(e){u.assertValue(e,"limits"),this.it=new sr(e)}return t.prototype.next=function(){return this.it.next()},t.prototype.id=function(){return this.it.current().N},t.prototype.count=function(){return this.it.count()},t}(),kN=function(){function t(e){u.assertValue(e,"dataShapeMessage"),this.it=new sr(e)}return t.prototype.next=function(){return this.it.next()},t.prototype.code=function(){return this.it.current().Code},t.prototype.severity=function(){return this.it.current().Severity},t.prototype.dsrMessage=function(){return new $y(this.it.current())},t}(),Lc=function(){function t(e,r,n,i){this.context=r,this.hierarchy=n,this.depth=i,u.assertValue(e,"dataMembers"),this.it=new sr(e)}return t.prototype.count=function(){return this.it.count()},t.prototype.reset=t.prototype.next=function(){this.instancesParser&&(this.instancesParser=void 0),this.dataMemberId&&(this.dataMemberId=void 0);var e=this.it.next();if(e){var r=this.dataMemberIdCache();if(_.size(r)>0)for(var n=this.it.current(),i=0,a=r[this.depth];i<a.length;i++){var o=a[i];n[o]&&(this.dataMemberId=o)}if(void 0===this.dataMemberId){var s=Object.keys(this.it.current());1===_.size(s)?this.dataMemberId=s[0]:u.assertFail("Unexpected DataMember with multiple properties. Cannot infer DataMemberId")}}return e},t.prototype.id=function(){return this.dataMemberId},t.prototype.dataMemberIdCache=t.prototype.instances=t}(),LN=function(t){function e(r,n,i,a,o){var s=t.call(this,n,2,i)||this;return s.parentDataMemberId=i,s.hierarchy=a,s.depth=o,u.assertValue(r,"instances"),s.it=new sr(r),s}return T(e,t),e.prototype.next=function(){var r=this,n=this.it.next();if(n){var i=this.it.current();!this.context.locked&&!i.M&&1===this.hierarchy&&this.context.secondaryLeafDataMemberId.push(this.parentDataMemberId),this.setCalculations(i),this.dataMemberIt=void 0,this.intersectionParserDirty=!0,u.assert("secondary hierarchy should not have any intersections")}return n},e.prototype.count=function(){return this.it.count()},e.prototype.currentIndex=function(){return this.it.index()},e.prototype.intersections=e.prototype.restartFlagKind=function(){return this.it.current().RF},e.prototype.restartKind=e.prototype.members=e}(tm),BN=function(){function t(e,r,n){this.context=r,this.parentDataMemberId=n,u.assertValue(e,"intersections"),this.it=new sr(null),this.reset(e),this.baseCalculationParser=new em(3),this.intersectionMeasureCount=_.size(this.context.intersectionMeasureToSelectIndex),this.expectedIntersectionCount=_.size(this.context.secondaryLeafDataMemberId);var i=r.dataMemberIdToMetadata[n];this.primaryMemberIsGroupMember=1===i.kind,this.primaryDataMemberDepth=i.depth,u.assertValue(r.intersectionCalcMetadataCache,"context.intersectionCalcMetadataCache"),this.calcMetadataCache=r.intersectionCalcMetadataCache[n],!this.calcMetadataCache&&!r.locked&&(this.calcMetadataCache=r.intersectionCalcMetadataCache[n]=new Array(this.expectedIntersectionCount))}return t.prototype.reset=t.prototype.next=t.prototype.setIntersectionId=t.prototype.resetCalcIt=t.prototype.initialize=function(e){var r=this;if(u.assert(function(){return r.logicalIntersectionIndex>=0},"Unexpected call to initialize IntersectionParser"),this.resetCalcIt(e),e){var n=e.S;if(n&&!this.context.locked){void 0===this.intersectionCalcCount&&(this.intersectionCalcCount=n.length),u.assert("unexpected schema present for current logical intersection"),this.calcMetadataCache[this.logicalIntersectionIndex]=n;for(var i=this.context.calcIdToCalcMetadata,a=0,o=n;a<o.length;a++)i[o[a].N]=n}}this.calculationContainer=e;var l=this.context.lastIntersectionCalcCache[this.intersectionId];!l&&this.intersectionId&&(l=this.context.lastIntersectionCalcCache[this.intersectionId]=new Array(this.intersectionCalcCount)),this.baseCalculationParser.initialize(e,l);var c=this.getCalcMetadata();c&&(this.currentCalcMetadata=c,void 0===this.intersectionCalcCount&&(this.intersectionCalcCount=this.intersectionMeasureCount>0?this.currentCalcMetadata.length:0))},t.prototype.restartCalcs=t.prototype.nextCalc=t.prototype.calcId=t.prototype.getCalcMetadata=function(){var e=this;u.assert(function(){return e.logicalIntersectionIndex>=0},"getCalcMetadata can return metadata only for valid logical intersection");var r=this.calcMetadataCache[this.logicalIntersectionIndex];if(!r&&!this.context.locked){var n=this.getExpectedCalcId();n&&(r=this.calcMetadataCache[this.logicalIntersectionIndex]=this.context.calcIdToCalcMetadata[n])}return r},t.prototype.getExpectedCalcId=function(){if(0!==this.intersectionMeasureCount){var e=this.context,r=e.dataMemberIdToMetadata[e.secondaryLeafDataMemberId[this.logicalIntersectionIndex]],a=e.selects[this.currentCalcIndex<0?e.intersectionMeasureToSelectIndex[0]:e.intersectionMeasureToSelectIndex[this.currentCalcIndex]];if(1===r.kind&&this.primaryMemberIsGroupMember)return a.Value;if(a.Subtotal){var o=J.computeAggIdx(this.primaryDataMemberDepth,r.depth,e.maxPrimaryDepth,e.maxSecondaryDepth);return a.Subtotal.length>o&&a.Subtotal[o]}}},t.prototype.calcValue=t.prototype.parseCalcValue=function(e){var r=this.calcMetadataCache[this.logicalIntersectionIndex][this.currentCalcIndex],n=this.context.valueDictionaryHandler.getCalcValue(e,r.DN,r.T);return void 0===n&&(n=Ec(e,r.T)),n},t.prototype.calcValueAsExpr=function(){if(void 0!==this.currentCalc)return this.parseCalcValueExpr(this.currentCalc,this.calcValue());if(this.it.index()===this.logicalIntersectionIndex){var e=this.calcValue();return null===e?Rt():this.parseCalcValueExpr(this.it.current()[this.calcId()],e)}return Rt()},t.prototype.parseCalcValueExpr=function(e,r){var n=this.calcMetadataCache[this.logicalIntersectionIndex][this.currentCalcIndex],i=this.context.valueDictionaryHandler.getCalcValueExpr(r,e,n.DN,n.T);return void 0===i&&(i=Cc(r,e,n.T)),i},t.prototype.calcCount=t}(),rm=function(){function t(){}return t.prototype.initialize=t.prototype.hasBitAtPosition=function(e){if(u.assert(function(){return e>=0},"expected positive integer for position"),e>52)return!1;if(this.value>0){var r=0,n=this.value;return e<31?r=1<<e:(r=1<<e-31,n=this.overflowValue),(n&r)>0}},t.MaxSignedNumberFor32Bits=Math.pow(2,31)-1,t}(),zN=),ON=);location.search.indexOf("renderAsModalDialog"),'<input type="button" class='.concat("pbi-fluent-button","></input>");var zo="azure:values",jN={ComplexSlicerNotAllowedWithMeasures:{localizedContent:"DsrError_ComplexSlicerNotAllowedWithMeasuresValue"},ComplexHighlightsNotAllowed:{localizedContent:"DsrError_ComplexHighlightsNotAllowed_Details",localizedMessage:"DsrError_ComplexHighlightsNotAllowed_ShortMessage"},CouldNotResolveModelReferencesInSemanticQuery:{localizedMessage:"DsrError_CouldNotResolveModelRefErrorMessage",localizedTitle:"DsrError_CouldNotResolveModelRefErrorKey",localizedContent:"DsrError_CouldNotResolveModelRefErrorValNoItems",localizedContentWithAffectedItems:"DsrError_CouldNotResolveModelRefErrorValFormat",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690865"},ExclusivePercentileOutOfRange:{localizedMessage:"DsrError_ExclusivePercentileOutOfRangeMessage",localizedTitle:"DsrError_ExclusivePercentileOutOfRangeKey",localizedContent:"DsrError_ExclusivePercentileOutOfRangeValue"},InvalidDataShapeNoOutputData:{localizedContent:"DsrError_InvalidDataShapeValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690860"},InvalidUnconstrainedJoin:{localizedTitle:"DsrError_InvalidUnconstrainedJoinKey",localizedContent:"DsrError_InvalidUnconstrainedJoinValue",helpLink:"https://go.microsoft.com/fwlink/?linkid=2186131"},IsRelatedToManyNotSupportedForDetailTable:{localizedMessage:"DsrError_IsRelatedToManyNotSupportedForDetailTableMessage",localizedTitle:"DsrError_IsRelatedToManyNotSupportedForDetailTableKey",localizedContent:"DsrError_IsRelatedToManyNotSupportedForDetailTableValueNoItems",localizedContentWithAffectedItems:"DsrError_IsRelatedToManyNotSupportedForDetailTableValueFormat"},AA_PowerBIScriptPayloadTooLargeError:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=746290"},AA_PowerBIScriptResultTooLargeError:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=746291"},AA_PowerBIScriptReturnedNoImageError:{localizedMessage:"DsrError_ScriptReturnedNoImageMessage",localizedTitle:"DsrError_ScriptReturnedNoImageKey",localizedContent:"DsrError_ScriptReturnedNoImageContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=733479"},AA_PowerBIScriptRuntimeErrorError:{localizedTitle:"DsrError_ScriptRuntimeErrorKey",localizedMessage:"DsrError_ScriptRuntimeErrorMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=733477"},AA_PowerBIScriptTimeoutError:{localizedMessage:"DsrError_ScriptTimeoutMessage",localizedTitle:"DsrError_ScriptTimeoutKey",localizedContent:"DsrError_ScriptTimeoutContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=733478"},AA_PowerBIRequestsQueueOverflowError:{localizedTitle:"DsrError_RequestsQueueOverflowKey",localizedMessage:"DsrError_RequestsQueueOverflowMessage",localizedContent:"DsrError_RequestsQueueOverflowContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799576"},AA_PowerBIScriptRuntimeMaxMemoryError:{localizedTitle:"DsrError_ScriptRuntimeMaxMemoryKey",localizedMessage:"DsrError_ScriptRuntimeMaxMemoryMessage",localizedContent:"DsrError_ScriptRuntimeMaxMemoryContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799578"},AA_PowerBIScriptRuntimeMaxDiskIOError:{localizedTitle:"DsrError_ScriptRuntimeMaxDiskIOKey",localizedMessage:"DsrError_ScriptRuntimeMaxDiskIOMessage",localizedContent:"DsrError_ScriptRuntimeMaxDiskIOContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799579"},AA_PowerBIScriptMissingDependencyError:{localizedTitle:"DsrError_ScriptRuntimeMissingDependencyKey",localizedMessage:"DsrError_ScriptRuntimeMissingDependencyMessage",localizedContent:"DsrError_ScriptRuntimeMissingDependencyContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799857"},AA_PowerBIScriptSpecificPackageWithMissingDependencyError:{localizedTitle:"DsrError_ScriptRuntimeSpecificPackageWithMissingDependencyKey",localizedMessage:"DsrError_ScriptRuntimeSpecificPackageWithMissingDependencyMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=799858"},AA_PowerBIScriptSpecificPackageMissingSpecificDependencyError:{localizedTitle:"DsrError_ScriptRuntimeSpecificPackageMissingSpecificDependencyKey",localizedMessage:"DsrError_ScriptRuntimeSpecificPackageMissingSpecificDependencyMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=799859"},AA_PowerBIScriptMissingSpecificPackageError:{localizedTitle:"DsrError_ScriptRuntimeMissingSpecificPackageKey",localizedMessage:"DsrError_ScriptRuntimeMissingSpecificPackageMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=800225"},ModelMeasuresNotSupportedForDetailTable:{localizedMessage:"DsrError_ModelMeasuresNotSupportedForDetailTableMessage",localizedTitle:"DsrError_ModelMeasuresNotSupportedForDetailTableKey",localizedContent:"DsrError_ModelMeasuresNotSupportedForDetailTableValueNoItems",localizedContentWithAffectedItems:"DsrError_ModelMeasuresNotSupportedForDetailTableValueFormat"},ModelUnavailable:{localizedContent:"DsrError_ModelUnavailableValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690862"},NoUniqueKeyForDetailTable:{localizedContent:"DsrError_NoUniqueKeyForDetailTableValue"},OverlappingKeysOnOppositeHierarchies:{localizedTitle:"DsrError_OverlappingKeysKey",localizedContent:"DsrError_OverlappingKeysValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690863"},rsQueryMemoryLimitExceeded:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690864"},rsQueryTimeoutExceeded:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690864"},rsAccessDenied:{localizedMessage:"DsrError_NoPermissionMessage",localizedTitle:"DsrError_NoPermissionKey",localizedContent:"DsrError_NoAccessForVisual",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690862"},UnsupportedDateTimeLiteral:{localizedMessage:"DsrError_UnsupportedDateTimeMessage",localizedTitle:"DsrError_UnsupportedDateTimeKey",localizedContent:"DsrError_UnsupportedDateTimeValueNoItems",localizedContentWithAffectedItems:"DsrError_UnsupportedDateTimeValueFormat"},InvalidExtensionDax_UnclosedBracketIdentifier:{localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnclosedBracketIdentifier"},InvalidExtensionDax_UnexpectedCloseParenthesis:{localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnexpectedCloseParenthesis"},InvalidFilterComparisonIncompatibleExpressions:{localizedContent:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpression",localizedContentWithAffectedItems:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpressionWithAffectedItems"},InvalidFilterConditionIncompatibleDataType:{localizedContent:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpression",localizedContentWithAffectedItems:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpressionWithAffectedItems"},ExtensionMeasureEmptyExpression:{localizedContentWithAffectedItems:"DsrError_ExtensionMeasureEmptyExpression"},ExtensionMeasureNameNotUniqueModel:{localizedContentWithAffectedItems:"DsrError_ExtensionMeasureNameNotUniqueModel"},ExtensionMeasureNameNotUnique:{localizedContentWithAffectedItems:"DsrError_ExtensionMeasureNameNotUnique"},CouldNotResolveModelReferencesInQueryExtensionSchema:{localizedMessage:"DsrError_CouldNotResolveModelRefErrorMessage",localizedTitle:"DsrError_CouldNotResolveModelRefErrorKey",localizedContentWithAffectedItems:"DsrError_CouldNotResolveModelReferencesInQueryExtensionSchema"},QueryExtensionMeasureError:{localizedContentWithAffectedItemsAndPosition:"DsrError_QueryExtensionMeasureError",localizedContentWithAffectedItemsAndPositionAndDetails:"DsrError_QueryExtensionMeasureErrorWithDetails"},QueryExtensionMeasureUnexpectedEndOfUserInput:{localizedContentWithAffectedItems:"DsrError_QueryExtensionMeasureUnexpectedEndOfUserInput"},NativeVisualCalculationError:{localizedContentWithAffectedItemsAndPosition:"DsrError_NativeVisualCalculationError",localizedContentWithAffectedItemsAndPositionAndDetails:"DsrError_NativeVisualCalculationErrorWithDetails"},NativeVisualCalculationUnexpectedEndOfUserInput:{localizedContentWithAffectedItems:"DsrError_NativeVisualCalculationUnexpectedEndOfUserInput"},UnsupportedDataSourceVariables:{localizedMessage:"DsrError_UnsupportedDataSourceVariablesMessage",localizedTitle:"DsrError_UnsupportedDataSourceVariablesKey",localizedContent:"DsrError_UnsupportedDataSourceVariablesContent"},DataExtensionMissingResultSet:{localizedMessage:"DsrError_DataExtensionMissingResultSetMessage",localizedTitle:"DsrError_DataExtensionMissingResultSetKey",localizedContent:"DsrError_DataExtensionMissingResultSetContent"},ProxyModelChainLimitExceeded:{localizedTitle:"DsrError_ProxyModelChainLimitExceededErrorKey",localizedContent:"DsrError_ProxyModelChainLimitExceededErrorContent",helpLink:"https://go.microsoft.com/fwlink/?LinkID=2225640"},CannotUseMultiColumnFilteringWithMappedColumns:{localizedContent:"DsrError_DQP_CannotUseMultiColumnFilteringWithMappedColumns",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},DifferentMappingsWithinSubqueries:{localizedContent:"DsrError_DQP_DifferentMappingsWithinSubqueries",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},FilterIncompatibleWithParameter:{localizedContent:"DsrError_DQP_FilterIncompatibleWithParameter",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},FoundMultipleTargetsWithAtLeastOneMapping:{localizedContent:"DsrError_DQP_FoundMultipleTargetsWithAtLeastOneMapping",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},FoundParameterMappingOnUnsupportedFilter:{localizedContent:"DsrError_DQP_FoundParameterMappingOnUnsupportedFilter",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},InTableConditionNotSupportedWithMappedParameters:{localizedContent:"DsrError_DQP_InTableConditionNotSupportedWithMappedParameters",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},InvalidMappedParameterValueExpression:{localizedContent:"DsrError_DQP_InvalidMappedParameterValueExpression",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},MappedTargetMustMatchMappedCondition:{localizedContent:"DsrError_DQP_MappedTargetMustMatchMappedCondition",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},MixOfAssignedAndUnassignedColumnsWithinORExpression:{localizedContent:"DsrError_DQP_MixOfAssignedAndUnassignedColumnsWithinORExpression",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},MultipleParameterAssignmentsWithinORUnsupported:{localizedContent:"DsrError_DQP_MultipleParameterAssignmentsWithinORUnsupported",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},MultipleParameterMappingsUnsupported:{localizedContent:"DsrError_DQP_MultipleParameterMappingsUnsupported",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},ParameterMappingFilterConflict:{localizedContent:"DsrError_DQP_ParameterMappingFilterConflict",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},ParameterMappingsFoundWithinFilteredEvalExpressionFilter:{localizedContent:"DsrError_DQP_ParameterMappingsFoundWithinFilteredEvalExpressionFilter",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},ParameterMappingsNotSupportedOnHighlights:{localizedContent:"DsrError_DQP_ParameterMappingsNotSupportedOnHighlights",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},SingleValueParameterWithMultipleValues:{localizedContent:"DsrError_DQP_SingleValueParameterWithMultipleValues",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},FabricThrottled:{localizedContent:"FabricCapacityThrottledErrorContent",helpLink:"https://aka.ms/capacitymessages"}},WN=function(){eturn Object.defineProperty(t,"maxNumberOfCommaValues",{get:function(){return 9},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.oDataCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oDataErrorMessage",{get:enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){switch(this.oDataError.source){case"PowerBI":return"PowerBI";case"External":return"External";case"Unknown":return;case"User":return t.isCodeKnown(this.code)?"User":void 0}u.assertFail("unknown DsrClientError source: ".concat(this.oDataError.source))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AdditionalErrorMessages",{get:function(){if(this.oDataError){var r=this.oDataError[zo];if(!_.isEmpty(r))for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!_.isEmpty(a.additionalMessages))return a.additionalMessages}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"powerBiErrorDetails",{get:enumerable:!1,configurable:!0}),t.prototype.getDetails=t.getErrorDetailsFromStatusCode=function(e,r,n,i,a){var o=a.get("DsrError_Key"),s=a.get("DsrError_UnknownErrorValue"),l=a.get("DsrError_Message"),c="https://support.powerbi.com",f=jN[e];f&&(o=f.localizedTitle?a.get(f.localizedTitle):o,s=t.getContent(e,n,i,f,a)||s,l=f.localizedMessage?a.get(f.localizedMessage):l,c=f.helpLink||c,f.useODataErrorMessageAsContent&&(s=r||l));var p={message:l,displayableErrorInfo:[{errorInfoKey:o,errorInfoValue:s}],helpLink:c,debugErrorInfo:[]};return!f&&e&&p.debugErrorInfo.push({errorInfoKey:Kv,errorInfoValue:e}),(!f||!f.useODataErrorMessageAsContent)&&r&&p.debugErrorInfo.push({errorInfoKey:"OData Error Message",errorInfoValue:r}),p},t.getContent=function(e,r,n,i,a){if(i.localizedContentWithAffectedItemsAndPosition||i.localizedContentWithAffectedItemsAndPositionAndDetails){var o=t.findAdditionalMessageWithAffectedItemsAndPosition(e,n);if(i.localizedContentWithAffectedItemsAndPositionAndDetails&&r&&o)return Ne(a.get(i.localizedContentWithAffectedItemsAndPositionAndDetails),Fs(o.AffectedItems,a,t.maxNumberOfCommaValues),qe.formatValue(o.Line),qe.formatValue(o.Position),r);if(i.localizedContentWithAffectedItemsAndPosition&&o)return Ne(a.get(i.localizedContentWithAffectedItemsAndPosition),Fs(o.AffectedItems,a,t.maxNumberOfCommaValues),qe.formatValue(o.Line),qe.formatValue(o.Position))}if(i.localizedContentWithAffectedItems){var s=t.getAffectedItemsFromStatusCode(e,n);if(s.length>0)return Ne(a.get(i.localizedContentWithAffectedItems),Fs(s,a,t.maxNumberOfCommaValues))}if(i.localizedContent)return a.get(i.localizedContent)},t.findAdditionalMessageWithAffectedItemsAndPosition=t.getAffectedItemsFromStatusCode=t.prototype.parseCode=t.isCodeKnown=function(e){return t.isGeneralKnownErrorCode(e)||t.isDynamicQueryParameterErrorCode(e)},t.isGeneralKnownErrorCode=t.isDynamicQueryParameterErrorCode=t}();nction hn(t,e){u.assertValue(t,"node");var r=t.values;r||(r=t.values={});var n=r[e];return n||(n=r[e]={}),n}function im(t,e,r,n){u.assertValue(t,"context"),u.assertValue(r,"dataShape"),u.assertValue(n,"metadata"),u.assert("context.includes(StandardDataViewKinds.Matrix)");var i=oi("DSR.matrix(".concat(t.perfId,")")),a=[],o=[],s=[];!function(t,e,r,n,i){u.assertValue(i,"metadataColumns");for(var a=t.selects,o=0,s=a.length;o<s;o++){var l=a[o];if(l){var c=$N(t,i,o);if(l.Kind===Z.Measure)n.push(c);else if(null!=l.Depth){var f=e[l.Depth];null!=f?f.sources.push(c):e[l.Depth]=Bc([c])}else if(null!=l.SecondaryDepth){var d=r[l.SecondaryDepth];null!=d?d.sources.push(c):r[l.SecondaryDepth]=Bc([c])}l.DynamicFormat&&l.DynamicFormat.Format&&(u.assertValue(c.formatSource&&c.formatSource.formatString,"metadataColumn.formatSource.formatString"),n.push(c.formatSource.formatString))}}var p=n.length;(p>1||p>0&&(0===e.length||0===r.length))&&r.push(Bc(n))}(t,a,o,s,n.columns);var l=[],c=function(t,e,r,n,i,a){if(!i.SecondaryHierarchy||0===i.SecondaryHierarchy.length){var o={};return zc(o,r,0,!1),o}var s;n&&n.Secondary&&(s=n.Secondary.Groupings);var l=sm(t,e,i.SecondaryHierarchy,s,function(c,f,d,p,h){if(h<e.length)if(p.isSubtotal){var v=e.length-1,g=e[v].sources.length;g>1&&zc(p,g,v,!0)}else u.assert("We only support one extra level in the column hierarchy (for measures)"),zc(p,e[h].sources.length,h,!1);a.push(am(p)),t.stats.secondary++});return l}(t,o,s.length,e,r,l),f=function(t,e,r,n,i){if(n.PrimaryHierarchy&&0!==n.PrimaryHierarchy.length){var a;r&&r.Primary&&(a=r.Primary.Groupings);var o=0,s=0;r&&(o=om(r.Primary),s=om(r.Secondary));var l=_.filter(t.selects,,c=sm(t,e,n.PrimaryHierarchy,a,function(f,d,p,h,v){(function(t,e,r,n,i,a,o){u.assertValue(r,"instance"),u.assertValue(n,"node"),u.assertValue(i,"intersectionToSecondaryAggIdx");var s=r.Intersections,l={index:0};if(s)for(var c=0,f=s.length;c<f;c++)s[c].Calculations&&lm(t,e,s[c].Calculations,n,l,i[c],a,o);else lm(t,e,r.Calculations,n,l,0,a,o)})(d,l,p,h,i,o,s),f.stats.primary++});return c}}(t,a,e,r,l),h={rows:{root:f,levels:a},columns:{root:c,levels:o},valueSources:s};return i(),h}function Bc(t){u.assertValue(t,"metadataColumns");for(var e={sources:[]},r=0,n=t.length;r<n;r++)e.sources.push(t[r]);return e}function $N(t,e,r){u.assertValue(e,"metadataColumns");for(var n=0,i=e.length;n<i;n++){var a=e[n];if(a&&a.index===r&&void 0===a.groupName)return a}return t.createColumns(e,r)}function am(t){return u.assertValue(t,"node"),t.isSubtotal?t.level:t.level+1}function om(t){return u.assertAnyValue(t,"axis"),t&&t.Groupings?t.Groupings.length:0}unction sm(t,e,r,n,i){u.assertValue(t,"context");var a={};return um(t,e,a,r,n,0,i),a}function um(t,e,r,n,i,a,o){if(u.assertValue(t,"context"),u.assertValue(r,"node"),u.assertValue(a,"depth"),n)for(var s=t.selects,l=function(t,e){u.assertAnyValue(t,"levelSources"),u.assertValue(e,"depth");var r=[],n=t&&t[e]&&t[e].sources;if(!_.isEmpty(n))for(var i=0,a=n.length;i<a;i++){var o=n[i];u.assertValue(o.index,"pre-condition: sourceMetadataColumn.index is defined"),r[o.index]=i}return r}(e,a),c=0,f=n.length;c<f;c++)for(var d=n[c],p=0,h=0,v=d.Instances.length;h<v;h++){var g=d.Instances[h];if(0===p&&4===(p=nk(s,i,a,d,g)))break;var y={level:a};if(r.children||(r.children=[]),r.children.push(y),1===p){var m=rk(s,g.Calculations,l);if(!_.isEmpty(m)){y.levelValues=m;var S=_.last(m);y.value=S.value,S.levelSourceIndex>0&&(y.levelSourceIndex=S.levelSourceIndex)}}else 3===p&&(y.isSubtotal=!0);g.RestartFlag&&1===g.RestartFlag&&(y.isMerge=!0),i&&1===p&&(r.childIdentityFields=t.readKeys(i,a),y.identity=t.readIdentity(i,g,a));var E=g.Members;E&&E.length>0?um(t,e,y,E,i,a+1,o):o&&o(t,p,g,y,a+1)}}function rk(t,e,r){u.assertValue(t,"selects"),u.assertValue(e,"calculations"),u.assertNonEmpty(r,"selectIndexToLevelSourceIndexMapping should be non-empty for dynamic groups");for(var n,i=0,a=t.length;i<a;i++){var o=t[i];if(o&&o.Value&&o.Kind===Z.Group){var s=J.findAndParseCalculation(e,o.Value);void 0!==s&&(n||(n=[]),n.push({levelSourceIndex:r[i],value:s}))}}return n}function nk(t,e,r,n,i){if(u.assertValue(t,"selects"),u.assertValue(n,"member"),e&&e.length>r&&null!=n.Id){var a=e[r];if(n.Id===a.Member)return 1;if(n.Id===a.SubtotalMember)return 3}var o=i.Calculations;if(o){for(var s=!1,l=0,c=t.length;l<c;l++){var f=t[l];if(f&&J.findCalculation(o,f.Value)){if(f.Kind===Z.Group)return 1;!s&&f.Kind===Z.Measure&&(s=!0)}}if(s)return 2}return 4}function lm(t,e,r,n,i,a,o,s){if(u.assertValue(e,"selects"),u.assertValue(n,"node"),r)for(var l={index:0},c=function(h,v){var g=e[h];u.assert(function(){return g.Kind===Z.Measure},"measureSelects is expected to have measure select bindings only");var y=g.Highlight,S=y&&y.DynamicFormat&&y.DynamicFormat.Format;if(cm(t,r,n,i,l,a,o,s,0,g.Value,y&&y.Value,g.Subtotal),g.DynamicFormat&&g.DynamicFormat.Format){var E=_.map(g.SubtotalDynamicFormat,function(C){return C&&C.Format});cm(t,r,n,i,l,a,o,s,0,g.DynamicFormat.Format,S,E)}},f=0,d=e.length;f<d;f++)c(f)}function cm(t,e,r,n,i,a,o,s,l,c,f,d){u.assertValue(i,"measureIndex");var p=hn(r,n.index),h=null;if(3!==t&&(h=J.findAndParseCalculation(e,c)),null==h){var g=function(t,e,r,n,i,a){if(e){var o=J.computeAggIdx(r,n,i,a);if(o<e.length)return J.findAndParseCalculation(t,e[o])}}(e,d,am(r),a,o,s);void 0!==g&&(h=g)}f&&(p.highlight=J.findAndParseCalculation(e,f)),p.value=h,i.index>0&&(p.valueSourceIndex=i.index),n.index++,i.index++}var ok=function(){function t(e){u.assertValue(e,"context"),this._context=e}return t.prototype.read=function(e,r,n){var i=this;u.assertValue(r,"dataShape");var a={metadata:{columns:[]}};return n.script=We(function(){if(r.PrimaryHierarchy&&r.PrimaryHierarchy.length>0){var o=r.PrimaryHierarchy[0];if(o&&o.Instances.length>0){var f=J.findCalculation(o.Instances[0].Calculations,i._context.scriptVisualBinding.PayloadCalculationId||i._context.scriptVisualBinding.ImageCalculationId);if(f){var p=function(t){return t&&_.startsWith(t,yy)?t.substring(yy.length,t.length-1):null}(f.Value);p&&(a.scriptResult={payloadBase64:p})}}}}),a},t}(),fm=function(){function t(e){u.assertValue(e,"context"),this.context=e}return t.prototype.read=function(e,r,n){var i=this;u.assertValue(r,"dataShape");var a=this.context,o=this.readMetadata(r.IsComplete),s={metadata:o},l=a.includes(16),c=a.includes(1),f=a.includes(4),d=a.includes(8);if(l||c||f||d){var p,h=We(function(){p=i.parseTree(o.columns,e,r),u.assertValue(p,"root")});l&&(n.tree=h+We(function(){var v=i.createTree(o,p);v&&(s.tree=v)})),c&&(n.categorical=h+We(function(){var v=i.categorize(o,p);v&&(s.categorical=v)})),f&&(n.single=h+We(function(){var v=i.createSingleValue(o,p);v&&(s.single=v)})),d&&(n.table=h+We()}return a.includes(2)&&(n.matrix=We(function(){var v=im(i.context,e,r,s.metadata);v&&(s.matrix=v)})),s},t.prototype.readMetadata=t.prototype.parseTree=function(e,r,n){var i=oi("DSR.tree(".concat(this.context.perfId,")")),a={},o=this.context.selects;this.parseRootAggregates(e,a);var s=J.getTopLevelPrimaryDynamicMember(n,r,!0);if(s){var l=n.PrimaryHierarchy[0];s!==l&&this.parseValues(o,a,t.getFirstInstanceCalcs(l));var c=void 0;r&&r.Primary&&(c=r.Primary.Groupings),this.parseRecursive(a,s,c,0,e)}else _.isEmpty(n.PrimaryHierarchy)||this.parseValues(o,a,t.getFirstInstanceCalcs(n.PrimaryHierarchy[0]));return i(),a},t.prototype.parseRecursive=function(e,r,n,i,a){u.assertValue(e,"node"),u.assertValue(r,"dynamicMember"),u.assertValue(i,"depth"),u.assertAnyValue(a,"columns");var c,o=this.context,s=r.Instances,l=s.length;l&&(e.children=[],0===i&&(c=ck.create(e,o))),n&&(e.childIdentityFields=o.readKeys(n,i));for(var f=0;f<l;f++){var d=s[f],p={};e.children.push(p),d.RestartFlag&&1===d.RestartFlag&&(p.isMerge=!0),this.parseValues(o.selects,p,d.Calculations,c),n&&(p.identity=o.readIdentity(n,d,i));var h=d.Members;if(this.parseAggregates(o.selects,p,d.Calculations,h,i+1),!_.isEmpty(h)){var v=J.getDynamicMember(h,n,i+1);v&&this.parseRecursive(p,v,n,i+1)}}c&&c.complete(a)},t.getFirstInstanceCalcs=function(e){u.assertValue(e,"member");var r=e.Instances;return r.length>0?r[0].Calculations:null},t.prototype.parseRootAggregates=function(e,r){u.assertValue(e,"columns"),u.assertValue(r,"node");for(var n=0,i=e.length;n<i;n++){var o=e[n].aggregates;o&&J.copyAggregates(o,hn(r,n))}},t.prototype.parseAggregates=function(e,r,n,i,a){u.assertValue(e,"selects"),u.assertValue(r,"node"),u.assertAnyValue(n,"calculations"),u.assertAnyValue(i,"allMembers");for(var o=0,s=e.length;o<s;o++){var l=e[o];if(l){var c=dm(l,n,i,a);c&&J.copyAggregates(c,hn(r,this.context.selectIndexToColumnIndexMap[o]))}}},t.prototype.parseValues=function(e,r,n,i){if(u.assertValue(e,"selects"),u.assertValue(r,"node"),u.assertAnyValue(n,"calculations"),!_.isEmpty(n))for(var a=0,o=0,s=e.length;a<s;a++){var l=e[a];if(l){if(l.Value&&void 0!==(c=J.findAndParseCalculation(n,l.Value))&&(l.Kind===Z.Group?r.name=c:(r.value=c,i&&i.add(o,c)),hn(r,o).value=c),l.Highlight){var f=J.findAndParseCalculation(n,l.Highlight.Value);void 0!==f&&(hn(r,o).highlight=f)}if(o++,l.DynamicFormat&&l.DynamicFormat.Format){var c=J.findAndParseCalculation(n,l.DynamicFormat.Format);hn(r,o).value=c,o++}}}},t.prototype.categorize=function(e,r){if(u.assertValue(e,"metadata"),!this.canCategorize())return null;for(var a,n=oi("DSR.categorical(".concat(this.context.perfId,")")),i={},o=0,s=e.columns.length;o<s;o++){var l=e.columns[o];if(void 0!==l.index){if(!l.isMeasure){a||(a=[]),a.push({columnIndex:o,metadataColumn:l});continue}var c={source:l,values:[]},f=l.aggregates;f&&J.copyAggregates(f,c),i.values||(i.values=Ar()),i.values.push(c)}}if(a){i.categories=[];for(var d=void 0,p=0,h=a.length;p<h;p++){var v=a[p],g=r.children,y={source:v.metadataColumn,values:[]};if(g)for(var m=0,S=g.length;m<S;m++){var E=g[m];y.values.push(E.values[v.columnIndex].value),0===p&&(this.writeCategoricalValues(e,E,i.values),E.identity&&(d||(d=[]),d.push(E.identity))),E.isMerge&&(i.lastMergeIndex=m)}d&&(y.identity=d),r.childIdentityFields&&(y.identityFields=r.childIdentityFields),i.categories.push(y)}}else this.writeCategoricalValues(e,r,i.values);return n(),i},t.prototype.canCategorize=t.prototype.createTree=function(e,r){var n=this.context;if(!(2&n.actionHistory||1&n.actionHistory))return{root:r};var i=fe(r),a=e.columns,o=r.values;if(o){for(var s={},l=0;l<a.length;l++){var c=a[l];void 0!==c.index&&void 0!==o[l]&&(s[c.index]=o[l])}i.values=s}var f=r.children;return f&&(i.children=this.removeFormatSourceFromTreeChildren(a,f)),{root:i}},t.prototype.removeFormatSourceFromTreeChildren=function(e,r){for(var n=r.length,i=_.map(r,function(d){return d}),a=0;a<n;a++){var o=fe(i[a]);i[a]=o;for(var s={},l=0;l<e.length;l++){var c=e[l];void 0!==c.index&&void 0!==i[a].values[l]&&(s[c.index]=i[a].values[l])}i[a].values=s;var f=i[a].children;f&&(i[a].children=this.removeFormatSourceFromTreeChildren(e,f))}return i},t.prototype.createTable=function(e,r){u.assertValue(e,"metadata");for(var n,i=this.context.selects,a=0,o=i.length;a<o;a++)if(i[a]){var l=i[a].Depth;l>=0&&(n=Math.max(l,n||0))}if(n>0)return null;var f,h,c=oi("DSR.table(".concat(this.context.perfId,")")),d=[],p=e.columns.length;if(n>=0){var v=r.children;if(v){a=0;for(var g=v.length;a<g;a++){var y=v[a];this.toTableRow(y,p,d),y.isMerge&&(f=a),y.identity&&(h||(h=[]),h.push(y.identity))}}}else u.assert("groups.length=0"),this.toTableRow(r,p,d);var m=this.toTotals(r,p),S={rows:d,columns:e.columns};return h&&(S.identity=h),r.childIdentityFields&&(S.identityFields=r.childIdentityFields),m&&(S.totals=m),f>=0&&(S.lastMergeIndex=f),c(),S},t.prototype.toTableRow=t.prototype.toTotals=t.prototype.writeCategoricalValues=t.prototype.createSingleValue=function(e,r){if(u.assertValue(e,"metadata"),u.assertValue(r,"root"),r.values){for(var n=e.columns,i=null,a=void 0,o=0,s=n.length;o<s;o++)if(n[o].isMeasure&&null!=n[o].index){if(i)return null;i=n[o],a=o}if(!i)return null;var l=r.values[a];if(!l)return null;var c=0===fc(e.columns)?l.value:l.subtotal;return void 0===c?null:{column:i,value:c}}return null},t}(),sk=function(){function t(e){u.assertValue(e,"context"),this._context=e,this._categoriesMetadata=[],this._primaryMeasureSelects=[],this._measureSelects=[],this._secondarySelects=[],this._seriesColumn=null}return t.prototype.read=function(e,r,n){var i=this;u.assertValue(r,"dataShape");var a=this._context,o={metadata:this.readMetadata(r.IsComplete)};return a.includes(1)&&(n.categorical=We(),a.includes(2)&&(n.matrix=We(),o},t.prototype.readMetadata=function(e){for(var r={columns:[]},n=this._context,i=n.selects,a=function(f,d){var p=i[f];if(!p)return"continue";if(p.Kind===Z.Measure)return 0===p.Depth?o._primaryMeasureSelects.push(p):o._measureSelects.push(p),"continue";u.assert(function(){return p.Kind===Z.Group},"Unexpected Select.Kind");var h=n.createColumns(r.columns,f);p.SecondaryDepth>=0?(o._secondarySelects.push(p),o._secondaryDepth=Math.max(o._secondaryDepth||0,p.SecondaryDepth),o._seriesColumn=h):0===p.Depth&&o._categoriesMetadata.push({select:p,column:h})},o=this,s=0,l=i.length;s<l;s++)a(s);return e||(r.segment={}),r},t.prototype.categorize=function(e,r,n){if(u.assertValue(e,"dataShape"),u.assertValue(r,"metadata"),0!==this._secondaryDepth||0===this._categoriesMetadata.length)return null;var a,o,i=oi("DSR.categorical(".concat(this._context.perfId,", secondary)"));n&&(n.Primary&&(a=n.Primary.Groupings),n.Secondary&&(o=n.Secondary.Groupings));var s=J.getTopLevelSecondaryDynamicMember(e,n),l=this.readColumnsFromSecondary(s,r,o,e.Calculations),c=J.getTopLevelPrimaryDynamicMember(e,n),f=this.readCategoriesAndValues(c,r,l,a),d={categories:f.categories,values:l};return void 0!==f.lastMergeIndex&&(d.lastMergeIndex=f.lastMergeIndex),i(),d},t.prototype.readColumnsFromSecondary=function(e,r,n,i){u.assertValue(e,"secondaryMember"),u.assertValue(r,"metadata");var a,o=this._context;n&&(a=o.readKeys(n,0));var s=[],l=o.selects,c=this._measureSelects.length,f=[],d=e.Instances,p=d.length;if(p)for(var h=0;h<p;h++){var v=d[h],g=v.Calculations,y=void 0;n&&(y=o.readIdentity(n,v,0));for(var m=0,S=this._secondarySelects.length;m<S;m++){for(var C=J.findAndParseCalculation(g,this._secondarySelects[m].Value),b=[],V=0;V<c;V++){var w=l.indexOf(x=this._measureSelects[V]),D=o.createColumns(r.columns,w,!0);void 0!==C&&(D.groupName=C);var A={source:D,values:[]};y&&(A.identity=y),this.addColumnAggregates(i,x,A),s.push(A),b.push(A)}f.push({identity:y,name:C,values:b})}}else{for(V=0;V<c;V++){var x;w=l.indexOf(x=this._measureSelects[V]),D=o.createColumns(r.columns,w),this.addColumnAggregates(i,x,A={source:D,values:[]}),s.push(A)}f.push({values:me([],s||[],!0)})}V=0;for(var I=this._primaryMeasureSelects.length;V<I;V++)w=l.indexOf(this._primaryMeasureSelects[V]),D=o.createColumns(r.columns,w),s.push(A={source:D,values:[]});a&&(s.identityFields=a);var R=this._seriesColumn;return R&&(s.source=R),s.grouped=function(){return f},s},t.prototype.addColumnAggregates=function(e,r,n){e&&(r.Max&&(n.max=J.findAndParseCalculation(e,r.Max[0])),r.Min&&(n.min=J.findAndParseCalculation(e,r.Min[0])))},t.prototype.readCategoriesAndValues=function(e,r,n,i){u.assertValue(e,"primaryMember"),u.assertValue(n,"values");for(var l,a=[],o=this._categoriesMetadata,s=o.length,c=this._context,f=0;f<s;f++)a.push(d={source:o[f].column,values:[]}),i&&(l||(l=[]),d.identity=l,d.identityFields=c.readKeys(i,0));for(var v,p=e.Instances,h=this._primaryMeasureSelects,g=(f=0,p.length);f<g;f++){var y=p[f];1===y.RestartFlag&&(v=f);for(var m=0;m<s;m++){var d;(d=a[m]).values.push(J.findAndParseCalculation(y.Calculations,o[m].select.Value))}l&&l.push(c.readIdentity(i,y,0));for(var S=y.Intersections,E=0,C=0,b=S.length;C<b;C++)for(var V=S[C].Calculations,x=0,w=this._measureSelects.length;x<w;x++)if(void 0!==(A=J.findAndParseCalculation(V,(D=this._measureSelects[x]).Value))&&((I=n[E++]).values.push(A),D.Highlight)){I.highlights||(I.highlights=[]);var F=J.findAndParseCalculation(V,D.Highlight.Value);I.highlights.push(F)}for(C=0,b=h.length;C<b;C++){var D,I,A=J.findAndParseCalculation(V=y.Calculations,(D=h[C]).Value);if((I=n[E++]).values.push(A),D.Highlight){I.highlights||(I.highlights=[]);var R=J.findAndParseCalculation(V,D.Highlight.Value);I.highlights.push(R)}}}return{categories:a,lastMergeIndex:v}},t}(),uk=function(){function t(e,r,n,i){u.assertValue(e,"targets"),u.assert(function(){return null!=r.Select||null!=r.ScriptVisualBinding},"descriptor"),u.assertAnyValue(n,"perfId"),u.assertValue(i,"aggregateReader"),this.targets=e,this.selects=r.Select,this.scriptVisualBinding=r.ScriptVisualBinding,this.perfId=n||"",this.stats={id:n||void 0,primary:0,secondary:0},this.aggregateReader=i,this.cacheItems=[],this.selectIndexToColumnIndexMap={}}return t.prototype.createColumns=t.prototype.columnMetadata=function(e,r,n){u.assertValue(e,"selectIndex"),u.assertAnyValue(n,"suppressAggregates");var i=this.selects[e];u.assertValue(i,"select");var a={displayName:"",index:e};if(i.Format&&(a.format=i.Format),a.type=J.describeDataType(i.Type,i.DataCategory),i.Kind===Z.Measure&&(a.isMeasure=!0),!n){var o=this.aggregateReader.compute(i,r);o&&(a.aggregates=o)}var s=i.GroupKeys;if(s)for(var l=a.identityExprs=[],c=0,f=s;c<f.length;c++){var p=this.convertKey(f[c]);l.push(p)}return this.selectIndexToColumnIndexMap[e]=r,a},t.prototype.tryCreatingDynamicFormatColumnMetadata=function(e,r,n,i){var a=this.selects[e];if(a.DynamicFormat&&a.DynamicFormat.Format){var o={displayName:"",isMeasure:!0};n.formatSource={formatString:o};var s={Kind:Z.Measure,Subtotal:_.map(a.SubtotalDynamicFormat,function(c){return c&&c.Format})};if(!i){var l=this.aggregateReader.compute(s,r);l&&(o.aggregates=l)}return this.actionHistory|=2,o}},t.prototype.readIdentity=function(e,r,n){u.assertValue(e,"axisGroupings"),u.assertValue(n,"depth");for(var a,i=this.readKeys(e,n),o=e[n].Keys,s=0,l=o.length;s<l;s++){var c=o[s],d=J.findAndParseCalculationToSQExpr(r.Calculations,c.Calc||this.selects[c.Select].Value);a=it(a,Tn(i[s],d))}return mt(a)},t.prototype.readKeys=function(e,r){u.assertValue(e,"axisGroupings"),u.assertValue(r,"depth");var n=this.getAxisCache(e),i=n.exprs[r];if(void 0===i){i=n.exprs[r]=[];for(var a=e[r].Keys,o=0,s=a.length;o<s;o++)i.push(this.convertKey(a[o]))}return i},t.prototype.includes=function(e){return u.assertValue(e,"kind"),ee(this.targets,e)},t.prototype.getAxisCache=function(e){u.assertValue(e,"axisGroupings");for(var r=this.cacheItems,n=0,i=r.length;n<i;n++){var a=r[n];if(a.axisGroupings===e)return a}var o={axisGroupings:e,exprs:[]};return r.push(o),o},t.prototype.convertKey=function(e){u.assertValue(e,"key");var r=e.Source;return Ie(Ge(Qy(r),r.Entity||r.EntitySet),r.Property)},t}(),lk=function(){function t(e,r){u.assert(function(){return null!=e.Select||null!=e.ScriptVisualBinding},"descriptor"),u.assertValue(r,"dataShape"),this.dataShape=r}return t.prototype.compute=function(e,r,n){u.assertValue(r,"columnIndex");var i=this.cache;if(i){var a=i[r];if(a)return a}if(e){i||(this.cache=i={});var o=this.dataShape,s=dm(e,o.Calculations,o.PrimaryHierarchy,0);return n&&!s&&(s={}),i[r]=s,s}},t.prototype.updateAggregates=function(e,r,n,i){u.assertValue(e,"select"),u.assertValue(r,"columnIndex"),u.assertValue(n,"name"),u.assertAnyValue(i,"value");var a=this.compute(e,r,!0);if(a)return a[n]=i,a},t}();function dm(t,e,r,n){u.assertValue(t,"select"),u.assertAnyValue(e,"calculations"),u.assertAnyValue(r,"allMembers"),u.assertValue(n,"depth");var i=!_.isEmpty(r)&&fm.getFirstInstanceCalcs(r[0]);if(!_.isEmpty(e)||!_.isEmpty(i)){var a;if(!_.isEmpty(i)&&t.Subtotal&&(o=t.Subtotal[n])&&void 0!==(s=J.findAndParseCalculation(i,o))&&(a||(a={}),a.subtotal=s),!_.isEmpty(e)){t.Max&&(o=t.Max[n])&&void 0!==(s=J.findAndParseCalculation(e,o))&&(a||(a={}),a.max=s),t.Min&&(o=t.Min[n])&&void 0!==(s=J.findAndParseCalculation(e,o))&&(a||(a={}),a.min=s),t.Count&&(o=t.Count[n])&&void 0!==(s=J.findAndParseCalculation(e,o))&&(a||(a={}),a.count=s);var l=t.Aggregates;if(l)for(var c=0,f=l;c<f.length;c++){var o,s,d=f[c],p=d.Aggregate;if((o=d.Ids[n])&&void 0!==(s=J.findAndParseCalculation(e,o))){var h=p.Percentile;if(h){var v={k:h.K,value:s};h.Exclusive&&(v.exclusive=h.Exclusive),a||(a={});var g=a.percentiles;g||(g=a.percentiles=[]),g.push(v)}else p.Average?(a||(a={}),a.average=s):p.Median&&(a||(a={}),a.median=s)}}0===n&&(o=t.Value)&&void 0!==(s=J.findAndParseCalculation(e,o))&&(a||(a={}),a.single=s)}return a}}var ck=function(){function t(e,r,n,i){u.assertValue(e,"node"),u.assertValue(r,"aggregateReader"),u.assertValue(i,"aggregators"),this.node=e,this.aggregateReader=r,this.selects=n,this.aggregators=i}return t.create=function(e,r){for(var n=e.values,i=r.selects,a=!1,o={},s=0,l=0,c=i.length;s<c;s++){var f=i[s];if(f){if(f.Kind!==Z.Measure){l++;continue}var p=void 0,h=void 0;if(n&&(h=n[l])){if(p=[],void 0===h.min&&p.push(new Rc),void 0===h.max&&p.push(new Pc),0===p.length){l++;continue}}else p=[new Rc,new Pc];o[l]=p,a=!0,l++,f.DynamicFormat&&f.DynamicFormat.Format&&l++}}if(a)return new t(e,r.aggregateReader,r.selects,o)},t.prototype.add=t.prototype.complete=function(e){u.assertValue(e,"columns");for(var r=this.aggregators,n=this.node,i=this.aggregateReader,a=0,o=0,s=this.selects.length;a<s;a++){var l=this.selects[a];if(l){var c=r[o];if(!c){o++;continue}for(var f=0,d=c.length;f<d;f++){var p=c[f],h=p.value();if(void 0!==h){var v=p.name;hn(n,o)[v]=h,e[o].aggregates=i.updateAggregates(l,o,v,h)}}o++,l&&l.DynamicFormat&&l.DynamicFormat.Format&&o++}}},t}();function Oc(t){if(u.assertAnyValue(t,"dsr"),2===t.Version)return!0}function dk(t,e,r,n,i,a){if(u.assertValue(e,"arg"),!e)return null;var o;e.data&&(e=e.data),a&&a.isRunning()&&(o=a.createChildActivity({name:"Parse Query Result"}));var s={},l=e,c=Mt();_.isString(e)&&(s.dsrLength=e.length,s.jsonParse=We(,o&&o.setProperty("metrics",{jsonParse:s.jsonParse}));var f=function(t,e,r,n,i,a,o,s,l,c,f,d,p,h,v){if(!r)return null;var g,y;if(s||(s={}),4&t&&(t|=8),Oc(r)){if(y="dsr2-read",performance&&performance.mark&&performance.mark(y+"-start"),s.mode="V2",1!==_.size(r.DS))return null;var m=function(t){var e=t.Select,r=t.Expressions,n=r&&r.Primary,i=n&&n.Groupings,a=n&&n.Synchronization,o=r&&r.Secondary&&r.Secondary.Groupings,s={},l=i&&[],c=o&&[];if(i)for(var f=0,d=i.length;f<d;f++)Nc(s,i[f],f,l,e);if(o)for(f=0,d=o.length;f<d;f++)c[f]=[],Nc(s,o[f],f,c,e);var p=0,h=[];if(e&&o)for(f=0;f<e.length;f++){var v=e[f];v&&v.Kind===Z.Measure&&null==v.Depth&&null==v.SecondaryDepth&&(h[p++]=f)}var g={intersectionMeasureToSelectIndex:h,secondaryLeafDataMemberId:o&&[],dataMemberIdToMetadata:s,selects:e,maxPrimaryDepth:_.size(i),maxSecondaryDepth:_.size(o),memberInstanceCalcMetadataCache:{},calcIdToCalcMetadata:{},intersectionCalcMetadataCache:{},primaryDataMemberIdCache:l,secondaryDataMemberIdCache:c,instancesCalcCache:{},lastIntersectionCalcCache:{},locked:!1};if(a){var y=a.length;for(g.primarySynchronizedGroups=new Array(y),f=0;f<y;f++){var m=a[f],S=_.last(m.Groupings);g.primarySynchronizedGroups[f]={groupings:m.Groupings,dataShapeId:m.DataShape,synchronizationIndexCalcId:i[S].SynchronizationIndex,context:EN(t,m)}}}return g}(e),S=Zy(r,m);g=function(t,e,r,n,i){var a={columns:t.createDataViewMetadataColumns()},o={dataView:{metadata:a}};if(function(t,e){t.reset();var r=t.dataShapes();u.assert(function(){return 1===r.count()},"DSR has multiple DataShapes"),r.next(),r.complete()||(e.dataView.metadata.segment={},e.restartToken=r.restartTokens())}(e,o),t.includes(2)){var s,l=We(;s&&(r.matrix=l)}if(t.includes(1)){var c,f=We(;c&&(r.categorical=f)}if(t.includes(8)){var d,p=We(;d&&(r.table=p)}if(t.includes(16)){var h,v=We(;h&&(r.tree=v)}if(t.includes(4)){var g,y=We(;g&&(r.single=y)}return o}(new kc(t,e,m,h,S.dataShapes()),S,s,0,h),S.reset();var C=S.dataShapes(),b=C.next();if(u.assert(function(){return b},"There must be a DataShape"),C.limitsExceeded()){g.warnings||(g.warnings=[]);var V=new Jy(e,C),C));g.warnings.push(V),nm(g.dataView,V.limits)}(function(t,e){var r=t.messages();if(r)for(;r.next();)Bo[r.code()]&&r.severity()===Yy(0)&&(e.warnings||(e.warnings=[]),e.warnings.push(r.dsrMessage()))})(C,g),g.dataView&&!_.isEmpty(a)&&(qy(g.dataView,a),g.disallowPersisting=!0)}else y="dsr1-read",performance&&performance.mark&&performance.mark(y+"-start"),s.mode="V1Old",g=function(t,e,r,n,i,a,o){if(u.assertValue(t,"targets"),u.assertAnyValue(e,"descriptor"),u.assertValue(r,"dsr"),u.assertAnyValue(a,"clientSideFilters"),!r))return null;var s=r.DataShapes[0];if(s["odata.error"]){var c=new WN(s["odata.error"]);return i&&(c.requestId=i),{error:c}}var d=new uk(t,e,o,new lk(e,s)),p=function(t){if(u.assertValue(t,"context"),null!=t.scriptVisualBinding)return new ok(t);for(var e=0,r=0,n=t.selects,i=0,a=n.length;i<a;i++){var o=n[i];o&&(null!=o.Depth&&(e=Math.max(e,o.Depth+1)),null!=o.SecondaryDepth&&(r=Math.max(r,o.SecondaryDepth+1)))}return r>=1&&1===e?new sk(t):new fm(t)}(d).read(e.Expressions,s,n),h={dataView:p};if(s.RestartTokens&&(h.restartToken=s.RestartTokens),s.DataLimitsExceeded&&s.DataLimitsExceeded.length>0){h.warnings||(h.warnings=[]);var v=new Jy(e,s.DataLimitsExceeded,s.Calculations);h.warnings.push(v),nm(p,v.limits)}if(s.DataShapeMessages&&s.DataShapeMessages.length>0)for(var g=0,y=s.DataShapeMessages;g<y.length;g++){var m=y[g];Bo[m.Code]&&m.Severity===Yy(0)&&(h.warnings||(h.warnings=[]),h.warnings.push(new $y(m)))}return h.dataView&&!_.isEmpty(a)&&(qy(h.dataView,a),h.disallowPersisting=!0),u.log("DSR.stats",d.stats),h}(t,e,r,s,i,a,o);return g&&(g.timestamp=f,g.fromCache=d,p&&!g.fromCache&&(g.performanceActivities=FN(p.Events,v&&v.getProperty("rootId")))),performance&&(performance.mark&&performance.mark(y+"-end"),performance.measure&&performance.measure(y,y+"-start",y+"-end")),s.total=Mt()-c,l&&l.logEvent(_A,{jsonparse:s.jsonParse,categorical:s.categorical,table:s.table,tree:s.tree,matrix:s.matrix,single:s.single,script:s.script,total:s.total,mode:s.mode,targetDataView:t,dsrLength:s.dsrLength,id:o}),g}(t,l.descriptor,l.dsr,0,l.requestId,l.clientSideFilters,i,s,n,c,l.timestamp,l.fromCache,l.metrics,r.scopedAggregates,a);if(null!=r&&r.queryContext){var d=l.queryContext;d&&(f.queryContext=d)}return o&&o.resolve(),f}var hm="CapacityLimitExceeded",Uc="ServerError_";var ym=function(){eturn Object.defineProperty(t.prototype,"code",{get:enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requestId",{get:function(){return this.httpRequestId},set:function(r){this.httpRequestId=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){var r=this.m_serviceError.exceptionCulprit;if(null!=r)switch(r){case"System":case"PowerBI":return"PowerBI";case"External":return"External";case"User":return"User";default:return u.assertFail("exceptionCulprit: unrecognized value"),"PowerBI"}},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){var r;return r=6===this.m_serviceError.statusCode?function(t,e){return{message:t.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:t.get("ServiceError_CannotLoadVisual"),errorInfoValue:e.message}]}}(e,this.m_serviceError):function(t,e){var o,r="",n="",i="",a="",s=!1;switch(e.errorCode){case"PremiumFilesModelRequiresPremiumCapacity":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("PremiumRequired_TitleText"),i=t.get("ServerError_PremiumFilesModelRequiresPremiumCapacity"),s=!0;break;case"LargeModelMovedAcrossRegions":r=t.get("ServiceError_LargeModelMovedAcrossRegionsTitle"),n=t.get("ServiceError_LargeModelMovedAcrossRegionsTitle"),i=function(t,e,r){if(!e)return"";var n,i=t.get(Uc+e);return i&&(n=i.replace(/\{\s*([^}\s]+)\s*\}/g,),n}(t,"LargeModelMovedAcrossRegions",e.parameters),a="https://aka.ms/moving-large-datasets",s=!0;break;case"rsAccessDeniedDueToRLSGroup":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelFetchingFailureKey"),i=t.get("DsrError_NoPermissionDueToRLSGroupMessage"),s=!0;break;case"rsCannotRetrieveModel":case"CannotRetrieveModelError":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelFetchingFailureKey"),i=t.get("DsrError_CanNotRetrieveModelMessage"),s=!0;break;case"DMTS_NoGatewayWithAllDatasourcesToBindError":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelFetchingFailureKey"),i=t.get("ServerError_DMTS_NoGatewayWithAllDatasourcesToBindError"),s=!0;break;case"DM_GWPipeline_UnknownError":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelFetchingFailureKey"),i=t.get("ServerError_DM_GWPipeline_Client_GatewayUnreachable"),s=!0;break;case"pbidAccessDenied":r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_AuthenticationErrorKey"),i=t.get("ServiceError_AuthenticationErrorValue"),s=!0;break;case"pbidWindowsAuthNotSupported":r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_AuthenticationErrorKey"),i=t.get("ServiceError_WindowsAuthNotSupportedErrorValue"),s=!0;break;case"pbidWindowsAuthWindowsAuthImpersonationNotSupported":r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_AuthenticationErrorKey"),i=t.get("ServiceError_WindowsAuthImpersonationNotSupportedErrorValue"),s=!0;break;case"PowerBIServiceLiveConnectModelNotFound":r=t.get("UploadPowerBICompanion_AccessDatasetWarning"),s=!0;break;case"InsecureLibraryLoadingPatchMissing":r=t.get("ServiceError_InsecureLibraryLoadingPatchMissingTitle"),n=t.get("ServiceError_InsecureLibraryLoadingPatchMissingTitle"),i=t.get("ServiceError_InsecureLibraryLoadingPatchMissingMessage"),s=!0;break;case"BYOKEncryptedModelRequiresPremiumCapacity":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("PremiumRequired_TitleText"),i=t.get("ServerError_BYOKEncryptedModelRequiresPremiumCapacity_Report"),s=!0;break;case"CustomerKeyNotAccessible":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelCannotLoad"),i=t.get("ServerError_CustomerKeyNotAccessible_Report"),s=!0;break;case"CustomerKeyVaultError":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelCannotLoad"),i=t.get("ServerError_CustomerKeyVaultError_Report"),s=!0;break;case hm:r=t.get("ServiceError_ModelCannotLoad_CapacityLimitExceeded"),n=t.get("ServiceError_ModelCannotLoad_CapacityLimitExceeded"),i=t.get("ServiceError_CapacityOverloadedMessage"),a="https://aka.ms/AboutFabricCapacity",s=!0,o="Capacity_Limit_Exceeded_LearnMore"}if(!s)switch(e.statusCode){case 2:r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelConvertFailureKey"),i=t.get("ServiceError_ModelConvertFailureValue");break;case 3:r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelCreationFailureKey"),i=t.get("ServiceError_ModelCreationFailureValue");break;case 1:case 9:if(r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelCannotLoad"),e.errorDetails){var l=_.find(e.errorDetails,function(f){return"ModelMode"===f.code});if(l)switch(l.detail.value){case"Internal":i=t.get("ServiceError_ModelConnectFailureInternalValue");break;case"ExternalOnPrem":i=t.get("ServiceError_ModelConnectFailureASLiveValue");break;case"ExternalService":i=t.get("ServiceError_ModelConnectFailurePBIServiceValue")}}i||(i=t.get("ServiceError_ModelFetchingFailureValue"));break;case 4:r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_ExecuteSemanticQueryErrorKey"),i=t.get("ServiceError_ExecuteSemanticQueryErrorValue");break;case 5:r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_ExecuteSemanticQueryInvalidStreamFormatKey"),i=t.get("ServiceError_ExecuteSemanticQueryInvalidStreamFormatValue");break;default:r=t.get("ServiceError_GeneralError"),n=t.get("ServiceError_GeneralErrorKey"),i=t.get("ServiceError_GeneralErrorValue")}var c={message:r,displayableErrorInfo:[{errorInfoKey:n,errorInfoValue:i}]};return e.errorCode===hm&&(c.helpLinkType=1),o&&(c.helpLinkOverrideText=o),a&&(c.helpLink=a),c}(e,this.m_serviceError),this.m_serviceError.errorDetails&&function(t,e,r){if(!e)return t;for(var n=0,i=e;n<i.length;n++){var a=i[n],o=r.getOptional(Uc+a.code),s=a.detail.value;0===a.detail.type&&(s=r.get(Uc+s)),t.displayableErrorInfo.push({errorInfoKey:o||a.code,errorInfoValue:s})}}(r,this.m_serviceError.errorDetails,e),function(t,e,r,n,i){var a=t.debugErrorInfo=t.debugErrorInfo||[];i&&a.push({errorInfoKey:Rl,errorInfoValue:i}),e&&a.push({errorInfoKey:ln,errorInfoValue:e}),r&&a.push({errorInfoKey:Jv,errorInfoValue:r}),n&&a.push({errorInfoKey:"Stack Trace",errorInfoValue:n})}(r,this.code,this.m_serviceError.message||null,this.m_serviceError.stackTrace||null,this.httpRequestId),r.source=this.source,r},t.codeName="ServiceErrorToClientError",t}();ar Uk=function(){eturn t.prototype.defer=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];u.assertValue(e,"callback"),this.deferMethod?this.deferMethod(e):this.deferInternal(e,r,n)},t.prototype.drain=t.prototype.deferInternal=t.prototype.drainQueue=t}();r Gk=function(){ar e;return t.prototype.then=t.prototype.catch=t.prototype.finally=t.all=t.setUseNativePromise=function(r){t.useNativePromise=r},t.resolvePromise=function(r,n){this.useNativePromise&&this.traceError&&(this.traceError=!1,nt.error("resolvePromise should not be called when useNativePromise is true")),!r.state.status&&(n===r?r.rejectInternal("Expected promise to be resolved with value other than itself"):r.resolveInternal(n))},t.rejectPromise=function(r,n){this.useNativePromise&&this.traceError&&(this.traceError=!1,nt.error("rejectPromise should not be called when useNativePromise is true")),!r.state.status&&r.rejectInternal(n)},t.reset=t.init=function(r,n,i,a){void 0!==a&&(t.useNativePromise=a)||t.usingMicrotask||(t.autoFlushInitialized=n,i?(t.pbiTimeout=mm(,t.usingMicrotask=!0):(u.assertValue(r,"pbiTimeout"),t.pbiTimeout=r||t.pbiTimeout))},t.resolve=t.reject=t.prototype.defer=function(r){u.assert(function(){return _.isFunction(r)},"callback"),this.autoFlush&&this.state.status>0?r():(u.assertValue(this.timeout,"timeout object should have been allocated!"),this.timeout.defer(r,0))},t.prototype.resolveInternal=t.prototype.rejectInternal=t.prototype.scheduleProcessQueue=t.ensurePbiTimeout=function(){var r=t.pbiTimeout;return r||(r=t.pbiTimeout=mm()),r},t.handleCallback=t.processQueue=e=Symbol.toStringTag,t.useNativePromise=!0,t.traceError=!0,t}(),Hc=function(){function t(e){void 0===e&&(e=!1);var r=this;this.promise=new Gk(function(n,i){r.resolver=n,r.rejector=i})}return t.prototype.resolve=function(e){this.resolver(e)},t.prototype.reject=function(e){this.rejector(e)},t}();ar Jk=function(){function t(e,r,n,i,a){this.addVisualIdToQueryDataAsHttpBodyId=a,this.preferredMaxBatchesConfigured=e>0,this.maxBatches=this.preferredMaxBatchesConfigured?e:4,this.queryExecuteCallback=r,this.pending=[],this.timeoutService=n,this.telemetryV2Enabled=i,this.useHttp2QueryDataEnabled=ya.browserSupportsHttp2()}return t.prototype.enqueue=function(e){var r=this;if(!function(t,e){var r=e.options;if(1===r.executionType){u.assertValue(r.queryId,"queryId");var n=_.findIndex(t,function(i){return i.options.queryId===r.queryId});if(n>-1)return u.assert("CancelQuery should correspond to rejected queries."),!0}return!1}(this.pending,e))return this.pending.push(e),this.currentBatchDeferred||(this.currentBatchDeferred=e.options.telemetryV2Enabled?new Hc(!0):$.Deferred(),this.timeoutService.setTimeout(-1,this.telemetryV2Enabled).promise.then(),e.options.telemetryV2Enabled?this.currentBatchDeferred.promise:this.currentBatchDeferred.promise()},t.prototype.clearPending=t.prototype.setMaxBatches=t.prototype.createBatches=t.prototype.sortQueriesByDataSource=function(){var r,e=this;r=this.addVisualIdToQueryDataAsHttpBodyId?_.groupBy(this.pending,:{"":this.pending};var i=[];return _.forEach(r,function(a){var o=[];_.forEach(a,function(s){if(!function(t){return!!Gc(t)&&t.execution.rejected()}(s)){var l=e.findDataSourceGroup(s.options.dataSources,o,s.options.cacheResponseOnServer);l?l.queuedExecutions.push(s):o.push({dataSources:s.options.dataSources,queuedExecutions:[s],cacheResponseOnServer:s.options.cacheResponseOnServer,cacheOptions:s.options.cacheOptions})}}),i.push.apply(i,o)}),i},t.prototype.findDataSourceGroup=function(e,r,n){for(var i=0,a=r.length;i<a;++i){var o=r[i];if(Gf(e,o.dataSources)&&o.cacheResponseOnServer===n)return o}return null},t.prototype.createBatchFromDataSourceGroup=function(e){for(var r=[],n=[],i=[],a=e.queuedExecutions,o=[],s=[],l=function(p,h){var v=a[p],g=a[p].options,y=a[p].enqueueActivity;Gc(v)?(r.push(g),i.push(v.deferred),y&&o.push(y),a[p].queryActivity&&s.push(a[p].queryActivity)):(u.assert(function(){return 1===g.executionType},"Only CancelQuery executions are not rejectable."),n.push(g))},c=0,f=a.length;c<f;++c)l(c);return{dataSources:e.dataSources,queryOptions:r,cancelQueryOptions:n,promises:i,cacheOptions:e.cacheOptions,cacheResponseOnServer:e.cacheResponseOnServer,enqueueActivities:o,queryActivities:s}},t.prototype.splitDataSourcesIntoBatches=t.prototype.splitBatches=t.prototype.splitBatch=t}(),Cm=function(){function t(e,r){this.requestId=e,this.errorCode=r}return Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){return{message:e.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:e.get("ServiceError_ExecuteSemanticQueryErrorValue")},{errorInfoKey:e.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:this.code}],debugErrorInfo:[{errorInfoKey:ln,errorInfoValue:this.code}]}},t}(),bm=),qo=),Xk=function(){function t(e){this.cache={},this.capacity=e,this.linkedList=new bm}return t.prototype.get=t.prototype.remove=t.prototype.put=function(e,r){var n=this;e in this.cache&&this.remove(e);var i=new Vm(e,r),a=new qo(i);if(this.cache[e]=a,this.linkedList.insertToHead(a),this.size()>this.capacity){u.assert(function(){return n.size()===n.capacity+1},"cache has exceeded expected maximum capacity");var o=this.linkedList.tail();delete this.cache[o.value.key],this.linkedList.removeFromTail()}},t.prototype.containsKey=function(e){return e in this.cache},t.prototype.size=function(){return this.keys().length},t.prototype.keys=function(){return Object.keys(this.cache)},t.prototype.isFull=function(){return this.size()===this.capacity},t}(),Zk=function(){eturn t.prototype.get=t.prototype.remove=t.prototype.put=function(e,r){var n=this;e in this.cache&&this.remove(e);var i=new Vm(e,r),a=new qo(i);if(this.cache[e]=a,this.linkedList.insertToHead(a),this.size()>this.capacity){u.assert("cache has exceeded expected maximum capacity");var o=this.linkedList.tail();delete this.cache[o.value.key],this.linkedList.removeFromTail()}},t.prototype.containsKey=t.prototype.size=t.prototype.keys=t.prototype.isFull=t}(),Vm=),wm=function(){function t(e,r,n){this.cache=1===(n||(n=500),r)?new Zk(n):new Xk(n),this.promiseFactory=e}return t.prototype.getEntryCount=function(){return this.cache.size()},t.prototype.hasCacheEntry=function(e){return u.assertValue(e,"cacheKey"),!!this.getCacheEntry(e)},t.prototype.createCacheEntry=function(e,r,n,i,a){var o=this;u.assertValue(e,"cacheKey");var s=this.getCacheEntry(e);if(e&&!s){var l=this.promiseFactory,c=this.cache,f=l.defer(a),d=function(t){return new zv(t)}(f),p=l.defer(a),h=Fi(p);return this.appendCacheEntryInternal(e,s={promise:h,refCount:0,context:r}),d.then(function(v){return p.reject(v)}).finally(function(){delete s.updateResult}),h.finally(.catch(function(v){return d.reject(v)}),{deferred:f,promise:d}}},t.prototype.clearEntry=t.prototype.clearAllEntries=t.prototype.bindCacheEntry=function(e,r,n){u.assertValue(e,"cacheKey");var i=this.getCacheEntry(e);if(void 0!==i){var a=this.promiseFactory.defer(n),o=Fi(a);if(i.result){var s=r?r(i.result):i.result;return a.resolve(s),o}var l=i.promise;if(!l)return a.reject(void 0),o;i.refCount++;var c=return o.then(function(){return c()},function(f){return c(f)}),l.then(function(f){return a.reject(f)}),o}},t.prototype.getEntryContext=function(e){u.assertValue(e,"cacheKey");var r=this.getCacheEntry(e);if(r)return r.context},t.prototype.keys=function(){return this.cache.keys()},t.prototype.isFull=function(){return this.cache.isFull()},t.prototype.rewriteAllEntries=t.prototype.putCacheResult=function(e,r,n){u.assertValue(e,"cacheKey");var i=this.getCacheEntry(e);i?i.result?i.result=n?n(r):r:i.updateResult=function(){return r}:u.assertFail("cannot update no-existing cacheEntry for key '".concat(e,"' with result '").concat(r,"'"))},t.prototype.appendCacheEntryInternal=t.prototype.removeCacheEntryInternal=function(e){this.cache.remove(e)},t.prototype.changeCacheKey=t.prototype.getCacheEntry=function(e){var r;if(u.assertValue(e,"cacheKey"),e&&(r=this.cache.get(e))&&(r.promise||r.result))return r},t}();function Qn(t){return u.assert(function(){return t&&t.Commands&&t.Commands.length>0},"data query should not be empty"),t.Commands.length>1}function xm(t){return u.assert("data query should not be empty"),Qn(t)?Qc(t):jc(t.Commands[0].SemanticQueryDataShapeCommand)}function Qc(t){if(u.assert(function(){return!t||Qn(t)},"!dataQuery || isCompositeDataQuery(dataQuery)"),t)return JSON.stringify(t)}ar Mm=pt.generateGuid,Dm=function(){function t(e,r,n,i,a){this.featureSwitches=a,u.assertValue(e,"promiseFactory"),u.assertValue(n,"createQuery"),this.createQuery=n,this.createCancelQuery=i,this.promiseFactory=e,this.cacheByModel={},this.telemetryService=r}return t.prototype.ensure=function(e){var n,r=this;u.assertValue(e,"options"),u.assertValue(e.command,"options.command");var i=e.command;u.assert(function(){return i&&i.Commands&&i.Commands.length>0},"data query should not be empty");var a=i.Commands[0].SemanticQueryDataShapeCommand,o=this.ensureCache(e.dataSources),s=xm(i);if(o.hasCacheEntry(s)){if(t.allowResultFromClientCacheOrDefault(e))return this.telemetryService.logEvent(Hv,{cacheHit:!0,isCacheFull:o.isFull(),entryCount:o.getEntryCount()}),o.bindCacheEntry(s,void 0,e.telemetryV2Enabled);o.clearEntry(s)}this.telemetryService.logEvent(Hv,{cacheHit:!1,isCacheFull:o.isFull(),entryCount:o.getEntryCount()});var l=Am(i,this.featureSwitches,s),c=this.findEquivalentCache(e,o,l);if(c)return c;var d,f=de({},e);f.queryId=l.queryId,f.executionType=0,null!==(n=this.featureSwitches)&&void 0!==n&&n.queryContext&&(d=function(g){var y=r.findQueryContext(f);if(!y)return g;var m=de({},g);return m.queryContext=y,m});var p=o.createCacheEntry(s,l,d,t.rewriteCachedResult,e.telemetryV2Enabled);if(p.promise.catch(function(v){(function(t){return null!=t&&void 0!==t.code&&void 0!==t.ignorable&&void 0!==t.requestId&&void 0!==t.getDetails})(v)||r.featureSwitches&&r.featureSwitches.queryCancellation&&r.createCancelQuery({dataSources:f.dataSources,command:f.command,allowResultFromClientCache:f.allowResultFromClientCache,allowClientSideFilters:f.allowClientSideFilters,cacheResponseOnServer:f.cacheResponseOnServer,ignoreViewportForCache:f.ignoreViewportForCache,cacheOptions:f.cacheOptions,queryId:f.queryId,executionType:1},v&&v.queryCancellationSource)}),f.clientCacheOnly)return p.promise.reject(new zA),p.promise;this.createQuery(f,p);var h=o.bindCacheEntry(s,void 0,e.telemetryV2Enabled);return!1===e.cacheResponseOnClient&&o.clearEntry(s),a.Binding&&a.Binding.DataReduction&&(Uo(a.Binding.DataReduction.Primary)||Uo(a.Binding.DataReduction.Secondary))||h.then(function(v){v&&v.dsr&&function(t,e){if(u.assertValue(t,"dsr"),Oc(t)){if(!e)return!1;for(var r=Zy(t,void 0).dataShapes(),n=function(t){return u.assertAnyValue(t,"dsr"),t.MinorVersion}(t);r.next();)if(n&&n>=1){if(!0!==r.hasAllData())return!1}else if(!r.complete()||r.limitsExceeded()||r.hasRestartTokens())return!1;return!0}return _.every(t.DataShapes,}(v.dsr,r.featureSwitches&&r.featureSwitches.dsrV2)&&(l.hasAllData=!0)},function(){}),h},t.prototype.findQueryContext=function(e){var r=e.applicationContext;if(r)return u.assert(function(){return 1===_.size(r.Sources)},"Expected to have 1 ApplicationContextSource"),r.Sources[0].CustomProperties},t.prototype.clear=t.prototype.rewrite=t.prototype.put=t.allowResultFromClientCacheOrDefault=function(e){return u.assertValue(e,"options"),!1!==e.allowResultFromClientCache},t.prototype.findEquivalentCache=function(e,r,n){if(u.assertValue(e,"options"),u.assertValue(r,"cache"),u.assertValue(n,"entryContext"),t.allowResultFromClientCacheOrDefault(e))if(n.compositeDataQuery){if(e.ignoreViewportForCache)for(var h=0,v=r.keys();h<v.length;h++)if((d=r.getEntryContext(v[h]))&&d.keyWithoutViewport&&d.keyWithoutViewport===n.keyWithoutViewport)return r.bindCacheEntry(d.key,void 0,e.telemetryV2Enabled)}else{var i=e.command;u.assert("data query should not be empty");for(var a=i.Commands[0].SemanticQueryDataShapeCommand.Binding,o=!!(a&&a.DataReduction&&a.DataReduction.Primary&&a.DataReduction.Primary.TopNPerLevel),s=!1,l=0,c=r.keys();l<c.length;l++){var d;if(d=r.getEntryContext(c[l])){if(!o&&d.hasAllData&&d.keyWithoutReduction===n.keyWithoutReduction)return r.bindCacheEntry(d.key,void 0,e.telemetryV2Enabled);if(c2(r,d,e,n,e.telemetryV2Enabled)){s=!0;break}}}s&&nt.information("Reused cache with client side filters")}},t.prototype.getCache=t.prototype.ensureCache=t.prototype.generateModelKey=t.rewriteCachedResult=function(e){if(!e)return e;var r=de({},e);return delete r.metrics,r.fromClientCache=!0,r},t}();function Am(t,e,r){return u.assertValue(t,"dataQuery"),u.assert(function(){return t&&t.Commands&&t.Commands.length>0},"data query should not be empty"),u.assertAnyValue(r,"cacheKey"),Qn(t)?Tm(t,e,r):(u.assert(function(){return 1===t.Commands.length},"Expecting a non-empty, non-composite query to have exactly 1 command."),Im(t.Commands[0].SemanticQueryDataShapeCommand,e,r))}function Tm(t,e,r){return u.assertValue(t,"dataQuery"),u.assert(function(){return Qn(t)},"data query should be composite"),u.assertAnyValue(r,"cacheKey"),u.assert(function(){return!r||r===Qc(t)},"If cacheKey is specified, it is expected to be the return value of this.generateCacheKeyDataQuery(dataQuery).  The fact that cacheKey is a parameter to this function is just an optimization."),{key:r||Qc(t),keyWithoutReduction:o2(t),keyWithoutViewport:s2(t),keyWithoutFilter:void 0,queryFilters:void 0,compositeDataQuery:!0,queryId:_m(e)}}function Im(t,e,r){u.assertAnyValue(t,"dataShapeCommand"),u.assertAnyValue(r,"cacheKey"),u.assert("If cacheKey is specified, it is expected to be the return value of this.generateCacheKey(dataShapeCommand).  The fact that cacheKey is a parameter to this function is just an optimization.");var n=function(t){if(u.assertAnyValue(t,"command"),!t)return!1;var e=t.Binding&&t.Binding.DataReduction,r=e&&e.Primary,n=e&&e.Secondary;return!(!Rm(r)||!Rm(n)||Uo(r)||Uo(n))}(t);return{key:r||jc(t),keyWithoutReduction:i2(t),keyWithoutViewport:void 0,keyWithoutFilter:n?a2(t):void 0,queryFilters:n?u2(t):void 0,compositeDataQuery:!1,queryId:_m(e)}}tion o2(t){if(u.assert(function(){return!t||Qn(t)},"!dataQuery || isCompositeDataQuery(dataQuery)"),t){var e=_.cloneDeep(t);return Fm(e.Commands[0].SemanticQueryDataShapeCommand),JSON.stringify(e)}}function s2(t){if(u.assert(function(){return!t||Qn(t)},"!dataQuery || isCompositeDataQuery(dataQuery)"),t){u.assertValue(t.Commands,"dataQuery.Commands"),u.assert(function(){return 2===t.Commands.length},"dataQuery.Commands must have two commands"),u.assertValue(t.Commands[1].ScriptVisualCommand,"dataQuery.Commands second element must be a ScriptVisualCommand");var e=_.cloneDeep(t);return e.Commands[1].ScriptVisualCommand),JSON.stringify(e)}}function u2(t){u.assertAnyValue(t,"command");var e=t&&t.Query;if(e&&!_.isEmpty(e.Where)){var r=Nm(e),n=r&&r.where();if(!_.isEmpty(n))return n}}function c2(t,e,r,n,i){if(void 0===i&&(i=!1),u.assert(function(){return Dm.allowResultFromClientCacheOrDefault(r)},"QueryCache.allowResultFromClientCacheOrDefault(options)"),u.assertValue(t,"cache"),u.assertValue(e,"oldItemContext"),u.assertValue(r,"newQueryOptions"),u.assertValue(n,"newItemContext"),r.allowClientSideFilters){var a=function(t,e){if(u.assertValue(t,"oldItemContext"),u.assertValue(e,"newItemContext"),!e.compositeDataQuery&&e.keyWithoutFilter&&!t.compositeDataQuery&&t.keyWithoutFilter&&t.hasAllData&&t.keyWithoutFilter===e.keyWithoutFilter&&function(t,e){return u.assertAnyValue(t,"filters"),u.assertAnyValue(e,"counterparts"),_.every(t,function(r){return _.some(e,function(n){return function(t,e){if(u.assertValue(t,"restrictiveFilter"),u.assertValue(e,"baseFilter"),!qf(t,e))return!1;var r=t.condition,n=e.condition;if(r instanceof ka&&n instanceof ka){var i=Fc(r),a=Fc(n);if(i&&a&&H(i.otherSide,a.otherSide))return ha(Hi(i.constantValue),Hi(a.constantValue))}return!1}(n,r)})})}(Pm(t.queryFilters,e.queryFilters),e.queryFilters)){var a=Pm(e.queryFilters,t.queryFilters);if(!_.isEmpty(a))return function(t,e){u.assert("itemContext && !itemContext.compositeDataQuery"),u.assertNonEmpty(e,"filtersToConvert");var r=JSON.parse(t.key),n=Nm(r&&r.Query);if(n)return u.assert(function(){return _.every(e,},"expecting every item in filtersToConvert to be in the where clause of the source SemanticQuery."),function(t,e){u.assertNonEmpty(t,"selects"),u.assertNonEmpty(e,"filters");var r=_.some(e,function(s){return!function(t){return u.assertValue(t,"filter"),!t.target}(s)});if(!r){for(var n=new pN(t),i=0,a=e;i<a.length;i++)a[i].condition.accept(n);return n.getClientSideFiltersIfAllSupported()}}(n.select(),e)}(e,a)}}(e,n);if(!_.isEmpty(a))return t.bindCacheEntry(e.key,function(o){return function(t,e){u.assertValue(t,"data"),u.assertNonEmpty(e,"clientSideFilters");var r=de({},t);return r.clientSideFilters=e,r}(o,a)},i)}}function Pm(t,e){return u.assertAnyValue(t,"filters"),u.assertAnyValue(e,"comparants"),_.isEmpty(e)?t:_.filter(t,}function Uo(t){return u.assertAnyValue(t,"algorithm"),t&&t.Window&&null!=t.Window.RestartTokens}function Rm(t){return u.assertAnyValue(t,"algorithm"),!t||!!t.Window}function Nm(t){if(u.assertAnyValue(t,"queryDefinition"),t&&t.From&&t.Select)return G.deserializeQuery(t)}var g2=function(t){function e(r){var n=this;return u.assertValue(r,"jobId"),(n=t.call(this,"DelayedQueryTimeoutError")||this).jobId=r,n}return T(e,t),e.prototype.getDetails=function(r){var n=t.prototype.getDetails.call(this,r);return n.debugErrorInfo=n.debugErrorInfo||[],n.debugErrorInfo.push({errorInfoKey:"Job Id",errorInfoValue:this.jobId}),n},e}(Yv),y2=function(){function t(){}return t.prototype.resolveDelayedQuery=function(e,r,n){u.assertFail("Apps that want to support delayed query results need to specify an IExecuteSemanticQueryDelayedResultResolver implementation"),n.reject(new g2(e))},t}(),m2=function(t){function e(r){var n=this;return u.assertValue(r,"requestId"),(n=t.call(this,"ExecuteSemanticQueryUnknownError")||this).httpRequestId=r,n}return T(e,t),Object.defineProperty(e.prototype,"requestId",{get:function(){return this.httpRequestId},enumerable:!1,configurable:!0}),e.prototype.getDetails=function(r){var n=t.prototype.getDetails.call(this,r);return n.debugErrorInfo=n.debugErrorInfo||[],n.debugErrorInfo.push({errorInfoKey:Rl,errorInfoValue:this.httpRequestId}),n},e}(Yv),S2=function(){function t(e,r,n,i,a,o,s,l,c){var f=this;this.communication=r,this.telemetryService=i,this.featureSwitches=s,this.queryContextProvider=l,this.appContextHostDataProvider=c,u.assertValue(e,"host"),u.assertValue(i,"telemetryService"),this.promiseFactory=e.promiseFactory(),this.delayedQueryResultResolver=a||new y2,this.batcher=new Jk(null==o?0:o,n,s&&s.telemetryV2,s&&s.addVisualIdToQueryDataAsHttpBodyId),this.queryCache=function(t,e,r,n,i){return u.assertValue(t,"promiseFactory"),u.assertValue(r,"createQuery"),new Dm(t,e,r,function(d,p){f.telemetryService.logEvent(IA,{source:p}),f.enqueueExecution({options:d,enqueueActivity:d.performanceActivity&&d.performanceActivity.isRunning()&&d.performanceActivity.createChildActivity({name:"Query Pending"}),queryActivity:d.performanceActivity})},i)}(this.promiseFactory,this.telemetryService,0,s)}return t.prototype.setAppContextHostData=function(e){var r;if(this.appContextHostDataProvider&&e.options.applicationContext&&null!==(r=this.featureSwitches)&&void 0!==r&&r.useEnrichedApplicationContext){var n=e.options.applicationContext,i=this.appContextHostDataProvider.getApplicationContextHostData();n.Sources[0]=de(de({},n.Sources[0]),i)}},t.prototype.setQueryContext=function(e){var r;return et(this,void 0,Qe,function(){var n,i;return tt(this,function(o){switch(o.label){case 0:if(null===(r=this.featureSwitches)||void 0===r||!r.queryContext)return[2];if(!this.queryContextProvider||!e.options.applicationContext)return[2];u.assert("Expected to have 1 ApplicationContextSource"),n=e.options.applicationContext.Sources[0],o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.queryContextProvider.generateQueryContext()];case 2:return(i=o.sent())?(n.CustomProperties=de(de({},n.CustomProperties),i),[3,4]):[2];case 3:return o.sent(),[2];case 4:return[2]}})})},t.prototype.enqueueExecution=t.prototype.execute=function(e){if(!_.isEmpty(e.dataSources))return this.queryCache.ensure(e);var r=this.promiseFactory.defer(e.telemetryV2Enabled),n=Fi(r);return r.resolve(e.command),n},t.prototype.stopCommunication=t.prototype.resumeCommunication=t.prototype.cache=function(){return this.queryCache},t.prototype.setLocalCacheResult=t.prototype.setPreferredMaxConnections=function(e){this.batcher.setMaxBatches(e)},t.prototype.executeBatch=function(e){var r=this;u.assertValue(e,"batch"),u.assert("Queries & promises sizes must match.");var n=e.promises;this.communication.execute(e).then(function(i){return r.onSuccess(i,n)},function(i){return r.onError(i,n)})},t.prototype.onSuccess=function(e,r){u.assertValue(e,"result"),u.assertValue(r,"executions"),this.rejectExecutionsForMissingJobs(e,r);for(var n=e.jobIds,i={},a=0,o=r.length;a<o;++a)i[n[a]]=r[a];var s=e.results;for(a=0,o=s.length;a<o;++a){var l=s[a],c=l.result,d=i[f=l.jobId];delete i[f];var p=c.data,h=c.error;if(p)d.resolve({descriptor:p.descriptor,dsr:p.dsr,metrics:p.metrics,requestId:e.requestId,timestamp:p.timestamp,fromCache:p.fromCache});else if(h){var g=new ym(h);g.requestId=e.requestId,d.reject(g)}else c.asyncResult&&this.delayedQueryResultResolver.resolveDelayedQuery(l.jobId,e.requestId,d)}if(!_.isEmpty(Object.keys(i)))for(var f in h=new Cm(e.requestId,"MissingJobResult"),i)i[f].reject(h)},t.prototype.rejectExecutionsForMissingJobs=t.prototype.onError=function(e,r){var n;if(u.assertValue(r,"executions"),e&&e.requestError&&(n=new ym(e.requestError)),n)n.requestId=e.requestId;else{var i=e.error,a=void 0,o=void 0,s=void 0;if(i){a=i.message,o=i.code;var l=i["pbi.error"]&&i["pbi.error"].exceptionCulprit;null!=l&&(s=l))}n=e&&null!=e.httpStatusCode&&e.requestId?new BA(e.httpStatusCode,e.requestId,o,a,s):new m2(e.requestId)}for(var c=0,f=r.length;c<f;c++)r[c].reject(n)},t}();function E2(t){return!!Gc(t)&&t.execution.pending()}var b2=function(){function t(e,r,n,i,a,o,s,l,c){u.assertValue(e,"host"),this.proxy=new S2(e,r,a,n,o,s,i,l,c),this.featureSwitches=i,this.telemetryService=n}return t.prototype.execute=function(e){return this.proxy.execute(e)},t.prototype.transform=function(e,r,n,i){return void 0===e?{dataView:{metadata:{columns:[]},error:{code:"UndefinedData"}}}:dk(r,e,this.featureSwitches,this.telemetryService,n,i)},t.prototype.stopCommunication=function(){this.proxy.stopCommunication()},t.prototype.resumeCommunication=Object.defineProperty(t.prototype,"cache",{get:function(){return this.proxy.cache()},enumerable:!1,configurable:!0}),t.prototype.setLocalCacheResult=t.prototype.setPreferredMaxConnections=function(e){this.proxy.setPreferredMaxConnections(e)},t}(),V2={get:function(e){return e},getOptional:function(e){return e},format:function(e){return e}};function x2(t,e){if(t){var r={properties:{}};for(var n in t.displayName&&(r.displayName=Dr(t.displayName,e)),t.description&&(r.description=Dr(t.description,e)),t.properties)r.properties[n]=D2(t.properties[n],e);return r}}function D2(t,e){var r={type:T2(t.type,e)};return t.rule&&(r.rule=t.rule),t.displayName&&(r.displayName=Dr(t.displayName,e)),t.description&&(r.description=Dr(t.description,e)),t.placeHolderText&&(r.placeHolderText=Dr(t.placeHolderText,e)),r}function T2(t,e){var r=L.fromDescriptor(t);return r&&r.enum?{enumeration:km(r.enum,e)}:null!=r&&r.flagsEnum?{flagsEnumeration:km(r.flagsEnum,e)}:t}function km(t,e){return _.map(t.members(),function(r){return function(t,e){return{displayName:Dr(t.displayName,e),value:t.value}}(r,e)})}var Wc="message",Bm="message",zm="onMessageProxyAsyncComplete";function Om(t,e){return new k2(t,e)}var k2=function(){eturn Object.defineProperty(t.prototype,"allowSameWindow",{get:function(){return this._allowSameWindow},set:function(r){this._allowSameWindow=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contentWindow",{get:function(){return this._contentWindow},set:function(r){u.assertValue(r,"value"),this._contentWindow=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queue",{get:enumerable:!1,configurable:!0}),t.prototype.postMessage=t.prototype.postMessageAsync=t.prototype.queueMessage=t.prototype.on=function(e,r){u.assertValue(e,"type"),u.assertValue(r,"handler"),this.handlers[e]&&(this.handlers[e].indexOf(r)>-1||this.handlers[e].push(r))},t.prototype.off=function(e,r){if(u.assertValue(e,"type"),this.handlers[e]){if(!r)return void(this.handlers[e].length=0);var n=this.handlers[e].indexOf(r);n>-1&&this.handlers[e].splice(n,1)}},t.prototype.flushQueue=t.prototype.sendMessage=function(e){var r=this.prepareMessage(e);this.contentWindow?this.contentWindow.postMessage&&this.contentWindow.postMessage(r,"*"):u.assertFail("contentWindow not set")},t.prototype.prepareMessage=function(e){var r;try{r=JSON.stringify(e)}catch(n){throw r=null,pt.ensureError(n)}return r},t.prototype.onMessageReceived=t.prototype.dispatchMessage=t.prototype.invokeHandler=t.prototype.createRandomString=t.prototype.destroy=t}();function L2(){var t=Di(),r={messageProxy:Om(t,window.parent),promiseFactory:t,resourceProvider:{get:function(i){return i},getOptional:function(i){return i},format:function(i){return i}}};return new B2(r)}var B2=function(){function t(e){var r=this;u.assertValue(e.messageProxy,"messageProxy"),u.assertValue(e.promiseFactory,"promiseFactory"),this.messageProxy=e.messageProxy,this.promiseFactory=e.promiseFactory,this.resourceProvider=e.resourceProvider,this.messageProxy.on(Wc,function(n){return r.onMessageReceived(n)}),this.hostOrigin=new URL(window.location.href).origin}return t.prototype.onMessageReceived=t.prototype.loadVisualPluginWithContent=function(e){var r=this.promiseFactory.defer(),n=e.pluginName,i=e.mappedPluginContent,a=i[At.CustomVisualJavascript].content,o=i[At.CustomVisualsCss].content;try{co(n,a),fo(n,o);var s=zn[n];s.iconUrl=function(t){var r=$("#css-"+t)[0],n=_.find(document.styleSheets,function(o){return o.ownerNode===r});if(n&&n.cssRules)for(var i=0;i<n.cssRules.length;i++){var a=n.cssRules[i];if(a.selectorText&&a.selectorText===".visual-icon."+t)return a.style.backgroundImage}return""}(n),s.content={js:a,css:o,iconBase64:s.iconUrl},uo(s),s.capabilities.objects=function(t,e){u.assertValue(t,"objectDescriptors");var r={};for(var n in t)r[n]=x2(t[n],e||V2);return r}(s.capabilities.objects,this.resourceProvider),r.resolve(s)}catch(l){r.reject(l)}return r.promise},t}();ar Um=!1;function Ho(t,e){u.assertValue(t,"fill"),t.solid&&t.solid.color?e.visitExpr(t.solid.color):u.assertFail("Unsupported FillDefinition")}unction W2(t,e,r,n){return u.assertValue(t,"propDefn"),Hm(t,e,r,n)}function Hm(t,e,r,n){var a,o,i=new YT;return wo(t)?((a=new Kc(e,r,n,t.context)).propertyVisitor=o,(o=new Va(a,i)).visitExpr(t.value)):Zl(t)?(a=new Kc(e,r,n),o=new Va(a,i),a.propertyVisitor=o,o.visitExpr(t)):(a=new Kc(e,r,n),o=new Va(a,i),a.propertyVisitor=o,function(t,e){Ll(t)?e.visitFillDefinition(t):Bl(t)?e.visitFillRuleDefinition(t):zl(t)?e.visitParagraphs(t):Ol(t)?e.visitDataBarsDefinition(t):vo(t)?e.visitIconDefinition(t):Pi(t)&&e.visitErrorRangeDefinition(t)}(t,a)),{expressions:a.exprs,references:i.references}}qm();var Kc=function(t){eturn T(e,t),e.prototype.resolveSelectRef=function(r){return r&&jt(r)?this.getSelectByRef(r):r},e.prototype.add=e.prototype.visitMeasureRef=function(r){this.add({expr:r,selector:this.selector})},e.prototype.visitArithmetic=function(r){this.add({expr:r,selector:this.selector})},e.prototype.visitAggr=function(r){if(jt(r.arg)){var i={expr:this.getSelectByRef(r.arg),selector:this.selector,aggregates:this.getAggregates(r.func)};this.add(i)}else this.add({expr:r,selector:this.selector})},e.prototype.checkIfOrdinal=function(r){},e.prototype.getAggregates=function(r){switch(r){case 4:return{max:!0};case 3:return{min:!0};case 6:return{median:!0};case 1:return{average:!0};default:u.assertFail("Unsupported Projection Aggregate")}},e.prototype.visitPercentile=function(r){if(jt(r.arg)){var i={expr:this.getSelectByRef(r.arg),selector:this.selector,aggregates:{percentiles:[{k:r.k,exclusive:r.exclusive}]}};this.add(i)}else this.add({expr:r,selector:this.selector})},e.prototype.visitColumnRef=function(r){this.add({expr:r,selector:this.selector})},e.prototype.visitContains=function(r){this.checkIfOrdinal(r),t.prototype.visitContains.call(this,r)},e.prototype.visitStartsWith=function(r){this.checkIfOrdinal(r),t.prototype.visitStartsWith.call(this,r)},e.prototype.visitCompare=e.prototype.visitHierarchyLevel=function(r){this.add({expr:r,selector:this.selector})},e.prototype.visitNativeMeasure=e.prototype.visitSelectRef=e.prototype.getSelectByRef=e.prototype.visitScopedEval=function(r){var n=r.decomposeGlobalAggregateOfScopedExpr();if(n){var i={expr:this.resolveSelectRef(n.source),selector:this.selector,aggregates:this.getAggregates(n.func)};this.add(i)}else r.hasGlobalScope()?this.add(i={expr:r.expression,selector:null}):(i={expr:r,selector:{data:[Au()]}},this.add(i))},e.prototype.visitFillRule=e.prototype.visitFillDefinition=e.prototype.visitFillRuleDefinition=function(r){u.assertValue(r,"fillRule"),u.assertAnyValue(this.inputExpr,"inputExpr can end up being undefined if it was a non-matching SelectRef");var n=r.linearGradient2||r.linearGradient3;u.assertValue(n,"fillRule needs either linearGradient2 or linearGradient3"),u.assertValue(n.min,"gradient.min"),u.assertValue(n.max,"gradient.max");var i={};n.min.value||(i.min=!0),n.max.value||(i.max=!0),(i.min||i.max)&&(this.exprs.push({expr:this.inputExpr,selector:this.selector,aggregates:i}),sd(r,this.propertyVisitor))},e.prototype.visitDataBarsDefinition=function(r){u.assertValue(this.inputExpr,"Databars without an input Expr"),u.assertValue(r,"dataBars");var n={};r.minValue||(n.min=!0),r.maxValue||(n.max=!0),(n.min||n.max)&&(this.exprs.push({expr:this.inputExpr,selector:this.selector,aggregates:n}),function(t,e){u.assertValue(t,"dataBars"),t.minValue&&e.visitExpr(t.minValue),t.maxValue&&e.visitExpr(t.maxValue),Ho(t.positiveColor,e),Ho(t.negativeColor,e),Ho(t.axisColor,e),e.visitExpr(t.reverseDirection),e.visitExpr(t.hideText)}(r,this.propertyVisitor))},e.prototype.visitIconDefinition=function(r){!function(t,e){u.assertValue(t,"fillRule"),t.layout&&e.visitExpr(t.layout),t.verticalAlignment&&e.visitExpr(t.verticalAlignment),t.value&&e.visitExpr(t.value)}(r,this.propertyVisitor)},e.prototype.visitParagraphs=function(r){!function(t,e){u.assertValue(t,"paragraphs");for(var r=0,n=t;r<n.length;r++)ZT(n[r],e)}(r,this.propertyVisitor)},e.prototype.visitErrorRangeDefinition=function(r){var n=this;u.assert("Error range should have a target"),this.relatedProjectionQueryName=this.selector.metadata,function(t,e){t.explicit?t.explicit,e):t.symmetricalExplicit?e.visitExpr(t.symmetricalExplicit.delta):t.standardDeviation?function(t,e){t.visitExpr(e.value),t.visitExpr(e.multiplier)}(e,t.standardDeviation):t.percentage?function(t,e){e.visitExpr(t.lowerBoundDelta),e.visitExpr(t.upperBoundDelta)}(t.percentage,e):t.percentile?t.percentile,e):u.assertFail("Unsupported ErrorRangeDefinition")}(r,this.propertyVisitor),this.relatedProjectionQueryName=void 0},e}(Kt);function K2(t){return J2.rewrite(t)}var J2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.prototype.visitDefault=function(r){var n=pe(r);return n&&!n.percentOfGrandTotal&&(r=ge({percentOfGrandTotal:{baseExpr:n}})),r},e.instance=new e,e}(Yr),Go=function(t){function e(r){var n=this;return u.assertValue(r,"func"),(n=t.call(this)||this).func=r,n}return T(e,t),e.prototype.visitAggr=function(r){return r.func===this.func?r:new $r(r.arg,this.func)},e.prototype.visitColumnRef=function(r){return new $r(r,this.func)},e.prototype.visitGroupRef=function(r){return new $r(r,this.func)},e.prototype.visitHierarchyLevel=e.rewrite=function(r,n){u.assertValue(r,"expr"),u.assertValue(n,"func");var i=new e(n);return r.accept(i)},e}(Yr);function Y2(t,e){return $2.rewrite(t,e)}var $2=function(){function t(e,r){this.sqExpr=e,this.aggregate=r}return t.rewrite=function(e,r){return Se(pe(e),new t(e,r))},t.prototype.visitPercentOfGrandTotal=function(e){return e.baseExpr=pe(Go.rewrite(ge(e.baseExpr),this.aggregate)),ge({percentOfGrandTotal:e})},t.prototype.visitPercentOfRoleTotal=function(e){return e.baseExpr=pe(Go.rewrite(ge(e.baseExpr),this.aggregate)),ge({percentOfRoleTotal:e})},t.prototype.visitFilteredEval=function(e){return e.baseExpr=pe(Go.rewrite(ge(e.baseExpr),this.aggregate)),ge({filteredEval:e})},t.prototype.visitColumn=function(e){return this.defaultRewrite()},t.prototype.visitColumnAggr=function(e){return this.defaultRewrite()},t.prototype.visitGroupingColumn=function(e){return this.defaultRewrite()},t.prototype.visitGroupingColumnAggr=function(e){return this.defaultRewrite()},t.prototype.visitColumnHierarchyVariation=function(e){return this.defaultRewrite()},t.prototype.visitColumnHierarchyLevelVariation=function(e){return this.defaultRewrite()},t.prototype.visitColumnSubquery=function(e){return this.defaultRewrite()},t.prototype.visitColumnAggrSubquery=function(e){return this.defaultRewrite()},t.prototype.visitColumnTransformRef=function(e){return this.defaultRewrite()},t.prototype.visitSelectRef=function(e){return this.defaultRewrite()},t.prototype.visitEntity=function(e){return this.defaultRewrite()},t.prototype.visitEntityAggr=function(e){return this.defaultRewrite()},t.prototype.visitHierarchy=function(e){return this.defaultRewrite()},t.prototype.visitHierarchyLevel=function(e){return this.defaultRewrite()},t.prototype.visitHierarchyLevelAggr=function(e){return this.defaultRewrite()},t.prototype.visitMeasure=function(e){return this.defaultRewrite()},t.prototype.visitPercentile=function(e){return this.defaultRewrite()},t.prototype.visitTransformOutputRoleRef=function(e){return this.defaultRewrite()},t.prototype.visitArithmetic=function(e){return this.defaultRewrite()},t.prototype.visitConstant=function(e){return this.defaultRewrite()},t.prototype.visitSparklineData=function(e){return this.defaultRewrite()},t.prototype.visitNativeVisualCalc=function(e){return this.defaultRewrite()},t.prototype.defaultRewrite=t}();function X2(t){return Z2.rewrite(t)}var Z2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.prototype.visitDefault=function(r){var n=pe(r);return n&&n.percentOfRoleTotal&&(r=ge(n.percentOfRoleTotal.baseExpr)),r},e.instance=new e,e}(Yr);ar tL=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.prototype.visitDefault=function(r){var n=pe(r);return n&&n.percentOfGrandTotal&&(r=ge(n.percentOfGrandTotal.baseExpr)),r},e.instance=new e,e}(Yr);function rL(t,e){return iL.rewrite(t,e)}var nL=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitAggr=function(r){return r.arg},e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.instance=new e,e}(Yr),iL=function(){function t(e){this.sqExpr=e}return t.rewrite=function(e,r){return Se(pe(e,r),new t(e))},t.prototype.visitPercentOfGrandTotal=function(e){return t.rewrite(ge(e.baseExpr))},t.prototype.visitPercentOfRoleTotal=function(e){return t.rewrite(ge(e.baseExpr))},t.prototype.visitFilteredEval=t.prototype.visitColumn=function(e){return this.defaultRewrite()},t.prototype.visitColumnAggr=function(e){return this.defaultRewrite()},t.prototype.visitGroupingColumn=function(e){return this.defaultRewrite()},t.prototype.visitGroupingColumnAggr=function(e){return this.defaultRewrite()},t.prototype.visitColumnHierarchyVariation=function(e){return this.defaultRewrite()},t.prototype.visitColumnHierarchyLevelVariation=function(e){return this.defaultRewrite()},t.prototype.visitColumnSubquery=function(e){return this.defaultRewrite()},t.prototype.visitColumnAggrSubquery=function(e){return this.defaultRewrite()},t.prototype.visitColumnTransformRef=function(e){return this.defaultRewrite()},t.prototype.visitSelectRef=function(e){return this.defaultRewrite()},t.prototype.visitEntity=function(e){return this.defaultRewrite()},t.prototype.visitEntityAggr=function(e){return this.defaultRewrite()},t.prototype.visitHierarchy=function(e){return this.defaultRewrite()},t.prototype.visitHierarchyLevel=function(e){return this.defaultRewrite()},t.prototype.visitHierarchyLevelAggr=function(e){return this.defaultRewrite()},t.prototype.visitMeasure=function(e){return this.defaultRewrite()},t.prototype.visitPercentile=function(e){return this.defaultRewrite()},t.prototype.visitTransformOutputRoleRef=function(e){return this.defaultRewrite()},t.prototype.visitArithmetic=function(e){return this.defaultRewrite()},t.prototype.visitConstant=function(e){return this.defaultRewrite()},t.prototype.visitSparklineData=function(e){return this.defaultRewrite()},t.prototype.visitNativeVisualCalc=t.prototype.defaultRewrite=function(){return nL.rewrite(this.sqExpr)},t}();ar oL=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r,n){return u.assertValue(r,"expr"),r.accept(e.instance,n)},e.prototype.visitDefault=function(r,n){var i=pe(r);return i&&!i.percentOfRoleTotal&&(r=ge({percentOfRoleTotal:{baseExpr:i,roles:n}})),r},e.instance=new e,e}(Yr);ar lL={});var Gm=new Set(["powerbi.bab","powerbi.common.cultureInfo","powerbi.common.formattingLocale","powerbi.data.DataViewScopeIdentity","powerbi.ExtendedType","powerbi.extensibility.data","powerbi.extensibility.utils.axisType","powerbi.extensibility.utils.CartesianHelper","powerbi.extensibility.utils.chart.dataLabel","powerbi.extensibility.utils.chart.legend","powerbi.extensibility.utils.chart","powerbi.extensibility.utils.color","powerbi.extensibility.utils.ColumnUtil","powerbi.extensibility.utils.dataview.converterHelper","powerbi.extensibility.utils.dataview.DataRoleHelper","powerbi.extensibility.utils.dataview.DataViewObject","powerbi.extensibility.utils.dataview.DataViewObjects","powerbi.extensibility.utils.dataview.validationHelper","powerbi.extensibility.utils.dataview","powerbi.extensibility.utils.filter","powerbi.extensibility.utils.formatting.DateTimeUnit","powerbi.extensibility.utils.formatting.dateUtils","powerbi.extensibility.utils.formatting.DisplayUnitSystemType","powerbi.extensibility.utils.formatting.font","powerbi.extensibility.utils.formatting.numberFormat","powerbi.extensibility.utils.formatting.stringExtensions","powerbi.extensibility.utils.formatting.textMeasurementService","powerbi.extensibility.utils.formatting.TextProperties","powerbi.extensibility.utils.formatting.textUtil","powerbi.extensibility.utils.formatting.valueFormatter","powerbi.extensibility.utils.formatting.wordBreaker","powerbi.extensibility.utils.formatting","powerbi.extensibility.utils.interactivity.interactivityUtils","powerbi.extensibility.utils.interactivity","powerbi.extensibility.utils.MessageBox","powerbi.extensibility.utils.objects","powerbi.extensibility.utils.parser","powerbi.extensibility.utils.selection","powerbi.extensibility.utils.svg.CssConstants","powerbi.extensibility.utils.svg.shapes","powerbi.extensibility.utils.svg.touch","powerbi.extensibility.utils.svg","powerbi.extensibility.utils.telemetry","powerbi.extensibility.utils.test.dataViewBuilder","powerbi.extensibility.utils.test.helpers","powerbi.extensibility.utils.test.mocks","powerbi.extensibility.utils.test","powerbi.extensibility.utils.tooltip","powerbi.extensibility.utils.type.ArrayExtensions","powerbi.extensibility.utils.type.EnumExtensions","powerbi.extensibility.utils.type.ExtendedType","powerbi.extensibility.utils.type.JsonComparer","powerbi.extensibility.utils.type.LogicExtensions","powerbi.extensibility.utils.type.PixelConverter","powerbi.extensibility.utils.type.PrimitiveType","powerbi.extensibility.utils.type.Prototype","powerbi.extensibility.utils.type.RegExpExtensions","powerbi.extensibility.utils.type.StringExtensions","powerbi.extensibility.utils.type.TextSizeDefaults","powerbi.extensibility.utils.type.ValueUtil","powerbi.extensibility.utils.type","powerbi.extensibility.utils.yAxisPosition","powerbi.extensibility.utils","powerbi.extensibility.visual.Color","powerbi.extensibility.visual.FormatUtils","powerbi.extensibility.visual.LinkColorType","powerbi.extensibility.visual.LinkType","powerbi.extensibility.visual.Month","powerbi.extensibility.visual.PositionType","powerbi.extensibility.visual","powerbi.extensibility.visualApiVersions","powerbi.extensibility.VisualPlugin","powerbi.extensibility","powerbi.FilterAction","powerbi.formattingService._currentCulture","powerbi.formattingService._currentCultureSelector","powerbi.PrivilegeStatus","powerbi.reportServerHost","powerbi.SelectionIdBuilder","powerbi.session.userInfo","powerbi.session","powerbi.SortDirection","powerbi.VisualEventType","powerbi.VisualObjectInstance","powerbi.VisualObjectInstanceEnumerationObject","powerbi.visuals.DataEntrySlicers.Slicers.Page","powerbi.visuals.DataEntrySlicers.Slicers.URL","powerbi.visuals.DataEntrySlicers.Slicers","powerbi.visuals.DataEntrySlicers","powerbi.visuals.dataLabelUtils","powerbi.visuals.DateUtil","powerbi.visuals.DonutChart","powerbi.visuals.DonutChartWebBehavior","powerbi.visuals.filter","powerbi.visuals.plugins.debugVisual","powerbi.visuals.plugins","powerbi.visuals.SelectionIdBuilder","powerbi.visuals.valueFormatter","powerbi.VisualUpdateType.36"]);unction hL(){window.powerbi=function(t,e){return new Proxy(t,Qm("powerbi",3))}(la())}function jm(t,e){if(t.matrix||u.assert(function(){return function(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;var n=e.columns.length;if(t.columns.length!==n)return!1;for(var i=0;i<n;i++)if(!Fu(t.columns[i],e.columns[i]))return!1;return!0}(t.metadata,e.metadata)},"Cannot merge data views with different metadata columns"),e.metadata.segment?t.metadata.segment=e.metadata.segment:delete t.metadata.segment,t.table&&e.table&&function(t,e){if(u.assertValue(t,"source"),u.assertValue(e,"segment"),!_.isEmpty(e.rows)){var r=e.lastMergeIndex+1;vn(t.rows,e.rows,r),u.assert("The existence of identity in the new segment is different than the source"),e.identity&&vn(t.identity,e.identity,r)}}(t.table,e.table),t.categorical&&e.categorical&&function(t,e){if(u.assertValue(t,"source"),u.assertValue(e,"segment"),u.assert(function(){return _.size(t.categories)===_.size(e.categories)},"pre-condition: source categories and segment categories should have the same length"),u.assert("pre-condition: the identity property of all category columns are expected to be the same array object"),!_.isEmpty(t.categories)&&!_.isEmpty(e.categories)){for(var r=e.lastMergeIndex+1,n=e.categories.length,i=function(f){var d=e.categories[f],p=t.categories[f];u.assert(function(){return Fu(p.source,d.source)},"Source and segment category have different sources."),u.assert("Source category is missing values but has identities."),d.values&&vn(p.values,d.values,r)},a=0;a<n;a++)i(a);e.categories[0].identity&&vn(t.categories[0].identity,e.categories[0].identity,r)}if(t.values&&e.values){var o=e.values.length;u.assert("Source and segment values have different lengths.");for(var s=function(f){var d=e.values[f],p=t.values[f];u.assert("Source and segment value have different sources."),!p.values&&d.values&&(p.values=[]);var h=e.lastMergeIndex+1;d.values&&vn(p.values,d.values,h),d.highlights&&vn(p.highlights,d.highlights,h)},l=0;l<o;l++)s(l)}}(t.categorical,e.categorical),t.tree&&e.tree&&Jc(t.tree.root,e.tree.root,!0),t.matrix&&e.matrix){u.assertValue(t.matrix.rows,"source.matrix.rows"),u.assertValue(t.matrix.rows.levels,"source.matrix.rows.levels"),u.assertValue(e.matrix.rows,"segment.matrix.rows"),u.assertValue(e.matrix.rows.levels,"segment.matrix.rows.levels"),u.assertValue(t.metadata,"source.metadata"),u.assertValue(t.metadata.columns,"source.metadata.columns"),u.assertValue(e.metadata,"segment.metadata"),u.assertValue(e.metadata.columns,"segment.metadata.columns");var r=t.matrix.rows.levels.length,n=e.matrix.rows.levels.length;if(r>n)_.remove(t.metadata.columns,function(c){return null!=c.index&&!_.some(e.metadata.columns,function(f){return f.index===c.index})}),t.metadata.columns.length=e.metadata.columns.length,function(t,e){var r=e.levels.length;t.levels.length=r,u.assert(function(){return _.isEqual(t.levels,e.levels)},"Segments have different levels");var n=[];Yc(t.root.children,r-1,n);for(var i=0,a=n;i<a.length;i++)SL(a[i])}(t.matrix.rows,e.matrix.rows);else if(r<n){for(var a=0,o=0,s=_.filter(e.metadata.columns,;o<s.length;o++){for(var l=s[o];a<t.metadata.columns.length&&(null==t.metadata.columns[a].index||t.metadata.columns[a].index<l.index);)a++;t.metadata.columns.splice(a,0,l)}!function(t,e){for(var r=e.levels.length,n=t.levels.length,i=n;i<r;i++)t.levels.push(e.levels[i]);u.assert("Segments have different levels");var a=[];Yc(t.root.children,n-1,a);for(var o=0,s=a;o<s.length;o++)CL(s[o],n);(function(t,e){for(var r=t.root,n=0;n<e;n++)if(_.isEmpty(r.children)||(u.assertValue(r=r.children[0],"Segment has fewer levels than expected"),!r.isMerge||r.isSubtotal))return!1;return!0})(e,n)&&delete _.last(a).children}(t.matrix.rows,e.matrix.rows)}Jc(t.matrix.rows.root,e.matrix.rows.root,r!==n)}}unction Jc(t,e,r){if(u.assertValue(t,"sourceRoot"),u.assertValue(e,"segmentRoot"),e.children&&0!==e.children.length){if(r&&(!t.children||0===t.children.length))return void(t.children=e.children);u.assert("Source tree has different structure than segment.");var n=function(t){if(0===t.length)return 0;for(var e=0;e<t.length&&t[e].isMerge;e++);return e}(e.children),i=t.children[t.children.length-1],a=vn(t.children,e.children,n);a.length>0&&Jc(i,a[a.length-1],r)}}unction CL(t,e){t.isSubtotal||(u.assert("Leaf was found on a non-last level"),u.assert("Node has children"),t.children=[{isSubtotal:!0,level:e,values:t.values}],delete t.values)}function Yc(t,e,r){u.assertValue(t,"nodes");for(var n=0,i=t;n<i.length;n++){var a=i[n];a.isSubtotal||(a.level===e?r.push(a):!_.isEmpty(a.children)&&void 0!==a.level&&a.level<e&&Yc(a.children,e,r))}}var $c="children",wL=function(){function t(){this.serializeDataViewFromScrathTimes=0,this.matrixIdentityToValueMapper=new Map,this.initializeFields()}return t.prototype.serializeDataViewForCv=function(e,r,n,i,a,o,s){var l=this;if(void 0===o&&(o=!1),void 0===s&&(s=!1),n||(this.initializeFields(),this.serializeDataViewFromScrathTimes=(this.serializeDataViewFromScrathTimes+1)%11617),e){e=this.filterDataViewsType(e,r),this.isExpandCollapseSupported=!!e.matrix&&!!r.expandCollapse,this.isExpandCollapseSupported&&(n&&(u.assert(function(){return!_.isEmpty(a)},"lastNodeIndex should be defined and not empty when we load more data"),this.lastNodeIndex=a),e.matrix.rows.levels.forEach();var c=this.getValueSource(e),f=this.getValueGroups(e);this.shouldShareIdentityIndexStrategy=o&&!!e.matrix,s&&(s=!!e.matrix&&function(t){var e=ml(t.objects,BM),r=null==e?void 0:e.type;return!(!r||!r.filter||r.filter.selfFilter)}(r));var d=JSON.stringify(e,;return u.assert(function(){return _.isEmpty(l.stackNodeIndex)},"stackNodeIndex should be empty"),{valueSource:c,valueGroups:f,stringifiedDataView:d}}},t.prototype.serializeDataViewMetadata=t.prototype.deserializeDataView=t.prototype.convertOpaqueIdentitiesToScopeIds=t.prototype.getDataViewScopeIdentityByCustomVisualOpaqueIdentity=t.prototype.convertCVSelectionIdToPowerbiSelctionId=function(e){var r=this,n=JSON.parse(JSON.stringify(e),function(i,a){return r.replaceOpaqueIdentitiesWithDataViewScopeIdentities(i,a)});return $a.createWithSelectorForColumnAndMeasures(n.dataMap,n.measures)},t.prototype.restoreIdentitiesIndexesFromSelectionId=function(e){var r=this,n={serializedDataMap:{},measures:e.metadata};return _.map(e.dataMap,function(i,a){u.assert("dataMap can only have one selector per column"),n.serializedDataMap[a]=[{identityIndex:r.ensureIdentityIsMapped(i[0])}]}),n},t.prototype.getNodeIndexOfSelectionId=t.prototype.sortSelectionIdAccordingToRows=t.prototype.deserializeVisualObjectInstance=t.prototype.deserializeOpaqueIdentity=t.prototype.flushIdentitiesArray=t.prototype.getCustomVisualOpaqueIdentityByDataViewScopeIdentity=t.prototype.getDataViewValueByCustomVisualOpaqueIdentity=function(e){var r=e.identityIndex;if(r>=0)return this.matrixIdentityToValueMapper.get(r)},t.prototype.getValueGroups=t.prototype.getValueSource=t.prototype.deserializeDataViewHelper=t.prototype.replacer=function(e,r,n,i){var o,s,a=this;if(void 0===i&&(i=!1),r){if(i&&r.levelValues&&this.isDataViewScopeIdentity(r.identity)&&this.valuesStack.push(null===(s=null===(o=r.levelValues)||void 0===o?void 0:o[0])||void 0===s?void 0:s.value),!this.shouldShareIdentityIndexStrategy&&this.isExpandCollapseSupported&&!isNaN(parseInt(e,10))&&r.identity&&this.isDataViewScopeIdentity(r.identity)&&(this.stackNodeIndex.push(parseInt(e,10)+this.getNodeIndexOffset(r)),r.needOffset&&delete r.needOffset),this.isDataViewScopeIdentity(r)){if(r.serializeDataViewFromScrathTimes===this.serializeDataViewFromScrathTimes&&r.opaqueIdentity&&null!=r.opaqueIdentity.identityIndex){if(this.stackNodeIndex.length){var l=this.stackNodeIndex.pop();null==this.identityNodeIndexArray[r.opaqueIdentity.identityIndex]&&(this.identityNodeIndexArray[r.opaqueIdentity.identityIndex]=l)}return{identityIndex:r.opaqueIdentity.identityIndex}}u.assert("The new segment's values should not have opaqueIdentity"),r.serializeDataViewFromScrathTimes=this.serializeDataViewFromScrathTimes;var c=-1;return this.shouldShareIdentityIndexStrategy&&(c=this.getIndexOfIdentity(r))>-1?(r.opaqueIdentity={identityIndex:c},this.valuesStack.pop()):(r.opaqueIdentity={identityIndex:this.identitiesArray.length},this.shouldShareIdentityIndexStrategy&&(this.identitiesIndexesMapper[r.key]=this.identitiesArray.length),this.valuesStack.length&&this.matrixIdentityToValueMapper.set(this.identitiesArray.length,this.valuesStack.pop()),this.identitiesArray.push(r)),this.stackNodeIndex.length&&(this.identityNodeIndexArray[r.opaqueIdentity.identityIndex]=this.stackNodeIndex.pop()),r.opaqueIdentity}if(r instanceof Array){var f=[];if(!this.shouldShareIdentityIndexStrategy&&this.isExpandCollapseSupported&&e===$c&&r.length&&r[0].isMerge)for(var d=0,p=r;d<p.length;d++){var h=p[d];h.identity&&(h.needOffset=!0)}if(n&&e===$c)for(var v=0;v<r.length;v++)if(r[v]&&(r[v].value&&r[v].value instanceof Date&&(r[v].isDate=!0),r[v].values))for(var g in r[v].values)r[v].values[g].value&&r[v].values[g].value instanceof Date&&(r[v].values[g].isDate=!0);return f.push.apply(f,r||[]),f}if("object"==typeof r&&!this.dontNeedToClone(r)){var y={};for(var m in r)y[m]=r[m];return y}}return r},t.prototype.replaceOpaqueIdentities=function(e){if(e){var r=e.identityIndex;if(void 0!==r&&r>=0&&r<this.identitiesArray.length)return Vc(this.identitiesArray[e.identityIndex])}return e},t.prototype.getNodeIndexOffset=function(e){var r=this;return this.isExpandCollapseSupported&&!_.isEmpty(this.lastNodeIndex)&&e.needOffset?(u.assert("node's level is too high"),this.lastNodeIndex[e.level]):0},t.prototype.getIndexOfIdentity=function(e){if(this.shouldShareIdentityIndexStrategy){var r=this.identitiesIndexesMapper[e.key];return null!=r?r:-1}return _.findIndex(this.identitiesArray,function(n){return Vi(n,e)})},t.prototype.ensureIdentityIsMapped=t.prototype.replaceOpaqueIdentitiesWithDataViewScopeIdentities=t.prototype.filterDataViewsType=t.prototype.dontNeedToClone=t.prototype.isDataViewScopeIdentity=t.prototype.reconstructValuesSource=t.prototype.reconstructValuesGroups=t.prototype.replaceOpaqueIndexWithScopeIds=t.prototype.initializeFields=function(){this.identitiesArray=[],this.identityNodeIndexArray={},this.stackNodeIndex=[],this.rowsLevel=[],this.lastNodeIndex=[],this.identitiesIndexesMapper={},this.shouldShareIdentityIndexStrategy=!1,this.matrixIdentityToValueMapper.clear(),this.valuesStack=[]},t}(),jo_AzureKey="xfefTl4ZST_fZb9l-IT5EpZqJGKpqQOsHTXeyoi3zeQ",Ut_MaxBingRequest=6,Ut_MaxCacheSize=3e3,Ut_MaxCacheSizeOverflow=100,Ut_MaxPersistedSpace=24e5,Ut_MaxAge=43200,Ut_BingKey="AoW85FdF-eTJavFmWhZjaQ970kwG1FuainbyVSlP5HglkbhVVIFOyNwlaQxAIj-S",ce={Address:"Address",City:"City",Continent:"Continent",CountryRegion:"Country",County:"County",Longitude:"Longitude",Latitude:"Latitude",Place:"Place",PostalCode:"PostalCode",StateOrProvince:"StateOrProvince"},kL=".".concat("mapLassoButton"),Km=(".".concat("NavBar_Container"),".".concat("plot-area"),"NavBar_zoomIn"),Jm="NavBar_zoomOut";unction Ko(t){var e=t);return{baseUrl:e?t.slice(0,t.indexOf("?")):t,queryParameters:rS(e)}}.".concat(Km,", .").concat(Jm),"".concat(kL,", .").concat(Km,", #").concat(Jm);var _t,ur,Ye={Continent:"Continent",Sovereign:"Sovereign",CountryRegion:"CountryRegion",AdminDivision1:"AdminDivision1",AdminDivision2:"AdminDivision2",PopulatedPlace:"PopulatedPlace",Postcode:"Postcode",Postcode1:"Postcode1",Neighborhood:"Neighborhood",Address:"Address"},Ki="2023-06-01",nS="https://platform.bing.com/geo/spatial/v1/public/Geodata",iS="https://dev.virtualearth.net/REST/v1/Locations",aS="https://atlas.microsoft.com/geocode",oS="https://atlas.microsoft.com/search/polygon",fB={adminDistrict:"AdminDistrict",locality:"Locality",postalCode:"PostalCode",addressLine:"AddressLine",countryRegion:"CountryRegion"},dB={AdminDistrict:"adminDistrict",Locality:"locality",PostalCode:"postalCode",AddressLine:"addressLine",CountryRegion:"countryRegion"};function Jo(t){return _t||((_t={})[ce.Continent.toLowerCase()]=Ye.Continent,_t[ce.CountryRegion.toLowerCase()]=Ye.Sovereign,_t[ce.StateOrProvince.toLowerCase()]=Ye.AdminDivision1,_t[ce.County.toLowerCase()]=Ye.AdminDivision2,_t[ce.City.toLowerCase()]=Ye.PopulatedPlace,_t[ce.PostalCode.toLowerCase()]=Ye.Postcode,_t[ce.Address.toLowerCase()]=Ye.Address),t&&_t[t.toLowerCase()]||""}function Yo(t){return ur||((ur={})[ce.CountryRegion.toLowerCase()]=Ye.CountryRegion,ur[ce.StateOrProvince.toLowerCase()]=Ye.AdminDivision1,ur[ce.County.toLowerCase()]=Ye.AdminDivision2,ur[ce.City.toLowerCase()]=Ye.PopulatedPlace,ur[ce.PostalCode.toLowerCase()]=Ye.Postcode1),t&&ur[t.toLowerCase()]||""}function Ji(){var e=ya.getLanguage());return e}nction $o(t){nt.information("georequest",void 0,t)}function Xo(t,e){nt.error("geocoding IndexedDB ".concat(t," failure"),!0,void 0,e)}var Wn,Zo={}),gB=((Wn={})[iS]="G",Wn[nS]="S",Wn[aS]="AG",Wn[oS]="AS",Wn),lS={Sovereign:"countryRegion",CountryRegion:"countryRegion",AdminDivision1:"adminDistrict",AdminDivision2:"adminDistrict",PopulatedPlace:"locality",Postcode:"postalCode",Postcode1:"postalCode",Neighborhood:"locality",Address:"addressLine"},cS={Sovereign:"countryRegion",CountryRegion:"countryRegion",AdminDivision1:"adminDistrict",AdminDivision2:"adminDistrict",PopulatedPlace:"locality",Postcode:"postalCode",Postcode1:"postalCode",Neighborhood:"locality",Address:"addressLine"},fS={Continent:"continent",CountryRegion:"countryRegion",AdminDivision1:"adminDistrict",AdminDivision2:"adminDistrict2",AdminDivision3:"adminDistrict3",PopulatedPlace:"locality",Postcode1:"postalCode",Postcode2:"postalCode2",Postcode3:"postalCode3",Postcode4:"postalCode4",Neighborhood:"neighborhood"},Yi=function(){eturn t.prototype.removeRegion=function(e){return u.assert("should be a valid azure maps url, but received ".concat(e)),e.slice(0,8)+e.slice(e.indexOf("atlas.microsoft.com"))},t.prototype.getKey=function(){return this.key},t.prototype.getAjaxConfig=t}(),es=function(t){eturn T(e,t),e.prototype.getCulture=function(){return this.location.culture},e.prototype.getBingEntity=function(){return Jo(_.last(this.location.components).category)},e.prototype.validate=function(){return null!=this.getEntity()},e.prototype.getEntity=function(){var r=this.getGeocodingParameters();if(_.some(r,function(d){return!d.key})){var n=_.chain(r).map(function(d){return d.value}).filter(function(d){return d}).reverse().value().join(", ");return n?{Query:n}:void 0}for(var i={Address:{}},a=i.Address,o=0,s=r;o<s.length;o++){var l=s[o],c=l.value;if(!c||!(c=c.trim()))return;var f=l.key;"adminDistrict"===f&&a.AdminDistrict?a.AdminDistrict=l.value+", "+a.AdminDistrict:a[fB[f]]=l.value}return i},e.prototype.getUrl=function(r){var n={key:this.credentials||Ut_BingKey},i=this.getEntity();if(i){var a=i.Address;if(a)for(var o in a)n[dB[o]]=a[o];else n.q=i.Query;var s=this.location.culture||Ji();return s&&(n.c=s),n.maxRes="10",jn(r,n,!0)}},e.prototype.getGeocodingParameters=function(){var r=this.location.components;return r.length>=2&&r[0].category===ce.Continent&&r[1].category===ce.CountryRegion&&(r=_.tail(r)),_.map(r,function(i){var a=Jo(i.category),o="";a in lS&&(o=lS[a]);var s=i.query;return a===Ye.Sovereign&&s&&(s=e.Iso3166Substitutions[s]||s),{key:o,value:s}})},e.prototype.isGeneralQuery=function(){return _.some(this.getGeocodingParameters(),function(r){return!r.key})},e.prototype.getResult=e.prototype.shouldDoFullGeocoding=function(r){var n=r&&r.resourceSets&&r.resourceSets[0]&&r.resourceSets[0].resources&&r.resourceSets[0].resources[0];if(!n||n.matchCodes))return!1;var i=this.getBingEntity().toLowerCase(),a=n.entityType&&n.entityType.toLowerCase();return"admindivision1"===i&&"admindivision2"===a||"admindivision2"===i&&"admindivision1"===a},e.prototype.extractSingleResult=e.prototype.locationQuality=function(r,n){if(!n&&r.matchCodes&&!sS(r.matchCodes))return-1;var i=0;if(1===this.location.components.length&&this.location.components[0].category===ce.CountryRegion){var a=r.address&&r.address.countryRegionIso2;if(a){var o=this.location.components[0].query.toLowerCase();2===o.length&&o===a.toLowerCase()&&(i+=2)}}return r.entityType&&r.entityType.toLowerCase()===this.getBingEntity().toLowerCase()&&(i+=1),i},e.Iso3166Substitutions={BI:"Burundi",BQ:"Bonaire",SJ:"Svalbard",BES:"Bonaire",NGA:"Nigeria",NAM:"Namibia",SJM:"Svalbard",MAF:"MF",SA:"Saudi Arabia"},e}(Yi),ts=function(t){function e(r,n,i,a,o,s,l){void 0===l&&(l="subscriptionKey");var c=t.call(this,n,r,i,a)||this;return c.apiVersion=o,c.credentials=s,c.credentialType=l,u.assert(function(){return"subscriptionKey"===l||!!s},"credentials must be provided when using Azure Maps SAS Token"),c}return T(e,t),e.prototype.getCulture=function(){return this.location.culture},e.prototype.validate=e.prototype.getEntity=e.prototype.getUrl=function(r){var n={},i=this.getEntity();if(!_.isEmpty(i)){for(var a in i)n[a]=i[a];return n.top="10",n["api-version"]=this.apiVersion,jn(r,n,!0)}},e.prototype.getGeocodingParameters=function(){var r=this.location.components;return r.length>=2&&r[0].category===ce.Continent&&r[1].category===ce.CountryRegion&&(r=_.tail(r)),_.map(r,function(i){var a=Jo(i.category),o="";a in cS&&(o=cS[a]);var s=i.query;return a===Ye.Sovereign&&s&&(s=e.Iso3166Substitutions[s]||s),{key:o,value:s}})},e.prototype.isGeneralQuery=e.prototype.getResult=e.prototype.extractSingleResult=e.prototype.getBingEntity=function(){return Jo(_.last(this.location.components).category)},e.prototype.locationQuality=function(r,n){var i;if(!n&&r.properties&&r.properties.matchCodes&&!sS(r.properties.matchCodes))return-1;var a=0;if("High"===(null===(i=r.properties)||void 0===i?void 0:i.confidence)&&(a+=3),1===this.location.components.length&&this.location.components[0].category===ce.CountryRegion){var o=r.properties&&r.properties.address&&r.properties.address.countryRegion&&r.properties.address.countryRegion.ISO;if(o){var s=this.location.components[0].query.toLowerCase();2===s.length&&s===o.toLowerCase()&&(a+=2)}}return r.properties&&r.properties.type&&r.properties.type.toLowerCase()===this.getBingEntity().toLowerCase()&&(a+=1),a},e.prototype.getHeaders=function(){var r;r="sasToken"===this.credentialType?{Authorization:"jwt-sas ".concat(this.credentials)}:{"subscription-key":this.credentials||jo_AzureKey};var n=this.getCulture()||Ji();return n&&(r["Accept-Language"]=n),r},e.prototype.getAjaxConfig=function(){return{type:"GET",dataType:"json"}},e.Iso3166Substitutions={BI:"Burundi",BQ:"Bonaire",SJ:"Svalbard",BES:"Bonaire",NGA:"Nigeria",NAM:"Namibia",SJM:"Svalbard",MAF:"MF"},e}(Yi);ar Pe,we,Xi,yB=function(t){eturn T(e,t),e.prototype.validate=function(){return!0},e.prototype.getUrl=function(r){var n=this;u.assert(function(){return n.entities.every(function(s){return!!_.findKey(Ye,function(l){return l===s})})},"All entities should match one of the allowed BingEntities");var i=Ko(r),a=_.endsWith(i.baseUrl,"/")?i.baseUrl:i.baseUrl+"/";a+=[this.latitude,this.longitude].join();var o={key:this.credentials||Ut_BingKey,include:"ciso2"};return _.isEmpty(this.entities)||(o.includeEntityTypes=this.entities.join()),jn(a,o,!0)},e.prototype.getResult=e}(Yi),rs=function(t){eturn T(e,t),e.prototype.getBingEntity=function(){return Yo(_.last(this.location.components).category)},e.prototype.validate=function(){return!(!this.entityType&&!this.getBingEntity())},e.prototype.getUrl=function(r){var n=this.entityType||this.getBingEntity();if(!n)return null;var i=Ko(r),a=i.baseUrl,o=i.queryParameters;o||(o={});var s=o.c||o.culture,l=s||"",c=s&&function(t){switch(t=t.toUpperCase()){case"ZH-HANS":case"ZH-HANT":return"CN"}var e=t.split("-",2);return e.length>1?e[1]:""}(s)||"";return o.key=this.credentials||Ut_BingKey,o.$format="json",o.SpatialFilter="GetBoundary("+[this.latitude,this.longitude,this.levelOfDetail,"'"+n+"'",1,0,"'"+l+"'","'"+c+"'"].join(", ")+")",delete o.c,delete o.culture,jn(a,o,!0)},e.prototype.getResult=e}(Yi),ns=function(t){function e(r,n,i,a,o,s,l,c,f,d,p,h){void 0===f&&(f=3),void 0===h&&(h="subscriptionKey");var v=t.call(this,{components:[{query:[s,l,c,f].join(",")+(d!==Yo(n)?","+d:""),category:n}]},r,i,a)||this;return v.apiVersion=o,v.latitude=s,v.longitude=l,v.levelOfDetail=c,v.maxGeoData=f,v.entityType=d,v.credentials=p,v.credentialType=h,u.assert("credentials must be provided when using Azure Maps SAS Token"),v}return T(e,t),e.prototype.getBingEntity=e.prototype.getResolution=e.prototype.validate=e.prototype.getUrl=function(r){var n,i,a=null!==(n=this.entityType)&&void 0!==n?n:this.getBingEntity();return""!==a&&a in fS&&(i=fS[a]),i?jn(r,{coordinates:"".concat(this.longitude,",").concat(this.latitude),view:"".concat("Auto"),resultType:i,resolution:"".concat(this.getResolution()),"api-version":this.apiVersion},!0):null},e.prototype.getResult=e.prototype.getHeaders=function(){var r;(r="sasToken"===this.credentialType?{Authorization:"jwt-sas ".concat(this.credentials)}:{"subscription-key":this.credentials||jo_AzureKey}).Accept="application/json";var n=Ji();return n&&(r["Accept-Language"]=n),r},e.prototype.getAjaxConfig=e}(Yi),mB=),SB=function(){eturn t.prototype.getData=function(e){return this.cache[e]},t.prototype.setData=function(e,r,n){var i=this;this.cache[e]=r,null==this.clearCacheTimerId&&(this.clearCacheTimerId=setTimeout(function(){return i.clearCache()},this.clearCacheInterval))},t.prototype.clearCache=t.defaultClearCacheInterval=864e5,t}(),EB=new mB,CB=(new SB,/^V:[12]-|^g:.* s:|(address|city|continent|country|county|postalcode|stateorprovince)$/);function hS(t,e){return"`"+t+"-"+e}function(t){Pe=EB,we=t,Xi={}}();var MB=function(){eturn t.prototype.getData=t.prototype.setData=function(e,r,n){if(!this.disabled){if(!(we=Zc()))return void(this.disabled=!0);var i=hS(this.cacheName,e),a=Pe.getData(i);void 0===r?this.removeEntry(i,a):this.setEntry(i,a,r,n)}},t.prototype.removeEntry=t.prototype.setEntry=function(e,r,n,i){var a=we.caches[this.cacheName];if(!a)return this.disabled=!0,void Fr("error","Did't find cache metadata for ".concat(this.cacheName," in directory ").concat(JSON.stringify(we)));var o=as(a.added),s=r&&r.id;s?(r.added=o,a.size-=r.size):r={id:s=a.nextId++,added:o,size:0};var l=Zi(this.cacheName,s),c=JSON.stringify(n);r.size=c.length+e.length+l.length,r.size+=JSON.stringify(r).length,r.size+=1,a.size+=r.size,a.size>this.maxSpace&&(i&&i(),ef(this.cacheName),a.added=Date.now(),a.nextId=2,r.added=as(a.added),r.id=1,l=Zi(this.cacheName,r.id),r.size=c.length+e.length+l.length,r.size+=JSON.stringify(r).length,r.size+=1,a.size=r.size),_r(),Pe.setData(e,r),Pe.setJSONData(l,c)},t}();unction gS(){if(we=Zc()){if("2"===we.version)return;Fr("information","Clearing old verion ".concat(we.version," localStorage entries")),tf(}else Fr("information","Clearing obsolete localStorage entries"),tf(function(t){return CB.test(t)});we={version:"2",caches:{}},_r(),yS()}ction ef(t){var e=function(t){return new RegExp("^`"+t+"-")}(t),r=t);tf(}unction Fr(t,e){var r=window.jsCommon;!r||!r.Trace||nt[t]("localStorageCache: "+e)}var os,IB=function(){eturn t.prototype.clear=function(e,r){return et(this,void 0,void 0,function(){return tt(this,function(n){switch(n.label){case 0:return e&&r.isSupported()?[4,r.clear()]:[3,2];case 1:n.sent(),n.label=2;case 2:return function(t){ef(t),gS();var e=we.caches.G;e&&(Xi.G?we.caches.G={version:e.version,size:0,nextId:1,added:Date.now()}:delete we.caches.G,_r())}("G"),this.geocodeCache={},this.geocodeCacheCount=0,[2]}})})},t.prototype.getCoordinates=function(e,r,n,i){return et(this,void 0,void 0,function(){var a,o,s;return tt(this,function(l){switch(l.label){case 0:return a=e.getKey(),(o=this.geocodeCache[a])?(++o.hitCount,[2,o.coordinate]):n&&i.isSupported()?[4,i.get(a)]:[3,2];case 1:return s=l.sent(),[3,3];case 2:s=this.localStorageCache.getData(a),l.label=3;case 3:return s?(r&&r.logFirstQueryHit(e),this.registerInMemory(a,s,r,n,i),[2,s]):(void 0===o&&(r&&r.logFirstQueryMiss(e),this.markPendingInMemory(a)),[2])}})})},t.prototype.getCoordinatesMemoryOnly=function(e,r){var n=e.getKey(),i=this.geocodeCache[n];if(i)return++i.hitCount,i.coordinate},t.prototype.registerCoordinates=function(e,r,n,i,a){return et(this,void 0,void 0,function(){var o;return tt(this,function(s){switch(s.label){case 0:return this.registerInMemory(e,r,n,i,a),o=t.getCoordinateToCache(r),i&&a.isSupported()?[4,a.set(e,o,function(){return n.logGeocodeCacheLimitExceeded(!0)})]:[3,2];case 1:return s.sent(),[3,3];case 2:this.localStorageCache.setData(e,o,,s.label=3;case 3:return[2]}})})},t.prototype.markPendingInMemory=t.prototype.registerInMemory=function(e,r,n,i,a){var o=this.geocodeCache,s=this.maxMemoryCacheSize,l=s+this.maxMemoryCacheSizeOverflow;if(this.geocodeCacheCount>=l){n&&n.disableFirstQueryLogging();var c=Object.keys(o),f=c.length;if(c.sort(,f<2*l)for(var d=s-1;d<f;d++)o[c[d]]=void 0;else{var p={};for(d=s-1;d-- >0;)p[c[d]]=o[c[d]];o=this.geocodeCache=p}this.geocodeCacheCount=s}i&&a.isSupported()&&null==r&&(r={latitude:void 0,longitude:void 0}),o[e]={coordinate:r,hitCount:1},++this.geocodeCacheCount},t.getCoordinateToCache=function(e){var r=null==e?void 0:e.locations;if(!r||!t.hasRuntimeBoundaryData(r))return e;var n={latitude:e.latitude,longitude:e.longitude,locations:_.map(r,function(i){return{nativeBing:i.nativeBing}})};return e.entityType&&(n.entityType=e.entityType),n},t.hasRuntimeBoundaryData=t}();function ss(){return os||(os=function(t,e,r,n,i){return new IB(t,e,function(t,e,r,n){gS();var i=Xi.G;if(!i){Fr("information","ensuring localStorageCache ".concat(t));var a=we.caches.G;a&&a.version!==e&&(Fr("information","Clearing old version cache ".concat(t)),ef(t),delete we.caches.G,_r(),a=void 0),i=new MB(t,r,n),Xi.G=i,a||(Fr("information","Adding initial cache metadata for ".concat(t)),we.caches.G={version:e,size:0,nextId:1,added:Date.now()},_r(),yS())}return i}("G",i,r,n))}(Ut_MaxCacheSize,Ut_MaxCacheSizeOverflow,Ut_MaxPersistedSpace,Ut_MaxAge,"4")),os} ES=);function ea(t,e,r){t&&(e instanceof es?t.logGeocodeImmediate(e,r):e instanceof rs?t.logGeocodeBoundaryImmediate(e,r):e instanceof ts?t.logAzureMapsGeocodeImmediate(e):e instanceof ns&&t.logAzureMapsGeocodeBoundaryImmediate(e))}function ls(t,e,r,n,i){t&&(e instanceof es?t.logGeocodeResult(e,r,n,i):e instanceof rs?t.logGeocodeBoundaryResult(e,r,n,i):e instanceof ts?t.logAzureMapsGeocodeResult(e,r,n,i):e instanceof ns&&t.logAzureMapsGeocodeBoundaryResult(e,r,n,i))}var FB=function(){function t(e,r){this.useBatchGeocoding=e,this.bypassGeocodingCache=r}return t.prototype.geocodeBaseUrl=t.prototype.geocodeQueueType=t.prototype.geocode=function(e,r,n,i,a,o){u.assert(function(){return 1===r||"sasToken"!==(null==a?void 0:a.credentialType)},"SASToken credential type is only supported for Azure Maps");var s=Di().defer(),l=this.geocodeQueueType(r),c=1===r?new ts(this.azureMapsGeocodingUrl(),e,!0,o,Ki,a&&a.credentials,a&&a.credentialType):new es(this.bingGeocodingUrl(),e,a&&a.credentials);return this.geocodeCore(l,c,n,i,a).pipe(function(f){return s.resolve(f)},function(f){return s.reject(f)}),s.promise},t.prototype.geocodeBoundary=function(e,r,n,i,a,o){u.assert("SASToken credential type is only supported for Azure Maps");var s=e.latitude,l=e.longitude,c=e.category,f=void 0===c?"":c,d=e.levelOfDetail,p=void 0===d?2:d,h=e.maxGeoData,v=void 0===h?3:h,g=e.entityType,y=1===r?5:1,m=1===r?new ns(this.azureMapsBoundaryUrl(),f,!0,o,Ki,s,l,p,v,g,a&&a.credentials,a&&a.credentialType):new rs(this.bingSpatialDataUrl(),s,l,f,p,v,g,a&&a.credentials);return this.geocodeCore(y,m,n,i,a)},t.prototype.geocodePoint=function(e,r,n,i,a,o){return this.geocodeCore(2,new yB(this.bingGeocodingUrl(),e,r,a,o&&o.credentials),n,i,o)},t.prototype.tryGeocodeImmediate=function(e,r,n,i,a){return et(this,void 0,void 0,function(){var o,s,l;return tt(this,function(c){switch(c.label){case 0:return this.bypassGeocodingCache()?[2]:(o=1===r?new ts(this.azureMapsGeocodingUrl(),e,!0,a,Ki):new es(this.bingGeocodingUrl(),e),s=this.bingGeocodingLogger(),[4,SS(o,s,n,i)]);case 1:return l=c.sent(),ea(s,o,l),[2,l]}})})},t.prototype.tryGeocodeBoundaryImmediate=function(e,r,n,i,a){return et(this,void 0,void 0,function(){var o,s,l,c,f,d,p,h,v,g;return tt(this,function(y){switch(y.label){case 0:return this.bypassGeocodingCache()?[2]:(o=e.latitude,s=e.longitude,l=e.category,c=e.levelOfDetail,d=void 0===(f=e.maxGeoData)?3:f,p=e.entityType,h=1===r?new ns(this.azureMapsBoundaryUrl(),l,!0,a,Ki,o,s,c,d,p):new rs(this.bingSpatialDataUrl(),o,s,l,c,d,p),v=this.bingGeocodingLogger(),[4,SS(h,v,n,i)]);case 1:return g=y.sent(),ea(v,h,g),[2,g]}})})},t.prototype.geocodeCore=function(e,r,n,i,a){var o=$.Deferred();if(r.validate()){var s=this.bingGeocodingLogger(),l=a&&null!=a.bypassCache?a.bypassCache:this.bypassGeocodingCache(),c=!l&&rf(r,s);if(c)ea(s,r,c),o.resolve(c);else{var f=a&&a.timeout,d=3===e||6===e,p=function(t,e,r,n,i,a,o){var s=t.toString()+e+(r||"");(3===t||6===t)&&o&&(s+=o);var c=ta[s];if(!c){var f=Ko(e),d=f.queryParameters;switch("/"===(e=f.baseUrl)[e.length-1]&&(e=e.substring(0,e.length-1)),t){case 6:c=new CS("".concat(e,":").concat("batch"),r,{batchGeocodeCulture:o,batchSize:50,batchRequest:function(h){return JSON.stringify({batchItems:_.map(h,function(v){return v.getEntity()})})},batchHeaders:function(h,v){var g={"Accept-Language":v||Ji()};return"sasToken"===a?g.Authorization="jwt-sas ".concat(h):g["subscription-key"]=h||jo_AzureKey,g},batchQueryParameters:function(h,v){return de(de({},d),{"api-version":Ki})},tryIndexedDB:n,indexedDBService:i,geocodeRetryOptions:{maxRetryAttempts:3,initialRetryIntervalInMs:1e3,retryOnStatusCodes:[429]}});break;case 3:c=new CS("".concat(e,"/").concat("multigeocode"),r,{batchGeocodeCulture:o,batchSize:30,batchRequest:batchHeaders:batchQueryParameters:function(h,v){return de(de({},d),{culture:v||Ji(),output:"json",key:h})},tryIndexedDB:n,indexedDBService:i});break;case 4:case 5:c=new bS(e,r,{tryIndexedDB:n,indexedDBService:i,geocodeRetryOptions:{maxRetryAttempts:3,initialRetryIntervalInMs:1e3,retryOnStatusCodes:[429]}});break;default:c=new bS(e,r,{tryIndexedDB:n,indexedDBService:i})}ta[s]=c}return c}(e,this.geocodeBaseUrl(e),a&&a.credentials,n,i,a&&a.credentialType,d&&r.getCulture?r.getCulture():void 0),h={timeout:f,geocoder:this,query:r,deferred:o,logger:this.bingGeocodingLogger(),bypassCache:l};p.enqueue(h),f&&a.timeout.finally(function(){h.deferred.state()===Ln[Ln.pending]&&h.deferred.reject()})}}else o.reject();return o},t}(),PB=function(t){eturn T(e,t),e.prototype.bingSpatialDataUrl=function(){return nS},e.prototype.bingGeocodingUrl=function(){return iS},e.prototype.bingGeocodingLogger=function(){return this.logger},e.prototype.azureMapsGeocodingUrl=function(){return aS},e.prototype.azureMapsBoundaryUrl=function(){return oS},e}(FB),CS=function(){eturn t.prototype.getGeocodeBatchSize=function(){return this.batchSize},t.prototype.setGeocodeBatchSize=function(e){u.assert("Invalid geocode batch size"),this.batchSize=e},t.prototype.reset=function(){var e=this.dequeueTimeout;e&&(this.dequeueTimeout=void 0,clearTimeout(e));for(var r=0,n=this.entries.concat(this.activeEntries);r<n.length;r++)this.cancel(n[r]);this.entries=[],this.activeEntries=[]},t.prototype.enqueue=function(e){var r=this,n={item:e};this.entries.push(n),e.deferred.always(function(){r.cancel(n)}),this.inDequeue||this.entries.length<this.batchSize||this.activeBatches>=Ut_MaxBingRequest?this.scheduleDequeue():(this.dequeueTimeout&&(clearTimeout(this.dequeueTimeout),this.dequeueTimeout=void 0),this.dequeue())},t.prototype.dequeue=function(){if(!this.inDequeue&&!this.dequeueTimeout)try{for(this.inDequeue=!0;0!==this.entries.length&&this.activeBatches<Ut_MaxBingRequest;){for(var e=[];0!==this.entries.length&&e.length<this.batchSize;){var r=this.entries.shift();if(!r.isCompleted){var n=!r.item.bypassCache&&rf(r.item.query,r.item.logger);n?(ea(r.item.logger,r.item.query,n),this.complete(r,{coordinates:n},!0)):e.push(r)}}e.length&&(this.geocodeRetryOptions?this.makeRequest(e,0,this.geocodeRetryOptions.initialRetryIntervalInMs):this.makeRequest(e))}}finally{this.inDequeue=!1}},t.prototype.scheduleDequeue=function(){var e=this;!this.dequeueTimeout&&0!==this.entries.length&&(this.dequeueTimeout=setTimeout(function(){e.dequeueTimeout=void 0,e.dequeue()}))},t.prototype.cancel=t.prototype.complete=function(e,r,n){var a,i=this,o=!1;if(!e.isCompleted&&(e.isCompleted=!0,e.item.deferred.state()===Ln[Ln.pending])){var s=this.tryIndexedDB&&this.indexedDBService.isSupported(),l=!e.item.bypassCache&&!n;!r||r.error?s&&l&&"Geocode result is empty."===(null===(a=null==r?void 0:r.error)||void 0===a?void 0:a.message)?(o=!0,us(e.item.query.getKey(),void 0,e.item.logger,this.tryIndexedDB,this.indexedDBService).then(function(){e.item.deferred.reject(r&&r.error||new Error("cancelled")),i.scheduleDequeue()},function(c){Xo(Zo.Set,{error:JSON.stringify(c)}),e.item.deferred.reject(r&&r.error||new Error("cancelled")),i.scheduleDequeue()})):e.item.deferred.reject(r&&r.error||new Error("cancelled")):l&&r.coordinates?(o=!0,us(e.item.query.getKey(),r.coordinates,e.item.logger,this.tryIndexedDB,this.indexedDBService).then(function(){e.item.deferred.resolve(r.coordinates),i.scheduleDequeue()},function(c){s&&Xo(Zo.Set,{error:JSON.stringify(c)}),e.item.deferred.resolve(r.coordinates),i.scheduleDequeue()})):e.item.deferred.resolve(r.coordinates)}o||this.scheduleDequeue()},t.prototype.makeRequest=function(e,r,n){var i=this;if(!_.isEmpty(e)){var a={type:"POST",dataType:"json",contentType:"application/json",data:this.batchRequest(e.map(function(g){return g.item.query}))},o=this.batchHeaders&&this.batchHeaders(this.credentials,this.culture);_.isEmpty(o)||(a.headers=o);for(var s=this.batchQueryParameters(this.credentials,this.culture),l=jn(this.baseUrl,s),c={uncancelledCount:e.length,request:ES.MapsAjaxCall(l,a)},f=0,d=e;f<d.length;f++){var p=d[f];p.batch=c,this.activeEntries.push(p)}++this.activeBatches;var h=c.request;h.always(;var v=_.head(e).item.bypassCache;h.pipe(function(g){v&&$o({url:l,request:a.data,response:JSON.stringify(g)});for(var y=m=0;m<e.length;++m)y(m)},function(g){if(v&&$o({url:l,request:a.data,error:JSON.stringify(g)}),i.shouldRetry(g?g.status:void 0,r)){var m=Math.random()*n+n;n*=2,setTimeout(function(){r++,i.makeRequest(e,r,n)},m)}else for(var S=0,E=e;S<E.length;S++){var C=E[S];C.batch=null;var b={error:new Error(g&&g.statusText||"cancelled")};ls(C.item.logger,C.item.query,void 0,b,!0),i.complete(C,b)}})}},t.prototype.shouldRetry=function(e,r){if(!this.geocodeRetryOptions)return!1;var n=this.geocodeRetryOptions,a=n.maxRetryAttempts;return n.retryOnStatusCodes.includes(e)&&r<a},t}(),bS=function(){eturn t.prototype.reset=t.prototype.enqueue=t.prototype.dequeue=function(){if(!this.inDequeue&&!this.dequeueTimeout)try{for(this.inDequeue=!0;0!==this.entries.length&&this.activeEntries.length<Ut_MaxBingRequest;){var e=this.entries.shift();e.isCompleted||(this.geocodeRetryOptions?this.makeRequest(e,0,this.geocodeRetryOptions.initialRetryIntervalInMs):this.makeRequest(e))}}finally{this.inDequeue=!1}},t.prototype.scheduleDequeue=t.prototype.cancel=t.prototype.complete=function(e,r,n){var a,i=this,o=!1;if(!e.isCompleted&&(e.isCompleted=!0,e.item.deferred.state()===Ln[Ln.pending])){var s=this.tryIndexedDB&&this.indexedDBService.isSupported(),l=!e.item.bypassCache&&!n;!r||r.error?s&&l&&"Geocode result is empty."===(null===(a=null==r?void 0:r.error)||void 0===a?void 0:a.message)?(o=!0,us(e.item.query.getKey(),void 0,e.item.logger,this.tryIndexedDB,this.indexedDBService).then(function(){e.item.deferred.reject(r&&r.error||new Error("cancelled")),i.scheduleDequeue()},function(c){Xo(Zo.Set,{error:JSON.stringify(c)}),e.item.deferred.reject(r&&r.error||new Error("cancelled")),i.scheduleDequeue()})):e.item.deferred.reject(r&&r.error||new Error("cancelled")):l&&r.coordinates?(o=!0,us(e.item.query.getKey(),r.coordinates,e.item.logger,this.tryIndexedDB,this.indexedDBService).then(function(c){s&&Xo(Zo.Set,{error:JSON.stringify(c)}),e.item.deferred.resolve(r.coordinates),i.scheduleDequeue()})):e.item.deferred.resolve(r.coordinates)}o||this.scheduleDequeue()},t.prototype.makeRequest=function(e,r,n){var i=this,a=!e.item.bypassCache&&rf(e.item.query,e.item.logger);if(a)return ea(e.item.logger,e.item.query,a),void this.complete(e,{coordinates:a},!0);var o=e.item.query.getAjaxConfig();o.jsonp&&(e.jsonp=!0);var s=e.item.query.getHeaders&&e.item.query.getHeaders();_.isEmpty(s)||(o.headers=s);var l=e.item.query.getUrl(this.baseUrl);l?(this.activeEntries.push(e),e.request=ES.MapsAjaxCall(l,o),e.request.always(,e.request.pipe(function(c){var f;e.item.bypassCache&&$o({url:l,response:JSON.stringify(c)}),e.request=null;try{f=e.item.query.getResult(c)}catch(d){f={error:d}}ls(e.item.logger,e.item.query,c,f,!1),i.complete(e,f)},function(c){if(e.item.bypassCache&&$o({url:l,error:JSON.stringify(c)}),i.shouldRetry(c?c.status:void 0,r)){var d=Math.random()*n+n;n*=2,setTimeout(d)}else{e.request=null;var p={error:new Error(c&&c.statusText||"cancelled")};ls(e.item.logger,e.item.query,void 0,p,!1),i.complete(e,p)}})):this.complete(e,{error:new Error("Unsupported query.")})},t.prototype.shouldRetry=t}(),ta={};t("tooltip-container"),Ft("tooltip-content"),Ft("arrow"),Ft("hide-arrow"),Ft("small-touch-screen"),Ft("large-touch-screen"),Ft("truncate-tooltip-height"),Ft("new-mobile-tooltip"),Ft("heightened-header"),Ft("themeableElement"),Ft("tooltip-light");var cs=);function Kn(t){return u.assertValue(t,"instances"),0===t.length?[]:_.map(t,OB)}function zB(t,e){return u.assertValue(t,"containers"),_.map(t,}function OB(t){return{objectName:t.objectName,displayName:t.displayName,properties:UB(t.properties),selector:Gn(t.selector),altConstantValueSelector:Gn(t.altConstantValueSelector),validValues:t.validValues,containerIdx:t.containerIdx,propertyInstanceKind:t.propertyInstanceKind}}unction GB(t){return t instanceof Ue?G.serializeFilter(t):void 0===t?null:t}var JB=),$B=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.getResourceUrl=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getResourceUrl",arguments:[e.id]}),e.deferred.promise},t.prototype.getAADAuthenticationToken=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getAADAuthenticationToken",arguments:[e.id]}),e.deferred.promise},t.prototype.getAADToken=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getAADToken",arguments:[e.id]}),e.deferred.promise},t.prototype.getWACToken=t.prototype.getSignedInAccessToken=function(){return this.promiseFactory.reject()},t.prototype.getClusterInfo=t}(),ZB=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.downloadFile=t.prototype.getExportStatus=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"exportVisualsContentStatus",arguments:[e.id]}),e.deferred.promise},t.prototype.exportVisualsContent=t}(),tz=function(){function t(e,r){this.messageProxy=e,this.instanceId=r,u.assertValue(e,"messageProxy")}return t.prototype.renderingStarted=function(e){this.messageProxy.postMessage({eventName:"renderingStarted",arguments:[this.instanceId,e.updateId]})},t.prototype.renderingFinished=t.prototype.renderingFailed=t}(),nz=function(){function t(e,r,n){this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n,u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory")}return t.prototype.getAvailableServicePlans=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getAvailableServicePlans",arguments:[e.id]}),e.deferred.promise},t.prototype.notifyLicenseRequired=function(e){var r=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"notifyLicenseRequired",arguments:[e,r.id]}),r.deferred.promise},t.prototype.notifyFeatureBlocked=function(e){var r=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"notifyFeatureBlocked",arguments:[e,r.id]}),r.deferred.promise},t.prototype.clearLicenseNotification=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"clearLicenseNotification",arguments:[e.id]}),e.deferred.promise},t}(),az=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.getStorageStatus=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getStorageStatus",arguments:[e.id]}),e.deferred.promise},t.prototype.getStorageData=function(e){var r=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getStorageData",arguments:[e,r.id]}),r.deferred.promise},t.prototype.setStorageData=function(e,r){var n=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"setStorageData",arguments:[e,r,n.id]}),n.deferred.promise},t.prototype.removeStorageData=function(e){this.messageProxy.postMessage({eventName:"removeStorageData",arguments:[e]})},t}(),sz=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.getStorageStatus=t.prototype.getStorageData=function(e){var r=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getStorageV2Data",arguments:[e,r.id]}),r.deferred.promise},t.prototype.setStorageData=t.prototype.removeStorageData=function(e){this.messageProxy.postMessage({eventName:"removeStorageV2Data",arguments:[e]})},t}(),lz=function(){function t(e,r){this.messageProxy=e,u.assertValue(e,"messageProxy"),this.instanceId=r}return t.prototype.trace=function(e,r){this.messageProxy.postMessageAsync({eventName:"logVisualEvent",arguments:[ww(e),{instanceId:this.instanceId,payload:r}]})},t.prototype.logStandardizedFeatureEvent=function(){},t}(),fz=function(){function t(e){u.assertValue(e,"messageProxy"),this.messageProxy=e,this.rootElement=window.document.body}return t.prototype.serializeIdentities=function(e){return e&&e[0]instanceof ie?e:e&&_(e).map(function(n){return ko(n)}).compact().value()},t.prototype.show=function(e){var r=e&&{coordinates:e.coordinates,dataItems:e.dataItems,identities:this.serializeIdentities(e.identities),isTouchEvent:e.isTouchEvent};this.messageProxy.postMessage({eventName:"showTooltip",arguments:[r]})},t.prototype.move=t.prototype.hide=function(e){this.messageProxy.postMessage({eventName:"hideTooltip",arguments:[e]})},t.prototype.visible=function(){return!1},t.prototype.isTouchOptimized=function(){return!1},t.prototype.container=function(){return this.rootElement},t.prototype.enabled=function(){return!0},t}(),pz=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.getWebAccessStatus=t}(),vz=function(){function t(e){u.assertValue(e,"messageProxy"),this.messageProxy=e}return t.prototype.subSelect=function(e){e&&this.messageProxy.postMessage({eventName:"subSelect",arguments:[e]})},t.prototype.updateRegionOutlines=t}(),gz={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},Ze={NullValue:"(Blank)",BooleanTrue:"True",BooleanFalse:"False",NaNValue:"NaN",InfinityValue:"+Infinity",NegativeInfinityValue:"-Infinity",Restatement_Comma:"{0}, {1}",Restatement_CompoundAnd:"{0} and {1}",DisplayUnitSystem_EAuto_Title:"Auto",DisplayUnitSystem_E0_Title:"None",DisplayUnitSystem_E3_LabelFormat:"{0}K",DisplayUnitSystem_E3_Title:"Thousands",DisplayUnitSystem_E6_LabelFormat:"{0}M",DisplayUnitSystem_E6_Title:"Millions",DisplayUnitSystem_E9_LabelFormat:"{0}bn",DisplayUnitSystem_E9_Title:"Billions",DisplayUnitSystem_E12_LabelFormat:"{0}T",DisplayUnitSystem_E12_Title:"Trillions",Percentage:"#,0.##%",Percentage1:"#,0.#%",TableTotalLabel:"Total",Tooltip_HighlightedValueDisplayName:"Highlighted",Decrease:"Decrease",Increase:"Increase",Waterfall_TotalLabel:"Total",GeotaggingString_Continent:"continent",GeotaggingString_Continents:"continents",GeotaggingString_Country:"country",GeotaggingString_Countries:"countries",GeotaggingString_State:"state",GeotaggingString_States:"states",GeotaggingString_City:"city",GeotaggingString_Cities:"cities",GeotaggingString_Town:"town",GeotaggingString_Towns:"towns",GeotaggingString_Province:"province",GeotaggingString_Provinces:"provinces",GeotaggingString_County:"county",GeotaggingString_Counties:"counties",GeotaggingString_Village:"village",GeotaggingString_Villages:"villages",GeotaggingString_Post:"post",GeotaggingString_Zip:"zip",GeotaggingString_Code:"code",GeotaggingString_Place:"place",GeotaggingString_Places:"places",GeotaggingString_Address:"address",GeotaggingString_Addresses:"addresses",GeotaggingString_Street:"street",GeotaggingString_Streets:"streets",GeotaggingString_Longitude:"longitude",GeotaggingString_Longitude_Short:"lon",GeotaggingString_Longitude_Short2:"long",GeotaggingString_Latitude:"latitude",GeotaggingString_Latitude_Short:"lat",GeotaggingString_PostalCode:"postal code",GeotaggingString_PostalCodes:"postal codes",GeotaggingString_ZipCode:"zip code",GeotaggingString_ZipCodes:"zip codes",GeotaggingString_Territory:"territory",GeotaggingString_Territories:"territories"},VS=function(){function t(e,r){this.messageProxy=e,this.sandboxPromiseHandler=r,this.loadMoreDataEnabled=!0,u.assertValue(e,"messageProxy"),this.visualHostTooltipService=function(t){return new fz(t)}(e),this.queryDictionary=t.parseUrlParameters(),this.authService=function(t,e,r){return new $B(t,e,r)}(e,this.promiseFactory(),r),this.storageService=function(t,e,r){return new az(t,e,r)}(e,this.promiseFactory(),r),this.hostWebAccessService=function(t,e,r){return new pz(t,e,r)}(e,this.promiseFactory(),r),this.contentDownloadService=function(t,e,r){return new ZB(t,e,r)}(e,this.promiseFactory(),r),this.licensesManagerService=function(t,e,r){return new nz(t,e,r)}(e,this.promiseFactory(),r),this.acquireTokenService=function(t,e,r){return new JB(t,e,r)}(e,this.promiseFactory(),r),this.storageV2Service=function(t,e,r){return new sz(t,e,r)}(e,this.promiseFactory(),r),this.hostSubSelectionService=function(t){return new vz(t)}(e),this.dialogPromiseFactory=this.promiseFactory()}return t.prototype.initInstanceId=t.initialize=function(){cs&&(cs.localizationOptions=t.createTooltipLocaleOptions())},t.createLocaleOptions=t.createTooltipLocaleOptions=t.prototype.getLocalizedString=function(e){return Ze[e]},t.prototype.onSelecting=t.prototype.onSelect=function(e){var r;if(function(t){var r=null!=t.data||null!=t.selectors,n=_.some(t.visualObjects,;return r||n}(e)){var n=e;r={data:Ay(n.data),data2:ko(n.data2),selectors:Ay(n.selectors)}}else r={type:e.type,visualObjects:AR(e.visualObjects)};this.messageProxy.postMessage({eventName:"onSelect",arguments:[r]})},t.prototype.customVisualOnContextMenu=function(e){this.messageProxy.postMessage({eventName:"onCustomVisualContextMenu",arguments:[e]})},t.prototype.customVisualOnExpandCollapse=function(e){this.messageProxy.postMessage({eventName:"onCustomVisualExpandCollapse",arguments:[e]})},t.prototype.switchFocusModeState=function(e){this.messageProxy.postMessage({eventName:"onSwitchFocusModeState",arguments:[e]})},t.prototype.displayWarningIcon=t.prototype.persistProperties=function(e){var r,n=e;r=this.apiVersion&&(nn(this.apiVersion,"2.0.0")||sh(this.apiVersion,"2.0.0"))?e:n.merge||n.remove||n.replace?{merge:n.merge?Kn(n.merge):null,replace:n.replace?Kn(n.replace):null,remove:n.remove?Kn(n.remove):null}:Kn(e),this.messageProxy.postMessage({eventName:"persistProperties",arguments:[r]})},t.prototype.sendSelectionIdsToHost=function(e){this.messageProxy.postMessage({eventName:"transformCvSelectionIdsAndSelect",arguments:[e]})},t.prototype.loadMoreData=t.prototype.loadWindow=function(e){},t.prototype.fetchMoreData=t.prototype.launchUrl=function(e){this.messageProxy.postMessage({eventName:"launchUrl",arguments:[e]})},t.prototype.setCanDrill=function(e){this.messageProxy.postMessage({eventName:"setCanDrill",arguments:[e]})},t.prototype.drill=function(e){this.messageProxy.postMessage({eventName:"drill",arguments:[e]})},t.prototype.openModalDialog=t.prototype.tooltips=function(){return this.visualHostTooltipService},t.prototype.telemetry=function(){return this.telemetryService},t.prototype.authenticationService=function(){return this.authService},t.prototype.localStorageService=function(){return this.storageService},t.prototype.localStorageV2Service=function(){return this.storageV2Service},t.prototype.eventService=function(){return this.eventsService},t.prototype.licenseManagerService=function(){return this.licensesManagerService},t.prototype.acquireAADTokenService=function(){return this.acquireTokenService},t.prototype.visualTimeSynchronization=function(){return this.visualTimeSynchronizationService},t.prototype.networkAvailability=function(){return this.networkAvailabilityService},t.prototype.webAccessService=function(){return this.hostWebAccessService},t.prototype.visualHostSubSelectionService=function(){return this.hostSubSelectionService},t.prototype.getSectionsMetadata$=function(){},t.prototype.getBookmarksMetadata$=function(){},t.prototype.downloadService=function(){return this.contentDownloadService},t.prototype.artifactService=function(){},t.prototype.getQueryStringValue=t.prototype.locale=function(){var e=this.queryDictionary&&this.queryDictionary.locale;return u.assert(function(){return!!e},"custom visual locale parameter is not valid"),e||navigator.language},t.prototype.loader=t.prototype.applyJsonFilter=function(e,r,n,i){var a=[e,r,n];return i&&a.push(i),this.messageProxy.postMessage({eventName:"applyJsonFilter",arguments:a}),!0},t.prototype.applyIdentityFilter=t.prototype.getJSONFilter=t.parseUrlParameters=t.prototype.destroy=t.prototype.refreshHostData=t.prototype.createSelectionIdBuilder=function(){return new ie},t.prototype.createTooltipService=function(){return ot({hostServices:this})},t.prototype.createSelectionManager=function(e){return new Be({hostServices:this,apiVersion:e})},t.prototype.applyCustomSort=t.prototype.alertScreenReader=function(e){},t.prototype.alertWithDebounce=function(e,r){},t.prototype.requestFocus=function(){},t.prototype.setShouldDeferData=function(){},t.prototype.onDragStart=function(){},t.prototype.onContextMenu=function(){},t.prototype.onSwitchFocusModeState=function(){},t.prototype.onDisplayWarningIcon=function(){},t.prototype.onClearCustomizedWarningIcon=function(){},t.prototype.getVisualLinkProperties=function(){},t.prototype.canSelect=function(){return!1},t.prototype.canExpandCollapse=t.prototype.setNodeExpansionState=function(e){},t.prototype.setLevelExpansionState=function(e){},t.prototype.onCustomSort=function(e){},t.prototype.getViewMode=function(){return 0},t.prototype.getEditMode=function(){return 0},t.prototype.setWarnings=function(e){},t.prototype.getWarnings$=function(){},t.prototype.setToolbar=function(e){},t.prototype.shouldRetainSelection=function(){return!1},t.prototype.geocoder=function(){return new PB},t.prototype.geolocation=t.prototype.promiseFactory=t.prototype.ignoreDefaultFilter=function(){return!1},t.prototype.getIdentityDisplayNames=function(e){},t.prototype.setIdentityDisplayNames=function(e){},t.prototype.setFilterExpressionMetadata=function(){},t.prototype.getFilterExpressionMetadata=function(){},t.prototype.getUIComponentFactory=function(){},t.prototype.onHyperlinkClick=t.prototype.isVisualEnabled=t.prototype.dataMultiSelectMode=t.prototype.dropdown=function(){},t.prototype.setAriaMetadata=function(e){},t.prototype.onNotifyLicense=function(e){},t.prototype.onClearLicenseNotification=function(){},t.prototype.onNotifyFeatureBlocked=t.prototype.getSubSelectionService=function(){},t.prototype.getAzureMapToken=function(){},t.prototype.azureMapsEndpoint=function(){},t.prototype.geocoderIndexedDB=function(){},t.prototype.triggerUpdate=function(){},t.prototype.isScreenshotWorkload=t.prototype.dateTimeFormatService=function(){},t.prototype.visualExportService=Object.defineProperty(t.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!1,configurable:!0}),t.beautify=t.describeUnit=t.prototype.enableLoadMoreData=function(e){this.loadMoreDataEnabled=e},t}();function Sz(t){var e={selector:Gn(t.selector),altStaticSelector:Gn(t.altStaticSelector),objects:t.objects};return void 0!==t.allowOverrideSubtotalMatching&&(e.allowOverrideSubtotalMatching=t.allowOverrideSubtotalMatching),e}var Cz={}),bz={}),Vz=function(t){return t.KeyDown="keydown",t}({}),wz={}),wS=Object.values(Cz),xS=Object.values(bz),nf=Object.values(Vz),af=wS.concat(xS),of=Object.values(wz),sf=["type","bubbles","which","buttons","button","ctrlKey","altKey","metaKey","shiftKey","x","y","clientX","clientY","pageX","pageY","movementX","movementY","layerX","layerY","changedTouches","keyCode","code","key","cancelable","composed"],xz={Escape:[]},Mz={Escape:[],y:["ctrlKey"],z:["ctrlKey"]},MS=function(){function t(e){this.id=++t.counter,this.deferred=e}return t.getLastId=function(){return t.counter},t.counter=0,t}(),DS=),AS=);nction IS(t,e){void 0===e&&(e=!1);var r=Di(),n=Om(r);VS.initialize(),ao.getQueryStringValue("pbiglobals")&&function(){var t=la();t.FilterAction=lL,t.VisualDataRoleKind=rt,t.VisualDataChangeOperationKind=lr,t.VisualUpdateType=xt,t.VisualPermissions=OS,t.formattingService=qe;var e=function(){var t=Qo();return t.data||(t.data={}),t.data}();Ge&&(e.SQExprBuilder={},e.SQExprBuilder.entity=Ge,e.SQExprBuilder.subqueryRef=Zr,e.SQExprBuilder.namedQueryRef=hp,e.SQExprBuilder.columnRef=Ie,e.SQExprBuilder.measureRef=pu,e.SQExprBuilder.nativeMeasure=vp,e.SQExprBuilder.nativeColumn=gp,e.SQExprBuilder.aggregate=Yt,e.SQExprBuilder.selectRef=gi,e.SQExprBuilder.percentile=hu,e.SQExprBuilder.rangePercent=yp,e.SQExprBuilder.arithmetic=yi,e.SQExprBuilder.floor=mp,e.SQExprBuilder.scopedEval=La,e.SQExprBuilder.filteredEval=vu,e.SQExprBuilder.withRef=Sp,e.SQExprBuilder.groupRef=Ba,e.SQExprBuilder.hierarchy=mi,e.SQExprBuilder.propertyVariationSource=za,e.SQExprBuilder.hierarchyLevel=Oa,e.SQExprBuilder.transformTableRef=gu,e.SQExprBuilder.transformOutputRoleRef=yu,e.SQExprBuilder.roleRef=mu,e.SQExprBuilder.summaryValueRef=Ep,e.SQExprBuilder.allRolesRef=Cp,e.SQExprBuilder.and=it,e.SQExprBuilder.between=Er,e.SQExprBuilder.inValues=en,e.SQExprBuilder.inTable=Su,e.SQExprBuilder.or=Si,e.SQExprBuilder.compare=An,e.SQExprBuilder.conditional=Eu,e.SQExprBuilder.contains=bp,e.SQExprBuilder.exists=Vp,e.SQExprBuilder.equal=Tn,e.SQExprBuilder.not=qa,e.SQExprBuilder.startsWith=wp,e.SQExprBuilder.nullConstant=Rt,e.SQExprBuilder.emptyString=Lb,e.SQExprBuilder.now=Cu,e.SQExprBuilder.defaultValue=Ua,e.SQExprBuilder.anyValue=Ei,e.SQExprBuilder.boolean=$t,e.SQExprBuilder.dateAdd=vt,e.SQExprBuilder.dateTime=Xt,e.SQExprBuilder.dateSpan=yt,e.SQExprBuilder.decimal=Ha,e.SQExprBuilder.double=tn,e.SQExprBuilder.integer=In,e.SQExprBuilder.text=Ee,e.SQExprBuilder.typedConstant=rn,e.SQExprBuilder.fromRawValue=Ci,e.SQExprBuilder.sparklineData=bu,e.SQExprBuilder.setAggregate=Y2,e.SQExprBuilder.removeAggregate=rL,e.SQExprBuilder.setPercentOfGrandTotal=K2,e.SQExprBuilder.removePercentOfGrandTotal=eL,e.SQExprBuilder.setPercentOfRoleTotal=aL,e.SQExprBuilder.removePercentOfRoleTotal=X2,e.SQExprBuilder.removeEntityVariables=Bb,e.SQExprBuilder.setVisualCalcExpression=zb,e.SQExprBuilder.fillRule=xp,e.SQExprBuilder.themeDataColor=Vu,e.SQExprBuilder.resourcePackageItem=Mp,e.SQExprBuilder.discretize=Dp,e.SQExprBuilder.member=Ap,e.SQExprBuilder.color=Ob,e.SQExprBuilder.nativeVisualCalc=wu,e.SQExprBuilder.fieldExpr=ge,e.SQExprBuilder.fromColumnAggr=bd,e.SQExprBuilder.fromColumn=iu,e.SQExprBuilder.fromGroupingColumnAggr=Vd,e.SQExprBuilder.fromGroupingColumn=wd,e.SQExprBuilder.fromEntity=Jt,e.SQExprBuilder.fromEntityAggr=xd,e.SQExprBuilder.fromColumnHierarchyVariation=Md,e.SQExprBuilder.fromColumnHierarchyLevelVariation=Dd,e.SQExprBuilder.fromColumnSubquery=Ad,e.SQExprBuilder.fromColumnAggrSubquery=Td,e.SQExprBuilder.fromColumnTransformRef=Id,e.SQExprBuilder.fromHierarchyLevelAggr=_d,e.SQExprBuilder.fromHierarchyLevel=au,e.SQExprBuilder.fromHierarchy=ou,e.SQExprBuilder.fromArithmetic=Fd,e.SQExprBuilder.fromConstant=Pd,e.SQExprBuilder.fromSparklineData=Rd,e.SQExprBuilder.fromNativeVisualCalc=Nd),e.Selector={},e.Selector.AllEncompasingKey="{}",e.Selector.isScopeIdentity=Nt,e.Selector.isScopeWildcard=br,e.Selector.isScopeTotal=Zt,e.Selector.isRoleWildcard=er,e.Selector.isWildcard=Vr,e.Selector.isWildcardSelector=Fn,e.Selector.toScopeIdentities=zp,e.Selector.getScopeIdentities=uV,e.Selector.filterFromSelector=Tu,e.Selector.filterFromSelectorsByColumn=lV,e.Selector.filterExprsFromSelectors=Op,e.Selector.hasIdentities=cV,e.Selector.equals=St,e.Selector.equalsDataArray=qp,e.Selector.equalsSelectorsByColumn=Up,e.Selector.equalsSelectorsByColumnArray=fV,e.Selector.equalsData=Iu,e.Selector.getKey=Hp,e.Selector.getDecomposedKeys=_u,e.Selector.containsWildcard=Qa,e.Selector.hasRoleWildcard=ja,e.Selector.convertSelectorsByColumnToSelector=wr,e.Selector.getSelectorTargetExpr=tr,e.Selector.normalizeSelector=dV,e.Selector.clone=pV,e.SQCompareExpr=fu,e.createDataViewScopeIdentity=mt,e.createDisplayNameGetter=MD,e.DataViewObjectDefinitions={},e.DataViewObjectDefinitions.allPropertiesAreEqual=fI,e.DataViewObjectDefinitions.clone=pI,e.DataViewObjectDefinitions.cloneDefinitions=xg,e.DataViewObjectDefinitions.deleteObjectDefinition=nI,e.DataViewObjectDefinitions.deleteProperties=iI,e.DataViewObjectDefinitions.deleteProperty=Yl,e.DataViewObjectDefinitions.encodePropertyValue=Xl,e.DataViewObjectDefinitions.ensure=Jl,e.DataViewObjectDefinitions.extend=aI,e.DataViewObjectDefinitions.getDataBoundExprs=j2,e.DataViewObjectDefinitions.getDataBoundExprsAndValueRef=W2,e.DataViewObjectDefinitions.getObjectDefinition=Vg,e.DataViewObjectDefinitions.getObjectDefinitions=Bi,e.DataViewObjectDefinitions.getPropertyContainer=bg,e.DataViewObjectDefinitions.getUnequalProperties=dI,e.DataViewObjectDefinitions.getValue=$l,e.DataViewObjectDefinitions.getValueFormatting=cI,e.DataViewObjectDefinitions.isEmpty=hI,e.DataViewObjectDefinitions.isObjectPropertySQExpr=Zl,e.DataViewObjectDefinitions.isObjectPropertySQExprWithContext=wo,e.DataViewObjectDefinitions.isPropertyDefinition=gI,e.DataViewObjectDefinitions.moveProperty=oI,e.DataViewObjectDefinitions.propertiesAreEqual=Vo,e.DataViewObjectDefinitions.reduce=SI,e.DataViewObjectDefinitions.setValue=Li,e.DataViewObjectDefinitions.setValueFormatting=lI,e.DataViewObjectDefinitions.updateSelector=rI,e.DataViewObjectDefinitions.visitPropertyDefinitions=yI,e.DataViewObjectDefinitions.visitPropertyExprs=mI;var r=function(){var t=Qo();return t.extensibility||(t.extensibility={}),t.extensibility}();r.createColorPalette=bt,r.createExtendedColorPalette=ue,r.getVisualApiVersions=Bn,r.visualApiVersions=Bn();var n=ca();n.buildValueDetailsForColumnValue=Rn,n.SelectionId=$a,n.SelectionIdBuilder=Xe;var i=);i.beautifyTrace=Zp,i.allowFormatBeautificationTraced=ku,i.getLocalizedString=qV,i.getFormatMetadata=WV,i.setLocaleOptions=KV,i.createDefaultFormatter=eh,i.create=JV,i.format=Lu,i.formatVariantMeasureValueWithDataPointObjects=YV,i.createDisplayUnitSystem=th,i.getDisplayUnits=$V,i.getFormatString=Ya,i.getDefaultFormatString=rh,i.getLabelPrecision=ew,i.getFormatStringWithDataPointObjects=nh,i.formatListAnd=tw,i.formatListOr=rw}(),ca().plugins={},hL();var a={promiseFactory:r},o=function(t){return new MA(t)}(n),s=n),l=new AS,c=function(t,e){return u.assertValue(t,"messageProxy"),new VS(t,e)}(n,l),p={$element:t,hostServices:c,hostServicesControl:c,dataProxy:Az(r),promiseFactory:r,messageProxy:n,resourceLoader:yA(a,null),resourceProvider:{get:function(g){return g},getOptional:function(g){return g},format:,telemetryProxyService:o,certifiedEventsProxyService:s,instanceId:"",sandboxPromiseHandler:l},h=c.getQueryStringValue("cspiframe");return n.contentWindow=h?window.parent.parent:window.parent,new FS(p,e)}function Az(t){var e=new AA,n={promiseFactory:,i=function(t,e){return new dD(t,{})}({dsr:{name:"dsr",reader:function(o){return new b2(o,{execute:,e,{dsrV2:!1},null,void 0,void 0)}}}),n);return t,i,e)}function _S(t,e,r){var a,n=t.content,i=t.hasBeenInjected||Jn()&&Jn().hasOwnProperty(t.name)&&Jn()[t.name].hasBeenInjected;return(!e||!i)&&(co(t.name,n.js,r,t.apiVersion),fo(t.name,n.css)),!t.apiVersion||Mr(t.apiVersion,{major:3,minor:0,patch:0})?(u.assertValue(Jn()[t.name],"Visual does not have a plugin"),a=Jn()[t.name]):(u.assertValue(window[t.name],"Visual does not have a plugin"),a=window[t.name].default),t.apiVersion&&(a.iconUrl=t.iconUrl,a.capabilities=t.capabilities,a.localizationResources=t.localizationResources,a.isDeprecated=t.isDeprecated,a.version=t.version),e&&(a.hasBeenInjected=!0,a.approvedForNoIframe=!0,Jn()[t.name]=a),a}var FS=function(){function t(e,r){void 0===r&&(r=!1);var n=this;this.isolate=r,this.isVisualInitialized=!1,this.messageQueue=[],this.formatMode=!1,this.relayUIEventListener=this.relayKeyboardEventListener=this.container=e.$element,this.hostServices=e.hostServices,this.hostServicesControl=e.hostServicesControl,this.dataProxy=e.dataProxy,this.promiseFactory=e.promiseFactory,this.messageProxy=e.messageProxy,this.resourceLoader=e.resourceLoader,this.resourceProvider=e.resourceProvider,this.telemetryProxyService=e.telemetryProxyService,this.certifiedEventsProxyService=e.certifiedEventsProxyService,this.sandboxPromiseHandler=e.sandboxPromiseHandler,this.aggregatedDataViewSize=0,this.dataViewSerializer=new wL,this.skipRedundantResize=!1,this.hostOrigin=new URL(window.location.href).origin,this.messageProxy.on(Wc,function(i){return n.onMessageReceived(i)})}return Object.defineProperty(t.prototype,"visual",{get:function(){return this._visual},enumerable:!1,configurable:!0}),t.prototype.init=function(e){this.hostServices.initInstanceId(e.instanceId),this.hostServicesControl.initInstanceId(e.instanceId),this.style=e.style);var r={animation:e.animation,element:this.container,host:this.hostServices,interactivity:e.interactivity,style:this.style,viewport:e.viewport,localizationResources:this.plugin.localizationResources,hostEnv:e.hostEnv,dataMultiSelectMode:e.dataMultiSelectMode};return this.featureSwitches=e.featureSwitches,this.skipRedundantResize=this.featureSwitches&&this.featureSwitches.cvSkipExtraResize,this.attachRelayUIEventListener(),this.attachWindowResizeListener(),this.visual.init(r)},t.prototype.destroy=function(){this.detachRelayUIEventListener(),this.detachWindowResizeListener(),this.detachFormatModeRelayUIEventListener(),this.messageProxy.off(Wc),this.messageProxy.destroy(),this.visual&&this.visual.destroy&&this.visual.destroy()},t.prototype.categoriesExists=t.prototype.getHostCategoriesValues=t.prototype.update=function(e){var i,r=this,n=e.message.arguments[0];if(this.formatMode!==!!n.formatMode&&(this.formatMode=n.formatMode,this.handleAttachingEventListeners()),this.plugin&&this.plugin.apiVersion&&!Mr(this.plugin.apiVersion,"2.0.0")){this.stringifiedDataView=n.serializedDataView?n.serializedDataView.stringifiedDataView:null;var a=!(!this.plugin.capabilities.expandCollapse||!this.plugin.capabilities.dataViewMappings[0].matrix),o=n.serializedDataView?[this.dataViewSerializer.deserializeDataView(n.serializedDataView,nn(this.plugin.apiVersion,"3.5.9"),a,[],oh(this.plugin.apiVersion,"5.3.0"))]:[];this.formatMode&&this.reCreateSelectionIds(n.subSelections);var s=this.lastVisualUpdateOptions={dataViews:o,suppressAnimations:n.suppressAnimations,viewMode:n.viewMode,editMode:n.editMode,viewport:n.viewport,type:n.type,operationKind:lr.Create,resizeMode:n.resizeMode,isInFocus:n.isInFocus,jsonFilters:n.jsonFilters?n.jsonFilters:null,updateId:n.updateId,formatMode:n.formatMode,subSelections:n.subSelections};this.plugin&&this.plugin.apiVersion&&!Mr(this.plugin.apiVersion,"3.5.0")?(this.onRestoreCvSelectionIds(n.selections,!nn(this.plugin.apiVersion,"2.4.0")),this.fixUpdateOptionsAndUpdateVisual(s,e,n)):(this.fixUpdateOptionsAndUpdateVisual(s,e,n),this.onRestoreCvSelectionIds(n.selections,!nn(this.plugin.apiVersion,"2.4.0")))}else n.dataTransforms&&(i=zy.deserializeDataViewTransformActions(n.dataTransforms,this.plugin.capabilities||{})),this.transformDataViewSource(n.dataViewSource,i,!0).then(function(l){var c=r.lastVisualUpdateOptions={dataViews:l.dataViews,suppressAnimations:n.suppressAnimations,viewMode:n.viewMode,editMode:n.editMode,viewport:n.viewport,type:n.type,operationKind:lr.Create,resizeMode:n.resizeMode,isInFocus:n.isInFocus,jsonFilters:n.jsonFilters?n.jsonFilters:null,updateId:n.updateId};r.visualHasNullFilter(i)&&r.onRestoreSelection(null),r.fixUpdateOptionsAndUpdateVisual(c,e,n)}).catch(function(l){return r.sendError(l)})},t.prototype.visualHasNullFilter=t.prototype.updateWithCachedData=function(e){var n,i,a,r=e.message.arguments[0];if(this.plugin&&this.plugin.apiVersion&&!Mr(this.plugin.apiVersion,"2.0.0")){if(this.lastVisualUpdateOptions.dataViews&&this.lastVisualUpdateOptions.dataViews[0]&&this.lastVisualUpdateOptions.dataViews[0].metadata){var o=this.lastVisualUpdateOptions.dataViews[0].metadata.segment;this.lastVisualUpdateOptions.dataViews[0].metadata=r.dataViewMetadata?JSON.parse(r.dataViewMetadata):void 0,this.lastVisualUpdateOptions.dataViews[0].metadata.segment=o}i=this.lastVisualUpdateOptions.dataViews,a=!0}else r.dataTransforms&&(n=zy.deserializeDataViewTransformActions(r.dataTransforms,this.plugin.capabilities||{})),this.lastDataViewTransformApplyOptions.transforms=n,i=dc(this.lastDataViewTransformApplyOptions).dataViews;var s=this.lastVisualUpdateOptions={dataViews:i,suppressAnimations:r.suppressAnimations,viewMode:r.viewMode,editMode:r.editMode,viewport:r.viewport,type:r.type,operationKind:lr.Create,resizeMode:r.resizeMode,isInFocus:r.isInFocus,jsonFilters:r.jsonFilters?r.jsonFilters:null,updateId:r.updateId,formatMode:r.formatMode,subSelections:r.subSelections};this.fixUpdateOptionsAndUpdateVisual(s,e,r,a)},t.prototype.loadResourcePackage=function(e){var r=this;u.assertValue(e,"resourcePackage"),this.resourceLoader.loadVisualPlugin(e).then(.catch(},t.prototype.createAdapter=function(){var e=this.plugin;if(this.container.addClass("visual-"+e.name),this._visual=function(t,e,r,n,i,a,o){var s=new Yh(t,e,r,n,i,o),l=function(t,e){return t&&(t=new tD(t),e&&(t=new jM(t,e))),t}(s,a);return new ZM(l,t,r,n,s.isPluginInError,o)}(e,e.create,this.promiseFactory,this.telemetryProxyService,void 0,void 0,this.certifiedEventsProxyService),!e||!this.visual){var r=new Error("Unable to create visual from plugin "+e.name);return this.sendError(r)}this.flushQueue(),this.isVisualInitialized=!0,this.sendSandboxReady()},t.prototype.loadWithoutResourcePackage=function(e){if(this.plugin)this.sendError(new Error("Plugin is already loaded"));else{var n=e.apiVersion?this.isolate&&Mr(e.apiVersion,"3.0.0"):this.isolate;this.plugin=_S(e,!1,n),uo(this.plugin),this.createAdapter()}},t.prototype.enumerateObjectInstances=function(e){if(this.visual.enumerateObjectInstances){var r=this.visual.enumerateObjectInstances(e);if(r){var n=r,i=this.plugin&&this.plugin.apiVersion&&!Mr(this.plugin.apiVersion,"2.0.0");return n&&n.instances?i?{instances:n.instances,containers:n.containers}:{instances:Kn(n.instances),containers:n.containers?zB(n.containers,this.resourceProvider):null}:i?r:Kn(r)}}},t.prototype.enumerateObjectRepetition=function(){if(this.visual.enumerateObjectRepetition){var e=this.visual.enumerateObjectRepetition();return e?function(t){return u.assertValue(t,"repetitions"),_.isEmpty(t)?[]:_.map(t,Sz)}(e):void 0}},t.prototype.getFormattingModel=t.prototype.getSubSelectionStyles=t.prototype.getSubSelectionShortcuts=t.prototype.getSubSelectables=t.prototype.focusVisualIframeWindow=t.prototype.sendUpdateResult=t.prototype.sendSandboxReady=t.prototype.flushQueue=t.prototype.sendError=t.prototype.sendErrorMessage=t.prototype.onMessageReceived=t.prototype.validateSandboxHostMessage=t.prototype.validateVisualMessage=function(e){var r=e.message;if(!this.visual)return{error:"unset visual"};var n=this.visual[r.eventName];return n?"function"!=typeof n?{error:"not a function"}:Yh.prototype[r.eventName].approvedMessage?{ok:!0}:{error:"unapproved type"}:{error:"undefined method"}},t.prototype.executeMessage=t.prototype.reCreateSelectionIds=function(e){e&&e.forEach(function(r){var n=r.customVisualObjects[0].selectionId;r.customVisualObjects[0].selectionId=n&&new ie(n.dataMap,n.measures)})},t.prototype.transformDataViewSource=function(e,r,n){var i=this,a=this.promiseFactory.defer();return(e?this.createDataView(e):this.promiseFactory.resolve({dataView:null})).then(function(s){var l=dc(i.lastDataViewTransformApplyOptions={prototype:s.dataView,objectDescriptors:i.plugin.capabilities?i.plugin.capabilities.objects:void 0,dataViewMappings:i.plugin.capabilities?i.plugin.capabilities.dataViewMappings:void 0,dataRoles:i.plugin.capabilities?i.plugin.capabilities.dataRoles:void 0,drillCapabilities:i.plugin.capabilities&&i.plugin.capabilities.drilldown,expandCollapseCapabilties:i.plugin.capabilities&&i.plugin.capabilities.expandCollapse,transforms:r,colorAllocatorFactory:no(),bypassConcatenation:n,visualStyle:i.style,keepAllMetadataColumnsCapability:!!i.plugin.capabilities&&i.plugin.capabilities.keepAllMetadataColumns,featureSwitches:i.featureSwitches}).dataViews;a.resolve({dataViews:l})}).catch(function(s){return i.sendError(s)}),a.promise},t.prototype.createDataView=function(e){var r=this;u.assertValue(e,"dataViewSource");var n=this.promiseFactory.defer();return this.dataProxy.execute({type:e.type,query:{dataSources:null,command:e.data}}).then(function(a){var s=function(t,e){if(!e||0===e.length)return{dataView:t,isValid:!0};if(t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(LF(t,i))return{dataView:t,isValid:!0};if(i.categorical&&t.categorical)return PF(t,i);if(i.tree&&t.tree)return NF(t,i.tree);if(i.single&&t.single)return RF(t,i.single);if(i.table&&t.table)return kF(t,i.table)}if(t.metadata)return{dataView:{metadata:t.metadata},isValid:!0}}return{isValid:!1}}(a&&a.dataReaderResult?a.dataReaderResult.dataView:null,r.plugin.capabilities?r.plugin.capabilities.dataViewMappings:null);n.resolve({dataView:s.dataView})}).catch(function(a){return r.sendError(a)}),n.promise},t.prototype.attachWindowResizeListener=t.prototype.detachWindowResizeListener=t.prototype.windowResizeListener=function(){if(this.lastVisualUpdateOptions){var e=$(window).height(),r=$(window).width();if(!(this.skipRedundantResize&&this.lastVisualUpdateOptions.viewport&&this.lastVisualUpdateOptions.viewport.width&&this.lastVisualUpdateOptions.viewport.height&&Math.abs(r-this.lastVisualUpdateOptions.viewport.width)<=1&&Math.abs(e-this.lastVisualUpdateOptions.viewport.height)<=1)){var n=fe(this.lastVisualUpdateOptions);n.viewport={width:r,height:e,scale:this.lastVisualUpdateOptions.viewport.scale},n.type=xt.Resize,n.resizeMode=1,this.visual.update(n)}}},t.prototype.attachRelayUIEventListener=function(){$(window).on(nf.join(" "),this.relayKeyboardEventListener),this.container.on(af.join(" "),this.relayUIEventListener)},t.prototype.detachRelayUIEventListener=t.prototype.attachFormatModeRelayUIEventListener=function(){$(window).on(of.join(" "),this.relayKeyboardEventListener)},t.prototype.detachFormatModeRelayUIEventListener=t.prototype.handleAttachingEventListeners=t.prototype.isSupportedKeyBoardEvent=t.prototype.handleLoadMoreDataResult=function(e){return et(this,void 0,Qe,function(){var r,n,i,a,o,s,l,f=this;return tt(this,function(d){switch(d.label){case 0:return r=e.message.arguments[1],this.plugin&&this.plugin.apiVersion&&!Mr(this.plugin.apiVersion,"2.0.0")?(i=e.message.arguments[2],(n=e.message.arguments[0])&&this.stringifiedDataView!==n.stringifiedDataView?(this.stringifiedDataView=n.stringifiedDataView,a=!(!this.plugin.capabilities.expandCollapse||!this.plugin.capabilities.dataViewMappings[0].matrix),o=[this.dataViewSerializer.deserializeDataView(n,nn(this.plugin.apiVersion,"3.5.9"),a,i,oh(this.plugin.apiVersion,"5.3.0"))],this.lastVisualUpdateOptions.type=xt.Data,r?(jm(this.lastVisualUpdateOptions.dataViews[0],o[0]),this.lastVisualUpdateOptions.operationKind=lr.Append,[4,this.aggregateDataViewSizeAndUpdateVisual(e.packedSize)]):[3,2]):[3,4]):[3,5];case 1:return d.sent(),[3,4];case 2:return this.lastVisualUpdateOptions.dataViews[0]=o[0],this.lastVisualUpdateOptions.operationKind=lr.Segment,[4,this.visual.update(this.lastVisualUpdateOptions)];case 3:d.sent(),d.label=4;case 4:return[3,9];case 5:return u.assert("Expected to have previous segment already"),(l=(s=e.message.arguments[0])?s.dataReaderResult.dataView:null)?(this.lastVisualUpdateOptions.type=xt.Data,r?(jm(this.lastDataViewTransformApplyOptions.prototype,l),this.lastVisualUpdateOptions.dataViews=dc(this.lastDataViewTransformApplyOptions).dataViews,this.lastVisualUpdateOptions.operationKind=lr.Append,[4,this.aggregateDataViewSizeAndUpdateVisual(e.packedSize)]):[3,7]):[3,9];case 6:return d.sent(),[3,9];case 7:return this.lastVisualUpdateOptions.dataViews[0]=l,this.lastVisualUpdateOptions.operationKind=lr.Segment,[4,this.visual.update(this.lastVisualUpdateOptions)];case 8:d.sent(),d.label=9;case 9:return this.messageProxy.postMessage({eventName:"stopProgressBar",arguments:[]}),[2]}})})},t.prototype.aggregateDataViewSizeAndUpdateVisual=function(e){return et(this,void 0,Qe,function(){return tt(this,})},t.prototype.handleGetResourceUrlResult=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId,e.payload):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.payload)},t.prototype.handleGetAADAuthenticationTokenResult=t.prototype.handleGetAADTokenResult=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId,e.payload):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.payload)},t.prototype.handleGetWACTokenResult=t.prototype.handleGetStorageStatus=function(e){this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.status)},t.prototype.handleGetStorageData=function(e){e.data?this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.data):this.sandboxPromiseHandler.RejectPromise(e.promiseId)},t.prototype.handleSetStorageData=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.freeSpace)},t.prototype.handleGetStorageV2Data=t.prototype.handleSetStorageV2Data=t.prototype.handleExportVisualsContentStatus=function(e){void 0!==e.status?this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.status):this.sandboxPromiseHandler.RejectPromise(e.promiseId)},t.prototype.handleExportVisualsContent=function(e){void 0!==e.data?this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.data):this.sandboxPromiseHandler.RejectPromise(e.promiseId)},t.prototype.handleGetWebAccessStatus=t.prototype.handleModalDialogResult=t.prototype.handleAcquireAADTokenResult=function(e){this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.data)},t.prototype.handleGetAcquireAADTokenStatus=t.prototype.handleLicenseResult=t.prototype.handleLicenseNotificationResult=t.prototype.onRestoreSelection=function(e){var r=this.hostServices.selectionManager;if(r)if(e&&e.selection){var n=e.selection.map(function(i){return $a.fromSelectorsByColumn(function(t){if(u.assertAnyValue(t,"input"),t){var e={};if(t.dataMap)for(var r in e.dataMap={},t.dataMap)e.dataMap[r]=_.chain(t.dataMap[r]).map(function(n){return _y(n)}).filter(.value();return t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),e}}(i))});r.setSelectionIds(n),r.invokeOnSelectCallback(n)}else r.setSelectionIds([]),r.invokeOnSelectCallback([])},t.prototype.onRestoreCvSelectionIds=function(e,r){void 0===r&&(r=!0);var n=this.hostServices.selectionManager;if(n){var i=[];e?(i=_.map(e,,n.setSelectionIds(i)):n.setSelectionIds([]),r&&n.invokeOnSelectCallback(i)}},t.prototype.fixUpdateOptionsAndUpdateVisual=Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",Object)],t.prototype,"init",null),Q([j(),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",void 0)],t.prototype,"destroy",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"update",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"updateWithCachedData",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"loadWithoutResourcePackage",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",Object)],t.prototype,"enumerateObjectInstances",null),Q([j(),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Array)],t.prototype,"enumerateObjectRepetition",null),Q([j(),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Object)],t.prototype,"getFormattingModel",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Array]),M("design:returntype",Object)],t.prototype,"getSubSelectionStyles",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Array,String]),M("design:returntype",Array)],t.prototype,"getSubSelectionShortcuts",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Number]),M("design:returntype",Array)],t.prototype,"getSubSelectables",null),Q([j(),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",void 0)],t.prototype,"focusVisualIframeWindow",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",Qe)],t.prototype,"handleLoadMoreDataResult",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleGetResourceUrlResult",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleGetAADAuthenticationTokenResult",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleGetAADTokenResult",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleGetWACTokenResult",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleGetStorageStatus",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleGetStorageData",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleSetStorageData",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleGetStorageV2Data",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleSetStorageV2Data",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleExportVisualsContentStatus",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleExportVisualsContent",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleGetWebAccessStatus",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleModalDialogResult",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleAcquireAADTokenResult",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleGetAcquireAADTokenStatus",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleLicenseResult",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"handleLicenseNotificationResult",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"onRestoreSelection",null),Q([j(),M("design:type",Function),M("design:paramtypes",[Array,Object]),M("design:returntype",void 0)],t.prototype,"onRestoreCvSelectionIds",null),t}();function PS(){if(!RS){window.powerbi||(window.powerbi={}),window.powerbi.visualSandbox||(window.powerbi.visualSandbox={});var t=IS;window.powerbi.visualSandbox.createSandboxHost=RS=!0}}var RS=!1;function NS(){if(!kS){window.powerbi||(window.powerbi={}),window.powerbi.visualSandbox||(window.powerbi.visualSandbox={});var t=TS;window.powerbi.visualSandbox.onSecurityPolicyViolation=kS=!0}}PS();var kS=!1;NS(),qm(),window.customVisualsHost=fs}();