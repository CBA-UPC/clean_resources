![function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=n(17),s=n(18),c=n(20),l={settings:{coreHost:"https://core.spreedly.com"}};function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;return"".concat(t.settings.coreHost,"/api/internal/v1/transactions/").concat(e,"/status.json")}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return e.environmentKey&&(t["Spreedly-Environment-Key"]=e.environmentKey),t}var p=function(){function e(t,n,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:500,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l;(0,i.default)(this,e),this.endpoint=u(t,d),this.done=n,this.handleData=this.handleData.bind(this),this.handleError=this.handleError.bind(this),this.fetchData=this.fetchData.bind(this),this.retryable=new s(a,c,this.fetchData,r),this.environmentKey=o}return(0,o.default)(e,[{key:"run",value:function(){this.retryable.runNow()}},{key:"stop",value:,{key:"fetchData",value:function(){var e=d({environmentKey:this.environmentKey}),t=(new Date).getTime();a.getJSON("".concat(this.endpoint,"?time=").concat(t),this.handleData,this.handleError,e)}},{key:"handleData",value:function(e){return!!this.retryable.isRunning()&&(e.transaction&&e.transaction.state&&"pending"!==e.transaction.state?(this.retryable.stop(),this.done(e.transaction),!0):(this.done(e.transaction),this.retryable.runLater(),!0))}},{key:"handleError",value:function(){return!!this.retryable.isRunning()&&(this.retryable.runLater(),!0)}}],[{key:"withStatus",value:function(e,t,n,r){var i=d({environmentKey:t});a.getJSON(u(e),n,r,i)}},{key:"withContext",value:function(t,n,r,i){e.withStatus(t,n,(function(e){r(c.decode(e.transaction&&e.transaction.context)||e.transaction)}),i)}},{key:"contextFrom",value:function(e){var t=null;if(e.transaction&&e.transaction.context)try{var n=window.atob(e.transaction.context);t=window.JSON.parse(n)}catch(e){}return t}}]),e}();e.exports=p},function(e,t,n){"use strict";e.exports={ajax:{post:function(e,t,n){var r=new XMLHttpRequest,i=JSON.parse(t);r.onreadystatechange=r.open("POST",e,!0),r.setRequestHeader("CONTENT-TYPE","application/json"),i&&i.environment_key&&r.setRequestHeader("Spreedly-Environment-Key",i.environment_key),r.send(t)}},addListener:addInputListener:function(e,t){void 0===e.oninput||null===e.oninput?(this.addListener(e,"change",t),this.addListener(e,"keyup",t)):this.addListener(e,"input",t)},removeListener:function(e,t,n){e&&(e.addEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&"string"==typeof t&&"function"==typeof n&&e.detachEvent("on"+t,n))},getElementWithAttribute:function(e,t){for(var n=document.getElementsByTagName(e),r=0;r<n.length;r++)if(n[r].getAttribute(t))return n[r]},domain:function(e){if(void 0!==e){var t=e.match(/^(https?:\/\/[^\/?#]+)(?:[\/?#]|$)/i);return t&&t[1]}},camelize:function(e){if(void 0!==e){var t=e.split("-");if(1===t.length)return e;for(var n=t[0],r=1;r<t.length;r++){var i=t[r];n=n+i.charAt(0).toUpperCase()+i.slice(1)}return n}},stripTags:setText:function(e,t){void 0!==e&&void 0!==t&&(e.textContent&&void 0!==e.textContent?e.textContent=t:e.innerText=t)},style:function(e,t,n){if(void 0!==t&&void 0!==n){var r=this.camelize(t.trim());if(this.cssProperties.includes(r))for(var i=0;i<e.length;i++){var o=e[i];"fontFamily"===r&&this.importFont(this.camelize(n.trim().toLowerCase().replaceAll("'","").replaceAll(" ","-"))),o.style[this.cssToJsProperty(r)]=n.trim()}}},importFont:function(e){var t=this.spreedlyHostedFontFamilies[e];if(t){var n="".concat("https://core.spreedly.com","/stylesheets/fonts/").concat(e);t.styles.forEach((function(e){var r=new FontFace(t.fontFamily,"url(".concat(n,"/").concat(e.file,")"),{style:e.style,weight:e.weight});document.fonts.add(r)}))}},removeClass:function(e,t){var n=new RegExp("(?:^|\\s)"+t+"(?!\\S)","g");e.className=e.className.replace(n,"")},hasClass:addClass:cssToJsProperty:spreedlyHostedFontFamilies:{lato:{fontFamily:"Lato",styles:[{file:"Lato-Bold.ttf",style:"normal",weight:"700"},{file:"Lato-Light.ttf",style:"normal",weight:"300"},{file:"Lato-Regular.ttf",style:"normal",weight:"400"}]}},cssProperties:["accentColor","alignContent","alignItems","alignSelf","alignTracks","all","animation","animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimeline","animationTimingFunction","appearance","aspectRatio","backdropFilter","backfaceVisibility","background","backgroundAttachment","backgroundBlendMode","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPosition","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize","blockSize","border","borderBlock","borderBlockColor","borderBlockEnd","borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth","borderBlockStart","borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth","borderBlockStyle","borderBlockWidth","borderBottom","borderBottomColor","borderBottomLeftRadius","borderBottomRightRadius","borderBottomStyle","borderBottomWidth","borderCollapse","borderColor","borderEndEndRadius","borderEndStartRadius","borderImage","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderInline","borderInlineColor","borderInlineEnd","borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth","borderInlineStart","borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth","borderInlineStyle","borderInlineWidth","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRadius","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderStartEndRadius","borderStartStartRadius","borderStyle","borderTop","borderTopColor","borderTopLeftRadius","borderTopRightRadius","borderTopStyle","borderTopWidth","borderWidth","bottom","boxDecorationBreak","boxShadow","boxSizing","breakAfter","breakBefore","breakInside","captionSide","caretColor","clear","clip","clipPath","color","columnCount","columnFill","columnGap","columnRule","columnRuleColor","columnRuleStyle","columnRuleWidth","columnSpan","columnWidth","columns","contain","content","contentVisibility","counterIncrement","counterReset","counterSet","cursor","direction","display","emptyCells","filter","flex","flexBasis","flexDirection","flexFlow","flexGrow","flexShrink","flexWrap","float","font","fontFamily","fontFeatureSettings","fontKerning","fontLanguageOverride","fontOpticalSizing","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontSynthesis","fontVariant","fontVariantAlternatives","fontVariantCaps","fontVariantEastAsian","fontVariantEmoji","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontVariationSettings","fontWeight","forcedColorAdjust","gap","grid","gridArea","gridAutoColumns","gridAutoFlow","gridAutoRows","gridColumn","gridColumnEnd","gridColumnStart","gridRow","gridRowEnd","gridRowStart","gridTemplate","gridTemplateAreas","gridTemplateColumns","gridTemplateRows","hangingPunctuation","height","hyphenatedCharacter","hyphens","imageOrientation","imageRendering","imageResolution","inherit","initial","initialLetter","initialLetterAlign","inlineSize","inset","insetBlock","insetBlockEnd","insetBlockStart","insetInline","insetInlineEnd","insetInlineStart","isolation","justifyContent","justifyItems","justifySelf","justifyTracks","left","letterSpacing","lineBreak","lineHeight","lineHeightStep","listStyle","listStyleImage","listStylePosition","listStyleType","margin","marginBlock","marginBlockEnd","marginBlockStart","marginBottom","marginInline","marginInlineEnd","marginInlineStart","marginLeft","marginRight","marginTop","marginTrim","maxBlockSize","maxHeight","maxInlineSize","maxWidth","minBlockSize","minHeight","minInlineSize","minWidth","mixBlendMode","objectFit","objectPosition","offset","offsetAnchor","offsetDistance","offsetPath","offsetPosition","offsetRotate","opacity","order","orphans","outline","outlineColor","outlineOffset","outlineStyle","outlineWidth","overflow","overflowAnchor","overflowBlock","overflowClipMargin","overflowInline","overflowWrap","overflowX","overflowY","overscrollBehavior","overscrollBehaviorBlock","overscrollBehaviorInline","overscrollBehaviorX","overscrollBehaviorY","padding","paddingBlock","paddingBlockStart","paddingBlockEnd","paddingBottom","paddingInline","paddingInlineEnd","paddingInlineStart","paddingLeft","paddingRight","paddingTop","pageBreakAfter","pageBreakBefore","pageBreakInside","perspective","perspectiveOrigin","placeContent","placeItems","placeSelf","pointerEvents","position","printColorAdjust","quotes","resize","revert","right","rotate","scale","tabSize","tableLayout","textAlign","textAlignLast","textAlignUpright","textDecoration","textDecorationColor","textDecorationLine","textDecorationStyle","textDecorationThickness","textEmphasis","textEmphasisColor","textEmphasisPosition","textEmphasisStyle","textIndent","textJustify","textOrientation","textOverflow","textRendering","textShadow","textSizeAdjust","textTransform","textUnderlineOffset","textUnderlinePosition","top","touchAction","transform","transformBox","transformOrigin","transformStyle","transition","transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction","unicodeBidi","verticalAlign","visibility","whiteSpace","widows","width","willChange","wordBreak","wordSpacing","wordWrap","writingMode","zIndex","-moz-appearance","-webkit-appearance"],cssToJsPropertyMappings:{float:"cssFloat"},mobile:screen.width<=480,browserVersion:},function(e,t,n){"use strict";e.exports=,function(e,t,n){"use strict";e.exports=function(e,t){return e[t]&&e[t].cdata||e[t]}},,,function(e,t,n){"use strict";var r={getJSON:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r.setupRequest(e,"GET",t,n,i).send()},postJSON:function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};r.setupRequest(e,"POST",n,i,o).send(JSON.stringify(t))},setupRequest:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===this.readyState){var e=null;try{(e=JSON.parse(this.responseText)).status=this.status}catch(t){e={status:this.status,unparseable:!0,message:"Unable to parse the response."}}this.status<400?n(e):r(e)}},o.open(t,e,!0),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Cache-Control","no-cache");for(var a=0,s=Object.keys(i);a<s.length;a++){var c=s[a];o.setRequestHeader(c,i[c])}return o}};e.exports=r},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(t,n,r,o){(0,i.default)(this,e),this.count=1,this.max=t,this.delay=n,this.work=r,this.exceeded=o,this.timeoutId=null,this.running=!0,this.runNow=this.runNow.bind(this),this.runLater=this.runLater.bind(this),this.isRunning=this.isRunning.bind(this)}return(0,o.default)(e,[{key:"runNow",value:function(){return!!this.running&&(this.work(),this.count++,!(this.count>this.max)||(this.exceeded(),this.stop(),!1))}},{key:"runLater",value:function(){var e=this;return!!this.isRunning()&&(this.timeoutId=setTimeout((,this.delay),!0)}},{key:"stop",value:,{key:"isRunning",value:function(){return this.running}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"decode",value:function(e){if(e)try{return window.JSON.parse(window.atob(e))}catch(e){}return null}}]),e}();e.exports=a},function(e,t,n){"use strict";e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=null==e,i="".concat(t," is required");if(r&&n)console.warn(i);else if(r)throw i;return e}},function(e,t,n){"use strict";var r=n(0),i=r(n(5)),o=r(n(1)),a=r(n(2));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=n(11),u=n(12),d=n(21),p=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l();(0,o.default)(this,e),this.frameId=t,this.destination=n,this.contents=r,this.token=i}return(0,a.default)(e,[{key:"inject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(document.getElementById(this.frameId))return!1;var t=document.getElementById(this.destination),n=document.createElement("iframe"),r=this.token;return e.show||(n.style.display="none"),e.classes&&(n.className=e.classes),n.src=e.src?e.src:"data:text/html;charset=utf-8,"+this.encodeContentsAndReceiverScript(),n.id=this.frameId,e.submit&&(n.onload=,t.appendChild(n),!0}},{key:"encodeContentsAndReceiverScript",value:function(){return encodeURI(this.contents+this.generateReceiverScript())}},{key:"generateReceiverScript",value:]),e}();e.exports={FrameManager:p,makeFrameManager:function(e){var t=e.frameManagerClass||p,n=e.frameId,r=e.destination,i=e.url,o=e.contents,a=e.injectOptions||{};d(n,"options.frameId"),d(i||o,"options.url or options.contents");var s=null,l=!1;return(u(i)||u(o))&&(s=new t(n,r,o),l=i?s.inject(c({submit:!1,src:i},a)):s.inject(c({submit:!0},a))),{success:l,frameManager:s}}}},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(0),i=r(n(8)),o=r(n(3)),a=r(n(10));r l=n(7),u=n(40),d=n(41),p=n(60),h=n(63),f=n(65),m=n(4),v=n(79),y=function(e){return document.getElementById("spreedly-iframe")?document.getElementById("spreedly-iframe").getAttribute(e):null},g=function(e,t){return null===t||0===t.length?e:e+(e.indexOf("?")>=0?"&":"?")+t},b=function(e){return"express"===e?"client="+e:""};function w(){var e=this;this.Utils=h,this.ThreeDS=f,this.init=function(e,t){this.isLoaded()&&this.unload(),t&&t.source&&(this.source=t.source),t&&t.numberEl?this.numberTarget=t.numberEl:this.numberTarget=y("data-number-id"),t&&t.cvvEl?this.cvvTarget=t.cvvEl:this.cvvTarget=y("data-cvv-id"),this.environmentKey=e||y("data-environment-key"),this.numberFrameId="spreedly-number-frame-"+this.uniqueId,this.cvvFrameId="spreedly-cvv-frame-"+this.uniqueId,this.addIframeElements()},this.c2pInit=function(){var e=(0,a.default)(i.default.mark((function e(t,n){var r,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.environmentKey=t||y("data-environment-key"),null!=n&&n.c2pConfig){e.next=4;break}return console.error("Click to Pay options are not present!"),e.abrupt("return");case 4:if(!(r=this.c2pSDKValidationAndInitialParams(n.isTest)).isValid){e.next=14;break}this.locale=r.c2pDpaLocale,n.c2pConfig.srcDpaId=r.srcDpaId,n.c2pConfig.dpaTransactionOptions.dpaLocale=this.locale,n.c2pSandbox=r.c2pSandbox,n.c2pSrc=r.c2pSrc,this.click2payInstance=new window.Click2Pay,e.next=16;break;case 14:return console.error("Mastercard SDK is not present!"),e.abrupt("return");case 16:return e.prev=16,e.next=19,this.click2payInstance.init(n.c2pConfig);case 19:o=e.sent,this.c2pInitiated(o,n),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(16),this.c2pError("c2p_invalid_initialization_options","C2P invalid initialization options.");case 26:case"end":return e.stop()}}),e,this,[[16,23]])})));return function(t,n){return e.apply(this,arguments)}}(),this.c2pInitiated=function(){var t=(0,a.default)(i.default.mark((function t(n,r){var o,a;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.availableCardBrands&&n.availableServices.length>=1)){t.next=27;break}return o=["mastercard","visa","discover","amex"],e.availableCardBrands=n.availableCardBrands.sort((),e.cardBrands=e.availableCardBrands.join(","),e.c2p={config:r.c2pConfig,frame_id:r.c2pFrameEl,frame_style:r.c2pFrameStyle,dpaId:r.c2pConfig.srcDpaId,isSandbox:r.c2pSandbox,src:r.c2pSrc},e.c2pSandboxLog("C2P valid options"),t.prev=6,t.next=9,e.click2payInstance.getCards();case 9:a=t.sent,t.next=16;break;case 12:return t.prev=12,t.t0=t.catch(6),e.c2pError("c2p_card_retrieval",t.t0),t.abrupt("return");case 16:if(e.c2pSandboxLog(a),!(a.length>0)){t.next=23;break}return e.c2pSandboxLog("Display cards"),t.next=21,e.displayCards(r,a);case 21:t.next=25;break;case 23:e.c2pSandboxLog("Identity lookup"),e.identifyLookup(r);case 25:t.next=28;break;case 27:console.error("C2P not valid options");case 28:case"end":return t.stop()}}),t,null,[[6,12]])})));return function(e,n){return t.apply(this,arguments)}}(),this.c2pSandboxLog=this.loadIdentifyLookupOptions=function(e){var t,n,r,i={mobileNumber:{}};null!=e&&null!==(t=e.customer)&&void 0!==t&&t.email&&(i.email=e.customer.email),null!=e&&null!==(n=e.customer)&&void 0!==n&&null!==(n=n.phone)&&void 0!==n&&n.number&&(i.mobileNumber.phoneNumber=e.customer.phone.number),null!=e&&null!==(r=e.customer)&&void 0!==r&&null!==(r=r.phone)&&void 0!==r&&r.countryCode&&(i.mobileNumber.countryCode=e.customer.phone.countryCode);var o=this.getMerchantElementById(null==e?void 0:e.emailEl,"data-email-id"),a=this.getMerchantElementById(null==e?void 0:e.phoneEl,"data-phone-id"),s=this.getMerchantElementById(null==e?void 0:e.countryCodeEl,"data-country-code-id");return null!=o&&o.value&&(i.email=o.value),null!=a&&a.value&&(i.mobileNumber.phoneNumber=a.value),null!=s&&s.value&&(i.mobileNumber.countryCode=s.value),i},this.getIdLookup=function(e){var t,n,r;return this.customer=this.loadIdentifyLookupOptions(e),"phoneNumber"===("phonenumber"===(null===(t=e.customer)||void 0===t||null===(t=t.mainLookupMethod)||void 0===t?void 0:t.toLowerCase())?"phoneNumber":"email")?this.isMobileNumberPresent(null===(n=this.customer)||void 0===n?void 0:n.mobileNumber)?{mobileNumber:this.customer.mobileNumber}:{email:this.customer.email}:null!==(r=this.customer)&&void 0!==r&&r.email?{email:this.customer.email}:{mobileNumber:this.customer.mobileNumber}},this.isMobileNumberPresent=this.identifyLookup=function(){var e=(0,a.default)(i.default.mark((function e(t){var n,r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.getIdLookup(t),e.next=4,this.click2payInstance.idLookup(n);case 4:null!=(r=e.sent)&&r.consumerPresent?this.handleOTP(t):this.makeVisibleNormalInit(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.c2pError("c2p_lookup",e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),this.c2pCVVContainer=function(){var e=document.getElementById(this.cvvTarget);this.cvvContainerTarget&&(this.cvvContainerEl=document.getElementById(this.cvvContainerTarget),this.cvvContainerEl?this.cvvContainerEl.appendChild(e):this.cardsEl.parentNode.insertBefore(e,this.cardsEl.nextSibling))},this.displayCards=function(){var e=(0,a.default)(i.default.mark((function e(t,n){var r,o,s,c,l=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this,this.cardsEl=this.getMerchantElementById(null==t?void 0:t.cardsEl,"data-cards-id"),o=n[0],s=null==t?void 0:t.displayCards,this.cardsEl.style.visibility="visible",c=["radioButton","gridView"],this.c2pSandboxLog("Display card list"),this.cardsEl.displaySignOut="boolean"!=typeof(null==s?void 0:s.displaySignOut)||s.displaySignOut,this.cardsEl.displayPreferredCard="boolean"!=typeof(null==s?void 0:s.displayPreferredCard)||s.displayPreferredCard,this.cardsEl.cardBrands=this.cardBrands,this.cardsEl.cardSelectionType=c.includes(null==s?void 0:s.cardSelectionType)?s.cardSelectionType:"radioButton",this.cardsEl.loadCards(n),this.cardsEl.displayAddCard="boolean"!=typeof(null==s?void 0:s.displayAddCard)||s.displayAddCard,this.cardsEl.locale=this.locale,this.cardsEl.srcDigitalCardId=o.srcDigitalCardId,this.init(this.environmentKey,t),this.cvvContainerTarget=null!=t&&t.cvvContainerEl?t.cvvContainerEl:y("data-cvv-container-id"),this.c2pCVVContainer(),this.emit("display-cards-ready"),this.c2pSandboxLog("default srcDigitalCardId:",this.cardsEl.srcDigitalCardId),this.cardsEl.addEventListener("selectSrcDigitalCardId",(function(e){r.c2pSandboxLog("srcDigitalCardId: ",e.detail),r.srcDigitalCardId=e.detail})),this.cardsEl.addEventListener("clickAddCardLink",(function(e){r.c2pSandboxLog("Add a Card button clicked: ",e),r.cardsEl.style.visibility="hidden",r.cardsEl.style.display="none",r.makeVisibleNormalInit(t)})),this.cardsEl.addEventListener("clickSignOutLink",(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.click2payInstance.signOut();case 3:return r.cardsEl.style.visibility="hidden",r.emit("c2p-session-deleted"),e.abrupt("return",!1);case 8:e.prev=8,e.t0=e.catch(0),l.c2pError("c2p_sign_out",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))));case 23:case"end":return e.stop()}}),e,this)})));return (),this.makeVisibleNormalInit=function(e){var t=this;this.init(this.environmentKey,e),this.emit("add-new-card",this.availableCardBrands);var n=this.getMerchantElementById(null==e?void 0:e.spreedlyPaymentFormEl,"data-spreedly-payment-form-id");n.style.visibility="visible";var r=this.getMerchantElementById(null==e?void 0:e.spreedlyPaymentFormC2PSubmitEl,"data-spreedly-payment-c2p-submit-id"),i=document.getElementById(this.cvvTarget);if(r.parentNode.insertBefore(i,r.previousSibling.previousSibling),e.isGuest&&(this.getMerchantElementById(null==e?void 0:e.spreedlyPaymentFormSubmitEl,"data-spreedly-payment-submit-id").style.visibility="visible",r.style.visibility="hidden"),r&&this.cardsEl){var o="go-back-link"+this.uniqueId;if(!document.getElementById(o)){var a=document.createElement("a");a.href="#",a.id=o,a.textContent="Go back",a.onclick=function(){t.c2pSandboxLog("Go back"),n.style.visibility="hidden",t.cardsEl.style.visibility="visible",t.cardsEl.style.display="block",t.emit("display-cards-ready"),t.c2pCVVContainer()},r.parentNode.insertBefore(a,r.afterSibling)}}},this.loadOTPElements=function(e){var t,n=this,r=["overlay","none"].includes(null==e||null===(t=e.otp)||void 0===t?void 0:t.type)?e.otp.type:"overlay";this.otpEl=this.getMerchantElementById(null==e?void 0:e.otpEl,"data-otp-id"),this.otpChannelsEl=this.getMerchantElementById(null==e?void 0:e.otpChannelSelectionEl,"data-otp-channel-selection-target-id"),this.otpChannelsEl.locale=this.locale,this.otpEl.cardBrands=this.cardBrands,this.otpEl.style.visibility="visible",this.otpEl.type=r,this.otpEl.locale=this.locale,this.otpEl.addEventListener("continue",(0,a.default)(i.default.mark((function t(){var r,o;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.handleValidation();case 3:(r=t.sent).isValid?(n.otpEl.style.visibility="hidden",n.otpEl.type="none",n.displayCards(e,r.cards)):r.errorReason?(n.otpEl.errorReason=r.errorReason,"ACCT_INACCESSIBLE"===r.errorReason&&(o=[{attribute:"otp_code",key:"errors.acct_inaccessible",message:"The account exists but is not currently accessible (e.g. is locked)."}],n.emit("errors",o),n.otpEl.style.visibility="hidden",n.otpEl.type="none")):n.c2pSandboxLog("No cards present"),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),n.c2pError("c2p_otp_handle_validation",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))),this.otpEl.addEventListener("otpChanged",(),this.otpEl.addEventListener("alternateRequested",(function(){var t;n.otpEl.style.visibility="hidden",n.otpEl.type="none",n.otpChannelsEl.style.visibility="visible",n.otpChannelsEl.type=["overlay","none"].includes(null==e||null===(t=e.otpChannels)||void 0===t?void 0:t.type)?e.otpChannels.type:"overlay",n.otpChannelsEl.cardBrands=n.cardBrands,n.otpChannelsEl.identityValidationChannels=n.otpChannels?n.otpChannels:n.otpDefaultChannel})),this.otpEl.addEventListener("close",(function(){return n.otpEl.style.visibility="hidden",n.otpEl.type="none",!1})),this.otpChannelsEl.addEventListener("continue",(function(){n.otpChannelsEl.style.visibility="hidden",n.otpChannelsEl.type="none","GUEST"===n.otpChannel.identityType?(e.isGuest=!0,n.makeVisibleNormalInit(e)):(n.otpEl.errorReason="",n.otpChannelRequested={requestedValidationChannelId:n.otpChannel.validationChannelId},n.handleOTP(e),n.otpEl.style.visibility="visible",n.otpEl.type=r)})),this.otpChannelsEl.addEventListener("selectChannel",(),this.otpChannelsEl.addEventListener("close",(function(){return n.otpChannelsEl.style.visibility="hidden",n.otpChannelsEl.type="none",!1}))},this.otpInitiated=function(e,t){var n;this.otpEl||this.otpChannelsEl?(this.otpEl.style.visibility="visible",this.otpEl.type=["overlay","none"].includes(null==t||null===(n=t.otp)||void 0===n?void 0:n.type)?t.otp.type:"overlay"):this.loadOTPElements(t);this.otpEl.maskedIdentityValue=e.maskedValidationChannel,this.otpDefaultChannel=[{identityType:"EMAIL",validationChannelId:"EMAIL",identityProvider:e.network,maskedValidationChannel:e.maskedValidationChannel}],this.otpChannels=e.supportedValidationChannels},this.otpRejected=function(){return this.emit("errors",[{attribute:"otp_code",key:"errors.otp_permissions_denied",message:"Unexpected error happened when trying to initiate validation"}])},this.handleOTP=function(){var e=(0,a.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.c2pSandboxLog("initiateValidation"),e.prev=1,e.next=4,this.click2payInstance.initiateValidation(this.otpChannelRequested);case 4:n=e.sent,this.otpInitiated(n,t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.otpRejected();case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),this.handleValidation=(0,a.default)(i.default.mark((function e(){var t,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.prev=1,e.next=4,this.click2payInstance.validate({value:this.otpValue});case 4:t.cards=e.sent,t.isValid=(null==t||null===(n=t.cards)||void 0===n?void 0:n.length)>0,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),t.isValid=!1,t.errorReason=e.t0.reason;case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,8]])}))),this.c2pCheckout=function(){var e=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setPermitableParams(t),this.setParam("c2p_dpa_id",this.c2p.dpaId),this.setParam("c2p_is_sandbox",this.c2p.isSandbox),null==t||!t.isCheckoutWithCard){e.next=9;break}return e.next=6,this.checkoutWithCard();case 6:t.isCheckoutWithCard=!1,e.next=11;break;case 9:this.setParam("c2p_available_card_brands",this.availableCardBrands),this.sendMessage("c2pNewCard");case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.c2pSDKValidationAndInitialParams=function(e){if(e)return e;var t=document.getElementsByTagName("script"),n=Array.prototype.slice.call(t),r=n.findIndex(();if(r>-1){var i=t[r].src,o=new URL(i),a=i.includes("sandbox"),s=new URLSearchParams(o.search),c=s.get("srcDpaId"),l=s.get("locale");return c?l?{srcDpaId:c,c2pDpaLocale:l,c2pSandbox:a,c2pSrc:i,isValid:!0}:void console.error("Locale is missing in the src params"):void console.error("DPA ID is missing in the src params")}return{isValid:!1}},this.checkoutWithCardWindow=function(){var e=this.c2p.frame_id,t=this.c2p.frame_style;this.c2pFrameTarget=e||y("data-click-to-pay-frame-id");var n=this.c2pFrameTarget?this.c2pFrameTarget:"";return n&&(document.getElementById(this.c2pFrameTarget).style.visibility="visible",document.getElementById(this.c2pFrameTarget).style.display="block"),this.c2pFrameEl=window.open("",n,t),this.c2pFrameEl},this.checkoutWithCard=(0,a.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.c2pSandboxLog("checkoutWithCard"),e.prev=1,e.next=4,this.click2payInstance.checkoutWithCard({srcDigitalCardId:this.srcDigitalCardId,windowRef:this.checkoutWithCardWindow()});case 4:return t=e.sent,this.c2pSandboxLog(t),this.triggerGetC2PToken(t),e.abrupt("return",t);case 10:e.prev=10,e.t0=e.catch(1),this.c2pError("c2p_checkout_with_card",e.t0);case 13:case"end":return e.stop()}}),e,this,[[1,10]])}))),this.checkoutWithNewCard=function(){var e=(0,a.default)(i.default.mark((function e(t){var n,r,o,a,s;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.c2pSandboxLog("checkoutWithNewCard"),a={encryptedCard:t.JWE,windowRef:this.checkoutWithCardWindow(),cardBrand:t.cardType,consumer:{emailAddress:null===(n=this.customer)||void 0===n?void 0:n.email,mobileNumber:{phoneNumber:null===(r=this.customer)||void 0===r||null===(r=r.mobileNumber)||void 0===r?void 0:r.phoneNumber,countryCode:null===(o=this.customer)||void 0===o||null===(o=o.mobileNumber)||void 0===o?void 0:o.countryCode}}},e.prev=2,e.next=5,this.click2payInstance.checkoutWithNewCard(a);case 5:return s=e.sent,this.c2pSandboxLog(s),this.triggerGetC2PToken(s),e.abrupt("return",s);case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",this.c2pError("checkout_code","The card entered is not valid."));case 14:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t){return e.apply(this,arguments)}}(),this.makeInvisibleC2PFrame=function(){document.getElementById(this.c2pFrameTarget).style.visibility="hidden",document.getElementById(this.c2pFrameTarget).style.display="none",this.c2pFrameEl.close()},this.triggerGetC2PToken=function(){var e=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.checkoutActionCode.toUpperCase(),e.next="CHANGE_CARD"===e.t0?3:"ADD_CARD"===e.t0?7:"SWITCH_CONSUMER"===e.t0?11:"CANCEL"===e.t0?15:"COMPLETE"===e.t0?19:24;break;case 3:return this.c2pSandboxLog("Consumer wishes to select an alternative card."),this.emit("checkout-different-pm"),this.makeInvisibleC2PFrame(),e.abrupt("break",27);case 7:return this.c2pSandboxLog("Consumer wishes to add a new card."),this.emit("add-new-card"),this.makeInvisibleC2PFrame(),e.abrupt("break",27);case 11:return this.c2pSandboxLog("Consumer wishes to change account profile / identity"),this.emit("c2p-session-deleted"),this.makeInvisibleC2PFrame(),e.abrupt("break",27);case 15:return this.c2pSandboxLog("Consumer wishes to cancel the flow"),this.emit("checkout-cancelled"),this.makeInvisibleC2PFrame(),e.abrupt("break",27);case 19:return this.c2pSandboxLog("Checkout processing completed normally â€“ Success"),this.setParam("environment_key",this.environmentKey),this.setParam("c2p_checkout_response",t),this.sendMessage("getTokenBasedOnC2PToken"),e.abrupt("break",27);case 24:this.emit("checkout-error"),this.c2pSandboxLog("An error was detected and the checkout processing cannot continue","- resume normally Business as usual without click to pay"),console.error("An error was detected and the checkout processing cannot continue.");case 27:return e.abrupt("return",!1);case 28:case"end":return e.stop()}}),e,this)})));retur}}(),this.addIframeElements=function(){var e=u('<iframe sandbox="allow-scripts allow-same-origin" frameborder="0" width="100%" height="100%" scrolling="no"></iframe>');e.id=this.numberFrameId,e.name=this.numberFrameId,e.setAttribute("src",g("https://core.spreedly.com/v1/embedded/number-frame-1.119.html",b(this.source))),document.getElementById(this.numberTarget).appendChild(e);var t=u('<iframe sandbox="allow-scripts allow-same-origin" frameborder="0" width="100%" height="100%" scrolling="no"></iframe>');t.id=this.cvvFrameId,t.name=this.cvvFrameId,t.setAttribute("src",g("https://core.spreedly.com/v1/embedded/cvv-frame-1.119.html",b(this.source))),document.getElementById(this.cvvTarget).appendChild(t)},this.getMerchantElementById=function(e,t){var n=e||y(t);return document.getElementById(n)},this.stripeRadar=function(e,t,n){var r;if(!window.Stripe)return console.error("Cannot find Stripe on page."),t(null),null;var i={canCreateRadarSession:!0};if(null!=n&&n.stripeAccount&&(i.stripeAccount=n.stripeAccount),!(r=window.Stripe(e,i)))return console.error("Creating a Stripe session failed."),t(null),null;r.createRadarSession().then((function(e){var n;e.radarSession&&e.radarSession.id?n=e.radarSession.id:(e.error&&console.error("Spreedly: Creating a radar session failed. Reason: "+e.error.message),n=null),t(n)}))},this.createStripePaymentElement=function(e){if(!window.Stripe)return{error:"Cannot find Stripe on page."};if(!e.publishableKey)return{error:"Required input field 'publishableKey' was not supplied."};if(!e.clientSecret)return{error:"Required input field 'clientSecret' was not supplied."};if(!e.transactionToken)return{error:"Required input field 'transactionToken' was not supplied."};if(!e.paymentElement)return{error:"Required input field 'paymentElement' was not supplied."};var t=window.Stripe(e.publishableKey);if(!t)return{error:"Creating a Stripe session failed."};var n={clientSecret:e.clientSecret,appeareance:e.appeareance},r=e.spreedlyRoot||"https://core.spreedly.com",i={return_url:"".concat(r,"/transaction/").concat(e.transactionToken,"/redirect")},o=t.elements(n);return o.create("payment").mount(e.paymentElement),{confirmPaymen}}},this.createBraintreePaymentElements=function(e){var t,n,r,i,o=["callbackFunction","transactionToken","paymentElements","environmentKey"].filter}));if(o.length>0)return{error:"Missing required parameter/s: ".concat(o)};var a=[];if(null!==(t=window.braintree)&&void 0!==t&&t.client||a.push("Client"),!e.paymentElements.paypal||null!==(n=window.braintree)&&void 0!==n&&n.paypalCheckout||a.push("Paypal Checkout"),!e.paymentElements.venmo||null!==(r=window.braintree)&&void 0!==r&&r.venmo||a.push("Venmo"),!e.paymentElements.venmo||null!==(i=window.braintree)&&void 0!==i&&i.dataCollector||a.push("Data Collector"),a.length>0)return{error:"The following Braintree scripts are not present on page: ".concat(a)};if("function"!=typeof e.callbackFunction)return{error:"Required parameter 'callbackFunction' is not a function."};var s=function(t){var n;if(t.transaction){var r={amount:t.transaction.amount/100,currencyCode:t.transaction.currency_code,clientToken:t.transaction.client_token,paymentMethodUsed:t.transaction.payment_method_type,paypalFlow:t.transaction.paypal_flow_type,transactionType:t.transaction.transaction_type,venmoFlow:t.transaction.venmo_flow_type,venmoProfileId:t.transaction.venmo_profile_id,billingAgreementDescription:t.transaction.billing_agreement_description,lineItems:t.transaction.line_items,shippingAddress:t.transaction.shipping_address,locale:t.transaction.locale};if(!["vault","checkout_with_vault"].includes(r.paypalFlow)||!e.paymentElements.paypal||null!==(n=window.braintree)&&void 0!==n&&n.dataCollector)if(Object.keys(e.paymentElements).includes(r.paymentMethodUsed.toLowerCase()))l(t.transaction.created_at)?v.initializeBraintreeButtons(e,r):console.error("The client token is no longer valid.");else console.error("Cannot find payment element corresponding to payment method used during transaction.");else console.error("The Data Collector Braintree script is not present on page")}else console.error("An error occured while obtaining required information from transactionToken.")},},l=function(e){var t=new Date(e),n=new Date;return!(Math.abs(t.getTime()-n.getTime())>=864e5)};"testToken"==e.transactionToken?window.withStatus(e.transactionToken,e.environmentKey,s,c):m.withStatus(e.transactionToken,e.environmentKey,s,c)},this.checkUniqueI},this.o},this.emi},this.c2pError=function(e,t){var n={attribute:e,key:"errors.".concat(e),message:t};return this.emit("errors",[n])},this.isLoaded=function(){return!(!this.numberFrameId&&!this.cvvFrameId)&&!(!document.getElementById(this.numberFrameId)&&!document.getElementById(this.cvvFrameId))},this.reload=function(){this.unload();var e={numberEl:this.numberTarget,cvvEl:this.cvvTarget};this.init(this.environmentKey,e)},this.removeHandler},this.resetFields=function(){this.sendMessage("reset")},this.sendMessage=function(e){document.getElementById(this.numberFrameId).contentWindow.postMessage(e,"https://core.spreedly.com")},this.setValue=function(e,t){"cvv"===e?this.sendMessage("setCvv: "+t):"number"===e&&this.sendMessage("setNumber: "+t)},this.setLabel=function(e,t){"cvv"===e?this.sendMessage("setCvvLabel: "+t):"number"===e&&this.sendMessage("setNumberLabel: "+t)},this.setTitle=function(e,t){"cvv"===e?this.sendMessage("setCvvTitle: "+t):"number"===e&&this.sendMessage("setNumberTitle: "+t)},this.setInputMode=function(e,t){"cvv"===e?this.sendMessage("setCvvInputMode: "+t):"number"===e&&this.sendMessage("setNumberInputMode: "+t)},this.setFieldType=function(e,t){t||(t=e,e="number"),"cvv"===e?this.sendMessage("setCvvType: "+t):"number"===e&&this.sendMessage("setNumberType: "+t)},this.setNumberFormat=function(e){this.sendMessage("numberFormat: "+e)},this.toggleAutoComplete=function(){this.sendMessage("autoComplete")},this.toggleMask=function(){this.sendMessage("toggleMask")},this.setPlaceholder=function(e,t){this.sendMessage("placeholder: "+e+":"+t)},this.setParam=function(e,t){"object"===(0,o.default)(t)&&null!==t&&(t=JSON.stringify(t)),this.sendMessage("param("+e+"): "+t)},this.setStyl},this.setRecache=function(e,t){this.sendMessage("setRecache: "+e),this.setParam("environment_key",this.environmentKey),t&&t.last_four_digits&&this.setParam("last_four_digits",t.last_four_digits),t&&t.card_type&&this.setParam("card_type",t.card_type)},this.recache=function(){this.sendMessage("recache")},this.setPermitableParams=function(e){if(this.setParam("environment_key",this.environmentKey),e){var t,n=Object.keys(e),r=s(x);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.includes(i)&&("string"==typeof e[i]||"number"==typeof e[i]?""!==e[i]&&this.setParam(i,e[i]):console.warn("Tokenization parameter ".concat(i," should be type string, was type ").concat((0,o.default)(e[i]))))}}catch(e){r.e(e)}finally{r.f()}var a,c=s(E);try{for(c.s();!(a=c.n()).done;){var l=a.value;n.includes(l)&&("boolean"==typeof e[l]||"true"===e[l].toLowerCase()||"false"===e[l].toLowerCase()?this.setParam(l,e[l]):console.warn("Tokenization parameter ".concat(l," should be type boolean or string 'true' or 'false'")))}}catch(e){c.e(e)}finally{c.f()}var u,d=s(C);try{for(d.s();!(u=d.n()).done;){var p=u.value;n.includes(p)&&("object"===(0,o.default)(e[p])?this.setParam(p,e[p]):console.warn("Tokenization parameter ".concat(p," should be type object, was type ").concat((0,o.default)(e[p]))))}}catch(e){d.e(e)}finally{d.f()}}},this.tokenizeCreditCard=function(e){return this.setPermitableParams(e),this.sendMessage("getToken"),!1},this.transferFocu},this.unload=function(){var e=document.getElementById(this.numberFrameId);e&&e.parentNode.removeChild(e);var t=document.getElementById(this.cvvFrameId);t&&t.parentNode.removeChild(t)},this.validat},this.buildMessageHandler=function(){var e=this;return function(t){if(("string"==typeof t.data||t.data instanceof String)&&"https://core.spreedly.com"===t.origin&&e.checkUniqueId(t.data.substring(0,4))&&e.isLoaded()){var n,r=t.data.substring(4);if("frameLoaded:"===r);else if("iframesReady"===r)e.source&&e.sendMessage("source: "+e.source),e.emit("ready");else if("recacheReady"===r)e.emit("recacheReady");else if(n=r.match(/paymentMethod\((.*)\): (.*)/i))e.emit("paymentMethod",n[1],JSON.parse(n[2]));else if(n=r.match(/c2pCard: (.*)/i)){var i=JSON.parse(n[1]);e.checkoutWithNewCard(i)}else if(n=r.match(/recacheResult\((.*)\): (.*)/i))e.emit("recache",n[1],JSON.parse(n[2]));else if(n=r.match(/errors: (.*)/i))e.emit("errors",JSON.parse(n[1]));else if(n=r.match(/validation: (.*)/i))e.emit("validation",JSON.parse(n[1]));else if(n=r.match(/input: (.*)/i)){var o=JSON.parse(n[1]),a=o.activeElement;e.emit("fieldEvent",a,"input",a,o)}else(n=r.match(/notifyEvent\( (.*)\): (.*):(.*)/i))?e.emit("fieldEvent",n[1],n[2],n[3],{}):(n=r.match(/consoleError: (.*)/i))?e.emit("consoleError",JSON.parse(n[1])):"numberSet"===r?e.emit("numberSet"):"cvvSet"===r?e.emit("cvvSet"):(n=r.match(/sourceSet: (.*)/i))&&e.emit("sourceSet",n[1])}}},this.uniqueId=(Math.floor(8999*Math.random())+1e3).toString(),this.messageHandler=this.buildMessageHandler(),l.addListener(window,"message",this.messageHandler),this.emitter=new d}var k=new w;e.exports=k,window.Spreedly=k,window.SpreedlyPaymentFrame=w;var x=["first_name","last_name","full_name","email","month","year","address1","address2","city","state","zip","country","phone_number","company","shipping_address1","shipping_address2","shipping_city","shipping_state","shipping_zip","shipping_country","shipping_phone_number"],E=["eligible_for_card_updater"],C=["metadata"]},function(e,t,n){"use strict";e.exports=n(48)()?Object.assign:n(49)},function(e,t,n){"use strict";var r=n(66),i=n(67);e.exports={Lifecycle:i,serialize:r.serialize}},function(e,t,n){"use strict";function r(e){return function(t){var n=t||window;return n.screen&&n.screen[e]||null}}function i(e){return function(t){var n=t||window;return n.navigator&&n.navigator[e]||null}function a(e){var t=e||window;return t.navigator&&t.navigator.javaEnabled?t.navigator.javaEnabled():null}var s=r("width"),c=r("height"),l=r("colorDepth"),u=i("userAgent"),d=i("language");e.exports={width:s,height:c,depth:l,timezone:o,userAgent:u,java:a,language:d,serialize:function(e,t,n){var r=n||window;return btoa(JSON.stringify(function(e,t,n){var r=n||window;return{width:s(r),height:c(r),depth:l(r),timezone:o(),user_agent:u(r),java:a(r),language:d(r),browser_size:e,accept_header:t||"text/html,application/xhtml+xml,application/xml"}}(e,t,r)))}}},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=n(4),s=n(21),c=n(68),l=n(70),u=n(72),d=n(73),p=n(75),h=n(76),f=n(77),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e),this.hiddenIframeLocation=s(t.hiddenIframeLocation,"hiddenIframeLocation option"),this.transactionToken=s(t.transactionToken,"transactionToken option"),this.challengeIframeLocation=s(t.challengeIframeLocation,"challengeIframeLocation option"),this.challengeIframeClasses=t.challengeIframeClasses,this.environmentKey=s(t.environmentKey,"environmentKey option",!0),this.Redirect=t.Redirect||d,this.Challenge=t.Challenge||f,this.DeviceFingerprint=t.DeviceFingerprint||h,this.start=this.start.bind(this),this.poll=this.poll.bind(this),this.stopPolling=this.stopPolling.bind(this),this.finalize=this.finalize.bind(this),this.event=this.event.bind(this),this.error=this.error.bind(this),this.installPoller=this.installPoller.bind(this),this.poller=t.poller,this.statusManager=t.statusManager||new l,this.eventPublisher=new c(this.finalize,this.transactionToken,this.statusManager,t.notifier||window.Spreedly),this.StatusPolling=t.StatusPolling||a,this.deviceFingerprintTimeoutTask=t.deviceFingerprintTimeoutTask||new u(10,"device-fingerprint",this.eventPublisher)}return(0,o.default)(e,[{key:"installExtensions",valu}},{key:"start",value:function(){var e=this;this.StatusPolling.withContext(this.transactionToken,this.environmentKey}))}},{key:"poll",valu}},{key:"stopPolling",valu}},{key:"installPoller",value:function(e){if(!e)return!1;this.stopPolling(),this.poller=e,this.poller.run()}},{key:"finalize",value:function(e){if(!this.statusManager.recordOnChange("finalize",{state:"finalize"}))return"noop";this.Challenge.run(e,this.transactionToken,this.environmentKey,this.challengeIframeLocation,this.challengeIframeClasses,this.poll,this.finalize,this.installPoller,this.eventPublisher)}},{key:"handleUpdate",value:function(e,t){if(!this.statusManager.recordOnChange(e,t))return"noop";switch("".concat(t.state," & ").concat(t.required_action)){case"pending & redirect":case"pending & fallback":return this.Redirect.run(this,t,this.hiddenIframeLocation),"redirect";case"pending & challenge":return"start"!==e&&"polling"!==e||this.finalize(t),"challenge";case"pending & device_fingerprint":return this.DeviceFingerprint.run(t,this.transactionToken,this.environmentKey,this.hiddenIframeLocation,this.finalize,this.poll,this.installPoller,this.eventPublisher,this.deviceFingerprintTimeoutTask,"braintree"===t.gateway_type?this.challengeIframeLocation:void 0),"device_fingerprint"}return"succeeded"===t.state?(this.stopPolling(),this.event("handleEvent","succeeded",t),"succeeded"):"failed"===t.state||"gateway_processing_failed"===t.state||"gateway_setup_failed"===t.state?(this.stopPolling(),this.error("handleUpdate","Failed to process transaction",t),"failed"):void 0}},{key:"error",value:function(e,t,n){var r={state:n.state,message:n.message,error_code:n.error_code};this.stopPolling(),this.eventPublisher.error(e,t,r)}},{key:"event",valu}}]),e}();e.exports=m},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=n(69),s=function(){function e(t,n,r,o){(0,i.default)(this,e),this.finalize=t,this.transactionToken=n,this.statusManager=r,this.event=this.event.bind(this),this.error=this.error.bind(this),this.notifier=o||window.Spreedly}return(0,o.default)(e,[{key:"event",value:function(e,t,n,r){return!!this.statusManager.recordOnChange(e,t,a)&&this.notifier.emit("3ds:status",{action:t,context:n,token:this.transactionToken,finalize:this.finalize,response:r})}},{key:"error",valu}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(t,n,r){(0,i.default)(this,e),this.initiator=t,this.index=n,this.action=r}return(0,o.default)(e,[{key:"getInitiator",value:function(){return this.initiator}},{key:"getIndex",value:function(){return this.index}},{key:"getType",value:function(){return"EventStatus"}},{key:"getAction",value:function(){return this.action}},{key:"diff",value:function(e){return e.getType()!==this.getType()||e.getAction()!==this.action}},{key:"toString",value:function(){return["Type:            ".concat(this.getType()),"Initiator:       ".concat(this.initiator),"Index:           ".concat(this.index),"Action:          ".concat(this.action)].join("\n")}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=n(71),s=function(){function e(){(0,i.default)(this,e),this.statuses=[new a]}return(0,o.default)(e,[{key:"getCurrentStatus",valu}},{key:"recordOnChange",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,r=new n(e,this.statuses.length,t),i=0;i<this.statuses.length;i++){var o=this.statuses[i];if(!o.diff(r))return!1}return this.statuses.push(r),!0}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,i.default)(this,e),this.initiator=t||"unknown",this.index=n||0,this.state=r.state||"unknown",this.requiredAction=r.required_action||"unknown"}return(0,o.default)(e,[{key:"getInitiator",value:function(){return this.initiator}},{key:"getIndex",value:function(){return this.index}},{key:"getRequiredAction",value:function(){return this.requiredAction}},{key:"getState",valu}},{key:"getType",valu}},{key:"diff",value:function(e){return e.getType()!==this.getType()||e.getState()!==this.state||e.getRequiredAction()!==this.requiredAction}},{key:"toString",value:function(){return["Type:            ".concat(this.getType()),"Initiator:       ".concat(this.initiator),"Index:           ".concat(this.index),"State:           ".concat(this.state),"Required Action: ".concat(this.requiredAction)].join("\n")}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(}return(0,o.default)(e,[{key:"start",value:function(e){this.eventPublisher.event("CancelableTask","".concat(this.context,"#start"),this),this.task=setTimeout(e,1e3*this.timeInSeconds)}},{key:"stop",value:function(){this.eventPublisher.event("CancelableTask","".concat(this.context,"#stop"),this),this.task&&clearTimeout(this.task)}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(74);e.exports={run:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;i(t,n)?e.event("Redirect.run","fallback",t):e.error("Redirect.run","fallback",t)}}},function(e,t,n){"use strict";var r=n(12),i=n(13);e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;if(!r(t))throw"A DOM id is required for injecting the 3DS 1 fallback";var o=i(e,"checkout_form");if(r(o)&&!/action\=\"\"/.test(o)){n.document.getElementById(t).innerHTML=o;var a=n.document.getElementById(t).getElementsByTagName("form");if(a.length>0)return a[0].submit(),!0}else if(r(e.checkout_url))return n.location=e.checkout_url,!0;return!1}},function(e,t,n){"use strict";var r=n(0),i=r(n(5)),o=r(n(1)),a=r(n(2));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=n(20),u=n(4),d=function(){function e(){(0,o.default)(this,e)}return(0,a.default)(e,null,[{key:"run",value:function(e,t,n,r,i,o,a,s,d,p,h,f,m,v){var y=m||braintree,g=v||l,b=new(f||u)(t,o}),n,200);s.event("Braintree Integration","device-fingerprint",e);var w=g.decode(e&&e.three_ds_context),k=c(c({},w.threeDSecureParameters),{},{onLookupComplet}});y.client.create({authorization:w.clientToken},(function(e,t){if(e)return b.stop(),void s.error("Braintree client error",{originalError:e});y.threeDSecure.create({version:"popup"!==p?"2-inline-iframe":2,client:t},(function(e,t){if(e)return b.stop(),void s.error("Braintree 3DS Client error",{originalError:e});"popup"!==p&&t.on("authentication-iframe-available",(function(e,t){document.getElementById(p).appendChild(e.element),t()})),t.verifyCard(k,(function(e,t){if(e)return b.stop(),void s.error("Braintree 3DS Authentication error",{originalError:e});s.event("Braintree 3DS Integration","trigger-completion",{payment_method_nonce:t.nonce})}))}))})),a(b)}}]),e}();e.exports=d},function(e,t,n){"use strict";var r=n(0)(n(5));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var a=n(13),s=n(4),c=n(22).makeFrameManager;e.exports={run:function(e,t,n,r,i,l,u,d,p,h,f){var m=f||s,v=(h||c)({frameId:"challenge-flow",destination:r,url:e.device_fingerprint_form_embed_url,contents:a(e,"device_fingerprint_form")}),y=v.success,g=v.frameManager;if(y&&g){var b=new m(t,l,(function(t){var n=o(o({},e),t);d.event("DeviceFingerprint polling","trigger-completion",n),l(n)}),n,20);"worldpay"===e.gateway_type?(p.start})),window.addEventListener("message",(function(e){!function(e,t,n){var r=null;try{r=JSON.parse(e.data)}catch(t){r=e.data}r&&"profile.completed"===r.MessageType&&(n.stop(),t.event("sendPostMessageWhenTrusted","trigger-completion",r))}(e,d,p)}),!1)):d.event("DeviceFingerprint.run","device-fingerprint",e),u(b)}else d.error("DeviceFingerprint.run",o({step:"device-fingerprint"},e)),u(null)}}},function(e,t,n){"use strict";var r=n(0)(n(5));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var a=n(78),s=n(4);e.exports={run:function(e,t,n,r,i,c,l,u,d,p,h){var f=p||s,m=h||a,v=null;"pending"!==e.state||"challenge"!==e.required_action?d.error("Challenge.run",{state:e,errors:["Failed to finalize. The transaction is not in the correct state. State should be 'pending' and required action should be 'challenge'"]}):m(e,r,i)?(d.event("Challenge.run","challenge",e),v=new f(t})}),n,1200)):d.error("Challenge.run",{state:e,errors:["Failed to inject the challenge iframe, is the challengeIframeLocation valid?"]});u(v)}}},function(e,t,n){"use strict";var r=n(0)(n(5)var a=n(12),s=n(13),c=n(22).makeFrameManager,l=n(11);e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l;if(!t)throw"A DOM id is required for injecting the challenge form.";var u=s(e,"challenge_form"),d=e.challenge_form_embed_url,p={frameId:"challenge-iframe-".concat(i()),frameManagerClass:r,destination:t,injectOptions:{show:!0,classes:n}},h=null;if(a(d))h=c(o({url:d},p)).frameManager;else if(a(u))h=c(o({contents:u},p)).frameManager;else{if(!a(e.challenge_url))throw"challenge_form and challenge_url are missing. Ensure that one of them is included.";h=c(o({url:e.challenge_url},p)).frameManager}return h}},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(}return(0,o.default)(e,null,[{key:"initializeBraintreeButtons",value:function(t,n){braintree.client.create({authorization:n.clientToken},(function(r,i){r?console.error("Error creating client: ".concat(r)):(t.paymentElements.paypal&&e.paypalButton(t,i,n),t.paymentElements.venmo&&e.venmoButton(t,i,n))}))}},{key:"shippingAddressParams",value:function(e){if(e.shippingAddress&&e.shippingAddress.shipping_address1&&e.shippingAddress.shipping_city&&e.shippingAddress.shipping_state&&e.shippingAddress.shipping_zip&&e.shippingAddress.shipping_country)return{line1:e.shippingAddress.shipping_address1,city:e.shippingAddress.shipping_city,state:e.shippingAddress.shipping_state,postalCode:e.shippingAddress.shipping_zip,countryCode:e.shippingAddress.shipping_country,line2:e.shippingAddress.shipping_address2||"",phone:e.shippingAddress.shipping_phone_number||"",recipientName:e.shippingAddress.shipping_full_name||""}}},{key:"lineItemsParams",value:function(e){var t=[];return e.lineItems&&e.lineItems.forEach((function(e){if(e.quantity&&e.unit_amount&&e.name&&e.kind){var n={quantity:e.quantity,unitAmount:e.unit_amount/100,name:e.name,kind:e.kind,description:e.description||"",productCode:e.product_code||"",url:e.url||""};e.unit_tax_amount&&(n.unitTaxAmount=e.unit_tax_amount/100),t.push(n)}})),t}},{key:"checkoutFlowParams",value:function(t){var n={flow:"checkout",amount:t.amount,currency:t.currencyCode,intent:"OffsiteSynchronousAuthorization"==t.transactionType?"authorize":"capture"};"checkout_with_vault"==t.paypalFlow&&(n.requestBillingAgreement=!0,t.billingAgreementDescription&&(n.billingAgreementDetails={description:t.billingAgreementDescription}));var r=e.shippingAddressParams(t);r&&(n.shippingAddressOverride=r,n.enableShippingAddress=!0,n.shippingAddressEditable=!1);var i=e.lineItemsParams(t);return i.length&&(n.lineItems=i),n}},{key:"vaultFlowParams",value:function(t){var n={flow:"vault"};t.billingAgreementDescription&&(n.billingAgreementDescription=t.billingAgreementDescription);var r=e.shippingAddressParams(t);return r&&(n.shippingAddressOverride=r,n.enableShippingAddress=!0,n.shippingAddressEditable=!1),n}},{key:"venmoParams",value:function(e,t){var n={client:t,allowDesktop:!0};return e.venmoFlow&&(n.paymentMethodUsage=e.venmoFlow),e.venmoProfileId&&(n.profileId=e.venmoProfileId),n}},{key:"paypalButton",value:function(t,n,r){var i="";function o(n){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s={payment_method_type:"paypal"};function c(e){var t={state:"Successful",nonce:e.nonce,payment_method:s};return"vault"!=r.paypalFlow&&"checkout_with_vault"!=r.paypalFlow||(t.device_data=i),t}if(o={fundingSource:null!=a?a:paypal.FUNDING.PAYPAL,onApprove:function(e){return n.tokenizePayment(e}))},onCancel:function(e){t.callbackFunction({state:"Cancelled",message:"PayPal payment cancelled, ".concat(JSON.stringify(e,null,2)),payment_method:s})},onErro}},"vault"==r.paypalFlow?o.createBillingAgreement=function(){return n.createPayment(e.vaultFlowParams(r))}:o.createOrde},a){var l,u={},d=null==t||null===(l=t.style)||void 0===l?void 0:l.paypal;u=d?e.stylingButtons("paypal",d):{color:"gold"},o.style=u}return o}"vault"!=r.paypalFlow&&"checkout_with_vault"!=r.paypalFlow||braintree.dataCollector.create({client:n},(function(e,t){e?console.error("Error occured in the creation of data collector: ".concat(e)):i=t.deviceData})),braintree.paypalCheckout.create({client:n},(function(e,n){e?console.error("Error creating PayPal Checkout component: ".concat(e)):n.loadPayPalSDK(function(){var e={};e="vault"==r.paypalFlow?{vault:!0}:{currency:r.currencyCode,intent:"OffsiteSynchronousAuthorization"==r.transactionType?"authorize":"capture"};r.locale&&(e.locale=r.locale);return e}(),(function(){"checkout"==r.paypalFlow?[paypal.FUNDING.PAYPAL,paypal.FUNDING.PAYLATER].forEach((function(e){var r=paypal.Buttons(o(n,e));r.isEligible()&&r.render("#".concat(t.paymentElements.paypal))})):paypal.Buttons(o(n)).render("#".concat(t.paymentElements.paypal))}))}))}},{key:"stylingButtons",value:function(e,t){if("paypal"==e){var n={min:25,max:55},r={};return["vertical","horizontal"].includes(null==t?void 0:t.layout)&&(r.layout=t.layout),["rect","pill"].includes(null==t?void 0:t.shape)&&(r.shape=t.shape),(null==t?void 0:t.height)>=n.min&&(null==t?void 0:t.height)<=n.max&&(r.height=t.height),["gold","blue","silver","white","black"].includes(null==t?void 0:t.color)&&(r.color=t.color),r}}},{key:"venmoButton",value:function(t,n,r){var i;function o(e,n){t.callbackFunction({state:"Cancelled",message:"VENMO_CANCELED"===e.code?"App is not available or user aborted payment flow":"User canceled payment flow",payment_method:n})}function a(e,n){t.callbackFunction({state:"Failed",message:"An error occurred: ".concat(e.message),payment_method:n})}function s(e,n){t.callbackFunction({state:"Successful",nonce:e.nonce,payment_method:n,device_data:i,username:e.details.username})}braintree.dataCollector.create({client:n,paypal:!0},(function(e,t){e?console.error("Error occured in the creation of data collector: ".concat(e)):i=t.deviceData})),braintree.venmo.create(e.venmoParams(r,n),(function(e,n){if(e)console.error("Error creating Venmo: ".concat(e));else if(n.isBrowserSupported()){var r={payment_method_type:"venmo"};!function(e,n){var r=document.getElementById(t.paymentElements.venmo);r.style.display="block",r.addEventListener("click",(function(){r.disabled=!0,e.tokenize((function(e,t){r.removeAttribute("disabled"),e?"VENMO_CANCELED"===e.code||"VENMO_APP_CANCELED"===e.code||"VENMO_DESKTOP_CANCELED"===e.code?o(e,n):a(e,n):s(t,n)}))}))}(n,r),n.hasTokenizationResult()&&n.tokenize((function(e,t){e?"VENMO_CANCELED"===e.code||"VENMO_APP_CANCELED"===e.code?o(e,r):a(e,r):s(t,r)}))}else console.error("Browser does not support Venmo")}))}}]),e}();e.exports=a}]);