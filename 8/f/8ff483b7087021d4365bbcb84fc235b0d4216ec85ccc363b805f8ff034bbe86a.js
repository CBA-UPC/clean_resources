const CACHE_NAMES={assets:"of.assets",images:"of.images.2"},CACHE_LIMIT={"of.assets":200,"of.images.2":200};async function trimCache(e,t){const s=await caches.open(e),r=await s.keys();if(void 0!==(t=t||CACHE_LIMIT[e])&&r&&r.length>t)for(let e=0;e<=r.length-1-t;e++)await s.delete(r[e])}async function cacheAssets(e){let t=CACHE_NAMES.assets;-1===e.request.headers.get("Accept").indexOf("image")&&!/\.(jpe?g|png|gif|svg)/.test(e.request.url)||(t=CACHE_NAMES.images);const s=await caches.open(t),r=await s.match(e.request);if(r)return r;var a=e.request.clone();let n;try{n=await fetch(a.url,{method:a.method,headers:a.headers,integrity:a.integrity,redirect:a.redirect,referrer:a.referrer,referrerPolicy:a.referrerPolicy})}catch(e){return console.error(e),new Response("",{status:500,statusText:"offline"})}if(200<=n.status&&n.status<400){a=n.clone();const c=new Headers(a.headers);return c.append("Cache-Control","public, max-age=0, immutable"),await s.put(e.request,new Response(n.body,{status:n.status,statusText:n.statusText,headers:c})),await trimCache(t).catch(console.error),a}return n}self.addEventListener("install",,self.addEventListener("activate",function(e){var t=Object.keys(CACHE_LIMIT);e.waitUntil(caches.keys().then(function(e){return Promise.all(e.map()}))}),self.addEventListener("message",e=>{if("trimCaches"===e.data.command)for(var t in CACHE_LIMIT)limits.hasOwnProperty(t)&&trimCache(t,CACHE_LIMIT[t]).catch(console.error)}),self.addEventListener("fetch",function(e){var t=new URL(e.request.url).hostname;/((qual)?media\.ouest-france\.fr|cdn\.sipaof\.fr)/gm.test(t)&&e.respondWith(cacheAssets(e).catch()});