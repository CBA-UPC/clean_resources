(function(window,document,undefined){function ContentValidator(){var $public=this;var $private={};$public.isFilledObject=function(entity){if(!entity||entity.constructor!==Object){return false;}for(var key in entity){return true;}return false;};$public.stringIsNotEmpty=function(string){if(typeof string!=="string"){return false;}return $private.trimString(string).length>0;};$private.trimString=$public.stringMatches=function(string,regexp){if(!$public.stringIsNotEmpty(string)){return false;}return regexp.test(string);};return $public;}function CookieUtils(){var $public=this;var $private={};$private.typeValidator=new TypeValidator();$public.getItem=function(name){if(!$private.typeValidator.isString(name)){return;}var cookie=document.cookie;var startIndex=cookie.indexOf(name+"=");if(startIndex===-1){return;}var middleIndex=cookie.indexOf("=",startIndex)+1;var endIndex=cookie.indexOf(";",middleIndex);cookie=cookie.replace(/ SameSite=None; Secure;/gi,"");if(endIndex===-1){endIndex=cookie.length;}return unescape(cookie.substring(middleIndex,endIndex));};$public.setItem=function(name,value,domain,expireDays,expireHours,expireMinutes){if(!$private.typeValidator.isString(name)){return false;}if(!$private.typeValidator.isString(value)){return false;}document.cookie=$private.createCookieString(name,value,domain,expireDays,expireHours,expireMinutes);};$private.createCookieString=function(name,value,domain,expireDays,expireHours,expireMinutes){var cookie=name+"="+value;if($private.hasExpirationTime(expireDays,expireHours,expireMinutes)){cookie+="; expires="+$private.getExpirationDate(expireDays,expireHours,expireMinutes)+"; path=/";}if($private.typeValidator.isString(domain)){if(cookie.substr(cookie.length-1)!==";"){cookie+=";";}cookie+=" domain="+domain+";";}if(window.location.ancestorOrigins.length>0){if(!window.location.ancestorOrigins[0].match(/localhost/g)&&!window.location.ancestorOrigins[0].match(/uol.com/g)&&!window.location.ancestorOrigins[0].match(/karma.tm.uol.com.br/g)){if(cookie.substr(cookie.length-1)!==";"){cookie+="; SameSite=None; Secure;";}else{cookie+=" SameSite=None; Secure;";}}}return cookie;};$private.hasExpirationTime=function(days,hours,minutes){if($private.isValidNumber(days)||$private.isValidNumber(hours)||$private.isValidNumber(minutes)){return true;}return false;};$private.isValidNumber=function(number){if(!isNaN(parseInt(number))&&parseInt(number)!==0){return true;}return false;};$private.getExpirationDate=function(days,hours,minutes){var exdate=new Date();if($private.isValidNumber(days)){exdate.setDate(exdate.getDate()+days);}if($private.isValidNumber(hours)){exdate.setHours(exdate.getHours()+hours);}if($private.isValidNumber(minutes)){exdate.setMinutes(exdate.getMinutes()+minutes);}return exdate.toGMTString();};$private.setCookie=function(value){document.cookie=value;};$public.removeItem=function(name,domain){$private.setCookie($private.createCookieString(name,"",domain,-100));};$public.getCookies=function(){var listCookies=document.cookie;listCookies=listCookies.replace(/ SameSite=None; Secure;/gi,"");return listCookies;};}function Logs(){var $private={};var $public=this;$private.queryString=new QueryString();$private.typeValidator=new TypeValidator();$private.tmConsole=(typeof tmConsole!=="undefined"?tmConsole:undefined);$private.history={"warn":[],"error":[],"info":[],"debug":[],"log":[]};$public.getPrefix=function(prefix){return $private.prefix;};$public.setPrefix=function(prefix){if($private.typeValidator.isString(prefix)){$private.prefix="["+prefix+"] ";}};$public.warn=function(message,namTag,namespace,executionTime){if($public.consoleValidator($private.tmConsole)){$private.tmConsole.append(namTag,namespace,message,executionTime,"warn");}return $private.print(message,"warn");};$public.error=function(message,namTag,namespace,executionTime){if($public.consoleValidator($private.tmConsole)){$private.tmConsole.append(namTag,namespace,message,executionTime,"error");}return $private.print(message,"error");};$public.info=function(message){return $private.print(message,"info");};$public.debug=$public.log=function(message,namTag,namespace,executionTime){if($public.consoleValidator($private.tmConsole)){$private.tmConsole.append(namTag,namespace,message,executionTime,"success");}return $private.print(message,"log");};$public.consoleValidator=function(tmConsole){if(!tmConsole){return false;}if(!$private.typeValidator.isFunction(tmConsole.append)){return false;}return true;};$private.print=function(msg,fn){if(!$private.prefix){return;}if(!$private.typeValidator.isString(msg)){return;}msg=$private.prefix+msg;$public.setHistory(fn,msg);if($public.isActive()===false||!$private.hasConsole()){return;}return $private.runLogMethod(fn,msg);};$public.isActive=function(){if($private.queryString.getValue("tm")==="debug"){return true;}return false;};$public.getHistory=function(methodName){if($private.typeValidator.isArray($private.history[methodName])){return $private.history[methodName];}return;};$public.setHistory=function(fn,msg){if($private.typeValidator.isString(msg)&&$private.typeValidator.isArray($private.history[fn])){$private.history[fn].push(msg);}};$private.hasConsole=function(){if(!$private.typeValidator.isDefined($public.getConsole())){return false;}if(!$private.typeValidator.isDefined($public.getConsoleLog())){return false;}return true;};$public.getConsole=function(){return window.console;};$public.getConsoleLog=$private.runLogMethod=function(fn,msg){if($private.typeValidator.isDefined($public.getConsole()[fn])){$public.getConsole()[fn](msg);return fn;}window.console.log(msg);return"log";};}function NameSpace(packageName){var $private={};var $public=this;$private.version="${project.version}";$private.validator=new TypeValidator();$public.init=function(packageName){if($private.validator.isString(packageName)){return $public.create(packageName);}};$public.create=function(packageName){$private.createUOLPD();$private.createTagManager();return $private.createPackage(packageName);};$private.createUOLPD=function(){if(!$private.validator.isObject(window.UOLPD)){window.UOLPD={};}};$private.createTagManager=function(){if(!$private.validator.isObject(UOLPD.TagManager)&&!$private.validator.isFunction(UOLPD.TagManager)&&typeof UOLPD.TagManager!=="object"){UOLPD.TagManager={};}};$private.createPackage=function(packageName){if(!$private.validator.isString(packageName)){return UOLPD.TagManager;}if(!$private.validator.isObject(UOLPD.TagManager[packageName])){UOLPD.TagManager[packageName]={};}UOLPD.TagManager[packageName].version=$private.version;if(!$private.validator.isArray(UOLPD.TagManager[packageName].config)){UOLPD.TagManager[packageName].config=[];}if(!$private.validator.isObject(UOLPD.TagManager[packageName].log)){UOLPD.TagManager[packageName].log=new Logs();UOLPD.TagManager[packageName].log.setPrefix("UOLPD.TagManager."+packageName);}return UOLPD.TagManager[packageName];};return $public.init(packageName);}function QueryString(){var $private={};var $public=this;$private.typeValidator=new TypeValidator();$public.getValue=function(name){if(!$private.queryStrings){return;}return $private.queryStrings[name];};$public.getQueryStrings=function(){return $private.queryStrings;};$public.setValues=function(){if(!$private.typeValidator.isString($public.getSearch())){return;}var substrings=$public.getSearch().substring(1).split("&");if(!$private.typeValidator.isArray(substrings)){return;}if(substrings.length===0){return;}for(var i=0,length=substrings.length;i<length;i++){if($private.typeValidator.isString(substrings[i])){$private.addQueryString(substrings[i]);}}};$public.getSearch=$private.addQueryString=function(substring){var queryObject=$private.getQueryObject(substring);if(!queryObject){return;}$private.queryStrings=$private.queryStrings||{};$private.queryStrings[queryObject.key]=queryObject.value;};$private.getQueryObject=function(substring){var query=substring.split("=");if(!$private.typeValidator.isString(query[0])){return;}var result={"key":query[0],"value":"true"};if($private.typeValidator.isString(query[1])){result.value=query[1];}return result;};$public.setValues();}function RemoteStorage(){var $private={};var $public=this;$public.logs=new Logs();$public.logs.setPrefix("UOLPD.TagManager");$private.validator=new TypeValidator();$private.path="https://tm.uol.com.br/mercurio.html";$private.iframe=undefined;$private.iframeLoaded=false;$private.queue=[];$private.requests={};$public.init=function(){$private.hasLoaded(function(){$private.iframe=$private.getIframe($private.path);if(!$private.iframe){$private.setIframe();}if($private.iframe.getAttribute("data-loaded")==="true"){$private.iframeLoaded=true;}$private.setListener($private.iframe);return true;});return $public;};$private.getIframe=function(src){return document.querySelector('iframe[src*="'+src+'"]');};$public.get=function(key,callback,dataType){$private.communicator("get",key,undefined,callback,dataType);};$public.set=$public.removeItem=function(key,callback,dataType){callback=callback||$private.communicator("removeItem",key,undefined,callback,dataType);};$private.hasLoaded=function(fn,timeout){timeout=(timeout?timeout+10:10);if(typeof fn!="function"){return false;}if(document.body!==null){fn();return true;}window.setTimeout(timeout);};$private.setIframe=$private.buildIframe=function(){var iframe=document.createElement("iframe");iframe.setAttribute("src",$private.path);iframe.setAttribute("id","tm-remote-storage");iframe.setAttribute("style","position:absolute;width:1px;height:1px;left:-9999px;display:none;");document.body.appendChild(iframe);return iframe;};$private.setListener=function(iframe){var hasEventListener=(window.addEventListener!==undefined);var method=(hasEventListener)?"addEventListener":"attachEvent";var message=(hasEventListener)?"message":"onmessage";var load=(hasEventListener)?"load":"onload";iframe[method](load,$private.iframeLoadHandler);window[method](message,$private.messageHandler);return iframe;};$private.iframeLoadHandler=function(event){event.target.setAttribute("data-loaded","true");$private.iframeLoaded=true;if(!$private.queue.length){return;}for(var i=0,length=$private.queue.length;i<length;i++){$private.sendMessageToIframe($private.queue[i]);}$private.queue=[];};$private.messageHandler=function(event){try{var data=JSON.parse(event.data);$private.requests[data.id].callback(data.key,data.value);delete $private.requests[data.id];}catch(err){}};$private.communicator=function(method,key,value,callback,dataType){if(!$private.validator.isString(key)){$public.logs.warn("Ocorreu um erro ao requisitar os dados");return;}if(method==="set"&&value===undefined){$public.logs.warn("Ocorreu um erro ao requisitar os dados");return;}if(!$private.validator.isFunction(callback)){$public.logs.warn("Ocorreu um erro ao requisitar os dados");return;}var request={id:(Math.round(Math.random()*9000000)),key:key,method:method,dataType:dataType};if(value){request.value=value;}var data={request:request,callback:callback};if($private.iframeLoaded){$private.sendMessageToIframe(data);}else{$private.queue.push(data);}if(!$private.iframe){$public.init();}};$private.sendMessageToIframe=function(data){$private.requests[data.request.id]=data;data=JSON.stringify(data.request);if(!data){return;}if($private.iframe&&$private.iframe.contentWindow){$private.iframe.contentWindow.postMessage(data,$private.path);}};return $public.init();}function Schema(configSchema){var $private={};var $public=this;$private.typeValidator=new TypeValidator();$private.contentValidator=new ContentValidator();$public.__constructor=function(configSchema){if(!$private.typeValidator.isObject(configSchema)){return;}if(!$private.typeValidator.isObject(configSchema.properties)){return;}if(!$private.isValidRequired(configSchema)){return;}$private.configSchema={};$private.configSchema.required=[];$private.setProperties(configSchema.properties);if(configSchema.required.length>0){$private.configSchema.required=configSchema.required;}return $public;};$public.isValid=function(config){if(!$private.configSchema){return false;}if(!$private.typeValidator.isObject(config)){$public.invalidProperties=$private.configSchema.required;return false;}if(!$private.contentValidator.isFilledObject(config)){$public.invalidProperties=$private.configSchema.required;return false;}return $private.areValidProperties(config);};$private.isValidRequired=function(configSchema){if(!$private.typeValidator.isArray(configSchema.required)){return false;}for(var i=0,length=configSchema.required.length;i<length;i++){var required=configSchema.required[i];if(!$private.typeValidator.isString(required)){return false;}if(!configSchema.properties[required]){return false;}}return true;};$private.setProperties=function(properties){$private.configSchema.properties=$private.configSchema.properties||{};for(var key in properties){var property=$private.getProperty(properties[key]);if(property){$private.configSchema.properties[key]=property;}}};$private.getProperty=function(property){var result={};if($private.typeValidator.isRegExp(property)){return{"validator":$private.contentValidator.stringMatches,"modifier":property};}if(!$private.typeValidator.isString(property)){return;}property=property.split(/\|(.+)?/,2);var validator=$private.getValidator(property);if(!validator){return;}result.validator=validator;if(property[1]){result.modifier=$private.getModifier(property[1]);}return result;};$private.getValidator=function(property){if(property.length===1){return $private.typeValidator[property[0]];}return $private.contentValidator[property[0]];};$private.getModifier=function(modifier){if(!modifier){return;}try{return eval(modifier);}catch(e){}};$private.areValidProperties=function(config){var isValid=true;var requiredProperties=0;for(var property in config){if(!$private.isValidProperty(property,config)){isValid=false;}if($private.isRequiredProperty(property)){requiredProperties++;}}if(requiredProperties!==$private.configSchema.required.length){$private.countRequiredProperties(config);return false;}return isValid;};$private.isValidProperty=function(property,config){var propertyValidator=$private.configSchema.properties[property];if(!propertyValidator){return false;}if(!propertyValidator.validator(config[property],propertyValidator.modifier)){$private.addInvalidProperty(property);return false;}return true;};$private.getPropertyValidator=function(property){var item=$private.configSchema.properties[property];if(!$private.typeValidator.isString(item)){return;}item=item.split(/\|(.+)?/,2);var validator=$private.typeValidator[item[0]];if(!validator){return;}var contentValidator=$private.contentValidator[item[1]];if(!contentValidator){return;}return{"validator":validator,"contentValidator":contentValidator};};$private.validateContent=function(property,contentValidator){try{return contentValidator(property,eval(contentValidator));}catch(e){}};$private.isRequiredProperty=function(property){if($private.configSchema.required.length===0){return false;}for(var i=0,length=$private.configSchema.required.length;i<length;i++){var required=$private.configSchema.required[i];if(required===property){return true;}}return false;};$private.addInvalidProperty=function(property){if(!$public.invalidProperties){$public.invalidProperties=[];}if(!$private.arrayHasItem($public.invalidProperties,property)){$public.invalidProperties.push(property);}};$private.arrayHasItem=function(array,item){for(var i=0,length=array.length;i<length;i++){if(array[i]==item){return true;}}return false;};$private.countRequiredProperties=function(config){for(var i=0,length=$private.configSchema.required.length;i<length;i++){var required=$private.configSchema.required[i];if(!$private.typeValidator.isDefined(config[required])){$private.addInvalidProperty(required);}}};return $public.__constructor(configSchema);}function ScriptUtils(){var $private={};var $public=this;$private.typeValidator=new TypeValidator();$private.dataCalls="data-uoltm-calls";$public.hasTagScript=function(src){if(!$private.typeValidator.isString(src)){return false;}if(src.length===0){return false;}if($public.findScript($private.removeProtocol(src))){return true;}return false;};$private.removeProtocol=$public.findScript=$private.isSrcEqual=$public.createScript=function(src){if(!$private.typeValidator.isString(src)){return;}var tag=document.createElement("script");tag.setAttribute("src",src);tag.async=true;return tag;};$public.appendTag=function(script){if(!$private.typeValidator.isDefined(script)){return;}if(script.constructor===HTMLScriptElement){$private.lastScriptsParent().appendChild(script);return true;}};$private.lastScriptsParent=$public.createSyncScript=function(src){if(!$private.typeValidator.isString(src)){return;}document.write("<scr"+'ipt src="'+src+'"></scr'+"ipt>");};}function StringUtils(){var $private={};var $public=this;$private.typeValidator=new TypeValidator();$public.trim=function(value){if(!$private.typeValidator.isString(value)){return;}if(value.length===0){return;}value=value.replace(/^(\s+)|(\s+)$/gm,"").replace(/\s+/gm," ");return value;};$public.getValueFromKeyInString=function(str,name,separator){if(!$private.typeValidator.isString(name)||name.length===0){return;}if(!$private.typeValidator.isString(str)||str.length===0){return;}if(!$private.typeValidator.isString(separator)||separator.length===0){return;}if(str.substring(str.length-1)){str+=separator;}name+="=";var startIndex=str.indexOf(name);if(startIndex===-1){return"";}var middleIndex=str.indexOf("=",startIndex)+1;var endIndex=str.indexOf(separator,middleIndex);if(endIndex===-1){endIndex=str.length;}return unescape(str.substring(middleIndex,endIndex));};return $public;}function TrackManager(){var $private={};var $public=this;$private.API_URL="//logger.uol.com.br/v1/?prd=98&gps=true&disp=true&mm=true";$private.typeValidator=new TypeValidator();$private.scriptUtils=new ScriptUtils();$private.baseMetric={groupingMap:{},measureMap:{}};$private.raffledRate=Math.round(Math.random()*100);$private.samplingRate=1;$public.trackSuccess=function(msr,samplingRate){return;var sampling=$private.generateSamplingRate(samplingRate);$public.addMetrics($private.getMeasures(msr),null,sampling);};$public.trackExecution=function(){var measures=$private.getMeasures("execution");if(!$private.isTrackEnabled(1)){return;}var metric=$private.generateMetric(measures);if(!metric){return;}$private.createNamespaceMetrics();window.UOLPD.TagManager.metrics.push(metric);$private.triggerMetrics();};$private.generateSamplingRate=function(samplingRate){if($private.typeValidator.isNumber(samplingRate)){return samplingRate;}return $private.samplingRate;};$public.addMetrics=function(measures,groupings,samplingRate){if(!$private.isTrackEnabled(samplingRate)){return;}var metric=$private.generateMetric(measures,groupings);if(!metric){return;}var metricOrigem=metric.groupingMap.Origem;if(metricOrigem!=="TM-dfp-async"&&metricOrigem!=="TM-core"){return;}$private.createNamespaceMetrics();window.UOLPD.TagManager.metrics.push(metric);$private.triggerMetrics();};$private.isTrackEnabled=function(samplingRate){try{if(window.localStorage.getItem("trackManager")=="true"){return true;}}catch(e){}if($public.getRaffledRate()<=samplingRate){return true;}return false;};$public.getRaffledRate=function(){return $private.raffledRate;};$private.generateMetric=function(measures,groupings){var metric=JSON.parse(JSON.stringify($private.baseMetric));if($private.typeValidator.isObject(measures)){metric.measureMap=metric.measureMap||{};for(var msr in measures){metric.measureMap[msr]=measures[msr];}}if($private.typeValidator.isObject(groupings)){metric.groupingMap=metric.groupingMap||{};for(var grp in groupings){metric.groupingMap[grp]=groupings[grp];}}if(Object.keys(metric.measureMap).length<1){return;}return metric;};$private.createNamespaceMetrics=function(){window.UOLPD=window.UOLPD||{};window.UOLPD.TagManager=window.UOLPD.TagManager||{};window.UOLPD.TagManager.metrics=window.UOLPD.TagManager.metrics||[];};$private.triggerMetrics=function(){if(window.UOLPD.TagManager.trackTimeWindow){return;}window.UOLPD.TagManager.trackTimeWindow=setTimeout(function(){var xhr=new XMLHttpRequest();xhr.open("POST",$private.API_URL,true);xhr.setRequestHeader("Content-Type","application/json; charset=UTF-8");xhr.send(JSON.stringify(window.UOLPD.TagManager.metrics));window.UOLPD.TagManager.metrics=[];clearTimeout(window.UOLPD.TagManager.trackTimeWindow);window.UOLPD.TagManager.trackTimeWindow=undefined;},4000);};$private.getMeasures=function(msr,value,measure){if(!$private.typeValidator.isString(msr)){return measure;}if(!value){value="1";}if($private.typeValidator.isNumericString(value)||$private.typeValidator.isNumber(value)){measure=measure||{};measure[msr]=value;}return measure;};$public.getModuleName=$public.setModuleName=function(moduleName){if($private.typeValidator.isString(moduleName)){$private.moduleName="TM-"+moduleName;}$private.baseMetric.groupingMap=$private.baseMetric.groupingMap||{};$private.baseMetric.groupingMap.tm_repo_id=$public.getRepoId();$private.baseMetric.groupingMap.Origem=$private.moduleName;};$public.getRepoId=$public.trackError=function(errorType,errorEffect){var errorGroups=$private.getGroups("erro_tipo",errorType);if(!$private.typeValidator.isObject(errorGroups)){return;}errorGroups=$private.getGroups("erro_efeito",errorEffect,errorGroups);if(!$private.typeValidator.isObject(errorGroups)){return;}$public.addMetrics($private.getMeasures("Erros"),errorGroups);};$private.getGroups=function(grp,value,groups){if(!$private.typeValidator.isString(grp)){return;}if(!$private.typeValidator.isString(value)&&!$private.typeValidator.isNumber(value)){return;}groups=groups||{};groups[grp]=value;return groups;};$public.trackCustom=function(measure,trackType,trackValue,samplingRate){var metricMeasures=$private.getMeasures(measure);var metricsGroups=$private.getGroups(trackType,trackValue);if(!metricMeasures||!metricsGroups){return;}var sampling=$private.generateSamplingRate(samplingRate);$public.addMetrics(metricMeasures,metricsGroups,sampling);};$public.trackCustomObj=function(metrics,samplingRate){if(!$private.typeValidator.isObject(metrics)||!$private.typeValidator.isObject(metrics.measures)){return;}var measures,groups;measures={};for(var msr in metrics.measures){measures=$private.getMeasures(msr,metrics.measures[msr],measures);}if(!$private.isValidMeasures(measures)){return;}if($private.typeValidator.isObject(metrics.groups)){groups={};for(var grp in metrics.groups){groups=$private.getGroups(grp,metrics.groups[grp],groups);}}var sampling=$private.generateSamplingRate(samplingRate);$public.addMetrics(measures,groups,sampling);};$private.isValidMeasures=function(measures){if(Object.keys(measures).length<1){return false;}var isValid=false;for(var msr in measures){if(measures[msr]==1||measures[msr]=="1"){isValid=true;}}return isValid;};}function TypeValidator(){var $public=this;var $private={};$private.contentValidator=new ContentValidator();$public.isDefined=$public.isString=$public.isArray=function(value){return value&&value.constructor.toString()===Array.toString();};$public.isObject=$public.isFunction=function(value){return value!==undefined&&value.constructor.toString()===Function.toString();};$public.isNumber=$public.isInt=$public.isRegExp=function(value){return value!==undefined&&value.constructor.toString()===RegExp.toString();};$public.isNumericString=$public.isBoolean=function(value){return value!==undefined&&value.constructor.toString()==Boolean.toString();};return $public;}var uolpdCommons=new NameSpace("Commons");uolpdCommons.RemoteStorage=RemoteStorage;function ExpirationController(namTag,namespace,timeStampInit){var $private={};var $public=this;$private.namTag=namTag;$private.namespace=namespace;$private.timeStampInit=timeStampInit;$private.contentValidator=new ContentValidator();$private.typeValidator=new TypeValidator();$private.trackManager=new TrackManager();$private.trackManager.setModuleName("dynad-track");$public.logger=new Logs();$public.logger.setPrefix("UOLPD.TagManager.DynadTrack");$private.DATALAYER_NAMESPACES=["DynadTrack","DfpAsync"];$private.clients=[];$public.getClient=function(){return $private.client;};$public.setClient=function(client){if(!client){return;}if(!client.getId()){return;}$private.client={"id":client.getId(),"expiration":client.getExpiration()};if(client.getBidding()){$private.client.bidding=client.getBidding();}$private.trackManager.trackCustom("Tracking","client",$private.client.id);};$public.updateClient=function(){var clients=$private.getItemFromLocalStorage("dynad_rt");$public.setClients(clients);$private.addClient();$public.updateExpiredClients();if($private.clients.length>0){$private.addItemToLocalStorage("dynad_rt",$private.clients);}else{$private.removeItemFromLocalStorage("dynad_rt");}$private.updateDataLayer();};$private.getItemFromLocalStorage=function(key){var item;try{item=JSON.parse(window.localStorage.getItem(key));}catch(e){$public.logger.warn("Erro na leitura do atributo "+key+" no localStorage",$private.namTag,$private.namespace,((new Date()).getTime()-$private.timeStampInit));}finally{return item;}};$public.getClients=function(){return $private.clients;};$public.setClients=function(clients){if($private.typeValidator.isArray(clients)){$private.clients=clients;}else{$private.clients=[];}};$private.addClient=function(){if(!$private.client){return;}var index=$private.getClientIndex($private.client.id);if(index<0){$private.clients.push($private.client);$public.logger.debug("Adicionando o cliente de id "+$private.client.id);}else{$private.clients[index]=$private.client;$public.logger.debug("Adicionando o cliente de id "+$private.client.id);}$public.logger.log("Adicionando o cliente de id "+$private.client.id,$private.namTag,$private.namespace,(new Date().getTime()-$private.timeStampInit));for(var key in $private.client.bidding){$public.logger.log("Adicionando o Bidding "+key+" com expiração para "+$private.getDateDifference($private.client.bidding[key])+" dias.",$private.namTag,$private.namespace,(new Date().getTime()-$private.timeStampInit));}};$public.updateExpiredClients=function(){for(var i=0;i<$private.clients.length;i++){var client=$private.clients[i];if(!$private.isValidClient(client)){$public.logger.debug("Removendo o cliente de id "+client.id+" pois este expirou");$private.trackManager.trackCustom("Expiration","client",client.id);$private.clients.splice(i,1);i--;}else{client=$private.updateExpiredBidding(client);}}};$private.updateExpiredClient=function(client){if(!$private.isValidClient(client)){$public.logger.debug("Removendo o cliente de id "+client.id+" pois este expirou");$private.trackManager.trackCustom("Expiration","client",client.id);return;}else{return $private.updateExpiredBidding(client);}};$private.isValidClient=function(client){if(!$private.contentValidator.isFilledObject(client)){return false;}if(!$private.typeValidator.isString(client.id)){return false;}if($private.shouldExpire(client.expiration)){return false;}return true;};$private.shouldExpire=function(expiration){var today=new Date();expiration=$private.getClientDate(expiration);return expiration<today;};$private.getClientDat};$private.updateExpiredBidding=function(client){if(!client.bidding){return client;}for(var key in client.bidding){if($private.shouldExpire(client.bidding[key])){delete client.bidding[key];}}if(!$private.contentValidator.isFilledObject(client.bidding)){delete client.bidding;}return client;};$private.getClientIndex=function(id){var index=$private.clients.length;while(index){index--;if($private.clients[index].id===id){return index;}}return -1;};$private.getDateDifference=function(expirationDate){var now=(new Date());return Math.floor((expirationDate.getTime()-now.getTime())/(1000*60*60*24));};$private.addItemToLocalStorage=function(key,value){try{value=JSON.stringify(value);window.localStorage.setItem(key,value);}catch(e){$public.logger.warn("Erro na escrita do atributo "+key+" no localStorage",$private.namTag,$private.namespace,((new Date()).getTime()-$private.timeStampInit));}finally{$public.logger.debug("Escrevendo o atributo "+key+" no localStorage com o valor"+value,$private.namTag,$private.namespace,((new Date()).getTime()-$private.timeStampInit));}};$private.removeItemFromLocalStorage=function(key){try{window.localStorage.removeItem(key);}catch(e){$public.logger.warn("Erro ao efetuar a remoção do atributo "+key+" do localStorage",$private.namTag,$private.namespace,((new Date()).getTime()-$private.timeStampInit));}finally{$public.logger.debug("Removendo o atributo "+key+" do localStorage",$private.namTag,$private.namespace,((new Date()).getTime()-$private.timeStampInit));}};$private.updateDataLayer=function(){var dataLayer=$private.proccessDataLayer($private.getClientsIds());if($private.contentValidator.isFilledObject(dataLayer)){$private.addItemToLocalStorage("uolDataLayer",dataLayer);}else{$private.removeItemFromLocalStorage("uolDataLayer");}};$private.getClientsIds=function(){var ids=[];for(var i=$private.clients.length-1;i>=0;i--){var client=$private.clients[i];ids.push(client.id);for(var key in client.bidding){ids.push(key);}}return ids.join(",");};$private.proccessDataLayer=function(clients){var dataLayer=$private.getItemFromLocalStorage("uolDataLayer");if(!$private.typeValidator.isObject(dataLayer)){dataLayer={};}for(var i=0,length=$private.DATALAYER_NAMESPACES.length;i<length;i++){var namespace=$private.DATALAYER_NAMESPACES[i];dataLayer[namespace]=$private.proccessNameSpace(dataLayer[namespace],clients);if(!dataLayer[namespace]){delete dataLayer[namespace];}}return dataLayer;};$private.proccessNameSpace=function(namespace,clients){if(!$private.typeValidator.isObject(namespace)){namespace={};}if($private.typeValidator.isString(clients)){namespace.bt=clients;}else{delete namespace.bt;}if(!$private.contentValidator.isFilledObject(namespace)){return;}return namespace;};}function Client(){var $private={};var $public=this;$private.typeValidator=new TypeValidator();$private.DEFAULT_EXPIRATION=60;$public.getId=function(){return $private.id;};$public.setId=function(id){if($private.typeValidator.isString(id)){$private.id=id;}};$public.getBiddingValues=function(){return $private.biddingValues;};$public.setBiddingValues=function(biddingValues){if($private.isValidBidding(biddingValues)){$private.biddingValues=$private.createBiddingArray(biddingValues);}};$public.getBiddingExpirations=function(){return $private.biddingExpirations;};$public.setBiddingExpirations=function(biddingExpirations){if(!$private.biddingValues||!$private.isValidBidding(biddingExpirations)){return;}biddingExpirations=$private.createBiddingArray(biddingExpirations);for(var key in biddingExpirations){biddingExpirations[key]=$private.getIncreasedDate(parseInt(biddingExpirations[key]));}if($private.biddingValues.length===biddingExpirations.length){$private.biddingExpirations=biddingExpirations;}};$public.getBidding=function(){return $private.bidding;};$public.setBidding=function(){if(!$private.expiration){$public.setExpiration();}if($private.biddingValues){$private.bidding=$private.createBiddingObject();}};$public.getExpiratn;};$public.setExpiration=function(expiration){if(isNaN(expiration)){$private.expiration=$private.getIncreasedDate($private.DEFAULT_EXPIRATION);return;}$private.expiration=$private.getIncreasedDate(parseInt(expiration));};$public.getTrackingDate=function(){return $private.trackingDate;};$public.setTrackingD);};$private.isValidBidding=function(biddingValues){if(!$private.typeValidator.isString(biddingValues)){return false;}var areValuesInvalid=/((\w+)(\s)?(;)?)+/gm;if(!areValuesInvalid.test(biddingValues)){return false;}return true;};$private.createBiddingArray=function(biddingArray){if(biddingArray.charAt(0)===";"||biddingArray.charAt(biddingArray.length-1)===";"){biddingArray=biddingArray.replace(/^;|;$/,"");}return biddingArray.replace(/\s/g,"").split(";");};$private.createBiddingObject=function(){var biddingObject={};if($private.biddingExpirations&&$private.biddingValues.length!==$private.biddingExpirations.length){return;}var today=new Date();for(var i=0,length=$private.biddingValues.length;i<length;i++){if(today>$private.expiration){biddingObject[$private.biddingValues[i]]=$private.expiration;continue;}if(!$private.biddingExpirations){biddingObject[$private.biddingValues[i]]=$private.expiration;continue;}biddingObject[$private.biddingValues[i]]=$private.biddingExpirations[i];}return biddingObject;};$private.getIncreasedDate=function(value){var date=new Date();date.setMilliseconds(59);date.setSeconds(59);date.setMinutes(59);date.setHours(23);if(value===0){date.setDate(date.getDate()-1);}date.setDate(date.getDate()+value);return date;};}function ClientManager(){var $private={};var $public=this;$private.typeValidator=new TypeValidator();$private.cookieUtils=new CookieUtils();$public.queryString=new QueryString();$private.domain=".uol.com.br";$private.expDomain="";$private.defaultExpiration=60;$private.deleteClient=false;$private.defaultExpiratonDate=60;$private.domainNameWhitelist=["dynad_rt","dynad_rt_exp","DEretargeting","DEretargetingExp","toggle","uoltm-toggle"];$public.init=function(){$private.createNamespace();$private.setQueryStringItems();$private.configureClient();$private.updateLocalStorage();if($private.redirectTo){window.location.href=$private.redirectTo;}return $public;};$private.createNamespace=function(){if(!$private.typeValidator.isObject(window.UOLPD)){window.UOLPD={};}window.UOLPD=window.UOLPD||{};if(!$private.typeValidator.isObject(window.UOLPD.DynadTrack)){window.UOLPD.DynadTrack={};}window.UOLPD.DynadTrack=window.UOLPD.DynadTrack||{};if(!$private.typeValidator.isObject(window.UOLPD.DynadTrack.ClientManager)){window.UOLPD.DynadTrack.ClientManager=$public;}window.UOLPD.DynadTrack.ClientManager=window.UOLPD.DynadTrack.ClientManager||{};};$private.setQueryStringItems=function(){$public.setCookieName($public.queryString.getValue("name"));$public.setExpirationCookieName($public.queryString.getValue("expname"));$private.setExpirationDomain($public.queryString.getValue("expdomain"));$public.setCustomExpiration($public.queryString.getValue("expires"));$public.setDeleteClient($public.queryString.getValue("delete"));$public.setRedirectTo($public.queryString.getValue("redir"));$public.setClientName($public.queryString.getValue("client"));$public.setClient($private.clientName);};$public.setCookieName=function(name){if($private.isCookieNameValid(name)){$private.cookieName=name;}};$private.isCookieNameValid=function(name){if(!$private.typeValidator.isString(name)){return false;}for(var i=0;i<$private.domainNameWhitelist.length;i++){if($private.domainNameWhitelist[i]===name){return true;}}return false;};$public.setExpirationCookieN;}};$private.setExpirationDomain=function(expDomain){if(expDomain==="1"){$private.expDomain=".tm.uol.com.br";}};$public.setCustomExpiration=function(expires){expires=parseInt(expires);if(!$private.typeValidator.isNumber(expires)||expires<=0||expires>60){$private.customExpiration=$private.defaultExpiration;return false;}$private.customExpiration=expires;return true;};$public.setDeleteClient=function(deleteValue){if(!$private.typeValidator.isString(deleteValue)){return false;}$private.deleteClient=(deleteValue=="true");return $private.deleteClient;};$public.setRedirecl;};$public.setClientName=function(clientName){if($private.typeValidator.isString(clientName)){$private.clientName=clientName;}};$public.setClient=function(clientName){$private.invalidClient=!$public.validateClient(clientName);if(!$private.expCookieName){if($private.invalidClient){$private.customExpiration=-1;}return $private.setCookie($private.cookieName,clientName,$public.getClientExpiration(),$private.domain);}var updatedExpCookies=$public.updateExpCookies(clientName);$public.setExpCookie(updatedExpCookies);return $private.setDefaultCookie(updatedExpCookies);};$public.validateClient=function(clientName){if(!$private.typeValidator.isString(clientName)){return false;}if($private.deleteClient){return false;}return/^[a-zA-Z0-9-_\.]+$/i.test(clientName);};$public.updateExpCookies=function(clientName){var clientExpiration=$public.getClientExpiration();var result=[];var cookies=$private.getCookieValues($private.expCookieName);if(cookies.length===0){result=$private.addDefaultValuesToExpiration(result,clientName);}if(!$private.findClientInCookie(clientName,cookies.replace(/\|\d{8}/g,"").split(";"))&&!$private.isClientInResult(clientName,result)&&!$private.invalidClient){result.push(clientName+"|"+$private.getNewDate(clientExpiration));}cookies=cookies.split(";");for(var i=0;i<cookies.length;i++){var client=cookies[i].split("|");if(client.length===0){continue;}if($private.isClientInResult(client[0],result)){continue;}if(client[0]==clientName){if($private.invalidClient===false){result.push(clientName+"|"+$private.getNewDate(clientExpiration));}continue;}if($private.isUpdated(client[1])){result.push(client.join("|"));}}result=$private.addDefaultValuesToExpiration(result,clientName).join(";");if(cookies.length===0&&result.length===0){return clientName+"|"+$private.getNewDate(clientExpiration);}return result;};$public.getClientExpiratn;};$private.getCookieValues=function(cookieName){var cookieValues=$private.cookieUtils.getItem(cookieName);if(!cookieValues){return"";}return cookieValues;};$private.getValueFromKeyInString=function(str,name,separator){if(!$private.typeValidator.isString(name)){return;}if(str.substring(str.length-1)){str+=separator;}name+="=";var startIndex=str.indexOf(name);if(startIndex===-1){return"";}var middleIndex=str.indexOf("=",startIndex)+1;var endIndex=str.indexOf(separator,middleIndex);if(endIndex===-1){endIndex=str.length;}return unescape(str.substring(middleIndex,endIndex));};$private.addDefaultValuesToExpiration=function(result,clientName){if(result.length>0){return result;}var defaultValues=$private.getCookieValues($private.cookieName).split(";");if(!$private.findClientInCookie(clientName,defaultValues)&&!$private.invalidClient){defaultValues.push(clientName);}for(var i=0;i<defaultValues.length;i++){if(defaultValues[i].length===0){continue;}if($private.isClientInResult(defaultValues[i],result)){continue;}if(!$private.hasInExpirationCookie(defaultValues[i])){result.push(defaultValues[i]+"|"+$private.getNewDate($public.getClientExpiration()));}}return result;};$private.findClientInCookie=function(clientName,cookies){if(!clientName||clientName.length===0){return false;}var length=cookies.length;for(var i=0;i<length;i++){if(cookies[i]==clientName){return true;}}return false;};$private.isClientInResult=function(client,result){if(!client||!result||client.length===0||result.length===0){return false;}for(var i=0;i<result.length;i++){if(client==result[i].substring(0,result[i].indexOf("|"))){return true;}}return false;};$private.hasInExpirationCookie=function(item){var expirationCookie=$private.getCookieValues($private.expCookieName);for(var i=0;i<expirationCookie.length;i++){if(expirationCookie.split("|")[0]==item){return true;}}return false;};$private.getNewDate=function(expireDays){var stringDate="";var today=new Date();expireDays=expireDays||0;today.setDate(today.getDate()+expireDays);if(today.getDate()<=9){stringDate+="0";}stringDate+=today.getDate();if(today.getMonth()<=8){stringDate+="0";}stringDate+=today.getMonth()+1;stringDate+=today.getFullYear();return stringDate;};$public.setExpCookie=function(updatedExpCookies){return $private.setCookie($private.expCookieName,updatedExpCookies,$public.getClientExpiration(),$private.expDomain);};$private.setCookie=function(name,value,expiredays,domain){if(value&&value.length>0){$private.cookieUtils.setItem(name,escape(value),domain,expiredays);}else{$private.cookieUtils.removeItem(name,domain);}return $private.cookieUtils.getItem(name);};$private.setExpirationDate=function(expiredays){$private.expirationDate=new Date();$private.expirationDate.setDate($private.expirationDate.getDate()+expiredays);$private.expirationDate.setHours(23);$private.expirationDate.setMinutes(59);$private.expirationDate.setSeconds(59);$private.expirationDate=$private.expirationDate.toUTCString();};$public.getExpirationDe;};$public.hasClientInCookies=function(clientName){if(clientName.length===0){return false;}var cookies=$private.findClientInCookie(clientName,$private.getCookieValues($private.cookieName).split(";"));var expCookies=$private.findClientInCookie(clientName,$private.getCookieValues($private.expCookieName).replace(/\|\d{8}/g,"").split(";"));return cookies&&expCookies;};$private.formatDate=function(currentDate){if(!currentDate){return;}var match=currentDate.match(/(\d{2})(\d{2})(\d{4})/);currentDate=new Date();if(!match){return;}currentDate.setDate(match[1]);currentDate.setMonth(match[2]-1);currentDate.setYear(match[3]);currentDate.setHours(23);currentDate.setMinutes(59);currentDate.setSeconds(59);return currentDate;};$private.isUpdated=function(currentDate){return $private.formatDate(currentDate)>$private.formatDate($private.getNewDate());};$private.setDefaultCookie=function(updatedExpCookies){var value=$private.getCookieValues($private.expCookieName).replace(/\|\d{8}/g,"");return $private.setCookie($private.cookieName,value,$public.getClientExpiration(),$private.domain);};$private.configureClient=function(){$private.client=new Client();$private.client.setId($private.clientName);if($private.deleteClient){$private.client.setExpiration(-1);}else{$private.client.setExpiration($private.customExpiration);$private.setClientBiddingValues();$private.client.setBidding();}$private.client.setTrackingDate();};$private.setClientBiddingValues=function(){var biddingValues=[];var biddingExpirations=[];var queryStringValue=$public.queryString.getValue("biddingValues");if(!$private.typeValidator.isString(queryStringValue)){return;}queryStringValue=queryStringValue.split(";");for(var i=0;i<queryStringValue.length;i++){var bidding=queryStringValue[i].split("|");biddingValues.push(bidding[0]);biddingExpirations.push(bidding[1]||"60");}$private.client.setBiddingValues(biddingValues.join(";"));$private.client.setBiddingExpirations(biddingExpirations.join(";"));};$private.updateLocalStorage=function(){$private.expirationController=new ExpirationController();$private.expirationController.setClient($private.client);$private.expirationController.updateClient();};}var clientManager=new ClientManager();clientManager.init();})(window,document);