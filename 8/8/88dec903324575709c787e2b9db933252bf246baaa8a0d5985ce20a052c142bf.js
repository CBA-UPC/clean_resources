!function(){var e={78959:function(e){window,e.exports=[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=r(n(6)),s=function(){function e(){}return e.infoMsg=function(e){this.parseMsg(o.messageConfig.types.info,e)},e.warnMsg=function(e){this.parseMsg(o.messageConfig.types.warn,e)},e.errorMsg=e.parseMsg=function(e,t){var n="string"!=typeof t?t:void 0,r=o.messageConfig.title+" "+e+": "+(n?"":t),s=null;switch(e){case o.messageConfig.types.info:return s=console.info,!i.default.ProdMode&&(this.outputMsg(s,r,n),!0);case o.messageConfig.types.warn:return s=console.warn,!i.default.ProdMode&&(this.outputMsg(s,r,n),!0);case o.messageConfig.types.error:return s=console.error,this.outputMsg(s,r,n),!0}},e.outputMsg=function(e,t,n){n?(console.group(t),Array.isArray(n)?n.forEach(():e(n),console.groupEnd()):e(t)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.messageConfig={title:"Swrve WebSDK",types:{error:"Error",info:"Info",warn:"Warning"}},t.webWorkerDbName="SwrveWebWorkerDB",t.swrveDefaultDBName="SwrveWebSDK",t.swrveDefaultDBVersion=1,t.swrveServiceWorkerName="SwrveWorker.js",t.swrveVersion=3,t.defaultFlushFrequency=6e4,t.defaultFlushRefreshDelay=5e3},function(e,t,n){"use strict";bject.defineProperty(t,"__esModule",{value:!0}),t.isNil=r,t.isPresent=t.noOp=,function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(7));t.nowInUtcTime=function(){return o.default.dateToUTCDate(new Date).getTime()}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(15),a=i(n(16)),u=i(n(17)),c=i(n(19)),f=i(n(7)),l=n(12),p=i(n(20)),h=n(2),d=i(n(0)),v=n(1),g=i(n(24)),y=i(n(9)),b=i(n(26)),m=i(n(27)),w=i(n(28)),S=i(n(5)),_=n(3),I=n(13),E=function(){function e(e){this.onSwrveLoadedCallback=null,this.flushConfig={flushFrequency:v.defaultFlushFrequency,flushRefreshDelay:v.defaultFlushRefreshDelay},this.eventFactory=new u.default,this.config=new a.default(e),this.localStorageClient=new S.default}return Object.defineProperty(e.prototype,"Config",{get:function(){return this.config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SwrvePushManager",{get:function(){return this.swrvePushManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"DeviceId",{get:function(){return this.getPersistentDeviceId()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getUserID",{get:enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"InstallDate",{get:enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"InitDate",{get:function(){return this.profile.FirstSession.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"WebPushAPIKey",{get:function(){return this.webPushAPIKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsSessionStarted",{get:enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastSession",{get:enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Profile",{get:function(){return this.profile},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SessionStartedAt",{get:function(){return this.sessionStartedAt},enumerable:!0,configurable:!0}),e.createInstance=e.getCurrentInstance=function(){return e.instance},e.prototype.init=function(){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:if(!b.default.isTrackingSupported())throw Error("The configuration shown in the User Agent is not officially supported");d.default.infoMsg("Starting New SwrveSDK instance"),this.initializePersistentData(),r.label=1;case 1:return r.trys.push([1,6,,7]),[4,this.initializeIdentity()];case 2:return r.sent(),this.profile.IsIdentityResolved?(d.default.infoMsg("Profile Resolved: "+this.profile.UserId+" for extUserId: "+this.profile.ExternalUserId),(t=this.hasSessionRestored())?(d.default.infoMsg("Session is still going, restoring last session"),this.sessionStartedAt=this.profile.LastSession):this.sessionStartedAt=_.nowInUtcTime(),d.default.infoMsg("Generating Session Token"),this.sessionToken=this.generateSessionToken(this.sessionStartedAt.toString()),d.default.infoMsg("Session Token Generated: "+this.sessionToken),d.default.infoMsg("Initializing Event Manager"),this.eventQueueManager=new g.default(this.config,this.flushConfig,this.getUserID,this.sessionToken),t||this.sessionStart(),d.default.infoMsg("Fetching synchronous campaigns and resources"),[4,this.initCampaignsAndResources()]):[3,4];case 3:return r.sent(),this.eventQueueManager.init(),null==this.profile.LastSession&&this.eventInternal(l.eventTypes.namedEvent,{name:l.firstSessionEventName}),d.default.infoMsg("Sending Client Info"),this.sendClientInfo(),d.default.infoMsg("Initializing PushManager with WebPushAPIKey: "+this.WebPushAPIKey),this.swrvePushManager=new w.default(this.config,this.WebPushAPIKey),this.SwrvePushManager.init(),this.config.AutoPushSubscribe?(d.default.infoMsg("autoPushSubscribe: ON"),this.swrvePushManager.registerPush()):d.default.infoMsg("SwrvePushManager Will not initialize. Auto subscribe is disabled"),window.onbeforeunload=function(){e.pageStateHandler()},window.onblur=function(){e.pageStateHandler()},h.isPresent(this.onSwrveLoadedCallback)&&this.onSwrveLoadedCallback(null),[3,5];case 4:throw e.shutdown(),new Error("User Profile could not be resolved");case 5:return[3,7];case 6:return n=r.sent(),d.default.errorMsg(n),this.onSwrveLoadedCallback(n.toString()),[3,7];case 7:return[2]}}))}))},e.shutdown=function(){if(!h.isNil(this.instance)){var e=this.instance.eventQueueManager;h.isNil(e)||e.shutdown(),this.pageStateHandler(),Object.setPrototypeOf(this.instance,null),this.instance=null}},e.prototype.initCampaignsAndResources=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return this.campaignManager=new p.default,[4,this.campaignManager.getInfoForSession()];case 1:return(e=t.sent())&&(this.flushConfig={flushFrequency:e.flushFrequency,flushRefreshDelay:e.flushRefreshDelay},this.profile.setQAFlag(e.qa),e.webPushPublicKey&&(this.webPushAPIKey=e.webPushPublicKey),this.campaignManager.init(this.flushConfig)),[2]}}))}))},e.prototype.registerPush=function(e,t){this.swrvePushManager.registerPush(e,t)},e.prototype.unregisterPush=e.prototype.sendQueuedEvents=e.prototype.getQueuedEvents=e.prototype.namedEvent=function(e){c.default.isValidEventName(e.name)&&this.eventInternal(l.eventTypes.namedEvent,e)},e.prototype.sessionStart=e.prototype.userUpdate=function(e){null!=e?this.userUpdateInternal(e):d.default.errorMsg("There must be at least one key/value pair, this will not be queued")},e.prototype.userUpdateWithDate=function(e){e.name&&e.date?this.userUpdateWithDateInternal(l.eventTypes.userUpdateEvent,e):d.default.errorMsg("Both name and date are mandatory, this will not be added to the queue")},e.prototype.purchaseEvent=function(e){e.cost&&e.item&&e.currency&&e.quantity&&this.purchaseInternal(e.item,e.currency,e.cost,e.quantity)},e.prototype.genericCampaignEvent=function(e){e.actionType&&e.campaignType&&e.campaignId&&e.id&&this.genericCampaignEventInternal({actionType:e.actionType,campaignId:e.campaignId,campaignType:e.campaignType,id:e.id})},e.prototype.pushNotificationEngagedEvent=function(e,t){var n="Swrve.Messages.Push-"+e+".engaged",r=this.eventFactory.constructEvent(this.profile.updateSeqnum(),_.nowInUtcTime(),"event",n),o=[r];if(this.profile.IsQA){var i=this.eventFactory.constructQAEvent(r);this.eventQueueManager.sendQAEvents([i])}this.queueEvents(o)},e.prototype.currencyGiven=function(e){e.currency&&e.amount&&this.currencyGivenInternal({currency:e.currency,amount:e.amount})},e.prototype.iapEvent=function(e){e.cost&&e.local_currency&&e.quantity&&e.product_id?this.iapInternal(e.rewards,e.local_currency,e.cost,e.quantity,e.product_id):d.default.infoMsg("Missing expected parameter")},Object.defineProperty(e.prototype,"onSwrveLoaded",{set:function(e){"function"==typeof e?this.onSwrveLoadedCallback=e:d.default.errorMsg("invalid function")},enumerable:!0,configurable:!0}),e.prototype.initializeIdentity=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return d.default.infoMsg("Setting up profile"),this.profile=new m.default(this.config.ExternalUserId),this.profile.IsIdentityResolved?[3,2]:[4,this.profile.callIdentifyOnExternalUserId(this.config.ExternalUserId,this)];case 1:e.sent(),this.profile.IsIdentityResolved&&d.default.infoMsg("Identify Resolved: "+this.profile.UserId+" for extUserId: "+this.profile.ExternalUserId),e.label=2;case 2:return[2]}}))}))},e.prototype.initializePersistentData=function(){this.hasPersistentInstallDate()||(this.sessionStartedAt=_.nowInUtcTime(),this.setPersistentInstallDate()),this.hasPersistentDeviceId()||this.setPersistentDeviceId()},e.prototype.queueEvents=function(e){var t=this;e.forEach(()},e.prototype.eventInternal=function(e,t){var n=this.eventFactory.constructEvent(this.profile.updateSeqnum(),_.nowInUtcTime(),e,t.name,t.payload),r=[n];if(this.profile.IsQA){var o=this.eventFactory.constructQAEvent(n);this.eventQueueManager.sendQAEvents([o])}this.queueEvents(r)},e.prototype.genericCampaignEventInternal=function(e){var t=this.eventFactory.constructGenericCampaignEvent(this.profile.updateSeqnum(),(new Date).getTime(),e.campaignType,e.campaignId,e.id,e.actionType);this.queueEvents([t])},e.prototype.currencyGivenInternal=function(e){var t=this.eventFactory.constructCurrencyGiven(this.profile.updateSeqnum(),_.nowInUtcTime(),e.currency,e.amount),n=[t];if(this.profile.IsQA){var r=this.eventFactory.constructQACurrencyGiven(t);this.eventQueueManager.sendQAEvents([r])}this.queueEvents(n)},e.prototype.sessionStartInternal=function(){var e=this.eventFactory.constructSessionStart(this.profile.updateSeqnum(),_.nowInUtcTime()),t=[e];if(this.profile.IsQA){var n=this.eventFactory.constructQASessionStart(e);this.eventQueueManager.sendQAEvents([n])}this.queueEvents(t)},e.prototype.userUpdateInternal=function(e){var t=this.eventFactory.constructUserUpdate(this.profile.updateSeqnum(),_.nowInUtcTime(),e),n=[t];if(this.profile.IsQA){var r=this.eventFactory.constructQAUserUpdate(t);this.eventQueueManager.sendQAEvents([r])}this.queueEvents(n)},e.prototype.userUpdateWithDateInternal=function(e,t){var n=this.profile.updateSeqnum(),r=this.eventFactory.constructUserUpdateWithDate(n,_.nowInUtcTime(),t.name,t.date),o=[];if(o.push(r),this.profile.IsQA){var i=this.eventFactory.constructQAUserUpdateWithDate(r);this.eventQueueManager.sendQAEvents([i])}this.queueEvents(o)},e.prototype.purchaseInternal=function(e,t,n,r){var o=this.profile.updateSeqnum(),i=this.eventFactory.constructPurchaseEvent(o,_.nowInUtcTime(),e,t,n,r),s=[];if(s.push(i),this.profile.IsQA){var a=this.eventFactory.constructQAPurchaseEvent(i);this.eventQueueManager.sendQAEvents([a])}this.queueEvents(s)},e.prototype.iapInternal=function(e,t,n,r,o){var i=this.profile.updateSeqnum(),s=this.eventFactory.constructIAPEvent(i,_.nowInUtcTime(),e,t,n,r,o),a=[];if(a.push(s),this.profile.IsQA){var u=this.eventFactory.constructQAIAPEvent(s);this.eventQueueManager.sendQAEvents([u])}this.queueEvents(a)},e.prototype.sendClientInfo=function(){var e=this.profile.updateSeqnum(),t=y.default.getClientInfo(),n=this.eventFactory.constructDeviceUpdate(e,_.nowInUtcTime(),t),r=[n];if(this.profile.IsQA){var o=this.eventFactory.constructQADeviceUpdate(n);this.eventQueueManager.sendQAEvents([o])}this.queueEvents(r)},e.prototype.generateSessionToken=function(e){var t=new s.Md5;t.appendStr(this.profile.UserId).appendStr(e).appendStr(this.config.ApiKey);var n=t.end();return this.config.AppID+"="+this.profile.UserId+"="+e+"="+n},e.prototype.hasSessionRestored=function(){if(null!=this.profile.LastSession){d.default.infoMsg("LastSession"),d.default.infoMsg(this.profile.LastSession);var e=Number(this.profile.LastSession);d.default.infoMsg("lastSession: "+e);var t=Number(_.nowInUtcTime());d.default.infoMsg("now: "+t);var n=1e3*this.config.NewSessionInterval,r=t-e;return d.default.infoMsg("Diff now - lastSession: "+r),!(e&&r>n&&(d.default.infoMsg("session has expired. returning false"),1))}return!1},e.prototype.getPersistentInstallDate=function(){return this.localStorageClient.fetchInstallDate()},e.prototype.hasPersistentInstallDate=function(){return h.isPresent(this.getPersistentInstallDate())},e.prototype.setPersistentInstallDate=function(){var e=f.default.dateToUTCDate(new Date(Date.now()));d.default.infoMsg("Setting Install Date:"),d.default.infoMsg(e),this.localStorageClient.storeInstallDate(f.default.dateToSwrveYYYYMMDDFormat(e))},e.prototype.getPersistentDeviceId=e.prototype.hasPersistentDeviceId=e.prototype.setPersistentDeviceId=function(){var e=I.generateUuid();d.default.infoMsg("Setting device id: "+e),this.localStorageClient.storeDeviceID(e.toString())},e.pageStateHandler=function(){null!==this.instance&&this.instance.profile.saveBeforeSessionEnd()},e}();t.default=E},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),i=n(22),s=r(n(23)),a=function(){eturn e.prototype.storeInstallDate=function(e){return this.storageManager.writeLocal(i.GlobalNamespaceKeys.InstallDate,e.toString())},e.prototype.fetchInstallDate=function(){var e=this.storageManager.readLocal(i.GlobalNamespaceKeys.InstallDate);return e?e.toString():void 0},e.prototype.storeDeviceID=e.prototype.fetchDeviceID=e.prototype.storeUserID=function(e,t){return this.storageManager.writeLocal(this.userIDKey(e),t)},e.prototype.fetchUserID=function(e){var t=this.storageManager.readLocal(this.userIDKey(e));return null!=t&&(t=t.toString()),t},e.prototype.storeLastETag=function(e,t){return this.storageManager.writeLocal(this.lastETagKey(e),t)},e.prototype.fetchLastETag=function(e){return this.storageManager.readLocal(this.lastETagKey(e))},e.prototype.storeFirstSession=function(e,t){return this.storageManager.writeLocal(this.firstSessionKey(e),t)},e.prototype.fetchFirstSession=function(e){var t=this.storageManager.readLocal(this.firstSessionKey(e));return t?+t:void 0},e.prototype.storeLastSession=function(e,t){return this.storageManager.writeLocal(this.lastSessionKey(e),t)},e.prototype.fetchLastSession=function(e){var t=this.storageManager.readLocal(this.lastSessionKey(e));return t?+t:void 0},e.prototype.storeSeqnum=function(e,t){return this.storageManager.writeLocal(this.seqnumKey(e),t)},e.prototype.fetchSeqnum=function(e){return+this.storageManager.readLocal(this.seqnumKey(e))},e.prototype.storeLastFlushFrequency=function(e,t){return this.storageManager.writeLocal(this.lastFlushFrequency(e),t)},e.prototype.fetchLastFlushFrequency=function(e){return this.storageManager.readLocal(this.lastFlushFrequency(e))},e.prototype.storeLastFlushRefreshDelay=function(e,t){return this.storageManager.writeLocal(this.lastFlushRefreshDelay(e),t)},e.prototype.fetchLastFlushRefreshDelay=function(e){return this.storageManager.readLocal(this.lastFlushRefreshDelay(e))},e.prototype.storeLastWebPushPublicKey=function(e,t){return this.storageManager.writeLocal(this.lastWebPushPublicKey(e),t)},e.prototype.fetchLastWebPushPublicKey=function(e){return this.storageManager.readLocal(this.lastWebPushPublicKey(e))},e.prototype.storeQAStatus=function(e,t){return this.storageManager.writeLocal(this.qaStatus(e),t)},e.prototype.fetchQAStatus=e.prototype.storeEventOnQueue=e.prototype.fetchEventKeys=function(e){var t=this;return this.storageManager.localKeys().filter(()},e.prototype.fetchEventsFromQueue=function(e){var t=this,n=this.fetchEventKeys(e),r=[];return n.forEach((),r},e.prototype.fetchEventFromQueue=function(e){return this.storageManager.readLocal(e)},e.prototype.deleteEventOnQueue=e.prototype.userIDKey=function(e){return"swrve:"+e+":"+i.ExternalUserNamespaceKeys.UserID},e.prototype.firstSessionKey=function(e){return"swrve:"+e+":"+i.UserNamespaceKeys.FirstSession},e.prototype.lastSessionKey=function(e){return"swrve:"+e+":"+i.UserNamespaceKeys.LastSession},e.prototype.seqnumKey=function(e){return"swrve:"+e+":"+i.UserNamespaceKeys.Seqnum},e.prototype.lastETagKey=function(e){return"swrve:"+e+":"+i.UserNamespaceKeys.LastETag},e.prototype.lastFlushFrequency=function(e){return"swrve:"+e+":"+i.UserNamespaceKeys.LastFlushFrequency},e.prototype.lastFlushRefreshDelay=function(e){return"swrve:"+e+":"+i.UserNamespaceKeys.LastFlushRefreshDelay},e.prototype.lastWebPushPublicKey=function(e){return"swrve:"+e+":"+i.UserNamespaceKeys.LastWebPushPublicKey},e.prototype.qaStatus=function(e){return"swrve:"+e+":"+i.UserNamespaceKeys.QAStatus},e.prototype.eventsQueueKey=function(e){return this.eventsQueueKeyPrefix(e)+":"+this.eventsQueueKeyStamp()},e.prototype.eventsQueueKeyPrefix=function(e){return"swrve:"+e+":"+i.UserNamespaceKeys.Events},e.prototype.eventsQueueKeyStamp=function(){return o.nowInUtcTime()+"-"+window.performance.now()+"-"+Math.random()},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return Object.defineProperty(e,"Mode",{get:function(){return this.mode},set:function(e){this.mode=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DevMode",{get:function(){return"dev"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TestMode",{get:function(){return"test"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ProdMode",{get:enumerable:!0,configurable:!0}),e.mode="prod",e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.dateToSwrveISOString=function(e){return e.toISOString().split(".")[0]+"Z"},e.dateToSwrveYYYYMMDDFormat=function(e){return e.toISOString().split("T")[0].replace(/-/g,"")},e.dateToUTCDate=e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18);t.sdkVersion="Web "+r.version,t.appStore="web",t.SWRVE_APP_STORE="swrve.app_store",t.SWRVE_COUNTRY_CODE="swrve.country_code",t.SWRVE_DEVICE_ID="swrve.device_id",t.SWRVE_DEVICE_NAME="swrve.device_name",t.SWRVE_DEVICE_REGION="swrve.device_region",t.SWRVE_DEVICE_WIDTH="swrve.device_width",t.SWRVE_DEVICE_HEIGHT="swrve.device_height",t.SWRVE_DEVICE_DPI="swrve.device_dpi",t.SWRVE_INSTALL_DATE="swrve.install_date",t.SWRVE_LANGUAGE="swrve.language",t.SWRVE_OS="swrve.os",t.SWRVE_OS_VERSION="swrve.os_version",t.SWRVE_SDK_VERSION="swrve.sdk_version",t.SWRVE_TIMEZONE_NAME="swrve.timezone_name",t.SWRVE_USER_ID="swrve.user_id",t.SWRVE_UTC_OFFSET_SECONDS="swrve.utc_offset_seconds",t.SWRVE_DEVICE_TYPE="swrve.device_type",t.SWRVE_BROWSER_NAME="swrve.browser_name",t.SWRVE_BROWSER_VERSION="swrve.browser_version",t.SWRVE_NAV_LANGUAGE="language",t.browserList=["chrome","opera","safari","firefox","msIE","Unknown"],t.browsersRegex={appleWebkit:/applewebkit/,chrome:/chrome/,chromium:/chromium/,edge:/edge/,firefox:/firefox/,mozilla:/mozilla/,msIE:/msie/,opera:/opr/,safari:/safari/,seamonkey:/seamonkey/,trident:/trident/,webkit:/webkit/},t.osRegex=[{name:"Windows 10",regex:/(Windows 10.0|Windows NT 10.0)/},{name:"Windows 8.1",regex:/(Windows 8.1|Windows NT 6.3)/},{name:"Windows 8",regex:/(Windows 8|Windows NT 6.2)/},{name:"Windows 7",regex:/(Windows 7|Windows NT 6.1)/},{name:"Windows Vista",regex:/Windows NT 6.0/},{name:"Windows Server 2003",regex:/Windows NT 5.2/},{name:"Windows XP",regex:/(Windows NT 5.1|Windows XP)/},{name:"Windows 2000",regex:/(Windows NT 5.0|Windows 2000)/},{name:"Windows ME",regex:/(Win 9x 4.90|Windows ME)/},{name:"Windows 98",regex:/(Windows 98|Win98)/},{name:"Windows 95",regex:/(Windows 95|Win95|Windows_95)/},{name:"Windows NT 4.0",regex:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{name:"Windows CE",regex:/Windows CE/},{name:"Windows 3.11",regex:/Win16/},{name:"Android",regex:/Android/},{name:"Open BSD",regex:/OpenBSD/},{name:"Sun OS",regex:/SunOS/},{name:"Linux",regex:/(Linux|X11)/},{name:"iOS",regex:/(iPhone|iPad|iPod)/},{name:"Mac OS X",regex:/Mac OS X/},{name:"Mac OS",regex:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{name:"QNX",regex:/QNX/},{name:"UNIX",regex:/UNIX/},{name:"BeOS",regex:/BeOS/},{name:"OS/2",regex:/OS\/2/},{name:"Search Bot",regex:/(nuhk|Googlebot|Yammybot|python|ruby|curl|bingbot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],t.browserBlackList=["msIE"],t.osBlackList=["Search Bot"]},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(4)),i=r(n(0)),s=n(8),a=function(){function e(){}return e.getClientInfo=function(){var e,t=this.getOS(),n=this.getBrowserInfo();return(e={})[s.SWRVE_DEVICE_ID]=this.getDeviceId(),e[s.SWRVE_OS]="web",e[s.SWRVE_OS_VERSION]=t.version,e[s.SWRVE_SDK_VERSION]=this.getSDKVersion(),e[s.SWRVE_LANGUAGE]=this.getBrowserLanguage(),e[s.SWRVE_COUNTRY_CODE]=this.getCountryCode(),e[s.SWRVE_DEVICE_REGION]=this.getRegion(),e[s.SWRVE_TIMEZONE_NAME]=this.getTimezoneName(),e[s.SWRVE_UTC_OFFSET_SECONDS]=this.getUTCOffsetSeconds(new Date),e[s.SWRVE_APP_STORE]=s.appStore,e[s.SWRVE_INSTALL_DATE]=this.getInstallDate(),e[s.SWRVE_BROWSER_NAME]=n.name,e[s.SWRVE_BROWSER_VERSION]=n.version,e[s.SWRVE_DEVICE_TYPE]=this.getDeviceType(),e},e.getOS=function(){var e,t={},n=navigator.userAgent.match(/\((.*?)\)/);n&&n.length>=2&&(t.version=n[1]);for(var r=0,o=s.osRegex;r<o.length;r++)if((e=o[r]).regex.test(navigator.userAgent)){t.name=e.name;break}return t},e.getDeviceName=function(){return this.getOS().name+" "+this.getBrowserInfo().name+" "+this.getBrowserInfo().version},e.getScreenResolution=function(){return{height:window.screen.availHeight.toString()||"Unknown",width:window.screen.availWidth.toString()||"Unknown"}},e.getBrowserLanguage=e.getTimezoneName=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone||"Unknown"},e.getUTCOffsetSeconds=function(e){var t=-60*e.getTimezoneOffset();return-0===t?0:t},e.getCountryCode=function(){return"Unknown"},e.getRegion=e.getInstallDate=function(){var e=o.default.getCurrentInstance();return e?e.InstallDate.toString():null},e.getDeviceId=function(){var e=o.default.getCurrentInstance();return e?e.DeviceId.toString():null},e.getDeviceType=function(){var e=navigator.userAgent.toLowerCase();return/android|webos|iphone|ipad|ipod|ios|blackberry|iemobile|opera mini|mobi/i.test(e)?"mobile":"desktop"},e.getBrowserInfo=function(){var t={name:"Unknown",version:"N/A"},n=navigator.userAgent.toLowerCase(),r=this.checkBrowser();for(var o in r)if(r[o])return t.name=o,t.version=e.extractBrowserVersion(o,n),t;return i.default.errorMsg("Cannot identify browser"),t},e.getSDKVersion=e.extractBrowserVersion=function(e,t){var n,r=new RegExp("version/(([0-9])+(.([0-9])+)+)"),o=new RegExp("rv:(([0-9])+(.([0-9])+)+)");return"safari"===e?(n=t.match(r))?n[1]:"N/A":(n=t.match(new RegExp("("+("msIE"===e?"msIE|edge":e)+")( |/)(([0-9])+(.([0-9])+)+)")))?n[3]||"N/A":(n=t.match(o))?n[1]:"N/A"},e.checkBrowser=function(){var e=navigator.userAgent.toLowerCase();return{chrome:s.browsersRegex.webkit.test(e)&&s.browsersRegex.chrome.test(e)&&!s.browsersRegex.edge.test(e)&&!s.browsersRegex.chromium.test(e),firefox:s.browsersRegex.mozilla.test(e)&&s.browsersRegex.firefox.test(e)&&!s.browsersRegex.seamonkey.test(e),msIE:s.browsersRegex.msIE.test(e)||s.browsersRegex.trident.test(e)||s.browsersRegex.edge.test(e),opera:s.browsersRegex.mozilla.test(e)&&s.browsersRegex.appleWebkit.test(e)&&s.browsersRegex.chrome.test(e)&&s.browsersRegex.safari.test(e)&&s.browsersRegex.opera.test(e),safari:s.browsersRegex.safari.test(e)&&s.browsersRegex.appleWebkit.test(e)&&!s.browsersRegex.chrome.test(e)}},e}();t.default=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),s=r(n(0));!function(e){e.GET="GET",e.POST="POST"}(o||(o={}));var a=function(){function e(){}return e.get=function(e,t,n){return this.xhrRequest(o.GET,e,null,t,n)},e.post=function(e,t,n,r){return this.xhrRequest(o.POST,e,t,n,r)},e.xhrRequest=function(e,t,n,r,o){var a=this;return new Promise((function(u,c){var f=a.getXmlHttpRequest(e,t),l=null;f.onload=function(){return(l=a.getXmlHTTPResponse(e,f)).statusCode>=400?(s.default.warnMsg("Restclient received status code: "+l.statusCode),i.isNil(o)||o(l),c(l)):(i.isNil(r)||r(l),u(l))},f.onerror=function(){return s.default.warnMsg("RESTClient encountered an error"),i.isNil(o)||o(l),c(new Error(f.statusText))},n?f.send(JSON.stringify(n)):f.send()}))},e.getXmlHTTPResponse=function(e,t){return{etag:e===o.GET&&"{}"!==t.responseText?t.getResponseHeader("Etag"):null,jsonBody:t.responseText,statusCode:t.status}},e.getXmlHttpRequest=function(e,t){var n=new XMLHttpRequest;return n.open(e,t,!0),n.setRequestHeader("Content-type","application/json"),n},e}();t.default=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(14)),i=r(n(4)),s=r(n(6)),a=null,u=function(){function e(e){var t=o.default.validateInitParams(e);if(t)throw o.default.outputErrors(t),new TypeError("Parameters are not correct");s.default.Mode=e.mode||"prod",a=i.default.createInstance(e)}return e.createInstance=function(t){return e.instance||(e.instance=new e(t),e.instance.init()),e.instance},e.prototype.init=function(){return e.checkInstance().init()},e.checkInstance=e.namedEvent=function(t){e.checkInstance().namedEvent(t)},e.userUpdate=function(t){e.checkInstance().userUpdate(t)},e.userUpdateWithDate=function(t){e.checkInstance().userUpdateWithDate(t)},e.purchaseEvent=function(t){e.checkInstance().purchaseEvent(t)},e.iapEvent=function(t){e.checkInstance().iapEvent(t)},e.currencyGiven=e.getQueuedEvents=e.getConfig=function(){return e.checkInstance().Config},e.getPushManager=function(){return e.checkInstance().SwrvePushManager},e.registerPush=function(t,n){return e.checkInstance().registerPush(t,n)},e.unregisterPush=e.getUserId=e.getExternalUserId=e.shutdown=function(){null!=a&&i.default.shutdown(),a=null,e.instance=null},Object.defineProperty(e,"onSwrveLoaded",{set:enumerable:!0,configurable:!0}),e.instance=null,e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventTypes={currencyGiven:"currency_given",deviceUpdateEvent:"device_update",genericCampaignEvent:"generic_campaign_event",iapEvent:"iap",namedEvent:"event",purchaseEvent:"purchase",qaLogEvent:"qa_log_event",sessionStartEvent:"session_start",userUpdateEvent:"user"},t.firstSessionEventName="Swrve.first_session",t.sessionStartEventName="Swrve.session_start"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuidRegex=/^\s*([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\s*$/i,t.parseUuid=function(e){var n=t.uuidRegex.exec(e);if(null==n)throw new Error("Invalid UUID");var o=(n[1]+n[2]+n[3]+n[4]+n[5]).split(/(..)/g).filter(().map(();return new r(o)},t.generateUuid=function(){var e=crypto.getRandomValues(new Uint8Array(16));return e[6]=15&e[6]|64,e[8]=63&e[8]|128,new r(Array.from(e))};var r=function(){function e(e){if(16!==e.length)throw new Error("Invalid UUID: Incorrect byte count");this.bytes=e.map(()}return e.prototype.toString=function(){return this.bytes.map(().map(().join("").replace(/^(.{8})(.{4})(.{4})(.{4})(.{12})$/,"$1-$2-$3-$4-$5")},e}();t.Uuid=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=r(n(6)),s=r(n(0)),a=/[(https):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi,u=function(){function e(){}return e.validateExternalUserId=function(e){var t=[];return null!=e&&"string"!=typeof e&&t.push("externalUserId should be a string"),t},e.validateAppId=function(e){var t=[];return e||t.push("appId doesn't exist"),e&&"number"!=typeof e&&t.push("appId should be a number"),t},e.validateApiKey=function(e){var t=[];return e||t.push("apiKey doesn't exist"),e&&"string"!=typeof e&&t.push("apiKey should be a string"),e&&"string"==typeof e&&!e.startsWith("web_sdk-")&&t.push("apiKey should be a valid web_sdk api key"),t},e.validateContentUrl=function(e){var t=[];e&&"string"!=typeof e&&t.push("contentURL should be a string");var n=new RegExp(a);return e&&!n.test(e)&&t.push("contentURL isn't valid URL"),t},e.validateApiUrl=function(e){var t=[];e&&"string"!=typeof e&&t.push("apiURL should be a string");var n=new RegExp(a);return e&&!n.test(e)&&t.push("apiURL isn't a valid URL"),t},e.validateVersion=function(e){var t=[];return e&&"string"!=typeof e&&t.push("version should be a string"),e&&!/(([0-9])+(\.([0-9])+)+)/.test(e)&&t.push("version isn't valid"),t},e.validateSessionTimeout=function(e){var t=[];return e&&"number"!=typeof e&&t.push("sessionTimeout should be a number"),e&&e<0&&t.push("sessionTimeout should be positive integer or 0"),t},e.validateInitParams=function(e){var t={};if(e&&"[object Object]"===Object.prototype.toString.call(e)?t.devErrors=this.validateExternalUserId(e.externalUserId).concat(this.validateAppId(e.appId),this.validateApiKey(e.apiKey),this.validateContentUrl(e.contentURL),this.validateApiUrl(e.apiURL),this.validateVersion(e.appVersion),this.validateSessionTimeout(e.httpTimeoutSeconds)):t.devErrors=["Init params should follow the scheme:\n        {\n          appId: number - *required\n          apiKey: string - *required\n          apiURL: string\n          contentURL: string\n          sessionTimeout: number\n          externalUserId: string - *required\n          version: string\n          devMode: boolean\n        }"],t.devErrors.length)return t.mainError="Initial configuration parameters are incorrect",t},e.outputErrors=function(e){i.default.ProdMode?s.default.errorMsg(o.messageConfig.title+" "+o.messageConfig.types.error+": "+e.mainError):(s.default.errorMsg(o.messageConfig.title+" "+o.messageConfig.types.error+": "+e.mainError),e.devErrors.forEach((function(e){s.default.errorMsg(" "+e)})))},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return e.hashStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendStr(e).end(t)},e.hashAsciiStr=e._hex=e._md5cycle=e.prototype.start=e.prototype.appendStr=e.prototype.appendAsciiStr=e.prototype.appendByteArray=e.prototype.getState=function(){var e=this._state;return{buffer:String.fromCharCode.apply(null,this._buffer8),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}},e.prototype.setState=e.prototype.end=function(t){void 0===t&&(t=!1);var n,r=this._bufferLength,o=this._buffer8,i=this._buffer32,s=1+(r>>2);if(this._dataLength+=r,o[r]=128,o[r+1]=o[r+2]=o[r+3]=0,i.set(e.buffer32Identity.subarray(s),s),r>55&&(e._md5cycle(this._state,i),i.set(e.buffer32Identity)),(n=8*this._dataLength)<=4294967295)i[14]=n;else{var a=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===a)return;var u=parseInt(a[2],16),c=parseInt(a[1],16)||0;i[14]=u,i[15]=c}return e._md5cycle(this._state,i),t?this._state:e._hex(this._state)},e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.hexChars="0123456789abcdef",e.hexOut=[],e.onePassHasher=new e,e}();t.Md5=r,"5d41402abc4b2a76b9719d911017c592"!==r.hashStr("hello")&&console.error("Md5 self test failed.")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(){function e(e){this.appID=null,this.apiKey=null,this.apiURL=null,this.contentURL=null,this.identifyURL=null,this.language=null,this.newSessionInterval=null,this.httpTimeoutSeconds=null,this.serviceWorker=null,this.pushEnabled=!1,this.autoPushSubscribe=!1,this.userVisibleOnly=!0,this.externalUserId=e.externalUserId,this.appID=e.appId,this.apiKey=e.apiKey,this.stack=e.stack||"us",this.language=e.language||"English",this.newSessionInterval=e.newSessionInterval||1800,this.resolveApiUrl(e),this.resolveContentUrl(e),this.resolveIdentifyUrl(e),this.appVersion=e.appVersion||"1.0",this.httpTimeoutSeconds=e.httpTimeoutSeconds||10,this.autoPushSubscribe=e.autoPushSubscribe||!1,this.serviceWorker=e.serviceWorker||r.swrveServiceWorkerName}return Object.defineProperty(e.prototype,"ExternalUserId",{get:function(){return this.externalUserId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AppVersion",{get:function(){return this.appVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AppID",{get:function(){return this.appID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ApiKey",{get:function(){return this.apiKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ApiURL",{get:function(){return this.apiURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ContentURL",{get:function(){return this.contentURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IdentifyURL",{get:function(){return this.identifyURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ServiceWorker",{get:function(){return this.serviceWorker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AutoPushSubscribe",{get:function(){return this.autoPushSubscribe},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HttpTimeoutSeconds",{get:function(){return this.httpTimeoutSeconds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Language",{get:function(){return this.language},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"NewSessionInterval",{get:function(){return this.newSessionInterval},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UserVisibleOnly",{get:function(){return this.userVisibleOnly},enumerable:!0,configurable:!0}),e.prototype.resolveApiUrl=function(e){var t="eu"===e.stack?"eu-api":"api";this.apiURL=e.apiURL||"https://"+e.appId+"."+t+".swrve.com"},e.prototype.resolveContentUrl=function(e){var t="eu"===e.stack?"eu-content":"content";this.contentURL=e.contentURL||"https://"+e.appId+"."+t+".swrve.com"},e.prototype.resolveIdentifyUrl=function(e){var t="eu"===this.stack?"eu-identity":"identity";this.identifyURL=e.identifyURL||"https://"+e.appId+"."+t+".swrve.com/identify"},e}();t.default=o},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(7)),i=n(12),s=n(8),a=function(){function e(){}return e.prototype.constructEvent=function(e,t,n,r,o){var i={seqnum:e,time:t,type:n};return null!=r&&(i.name=r),i.payload=null!=o?o:{},i},e.prototype.constructQAEvent=function(e){var t={client_time:e.time,parameters:{name:e.name},seqnum:e.seqnum,type:e.type};return e.name&&e.payload&&(t.parameters={name:e.name,payload:e.payload}),e.name&&!e.payload&&(t.parameters={name:e.name}),e.name||e.payload||(t.parameters={}),this.constructQAWrappedEvent(t)},e.prototype.constructSessionStart=function(e,t,n,r){return this.constructEvent(e,t,i.eventTypes.sessionStartEvent,n,r)},e.prototype.constructQASessionStart=function(e){return this.constructQAEvent(e)},e.prototype.constructUserUpdate=function(e,t,n){return{attributes:n,seqnum:e,time:t,type:i.eventTypes.userUpdateEvent}},e.prototype.constructQAUserUpdate=function(e){var t={client_time:e.time,parameters:{attributes:e.attributes},seqnum:e.seqnum,type:e.type};return this.constructQAWrappedEvent(t)},e.prototype.constructUserUpdateWithDate=function(e,t,n,r){var i=o.default.dateToUTCDate(r),s={name:n,date:o.default.dateToSwrveISOString(i)};return this.constructUserUpdate(e,t,s)},e.prototype.constructQAUserUpdateWithDate=e.prototype.constructGenericCampaignEvent=function(e,t,n,r,o,s){return{actionType:s,campaignId:r,campaignType:n,id:o,seqnum:e,time:t,type:i.eventTypes.genericCampaignEvent}},e.prototype.constructDeviceUpdate=e.prototype.constructQADeviceUpdate=function(e){var t={client_time:e.time,parameters:{attributes:e.attributes},seqnum:e.seqnum,type:e.type};return this.constructQAWrappedEvent(t)},e.prototype.constructPurchaseEvent=function(e,t,n,r,o,s){return{cost:o,currency:r,item:n,quantity:s,seqnum:e,time:t,type:i.eventTypes.purchaseEvent}},e.prototype.constructQAPurchaseEvent=function(e){var t={client_time:e.time,parameters:{cost:e.cost,currency:e.currency,item:e.item,quantity:e.quantity},seqnum:e.seqnum,type:e.type};return this.constructQAWrappedEvent(t)},e.prototype.constructIAPEvent=function(e,t,n,r,o,a,u){return{app_store:s.appStore,cost:o,local_currency:r,product_id:u,quantity:a,rewards:n,seqnum:e,time:t,type:i.eventTypes.iapEvent}},e.prototype.constructQAIAPEvent=function(e){var t={client_time:e.time,parameters:{app_store:s.appStore,cost:e.cost,local_currency:e.local_currency,product_id:e.product_id,quantity:e.quantity,rewards:e.rewards},seqnum:e.seqnum,type:e.type};return this.constructQAWrappedEvent(t)},e.prototype.constructCurrencyGiven=function(e,t,n,r){return{given_amount:r,given_currency:n,seqnum:e,time:t,type:i.eventTypes.currencyGiven}},e.prototype.constructQACurrencyGiven=function(e){var t={client_time:e.time,parameters:{given_amount:e.given_amount,given_currency:e.given_currency},seqnum:e.seqnum,type:e.type};return this.constructQAWrappedEvent(t)},e.prototype.constructQAWrappedEvent=function(e){return{log_details:e,log_source:"sdk",log_type:"event",seqnum:e.seqnum,time:e.client_time,type:"qa_log_event"}},e}();t.default=a},function(e){e.exports={name:"@swrve/web-sdk",version:"1.4.3",author:"Swrve Inc.",license:"Apache-2.0",keywords:["swrve","sdk","web","browser","js","chrome","firefox","safari","engagement","marketing","platform"],homepage:"https://github.com/Swrve/swrve-web-sdk#readme",bugs:{url:"https://github.com/Swrve/swrve-web-sdk/issues"},repository:{type:"git",url:"git@github.com:Swrve/swrve-web-sdk.git"},files:["dist/**/*"],browser:"dist/SwrveSDK.js",scripts:{bundle:"yarn run bundle:prod","bundle:dev":"webpack --config webpack.dev.js --watch","bundle:prod":"webpack --config webpack.prod.js","bundle:release":"yarn run bundle:prod",stats:"webpack --config webpack.prod.js --profile --json > stats.json && webpack-bundle-analyzer stats.json --mode static --no-open",clean:"yarn cache clean && rm -rf ./dist",lint:"tslint --project tsconfig.json",prepublish:"yarn bundle:release"},devDependencies:{"clean-webpack-plugin":"1.0.0","ts-loader":"5.3.3","ts-md5":"1.2.4",tslint:"5.12.1","tslint-config-airbnb":"5.11.1","tslint-loader":"3.5.4","tslint-sonarts":"1.8.0",typedoc:"0.14.1","typedoc-webpack-plugin":"1.1.4",typescript:"3.2.2",webpack:"4.28.4","webpack-bundle-analyzer":"3.0.3","webpack-cli":"3.2.1","webpack-merge":"4.2.1"}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),i=function(){function e(){}return e.isValidEventName=function(e){for(var t=0,n=["Swrve.","swrve."];t<n.length;t++){var r=n[t];if(null==e||e.startsWith(r))return o.default.errorMsg("Event names cannot begin with: "+r+" :: This event will not be sent. Eventname: "+e),!1}return!0},e}();t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(21),a=n(1),u=i(n(9)),c=i(n(10)),f=i(n(5)),l=i(n(4)),p=n(3),h=n(2),d=i(n(0)),v=function(){function e(){}return e.prototype.init=e.prototype.getInfoForSession=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:e=l.default.getCurrentInstance(),t=new f.default,n=h.isPresent(t.fetchLastFlushRefreshDelay(e.Profile.UserId)),e.Profile.Etag&&n&&l.default.getCurrentInstance().Profile.setEtag(null),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.getResourcesAndCampaigns()];case 2:return r=o.sent(),d.default.infoMsg(r.jsonBody),void 0!==r.jsonBody&&"{}"!==r.jsonBody&&200===r.statusCode&&(i=JSON.parse(r.jsonBody),t.storeLastFlushFrequency(e.Profile.UserId,i.flush_frequency),t.storeLastFlushRefreshDelay(e.Profile.UserId,i.flush_refresh_delay),t.storeQAStatus(e.Profile.UserId,"qa"in i),t.storeLastWebPushPublicKey(e.Profile.UserId,i.web_push_public_key),r.etag&&l.default.getCurrentInstance().Profile.setEtag(r.etag)),[2,{flushFrequency:t.fetchLastFlushFrequency(e.Profile.UserId)||a.defaultFlushFrequency,flushRefreshDelay:t.fetchLastFlushRefreshDelay(e.Profile.UserId)||a.defaultFlushRefreshDelay,qa:t.fetchQAStatus(e.Profile.UserId)||!1,webPushPublicKey:t.fetchLastWebPushPublicKey(e.Profile.UserId)||null}];case 3:return s=o.sent(),d.default.errorMsg(s),[2,{flushFrequency:a.defaultFlushFrequency,flushRefreshDelay:a.defaultFlushRefreshDelay,qa:!1,webPushPublicKey:null}];case 4:return[2]}}))}))},e.prototype.processInBackground=function(){if(this.isProcessing)return null;this.setAsStarted();try{this.getResourcesAndCampaigns()}catch(e){d.default.errorMsg("SwrveSDK - An error has occured processing events"),d.default.errorMsg(e)}this.setAsStopped(),this.timeoutProcess=window.setTimeout(this.processInBackground.bind(this),this.flushConfig.flushFrequency)},e.prototype.shutdown=e.prototype.setAsStarted=function(){this.isProcessing=!0,this.lastProcessingStart=p.nowInUtcTime()},e.prototype.setAsStopped=function(){this.isProcessing=!1,this.lastProcessingStop=p.nowInUtcTime()},e.prototype.resourceAndCampaignRequestUrl=function(e){var t={api_key:e.Config.ApiKey,app_store:s.resourcesCampaignSpecialParams.app_store,app_version:e.Config.AppVersion||a.swrveVersion.toString(),device_height:u.default.getScreenResolution().height,device_name:u.default.getDeviceName(),device_type:u.default.getDeviceType(),device_width:u.default.getScreenResolution().width,joined:e.Profile.FirstSession.toString(),language:u.default.getBrowserLanguage(),orientation:s.resourcesCampaignSpecialParams.orientation,os:"web",os_version:u.default.getOS().version,user:e.Profile.UserId,version:s.resourcesCampaignSpecialParams.version};e.Profile.Etag&&(t.etag=e.Profile.Etag);var n=Object.keys(t).map(().join("&"),r=this.replaceWhitespaces(n,"+");return e.Config.ContentURL+"/"+s.resourcesCampaignURL+"?"+r},e.prototype.getResourcesAndCampaigns=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){return e=this.resourceAndCampaignRequestUrl(l.default.getCurrentInstance()),[2,c.default.get(e)]}))}))},e.prototype.replaceWhitespaces=e}();t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resourcesCampaignURL="api/1/user_content",t.resourcesCampaignSpecialParams={app_store:"web",orientation:"both",version:"7"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalNamespaceKeys||(t.GlobalNamespaceKeys={})),t.ExternalUserNamespaceKeys||(t.ExternalUserNamespaceKeys={})),t.UserNamespaceKeys||(t.UserNamespaceKeys={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(){function e(){this.dbName=r.swrveDefaultDBName,this.dbVersion=r.swrveDefaultDBVersion,this.local=localStorage}return e.clear=e.prototype.writeLocal=e.prototype.readLocal=function(e){var t=this.local.getItem(e);return null===t?null:this.deserialize(t)},e.prototype.deleteLocal=e.prototype.localKeys=function(){for(var e=[],t=0;t<this.local.length;t+=1)e.push(this.local.key(t));return e},e.prototype.serialize=e.prototype.deserialize=function(e){var t=null;try{t=JSON.parse(e)}catch(n){t=e}return t},e.initailized=!1,e}();t.default=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(25)),a=i(n(5)),u=i(n(4)),c=n(3),f=i(n(0)),l=function(){function e(e,t,n,r){var o=u.default.getCurrentInstance(),i=o?o.InstallDate:void 0,c=o?o.DeviceId:void 0;this.userID=n,this.installDate=i,this.deviceID=c,this.sessionToken=r,this.swrveConfig=e,this.flushConfig=t,this.isSending=!1,this.localStorageClient=new a.default,this.eventAPIClient=new s.default(e.ApiURL,this.userID,this.deviceID)}return e.prototype.init=e.prototype.shutdown=function(){clearTimeout(this.timeoutProcess);try{this.sendEvents()}catch(e){f.default.errorMsg("SwrveSDK - could not clear events before shutdown"),f.default.errorMsg(e)}this.timeoutProcess=void 0},e.prototype.deleteEvents=function(e){var t=this;f.default.infoMsg("Deleting Events from Queue"),e.forEach(()},e.prototype.sendEvents=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,s,a=this;return o(this,(function(o){switch(o.label){case 0:if(e=this.localStorageClient.fetchEventsFromQueue(this.userID),t=this.localStorageClient.fetchEventKeys(this.userID),n=function(e){a.deleteEvents(t)},r=function(e){e.statusCode<500?a.deleteEvents(t):f.default.errorMsg("Swrve API responded with status code: "+e.statusCode+" and body: "+e.jsonBody+". Leaving events in queue")},i={apiURL:this.swrveConfig.ApiURL,appVersion:this.swrveConfig.AppVersion,deviceID:this.deviceID,sessionToken:this.sessionToken,userId:this.userID},this.isSending)return f.default.warnMsg("Swrve Event Queue is still sending..."),[2];this.isSending=!0,o.label=1;case 1:return o.trys.push([1,4,5,6]),e.length>0?[4,this.eventAPIClient.sendEventBatch(i,e,n,r)]:[3,3];case 2:o.sent(),o.label=3;case 3:return[3,6];case 4:return s=o.sent(),f.default.warnMsg("There was an error sending the event batch"),f.default.warnMsg(s),[3,6];case 5:return this.isSending=!1,[7];case 6:return[2]}}))}))},e.prototype.sendQAEvents=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:t=JSON.stringify(e),f.default.infoMsg("Sending QA event..."+t),n=r=function(e){f.default.warnMsg("QA event sending failed, status code: "+e.statusCode+" and body:"+e.jsonBody+" event data:"+t)},i={apiURL:this.swrveConfig.ApiURL,appVersion:this.swrveConfig.AppVersion,deviceID:this.deviceID,sessionToken:this.sessionToken,userId:this.userID},o.label=1;case 1:return o.trys.push([1,4,5,6]),e.length>0?[4,this.eventAPIClient.sendEventBatch(i,e,n,r)]:[3,3];case 2:o.sent(),o.label=3;case 3:return[3,6];case 4:return s=o.sent(),f.default.warnMsg("There was an error sending the QA event"),f.default.warnMsg(s),[3,6];case 5:return f.default.infoMsg("Finsihed QA event sending"),[7];case 6:return[2]}}))}))},e.prototype.processInBackground=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:if(this.isProcessing)return f.default.warnMsg("EventQueueManager is already processing"),[2,null];this.setAsStarted(),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.sendEvents()];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),f.default.errorMsg("SwrveSDK - An error has occured processing events"),f.default.errorMsg(e),[3,4];case 4:return this.setAsStopped(),this.timeoutProcess=window.setTimeout(this.processInBackground.bind(this),this.flushConfig.flushFrequency),[2]}}))}))},e.prototype.setAsStarted=function(){this.isProcessing=!0,this.lastProcessingStart=c.nowInUtcTime()},e.prototype.setAsStopped=e}();t.default=l},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),a=i(n(10)),u=function(){function e(e,t,n){this.apiVersion=1,this.eventBatchUriPath="/batch",this.baseUrl=new URL(this.apiVersion.toString(),e).toString(),this.deviceId=n,this.userId=t}return e.prototype.sendEventBatch=function(e,t,n,i){return r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return(r=this.eventBatchRequestParams(e)).body.data=t,[4,a.default.post(r.url,r.body,n,i)];case 1:return[2,o.sent()]}}))}))},e.prototype.eventBatchRequestParams=function(e){return{url:""+this.baseUrl+this.eventBatchUriPath,body:this.requestBodyPrototype(e)}},e.prototype.requestBodyPrototype=function(e){var t={};return t.session_token=e.sessionToken,t.app_version=e.appVersion,t.user=this.userId,t.unique_device_id=this.deviceId,t.version=s.swrveVersion,t},e}();t.default=u},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),i=r(n(9)),s=function(){eturn e.isTrackingSupported=function(){var e=i.default.getOS(),t=i.default.getBrowserInfo();return null!=t.name&&null!=t.version&&!(o.browserBlackList.includes(t.name)||o.osBlackList.includes(e.name))},e}();t.default=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(10)),a=i(n(5)),u=n(3),c=n(2),f=i(n(0)),l=n(13),p=function(){function e(e){var t=null,n=this.getSwrveProfileFromExternalUserId(e);null!=n&&void 0!==n?(t=n,this.externalUserId=t.extUserId,this.userId=t.userId,this.firstSession=t.firstSession,this.lastSession=t.lastSession,this.seqnum=t.seqnum,this.isQA=t.qa,t.etag&&(this.etag=t.etag),this.isIdentityResolved=!0):(f.default.infoMsg("No Profile Found In Storage. Calling identify API"),this.isIdentityResolved=!1)}return Object.defineProperty(e.prototype,"ExternalUserId",{get:function(){return this.externalUserId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UserId",{get:function(){return this.userId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"FirstSession",{get:function(){return this.firstSession},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastSession",{get:function(){return this.lastSession},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Seqnum",{get:function(){return this.seqnum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Etag",{get:function(){return this.etag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsQA",{get:function(){return this.isQA},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsIdentityResolved",{get:function(){return this.isIdentityResolved},enumerable:!0,configurable:!0}),e.prototype.callIdentifyOnExternalUserId=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,a,p,h;return o(this,(function(o){switch(o.label){case 0:n=l.generateUuid().toString(),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,s.default.post(t.Config.IdentifyURL,{api_key:t.Config.ApiKey,swrve_id:n,external_user_id:e,unique_device_id:t.DeviceId})];case 2:return void 0!==(r=o.sent()).jsonBody&&200===r.statusCode?(i=JSON.parse(r.jsonBody),a={extUserId:e,firstSession:u.nowInUtcTime(),qa:!1,seqnum:0,userId:i.swrve_id},this.externalUserId=a.extUserId,this.userId=a.userId,this.firstSession=a.firstSession,this.lastSession=a.lastSession,this.seqnum=a.seqnum,this.isQA=a.qa,this.isIdentityResolved=!0,this.saveSwrveProfileToStorage(a)):(p=c.isNil(r.jsonBody)?"with no message.":" message: "+r.jsonBody,f.default.errorMsg("Identify failed: "+r.statusCode+" :: "+p)),[3,4];case 3:return h=o.sent(),f.default.errorMsg(h),[3,4];case 4:return[2]}}))}))},e.prototype.setEtag=function(e){this.etag=e},e.prototype.setQAFlag=e.prototype.getSwrveProfileFromExternalUserId=function(t){try{var n=e.getSwrveProfileFromStorage(t);return!c.isNil(n)&&this.isValidResultProfile(n)?(f.default.infoMsg("Received from Storage: "+n.userId+" | "+n.extUserId+" | "+n.seqnum+" | "+n.firstSession+" | "+n.lastSession+" | "+n.etag),n):null}catch(e){return f.default.errorMsg(e),null}},e.prototype.updateSeqnum=function(){return this.seqnum=this.seqnum+1,this.seqnum},e.prototype.saveBeforeSessionEnd=function(){this.lastSession=u.nowInUtcTime();var e={extUserId:this.externalUserId,firstSession:this.firstSession,lastSession:this.lastSession,qa:this.isQA,seqnum:this.seqnum,userId:this.userId};this.etag&&(e.etag=this.etag),this.saveSwrveProfileToStorage(e)},e.getSwrveProfileFromStorage=function(e){var t=new a.default,n=t.fetchUserID(e);return{etag:t.fetchLastETag(n),extUserId:e,firstSession:t.fetchFirstSession(n),lastSession:t.fetchLastSession(n),qa:t.fetchQAStatus(n),seqnum:t.fetchSeqnum(n),userId:n}},e.prototype.saveSwrveProfileToStorage=function(e){var t=new a.default;t.storeUserID(e.extUserId,e.userId),t.storeSeqnum(e.userId,e.seqnum),t.storeFirstSession(e.userId,e.firstSession),t.storeQAStatus(e.userId,e.qa),e.lastSession&&t.storeLastSession(e.userId,e.lastSession),e.etag&&t.storeLastETag(e.userId,e.etag)},e.prototype.isValidResultProfile=function(e){return!(c.isNil(e.userId)||c.isNil(e.extUserId)||c.isNil(e.firstSession)||c.isNil(e.seqnum))},e}();t.default=p},function(e,t,n){"use strict";var r=this&&this.__awaiter||o=this&&this.__generator||i=this&&this.__importDefault||Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(11)),a=n(29),u=n(2),c=i(n(0));t.serviceWorkerEventTypes={swrvePushNotificationClicked:"swrve.push_clicked",swrvePushNotificationClosed:"swrve.push_closed",swrvePushReceived:"swrve.push_receieved"};var f=function(){function e(e,t,n,r,o){this.config=e,this.isInitialised=!1,this.webPushApiKey=t,this.callBackPushRecieved=n,this.callBackPushClicked=r,this.callBackPushClosed=o}return Object.defineProperty(e.prototype,"IsInitialised",{get:function(){return this.isInitialised},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"WebPushApiKey",{get:enumerable:!0,configurable:!0}),e.prototype.init=function(){this.IsInitialised?c.default.infoMsg("SwrvePushManager :: Already Initialised"):this.isPushSupported()?this.isInitialised=!0:c.default.infoMsg("SwrvePushManager :: Push is not supported")},e.prototype.registerPush=function(e,t){var n=this;if(this.isPushSupported()){this.check();var r=u.isNil(e)?u.noOp:e,o=u.isNil(t)?u.noOp:t,i=this.config.ServiceWorker;navigator.serviceWorker.register(i).then((function(e){c.default.infoMsg("Registering service worker: "+i),c.default.infoMsg(e),e.pushManager.getSubscription().then((function(t){if(!u.isNil(t))return c.default.infoMsg("Already subscribed to push"),n.sendPushRegistrationProperties(t),void r();c.default.infoMsg("Attempting to subscribe to push");var i={applicationServerKey:a.base64UrlToUint8Array(n.WebPushApiKey),userVisibleOnly:n.config.UserVisibleOnly};e.pushManager.subscribe(i).then((function(e){n.sendPushRegistrationProperties(e),c.default.infoMsg("Subscribed Successfully"),r()})).catch((function(e){c.default.errorMsg("Subcription to push failed"),c.default.errorMsg(e),o(e)}))})).catch((function(e){c.default.errorMsg("Cannot get Push Subscription Information"),c.default.errorMsg(e),o(e)}))})),this.registerPushListeners()}},e.prototype.unregisterPush=function(e,t){if(this.isPushSupported()){this.check();var n=u.isNil(e)?u.noOp:e,r=u.isNil(t)?u.noOp:t,o=navigator.serviceWorker.ready.then((function(e){e.pushManager.getSubscription().then((function(e){u.isNil(e)?c.default.warnMsg("Could not unregister push. No subscription found"):e.unsubscribe().then((function(){navigator.serviceWorker.getRegistrations().then((function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];c.default.infoMsg("Unregistering from Service Worker"),c.default.infoMsg(r),r.unregister()}})),n()})).catch((function(e){c.default.errorMsg("Error unsubscribing from push"),o(e)}))})).catch(()}))}},e.prototype.isPushSupported=e.prototype.onPushReceived=function(e){return c.default.infoMsg("Notification Received"),u.isNil(this.callBackPushRecieved)?null:this.callBackPushRecieved(e)},e.prototype.onPushClicked=function(e){return c.default.infoMsg("Notification Clicked"),c.default.infoMsg(e),u.isPresent(e.data)&&u.isPresent(e.data.body.id)&&s.default.checkInstance().pushNotificationEngagedEvent(e.data.body.id,e.data.body.deeplink),u.isNil(this.callBackPushClicked)?null:this.callBackPushClicked(e)},e.prototype.onPushClosed=function(e){return c.default.infoMsg("Notification Closed"),u.isNil(this.callBackPushClosed)?null:this.callBackPushClosed(e)},e.prototype.registerPushListeners=function(){var e=this;navigator.serviceWorker.removeEventListener("message",this.pushHandler),navigator.serviceWorker.addEventListener("message",bind(this),!1)},e.prototype.pushHandler=function(e){c.default.infoMsg("PushManager receieved message event"),c.default.infoMsg(e);var n=e.data;if(u.isNil(n))c.default.errorMsg("Could not parse message from service worker");else switch(n.type){case t.serviceWorkerEventTypes.swrvePushReceived:this.onPushReceived(e);break;case t.serviceWorkerEventTypes.swrvePushNotificationClicked:this.onPushClicked(e);break;case t.serviceWorkerEventTypes.swrvePushNotificationClosed:this.onPushClosed(e)}},e.prototype.check=e.prototype.sendPushRegistrationProperties=function(e){var t=e.toJSON(),n=t.keys.auth,r=t.keys.p256dh,o=t.endpoint;this.webPushToken=o+"|"+r+"|"+n,c.default.infoMsg("sending push registration properties : "+this.webPushToken),c.default.infoMsg(t),s.default.userUpdate({"swrve.web_push_token":this.webPushToken}),this.sendBrowserPermissions(e)},e.prototype.sendBrowserPermissions=function(e){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){switch(t.label){case 0:return this.browserHasPermissionsAccess()?[4,navigator.permissions.query({name:"notifications"}).then((function(t){c.default.infoMsg("notifications permission status is  "+t.state),e.sendPermissionsUpdate(t.state),t.onchange=function(t){c.default.infoMsg("notifications permission status has changed to "+t.target.state),e.sendPermissionsUpdate(t.target.state)}}))]:[3,2];case 1:return t.sent(),[3,3];case 2:c.default.warnMsg("notifications permission status is unknown"),this.sendPermissionsUpdate("unknown"),t.label=3;case 3:return[2]}}))}))},e.prototype.sendPermissionsUpdate=e.prototype.browserHasPermissionsAccess=e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64UrlToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),o=0;o<n.length;o+=1)r[o]=n.charCodeAt(o);return r}}])},84933:function(e,t,n){var r=n(45001),o=n(96291),i=n(67073),s=r.TypeError;e.exports=function(e){if(o(e))return e;throw s(i(e)+" is not a function")}},18209:29076:25528:72814:4905:5029:60650:13165:75489:20486:46810:50430:86034:11502:36009:16837:81368:70311:function(e,t,n){var r=n(19966);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},10566:74832:19966:42821:72089:29638:25061:95453:25494:99918:58483:63927:9873:70936:3425:26354:48437:53815:18327:45001:78382:92499:function(e){e.exports={}},53455:12118:17788:62901:685:50684:55557:96291:61814:91092:62366:20013:6448:98971:9200:80501:44821:43690:42673:99262:77650:37714:22275:56191:56462:8117:59219:72822:66282:23855:89749:49265:22848:45085:50379:62466:37040:47504:28791:86846:96313:41847:44847:5268:4764:21406:63069:64475:88506:53126:40606:61695:19982:6809:,63571,50189,38680,6971,40678,89398,74479,87615,76973,91030,68171,89284,67073,41050,37558,75780,57427,46802,92274,63045,42295,34994,11602},t={}n.n,n.d,n.g(),n.o,function(){"use strict";n(92274),n(63045),n(11602);var e=n(78959),t=n.n(e);n(42295),n(34994)!function(e,n){var o;e.behaviors.swrveNotifications={createInstance:(o(regeneratorRuntime.mark((function e(){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){gigya.accounts.getAccountInfo({callback:function(t){e(t.data)}})}));case 2:r=e.sent,o=r.hasOwnProperty("member_no")&&r.hasOwnProperty("membership_type"),r.hasOwnProperty("adobeprefcenterguid")&&""!==r.adobeprefcenterguid&&o&&(i=r.member_no,s=r.membership_type,i&&s&&"member"===s.replace(/\s+/g,"").toLowerCase())&&t().createInstance({appId:n.swrve.appId,apiKey:n.swrve.apiKey,externalUserId:r.adobeprefcenterguid,stack:"eu",autoPushSubscribe:!0});case 5:case"end":return e.stop()}var i,s}),e)}))))}}(Drupal,drupalSettings)}()}();