"use strict";(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[8641],{68641:function(t,e,n){n.r(e);var o=n(31240),a=n(49200),c=n(37311),i=n(2406),r=n.n(i),s=n(43800),d=n(16548),u=n(63210),l=n(95272),f=n(80589),_=n(27361),m=n.n(_),h=n(23279),p=n.n(h),v=n(26743),g=n(12196),C=n(98241),k=n.n(C),x=n(61918),y=n(45821),b=n(79137),S=n(47189),F="addcontacts",R="search",I="copy",A={dwSearch:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(0,b.Z)(F,{action:R,keyword:e,result:t?"success":"fail"})},dwLinkCopy:function(){(0,b.Z)(F,{action:I})}};r D=v.dateHelper.duration,O="SENDED_USERIDS",E=(0,x.Z)(),$={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-addRecommendContact"},[n("div",{class:["k-addRecommendContact__content",t.isContentAutoClass?"":"k-addRecommendContact__content-auto"]},[t.isAddRecommendContactSearchInput?n("div",{staticClass:"k-addRecommendContact__search-wrapper"},[n("KInputSearch",{staticClass:"k-addRecommendContact__search",attrs:{placeholder:t.lang_inputSearch,onClear:t.onSearchClear,onInput:t.onInput,maxlength:30,defaultValue:t.defaultPhone},nativeOn:{keydown:click:})],1):t._e(),t._v(" "),t.contacts.length>0?n("div",{staticClass:"k-addRecommendContact__tips"},[t._v("\n      "+t._s(t.searched?t.lang_searchRes:t.lang_searchCon)+"\n    ")]):t._e(),t._v(" "),t.isAddRecommendContactLatest?n("div",{class:["k-addRecommendContact__list",{"k-addRecommendContact__list--longer":t.contacts.length<=0}]},[t.loading?n("kLoading"):t.contacts.length?n("div",{staticClass:"k-addRecommendContact__list--exist"},t._l(t.contacts,(function(e){return n("div",{key:e.userid,staticClass:"k-addRecommendContact__list__item"},[n("div",{staticClass:"k-addRecommendContact__list__item__avatar"},[n("img",{attrs:{src:e.avatar}})]),t._v(" "),n("div",{staticClass:"k-addRecommendContact__list__item__name"},[t._v(t._s(e.name))]),t._v(" "),n("div",{class:["k-addRecommendContact__list__item__btn",{added:t.isDisable(e)}],on:{click:},[t._v("\n            "+t._s(t.getBtnText(e))+"\n          ")])])})),0):n("div",{staticClass:"k-addRecommendContact__list--empty"},[t.searched?n("div",{staticClass:"k-addRecommendContact__list--empty--searched"},[n("p",[t._v(t._s(t.lang_noFind))]),t._v(" "),n("p",[t._v(t._s(t.lang_copyAdd))])]):n("div",{staticClass:"k-addRecommendContact__list--empty--recommend"},[t.contentEmptyText?n("p",[t._v(t._s(t.contentEmptyText))]):[n("p",[t._v(t._s(t.lang_searchInvite)+" "),n("span",[t._v(t._s(t.lang_searchInvite1))]),t._v(" "+t._s(t.lang_searchInvite2))])]],2)])],1):t._e(),t._v(" "),t._t("inviteLink",[t.isAddContactByLink?n("div",{staticClass:"k-addRecommendContact__link"},[n("div",{staticClass:"k-addRecommendContact__link__icon"},[n("KIcon",{attrs:{type:"share-link"}})],1),t._v(" "),n("div",{staticClass:"k-addRecommendContact__link__text"},[n("p",[t._v(t._s(t.lang_inviteAdd))]),t._v(" "),t.source&&t.source.id?n("p",{attrs:{title:t.source.fname}},[t._v(t._s(t.lang_getLink)+t._s(t.expireDuration))]):n("p",[t._v(t._s(t.lang_inviteRoad))])]),t._v(" "),t.inviteLink?n("div",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.inviteLinkText,expression:"inviteLinkText"}],staticClass:"k-addRecommendContact__link__button--copy",on:{success:t.onCopySuccess,error:t.onCopyError,click:t.handleCopy}},[t._v(t._s(t.lang_copyLink))]):t._e()]):t._e()],{inviteLinkText:t.inviteLinkText,inviteLink:t.inviteLink,onCopySuccess:t.onCopySuccess,onCopyError:t.onCopyError,loading:t.loading})],2)])},staticRenderFns:[],name:"KAddRecommendContact",components:{KInputSearch:u.Z,KLoading:l.Z,KIcon:f.default},directives:{clipboard:s.B},props:{user:{type:Object,validator:function(t){return["userid"].every(()}},source:{type:Object,default:,addedCoopMembers:{type:Array,default:,linkSuffix:{type:String,default:""},onSendSuccess:{type:Function,default:function(){}},defaultPhone:{type:String,default:""},onLoad:{type:Function,default:function(){}},onLoadError:{type:Function,default:function(){}},onCopy:{type:Function,default:function(){}},onSearchClick:{type:Function,default:function(){}},onIndexSend:{type:Function,default:function(){}},onSearchSend:{type:Function,default:function(){}},onSearchEnd:{type:Function,default:function(){}},errorFn:{type:Function,default:function(){}},onContactInvitationPanelLoad:{type:Function,default:function(){}},onInvitationSuccessCallback:{type:Function,default:function(){}},onInvitationCancelCallback:{type:Function,default:function(){}},onUpdateLink:{type:Function,default:function(){}},doNotShowFeedback:{type:Boolean,default:!1},enableAddingContactLink:{type:Boolean,defaul:!0},placeholder:{type:[String,Number],default:""},noCorp:{type:Boolean,default:!1},builtInAddContact:{type:Boolean,default:!0}},data:function(){return{lang_inputSearch:this.placeholder||(0,y.t)("logic.AddRecommendContact.inputSearch"),lang_searchRes:(0,y.t)("logic.AddRecommendContact.searchRes"),lang_searchCon:(0,y.t)("logic.AddRecommendContact.searchCon"),lang_noFind:(0,y.t)("logic.AddRecommendContact.noFind"),lang_copyAdd:(0,y.t)("logic.AddRecommendContact.copyAdd"),lang_searchInvite:(0,y.t)("logic.AddRecommendContact.searchInvite"),lang_searchInvite1:(0,y.t)("logic.AddRecommendContact.searchInvite1"),lang_searchInvite2:(0,y.t)("logic.AddRecommendContact.searchInvite2"),lang_inviteAdd:(0,y.t)("logic.AddRecommendContact.inviteAdd"),lang_validLink:(0,y.t)("logic.AddRecommendContact.validLink"),lang_validLink1:(0,y.t)("logic.AddRecommendContact.validLink1"),lang_validLink2:(0,y.t)("logic.AddRecommendContact.validLink2"),lang_inviteRoad:(0,y.t)("logic.AddRecommendContact.inviteRoad"),lang_copyLink:(0,y.t)("logic.AddRecommendContact.copyLink"),lang_getLink:(0,y.t)("logic.AddRecommendContact.getLink"),loading:!0,editLink:{},contacts:[],searched:!1,inviteLink:"",userinfo:"",selectedMember:null,copyErrorMsg:"",$toast:keyword:""}},computed:{isAddContactByLink:function(){return!this.$__SHIELD_CONFIG__||this.$__SHIELD_CONFIG__.addContactByLink},isAddRecommendContactLatest:function(){return!this.$__SHIELD_CONFIG__||this.$__SHIELD_CONFIG__.componentAddRecommendContactLatest},isAddRecommendContactSearchInput:function(){return!this.$__SHIELD_CONFIG__||this.$__SHIELD_CONFIG__.UIAddRecommendContactSearchInput},isContentAutoClass:inviteLinkText:function(){var t=this.source&&this.source.fname;if(t){var e=(0,v.getFileIcon)(t);"otl"!==e&&"ksheet"!==e||(t=(0,v.subFileName)(t))}var n=this.copyErrorMsg?" ":"".concat(this.inviteLink,"\n");return n+=this.source.id&&!this.noCorp?"".concat((0,y.t)("logic.AddRecommendContact.inviteEdit")).concat((0,v.cutOffString)(t,8,20)).concat((0,y.t)("logic.AddRecommendContact.validLink2")):(0,y.t)("logic.AddRecommendContact.applyContact")},expireDuration:function(){return this.editLink?D(this.editLink.expired_at)+(0,y.t)("logic.AddRecommendContact.inner"):(0,y.t)("logic.AddRecommendContact.seInner")},searchMemberFrom:function(){return k()(this.keyword)?"mailbox":"phone"},contentEmptyText:”ç³»äºº"},featureSearchContact:function(){return!this.$__SHIELD_CONFIG__||!1!==this.$__SHIELD_CONFIG__.UIFeatureSearchContact}},mounted:function(){var t=this;return(0,c.Z)(r().mark((function e(){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.defaultPhone){e.next=5;break}return e.next=3,t.initData([t.onSearch.bind(t,t.defaultPhone),t.fetchInviteLink]);case 3:e.next=7;break;case 5:return e.next=7,t.initData();case 7:n={inviteContent:t.source.id&&!t.noCorp?(0,y.t)("logic.AddRecommendContact.validContac"):(0,y.t)("logic.AddRecommendContact.txt0"),userinfo:t.userinfo,link:t.editLink.link,callbackSuccess:t.onInvitationSuccess,callbackCancel:t.onInvitationCancel,errorFn:t.errorFn,doNotShowFeedback:t.doNotShowFeedback,onLoad:t.onContactInvitationPanelLoad},E.mount(t,n);case 9:case"end":return e.stop()}}),e)})))()},methods:w(w({},A),{},{cutOffString:v.cutOffString,getUserInfo:function(){var t=this;return(0,c.Z)(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.user,e.t0){e.next=5;break}return e.next=4,(0,S.XTJ)();case 4:e.t0=e.sent;case 5:t.userinfo=e.t0;case 6:case"end":return e.stop()}}),e)})))()},initData:function(t){var e=this;return(0,c.Z)(r().mark((function n(){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(t=t||[e.fetchRecommendContacts,e.fetchInviteLink]).push(e.getUserInfo),n.prev=2,e.loading=!0,n.next=6,Promise.aturn t()})));case 6:e.onLoad(e.contacts),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(2),"RateLimitedMinV2"===m()(n.t0,"response.data.result")?e.copyErrorMsg=n.t0.response.data.msg:e.onLoadError(n.t0);case 13:e.loading=!1;case 14:case"end":return n.stop()}}),n,null,[[2,9]])})))()},fetchRecommendContacts:function(){if(!this.isAddRecommendContactLatest)return[];this.contacts=[]},fetchInviteLink:function(){var t=this;return(0,c.Z)(r().mark((function e(){var n,o,a,c,i,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.source.id||t.noCorp){e.next=26;break}return e.prev=1,e.next=4,(0,S.DVf)(t.source.id,t.source.groupid);case 4:if(o=e.sent,a=o,c=(new Date).getTime(),!("close"===a.status||1e3*a.expired_at-c<=0)){e.next=15;break}return e.next=10,(0,S.tVb)(t.source.id,{status:"open"});case 10:i=e.sent,a=w(w({},a),i),n="".concat(a.elink_url),e.next=16;break;case 15:n="".concat(a.elink_url);case 16:t.editLink=a,t.onUpdateLink(),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(1),s=m()(e.t0,"response.data.msg"),d.Z.error(s||(0,y.t)("logic.AddRecommendContact.inviteFail"));case 24:e.next=30;break;case 26:return e.next=28,(0,S.M5n)({type:0});case 28:u=e.sent,n=u.res;case 30:t.inviteLink=n+t.linkSuffix;case 31:case"end":return e.stop()}}),e,null,[[1,20]])})))()},onSearch:function(t){var e=this;return(0,c.Z)(r().mark((function n(){var o,a;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=(o=t.target?t.target.value:t).replace(/(^\s*)|(\s*$)/g,""),k()(o)||(0,g.ZP)(o,"zh-CN")){n.next=4;break}return n.abrupt("return",d.Z.error((0,y.t)("logic.AddRecommendContact.correctMsg")));case 4:return e.searched=!0,e.loading=!0,n.prev=6,n.next=9,(0,S.tID)({params:{value:o}});case 9:a=n.sent,Object.assign(a,{name:a.nickname,userid:a.user_id}),e.contacts=[a],e.dwSearch(!0,o),n.next=18;break;case 15:n.prev=15,n.t0=n.catch(6),404===n.t0.response.status?e.contacts=[]:e.dwSearch(!1,o);case 18:e.onSearchEnd(e.contacts,{result:e.contacts.length?1:0,from:e.searchMemberFrom}),e.loading=!1;case 20:case"end":return n.stop()}}),n,null,[[6,15]])})))()},onSeitData()},onInput:p()((function(t,e){this.keyword=t,e||k()(t)&&/(com|cn|net)$/.test(t)&&this.onSearch(t)}),20erid===t},isDisable:function(t){var e=t.userid,n=t.add;return this.isSelf(e)||n||this.isSended(e)},isSended:function(t){return-1!==this.getStorage(this.userinfo.userid).indexOf(t)},getBtnText:function(t){var e=t.userid,n=t.add;return this.isSelf(e)?(0,y.t)("logic.AddRecommendContact.me"):n?(0,y.t)("logic.AddRecommendContact.add"):this.isSended(e)?(0,y.t)("logic.AddRecommendContact.send"):(0,y.t)("logic.AddRecommendContact.invite")},handleAddContact:function(t){this.source.id&&!this.noCorp?this.toAddCoop(t):this.addContact(t)},addContact:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.isDisable(t)||(this.selectedMember=t,this.searched?this.onSearchSend(this.contacts,{from:this.searchMemberFrom}):this.onIndexSend(this.contacts),this.builtInAddContact&&E&&E.show(this.selectedMember,e),this.$emit("addContact",this.selectedMember,e))},toAddCoop:function(t){this.isDisable(t)||(this.addedCoopMembers.ft.userid}))>-1?this.addContact(t):this.addContact(t,"addCoop"))},onInvitationSuccess:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.targetId;e.RelationAdded&&this.$set(this.contaerid===n})),"add",!0),this.setStorage(this.userinfo.userid,n),this.contacts=(0,o.Z)(this.contacts),this.selectedMember=null,this.onSendSuccess(t,e),this.onInvitationSuccessCallback(t,e)},onInvitatllback()},getStorage:function(t){try{return JSON.parse(sessionStorage.getItem("".concat(O,"_").concat(t))||"[]")}catch(t){}},setStorage:function(t,e,n){try{var o=this.getStorage(t);n?o.splice(o.frn t===e})),1):o.push(e),sessionStorage.setItem("".concat(O,"_").concat(t),JSON.stringify(o))}catch(t){}},onCopySuccess:function(){this.copyErrorMsg?d.Z.error(this.copyErrorMsg):d.Z.success((0,y.t)("logic.AddRecommendContact.copySucc")),this.onCopy(this.contacts),this.dwLinkCopy()},onyFail"))},handleCopy:function(){if(this.source.id)try{var t={fid:this.source.id,file_ver:this.source.fver,scene:2};(0,S.AV1)(t)}catch(t){this.$emit("requestError",t)}}}.name,$)}};e.default=$},53742:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),o||i<=o)};var o,a=(o=n(84512))&&o.__esModule?o:{d t},c(t)}t.exports=e.default,t.exports.default=e.default},98241:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if((0,o.default)(t),(e=(0,r.default)(e,d)).require_display_name||e.allow_display_name){var n=t.match(u);if(n){var s=n[1];if(t=t.replace(s,"").replace(/(^<|>$)/g,""),s.endsWith(" ")&&(s=s.slicreturn!0}(s))return!1}else if(e.require_display_name)return!1}if(!e.ignore_max_length&&t.length>254)return!1;var p=t.split("@"),v=p.pop(),g=v.toLowerCase();if(e.host_blacklist.includes(g))return!1;if(e.host_whitelist.length>0&&!e.host_whitelist.includes(g))return!1;var C=p.join("@");if(e.domain_specific_validation&&("gmail.com"===g||"googlemail.com"===g)){var k=(C=C.toLowerCase()).split("+")[0];if(!(0,a.default)(k.replace(/\./g,""),{min:6,max:30}))return!1;for(var x=k.split("."),y=0;y<x.length;y++)if(!f.test(x[y]))return!1}if(!(!1!==e.ignore_max_length||(0,a.default)(C,{max:64})&&(0,a.default)(v,{max:254})))return!1;if(!(0,c.default)(v,{require_tld:e.require_tld,ignore_max_length:e.ignore_max_length,allow_underscores:e.allow_underscores})){if(!e.allow_ip_domain)return!1;if(!(0,i.default)(v)){if(!v.startsWith("[")||!v.endsWith("]"))return!1;var b=v.slice(1,-1);if(0===b.length||!(0,i.default)(b))return!1}}if('"'===C[0])return C=C.slice(1,C.length-1),e.allow_utf8_local_part?h.test(C):_.test(C);for(var S=e.allow_utf8_local_part?m:l,F=C.split("."),R=0;R<F.length;R++)if(!S.test(F[R]))return!1;if(e.blacklisted_chars&&-1!==C.search(new RegExp("[".concat(e.blacklisted_chars,"]+"),"g")))return!1;return!0};var o=s(n(84512)),a=s(n(53742)),c=s(n(82845)),i=s(n(45413)),r=s(n(75303));function s(t){return t&&t.__esModule?t:{default:t}}var d={allow_display_name:!1,allow_underscores:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0,blacklisted_chars:"",ignore_max_length:!1,host_blacklist:[],host_whitelist:[]},u=/^([^\x00-\x1F\x7F-\x9F\cX]+)</i,l=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,f=/^[a-z\d]+$/,_=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,m=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A1-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,h=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i;t.exports=e.default,t.exports.default=e.default},82845:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),)))))}))};var o=c(n(84512)),a=c(fault:t}}var i={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1,ignore_max_length:!1};t.exports=e.default,t.exports.default=e.default},45413:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),return!1};var o,a=(o=n(84512))&&o.__esModule?o:{default:o};var c="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",i="(".concat(c,"[.]){3}").concat(c),r=new RegExp("^".concat(i,"$")),s="(?:[0-9a-fA-F]{1,4})",d=new RegExp("^("+"(?:".concat(s,":){7}(?:").concat(s,"|:)|")+"(?:".concat(s,":){6}(?:").concat(i,"|:").concat(s,"|:)|")+"(?:".concat(s,":){5}(?::").concat(i,"|(:").concat(s,"){1,2}|:)|")+"(?:".concat(s,":){4}(?:(:").concat(s,"){0,1}:").concat(i,"|(:").concat(s,"){1,3}|:)|")+"(?:".concat(s,":){3}(?:(:").concat(s,"){0,2}:").concat(i,"|(:").concat(s,"){1,4}|:)|")+"(?:".concat(s,":){2}(?:(:").concat(s,"){0,3}:").concat(i,"|(:").concat(s,"){1,5}|:)|")+"(?:".concat(s,":){1}(?:(:").concat(s,"){0,4}:").concat(i,"|(:").concat(s,"){1,6}|:)|")+"(?::((?::".concat(s,"){0,5}:").concat(i,"|(?::").concat(s,"){1,7}|:))")+")(%[0-9a-zA-Z-.:]{1,})?$");t.exports=e.default,t.exports.default=e.defau.default}}]);
