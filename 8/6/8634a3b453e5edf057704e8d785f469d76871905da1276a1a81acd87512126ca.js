/*! For license information please see 684.edd271e2ea5233b398b5.chunk.v7.js.LICENSE.txt */
(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[684],{"05Uz":function(e,t,r){"use strict";(function(e){r.d(t,"m",(function(){return g})),r.d(t,"l",(function(){return m})),r.d(t,"a",(function(){return b})),r.d(t,"f",(function(){return v})),r.d(t,"i",(function(){return y})),r.d(t,"d",(function(){return S})),r.d(t,"h",(function(){return E})),r.d(t,"e",(function(){return _})),r.d(t,"b",(function(){return C})),r.d(t,"c",(function(){return w})),r.d(t,"g",(function(){return T})),r.d(t,"k",(function(){return j})),r.d(t,"j",(function(){return k})),r.d(t,"n",(function(){return R}));var n=r("75Dz"),o=r("UsZI"),i=r("ZTn1"),s=r("n3ZG"),a=r("eb2x"),c=r("KMDl"),d=r("qDpI"),l=r("O27a"),h=r.n(l),u=r("QD8S");const p=f=new RegExp(/^((?!-)[A-Za-z0-9-]{1,62}((?!-)[A-Za-z0-9])\.)+[A-Za-z]{2,6}$/);function g(e){return Object(d.l)(c.c,"isValidOdspUrl",(()=>{let t=!1;try{new URL(e),t=!0}catch(e){}return c.c.logVerbose("isValidOdspUrl","Returns",{odspUrl:e,isValid:t}),t}))}function m(e){return Object(d.l)(c.c,"isValidDomain",(()=>f.test(e)))}function b(e,t,r){return Object(d.l)(c.c,"generateOdspCreateContainerRequest",(()=>{const o={url:`${e.origin}?driveId=${encodeURIComponent(r)}&path=${e.pathname}`,headers:{[n.a.createNew]:{fileName:t}}};return c.c.logVerbose("generateOdspCreateContainerRequest","Returning Request",{driveId:r}),o}))}async function v(e,t,r,n,o){return Object(d.m)(c.c,"getDriveItem",(async()=>{const i=encodeURIComponent(o);return y(e,`https://${e}/_api/v2.1/drives/${i}/root:${t}:`,r,n)}))}async function y(e,t,r,n){return Object(d.m)(c.c,"getDriveItemFromUrl",(async()=>{const o={accessToken:await r(e),refreshTokenFn:()=>n(e)},s=await D(t,o,"OpenFile_MFS");if(404===s.status)throw i.a.fileNotFound();if(200!==s.status)throw i.a.cannotGetDriveItemFromUrl(t);return O(await s.json())}))}function O(e){return Object(d.l)(c.c,"toIODSPDriveItem",(()=>(function(e){const t=[];if(!e)throw i.a.invalidDriveItemInfo("drive item response");if(e.id||t.push("itemId"),e.parentReference&&e.parentReference.driveId||t.push("driveId"),t.length>0)throw i.a.invalidDriveItemInfo(t)}(e),{path:e.parentReference.path?e.parentReference.path.split("root:")[1]:"/",name:e.name,driveId:e.parentReference.driveId,itemId:e.id,isFolder:!!e.folder})))}async function S(e,t,r){return Object(d.m)(c.c,"getAppsSpecialFolderAsDriveItem",(async()=>y(e,`https://${e}/_api/v2.1/drive/special/apps`,t,r)))}async function E(t,r,n,o){return Object(d.m)(c.c,"getDriveItemFromSharingURL",(async()=>{const s={accessToken:await n(t),refreshTokenFn:()=>o(t)},a="u!"+function(e,t){return Object(d.l)(c.c,"trimChar",(()=>e&&0!=e.length?("="==e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),c.c.logVerbose("trimChar","Returning updated input"),e):(c.c.logVerbose("trimChar","Input is undefined or has length 0"),e)))}(e.from(r).toString("base64")).replace("/","_").replace("+","-"),l=`https://${t}/_api/v2.0/shares/${a}/driveItem`;c.c.logVerbose("getDriveItemFromSharingURL","Getting drive item from url");const h=await D(l,s,"OpenFile_MFS"),u=await h.json();if(!u||!u.parentReference)throw i.a.invalidSharingURL(r);const p={driveId:u.parentReference.driveId,itemId:u.id};return c.c.logVerbose("getDriveItemFromSharingURL",`itemId: ${u.id}`),p}))}async function _(e,t,r){return Object(d.l)(c.c,"getDriveIdForDomain",(async()=>{const n={accessToken:await t(e),refreshTokenFn:()=>r(e)},o=`https://${e}/_api/v2.1/drive?select=id`,s=await D(o,n,"OpenFile_MFS");if(200!==s.status)throw i.a.cannotGetDriveId(o);const a=await s.json();if(!a||!a.id)throw i.a.cannotGetDriveId(o);return a.id}))}async function C(e,t,r,n,o){return Object(d.l)(c.c,"getAllPodFilesWithinFolder",(async()=>{c.c.logVerbose("getAllPodFilesWithinFolder","Getting folder",{domain:e,folderPath:t,driveId:o});const s=await v(e,t,r,n,o);if(!s.isFolder)throw i.a.driveItemInvalidFolder();c.c.logVerbose("getAllPodFilesWithinFolder","Getting children",{parentId:s.itemId,isFolder:s.isFolder});const a=(await async function(e,t,r){return Object(d.l)(c.c,"getChildrenByDriveItem",(async()=>{if(!e.isFolder)return[];let n=`https://${t}/_api/v2.1/drives/${e.driveId}/items/${e.itemId}/children`,o=[];do{const e=await D(n,r,"OpenFile_MFS");if(200!==e.status)throw i.a.cannotGetDriveItemChildren(n);const t=await e.json();o=o.concat(t.value),n=t["@odata.nextLink"]}while(n);return o.map(O)}))}(s,e,{accessToken:await r(e),refreshTokenFn:()=>n(e)})).filter(();return c.c.logVerbose("getAllPodFilesWithinFolder",`Found ${a.length} files`,{podFiles:a.map(()}),a}))}function w(e){return Object(d.l)(c.c,"getAppIdHash",(()=>{const t=Object(a.sha256)(e);return c.c.logVerbose("getAppIdHash","generated",{hash:t}),t}))}async function T(e,t,r,n,o){return Object(d.m)(c.c,"getDriveItemFromDriveItemId",(async()=>(c.c.logVerbose("getDriveItemFromDriveItemId","Getting drive item",{domain:e,driveItemId:r,driveId:t}),y(e,`https://${e}/_api/v2.1/drives/${t}/items/${r}`,n,o))))}function I(e){return Object(d.l)(c.c,"isOdspFileVersion",(()=>"object"==typeof e&&null!==e&&"id"in e&&"lastModifiedDateTime"in e))}sync function k(e,t,r,n,o){return Object(d.m)(c.c,"getFileVersions",(async()=>{const i=`https://${e}/_api/v2.0/drives/${t}/items/${r}/versions`;c.c.logVerbose("getFileVersions","Enter",{domain:e,driveId:t,itemId:r,versionsUrl:"https://###/_api/v2.0/drives/###/items/${itemId}/versions"});const a={accessToken:await n(e),refreshTokenFn:()=>o(e)},l=await D(i,a,"RestoreFile_MFS");if(200!==l.status)return c.c.logVerbose("getFileVersions","Exit - request failed",{statusCode:l.status,domain:e,driveId:t,itemId:r}),s.l.fail(new Error("Error getting file versions"));const h=await l.json();if(function(e){return Object(d.l)(c.c,"isOdspFileVersionsResponse",(()=>"object"==typeof e&&null!==e&&"value"in e&&function(e,t){return Object(d.l)(c.c,"isArrayOfType",(()=>e.length>0&&!e.some(()))}(null==e?void 0:e.value,I)))}(h)){const e=h.value.sort(();return c.c.logVerbose("getFileVersions","Success",{versions:e}),s.l.ok(e)}return c.c.logVerbose("getFileVersions","Exit - unexpected response object",{responseObject:h}),s.l.fail(new Error("Failed parsing get file versions response"))}))}async function R(e,t,r,n,o,i){return Object(d.m)(c.c,"restoreFileVersion",(async()=>{if(!n)return s.l.fail(new Error("Invalid versionId"));const a={accessToken:await o(e),refreshTokenFn:()=>i(e)},d=`https://${e}/_api/v2.0/drives/${t}/items/${r}/versions/${n.id}/restoreVersion`;c.c.logVerbose("restoreFileVersion","Begin restore",{versionUrl:"https://###/_api/v2.0/drives/###/items/${itemId}/versions/${fileVersion.id}/restoreVersion"});const l=await async function(e,t,r,n){return A(r,"RestoreFile_MFS",(async t=>{const r={...t,body:"",method:"POST"};return p(e,r)}))}(d,0,a);return 204!==l.status?(c.c.logVerbose("restoreFileVersion","Fail",{response:l}),s.l.fail(new Error("Failure restoring file version"))):(c.c.logVerbose("restoreFileVersion","Success",{fileVersion:n}),s.l.ok())}))}async function D(e,t,r){return A(t,r,()}async function A(e,t,r){return Object(o.a)(e,(async e=>{const n={...e,headers:{...e.headers,Application:"MFSData",Scenario:t,ScenarioType:"AUO"}};return async function(e){var t;let r;try{r=await e()}catch(e){if(!(null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.status))throw e;r=e.response}return r}(()}))}}).call(this,r("zkTx").Buffer)},"1Z3m":function(e,t,r){"use strict";var n,o;r.d(t,"a",(function(){return o})),function(e){e.isSharingLinkToRedeem="isSharingLinkToRedeem"}(n||(n={})),o||(o={}))},"2IM6":function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return f}));var n=r("O9x+"),o=r("Unhj");const i=new n.a((),s={getRawConfig:,a=e=>null!=e?new h(void 0,{getRawConfig:t=>{var r,n;try{return null===(n=d(null!==(r=e.getItem(t))&&void 0!==r?r:void 0))||void 0===n?void 0:n.raw}catch(e){}}}):s;unction d(e){let t,r=e;if("string"==typeof e)try{r=JSON.parse(e),t={raw:e,string:e}}catch(e){}if(void 0===r)return t;const n=typeof r;if(c(n))return Object.assign(Object.assign({},t),{raw:e,[n]:r});if(Array.isArray(r)){const n=typeof r[0];if(!c(n))return t;for(const e of r)if(typeof e!==n)return t;return Object.assign(Object.assign({},t),{raw:e,[`${n}[]`]:r})}return t}const l=()=>{var e;try{return null!==(e=globalThis.sessionStorage)&&void 0!==e?e:void 0}catch(e){return}};class h{constructor(e){this.logger=e,this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set;for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];const i=[...n];for(;i.length>0;){const e=i.shift();void 0!==e&&g(e)&&!t.has(e)&&(t.add(e),e instanceof h?i.push(...e.orderedBaseProviders):this.orderedBaseProviders.push(e))}}getBoolean(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}getNumber(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}getString(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}getBooleanArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}getNumberArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}getStringArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}etCacheEntry(e){var t;if(!this.configCache.has(e)){for(const r of this.orderedBaseProviders){const n=d(null==r?void 0:r.getRawConfig(e));if(void 0!==n)return this.configCache.set(e,n),null===(t=this.logger)||void 0===t||t.send({category:"generic",eventName:"ConfigRead",configName:{tag:o.c.CodeArtifact,value:e},configValue:{tag:o.c.CodeArtifact,value:JSON.stringify(n)}}),n}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function u(e){const t=e;return g(null==t?void 0:t.config)&&void 0!==(null==t?void 0:t.logger)}function p(e){return u(e)?e:f(e,i.value)}function f(e){if(u(e))throw new Error("Logger is already a monitoring context");const t=e;for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return t.config=new h(e,...n),t.logger=e,t},"2qH7":function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"c",();const n=e=>"function"==typeof(null==e?void 0:e.getTelemetryProperties)&&"function"==typeof(null==e?void 0:e.addTelemetryProperties),o=e=>"string"==typeof(null==e?void 0:e.errorInstanceId);function i(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&o(e)&&n(e)}function s(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&n(e)}},"75Dz":"8/K7":function(e,t){.exports=r,r.prototype.reset=r.prototype.stop=r.prototype.retry=r.prototype.attempt=r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=,DX81:EdNJ:Fen9:function(e,t,r){"use strict";(function(r){var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response}).call(this,r("pCvA"))},FiVw:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n="2.0.0-internal.4.3.0"},GmCu:Io9h:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0,t.default=["change","keydown","mousedown","mousemove","mouseup","orientationchange","resize","scroll","touchend","touchmove","touchstart","visibilitychange"]},KMDl:function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s}));var n=r("qDpI");const o=n.e.getInstance().getMfsLogger("loader"),i=Object(n.j)(o),s=Object(n.k)(o)},KSUX:KqdK:function(e,t,r){"use strict";unction o(e){let t="_api/";return n(e)&&(t=""),`${e}/${t}v2.1`}r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return o}))},LZKY:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("he5V");class o{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{const e=this.tasks.shift();if(void 0!==e)return e();this.maxRequests++},Object(n.a)(e>0,174)}get waitQueueLength(){return this.tasks.length}async acquire(){if(!(this.maxRequests>0))return new Promise(();this.maxRequests--}async schedule(e){return await this.acquire(),e().finally(this.release)}}},O27a:QD8S:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return l})),r.d(t,"b",(function(){return h}));var n,o=r("O27a"),i=r.n(o),s=r("EdNJ"),a=r("qDpI"),c=r("KMDl"),d=r("05Uz");async function l(e,t,r,o){return Object(a.m)(c.c,"getUserPushChannelInfo",(async()=>{try{const n=await e(),i=function(e,t){return Object(a.l)(c.c,"getPushChannelInfoUrl",(()=>{const r=f(t),n=`https://${r}/pushchannel/info?skipOneDriveDomain=${e}`;return c.c.logVerbose("getPushChannelInfoUrl","Returning pushchannel info URL",{mfsServiceDomain:r,url:n}),n}))}(r,o),s=await p(n,i,t);if(s.ok){const e=await s.json();return c.c.logVerbose("getUserPushChannelInfo","Success"),{pushChannelInfo:e,success:!0}}{const e=`Encountered error when getting PushChannelInfo from Mfs Service: ${s.status} ${s.statusText}`;return c.c.logVerbose("getUserPushChannelInfo",e),{success:!1,error:{message:e,errorCategory:await u(s)}}}}catch(e){const t=`Failed to get user PushChannelInfo response: ${e}`;return c.c.logVerbose("getUserPushChannelInfo",t),{success:!1,error:{message:t,errorCategory:n.Generic}}}}))}async function h(e,t,r){return Object(a.m)(c.c,"getClientConfig",(async()=>{try{const n=await e(),o=`https://${f(r)}/pushchannel/clientconfig`,i=await p(n,o,t);if(i.ok){const e=await i.json();return c.c.logVerbose("getClientConfig","Client config successfully retrieved"),{clientConfig:e,success:!0}}{const e=`Encountered error when getting ClientConfig from Mfs Service: ${i.status} ${i.statusText}`;return c.c.logVerbose("getClientConfig",e),{success:!1,error:{message:e,errorCategory:await u(i)}}}}catch(e){const t=`Failed to get user ClientConfig response: ${e}`;return c.c.logVerbose("getClientConfig",t),{success:!1,error:{message:t,errorCategory:n.Generic}}}}))}async function u(e){const t=await async function(e){try{return(await e.json()).error.code}catch(e){return n.Generic}}(e);return Object(d.k)(t)?t:n.Generic}async function p(e,t,r){return Object(a.m)(c.c,"callMfsService",(async()=>{if(a.d){c.c.logVerbose("callMfsService","In Browser environment",{sessionId:r});const n=new Headers;return n.append("Authorization",`Bearer ${e}`),n.append("SessionId",r),function(e,t){return Object(a.m)(c.c,"fetchWithRetry",(async()=>new Promise(((r,n)=>{const o=s.operation({retries:3,minTimeout:1e3});o.attempt((async s=>{try{let n;if(n=a.d?await window.fetch(e,t):await i.a(e,t),c.c.logVerbose("fetchWithRetry",`Response obtained with status code ${n.status} in ${a.d?"browser":"node"} environment`),s<=3&&(429===n.status||503===n.status||509===n.status))return c.c.logVerbose("fetchWithRetry","Retrying",{status:n.status,currentAttempt:s}),void o.retry(new Error(n.statusText));c.c.logVerbose("fetchWithRetry","Success",{status:n.status}),r(n)}catch(e){o.stop(),c.c.logVerbose("fetchWithRetry","Failed",{error:e}),n(e)}}))}))))}(t,{method:"GET",headers:n})}{c.c.logVerbose("callMfsService","In NodeJs environment",{sessionId:r,apiUrl:t});const n=new o.Headers;return n.append("Authorization",`Bearer ${e}`),n.append("SessionId",r),await i.a(t,{method:"GET",headers:n})}}))}function f(e){return Object(a.l)(c.c,"getMfsServiceDomain",(()=>{let t=function(e,t){return Object(a.l)(c.c,"getDomain",(()=>{const e=(null==(t=null==t?void 0:t.trim())?void 0:t.length)?t:"api.mfs.microsoft.com";return c.c.logVerbose("getDomain","Returns",{domain:e}),e}))}(0,e);c.c.logVerbose("getMfsServiceDomain","Domain retrieved",{specifiedDomain:e,domain:t});try{if(null===window||void 0===window?void 0:window.sessionStorage){const e=window.sessionStorage.getItem("MfsServiceDomain");e&&(t=e)}}catch(e){c.c.logVerbose("getMfsServiceDomain","Session storage not found",{error:e})}return t}))}!function(e){e.NoValidOneDriveLicense="NoValidOneDriveLicense",e.UserOneDriveNotProvisioned="UserOneDriveNotProvisioned",e.Generic="Generic"}(n||(n={}))},Qkn4:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r("rK/e"),o=r("gaGA"),i=r("1bkS"),s=r("V0Op"),a=r("SuZ0");async function c(e,t,r,c){var d;let l=1e3;const h=n.a.now();let u;for(let p=1;;p++){void 0!==c&&c();try{const o=await e();return p>1&&r.sendTelemetryEvent({eventName:"MultipleRetries",callName:t,attempts:p,duration:n.a.now()-h},u),o}catch(e){const c=Object(i.j)(e),f=!0===(null==e?void 0:e[a.a]),g=(null==e?void 0:e.errorType)===s.a.serviceReadOnly;if(1===p&&r.sendTelemetryEvent({eventName:`${t}_firstFailed`,callName:t,attempts:p,duration:n.a.now()-h},e),!f&&!g||!c)throw e;if(5===p)throw r.sendErrorEvent({eventName:f?"CoherencyErrorTooManyRetries":"ServiceReadonlyErrorTooManyRetries",callName:t,attempts:p,duration:n.a.now()-h},e),e.canRetry=!1,e;l=null!==(d=Object(i.m)(e))&&void 0!==d?d:l,await Object(o.a)(Math.floor(l)),l+=l/4*(1+Math.random()),u=e}}}},SuZ0:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return O}));var n=r("A3AF"),o=r("he5V"),i=r("NsUA"),s=r("LZKY"),a=r("1bkS"),c=r("mwlv"),d=r("DX81"),l=r("2IM6"),h=r("2qH7"),u=r("zQYL"),p=r("Unhj"),f=r("hpQ0"),g=r("GmCu"),m=r("1Z3m"),b=r("FiVw");const v="Odsp409Error";class y extends class{constructor(e,t,r,o){this.cache=e,this.fileEntry=t,this.logger=r,this.clientIsSummarizer=o,this.driverId=Object(n.a)(),this.networkCallNumber=1,this.rateLimiter=new s.a(24),this.snapshotCacheExpiryTimeoutMs=Object(l.c)(r).config.getBoolean("Fluid.Driver.Odsp.TestOverride.DisableSnapshotCache")?0:1728e5}setEpoch(e,t,r){Object(o.a)(void 0===this._fluidEpoch,475),this._fluidEpoch=e,this.logger.sendTelemetryEvent({eventName:"EpochLearnedFirstTime",epoch:e,fetchType:r,fromCache:t})}async get(e){var t;try{const r=await this.cache.get(this.fileEntryFromEntry(e));if(void 0===r||r.version!==g.a)return;if(Object(o.a)(void 0!==r.fluidEpoch,476),void 0===this._fluidEpoch)this.setEpoch(r.fluidEpoch,!0,"cache");else if(this._fluidEpoch!==r.fluidEpoch)return;if(e.type===c.b){const e=null===(t=r.value)||void 0===t?void 0:t.cacheEntryTime,n=Date.now();if(void 0===e||n-e>=this.snapshotCacheExpiryTimeoutMs)return this.logger.sendTelemetryEvent({eventName:"odspVersionsCacheExpired",duration:n-e,maxCacheAgeMs:this.snapshotCacheExpiryTimeoutMs}),void await this.removeEntries()}return r.value}catch(t){return void this.logger.sendErrorEvent({eventName:"cacheFetchError",type:e.type},t)}}async put(e,t){var r;Object(o.a)(void 0!==this._fluidEpoch,477),e.type===c.b&&(t.cacheEntryTime=null!==(r=t.cacheEntryTime)&&void 0!==r?r:Date.now());const n={value:t,version:g.a,fluidEpoch:this._fluidEpoch};return this.cache.put(this.fileEntryFromEntry(e),n).catch((t=>{throw this.logger.sendErrorEvent({eventName:"cachePutError",type:e.type},t),t}))}async removeEntries(){try{return await this.cache.removeEntries(this.fileEntry)}catch(e){this.logger.sendErrorEvent({eventName:"removeCacheEntries"},e)}}get fluidEpoch(){return this._fluidEpoch}async validateEpoch(e,t){Object(o.a)(void 0!==e,1412);try{this.validateEpochFromResponse(e,t)}catch(r){throw await this.checkForEpochError(r,e,t),r}}async fetchAndParseAsJSON(e,t,r){return this.fetchCore(e,t,f.d,r,arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4?arguments[4]:void 0)}async fetch(e,t,r){return this.fetchCore(e,t,f.f,r,arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4?arguments[4]:void 0)}async fetchCore(e,t,r,n){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i=this.formatClientCorrelationId(arguments.length>5?arguments[5]:void 0);let s;return this.addEpochInRequest(t,o,i),this.rateLimiter.schedule(().then((e=>(s=e.headers.get("x-fluid-epoch"),this.validateEpochFromResponse(s,n),e.propsToLog.XRequestStatsHeader=i,e))).catch((async e=>{throw void 0===s&&(s=e.serverEpoch),await this.checkForEpochError(e,s,n),e})).catch((e=>{if(Object(h.b)(e)&&e.errorType===d.a.fileNotFoundOrAccessDeniedError){const t=e.redirectLocation;if(void 0!==t){const r=function(e,t){const r=Object.assign({},Object(f.g)(e)),n=`${new URL(t).origin}${new URL(r.siteUrl).pathname}`;return r.siteUrl=n,r}(this.fileEntry.resolvedUrl,t),n=new a.d(e.message,r,{driverVersion:b.a,redirectLocation:t});throw n.addTelemetryProperties(e.getTelemetryProperties()),n}}throw e})).catch((e=>{throw Object(u.g)(e,{props:{XRequestStatsHeader:i}})}))}async fetchArray(e,t,r){return this.fetchCore(e,t,f.e,r,arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4?arguments[4]:void 0)}addEpochInRequest(e,t,r){const n=Object(f.g)(this.fileEntry.resolvedUrl).isClpCompliantApp;if(t){const t={};t["X-RequestStats"]=r,void 0!==this.fluidEpoch&&(t["x-fluid-epoch"]=this.fluidEpoch),n&&(t[m.a.isClpCompliantApp]=n.toString()),this.addParamInBody(e,t)}else{const t=(t,r)=>{e.headers=Object.assign({},e.headers),Object(o.a)(void 0!==e.headers,642),e.headers[t]=r};t("X-RequestStats",r),void 0!==this.fluidEpoch&&t("x-fluid-epoch",this.fluidEpoch),n&&t(m.a.isClpCompliantApp,n.toString())}}addParamInBody(e,t){const r=e.body;Object(o.a)("string"==typeof r,541);const n=r.split("\r\n"),i=n.shift();Object(o.a)(!0===(null==i?void 0:i.startsWith("--")),542);const s=[i];Object.entries(t).forEach((e=>{let[t,r]=e;s.push(`${t}: ${r}`)})),n.forEach((e=>{s.push(e)})),e.body=s.join("\r\n")}formatClientCorrelationId(e){const t=[`driverId=${this.driverId}`,"RequestNumber="+this.networkCallNumber++,`driverVersion=${b.a}`,`isSummarizer=${this.clientIsSummarizer}`];return void 0!==e&&t.push(`fetchReason=${e}`),t.join(", ")}validateEpochFromResponse(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.checkForEpochErrorCore(e);if(void 0!==n)throw n;void 0!==e&&void 0===this._fluidEpoch&&this.setEpoch(e,r,t)}async checkForEpochError(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Object(h.b)(e)&&e.errorType===d.a.fileOverwrittenInStorage){const o=this.checkForEpochErrorCore(t);if(void 0!==o)throw o.addTelemetryProperties({fromCache:n,fetchType:r}),this.logger.sendErrorEvent({eventName:"fileOverwrittenInStorage"},o),await this.removeEntries(),o;throw new a.i(`Coherency 409: ${e.message}`,1,{[v]:!0,driverVersion:b.a})}}checkForEpochErrorCore(e){if(this.fluidEpoch&&e&&this.fluidEpoch!==e)return new a.f("Epoch mismatch",d.a.fileOverwrittenInStorage,{driverVersion:b.a,serverEpoch:e,clientEpoch:this.fluidEpoch})}fileEntryFromEntry(e){return Object.assign(Object.assign({},e),{file:this.fileEntry})}}{constructor(e,t,r,n){super(e,t,r,n),this.cache=e,this.fileEntry=t,this.logger=r,this.clientIsSummarizer=n,this.treesLatestDeferral=new i.a,this.treesLatestDeferral.promise.catch((()=>{}))}validateEpochFromResponse(e,t){super.validateEpochFromResponse(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.treesLatestDeferral.resolve()}async get(e){let t=super.get(e);return e.type===c.b&&(t=t.then((e=>(void 0!==e&&this.treesLatestDeferral.resolve(),e))).catch(()),t}async fetchAndParseAsJSON(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0;const i=this.treesLatestDeferral.isCompleted;try{return await super.fetchAndParseAsJSON(e,t,r,n,o)}catch(e){if("treesLatest"===r&&this.treesLatestDeferral.reject(e),"joinSession"!==r||e.statusCode<401||e.statusCode>404||i)throw e}return await p.b.timedExecAsync(this.logger,{eventName:"JoinSessionSyncWait"},(async e=>{let t;const r=new Promise((e=>{t=setTimeout((,15e3)}));51===await Promise.race([r,this.treesLatestDeferral.promise.finally((()=>clearTimeout(t)))])&&e.cancel()}),{start:!0,end:!0,cancel:"generic"}),super.fetchAndParseAsJSON(e,t,r,n)}}function O(e,t,r,n,o){const i=new y(e,r,n,o);return{cache:Object.assign(Object.assign({},t),{persistedCache:i}),epochTracker:i}}},Tvsg:function(e,t,r){"use strict";function n(e,t,r){if(!t||0===t.length)return{url:e,headers:{}};if(!r){const r=new URL(e);if(r.searchParams.set("access_token",t),r.search.length<=2048)return{headers:{},url:r.href}}return{headers:{Authorization:`Bearer ${t}`},url:e}}r.d(t,"a",(function(){return n}))},Unhj:function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return a})),r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return d}));var n,o=r("rK/e"),i=r("2IM6"),s=r("zQYL");!function(e){e.CodeArtifact="CodeArtifact",e.UserData="UserData"}(n||(n={}));class a{constructor(e,t){this.namespace=e,this.properties=t}static formatTick(e){return Math.floor(e)}static numberFromString(e){if(null==e)return;const t=Number(e);return Number.isNaN(t)?e:t}static sanitizePkgName(e){return e.replace("@","").replace("/","-")}static prepareErrorObject(e,t,r){const{message:n,errorType:o,stack:i}=Object(s.b)(t,!0);if(e.stack=i,e.error=n,e.errorType=o,Object(s.e)(t)){const r=t.getTelemetryProperties();for(const t of Object.keys(r))void 0===e[t]&&(e[t]=r[t])}void 0===e.stack&&r&&(e.stack=Object(s.c)())}sendTelemetryEvent(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"generic"}),t)}sendTelemetryEventCore(e,t){const r=function(e){var{category:t,eventName:r}=e,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}(e,["category","eventName"]);const o={category:t,eventName:r};for(const e of Object.keys(n))o[e]=h(n[e]);return o}(e);void 0!==t&&a.prepareErrorObject(r,t,!1),"number"==typeof r.duration&&(r.duration=a.formatTick(r.duration)),this.send(r)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var r;const n=Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"performance"});this.sendTelemetryEventCore(n,t)}prepareEvent(e){const t="error"===e.category||void 0!==e.error,r=Object.assign({},e);if(void 0!==this.namespace&&(r.eventName=`${this.namespace}${a.eventNamespaceSeparator}${r.eventName}`),this.properties){const n=[];n.push(this.properties.all),t&&n.push(this.properties.error);for(const t of n)if(void 0!==t)for(const n of Object.keys(t)){if(void 0!==e[n])continue;const o=t[n],i="function"==typeof o?o():o;void 0!==i&&(r[n]=i)}}return r}}a.eventNamespaceSeparator=":";class c extends a{constructor(e,t,r){super(t,r),this.baseLogger=e,Object(i.b)(e)&&Object(i.d)(this,new i.a(this,e.config))}static create(e,t,r){if(e instanceof c){const n={};for(const t of[e.properties,r])void 0!==t&&(void 0!==t.all&&(n.all=Object.assign(Object.assign({},n.all),t.all)),void 0!==t.error&&(n.error=Object.assign(Object.assign({},n.error),t.error)));return new c(e.baseLogger,void 0===e.namespace?t:void 0===t?e.namespace:`${e.namespace}${a.eventNamespaceSeparator}${t}`,n)}return new c(e||new l,t,r)}send(e){this.baseLogger.send(this.prepareEvent(e))}}class d{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{end:!0,cancel:"generic"};var n;this.logger=e,this.markers=r,this.startTime=o.a.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),"object"==typeof window&&null!=window&&(null===(n=window.performance)||void 0===n?void 0:n.mark)&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}tatic timedExec(e,t,r,n){const o=d.start(e,t,n);try{const e=r(o);return o.autoEnd(),e}catch(e){throw o.cancel(void 0,e),e}}static async timedExecAsync(e,t,r,n){const o=d.start(e,t,n);try{const e=await r(o);return o.autoEnd(),e}catch(e){throw o.cancel(void 0,e),e}}eportProgress(e){this.reportEvent(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"update",e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){const e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){void 0!==this.markers.cancel&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,r){if(!this.event)return;const n=Object.assign(Object.assign({},this.event),t);n.eventName=`${n.eventName}_${e}`,"start"!==e&&(n.duration=this.duration),this.logger.sendPerformanceEvent(n,r)}}class l{send(e){}}function h(e){return Object(s.f)(e)?{value:u(e.value),tag:e.tag}:u(e)}function u(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return e;case"object":return JSON.stringify(e);default:return console.error(`convertToBasePropertyTypeUntagged: INVALID PROPERTY (typed as ${typeof e})`),`INVALID PROPERTY (typed as ${typeof e})`}}},UsZI:function(e,t,r){"use strict";async function n(e,t){const r=e=>({headers:{Authorization:`Bearer ${e}`}}),n=await t(r(e.accessToken));return!e.refreshTokenFn||401!==n.status&&403!==n.status?n:t(r(await e.refreshTokenFn()))}r.d(t,"a",(function(){return n})),r("he5V"),r("2qH7"),new Map([["spo","microsoft-my.sharepoint.com"],["spo-df","microsoft-my.sharepoint-df.com"]]),r("mOo8"),r("Fen9")},V0Op:ZTn1:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("qDpI"),o=r("DX81");class i extends n.f{constructor(e){super("ODSP Driver Error when mounting pod",function(e){switch(e){case o.a.authorizationError:return n.g.Unauthorized;case o.a.deltaStreamConnectionForbidden:return n.g.Forbidden;case o.a.fetchFailure:return n.g.UnhandledException;case o.a.fileOverwrittenInStorage:return n.g.DataCorruption;case o.a.genericNetworkError:case o.a.incorrectServerResponse:case o.a.offlineError:return n.g.UnhandledException;case o.a.throttlingError:return n.g.TooManyRequests;case o.a.unsupportedClientProtocolVersion:return n.g.NotAllowed;case o.a.writeError:default:return n.g.UnhandledException}}(e)),this.odspDriverErrorType=e}}const s={expiredToken:()=>new n.f("Received invalid or expired jwt token",n.g.Unauthorized),cannotDecodeToken:()=>new n.f("Failed to decode to readable jwt token",n.g.BadRequest),cannotGetDriveItemFromUrl:e=>new n.f(`Failed to get drive item from url: ${e}`,n.g.BadRequest),cannotGetDriveItemChildren:e=>new n.f(`Failed to get drive item children: ${e}`,n.g.BadRequest),cannotGetAppDataFolder:()=>new n.f("Failed to get the app's data folder",n.g.BadRequest),cannotGetDriveId:e=>new n.f(`Failed to get drive id ${e}`,n.g.BadRequest),cannotGetODSPAppSpecialFolder:()=>new n.f("Failed to get the ODSP Apps Special folder",n.g.BadRequest),invalidSharingURL:e=>new n.f("Sharing link: "+e+"is invalid. Failed to get the drive item",n.g.BadRequest),invalidDriveItemInfo:e=>new n.f(`${e} is/are undefined`,n.g.ExpectationFailed),driveItemInvalidFolder:()=>new n.f("Cannot get all Pods when provided path is not a valid folder",n.g.BadRequest),notOdspStoreLocator:()=>new n.f("Operation not allowed when store locator type is not OdspStoreLocator",n.g.BadRequest),invalidOdspSite:()=>new n.f("Cannot create data store when store locator is not pointing to valid ODSP site",n.g.BadRequest),invalidDomain:e=>new n.f(`An invalid OneDrive domain was provided: ${e}`,n.g.BadRequest),oneDriveDomainException:()=>new n.f("Unable to retrieve user's OneDrive domain.",n.g.UnhandledException),containerCatchUpException:e=>new n.f(`Unhandled error while waiting for container to catch up: ${e}`,n.g.UnhandledException),invalidLoadOptions:()=>new n.f("No load options specified",n.g.BadRequest),pushChannelTokenException:e=>new n.f(`Could not obtain PushChannel token: ${e}`,n.g.Unauthorized),invalidPodId:()=>new n.f("Cannot parse id value when provided ID is not for ODSP pod",n.g.BadRequest),podFileNameHasIncorrectSuffix:()=>new n.f("The pod file name is incorrectly suffixed",n.g.NotAllowed),appNotAllowedToAccessPod:(e,t)=>new n.f(`Current app [${e}] is not allowed to access app [${t}] pod`,n.g.NotAllowed),driverError:mountPodException:()=>new n.f("Unhandled exception when mounting pod by path URL",n.g.UnhandledException),getUserPushChannelInfoException:(e,t)=>new n.f(`Could not get user push channel info : ${e}`,n.g.UnhandledException,t),odspTokenException:e=>new n.f(`Could not obtain ODSP token : ${e}`,n.g.Unauthorized),notImplemented:()=>new n.f("Method not implemented",n.g.NotImplemented),corruptedPodFileError:()=>new n.f("Pod file corrupted.",n.g.DataCorruption),fileNotFound:()=>new n.f("File not found",n.g.NotFound)}},cqV8:function(e,t,r){"use strict";r.r(t),r.d(t,"FoldersProdClientBuilder",(function(){return yr})),r.d(t,"InvalidOperation",(function(){return Sr.a})),r.d(t,"ResourceIdAlreadyInUse",(),r.d(t,"Folder",(function(){return _r}));var n=r("QjXU"),o=r("ijzj"),i=r.n(o),s=r("qDpI");const a=s.e.getInstance().getMfsLogger("idletracker"),c=Object(s.j)(a),d=Object(s.k)(a),l="trackcontainer",h=["mousemove","keydown","wheel","mousedown","touchstart","touchmove","visibilitychange",l];var u=r("8Leb");function p(e,t,r){Object(s.l)(a,"logError",(()=>{const n=r instanceof Error?r:void 0;a.logError(e,s.g.ExpectationFailed,{message:t,error:n},"logError")}))}function f(e){Object(s.l)(a,"disconnectContainer",(()=>{try{(function(e){return Object(s.l)(a,"canDisconnectContainer",(()=>!e.closed&&e.connectionState!==u.a.Disconnected))})(e)&&(e.disconnect(),a.logInfo("containerDisconnected","Container was disconnected","disconnectContainer"))}catch(e){p("containerDisconnectError","Error disconnecting container",e)}}))}function g(e){return Object(s.l)(a,"connectContainer",(()=>{try{(function(e){return Object(s.l)(a,"canConnectContainer",(()=>!e.closed&&e.connectionState===u.a.Disconnected))})(e)&&(e.connect(),a.logInfo("containerConnected","Container was reconnected","connectContainer"))}catch(e){p("containerConnectError","Error connecting container",e)}}))}class m{constructor(e){this.containerSet=new Set,this.isEnabled=e.isEnabled,this.idleTracker=new i.a({timeout:e.idleTimeoutMs,onIdleCallback:events:h,throttle:0})}changeConfiguration(e){const t=this.isEnabled!==e.isEnabled||this.idleTracker.timeout!==e.idleTimeoutMs;e.isEnabled||this.isEnabled===e.isEnabled||this.containerSet.forEach((),t&&(this.idleTracker.end(),this.isEnabled=e.isEnabled,this.idleTracker.timeout=e.idleTimeoutMs,this.isEnabled&&this.containerSet.size>0&&this.idleTracker.start())}track(e){this.containerSet.add(e),!this.isStarted()&&this.isEnabled&&this.idleTracker.start(),document.dispatchEvent(new Event(l))}IdleCallback(e){const t=e.idle;t?a.logInfo("userIdle","User became idle","onIdleCallback"):a.logInfo("userActive","User became active","onIdleCallback"),this.containerSet.forEach((e=>{t?this.disconnectContainerOrSchedule(e):g(e)}))}disconnectContainerOrSchedule(e){e.isDirty?(a.logInfo("scheduleDirtyContainerDisconnect","Scheduling dirty container for disconnection","disconnectContainerOrSchedule"),e.once("saved",(()=>{this.idleTracker.isIdle()&&f(e)}))):f(e)}}Object(n.__decorate)([c(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",void 0)],m.prototype,"changeConfiguration",null),Object(n.__decorate)([c(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",void 0)],m.prototype,"track",null),Object(n.__decorate)([c(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",Boolean)],m.prototype,"isStarted",null),Object(n.__decorate)([c(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",void 0)],m.prototype,"dispose",null),Object(n.__decorate)([d(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",void 0)],m.prototype,"onIdleCallback",null),Object(n.__decorate)([d(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",void 0)],m.prototype,"disconnectContainerOrSchedule",null);var b=r("NgDi");class v extends b.a{constructor(e){super(),this.errorHandler=e}emit(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return super.emit(e,...r)}catch(t){return this.errorHandler(e,t),!0}}}var y,O=r("KMDl"),S=r("QD8S"),E=r("n3ZG");class _ extends v{constructor(e){super(((e,t)=>{const r=t instanceof Error?t:void 0;O.c.logError("clientConfigChangeListenerError",s.g.UnprocessableEntity,{message:"Error processing clientConfigChange listeners",error:r},"constructor")})),this.config=e}static initialize(e){if(this.instance)throw new Error("ClientConfigProvider already initialized");this.instance=new _(e)}art(){if(this.timeoutId)throw new Error("ClientConfigProvider already started");this.timeoutId=setInterval((()=>{this.retrieveClientConfig().catch((e=>{const t=e instanceof Error?e:void 0;O.c.logError("timedRetrieveClientConfigError",s.g.UnprocessableEntity,{message:"Error attempting to retrieve client configuration",error:t},"start")}))}),_.intervalMs)}sync retrieveClientConfig(){const e=await Object(S.b)(this.config.getAccessTokenCallback,this.config.sessionId,this.config.mfsServiceDomain);if(!e.success||!e.clientConfig)throw new Error("Could not retrieve client configuration");const t=e.clientConfig;return this.lastConfig&&Object(E.n)(this.lastConfig,t)||this.emit("clientConfigChanged",t),this.lastConfig=t,t}}_.intervalMs=18e5,Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",void 0)],_.prototype,"start",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",void 0)],_.prototype,"stop",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",Promise)],_.prototype,"retrieveClientConfig",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",void 0)],_,"initialize",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",void 0)],_,"dispose",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",_)],_,"getInstance",null),y||(y={}));var C=r("QnlE"),w=r("DX81"),T=r("obr3"),I=r("rK/e");new(r("O9x+").a)((()=>k(A())));const j={getRawConfig:()=>{}},k=e=>null!=e?new N(void 0,{getRawConfig:t=>{var r,n;try{return null===(n=D(null!==(r=e.getItem(t))&&void 0!==r?r:void 0))||void 0===n?void 0:n.raw}catch(e){}}}):j;function R(e){switch(e){case"boolean":case"number":case"string":return!0;default:return!1}}function D(e){let t,r=e;if("string"==typeof e)try{r=JSON.parse(e),t={raw:e,string:e}}catch(e){}if(void 0===r)return t;const n=typeof r;if(R(n))return Object.assign(Object.assign({},t),{raw:e,[n]:r});if(Array.isArray(r)){const n=typeof r[0];if(!R(n))return t;for(const e of r)if(typeof e!==n)return t;return Object.assign(Object.assign({},t),{raw:e,[`${n}[]`]:r})}return t}const A=()=>{var e;try{return null!==(e=globalThis.sessionStorage)&&void 0!==e?e:void 0}catch(e){return}};class N{constructor(e){this.logger=e,this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set;for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];const i=[...n];for(;i.length>0;){const e=i.shift();void 0!==e&&F(e)&&!t.has(e)&&(t.add(e),e instanceof N?i.push(...e.orderedBaseProviders):this.orderedBaseProviders.push(e))}}getBoolean(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}getNumber(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}getString(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}getBooleanArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}getNumberArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}getStringArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}getRawConfig(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.raw}getCacheEntry(e){var t;if(!this.configCache.has(e)){for(const r of this.orderedBaseProviders){const n=D(null==r?void 0:r.getRawConfig(e));if(void 0!==n)return this.configCache.set(e,n),null===(t=this.logger)||void 0===t||t.send({category:"generic",eventName:"ConfigRead",configName:{tag:M.CodeArtifact,value:e},configValue:{tag:M.CodeArtifact,value:JSON.stringify(n)}}),n}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function P(e){const t=e;return F(null==t?void 0:t.config)&&void 0!==(null==t?void 0:t.logger)}function F(e){return"function"==typeof(null==e?void 0:e.getRawConfig)}var L=r("A3AF");let U;var M;Error,function(e){e.CodeArtifact="CodeArtifact",e.UserData="UserData"}(M||(M={}));class H{atic numberFromString(e){if(null==e)return;const t=Number(e);return Number.isNaN(t)?e:t}tatic prepareErrorObject(e,t,r){const{message:n,errorType:o,stack:i}=function(e,t){const r={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if((e=>null!==e&&!Array.isArray(e)&&"object"==typeof e)(e)){const{errorType:t,stack:n,name:o}=e;"string"==typeof t&&(r.errorType=t),"string"==typeof n&&(r.stack=((e,t)=>{const r=e.split("\n");return r.shift(),void 0!==t&&r.unshift(t),r.join("\n")})(n,"string"==typeof o?o:void 0))}return r}(t);if(e.stack=i,e.error=n,e.errorType=o,(e=>"function"==typeof(null==e?void 0:e.getTelemetryProperties))(t)){const r=t.getTelemetryProperties();for(const t of Object.keys(r))void 0===e[t]&&(e[t]=r[t])}void 0===e.stack&&r&&(e.stack=function(){return function(){const e=new Error("<<generated stack>>");if(void 0===U&&(U=void 0!==e.stack),U)return e;try{throw e}catch(e){return e}}().stack}())}sendTelemetryEvent(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"generic"}),t)}sendTelemetryEventCore(e,t){const r=function(e){var{category:t,eventName:r}=e,n=e,["category","eventName"]);const o={category:t,eventName:r};for(const e of Object.keys(n))o[e]=V(n[e]);return o}(e);void 0!==t&&H.prepareErrorObject(r,t,!1),"number"==typeof r.duration&&(r.duration=H.formatTick(r.duration)),this.send(r)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var r;const n=Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"performance"});this.sendTelemetryEventCore(n,t)}prepareEvent(e){const t="error"===e.category||void 0!==e.error,r=Object.assign({},e);if(void 0!==this.namespace&&(r.eventName=`${this.namespace}${H.eventNamespaceSeparator}${r.eventName}`),this.properties){const n=[];n.push(this.properties.all),t&&n.push(this.properties.error);for(const t of n)if(void 0!==t)for(const n of Object.keys(t)){if(void 0!==e[n])continue;const o=t[n],i="function"==typeof o?o():o;void 0!==i&&(r[n]=i)}}return r}}H.eventNamespaceSeparator=":";class x extends H{constructor(e,t,r){super(t,r),this.baseLogger=e,P(e)&&function(e){if(P(e))throw new Error("Logger is already a monitoring context");const t=e;for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];t.config=new N(e,...n),t.logger=e}(this,new N(this,e.config))}static create(e,t,r){if(e instanceof x){const n={};for(const t of[e.properties,r])void 0!==t&&(void 0!==t.all&&(n.all=Object.assign(Object.assign({},n.all),t.all)),void 0!==t.error&&(n.error=Object.assign(Object.assign({},n.error),t.error)));return new x(e.baseLogger,void 0===e.namespace?t:void 0===t?e.namespace:`${e.namespace}${H.eventNamespaceSeparator}${t}`,n)}return new x(e||new B,t,r)}unction V(e){return function(e){var t;return"string"==typeof(null===(t=e)||void 0===t?void 0:t.tag)}(e)?{value:$(e.value),tag:e.tag}:$(e)}function $(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return e;case"object":return JSON.stringify(e);default:return console.error(`convertToBasePropertyTypeUntagged: INVALID PROPERTY (typed as ${typeof e})`),`INVALID PROPERTY (typed as ${typeof e})`}}const q="fluidDriverCache",z="driverStorage.V3",G={1:"diverStorage",2:"diverStorage.V2"};function X(e){return`${e.file.docId}_${e.type}_${e.key}`}function W(e){return new Promise(((t,r)=>{Object(T.b)(q,3,{upgrade:(t,r)=>{try{const e=G[r];e&&t.deleteObjectStore(e)}catch(t){x.create(e).sendErrorEvent({eventName:"FluidCacheDeleteOldDbError"},t)}const n=t.createObjectStore(z);n.createIndex("createdTimeMs","createdTimeMs"),n.createIndex("lastAccessTimeMs","lastAccessTimeMs"),n.createIndex("partitionKey","partitionKey"),n.createIndex("fileId","fileId")},blocked:).then(t,r)}))}var K=r("he5V");let J=[],Y=!1;function Q(e){J.push({task:e}),Z(2e3)}function Z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!Y){if(self.requestIdleCallback)self.requestIdleCallback(ee);else{const t=Date.now()+50;self.setTimeout((()=>ee({timeRemaining:()=>Math.max(t-Date.now(),0),didTimeout:!1})),e)}Y=!0}}function ee(e){!function(e,t){const r=[];for(let e=0;e<J.length;e+=1){if(t&&!t()){r.push(...J.slice(e));break}J[e].task()}J=r}(0,(),Y=!1,J.length>0&&Z()}const te="2.0.0-internal.4.4.0";class re{constructor(e){var t;this.closeDbImmediately=!0,this.dbReuseCount=-1,this.logger=x.create(e.logger),this.partitionKey=e.partitionKey,this.maxCacheItemAge=e.maxCacheItemAge,this.closeDbAfterMs=null!==(t=e.closeDbAfterMs)&&void 0!==t?t:0,this.closeDbAfterMs>0&&(this.closeDbImmediately=!1),Q((async()=>{var e;if(null===(e=navigator.storage)||void 0===e?void 0:e.estimate){const e=await navigator.storage.estimate();let t;"usageDetails"in e&&(t=e.usageDetails.indexedDB),this.logger.sendTelemetryEvent({eventName:"FluidCacheStorageInfo",subCategory:"FluidCache",quota:e.quota,usage:e.usage,indexedDBSize:t,pkgVersion:te})}})),Q((async()=>{let e;try{e=await W(this.logger);const t=e.transaction(z,"readwrite"),r=t.store.index("createdTimeMs"),n=await r.getAllKeys(IDBKeyRange.upperBound((new Date).getTime()-this.maxCacheItemAge));await Promise.all(n.map((e=>t.store.delete(e)))),await t.done}catch(e){this.logger.sendErrorEvent({eventName:"FluidCacheDeleteOldEntriesError",pkgVersion:te},e)}finally{null==e||e.close()}}))}async openDb(){if(this.closeDbImmediately)return W(this.logger);if(void 0===this.db){const e=await W(this.logger);if(void 0!==this.db)return e.close(),this.dbReuseCount+=1,this.db;this.dbReuseCount=-1,this.db=e,this.db.onversionchange=e=>{var t;null===(t=this.db)||void 0===t||t.close(),this.db=void 0,clearTimeout(this.dbCloseTimer),this.dbCloseTimer=void 0},this.db.addEventListener("close",(e=>{clearTimeout(this.dbCloseTimer),this.dbCloseTimer=void 0,this.db=void 0})),Object(K.a)(void 0===this.dbCloseTimer,1734),this.dbCloseTimer=setTimeout((()=>{var e;null===(e=this.db)||void 0===e||e.close(),this.db=void 0,this.dbCloseTimer=void 0}),this.closeDbAfterMs)}return Object(K.a)(void 0!==this.db,1735),this.dbReuseCount+=1,this.db}closeDb(e){this.closeDbImmediately&&(null==e||e.close())}async removeEntries(e){let t;try{t=await this.openDb();const r=t.transaction(z,"readwrite"),n=r.store.index("fileId"),o=await n.getAllKeys(e.docId);await Promise.all(o.map(()),await r.done}catch(e){this.logger.sendErrorEvent({eventName:"FluidCacheDeleteOldEntriesError",pkgVersion:te},e)}finally{this.closeDb(t)}}async get(e){const t=performance.now(),r=await this.getItemFromCache(e);return this.logger.sendPerformanceEvent({eventName:"FluidCacheAccess",cacheHit:void 0!==r,type:e.type,duration:performance.now()-t,dbOpenPerf:null==r?void 0:r.dbOpenPerf,dbReuseCount:this.dbReuseCount,pkgVersion:te}),null==r?void 0:r.cachedObject}async getItemFromCache(e){let t;try{const r=X(e),n=performance.now();t=await this.openDb();const o=performance.now()-n,i=await t.get(z,r);return i?i.partitionKey!==this.partitionKey?(this.logger.sendTelemetryEvent({eventName:"FluidCachePartitionKeyMismatch",subCategory:"FluidCache",pkgVersion:te}),void this.closeDb(t)):(new Date).getTime()-i.createdTimeMs>this.maxCacheItemAge?void this.closeDb(t):(this.closeDb(t),Object.assign(Object.assign({},i),{dbOpenPerf:o})):void this.closeDb(t)}catch(e){return this.logger.sendErrorEvent({eventName:"FluidCacheGetError",pkgVersion:te},e),void this.closeDb(t)}}async put(e,t){let r;try{r=await this.openDb();const n=(new Date).getTime();await r.put(z,{cachedObject:t,fileId:e.file.docId,type:e.type,cacheItemId:e.key,partitionKey:this.partitionKey,createdTimeMs:n,lastAccessTimeMs:n},X(e)),this.closeDb(r)}catch(e){this.logger.sendErrorEvent({eventName:"FluidCachePutError",pkgVersion:te},e)}finally{this.closeDb(r)}}}var ne=r("f/DM"),oe=ar se,ae,ce,de,le,he,ue,pe,fe,ge,me,be,ve,ye,Oe,Se,Ee,_e,Ce,we,Te,Ie="";!["openid","profile","offline_access"],["email"]),function(e){e.CONTENT_TYPE="Content-Type",e.RETRY_AFTER="Retry-After",e.CCS_HEADER="X-AnchorMailbox",e.WWWAuthenticate="WWW-Authenticate",e.AuthenticationInfo="Authentication-Info",e.X_MS_REQUEST_ID="x-ms-request-id",e.X_MS_HTTP_VERSION="x-ms-httpver"}(se||(se={})),function(e){e.ID_TOKEN="idtoken",e.CLIENT_INFO="client.info",e.ADAL_ID_TOKEN="adal.idtoken",e.ERROR="error",e.ERROR_DESC="error.description",e.ACTIVE_ACCOUNT="active-account",e.ACTIVE_ACCOUNT_FILTERS="active-account-filters"}(ae||(ae={})),function(e){e.COMMON="common",e.ORGANIZATIONS="organizations",e.CONSUMERS="consumers"}(ce||(ce={})),de||(de={})),function(e){e.ACCESS_TOKEN="access_token",e.XMS_CC="xms_cc"}(le||(le={})),he||(he={})),function(e){e.QUERY="query",e.FRAGMENT="fragment",e.FORM_POST="form_post"}(ue||(ue={})),pe||(pe={})),function(e){e.MSSTS_ACCOUNT_TYPE="MSSTS",e.ADFS_ACCOUNT_TYPE="ADFS",e.MSAV1_ACCOUNT_TYPE="MSA",e.GENERIC_ACCOUNT_TYPE="Generic"}(fe||(fe={})),function(e){e.CACHE_KEY_SEPARATOR="-",e.CLIENT_INFO_SEPARATOR="."}(ge||(ge={})),function(e){e.ID_TOKEN="IdToken",e.ACCESS_TOKEN="AccessToken",e.ACCESS_TOKEN_WITH_AUTH_SCHEME="AccessToken_With_AuthScheme",e.REFRESH_TOKEN="RefreshToken"}(me||(me={})),be||(be={})),ve||(ve={})),function(e){e.CONFIG="config",e.CACHE="cache",e.NETWORK="network",e.HARDCODED_VALUES="hardcoded_values"}(ye||(ye={})),Oe||(Oe={})),function(e){e.username="username",e.password="password"}(Se||(Se={})),function(e){e[e.httpSuccess=200]="httpSuccess",e[e.httpBadRequest=400]="httpBadRequest"}(Ee||(Ee={})),function(e){e.FAILED_AUTO_DETECTION="1",e.INTERNAL_CACHE="2",e.ENVIRONMENT_VARIABLE="3",e.IMDS="4"}(_e||(_e={})),function(e){e.CONFIGURED_MATCHES_DETECTED="1",e.CONFIGURED_NO_AUTO_DETECTION="2",e.CONFIGURED_NOT_DETECTED="3",e.AUTO_DETECTION_REQUESTED_SUCCESSFUL="4",e.AUTO_DETECTION_REQUESTED_FAILED="5"}(Ce||(Ce={})),we||(we={})),function(e){e.Jwt="JWT",e.Jwk="JWK"}(Te||(Te={}));var je=function(e){function t(r,n,o){var i=this;return i=e.call(this,n?r+": "+n:r)||this,Object.setPrototypeOf(i,t.prototype),i.errorCode=r||Ie,i.errorMessage=n||Ie,i.subError=o||Ie,i.name="AuthError",i}return ie(t,e),t.prototype.setCorrelationId=function(e){this.correlationId=e},t.createUnexpectedError=function(e){return new t("unexpected_error","Unexpected error in authentication.: "+e)},t.createPostRequestFailed=function(e){return new t("post_request_failed","Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details.: "+e)},t}(Error),ke=["interaction_required","consent_required","login_required"],Re=["message_only","additional_action","basic_action","user_password_expired","consent_required"];function De(e,t){return Ne()?async()=>{const r=await t();return null===sessionStorage||void 0===sessionStorage||sessionStorage.setItem(Ae[e],r),r}:t}!function(e){function t(r,n,o,i,s,a,c){var d=e.call(this,r,n,o)||this;return Object.setPrototypeOf(d,t.prototype),d.timestamp=i||Ie,d.traceId=s||Ie,d.correlationId=a||Ie,d.claims=c||Ie,d.name="InteractionRequiredAuthError",d}ie(t,e),t.isInteractionRequiredError=t.createNoTokensFoundError=function(){return new t("no_tokens_found","No refresh token found in the cache. Please sign-in.")},t.createNativeAccountUnavailableError=(je);const Ae={type:"mfsClient-type",document:"mfsClient-id",access:"mfsClient-access-token",push:"mfsClient-push-channel-access-token",odsp:"mfsClient-odsp-access-token"},Ne=var Pe=r("ZTn1");const Fe=var Le=r("EX4G");async function Ue(e,t,r,n,o=!1){return Object(s.m)(O.c,"loadMfsDataObject",(async()=>{const i=await Object(Le.a)(e,r);return O.c.logVerbose("loadMfsDataObject","Initializing datastore",{dataStoreId:e,podId:t,onlyVolatileSession:o}),i.setHost(n),i.setId(t),Object(E.t)(i)&&(O.c.logVerbose("loadMfsDataObject","Initializing MfsFluidVolatileSession"),i.initSession(),i.registerVolatileAudience(o)),i}))}function Me(e,t){return{readyToRead:O.c.startActivity("readyToRead",t,"Starting the measurement when the data store is retrieved without trailing ops applied",e),readyToWrite:O.c.startActivity("readyToWrite",t,"Starting the measurement when the data store is caught up with trailing ops",e)}}var He=r("05Uz");function xe(e,t){return Object(s.l)(O.c,"setLoggingContext",()}function Be(e){return Object(s.l)(O.c,"setPodLocationIdFromPodId",(()=>{s.e.getInstance().setPodLocationId(function(e){const t=Fe(e),r=t.split("|");if(!t.startsWith("ODSP")||5!==r.length)throw Pe.a.invalidPodId();return r[3]}(e))}))}var Ve=r("UPAM"),$e=r("Unhj"),qe=r("qQRf"),ze=r("DLbW"),Ge=r("nmwP"),Xe=r("+DV+"),We=r("mwlv");class Ke{constructor(){this.snapshotExpiryPolicy=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36e5,this.cache=new Map,this.docIdExpirationMap=new Map}async get(e){const t=Object(We.a)(e);return this.cache.get(t)}async put(e,t){const r=Object(We.a)(e);this.cache.set(r,t),this.updateExpirationEntry(e.file.docId)}emoveDocIdEntriesFromCache(e){return this.removeExpirationEntry(e),Array.from(this.cache).filter((t=>{let[r]=t;if(r.split("_")[0]===e)return!0})).map((e=>{let[t]=e;this.cache.delete(t)}))}removeExpirationEntry(e){const t=this.docIdExpirationMap.get(e);void 0!==t&&(clearTimeout(t),this.docIdExpirationMap.delete(e))}updateExpirationEntry(e){this.removeExpirationEntry(e),this.docIdExpirationMap.set(e,setTimeout((,this.snapshotExpiryPolicy))}}class Je{var Ye=r("SuZ0"),Qe=r("2IM6"),Ze=r("vqXW"),et=r.n(Ze),tt=r("KGtu"),rt=r("hpQ0");class nt{sync get(e,t,r,n){return Object(rt.i)((async o=>{const i=this.buildUrl(e,t),s=await this.getStorageToken(o,"DeltaStorage");return $e.b.timedExecAsync(this.logger,Object.assign(Object.assign({eventName:"OpsFetch",attempts:o.refresh?2:1,from:e,to:t},r),{reason:n}),(async e=>{const t=Object(L.a)();let r=`--${t}\r\n`;r+=`Authorization: Bearer ${s}\r\n`,r+="X-HTTP-Method-Override: GET\r\n",r+="_post: 1\r\n",r+=`\r\n--${t}--`;const o={"Content-Type":`multipart/form-data;boundary=${t}`},a=new et.a,c=setTimeout((()=>a.abort()),3e4),d=await this.epochTracker.fetchAndParseAsJSON(i,{headers:o,body:r,method:"POST",signal:a.signal},"ops",!0,n);clearTimeout(c);const l=d.content,h=l.value.length>0&&"op"in l.value[0]?l.value.map((e=>e.op)):l.value;return e.end(Object.assign({headers:0!==Object.keys(o).length||void 0,length:h.length},d.propsToLog)),{messages:h,partialResult:!1}}))}))}buildUrl(e,t){const r=encodeURIComponent(`sequenceNumber ge ${e} and sequenceNumber le ${t-1}`);return`${this.deltaFeedUrl}?ump=1&filter=${r}`}}class ot{constructor(e,t,r,n,o,i,s,a){this.snapshotOps=e,this.logger=t,this.batchSize=r,this.concurrency=n,this.getFromStorage=o,this.getCached=i,this.requestFromSocket=s,this.opsReceived=a,this.firstCacheMiss=Number.MAX_SAFE_INTEGER}fetchMessages(e,t,r,n,o){Object(K.a)(!n||void 0===t,483);let i=0,s=0,a=0;const c=async(e,t,r)=>{if(void 0!==this.snapshotOps&&0!==this.snapshotOps.length){const r=this.snapshotOps.filter(();if(Object(rt.p)("cached",r,e,this.logger),r.length>0&&r[0].sequenceNumber===e)return this.snapshotOps=this.snapshotOps.filter((),i=r.length,{messages:r,partialResult:!0};this.snapshotOps=void 0}if(this.requestFromSocket(e,t),e<this.firstCacheMiss){const r=await this.getCached(e,t);if(Object(rt.p)("cached",r,e,this.logger),0!==r.length)return s+=r.length,{messages:r,partialResult:!0};this.firstCacheMiss=Math.min(this.firstCacheMiss,e)}if(n)return{messages:[],partialResult:!1};const c=await this.getFromStorage(e,t,r,o);return Object(rt.p)("storage",c.messages,e,this.logger),a+=c.messages.length,this.opsReceived(c.messages),c},d=Object(tt.c)((async(e,t,r)=>{const n=await c(e,t,r);return Object(rt.p)("catch all",n.messages,e,this.logger),n}),this.concurrency,e,t,this.batchSize,this.logger,r,o);return Object(tt.e)(d,(e=>{e.done&&i+s+a!==0&&this.logger.sendPerformanceEvent({eventName:"CacheOpsRetrieved",opsFromSnapshot:i,opsFromCache:s,opsFromStorage:a})}))}}var it,st,at=r("gaGA");!function(e){e[e.NoCaching=0]="NoCaching",e[e.Prefetch=1]="Prefetch"}(it||(it={})),st||(st={}));var ct=r("LZKY"),dt=r("1bkS"),lt=r("V0Op"),ht=r("nCVa"),ut=r("2qH7"),pt=r("zQYL"),ft=r("3mBU"),gt=r("GmCu"),mt=r("Tvsg"),bt=r("Xou4");function vt(e){const t={},r={id:e.id,blobs:{},trees:{}};t[""]=r;for(const r of e.entries){const e=r.path.lastIndexOf("/"),n=r.path.slice(0,Math.max(0,e)),o=r.path.slice(e+1),i=t[n];if("tree"===r.type){const e={blobs:{},trees:{},unreferenced:r.unreferenced};i.trees[decodeURIComponent(o)]=e,t[r.path]=e}else"blob"===r.type&&(i.blobs[decodeURIComponent(o)]=r.id)}return r}function yt(e){var t,r;const n=new Map;e.blobs&&e.blobs.forEach((e=>{var t;Object(K.a)("base64"===e.encoding||void 0===e.encoding,164),n.set(e.id,Object(bt.e)(e.content,null!==(t=e.encoding)&&void 0!==t?t:"utf8"))}));const o=null==e?void 0:e.trees[0].sequenceNumber;return{blobs:n,ops:null!==(r=null===(t=e.ops)||void 0===t?void 0:t.map(())&&void 0!==r?r:[],sequenceNumber:o,snapshotTree:vt(e.trees[0]),latestSequenceNumber:e.ops&&e.ops.length>0?e.ops[e.ops.length-1].sequenceNumber:o}}class Ot{constructor(e){this.data=e,this.index=0,Object.freeze(e.buffer)}get buffer(){return this.data}et pos(){return this.index}get length(){return this.data.length}ad(){let e=0,t=1,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;for(;r>0;)Object(K.a)(!this.eof,547),e+=this.data[this.index]*t,this.index++,t*=256,r--;return e}skip(e){Object(K.a)(e>=0,548),this.index+=e,Object(K.a)(this.index<=this.data.length,988)}}var St,Et,_t,Ct=r("cGWa"),wt=r("FiVw");!St||(St={})),function(e){e[e.list=49]="list",e[e.set=51]="set"}(Et||(Et={})),_t||(_t={}));const Tt={1:0,2:1,3:1,4:2,5:2,6:4,7:4,8:8,9:8,13:0,14:1,15:2,16:4,17:1,18:2,19:4,20:1,21:4,32:0,33:1,34:2,35:4,36:8};function It(e,t){const r=e[t];return Object(K.a)(void 0!==r,647),r}function jt(e){const t={};for(const[r,n]of e.iteratePairs())t[Pt(r,"keynode should be a string")]=n;return t}lass Rt extends kt{et buffer(){return this.data}tatic read(e,t){const r=e.read(t),n=new Uint8Array(r);for(let t=0;t<r;t++)n[t]=e.read();return new Rt(n)}}class Dt extends kt{t arrayBuffer(){const e=this.data.byteOffset;return this.data.buffer.slice(this.start+e,this.end+e)}static read(e,t){const r=e.read(t),n=e.pos;return e.skip(r),new Dt(e.buffer,n,n+r)}}class At{constructor(){this.type=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"set",this.children=[]}eratePairs(){return Object(K.a)(this.length%2==0,556),function(e){const t={next:()=>{const t=e.next();if(t.done)return{value:void 0,done:!0};const r=e.next();return Object(K.a)(!0!==r.done,555),{value:[t.value,r.value],done:r.done}},[Symbol.iterator]:;return t}(this))}tString(e){return Pt(this.children[e],"getString should return string")}getMaybeString(e){return this.children[e])}getBlob(e){const t=this.children[e];return Ft(t,"getBlob should return a blob"),t}getNode(e){const t=this.children[e];return Lt(t,"getNode should return a node"),t}getNumber(e){const t=this.children[e];return Ut(t,"getNumber should return a number"),t}getBool(e){const t=this.children[e];return Mt(t,"getBool should return a boolean"),t}dDictionaryString(e){this.children.push({content:e,dictionary:!0,_stringElement:!0})}addString(e){this.children.push({content:e,dictionary:!1,_stringElement:!0})}addNumber(e){Object(K.a)(Number.isInteger(e),561),Object(K.a)(void 0!==e&&e>=0,562),this.children.push(e)}tatic readString(e,t,r){const n=It(Tt,t),o=e.read(n),i=e.pos;return e.skip(o),{dictionary:r,_stringElement:!0,startPos:i,endPos:e.pos}}load(e,t){const[r,n]=Object(rt.m)((),[,o]=Object(rt.m)(();return{durationStructure:n,durationStrings:o}}loadStructure(e,t){const r=[],n=[],o=[];let i=this.children;for(;!e.eof;){const t=e.read();switch(t){case Et.list:case Et.set:{const e=new At(t===Et.set?"set":"list");i.push(e),r.push(i),i=e.children;continue}case St.ConstStringDeclare:case St.ConstStringDeclareBig:{const r=e.read(It(Tt,t)),i=At.readString(e,t,!0);n.push(i),o[r]=i;continue}case St.ConstString8Id:case St.ConstString16Id:case St.ConstString32Id:{const r=o[e.read(It(Tt,t))];Object(K.a)(void 0!==r,990),i.push(r);continue}case St.StringEmpty:case St.String8Length:case St.String16Length:case St.String32Length:{const r=At.readString(e,t,!1);n.push(r),i.push(r);continue}case St.BinaryEmpty:case St.BinarySingle8:case St.BinarySingle16:case St.BinarySingle32:case St.BinarySingle64:i.push(Dt.read(e,It(Tt,t)));continue;case St.Int0:i.push(0);continue;case St.UInt8:case St.UInt16:case St.UInt32:case St.UInt64:case St.Int8:case St.Int16:case St.Int32:case St.Int64:i.push(e.read(It(Tt,t)));continue;case St.BoolTrue:i.push(!0);continue;case St.BoolFalse:i.push(!1);continue;case _t.list:case _t.set:i=r.pop();continue;default:throw new Error(`Invalid code: ${t}`)}}return Object(K.a)(i===this.children,999),n}loadStrings(e,t,r){let n=0;for(const e of t)n+=e.endPos-e.startPos+1;const o=new Uint8Array(n);n=0;const i=e.buffer;Object(K.a)(0===i.byteOffset,1e3);for(const e of t){for(let t=e.startPos;t<e.endPos;t++)o[n]=i[t],n++;o[n]=0,n++}Object(K.a)(n===o.length,1048);const s=Object(bt.b)(o,"utf-8").split(String.fromCharCode(0));if(s.length===t.length+1)for(let e=0;e<t.length;e++)t[e].content=s[e];else{r.sendErrorEvent({eventName:"StringParsingError"});for(const e of t)Object(K.a)(e.content===Object(bt.b)(i.subarray(e.startPos,e.endPos),"utf-8"),1002)}}}class Nt extends At{static load(e,t){const r=new Nt,n=r.load(e,t);return Object(K.a)(e.eof,563),{builder:r,telemetryProps:n}}}function Pt(e,t){if(e._stringElement)return e.content;Ht(e,"BlobCore",t)}function Ft(e,t){e instanceof kt||Ht(e,"BlobCore",t)}function Lt(e,t){e instanceof At||Ht(e,"NodeCore",t)}function Ut(e,t){"number"!=typeof e&&Ht(e,"Number",t)}function Mt(e,t){"boolean"!=typeof e&&Ht(e,"Boolean",t)}function Ht(e,t,r){throw new dt.f(`Buffer parsing exception: ${r}`,w.a.incorrectServerResponse,{nodeType:xt(e),expectedNodeType:t,driverVersion:wt.a})}function xt(e){return"number"==typeof e?"Number":e instanceof kt?"BlobCore":e instanceof At?"NodeCore":"boolean"==typeof e?"Boolean":e._stringElement?"String":"UnknownType"}function Bt(e){Lt(e,"Deltas should be of type NodeCore");const t=[],r=jt(e);Ut(r.firstSequenceNumber,"Seq number should be a number"),Lt(r.deltas,"Deltas should be a Node");for(let e=0;e<r.deltas.length;++e)t.push(JSON.parse(r.deltas.getString(e)));return Object(K.a)(r.firstSequenceNumber.valueOf()===t[0].sequenceNumber,640),t}function Vt(e){let t=0;const r={},n={blobs:{},trees:r};for(const o of e){Lt(o,"tree nodes should be nodes");const e=o.length;if(e>0&&"name"===o.getMaybeString(0)){if(4===e){const e=o.getMaybeString(2);if("children"===e){const e=Vt(o.getNode(3));r[o.getString(1)]=e.snapshotTree,t+=e.slowTreeStructureCount;continue}if("value"===e){n.blobs[o.getString(1)]=o.getString(3);continue}}if(6===e&&"nodeType"===o.getMaybeString(2)&&"value"===o.getMaybeString(4)){n.blobs[o.getString(1)]=o.getString(5);continue}if(6===e&&"unreferenced"===o.getMaybeString(2)&&"children"===o.getMaybeString(4)){const e=Vt(o.getNode(5));r[o.getString(1)]=e.snapshotTree,t+=e.slowTreeStructureCount,Object(K.a)(o.getBool(3),987),n.unreferenced=!0;continue}}t+=1;const i=jt(o);void 0!==i.unreferenced&&(Mt(i.unreferenced,"Unreferenced flag should be bool"),Object(K.a)(i.unreferenced,641),n.unreferenced=!0);const s=Pt(i.name,"Path name should be string");if(void 0!==i.value)n.blobs[s]=Pt(i.value,"Blob value should be string");else if(void 0!==i.children){Lt(i.children,"Trees should be of type NodeCore");const e=Vt(i.children);r[s]=e.snapshotTree,t+=e.slowTreeStructureCount}else r[s]={blobs:{},trees:{}}}return{snapshotTree:n,slowTreeStructureCount:t}}function $t(e){Lt(e,"Snapshot should be of type NodeCore");const t=jt(e);Lt(t.treeNodes,"TreeNodes should be of type NodeCore"),Ut(t.sequenceNumber,"sequenceNumber should be of type number");const{snapshotTree:r,slowTreeStructureCount:n}=Vt(t.treeNodes);return r.id=Pt(t.id,"snapshotId should be string"),{sequenceNumber:t.sequenceNumber.valueOf(),snapshotTree:r,slowTreeStructureCount:n}}var qt;async function zt(e,t,r,n,o,i,s,a,c){const d=e.sharingLinkToRedeem;return d&&(e.shareLinkInfo=Object.assign(Object.assign({},e.shareLinkInfo),{sharingLinkToRedeem:d})),Gt(e,t,r,o,i,s,c).catch((async a=>{if(c&&function(e,t){var r;return void 0!==(null===(r=e.shareLinkInfo)||void 0===r?void 0:r.sharingLinkToRedeem)&&"object"==typeof t&&null!==t&&(t.errorType===w.a.authorizationError||t.errorType===w.a.fileNotFoundOrAccessDeniedError)}(e,a)){await async function(e,t,r,n){return $e.b.timedExecAsync(r,{eventName:"RedeemShareLink"},(async()=>Object(rt.i)((async r=>{var o,i;Object(K.a)(!!(null===(o=e.shareLinkInfo)||void 0===o?void 0:o.sharingLinkToRedeem),493);const s=await t(r,"RedeemShareLink"),a=function(e){let t=Object(ht.b)(encodeURI(e));return t=t.replace(/=+$/g,"").replace(/\//g,"_").replace(/\+/g,"-"),t="u!".concat(t),t}(null===(i=e.shareLinkInfo)||void 0===i?void 0:i.sharingLinkToRedeem),c=`${e.siteUrl}/_api/v2.0/shares/${a}`,{url:d,headers:l}=Object(mt.a)(c,s,n);return l.prefer="redeemSharingLink",Object(rt.d)(d,{headers:l})}))))}(e,t,o,n);const c=Object.assign(Object.assign({},e),{shareLinkInfo:Object.assign(Object.assign({},e.shareLinkInfo),{sharingLinkToRedeem:void 0})});return o.sendErrorEvent({eventName:"RedeemFallback",errorType:a.errorType},a),Gt(c,t,r,o,i,s)}throw a})).catch((async e=>{throw("object"==typeof e&&null!==e&&e.errorType===w.a.authorizationError||e.errorType===w.a.fileNotFoundOrAccessDeniedError)&&await a(),e}))}async function Gt(e,t,r,n,o,i,s){return Object(rt.i)((async a=>{var c;const d=await t(a,"TreesLatest",!0);Object(K.a)(null!==d,485);const l={eventName:"TreesLatest",attempts:a.refresh?2:1,shareLinkPresent:void 0!==(null===(c=e.shareLinkInfo)||void 0===c?void 0:c.sharingLinkToRedeem),isSummarizer:e.summarizer,redeemFallbackEnabled:s};return void 0!==r&&Object.entries(r).forEach((e=>{let[t,r]=e;void 0!==r&&(l[`snapshotOption_${t}`]=r)})),$e.b.timedExecAsync(n,l,(async t=>{var s,a,c,l,h,u,p,f,g;let m,b;void 0!==(null==r?void 0:r.timeout)&&(m=new et.a,b=setTimeout((,r.timeout));const[v,y]=await Object(rt.n)(().finally((()=>{void 0!==b&&(clearTimeout(b),b=void 0)})),O=v.odspResponse,S=O.headers.get("content-type"),E=Object.assign(Object.assign({},O.propsToLog),{contentType:S,accept:v.requestHeaders.accept,driverVersion:wt.a});let _,C,T,j;(null==S?void 0:S.includes("application/ms-fluid"))?C="application/ms-fluid":(null==S?void 0:S.includes("application/json"))&&(C="application/json");try{switch(C){case"application/json":{let e,t;[e,j]=await Object(rt.n)((async()=>O.content.text())),E.bodySize=e.length,[t,T]=Object(rt.m)((),function(e){Object(K.a)(void 0!==e.trees,512),Object(K.a)(void 0!==e.blobs,513)}(t);const r=yt(t);_=Object.assign(Object.assign({},O),{content:Object.assign(Object.assign({},r),{telemetryProps:{}})});break}case"application/ms-fluid":{let e,t;if([e,j]=await Object(rt.n)((),E.bodySize=e.byteLength,[t,T]=Object(rt.m)((()=>function(e,t){const{builder:r,telemetryProps:n}=Nt.load(new Ot(e),t);Object(K.a)(1===r.length,537);const o=jt(r.getNode(0)),i=Pt(o.mrv,"minReadVersion should be string"),s=Pt(o.cv,"createVersion should be string");void 0!==o.lsn&&Ut(o.lsn,"lsn should be a number"),Object(K.a)(parseFloat("1.0")>=parseFloat(i),527),Object(K.a)(parseFloat(s)>=parseFloat("1.0"),528),Object(K.a)("1.0"===s,706);const[a,c]=Object(rt.m)((),[d,l]=Object(rt.m)((()=>function(e){Lt(e,"TreeBlobs should be of type NodeCore");let t=0;const r=new Map;for(const n of e){if(Lt(n,"blob should be node"),4===n.length&&"id"===n.getMaybeString(0)&&"data"===n.getMaybeString(2)){r.set(n.getString(1),n.getBlob(3).arrayBuffer);continue}t+=1;const e=jt(n);Ft(e.data,"data should be of BlobCore type");const o=Pt(e.id,"blob id should be string");r.set(o,e.data.arrayBuffer)}return{blobs:r,slowBlobStructureCount:t}}(o.blobs)));return Object.assign(Object.assign(Object.assign({},a),d),{ops:void 0!==o.deltas?Bt(o.deltas):[],latestSequenceNumber:o.lsn,telemetryProps:Object.assign(Object.assign({},n),{durationSnapshotTree:c,durationBlobs:l,slowTreeStructureCount:a.slowTreeStructureCount,slowBlobStructureCount:d.slowBlobStructureCount})})}(new Uint8Array(e),n))),void 0===t.snapshotTree.trees||void 0===t.snapshotTree.blobs)throw new dt.f("Returned odsp snapshot is malformed. No trees or blobs!",w.a.incorrectServerResponse,E);const r=t.telemetryProps,o=null!==(s=r.slowTreeStructureCount)&&void 0!==s?s:0,i=null!==(a=r.slowBlobStructureCount)&&void 0!==a?a:0;(o>10||i>10)&&n.sendErrorEvent({eventName:"SlowSnapshotParseCodePaths",slowTreeStructureCount:o,slowBlobStructureCount:i}),_=Object.assign(Object.assign({},O),{content:t});break}default:throw new dt.f("Unknown snapshot content type",w.a.incorrectServerResponse,E)}}catch(e){if(Object(ut.b)(e))throw e.addTelemetryProperties(E),e;throw Object(pt.h)(e,(e=>new dt.f(`Error parsing snapshot response: ${e}`,w.a.genericError,E)))}Object(K.a)(void 0!==_,786);const k=_.content,{trees:R,numBlobs:D,encodedBlobsSize:A}=Xt(k),N="true"!==O.headers.get("disablebrowsercachingofusercontent"),P=null!==(c=k.sequenceNumber)&&void 0!==c?c:0,F=k.ops&&k.ops.length>0?k.ops[0].sequenceNumber-1:void 0;if(!Number.isInteger(P)||void 0!==F&&F!==P)n.sendErrorEvent({eventName:"fetchSnapshotError",sequenceNumber:P,seqNumberFromOps:F}),k.sequenceNumber=void 0;else if(N){const e=O.headers.get("x-fluid-epoch");Object(K.a)(void 0!==e,486);const t=Object.assign(Object.assign({},k),{cacheEntryTime:Date.now()});i({value:t,fluidEpoch:e,version:gt.a})}return t.end(Object.assign(Object.assign(Object.assign(Object.assign({trees:R,blobs:null!==(h=null===(l=k.blobs)||void 0===l?void 0:l.size)&&void 0!==h?h:0,leafNodes:D,encodedBlobsSize:A,sequenceNumber:P,ops:null!==(p=null===(u=k.ops)||void 0===u?void 0:u.length)&&void 0!==p?p:0,userOps:null!==(g=null===(f=k.ops)||void 0===f?void 0:f.filter(().length)&&void 0!==g?g:0,headers:0!==Object.keys(v.requestHeaders).length||void 0,fetchTime:y,parseTime:T,receiveContentTime:j},function(e,t){var r,n;let o,i,s,a,c,d,l,h;const u=null!==(n=null===(r=I.a.getEntriesByType)||void 0===r?void 0:r.call(I.a,"resource"))&&void 0!==n?n:[];for(let t=u.length-1;t>0;t--){const r=u[t],n=r.name.toString();if(0===r.initiatorType.localeCompare("fetch")&&n.includes(e)){i=r.redirectEnd-r.redirectStart,h=r.fetchStart,o=r.domainLookupEnd-r.domainLookupStart,s=r.connectEnd-r.connectStart,a=r.secureConnectionStart>0?r.connectEnd-r.secureConnectionStart:0,c=r.responseStart>0?r.responseEnd-r.responseStart:void 0,d=r.fetchStart>0?r.responseEnd-r.fetchStart:void 0,l=r.requestStart>0?r.responseEnd-r.requestStart:void 0;break}}return{dnsLookupTime:o,w3cStartTime:h,redirectTime:i,tcpHandshakeTime:s,secureConnectionTime:a,responseNetworkTime:c,fetchStartToResponseEndTime:d,reqStartToResponseEndTime:l}}(v.requestUrl)),{sltelemetry:O.headers.get("x-fluid-sltelemetry")}),E),_.content.telemetryProps)),k})).catch((e=>{throw"object"!=typeof e||null===e||e.errorType!==w.a.fetchFailure&&e.errorType!==lt.a.fetchTimeout||(e[rt.j]=!0),e}))}))}function Xt(e){const t=Wt(e.snapshotTree),r=e.blobs.size;let n=0;for(const[t,r]of e.blobs)n+=r.byteLength;return{trees:t,numBlobs:r,encodedBlobsSize:n}}function Wt(e){let t=0;for(const[r,n]of Object.entries(e.trees))t+=1,t+=Wt(n);return t}!qt||(qt={}));class Kt{constructor(){this.deferBlobCacheClear=!1,this._blobCache=new Map,this.blobsEvicted=new Set,this.blobCacheTimeoutDuration=12e4,this.purgeEnabled=!1}get value(){return this._blobCache}addBlobs(e){e.forEach((),this.scheduleClearBlobsCache()}scheduleClearBlobsCache(){void 0!==this.blobCacheTimeout?this.deferBlobCacheClear=!0:this.purgeEnabled&&(this.blobCacheTimeout=setTimeout((()=>{this.blobCacheTimeout=void 0,this.deferBlobCacheClear?(this.deferBlobCacheClear=!1,this.scheduleClearBlobsCache()):(this._blobCache.forEach((),this._blobCache.clear())}),this.blobCacheTimeoutDuration),this.blobCacheTimeoutDuration=1e4)}getBlob(e){return this.scheduleClearBlobsCache(),{blobContent:this._blobCache.get(e),evicted:this.blobsEvicted.has(e)}}setBlob(e,t){if(t.byteLength<262144)return this.scheduleClearBlobsCache(),this._blobCache.set(e,t);this.blobsEvicted.add(e)}}class Jt extends class{constructor(e){this.commitCache=new Map,this.attributesBlobHandles=new Set,this.blobCache=new Kt;const t=e.getBoolean("Fluid.Driver.Odsp.TestOverride.DisableSnapshotCache")?0:432e6;this.policies={caching:it.NoCaching,minBlobSize:2048,maximumCacheDurationMs:t}}set ops(e){Object(K.a)(void 0===this._ops,165),this._ops=e}get ops(){return this._ops}get snapshotSequenceNumber(){return this._snapshotSequenceNumber}sync readBlobCore(e){const{blobContent:t,evicted:r}=this.blobCache.getBlob(e);return null!=t?t:this.fetchBlobFromStorage(e,r)}sync getSnapshotTree(e,t){let r;if(e&&e.id)r=e.id;else{const e=await this.getVersions(null,1,t);if(!e||0===e.length)return null;r=e[0].id}const n=await this.readTree(r,t);if(!n)return null;if(n.blobs){const e=n.blobs.attributes;e&&this.attributesBlobHandles.add(e)}return this.combineProtocolAndAppSnapshotTree(n.trees[".app"],n.trees[".protocol"])}itBlobsCache(e){this.blobCache.addBlobs(e)}async readTree(e,t){let r=this.commitCache.get(e);return r||(r=await this.fetchTreeFromSnapshot(e,t)),null!=r?r:null}combineProtocolAndAppSnapshotTree(e,t){return{blobs:Object.assign({},e.blobs),trees:Object.assign(Object.assign({},e.trees),{".protocol":t})}}initializeFromSnapshot(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._snapshotSequenceNumber=e.sequenceNumber;const{snapshotTree:r,blobs:n,ops:o}=e;let i;return r&&(i=r.id,Object(K.a)(void 0!==i,545),this.setRootTree(i,r)),n&&this.initBlobsCache(n),t&&(this.ops=o),i}}{constructor(e,t,r,n,o,i,s,a,c,d){super(Object(Qe.c)(r).config),this.odspResolvedUrl=e,this.getStorageToken=t,this.logger=r,this.fetchFullSnapshot=n,this.cache=o,this.hostPolicy=i,this.epochTracker=s,this.flushCallback=a,this.relayServiceTenantAndSessionId=c,this.snapshotFormatFetchType=d,this.odspSummaryModuleLoaded=!1,this.firstVersionCall=!0,this.maxSnapshotSizeLimit=5e8,this.maxSnapshotFetchTimeout=12e4,this.createBlobRateLimiter=new ct.a(1),this.documentId=this.odspResolvedUrl.hashedDocumentId,this.snapshotUrl=this.odspResolvedUrl.endpoints.snapshotStorageUrl,this.attachmentPOSTUrl=this.odspResolvedUrl.endpoints.attachmentPOSTStorageUrl,this.attachmentGETUrl=this.odspResolvedUrl.endpoints.attachmentGETStorageUrl}async createBlob(e){return this.checkAttachmentPOSTUrl(),(await Object(rt.i)((async t=>{var r;const n=await this.getStorageToken(t,"CreateBlob"),{url:o,headers:i}=Object(mt.a)(`${this.attachmentPOSTUrl}/content`,n,!!(null===(r=this.hostPolicy.sessionOptions)||void 0===r?void 0:r.forceAccessTokenViaAuthorizationHeader));return i["Content-Type"]="application/octet-stream",$e.b.timedExecAsync(this.logger,{eventName:"createBlob",size:e.byteLength,waitQueueLength:this.createBlobRateLimiter.waitQueueLength},(async t=>{const r=await this.createBlobRateLimiter.schedule((async()=>this.epochTracker.fetchAndParseAsJSON(o,{body:e,headers:i,method:"POST"},"createBlob")));return t.end(Object.assign({blobId:r.content.id},r.propsToLog)),r}))}))).content}async fetchBlobFromStorage(e,t){this.checkAttachmentGETUrl();const r=await Object(rt.i)((async r=>{var n;const o=await this.getStorageToken(r,"GetBlob"),i=`${this.attachmentGETUrl}/${encodeURIComponent(e)}/content`,{url:s,headers:a}=Object(mt.a)(i,o,!!(null===(n=this.hostPolicy.sessionOptions)||void 0===n?void 0:n.forceAccessTokenViaAuthorizationHeader));return $e.b.timedExecAsync(this.logger,{eventName:"readDataBlob",blobId:e,evicted:t,headers:0!==Object.keys(a).length||void 0,waitQueueLength:this.epochTracker.rateLimiter.waitQueueLength},(async t=>{const n=await this.epochTracker.fetchArray(s,{headers:a},"blob");t.end(Object.assign(Object.assign({waitQueueLength:this.epochTracker.rateLimiter.waitQueueLength},n.propsToLog),{attempts:r.refresh?2:1}));const o=n.headers.get("cache-control");return void 0!==o&&(o.includes("private")||o.includes("public"))||this.logger.sendErrorEvent(Object.assign({eventName:"NonCacheableBlob",cacheControl:o,blobId:e},n.propsToLog)),n.content}))}));return this.blobCache.setBlob(e,r),r}async getSnapshotTree(e,t){return this.snapshotUrl?super.getSnapshotTree(e,t):null}async getVersions(e,t,r,n){if(e!==this.documentId&&e)return[{id:e,treeId:void 0}];if(!this.snapshotUrl)return[];if(1===t&&(null===e||e===this.documentId)){const e=this.hostPolicy.snapshotOptions,t=await $e.b.timedExecAsync(this.logger,{eventName:"ObtainSnapshot",fetchSource:n},(async t=>{const o={};let i,s,a=I.a.now();if(n===st.noCache)i=await this.fetchSnapshot(e,r),s="networkOnly";else{const t=this.epochTracker.get(Object(rt.b)(this.odspResolvedUrl)).then((async e=>{var t;if(void 0!==e){const r=Date.now()-(null!==(t=e.cacheEntryTime)&&void 0!==t?t:Date.now()-2592e6);if(this.hostPolicy.summarizerClient){if(r>6e4)return void(o.cacheSummarizerExpired=!0);o.cacheSummarizerExpired=!1}o.cacheEntryAge=r}return e}));if(this.firstVersionCall&&this.hostPolicy.concurrentSnapshotFetch&&!this.hostPolicy.summarizerClient){const n=this.fetchSnapshot(e,r),o=await async function(e){return new Promise(((t,r)=>{e.forEach(((e,n)=>{e.then(().catch(r)}))}))}([t.catch((()=>{})),n.catch((()=>{}))]);i=o.value,s=0===o.index?"cache":"network",void 0===i&&(1===o.index&&(i=await t,s="cache"),void 0===i&&(i=await n,s="network"))}else i=await t,s=void 0!==i?"cache":"network",void 0===i&&(a=I.a.now(),i=await this.fetchSnapshot(e,r))}"network"===s&&(o.cacheEntryAge=void 0);const c=i.prefetchStartTime;return t.end(Object.assign(Object.assign(Object.assign(Object.assign({},o),{method:s,avoidPrefetchSnapshotCache:this.hostPolicy.avoidPrefetchSnapshotCache}),Xt(i)),{prefetchSavedDuration:void 0!==c&&"cache"!==s?a-c:void 0})),i})),o=this.initializeFromSnapshot(t,this.firstVersionCall);return this.firstVersionCall=!1,o?[{id:o,treeId:void 0}]:[]}return Object(rt.i)((async e=>{var n;const o=await this.getStorageToken(e,"GetVersions"),{url:i,headers:s}=Object(mt.a)(`${this.snapshotUrl}/versions?top=${t}`,o,!!(null===(n=this.hostPolicy.sessionOptions)||void 0===n?void 0:n.forceAccessTokenViaAuthorizationHeader)),a=(await $e.b.timedExecAsync(this.logger,{eventName:"getVersions",headers:0!==Object.keys(s).length||void 0},(async()=>this.epochTracker.fetchAndParseAsJSON(i,{headers:s},"versions",void 0,r)))).content;if(!a)throw new dt.f("No response from /versions endpoint",w.a.genericNetworkError,{driverVersion:wt.a});if(!Array.isArray(a.value))throw new dt.f("Incorrect response from /versions endpoint, expected an array",w.a.genericNetworkError,{driverVersion:wt.a});return a.value.map((e=>({id:e.id,treeId:void 0})))}))}async fetchSnapshot(e,t){return this.fetchSnapshotCore(e,t).catch((e=>{throw"object"==typeof e&&null!==e&&(e.canRetry=!1),e}))}async fetchSnapshotCore(e,t){var r,n,o,i;if(!this.hostPolicy.avoidPrefetchSnapshotCache){const e=Object(We.a)(Object(rt.b)(this.odspResolvedUrl)),t=await(null===(n=null===(r=this.cache.snapshotPrefetchResultCache)||void 0===r?void 0:r.get(e))||void 0===n?void 0:n.then((async e=>(await this.epochTracker.validateEpoch(e.fluidEpoch,"treesLatest"),e))).catch((async e=>{this.logger.sendTelemetryEvent({eventName:"PrefetchSnapshotError",concurrentSnapshotFetch:this.hostPolicy.concurrentSnapshotFetch},e)})));if(void 0!==t)return t}const s=Object.assign(Object.assign({mds:this.maxSnapshotSizeLimit},e),{timeout:(null==e?void 0:e.timeout)?Math.min(e.timeout,this.maxSnapshotFetchTimeout):this.maxSnapshotFetchTimeout});this.hostPolicy.summarizerClient&&(s.mds=void 0,s.timeout=void 0);const a=async(e,r,n,o)=>async function(e,t,r,n,o,i,s,a){var c;const d=e.sharingLinkToRedeem;d&&(e.shareLinkInfo=Object.assign(Object.assign({},e.shareLinkInfo),{sharingLinkToRedeem:d}));const l=`${e.endpoints.snapshotStorageUrl}/trees/latest?ump=1`,{body:h,headers:u}=function(e,t,r,n){var o,i;const s=Object(L.a)(),a=[];return a.push(`--${s}`),a.push(`Authorization: Bearer ${t}`),a.push("X-HTTP-Method-Override: GET"),void 0!==r&&Object.entries(r).forEach((e=>{let[t,r]=e;void 0!==r&&a.push(`${t}: ${r}`)})),void 0!==n&&Object.entries(n).forEach((e=>{let[t,r]=e;void 0!==r&&a.push(`${t}: ${r}`)})),(null===(o=e.shareLinkInfo)||void 0===o?void 0:o.sharingLinkToRedeem)&&a.push(`sl: ${null===(i=e.shareLinkInfo)||void 0===i?void 0:i.sharingLinkToRedeem}`),a.push("_post: 1"),a.push(`\r\n--${s}--`),{body:a.join("\r\n"),headers:{"Content-Type":`multipart/form-data;boundary=${s}`}}}(e,t,n,{prefer:"manualredirect"}),p={body:h,headers:u,signal:null==i?void 0:i.signal,method:"POST"};switch(o){case qt.Binary:u.accept="application/ms-fluid; v=1.0";break;default:u.accept="application/json, application/ms-fluid; v=1.0"}return{odspResponse:await(null!==(c=null==s?void 0:s.fetch(l,p,"treesLatest",!0,a))&&void 0!==c?c:Object(rt.f)(l,p)),requestHeaders:u,requestUrl:l}}(e,r,0,n,this.snapshotFormatFetchType,o,this.epochTracker,t),c=async e=>this.cache.persistedCache.put(Object(rt.b)(this.odspResolvedUrl),e.value),d=try{return await zt(this.odspResolvedUrl,this.getStorageToken,s,!!(null===(o=this.hostPolicy.sessionOptions)||void 0===o?void 0:o.forceAccessTokenViaAuthorizationHeader),this.logger,a,c,d,this.hostPolicy.enableRedeemFallback)}catch(t){const r=t.errorType;if(r===lt.a.snapshotTooBig&&void 0!==(null==e?void 0:e.mds)&&!0!==this.hostPolicy.summarizerClient)throw t;if((r===lt.a.snapshotTooBig||r===lt.a.fetchTimeout)&&s.blobs){this.logger.sendErrorEvent({eventName:"TreeLatest_SecondCall",errorType:r});const e=Object.assign(Object.assign({},s),{blobs:0,mds:void 0,timeout:void 0});return await zt(this.odspResolvedUrl,this.getStorageToken,e,!!(null===(i=this.hostPolicy.sessionOptions)||void 0===i?void 0:i.forceAccessTokenViaAuthorizationHeader),this.logger,a,c,d,this.hostPolicy.enableRedeemFallback)}throw t}}async uploadSummaryWithContext(e,t){var r;if(this.checkSnapshotUrl(),void 0===this.summaryModuleP&&(this.summaryModuleP=this.getDelayLoadedSummaryManager()),".protocol"in e.tree&&void 0!==t.ackHandle){let e=1;for(;;){const n=await this.flushCallback(),o=n.lastPersistedSequenceNumber;if(void 0!==o&&o>=t.referenceSequenceNumber)break;if(e>3){this.logger.sendErrorEvent(Object.assign(Object.assign({eventName:"FlushFailure"},n),{retry:e,referenceSequenceNumber:t.referenceSequenceNumber}));break}this.logger.sendPerformanceEvent(Object.assign(Object.assign({eventName:"FlushExtraCall"},n),{retry:e,referenceSequenceNumber:t.referenceSequenceNumber})),e++,await Object(at.a)(1e3*(null!==(r=n.retryAfter)&&void 0!==r?r:1))}}return this.odspSummaryUploadManager||(this.odspSummaryUploadManager=await this.summaryModuleP.then(().catch(()),Object(K.a)(void 0!==this.odspSummaryUploadManager,1390),await this.odspSummaryUploadManager.writeSummaryTree(e,t)}async getDelayLoadedSummaryManager(){var e;Object(K.a)(!1===this.odspSummaryModuleLoaded,1391);const t=await r.e(609).then(r.bind(null,"WG0T")).then((e=>(this.logger.sendTelemetryEvent({eventName:"SummaryModuleLoaded"}),e))).catch((e=>{throw this.logger.sendErrorEvent({eventName:"SummaryModuleLoadFailed"},e),e}));return this.odspSummaryUploadManager=new t.OdspSummaryUploadManager(this.odspResolvedUrl.endpoints.snapshotStorageUrl,this.getStorageToken,this.logger,this.epochTracker,!!(null===(e=this.hostPolicy.sessionOptions)||void 0===e?void 0:e.forceAccessTokenViaAuthorizationHeader),this.relayServiceTenantAndSessionId),this.odspSummaryUploadManager}checkSnapshotUrl(){if(!this.snapshotUrl)throw new dt.f("Method failed because no snapshot url was available",w.a.genericError,{driverVersion:wt.a})}checkAttachmentPOSTUrl(){if(!this.attachmentPOSTUrl)throw new dt.f("Method failed because no attachment POST url was available",w.a.genericError,{driverVersion:wt.a})}checkAttachmentGETUrl(){if(!this.attachmentGETUrl)throw new dt.f("Method failed because no attachment GET url was available",w.a.genericError,{driverVersion:wt.a})}async fetchTreeFromSnapshot(e,t){return Object(rt.i)((async r=>{var n,o;const i=await this.getStorageToken(r,"ReadCommit"),s=await async function(e,t,r,n,o,i,s){const a=`/trees/${r}`;let c={};n&&(c="latest"!==r?{blobs:2}:{deltas:1,blobs:2});const d=function(e){let t="";for(const r of Object.keys(e))void 0!==e[r]&&(t+=`${""===t?"?":"&"}${r}=${encodeURIComponent(e[r])}`);return t}(c),{url:l,headers:h}=Object(mt.a)(`${e}${a}${d}`,t,o);return yt((await $e.b.timedExecAsync(i,{eventName:"fetchSnapshot",headers:0!==Object.keys(h).length||void 0},()).content)}(this.snapshotUrl,i,e,this.fetchFullSnapshot,!!(null===(n=this.hostPolicy.sessionOptions)||void 0===n?void 0:n.forceAccessTokenViaAuthorizationHeader),this.logger,(async(e,r)=>this.epochTracker.fetchAndParseAsJSON(e,r,"snapshotTree",void 0,t)));let a="";return s.snapshotTree&&(Object(K.a)(void 0!==s.snapshotTree.id,546),a=s.snapshotTree.id,this.setRootTree(a,s.snapshotTree)),s.blobs&&this.initBlobsCache(s.blobs),null!==(o=this.commitCache.get(e))&&void 0!==o?o:this.commitCache.get(a)}))}}var Yt=r("KqdK");class Qt{constructor(e,t,r,n,o,i){this.logger=t,this.cache=r,this.batchSize=n,this.timerGranularity=o,this.totalOpsToCache=i,this.batches=new Map;const s=this.batchSize-this.getPositionInBatchArray(e)-1;0!==s&&this.batches.set(this.getBatchNumber(e),{remainingSlots:s,batchData:this.initializeNewBatchDataArray(),dirty:!1})}dispose(){this.batches.clear(),void 0!==this.timer&&(clearTimeout(this.timer),this.timer=void 0)}flushOps(){for(const[e,t]of this.batches)null!==t&&t.dirty&&(t.dirty=!1,this.write(e,t))}addOps(e){if(!(this.totalOpsToCache<=0))for(const t of e){const e=this.getBatchNumber(t.sequenceNumber),r=this.getPositionInBatchArray(t.sequenceNumber);let n=this.batches.get(e);if(void 0===n)n={remainingSlots:this.batchSize-1,batchData:this.initializeNewBatchDataArray(),dirty:!0},n.batchData[r]=t,this.batches.set(e,n);else{if(null===n||void 0!==n.batchData[r])return;n.batchData[r]=t,n.remainingSlots--,n.dirty=!0}if(0===n.remainingSlots?(this.write(e,n),this.batches.set(e,null)):this.scheduleTimer(),this.totalOpsToCache--,0===this.totalOpsToCache){this.logger.sendPerformanceEvent({eventName:"CacheOpsLimitHit"}),this.cache.remove(),this.dispose();break}}}async getCore(e,t){const r=[];let n=this.getBatchNumber(e);for(;;){const o=await this.cache.read(`${this.batchSize}_${n}`);if(void 0===o)return r;const i=JSON.parse(o);for(const n of i)if(n){if(void 0!==t&&n.sequenceNumber>=t)return r;if(0===r.length){if(n.sequenceNumber>e)return r;if(n.sequenceNumber<e)continue}r.push(n)}else if(0!==r.length)return r;n++}}async get(e,t){const r=I.a.now(),n=await this.getCore(e,t),o=I.a.now()-r;return(n.length>0||o>1e3)&&this.logger.sendPerformanceEvent({eventName:"CacheOpsUsed",from:e,to:t,length:n.length,duration:o}),n}write(e,t){this.cache.write(`${this.batchSize}_${e}`,JSON.stringify(t.batchData)).catch(()}scheduleTimer(){!this.timer&&this.timerGranularity>0&&(this.timer=setTimeout((,this.timerGranularity))}etPositionInBatchArraynitializeNewBatchDataArray(){const e=[];return e.length=this.batchSize,e}}var Zt=r("Qkn4");class er{et policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}et repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e){return this.runWithRetry((async()=>this.internalStorageService.getSnapshotTree(e)),"storage_getSnapshotTree")}async readBlob(e){return this.runWithRetry((async()=>this.internalStorageService.readBlob(e)),"storage_readBlob")}async getVersions(e,t,r,n){return this.runWithRetry((,"storage_getVersions")}async uploadSummaryWithContext(e,t){return this.runWithRetry((,"storage_uploadSummaryWithContext")}async downloadSummary(e){return this.runWithRetry((async()=>this.internalStorageService.downloadSummary(e)),"storage_downloadSummary")}heckStorageDisposed(){if(this._disposed)throw new pt.a("Storage Service is disposed. Cannot retry",{canRetry:!1})}async runWithRetry(e,t){return Object(Zt.a)(e,t,this.logger,()}}class tr{constructor(e,t,r,n,o,i,s,a,c){this.odspResolvedUrl=e,this.getStorageToken=t,this.getWebsocketToken=r,this.cache=o,this.epochTracker=s,this.socketReferenceKeyPrefix=a,this.clientIsSummarizer=c,this.odspSocketModuleLoaded=!1,this._policies={storageOnly:void 0!==e.fileVersion,summarizeProtocolTree:!0},this.mc=Object(Qe.c)($e.a.create(n,void 0,{all:{odc:Object(Yt.b)(new URL(this.odspResolvedUrl.endpoints.snapshotStorageUrl).origin)}})),this.hostPolicy=i,this.clientIsSummarizer&&(this.hostPolicy=Object.assign(Object.assign({},this.hostPolicy),{summarizerClient:!0}))}static async create(e,t,r,n,o,i,s,a,c){return new tr(Object(rt.g)(e),t,r,n,o,i,s,a,c)}get resolvedUrl(){return this.odspResolvedUrl}get policies(){return this._policies}async connectToStorage(){return this.storageManager||(this.storageManager=new Jt(this.odspResolvedUrl,this.getStorageToken,this.mc.logger,!0,this.cache,this.hostPolicy,this.epochTracker,(async()=>{var e;const t=null===(e=this.odspDelayLoadedDeltaStream)||void 0===e?void 0:e.currentDeltaConnection;if(void 0!==t&&!t.disposed)return t.flush();throw new Error("Disconnected while uploading summary (attempt to perform flush())")}),(,this.mc.config.getNumber("Fluid.Driver.Odsp.snapshotFormatFetchType"))),new er(this.storageManager,this.mc.logger)}async connectToDeltaStorage(){var e,t,r,n;const o=null!==(t=null===(e=this.storageManager)||void 0===e?void 0:e.ops)&&void 0!==t?t:[],i=new nt(this.odspResolvedUrl.endpoints.deltaStorageUrl,this.getStorageToken,this.epochTracker,this.mc.logger),s=null!==(r=this.hostPolicy.opsBatchSize)&&void 0!==r?r:5e3,a=null!==(n=this.hostPolicy.concurrentOpsBatches)&&void 0!==n?n:1;return new ot(o,this.mc.logger,s,a,(,(async(e,t)=>{var r,n;return null!==(n=await(null===(r=this.opsCache)||void 0===r?void 0:r.get(e,t)))&&void 0!==n?n:[]}),((e,t)=>{var r;const n=null===(r=this.odspDelayLoadedDeltaStream)||void 0===r?void 0:r.currentDeltaConnection;void 0===n||n.disposed||n.requestOps(e,t)}),(e=>this.opsReceived(e)))}async connectToDeltaStream(e){return void 0===this.socketModuleP&&(this.socketModuleP=this.getDelayLoadedDeltaStream()),this.socketModuleP.then((async t=>(this.odspSocketModuleLoaded=!0,t.connectToDeltaStream(e)))).catch((e=>{throw this.socketModuleP=void 0,this.odspSocketModuleLoaded=!1,e}))}async getDelayLoadedDeltaStream(){Object(K.a)(!1===this.odspSocketModuleLoaded,1287);const e=await Promise.all([r.e(110),r.e(130),r.e(666)]).then(r.bind(null,"Xcci")).then((e=>(this.mc.logger.sendTelemetryEvent({eventName:"SocketModuleLoaded"}),e))).catch((e=>{throw this.mc.logger.sendErrorEvent({eventName:"SocketModuleLoadFailed"},e),e}));return this.odspDelayLoadedDeltaStream=new e.OdspDelayLoadedDeltaStream(this.odspResolvedUrl,this._policies,this.getStorageToken,this.getWebsocketToken,this.mc,this.cache,this.hostPolicy,this.epochTracker,(e=>this.opsReceived(e)),this.socketReferenceKeyPrefix),this.odspDelayLoadedDeltaStream}dispose(e){var t,r,n;void 0!==e?this.epochTracker.removeEntries().catch((()=>{})):null===(t=this._opsCache)||void 0===t||t.flushOps(),null===(r=this._opsCache)||void 0===r||r.dispose(),null===(n=this.odspDelayLoadedDeltaStream)||void 0===n||n.dispose()}get opsCache(){var e,t,r,n,o,i,s;if(this._opsCache)return this._opsCache;const a=null===(e=this.storageManager)||void 0===e?void 0:e.snapshotSequenceNumber,c=null!==(r=null===(t=this.hostPolicy.opsCaching)||void 0===t?void 0:t.batchSize)&&void 0!==r?r:100;if(void 0===a||c<1)return;const d={type:"ops"};return this._opsCache=new Qt(a,this.mc.logger,{write:async(e,t)=>this.cache.persistedCache.put(Object.assign(Object.assign({},d),{key:e}),t),read:async e=>this.cache.persistedCache.get(Object.assign(Object.assign({},d),{key:e})),remove:()=>{this.cache.persistedCache.removeEntries().catch((()=>{}))}},c,null!==(o=null===(n=this.hostPolicy.opsCaching)||void 0===n?void 0:n.timerGranularity)&&void 0!==o?o:5e3,null!==(s=null===(i=this.hostPolicy.opsCaching)||void 0===i?void 0:i.totalOpsToCache)&&void 0!==s?s:5e3),this._opsCache}opsReceived(e){var t;0===e.length||this.odspResolvedUrl.summarizer||null===(t=this.opsCache)||void 0===t||t.addOps(e)}}r("7Oo1");class rr extends class{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ke,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var o;this.getStorageToken=e,this.getWebsocketToken=t,this.persistedCache=r,this.hostPolicy=n,this.nonPersistentCache=new Je,!0===this.hostPolicy.isolateSocketCache&&(this.socketReferenceKeyPrefix=Object(L.a)()),this.hostPolicy.enableRedeemFallback=null===(o=this.hostPolicy.enableRedeemFallback)||void 0===o||o,this.hostPolicy.sessionOptions=Object.assign({forceAccessTokenViaAuthorizationHeader:!0},this.hostPolicy.sessionOptions)}get snapshotPrefetchResultCache(){return this.nonPersistentCache.snapshotPrefetchResultCache}async createContainer(e,t,n,o){Object(qe.a)(t);let i=Object(rt.g)(t);const s={siteUrl:i.siteUrl,driveId:i.driveId,itemId:i.itemId},[,a]=i.url.split("?"),c=new URLSearchParams(a),d=c.get("path");if(null==d)throw new Error("File path should be provided!!");let l,h;if(i.itemId)l={type:"Existing",driveId:i.driveId,siteUrl:i.siteUrl,itemId:i.itemId};else{if(!i.fileName)throw new Error("A new or existing file must be specified to create container!");h=function(e,t){let r;if(e.enableSingleRequestForShareLinkWithCreate){const e=t.get("createLinkScope"),n=t.get("createLinkRole");e&&Ge.c[e]&&(r=Object.assign({scope:Ge.c[e]},n&&Ge.b[n]?{role:Ge.b[n]}:{}))}else if(e.enableShareLinkWithCreate){const e=t.get("createLinkType");e&&Ge.a[e]&&(r=Ge.a[e||""])}return r}(this.hostPolicy,c),l={type:"New",driveId:i.driveId,siteUrl:i.siteUrl,filePath:d,filename:i.fileName,createLinkType:h}}if(Object(ze.d)(e)){const t=Object(ze.b)(e.tree[".protocol"]);if(0!==(null==t?void 0:t.sequenceNumber))throw new Error("Seq number in detached ODSP container should be 0")}const u=Object(rt.c)(n),p={resolvedUrl:i,docId:i.hashedDocumentId},f=Object(Ye.b)(this.persistedCache,this.nonPersistentCache,p,u,o);return $e.b.timedExecAsync(u,{eventName:"CreateNew",isWithSummaryUpload:!0,createShareLinkParam:h?JSON.stringify(h):void 0,enableShareLinkWithCreate:this.hostPolicy.enableShareLinkWithCreate,enableSingleRequestForShareLinkWithCreate:this.hostPolicy.enableSingleRequestForShareLinkWithCreate},(async t=>{var n,a,c,d;const h=Object(rt.o)(u,s,this.getStorageToken,!0),g=await r.e(165).then(r.bind(null,"psR6")).then((e=>(u.sendTelemetryEvent({eventName:"createNewModuleLoaded"}),e))).catch((e=>{throw u.sendErrorEvent({eventName:"createNewModuleLoadFailed"},e),e}));i=Object(rt.k)(l)?await g.createNewFluidFile(h,l,u,e,f.epochTracker,p,null===(n=this.hostPolicy.cacheCreateNewSummary)||void 0===n||n,!!(null===(a=this.hostPolicy.sessionOptions)||void 0===a?void 0:a.forceAccessTokenViaAuthorizationHeader),i.isClpCompliantApp,this.hostPolicy.enableSingleRequestForShareLinkWithCreate,this.hostPolicy.enableShareLinkWithCreate):await g.createNewContainerOnExistingFile(h,l,u,e,f.epochTracker,p,null===(c=this.hostPolicy.cacheCreateNewSummary)||void 0===c||c,!!(null===(d=this.hostPolicy.sessionOptions)||void 0===d?void 0:d.forceAccessTokenViaAuthorizationHeader),i.isClpCompliantApp);const m=this.createDocumentServiceCore(i,u,f,o);return t.end({docId:i.hashedDocumentId}),m}))}async createDocumentService(e,t,r){return this.createDocumentServiceCore(e,Object(rt.c)(t),void 0,r)}async createDocumentServiceCore(e,t,r,n){const o=Object(rt.g)(e),i={siteUrl:o.siteUrl,driveId:o.driveId,itemId:o.itemId},s=null!=r?r:Object(Ye.b)(this.persistedCache,this.nonPersistentCache,{resolvedUrl:o,docId:o.hashedDocumentId},t,n),a=Object(rt.o)(t,i,this.getStorageToken,!0);return tr.create(e,a,void 0===this.getWebsocketToken?void 0:async e=>Object(rt.o)(t,i,this.getWebsocketToken,!1)(e,"GetWebsocketToken"),t,s.cache,this.hostPolicy,s.epochTracker,this.socketReferenceKeyPrefix,n)}}{var nr=r("kWwJ");async function or(e,t,r,n,o,i){return Object(s.m)(O.c,"getOdspContainer",(async()=>{const a=await async function(e,t,r,n){return Object(s.m)(O.c,"createLoader",(async()=>{const o=E.h,i="my.microsoftpersonalcontent.com"===e.toLowerCase(),a=function(e,t){return Object(s.l)(O.c,"createHostStoragePolicy",(()=>({concurrentSnapshotFetch:!!t||void 0,sessionOptions:{unauthenticatedUserDisplayName:e?"MSA User":void 0,forceAccessTokenViaAuthorizationHeader:!!e||void 0}})))}(i,n),c=new rr((()=>t(e)),i?void 0:r,n,a),d=new nr.a;return new Ve.a({urlResolver:d,documentServiceFactory:c,codeLoader:{load:async()=>({module:{fluidExport:o},details:{package:"no-dynamic-package",config:{}}})}})}))}(t,r,n,o);let c;return c="string"==typeof e?await a.resolve({url:e,headers:i}):await a.createDetachedContainer({package:"no-dynamic-package",config:{}}),c}))}const ir=".pod",sr=".appdata",ar=cr=e=>ar(e)&&"url"in e,dr=lr=e=>{if(e)throw O.c.logError("loadDataStore",e.statusCode,{message:e.message},"loadDataStore"),e};class hr extends E.f{constructor(e){super(),this.config=e,this.getOdspToken=async e=>{if(O.c.logVerbose("getOdspToken","Call to get the access token for ODSP"),this.config.getOdspTokenCallback)return this.config.getOdspTokenCallback(e);throw Pe.a.odspTokenException("ODSP token callback not provided")},this.getPushChannelToken=async()=>{if(O.c.logVerbose("getPushChannelToken","Call to get an access token for PushChannel service"),this.config.getPushChannelTokenCallback)return this.config.getPushChannelTokenCallback();throw Pe.a.pushChannelTokenException("PushChannel token callback not provided")},this.refreshOdspToken=async e=>{if(O.c.logVerbose("refreshOdspToken","Call to get a refreshed access token for ODSP"),this.config.getOdspTokenCallback)return this.config.getOdspTokenCallback(e);throw Pe.a.odspTokenException("ODSP token callback not provided")},function(e){Ne()&&(null===sessionStorage||void 0===sessionStorage||sessionStorage.setItem(Ae.type,"odsp"))}(),this.validateConfiguration(),this.buildCachedCallbacks(e),this.persistedCache=void 0,this.loginInfo=this.getUserLoginInfo(),this.appId=void 0,this.userCacheKey=e.userCacheKey,this.oneDriveDomain=e.oneDriveDomain,this.loginInfo.then((async e=>{var t,r;null!==(t=this.oneDriveDomain)&&void 0!==t||(this.oneDriveDomain=e.userOneDriveDomain),null!==(r=this.userCacheKey)&&void 0!==r||(this.userCacheKey=e.userId);const n=function(e,t){return Object(s.l)(O.c,"createLoggerContext",(()=>{var r,n;return{user:{userId:e.userId,passportUserId:e.passportUserId,tenantId:e.userTenantId,tenantDataBoundaryRestriction:e.tenantDataBoundaryRestriction},appInfo:{appId:e.applicationId,appPlatform:"web",appVersion:void 0===(null===(r=t.hostConfig)||void 0===r?void 0:r.dataModelVersion)?void 0:"v"+t.hostConfig.dataModelVersion.toString(),mfsCoreVersion:"2.0.4",appHostingPlatform:t.appHostingPlatform,clientRing:null!==(n=t.clientRing)&&void 0!==n?n:""},sessionId:t.sessionId,serviceLoggingInfo:{isLoggingEnabled:e.clientLoggingInfo.isLoggingEnabled,isConsoleLoggingEnabled:e.clientLoggingInfo.isConsoleLoggingEnabled,mfsServiceBuildNumber:e.clientLoggingInfo.mfsServiceBuildNumber,mfsServiceEnvironment:e.clientLoggingInfo.mfsServiceEnvironment,ariaInfo:{token:e.clientLoggingInfo.ariaTenantToken,namespacePrefix:e.clientLoggingInfo.ariaTenantNamespace}}}}))}(e,this.config);await this.setLoggerContext(n)})).catch((e=>{!e.innerError||e.innerError.message!==S.a.NoValidOneDriveLicense&&e.innerError.message!==S.a.UserOneDriveNotProvisioned?O.c.logError("SetLoggingContextError",s.g.NotFound,{error:e},"getUserLoginInfo"):O.c.logVerbose("getUserLoginInfo","Unable to retrieve push channel info",{errorCategory:e.innerError.message})}))}async loadDataStore(e,t,r){const n=Me("loadDataStore",s.a.SINGLE),{dataStore:o,containerAttachmentCallback:i}=await this.loadDataObject(2,n,e,r,t);return Object(E.o)(Object(E.r)(o)),{dataStore:o,containerAttachmentCallback:i}}async loadDataStoreAndVolatileSession(e){const t=Me("loadDataStoreAndVolatileSession",s.a.SINGLE),{dataStore:r,volatileSession:n,containerAttachmentCallback:o}=await this.loadDataObject(6,t,lr,void 0,e);return Object(E.o)(Object(E.r)(r)),Object(E.o)(Object(E.t)(n)),{dataStore:r,volatileSession:n,containerAttachmentCallback:o}}async loadVolatileSession(e){const t=Me("loadVolatileSession",s.a.SINGLE),{volatileSession:r}=await this.loadDataObject(4,t,lr,void 0,e);return Object(E.o)(Object(E.t)(r)),{volatileSession:r}}async loadDataStores(e,t,r){var n;const o=Me("loadDataStores",s.a.SINGLE);if(!ar(e))throw Pe.a.notOdspStoreLocator();const i=cr(e)?e.url:`https://${e.siteDomain}`;if(!Object(He.m)(i))throw Pe.a.invalidOdspSite();let a,c,d="",l="";if(cr(e)){const t=new URL(e.url);d=t.hostname,l=t.pathname,O.c.logVerbose("loadDataStores","Getting drive item from sharing URL",{locator:"OdspUrlStoreLocator"});const r=await Object(He.h)(d,e.url,this.getOdspToken,this.refreshOdspToken);a=r.driveId,c=r.itemId,O.c.logVerbose("loadDataStores","Retrieved drive item",{domain:d,driveId:a,itemId:c})}else if(dr(e)){d=e.siteDomain,a=e.driveId,c=e.itemId,O.c.logVerbose("loadDataStores","Getting drive item by id",{locator:"OdspIdStoreLocator",driveItemId:c,driveId:a});const{path:t,name:r}=await Object(He.g)(d,a,c,this.getOdspToken,this.refreshOdspToken);O.c.logVerbose("loadDataStores","Retrieved driveItem",{driveItemId:c}),l=`${t}/${r}`}else d=e.siteDomain,a=e.driveId,l=null!==(n=e.partialPath)&&void 0!==n?n:"",O.c.logVerbose("loadDataStores","",{domain:d,driveId:a,locator:"OdspLibraryStoreLocator"});if(l.endsWith(ir)){if(O.c.logVerbose("loadDataStores","Locator folderPath points to a pod"),!a||!c){const e=await Object(He.f)(d,l,this.getOdspToken,this.refreshOdspToken,a);a=e.driveId,c=e.itemId,O.c.logVerbose("loadDataStores","Retrieved item",{driveId:a,driveItemId:c})}const{dataStore:e}=await this.mountPodById(d,a,2,c,o,t,r);return Object(E.o)(Object(E.r)(e)),[{dataStore:e}]}const h=await Object(He.b)(d,this.concatSharedPodPath(l),this.getOdspToken,this.refreshOdspToken,a),u=[];for(const e of h)try{const{dataStore:n}=await this.mountPodById(d,e.driveId,2,e.itemId,o,t,r);Object(E.o)(Object(E.r)(n)),u.push({dataStore:n})}catch(e){if(!e.statusCode||e.statusCode!=s.g.NotAllowed)throw e}return u}async createDataStore(e,t,r){var n;const o=Me("createDataStore",s.a.SINGLE);if(!ar(e))throw Pe.a.notOdspStoreLocator();const i=cr(e)?e.url:`https://${e.siteDomain}`;if(!Object(He.m)(i))throw Pe.a.invalidOdspSite();let a,c,d="";if(cr(e)){O.c.logVerbose("createDataStore","Locator is of type OdspUrlStoreLocator");const t=new URL(e.url).hostname;d=e.url,a=(await Object(He.h)(t,d,this.getOdspToken,this.refreshOdspToken)).driveId}else if(dr(e)){O.c.logVerbose("createDataStore","",{locator:"OdspIdStoreLocator"});const{isFolder:n,path:i,name:s}=await Object(He.g)(e.siteDomain,e.driveId,e.itemId,this.getOdspToken,this.refreshOdspToken);if(!n&&s.endsWith(ir)){O.c.logVerbose("createDataStore","Mounting pod",{driveId:e.driveId,driveItemId:e.itemId});const{dataStore:n,containerAttachmentCallback:i}=await this.mountPodById(e.siteDomain,e.driveId,2,e.itemId,o,t,r);return Object(E.o)(Object(E.r)(n)),O.c.logVerbose("createDataStore","Data store loaded from mounted pod",{dataStoreId:n.getId()}),{dataStore:n,containerAttachmentCallback:i}}d=`https://${e.siteDomain}${i}/${s}`,a=e.driveId}else O.c.logVerbose("createDataStore","",{locator:"OdspLibraryStoreLocator",domain:e.siteDomain}),d=`https://${e.siteDomain}/${(null!==(n=e.partialPath)&&void 0!==n?n:"").replace(/^\/+/,"")}`,a=e.driveId;if(d.endsWith(ir)){const e=d.split("/");c=e.pop(),d=e.join("/")}else d=this.concatSharedPodPath(d);O.c.logVerbose("createDataStore","Creating pod file at url",{driveId:a,folderPath:d});const{dataStore:l,containerAttachmentCallback:h}=await this.createPodFile(d,2,o,t,r,a,c);return Object(E.o)(Object(E.r)(l)),O.c.logVerbose("createDataStore","Data store loaded from created pod",{dataStoreId:l.getId()}),{dataStore:l,containerAttachmentCallback:h}}async unloadDataStore(e){throw Pe.a.notImplemented()}async loadDataObject(e,t,r,n,o){var i;let a,c,d;if(o)O.c.logVerbose("loadDataObject","Locating pod file",{podId:o}),({siteDomain:a,driveId:c,itemId:d}=await this.getLocatorFromPodId(o));else{if(O.c.logVerbose("loadDataObject","Getting user one drive domain"),a=null!==(i=this.oneDriveDomain)&&void 0!==i?i:(await this.loginInfo).userOneDriveDomain,!a)throw Pe.a.oneDriveDomainException();const o=await this.getDefaultPodName();try{({driveId:c,itemId:d}=await this.getDefaultPodDriveItem(a,o))}catch(i){if(i instanceof s.f&&404===i.statusCode)return this.createDefaultPod(e,t,a,o,r,n);throw i}}return this.mountPodById(a,c,e,d,t,r,n)}async createDefaultPod(e,t,r,n,o,i){const{name:s}=await Object(He.d)(r,this.getOdspToken,this.refreshOdspToken);return this.createPodFile(`https://${r}/${s}/MFS Data/Personal`,e,t,o,i,void 0,n)}async getDefaultPodName(){const e=await this.getAppId(),t=Object(He.c)(e),r=`default${t}.pod`;return O.c.logVerbose("getDefaultPodName","Returns",{appIdHash:t,defaultPodName:r}),r}async getDefaultPodDriveItem(e,t){const r=`https://${e}/_api/v2.1/drive/special/apps:/MFS Data/Personal/${t}?select=id,parentReference/driveId`;return Object(He.i)(e,r,this.getOdspToken,this.refreshOdspToken)}async recoverPodFile(e,t,r,n){this.emitMfsClientEvent("recoveryStart",{podId:n});let o=null;const i=await Object(He.j)(e,t,r,this.getOdspToken,this.refreshOdspToken);if(!0===i.isOK){const n=await this.findLastHealthyPodfile(i.value,e,t,r);if(!0===n.isOK){const i=await Object(He.n)(e,t,r,n.value,this.getOdspToken,this.refreshOdspToken);!1===i.isOK&&(o=i.error),O.c.logVerbose("recoverPodFile","File successfully restored")}else o=n.error}else o=i.error;if(this.emitMfsClientEvent("recoveryEnd",{podId:n,successfulRecovery:null===o}),o)throw o}async findLastHealthyPodfile(e,t,r,n){if(!e)return E.l.fail(new Error("Invalid OdspFileVersion array"));const o=`https://${t}`;let i=null;for(const s of e){const e=Object(ne.a)({siteUrl:o,driveId:r,itemId:n,dataStorePath:"",fileVersion:s.id});try{O.c.logVerbose("findLastHealthyPodfile","Loading pod file",{versionId:s.id}),(await or(e,t,this.getOdspToken,this.getPushChannelToken,this.persistedCache,{[y.loadMode]:{opsBeforeReturn:"cached"}})).close(),i=s,O.c.logVerbose("findLastHealthyPodfile","last Healthy Version",{lastHealthyVersion:i});break}catch(e){if(!this.isPodFileCorruptionError(e))return e instanceof Error?E.l.fail(e):E.l.fail(new Error("Error finding last healthy pod"));O.c.logVerbose("findLastHealthyPodfile","Corrupted pod file",{versionId:s.id})}}return i?E.l.ok(i):E.l.fail(new Error("Failure finding a healthy pod"))}isDriverErrorBase(e){return"object"==typeof e&&null!==e&&"errorType"in e&&"message"in e&&"canRetry"in e}async mountPodById(e,t,r,n,o,i,s){O.c.logVerbose("mountPodById","Load the data store using specified Pod ID");const a=Object(ne.a)({siteUrl:`https://${e}`,driveId:t,itemId:n,dataStorePath:""});return this.loadPod(a,e,t,r,o,!1,i,s,n,void 0)}async clearCache(){var e;if(null===(e=this.config.localStore)||void 0===e||e.clear(),this.persistedCache)return function(e){return Object(T.a)(q,void 0)}()}async createPodFile(e,t,r,n,o,i,a){O.c.logVerbose("createPodFile","Enter",{dataObjectsToLoad:t,driveId:i});const c=new URL(e),d=c.hostname,l=c.pathname;O.c.logVerbose("createPodFile",`${s.b}: getAppId`);const h=await this.getAppId();O.c.logVerbose("createPodFile",`${s.c}: getAppId`,{appId:h});const u=Object(He.c)(h),p=null!=a?a:`${Object(L.a)()}${u}.pod`;i||(O.c.logVerbose("createPodFile",`${s.b}: getDriveIdForDomain`),i=await Object(He.e)(d,this.getOdspToken,this.refreshOdspToken),O.c.logVerbose("createPodFile",`${s.c}: getDriveIdForDomain`,{driveId:i}));const f=Object(He.a)(c,p,i);return this.loadPod(f,d,i,t,r,!0,n,o,void 0,`${l}/${p}`)}async loadPod(e,t,r,n,o,i,a,c,d,l){var h;if(!this.config.disableCache&&!this.persistedCache){const e={partitionKey:null!==(h=this.userCacheKey)&&void 0!==h?h:(await this.loginInfo).userId,maxCacheItemAge:2592e5};this.persistedCache=new re(e)}let u,p;try{u=await or(e,t,this.getOdspToken,this.getPushChannelToken,this.persistedCache,{[y.loadMode]:{opsBeforeReturn:"cached",deltaConnection:"delayed"}})}catch(e){if(this.isPodFileCorruptionError(e)&&d){const e=await this.toPodId(t,r,d),n={podId:e};throw this.recoverPodFile(t,r,d,e).then((()=>{O.c.logInfo("podRecoverySuccess","Pod recovered successfully","podRecovery",n)})).catch((e=>{O.c.logError("podRecoveryFailed",s.g.DataCorruption,{message:"Pod recovery failed",error:e},"podRecovery",n)})),Pe.a.corruptedPodFileError()}throw e}const f=await this.getAppId(),g=await async function(e){return Object(s.m)(O.c,"loadMfsSystemDataObject",(async()=>(O.c.logVerbose("loadMfsSystemDataObject",`Getting object with MFS_VOLATILE_SESSION_ID: ${E.e}`),Object(Le.a)(E.e,e))))}(u);if(i)O.c.logVerbose("loadPod","Setting appId",{appId:f}),g.setAppId(f),p="detachedPodId";else{[p,d]=await this.getPodIdFromODSP(t,r,d,l),O.c.logInfo("LoadPod","Load Pod for User","LoadPod",{podId:p,driveId:r,itemId:d});const e=g.getAppId();if(e&&e!=f)throw Pe.a.appNotAllowedToAccessPod(f,e);[p,d]=await this.getPodIdFromODSP(t,r,d,l),Be(p)}const m=new E.i(f,this.config.hostConfig);let b;try{if(b=await async function(e,t,r,n){return Object(s.m)(O.c,"loadDataObjects",(async()=>{const o=2==(2&e),i=4==(4&e);if(o&&i)return O.c.logVerbose("loadDataObjects",`Returning MFS_DATA_STORE_ID: ${E.d} and MFS_VOLATILE_SESSION_ID: ${E.e}`),Promise.all([Ue(E.d,n,t,r),Ue(E.e,n,t,r)]).then(();if(o&&!i)return O.c.logVerbose("loadDataObjects",`Returning MFS_DATA_STORE_ID: ${E.d}`),{dataStore:await Ue(E.d,n,t,r)};if(!o&&i)return O.c.logVerbose("loadDataObjects",`Returning MFS_VOLATILE_SESSION_ID: ${E.e}`),{volatileSession:await Ue(E.e,n,t,r,!0)};throw O.c.logVerbose("loadDataObjects","Invalid dataObjectsToLoad:",{dataObjectsToLoad:e}),Pe.a.invalidLoadOptions()}))}(n,u,m,p),!b)throw new s.f("Failed to load data objects, loadDataObjects returned undefined",s.g.UnhandledException);if(i||(this.emitMfsClientEvent("readyToRead",{podId:p}),O.c.endActivitySuccess(o.readyToRead,s.i)),!Object(E.r)(b.dataStore))throw new s.f("Load data objects did not return a MfsDataStore",s.g.UnhandledException);const h=b.dataStore;if(i&&"string"!=typeof e){if(c)try{await c(h)}catch(e){}b.containerAttachmentCallback=async()=>u.attach(e).then((async()=>{[p,d]=await this.getPodIdFromODSP(t,r,d,l),h.setId(p),Be(p),await this.waitForUpdates(u),this.trackContainerForIdleDisconnects(u),this.attemptCompletionCallback(a),O.c.logInfo("LoadPod","Load Pod for User","LoadPod",{podId:p}),O.c.logVerbose("loadPod","Detached Pod has been attached successfully")})).catch((e=>{O.c.logVerbose("loadPod","Detached Pod failed to attach"),this.attemptCompletionCallback(a,e)}))}}catch(e){throw i||O.c.endActivityFailure(o.readyToRead,e),e}return this.attachEventListeners(u,E.a),O.c.logVerbose("loadPod","Waiting for Fluid container to catch up..."),i||(O.c.logVerbose("loadPod","Waiting for updates from pod",{podId:p}),await this.waitForUpdates(u,p,o),p&&o&&this.emitReadyToWriteEvent(p,o),this.trackContainerForIdleDisconnects(u),this.attemptCompletionCallback(a)),b}trackContainerForIdleDisconnects(e){var t;null===(t=this.config.idleTracker)||void 0===t||t.then(().catch((e=>{const t=e instanceof Error?e:void 0;O.c.logError("containerTrackingError",s.g.ExpectationFailed,{message:"Error while idle-tracking container",error:t},"trackContainerForIdleDisconnects")}))}async setLoggerContext(e){try{if(this.config.sinkCallback)return void await async function(e,t){return Object(s.m)(O.c,"setLoggingContextFromCallback",(async()=>xe(e,await t())))}(e,this.config.sinkCallback)}catch(e){let t={message:"sinkCallback threw an error. Will set Websink using setLoggingContext or sink param"};e instanceof Error&&(t={...t,error:e}),O.c.logError("SetLoggingContextError",s.g.BadRequest,t,"setLoggingContextFromCallback")}this.config.setLoggingContext?this.config.setLoggingContext(e,this.config.sink):xe(e,this.config.sink)}attemptCompletionCallback(e,t){try{e(t)}catch(e){}}async getPodIdFromODSP(e,t,r,n){return new Promise((async o=>{if(!r){const o=await Object(He.f)(e,null!=n?n:"",this.getOdspToken,this.refreshOdspToken,t);r=o.itemId}const i=await this.toPodId(e,t,r);O.c.logVerbose("getPodIdFromODSP","",{podId:i,itemId:r}),o([i,r])}))}async waitForUpdates(e,t,r){if(this.config.waitForUpdates)try{await Object(C.b)(e)}catch(e){throw r&&O.c.endActivityFailure(r.readyToWrite,e),Pe.a.containerCatchUpException(e instanceof Error?e.message:void 0)}else Object(C.b)(e).catch((e=>{throw r&&O.c.endActivityFailure(r.readyToWrite,e),Pe.a.containerCatchUpException(e instanceof Error?e.message:void 0)}))}emitReadyToWriteEvent(e,t){this.emitMfsClientEvent("readyToWrite",{podId:e}),O.c.endActivitySuccess(t.readyToWrite,s.i),O.c.logInfo("fluidContainerReady","Fluid container is ready to write.","fluidContainerReady"),O.c.logVerbose("emitReadyToWriteEvent","Emitted ready to write",{podId:e})}isPodFileCorruptionError(e){return this.isDriverErrorBase(e)&&e.errorType===w.a.genericNetworkError&&"innerMostErrorCode"in e&&"fluidInvalidSchema"===(null==e?void 0:e.innerMostErrorCode)}async getUserLoginInfo(){const e=!!this.config.oneDriveDomain;return Object(S.c)(this.config.getAccessTokenCallback,this.config.sessionId,e,this.config.mfsServiceDomain).then((e=>{var t,r;if(!1===e.success||!e.pushChannelInfo){const n=new Error(null===(t=e.error)||void 0===t?void 0:t.errorCategory);throw Pe.a.getUserPushChannelInfoException(null===(r=e.error)||void 0===r?void 0:r.message,n)}return e.pushChannelInfo}))}concatSharedPodPath(e){const t=e.replace(/^\/+|\/+$/g,"");return t.endsWith(sr)?(O.c.logVerbose("concatSharedPodPath","",{folderPath:sr}),t):t.split("/").length>1||t.length>0?t.concat("/.appdata"):t.concat(".appdata")}async toPodId(e,t,r){const n=await this.getAppId();return(e=>window.btoa(e))(`ODSP|${e.toLowerCase()}|${t}|${r}|${n}`)}async getLocatorFromPodId(e){const t=Fe(e);if(!t.startsWith("ODSP"))throw Pe.a.invalidPodId();const r=t.split("|");if(await this.getAppId()!==r[4])throw Pe.a.podFileNameHasIncorrectSuffix();return{siteDomain:r[1],driveId:r[2],itemId:r[3]}}async getAppId(){return this.appId||(this.appId=(await this.loginInfo).applicationId),O.c.logVerbose("getAppId","",{appId:this.appId}),this.appId}buildCachedCallbacks(e){this.config.getOdspTokenCallback=function(e){return e&&Ne()?async t=>{const r=await e(t);return null===sessionStorage||void 0===sessionStorage||sessionStorage.setItem(Ae.odsp,r),r}:e}(e.getOdspTokenCallback),this.config.getAccessTokenCallback=De("access",e.getAccessTokenCallback),this.config.getPushChannelTokenCallback=e.getPushChannelTokenCallback?De("push",e.getPushChannelTokenCallback):e.getPushChannelTokenCallback}validateConfiguration(){if(this.config.oneDriveDomain&&!Object(He.l)(this.config.oneDriveDomain)){const e=Pe.a.invalidDomain(this.config.oneDriveDomain);throw O.c.logError("validateConfiguration",s.g.BadRequest,{error:e},"domainValidation",{domain:this.config.oneDriveDomain}),e}}}Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Function,String,Function]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"loadDataStore",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"loadDataStoreAndVolatileSession",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"loadVolatileSession",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object,Function,Function]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"loadDataStores",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object,Function,Function]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"createDataStore",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"unloadDataStore",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Number,Object,Function,Function,String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"loadDataObject",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Number,Object,String,String,Function,Function]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"createDefaultPod",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"getDefaultPodName",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String,String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"getDefaultPodDriveItem",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String,String,String,String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"recoverPodFile",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object,String,String,String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"findLastHealthyPodfile",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",Boolean)],hr.prototype,"isDriverErrorBase",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String,String,Number,String,Object,Function,Function]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"mountPodById",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"clearCache",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String,Number,Object,Function,Function,String,String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"createPodFile",null),Object(n.__decorate)([Object(O.a)(s.a.NONE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object,String,String,Number,Object,Boolean,Function,Function,String,String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"loadPod",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",void 0)],hr.prototype,"trackContainerForIdleDisconnects",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"setLoggerContext",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Function,s.f]),Object(n.__metadata)("design:returntype",void 0)],hr.prototype,"attemptCompletionCallback",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String,String,String,String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"getPodIdFromODSP",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object,String,Object]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"waitForUpdates",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String,Object]),Object(n.__metadata)("design:returntype",void 0)],hr.prototype,"emitReadyToWriteEvent",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",Boolean)],hr.prototype,"isPodFileCorruptionError",null),Object(n.__decorate)([Object(O.a)(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"getUserLoginInfo",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String]),Object(n.__metadata)("design:returntype",String)],hr.prototype,"concatSharedPodPath",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String,String,String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"toPodId",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"getLocatorFromPodId",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",Promise)],hr.prototype,"getAppId",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[Object]),Object(n.__metadata)("design:returntype",void 0)],hr.prototype,"buildCachedCallbacks",null),Object(n.__decorate)([Object(O.b)(),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",void 0)],hr.prototype,"validateConfiguration",null);const ur=s.e.getInstance().getMfsLogger("local-store"),pr=Object(s.j)(ur);class fr{constructor(){this.localStorage=function(){const e=function(){return new s.f("Environment is not a browser",s.g.NotAllowed)}(),t=function(){return new s.f("Local storage is not defined for this browser",s.g.NotFound)}();if(!s.d)throw ur.logError("LocalStoreNotBrowserError",e.statusCode,{message:e.message},"getLocalStorage"),e;const r=window.localStorage;if(!r)throw ur.logError("LocalStoreUnavailableError",t.statusCode,{message:t.message},"getLocalStorage"),t;return r}()}et(e,t){try{this.localStorage.setItem(e,t)}catch(e){if(function(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)}(e))throw function(){return new s.f("Storage capacity in local storage has exceeded. Cannot add/update the new item",s.g.NotAllowed)}()}}removeEntry(e){this.localStorage.removeItem(e)}Object(n.__decorate)([pr(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String]),Object(n.__metadata)("design:returntype",Object)],fr.prototype,"get",null),Object(n.__decorate)([pr(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String,String]),Object(n.__metadata)("design:returntype",void 0)],fr.prototype,"set",null),Object(n.__decorate)([pr(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[String]),Object(n.__metadata)("design:returntype",void 0)],fr.prototype,"removeEntry",null),Object(n.__decorate)([pr(s.a.SINGLE),Object(n.__metadata)("design:type",Function),Object(n.__metadata)("design:paramtypes",[]),Object(n.__metadata)("design:returntype",void 0)],fr.prototype,"clear",null);var gr=r("pRW0"),mr=r("/6iw"),br=r("dkAV"),vr=r("AVrd");class yr{constructor(e){var t,r;this.config=e,this.mfsLocalStore=s.d?new fr:void 0;const n=this.initializeConfigProvider(),o=this.createIdleTracker(n),i=new hr({hostConfig:{},getAccessTokenCallback:this.config.mfsAccessTokenCallback,getOdspTokenCallback:this.config.odspAccessTokenCallback,getPushChannelTokenCallback:this.config.pushChannelTokenCallback,sessionId:this.config.sessionId,waitForUpdates:null===(t=this.config.waitForUpdates)||void 0===t||t,sink:this.config.sink,sinkCallback:this.config.sinkCallback,disableCache:null!==(r=this.config.disableCache)&&void 0!==r&&r,setLoggingContext:userCacheKey:e.userCacheKey,oneDriveDomain:e.oneDriveDomain,localStore:this.mfsLocalStore,idleTracker:o});e.appId!==br.c&&Reflect.set(i,"appId",br.c),this.mfsClient=i}async build(){const{dataStore:e,containerAttachmentCallback:t}=await this.getDatastore();return await gr.a.initialize(e,this.mfsClient.clearCache.bind(this.mfsClient),t)}async getDatastore(){try{let e;const t=Object(mr.b)(this.config.completedCallback);if(this.isPodFolderLocator(this.config.podLocation)){const r={type:"odsp",...this.config.podLocation};e=await this.mfsClient.createDataStore(r,t)}else if(this.isPersonalPodLocator(this.config.podLocation))e=this.config.disableCache||!this.mfsLocalStore?await this.mfsClient.loadDataStore(t):await this.loadDataStoreFromCache(this.mfsLocalStore,t);else{const r=this.config.podLocation;e=await this.mfsClient.loadDataStore(t,r)}return e}catch(e){throw Object(mr.a)("Failed to create or load datastore",e)}}isPersonalPodLocator(e){return"string"==typeof e&&e===br.h}sync loadDataStoreFromCache(e,t){const r=this.config.userCacheKey),n=e.get(r);let o;if(n)try{return o=await this.mfsClient.loadDataStore(t,n),vr.c.logVerbose("loadDataStoreFromCache","Retrieved podId from cache and loaded default pod",{podId:n}),o}catch(t){e.removeEntry(r),vr.c.logVerbose("loadDataStoreFromCache","Cached podId invalidated as pod no longer exists",{podId:n})}return o=await this.mfsClient.loadDataStore(t),function(e,t,r,n){if(n.getId()==br.b){const o=async()=>{t.set(r,n.getId()),e.off(br.i,o)};e.on(br.i,o)}else t.set(r,n.getId())}(this.mfsClient,e,r,o.dataStore),vr.c.logVerbose("loadDataStoreFromCache","Cache empty, updating cache with new podId and loaded default pod",{podId:o.dataStore.getId()}),o}initializeConfigProvider(){_.initialize({getAccessTokenCallback:this.config.mfsAccessTokenCallback,sessionId:this.config.sessionId});const e=_.getInstance();return e.start(),e}async createIdleTracker(e){let t;try{const r=await e.retrieveClientConfig();t=new m({isEnabled:r.containerDisconnects.enableContainerDisconnects,idleTimeoutMs:r.containerDisconnects.allottedTimeBeforeDisconnectMilliseconds})}catch(e){const r=e instanceof Error?e:void 0;vr.c.logError("idleTrackerInitializeError",s.g.UnprocessableEntity,{error:r},"createIdleTracker"),t=new m({isEnabled:!1,idleTimeoutMs:0})}return e.on("clientConfigChanged",(e=>{t.changeConfiguration({isEnabled:e.containerDisconnects.enableContainerDisconnects,idleTimeoutMs:e.containerDisconnects.allottedTimeBeforeDisconnectMilliseconds})})),t}}var Or,Sr=r("9UhD"),Er=r("Lywj");!function(e){e.Folder="Folder",e.Word="WordDocument",e.Excel="ExcelDocument",e.PowerPoint="PowerPointDocument"}(Or||(Or={}));const _r={value:Or.Folder}},eb2x:function(module,exports,__webpack_require__){(function(process,global){var __WEBPACK_AMD_DEFINE_RESULT__;(function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD=__webpack_require__("K2jg"),ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=,!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=;var createOutputMethod=createMethod=nodeWrap=createHmacOutputMethod=createHmacMethod=a256.prototype.update=Sha256.prototype.finalize=Sha256.prototype.hash=Sha256.prototype.hex=Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))})()}).call(this,__webpack_require__("5IsQ"),__webpack_require__("pCvA"))},"f/DM":function(e,t,r){"use strict";function n(e){let t=`${e.siteUrl}?driveId=${encodeURIComponent(e.driveId)}&itemId=${encodeURIComponent(e.itemId)}&path=${encodeURIComponent(e.dataStorePath)}`;return e.containerPackageName&&(t+=`&containerPackageName=${encodeURIComponent(e.containerPackageName)}`),e.fileVersion&&(t+=`&fileVersion=${encodeURIComponent(e.fileVersion)}`),t}r.d(t,"a",(function(){return n}))},gdCR:function(e,t,r){var n=r("8/K7");t.operation=t.timeouts=t.createTimeout=t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var o in n=[],e)"function"==typeof e[o]&&n.push(o);for(var i=0;i<n.length;i++){var s=n[i];e[s]=bind(e,e[s]),e[s].options=r}}},hpQ0:function(e,t,r){"use strict";r.d(t,"j",(function(){return b})),r.d(t,"h",(function(){return v})),r.d(t,"i",(function(){return y})),r.d(t,"f",(function(){return O})),r.d(t,"e",(function(){return S})),r.d(t,"d",(function(){return E})),r.d(t,"k",(function(){return _})),r.d(t,"g",(function(){return C})),r.d(t,"c",(function(){return w})),r.d(t,"o",(function(){return T})),r.d(t,"b",(function(){return I})),r.d(t,"l",(function(){return j})),r.d(t,"a",(function(){return k})),r.d(t,"m",(function(){return R})),r.d(t,"n",(function(){return D})),r.d(t,"p",(function(){return A}));var n=r("DX81"),o=r("1bkS"),i=r("rK/e"),s=r("he5V"),a=r("Unhj"),c=r("zQYL"),d=r("mOo8"),l=r("V0Op");const h=e=>null===e||"string"==typeof e?e:void 0===e?null:e.token,u=e=>null===e||"string"==typeof e?void 0:e.fromCache;var p=r("mwlv"),f=r("KSUX"),g=r.n(f),m=r("FiVw");const b="getWithRetryForTokenRefreshRepeat",v=async function y(e){return e({refresh:!1}).catch((async t=>{const r={refresh:!0,previousError:t};switch(t.errorType){case n.a.authorizationError:return e(Object.assign(Object.assign({},r),{claims:t.claims,tenantId:t.tenantId}));case n.a.incorrectServerResponse:case l.a.fetchTokenError:return e(r);default:if(!0===t[b])return e(r);throw t}}))}async function O(e,t){const r=i.a.now();return(async(e,t)=>g()(e,t))(e,t).then((async e=>{const t=e;if(!t)throw new o.f("No response from ODSP fetch call",n.a.incorrectServerResponse,{driverVersion:m.a});(!t.ok||t.status<200||t.status>=300)&&Object(d.e)(`ODSP fetch error [${t.status}]`,t.status,t,await t.text());const s=function(e){const t=new Map;for(const[r,n]of e.entries())t.set(r,n);return t}(t.headers);return{content:t,headers:s,propsToLog:Object(d.c)(s),duration:i.a.now()-r}}),(e=>{const t=Object(o.o)(),r={value:`${e}`,tag:a.c.UserData},i=r.value.replace(/((http|https):\/\/(\S*))/i,"REDACTED_URL");if("AbortError"===e.name)throw new o.h("Fetch Timeout (AbortError)",l.a.fetchTimeout,{driverVersion:m.a});if(i.includes("ETIMEDOUT"))throw new o.h("Fetch Timeout (ETIMEDOUT)",l.a.fetchTimeout,{driverVersion:m.a});throw t===o.g.Offline?new o.h(`ODSP fetch failure (Offline): ${i}`,n.a.offlineError,{driverVersion:m.a,rawErrorMessage:r}):new o.h(`ODSP fetch failure: ${i}`,n.a.fetchFailure,{driverVersion:m.a,rawErrorMessage:r})}))}async function S(e,t){const{content:r,headers:n,propsToLog:o,duration:i}=await O(e,t),s=await r.arrayBuffer();return o.bodySize=s.byteLength,{headers:n,content:s,propsToLog:o,duration:i}}async function E(e,t){const{content:r,headers:n,propsToLog:o,duration:i}=await O(e,t);let s;try{s=await r.text()}catch(e){Object(d.e)("Error while parsing fetch response",d.b,r,s)}return o.bodySize=s.length,{headers:n,content:JSON.parse(s),propsToLog:o,duration:i}}unction C(e){return Object(s.a)(!0===e.odspResolvedUrl,478),e}const w=e=>a.a.create(e,"OdspDriver",{all:{driverVersion:m.a}});function T(e,t,r,n){return async function(i,s){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a.b.timedExecAsync(e,{eventName:`${s}_GetToken`,attempts:i.refresh?2:1,hasClaims:!!i.claims,hasTenantId:!!i.tenantId},(async e=>r(Object.assign(Object.assign({},i),t)).then((t=>{const r=h(t);if((d||e.duration>=32)&&e.end({fromCache:u(t),isNull:null===r}),null===r&&n)throw new o.f("The Host-provided token fetcher returned null",l.a.fetchTokenError,{method:s,driverVersion:m.a});return r}),(e=>{const t=null==e?void 0:e.canRetry;throw Object(c.h)(e,(e=>new o.e("The Host-provided token fetcher threw an error",l.a.fetchTokenError,"boolean"==typeof t&&t,{method:s,errorMessage:e,driverVersion:m.a})))}))),{cancel:"generic"})}}function I(e){var t;return{type:p.b,key:null!==(t=e.fileVersion)&&void 0!==t?t:"",file:{resolvedUrl:e,docId:e.hashedDocumentId}}}const j=79872;function k(e){if(!e)return;const t=e.scope;if(!t)return`createLinkType=${e}`;let r=`createLinkScope=${t}`;const n=e.role;return r=n?`${r}&createLinkRole=${n}`:r,r}function R(e){const t=i.a.now();return[e(),i.a.now()-t]}async function D(e){const t=i.a.now();return[await e(),i.a.now()-t]}function A(e,t,r,n){if(0!==t.length){const o=t[0].sequenceNumber,i=t.length,s=t[i-1].sequenceNumber;o!==r&&(n.sendErrorEvent({eventName:"OpsFetchViolation",reason:e,from:r,start:o,last:s,length:i}),t.length=0),s+1!==r+i&&(n.sendErrorEvent({eventName:"OpsFetchViolation",reason:e,from:r,start:o,last:s,length:i}),t.length=0)}}},ijzj:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=i(r("Io9h")),o=i(r("riBb"));ar s=a=500,c=3e4,d={capture:!1,passive:!1};t.default=class{constructor(e){var t=this,{timeout:r=c,onIdleCallback:i=s,events:l=n.default,throttle:h=a}=e;this.start=function(e){var{onIdleCallback:r}=void 0===e?{}:e;t.callback=r||t.callback,t.handleEvent=t.handleEvent.bind(t),t.listeners=t.events.map((e=>(document.addEventListener(e,t.handleEvent,!!o.default&&d),e))),t.startTimer.call(t)},this.startTimer=()=>{this.state.lastActive=Date.now(),this.resetTimer()},this.handleEvent=e=>{Date.now()-this.state.lastActive<this.throttleTime||("mousemove"!==e.type&&"touchmove"!==e.type||this.resetTimer(e),this.state.idle&&this.callback({event:e,idle:!1}),this.state.idle=!1,this.resetTimer())},this.resetTimer=e=>{var t=Date.now();this.clearTimer(),this.state.lastActive=t,this.timer=setTimeout((()=>{this.state.idle||this.callback({event:e,idle:!0}),this.state.idle=!0,this.resetTimer(e)}),this.timeout)},this.isIdle=this.clearTimer=this.end=()=>{this.listeners.length&&this.listeners.forEach((e=>document.removeEventListener(e,this.handleEvent,!!o.default&&d))),this.clearTimer()},this.callback=i,this.events=l,this.listeners=[],this.throttleTime=h,this.timeout=r,this.timer=null,this.state={idle:!1,lastActive:0}}}},kWwJ:function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var n=r("he5V"),o=r("75Dz"),i=r("DX81"),s=r("nmwP"),a=r("1bkS"),c=r("f/DM"),d=r("KqdK"),l=r("hpQ0"),h=r("Xou4"),u=r("5zuf"),p=r("1Z3m"),f=r("FiVw");function g(e,t,r,n){const o=new URL(e).origin,i=n?`versions/${n}/`:"";return`${Object(d.a)(o)}/drives/${t}/items/${r}/${i}`}function m(e,t,r,n){return`${g(e,t,r,n)}opStream/snapshots`}function b(e,t,r,n){return`${g(e,t,r,n)}opStream/attachment`}function v(e,t,r,n){return`${g(e,t,r,n)}opStream/attachments`}function y(e,t,r,n){return`${g(e,t,r,n)}opStream`}class O{constructor(){}async resolve(e){var t,r,c,d;if(null===(t=e.headers)||void 0===t?void 0:t[o.a.createNew]){const[t,n]=e.url.split("?"),c=new URLSearchParams(n),d=e.headers[o.a.createNew].fileName,l=c.get("driveId"),h=c.get("path"),u=c.get("containerPackageName"),g=c.get("createLinkType");if(!(d&&t&&l&&null!=h))throw new a.f("Proper new file params should be there!!",i.a.genericError,{driverVersion:f.a});let m;return g&&g in s.a&&(m={createLink:{type:s.a[g]}}),{endpoints:{snapshotStorageUrl:"",attachmentGETStorageUrl:"",attachmentPOSTStorageUrl:"",deltaStorageUrl:""},tokens:{},type:"fluid",odspResolvedUrl:!0,id:"odspCreateNew",url:`fluid-odsp://${t}?${n}&version=null`,siteUrl:t,hashedDocumentId:"",driveId:l,itemId:"",fileName:d,summarizer:!1,codeHint:{containerPackageName:null!=u?u:void 0},fileVersion:void 0,shareLinkInfo:m,isClpCompliantApp:null===(r=e.headers)||void 0===r?void 0:r[p.a.isClpCompliantApp]}}const{siteUrl:l,driveId:g,itemId:O,path:S,containerPackageName:E,fileVersion:_}=function(e){const[t,r]=e.split("?"),n=new URLSearchParams(r),o=n.get("driveId"),i=n.get("itemId"),s=n.get("path"),a=n.get("containerPackageName"),c=n.get("fileVersion");if(null===o)throw new Error("ODSP URL did not contain a drive id");if(null===i)throw new Error("ODSP Url did not contain an item id");if(null===s)throw new Error("ODSP Url did not contain a path");return{siteUrl:t,driveId:decodeURIComponent(o),itemId:decodeURIComponent(i),path:decodeURIComponent(s),containerPackageName:a?decodeURIComponent(a):void 0,fileVersion:c?decodeURIComponent(c):void 0}}(e.url),C=await async function(e,t){const r=h.a.from(`${e}_${t}`);return encodeURIComponent(await Object(u.b)(r,"SHA-256","base64"))}(g,O);Object(n.a)(!C.includes("/"),168);const w=`fluid-odsp://placeholder/placeholder/${C}/${S)}`,T=!!(null===(c=e.headers)||void 0===c?void 0:c[o.a.summarizingClient]);return{type:"fluid",odspResolvedUrl:!0,endpoints:{snapshotStorageUrl:m(l,g,O,_),attachmentPOSTStorageUrl:b(l,g,O,_),attachmentGETStorageUrl:v(l,g,O,_),deltaStorageUrl:y(l,g,O,_)},id:C,tokens:{},url:w,hashedDocumentId:C,siteUrl:l,driveId:g,itemId:O,dataStorePath:S,fileName:"",summarizer:T,codeHint:{containerPackageName:E},fileVersion:_,isClpCompliantApp:null===(d=e.headers)||void 0===d?void 0:d[p.a.isClpCompliantApp]}}async getAbsoluteUrl(e,t,r){var n,o,i,s;const a=Object(l.g)(e);let d,h=t;return""===t&&void 0!==a.dataStorePath&&(h=a.dataStorePath),h.startsWith("/")&&(h=h.substr(1)),d=r&&"name"in r?r.name:(e=>"object"==typeof e&&"string"==typeof(null==e?void 0:e.name)&&"object"==typeof(null==e?void 0:e.fluid))(null===(n=r)||void 0===n?void 0:n.package)?null===(o=r)||void 0===o?void 0:o.package.name:null===(i=r)||void 0===i?void 0:i.package,d=null!=d?d:null===(s=a.codeHint)||void 0===s?void 0:s.containerPackageName,Object(c.a)(Object.assign(Object.assign({},a),{containerPackageName:d,dataStorePath:h}))}}},mOo8:function(e,t,r){"use strict";r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return g})),r.d(t,"a",(function(){return y})),r.d(t,"e",(function(){return S})),r.d(t,"d",(function(){return E}));var n=r("DX81"),o=r("Unhj"),i=r("zQYL"),s=r("1bkS"),a=r("V0Op"),c=r("nCVa");function d(e){const t=e.get("www-authenticate");if(!t)return;let r,n=!1;return t.split(",").map((e=>{const t=e.split("=");t.length>=2&&(n||"error"!==t[0].trim().toLowerCase()?r||"claims"!==t[0].trim().toLowerCase()||(r=Object(c.a)(JSON.parse(e.substring(e.indexOf("=")+1).trim()))):n="insufficient_claims"===JSON.parse(t[1].trim().toLowerCase()))})),n?r:void 0}const l="Bearer";function h(e){const t=e.get("www-authenticate");if(!t)return;const r=t.indexOf(l);if(r<0)return;let n;return t.substring(r+l.length).split(",").map((e=>{if(!n){const t=e.split("=");t.length>=2&&"realm"===t[0].trim().toLowerCase()&&(n=JSON.parse(t[1].trim()))}})),n}const u="2.0.0-internal.4.3.0",p=712,f="serviceReadOnly";function g(e){const t={sprequestduration:o.d.numberFromString(e.get("sprequestduration")),contentsize:o.d.numberFromString(e.get("content-length"))};[{headerName:"sprequestguid",logName:"sprequestguid"},{headerName:"request-id",logName:"requestId"},{headerName:"client-request-id",logName:"clientRequestId"},{headerName:"x-msedge-ref",logName:"xMsedgeRef"},{headerName:"X-Fluid-Retries",logName:"serverRetries"},{headerName:"content-encoding",logName:"contentEncoding"},{headerName:"content-type",logName:"contentType"}].forEach((r=>{const n=e.get(r.headerName);null!=n&&(t[r.logName]=n)}));const r=e.get("x-fluid-telemetry");if(null!=r){t.xFluidTelemetry=r;const e=r.split(",").map(();for(const[r,n]of e)if("Origin"===r.trim()){let e;switch(null==n?void 0:n.trim()){case"c":e="cache";break;case"g":e="graph";break;default:e=null==n?void 0:n.trim()}t.responseOrigin=e;break}}return t}class m extends i.a{constructor(e,t,r){super(e,r,new Set(["redirectLocation"])),this.redirectLocation=t,this.errorType=n.a.fileNotFoundOrAccessDeniedError,this.canRetry=!1}}function b(e){try{if(void 0!==e){const t=JSON.parse(e);if(function(e){const t=null==e?void 0:e.error;return"string"==typeof(null==t?void 0:t.message)&&(void 0===(null==t?void 0:t.code)||"string"==typeof(null==t?void 0:t.code))}(t))return{success:!0,errorResponse:t}}}catch(e){}return{success:!1}}function v(e){const t=[];let r=e.error;for(;"object"==typeof r&&null!==r;)void 0!==r.code&&t.unshift(r.code),r=r.innerError;return t}function y(e,t,r,o,i){let c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};var l;let g;const y=b(i);let S,E,_;if(y.success){const e=y.errorResponse;c.responseMessage=e.error.message,S=v(e),void 0!==S&&(E=S[0],c.innerMostErrorCode=E)}const C=Object.assign({driverVersion:u,statusCode:t},c);switch(t){case 400:if("fluidInvalidSchema"===E){g=new s.c(e,C);break}g=new s.f(e,n.a.genericNetworkError,C);break;case 401:case 403:if(E===f)g=new s.h(e,a.a.serviceReadOnly,C);else{const t=(null==o?void 0:o.headers)?d(o.headers):void 0,r=(null==o?void 0:o.headers)?h(o.headers):void 0;g=new s.a(e,t,r,C)}break;case 404:if(y.success){const t=null===(l=null==y?void 0:y.errorResponse)||void 0===l?void 0:l.error;if(_=null==t?void 0:t["@error.redirectLocation"],void 0!==_){g=new m(e,_,C);break}}g=new s.f(e,n.a.fileNotFoundOrAccessDeniedError,C);break;case 406:g=new s.f(e,n.a.unsupportedClientProtocolVersion,C);break;case 410:g=new s.f(e,a.a.cannotCatchUp,C);break;case 409:g=new s.f(e,n.a.fileOverwrittenInStorage,C);break;case 412:g=new s.f(e,n.a.genericNetworkError,C);break;case 413:g=new s.f(e,a.a.snapshotTooBig,C);break;case 414:g=new s.f(e,a.a.invalidFileNameError,C);break;case 423:if("resourceLocked"===E){g=new s.f(e,n.a.fileIsLocked,C);break}case 500:g=new s.h(e,n.a.genericNetworkError,C);break;case 501:g=new s.f(e,a.a.fluidNotEnabled,C);break;case 507:g=new s.f(e,a.a.outOfStorageError,C);break;case p:g=new s.f(e,n.a.incorrectServerResponse,C);break;default:const t=void 0!==r?1e3*r:void 0;g=Object(s.k)(e,{canRetry:!0,retryAfterMs:t},C)}return O(g,o,S,void 0),g}function O(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var o;if(e.online=s.g[Object(s.o)()],void 0!==r&&(e.facetCodes=r),t&&(n.responseType=t.type,t.headers)){const r=g(t.headers);for(const e of Object.keys(r))n[e]=r[e];e.serverEpoch=null!==(o=t.headers.get("x-fluid-epoch"))&&void 0!==o?o:void 0}return e.addTelemetryProperties(n),e}function S(e,t,r,n,o){const i=y(e,t,function(e){if(null===e)return;const t=Number(e);return Number.isNaN(t)?void 0:t}(r.headers.get("retry-after")),r,n,o);throw i.addTelemetryProperties({odspError:!0,storageServiceError:!0}),i},mwlv:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return o}));const n="snapshot";function o(e){return`${e.file.docId}_${e.type}_${e.key}`}},nmwP:function(e,t,r){"use strict";var n,o,i;r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return i})),function(e){e.csl="csl"}(n||(n={})),o||(o={})),function(e){e.view="view",e.edit="edit"}(i||(i={}))},riBb:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=!1;if("undefined"!=typeof window)try{var o=Object.defineProperty({},"passive",{get:),i=()=>{};window.addEventListener("test",i,o),window.removeEventListener("test",i,o)}catch(e){n=!1}t.default=n},zQYL:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"e",(function(){return s})),r.d(t,"g",(function(){return c})),r.d(t,"c",(function(){return l})),r.d(t,"h",(function(){return h})),r.d(t,"f",(function(){return p})),r.d(t,"d",(function(){return m})),r.d(t,"a",(function(){return b}));var n=r("A3AF"),o=r("2qH7");function i(e,t){const r={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if((e=>null!==e&&!Array.isArray(e)&&"object"==typeof e)(e)){const{errorType:n,stack:o,name:i}=e;"string"==typeof n&&(r.errorType=n),"string"==typeof o&&(r.stack=((e,r)=>{if(!t)return e;const n=e.split("\n");return n.shift(),void 0!==r&&n.unshift(r),n.join("\n")})(o,"string"==typeof i?i:void 0))}return r}const s=function a(e){void 0===e.errorInstanceId&&(e.errorInstanceId=Object(n.a)())}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;if(Object(o.c)(e)&&a(e),Object(o.b)(e))return e.addTelemetryProperties(null!==(r=t.props)&&void 0!==r?r:{}),e;const{message:n,stack:s}=i(e,!1),d=new y({message:n,stack:s});if("object"==typeof e&&null!==e){const{canRetry:t,retryAfterSeconds:r}=e;Object.assign(c,{canRetry:t,retryAfterSeconds:r})}"object"!=typeof e&&d.addTelemetryProperties({typeofError:typeof e});const l=b.typeCheck(e)?e.getTelemetryProperties():{untrustedOrigin:1};return d.addTelemetryProperties(Object.assign(Object.assign({},l),t.props)),d}let d;function l(){return function(){const e=new Error("<<generated stack>>");if(void 0===d&&(d=void 0!==e.stack),d)return e;try{throw e}catch(e){return e}}().stack}function h(e,t){const{message:r,stack:n}=i(e,!1),a=t(r);return void 0!==n&&u(a,n),function(e){return b.typeCheck(e)?e.errorType===v&&1===e.getTelemetryProperties().untrustedOrigin:!Object(o.c)(e)}(e)&&a.addTelemetryProperties({untrustedOrigin:1}),Object(o.a)(e)&&(a.overwriteErrorInstanceId(e.errorInstanceId),a.addTelemetryProperties({innerErrorInstanceId:e.errorInstanceId})),s(e)&&a.addTelemetryProperties(e.getTelemetryProperties()),a}function u(e,t){try{Object.assign(e,{stack:t})}catch(r){e.addTelemetryProperties({stack2:t})}}function p(e){var t;return"string"==typeof(null===(t=e)||void 0===t?void 0:t.tag)}function f(e,t){return Array.isArray(e)&&e.every(()?JSON.stringify(e):g(e)?e:(console.error(`UnSupported Format of Logging Error Property for key ${t}:`,e),"REDACTED (arbitrary object)")}function g(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}const m=()=>{const e=new WeakSet;return(t,r)=>{if("object"==typeof r&&null!==r){if(e.has(r))return"<removed/circular>";e.add(r)}return r}};class b extends Error{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;super(e),this.omitPropsFromLogging=r,this._errorInstanceId=Object(n.a)(),this.fluidErrorCode="-",r.add("omitPropsFromLogging"),r.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}tatic typeCheck(e){return"object"==typeof e&&null!==e&&"function"==typeof e.addTelemetryProperties&&"function"==typeof e.getTelemetryProperties&&"string"==typeof e.errorInstanceId}addTelemetryProperties(e){!function(e,t){for(const r of Object.keys(t))void 0===e[r]&&(e[r]=t[r])}(this,e)}getTelemetryProperties(){const e=function(e,t){const r={};for(const n of Object.keys(e)){if(t.has(n))continue;const o=e[n];r[n]=p(o)?{value:f(o.value,n),tag:o.tag}:f(o,n)}return r}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}const v="genericError";class y extends b{constructor(e){super(e.message),this.errorType=v,void 0!==e.stack&&u(this,e.stack)}}}}]);
//# sourceMappingURL=684.edd271e2ea5233b398b5.chunk.v7.js.map