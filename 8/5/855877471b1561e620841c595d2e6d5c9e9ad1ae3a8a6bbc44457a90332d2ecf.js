"use strict";(self.webpackChunkTalkdeskChatSDK=self.webpackChunkTalkdeskChatSDK||[]).push([[341],{21879:function(e,t,r){r.d(t,{XN:function(){return defaultRegister},rP:function(){return defaultRegister}});var n=r(1883);defaultRegister.on=registerWithSpecificEmitter;var a=defaultRegister.handlers={},s=handlers={};unction registerWithSpecificEmitter(e,t,r,a,s){if(s||(s="feature"),e||(e=n.EM),e.isBuffering(r)){var i=t[s]=t[s]||{};(i[r]=i[r]||[]).push([e,a])}else e.on(r,a)}},96341:function(e,t,r){r.r(t),r.d(t,{Aggregate:);var n=/([a-z0-9]+)$/i;ar a=r(59722),s=/^\n+|\n+$/g;function formatStackTrace(e){return function truncateStackLines(e){var t;if(e.length>100){var r=e.length-100;t=e.slice(0,50).join("\n"),t+="\n< ...truncated "+r+" lines... >\n",t+=e.slice(-50).join("\n")}else t=e.join("\n");return t}(e).replace(s,"")}var i=!1,o=/function (.+?)\s*\(/,c=/^\s*at (?:((?:\[object object\])?(?:[^(]*\([^)]*\))*[^()]*(?: \[as \S+\])?) )?\(?((?:file|http|https|chrome-extension):.*?)?:(\d+)(?::(\d+))?\)?\s*$/i,u=/^\s*(?:(\S*|global code)(?:\(.*?\))?@)?((?:file|http|https|chrome|safari-extension).*?):(\d+)(?::(\d+))?\s*$/i,h=/^\s*at .+ \(eval at \S+ \((?:(?:file|http|https):[^)]+)?\)(?:, [^:]*:\d+:\d+)?\)$/i,d=/^\s*at Function code \(Function code:\d+:\d+\)\s*/i;function computeStackTrace(e){var t=null;try{if(t=function computeStackTraceFromStackProp(e){if(!e.stack)return null;var t=(0,a.u)(e.stack.split("\n"),parseStackProp,{frames:[],stackLines:[],wrapperSeen:!1});return t.frames.length?{mode:"stack",name:e.name||getClassName(e),message:e.message,stackString:formatStackTrace(t.stackLines),frames:t.frames}:null}(e),t)return t}catch(e){i}try{if(t=function computeStackTraceBySourceAndLine(e){if(!("line"in e))return null;var t=e.name||getClassName(e);if(!e.sourceURL)return{mode:"sourceline",name:t,message:e.message,stackString:getClassName(e)+": "+e.message+"\n    in evaluated code",frames:[{func:"evaluated code"}]};var r=t+": "+e.message+"\n    at "+e.sourceURL;e.line&&(r+=":"+e.line,e.column&&(r+=":"+e.column));return{mode:"sourceline",name:t,message:e.message,stackString:r,frames:[{url:e.sourceURL,line:e.line,column:e.column}]}}(e),t)return t}catch(e){i}try{if(t=function computeStackTraceWithMessageOnly(e){var t=e.name||getClassName(e);return t?{mode:"nameonly",name:t,message:e.message,stackString:t+": "+e.message,frames:[]}:null}(e),t)return t}catch(e){i}return{mode:"failed",stackString:"",frames:[]}}function parseStackProp(e,t){var r=function getElement(e){var t=e.match(u);t||(t=e.match(c));if(t)return{url:t[2],func:"Anonymous function"!==t[1]&&"global code"!==t[1]&&t[1]||null,line:+t[3],column:t[4]?+t[4]:null};if(e.match(h)||e.match(d)||"anonymous"===e)return{func:"evaluated code"}}(t);return r?(!function isWrapper(e){return e&&e.indexOf("nrWrapper")>=0}(r.func)?e.stackLines.push(t):e.wrapperSeen=!0,e.wrapperSeen||e.frames.push(r),e):(e.stackLines.push(t),e)}unction stringHashCode(e){var t=0;if(!e||!e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}var l=r(21879),g=r(46303),f=r(89247),m=r(1883),p=r(30717),v=r(80406),k=r(11249),S=r(25768),C=r(41437),I=r(77311),y=r(83707);class Aggregate extends y.W{constructor(e,t){super(e,t),this.stackReported={},this.pageviewReported={},this.errorCache={},this.currentBody,this.errorOnPage=!1,this.ee.on("interactionSaved",(function(e){this.errorCache[e.id]&&(this.errorCache[e.id].forEach((function(t){var r={},n=t[4],a=t[5];(0,p.D)(n,setCustom),(0,p.D)(e.root.attrs.custom,setCustom),(0,p.D)(a,setCustom);var s=t[2];s.browserInteractionId=e.root.attrs.id,delete s._interactionId,s._interactionNodeId&&(s.parentNodeId=s._interactionNodeId.toString(),delete s._interactionNodeId);var i=t[1]+e.root.attrs.id+":"+stringHashCode((0,f.P)(r));function setCustom(e,t){r[e]=t&&"object"==typeof t?(0,f.P)(t):t}this.aggregator.store(t[0],i,s,t[3],r)})),delete this.errorCache[e.id])})),this.ee.on("interactionDiscarded",(function(e){this.errorCache&&this.errorCache[e.id]&&(this.errorCache[e.id].forEach((function(t){var r={},n=t[4],a=t[5];(0,p.D)(n,setCustom),(0,p.D)(e.root.attrs.custom,setCustom),(0,p.D)(a,setCustom);var s=t[2];delete s._interactionId,delete s._interactionNodeId;var i=t[1]+":"+stringHashCode((0,f.P)(r));function setCustom(e,t){r[e]=t&&"object"==typeof t?(0,f.P)(t):t}this.aggregator.store(t[0],i,t[2],t[3],r)})),delete this.errorCache[e.id])})),(0,l.XN)("err",((...e)=>this.storeError(...e)),void 0,this.ee),(0,l.XN)("ierr",((...e)=>this.storeError(...e)),void 0,this.ee);var r=(0,v.Mt)(this.agentIdentifier,"jserrors.harvestTimeSeconds")||10,n=new g.o("jserrors",{onFinished:(...e)=>this.onHarvestFinished(...e)},this);n.harvest.on("jserrors",(),n.startTimer(r)}onHarvestStarted(e){var t=this.aggregator.take(["err","ierr"]);e.retry&&(this.currentBody=t);var r={body:t,qs:{}},n=(0,f.P)((0,k.O)(this.agentIdentifier).releaseIds);return"{}"!==n&&(r.qs.ri=n),t&&t.err&&t.err.length&&!this.errorOnPage&&(r.qs.pve="1",this.errorOnPage=!0),r}onHarvestFinished(e){e.retry&&this.currentBody&&((0,p.D)(this.currentBody,(function(e,t){for(var r=0;r<t.length;r++){var n=t[r],a=this.getBucketName(n.params,n.custom);this.aggregator.merge(e,a,n.metrics,n.params,n.custom)}})),this.currentBody=null)}nameHash(e){return stringHashCode(e.exceptionClass)^e.stackHash}getBucketName(e,t){return this.nameHash(e)+":"+stringHashCode((0,f.P)(t))}canonicalizeURL(e,t){if("string"!=typeof e)return"";var r=(0,I.f)(e);return r===t?"<inline>":r}buildCanonicalStackString(e,t){for(var r="",n=0;n<e.frames.length;n++){var a=e.frames[n],s=canonicalFunctionName(a.func);r&&(r+="\n"),s&&(r+=s+"@"),"string"==typeof a.url&&(r+=a.url),a.line&&(r+=":"+a.line)}return r}canonicalizeStackURLs(e){for(var t=(0,I.f)((0,k.O)(this.agentIdentifier).origin),r=0;r<e.frames.length;r++){var n=e.frames[r],a=n.url,s=this.canonicalizeURL(a,t);s&&s!==n.url&&(n.url=s,e.stackString=e.stackString.split(a).join(s))}return e}storeError(e,t,r,n){if(t=t||(0,C.zO)(),r||!(0,k.O)(this.agentIdentifier).onerror||!(0,k.O)(this.agentIdentifier).onerror(e)){var a=this.canonicalizeStackURLs(computeStackTrace(e)),s={stackHash:stringHashCode(this.buildCanonicalStackString(a)),exceptionClass:a.name,request_uri:window.location.pathname};a.message&&(s.message=""+a.message),this.stackReported[s.stackHash]?s.browser_stack_hash=stringHashCode(a.stackString):(this.stackReported[s.stackHash]=!0,s.stack_trace=function truncateSize(e){return e.length>65530?e.substr(0,65530):e}(a.stackString)),s.releaseIds=(0,f.P)((0,k.O)(this.agentIdentifier).releaseIds);var i=this.nameHash(s);this.pageviewReported[i]||(s.pageview=1,this.pageviewReported[i]=!0);var o=r?"ierr":"err",c={time:t};if((0,m.pr)("errorAgg",[o,i,s,c],void 0,void 0,this.ee),null!=s._interactionId)this.errorCache[s._interactionId]=this.errorCache[s._interactionId]||[],this.errorCache[s._interactionId].push([o,i,s,c,h,n]);else{var u={},h=(0,S.C)(this.agentIdentifier).jsAttributes;(0,p.D)(h,setCustom),n&&(0,p.D)(n,setCustom);var d=i+":"+stringHashCode((0,f.P)(u));this.aggregator.store(o,d,s,c,u)}}}}}]);