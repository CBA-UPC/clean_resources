(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[586],{KLDM:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("3M/p"),s=n("bgLm"),i=n("USFr"),r="Office.Telemetry.OTelJS.EventThrottled";ar o=function(){function e(e,t){this._sinkName=e,this._telemetrySink=t,this.name="EventThrottler",this._totalEventsInLastInterval=0,this._singleEventInLastInterval={},this._eventThrottleReported={},this._lastIntervalStart=Date.now(),this._maxNamedEventsPerSecond={}}return e.prototype.setSingleEventThrottle=function(e){this._maxSingleEventPerSecond=e},e.prototype.setTotalEventThrottle=e.prototype.setNamedEventThrottle=e.prototype.processEvent=function(e){var t=e.eventName;if(t===r)return!0;var n=!0;return Date.now()-this._lastIntervalStart>1e3&&(this._lastIntervalStart=Date.now(),this._totalEventsInLastInterval=0,this._singleEventInLastInterval={}),this._singleEventInLastInterval[t]=this._singleEventInLastInterval[t]+1||1,t in this._maxNamedEventsPerSecond?n=this.applyThrottle(this._singleEventInLastInterval[t],this._maxNamedEventsPerSecond[t],"MaxNamedEventsPerSecond",t):d(this._maxSingleEventPerSecond)&&(n=this.applyThrottle(this._singleEventInLastInterval[t],this._maxSingleEventPerSecond,"MaxSingleEventsPerSecond",t)),d(this._maxTotalEventsPerSecond)&&(this._totalEventsInLastInterval++,n&&(n=this.applyThrottle(this._totalEventsInLastInterval,this._maxTotalEventsPerSecond,"MaxTotalEventsPerSecond",t))),n},e.prototype.applyThrottle=function(e,t,n,d){return!(e>t&&(e===t+1&&this._telemetrySink&&!this._eventThrottleReported[d]&&(this._eventThrottleReported[d]=!0,this._telemetrySink.sendTelemetryEvent({eventName:r,telemetryProperties:{ariaTenantToken:i.a,nexusTenantToken:1723},eventFlags:{diagnosticLevel:110},dataFields:[Object(a.d)("SinkName",this._sinkName||""),Object(a.d)("ThrottledEvent.Name",d),Object(a.c)(n,t)]})),Object(s.b)(2,1,(),1))},e}()},b8Ce:function(e,t,n){"use strict";n.r(t),n.d(t,"OfficeFluidOneDsSink",();var a=n("3qFY"),s=n("KLDM"),i=n("svub"),r=n("oeGp");let d;class o{constructor(e){this.context=e,this.createOneDsSink=()=>{if(!d){d=new a.a([],{endpointUrl:this.getOneDsEndpointUrl()}),d.setFullEventsEnabled(!0);let e=new s.a("_",d);e.setSingleEventThrottle(100),e.setTotalEventThrottle(1e3),d.addPreprocessor(e),this.setPartADataFields(this.context)}return d},this.shutdown=this.setPartADataFields=this.getOneDsEndpointUrl=()=>{switch(this.audience){case"Automation":case"SyntheticTraffic":case"Local":case"Development":case"Staging":case"Dogfood":case"Preview":case"Microsoft":case"Production":case"GCC":return i.a.PUBLIC;case"GCC-High":return i.a.USGOV_DOJ;case"DoD":return i.a.USGOV_DOD;default:throw new Error("Unexpected audience value provided")}},this.audience=e.audience}getReleaseAudienceGroup(e){if(e)switch(e){case"Automation":case"SyntheticTraffic":case"Local":case"Development":case"Staging":case"Dogfood":case"Preview":case"Microsoft":case"Production":return e;case"GCC":case"GCC-High":case"DoD":return"Production"}}isGuidtermineIdentitySpace(e,t){return t||(this.isGuid(e)?"UserObjectId":this.isOrgIdPuid(e)?"OrgIdPuid":void 0)}addDataFieldIfNeeded(e,t,n){const a=Object(r.a)(n,t);a&&e.push(a)}extractPartADataFields(e){var t;const n=[];this.addDataFieldIfNeeded(n,"App.Platform",e.appPlatform||"Web"),this.addDataFieldIfNeeded(n,"App.Name",e.appName||"Fluid"),this.addDataFieldIfNeeded(n,"App.Version",e.appVersion),this.addDataFieldIfNeeded(n,"Release.AudienceGroup",this.getReleaseAudienceGroup(e.audience)),this.addDataFieldIfNeeded(n,"Session.Id",e.sessionId),this.addDataFieldIfNeeded(n,"Culture.UiLanguage",e.uiLanguage),this.addDataFieldIfNeeded(n,"User.IsAnonymous",!e.user),this.addDataFieldIfNeeded(n,"User.TenantId",null===(t=e.user)||void 0===t?void 0:t.tenantId),this.addDataFieldIfNeeded(n,"User.TenantGroup",e.user&&"Commercial");const a=e.user&&(e.user.id?e.user.id:e.user.oid);return this.addDataFieldIfNeeded(n,"User.PrimaryIdentityHash",a),this.addDataFieldIfNeeded(n,"User.PrimaryIdentitySpace",e.user&&this.determineIdentitySpace(a,e.user.userIdSpace)),n}}}}]);
//# sourceMappingURL=officeflonedssink.fe3ee4299bcb7d20473b.chunk.v7.js.map