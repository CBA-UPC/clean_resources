!function(e){function a(a){for(var c,t,n=a[0],b=a[1],o=a[2],i=0,l=[];i<n.length;i++)t=n[i],Object.prototype.hasOwnProperty.call(f,t)&&f[t]&&l.push(f[t][0]),f[t]=0;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(e[c]=b[c]);for(u&&u(a);l.length;)l.shift()();return r.push.apply(r,o||[]),d()}function d(){for(var e,a=0;a<r.length;a++){for(var d=r[a],c=!0,n=1;n<d.length;n++)0!==f[d[n]]&&(c=!1);c&&(r.splice(a--,1),e=t(t.s=d[0]))}return e}var c={},f={9:0},r=[];function t(a){if(c[a])return c[a].exports;var d=c[a]={i:a,l:!1,exports:{}};return e[a].call(d.exports,d,d.exports,t),d.l=!0,d.exports}t.e=function(e){var a=[],d=f[e];if(0!==d)if(d)a.push(d[2]);else{var c=new Promise((function(a,c){d=f[e]=[a,c]}));a.push(d[2]=c);var r,n=document.createElement("script");n.charset="utf-8",n.timeout=120,t.nc&&n.setAttribute("nonce",t.nc),n.src=function(e){return t.p+""+({1:"common"}[e]||e)+"-es2015."+{0:"3ffc777aa16b3586448b",1:"65dd11b494f886f60e4a",2:"7315662a5937a9a53dd8",3:"fdcdea2486f526c57f22",4:"5e2ca509f885bf3c2ac4",5:"f79b263deebedf6ac3e1",6:"324a491b2c3430714dc9",7:"248858ac68a273be8a2d",8:"7dc1e1e9fbc32417280b",10:"0a69db39dfb05a112821",11:"4b29c640009f28e7f618",12:"90ec058ff313e7f53465",13:"38c9420d01bcb4005b18",14:"44f82f94ada99f22d8ad",19:"8308ea3f492a2b7e1719",20:"eb5dd2785c21a5bd1735",21:"44eee7a00ed7dd2ec6dd",22:"ccf95cefaf25296c0d8d",23:"788d42d30b6ceff486bf",24:"d5e279d39cbfc2776cca",25:"adb5ae014fe193a04f59",26:"008f0148dec9fac61fa0",27:"de9bd62163366351fcaf",28:"f878643ad34dd8b614ad",29:"a83dc07977856daf7983",30:"f1d5568032cab6c2b607",31:"2f6222297fe548663bea",32:"1eb3afa6be0058d9d929",33:"407523a8eb0e3d834a8f",34:"a50ed88d7781da3c70d6",35:"c2438bd6d5746933f05a",36:"d98967fd71896c9fdbd3",37:"e2cecd742cf9ce481b15",38:"5fee7204b3070bd8502f",39:"584b456cb49d1aa6fe5b",40:"218cb7162832e6dcafdb",41:"431cc89fceb6e3c00389",42:"0079c3aa5a268923d44a",43:"cb7daa76fe42d6c773aa",44:"327fe7c6436bd058d23c",45:"cc3224e09422d84589ff",46:"1ee662907f8a31414afa",47:"4996ee9b10017d9018ff",48:"5ddb38627bbd1768f5ac",49:"ae193db27e10dadec8cc",50:"a290cdd5b55761be4a81",51:"3222245b90ead104f9f2",52:"216501f1848475be26d2",53:"c1616f0120000aa1d99b",54:"a222b2d3fea29fc41b8a",55:"a6123ab6b7e4743cac02",56:"9c0b91f5060ce8076c0f",57:"1c8dfd7d6d47df5dbff2",58:"3e952076d75ebdd92533",59:"764cad9f071aa1b7f1e0",60:"1c79933ac1db93fa8e8d",61:"da9f0dbbd76c48e8513d",62:"4fe1348b45eced38a482",63:"2b9e86b6dabde4148854",64:"457c2f21ffe4b52d5e97",65:"363ce0a8d51ad76bd2cd",66:"4a23b65b3e2a06e94911",67:"8c27fe0b701cd5dc6d62",68:"defe0680031683985065",69:"f7613fb9a24ad03c3159",70:"9be15335478253e803a6",71:"ea2213479283629f5680",72:"8e79c52bdb0c1b136cd1",73:"4f89ead4a09185012ab5",74:"5e280d0ee189f4326d9f",75:"23cd7a0f44c55acdc4e9",76:"a752f2bf0816fabc4a3a",77:"a2c6470ec47801399e5c"}[e]+".js"}(e);var b=new Error;r=function(a){n.onerror=n.onload=null,clearTimeout(o);var d=f[e];if(0!==d){if(d){var c=a&&("load"===a.type?"missing":a.type),r=a&&a.target&&a.target.src;b.message="Loading chunk "+e+" failed.\n("+c+": "+r+")",b.name="ChunkLoadError",b.type=c,b.request=r,d[1](b)}f[e]=void 0}};var o=setTimeout((function(){r({type:"timeout",target:n})}),12e4);n.onerror=n.onload=r,document.head.appendChild(n)}return Promise.all(a)},t.m=e,t.c=c,t.d=function(e,a,d){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:d})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var d=Object.create(null);if(t.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var c in e)t.d(d,c,(function(a){return e[a]}).bind(null,c));return d},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="/wu-next/assets/3d0d6e4/",t.oe=function(e){throw console.error(e),e};var n=window.webpackJsonp=window.webpackJsonp||[],b=n.push.bind(n);n.push=a,n=n.slice();for(var o=0;o<n.length;o++)a(n[o]);var u=b;d()}([]);ppendChild(s)}}}}static log(t,e){var i,n;"error"===e&&(null===(n=null===(i=window.s2sSdkConfig)||void 0===i?void 0:i.crashReporting)||void 0===n?void 0:n.sampling)>0&&window.gfkS2sConf.crashReporting&&window.gfkSentryHub&&window.gfkSentryHub.captureMessage(t)}static isScriptMissingCrossorigin(t){const e=document.querySelector(`script[src*='${t}']`);return e&&"anonymous"!==e.getAttribute("crossorigin")}static checkImplementation(t){t&&(this.isScriptMissingCrossorigin("playerextension.js")&&s.warn('WARN: Crash reporting is enabled but "crossorigin" attribute is missing from playerextension.js script. Please check our documentation here: https://confluence-docu.gfk.com/pages/viewpage.action?pageId=102334502#GenericPlayerExtension(JSSDK)-Theidea-somepseudocode'),this.isScriptMissingCrossorigin("s2s-web.js")&&s.warn('WARN: Crash reporting is enabled but "crossorigin" attribute is missing from the tag. Please check our documentation here: https://confluence-docu.gfk.com/pages/viewpage.action?pageId=13044049'))}static shouldEnableLogging(){var t,e,i,n,r,o;if(window&&(null===(e=null===(t=null===window||void 0===window?void 0:window.s2sSdkConfig)||void 0===t?void 0:t.crashReporting)||void 0===e?void 0:e.sampling)>0&&(null===(i=null===window||void 0===window?void 0:window.gfkS2sConf)||void 0===i?void 0:i.crashReporting)){const t=(null===(r=null===(n=window.s2sSdkConfig)||void 0===n?void 0:n.crashReporting)||void 0===r?void 0:r.sampling)||0;let e;if(sessionStorage){if(sessionStorage.getItem("sensicCrashReporting"))return this.checkImplementation("true"===sessionStorage.getItem("sensicCrashReporting")),"true"===sessionStorage.getItem("sensicCrashReporting");e=100*Math.random(),sessionStorage.setItem("sensicCrashReporting",(t>e)+"")}else e=100*Math.random();return this.checkImplementation(t>e),t>e}if(null===(o=null===window||void 0===window?void 0:window.gfkS2sConf)||void 0===o?void 0:o.crashReporting)return!1;{const t=(null===window||void 0===window?void 0:window.extensionConfig)?"https://confluence-docu.gfk.com/pages/viewpage.action?pageId=102334502":"https://confluence-docu.gfk.com/display/SENSIC/Configuration+for+Websites";return s.warn(`WARN: Crash reporting is disabled at the moment. Please consider its activation as documented here: ${t}`),!1}}}const i={none:0,error:1,warn:2,info:3,log:4,debug:5},n=["none","debug","log","info","warn","error"];class s{static debug(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.output(t,"debug",e.coloring,e.extraObj)}static log(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.output(t,"log",e.coloring,e.extraObj)}static info(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.output(t,"info",e.coloring,e.extraObj)}static warn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.output(t,"warn",e.coloring,e.extraObj)}static error(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.output(t,"error",e.coloring,e.extraObj)}static output(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log",r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;var a,d;if(!(i[n]>i[s.logLevel])){if(t.match(null===(d=null===(a=window.s2sSdkConfig)||void 0===a?void 0:a.crashReporting)||void 0===d?void 0:d.ignoreErrors)||e.log(t,n),s.url&&XMLHttpRequest){const e=new XMLHttpRequest,i=s.url+"?"+n+"="+encodeURIComponent(t+(o?"\n"+JSON.stringify(o):""))+"&src=S2S";e.open("GET",i,!0),e.send()}if("undefined"!=typeof console){const e=(r?"%c ":"")+t+(r?" %c":""),i=console;"function"==typeof i[n]?"fcall"===r?o?i[n]("GFK: "+e,"background: #060; color: #fff","","object"==typeof o&&Array.from?Array.from(o):o):i[n]("GFK: "+e,"background: #060; color: #fff",""):"request"===r?i[n]("GFK: "+e,"background: #059; color: #fff","",o):i[n]("GFK: "+e):i.error("GFK: "+e)}}}static formatDuration(t){const e=t%1e3,i=(t=(t-e)/1e3)%60,n=(t=(t-i)/60)%60,s=(t-n)/60;return(s?s+":":"")+("0"+n).slice(-2)+":"+("0"+i).slice(-2)+"."+("00"+e).slice(-3)}static readFromTagConf(){this.readFromConf(window.gfkS2sConf)}static readFromConnectorConf(){this.readFromConf(window.gfkConnectorConf)}static readFromLocalStorage(){try{if(window.localStorage){const t=window.localStorage.getItem("sensic-logLevel");r(t)&&(s.logLevel=t)}}catch(t){console.warn("Couldn't read log settings from local storage:",t)}}static readFromConf(t){r(null==t?void 0:t.logLevel)&&(s.logLevel=t.logLevel),(null==t?void 0:t.logUrl)&&(s.url=t.logUrl)}}function r(t){return n.includes(t)}s.logLevel="none",s.url=null;class o{constructor(t){this.appType=t.hasOwnProperty("type")?t.type:"WEB";const e=o.getParticularDeviceType(),i=t.hasOwnProperty("device")?t.device:"UNKNOWN";this.deviceType="UNKNOWN"===e?i:e}static determineDeviceType(t,e){let i="";return e.match(/Linux/i)&&t.match(/(WEBOS)/i)&&(i="Smart-TV"),i}static determineOs(t,e){let i="";return e.match(/Linux /i)&&t.match(/WEBOS/i)&&(i="WebOS"),i}static getPlatform(){return o.isWebContext()?window.navigator.platform:""}static getOperatingSystem(){const t=o.getUserAgent(),e=o.getPlatform();return o.determineOs(t,e)}static getParticularDeviceType(){const t=o.getUserAgent(),e=o.getPlatform();return o.determineDeviceType(t,e)}static getUserAgent(){return o.isWebContext()?window.navigator.userAgent:""}static getTimeOffset(){return o.timeOffset}static getTimeWithOffset(){return o.getUTCTimeStamp()+o.getTimeOffset()}static setTimeOffset(){"idle"!==o.dateStatus&&"canceled"!==o.dateStatus||(o.dateStatus="waiting",o.getServerDate())}static isDntEnabled(){return o.config.dnt}static setConfig(t){o.isHttp()&&["trackingUrl"].forEach((t=>{window.s2sSdkConfig[t]=window.s2sSdkConfig[t].replace(/^https:/,"http:")})),o.config=t}static init(t,e){var i;o.suiapiV2=e,o.tagConf=t,"undefined"!=typeof document&&(o.suiapiV2.init(o.tagConf.optin),(null===(i=window.gfkS2s)||void 0===i?void 0:i.scb)&&"function"==typeof window.gfkS2s.scb&&window.gfkS2s.scb(o.suiapiV2.instanceID))}static getInstanceID(){return o.suiapiV2.instanceID}static getServerDate(){window.addEventListener("message",(t=>{t.data.relayRequestServerDate&&"finished"!==o.dateStatus&&"canceled"!==o.dateStatus&&(o.dateStatus="finished",o.setCalculatedOffset(t.data.relayRequestServerDate))})),setTimeout((()=>{"finished"!==o.dateStatus&&(o.dateStatus="canceled",s.output("Request Timeout!","warn"))}),3e3)}static setCalculatedOffset(t){const e=o.getUTCTimeStamp(),i=Date.parse(t);o.timeOffset=isNaN(i)?0:i-e,0!==o.timeOffset&&s.output("Time offset = "+o.timeOffset+" milliseconds","info")}static getUTCTimeStamp(){return(new Date).getTime()}static isWebContext(){return"undefined"!=typeof window}static isHttp(){if("undefined"!=typeof window){if(window.document.currentScript){const t=window.document.currentScript;if(t.src)return t.src.match(/^http:/)}const t=document.getElementsByTagName("script");for(let e=0;e<t.length;e++)if(t[e]&&t[e].src.match(/\/s2s-web.js$/))return null!==t[e].src.match(/^http:/);if("http:"===window.location.protocol)return!0}return!1}getOrigin(){return o.isWebContext()?window.location.protocol+"//"+window.location.hostname:""}getLanguage(){return o.isWebContext()?window.navigator.language||window.navigator.userLanguage:""}getProjectStatus(){return o.config.enabled}getContentCustomParameter(){return o.config.contentCustom}getStreamCustomParameter(){return o.config.streamCustom}getVersion(){return o.config.sdkVersion+(this.extensionVersion?"/"+this.extensionVersion:"")}getTechnology(){return o.config.tech}getProjectName(){return o.config.projectName}getTrackingUrl(){return o.config.trackingUrl}getHeartbeatSettings(){return o.config.heartbeat}getSegmentSettings(){return o.config.segment}getAppType(){return this.appType}getDeviceType(){if("undefined"!=typeof window&&window.cast){if("CONNECTED"===window.cast.framework.CastContext.getInstance().getCastState())return"chromecast"}return this.deviceType}setExtensionVersion(t){this.extensionVersion=t}}o.dateStatus="idle",o.timeOffset=0;class a{static validateTagConfig(t){const e="gfkS2sConf = {...}";if(!this.isStringAndNotEmpty(t.media,"mediaId",e))throw new Error;if(!this.isStringAndNotEmpty(t.url,"url",e))throw new Error;if(!this.isStringAndNotEmpty(t.type,"type",e))throw new Error;switch(t.type){case"APP":if(!this.isStringAndNotEmpty(t.device,"device",e))throw this.errorLog(e,"device","","Missing or empty property","error"),new Error;if(!t.hasOwnProperty("ai"))throw this.errorLog(e,"ai","","Missing property","error"),new Error;-1===["SMARTPHONE","TABLET","TV","DESKTOP"].indexOf(t.device)&&(this.errorLog(e,"device",t.device,"Unknown device type, see documentation","warn"),t.device="UNKNOWN");break;case"WEB":case"TV":break;default:throw this.errorLog(e,"type",t.type,"Unknown app type, see documentation (configuration)","error"),new Error("Unknown type")}}static isStringAndNotEmpty(t,e,i,n){const s="string"==typeof t&&t.length>0;return!1===s&&this.errorLog(i,e,t,"is not a string",n),s}static isCorrectStreamOffset(t,e,i,n){const s="number"==typeof t&&!isNaN(t);return s||this.errorLog(i,e,t,"is not a number!",n),s}static isCorrectStreamStart(t,e,i,n){const s=Date.parse(t);return!isNaN(s)||0===t.length||(this.errorLog(i,e,t,"must be a valid date string with timezone offset (YYYY-MM-DDTHH:ii:ss TZ +OFFSET)!",n),!1)}static areParameterValid(t){for(const e in t)if(t.hasOwnProperty(e)&&!1===t[e])return s.output(`Input param "${e}" is not valid, request couldn't be sent!`,"warn"),!1;return!0}static isPlayOptionsValid(t,e,i,n){let s=!0;if("object"!=typeof t)this.errorLog(i,e,"(valueType="+typeof t+")","is invalid object!","warn"),s=!1;else{void 0===t.screen||"string"==typeof t.screen||(this.errorLog(i,e+".screen","(valueType="+typeof t.screen+")","is invalid object!","warn"),s=!1),void 0!==t.volume&&"string"!=typeof t.volume&&(s=!1),"string"==typeof t.speed&&isNaN(parseFloat(t.speed))&&(s=!1);let r=void 0===t.position;n&&(r=r||"number"==typeof t.position),r||(this.errorLog(i,e+".position","(valueType="+typeof t.position+")","is invalid object!","warn"),s=!1)}return s}static areCustomParametersValid(t,e,i){const n="object"==typeof t;return!1===n&&this.errorLog(i,e,"(valueType="+typeof t+")","is invalid object!","warn"),n}static checkArgCount(t,e,i){if(!a.isArgumentsLengthValid(t,e,i))throw new Error(i+" cannot be executed!")}static isArgumentsLengthValid(t,e,i,n){return!1!=(t===e)||(this.errorLog(i,"Input parameter number",t.toString(),"; Invalid number of arguments, given: "+t+", expected: "+e+"!",n),!1)}static errorLog(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"error";s.output("Origin="+t+"; Parameter="+e+"; Value="+i+"; "+n,r)}}class d{constructor(t,e){this.sMediaId=t,this.sInstance=e}get mediaId(){return this.sMediaId}get instance(){return this.sInstance}}class u extends d{constructor(t,e,i,n,s,r,o,a){super(t,a),this.iStreamPosition=e,this.sPresentationId=i,this.iStateItemNumber=n,this.iSegmentNumber=s,this.iSegmentDuration=r,this.iUsageTime=o}get presentationId(){return this.sPresentationId}get stateItemNumber(){return this.iStateItemNumber}get segmentNumber(){return this.iSegmentNumber}get segmentDuration(){return this.iSegmentDuration}get streamPosition(){return this.iStreamPosition}get usageTime(){return this.iUsageTime}}class c{static playbackSpeedConverter(t){if("string"!=typeof t||""===t||isNaN(parseFloat(t))){if("number"==typeof t)return Number(t.toFixed(2).replace(/(\.0+|0+)$/,""));if(void 0===t||""===t||null===t)return 1;throw new Error("Error in start event: Playback Speed wrong format. No data will be send")}return Number(Number(t).toFixed(2).replace(/(\.0+|0+)$/,""))}}class l extends u{constructor(t,e,i,n,s,r,o,a,d,u,h,m,g,p){super(t,"ondemand"===h?i:-1,o,d,a,u,r,l.instance),this.fPlaybackSpeedMultiplier=c.playbackSpeedConverter(m.speed),this.sPlayType=h,this.sContentId=e,this.oOptions=m,this.sVisibility=g||"",this.oCustomParams=p||{},this.iStreamStartTime=0===n.length?r-s:Date.parse(n)-s}get playType(){return this.sPlayType}set playType(t){this.sPlayType=t}get contentId(){return this.sContentId}get options(){return this.oOptions}get visibility(){return this.sVisibility}get customParams(){return this.oCustomParams}get streamStartTime(){return this.iStreamStartTime}}l.instance="EventPlay";class h extends u{constructor(t,e,i,n,s,r,o){super(t,e,i,s,n,r,o,h.instance)}}h.instance="EventStop";class m extends u{constructor(t,e,i,n,s,r,o){super(t,e,i,s,n,r,o,m.instance)}}m.instance="EventSkip";class g extends u{constructor(t,e,i,n,s,r,o,a){super(t,e,i,s,n,r,a,g.instance),this.sVolume=o}get volume(){return this.sVolume}}g.instance="EventVolume";class p extends u{constructor(t,e,i,n,s,r,o,a){super(t,e,i,s,n,r,a,p.instance),this.sScreen=o}get screen(){return this.sScreen}}p.instance="EventScreen";class f extends u{constructor(t,e,i,n,s,r,o){super(t,e,i,s,n,r,o,f.instance)}}f.instance="EventHeartbeat";class v extends d{constructor(t,e,i){super(t,v.instance),this.sContentId=e,this.oCustomParams=i||{}}get contentId(){return this.sContentId}get customParams(){return this.oCustomParams}}v.instance="EventImpression";class S extends u{constructor(t,e,i,n,s,r,o,a){super(t,e,i,s,n,r,a,S.instance),this.sVisibility=o}get visibility(){return this.sVisibility}}S.instance="EventVisibility";class w{constructor(t){this.mediaId=t}buildEventImpression(t,e){return new v(this.mediaId,t,e)}buildEventPlay(t,e,i,n,s,r,o,a,d){return new l(this.mediaId,s,t.streamPosition,e,i,n,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,r,o,a,d)}buildEventStop(t,e){return new h(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e)}buildEventSkip(t,e){return new m(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e)}buildEventVolume(t,e,i){return new g(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e,i)}buildEventScreen(t,e,i){return new p(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e,i)}buildEventHeartbeat(t,e){return new f(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e)}buildEventVisibility(t,e,i){return new S(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e,i)}}class b{constructor(t,e,i,n,s){this.iStateItemNumber=t,this.iSegmentNumber=e,this.iStreamPosition=i,this.sPresentationId=n,this.iSegmentDuration=s}get presentationId(){return this.sPresentationId}get segmentNumber(){return this.iSegmentNumber}get stateItemNumber(){return this.iStateItemNumber}get segmentDuration(){return this.iSegmentDuration}get streamPosition(){return this.iStreamPosition}}class y{hash(t){let e,i,n,s,r,o,a,d,u,c=[];for(t=this.Utf8Encode(t),c=this.ConvertToWordArray(t),o=1732584193,a=4023233417,d=2562383102,u=271733878,e=0;e<c.length;e+=16)i=o,n=a,s=d,r=u,o=this.FF(o,a,d,u,c[e+0],7,3614090360),u=this.FF(u,o,a,d,c[e+1],12,3905402710),d=this.FF(d,u,o,a,c[e+2],17,606105819),a=this.FF(a,d,u,o,c[e+3],22,3250441966),o=this.FF(o,a,d,u,c[e+4],7,4118548399),u=this.FF(u,o,a,d,c[e+5],12,1200080426),d=this.FF(d,u,o,a,c[e+6],17,2821735955),a=this.FF(a,d,u,o,c[e+7],22,4249261313),o=this.FF(o,a,d,u,c[e+8],7,1770035416),u=this.FF(u,o,a,d,c[e+9],12,2336552879),d=this.FF(d,u,o,a,c[e+10],17,4294925233),a=this.FF(a,d,u,o,c[e+11],22,2304563134),o=this.FF(o,a,d,u,c[e+12],7,1804603682),u=this.FF(u,o,a,d,c[e+13],12,4254626195),d=this.FF(d,u,o,a,c[e+14],17,2792965006),a=this.FF(a,d,u,o,c[e+15],22,1236535329),o=this.GG(o,a,d,u,c[e+1],5,4129170786),u=this.GG(u,o,a,d,c[e+6],9,3225465664),d=this.GG(d,u,o,a,c[e+11],14,643717713),a=this.GG(a,d,u,o,c[e+0],20,3921069994),o=this.GG(o,a,d,u,c[e+5],5,3593408605),u=this.GG(u,o,a,d,c[e+10],9,38016083),d=this.GG(d,u,o,a,c[e+15],14,3634488961),a=this.GG(a,d,u,o,c[e+4],20,3889429448),o=this.GG(o,a,d,u,c[e+9],5,568446438),u=this.GG(u,o,a,d,c[e+14],9,3275163606),d=this.GG(d,u,o,a,c[e+3],14,4107603335),a=this.GG(a,d,u,o,c[e+8],20,1163531501),o=this.GG(o,a,d,u,c[e+13],5,2850285829),u=this.GG(u,o,a,d,c[e+2],9,4243563512),d=this.GG(d,u,o,a,c[e+7],14,1735328473),a=this.GG(a,d,u,o,c[e+12],20,2368359562),o=this.HH(o,a,d,u,c[e+5],4,4294588738),u=this.HH(u,o,a,d,c[e+8],11,2272392833),d=this.HH(d,u,o,a,c[e+11],16,1839030562),a=this.HH(a,d,u,o,c[e+14],23,4259657740),o=this.HH(o,a,d,u,c[e+1],4,2763975236),u=this.HH(u,o,a,d,c[e+4],11,1272893353),d=this.HH(d,u,o,a,c[e+7],16,4139469664),a=this.HH(a,d,u,o,c[e+10],23,3200236656),o=this.HH(o,a,d,u,c[e+13],4,681279174),u=this.HH(u,o,a,d,c[e+0],11,3936430074),d=this.HH(d,u,o,a,c[e+3],16,3572445317),a=this.HH(a,d,u,o,c[e+6],23,76029189),o=this.HH(o,a,d,u,c[e+9],4,3654602809),u=this.HH(u,o,a,d,c[e+12],11,3873151461),d=this.HH(d,u,o,a,c[e+15],16,530742520),a=this.HH(a,d,u,o,c[e+2],23,3299628645),o=this.II(o,a,d,u,c[e+0],6,4096336452),u=this.II(u,o,a,d,c[e+7],10,1126891415),d=this.II(d,u,o,a,c[e+14],15,2878612391),a=this.II(a,d,u,o,c[e+5],21,4237533241),o=this.II(o,a,d,u,c[e+12],6,1700485571),u=this.II(u,o,a,d,c[e+3],10,2399980690),d=this.II(d,u,o,a,c[e+10],15,4293915773),a=this.II(a,d,u,o,c[e+1],21,2240044497),o=this.II(o,a,d,u,c[e+8],6,1873313359),u=this.II(u,o,a,d,c[e+15],10,4264355552),d=this.II(d,u,o,a,c[e+6],15,2734768916),a=this.II(a,d,u,o,c[e+13],21,1309151649),o=this.II(o,a,d,u,c[e+4],6,4149444226),u=this.II(u,o,a,d,c[e+11],10,3174756917),d=this.II(d,u,o,a,c[e+2],15,718787259),a=this.II(a,d,u,o,c[e+9],21,3951481745),o=this.AddUnsigned(o,i),a=this.AddUnsigned(a,n),d=this.AddUnsigned(d,s),u=this.AddUnsigned(u,r);return(this.WordToHex(o)+this.WordToHex(a)+this.WordToHex(d)+this.WordToHex(u)).toLowerCase()}RotateLeft(t,e){return t<<e|t>>>32-e}AddUnsigned(t,e){const i=2147483648&t,n=2147483648&e,s=1073741824&t,r=1073741824&e,o=(1073741823&t)+(1073741823&e);return s&r?2147483648^o^i^n:s|r?1073741824&o?3221225472^o^i^n:1073741824^o^i^n:o^i^n}F(t,e,i){return t&e|~t&i}G(t,e,i){return t&i|e&~i}H(t,e,i){return t^e^i}I(t,e,i){return e^(t|~i)}FF(t,e,i,n,s,r,o){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.F(e,i,n),s),o)),this.AddUnsigned(this.RotateLeft(t,r),e)}GG(t,e,i,n,s,r,o){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.G(e,i,n),s),o)),this.AddUnsigned(this.RotateLeft(t,r),e)}HH(t,e,i,n,s,r,o){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.H(e,i,n),s),o)),this.AddUnsigned(this.RotateLeft(t,r),e)}II(t,e,i,n,s,r,o){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.I(e,i,n),s),o)),this.AddUnsigned(this.RotateLeft(t,r),e)}ConvertToWordArray(t){let e;const i=t.length,n=i+8,s=16*((n-n%64)/64+1),r=Array(s-1);let o=0,a=0;for(;a<i;)e=(a-a%4)/4,o=a%4*8,r[e]=r[e]|t.charCodeAt(a)<<o,a++;return e=(a-a%4)/4,o=a%4*8,r[e]=r[e]|128<<o,r[s-2]=i<<3,r[s-1]=i>>>29,r}WordToHex(t){let e,i,n="",s="";for(i=0;i<=3;i++)e=t>>>8*i&255,s="0"+e.toString(16),n+=s.substr(s.length-2,2);return n}Utf8Encode(t){t=t.replace(/\r\n/g,"\n");let e="";for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e}}class I{constructor(t){this.milliseconds=1e3,this.minSegmentDuration=0,this.maxStateItemsNumber=0,this.maxSegmentNumber=0,this.state=1,this.presentationId="",this.streamId="",this.stateItemNumber=0,this.segmentNumber=0,this.playStreamPosition=0,this.streamOffset=0,this.startTime=0,this.toleranceSeconds=3,this.playbackSpeed=1,this.minSegmentDuration=t.minSegmentDuration,this.maxStateItemsNumber=t.maxSegmentStateItems,this.maxSegmentNumber=t.maxSegments,this.md5=new y}isSegmentStopped(){return 1===this.state}createSegmentStarting(t,e,i,n,s){if(this.isMaxStateItemNumberReached()||this.isMaxSegmentNumberReached())throw new Error("Max state item number or max segment number reached! #noreport");return this.startTime=this.getTimeSeconds(),this.setSegmentAsPlayed(),this.playbackSpeed=n,this.playType=s,this.generateStreamSegment(t,e,i),this.incrementStateItemNumber(),this.incrementSegmentNumber(),this.createSegment(0,i)}createSegmentRunning(t,e){if(this.isSegmentStopped()||this.isMaxStateItemNumberReached())throw new Error("Stream not yet started or max state item number reached! #noreport");const i=this.calculateSegmentDuration(t);if(e&&this.isBelowMinSegmentDuration(i))throw new Error(`Duration of ${i} ms is below min segment duration of ${this.minSegmentDuration} ms! #noreport`);return this.checkSegmentDuration(i),this.incrementStateItemNumber(),this.createSegment(i,t)}createSegmentStopping(t){if(this.isSegmentStopped())throw new Error("Stop called for an already stopped segment #noreport");this.setSegmentAsStopped();const e=this.calculateSegmentDuration(t);if(this.isBelowMinSegmentDuration(e))throw new Error(`Duration of ${e} ms is below min segment duration of ${this.minSegmentDuration} ms! #noreport`);return this.checkSegmentDuration(e),this.incrementStateItemNumber(),this.createSegment(e,t)}setStartTime(t){this.startTime=t}setToleranceLimit(t){this.toleranceSeconds=t}checkSegmentDuration(t){const e=this.getTimeSeconds()-this.startTime+this.toleranceSeconds;if(Math.round(t/1e3)>e*this.playbackSpeed)throw new Error(`Segment duration  (${t}) >= actual elapsed time (${e} with playback speed ${this.playbackSpeed})! #noreport`)}isBelowMinSegmentDuration(t){return t<this.minSegmentDuration}isMaxStateItemNumberReached(){return this.maxStateItemsNumber<this.getStateItemNumber()}isMaxSegmentNumberReached(){return this.maxSegmentNumber<this.getSegmentNumber()}getTimeSeconds(){return Math.round(this.getTimeMilliseconds()/this.milliseconds)}getTimeMilliseconds(){return Date.now()}setSegmentAsPlayed(){this.state=0}setSegmentAsStopped(){this.state=1}getPresentationId(){return this.presentationId}calculateDuration(t){let e;return e="live"===this.playType?Math.round(t*this.playbackSpeed):t,e}calculateSegmentDuration(t){const e=this.getCurrentStreamPosition(t)-this.playStreamPosition;return this.calculateDuration(e)}getCurrentStreamPosition(t){return t-this.streamOffset}getStateItemNumber(){return this.stateItemNumber}getSegmentNumber(){return this.segmentNumber}incrementStateItemNumber(){this.stateItemNumber++}incrementSegmentNumber(){this.segmentNumber++}generateStreamSegment(t,e,i){this.isStreamIdChanged(e)&&(this.streamId=e,this.presentationId=this.generatePresentationId(e),this.stateItemNumber=0,this.segmentNumber=0),this.streamOffset=t,this.playStreamPosition=this.getCurrentStreamPosition(i)}isStreamIdChanged(t){return this.streamId!==t}generatePresentationId(t){const e=this.getRndInt(1e6,9999999);return this.md5.hash(t).toUpperCase()+e+this.getTimeMilliseconds()}getRndInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}createSegment(t,e){return new b(this.getStateItemNumber(),this.getSegmentNumber(),this.getCurrentStreamPosition(e),this.getPresentationId(),t)}}class C{constructor(t){this.requestType=t,this.fields={ty:t}}set projectId(t){this.fields.p=t}set mediaId(t){this.fields.m=t}set technology(t){this.fields.t=t}set version(t){this.fields.v=t}set operatingSystem(t){this.fields.os=t}set appType(t){this.fields.at=t}set deviceType(t){this.fields.dt=t}get deviceType(){return this.fields.dt}getAsUrlString(){let t="";for(const e in this.fields)if(this.fields.hasOwnProperty(e)){let i=this.fields[e];"object"==typeof i&&(i=JSON.stringify(i)),t+=e+"="+this.encode(i)+"&"}return t.substring(0,t.length-1)}set customParameter(t){const e=t.userParams,i=t.allowedParams;for(const t in e)e.hasOwnProperty(t)&&-1!==i.indexOf(t)&&(this.fields["cp_"+t]=e[t])}encode(t){return encodeURIComponent(t)}}class E extends C{constructor(t){super(t)}set presentationId(t){this.fields.pr=t}get presentationId(){return this.fields.pr}set requestNumber(t){this.fields.rn=t.toString()}set segmentNumber(t){this.fields.sn=t.toString()}get segmentNumber(){return parseInt(this.fields.sn,10)}set segmentDuration(t){this.fields.sd=Math.round(t/1e3).toString(),this.fields.vt=this.fields.sd}set streamTime(t){this.fields.st=Math.round(t/1e3).toString(),this.fields.ct=this.fields.st}set usageTime(t){this.fields.ut=Math.round(t/1e3).toString()}}class P extends E{constructor(){super("HB"),this.isMostRecent=!0}}class T extends E{constructor(){super("PL")}set contentId(t){this.fields.c=t}set streamPosition(t){this.fields.sp=-1===t?"-1":Math.round(t/1e3).toString(),this.fields.vp=this.fields.sp}set playbackSpeed(t){this.fields.ps=t.toString()}set visibility(t){this.fields.vb=t}set screen(t){this.fields.sc=t}set volume(t){this.fields.vo=t}set instanceid(t){this.fields.instanceid=t}set origin(t){this.fields.r=t}set userAgent(t){this.fields.ua=t}set language(t){this.fields.l=t}}class k extends E{constructor(){super("SC")}set screen(t){this.fields.sc=t}}class R extends E{constructor(){super("ST")}set skip(t){this.fields.sk=t.toString()}}class N extends E{constructor(){super("VO")}set volume(t){this.fields.vo=t}}class A extends C{constructor(){super("IM")}set contentId(t){this.fields.c=t}set instanceid(t){this.fields.instanceid=t}set origin(t){this.fields.r=t}set userAgent(t){this.fields.ua=t}set language(t){this.fields.l=t}}class D extends E{constructor(){super("VB")}set visibility(t){this.fields.vb=t}}class O{constructor(t){this.collector=t}buildRequest(t){let e;switch(t.instance){case"EventImpression":e=this.buildRequestImpression(t);break;case"EventPlay":e=this.buildRequestPlay(t);break;case"EventStop":e=this.buildRequestStop(t);break;case"EventSkip":e=this.buildRequestSkip(t);break;case"EventVolume":e=this.buildRequestVolume(t);break;case"EventScreen":e=this.buildRequestScreen(t);break;case"EventHeartbeat":e=this.buildRequestHeartbeat(t);break;case"EventVisibility":e=this.buildRequestVisibility(t)}return e}buildRequestImpression(t){const e=this.buildRequestCommon(new A,t);return e.contentId=t.contentId,e.instanceid=o.getInstanceID(),e.userAgent=o.getUserAgent(),e.language=this.collector.getLanguage(),e.origin=this.collector.getOrigin(),e.customParameter={userParams:t.customParams,allowedParams:this.collector.getContentCustomParameter()},e}buildRequestPlay(t){const e=this.buildRequestBase(new T,t);return e.contentId=t.contentId,e.volume=t.options.volume||"",e.visibility=t.visibility,e.screen=t.options.screen||"",e.instanceid=o.getInstanceID(),e.userAgent=o.getUserAgent(),e.language=this.collector.getLanguage(),e.origin=this.collector.getOrigin(),e.streamPosition=t.streamPosition,e.streamTime=t.streamStartTime,e.playbackSpeed=c.playbackSpeedConverter(t.options.speed),e.customParameter={userParams:t.customParams,allowedParams:this.collector.getStreamCustomParameter()},e}buildRequestStop(t){const e=this.buildRequestBase(new R,t);return e.skip=0,e}buildRequestSkip(t){const e=this.buildRequestBase(new R,t);return e.skip=1,e}buildRequestVolume(t){const e=this.buildRequestBase(new N,t);return e.volume=t.volume,e}buildRequestScreen(t){const e=this.buildRequestBase(new k,t);return e.screen=t.screen,e}buildRequestHeartbeat(t){return this.buildRequestBase(new P,t)}buildRequestVisibility(t){const e=this.buildRequestBase(new D,t);return e.visibility=t.visibility,e}buildRequestBase(t,e){return(t=this.buildRequestCommon(t,e)).presentationId=e.presentationId,t.requestNumber=e.stateItemNumber,t.segmentNumber=e.segmentNumber,t.segmentDuration=e.segmentDuration,t.usageTime=e.usageTime,t}buildRequestCommon(t,e){return t.projectId=this.collector.getProjectName(),t.mediaId=e.mediaId,t.technology=this.collector.getTechnology(),t.version=this.collector.getVersion(),t.operatingSystem=o.getOperatingSystem(),t.deviceType=this.getDeviceType(t.requestType),t.appType=this.collector.getAppType(),t}getDeviceType(t){let e=this.lastDeviceType;return void 0!==e&&"PL"!==t||(e=this.lastDeviceType=this.collector.getDeviceType()),e}}class x{constructor(t,e){this.eventBuilder=new w(t),this.segmentBuilder=new I(e.getSegmentSettings()),this.requestBuilder=new O(e)}getSegmentBuilder(){return this.segmentBuilder}getEventBuilder(){return this.eventBuilder}getRequestBuilder(){return this.requestBuilder}}class H{constructor(t,e){this.milliseconds=1e3,this.heartbeatNumber=0,this.intervalId=0,this.timeoutId=[],this.buildHeartbeat=t,this.heartbeatConfig=e,this.extendTimeoutIntervallWithParamsForOldIE()}start(){if(this.stop(),!this.isHeartbeatEnabled()||this.heartbeatConfig.interval.length<1||"undefined"==typeof window)return;this.heartbeatNumber=0;const t=this.heartbeatConfig.interval.slice(),e=t.pop();let i=0;for(const e of t)i+=e,this.timeoutId.push(window.setTimeout(this.buildHeartbeatEvent,i*this.milliseconds,this));i+=e,this.timeoutId.push(window.setTimeout((()=>{this.buildHeartbeatEvent(this),this.intervalId=window.setInterval(this.buildHeartbeatEvent,e*this.milliseconds,this)}),i*this.milliseconds))}stop(){for(const t of this.timeoutId)clearTimeout(t);clearInterval(this.intervalId),this.timeoutId=[],this.intervalId=0}isHeartbeatActive(){return this.intervalId>0||this.timeoutId.length>0}getMaxHeartbeatInterval(){let t=0;return this.isHeartbeatEnabled()&&this.heartbeatConfig.interval.length>0&&(t=Math.max.apply(Math,this.heartbeatConfig.interval)),t}buildHeartbeatEvent(t){t.isMaxHeartbeatReached()?t.stop():(t.heartbeatNumber++,t.buildHeartbeat())}isHeartbeatEnabled(){return this.heartbeatConfig.enabled}isMaxHeartbeatReached(){return 0!==this.heartbeatConfig.maximum&&this.heartbeatNumber>=this.heartbeatConfig.maximum}extendTimeoutIntervallWithParamsForOldIE(){if("undefined"!=typeof window){if(document.all){const t=window.setTimeout;window.setTimeout=function(e,i){const n=Array.prototype.slice.call(arguments,2);return t(e instanceof Function?()=>{e.apply(this,n)}:e,i)}}if(document.all){const t=window.setInterval;window.setInterval=function(e,i){const n=Array.prototype.slice.call(arguments,2);return t(e instanceof Function?()=>{e.apply(this,n)}:e,i)}}}}}class M{constructor(t){this.timeWithOffsetCallback=t}setPlayType(t){this.playType=t}setStreamPositionCallback(t){this.streamPositionCallback=t}getCurrentStreamPosition(){let t=0;switch(this.playType){case"live":t=this.getCurrentStreamPositionLive();break;case"ondemand":t=this.getCurrentStreamPositionOnDemand()}return t}getCurrentStreamPositionLive(){return this.timeWithOffsetCallback()}getCurrentStreamPositionOnDemand(){let t=0;try{t=this.streamPositionCallback()}catch(t){throw new Error("Error while executing stream position callback: "+t.message)}if("number"!=typeof t||t<0)throw new Error(`Stream position must be a positive milliseconds value, but is ${t}.`);return s.output(`Stream position: ${s.formatDuration(t)} (${t})`,"log"),t}}class L{constructor(t){this.skipAllAfterValidationError=!1,this.lastPosition=0,this.heartbeat=t}start(t){if(t<0)throw this.skipAllAfterValidationError=!0,new Error("Position must be >= 0.");this.skipAllAfterValidationError=!1,this.lastPosition=t}validate(t){if(this.skipAllAfterValidationError)throw new Error("Event skipped after validation error! #noreport");if(t<this.lastPosition)throw new Error(`Current position (${t}) is less than last position (${this.lastPosition}). #noreport`);this.heartbeat.isHeartbeatActive()&&this.skipIfItemIntervalLargerThanHbInterval(t)}updateLastPosition(t){this.lastPosition=t}skipIfItemIntervalLargerThanHbInterval(t){const e=t-this.lastPosition,i=1e3*(this.heartbeat.getMaxHeartbeatInterval()+L.toleranceSeconds);if(e>i){this.heartbeat.stop(),this.skipAllAfterValidationError=!0;let n=`Time interval since last segment is ${e} ms, should be < ${i} ms.`;throw n+=` Last: ${this.lastPosition}, current: ${t}.`,s.output(n,"error"),new Error(n)}}}L.toleranceSeconds=30;class V{constructor(){this.mostRecentHeartbeats={}}onNewHeartbeatGenerated(t){t.isMostRecent=!0,this.invalidateMostRecentHeartbeat(t),this.storeAsMostRecentHeartbeat(t)}invalidateMostRecentHeartbeat(t){const{presentationId:e,segmentNumber:i}=t;this.mostRecentHeartbeats[e]&&this.mostRecentHeartbeats[e][i]&&(this.mostRecentHeartbeats[e][i].isMostRecent=!1)}storeAsMostRecentHeartbeat(t){const{presentationId:e,segmentNumber:i}=t;this.mostRecentHeartbeats[e]={[i]:t}}}class q{constructor(t){this.sendTo=t}send(t){let e;const i=new Promise(((t,i)=>{e=e=>e?t():i("Sending request failed")}));return this.isWebContext()?this.isIEContext()?this.sendWithOldIE(t,e):this.sendWithDefault(t,e):this.sendNotInBrowser(e),i}sendWithDefault(t,e){if(XMLHttpRequest){const i=new XMLHttpRequest;if(!("withCredentials"in i))return s.output("withCredentials not possible on XMLHttpRequest","error"),void e(!1);i.open("POST",this.sendTo,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=()=>{4===i.readyState&&(204===i.status?e(!0):e(!1))},i.send(t.getAsUrlString())}else s.output("XMLHttpRequest not found","error"),e(!1)}sendWithOldIE(t,e){const i=new XDomainRequest;i.open("POST",this.sendTo),i.onerror=()=>{s.output("Can't send a request with old IE","error"),e(!1)},i.ontimeout=()=>{s.output("Server status unknown, POST data not sent!","error"),e(!1)},i.onload=()=>{s.output(t.requestType,"log","request",t.fields),e(!0)},i.send(t.getAsUrlString())}sendNotInBrowser(t){s.output("Cannot send xhttp request, not in a browser","warn"),t(!0)}isWebContext(){return"undefined"!=typeof window}isIEContext(){return"undefined"!=typeof XDomainRequest}}var U=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{d(n.next(t))}catch(t){r(t)}}function a(t){try{d(n.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}d((n=n.apply(t,e||[])).next())}))};class F{constructor(t){this.storage=[],this.currentDelay=F.BASE_DELAY,this.isResendQueued=!1,this.requestSender=new q(t)}sendRequest(t){return this.requestSender.send(t).then((()=>s.output("Sent: "+t.requestType,"log","request",t.fields))).catch((e=>{s.output("Failed to send request: "+e,"error"),_(t)&&(s.output("Queueing request","info"),this.storage.push(t)),this.isResendQueued||(s.output("No re-sending active, starting new re-sending after "+this.currentDelay+" ms","info"),this.scheduleNextResend())}))}resend(){return U(this,void 0,void 0,(function*(){for(;this.storage.length>0;){const t=this.storage.shift();try{yield this.requestSender.send(t)}catch(e){_(t)&&this.storage.unshift(t),this.increaseDelay(),s.output("Failed to re-send request: "+e,"error"),s.output("Increasing re-send delay to "+this.currentDelay,"info"),this.scheduleNextResend();break}}0===this.storage.length&&(s.output("All requests flushed","info"),this.isResendQueued=!1,this.currentDelay=F.BASE_DELAY)}))}scheduleNextResend(){setTimeout((()=>this.resend()),this.currentDelay),this.isResendQueued=!0}increaseDelay(){this.currentDelay=Math.min(2*this.currentDelay,F.MAX_DELAY)}get _requestSender(){return this.requestSender}}function _(t){return!("HB"===t.requestType)||t.isMostRecent}F.MAX_DELAY=32e3,F.BASE_DELAY=500;class B{constructor(t,e,i){this.heartbeatInvalidator=new V,this.htmlPlayerId=i,o.setConfig(e),this.collector=new o(t),this.streamPositionManager=new M(o.getTimeWithOffset),this.builder=new x(t.media,this.collector),this.transmitter=new F(e.trackingUrl),this.heartbeat=new H((()=>{s.output("Triggered: HB","log","fcall"),this.createEventHeartbeat()}),e.heartbeat),this.itemValidator=new L(this.heartbeat)}setStreamPositionCallback(t){this.streamPositionManager.setStreamPositionCallback(t)}isPlaying(){return!this.builder.getSegmentBuilder().isSegmentStopped()}createEventImpression(t,e){try{const i=this.builder.getEventBuilder().buildEventImpression(t,e),n=this.builder.getRequestBuilder().buildRequest(i);this.send(n)}catch(t){s.output("Error in impression event: "+t.message,"error")}}createEventPlayLive(t,e,i,n,r,a){try{this.streamPositionManager.setPlayType("live");const s=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.start(s);const d=this.builder.getSegmentBuilder().createSegmentStarting(i,n,s,c.playbackSpeedConverter(r.speed),"live");this.heartbeat.start();const u=o.getTimeWithOffset(),l=this.builder.getEventBuilder().buildEventPlay(d,e,i,u,t,"live",r,"",a),h=this.builder.getRequestBuilder().buildRequest(l);this.send(h)}catch(t){s.output("Error in play (live) event: "+t.message,"error")}}createEventPlayOnDemand(t,e,i,n){var r;try{this.streamPositionManager.setPlayType("ondemand");const s=null!==(r=i.position)&&void 0!==r?r:this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.start(s);const a=this.builder.getSegmentBuilder().createSegmentStarting(0,e,s,c.playbackSpeedConverter(i.speed),"ondemand");this.heartbeat.start();const d=o.getTimeWithOffset(),u=this.builder.getEventBuilder().buildEventPlay(a,"",0,d,t,"ondemand",i,"",n),l=this.builder.getRequestBuilder().buildRequest(u);this.send(l)}catch(t){s.output("Error in play (on demand) event: "+t.message,"error")}}createEventStop(t){let e=!1;try{const i=null!=t?t:this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(i);const n=this.builder.getSegmentBuilder().createSegmentStopping(i),s=o.getTimeWithOffset(),r=this.builder.getEventBuilder().buildEventStop(n,s),a=this.builder.getRequestBuilder().buildRequest(r);this.send(a),e=!0,this.itemValidator.updateLastPosition(i)}catch(t){s.output("Error in stop event: "+t.message,"error")}return this.heartbeat.stop(),e}createEventSkip(t){let e=!1;try{const i=null!=t?t:this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(i);const n=this.builder.getSegmentBuilder().createSegmentStopping(i),s=o.getTimeWithOffset(),r=this.builder.getEventBuilder().buildEventSkip(n,s),a=this.builder.getRequestBuilder().buildRequest(r);this.send(a),e=!0,this.itemValidator.updateLastPosition(i)}catch(t){s.output("Error in skip event: "+t.message,"error")}return this.heartbeat.stop(),e}createEventHeartbeat(){try{const t=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(t);const e=this.builder.getSegmentBuilder().createSegmentRunning(t,!0),i=o.getTimeWithOffset(),n=this.builder.getEventBuilder().buildEventHeartbeat(e,i),s=this.builder.getRequestBuilder().buildRequest(n);this.send(s),this.heartbeatInvalidator.onNewHeartbeatGenerated(s),this.itemValidator.updateLastPosition(t)}catch(t){s.output("Error in heartbeat event: "+t.message,"error")}}createEventVisibility(t){try{const e=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(e);const i=this.builder.getSegmentBuilder().createSegmentRunning(e,!1),n=o.getTimeWithOffset(),s=this.builder.getEventBuilder().buildEventVisibility(i,t,n),r=this.builder.getRequestBuilder().buildRequest(s);this.send(r),this.itemValidator.updateLastPosition(e)}catch(t){s.output("Error in visibility event: "+t.message,"error")}}createEventScreen(t){try{const e=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(e);const i=this.builder.getSegmentBuilder().createSegmentRunning(e,!0),n=o.getTimeWithOffset(),s=this.builder.getEventBuilder().buildEventScreen(i,t,n),r=this.builder.getRequestBuilder().buildRequest(s);this.send(r),this.itemValidator.updateLastPosition(e)}catch(t){s.output("Error in screen event: "+t.message,"error")}}createEventVolume(t){try{const e=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(e);const i=this.builder.getSegmentBuilder().createSegmentRunning(e,!0),n=o.getTimeWithOffset(),s=this.builder.getEventBuilder().buildEventVolume(i,t,n),r=this.builder.getRequestBuilder().buildRequest(s);this.send(r),this.itemValidator.updateLastPosition(e)}catch(t){s.output("Error in volume event: "+t.message,"error")}}isProjectEnabled(){return!0===this.collector.getProjectStatus()}send(t){this.isProjectEnabled()&&this.transmitter.sendRequest(t)}setExtensionVersion(t){this.collector.setExtensionVersion(t)}}class G{constructor(t,e,i,n){if(a.validateTagConfig(t),void 0===n){n=window.s2sSdkConfig}this.processor=new B(t,n,e),"function"==typeof i&&this.setStreamPositionCallback(i)}impression(t,e){const i="impression()";s.output("Triggered: "+i,"log","fcall",arguments),a.checkArgCount(arguments.length,2,i);const n={contentId:a.isStringAndNotEmpty(t,"contentId",i),customParams:a.areCustomParametersValid(e,"customParams",i)};return a.areParameterValid(n)&&this.processor.createEventImpression(t,e),n}playStreamLive(t,e,i,n,r,o){const d="playStreamLive()";s.output("Triggered: "+d,"log","fcall",arguments),a.checkArgCount(arguments.length,6,d);const u={contentId:a.isStringAndNotEmpty(t,"contentId",d),streamStart:a.isCorrectStreamStart(e,"streamStart",d),streamOffset:a.isCorrectStreamOffset(i,"streamOffset",d),streamId:a.isStringAndNotEmpty(n,"streamId",d),options:a.isPlayOptionsValid(r,"options",d,!1),customParams:a.areCustomParametersValid(o,"customParams",d)};return a.areParameterValid(u)&&this.processor.createEventPlayLive(t,e,i,n,r,o),u}playLive(t,e,i,n,s,r,o){a.checkArgCount(arguments.length,7,"playLive()");const d={screen:s,volume:r};return this.playStreamLive(t,e,i,n,d,o)}playStreamOnDemand(t,e,i,n,r){const o="playStreamOnDemand()";let d;if(s.output("Triggered: "+o,"log","fcall",arguments),"number"==typeof i){a.checkArgCount(arguments.length,5,o);const s=Object.assign(Object.assign({},n),{position:i}),u=r;d={contentId:a.isStringAndNotEmpty(t,"contentId",o),streamId:a.isStringAndNotEmpty(e,"streamId",o),options:a.isPlayOptionsValid(s,"options",o,!0),customParams:a.areCustomParametersValid(u,"customParams",o)};a.areParameterValid(d)&&this.processor.createEventPlayOnDemand(t,e,s,u)}else{a.checkArgCount(arguments.length,4,o);const s=i,r=n;d={contentId:a.isStringAndNotEmpty(t,"contentId",o),streamId:a.isStringAndNotEmpty(e,"streamId",o),options:a.isPlayOptionsValid(s,"options",o,!0),customParams:a.areCustomParametersValid(r,"customParams",o)};a.areParameterValid(d)&&this.processor.createEventPlayOnDemand(t,e,s,r)}return d}playVOD(t,e,i,n,s){a.checkArgCount(arguments.length,5,"playVOD()");const r={screen:i,volume:n};return this.playStreamOnDemand(t,e,r,s)}stop(t){return s.output("Triggered: stop()","log","fcall",t),{stop:this.processor.createEventStop(t)}}skip(t){return s.output("Triggered: skip()","log","fcall"),{skip:this.processor.createEventSkip(t)}}volume(t){const e="volume()";s.output("Triggered: "+e,"log","fcall",t),a.checkArgCount(arguments.length,1,e);const i={volume:a.isStringAndNotEmpty(t,"volume",e)};return this.processor.isPlaying()&&this.processor.createEventVolume(t),i}screen(t){const e="screen()";s.output("Triggered: "+e,"log","fcall",t),a.checkArgCount(arguments.length,1,e);const i={screen:a.isStringAndNotEmpty(t,"screen",e)};return this.processor.isPlaying()&&this.processor.createEventScreen(t),i}setStreamPositionCallback(t){this.processor.setStreamPositionCallback(t)}setExtensionVersion(t){this.processor.setExtensionVersion(t)}}function W(){let t=Date.now().toString().substring(0,13).padStart(13,"0");const e="ABCDEF0123456789",i=e.length,n=56-t.length;for(let s=0;s<n;s++)t+=e.charAt(Math.floor(Math.random()*i));return t}var j;!function(t){t[t.NOT_ALLOWED=0]="NOT_ALLOWED",t[t.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",t[t.REQUIRE_LI=2]="REQUIRE_LI"}(j||(j={}));class ${static isValidTCData(t){return!!(t.vendor&&t.vendor.consents&&t.vendor.legitimateInterests&&t.purpose&&t.purpose.consents&&t.purpose.legitimateInterests)}static hasReadWrite(t){return $.hasPurpose($.PURPOSE_READ_WRITE_ON_USER_DEVICE,t)}static hasMeasureAdPerformance(t){return $.hasPurpose($.PURPOSE_MEASURE_AD_PERFORMANCE,t)}static hasMeasureContentPerformance(t){return $.hasPurpose($.PURPOSE_MEASURE_CONTENT_PERFORMANCE,t)}static hasMarketResearch(t){return $.hasPurpose($.PURPOSE_MARKET_RESEARCH,t)}static hasGfK(t){return $.isValidTCData(t)&&!0===t.vendor.consents[$.VENDOR_ID]}static hasPurpose(t,e){var i,n;const s=null===(n=null===(i=e.publisher)||void 0===i?void 0:i.restrictions[t])||void 0===n?void 0:n[$.VENDOR_ID];return(void 0===s||s!==j.NOT_ALLOWED)&&($.isValidTCData(e)&&!0===e.purpose.consents[t])}}$.VENDOR_ID=758,$.PURPOSE_READ_WRITE_ON_USER_DEVICE=1,$.PURPOSE_MEASURE_AD_PERFORMANCE=7,$.PURPOSE_MEASURE_CONTENT_PERFORMANCE=8,$.PURPOSE_MARKET_RESEARCH=9;class K{}K.version="2.4.1",K.suiGeneratorUrl="es-config.sensic.net/suigenerator",K.thirdPartyCookieIframeUrl="https://es-config.sensic.net/3pc.html",K.panelcookie=["MEPP","GFKP","GFKM"],K.suiPixelUrl=".trk.sensic.net/tp.gif",K.suiHtmlUrl="https://es-config.sensic.net/sui.html",K.filecacheUrl="https://es-config.sensic.net/sui_fc",K.featureFlagTcf=!0,K.suiLogging=1,K.projectId="es1",K.trackingUrl="https://es1-s2s.sensic.net";const X={TCF:K.featureFlagTcf};class Y{static isEnabled(t){return!0===X[t]}}function Q(t){return $.hasGfK(t)&&$.hasMarketResearch(t)&&$.hasMeasureAdPerformance(t)&&$.hasMeasureContentPerformance(t)&&$.hasReadWrite(t)}class z{static sendData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST",i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;return new Promise(((s,r)=>{const o=new XMLHttpRequest;o.onloadend=()=>{o.status>=200&&o.status<400?(n&&n(o),s()):r()},o.open(e,t,!0),o.setRequestHeader("Content-Type","text/plain"),i?o.send(JSON.stringify(i)):o.send()}))}}class J{static getCookie(t){const e=document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return e?decodeURIComponent(e[2]):null}static deleteCookie(t,e){this.setCookie(t,"",{days:-1,domain:e})}static setCookie(t,e){let{days:i=730,domain:n,sameSite:s="None"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3);let o=t+"="+encodeURIComponent(e)+";path=/;expires="+r.toUTCString();n&&(o+=";domain="+n),o+=";sameSite="+s,"https:"===window.location.protocol&&(o+=";secure"),document.cookie=o}static isHttp(){if("undefined"!=typeof window){const t=window.document.getElementsByTagName("script");for(let e=0;e<t.length;e++)if(t[e]&&t[e].src.match(/\/\/[^/]*sensic.net\/\S*\.js$/))return null!==t[e].src.match(/^http:/);if("http:"===window.location.protocol)return!0}return!1}}const Z="sui_1pc";function tt(){if(!J.getCookie(Z)){const t=W();J.setCookie(Z,t,{sameSite:"Lax"})}return J.getCookie(Z)}const et=/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/i;function it(){var t;const e=null===(t=null===window||void 0===window?void 0:window.gfkS2sConf)||void 0===t?void 0:t.ai;return et.test(e)&&"00000000-0000-0000-0000-000000000000"!==e?e:null}const nt="sensic_sui_3pc",st="sensic_sui_old_3pc";function rt(t,e){const i=new Promise(((t,i)=>{setTimeout((()=>i(`No value returned after ${e} ms`)),e)}));return Promise.race([t,i])}var ot=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{d(n.next(t))}catch(t){r(t)}}function a(t){try{d(n.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}d((n=n.apply(t,e||[])).next())}))};let at,dt,ut;const ct=1e4;function lt(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];void 0===at&&ht();const i={};return e&&(ut=rt(mt(st),ct),setTimeout((()=>{at.contentWindow.postMessage({readOldCookie:!0},"*")}),500),i.oldCookie=ut),t&&(dt=rt(mt(nt),ct),at.contentWindow.postMessage({readNewCookie:!0},"*"),i.newCookie=dt),i}function ht(){at=document.createElement("iframe"),at.style.visibility="hidden",at.style.display="none",at.width="0",at.height="0",at.src=K.thirdPartyCookieIframeUrl.replace(/^https?:/,J.isHttp()?"http:":"https:");const t=document.body.childNodes[0];var e,i;e=at,(i=t)&&i.parentNode?i.parentNode.insertBefore(e,i.nextSibling):document.body.appendChild(e)}function mt(t){return new Promise((e=>{window.addEventListener("message",(i=>{i.data.hasOwnProperty(t)&&e(i.data[t])}))}))}function gt(){const t="https://fc-id.sensic.net/".replace(/^https?:/,J.isHttp()?"http:":"https:");return new Promise(((e,i)=>{const n=new XMLHttpRequest;n.onloadend=()=>{n.status>=200&&n.status<=299?e(n.response):i(`${t} returned ${n.status}`)},n.open("GET",t,!0),n.send()}))}var pt=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{d(n.next(t))}catch(t){r(t)}}function a(t){try{d(n.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}d((n=n.apply(t,e||[])).next())}))};function ft(){return rt(new Promise(((t,e)=>{Y.isEnabled("TCF")||e("TCF feature flag is disabled"),window.__tcfapi||e("No __tcfapi found."),window.__tcfapi("addEventListener",2,((e,i)=>{!i||"tcloaded"!==e.eventStatus&&"useractioncomplete"!==e.eventStatus||t(e.tcString)}),[758])})),1e3)}function vt(){return pt(this,void 0,void 0,(function*(){const{oldCookie:t,newCookie:e}=lt(!0),i=[["sui_1pc",tt()],["ai",it()],["sui_fc",gt()],["sui_3pc",e],["sui_old_3pc",t],["external",window.gfkS2sConf?window.gfkS2sConf.extID:window.gfkConnectorConf?window.gfkConnectorConf.extID:void 0]],n={};for(const[t,e]of i)try{const i=yield e;i&&(n[t]=i)}catch(e){s.warn(`Failed to collect ID '${t}': `+e.toString())}return n}))}function St(){const t=new URL("id",K.trackingUrl);return J.isHttp()?t.protocol="http:":t.protocol="https:",t}var wt=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"1",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"sensic-sdk-web";return pt(this,void 0,void 0,(function*(){const a={version:r,source:o,id:Object.assign({},t),privacy:{providedOptin:e},tracking:i};try{a.privacy.tcString=yield ft()}catch(t){s.warn("Could not determine TC string: "+t)}i&&n&&Object.assign(a.id,yield vt()),s.log(`VMS privacy settings:, ${JSON.stringify(a,null,2)}`);const d=St();yield z.sendData(d.href,"POST",a)}))},bt=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{d(n.next(t))}catch(t){r(t)}}function a(t){try{d(n.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}d((n=n.apply(t,e||[])).next())}))};function yt(t){return bt(this,void 0,void 0,(function*(){try{const e=function(t){const e=J.isHttp()?"http://":"https://",i=(t||"error-got-empty-id").replace("|","-")+K.suiPixelUrl;return new URL(e+i)}(t);return function(t,e){let{searchParams:i}=e;var n;const s=new URLSearchParams(window.location.search);if(i.append("m",(null===(n=window.gfkS2sConf)||void 0===n?void 0:n.media)||"no_mediaid"),i.append("r",window.location.host),i.append("p",K.projectId),i.append("instanceid",t),window.location.host.includes(".sensic.net"))for(const t of["paneluserid","hhid","uid","pid","origin"])s.has(t)&&i.append(t,s.get(t))}(t,e),s.log("Relay ID: "+e),yield z.sendData(e.href+"&redirect=manual","GET",null,(t=>{if(window.postMessage({relayRequestServerDate:t.getResponseHeader("Date")},"*"),t.getAllResponseHeaders().includes("x-location")){const e=new XMLHttpRequest;e.open("GET",t.getResponseHeader("x-location"),!0),e.send()}}))}catch(t){s.error("Failed to send relay request: "+t.message)}}))}var It=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{d(n.next(t))}catch(t){r(t)}}function a(t){try{d(n.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}d((n=n.apply(t,e||[])).next())}))};var Ct=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{d(n.next(t))}catch(t){r(t)}}function a(t){try{d(n.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}d((n=n.apply(t,e||[])).next())}))};const Et=new class{constructor(){this.instanceID=W()}init(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return It(this,void 0,void 0,(function*(){s.info("Using VMS V2"),yt(this.instanceID);const r=yield this.hasOldPanelCookie(),o={instanceid:this.instanceID};(i.paneluserid||i.hhid)&&(o.panelistid={panel:i.pid,paneluserid:i.paneluserid,panelhouseholdid:i.hhid,panelhouseholdmemberid:i.uid}),function(t){let{optin:e}=t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((t=>i?t(!0):void 0!==e?t(e):(setTimeout((()=>{t(!1)}),1e4),void(window.__tcfapi&&Y.isEnabled("TCF")?window.__tcfapi("addEventListener",2,((i,n)=>{n||t(!1),i.gdprApplies||(t(e),window.__tcfapi("removeEventListener",2,(()=>{}),i.listenerId)),!n||"tcloaded"!==i.eventStatus&&"useractioncomplete"!==i.eventStatus||(t(Q(i)),window.__tcfapi("removeEventListener",2,(()=>{}),i.listenerId))})):t(!0)))))}({optin:t},r).then((s=>{var r;wt(o,null!==(r=i.optin)&&void 0!==r?r:t,s,!0,"2",n).then((()=>{"function"==typeof e&&e()}))}))}))}hasOldPanelCookie(){return It(this,void 0,void 0,(function*(){try{const t=yield function(){var t;return ot(this,void 0,void 0,(function*(){const{oldCookie:e}=lt();let i=null;if(void 0!==(null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.nodeName))try{i=yield e}catch(t){s.warn("Failed to collect oldCookie: "+t.toString())}return i}))}();return void 0!==(null==t?void 0:t.paneluserid)||void 0!==(null==t?void 0:t.uid)||void 0!==(null==t?void 0:t.hhid)||void 0!==(null==t?void 0:t.pid)}catch(t){s.error("Failed to get oldPanelCookie: "+t.message)}}))}};let Pt;s.readFromTagConf(),s.readFromLocalStorage(),Array.prototype.forEach&&Array.prototype.indexOf&&window.JSON?(Pt=(new Date).getTime(),window.s2sSdkConfig=new t,e.enable(),o.setConfig(window.s2sSdkConfig),o.init(window.gfkS2sConf,Et),function(){var t,e;Ct(this,void 0,void 0,(function*(){window.gfks?window.gfks=G:(s.output("You are using a deprecated tag. Please visit https://confluence-docu.gfk.com/display/SENSIC/Adding+the+Tag and update your tag.","warn"),window.s=G),(null===(t=window.gfkS2s)||void 0===t?void 0:t.agents)&&window.gfkS2s.agents.forEach((t=>{const e=t.a;t.a=new G(e.config,e.pId,(()=>e.p),window.s2sSdkConfig),s.output('Processing started for player "'+e.pId+'"',"info"),e.queue.forEach((i=>{s.output('Method "'+i.f+'" was executed for player "'+e.pId+'" before SDK loaded',"info"),t.a[i.f].apply(t.a,i.a)})),t.a.setStreamPositionCallback(e.cb)})),(null===(e=window.gfkS2s)||void 0===e?void 0:e.onSdkLoaded)&&window.gfkS2s.onSdkLoaded();const i=(new Date).getTime()-Pt;s.output(`Agents initialized after ${i} ms`,"debug"),window.gfkS2s&&(window.gfkS2s.getInstanceID=()=>Et.instanceID)}))}(),o.setTimeOffset()):s.output("Device doesn't support ECMAScript 5","error")}();
//# sourceMappingURL=s2s-web.js.map