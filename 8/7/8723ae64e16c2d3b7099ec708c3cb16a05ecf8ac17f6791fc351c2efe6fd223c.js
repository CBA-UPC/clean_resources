var WorkerMessengerCommand={AMP_SUBSCRIPION_STATE:"amp-web-push-subscription-state",AMP_SUBSCRIBE:"amp-web-push-subscribe",AMP_UNSUBSCRIBE:"amp-web-push-unsubscribe"};if(!_nvClientConfig)var _nvClientConfig={};_nvClientConfig.url={chrome_subscribe:"https://push.notifyvisitors.com/brand/t1/chrome_subscribe",chrome_unsubscribe:"https://push.notifyvisitors.com/brand/t1/unsubscribe",fireFox_subscribe:"https://push.notifyvisitors.com/brand/t1/mozilla_subscribe",fireFox_unsubscribe:"https://push.notifyvisitors.com/brand/t1/unsubscribe_mozilla"};
(function(a){_nvClientConfig.data.isChrome=!1;_nvClientConfig.data.isFirefox=!1;_nvClientConfig.data.isChromePush=!1;_nvClientConfig.data.isFirefoxPush=!1;a=a.navigator.userAgent;if(/chrome/i.test(a))_nvClientConfig.data.isChrome=!0,/Android|webOS/i.test(navigator.userAgent)?(a=a.split("/"),a=a[a.length-2]):(a=a.split(" "),a=a[a.length-2].substr(7)),42<=a.substring(0,2)&&(_nvClientConfig.data.isChromePush=!0);else if(/firefox/i.test(a)){_nvClientConfig.data.isFirefox=!0;var b=a.indexOf("Firefox");
a=a.substring(b+8);a=parseInt(""+a,10);isNaN(a)&&(a=parseInt(navigator.appVersion,10));if(44<=a&&!/Android|webOS/i.test(navigator.userAgent)||48<=a&&/Android|webOS/i.test(navigator.userAgent))_nvClientConfig.data.isFirefoxPush=!0}})(self);self.addEventListener("message",function(a){var b=a.data.payload;switch(a.data.command){case WorkerMessengerCommand.AMP_SUBSCRIPION_STATE:onMessageReceivedSubscriptionState(b);break;case WorkerMessengerCommand.AMP_SUBSCRIBE:onMessageReceivedSubscribe(b);break;case WorkerMessengerCommand.AMP_UNSUBSCRIBE:onMessageReceivedUnsubscribe(b)}});
function onMessageReceivedSubscriptionState(){var a=null;self.registration.pushManager.getSubscription().then(.then(function(b){null==b?broadcastReply(WorkerMessengerCommand.AMP_SUBSCRIPION_STATE,!1):broadcastReply(WorkerMessengerCommand.AMP_SUBSCRIPION_STATE,!!a&&"granted"===b)})}
function onMessageReceivedSubscribe(){self.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:urlBase64ToUint8Array(_nvClientConfig.cPubKey)}).then(function(a){nvPush.send(a,"subscribe");broadcastReply(WorkerMessengerCommand.AMP_SUBSCRIBE,null)})}
function onMessageReceivedUnsubscribe(){self.registration.pushManager.getSubscription().then(.then(}var nvPush={send:function(a,b){var c=this.subscriptionData(a);if(c.hasOwnProperty("pkey")&&(c=this.serverData(c,b))&&c.hasOwnProperty("query")&&c.hasOwnProperty("url"))return"unsubscribe"===b&&_nvClientConfig.data.isChrome&&(c.query.subscriptionID=c.query.subscriptionId),"unsubscribe"===b&&_nvClientConfig.data.isFirefox&&(c.query.subscriptionID=c.query.endpoint),this.nvFetch(c.url,c.query).then(["catch"](},nvFetch:function(a,b){query=-1!==
a.indexOf("?")?"&":"?";b=b||{};for(key in b)b.hasOwnProperty(key)&&(query+=encodeURIComponent(key)+"="+encodeURIComponent(b[key])+"&");return fetch(a+query,{mode:"no-cors",credentials:"include"})},serverData:function(a,b){var c={};b&&"string"===typeof b&&(c.query=Object.assign({},_nvClientConfig.auth,a),_nvClientConfig.data.isChrome&&_nvClientConfig.data.isChromePush&&(c.url=_nvClientConfig.url["chrome_"+b]),_nvClientConfig.data.isFirefox&&_nvClientConfig.data.isFirefoxPush&&(c.url=_nvClientConfig.url["fireFox_"+
b]),c.query.vapid=1);return c},subscriptionData:function(a){if(a.endpoint){var b={};if(_nvClientConfig.data.isChrome&&_nvClientConfig.data.isChromePush){if(a.subscriptionId)b.subscriptionId=a.subscriptionId;else{var c=a.endpoint.split("/");b.subscriptionId=c[c.length-1]}console.log("server subscription id chrome: ",b.subscriptionId)}else _nvClientConfig.data.isFirefox&&_nvClientConfig.data.isFirefoxPush&&(b.endpoint=a.endpoint,console.log("server subscription id mozilla: ",b.endpoint));if(""!=b.subscriptionId){try{var d=
JSON.stringify(a);d=JSON.parse(d)}catch(e){b.subscriptionId=null,console.log(e)}d&&d.keys&&(d.keys.p256dh&&(b.pkey=d.keys.p256dh),d.keys.auth&&(b.authkey=d.keys.auth))}return b}console.log("This browser isn't currently supported yet")}};