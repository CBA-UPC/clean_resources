(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["shared~loader.AppModules~loader.LoggedOutNotifications"],{145988:288625:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PromptStatus:()=>N,SET_PROMPT_STATUS:()=>y,default:()=>L,fetchLoggedOutNotificationsDataTypes:()=>h,loadLoggedOutNotificationData:()=>V,pushSubscribeLoggedOut:()=>Q,resetLoggedOutNotificationState:()=>j,selectArkosePromptStatus:()=>C,selectBrowserPromptStatus:()=>I,selectFetchStatus:()=>R,selectInAppPromptStatus:()=>Z,selectIsEligibleForPushPrompt:()=>F,selectLastSeenTimeStamp:()=>K,selectPushNotificationsPromptIsSeen:()=>D,setLastSeenTimeStamp:()=>A,setPromptStatus:()=>w,updatePromptStatus:()=>H,verifyArkoseTokenAndSavePushToken:()=>M,verifyArkoseTokenAndSavePushTokenActionTypes:);var o=n(256666),r=n(133028),i=(n(73439),n(571372),n(472599)),s=n(17360),a=n(145988),u=n.n(a),c=n(297534),p=function(e,t){return(null==t?void 0:t.enable_logged_out_web_notifications)||(0,i.ZP)("GQL LoggedOutNotifications: Failed to execute EnableLoggedOutWebNotifications",{extra:(0,c.dL)(e)}),(0,s.jB)(e)};const f=function(e){var t=e.apiClient;e.featureSwitches;return{enableLoggedOutWebNotifications:};var S=n(366136),l=n(426540),d=n(526853),E=n(753392),m=n(823803),g=n(467935),T=(n(315735),n(906886),n(214121),n(460523),n(543673),n(240753),n(128399),n(477950),n(74069),n(669263)),P=(0,T.j)("https://x.com");var _="loggedOutNotifications",b="rweb.loggedOutNotifications",y="rweb/loggedOutNotifications/SET_PROMPT_STATUS",O="rweb/loggedOutNotifications/SET_LAST_SEEN_TIMESTAMP",N=Object.freeze({DISMISSED:"dismissed",APPROVED:"approved",NOT_SEEN:"not_seen",SEEN:"seen"}),h=Object.freeze({REQUEST:"rweb/loggedOutNotifications/FETCH_REQUEST",SUCCESS:"rweb/loggedOutNotifications/FETCH_SUCCESS",FAILURE:"rweb/loggedOutNotifications/FETCH_FAILURE"}),v=Object.freeze({REQUEST:"rweb/loggedOutNotifications/SAVE_PUSH_TOKEN_REQUEST",SUCCESS:"rweb/loggedOutNotifications/SAVE_PUSH_TOKEN_SUCCESS",FAILURE:"rweb/loggedOutNotifications/SAVE_PUSH_TOKEN_FAILURE"}),w=A=k={inAppPrompt:N.NOT_SEEN,browserPrompt:N.NOT_SEEN,arkosePrompt:N.NOT_SEEN,fetchStatus:m.ZP.NONE};function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;if(!t)return e;switch(t.type){case h.REQUEST:return(0,r.Z)((0,r.Z)({},e),{},{fetchStatus:m.ZP.LOADING});case h.FAILURE:return(0,r.Z)((0,r.Z)({},e),{},{fetchStatus:m.ZP.FAILED});case h.SUCCESS:return(0,r.Z)((0,r.Z)((0,r.Z)({},e),t.payload),{},{fetchStatus:m.ZP.LOADED});case y:if(t.payload)return(0,r.Z)((0,r.Z)({},e),{},(0,o.Z)({},t.payload.promptType,t.payload.promptStatus));break;case O:return(0,r.Z)((0,r.Z)({},e),{},{lastSeenTimestamp:Date.now()});default:return e}return e}var U=Z=function(e){return e[_].inAppPrompt},I=function(e){return e[_].browserPrompt},C=function(e){return e[_].arkosePrompt},K=function(e){return e[_].lastSeenTimestamp},R=D=F=V=function(){return function(e,t,n){var o=n.devicePersistence,r=n.featureSwitches;return R(t())===m.ZP.LOADED?Promise.resolve():(e({type:h.REQUEST}),o.get(b).then((function(t){return null!=t&&t.lastSeenTimestamp&&function(e){var t=e.browserPrompt,n=e.featureSwitches,o=e.lastSeenTimestamp;if(t!==N.APPROVED&&"denied"!==l.qO()){var r=n.getNumberValue("responsive_web_logged_out_notifications_fatigue_days_count",7);return Date.now()-o>864e5*r}return!1}({featureSwitches:r,lastSeenTimestamp:t.lastSeenTimestamp,browserPrompt:t.browserPrompt})?e(U(k)):e(U(t))})).catch(())}},j=H=function(e,t){return function(n,i,s){var a=s.devicePersistence,u=(0,r.Z)((0,r.Z)({},i()[_]),{},(0,o.Z)({},e,t));return a.set(b,u).then((function(){"inAppPrompt"===e&&t===N.SEEN&&n(A()),n(w(e,t))}))}},Q=function(){return function(e,t,n){n.api,n.featureSwitches;var o=n.scribe,i="default"===l.qO(),s={page:"app",section:"permissions",component:"lo_notifications"},a=function(e){i&&o.log((0,r.Z)((0,r.Z)({},s),{},{action:e}))};return a("impression"),l.pI(!0).then((function(t){return a("permissions_granted"),e(H("browserPrompt",N.APPROVED)),Promise.resolve(!0)}),(function(t){return"denied"===l.qO()?(a("permissions_denied"),e(H("browserPrompt",N.DISMISSED)),Promise.resolve(!1)):(a("permissions_error"),e(H("browserPrompt",N.SEEN)),Promise.resolve(!1))}))}},M=function(e){return function(t,n,o){var r=o.api,i=function(e){var t,n=null===(t=new URL(e,P).searchParams.get("access_token"))||void 0===t?void 0:t.split("|");if(!n)return{};var o=(n.filter((function(e){return e.match("pk=")}))[0]||"").slice(3),r=n.filter(()[0]||"";return{accessToken:r?"".concat(n[0],"|").concat(r):n[0],publicKey:o}}(e),s=i.accessToken,a=i.publicKey;if(!s||!a)return Promise.reject(new Error("loggedOutNotifications#verifyArkoseTokenAndSavePushToken: unable to decode arkose link"));return l.pI(!1).then((function(e){var o=n(),i=(0,g.VT)(o),u=(0,S.o)(i),c=l.lX().os_version,p=void 0===c?"":c,d=function(e){var t={pushFcmToken:e.endpoint,encryptionKey1:"",encryptionKey2:""};return e.keys&&(t.encryptionKey1=e.keys.p256dh,t.encryptionKey2=e.keys.auth),t}(e),m=d.encryptionKey1,T=d.encryptionKey2,P=d.pushFcmToken,_={locale:u,accessToken:s,publicKey:a,language:i,osVersion:p,encryptionKey1:m,encryptionKey2:T,pushFcmToken:P};return E.AB(t,{params:_,request:r.withEndpoint(f).enableLoggedOutWebNotifications})({actionTypes:v,context:"SAVE_PUSH_TOKEN",meta:_})}),()}};d.Z.register((0,o.Z)({},_,L))}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web-legacy/shared~loader.AppModules~loader.LoggedOutNotifications.3c52b5ba.js.mapor:rgba(0,0,0,.1)}.login__separator__text[data-v-0ae53d5c]{background-color:#fff;padding:0 2em;font-size:18px;position:relative;z-index:1}.login__form[data-v-0ae53d5c]{padding:40px 0 64px}.login__form__submit[data-v-0ae53d5c]{margin-top:24px;font-size:16px}.login__password-link[data-v-0ae53d5c]{text-decoration:underline}.login__back[data-v-0ae53d5c]{width:100%;text-align:center;padding-bottom:20px}.login__back a[data-v-0ae53d5c]{position:relative;font-size:12px;display:inline-block;padding-bottom:5px}.login__back a[data-v-0ae53d5c]:after{content:"";position:absolute;bottom:3px;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);width:100%;height:1px;background:#000;-webkit-transition:all .15s ease;transition:all .15s ease}.login__back a[data-v-0ae53d5c]:hover:after{width:10%}.form__error--success[data-v-0ae53d5c]{text-align:center;color:#191919;font-size:16px;margin-top:40px}