"use strict";(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[9766],{30960:function(e,t,i){var n=i(37311),o=i(2406),s=i.n(o),a=i(423),r=i(47189),c=i(52477),d=i(70364),l=i(45821),h=i(62414),u=i(16548),p=i(60987),f=i(95272),m={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visiable?i("div",{staticClass:"k-certification",class:{"k-certification--phone-certification":e.isPhoneCertification}},[e.initDataLoading?i("KLoading"):e._e(),e._v(" "),i("iframe",{directives:[{name:"show",rawName:"v-show",value:e.iframeShow,expression:"iframeShow"}],ref:"iframe",staticStyle:{width:"100%",height:"458px",visibility:"hidden",position:"inherit"},attrs:{frameborder:"0"}}),e._v(" "),e.txtShow?i("div",{staticClass:"tips-box"},[i("div",{staticClass:"phone-img"}),e._v(" "),i("div",{staticClass:"sub-disc"},[e._v(e._s(e.descTxt?e.descTxt:e.lang_desc))]),e._v(" "),i("div",{staticClass:"btns"},[i("KButton",{staticClass:"cancle",on:{click:e.close}},[e._v(e._s(e.lang_cancel))]),e._v(" "),i("KButton",{attrs:{type:"primary"},on:{click:e.toBindPhone}},[e._v(e._s(e.lang_bind))])],1)]):e._e(),e._v(" "),e.qrCodeBindShow?i("QrCodeBind",{attrs:{from:e.qrCodeBindFrom,onDwEvent:e.onDwEvent},on:{hideBottomTip:success:e.onQrCodeBindSuccess}}):e._e(),e._v(" "),e.bindTipShow?i("div",{staticClass:"k-phoneBind__qr-code-switch",on:{click:e.switchQrCodeStatus}},[e._v("\n    "+e._s(e.qrCodeStatus?e.lang_smsValid+" ＞":e.lang_wxValid+" ＞")+"\n  ")]):e._e()],1):e._e()},staticRenderFns:[],name:"KCertification",components:{KButton:h.Z,QrCodeBind:p.Z,KLoading:f.Z},mixins:[c.default],props:{from:{type:String,default:d.Z.WPS&&!d.Z.wps2018beta?"kdpc-kdocs-web-share":"kdweb-kdocs-web-share"},descTxt:{type:String},moreDialog:{type:Boolean,default:!1},unbind:{type:Boolean},parentComponentName:{type:String},bindPhoneCb:{type:Function,default:function(){}},identifyType:{type:String,default:"phone"},isQrCodeBind:{type:Boolean,default:!0},qrCodeBindFrom:{type:String,default:"default",required:!1},onDwEvent:{type:Function,default:function(){}},showSuccessToast:{type:Boolean,default:!0}},data:function(){return{visiable:!0,bindSuccessed:!1,thirdPartCookies:!0,url:"",lang_desc:"certification"===this.identifyType?(0,l.t)("basic.certification.descCertification"):(0,l.t)("basic.certification.desc"),lang_cancel:(0,l.t)("basic.certification.cancel"),lang_bind:"certification"===this.identifyType?(0,l.t)("basic.certification.cert"):(0,l.t)("basic.certification.bind"),lang_wxValid:(0,l.t)("logic.QrCodeBind.wxValid"),lang_smsValid:(0,l.t)("logic.QrCodeBind.smsValid"),initDataLoading:!0,isBindWx:!1,qrCodeStatus:!1,isHideBottomTip:!1,dwFromMap:{fileEdit:"editFile",share:"share",default:"other"}}},computed:{iframeShow:function(){return this.moreDialog?this.thirdPartCookies&&this.bindSuccessed&&!this.initDataLoading&&!this.qrCodeStatus:this.thirdPartCookies&&!this.initDataLoading&&!this.qrCodeStatus},txtShow:function(){return this.moreDialog?!this.bindSuccessed&&!this.initDataLoading&&!this.qrCodeStatus:!this.thirdPartCookies&&!this.initDataLoading&&!this.qrCodeStatus},qrCodeBindSwipe},qrCodeBindShow:function(){return!this.initDataLoading&&this.qrCodeBindSwitch&&this.isBindWx&&this.bindSuccessed&&this.qrCodeStatus},bindTipShow:function(){return!this.initDataLoading&&this.qrCodeBindSwitch&&this.isBindWx&&this.bindSuccessed&&!this.isHideBottomTip},isPhoneCertification:function(){return!this.isBindWx&&"certification"===this.identifyType&&!this.txtShow}},created:function(){var e=this;return(0,n.Z)(s().mark((function t(){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.unbind){t.next=12;break}if("certification"!==e.identifyType){t.next=7;break}return t.next=4,(0,r.Vsp)();case 4:i=t.sent,t.next=10;break;case 7:return t.next=9,(0,r.yYX)();case 9:i=t.sent;case 10:e.$emit("bindPhoneCb","fetchUserBindFinish"),"certification"===e.identifyType?i&&i.phone&&1===i.certification&&(e.$emit("bindPhoneCb","bindPhoneSuccessed"),2===i.phone_user_status&&e.$emit("bindPhoneCb","certificationForbidden"),e.visiable=!1):i&&i.phone&&i.phone.value&&(e.$emit("bindPhoneCb","bindPhoneSuccessed"),e.visiable=!1);case 12:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this;return(0,n.Z)(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return window.addEventListener("message",e.onMessage),e.url="".concat(a.fy,"/crossdomain.html?action=sharePhoneBind&from=").concat(e.from,"&type=").concat(e.identifyType),e.qrCodeBindSwitch?e.getWxBindStatus():e.initDataLoading=!1,t.next=5,(0,r.F8v)();case 5:if(!t.sent){t.next=10;break}e.$refs.iframe.src=e.url,t.next=11;break;case 10:e.thirdPartCookies=!1;case 11:case"end":return t.stop()}}),t)})))()},methods:{toBindPhone:function(){this.bindSuccessed=!0,this.close(),window.open(this.url)},cl!1},onMessage:function(e){var t=this,i=this.$refs.iframe,n="certification"===this.identifyType?(0,l.t)("basic.certification.certificationSuccess"):(0,l.t)("basic.certification.bindSuccess"),o="";try{o=e.data&&JSON.parse(e.data).action}catch(e){}switch(o){case"load":this.thirdPartCookies&&i&&(i.style.visibility="visible");break;case"beforeunload":this.thirdPartCookies&&i&&(i.style.visibility="hidden");break;case"bindPhoneSuccessed":this.showSuccessToast&&u.Z.success(n),this.bindSuccessed=!0,this.thirdPartCookies&&setTimeout((function(){t.visiable=!1,t.$emit("close"),t.$emit("bindPhoneCb","bindPhoneSuccessed")}),1e3)}},getWxBindStatus:function(){var e=this;return(0,n.Z)(s().mark((function t(){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.q6S)();case 3:(i=t.sent)&&i.wechat&&(e.isBindWx=!0,e.qrCodeStatus=!0,e.bindSuccessed=!0,e.onDwEvent("realname_dialog",{action:"show",page:"scan",scene:e.dwFromMap[e.qrCodeBindFrom]}));case 5:return t.prev=5,e.initDataLoading=!1,t.finish(5);case 8:case"end":return t.stop()}}),t,null,[[0,,5,8]])})))()},switchQrCodeStatus:function(){this.qrCodeStatus?(this.onDwEvent("realname_dialog",{action:"show",page:"message",scene:this.dwFromMap[this.qrCodeBindFrom]}),this.onDwEvent("realname_dialog",{action:"click",type:"switchToMessage",page:"scan",scene:this.dwFromMap[this.qrCodeBindFrom]})):(this.onDwEvent("realname_dialog",{action:"show",page:"scan",scene:this.dwFromMap[this.qrCodeBindFrom]}),this.onDwEvent("realname_dialog",{action:"click",type:"switchToScan",page:"message",scene:this.dwFromMap[this.qrCodeBindFrom]})),this.qrCodeStatus&&!this.thirdPartCookies&&(this.$emit("close"),window.open(this.url)),this.qrCodeStatus=!this.qrCodeStatus},onQrCodeBindSuccess:function(){this.bindSuccessed=!0,this.visiable=!1,this.$emit("close"),this.$emit("bindPhoneCb","bindPhoneSuccessed")}},install:function(e){e.component(m.name,m)}};t.Z=m},58166:function(e,t,i){var n=i(56451),o=i(49200),s=i(423),a=i(84588),r=i.n(a),c=i(82551),d=i(5330),l=i(50792),h=i(45821),u=i(26743),p=i(85476),f=i(34241),m=i(23070),g=i(80589),v=i(74470),w=i(57099),_=i.n(w),C=i(43229),y=i.n(C),S=i(42173),b=i.n(S),k=i(43800),x=i(55382),P=i.n(x),T=i(16569),D=i.n i}var B={kdocs:c,square:d},E={ppt:"wpp",pom:"flow-chart",dbt:"dbs",ofd:"ofd",ckt:"poster",img:"pic",doc_wps:"wps",xls_wps:"et",txt:"txt",pdf:"pdf",pof:"mind-mapping",otl:"air-page",kw:"whiteboard",ksheet:"air-sheet",audio:"audio",doc:"wps",h5:"link",xls:"et",note:"sticky-note",form:"form",zip:"compressed-package",video:"video",resh:"job",cad2d:"cad",cad3d:"3dmodel",unknown:"unknown-file",sharefolder2:"folder-shared",folder:"folder"},Q={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:["k-MiniCode-wrapper",{"is-pc-office":e.isPC},{"is-web-cloud":e.isCloud},{"k-MiniCode-wrapper--pcShare":e.pcShare},{"k-MiniCOde-wrapper-sharev3":e.isShareV3},{"k-MiniCOde-wrapper-copy":e.copyText}]},[i("div",{staticClass:"minicode-title",attrs:{tabindex:"0"}},[i("img",{attrs:{src:e.fileIcon}}),e._v(" "),i("span",{staticClass:"minicode-title-txt"},[e._v(e._s(e._f("formatFileName")(e.file.fname)))])]),e._v(" "),e.hasSharePerm&&e.canCoop&&e.secretPerm?i("div",{staticClass:"minicode-tips"},[i("span",{staticClass:"minicode-tips-txt"},[e._v(e._s(e.shareTips))]),e._v(" "),i("el-dropdown",{ref:"dropdown",staticClass:"minicode-dropdown",attrs:{trigger:"click",placement:"bottom-start"},on:{command:e.handlePerm,"visible-change":e.permVisibleChange}},[i("span",{staticClass:"el-dropdown-link"},[i("span",[e._v(e._s(e.PERM_LIST[e.secretPerm]))]),e._v(" "),e.showPermDropDown?i("ArrowUp",{attrs:{size:"12",fill:"currentColor"}}):i("ArrowDown",{attrs:{size:"12",fill:"currentColor"}})],1),e._v(" "),i("el-dropdown-menu",{staticClass:"minicode-dropdown-menu",class:{"minicode-dropdown-menu--dark":e.isDark},attrs:{slot:"dropdown",appendToBody:!1,tabindex:"0"},slot:"dropdown"},e._l(Object.keys(e.PERM_LIST),(function(t){return i("el-dropdown-item",{key:t,class:{checked:t===e.secretPerm},attrs:{command:t}},[e._v("\n          "+e._s(e.PERM_LIST[t])+"\n          "),t===e.secretPerm&&e.pcShare?i("KIcon",{attrs:{type:"m-check"}}):e._e()],1)})),1)],1)],1):e._e(),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.miniCode,expression:"miniCode"}],staticClass:"minicode",on:{contextmenu:e.onContextmenu,mouseover:e.onMouseover,mouseout:e.onMouseout}},[i("div",{staticClass:"minicode__img"},[i("img",{attrs:{src:e.miniCode,alt:"小程序码"}}),e._v(" "),e.isShowGuide?i("div",{staticClass:"minicode-qrScanGuide"},[i("div",{staticClass:"minicode-qrScanGuide__title"},[e._v("\n          "+e._s(e.scanGuide)+"\n        ")]),e._v(" "),i("div",{staticClass:"minicode-qrScanGuide__body"},[i("img",{staticClass:"minicode-qrScanGuide__img",attrs:{src:e.QN+"/kdocs/cloud/static/wx_qr_scan_guide.gif"}})])]):e._e()])]),e._v(" "),i("div",{staticClass:"minicode-desc",attrs:{tabindex:"0"}},[e._v(e._s(e.description))]),e._v(" "),e.copyText?i("div",{staticClass:"mini-copylink"},[i("span",[e._v(e._s(e.copyTipsTxt))]),e._v(" "),i("kd-button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:e.copyText,expression:"copyText"}],attrs:{type:"light",highlight:"",size:"small"},on:{success:e.onSuccessMessage}},[e._v(e._s(e.copyHandleTxt))])],1):e._e(),e._v(" "),e.url?i("div",{staticStyle:{display:"none"}},[i("vue-qr",e._b({},"vue-qr",e.qrcodeConfig,!1))],1):e._e()])},staticRenderFns:[],name:"KMiniCode",components:(0,o.Z)((0,o.Z)((0,o.Z)((0,o.Z)({VueQr:r(),ArrowUp:f.Z,ArrowDown:m.Z,KIcon:g.default},_().name,_()),y().name,y()),b().name,b()),D().name,D()),directives:{clipboard:k.B},props:{sid:{required:!1,type:String},fid:{required:!1,type:String||Number},newShare:{required:!1,type:Boolean,default:!1},file:{required:!1,type:Object},type:{required:!1,type:String,default:"wechat"},onDwEvent:{type:Function,default:function(){}},url:{type:String,default:""},pcShare:{type:Boolean,default:!1},logo:{required:!1,type:String,default:"kdocs"},isDisableHover:{type:Boolean,default:!1},permission:{type:String,default:""},dwType:{type:String,default:""},isShareV2:{type:Boolean,default:!1},isShareV3:{type:Boolean,required:!1,default:!1},hasSharePerm:{type:Boolean,default:!1},isDark:{type:Boolean,default:!1},copyText:String,customDesc:String},data:function(){return{miniCode:"",loading:!0,qrcodeConfig:{text:this.url,correctLevel:2,logoSrc:B[this.logo],size:432,margin:0,logoScale:.25,logoCornerRadius:16,callback:this.renderQrcode},isShowGuide:!1,description:"",scanGuide:(0,h.t)("logic.QrCode.scanGuide"),shareTips:(0,h.t)("logic.MiniCode.shareTips"),copyHandleTxt:(0,h.t)("logic.MiniCode.copyHandleTxt"),copyTipsTxt:(0,h.t)("logic.MiniCode.copyTipsTxt"),secretPerm:"",showPermDropDown:!1,QN:(0,u.getCDN)()}},beforeMount:function(){var e=encodeURIComponent(this.sid+"_file");this.url||(this.permission&&(e+="__secret".concat(this.permission)),this.miniCode="".concat(s.yV,"/api/v3/miniprogram/code/jpg?scene=").concat(e,"&page_path=pages/miniCodeShare/miniCodeShare"))},mounted:function(){var e,t={type:"mini_programs_core"};this.isShareV2&&(t.action="show"),this.pcShare?this.$emit("onDwEvent","share_file_newsetting",t):this.dwType&&(null===(e=this.onDwEvent)||void 0===e||e.call(this,this.dwType,t));var i=(0,h.t)("logic.QrCode.wechatScan");"wework"===this.type&&(i=(0,h.t)("logic.QrCode.wxqyScan")),this.description=this.customDesc||i,this.secretPerm=this.permission&&this.permission.slice(0,1)},computed:{isPC:function(){var e;return null===(e=this.$root)||void 0===e?void 0:e.isPC},isCloud:function(){var e;return null===(e=this.$root)||void 0===e?void 0:e.isCloud},fileIcon:function(){var e=(0,u.getFileIcon)(this.file.fname,this.file.ftype||"file").replace(/-/g,""),t=E[e]||"unknown";return"ofd"===t&&(t="v2/"+t),"".concat((0,u.getCDN)(),"/kdocs/kd-pic-resource/format/v1/icons/svg/").concat(t,"-24.svg")|ile.fname)},showComment:function(){return!this.pcShare&&(0,v.Ps)(this.file.fname)},PERM_LIST:function(){var e={r:(0,h.t)("logic.MiniCode.read")};return this.showComment&&(e.c=(0,h.t)("logic.MiniCode.comment")),this.canCoop&&(e.w=(0,h.t)("logic.MiniCode.write")),e}},methods:{onSuccessMessage:function(){var e;P().success((0,h.t)("logic.MiniCode.copySuccessText")),null===(e=this.onDwEvent)||void 0===e||e.call(this,"share_v3_settings",{type:"mini_programs_core",action:"click",operation:"click_copylink"})},permViopDown=!!e},rminiCode=e},reRenderQrcode:function(e){var t=encodeURIComponent(this.sid+"_file");this.permission&&(t+="__secret".concat(e)),this.miniCode="".concat(s.yV,"/api/v3/miniprogram/code/jpg?scene=").concat(t,"&page_path=pages/miniCodeShare/miniCodeShare")},onMouseover:function(){var e,t,i=(0,u.getUA)(navigator.userAgent);i&&i.isiPad||this.pcShare||this.isDisableHover||(this.isShowGuide=!0,this.isShareV2?this.onDwEvent&&(null===(t=this.onDwEvent)||void 0===t||t.call(this,this.dwType,{action:"click",operation:"mouse_hover",type:"mini_programs_core",filetype:(0,p.Li)(this.file.fname)})):this.onDwEvent&&(null===(e=this.onDwEvent)||void 0===e||e.call(this,this.dwType||"share_file_settings",{action:"mouse_hover",type:"mini_programs_core",filetype:(0,p.Li)(this.file.fname)})))}owGuide=!1},onContextmenu:function(e){var t,i;(this.pcShare?e.preventDefault():e.stopPropagation(),this.isShareV2)?this.onDwEvent&&(null===(i=this.onDwEvent)||void 0===i||i.call(this,this.dwType||"share_file_settings",{action:"click",operation:"mouse_rightclick",type:"mini_programs_core"})):this.onDwEvent&&(null===(t=this.onDwEvent)||void 0===t||t.call(this,this.dwType||"share_file_settings",{action:"mouse_rightclick",type:"mini_programs_core"}))},handlePerm:function(e){if(this.isShareV2){var t="click_";switch(e){case"r":t+="read";break;case"w":t+="write";break;case"c":t+="comment"}var i={action:"click",operation:t};this.pcShare?this.$emit("onDwEvent","share_file_)}return e}({type:"mini_programs_core"},i)):this.onDwEvent("share_file_newsetting",i)}this.secretPerm=e,this.reRenderQrcode(e)}},filters:{formatFileName:function(e){var t=/(.+)\.([^.]+)$/.exec(e)||[],i=(0,n.Z)(t,3),o=i[1],s=i[2];return l.UI.includes(s)?o:e}},install:function(e){e.component(Q.name,Q)}};t.Z=Q},48617:function(e,t,){return b}});var n=i(37311),o=i(56451),s=i(2406),a=i.n(s),r=i(95272),c=i(62414),d=i(84588),l=i.n(d),h=i(82551),u=i(5330),p=i.p+"s1/static/images/9b91bbcdd140a640d89b.svg",f=i(45821),m=i(26743),g=i(19963),v=i(50792),w=i(85476),_=new(i(7018).PlugCtr)("kso"),C={kdocs:h,square:u,corpus:p},y={ppt:"wpp",pom:"flow-chart",dbt:"dbs",ofd:"ofd",ckt:"poster",img:"pic",doc_wps:"wps",xls_wps:"et",txt:"txt",pdf:"pdf",pof:"mind-mapping",otl:"air-page",kw:"whiteboard",ksheet:"air-sheet",audio:"audio",doc:"wps",h5:"link",xls:"et",note:"sticky-note",form:"form",zip:"compressed-package",video:"video",resh:"job",cad2d:"cad",cad3d:"3dmodel",unknown:"unknown-file",sharefolder2:"folder-shared",folder:"folder"},S={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:["k-QrCode",{"is-pc-office":e.isPC},{"is-web-cloud":e.isCloud},{"k-QrCode--pcShare":e.pcShare&&!e.isShareV2}]},[e.loading?i("div",{staticClass:"k-shareFile-loading"},[i("KLoading")],1):e._e(),e._v(" "),e.ecisQrcode()?i(e.ecisQrcode(),{tag:"component"}):[e.pcShare&&!e.isShareV2?i("div",{staticClass:"qrcode-title"},[e._v(e._s(e.formatFileName))]):e._e(),e._v(" "),i("div",{class:"qrcode "+(e.pcShare?"pcshare":"")+" "+("qq"===e.type||"dingtalk"===e.type?"mini-qrcode":""),on:{Nothing(t)}}},[e.imgQrcode?i("img",{attrs:{src:e.imgQrcode}}):e._e()]),e._v(" "),"dingtalk"===e.type?i("div",{staticClass:"qq-tips"},[e._v(e._s(e.t("logic.QrCode.dingtalkScan")))]):"qq"===e.type?i("div",{staticClass:"qq-tips"},[e._v(e._s(e.t("logic.QrCode.qqScan")))]):[e.pcShare?i("div",{staticClass:"qrcode-desc"},[e._v(e._s(e.t("logic.QrCode.scan")))]):e._e(),e._v(" "),e.pcShare||e.isEntOnlineDialog?e._e():i("div",{staticClass:"qrcode-footer",attrs:{tabindex:"0"}},[1===e.blockDownloadBtn?i("div",[e._v(e._s(e.saveText))]):2===e.blockDownloadBtn?i("div",[e._v(e._s(e.upgradeText))]):3===e.blockDownloadBtn&&e.useNewLayout?i("KButton",{attrs:{useNewLayout:!0,type:"primary"},on:{click:e.downloadQrCode}},[e._v(e._s(e.btnText))]):3===e.blockDownloadBtn?i("button",{staticClass:"btn-download k-button",on:{click:e.downloadQrCode}},[e._v(e._s(e.btnText))]):4===e.blockDownloadBtn?i("div",[e._v(e._s(e.rightClickSaveText))]):e._e()],1),e._v(" "),e.pcShare||e.isEntOnlineDialog?e._e():i("div",{staticClass:"qrcode-tips",attrs:{tabindex:"0"}},[e._v(e._s(e.t("logic.QrCode.saveQrCode")))])]],e._v(" "),i("div",{staticStyle:{display:"none"}},[i("vue-qr",e._b({},"vue-qr",e.qrcodeConfig,!1))],1)],2)},staticRenderFns:[],name:"KQrCode",components:{KLoading:r.Z,VueQr:l(),KButton:c.Z},props:{file:{required:!0,type:Object},type:{required:!1,type:String,default:"qrcode"},logo:{required:!1,type:String,default:"kdocs"},onDwEvent:{type:Function,default:function(){}},linkSuffix:{type:String,default:""},url:{type:String,default:""},pcShare:{type:Boolean,default:!1},isEntOnlineDialog:{type:Boolean,default:!1},isShareV2:{type:Boolean,default:!1},dwType:{type:String,default:""},useNewLayout:{type:Boolean,default:!1},isDark:{type:Boolean,default:!1}},data:function(){return{qrcodeConfig:{backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--kd-color-text-white"),text:this.getQrcodeText(),correctLevel:2,logoSrc:C[this.logo],size:432,margin:0,logoScale:.25,logoCornerRadius:16,callback:this.renderQrcode},dataUrl:"",imgQrcode:"",loading:!0,btnText:(0,f.t)("logic.QrCode.txt0"),saveText:(0,f.t)("logic.QrCode.txt2"),upgradeText:(0,f.t)("logic.QrCode.txt3"),rightClickSaveText:(0,f.t)("logic.QrCode.rightClickSave"),qrcodeTips:(0,f.t)("logic.QrCode.qrCodeTips"),ua:{},isallowsLinkPreviewAPI:!1,t:f.t,canvasObj:null}},computed:{isPC:function(){var e;return null===(e=this.$root)||void 0===e?void 0:e.is:e.isCloud},fileType:function(){var e;return(0,m.getFileIcon)(this.file.fname,this.file.ftype||(null===(e=this.file)||void 0===e||null===(e=e.fileInfo)||void 0===e?void 0:e.ftype)||"file")}e(/-/g,"")},blockDownloadBtn:function(){var e=this.ua;return e.isTabletClient&&this.isallowsLinkPreviewAPI||e.isWechat&&e.isTablet?1:e.isTabletClient&&!this.isallowsLinkPreviewAPI?2:e.isWechat&&e.isMac?4:e.moffice?0:3},formatFileName:function(){var e=this.file.fname,t=/(.+)\.([^.]+)$/.exec(e)||[],i=(0,o.Z)(t,3),n=i[1],s=i[2];return v.UI.includes(s)?n:e}},mounted:function(){var e=this;return(0,n.Z)(a().mark((function t(){var i,n,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i={type:"qrcore",filetype:(0,w.Li)(e.file.fname)},e.isShareV2&&(i.action="show"),e.pcShare?e.$emit("onDwEvent",e.dwType||"share_file_newsetting",i):null===(n=e.onDwEvent)||void 0===n||n.call(e,e.dwType||"share_file_settings",i),e.ua=(0,m.getUA)(navigator.userAgent),!e.ua.mdocs){t.next=10;break}return t.next=7,(0,g.X9)();case 7:o=t.sent,e.isallowsLinkPreviewAPI=o.includes("allowsLinkPreview"),1===e.blockDownloadBtn&&e.isallowsLinkPreviewAPI&&(0,g.dD)({allow:!0});case 10:case"end":return t.stop()}}),t)})))()},destroyed:function(){1===this.blockDownloadBtn&&this.isallowsLinkPreviewAPI&&(0,g.dD)({allow:!1})},methods:{isWWW:function(e){return e.split(".").length>2?e:e.replace("//","//www.")},getQrcodeText:function(){var e=this.url||(this.file.clink_url||this.file.link_url||this.file.fileInfo.link_url)+this.linkSuffix;return this.isWWW(e)},ecisQrcode:function(){return _.ask("ShareFileQRcodeModal.QRcode.render",{fileInfo:this.file},null)unction(){},getPixelRatio:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},renderQrcode:function(e){if(this.dataUrl=e,this.pcShare&&!this.isShareV2)return this.imgQrcode=e,void(this.loading=!1);this.renderImg(!1,e)},getTextWidth:function(e,t){var i=(this.canvasObj||(this.canvasObj=document.createElement("canvas"))).getContext("2d");return i.font=t,i.measureText(e).width},getTwoRowFnameIndex:function(e){var t,i,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,s=arguments.length>2?arguments[2]:void 0;if(e.length<=10)return{firstIndex:e.length-1,secondIndex:null,showEllipsis:!1};for(var a=10;a<e.length&&((n=this.getTextWidth(e.slice(0,a),s))<o&&(t=a),n<2*o&&(i=a),!(n>2*o));a++);return{firstIndex:t,secondIndex:i,showEllipsis:i<e.length-1}},renderImg:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),n=this.getPixelRatio(i),o=e?140:24,s=e?2.53125:1,a=e?963/430:1,r=e?140:24,c=256*s,d=344*a,l=c/2+12+5;t.width=c*n,t.height=d*n,t.style.width=c+"px",t.style.height=d+"px";var h=164*a,u=10,p=getComputedStyle(this.$el).getPropertyValue("--kd-color-background-middle");i.fillStyle=p,i.fillRect(0,0,t.width,t.height),i.scale(n,n),i.textBaseline="top";var g=14*(e?2:1)+"px Helvetica,BlinkMacSystemFont,Neue,PingFangSC-Regular,PingFang SC";i.font=g,i.fillStyle=getComputedStyle(this.$el).getPropertyValue("--kd-color-text-primary")||"rgba(13,13,13,0.9)";var v=this.formatFileName,w=this.getTwoRowFnameIndex(v,e?300:150,g),_=w.firstIndex,C=w.secondIndex,S=w.showEllipsis;if(i.textAlign="center",C&&_!==C){var b=v.slice(0,_+1);i.fillText(b,l,(e?33:6)*a);var k=v.slice(_+1,C+1)+(S?"...":"");i.fillText(k,l,(e?53:26)*a),r=l-i.measureText(b).width/2-24*a-10}else{var x;i.fillText(v,l,(e?40:13)*a),r=l-(null===(x=i.measureText(v))||void 0===x?void 0:x.width)/2-24*a-10}"qq"!==this.type&&"dingtalk"!==this.type&&(i.font=14*(e?1.8:1)+"px PingFangSC-Regular,PingFang SC",i.textAlign="center",i.fillStyle=getComputedStyle(this.$el).getPropertyValue("--kd-color-text-secondary"),i.fillText((0,f.t)("logic.QrCode.scan"),128*s,((e?290:260)+u)*a));var P=y[this.formatType]||"unknown",T=new Image;T.setAttribute("crossOrigin","anonymous");var D=this;T.onload=function(){i.drawImage(T,r,(e?35:8)*a,24*a,24*a);var s=new Image;s.onload=function(){if(e){i.drawImage(s,o,96*a,164*a,164*a);var r=document.createElement("a"),c=document.createEvent("MouseEvents");c.initEvent("click",!1,!1),r.download=D.formatFileName+".png",r.href=t.toDataURL("image/png"),r.dispatchEvent(c)}else{var d=document.createElement("canvas"),l=d.getContext("2d"),f=h+20,m=h+20;d.width=f*n,d.height=m*n,l.scale(n,n),l.fillStyle=p,l.fillRect(0,0,f,m),l.drawImage(s,9,9,h+2,h+2),l.strokeStyle="white",l.lineWidth=u,l.lineJoin="round",l.strokeRect(5,5,h+u,h+u),i.drawImage(d,36,68,f,m),D.loading=!1,D.imgQrcode=t.toDataURL("image/jpg")}},s.src=D.dataUrl},"ofd"===P&&(P="v2/"+P),T.src="".concat((0,m.getCDN)(),"/kdocs/kd-pic-resource/format/v1/icons/svg/").concat(P,"-24.svg")},downloadQrCode:function(){var e;this.pcShare?this.$emit("onDwEvent","share_file_newsetting",{type:"qrcore",action:"click",operation:"download_click",filetype:(0,w.tL)(this.file.fname)}):null===(e=this.onDwEvent)||void 0===e||e.call(this,this.dwType||"share_file_settings",{type:"qrcore",action:this.isShareV2?"click":"download_click",operation:"download_click",filetype:(0,w.Li)(this.file.fname)});this.renderImg(!0(S.name,S)}},b=S},82551:function(e,t,i){e.exports=i.p+"s1/static/images/4cc6dbb0a58a6a6550e51e91c.svg"}}]);
