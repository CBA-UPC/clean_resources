import{bs as G,ay as fe,G as ze,aA as I,d5 as pe,bd as q,az as Le,aB as W,as as A,d8 as Fe,aT as He,aD as P,a1 as _e,at as je,b4 as qe,aC as Oe,cW as Ge,au as We,d9 as Ye,b7 as Je,bv as oe,l as ne,K as ie,h as ce,j as re,i as de,cB as Ke,cb as Qe,b0 as Xe,aE as Ze,bm as et,bl as tt,aa as at,aM as st,bR as lt}from"./itinerary-entities.5f897bcd.js";import{l as N,r as y,c as f,q as Y,s as ot,G as c,H as k,I as r,Y as a,x as n,a7 as C,z as e,P as S,F as E,$ as U,a as he,R as O,a6 as B,an as J,ao as K,Q as D,aX as nt,a3 as it,S as ct,n as H,w as ue}from"./graphql.5cf3693b.js";import{F as ge}from"./FreezeCard.4449bf65.js";import{b as be,M as me}from"./entry.a7cea746.js";import{bO as j,ak as T}from"./service-client.4862e840.js";import{E as rt}from"./EmptyState.a6e8cd62.js";import{P as ve}from"./PanelContainer.e2d81510.js";import{_ as dt}from"./MrInfiniteScroll.vue.044c5ead.js";import{T as ut}from"./TabBar.b3960988.js";import"./itinerary-modules.2ea32123.js";import"./SegmentView.f9955577.js";import"./RouteView.94d5f105.js";const mt={class:"cancel-root"},vt={class:"checkbox-container"},ft={class:"actions"},pt=N({__name:"CancelModal",props:{reserveId:{}},emits:["close"],setup(t,{emit:d}){const l=G(),{cancellationReasons:u}=fe(l),o=ze(),g=y(""),R=y(!1),p=y(!1),x=y({}),b=f(()=>Object.entries(x.value).filter(([,h])=>h).length===0);async function i(){R.value=!0,p.value=!0;try{await l.cancelDemand({automaticReserveDemandId:t.reserveId,cancellationRequest:{description:g.value,reasons:Object.entries(x.value).filter(([,h])=>h).map(([h])=>+h)}}),p.value=!1,d("close",{message:"",success:!0})}catch(h){p.value=!1,d("close",{success:!1,message:h.message})}}return Y(()=>{o.trackPosthog("open-auto-reserve-cancel-modal")}),ot(()=>{R.value?o.trackPosthog("auto-reserve-canceled"):o.trackPosthog("cancel-canceling-auto-reserve")}),(h,_)=>(c(),k(W,{title:"حذف رزرو خودکار","mobile-page":"",width:"500px",onClose:_[2]||(_[2]=m=>d("close",{canceled:!0}))},{footer:r(()=>[a("div",ft,[n(I,{"full-width":"",type:"bordered",onClick:_[1]||(_[1]=m=>d("close",{canceled:!0}))},{default:r(()=>[C(" انصراف ")]),_:1}),n(I,{disabled:e(b),"full-width":"",loading:e(p),onClick:i},{default:r(()=>[C(" تأیید و لغو ")]),_:1},8,["disabled","loading"])])]),default:r(()=>[a("div",mt,[n(pe,{size:"free",label:"دلیل حذف رزرو خودکار را انتخاب کنید.",ghost:""},{default:r(()=>[a("div",vt,[(c(!0),S(E,null,U(e(u),m=>(c(),k(q,{key:m.id,modelValue:e(x)[m.id||0],"onUpdate:modelValue":w=>e(x)[m.id||0]=w,label:m.title||""},null,8,["modelValue","onUpdate:modelValue","label"]))),128))])]),_:1}),n(Le,{modelValue:e(g),"onUpdate:modelValue":_[0]||(_[0]=m=>he(g)?g.value=m:null),"text-area":"","full-width":"",label:"لطفاً در صورت تمایل سایر دلایل خود را ذکر کنید:"},null,8,["modelValue"])])]),_:1}))}});const _t=A(pt,[["__scopeId","data-v-dab2aa13"]]),ht=t=>(J("data-v-e7e236c6"),t=t(),K(),t),gt={class:"auto-reserve-pax-root"},bt={class:"header"},yt=ht(()=>a("span",{class:"title"},"لیست مسافران",-1)),kt={class:"pax-container"},xt={class:"pax-name"},Rt=N({__name:"AutoReservePaxDetails",props:{editEnabled:{type:Boolean},pax:{default:()=>[]}},emits:["editPax"],setup(t,{emit:d}){return(l,u)=>(c(),S("div",gt,[a("div",bt,[yt,n(I,{class:O({hidden:!l.editEnabled}),size:"medium",type:"transparent","right-icon":e(Fe),onClick:u[0]||(u[0]=o=>d("editPax"))},{default:r(()=>[C(" ویرایش مسافران ")]),_:1},8,["class","right-icon"])]),a("div",kt,[(c(!0),S(E,null,U(l.pax,o=>(c(),S("div",{key:o.id,class:"passenger"},[n(P,{icon:e(He)},null,8,["icon"]),a("span",xt,B(o.persianFirstName||o.firstName)+" "+B(o.persianLastName||o.lastName),1)]))),128))])]))}});const ye=A(Rt,[["__scopeId","data-v-e7e236c6"]]),$t={class:"bottom-sheet-content"},It=N({__name:"AutoReserveItemsBottomSheet",props:{item:{},pax:{}},emits:["close","editPax"],setup(t,{emit:d}){const l=f(()=>`${t.item.origin||""}-${t.item.destination||""}`);return(u,o)=>(c(),k(W,{title:e(l),onClose:o[2]||(o[2]=g=>d("close"))},{footer:r(()=>[n(I,{"full-width":"",onClick:o[1]||(o[1]=g=>d("close"))},{default:r(()=>[C("متوجه شدم")]),_:1})]),default:r(()=>[a("div",$t,[n(ye,{pax:u.pax,"edit-enabled":u.item.status===1,onEditPax:o[0]||(o[0]=g=>d("editPax"))},null,8,["pax","edit-enabled"]),(c(!0),S(E,null,U(u.item.packages,(g,R)=>{var p;return c(),k(ge,{key:g.key,package:g,"is-auto-reserve":"","in-panel":"","model-value":!!((p=u.item.items)!=null&&p[R].isReserved),selectable:!1},null,8,["package","model-value"])}),128))])]),_:1},8,["title"]))}});const Ct=A(It,[["__scopeId","data-v-c38b6d17"]]),wt={class:"cancel-content"},Bt={class:"checkbox-container"},St={class:"actions"},Tt=N({__name:"RemoveItem",props:{items:{default:()=>[]},loading:{type:Boolean},hasSelectAll:{type:Boolean},label:{default:""},description:{default:""},itemsTitle:{default:""},allTitle:{default:""},selectAllInitially:{type:Boolean}},emits:["removeAll","remove","close"],setup(t,{emit:d}){const l=y([]),u=f(()=>t.items.length===l.value.length),o=f(()=>!u.value&&!!t.items.length),g=f(()=>l.value.length===0);function R(i){l.value.includes(i)?l.value=l.value.filter(h=>h!==i):l.value=[...l.value,i]}function p(){u.value?l.value=[]:l.value=t.items.map(i=>i.value)}function x(){u.value?d("removeAll"):d("remove",l.value)}function b(){d("close"),l.value=[]}return Y(()=>{t.selectAllInitially&&p()}),(i,h)=>(c(),k(W,{width:"fit-content",title:i.label,onClose:b},{footer:r(()=>[a("div",St,[n(I,{type:"bordered","full-width":"",onClick:b},{default:r(()=>[C(" بستن ")]),_:1}),n(I,{type:"filled",disabled:e(g),"full-width":"",loading:i.loading,onClick:x},{default:r(()=>[C(" حذف "+B(e(u)?i.allTitle:i.itemsTitle),1)]),_:1},8,["disabled","loading"])])]),default:r(()=>[a("div",wt,[n(pe,{size:"free","full-width":"",label:i.description,ghost:""},{default:r(()=>[a("div",Bt,[i.hasSelectAll?(c(),k(q,{key:0,"model-value":e(u),label:"انتخاب همه",intermediate:e(o),"onUpdate:modelValue":p},null,8,["model-value","intermediate"])):D("",!0),(c(!0),S(E,null,U(i.items,_=>(c(),k(q,{key:_.value,"model-value":e(l).includes(_.value||0),label:_.label,"onUpdate:modelValue":m=>R(_.value||0)},null,8,["model-value","label","onUpdate:modelValue"]))),128))])]),_:1},8,["label"])])]),_:1},8,["title"]))}});const Mt=A(Tt,[["__scopeId","data-v-4327fc6d"]]),V=t=>(J("data-v-a124295d"),t=t(),K(),t),At={class:"auto-reserve-card-root"},Nt=V(()=>a("div",{class:"label"},[a("span",null,"رزرو خودکار")],-1)),Pt={class:"ticket-section"},Dt={class:"segment"},Et={class:"corporation-frame"},Ut={class:"corporation-container"},Vt={class:"span"},zt={class:"route"},Lt={class:"from"},Ft={class:"location"},Ht={class:"router"},jt=V(()=>a("span",{class:"line"},null,-1)),qt=V(()=>a("span",{class:"line"},null,-1)),Ot={class:"to"},Gt={class:"location"},Wt={class:"day"},Yt={class:"date"},Jt={class:"reserve-section"},Kt=V(()=>a("div",{class:"spacer"},null,-1)),Qt={key:1,class:"message"},Xt={class:"text"},Zt={class:"wrapper"},ea=N({__name:"AutoReserveCard",props:{item:{},loading:{type:Boolean}},emits:["refresh"],setup(t,{emit:d}){nt(s=>{var v;return{f8559e38:(v=e(M))==null?void 0:v.color}});const l=_e(),u=G(),{day:o}=ne(),g=it(),R=je(),{isMobileSize:p,isGreaterOrEqual:x}=qe(),b=y(!1),i=y([]),h=y(0),_=y(!1),m=y(!1),w=y(null),{open:ke,close:xe}=Oe({component:_t,attrs:{reserveId:t.item.id||0}}),{open:Re}=Ge({component:Ct}),{open:Q,close:z}=We({component:Mt,attrs:{onRemoveAll:()=>ae()}}),M=f(()=>{switch(t.item.billStatus){case j.NUMBER_0:return{icon:oe,pulse:!0,text:`این ${ee.value} دارای ظرفیت شده و در فرایند صدور قرار گرفت.`,color:"var(--yellow-500)"};case j.NUMBER_1:return{icon:Je,text:"خرید ناموفق",color:"var(--red-500)"};case j.NUMBER_2:return{icon:Ye,text:"بلیط برای شما صادر شد.",color:"var(--green-500)"};default:return null}});function X(){Q({items:Ie.value,label:"ویرایش مسافران",allTitle:"َرزرو",description:"مسافرانی که قصد حذف رزرو آنان را دارید، انتخاب کنید.",itemsTitle:"مسافران",loading:m.value,onRemove:Ae})}function $e(){Z.value.length?Q({items:Z.value,label:"حذف رزرو",allTitle:"رزرو",description:"پروازهایی که قصد دارید از رزرو حذف کنید، انتخاب کنید.",itemsTitle:"پروازها",hasSelectAll:!0,selectAllInitially:!0,loading:m.value,onRemove:Ne}):ae()}const Ie=f(()=>i.value.map(s=>({label:`${s.persianFirstName||s.firstName} ${s.persianLastName||s.lastName}`,value:s.id||0}))),Z=f(()=>{var v;const s=ne().day.js;return((v=t.item.items)==null?void 0:v.map($=>({label:`${$.providerName} ${$.serviceNumber} - (${s($.departureTime).format(ie({format:"long",includeYear:!0}))})`,value:$.id||0})))||[]}),Ce=f(()=>{if(!b.value)return"0";const{length:s}=t.item.packages;return`${(s-1)*88+140+(s-1)*16+20+20+h.value}px`}),ee=f(()=>{switch(t.item.reserveType){case T.NUMBER_0:return"پرواز";case T.NUMBER_1:return"قطار";case T.NUMBER_2:return"اتوبوس";default:return"پرواز"}}),we=f(()=>{switch(t.item.reserveType){case T.NUMBER_0:return ce;case T.NUMBER_1:return de;case T.NUMBER_2:return re;default:return ce}}),L=f(()=>{switch(t.item.reserveType){case T.NUMBER_0:return{icon:Ke,rotate:"180"};case T.NUMBER_1:return{icon:de};case T.NUMBER_2:return{icon:re};default:return}}),Be=f(()=>t.item.departureDate?o.js(t.item.departureDate).format(ie({format:"long",includeYear:!0,includeWeekday:!0})):""),te=f(()=>t.item.status!==3),Se=f(()=>{switch(t.item.status){case 0:return"لغو شده";case 1:return"در حال رهگیری";case 3:return"مشاهده رزرو";default:return""}}),Te=f(()=>{if(!te.value)return Qe}),Me=f(()=>{if(t.item.status===1)return{icon:oe,pulse:!0}});async function F(s=!1){i.value.length&&!s||(_.value=!0,s&&(b.value=!b.value),i.value=await u.getPassengers(t.item.id||0),_.value=!1)}async function Ae(s){m.value=!0,await u.removePassengers({requestBody:s,id:t.item.id||0}),m.value=!1,z(),await F(!0),p.value||H(()=>{var v;h.value=((v=w.value)==null?void 0:v.clientHeight)||0})}async function Ne(s){try{m.value=!0,await u.cancelDemand({automaticReserveDemandId:t.item.id||0,cancellationRequest:{itemIds:s}}),m.value=!1,z()}catch{}}async function Pe(){await F(),H(()=>{var s;h.value=((s=w.value)==null?void 0:s.clientHeight)||0}),b.value=!b.value}async function De(){await F(),Re({item:t.item,pax:i.value,onEditPax:X})}async function ae(){await z(),H(()=>{setTimeout(()=>{ke({reserveId:t.item.id||0}).then(s=>{var v;return Ee((v=s.args)==null?void 0:v[0])})},200)})}const Ee=async({success:s,canceled:v,message:$})=>{await xe(),setTimeout(()=>{s?(R({icon:"success",text:"رزرو با موفقیت لغو شد.",confirmButtonText:"باشه"}),d("refresh")):!v&&$&&R({icon:"error",text:$,confirmButtonText:"باشه"})},200)},Ue=()=>{var v;const s=(v=l.userInfo)==null?void 0:v.mobile;g.push(`/support/tracking?billCode=${t.item.billCode}&mobile=${s}`)};return(s,v)=>(c(),S("div",At,[a("div",{class:O(["tracking-card-root",{"loading-skeleton":s.loading,expanded:e(b)}]),onClick:v[0]||(v[0]=$=>e(x)("laptop"))},[Nt,a("div",Pt,[a("div",Dt,[a("div",Et,[a("div",Ut,[n(P,{icon:e(we),size:"large",color:"var(--blue-400)"},null,8,["icon"])]),a("span",Vt,"مسیر "+B(e(ee)),1)]),a("div",zt,[a("div",Lt,[a("span",Ft,B(s.item.origin||""),1)]),a("div",Ht,[jt,e(L)?(c(),k(P,{key:0,size:"small",icon:e(L).icon,rotation:e(L).rotate,color:"var(--cool-gray-400)"},null,8,["icon","rotation"])):D("",!0),qt]),a("div",Ot,[a("span",Gt,B(s.item.destination||""),1)])])]),a("div",Wt,[n(I,{type:"transparent",class:"expand-button-desktop","left-icon":e(b)?e(Xe):e(Ze),loading:e(_),onClick:Pe},{default:r(()=>[C(" جزئیات و ویرایش مسافران ")]),_:1},8,["left-icon","loading"]),n(I,{type:"transparent",size:"small",class:"expand-button-mobile","left-icon":e(et),loading:e(_),onClick:De},{default:r(()=>[C(" جزئیات و ویرایش مسافران ")]),_:1},8,["left-icon","loading"]),a("span",Yt,B(e(Be)),1)])]),n(be,{class:"divider",color:"var(--blue-100)",thickness:"1px",margin:"0"}),a("div",Jt,[s.item.status===1?(c(),k(I,{key:0,type:"transparent","right-icon":e(tt),size:"medium",class:"cancel",onClick:$e},{default:r(()=>[C(" حذف رزرو ")]),_:1},8,["right-icon"])):D("",!0),Kt,e(M)?(c(),S("div",Qt,[n(P,{icon:e(M).icon,color:e(M).color,pulse:e(M).pulse},null,8,["icon","color","pulse"]),a("span",Xt,B(e(M).text),1)])):D("",!0),n(I,{size:"medium",disabled:e(te),type:s.item.status===1&&e(p)?"transparent":"filled","full-width":"",class:O(["button",{half:s.item.status===1}]),"left-icon":e(Te),"right-icon":e(Me),onClick:Ue},{default:r(()=>[C(B(e(Se)),1)]),_:1},8,["disabled","type","class","left-icon","right-icon"])])],2),a("div",{class:"children-wrapper",style:ct({maxHeight:e(Ce)})},[a("div",Zt,[a("div",{ref_key:"details",ref:w},[n(ye,{pax:e(i),"edit-enabled":s.item.status===1,onEditPax:X},null,8,["pax","edit-enabled"])],512),(c(!0),S(E,null,U(s.item.packages,($,Ve)=>{var se,le;return c(),k(ge,{key:$.key,package:$,"model-value":!!((le=(se=s.item.items)==null?void 0:se[Ve])!=null&&le.isReserved),"is-auto-reserve":"","in-panel":""},null,8,["package","model-value"])}),128))])],4)]))}});const ta=A(ea,[["__scopeId","data-v-a124295d"]]),aa=t=>(J("data-v-085d2c00"),t=t(),K(),t),sa={class:"root-container"},la={class:"credit-container"},oa={class:"credit-value-container"},na={class:"credit-icon-container"},ia={class:"credit-value"},ca=aa(()=>a("span",{class:"credit-title"},"اعتبار کاربری",-1)),ra={class:"credit"},da={class:"messages-container"},ua=N({__name:"auto-reserve",setup(t){const d=y(1),l=y(0),u=f(()=>!p.value&&o.demands.length<o.demandsCount),o=G(),g=_e(),{credit:R}=fe(g),p=y(!1),x=y(!1),b=f(()=>p.value?[{packages:[]},{packages:[]},{packages:[]}]:o.autoReserveNormalizedDemands),i=f(()=>at(R.value));async function h(){o.demands=[],p.value=!0,d.value=1,await o.getAutoReserveDemands(d.value,l.value===0),p.value=!1}return Y(()=>{g.loadCredit(!0),h(),o.getCancellationReasons()}),ue(d,async _=>{x.value=!0,await o.getAutoReserveDemands(_,l.value===0),x.value=!1}),ue(l,()=>h()),(_,m)=>(c(),S("div",sa,[n(ve,{title:"مدیریت رزرو خودکار",class:"panel-container","retain-box-in-mobile":""},{default:r(()=>[a("div",la,[a("div",oa,[a("div",na,[n(P,{icon:e(st),size:"x-large",color:"var(--blue-400)"},null,8,["icon"])]),a("div",ia,[ca,a("span",ra,B(e(i)),1)])]),n(be,{class:"divider",thickness:"1px",vertical:"",margin:"0"}),n(I,{type:"filled",href:"/panel/credit",link:"nuxt",class:"credit-button"},{default:r(()=>[C(" افزایش و استرداد اعتبار ")]),_:1})]),a("div",da,[n(me,{items:[{message:"رزرو خودکار مختص سفرهایی با ظرفیت تکمیل شده است، در صورت نبود کنسلی، رزرو خودکار شما با موفقیت انجام نخواهد شد."},{message:"تا ۳ ساعت پیش از حرکت سفرهای انتخابی، رهگیری رزرو خودکار ادامه خواهد داشت و امکان رزرو موفق وجود خواهد داشت."},{message:"اعتبار موجود در حساب کاربری شما همواره قابل استفاده و قابل استرداد خواهد بود، اما در صورتی که رزرو خودکار فعالی داشته باشید و اعتبار لازم در حساب شما موجود نباشد، رزرو خودکار شما ناموفق خواهد شد."}]},null,8,["items"]),n(me,{items:[{message:"به منظور انصراف از رزرو خودکار، گزینه حذف رزرو را روی کارت پرواز مورد نظر را انتخاب کنید."}],type:"warning"},null,8,["items"])])]),_:1}),n(ve,{"disable-title-portal":"","retain-box-in-mobile":""},{default:r(()=>[n(ut,{modelValue:e(l),"onUpdate:modelValue":m[0]||(m[0]=w=>he(l)?l.value=w:null),tabs:[{title:"جاری"},{title:"گذشته"}]},null,8,["modelValue"]),e(b).length?(c(),k(dt,{key:0,class:"list-container",items:e(b),"has-next":e(u),onLoad:m[1]||(m[1]=w=>d.value++)},{item:r(({item:w})=>[n(ta,{item:w,loading:e(p)},null,8,["item","loading"])]),_:1},8,["items","has-next"])):(c(),k(rt,{key:1,mode:"autoReserve"})),e(x)?(c(),k(lt,{key:2})):D("",!0)]),_:1})]))}});const $a=A(ua,[["__scopeId","data-v-085d2c00"]]);export{$a as default};
