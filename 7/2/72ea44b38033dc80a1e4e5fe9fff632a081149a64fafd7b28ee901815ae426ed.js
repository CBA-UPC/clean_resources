import{popinCountriesInit as t}from"../components/footer-countries.js";import{accordionInit as i}from"../modules/accordion.js";import{getLocalData as v,mediaQuery as l}from"./config.js";import{delegate as m,fetchJson as p,forceRepaintSVG as k,resolve}from"./croco.js";let u;const j="partials-skeleton";const S="footer-skeleton";export const renderFooterSection=async(o,data,t,i)=>{const l=u.querySelector(o);const{render:m}=await import("../vendors/lit-html/lit-html.js");data&&t&&m(t(data),l);l.classList.remove(j,S);i&&k(l)};const T=()=>{const t=document.querySelector(".js-form-login");if(t){t.action&&t.addEventListener("submit",async e=>{e.preventDefault();const formData=new FormData;const email=resolve("elements.email.value",t);email&&formData.append("email",email);const data=await p(t.action,{method:"POST",body:formData});const o=resolve("nextStep.redirectUrl",data);window.location.href=o||t.action})}};const g=async()=>{const{getLinksTpl:o,getHelpLinksTpl:t,getNewsletterTpl:i,getSocialsTpl:l,getMainLinksTpl:m}=await import("../templates/footer.tpl.js");const p=await v("links");const[k,u,j,S,g,F,h]=resolve(["footer.newsletter","footer.links.socials","footer.links.about","footer.links.categories","common.links.help.content","footer.links.main","common.links.accessibilityIcons"],p);await renderFooterSection(".js-footer-links-newsletter",k,i,true);await renderFooterSection(".js-footer-links-socials",u,l);await renderFooterSection(".js-footer-links-about",j,o,true);await renderFooterSection(".js-footer-links-categories",S,o,true);await renderFooterSection(".js-footer-links-help",{...g,accessibilityIcons:h},t,true);await renderFooterSection(".js-footer-links-main",F,m);T()};export const footerInit=()=>{u=document.querySelector(".js-footer");if(window.pageInfo?.type!=="home"){const o=u&&new IntersectionObserver((entries,o)=>{for(let t of entries){if(t.intersectionRatio>0){o.unobserve(u);g()}}},{rootMargin:"0px 0px 100% 0px",threshold:0});o?.observe(u)}else{renderFooterSection(".js-footer-links-newsletter");T();renderFooterSection(".js-footer-links-socials");renderFooterSection(".js-footer-links-about");renderFooterSection(".js-footer-links-categories");renderFooterSection(".js-footer-links-help");renderFooterSection(".js-footer-links-main")}if(u){l.mobileOnly.matches&&i(u);u.addEventListener("click",async e=>{const o=e.target;const[t,i,l]=resolve(["dataset.popinContentId","dataset.popinTitle","dataset.popinContent"],o);const{openPopin:m}=await import("./popin-refit.js");if(t&&i&&l){const p=document.createElement("div");p.innerHTML=l;p.className="font-medium";m({instanceId:t,title:i,$btnSource:o,loadContents:()=>({htmlContents:p})})}})}t();m(document.documentElement,".js-didomi-manage-cookies","click",()=>{window.Didomi&&window.Didomi.preferences&&window.Didomi.preferences.show()})};