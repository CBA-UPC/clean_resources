ips.templates.set('core.general.loading',"  &nbsp;<span class='ipsType_light'><i class='icon-spinner2 ipsLoading_tinyIcon'></i>&nbsp;&nbsp;&nbsp;</span> {{text}}</span>");ips.templates.set('core.general.ajax',"  <div id='elAjaxLoading'><i class='icon-spinner2 ipsLoading_tinyIcon'></i> &nbsp;&nbsp;{{#lang}}loading{{/lang}}...</div>");ips.templates.set('core.general.flashMsg',"  <div id='elFlashMessage'><div data-role='flashMessage'></div><a href='#' data-action='dismissFlashMessage'>&times;</a></div>");ips.templates.set('core.hovercard.loading',"  <i class='icon-spinner2 ipsLoading_tinyIcon'></i>");ips.templates.set('core.posts.spoiler',"  <span class='ipsStyle_spoilerFancy_text'><span class='ipsButton ipsButton_verySmall ipsButton_primary ipsButton_narrow'><i class='fa fa-chevron-right'></i></span> {{#lang}}spoilerClickToReveal{{/lang}}</span>");ips.templates.set('core.posts.spoilerOpen',"  <span class='ipsStyle_spoilerFancy_text'><span class='ipsButton ipsButton_verySmall ipsButton_primary ipsButton_narrow'><i class='fa fa-chevron-down'></i></span> {{#lang}}spoilerClickToHide{{/lang}}</span>");ips.templates.set('core.posts.multiQuoteOff',"  <i class='fa fa-plus'></i>");ips.templates.set('core.posts.multiQuoteOn',"  <i class='fa fa-check'></i>");ips.templates.set('core.posts.multiQuoter',"  <div id='ipsMultiQuoter'>  <button class='ipsButton ipsButton_light ipsButton_small' data-role='multiQuote'><i class='fa fa-comments'></i> &nbsp;&nbsp;{{{count}}}</button> &nbsp;&nbsp;<a href='#' data-action='clearQuoted'><i class='fa fa-times'></i></a> </div>");ips.templates.set('core.menus.menuItem',"  <li class='ipsMenu_item {{#checked}}ipsMenu_itemChecked{{/checked}}' data-ipsMenuValue='{{value}}'>  <a href='{{link}}'>{{title}}</a> </li>");ips.templates.set('core.menus.menuSep',"  <li class='ipsMenu_sep'><hr></li>");ips.templates.set('core.posts.quotedSpoiler',"  <p><em>{{#lang}}quotedSpoiler{{/lang}}</em></p>");ips.templates.set('core.postNotify.single',"  <span data-role='newPostNotification' class='ipsType_medium'>  <img src='{{photo}}' alt='' class='ipsUserPhoto ipsUserPhoto_tiny ipsPos_middle'> &nbsp;&nbsp;&nbsp;{{{text}}}  &nbsp;&nbsp;&nbsp;<a href='#' data-action='loadNewPosts'>{{#lang}}showReply{{/lang}}</a> </span>");ips.templates.set('core.postNotify.multiple',"  <span data-role='newPostNotification' class='ipsType_medium'>  {{text}}  &nbsp;&nbsp;&nbsp;<a href='#' data-action='loadNewPosts'>{{#lang}}showReplies{{/lang}}</a> </span>");ips.templates.set('core.postNotify.multipleSpillOver',"  <span data-role='newPostNotification' class='ipsType_medium'>  {{text}}  {{#canLoadNew}}   &nbsp;&nbsp;&nbsp;<a href='#' data-action='loadNewPosts'>{{showFirstX}}</a>   &nbsp;&nbsp;&nbsp;<span class='ipsType_light'>{{#lang}}showRepliesOr{{/lang}}</span>  {{/canLoadNew}}  &nbsp;&nbsp;&nbsp;<a href='{{spillOverUrl}}'>{{#lang}}goToNewestPage{{/lang}}</a> </span>");ips.templates.set('core.notification.flashSingle',"  <a href='{{url}}' data-role='newNotification'>  <div class='ipsPhotoPanel ipsPhotoPanel_tiny ipsType_medium ipsType_blendLinks'>   <img src='{{icon}}' alt='' class='ipsUserPhoto ipsUserPhoto_tiny ipsPos_middle'>   <div class='ipsType_left'>    {{text}}    <p class='ipsType_reset ipsType_light ipsTruncate ipsTruncate_line'>{{{body}}}</p>   </div>  </div> </a>");ips.templates.set('core.notification.flashMultiple',"  <div class='ipsPhotoPanel ipsPhotoPanel_tiny ipsType_medium ipsType_blendLinks' data-role='newNotification'>  <span class='ipsPos_left ipsType_veryLarge ipsPos_left'><i class='fa fa-bell'></i></span>  <div class='ipsType_left'>   {{text}}   <p class='ipsType_reset ipsType_light ipsTruncate ipsTruncate_line'>{{{body}}}</p>  </div> </div>");ips.templates.set('core.alert.box'," <div class='ipsAlert' style='display: none' role='alertdialog' aria-describedby='{{id}}_message'> {{{icon}}} <div class='ipsAlert_msg ipsType_break' id='{{id}}_message'>  {{{text}}}  {{{subtext}}} </div> <ul class='ipsToolList ipsToolList_horizontal ipsType_right ipsAlert_buttonRow ipsClear ipsClearfix'>  {{{buttons}}} </ul></div>");ips.templates.set('core.alert.subText'," <div class='ipsType_light ipsType_normal'>{{text}}</div>");ips.templates.set('core.alert.subTextHtml'," <div class='ipsType_light ipsType_normal'>{{{text}}}</div>");ips.templates.set('core.alert.icon'," <i class='{{icon}} ipsAlert_icon'></i>");ips.templates.set('core.alert.button'," <li><button data-action='{{action}}' class='ipsButton ipsButton_fullWidth {{extra}}' role='button'>{{title}}</button></li>");ips.templates.set('core.alert.prompt'," <br><br><input type='text' value='{{value}}' class='ipsField_fullWidth' data-role='promptValue'><br><br>");ips.templates.set('core.lightbox.meta',"{{title}}");ips.templates.set('core.dialog.main'," <div class='{{class}} {{#fixed}}{{class}}_fixed{{/fixed}} {{#size}}{{class}}_{{size}}{{/size}} {{extraClass}}' style='display: none' id='{{id}}' role='dialog' aria-label='{{title}}'> <div>  {{#title}}   <h3 class='{{class}}_title'>{{title}}</h3>   <hr class='ipsHr'>  {{/title}}  {{#close}}   <a href='#' class='{{class}}_close' data-action='dialogClose'>&times;</a>  {{/close}}  <div class='{{class}}_content'>   {{content}}  </div>  <div class='{{class}}_loading {{class}}_large ipsLoading ipsLoading_noAnim' style='display: none'></div> </div></div>")
ips.templates.set('core.tooltip',"  <div id='{{id}}' class='ipsTooltip ipsType_noBreak' role='tooltip'>{{content}}</div>");ips.templates.set('core.search.loadingPanel',"  <div id='{{id}}' class='ipsLoading' style='min-height: 100px'>  &nbsp; </div>");ips.templates.set('core.editor.panelWrapper',"  <div id='{{id}}' class='ipsRTE_panel ipsPad'>  {{content}} </div>");ips.templates.set('core.editor.giphy'," <div class='ipsMenu ipsMenu_wide' id='{{id}}_menu' style='display: none' data-editorID='{{editor}}' data-controller='core.global.editor.giphy'> <div class='ipsMenu_headerBar'>  <div class='ipsGiphy_attribution'><img src='{{attribution_image}}'></div>  <h4 class='ipsType_sectionHead'>   {{#lang}}giphy{{/lang}}  </h4> </div> <div class='ipsMenu_innerContent ipsGiphy_content' data-role='giphyResults'>  <div data-role='giphyLoading'>     </div>  <div class='ipsGiphy_moar' data-role='giphyMore' data-offset='0'>   <div data-role='giphyMoreLoading' class='ipsType_light ipsHide ipsSpacer_bottom'>{{#lang}}giphyMore_loading{{/lang}}</div>  </div> </div> <div class='ipsMenu_footerBar'>  <input type='text' data-role='giphySearch' class='ipsField_fullWidth' placeholder='{{#lang}}giphyFind{{/lang}}'> </div></div>");ips.templates.set('core.editor.giphyThumb',"  <div class='ipsGiphy_thumb'><img src=\"{{thumb}}\" class=\"ipsGiphyImage\" data-url=\"{{url}}\" alt='{{title}}' title='{{title}}'></div>");ips.templates.set('core.editor.giphyRow',"  <div class='ipsGiphy_row'>{{{gifs}}}</div>");ips.templates.set('core.editor.emoticons'," <div class='ipsMenu ipsMenu_wide' id='{{id}}_menu' style='display: none' data-editorID='{{editor}}' data-controller='core.global.editor.emoticons'> <div class='ipsMenu_headerBar'>  <p class='ipsType_reset ipsPos_right'>   <a href='#' class='ipsType_blendLinks ipsHide' data-role='skinToneMenu' data-ipsMenu data-ipsMenu-appendTo='#{{id}}_menu' id='{{id}}_tones'>{{#lang}}emoji_skin_tone{{/lang}} <i class='fa fa-caret-down'></i></a>   &nbsp;&nbsp;&nbsp;   <a href='#' class='ipsType_blendLinks ipsHide' data-role='categoryTrigger' data-ipsMenu data-ipsMenu-appendTo='#{{id}}_menu' id='{{id}}_more'>{{#lang}}emoticonCategories{{/lang}} <i class='fa fa-caret-down'></i></a>  </p>  <h4 class='ipsType_sectionHead'>{{#lang}}emoji{{/lang}}</h4>  <ul class='ipsMenu ipsMenu_veryNarrow ipsCursor_pointer' id='{{id}}_tones_menu' role='menu' style='display: none'>   <li class='ipsMenu_title'>{{#lang}}emoji_skin_tone{{/lang}}</li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='none'><a>{{#lang}}emoji_skin_tone_default{{/lang}}</a></li>   <li class='ipsMenu_sep'><hr></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='light'><a>\uD83C\uDFFB {{#lang}}emoji_skin_tone_light{{/lang}}</a></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='medium-light'><a>\uD83C\uDFFC {{#lang}}emoji_skin_tone_medium_light{{/lang}}</a></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='medium'><a>\uD83C\uDFFD {{#lang}}emoji_skin_tone_medium{{/lang}}</a></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='medium-dark'><a>\uD83C\uDFFE {{#lang}}emoji_skin_tone_medium_dark{{/lang}}</a></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='dark'><a>\uD83C\uDFFF {{#lang}}emoji_skin_tone_dark{{/lang}}</a></li>  </ul>  <ul data-role='categoryMenu' class='ipsMenu ipsMenu_auto ipsCursor_pointer' id='{{id}}_more_menu' role='menu' style='display: none'>  </ul> </div> <div class='ipsMenu_innerContent ipsEmoticons_content'>  <div class='ipsEmpty ipsType_center ipsEmoticons_contentLoading' data-role='emojiLoading'>   {{#lang}}loading{{/lang}}...  </div> </div> <div class='ipsMenu_footerBar'>  <input type='text' data-role='emoticonSearch' class='ipsField_fullWidth' placeholder='{{#lang}}emoticonFind{{/lang}}'> </div></div>");ips.templates.set('core.editor.emoticonSection',"  <div data-panel='{{id}}'>{{{content}}}</div>");ips.templates.set('core.editor.emoticonMenu',"  <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='{{categoryID}}'><a><span class='ipsMenu_itemCount'>{{count}}</span>{{title}}</a></li>");ips.templates.set('core.editor.emoticonCategory',"  <div class='ipsAreaBackground_light ipsPad_half'><strong>{{title}}</strong></div> <div class='ipsEmoticons_category' data-categoryid='{{categoryID}}'>{{{emoticons}}}</div>");ips.templates.set('core.editor.emoticonSearch',"  <div class='ipsEmoticons_category'>{{{emoticons}}}</div>");ips.templates.set('core.editor.emoticonRow',"  <div class='ipsEmoticons_row ipsEmoji'>{{{emoticons}}}</div>");ips.templates.set('core.editor.emoticonItem',"  <div class='ipsEmoticons_item' data-emoticon='{{tag}}' data-src='{{src}}' data-srcset='{{srcset}}' data-height='{{height}}' data-width='{{width}}' title='{{tag}}'>{{{img}}}</div>");ips.templates.set('core.editor.emoji',"  <div class='ipsEmoticons_item' title='{{name}}' data-emoji='{{code}}'>{{{display}}}</div>");ips.templates.set('core.editor.emojiNotNative',"  <div class='ipsEmoticons_item' title='{{name}}' data-emoji='{{code}}'>{{{img}}}</div>");ips.templates.set('core.editor.emoticonBlank',"  <div class='ipsEmoticons_item'>&nbsp;</div>");ips.templates.set('core.editor.emoticonNoResults',"  <div class='ipsPad ipsType_center ipsType_light'>{{#lang}}no_results{{/lang}}</div>");ips.templates.set('core.editor.emojiResult',"  <li class='ipsMenu_item ipsCursor_pointer' title='{{name}}' data-emoji='{{code}}'>  <a><span class='ipsEmoji_result'>{{{emoji}}}</span> <span data-role='shortCode'>{{short_code}}</span></a> </li>");ips.templates.set('core.editor.quote',"<blockquote class='ipsQuote' data-ipsQuote data-gramm='false'><div class='ipsQuote_citation'>{{citation}}</div><div class='ipsQuote_contents ipsClearfix' data-gramm='false'>{{{contents}}}</div></blockquote>");ips.templates.set('core.editor.legacyQuoteUpcast',"<div class='ipsQuote_citation'>{{citation}}</div><div class='ipsQuote_contents ipsClearfix' data-gramm='false'>{{{contents}}}</div>");ips.templates.set('core.editor.citation',"  <div class='ipsQuote_citation ipsQuote_open'>  <a href='#' data-action='toggleQuote'>&nbsp;</a>  {{#contenturl}}   <a class='ipsPos_right' href='{{contenturl}}'><i class='fa fa-share'></i></a>  {{/contenturl}}  {{{citation}}} </div>");ips.templates.set('core.editor.citationLink',"  <a href='{{baseURL}}?app=core&module=members&controller=profile&id={{userid}}' data-ipsHover data-ipshover-target='{{baseURL}}?app=core&module=members&controller=profile&id={{userid}}&do=hovercard'>{{username}}</a>");ips.templates.set('core.editor.spoiler',"<div class='ipsSpoiler' data-ipsSpoiler><div class='ipsSpoiler_header'><span>{{#lang}}editorSpoiler{{/lang}}</span></div><div class='ipsSpoiler_contents'></div></div>");ips.templates.set('core.editor.legacySpoilerUpcast',"<div class='ipsSpoiler_header'><span>{{#lang}}editorSpoiler{{/lang}}</span></div><div class='ipsSpoiler_contents' data-gramm='false'>{{{contents}}}</div>");ips.templates.set('core.editor.spoilerHeader',"  <div class='ipsSpoiler_header ipsSpoiler_closed'>  <a href='#' data-action='toggleSpoiler'>&nbsp;</a>  <span>{{#lang}}spoilerClickToReveal{{/lang}}</span> </div>");ips.templates.set('core.editor.initLoading',"  <div class='ipsLoading ipsLoading_tiny'>&nbsp;</div>");ips.templates.set('core.editor.previewLoading',"  <div data-role='previewLoading' class='ipsLoading' style='min-height: 100px'>  &nbsp; </div>");ips.templates.set('core.attachments.metaInfo',"  {{size}} &middot; {{downloads}} ");ips.templates.set('core.attachments.attachmentPreview',"  <span class='ipsAttachLink_title'>{{title}}</span><span class='ipsAttachLink_metaInfo'>{{#lang}}attachmentPending{{/lang}}</span> ");ips.templates.set('core.attachments.fileItemWrapper',"  <ul class='ipsDataList'>{{{content}}}</ul>");ips.templates.set('core.attachments.fileItem',"  <li class='ipsDataItem ipsAttach ipsContained {{#done}}ipsAttach_done{{/done}}' id='{{id}}' data-role='file' data-fileid='{{id}}'>  <div class='ipsDataItem_generic ipsDataItem_size2 ipsResponsive_hidePhone ipsResponsive_block ipsType_center' data-role='preview' data-action='insertFile' {{#thumb}}style='background-image: url( {{thumbnail}} )'{{/thumb}}>   {{#thumb}}    {{{thumb}}}   {{/thumb}}   <i class='fa fa-file ipsType_large' {{#thumb}}style='display: none'{{/thumb}}></i>  </div>  <div class='ipsDataItem_main' data-action='insertFile'>   <h2 class='ipsDataItem_title ipsType_medium ipsType_reset ipsAttach_title ipsTruncate ipsTruncate_line' data-role='title'>{{title}}</h2>   <p class='ipsDataItem_meta ipsType_light'>    {{size}}   </p>  </div>  <div class='ipsDataItem_generic ipsDataItem_size5'>   {{#status}}<span class='ipsAttachment_progress'><span data-role='progressbar'></span></span>{{/status}}   {{#statusText}}<span class='ipsType_light' data-role='status'>{{statusText}}</span>{{/statusText}}  </div>  <div class='ipsDataItem_generic ipsDataItem_size8 ipsType_right'>   <ul class='ipsList_inline'>    <li data-role='insert' {{#insertable}}style='display: none'{{/insertable}}>     <a href='#' data-action='insertFile' class='ipsAttach_selection' data-ipsTooltip title='{{#lang}}insertIntoPost{{/lang}}'>      <i class='fa fa-plus'></i>     </a>    </li>    {{#supportsDelete}}<li data-role='deleteFileWrapper' {{#newUpload}}style='display: none'{{/newUpload}}>     <input type='hidden' name='{{field_name}}_keep[{{id}}]' value='1'>     <a href='#' data-role='deleteFile' class='ipsType_warning' data-ipsTooltip title='{{#lang}}attachRemove{{/lang}}'>      <i class='fa fa-trash-o'></i> {{#lang}}delete{{/lang}}     </a>    </li>    {{/supportsDelete}}    {{^supportsDelete}}    <input type='hidden' name='{{field_name}}_keep[{{id}}]' value='1'>    {{/supportsDelete}}   </ul>  </div> </li>");ips.templates.set('core.attachments.imageItem',"  <div class='ipsGrid_span3 ipsAttach ipsImageAttach ipsPad_half ipsAreaBackground_light {{#done}}ipsAttach_done{{/done}}' id='{{id}}' data-role='file' data-fileid='{{id}}' data-fullsizeurl='{{imagesrc}}' data-thumbnailurl='{{thumbnail}}' data-fileType='image'>  <ul class='ipsList_inline ipsImageAttach_controls'>   <li data-role='insert' {{#insertable}}style='display: none'{{/insertable}}><a href='#' data-action='insertFile' class='ipsAttach_selection' data-ipsTooltip title='{{#lang}}insertIntoPost{{/lang}}'><i class='fa fa-plus'></i></a></li>   </li>   <li class='ipsPos_right' {{#newUpload}}style='display: none'{{/newUpload}} data-role='deleteFileWrapper'>    <input type='hidden' name='{{field_name}}_keep[{{id}}]' value='1'>    <a href='#' data-role='deleteFile' class='ipsButton ipsButton_verySmall ipsButton_light' data-ipsTooltip title='{{#lang}}attachRemove{{/lang}}'><i class='fa fa-trash-o'></i></a>   </li>  </ul>  <div class='ipsImageAttach_thumb ipsType_center' data-role='preview' data-grid-ratio='65' data-action='insertFile' {{#thumb}}style='background-image: url( {{thumbnail}} )'{{/thumb}}>   {{#status}}    <span class='ipsImageAttach_status ipsType_light' data-role='status'>{{{status}}}</span>    <span class='ipsAttachment_progress'><span data-role='progressbar'></span></span>   {{/status}}   {{#thumb}}    {{{thumb}}}   {{/thumb}}  </div>  <h2 class='ipsType_reset ipsAttach_title ipsType_medium ipsTruncate ipsTruncate_line' data-role='title'>{{title}}</h2>  <p class='ipsType_light'>{{size}} {{#statusText}}&middot; <span data-role='status'>{{statusText}}</span>{{/statusText}}</p> </div>");ips.templates.set('core.attachments.videoItem',"  <div class='ipsGrid_span3 ipsAttach ipsImageAttach ipsPad_half ipsAreaBackground_light {{#done}}ipsAttach_done{{/done}}' id='{{id}}' data-role='file' data-fileid='{{id}}' data-fullsizeurl='{{imagesrc}}' data-thumbnailurl='{{thumbnail}}' data-fileType='video' data-mimeType='{{mime}}'>  <ul class='ipsList_inline ipsImageAttach_controls'>   <li data-role='insert' {{#insertable}}style='display: none'{{/insertable}}><a href='#' data-action='insertFile' class='ipsAttach_selection' data-ipsTooltip title='{{#lang}}insertIntoPost{{/lang}}'><i class='fa fa-plus'></i></a></li>   </li>   <li class='ipsPos_right' {{#newUpload}}style='display: none'{{/newUpload}} data-role='deleteFileWrapper'>    <input type='hidden' name='{{field_name}}_keep[{{id}}]' value='1'>    <a href='#' data-role='deleteFile' class='ipsButton ipsButton_verySmall ipsButton_light' data-ipsTooltip title='{{#lang}}attachRemove{{/lang}}'><i class='fa fa-trash-o'></i></a>   </li>  </ul>  <div class='ipsImageAttach_thumb ipsType_center' data-role='preview' data-grid-ratio='65' data-action='insertFile'>   {{#status}}    <span class='ipsImageAttach_status ipsType_light' data-role='status'>{{{status}}}</span>    <span class='ipsAttachment_progress'><span data-role='progressbar'></span></span>   {{/status}}   {{#thumb}}    <video>     <source src='{{{thumb}}}' type='{{mime}}'>    </video>   {{/thumb}}  </div>  <h2 class='ipsType_reset ipsAttach_title ipsType_medium ipsTruncate ipsTruncate_line' data-role='title'>{{title}}</h2>  <p class='ipsType_light'>{{size}} {{#statusText}}&middot; <span data-role='status'>{{statusText}}</span>{{/statusText}}</p> </div>");ips.templates.set('core.attachments.imageItemWrapper',"  <div class='ipsGrid ipsGrid_collapsePhone' data-ipsGrid data-ipsGrid-minItemSize='150' data-ipsGrid-maxItemSize='250'>{{{content}}}</div>");ips.templates.set('core.autocomplete.field',"  <div class='ipsField_autocomplete' id='{{id}}_wrapper' role='combobox' aria-autocomplete='list' aria-owns='{{id}}_results'>  <span class='ipsField_autocomplete_loading' style='display: none' id='{{id}}_loading'></span>  <ul class='ipsList_inline'><li id='{{id}}_inputItem'>{{content}}</li></ul> </div>");ips.templates.set('core.autocomplete.addToken',"  <a href='#' data-action='addToken'><i class='fa fa-plus'></i> {{text}}</a> ");ips.templates.set('core.autocomplete.resultWrapper',"  <ul class='ipsAutocompleteMenu ipsList_reset' id='{{id}}_results' aria-expanded='false' style='display: none'> </ul>");ips.templates.set('core.autocomplete.resultItem',"  <li class='ipsAutocompleteMenu_item' data-value='{{value}}' role='option' role='listitem'>  <div class='ipsClearfix'>   {{html}}  </div> </li>");ips.templates.set('core.autocomplete.tagsResultItem',"  <li class='ipsAutocompleteMenu_item' data-value='{{value}}' role='option' role='listitem'>  <div class='ipsClearfix'>   {{html}}   {{#recommended}}    <span class='ipsPos_right ipsType_success'>{{#lang}}tag_recommended{{/lang}}   {{/recommended}}  </div> </li>");ips.templates.set('core.autocomplete.token',"  <li class='cToken' data-value='{{value}}'>  {{{title}}} <span class='cToken_close' data-action='delete'>&times;</span> </li>");ips.templates.set('core.autocomplete.memberItem',"  <li class='ipsAutocompleteMenu_item ipsClearfix' data-value=\"{{value}}\" role='option' role='listitem'>  <div class='ipsPhotoPanel ipsPhotoPanel_tiny'>   <span class='ipsUserPhoto ipsUserPhoto_tiny'><img src='{{{photo}}}'></span>   <div>    <strong>{{{name}}}</strong><br>    <span class='ipsType_light'>{{{extra}}}</span>   </div>  </div> </li>");ips.templates.set('core.autocomplete.optional',"  <a href='#' data-action='showAutocomplete' class='ipsType_normal'><i class='fa fa-plus'></i> {{#lang}}ac_optional{{/lang}}...</a>");ips.templates.set('core.forms.toggle',"  <span class='ipsToggle {{className}}' id='{{id}}' tabindex='0' role='switch' aria-checked='{{status}}'>  <span data-role='status'></span> </span>");ips.templates.set('core.forms.validationWrapper',"  <ul id='{{id}}' class='ipsList_reset ipsType_small ipsForm_errorList'>{{content}}</ul>");ips.templates.set('core.forms.validationItem',"  <li class='ipsType_warning'>{{message}}</li>");ips.templates.set('core.forms.advicePopup',"<div class='ipsHovercard' data-role='advicePopup' id='elPasswordAdvice_{{id}}'> <div class='ipsPad'>  <h2 class='ipsType_sectionHead'>{{#lang}}password_advice_title{{/lang}}</h2>  <p class='ipsSpacer_top ipsSpacer_half ipsType_reset ipsType_medium'>   {{#min}}    {{min}}    {{/min}}   {{{text}}}  </p> </div> <span class='ipsHovercard_stem'></span></div>");ips.templates.set('core.forms.validateOk',"<span> <i class='fa fa-check-circle ipsType_success'></i></span>");ips.templates.set('core.forms.validateFail',"<span data-ipsTooltip data-ipsTooltip-label='{{message}}'> <i class='fa fa-times-circle ipsType_warning'></i></span>");ips.templates.set('core.forms.validateFailText',"<p class='ipsType_reset ipsSpacer_top ipsSpacer_half ipsType_warning'> <i class='fa fa-times-circle'></i> {{message}}</p>");ips.templates.set('core.truncate.expand',"  <a class='ipsTruncate_more' data-action='expandTruncate'><span>{{text}} &nbsp;<i class='fa fa-caret-down'></i></span></a>");ips.templates.set('core.selectTree.token'," <li><span class='ipsSelectTree_token cToken' data-nodeID='{{id}}'>{{title}}</span></li>");ips.templates.set('core.accessibility.border'," <div id='ipsAccessibility_border'></div>");ips.templates.set('core.accessibility.arrow'," <div id='ipsAccessibility_arrow'></div>");ips.templates.set('core.infScroll.loading',"  <li class='ipsPad ipsType_center' data-role='infScroll_loading'>  {{#lang}}loading{{/lang}}... </li>");ips.templates.set('core.infScroll.pageBreak',"  <li class='ipsPad_half ipsAreaBackground' data-role='infScroll_break' data-infScrollPage='{{page}}'>  {{#lang}}page{{/lang}} {{page}} </li>");ips.templates.set('core.pageAction.actionMenuItem',"  <li data-role='actionMenu' data-action='{{action}}' id='{{id}}_{{action}}' data-ipsMenu data-ipsMenu-above='force' data-ipsMenu-appendTo='#{{id}}_bar' data-ipsMenu-activeClass='ipsPageAction_active' data-ipsTooltip title='{{title}}' class='ipsHide'>  {{#icon}}   <i class='fa fa-{{icon}} ipsPageAction_icon'></i> <i class='fa fa-caret-up'></i>  {{/icon}}  {{^icon}}   <span class='ipsPageAction_text'>{{title}} <i class='fa fa-caret-up'></i></span>  {{/icon}}  <ul id='{{id}}_{{action}}_menu' class='ipsMenu ipsMenu_auto' style='display: none'>   {{{menucontent}}}  </ul> </li>");ips.templates.set('core.pageAction.actionItem',"  <li data-role='actionButton' data-action='{{action}}' id='{{id}}_{{action}}' data-ipsTooltip title='{{title}}'>  {{#icon}}   <i class='fa fa-{{icon}} ipsPageAction_icon' data-ipsTooltip='{{title}}'></i></i>  {{/icon}}  {{^icon}}   <span class='ipsPageAction_text'>{{title}}</span>  {{/icon}} </li>");ips.templates.set('core.pageAction.wrapper',"  <div class='ipsPageAction' data-role='actionBar' id='{{id}}_bar'>  <ul class='ipsList_inline ipsList_reset' data-role='actionItems'>   <li>{{{selectedLang}}}</li>   {{{content}}}  </ul> </div>");ips.templates.set('core.carousel.bulletWrapper'," <ul class='ipsCarousel_bullets'>{{content}}</ul>");ips.templates.set('core.carousel.bulletItem'," <li><i class='fa fa-circle'></i></li>");ips.templates.set('core.rating.wrapper'," <div class='ipsClearfix ipsRating'>  <ul class='{{className}}' data-role='ratingList'>   {{{content}}}  </ul> </div> <span data-role='ratingStatus' class='ipsType_light ipsType_medium'>{{status}}</span>")
ips.templates.set('core.rating.star'," <li class='{{className}}' data-ratingValue='{{value}}'><a href='#'><i class='fa fa-star'></i></a></li>");ips.templates.set('core.rating.halfStar'," <li class='ipsRating_half' data-ratingValue='{{value}}'><i class='fa fa-star-half'></i><i class='fa fa-star-half fa-flip-horizontal'></i></li>");ips.templates.set('core.rating.loading'," <i class='icon-spinner2 ipsLoading_tinyIcon'></span>");ips.templates.set('core.sidebar.managerWrapper',"  <div id='elSidebarManager' data-role='manager' class='ipsToolbox ipsScrollbar ipsHide'>  <div class='ipsPad'>   <h3 class='ipsToolbox_title ipsType_reset'>{{#lang}}sidebarManager{{/lang}}</h3>   <p class='ipsType_light'>{{#lang}}sidebarManagerDesc{{/lang}}</p>   <p class='ipsType_light'>{{#lang}}sidebarManagerDesc2{{/lang}}</p>   <div data-role='availableBlocks' class='ipsLoading ipsLoading_dark'></div>  </div>  <div id='elSidebarManager_submit' class='ipsPad'>   <button class='ipsButton ipsButton_important ipsButton_medium ipsButton_fullWidth' data-action='closeSidebar'>{{#lang}}finishEditing{{/lang}}</button>  </div> </div>");ips.templates.set('core.sidebar.blockManage',"  <div class='cSidebarBlock_managing ipsType_center'>  <h4>{{title}}</h4>  <a href='#' data-action='removeBlock' data-ipsTooltip title='{{#lang}}removeBlock{{/lang}}'><i class='fa fa-times'></i></a>  <button data-ipsMenu data-ipsMenu-closeOnClick='false' id='{{id}}_edit' data-action='manageBlock' class='ipsButton ipsButton_primary'>   <i class='fa fa-pencil'></i> &nbsp;{{#lang}}editBlock{{/lang}}  </button>  <div class='ipsMenu ipsMenu_wide ipsHide' id='{{id}}_edit_menu'>  </div> </div>");ips.templates.set('core.sidebar.blockManageNoConfig',"  <div class='cSidebarBlock_managing ipsType_center'>  <h4>{{title}}</h4>  <a href='#' data-action='removeBlock' data-ipsTooltip title='{{#lang}}removeBlock{{/lang}}'><i class='fa fa-times'></i></a> </div>");ips.templates.set('core.sidebar.blockIsEmpty',"  <div class='ipsWidgetBlank ipsPad'>  {{text}} </div>");ips.templates.set('core.follow.loading'," <div class='ipsLoading ipsLoading_tiny'></div>");ips.templates.set('core.statuses.loadingComments',"  <i class='icon-spinner2 ipsLoading_tinyIcon'></i> &nbsp;<span class='ipsType_light'> &nbsp;{{#lang}}loadingComments{{/lang}}</span>");ips.templates.set('core.forms.stack',"  <li class='ipsField_stackItem' data-role='stackItem'>  <span class='ipsField_stackDrag ipsDrag' data-action='stackDrag'>   <i class='fa fa-bars ipsDrag_dragHandle'></i>  </span>  <a href='#' class='ipsField_stackDelete ipsCursor_pointer' data-action='stackDelete'>   &times;  </a>  <div data-ipsStack-wrapper>   {{{field}}}  </div> </li>");ips.templates.set('core.pollEditor.question',"  <div class='ipsAreaBackground_light ipsBox ipsBox_transparent' data-role='question' data-questionID='{{questionID}}'>  <div class='ipsAreaBackground ipsPad'>   <input type='text' data-role='questionTitle' name='{{pollName}}[questions][{{questionID}}][title]' placeholder='{{#lang}}questionPlaceholder{{/lang}}' class='ipsField_fullWidth' value='{{question}}'>  </div>  <div class='ipsPad'>   <ul class='ipsDataList cPollChoices' data-role='choices'>    <li class='ipsDataItem ipsResponsive_hidePhone'>     <p class='ipsDataItem_generic ipsDataItem_size1'>&nbsp;</p>     <p class='ipsDataItem_main'><strong>{{#lang}}choicesTitle{{/lang}}</strong></p>     {{#showCounts}}      <p class='ipsDataItem_generic ipsDataItem_size4'><strong>{{#lang}}votesTitle{{/lang}}</strong></p>     {{/showCounts}}     <p class='ipsDataItem_generic ipsDataItem_size1'>&nbsp;</p>    </li>    {{{choices}}}   </ul>   <br>   <div class='ipsDataList'>    <p class='ipsDataItem_generic ipsDataItem_size1'>&nbsp;</p>    <ul class='ipsDataItem_main ipsList_inline'>     {{#removeQuestion}}<li class='ipsPos_right'><a href='#' data-action='removeQuestion' class='ipsButton ipsButton_verySmall ipsButton_light'>{{#lang}}removeQuestion{{/lang}}</a></li>{{/removeQuestion}}     <li><a href='#' data-action='addChoice' class='ipsButton ipsButton_verySmall ipsButton_normal'>{{#lang}}addChoice{{/lang}}</a></li>     <li><input type='checkbox' id='elPoll_{{pollName}}_{{questionID}}multi' name='{{pollName}}[questions][{{questionID}}][multichoice]' {{#multiChoice}}checked{{/multiChoice}}> <label for='elPoll_{{pollName}}_{{questionID}}multi'>{{#lang}}multipleChoiceQuestion{{/lang}}</label></li>    </ul>   </div>  </div> </div>");ips.templates.set('core.pollEditor.choice',"  <li class='ipsDataItem' data-choiceID='{{choiceID}}'>  <div class='ipsDataItem_generic ipsDataItem_size1 cPollChoiceNumber ipsType_right ipsType_normal'>   <strong data-role='choiceNumber'>{{choiceID}}</strong>  </div>  <div class='ipsDataItem_main'>   <input type='text' name='{{pollName}}[questions][{{questionID}}][answers][{{choiceID}}][value]' value='{{choiceTitle}}' class='ipsField_fullWidth'>  </div>  {{#showCounts}}   <div class='ipsDataItem_generic ipsDataItem_size4' data-voteText='{{#lang}}votesTitle{{/lang}}'>    <input type='number' name='{{pollName}}[questions][{{questionID}}][answers][{{choiceID}}][count]' value='{{count}}' min='0'>   </div>  {{/showCounts}}  <div class='ipsDataItem_generic ipsDataItem_size1'>   <a href='#' data-action='removeChoice' class='ipsButton ipsButton_verySmall ipsButton_light ipsButton_narrow'><i class='fa fa-times'></i></a>  </div> </li>");ips.templates.set('core.coverPhoto.controls',"  <ul class='ipsList_inline' data-role='coverPhotoControls'>  <li><a href='#' class='ipsButton ipsButton_positive ipsButton_verySmall' data-action='savePosition'><i class='fa fa-check'></i> {{#lang}}save_position{{/lang}}</a></li>  <li><a href='#' class='ipsButton ipsButton_negative ipsButton_verySmall' data-action='cancelPosition'><i class='fa fa-times'></i> {{#lang}}cancel{{/lang}}</a></li> </ul>");ips.templates.set('core.patchwork.imageList',"  {{#showThumb}}  <li class='cGalleryPatchwork_item' style='width: {{dims.width}}px; height: {{dims.height}}px; margin: {{dims.margin}}px {{dims.marginRight}}px {{dims.margin}}px {{dims.marginLeft}}px'> {{/showThumb}} {{^showThumb}}  <li class='cGalleryPatchwork_item ipsNoThumb ipsNoThumb_video' style='width: {{dims.width}}px; height: {{dims.height}}px; margin: {{dims.margin}}px {{dims.marginRight}}px {{dims.margin}}px {{dims.marginLeft}}px'> {{/showThumb}}  <a href='{{image.url}}'>   {{#showThumb}}<img src='{{image.src}}' alt='{{image.title}}' class='cGalleryPatchwork_image'>{{/showThumb}}   <div class='ipsPhotoPanel ipsPhotoPanel_mini'>    <img src='{{image.author.photo}}' class='ipsUserPhoto ipsUserPhoto_mini'>    <div>     <span class='ipsType_normal ipsTruncate ipsTruncate_line'>{{image.caption}}</span>     <span class='ipsType_small ipsTruncate ipsTruncate_line'>{{#lang}}by{{/lang}} {{image.author.name}}</span>    </div>   </div>   <ul class='ipsList_inline cGalleryPatchwork_stats'>    {{#image.unread}}     <li class='ipsPos_left'>      <span class='ipsItemStatus ipsItemStatus_small' data-ipsTooltip title='{{image.unread}}'><i class='fa fa-circle'></i></span>     </li>    {{/image.unread}}    {{#image.hasState}}     <li class='ipsPos_left'>      {{#image.state.hidden}}       <span class='ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_warning' data-ipsTooltip title='{{#lang}}hidden{{/lang}}'><i class='fa fa-eye-slash'></i></span>      {{/image.state.hidden}}      {{#image.state.pending}}       <span class='ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_warning' data-ipsTooltip title='{{#lang}}pending{{/lang}}'><i class='fa fa-warning'></i></span>      {{/image.state.pending}}      {{#image.state.pinned}}       <span class='ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_positive' data-ipsTooltip title='{{#lang}}pinned{{/lang}}'><i class='fa fa-thumb-tack'></i></span>      {{/image.state.pinned}}      {{#image.state.featured}}       <span class='ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_positive' data-ipsTooltip title='{{#lang}}featured{{/lang}}'><i class='fa fa-star'></i></span>      {{/image.state.featured}}     </li>    {{/image.hasState}}    {{#image.allowComments}}     <li class='ipsPos_right' data-commentCount='{{image.comments}}'><i class='fa fa-comment'></i> {{image.comments}}</li>    {{/image.allowComments}}   </ul>  </a>  {{#image.modActions}}   <input type='checkbox' data-role='moderation' name='moderate[{{image.id}}]' data-actions='{{image.modActions}}' data-state='{{image.modStates}}'>  {{/image.modActions}} </li>");ips.templates.set('core.editor.preferences',"  <div id='editorPreferencesPanel' class='ipsPad'>  <div class='ipsMessage ipsMessage_info'>    {{#lang}}papt_warning{{/lang}}   </div>   <br>   <ul class='ipsForm ipsForm_vertical'>    <li class='ipsFieldRow ipsClearfix'>     <div class='ipsFieldRow_content'>      <input type='checkbox' {{#checked}}checked{{/checked}} name='papt' id='papt'>      <label for='papt'>{{#lang}}papt_label{{/lang}}</label>     </div>    </li>   </ul>   <div class='ipsPad_top ipsType_center'>    <button role='button' class='ipsButton ipsButton_medium ipsButton_primary' id='papt_submit'>{{#lang}}save_preference{{/lang}}</button>   </div>  </div> ");ips.templates.set('core.pagination',"  <ul class='ipsPagination' data-ipsPagination data-ipsPagination-pages='{{pages}}'>  <li class='ipsPagination_prev'>   <a href='#' data-page='prev'><i class='fa fa-caret-left'></i> {{#lang}}prev_page{{/lang}}</a>  </li>  <li class='ipsPagination_next'>   <a href='#' data-page='next'>{{#lang}}next_page{{/lang}} <i class='fa fa-caret-right'></i></a>  </li> </ul>");ips.templates.set('core.selection.quote',"  <div class='ipsTooltip ipsTooltip_{{direction}} ipsComment_inlineQuoteTooltip' data-role='inlineQuoteTooltip'>     <a href='#' data-action='quoteSelection' class='ipsButton ipsButton_veryVerySmall ipsButton_veryLight'>   {{#lang}}quote_selected_text{{/lang}}     </a>    </div>");ips.templates.set('core.contentItem.resultItem',"  <li class='ipsAutocompleteMenu_item' data-id='{{{id}}}' role='option' role='listitem'>  <div class='ipsClearfix'>   {{{html}}}  </div> </li>");ips.templates.set('core.contentItem.field',"  <div class='ipsField_autocomplete' id='{{id}}_wrapper' role='combobox' aria-autocomplete='list' aria-owns='{{id}}_results'>  <span class='ipsField_autocomplete_loading' style='display: none' id='{{id}}_loading'></span>  <ul class='ipsList_inline'><li id='{{id}}_inputItem'>{{content}}</li></ul> </div>");ips.templates.set('core.contentItem.resultWrapper',"  <ul class='ipsAutocompleteMenu ipsList_reset' id='{{id}}_results' aria-expanded='false' style='display: none'> </ul>");ips.templates.set('core.contentItem.item',"  <li data-id='{{id}}'>  <span class='cContentItem_delete' data-action='delete'>&times;</span> {{{html}}}  </li>");ips.templates.set('promote.imageUpload',"  <div class='ipsGrid_span4 cPromote_attachImage' id='{{id}}' data-role='file' data-fileid='{{id}}' data-fullsizeurl='{{imagesrc}}' data-thumbnailurl='{{thumbnail}}' data-fileType='image'>  <div class='ipsThumb ipsThumb_bg' data-role='preview' {{#thumbnail}}style='background-image: url( {{thumbnail_for_css}} )'{{/thumbnail}}>   {{#thumbnail}}<img src='{{thumbnail}}' class='ipsImage'>{{/thumbnail}}  </div>  <ul class='ipsList_inline ipsImageAttach_controls'>   <li class='ipsPos_right' {{#newUpload}}style='display: none'{{/newUpload}} data-role='deleteFileWrapper'>    <input type='hidden' name='{{field_name}}_keep[{{id}}]' value='1'>    <a href='#' data-role='deleteFile' class='ipsButton ipsButton_verySmall ipsButton_light' data-ipsTooltip title='{{#lang}}attachRemove{{/lang}}'><i class='fa fa-trash-o'></i></a>   </li>  </ul>  <span class='ipsAttachment_progress'><span data-role='progressbar'></span></span> </div>");ips.templates.set('table.row.loading',"  <li class='ipsDataItem ipsDataItem_loading'>  <div>   <span></span>   <span style='margin-right: {{rnd}}%'></span>  </div> </li>");ips.templates.set('licenseRenewal.wrapper',"  <div class='acpLicenseRenewal' data-role='licenseRenewal'>  <div class='acpLicenseRenewal_wrap'>   <div class='acpLicenseRenewal_inner'>    <div class='acpLicenseRenewal_content'>     <h1 class='acpLicenseRenewal_mainTitle' data-role='mainTitle'>{{#lang}}licenseRenewalTitle{{/lang}}</h1>     <p class='ipsType_normal'>{{#lang}}licenseRenewalText{{/lang}}</p>     <span class='ipsCustomInput'><input type='checkbox' checked='checked' name='hideRenewalNotice' id='hideRenewalNotice'><span></span></span> <label for='hideRenewalNotice'>{{#lang}}licenseRenewalCheckbox{{/lang}}</label>    </div>    <ul class='ipsPad ipsToolList ipsToolList_horizontal ipsPos_center ipsList_reset ipsClearfix ipsAreaBackground'>     <li>      <a href='#' class='ipsButton ipsButton_medium ipsButton_veryLight ipsButton_fullWidth' data-action='closeLicenseRenewal'>{{#lang}}licenseRenewalNo{{/lang}}</a>     </li>     <li>      <a href='#' class='ipsButton ipsButton_medium ipsButton_primary ipsButton_fullWidth' data-role='survey' data-action='closeLicenseRenewal' target='_blank'>{{#lang}}licenseRenewalYes{{/lang}}</a>     </li>    </ul>   </div>  </div> </div>");ips.templates.set('core.browserNotification.prompt'," <div class='cNotifcationPrompt'>  <div class='ipsPad'>   <div class='ipsPhotoPanel ipsPhotoPanel_mini'>    <span class='cNotifcationPrompt_icon ipsPos_left'></span>    <div>     <a href='#' class='cNotifcationPrompt_dismiss' data-role=\"dismissNotification\">Ã—</a>     <h3 class='cNotifcationPrompt_title ipsType_large ipsType_sectionHead'>{{#lang}}notificationsCallout{{/lang}}</h3>     <p class='cNotifcationPrompt_text ipsType_reset ipsType_medium ipsSpacer_top ipsSpacer_half'>      {{#lang}}notificationsDefaultBlurb{{/lang}}     </p>     <button data-action='browserNotificationPrompt' class='ipsButton ipsButton_veryLight ipsButton_fullWidth ipsSpacer_top'>{{#lang}}notificationsAllow{{/lang}}</button>     <p class='ipsType_small ipsSpacer_both ipsSpacer_half ipsHide' data-role='promptMessage'>      {{#lang}}notificationsAllowPrompt{{/lang}}     </p>    </div>   </div>  </div> </div>");;
;(function($,_,undefined){"use strict";ips.createModule('ips.controller',function(){var _controllers={},_autoMixins={},_manualMixins={},_mixins={},_beingLoaded=[],_queue={},_prototypes={},instanceID=1,_controllerCaseMap={'core.front.core.autosizeiframe':'core.front.core.autoSizeIframe'};var register,isRegistered=function(id){return!_.isUndefined(_controllers[id]);},init,mixin,initializeControllers,_checkQueue,_loadControllers,_buildFilePath=function(controllerName){var bits=controllerName.split('.');if(ips.getSetting('useCompiledFiles')===false){return bits[0]+'/'+bits[1]+'/controllers/'+bits[2]+'/ips.'+bits[2]+'.'+bits[3]+'.js';}else{try{return ipsJavascriptMap[bits[0]][bits[1]+'_'+bits[2]];}catch(err){return'';}}},_findControllers,_getControllersAndMixins=function(controllerString){var controllers={};var pieces=controllerString.split(',');for(var i=0;i<pieces.length;i++){pieces[i]=$.trim(pieces[i]);if(!_.isUndefined(_controllerCaseMap[pieces[i]])){pieces[i]=_controllerCaseMap[pieces[i]];}
if(pieces[i].indexOf('(')===-1){controllers[pieces[i]]=[];continue;}
var p=pieces[i].match(/([a-zA-Z0-9.]+)\((.+?)\)/i);var mixinPieces=[];_.each(p[2].split(';'),function(val){mixinPieces.push($.trim(val));});controllers[p[1]]=mixinPieces;}
return controllers;},getInstanceID,cleanContentsOf,initControllerOnElem,_findSubControllers,getBaseController=function(){var baseController;baseController.method('_destroy');baseController.method('cleanContents');baseController.method('trigger');baseController.method('on',function(elem,ev,delegate,fn){var args=ips.utils.argsToArray(arguments);elem=(!_.isElement(elem)&&elem!=document&&elem!=window)?this.scope:$(args.shift());ev=args[0];fn=(args.length==3)?args[2]:args[1];delegate=(args.length==3)?args[1]:undefined;if(!_.isFunction(fn)){Debug.warn("Callback function for "+ev+" doesn't exist in "+this.controllerType
+" ("+this.controllerID+")");return;}
fn=_.bind(fn,this);if(delegate){elem.on(ev,delegate,fn);this._eventListeners.push({elem:elem,event:ev,delegate:delegate,fn:fn});}else{elem.on(ev,fn);this._eventListeners.push({elem:elem,event:ev,fn:fn});}});baseController.method('triggerOn');return baseController;};return{initControllerOnElem:initControllerOnElem,register:register,mixin:mixin,isRegistered:isRegistered,init:init,cleanContentsOf:cleanContentsOf};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.loader',function(){var _loadedScripts=[],_loadingScripts=[];var init,_getOtherScript,_getInterfaceScript,_getPathScripts,get,_doLoad,_insertScript=function(toLoad,cached){for(var i=0;i<toLoad.length;i++){_loadingScripts.push(toLoad[i]);}
Debug.log("Loading: "+toLoad.join(', '));var url='';if(toLoad[0].match(/^(http|\/\/)/i)){url=toLoad[0].match(/^http/)?toLoad[0].replace(/^.+?\/\/(.*)$/,'//$1'):toLoad[0];}else{url=ips.getSetting('jsURL')+'?src='+encodeURIComponent(toLoad.join(','));}
setTimeout(function(){$.ajax({dataType:'script',cache:(_.isUndefined(cached))?true:cached,url:url,data:{antiCache:ips.getSetting('antiCache')}}).fail).always).done)},500);};return{init:init,get:get}});}(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui',function(){var widgets={},doneInitialInit=false,ziCounter=ips.getSetting('zindex_start')||5000,ziIncrement=ips.getSetting('zindex_inc')||50;var key={BACKSPACE:8,ESCAPE:27,TAB:9,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,COMMA:188,SPACE:32};var registerWidget,getAcceptedOptions,buildjQueryPlugin,_initializeWidgets,destructAllWidgets,_destructWidget,_doImmediateWidgets,_doLazyWidgets,_callWidget,_getWidgetOptions=function(widgetID,elem){var options={},optionKeys=widgets[widgetID].acceptedOptions;elem=$(elem);try{if(elem.attr('data-ips'+widgetID+'-options')){var optionsObj=$.parseJSON(elem.attr('data-ips'+widgetID+'-options'));if(_.isObject(optionsObj)){return optionsObj;}}}catch(err){Debug.warn("Invalid options object passed in for a "+widgetID+" widget. Must be valid JSON.");}
if(optionKeys.length){for(var i=0;i<optionKeys.length;i++){var thisOption=elem.attr('data-ips'+widgetID+'-'+optionKeys[i]);if(!_.isUndefined(thisOption)){if(thisOption.match(/^[0-9]+$/g)){thisOption=parseInt(thisOption,10);}
if(thisOption==='true'){thisOption=true;}else if(thisOption==='false'){thisOption=false;}
if($.trim(thisOption)===''){thisOption=true;}
options[optionKeys[i]]=thisOption;}}}
return options;},zIndex=function(){ziCounter+=ziIncrement;return ziCounter;},getModal,init;return{registerWidget:registerWidget,init:init,zIndex:zIndex,getModal:getModal,getAcceptedOptions:getAcceptedOptions,key:key,destructAllWidgets:destructAllWidgets};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.addressForm',function(){var defaults={minimize:false,country:"",requireFullAddress:true};var respond;var init;var googlePlacesCallback=function(){$(window).trigger('googlePlacesLoaded');};var minimizeAddress=function(elem,options){var tempInput=$('<input/>').attr('type','text').attr('data-role','minimizedVersion').attr('placeholder',ips.getString('specifyLocation')).on('focus');var value=[];elem.find('input, select').each(function(addressPart){if($(this).val()){if($(this).is('select')){value.push($.trim($(this).find('option[value="'+$(this).val()+'"]').text()));}else{value.push($.trim($(this).val()));}}});if(value.length){tempInput.val(value.join(', '));}
elem.hide().after(tempInput);};var countryChange;var addAddressLine;var recalculateAddAddressLineButton;var googlePlacesInit=function(elem){var googlePlacesInput=$(elem).find('[data-role="addressLine"]').first();var options={types:['geocode'],componentRestrictions:{country:$(elem).find('[data-role="countrySelect"]').val()}};var autocomplete=new google.maps.places.Autocomplete(googlePlacesInput.get(0),options);googlePlacesInput.on('focus');googlePlacesInput.on('keypress');google.maps.event.addListener(autocomplete,'place_changed',function(){var place=autocomplete.getPlace();var i;var streetNumber;var addressLines=[];for(i in place.address_components){switch(place.address_components[i].types[0]){case'street_number':streetNumber=place.address_components[i].long_name;break;case'street_address':case'route':case'sublocality':case'neighborhood':case'premise':case'subpremise':addressLines.push(place.address_components[i].long_name);break;case'administrative_area_level_1':case'administrative_area_level_2':elem.find('[data-role="regionSelect"]').val(place.address_components[i].long_name);elem.find('[data-role="regionText"]').focus().val(place.address_components[i].long_name);break;case'locality':case'postal_town':elem.find('[data-role="city"]').focus().val(place.address_components[i].long_name);break;case'postal_code':elem.find('[data-role="postalCode"]').focus().val(place.address_components[i].long_name);break;}}
for(var i=0;i<$(elem).find('[data-role="addressLine"]').length;i++){$(elem).find('[data-role="addressLine"]').val('');}
setTimeout(function(){var existingAddressLines=$(elem).find('[data-role="addressLine"]').length;if(streetNumber&&addressLines[0]){var splitFormatted=place.formatted_address.split(',');if(splitFormatted[0].indexOf(addressLines[0])!=-1){addressLines[0]=splitFormatted[0];}
else{addressLines[0]=streetNumber+' '+addressLines[0];}}
for(var i=0;i<addressLines.length;i++){if(existingAddressLines){$(elem).find('[data-role="addressLine"]').slice(i,1).focus().val(addressLines[i]);existingAddressLines--;}else{addAddressLine(elem,addressLines[i]);}}},50);});}
ips.ui.registerWidget('addressForm',ips.ui.addressForm,['minimize','country','requireFullAddress']);return{respond:respond,googlePlacesCallback:googlePlacesCallback};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.alert');var alertObj=function(options){var alert=null,modal=null;var _defaults={type:'alert',message:ips.getString('generic_confirm'),buttons:{ok:ips.getString('ok'),cancel:ips.getString('cancel'),yes:ips.getString('yes'),no:ips.getString('no')},icon:'info',showIcon:true,callbacks:{}};var _icons={warn:'fa fa-exclamation-triangle',success:'fa fa-check-circle',info:'fa fa-info-circle',ok:'fa fa-check-circle',question:'fa fa-question-circle'};options=_.defaults(options||{},_defaults);var init=function(){_buildAlert();_setUpEvents();},_setUpEvents,_clickButton,_remove,_buildAlert=function(){var parts={},buttons=[];if(options.showIcon){parts.icon=ips.templates.render('core.alert.icon',{icon:_icons[options.icon]||options.icon});}
parts.id='alert_'+(Math.round(Math.random()*10000000));parts.text=options.message;if(options.subText){parts.subtext=ips.templates.render('core.alert.subText',{text:options.subText});}
if(options.subTextHtml){parts.subtext=ips.templates.render('core.alert.subTextHtml',{text:options.subTextHtml});}
switch(options.type){case'alert':buttons.push(ips.templates.render('core.alert.button',{action:'ok',title:options.buttons.ok,extra:'ipsButton_primary'}));break;case'confirm':case'prompt':buttons.push(ips.templates.render('core.alert.button',{action:'ok',title:options.buttons.ok,extra:'ipsButton_primary'}));buttons.push(ips.templates.render('core.alert.button',{action:'cancel',title:options.buttons.cancel,extra:'ipsButton_light'}));break;case'verify':buttons.push(ips.templates.render('core.alert.button',{action:'yes',title:options.buttons.yes,extra:'ipsButton_primary'}));if(options.buttons.no){buttons.push(ips.templates.render('core.alert.button',{action:'no',title:options.buttons.no,extra:'ipsButton_light'}));}
if(options.buttons.cancel){buttons.push(ips.templates.render('core.alert.button',{action:'cancel',title:options.buttons.cancel,extra:'ipsButton_light'}));}
break;}
parts.buttons=buttons.join('');if(options.type=='prompt'){parts.text+=ips.templates.render('core.alert.prompt');}
var tmpAlert=$.parseHTML($.trim(ips.templates.render('core.alert.box',parts)));alert=$(tmpAlert[0]);$('body').append(alert);modal=ips.ui.getModal();modal.css({zIndex:ips.ui.zIndex()}).show();alert.css({zIndex:ips.ui.zIndex()});ips.utils.anim.go('zoomIn fast',alert);if(options.focus){alert.find('[data-action="'+options.focus+'"]').focus();}else{if(options.type=='prompt'){alert.find('[data-role="promptValue"]').val(options.value||'').focus();}else{alert.find('[data-action="ok"], [data-action="yes"]').focus();}}};init();};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.autoCheck');var autoCheckObj=function(elem,options){var init=function(){if(options.context&&$(options.context).length){elem.on('menuItemSelected',clickedMenu);$(options.context).on('change','input[type="checkbox"][data-state]',_updateCount);}
elem.on('refresh.autoCheck',refresh);elem.find('[data-role="autoCheckCount"]').hide();},destruct,refresh=function(){_updateCount();},clickedMenu,_updateCount=function(){var checkboxes=$(options.context).find(':checkbox[data-state]');var count=$(options.context).find(':checkbox[data-state]:checked');if(count.length==checkboxes.length&&checkboxes.length!==0){elem.find('.cAutoCheckIcon').html('<i class="fa fa-check-square"></i>');}else if(count.length===0){elem.find('.cAutoCheckIcon').html('<i class="fa fa-square-o"></i>');}else{elem.find('.cAutoCheckIcon').html('<i class="fa fa-minus-square"></i>');}
if(count.length){elem.find('[data-role="autoCheckCount"]').text(count.length).show();}else if(elem.find('[data-role="autoCheckCount"]').is(':visible')){ips.utils.anim.go('fadeOut',elem.find('[data-role="autoCheckCount"]'));}
return count.length;};init();return{destruct:destruct,refresh:refresh};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.autocomplete',function(){var defaults={multiValues:true,freeChoice:true,itemSep:{chr:',',keycode:188,charcode:44},disallowedCharacters:JSON.stringify(["<",">","'","\""]),unique:false,customValues:true,fieldTemplate:'core.autocomplete.field',resultsTemplate:'core.autocomplete.resultWrapper',resultItemTemplate:'core.autocomplete.resultItem',tokenTemplate:'core.autocomplete.token',addTokenTemplate:'core.autocomplete.addToken',addTokenText:ips.getString('add_tag'),queryParam:'q',forceLower:false,minLength:1,minAjaxLength:1,commaTrigger:true};var respond=function(elem,options){if(!$(elem).data('_autocomplete')){$(elem).data('_autocomplete',autocompleteObj(elem,_.defaults(options,defaults)));}},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){elem=$(elem);if(elem.data('_autocomplete')){return elem.data('_autocomplete');}else if($('[name="'+elem.attr('name')+'_original'+'"]').length&&$('[name="'+elem.attr('name')+'_original'+'"]').data('_autocomplete')){return $('[name="'+elem.attr('name')+'_original'+'"]').data('_autocomplete');}
return undefined;};ips.ui.registerWidget('autocomplete',ips.ui.autocomplete,['multiValues','freeChoice','dataSource','maxItems','itemSep','resultsElem','unique','commaTrigger','fieldTemplate','resultsTemplate','resultItemTemplate','tokenTemplate','addTokenTemplate','addTokenText','queryParam','minLength','maxLength','forceLower','disallowedCharacters','minAjaxLength']);return{respond:respond,destruct:destruct,getObj:getObj};});var autocompleteObj=function(elem,options,e){var timer,blurTimer,lastValue='',originalTextField,valueField,textField,dataSource,elemID=$(elem).identify().attr('id'),wrapper,inputItem,resultsElem,selectedToken,disabled=false,required=false,tooltip=null,tooltipTimer=null,mouseOverResults=false,hasError=false;var init=function(){if($(elem).is('textarea, input[type="text"], input[type="search"]')){originalTextField=$(elem);}else{originalTextField=$(elem).find('textarea, input[type="text"], input[type="search"]').first();}
try{options.disallowedCharacters=$.parseJSON(options.disallowedCharacters);}catch(err){Debug.error("Couldn't parse disallowed characters option");}
_buildWrapper();_getDataSource();originalTextField.removeAttr('list');if(dataSource.type!='none'){_buildResultsList();}
if(originalTextField.is(':disabled')){disabled=true;}
if(originalTextField.is('[required]')){required=true;originalTextField.removeProp('required').removeAttr('aria-required');}
textField.prop('autocomplete','off').prop('spellcheck',false).prop('disabled',disabled).attr('aria-autocomplete','list').attr('aria-haspopup','true').attr('tabindex',originalTextField.attr('tabindex')||'');if(options.maxLength){textField.attr('maxlength',options.maxLength+1);}
$(document).on('click',_documentClick);wrapper.click(function(e){e.stopPropagation();return false;});textField.on('focus',_focusField).on('blur',_blurField).on('keydown',_keydownField).on('keyup',_keyupField).on('keypress',_keypressField);wrapper.on('click',_clickWrapper).on('click','[data-action="addToken"]',_clickAddToken).on('keydown',_keydownWrapper).on('propChanged',_propChanged).toggleClass('ipsField_autocompleteDisabled',disabled);_buildInitialTokens();elem.on('blur').trigger('autoCompleteReady',{elemID:elemID,elem:elem,currentValues:tokens.getValues()});elem.on('reissueReady');},destruct=function(){$(document).off('click',_documentClick);},hasErrors=function(){return hasError;},_propChanged=function(e){disabled=originalTextField.is(':disabled');wrapper.toggleClass('ipsField_autocompleteDisabled',disabled);},_buildInitialTokens,_getOriginalValue=function(){return originalTextField.val();},_buildResultsList,_buildWrapper,_getDataSource,_clickWrapper,_clickAddToken,focus,_focusField=function(e){if(dataSource.type=='none'){return;}
timer=setInterval(_timerFocusField,400);},_blurField,_timerBlurField,_timerFocusField=function(){if(dataSource.type=='none'){return;}
var currentValue=_getCurrentValue();if(currentValue==lastValue){return;}
lastValue=currentValue;_loadResults(currentValue);},_loadResults=function(value){_toggleLoading('show');resultsElem.attr('aria-busy','true');dataSource.getResults(value).done(function(results){_showResults(_processResults(results,value));}).fail(function(){}).always(function(){resultsElem.attr('aria-busy','false');_toggleLoading('hide');});},_toggleLoading=function(doWhat){if(doWhat=='show'){wrapper.addClass('ipsField_loading');}else{wrapper.removeClass('ipsField_loading');}},_closeResults=function(e){if(e){e.preventDefault();}
if(resultsElem&&resultsElem.length){resultsElem.hide().attr('aria-expanded','false');}
dataSource.stop();},_documentClick=function(){_closeResults();},_processResults,_showResults=function(results){var output='';$.each(results,function(idx,value){output+=ips.templates.render(options.resultItemTemplate,value);});if(resultsElem.attr('id')==(elemID+'_results')){_positionResults();}
resultsElem.show().html(output).attr('aria-expanded','true');},_positionResults=function(){resultsElem.css({width:wrapper.outerWidth()+'px'});var positionInfo={trigger:wrapper,targetContainer:wrapper,target:resultsElem,center:false};var resultsPosition=ips.utils.position.positionElem(positionInfo);var resultsSize=ips.utils.position.getElemDims(resultsElem);$(resultsElem).css({left:(resultsPosition.left-(resultsSize.width / 2))+'px',top:resultsPosition.top+'px',position:(resultsPosition.fixed)?'fixed':'absolute',zIndex:ips.ui.zIndex()});},_getCurrentValue=function(){var value=textField.val();if(options.multiValues){if(value.indexOf(options.itemSep.chr)===-1||!options.commaTrigger){return $.trim(value);}else{var pieces=value.split(options.itemSep.chr);return $.trim(pieces[pieces.length-1]);}}else{return value;}},_keydownWrapper=function(e){if(e.which==ips.ui.key.ESCAPE){keyEvents.escape(e);}},_keydownField=function(e){_expandField();var ignoreKey=false;if(!_([ips.ui.key.UP,ips.ui.key.DOWN,ips.ui.key.LEFT,ips.ui.key.RIGHT,ips.ui.key.ENTER,ips.ui.key.TAB,ips.ui.key.BACKSPACE,ips.ui.key.ESCAPE]).contains(e.which)){ignoreKey=true;}
var value=$.trim(textField.val());if(!value.length){hasError=false;}
if(options.maxLength&&value.length==options.maxLength&&ignoreKey){e.preventDefault();return;}
if(_([ips.ui.key.ENTER,ips.ui.key.TAB]).contains(e.which)&&options.unique&&_duplicateValue(value)){e.preventDefault();_showTooltip(ips.getString('ac_dupes'));return;}
if(ignoreKey){return;}
switch(e.which){case ips.ui.key.BACKSPACE:keyEvents.backspace(e);break;case ips.ui.key.TAB:case ips.ui.key.ENTER:keyEvents.enter(e);break;case ips.ui.key.UP:keyEvents.up(e);break;case ips.ui.key.DOWN:keyEvents.down(e);break;case ips.ui.key.ESCAPE:keyEvents.escape(e);break;}},_keyupField,_keypressField,_addToken,_deleteToken=function(token){if(disabled){return;}
tokens.remove(token);},keyEvents={backspace,enter,up:function(e){if(!resultsElem||!resultsElem.is(':visible')){return;}
e.preventDefault();var selected=results.getCurrent();if(!selected){results.selectLast();}else{var prev=results.getPrevious(selected);if(prev){results.select(prev);}else{results.selectLast();}}},down:function(e){if(!resultsElem||!resultsElem.is(':visible')){return;}
e.preventDefault();var selected=results.getCurrent();if(!selected){results.selectFirst();}else{var next=results.getNext(selected);if(next){results.select(next);}else{results.selectFirst();}}},escape:function(e){if(resultsElem&&resultsElem.is(':visible')){_closeResults();}}},results={deselectAll:function(){resultsElem.find('[data-selected]').removeAttr('data-selected');},getCurrent:function(){if(dataSource.type=='none'){return;}
var cur=resultsElem.find('[data-selected]');if(cur.length&&resultsElem.is(':visible')){return cur;}
return false;},getPrevious:function(result){var prev=$(result).prev('[data-value]');if(prev.length){return prev;}
return false;},getNext:function(result){var next=$(result).next('[data-value]');if(next.length){return next;}
return false;},selectFirst:function(){results.select(resultsElem.find('[data-value]').first());},selectLast:function(){results.select(resultsElem.find('[data-value]').last());},select:function(result){results.deselectAll();result.attr('data-selected',true);}},tokens={selected:null,add:function(value){var html='';value=$.trim(_.escape(value));if(options.minLength&&value.length<options.minLength){return false;}
if(options.maxLength&&value.length>options.maxLength){return false;}
if(options.forceLower){value=value.toLowerCase();}
tokens.deselectAll();inputItem.before(ips.templates.render(options.tokenTemplate,{id:elemID,value:value,title:value}));if(resultsElem){_closeResults();}
valueField.val(tokens.getValues().join("\n"));if(dataSource.type!='none'){html=resultsElem.find('[data-value="'+value.replace("\\","\\\\")+'"]').html();}else{html=value;}
elem.trigger('tokenAdded',{token:value,html:html,tokenList:tokens.getValues(),totalTokens:tokens.total()});return true;},remove,removeAll,select,total,getValues,getSelected,deselectAll},_addTokenFromCurrentInput,_duplicateValue=function(value){var values=tokens.getValues();if(values.indexOf(value)!==-1){return true;}
return false;},_stripHTML=function(text){return text.replace(/<|>|"|'/g,'');},_showTooltip,_hideTooltip,_positionTooltip,_buildTooltip=function(){var tooltipHTML=ips.templates.render('core.tooltip',{id:'elAutoCompleteTooltip'});ips.getContainer().append(tooltipHTML);tooltip=$('#elAutoCompleteTooltip');},_expandField=function(){var text=textField.val();var widthOfElem=wrapper.width();widthOfElem-=(parseInt(wrapper.css('padding-left'))+parseInt(wrapper.css('padding-right')));var span=$('<span/>').text(text).css({'font-size':textField.css('font-size'),'letter-spacing':textField.css('letter-spacing'),'position':'absolute','top':'-100px','left':'-300px','opacity':0.1});ips.getContainer().append(span);var width=span.width()+20;span.remove();textField.css({width:((width>=widthOfElem)?widthOfElem:width)+'px'});},_resetField=function(){textField.css({width:'15px'});};init();return{init:init,destruct:destruct,hasErrors:hasErrors,addToken:tokens.add,getTokens:tokens.getValues,removeToken:tokens.remove,removeAll:tokens.removeAll,focus:focus};};var localData;var remoteData;var noData=function(){return{type:'none',getResults:$.noop,totalItems:-1,stop:$.noop};};}(jQuery,_));;;;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.carousel',function(){var defaults={item:".ipsCarousel_item",shadows:true};var respond=function(elem,options){if(!$(elem).data('_carousel')){$(elem).data('_carousel',carouselObj(elem,_.defaults(options,defaults)));}},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){if($(elem).data('_carousel')){return $(elem).data('_carousel');}
return undefined;};var carouselObj=function(elem,options){var rtlMode=($('html').attr('dir')=='rtl');var currentItemCount=0;var currentLeftPos=0;var currentFirstItem=null;var ui={};var slideshowTimer=null;var slideshowTimeout=4000;var animating=false;var init=function(){currentItemCount=elem.find(options.item);ui={itemList:elem.find('[data-role="carouselItems"]'),next:elem.find('[data-action="next"]'),prev:elem.find('[data-action="prev"]'),nextShadow:elem.find('.ipsCarousel_shadowRight'),prevShadow:elem.find('.ipsCarousel_shadowLeft')};if(!options.shadows){ui.nextShadow.hide();ui.prevShadow.hide();}
var leftPos=parseInt(ui.itemList.css('left'));if(!_.isNaN(leftPos)){currentLeftPos=leftPos;}
_build();var images=elem.find('img[src]').length;elem.find('img[src]').load);_checkNav();elem.on('click',"[data-action='next']",_navNext);elem.on('click',"[data-action='prev']",_navPrev);elem.on('contentTruncated',_updateHeight);elem.on('gridRedraw.grid',_updateHeight);var mc=new Hammer(elem[0]);mc.on('panleft',function(e){if(!animating){if(rtlMode){_navPrev();}else{_navNext();}}});mc.on('panright');if(options.slideshow){slideshowTimer=setTimeout(_slideshowNext,slideshowTimeout);elem.on('mouseenter',function(){clearTimeout(slideshowTimer);}).on('mouseleave');}
$(window).on('resize',_resize);},destruct,_build,_updateHeight,_slideshowNext,_navNext=function(e){if(e){e.preventDefault();}
var items=elem.find(options.item);var wrapperWidth=elem.outerWidth();var listWidth=_getCurrentWidth();var stayOnScreen=currentLeftPos+wrapperWidth;var forceNext=false;var deferred=$.Deferred();var nextFirst=_.find(items,function(item,idx){var edge=$(item).position().left;var width=$(item).outerWidth();var margin=(rtlMode)?parseInt($(item).css('marginLeft')):parseInt($(item).css('marginRight'));if(rtlMode){edge=ui.itemList.outerWidth()-(edge+width)-margin;}
if(forceNext){return true;}
if(edge<currentLeftPos){return false;}
var otherEdge=edge+width;if(stayOnScreen<=(otherEdge+margin)){forceNext=true;return false;}
if(rtlMode){if(edge>stayOnScreen&&otherEdge<stayOnScreen){return true;}}else if(edge<stayOnScreen&&otherEdge>stayOnScreen){return true;}
return false;});var nextFirst=$(nextFirst);if(!nextFirst.length){deferred.resolve();return deferred.promise();}
var nextFirstPos=nextFirst.position().left;var nextFirstMargin=(rtlMode)?parseInt($(nextFirst).css('marginLeft')):parseInt($(nextFirst).css('marginRight'));if(rtlMode){nextFirstPos=ui.itemList.outerWidth()-(nextFirstPos+nextFirst.outerWidth())-nextFirstMargin;}
if((listWidth-nextFirstPos)<wrapperWidth){nextFirstPos=listWidth-wrapperWidth;}
currentLeftPos=nextFirstPos;animating=true;ui.itemList.animate((rtlMode)?{right:(nextFirstPos*-1)+'px'}:{left:(nextFirstPos*-1)+'px'},'slow',function(){_checkNav();animating=false;deferred.resolve();});return deferred.promise();},_navPrev=function(e,backToBeginning){if(e){e.preventDefault();}
var items=elem.find(options.item).toArray();var wrapperWidth=elem.find('.ipsCarousel_inner').outerWidth();var listWidth=_getCurrentWidth();var stayOnScreen=currentLeftPos+wrapperWidth;var forcePrev=false;var deferred=$.Deferred();var idealLeft=(currentLeftPos*-1)+wrapperWidth;if(idealLeft>=0||backToBeginning){currentLeftPos=0;animating=true;ui.itemList.animate((rtlMode)?{right:'0px'}:{left:'0px'},'slow');deferred.resolve();return deferred.promise();}
items.reverse();idealLeft=(idealLeft*-1)+wrapperWidth;var prevFirst=_.find(items,function(item){var edge=$(item).position().left;var width=$(item).outerWidth();var otherEdge=edge+width;var margin=(rtlMode)?parseInt($(item).css('marginLeft')):parseInt($(item).css('marginRight'));if(rtlMode){edge=ui.itemList.outerWidth()-(otherEdge);}
if(forcePrev){return true;}
if(edge>idealLeft){return false;}
if(stayOnScreen<=(otherEdge+margin)){forcePrev=true;return false;}
if(otherEdge>idealLeft&&edge<=idealLeft){return true;}
return false;});prevFirst=$(prevFirst);if(!ips.utils.responsive.currentIs('phone')&&!options.fullSizeItems){prevFirst=$(prevFirst).next(options.item);}
currentFirstItem=prevFirst;if(prevFirst.position()!=null){currentLeftPos=prevFirst.position().left+prevFirst.outerWidth()-wrapperWidth;if(rtlMode){var prevFirstMargin=(rtlMode)?parseInt($(prevFirst).css('marginLeft')):parseInt($(prevFirst).css('marginRight'));currentLeftPos=ui.itemList.outerWidth()-(prevFirst.position().left)-prevFirstMargin-wrapperWidth;}}else{currentLeftPos=prevFirst.outerWidth()+wrapperWidth;}
animating=true;ui.itemList.animate((rtlMode)?{right:(currentLeftPos*-1)+'px'}:{left:(currentLeftPos*-1)+'px'},'slow');return deferred.promise();},_getMaxHeight,_checkNav,_getCurrentWidth,_buildNav=function(){elem.find('.ipsCarousel_nav').removeClass('ipsHide');},_resize=function(){if(options.fullSizeItems){var elemWidth=elem.find('.ipsCarousel_inner').outerWidth(true);elem.find(options.item).each);}};init();return{destruct:destruct};};ips.ui.registerWidget('carousel',ips.ui.carousel,['showDots','fullSizeItems','slideshow','shadows']);return{respond:respond,destruct:destruct};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.chart',function(){var defaults={};var respond=function(elem,options){var doInit;try{doInit();}catch(err){ips.loader.get(['https://www.google.com/jsapi']).then(function(){google.load('visualization','1.0',{'packages':['corechart','gauge','table'],'callback':doInit});});}},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){if($(elem).data('_chart')){return $(elem).data('_chart');}
return undefined;};var chartObj=function(elem,options){var data=new google.visualization.DataTable();var headerTypes={};var extraOptions={};var chartElem=$(elem).next();var chart=null;var init=function(){elem.find('thead th').each);elem.find('tbody tr').each(function(){var row=[];$(this).find('td').each(function(idx){if(headerTypes[idx]=='number'){var val;if(val=$(this).text()){val=Number(val);}else{val=null;}}else if(headerTypes[idx]=='date'||headerTypes[idx]=='datetime'||headerTypes[idx]=='timeofday'){var val=new Date($(this).text());}else{var val=$(this).text();}
if(!_.isNaN(val)){row.push(val);}});data.addRow(row);});if(options.format){var formatter=new google.visualization.NumberFormat({pattern:'# '+options.format});formatter.format(data,1);}
extraOptions=$.parseJSON(options.extraOptions);if(!_.isUndefined(extraOptions.height)){chartElem.css({height:extraOptions.height+'px'});}else{chartElem.css({minHeight:'250px'});}
elem.hide().after(chartElem);$(window).on('resize',drawChart);drawChart();google.visualization.events.addListener(chart,'ready');$(document).on('tabShown',tabShown);},drawChart,destruct=function(){$(window).off('resize',drawChart);$(document).off('tabShown',tabShown);},tabShown=function(e,data){if($.contains(data.panel.get(0),elem.get(0))){drawChart();}};if(_.isUndefined(google.visualization)){google.setOnLoadCallback(init);}else{init();}
return{init:init,drawChart:drawChart};};ips.ui.registerWidget('chart',ips.ui.chart,['type','extraOptions','format']);return{respond:respond,destruct:destruct,getObj:getObj};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.contentItem');var contentItemObj=function(elem,options,e){var timer,blurTimer,lastValue='',originalTextField,valueField,hiddenValueField,itemListWrapper,textField,dataSource,elemID=$(elem).identify().attr('id'),wrapper,inputItem,resultsElem,disabled=false,required=false,tooltip=null,tooltipTimer=null;var init,destruct=function(){$(document).off('click',_documentClick);},_propChanged,_buildResultsList,_buildWrapper,_getDataSource,_clickWrapper,_focusField,_blurField,_timerBlurField=function(){_closeResults();},_timerFocusField,_loadResults,_toggleLoading,_closeResults,_documentClick=function(){_closeResults();},_processResults,_showResults,_positionResults,_getCurrentValue,_keydownWrapper,_keydownField=function(e){_expandField();var ignoreKey=false;if(!_([ips.ui.key.UP,ips.ui.key.DOWN,ips.ui.key.ESCAPE,ips.ui.key.ENTER]).contains(e.keyCode)){ignoreKey=true;}
var value=$.trim(textField.val());if(ignoreKey){return;}
switch(e.keyCode){case ips.ui.key.UP:keyEvents.up(e);break;case ips.ui.key.DOWN:keyEvents.down(e);break;case ips.ui.key.ESCAPE:keyEvents.escape(e);break;case ips.ui.key.ENTER:keyEvents.enter(e);break;}},_addContentItem,_deleteContentItem,keyEvents={up:function(e){if(!resultsElem||!resultsElem.is(':visible')){return;}
e.preventDefault();var selected=results.getCurrent();if(!selected){results.selectLast();}else{var prev=results.getPrevious(selected);if(prev){results.select(prev);}else{results.selectLast();}}},down,enter,escape},results={deselectAll,getCurrent,getPrevious:function(result){var prev=$(result).prev('[data-id]');if(prev.length){return prev;}
return false;},getNext,selectFirst:function(){results.select(resultsElem.find('[data-id]').first());},selectLast,select},contentItems={selected:null,add,remove,total,getValues},_duplicateValue,_expandField,_resetField;init();return{init:init,destruct:destruct,addContentItem:contentItems.add,getContentItem:contentItems.getValues,removeContentItem:contentItems.remove};};var remoteData;var noData;}(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.drawer');var drawerObj=function(elem,options){var modal,drawerElem,drawerContent;var init=function(){modal=ips.ui.getModal().addClass('ipsDrawer_modal');drawerElem=$(options.drawerElem),drawerContent=drawerElem.find('.ipsDrawer_menu');drawerElem.on('click','[data-action="close"]',function(){hide();});drawerElem.on('click');drawerElem.on('click','.ipsDrawer_itemParent > h4',_showSubMenu).on('click','[data-action="back"]',_subMenuBack).find('.ipsDrawer_itemParent > ul').addClass('ipsDrawer_subMenu').hide();},_showSubMenu=function(e){e.preventDefault();var item=$(e.currentTarget);item.parents('.ipsDrawer_list').animate(($('html').attr('dir')==='rtl')?{marginRight:'-100%'}:{marginLeft:'-100%'}).end().siblings('.ipsDrawer_list').show();},_subMenuBack,show,hide;init();return{init:init,show:show,hide:hide};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.editor',function(){var defaults={allbuttons:false,postKey:'',toolbars:'',extraPlugins:'',contentsCss:'',minimized:false,autoSaveKey:null,skin:'ips',autoGrow:true,pasteBehaviour:'rich',autoEmbed:true,controller:null,defaultIfNoAutoSave:false};var respond=function(elem,options){var loadTries=0;var fileToLoad=ips.getSetting('useCompiledFiles')!==true?'core/dev/ckeditor/ckeditor.js':'core/interface/ckeditor/ckeditor/ckeditor.js';if(!options.minimized||ips.getSetting('memberID')){ips.loader.get([fileToLoad]).then(bootEditor);}else{options.minimized=false;$(elem).data('_editorInit',function(callback){$(elem).find('.ipsComposeArea_dummy').html(ips.templates.render('core.editor.initLoading'));ips.loader.get([fileToLoad]).then(function(){$(elem).find('.ipsComposeArea_dummy').hide().end().find('[data-role="mainEditorArea"]').show().end().closest('.ipsComposeArea').removeClass('ipsComposeArea_minimized').find('[data-ipsEditor-toolList]').show();bootEditor(callback);});});$(elem).find('.ipsComposeArea_dummy').show().on('focus',function(){$(elem).data('_editorInit')(function(instance){var inputs=elem.closest('.ipsComposeArea').find('input[type="text"], input[type="email"]');if(inputs.length){inputs[0].focus();}
else{instance.focus();}})}).end().find('[data-role="mainEditorArea"]').hide().end().closest('.ipsComposeArea').addClass('ipsComposeArea_minimized').find('[data-ipsEditor-toolList]').hide();};},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){if($(elem).data('_editor')){return $(elem).data('_editor');}
return undefined;},getObjWithInit;ips.ui.registerWidget('editor',ips.ui.editor,['allbuttons','postKey','toolbars','extraPlugins','autoGrow','contentsCss','minimized','autoSaveKey','skin','name','pasteBehaviour','autoEmbed','controller','defaultIfNoAutoSave','ipsPlugins']);return{respond:respond,getObj:getObj,getObjWithInit:getObjWithInit,destruct:destruct};});var editorObj=function(elem,options){var changePolled=false;var instance=null;var hiddenAtStart=false;var minimized=options.minimized;var hiddenInterval=null;var size='phone';var name='';var previewIframe=null;var currentPreviewView='';var previewInitialHeight=0;var previewSizes={phone:375,tablet:780};var init=function(callback){var config={allowedContent:true,contentsLangDirection:$('html').attr('dir'),disableNativeSpellChecker:false,extraPlugins:options.ipsPlugins,ipsAutoSaveKey:options.autoSaveKey,ipsDefaultIfNoAutoSave:options.defaultIfNoAutoSave,ipsPasteBehaviour:options.pasteBehaviour,ipsAutoEmbed:options.autoEmbed,removeButtons:'',skin:options.skin,height:'auto',title:window.navigator.platform=='MacIntel'?ips.getString('editorRightClickMac'):ips.getString('editorRightClick'),controller:options.controller};if(options.pasteBehaviour=='force'){config.pasteFilter='plain-text';}
else{if(CKEDITOR.env.webkit){var tags=[];for(var tag in CKEDITOR.dtd){if(tag.charAt(0)!='$'){tags.push(tag);}}
config.pasteFilter=tags.join(' ')+'[*]{background-color,border*,color,padding,text-align,vertical-align,font-size}';}
else{config.pasteFilter=null;}}
if(!/iPad|iPhone|iPod/.test(navigator.platform)){config.removePlugins='elementspath';}
if(ips.getSetting('ipb_url_filter_option')=='none'&&ips.getSetting('url_filter_any_action')=='moderate'&&ips.getSetting('bypass_profanity')==0){config.removePlugins='ipslink';}
name=$(elem).find('textarea').attr('name');$(elem).trigger('editorCompatibility',{compatible:CKEDITOR.env.isCompatible});if(options.minimized&&minimized){$(elem).find('.ipsComposeArea_dummy').show().on('focus click').end().find('[data-role="mainEditorArea"]').hide().end().closest('.ipsComposeArea').addClass('ipsComposeArea_minimized').find('[data-ipsEditor-toolList]').hide();$(document).on('initializeEditor',_initializeEditor);minimized=true;}
if(!elem.is(':visible')){hiddenAtStart=true;if(!options.minimized&&!minimized){clearInterval(hiddenInterval);hiddenInterval=setInterval,400);}}
var language=$('html').attr('lang').toLowerCase();if(!CKEDITOR.lang.languages[language]){var language=language.substr(0,2);if(CKEDITOR.lang.languages[language]){config.language=language;}}else{config.language=language;}
if(!options.allbuttons){var toolbars=$.parseJSON(options.toolbars);var width=elem.width();if(width>700){size='desktop';}else if(width>400){size='tablet';}
config.toolbar=toolbars[size];}else{config.removePlugins='sourcearea';}
if(options.extraPlugins!==true){config.extraPlugins+=','+options.extraPlugins;}
instance=CKEDITOR.replace($(elem).find('textarea').get(0),config);instance.once('instanceReady',function(){$(instance.container.$).find('div.cke_wysiwyg_div').attr('data-gramm','false');elem.trigger('editorWidgetInitialized',{id:name});ips.utils.lazyLoad.loadContent(elem);if(_.isFunction(callback)){callback(this);}}.bind(this));instance.on('afterInsertHtml');if(!options.allbuttons){$(window).on('resize',resize);}
$(document).on('fileDeleted',_deleteFile);$(document).on('insertEmoji',_insertEmoji);$(elem).on('togglePreview',_togglePreview);$(window).on('message',_previewMessage);_cleanUpStaleAutoSaves();};var _cleanUpStaleAutoSaves;var destruct=function(){try{instance.fire('resetOrDestroy');instance.removeAllListeners();CKEDITOR.remove(instance);_offEvents();Debug.log("Destroyed editor instance");}catch(err){Debug.error("Editor destruct error:");Debug.error(err);}};var getInstance;var _offEvents;var resize;var focus=function(){instance.focus();};var unminimize=function(callback){if(!_.isFunction(callback)){callback=$.noop;}
if(minimized){var _unminimize=function(){$(elem).find('.ipsComposeArea_dummy').hide().end().find('[data-role="mainEditorArea"]').show().end().closest('.ipsComposeArea').removeClass('ipsComposeArea_minimized').find('[data-ipsEditor-toolList]').show();if(instance.status=='ready'){minimized=false;callback();if(hiddenAtStart){resize(true);hiddenAtStart=false;}
instance.on('change',function(e){if(!changePolled){changePolled=true;ips.getAjax()(elem.parentsUntil('','form').attr('action'),{'data':{'usingEditor':1}});}});}else{instance.once('instanceReady');}
var minimizedUploader=$(elem).find('[data-ipsEditor-toolListMinimized]');if(minimizedUploader.length){minimizedUploader.show();ips.getAjax()(elem.parentsUntil('','form').attr('action'),{'data':{'getUploader':minimizedUploader.attr('data-name')}}).done);}};if(!/iPad|iPhone|iPod/.test(navigator.platform)){setTimeout(function(){_unminimize();},200);}else{_unminimize();}}else{callback();}};var insertQuotes;var updateImage;var checkDirty=function(){return instance.checkDirty();};var resetDirty=function(){return instance.resetDirty();};var insertHtml;var reset=function(){instance.fire('resetOrDestroy');instance.setData('<p></p>');_closePreview();elem.find('[data-ipsUploader]').trigger('resetUploader');};var saveAndClearAutosave;var _belongsToThisEditor;var _initializeEditor;var _deleteFile;var _scrollToEditor;var _insertEmoji;var _togglePreview;var _showPreview;var _buildAndShowPreview;var _showPreviewButtons;var _resizePreview;var _previewMessage;var _fetchPreview;var _closePreview;var _setPreviewHeight;var _sendMessage;return{init:init,focus:focus,unminimize:unminimize,insertQuotes:insertQuotes,insertHtml:insertHtml,checkDirty:checkDirty,resetDirty:resetDirty,updateImage:updateImage,reset:reset,destruct:destruct,saveAndClearAutosave:saveAndClearAutosave,getInstance:getInstance};};}(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.flashMsg',function(){var _queue=[],_doneInit=false,_box,_content,_isShowing=false,_currentDismissHandler=null;var defaults={timeout:2,extraClasses:'',location:'top',sticky:false,escape:true};var respond,init,show=function(message,options,update){if(!_doneInit){_initElement();}
options=_.defaults(options||{},defaults);if(options.escape){message=_.escape(message);}
if(_isShowing&&!update){_queue.push([message,options]);return;}
if(update&&_isShowing){_content.html(message);ips.utils.anim.go('pulseOnce',_box);if(!options.sticky){setTimeout(hide,options.timeout*1000);}
return;}
_currentDismissHandler=null;_isShowing=true;_content.html(message);_box.css({zIndex:ips.ui.zIndex()}).attr('class','').addClass(options.extraClasses).addClass(options.dismissable?'ipsFlashMsg_dismissable':'').addClass(options.position=='bottom'?'ipsFlashMsg_bottom':'ipsFlashMsg_top').on('click','a:not( [data-action="dismissFlashMessage"] )',function(){hide();}).animationComplete);if(_.isFunction(options.dismissable)){_currentDismissHandler=options.dismissable;}
ips.utils.anim.go('fadeInDown',_box);},hide,dismiss,_initElement;ips.ui.registerWidget('flashMsg',ips.ui.flashMsg,['text','extraClasses','timeout','position','sticky','dismissable']);init();return{respond:respond,show:show};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.form',function(){var _cmInstances={};var _support={};var formTypes={'unlimited':'[data-control~="unlimited"]','selectDisable':'[data-control~="selectDisable"]','date':'input[type="date"], [data-control~="date"]','range':'input[type="range"], [data-control~="range"]','color':'input[type="color"], [data-control~="color"]','dimensions':'[data-control~="dimensions"]','dimensionsUnlimited':'[data-control~="dimensionsUnlimited"]','jsDisable':'input[data-control~="jsdisable"]','toggle':'[data-control~="toggle"]','codemirror':'[data-control~="codemirror"]','granularCheckboxset':'[data-control~="granularCheckboxset"]','diallingCode':'[data-control="diallingCode"]'};var init=function(){$(document).on('contentChange',function(e,data){if($(data[0]).closest('[data-ipsForm]').length){respond($(data[0]));}});$(document).on('menuOpened');$(document).on('codeMirrorInsert');$(document).on('tabChanged');},respond;var localeSort;var _controlMethods={codemirror,range,unlimited:function(elem){elem.on('change',function(){_unlimitedCheck(elem);});_unlimitedCheck(elem);},selectDisable:function(elem){elem.on('change',function(){_selectDisable(elem);});_selectDisable(elem);},date,color:function(elem){if(elem.attr('data-ipsFormData')){return;}
elem.addClass('color');elem.attr('data-ipsFormData',1);ips.loader.get(['core/interface/jscolor/jscolor.js']).then(function(){jscolor.dir=ips.getSetting('baseURL')+'applications/core/interface/jscolor/';new jscolor.color(elem.get(0),{required:false});if(elem.is(':focus')){elem.blur();}});},toggle,dimensions,dimensionsUnlimited,jsDisable,granularCheckboxset:function(elem){elem.find('[data-role="checkboxsetUnlimitedToggle"]').on('change');elem.find('[data-action="checkboxsetCustomize"]').on('click',function(){elem.find('[data-role="checkboxsetUnlimited"]').hide();elem.find('[data-role="checkboxsetUnlimitedToggle"]').prop('checked',false);elem.find('[data-role="checkboxsetGranular"]').slideDown();});elem.find('[data-action="checkboxsetAll"]').on('click',function(){elem.find('[data-role="checkboxsetGranular"] input:enabled[type="checkbox"]').prop('checked',true);elem.find('[data-role="checkboxsetUnlimited"]').slideDown();elem.find('[data-role="checkboxsetGranular"]').slideUp();elem.find('[data-role="checkboxsetUnlimitedToggle"]').prop('checked',true).change();});elem.find('[data-action="checkboxsetNone"]').on('click',function(){elem.find('[data-role="checkboxsetGranular"] input[type="checkbox"]').prop('checked',false);elem.find('[data-role="checkboxsetUnlimited"]').slideDown();elem.find('[data-role="checkboxsetGranular"]').slideUp();elem.find('[data-role="checkboxsetUnlimitedToggle"]').prop('checked',false).change();});},diallingCode},_toggler,_dimensionsUnlimitedCheck,_toggleRadio,_toggleSelect,_toggleCheckbox=function(elem,toggleList,thisElem,form,reverse){var show=elem.is(':checked');if(reverse){show=!show;}
if(show){_showFormRows(toggleList,form);}else{_hideFormRows(toggleList,form);}},_toggleNode,_toggleGeneric,_hideFormRows,_showFormRows=function(show,form){if(_.isArray(show)){show=show.join(',');}
$(form||document).find(show).not('[data-ipsToggle]').show().end().removeClass('ipsHide').find('[data-toggles],[data-togglesOn]').each).end().find('[data-ipsUploader]').each)},_selectDisable,_unlimitedCheck,_validationError;ips.ui.registerWidget('form',ips.ui.form);return{respond:respond,init:init};});}(jQuery,_));;
;(jQuery,_));;
;(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.infiniteScroll',function(){var defaults={distance:50,loadingTpl:'core.infScroll.loading',scrollScope:'body',pageParam:'page',pageBreakTpl:'core.infScroll.pageBreak',totalPages:null,disableIn:'phone'};var respond=function(elem,options){if(!$(elem).data('_infinite')){$(elem).data('_infinite',infiniteScrollObj(elem,_.defaults(options,defaults)));}},getObj=function(elem){if($(elem).data('_infinite')){return $(elem).data('_infinite');}
return undefined;};ips.ui.registerWidget('infScroll',ips.ui.infiniteScroll,['container','scrollScope','distance','url','pageParam','loadingTpl','pageBreakTpl','disableIn']);var infiniteScrollObj=function(elem,options){var state='ready',scrollScope=null,container=null,ajaxObj=null,currentPage=1;var init,_refresh,_scrollEvent,_loadMoreResults,_insertNewResults,_showLoadingElem,_removeLoadingElem,_getDistance=function(){if(options.scrollScope=='body'){var scrollHeight=$(document).height();var distanceFromBottom=scrollHeight-$(window).height()-$(window).scrollTop();}else{var scrollHeight=scrollScope[0].scrollHeight;var distanceFromBottom=scrollHeight-scrollScope.height()-scrollScope.scrollTop();}
return distanceFromBottom;},_getPageURL=function(pageNo){return elem.attr('data-ipsInfScroll-url')+'&'+options.pageParam+'='+parseInt(pageNo);},_getStartPage,_getTotalPages;init();return{init:init};};return{respond:respond};});}(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.lightbox');var lightboxObj=function(elem,options,e){if(e){e.preventDefault();}
var imageCollection=[],commentsAjax,modal,pieces,currentImage,phoneBreakpoint=false;var init,destruct,_setUpEvents=function(){pieces.lightbox.on('click','.'+options.className+'_next',nextImage).on('click','.'+options.className+'_prev',prevImage).on('click','.'+options.className+'_close',close).on('click',clickedLightbox);modal.on('click',close);$(window).on('resize',_resize);$(document).on('keydown',_keyPress);$(document).on('imageUpdated',_updateImage);$(document).on('imageLoading',_mainImageLoading);if(options.useEvents){$(document).on('lightboxDisable_next',function(){$('.'+options.className+'_next').hide();});$(document).on('lightboxDisable_prev',function(){$('.'+options.className+'_prev').hide();});$(document).on('lightboxEnable_next',function(){$('.'+options.className+'_next').show();});$(document).on('lightboxEnable_prev',function(){$('.'+options.className+'_prev').show();});}},_mainImageLoading,_updateImage,_resize,_keyPress,_loadFirstImage,_showImage=function(image){_setLoading(true);pieces.imagePanel.find('.'+options.className+'_image ').hide();if(image.imageElem){pieces.imagePanel.find('.'+options.className+'_image ').hide()
var thisImage=image.imageElem.css({opacity:0}).show();_imageLoaded(thisImage);}else{var thisImage=image.imageElem=$('<img/>').attr('src',image.largeImage).addClass(options.className+'_image').css({opacity:0}).imagesLoaded);pieces.imagePanel.find('.'+options.className+'_image ').hide().end().append(thisImage);}
pieces.fullSize.attr('href',image.largeImage);if(image.commentsURL){_loadComments(image);}else{_hideCommentsPanel();}
if(image.meta){pieces.metaPanel.show().html(ips.templates.render('core.lightbox.meta',{title:image.largeImage}));}else{pieces.metaPanel.hide();}
$(elem).trigger('lightboxImageShown',{image:image,triggerElem:elem});},_loadComments,_hideCommentsPanel,_setLoading,_imageLoaded=function(image){image.css({opacity:1});_positionCenter(image);_setLoading(false);if(options.useEvents){return;}
if(imageCollection.length<2){pieces.next.hide();pieces.prev.hide();}else{var curPos=_.indexOf(imageCollection,currentImage);pieces.next.show();pieces.prev.show();if(curPos==0){pieces.prev.hide();}
if(curPos==(imageCollection.length-1)){pieces.next.hide();}}},_positionCenter,clickedLightbox,nextImage=function(e){e.preventDefault();e.stopPropagation();if(options.useEvents){$(document).trigger('lightboxNextImage');return;}
currentImage=_getNextImage();_showImage(currentImage);},prevImage,_getPrevImage,_getNextImage,close,_show,_buildWrapper=function(){pieces={lightbox:$('<div/>').addClass(options.className).css({zIndex:ips.ui.zIndex()}),imagePanel:$('<div/>').addClass(options.className+'_imagePanel'),commentsPanel:$('<div/>').addClass(options.className+'_commentsPanel').html('').hide(),next:$('<a/>').addClass(options.className+'_next').html("<i class='fa fa-angle-right'></i>"),prev:$('<a/>').addClass(options.className+'_prev').html("<i class='fa fa-angle-left'></i>"),close:$('<a/>').addClass(options.className+'_close').html("&times;"),fullSize:$('<a/>').attr('href','#').attr('target','_blank').addClass(options.className+'_fullSize'),metaPanel:$('<div/>').addClass(options.className+'_meta').hide()};pieces.lightbox.append(pieces.imagePanel.append(pieces.next).append(pieces.prev).append(pieces.fullSize)).append(pieces.metaPanel).append(pieces.commentsPanel).append(pieces.close);$('body').append(pieces.lightbox);},_getAllImages,_returnImageData,_buildModal=function(){modal=ips.ui.getModal();modal.css({zIndex:ips.ui.zIndex()});};init();return{destruct:destruct};};}(jQuery,_));;
;(function($,_,undefined){ips.createModule('ips.ui.map',function(){var defaults={zoom:2,markers:'[]',contentUrl:null};var respond;var _mapbox=function(elem,options){$('head').append("<link rel='stylesheet' type='text/css' media='all' href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css'><link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v1.0.0/MarkerCluster.css' rel='stylesheet' /><link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v1.0.0/MarkerCluster.Default.css' rel='stylesheet' />");var handlePopup;ips.loader.get(['https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js']).then(function(){ips.loader.get(['https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v1.0.0/leaflet.markercluster.js']).then(function(){L.mapbox.accessToken=ips.getSetting('mapApiKey');var map=L.mapbox.map(elem.get(0),'mapbox.streets').setView([45,0],options.zoom);var cluster=new L.MarkerClusterGroup();map.addLayer(cluster);var markers=$.parseJSON(options.markers);for(var id in markers){var marker=L.marker([markers[id].lat,markers[id].long],{icon:L.mapbox.marker.icon({'marker-color':'#0000ff'}),clubID:id,title:markers[id].title,draggable:false}).addTo(map);cluster.addLayer(marker);if(options.contentUrl){marker.bindPopup(ips.getString('loading'));marker.on('click',handlePopup);}}});});};var _google=function(elem,options){if(typeof google==='undefined'||typeof google.maps==='undefined'){ips.loader.get(['https://maps.googleapis.com/maps/api/js?key='+ips.getSetting('mapApiKey')+'&libraries=places&sensor=false&callback=ips.ui.map.googleCallback']);}else{ips.ui.map.googleCallback();}
$(window).on('googleApiLoaded',function(){var mapOptions={zoom:options.zoom,scrollwheel:false};if(options.zoom){mapOptions.center={lat:45,lng:0};}else{mapOptions.center={lat:30,lng:0};}
var map=new google.maps.Map(elem.get(0),mapOptions);var infowindow=new google.maps.InfoWindow({content:ips.getString('loading')});var markers=$.parseJSON(options.markers);for(var id in markers){var marker=new google.maps.Marker({position:{lat:markers[id].lat,lng:markers[id].long},map:map,title:markers[id].title,id:id});if(options.contentUrl){marker.addListener('click');}}});};var googleCallback=function(){$(window).trigger('googleApiLoaded');};ips.ui.registerWidget('map',ips.ui.map,['zoom','markers','contentUrl']);return{respond:respond,googleCallback:googleCallback};});}(jQuery,_));;
;(function($,_,undefined){ips.createModule('ips.ui.menu',function(){var defaults={className:'ipsMenu',activeClass:'',closeOnClick:true,closeOnBlur:true,selectable:false,withStem:true,stemOffset:25,stopLinks:false,above:'auto'};var stems=['topLeft','topRight','topCenter','bottomLeft','bottomRight','bottomCenter'];if(!defaults.withStem){defaults.stemOffset=0;}
var _menuRegistry={};var respond,_showMenu,_showSubMenu=function(elem,elemID,options,menu,e){var menuItem=$(e.currentTarget).find('> a');var subMenu=menuItem.next('.ipsMenu');$(e.currentTarget).on('mouseleave',_.bind(_hideSubMenu,this,elem,elemID,options,menu));var itemPosition=ips.utils.position.getElemPosition(menuItem);var itemSize=ips.utils.position.getElemDims(menuItem);var subMenuSize=ips.utils.position.getElemDims(subMenu);if($('html').attr('dir')=='rtl'){var right=(itemSize.outerWidth-5);if((itemPosition.viewportOffset.right+itemSize.outerWidth+subMenuSize.outerWidth-5)>$(window).width()){if((itemPosition.viewportOffset.right+5-subMenuSize.outerWidth)>=0){right=((subMenuSize.outerWidth*-1)+5);}}
subMenu.css({left:right+'px',top:(menuItem.position()['top']-5)+'px'}).show();}else{var left=(itemSize.outerWidth-5);if((itemPosition.viewportOffset.left+itemSize.outerWidth+subMenuSize.outerWidth-5)>$(window).width()){if((itemPosition.viewportOffset.left+5-subMenuSize.outerWidth)>=0){left=((subMenuSize.outerWidth*-1)+5);}}
subMenu.css({left:left+'px',top:(menuItem.position()['top']-5)+'px'}).show();}},_hideSubMenu,_hideMenu,_positionMenu=function(elem,elemID,options,menu,repositioning){var above=options.above;if(above=='auto'){above=false;if(($(elem).offset().top+menu.height())>$(window).height()){above=true;}}
var positionInfo={trigger:elem,target:menu,center:true,above:above,stemOffset:{left:options.stemOffset,top:-2}};menu.css({left:'auto',top:'auto',position:'static'});if(menu.attr('data-originalWidth')){menu.css({width:menu.attr('data-originalWidth')+'px'});}
if(options.appendTo){var appendTo=_getAppendContainer(elem,options.appendTo);if(appendTo.length){_.extend(positionInfo,{targetContainer:appendTo});}}
var menuPosition=ips.utils.position.positionElem(positionInfo);var menuDims=ips.utils.position.getElemDims(menu);var triggerPosition=ips.utils.position.getElemPosition($(elem));menu.css({left:menuPosition.left+'px',top:menuPosition.top+'px',position:(menuPosition.fixed)?'fixed':'absolute',});if(!repositioning){menu.css({zIndex:ips.ui.zIndex()});}
var newMenuPosition=ips.utils.position.getElemPosition(menu);if((menuDims.width>$(document).width())||newMenuPosition.viewportOffset.left<0){options.noStem=true;menu.attr('data-originalWidth',menuDims.width).css({left:'10px',width:($(document).width()-20)+'px'});}
_removeExistingStems(menu,options);if(!menu.hasClass(options.className+'_noStem')&&!options.noStem){var stemClass='';stemClass+=menuPosition.location.vertical;stemClass+=menuPosition.location.horizontal.charAt(0).toUpperCase();stemClass+=menuPosition.location.horizontal.slice(1);menu.addClass(options.className+'_'+stemClass);}},_removeExistingStems,_getMenu,_closeOnBlur,_clickIsChildOfMenu,_menuClicked,_handleSelectableClick,_getAppendContainer=function(elem,appendTo){var appends=appendTo.split(',');var elem=$(elem);for(var i=0;i<appends.length;i++){var selector=$.trim(appends[i]);if(selector.startsWith('#')){if($(selector).length){return $(selector);}}else{if(elem.closest(selector).length){return elem.closest(selector);}}};};ips.ui.registerWidget('menu',ips.ui.menu,['className','menuID','closeOnClick','closeOnBlur','menuContent','appendTo','activeClass','selectable','withStem','stemOffset','stopLinks','above'],{lazyLoad:true,lazyEvents:'click'});return{respond:respond};});}(jQuery,_));;
;(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.passwordStrength',function(){var defaults={};var respond=function(elem,options){if(!$(elem).data('_passwordStrength')){$(elem).data('__passwordStrength',passwordStrengthObj(elem,_.defaults(options,defaults)));}},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){if($(elem).data('_passwordStrength')){return $(elem).data('_passwordStrength');}
return undefined;};ips.ui.registerWidget('passwordStrength',ips.ui.passwordStrength,['enforced','enforcedStrength']);return{respond:respond,getObj:getObj,destruct:destruct};});var passwordStrengthObj=function(elem,options){var _popup=null,_passwordBlurred=false,_field=null,_dirty=false,_timer=null,_ajax=ips.getAjax();var init,destruct,_passwordFocus,_passwordBlur,_clearResult,_passwordKeyEvent,_changePassword=function(){var value=_field.val();var resultElem=_field.next('[data-role="validationCheck"]');var wrapper=elem.find('[data-role="strengthInfo"]');var meter=elem.find('[data-role="strengthMeter"]');var text=elem.find('[data-role="strengthText"]');if(_ajax&&_ajax.abort){_ajax.abort();}
if(value.length){_dirty=true;}else{if(!_dirty){return;}}
if(!meter.is(':visible')){ips.utils.anim.go('fadeInDown fast',wrapper);}
_field.addClass('ipsField_loading');_ajax(ips.getSetting('baseURL')+'?app=core&module=system&controller=ajax&do=passwordStrength',{dataType:'json',data:{input:value},method:'post'}).done).fail(function(){}).always(function(){_field.removeClass('ipsField_loading');});},_buildAdvicePopup,_positionAdvicePopup;init();return{destruct:destruct};};}(jQuery,_));;
;(jQuery,_));;
;(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.quote',function(){var defaults={timestamp:'',userid:0,username:'',contenttype:'',contentclass:'',contentid:0};var respond=function(elem,options){if(elem.data('quoteBuilt')||elem.parents('.cke_wysiwyg_div').length){return;}
var existingCitation=elem.children('.ipsQuote_citation');var citation=ips.utils.getCitation(options,true,existingCitation.length?existingCitation.text():ips.getString('editorQuote'));var data={citation:citation,contenturl:options.contentid&&options.contentcommentid?ips.getSetting('baseURL')+"?app=core&module=system&controller=content&do=find&content_class="+options.contentclass+"&content_id="+options.contentid+"&content_commentid="+options.contentcommentid:''};var citation=ips.templates.render('core.editor.citation',data);if(existingCitation.length){existingCitation.replaceWith(citation);}else{elem.prepend(citation);}
elem.find('> .ipsQuote_citation').on('click',_toggleQuote);elem.find('.ipsQuote_contents').addClass('ipsClearfix');if(elem.is('blockquote.ipsQuote > blockquote.ipsQuote')){elem.find('> *:not( .ipsQuote_citation )').hide().end().find('> .ipsQuote_citation').removeClass('ipsQuote_open').addClass('ipsQuote_closed');}
elem.trigger('quoteBuilt.quote');elem.data('quoteBuilt',true);},_toggleQuote;ips.ui.registerWidget('quote',ips.ui.quote,['timestamp','userid','username','contentapp','contenttype','contentclass','contentid','contentcommentid']);return{respond:respond};});}(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.selectTree',function(){var defaults={multiple:false,selected:false,searchable:true,placeholder:ips.getString('select')};var respond,getObj=function(elem){if($(elem).data('_selecttree')){return $(elem).data('_selecttree');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}};var selectTreeObj=function(elem,options){var results=null,elemID=null,selectedItems=[],name='';var init=function(){elemID=elem.identify().attr('id');results=elem.find('.ipsSelectTree_nodes');name=elem.attr('data-name');elem.on('click',_toggleResults);elem.on('click','[data-action="getChildren"]',_toggleChildren);elem.on('click','[data-action="nodeSelect"]',_toggleNodeSelection);if($('input[name="'+name+'-zeroVal"]')){$('input[name="'+name+'-zeroVal"]').on('change',_zeroValChange);}
if(options.selected){try{var preSelected=$.parseJSON(options.selected);}catch(err){}
if(preSelected&&_.isObject(preSelected)&&_.size(preSelected)){_buildPreSelected(preSelected);return;}}
elem.find('.ipsSelectTree_value').addClass('ipsSelectTree_placeholder').text((options.placeholder)?options.placeholder:ips.getString('select'));_zeroValChange();},destruct,_buildPreSelected,_zeroValChange,_toggleChildren,_toggleNodeSelection,_selectNode,_unselectNode,_addToken=function(title,id){var valueElem=elem.find('.ipsSelectTree_value');var elemHeight=elem.outerHeight();if(!elem.find('[data-role="tokenList"]').length){valueElem.html($('<ul/>').addClass('ipsList_inline').attr('data-role','tokenList'));}
elem.find('[data-role="tokenList"]').append(ips.templates.render('core.selectTree.token',{title:title,id:id}));if(elemHeight!=elem.outerHeight()){_positionResults();}},_removeToken,_updateSelectedValues,_setValue,_toggleResults,_maybeHideResults,_closeResults,_showResults,_positionResults=function(){var above=false;var selectWidth=elem.outerWidth();var elemTop=elem.offset().top;var elemHeight=elem.height();if((elemTop+elemHeight+results.height())>$(window).height()){above=true;var scrollParent=_getScrollParent();var scrollParentTop=$(scrollParent).offset().top;Debug.log("elemTop: "+elemTop);Debug.log("elemTop - resultsHeight: "+(elemTop-results.height()));Debug.log("scrollParentTop: "+scrollParentTop);if((elemTop-results.height())<scrollParentTop){above=false;}}
var positionInfo={trigger:elem,target:results,targetContainer:elem,above:above};var resultsPosition=ips.utils.position.positionElem(positionInfo);results.css({top:resultsPosition.top+'px',left:-parseFloat(results.css('borderLeftWidth'))-parseFloat(results.css('marginLeft')),position:'absolute',zIndex:ips.ui.zIndex(),minWidth:selectWidth+'px'});if(resultsPosition.location.vertical=='top'){results.removeClass('ipsSelectTree_bottom').addClass('ipsSelectTree_top');elem.removeClass('ipsSelectTree_bottom').addClass('ipsSelectTree_top');}else{results.removeClass('ipsSelectTree_top').addClass('ipsSelectTree_bottom');elem.removeClass('ipsSelectTree_top').addClass('ipsSelectTree_bottom');}},_closeResultsOnBlur,_clickIsInElem,_getScrollParent
init();return{destruct:destruct};};ips.ui.registerWidget('selectTree',ips.ui.selectTree,['placeholder','multiple','selected','url','searchable']);return{respond:respond,destruct:destruct};});}(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.spoiler',function(){var respond=function(elem,options,e){if(elem.parents('.cke_wysiwyg_div').length){return;}
elem.contents().hide();var existingHeader=elem.children('.ipsSpoiler_header');var header=ips.templates.render('core.editor.spoilerHeader');if(existingHeader.length){existingHeader.replaceWith(header);}else{elem.prepend(header);}
elem.find('> .ipsSpoiler_header').on('click',_toggleSpoiler);},_toggleSpoiler;ips.ui.registerWidget('spoiler',ips.ui.spoiler);return{respond:respond}});}(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.sticky',function(){var defaults={stickyClass:'ipsSticky',stickTo:'top',spacing:0,disableIn:'phone'};var respond,getObj=function(elem){if($(elem).data('_sticky')){return $(elem).data('_sticky');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}};ips.ui.registerWidget('sticky',ips.ui.sticky,['stickyClass','relativeTo','spacing','stickTo','width','disableIn']);var stickyObj=function(elem,options){var relativeTo=false,originalStyles={},originalOffsetTop,status,dummyElem,locked=false;var _init=function(){if(!$(elem).is(':visible')){Debug.warn("Can't set up a sticky element if the element is hidden when init is called.");return;}
relativeTo=options.relativeTo?$(options.relativeTo):false;if(options.disableIn){options.disableIn=_.map(options.disableIn.split(','));}
originalStyles={top:$(elem).css('top'),bottom:$(elem).css('bottom'),position:$(elem).css('position'),width:$(elem).get(0).style.width};status='normal';originalOffsetTop=$(elem).offset().top;_scrollDocument();$(document).on('scroll',_scrollDocument).on('breakpointChange',_breakpointChange);$(window).on('resize',_windowResize);$(elem).trigger('stickyInit',{id:$(elem).identify().attr('id'),status:status});},destruct,_breakpointChange,_windowResize,_scrollDocument,_makeFixed=function(offset){if(locked){return;}
var width;if(!dummyElem&&!relativeTo){_makeDummyElem();}
if(status=='fixed'&&!_.isUndefined(offset)){$(elem).css({top:(offset)+'px'});$('#ipsStickySpacer').remove();return;}
var bottomSpacing=$(document).height()-$(window).height()-$(document).scrollTop()-10;if(options.stickTo=='top'&&bottomSpacing<$(elem).outerHeight()){_makeBottomSpacer(bottomSpacing);}
if(options.width&&(options.width.indexOf('#')===0||options.width.indexOf('.')===0)){width=$(options.width).first().outerWidth();}else if(options.width){width=parseInt(options.width);}else{width=$(elem).css('width');}
$(elem).css({position:'fixed',width:width,zIndex:ips.ui.zIndex()}).addClass(options.stickyClass);if(options.stickTo=='bottom'){$(elem).css({bottom:options.spacing+'px'}).addClass(options.stickyClass+'_bottom');}else{$(elem).css({top:options.spacing+'px'}).addClass(options.stickyClass+'_top');}
if(!relativeTo){dummyElem.css({width:$(elem).width(),height:$(elem).outerHeight()}).show();}
status='fixed';$(elem).trigger('stickyStatusChange.sticky',{status:'fixed'});},_makeNormal=function(){$(elem).css({position:originalStyles.position,width:originalStyles.width}).removeClass(options.stickyClass).removeClass(options.stickyClass+'_top')
if(options.stickTo=='bottom'){$(elem).css({bottom:originalStyles.bottom}).removeClass(options.stickyClass+'_bottom');}else{$(elem).css({top:originalStyles.bottom}).removeClass(options.stickyClass+'_top');}
if(dummyElem){dummyElem.hide();}
_makeBottomSpacer(0);status='normal';$(elem).trigger('stickyStatusChange.sticky',{status:'normal'});},_makeDummyElem,_makeBottomSpacer;_init();return{destruct:destruct};};return{respond:respond,destruct:destruct};});}(jQuery,_));;
;(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.tooltip',function(){var _animating=false,_tooltip=null,_timer=[],_currentElem=null;var respond,_show=function(elem,options,content){elem=$(elem);ips.utils.anim.cancel(_tooltip);if(options.safe){_tooltip.hide().html(content);}else{_tooltip.hide().text(content);}
if(elem.attr('title')){elem.attr('_title',elem.attr('title')).removeAttr('title');}
var positionInfo={trigger:elem,target:_tooltip,center:true,above:true,stemOffset:{left:10,top:0}};var tooltipPosition=ips.utils.position.positionElem(positionInfo);$(_tooltip).css({left:tooltipPosition.left+'px',top:tooltipPosition.top+'px',position:(tooltipPosition.fixed)?'fixed':'absolute',zIndex:ips.ui.zIndex()});if(tooltipPosition.location.vertical=='top'){_tooltip.addClass('ipsTooltip_top').removeClass('ipsTooltip_bottom');}else{_tooltip.addClass('ipsTooltip_bottom').removeClass('ipsTooltip_top');}
_tooltip.removeClass('ipsTooltip_left').removeClass('ipsTooltip_right');if(tooltipPosition.location.horizontal=='left'){_tooltip.addClass('ipsTooltip_left');}else if(tooltipPosition.location.horizontal=='right'){_tooltip.addClass('ipsTooltip_right');}
_tooltip.show();_currentElem=elem;_timer.push(setInterval(_checkForElemPresence,100));$(elem).trigger('tooltipShown');},_hide,_checkForElemPresence,_getContent=function(elem,options){elem=$(elem);if(options.label){if(options.json){return $.parseJSON(options.label).join("<br>");}else{return options.label;}}else if(elem.attr('aria-label')){return elem.attr('aria-label');}else if(elem.attr('_title')){return elem.attr('_title');}else if(elem.attr('title')){return elem.attr('title');}},_createTooltipElement;ips.ui.registerWidget('tooltip',ips.ui.tooltip,['label','extraClass','safe','json'],{lazyLoad:true,lazyEvents:'mouseenter mouseleave focus blur'});return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.truncate',function(){var defaults={type:'remove',size:100,expandText:ips.getString('show_more'),watch:true};var respond,_removeTruncate,_hideTruncate=function(elem,options){var size=_getSizeValue(options.size,elem);var originalSize=elem.outerHeight();var originalPos=$(elem).css('position');if(originalSize<=size.pixels){Debug.log('Smaller than the specified size, finishing...');return;}
if(originalPos=='static'){$(elem).css('position','relative');}
$(elem).css({height:size.pixels+'px'}).addClass('ipsTruncate');var showMore=ips.templates.render('core.truncate.expand',{text:options.expandText});$(elem).after(showMore);var expander=elem.next("[data-action='expandTruncate']");elem.trigger('contentTruncated',{type:'hide'});expander.on('click',function(e){elem.css({height:'auto'});var newOriginalSize=elem.outerHeight();elem.css({height:size.pixels+'px'});ips.utils.anim.go('fadeOutDown fast',expander).done(function(){expander.remove();});if(newOriginalSize>size.pixels){$(elem).animate({height:newOriginalSize+'px'},function(){$(this).css({'position':originalPos,'height':'auto'});$(elem).trigger('truncateExpanded');});}});},_getSizeValue,_getLineHeight;ips.ui.registerWidget('truncate',ips.ui.truncate,['type','size','expandText','watch']);return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.uploader',function(){var defaults={multiple:false,allowedFileTypes:null,maxFileSize:null,maxTotalSize:null,maxChunkSize:null,action:null,name:'upload',button:'.ipsButton_primary',key:null,autoStart:true,insertable:false,template:'core.attachments.fileItem',postkey:'',supportsDelete:true};var respond,refresh,getObj=function(elem){if($(elem).data('_uploader')){return $(elem).data('_uploader');}
return undefined;};ips.ui.registerWidget('uploader',ips.ui.uploader,['multiple','allowedFileTypes','maxFileSize','maxTotalSize','maxChunkSize','action','name','button','key','maxFiles','dropTarget','listContainer','autoStart','insertable','template','existingFiles','postkey','supportsDelete']);return{respond:respond,refresh:refresh,getObj:getObj};});var uploadObj=function(elem,options,e){var pluploadObj,listContainer,uploadCount=0,injectIds={},uploaderID='',sound=null;var init,refresh,_setUpFormEvents=function(){if(!elem.closest('form').length){return;}
elem.closest('form').on('submit');},_addUploaderFile=function(e,data){if(data.uploaderID==uploaderID){listContainer.append(ips.templates.render(options.template,data));}},_removeAllFiles,_buildExistingFiles=function(files){if(!files.length){return;}
for(var i=0;i<files.length;i++){var data={id:files[i].id,imagesrc:files[i].imagesrc,thumbnail:files[i].thumbnail?files[i].thumbnail:'',thumbnail_for_css:files[i].thumbnail?files[i].thumbnail.replace('(','\\(').replace(')','\\)'):'',title:files[i].originalFileName,size:files[i].size,field_name:elem.attr('data-ipsUploader-name'),newUpload:false,insertable:!options.insertable,done:true,'default':files[i].default?files[i].default:null,supportsDelete:options.supportsDelete};if(files[i].id==elem.attr('data-ipsUploader-default')){data['checked']="checked";}
if(files[i]['hasThumb']){data['thumb']="<img src='"+(files[i]['thumbnail']?files[i]['thumbnail']:files[i]['imagesrc'])+"' class='ipsImage'>";}
listContainer.append(ips.templates.render(options.template,data));$('#'+files[i].id).trigger('newItem',[$('#'+files[i].id)]);};elem.trigger('fileAdded',{count:files.length,uploader:options.name});},_setUpUploader,_getUploaderSettings=function(){var form=elem.parentsUntil('','form');if(options.action===null){options.action=form.attr('action');}
if(options.key===null){options.key=form.children("[name='plupload']").val();}
var pluploadOptions={runtimes:'html5,flash,silverlight,html4',multi_selection:options.multiple,url:encodeURI(_decodeUrl(options.action)),file_data_name:options.name,flash_swf_url:'applications/core/interface/plupload/Movie.swf',silverlight_xap_url:'applications/core/interface/plupload/Movie.xap',browse_button:elem.find(options.button).identify().attr('id'),headers:{'x-plupload':options.key},chunk_size:options.maxChunkSize+'mb'};if(options.dropTarget){pluploadOptions.drop_element=$(options.dropTarget).attr('id');}else if($(elem).hasClass('ipsAttachment_dropZone')){pluploadOptions.drop_element=$(elem).attr('id');}else if($(elem).find('.ipsAttachment_dropZone').length){pluploadOptions.drop_element=$(elem).find('.ipsAttachment_dropZone').identify().attr('id');}
return pluploadOptions;},_isEncoded,_decodeUrl,_initUploader=function(){pluploadObj.init();},_postInitEvents=function(){pluploadObj.bind('Error',events.error);pluploadObj.bind('FilesAdded',events.filesAdded);pluploadObj.bind('FilesRemoved',events.filesRemoved);pluploadObj.bind('UploadFile',events.uploadFile);pluploadObj.bind('UploadProgress',events.uploadProgress);pluploadObj.bind('FileUploaded',events.fileUploaded);pluploadObj.bind('UploadComplete',events.uploadComplete);$(elem).on('injectFile',function(e,data){var pluploadFile=new plupload.File(new moxie.file.File(null,data.file));injectIds[pluploadFile.id]=data.data;pluploadObj.addFile(pluploadFile);}).on('resetUploader',function(data){_resetUploader(e,data);})},_resetUploader=function(data){uploadCount=0;_updateCount();$(elem).trigger('removeAllFiles',{uploaderID:uploaderID});},_startUpload=function(){Debug.log('Starting upload process...');_preloadNotificationSound();pluploadObj.start();},_preloadNotificationSound=function(){ips.loader.get(['core/interface/howler/howler.core.min.js']).then(function(){sound=new Howl({src:ips.getSetting('baseURL')+'applications/core/interface/sounds/success.mp3',autoplay:false});});},_getStatus,_updateFileElement=function(file){var fileElem=_findFileElem(file);_updateStatus(fileElem,file.status);_removeStatusClasses(fileElem);_updateCount();return fileElem;},_findFileElem,_updateStatus=function(fileElem,status){fileElem.find('[data-role="status"]').html(_getStatus(status));},_removeStatusClasses,_updateCount,_setPercent=function(fileElem,percent){fileElem.find('[data-role="progressbar"]').css({width:percent+'%'});if(percent===100){ips.utils.anim.go('fadeOut fast',fileElem.find('.ipsAttachment_progress'));}},_buildThumb=function(fileElem,file,info){var toInsert='';if(info.imagesrc){Debug.log(fileElem.find('[data-role="preview"]'));toInsert=$('<img/>').attr({src:info.thumbnail?info.thumbnail:info.imagesrc}).addClass('ipsImage');fileElem.attr('data-fullsizeurl',info.imagesrc).attr('data-thumbnailurl',info.thumbnail?info.thumbnail:info.imagesrc).find('[data-role="preview"]').html(toInsert).css('background-image','url( "'+(info.thumbnail?info.thumbnail:info.imagesrc)+'")');}else if(info.videosrc){toInsert=$('<video/>').append($('<source/>').attr({src:info.videosrc,type:fileElem.attr('data-mimeType')}));fileElem.attr('data-fullsizeurl',info.videosrc).find('[data-role="preview"]').html(toInsert);}
fileElem.attr('data-fileid',info.id);},_deleteFile=function(fileElem,e){e.preventDefault();e.stopPropagation();var baseUrl=options.action;if(baseUrl.match(/\?/)){if(baseUrl.slice(-1)!='?'){baseUrl+='&';}}else{baseUrl+='?';}
ips.getAjax()(baseUrl+'postKey='+options.postkey+'&deleteFile='+encodeURIComponent(fileElem.attr('data-fileid')));uploadCount--;_updateCount();fileElem.animationComplete);ips.utils.anim.go('fadeOutDown',fileElem);},_supportsDraggable,events={init,filesAdded:function(up,files){if(!options.multiple){listContainer.find('[data-role="deleteFile"]').click();if(files.length>1){alert(ips.getString('uploadSingleErr'));return false;}}else if(options.maxFiles){if(files.length>options.maxFiles||(uploadCount+files.length)>options.maxFiles){ips.ui.alert.show({type:'alert',icon:'warn',message:ips.pluralize(ips.getString('uploadMaxFilesErr'),options.maxFiles),callbacks:{}});_.each(files,function(file,idx){up.removeFile(file);});return false;}}else if(options.maxTotalSize&&up.total.size>(options.maxTotalSize*1048576)){ips.ui.alert.show({type:'alert',icon:'warn',message:ips.getString('uploadTotalErr',{size:parseFloat((options.maxTotalSize>1)?options.maxTotalSize:(options.maxTotalSize*1024)).toLocaleString($('html').attr('lang')),size_suffix:(options.maxTotalSize>1)?ips.getString('size_mb'):ips.getString('size_kb')}),callbacks:{}});_.each(files,function(file,idx){up.removeFile(file);});return false;}
var tooLarge=0;var badType=0;var allowedFileTypes=(options.allowedFileTypes!==null)?$.parseJSON(options.allowedFileTypes).join(',').toLowerCase().split(','):'';_.each(files,function(file,idx){if(options.maxFileSize!==null&&((file.size / 1024)>(options.maxFileSize*1024))){tooLarge++;up.removeFile(file);return;}
if(allowedFileTypes&&allowedFileTypes.indexOf(file.name.substr((~-file.name.lastIndexOf(".")>>>0)+2).toLowerCase())===-1){badType++;up.removeFile(file);return;}
var size=plupload.formatSize(file.size),status=_getStatus(file.status),isImage=false,isVideo=false;if(['jpg','jpeg','jpe','gif','png'].indexOf(file.name.substr((~-file.name.lastIndexOf(".")>>>0)+2).toLowerCase())!==-1){isImage=true;}
if(['mp4','3gp','mov','ogg','ogv','mpg','mpeg','flv','webm','wmv','avi','m4v'].indexOf(file.name.substr((~-file.name.lastIndexOf(".")>>>0)+2).toLowerCase())!==-1){isVideo=true;}
var data={uploaderID:uploaderID,id:file.id,title:file.name,mime:file.type,size:size,status:status,statusCode:file.status,statusText:ips.getString('attachStatus',{size:size,status:status}),field_name:elem.attr('data-ipsUploader-name'),newUpload:true,insertable:true,isImage:isImage,isVideo:isVideo,supportsDelete:options.supportsDelete};$(elem).trigger('addUploaderFile',data);$('#'+file.id).addClass('ipsAttach_queued').trigger('newItem',[$('#'+file.id)]);});if(tooLarge){var errorString=ips.getString('uploadSizeErr',{max_file_size:parseFloat((options.maxFileSize>1)?options.maxFileSize:(options.maxFileSize*1024)).toLocaleString($('html').attr('lang')),size_suffix:(options.maxFileSize>1)?ips.getString('size_mb'):ips.getString('size_kb')});ips.ui.alert.show({type:'alert',icon:'warn',message:ips.pluralize(errorString,[tooLarge,tooLarge]),callbacks:{}});}
if(badType){var errorString=ips.getString('pluploaderr_-601',{allowed_extensions:allowedFileTypes.join(', ')});ips.ui.alert.show({type:'alert',icon:'warn',message:ips.pluralize(errorString,[tooLarge,tooLarge]),callbacks:{}});}
if(up.files.length){elem.trigger('fileAdded',{count:up.files.length,uploader:options.name});if(options.autoStart){_startUpload();}}},filesRemoved:function(){Debug.log('removed');},uploadFile,uploadProgress,uploadComplete:function(up,files){var success=0;var error=0;_.each(files);var total=success+error;elem.trigger('uploadComplete',{success:success,error:error,total:total,uploader:options.name});if(_.isUndefined(ips.utils.events.getVisibilityProp())||!document[ips.utils.events.getVisibilityProp()]){return;}
var text=[];if(!total){return;}
if(success){text.push(ips.pluralize(ips.getString('notifyUploadSuccess'),[success]));}
if(error){text.push(ips.pluralize(ips.getString('notifyUploadError'),[error]));}
if(ips.utils.notification.supported){ips.utils.notification.create({title:ips.pluralize(ips.getString('yourUploadsFinished'),[total]),body:text.join(' '),icon:ips.getSetting('upload_imgURL'),onClick}).show();}
if(sound){try{sound.play();}catch(err){}}},fileUploaded:function(up,file,info){uploadCount++;var fileElem=_updateFileElement(file);fileElem.addClass('ipsAttach_done');if(options.insertable){ips.utils.anim.go('fadeIn',fileElem.find('[data-role="insert"]'));}
ips.utils.anim.go('fadeIn',fileElem.find('[data-role="deleteFileWrapper"]'));_setPercent(fileElem,100);try{var jsonInfo=$.parseJSON(info.response);elem.before($('<input type="hidden">').attr('name',elem.attr('data-ipsUploader-name')+'_existing['+file.id+']').attr('value',jsonInfo.id));if(jsonInfo['error']){fileElem.on('click','[data-role="deleteFile"]',_.bind(_deleteFile,fileElem,fileElem));file.status=plupload.FAILED;up.trigger('error',{code:jsonInfo['error'],extra:jsonInfo['extra'],subText:jsonInfo['sub'],file:file,uploader:options.name});return;}
if(jsonInfo){_buildThumb(fileElem,file,jsonInfo);fileElem.on('click','[data-role="deleteFile"]',_.bind(_deleteFile,fileElem,fileElem));}}catch(err){fileElem.on('click','[data-role="deleteFile"]',_.bind(_deleteFile,fileElem,fileElem));file.status=plupload.FAILED;up.trigger('error',{code:'upload_error',extra:err.message,file:file,uploader:options.name});Debug.warn(err);}
if(file.id&&injectIds[file.id]){$(elem).trigger('fileInjected',{'fileElem':fileElem,'data':injectIds[file.id]});delete injectIds[file.id];}},error:function(up,err){if(err.file){_updateFileElement(err.file);}
if(err.code==-600||err.code==-601){errorCounts[(err.code==-600)?'size':'ext']++;return;}
var errorMessage=ips.getString('pluploaderr_'+err.code,{max_file_size:parseFloat((options.maxFileSize>1)?options.maxFileSize:(options.maxFileSize*1024)).toLocaleString($('html').attr('lang')),size_suffix:(options.maxFileSize>1)?ips.getString('size_mb'):ips.getString('size_kb'),allowed_extensions:(options.allowedFileTypes!==null)?$.parseJSON(options.allowedFileTypes).join(','):'',server_error_code:(err.extra!==null)?err.extra:0,});if(!errorMessage){errorMessage=ips.getString('pluploaderr_SERVER_CONFIGURATION',{server_error_code:err.code});}
ips.ui.alert.show({type:'alert',icon:'warn',message:errorMessage,callbacks:{},subTextHtml:err.subText?err.subText:null});}};init();return{init:init,refresh:refresh};}}(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.wizard',function(){var respond;var refresh=function(elem,e){var target=$(e.currentTarget);_showLoading(elem);if(target.is('form')){if(target.attr('data-bypassAjax')){return true;}
e.preventDefault();ips.getAjax()(target.attr('action'),{data:target.serialize(),type:'post'}).done(function(response){_insertHtml(response,elem);}).fail)}else{e.preventDefault();ips.getAjax()(target.attr('href')).done);}},_insertHtml,_showLoading=function(elem){var loading=elem.find('[data-role="loading"]');var formContainer=elem.find('[data-role="wizardContent"]');if(!loading.length){loading=$('<div/>').attr('data-role','loading').addClass('ipsLoading').hide();elem.append(loading);}
var dims={width:formContainer.outerWidth(),height:formContainer.outerHeight()};loading.css({width:dims.width+'px',height:dims.height+'px'}).show();formContainer.hide().after(loading.show());},_hideLoading;ips.ui.registerWidget('wizard',ips.ui.wizard);return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils',function(options){var argsToArray,uppercaseFirst,getIDsFromList,getCitation=function(data,html,defaultValue){var citation=ips.getString('editorQuote');if(defaultValue){var citation=defaultValue;}
if(data.username){var username=data.username;if(html&&data.userid&&ips.getSetting('viewProfiles')){username=ips.templates.render('core.editor.citationLink',{baseURL:ips.getSetting('baseURL'),userid:data.userid,username:data.username});}
if(data.timestamp){var citation=ips.getString('editorQuoteLineWithTime',{date:ips.utils.time.readable(data.timestamp),username:username});}else{var citation=ips.getString('editorQuoteLine',{username:username});}}
return citation;},escapeRegexp=function(toEscape){return toEscape.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");};return{argsToArray:argsToArray,uppercaseFirst:uppercaseFirst,getIDsFromList:getIDsFromList,getCitation:getCitation,escapeRegexp:escapeRegexp};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.analytics',function(){var init=function(){},trackPageView=function(url){try{if(ips.getSetting('analyticsProvider')=='ga'){if(!_.isUndefined(window.ga)){var urlObj=ips.utils.url.getURIObject(url||document.location);Debug.log("Manual page view tracked with Google Analytics: "+urlObj.relative);ga('send','pageview',urlObj.relative);}}else if(ips.getSetting('analyticsProvider')=='piwik'){if(!_isUndefined(window._paq)){Debug.log("Manual page view tracked with Piwik");_paq.push(['trackPageView']);}}else if(ips.getSetting('analyticsProvider')=='custom'&&_.isFunction(ips.getSetting('paginateCode'))){ips.getSetting('paginateCode').call(url);}}catch(err){Debug.log("Error tracking page view: "+err);}};return{init:init,trackPageView:trackPageView};});}(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.color',function(){var init=function(){};var convertHex,HSLtoRGB,hueToRGB,RGBtoHSL,hexToRGB=function(hex){return parseInt(hex,16);},RGBtoHex;return{convertHex:convertHex,HSLtoRGB:HSLtoRGB,hueToRGB:hueToRGB,RGBtoHSL:RGBtoHSL,hexToRGB:hexToRGB,RGBtoHex:RGBtoHex};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.cookie',function(){var _store={},_init=false;var init,get,set=function(cookieKey,value,sticky){var expires='',path='/',domain='',ssl='',prefix='';if(!cookieKey){return;}
if(!_.isUndefined(sticky)){if(sticky===true){expires="; expires=Wed, 1 Jan 2020 00:00:00 GMT";}else if(sticky===-1){expires="; expires=Thu, 01-Jan-1970 00:00:01 GMT";}else if(sticky.length>10){expires="; expires="+sticky;}}
if(!_.isUndefined(ips.getSetting('cookie_domain'))&&ips.getSetting('cookie_domain')!=''){domain="; domain="+ips.getSetting('cookie_domain');}
if(!_.isUndefined(ips.getSetting('cookie_path'))&&ips.getSetting('cookie_path')!=''){path=ips.getSetting('cookie_path');}
if(!_.isUndefined(ips.getSetting('cookie_prefix'))&&ips.getSetting('cookie_prefix')!=''){prefix=ips.getSetting('cookie_prefix');}
if(!_.isUndefined(ips.getSetting('cookie_ssl'))&&ips.getSetting('cookie_ssl')!=''){ssl='; secure';}
document.cookie=prefix+cookieKey+"="+escape(value)+"; path="+path+expires+domain+ssl+';';_store[cookieKey]=value;},unset,_parseCookies=function(cookieString){var pairs=cookieString.split(";"),cookies={};for(var i=0;i<pairs.length;i++){var pair=pairs[i].split("=");cookies[$.trim(pair[0])]=$.trim(unescape(pair[1]));}
return cookies;};return{init:init,get:get,set:set,unset:unset};});}(jQuery,_));;
;(jQuery,_));;
;(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.emoji',function(){var _emoji=null,_categories=null,_testingCanvasContext=null,_ajax=null,init,getEmoji=function(callback){if(this._emoji&&this._categories){callback(this._emoji,this._categories);return;}
var storage=ips.utils.db.get('emoji',ips.getSetting('baseURL')+'-'+ips.getSetting('emoji_cache'));var categories=ips.utils.db.get('emojiCategories',ips.getSetting('baseURL')+'-'+ips.getSetting('emoji_cache'));if(storage&&categories){this._emoji=storage;callback(storage,categories);}else{ips.utils.db.removeByType('emoji');if(this._ajax&&this._ajax.abort){this._ajax.abort();}
this._ajax=ips.getAjax()(ips.getSetting('baseURL')+'index.php?app=core&module=system&controller=editor&do=emoji').done(function(emoji){this._emoji={};this._categories=[];var canUseTones=null;for(var category in emoji){var categoryName=emoji[category].category;this._categories.push(categoryName);this._emoji[categoryName]=[];for(var i=0;i<emoji[category].emoji.length;i++){if(this.canRender(emoji[category].emoji[i].code)){if(emoji[category].emoji[i].skinTone){if(canUseTones===null){if(!this.canRender(this.tonedCode(emoji[category].emoji[i].code,'light'))){canUseTones=false;}
else{canUseTones=true;}}
if(canUseTones===false){emoji[category].emoji[i].skinTone=false;}}
emoji[category].emoji[i].shortNames.push(ips.getString('emoji-'+emoji[category].emoji[i].name));this._emoji[categoryName].push(emoji[category].emoji[i]);}}}
ips.utils.db.set('emoji',ips.getSetting('baseURL')+'-'+ips.getSetting('emoji_cache'),this._emoji);ips.utils.db.set('emojiCategories',ips.getSetting('baseURL')+'-'+ips.getSetting('emoji_cache'),this._categories);callback(this._emoji,this._categories);}.bind(this));}},canRender,emojiFromHex,emojiImage=function(codeToUse,lazyLoad){if(codeToUse.substr(0,7)=='custom-'){var parts=codeToUse.split('-');if(_.isUndefined(this._emoji[parts[1]])){return null;}
for(var i=0;i<this._emoji[parts[1]].length;i++){if(this._emoji[parts[1]][i].code==codeToUse){var imgTag='<img ';if(lazyLoad){imgTag+='src="'+ips.getSetting('blankImg')+'" data-loading data-src="'+this._emoji[parts[1]][i].image+'"';}else{imgTag+='src="'+this._emoji[parts[1]][i].image+'"';}
imgTag+='title="'+this._emoji[parts[1]][i].name+'" alt="'+this._emoji[parts[1]][i].name+'"';if(this._emoji[parts[1]][i].image2x){imgTag+=' srcset="'+this._emoji[parts[1]][i].image2x+' 2x"';}
if(parseInt(this._emoji[parts[1]][i].width)&&parseInt(this._emoji[parts[1]][i].height)){imgTag+=' width="'+this._emoji[parts[1]][i].width+'" height="'+this._emoji[parts[1]][i].height+'"';}
imgTag+=' data-emoticon="true">';return imgTag;}}
return null;}else{var url;var image=codeToUse.toLowerCase();if(image.indexOf('200d')==-1||['1f441-fe0f-200d-1f5e8-fe0f'].indexOf(image)!=-1){image=image.replace(/\-fe0f/g,'');}
if(['0031-20e3','0030-20e3','0032-20e3','0034-20e3','0035-20e3','0036-20e3','0037-20e3','0038-20e3','0033-20e3','0039-20e3','0023-20e3','002a-20e3','00a9','00ae'].indexOf(image)!=-1){image=image.replace('00','');}
url="https://twemoji.maxcdn.com/2/72x72/"+image+".png";var character=this.emojiFromHex(codeToUse);if(lazyLoad){return'<img src="'+ips.getSetting('blankImg')+'" data-loading data-src="'+url+'" alt="'+character+'" class="ipsEmoji" data-emoticon="true">';}else{return'<img src="'+url+'" alt="'+character+'" class="ipsEmoji" data-emoticon="true">';}}},tonedCode,preview,editorElement,logUse;return{init:init,getEmoji:getEmoji,canRender:canRender,emojiFromHex:emojiFromHex,emojiImage:emojiImage,tonedCode:tonedCode,preview:preview,editorElement:editorElement,logUse:logUse};});}(jQuery,_));if(!String.fromCodePoint){());};
;(jQuery,_));;
;(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.lazyLoad',function(){var _observer;var _rootMargin="150px";var _threshold=0;var _supportsObserver=true;var _registry={};var _document=$(document);var contentSelector="img[data-src], [data-background-src], iframe[data-embed-src], video[data-video-embed]";var init,observe,_preload=function(rawNode){if(_isImg(rawNode)&&!rawNode.hasAttribute('data-loaded')&&!rawNode.hasAttribute('data-loading')){var lazyLoaded=[rawNode];}else{var lazyLoaded=rawNode.querySelectorAll('img[data-src]:not([data-loaded]):not([data-loading])');}
_.each(lazyLoaded,function(element){if(!element.hasAttribute('data-ratio')){return;}
if(((element.hasAttribute('style')&&element.style.width)||element.hasAttribute('width'))){if(element.style.height!=='auto'){var width=element.hasAttribute('style')&&element.style.width?element.style.width:element.width;element.style.height=parseInt((parseInt(width)/ 100)*element.getAttribute('data-ratio'))+'px';}}else{element.style.height='0';element.style.paddingBottom=parseFloat(element.getAttribute('data-ratio'))+'%';}});},_intersection=function(entries){for(var i=0;i<entries.length;i++){if(entries[i].isIntersecting||entries[i].intersectionRatio>0){_observer.unobserve(entries[i].target);if(entries[i].target.id&&!_.isUndefined(_registry[entries[i].target.id])&&_.isFunction(_registry[entries[i].target.id].loadCallback)){_registry[entries[i].target.id].loadCallback.call(null,entries[i].target);}else{_load(entries[i].target);}}}},_load=function(rawNode,imgLoadedCallback){if(_isImg(rawNode)||_isEmbed(rawNode)||_isBackgroundImg(rawNode)||_isVideo(rawNode)){var itemsToLoad=[rawNode];}else{var itemsToLoad=rawNode.querySelectorAll(contentSelector);}
Debug.log('Loading '+itemsToLoad.length+' items...');_.each(itemsToLoad,function(element){if(_isImg(element)){if(rawNode.id&&((!_.isUndefined(_registry[rawNode.id])&&_.isFunction(_registry[rawNode.id].imgLoadedCallback))||_.isFunction(imgLoadedCallback))){replaceImg(element,imgLoadedCallback?imgLoadedCallback:_registry[rawNode.id].imgLoadedCallback);}else{replaceImg(element);}}else if(_isBackgroundImg(element)){replaceBackgroundImg(element);}else if(_isEmbed(element)){replaceEmbed(element);}else if(_isVideo(element)){replaceVideo(element);}});if(rawNode.id&&!_.isUndefined(_registry[rawNode.id])&&_.isFunction(_registry[rawNode.id].loadedCallback)){_registry[rawNode.id].loadedCallback.call(null,rawNode);}},_isImg=function(rawNode){return rawNode.tagName.toLowerCase()=='img'&&rawNode.hasAttribute('data-src');},_isBackgroundImg=function(rawNode){return rawNode.hasAttribute('data-background-src');},_isEmbed=function(rawNode){return rawNode.tagName.toLowerCase()=='iframe'&&rawNode.hasAttribute('data-embed-src');},_isVideo,replaceImg=function(element,imgLoadedCallback){if(element.hasAttribute('style')&&element.style.height!=='auto'){element.style.height=element.offsetHeight+'px';}
element.style.paddingBottom='';element.addEventListener('load',function(){if(element.hasAttribute('data-ratio')&&element.hasAttribute('style')&&element.style.width&&element.style.height&&element.style.height!=='auto'){element.style.height=parseInt((parseInt(element.style.width)/ 100)*element.getAttribute('data-ratio'))+'px';}else{element.style.height='auto';}
element.removeAttribute('data-loading');element.setAttribute('data-loaded',true);if(_.isFunction(imgLoadedCallback)){imgLoadedCallback.call(null,element);}});element.src=element.getAttribute('data-src');element.setAttribute('data-loading',true);},replaceBackgroundImg,replaceEmbed,replaceVideo=function(element){var sources=element.querySelectorAll('[data-video-src]');var canPlay=false;if(sources.length&&!ips.getSetting('adsess')){for(var i=0;i<sources.length;i++){if(element.canPlayType(sources[i].getAttribute('type'))){element.setAttribute('src',sources[i].getAttribute('data-video-src'));sources[i].setAttribute('src',sources[i].getAttribute('data-video-src'));_document.trigger('contentChange',[$(element)]);canPlay=true;break;}}}
if(!canPlay){var embed=element.querySelector("embed");var link=element.querySelector(".ipsAttachLink");if(embed&&embed.length){element.parentNode.replaceChild(embed,element);}else{element.parentNode.replaceChild(link,element);}}},loadContent=function(rawNode){if(rawNode instanceof $){rawNode=rawNode.get(0);}
_load(rawNode);},applyLazyLoadAttributes=function(rawNode,dims,forceUpdate){if(rawNode.tagName.toLowerCase()!=='img'||(rawNode.hasAttribute('data-loaded')&&!forceUpdate)){return;}
var _loadHandler=function(){dims=dims||{};var height=dims.height||rawNode.naturalHeight;var width=dims.width||rawNode.naturalWidth;if(height=='auto'){width=rawNode.offsetWidth;height=rawNode.offsetHeight;}
if(!rawNode.hasAttribute('width')&&width){rawNode.setAttribute('width',width);}
var ratio=((height / width)*100).toFixed(2);if(ratio){rawNode.setAttribute('data-ratio',ratio);}
rawNode.setAttribute('data-loaded',true);};if(rawNode.hasAttribute('data-loaded')){_loadHandler();}else{rawNode.addEventListener('load',_loadHandler);}};init();return{observe:observe,loadContent:loadContent,applyLazyLoadAttributes:applyLazyLoadAttributes,replaceImg:replaceImg,replaceBackgroundImg:replaceBackgroundImg,replaceEmbed:replaceEmbed,replaceVideo:replaceVideo,contentSelector:contentSelector};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.notification',function(){var supported=("Notification"in window);var sound=null;var initSoundFile=function(){var deferred=$.Deferred();if(sound!==null){deferred.resolve();return deferred.promise();}
ips.loader.get(['core/interface/howler/howler.core.min.js']).then(function(){Howler.autoSuspend=false;sound=new Howl({src:ips.getSetting('baseURL')+'applications/core/interface/sounds/notification.mp3',preload:false});Debug.log("Audio created with state: "+Howler.state);if(Howler.state=='suspended'){$(document).one('click',function(){Howler.ctx.resume().then);});}
deferred.resolve();});return deferred.promise();},hasPermission=function(){if(!supported||Notification.permission=='denied'||Notification.permission=='default'){return false;}
return true;},needsPermission=function(){if(supported&&Notification.permission=='default'){return true;}
return false;},permissionLevel,requestPermission,create,playSound=function(){try{if(ips.getSetting('disableNotificationSounds')){return;}
initSoundFile().then(function(){if(Howler.state!="suspended"){sound.load();sound.play();}});}catch(err){Debug.log(err);}};if(ips.getSetting('memberID')!==0){initSoundFile().then(function(){Debug.log("Initialized notification audiocontext.");});}
return{supported:supported,hasPermission:hasPermission,needsPermission:needsPermission,permissionLevel:permissionLevel,requestPermission:requestPermission,create:create,playSound:playSound};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.position',function(){var theWindow=$(window);var getElemPosition=function(elem){if(!elem){return false;}
var elem=$(elem);var props={};var hidden=!elem.is(':visible');var opacity=elem.css('opacity');if(hidden){elem.css({opacity:0.0001}).show();}
var offset=elem.offset();var position=elem.position();var dims=getElemDims(elem);props.absPos={left:offset.left,top:offset.top,right:(offset.left+dims.outerWidth),bottom:(offset.top+dims.outerHeight),};props.offsetPos={left:position.left,top:position.top,right:(position.left+dims.outerWidth),bottom:(position.top+dims.outerHeight)};props.viewportOffset={left:offset.left-theWindow.scrollLeft(),top:offset.top-theWindow.scrollTop()};props.offsetParent=elem.offsetParent();props.fixed=(hasFixedParents(elem,true));if(hidden){elem.hide().css({opacity:opacity});}
return props;},positionElem,hasFixedParents,_getBestFit=function(viewportOffset,triggerDims,targetDims,offset,posDefaults,preferBottom,attemptToFit){var position=_.defaults(posDefaults||{},{vertical:'bottom',horizontal:'left'});if(position.horizontal=='center'){var targetLeft=viewportOffset.left+(triggerDims.outerWidth / 2)-(targetDims.outerWidth / 2);var targetRight=targetLeft+targetDims.outerWidth;if(targetLeft<0||targetRight>theWindow.width()){position.horizontal='left';}}
if(position.horizontal=='left'){if((viewportOffset.left+targetDims.outerWidth-offset.left)>theWindow.width()){position.horizontal='right';}}else if(position.horizontal=='right'){if((viewportOffset.right-targetDims.outerWidth+offset.left)<0){position.horizontal='left';}}
if(attemptToFit){if(position.vertical=='top'||preferBottom){if((viewportOffset.top-targetDims.outerHeight-offset.top)<0){position.vertical='bottom';}}else{if((viewportOffset.top+triggerDims.outerHeight+targetDims.outerHeight+offset.top)>theWindow.height()){position.vertical='top';}}}
return position;},getElemDims,naturalWidth=function(elem){return _getNatural(elem,'Width');},naturalHeight,lineHeight,_getNatural;return{getElemPosition:getElemPosition,getElemDims:getElemDims,positionElem:positionElem,hasFixedParents:hasFixedParents,naturalWidth:naturalWidth,naturalHeight:naturalHeight,lineHeight:lineHeight};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.responsive',function(options){options=$.extend({breakpoints:{980:'desktop',768:'tablet',0:'phone'}});var self=this,previousBreakpoint=[],currentBreakpoint=[],breakpointsBySize={},breakpointsByKey={},callbacks={};var currentIs,getCurrentKey,getAllBreakpoints,addBreakpoint,addCallback,checkForBreakpointChange,executeCallbacks,getCurrentBoundary,init=function(){$.each(options.breakpoints);$(window).resize(windowResize);checkForBreakpointChange();},windowResize,enabled;init();return{addBreakpoint:addBreakpoint,addCallback:addCallback,currentIs:currentIs,getCurrentKey:getCurrentKey,getAllBreakpoints:getAllBreakpoints,enabled:enabled}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.selection',function(){var getSelectedText;var getRange;var getSelection;var _isChild;return{getSelectedText:getSelectedText,getSelection:getSelection,getRange:getRange};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.time',function(){var _supportsLocale=null;var readable=function(timestamp){var date=new Date();var time=date.getTime()/ 1000;var dst=0;var now=time+dst;var elapsed=now-timestamp;if(elapsed<60){return ips.getString('time_just_now');}else if(elapsed<3600){return ips.pluralize(ips.getString('time_minutes_ago'),Math.floor(elapsed / 60));}else if(elapsed<5400){return ips.getString('time_1_hour_ago');}else if(elapsed<86400){return ips.pluralize(ips.getString('time_hours_ago'),Math.floor(elapsed / 3600));}else{var dateObj=new Date(timestamp*1000);var format=localeTimeFormat($('html').attr('lang'));var time=formatTime(dateObj,format);var timeParts=ips.getString('time_at')?[localeDateString(dateObj),ips.getString('time_at')]:[localeDateString(dateObj)];timeParts.push(time);return ips.getString('time_other',{time:timeParts.join(' ')});}},getDateFromInput,removeTimezone,isDST,isValidDateObj,timestamp,localeDateString,supportsHTMLDate,formatTime,localeTimeFormat,_checkLocaleSupport,_getLocaleTimeFormatsq':{format:'%H:%M'},'sr-cyrl':{format:'%k:%M'},'sr':{format:'%k:%M'},'sv':{format:'%H:%M'},'ta':{format:'%H:%M'},'th':{format:'%k à¸™à¸²à¸¬à¸´à¸à¸² %N à¸™à¸²à¸—à¸µ'},'tl-ph':{format:'%H:%M'},'tr':{format:'%H:%M'},'tzl':{format:'%H.%M'},'tzm-latn':{format:'%H:%M'},'tzm':{format:'%H:%M'},'uk':{format:'%H:%M'},'uz':{format:'%H:%M'},'vi':{format:'%H:%M'},'zh-cn':{format:'%p%lç‚¹%Måˆ†',meridiem:defaultMeridiem}ž%Måˆ†',mString,isValidue){if(pageNum==!==null&&!_.');}
var newKfined(match[0])){lue,key){retubject(uriOURIObject=function(url){return parseUri(url||window.location.href);},getOrigin=function(){if(!_origin){var url=getURIObject();_origin=url.protocol+'://'+url.host+((url.port!=='')?':'+url.port:'');}
return _origin;};function parseUri(str){var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||"";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2;});return uri;};parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?;}
if(field.is('input[type="nmin=fievar i in this.ligin:'',initialize:function(){this.on('click','[data-action="preview"]',this.fetchPreview);},fetchPreview:function(data){var scope=$(this.scope);$('#'+scope.attr('data-name')+'_preview').addClass('ipsLoaetValue()}}).done(function(response){$('#'+scope.attr('data-name')+'_preview').removeClass('ipsLoading').html(response);});}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.customtags',{editorWrap:null,editorSidebar:null,editorSidebarHeader:null,editorSidebarthis;this.editorWrap=rSidebarLi('textarea[name="'+this.scope.attr('data-tagFieldID')+'"]').closest('[data-ipsEditor]').data('_editor').insertHtml(content);}else if(this.scope.attr('data-tagFieldType')=='codemirror'){this.scope.trigger('codeMirrorInsert',{elemID:$(e.currentTarget).closest('[data-codemirrorid]').attr('data-codemirrorid'),tag:content});}else{var textField=$('#'+this.scope.attr('data-tagFieldID'));textField.focus().insertText(content,textField.getSelection().start,'collapseToEnd');}}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.registe,'[data-roleldEmoji(emoji,ips.utils.cookie.get('emojiSkinTone'),null,categories);}.bind(this),100);}.bind(this));},insertEmoji:function(e){this.trigger($(document),'insertEmoji',{editorID:this.editorID,emoji:$(e.currentTarget).attr('data-emoji'),});this.scope.find('[data-role="emoticonSearch"]').val('');this.scope.trigger('closeMenu');ips.utils.emoji.getEmoji(function(emoji,categories){this._buildEmoji(emoji,ips.utils.cookie.get('emojiSkinTone'),null,categories);}.bind(this));},_buildEmoji:function(emoji,tone,search,categories){var finalHtml='';var categoryHtml='';var pos=0;var emojiForThisRow='';var menuContent=[];if(!search&&ips.utils.cookie.get('recentEmoji')){var recentlyUsed=ips.utils.cookie.get('recentEmoji').split(',');var newRecentlyUsed=[];if(recentlyUsed.length){for(var i=0;i<recentlyUsed.length;i++){if(ips.utils.emoji.canRender(recentlyUsed[i])){var displayHtml=ips.utils.emoji.preview(recentlyUsed[i]);if(displayHtml){newRecentlyUsed.push(recentlyUsed[i]);emojiForThisRow+=ips.templates.render('core.editor.emoji',{display:displayHtml,name:null,code:recentlyUsed[i]});if(newRecentlyUsed.length==8||newRecentlyUsed.length==16){categoryHtml+=ips.templates.render('core.editor.emoticonRow',{emoticons:emojiForThisRow});emojiForThisRow='';}}}}
if(emojiForThisRow){categoryHtml+=ips.templates.render('core.editor.emoticonRow',{emoticons:emojiForThisRow});}
if(categoryHtml){finalHtml+=ips.templates.render('core.editor.emoticonCategory',{title:ips.getString('emoji-category-recent'),categoryID:category,emoticons:categoryHtml});categoryHtml='';emojiForThisRow='';}}
if(newRecentlyUsed!=recentlyUsed){ips.utils.cookie.set('recentEmoji',newRecentlyUsed.join(','),true);}}
for(var i in categories){var category=categories[i];var categoryCount=0;for(var i=0;i<emoji[category].length;i++){if(search){var match=false;if(emoji[category][i].name.match(search)){match=true;}
if(!match&&emoji[category][i].shortNames){for(var j=0;j<emoji[category][i].shortNames.length;j++){if(emoji[category][i].shortNames[j].match(search)){match=true;}}}
if(!match&&emoji[category][i].ascii){for(var j=0;j<emoji[category][i].ascii.length;j++){if(emoji[category][i].ascii[j].match(search)){match=true;}}}
if(!match){continue;}}
var codeToUse=emoji[category][i].code;if(emoji[category][i].skinTone&&tone&&tone!='none'){codeToUse=ips.utils.emoji.tonedCode(codeToUse,tone);}
emojiForThisRow+=ips.templates.render('core.editor.emoji',{display:ips.utils.emoji.preview(codeToUse),name:ips.haveString('emoji-'+emoji[category][i].name)?ips.getString('emoji-'+emoji[category][i].name):emoji[category][i].name,code:codeToUse});pos++;categoryCount++;if(pos==8){categoryHtml+=ips.templates.render('core.editor.emoticonRow',{emoticons:emojiForThisRow});pos=0;emojiForThisRow='';}}
if(!search){if(pos){categoryHtml+=ips.templates.render('core.editor.emoticonRow',{emoticons:emojiForThisRow});}
if(categoryHtml){var categoryTitle=['smileys_people','animals_nature','food_drink','activities','travel_places','objects','symbols','flags'].indexOf(category)==-1?emoji[category][0].categoryName:ips.getString('emoji-category-'+category);finalHtml+=ips.templates.render('core.editor.emoticonCategory',{title:categoryTitle,categoryID:category,emoticons:categoryHtml});categoryHtml='';pos=0;emojiForThisRow='';menuContent.push(ips.templates.render('core.editor.emoticonMenu',{title:categoryTitle,count:categoryCount,categoryID:category}));}}}
if(search){$(this.scope).find('[data-role="categoryTrigger"]').hide();if(pos){categoryHtml+=ips.templates.render('core.editor.emoticonRow',{emoticons:emojiForThisRow});}
if(categoryHtml){finalHtml=ips.templates.render('core.editor.emoticonSearch',{emoticons:categoryHtml});}else{finalHtml=ips.templates.render('cor'[data-role="categoryTrigger"]').show();$(this.scope).find('[data-role="categoryMenu"]').html(menuContent.join(''));}
this.scope.find('.ipsMenu_innerContent').html(finalHtml);var replaceEmojiInCategory=function(category){var emoji=category.querySelectorAll('img[data-src]');_.each(emoji,function(img){img.setAttribute('src',img.getAttribute('data-src'));img.addEventListener('load',emojiLoaded);});};var emojiLoaded=function(e){e.target.removeAttribute('data-loading');};this.scope.find('.ipsMenu_innerContent .ipsEmoticons_category').each(function(){ips.utils.lazyLoad.observe(this,{preloadCallback:$.noop,imgLoadedCallback:$.noop,loadedCallback:$.noop,loadCallback:function(category){replaceEmojiInCategory(category);var nextCategory=$(this).next('.ipsEmoticons_category');if(nextCategory.length){replaceEmojiInCategory(nextCategory.get(0));}}},{rootMargin:'400px'});});if(ips.getSetting('emoji_style')!='disabled'&&(ips.getSetting('emoji_style')!='native'||ips.utils.emoji.canRender('1F44D-1F3FB'))){this.scope.find("[data-role='skinToneMenu']").show();switch(tone){case'light':this.scope.find("[data-role='skinToneIndicator']").text(String.fromCodePoint(parseInt('1F44D',16))+String.fromCodePoint(parseInt('1F3FB',16)));break;case'medium-light':this.scope.find("[data-role='skinToneIndicator']").text(String.fromCodePoint(parseInt('1F44D',16))+String.fromCodePoint(parseInt('1F3FC',16)));break;case'medium':this.scope.find("[data-role='skinToneIndicator']").text(String.fromCodePoint(parseInt('1F44D',16))+String.fromCodePoint(parseInt('1F3FD',1nt(parseInt('1F3FF',16)));break;default:this.scope.find("[data-role='skinToneIndicator']").text(String.fromCodePoint(parseInt('1F44D',16)));break;}}},changeSkinTone:function(e,data){ips.utils.emoji.getEmoji(function(emoji,categories){this._buildEmoji(emoji,data.selectedItemID,this._lastVal?new RegExp(this._lastVal.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),'i'):null,categories);}.bind(this));ips.utils.cookie.set('eearch"]').focypeTimer){doSearch(textElhis));},_doSearch:futils.lazyLoad.ng"]').text(ips.getString('editorImageMaxHeight',{'maxheight':heightInput.attr('max')}));}
if(!error){var editor=$('.cke.'+this.scope.attr('data-editorUniqueId')).closest('[data-ipsEdi"use sedItems:{function(){Item');if(thisT.addClass('ipsD).removeClatem));});thista('_editor');var n.positionElem(pozIndex:ips.ui.zIndexut(function(){if(selfctedButton();},_checkSelectedButton:function(){var button=this.scope.find('[data-action="insertSelected"]');this.scope.find('[data-action="clearAll"]').toggleClass('ipsButton_disabled',!(_.size(this._selectedItems)>0));button.toggleClass('ipsButton_disabled',!(_.size(this._selectedItems)>0));if(!_.size(this._selectedItems)){button.text(ips.getString('insertSelected'));}else{button.text(ips.pluralize(ips.getString('insertSelectedNum'),_.size(this._selectedItems)));}},_buildInsertData:function(element){var element=element.closest('.ipsAttach');var fileID=element.attr('data-fileid');var type=(element.attr('data-fileType'))?element.attr('data-fileType'):'file';var url='';var image='';var extension='';var mimeType='';if(type=='image'){url=(element.attr('data-thumbnailurl'))?element.attr('data-thumbnailurl'):element.attr('data-fullsizeurl');if(url!=element.attr('data-fullsizeurl')){image=element.attr('data-fullsizeurl');}}else if(type=='video'){image=element.attr('data-fullsizeurl');mimeType=element.attr('data-mimeType');}else{url=(element.attr('data-filelink'))?element.attr('data-filelink'):'';}
extension=element.closest('[data-extension]').attr('data-extension');return{fileID:fileID,type:type,title:(type!='image')?element.find('[data-role="title"]').html():'',link:url,fullImage:image,extension:extension,mimeType:mimeType};},_buildInsert:function(item){var element=null;if(item.type=='image'){element=$('<img/>').attr({'data-fileid':item.fileID,'src':item.link,'data-unique':Math.random().toString(36).substr(2,9)}).addClass('ipsImage ipsImage_thumbnailed');if(item.extension){element.attr('data-extension',item.extension);}
if(item.fullImage){var link=$('<a>').attr('href',item.fullImage).addClass('ipsAttachLink ipsAttachLink_image');element.addClass('ipsImage_thumbnailed');link.append(element);element=link;}}else if(item.type=='video'){var element=$('<video controls>').attr({'class':'ipsEmbeddedVideo','data-controller':'core.global.core.embeddedvideo','data-fileid':item.fileID,'data-unique':Math.random().toString(36).substr(2,9)});var sourceElement=$('<source>').attr({'src':item.fullImage,'type':item.mimeType});element.append(sourceElement);var fallbackLink=$('<a>').addClass('ipsAttachLink').attr('href',ips.getSetting('baseURL')+'applications/core/interface/file/attachment.php?id='+item.fileID).html(item.title);element.append(fallbackLink);}else{element=$('<a>').addClass('ipsAttachLink').html(item.title).attr('data-fileid',item.fileID).attr('data-filension',iteml();}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.link',{_typingTimer:null,_textTypingTimer:null,_ajaxObj:null,initialize:function(){this.on('submit','form',this.formSubmit);this.on('click','.cEditorURLButtonInsert',this.formSubmit);this.on('click','[data-action="linkRemoveButton"]',this.removeLink);this.scope.find('[data-role="linkURL"]').focus();},formSubmit:function(e){e.preventDefault();this.insertLink(e);},insertLink:function(e){var url=this.scope.find('[data-role="linkURL"]').val();if(!url){$(this.scope).find('.ipsFieldRow').addClass('ipsFieldRow_error');return;}else{$(this.scope).find('.ipsFieldRow').removeClass('ipsFieldRow_error');}
if(!url.match(/^[a-z]+\:\/\//i)&&!url.match(/^mailto\:/i)&&!url.match(/^\#/)){url='http://'+url.replace(/^\/*/,'');}
var editor=CKEDITOR.instances[$(this.scope).data('editorid')];var selection=editor.getSelection();if(!_.isUndefined(editor._linkBookmarks)){selection.selectBookmarks(editor._linkBookmarks);delete editor._linkBookmarks;}
var selectedElement=selection.getSelectedElement();if(selectedElement&&selectedElement.is('img')){var selectedElement=$(selection.getSelectedElement().$);if(!selectedElement.parent().is('a')){var element=CKEDITOR.dom.element.createFromHtml("<a href='"+url.replace(/'/g,'%27').replace(/"/g,'%22').replace(/</g,'%3C').replace(/>/g,'%3E')+"'>"+selectedElement[0].outerHTML+"</a>");editor.insertElement(element);}
else{selectedElement.parent().attr('href',url.replace(/'/g,'%27').replace(/"/g,'%22').replace(/</g,'%3C').replace(/>/g,'%3E')).removeAttr('data-cke-saved-href');}
this.scope.find('input.cEditorURL').val('');this.trigger('closeDialog');}else{if($(this.scope).data('image')){this.scope.find('[data-role="linkURL"]').addClass('ipsField_loading');this.scope.find('[data-action="linkButton"]').prop('disabled',true);var scope=this.scope;var self=this;var img=new Image();img.onerror=function(){scope.find('[data-role="linkURL"]').removeClass('ipsField_loading');scope.find('[data-action="linkButton"]').prop('disabled',false);scope.find('.ipsFieldRow').addClass('ipsFieldRow_error');};img.onload=function(){var ajaxUrl=editor.config.controller+'&do=validateLink'
if($(this.scope).attr('data-image')){ajaxUrl+='&image=1';}
ips.getAjax()(ajaxUrl,{data:{url:url.replace(/'/g,'%27').replace(/"/g,'%22').replace(/</g,'%3C').replace(/>/g,'%3E'),width:img.width,height:img.height,image:1},type:'post'}).done(functi;editor.insertHtml(response.preview);self.trigger('closeDialog');}else{scope.find('[data-role="linkURL"]').removeClass('ipsField_loading');scope.find('[data-action="linkButton"]').prop('disabled',false);scope.find('.ipsFieldRow').addClass('ipsFieldRow_error');}}).fail(function(){scope.find('[data-role="linkURL"]').removeClass('ipsField_loading');scope.find('[data-action="linkButton"]').prop('disabled',false);scope.find('.ipsFieldRow').addClass('ipsFieldRow_error');});}
img.src=url;}else{if(this.scope.find('[data-role="linkText"]').length){var title=this.scope.find('[data-role="linkText"]').valtitle+"</a>");}
elsentroller.registif(this._ajax&&itorID}};ajaxData.data[this._editorID]=data.editorContent;ips.getAjax()(data.url,ajaxData).done(function(response){varsponseeight:$(documenaddUploaderFile',this.addUploaderFile);this.on('removeAllFiles',this.removeAllFiles);this.on('fileDeleted',this.fileDeleted);this.setup();},setup:function(){this.scope.find('[data-role="fileContainer"]').each(function(){if($(this).children().length>0){$(this).parent().removeClass('ipsHide');}});},removeAllFiles:function(e,data){this.scope.find('[data-role="files"], [data-role="images"], [data-role="videos"]').hide();this.scope.find('[data-role="fileList"]').hide();},addUploaderFile:function(e,data){e.stopPropagation();varthis.scope.find('[data-role="files"]');template+='fileItem';}
container.show().find('[data-role="fileContainer"]').append(ips.templates.render(template,data));},fileDeleted:function(e,data){var count=0;this.scope.find('[data-role="fileContainer"]').each(function(){if(!$(this).find('.ipsAttach').length){$(this).closest('[data-role="files"], [data-role="images"], [data-role="videos"]').hide();count++;}});if(count==3){this.scope.find('[data-role="fileList"]').hide();}}});}(jQuery,_));;