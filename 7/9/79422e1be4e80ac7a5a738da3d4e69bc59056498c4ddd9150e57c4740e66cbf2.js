"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5805],{45805:function(e,t,i){i.r(t),i.d(t,{SessionRecording:);var n=i(87462),r=i(67294),a=i(45697),o=i.n(a),s=i(41451),c=i(86854),d=i(15671),g=i(43144),u=i(71002),l=i(30434),f=l.X.getItem,v=l.X.setItem,h="rdc:recording-session",y=(new Date).getTime()+18e5,p=m=function e(t,i){return Object.keys(t).forEach((function(n){if(t[n]){var r="".concat(n).concat(k(t[n]));i[r]=t[n],"object"===(0,u.Z)(t[n])?i[r]=e(t[n],{}):i[r]=t[n]}})),i},k=function(e){var t={string:"_str",boolean:"_bool",object:"_obj"};return t[(0,u.Z)(e)]?t[(0,u.Z)(e)]:""},R=D=function(e,t,i){return function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(i||"debug"===f("rdc.recording.log"))&&console.log("%c[".concat(e,"]:"),"color: ".concat(t),n,r)}},_="feature-variable",w=function(){function e(t){var i=this,n=t.eventData,r=t.triggers,a=t.startRecording,o=t.deferRecording,s=t.trackEvent;(0,d.Z)(this,e),this._trackDecision=this.eventData=n,this.triggers=r,this.startRecording=a,this.deferRecording=o,this.trackEvent=s,this.log=D("RecordingDecision","#06C6F1")}return(0,g.Z)(e,[{key:"getIdentifier",value:function(){var e=this.eventData,t=e.type,i=e.decisionInfo;return"".concat(t,":").concat(i.featureKey||i.experimentKey)}},{key:"evaluate",value:function(){var e=this.eventData,t=e.decisionInfo;e.type===_&&this._testExperiment(t)}},{key:"_testExperiment",value:function(e){var t=e.sourceInfo||e,i=t.experimentKey,n=t.variationKey;if(this.triggers[i]){this.log('experiment "'.concat(i,'" is considered for recording'));var r=this.triggers[i];if(r.variations&&!r.variations.includes(n))return void this.log('served variation "'.concat(n,'" is not a listed recording candidate'),{variations:r.variations});if(r.deferred||(this.log("experiment qualifies session for immediate recording"),this.startRecording(this._trackDecision)),r.deferred){if(!r.trigger)return void this.log("attempted to defer recording but no trigger was specified");this.log("experiment qualifies session for deferred recording",{trigger:r.trigger}),this.deferRecording(r.trigger,this._trackDecision)}}}}]),e}(),b=i(43550),I=l.X.getItem,E=1e3,x=10,O=function(){function e(t){var i=this,n=t.config,r=void 0===n?{}:n,a=t.userId,o=t.userData;(0,d.Z)(this,e),this._pollForAnalyticsOnWindow=function(e,t){"undefined"!==typeof window&&(t<=0?i.log("window.analytics availablity timeout"):setTimeout((function(){R()?(i.log("window.analytics is available"),i._registerAnalyticTriggers(i.triggers.analytics),Object.keys(i.deferredRecordingQueue).length&&(i.log("registering ".concat(Object.keys(i.deferredRecordingQueue).length," queued handlers")),Object.entries(i.deferredRecordingQueue).forEach((function(e){var t=(0,c.Z)(e,2),n=(t[0],t[1]);i._addAnalyticsTrackEventhandler(n)})))):(i.log("window.analytics is undefined. Checking in ".concat(e,"ms. ").concat(t," more attempts")),i._pollForAnalyticsOnWindow(e,t-1))}),e))},this._registerAnalyticTriggers=function(e){for(var t=0;t<e.length;t++){var n=e[t];i.deferRecording(e[t],i.trackEvent,["click",{name:n}])}},this._featureDecisionHandler=function(e){var t=new w({eventData:e,triggers:i.triggers.experiments,startRecording:i.startRecording,deferRecording:i.deferRecording,trackEvent:i.trackEvent});i._isCachedDecision(t)||(i.decisionCache[t.getIdentifier()]=t.eventData,t.evaluate())},this._registerDeferedRecording=function(e){R()?i._addAnalyticsTrackEventhandler(e):(i.log("window.analytics not in ready state"),i.deferredRecordingQueue[e.event]||(i.log("adding handler to deferred queue"),i.deferredRecordingQueue[e.event]=e))},this.trackEvent=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e&&Object.keys(t).length&&(i.log("track custom event",{event:e,data:p(t)}),b.B(e,p(t)))},this.deferRecording=function(e,t,n){i.log("defer recording");var r=function(r,a,o){"click"===r&&a.label===e&&(i.log("deferred trigger fired",e),i.startRecording(),t.apply(void 0,(0,s.Z)(n)))};r.event=e,i._registerDeferedRecording(r)},this.deferredRecordingQueue={},this.decisionCache={},this.triggers=r.triggers||{},this.userId=a,this.log=D("RecordingManager","#bada55"),this.userData=o}return(0,g.Z)(e,[{key:"_isCachedDecision",value:function(e){return Object.keys(this.decisionCache).includes(e.getIdentifier())}},{key:"_addAnalyticsTrackEventhandler",value:function(e){var t,i;(t="track",i=e.event,window.analytics.listeners(t).some(())?this.log("trigger event already exists on TRACK event"):(this.log("adding handler to analytics TRACK event"),window.analytics.on("track",e))}},{key:"_identifyUser",value:function(){var e={displayName:this.userId};this.log("identify user",{id:this.userId,userVars:e}),b.yV(this.userId,e)}},{key:"_addUserData",value:function(){this.userData&&(b.y_(this.userData),this.userData.pageName&&b.kA("page",{pageName:this.userData.pageName}))}},{key:"stopRecording",value:,{key:"startRecording",value:function(e){this.log("start recording"),this._identifyUser(),this._addUserData(),b.ur(),v(h,y),"function"===typeof e&&(this.log("invoking startRecording callback"),e())}},{key:"init",value:function(){this._pollForAnalyticsOnWindow(E,x),b.S1({debug:I("fs.debug")||!1,orgId:"ZPS06"})}},{key:"addDecisionListener",value:]),e}(),j=i(29424),C=i(90998),T=(0,r.memo)((function(e){var t=e.config,i=e.userId,a=e.recordOnInit,o=e.experimentHandler,s=e.customizedUserData,c=D("SessionRecording","#D20E91"),d=(0,j.y)(),g=d.optimizely,u=d.status;return(0,r.useEffect)((function(){if(!window._fs_initialized&&"ready"===u&&g){var e=(0,C.O)()||"",r=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0,n=((null===(e=t.instance)||void 0===e?void 0:e.getOptimizelyConfig())||{}).featuresMap,r=void 0===n?{}:n;return Object.keys(r).map((function(e){if(r[e]&&r[e].experimentRules&&r[e].experimentRules.length>0){var n=t.instance.getVariation(r[e].experimentRules[0].key,i);if(n)return"".concat(r[e].experimentRules[0].key,":").concat(n)}})).filter(()}(g,e),d={abTestId:r.toString()},l=(0,n.Z)({},s,{},d),v=new O({config:t,userId:i,experimentHandler:o,userData:l});c("Initialize"),v.init(),v.stopRecording(),(a||function(){var e=f(h);return!!(e&&parseInt(e)>(new Date).getTime())}())&&v.startRecording(),o&&v.addDecisionListener(o)}}),[u,g,i]),r.createElement(r.Fragment,null)}));T.propTypes={config:o().shape({triggers:o().shape({experiments:o().object,analytics:o().arrayOf(o().string)})}),userId:o().string,recordOnInit:o().bool,experimentHandler:o().func,customizedUserData:o().object},T.defaultProps={config:{triggers:{experiments:{},analytics:[]}},recordOnInit:!1,customizedUserData:void 0}}}]);