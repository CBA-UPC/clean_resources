(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[752],{"5ezV":function(e,t,i){"use strict";i.r(t),i.d(t,"CacheKeys",(function(){return C})),i.d(t,"SharepointInformationProtectionService",(function(){return k}));var r=i("a9wj"),s=i("ki/R"),a=i("hBZP"),o=i("7J8z"),n=i("aFvx"),l=i("graM"),c=i("PJyT"),d=i("kxAM"),p=i("Ito+"),h=i("TVWn");let g;const u={allowedAttributes:["term","scheme","rel","href","type","m:null","m:type"],allowedNamespaces:["http://www.w3.org/2005/Atom","http://schemas.microsoft.com/ado/2007/08/dataservices/metadata","http://schemas.microsoft.com/ado/2007/08/dataservices","http://www.georss.org/georss","http://www.opengis.net/gml"],allowedTags:["entry","id","category","link","title","updated","author","name","content","m:properties","d:AppliedActionsText","d:ComplianceUrl","d:GeneralText","d:OverrideOptions","d:LastProcessedTime","d:MatchedConditionDescriptions","d:element","d:TwoLetterISOLanguageName","d:GetDlpPolicyTip"]};function m(e,t){const i=e.getElementsByTagName(t);return 1===i.length&&i[0].textContent?i[0].textContent:""}function b(e,t){const i=e.getElementsByTagName(t);let r=[];if(1===i.length)for(let e=0;e<i[0].children.length;e+=1)r.push(i[0].children[e].textContent||"");return r}var y;!y||(y={}));const v=2e4;function f(e){var t;const i=null==e||null===(t=e.value)||void 0===t?void 0:t.filter((e=>{if(e["@odata.type"]===y.Metadata)return e}));return 1===i.length?i[0]:void 0}const w={maxRetries:2,backoffFn:Object(n.b)(500),filter:Object(l.c)([408,409,429])},P=["InformationProtectionPolicy.Read"];function L(e){return{metadata:[{name:`MSIP_Label_${e}_Enabled`,value:"true"}]}}async function I(e,t,i,r,s){const a={contentInfo:r||L(t),labelingOptions:{labelId:t,downgradeJustification:{isDowngradeJustified:!!i,justificationMessage:i||""}}},o=await Object(c.b)((t=>e.getToken(P,t)),"https://graph.microsoft.com/beta/me/security/informationProtection/sensitivityLabels/evaluateApplication","EvaluateApplication",s,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},void 0,v);if(!o.ok||200!==o.status)throw new Error(`evaluateLabelApplication failed with status : ${o.status}`);const n=await o.json(),l=function(e){var t;const i=null==e||null===(t=e.value)||void 0===t?void 0:t.filter((e=>{if(e["@odata.type"]===y.Watermark)return e}));return 1===i.length?i[0]:void 0}(n),d=f(n);return null!=d&&d.metadataToAdd?{changeLabel:!0,contentInfo:{metadata:d.metadataToAdd},watermark:l}:{changeLabel:!1}}var C,T=i("OUob"),O=i("tnSK"),j=i("/QHu"),R=i("ZgE7"),S=i("ef5c"),E=i("uAd/"),M=i("zlnT");!C||(C={}));class k extends a.EventEmitter{nc getCurrentLabel(e){if(!Object(r.e)(e))return void(this.props.logger&&Object(S.c)(this.props.logger,{eventName:T.a.InvalidResolvedUrl,scenario:j.a.GetAppliedLabel}));const t=this.getCacheKey(C.AppliedLabel,e.hashedDocumentId);let i=this.PromiseCache.get(t);if(i)return i;const a=E.a.start("GetAppliedLabel",this.props.logger),o=Object(s.b)(e.siteUrl,this.props.logger);if(o)return i=new Promise((async t=>{try{const i=await async function(e,t,i,r,s,a){const o=`https://graph.microsoft.com/beta/sites/${new URL(r).hostname}/drives/${i}/items/${t}/extractSensitivityLabels`,n=await Object(c.b)((t=>e.getToken(["files.readwrite.all"],t)),o,"extractSensitivityLabels",a,s,{method:"POST"},void 0,v);if(!n.ok||200!==n.status)throw new Error(`extractInformationProtectionContentLabels failed with status : ${n.status}`);return(await n.json()).labels.find(()}(this.props.tokenProvider,e.itemId,e.driveId,e.siteUrl,o,this.props.logger);return this.monitorAppliedLabel(e),this.processPolicySettings(e,i),a.setResult(!0,{appliedLabel:!!i,assignmentMethod:null==i?void 0:i.assignmentMethod}),t(i)}catch(e){return a.setResult(!1,{errorType:T.a.GetAppliedLabelError},e),t(void 0)}})),this.PromiseCache.set(t,i),i;a.setResult(!1,{errorType:T.a.InvalidTenantId})}async getHasProtection(e){if(!Object(r.e)(e))return void(this.props.logger&&Object(S.c)(this.props.logger,{eventName:T.a.InvalidResolvedUrl,scenario:j.a.GetIsProtectionEnabled}));const t=this.getCacheKey(C.IsProtectionEnabled,e.hashedDocumentId);let i=this.PromiseCache.get(t);if(i)return i;const s=E.a.start("IsProtectionEnabled",this.props.logger);return i=new Promise((async t=>{const[i,r]=await Promise.all([this.getCurrentLabel(e),this.getLabels()]);if(!r)return s.setResult(!1,{hasProtection:!1,appliedLabel:!!i,allLabels:!!r}),t(void 0);let a=!1;if(i){const e=Object(o.a)(r,i.sensitivityLabelId);a=!(null==e||!e.hasProtection)}return s.setResult(!0,{appliedLabel:!!i,allLabels:!!r,hasProtection:a}),t(a)})),this.PromiseCache.set(t,i),i}async getIrmInformation(e){if(!Object(r.e)(e))return void(this.props.logger&&Object(S.c)(this.props.logger,{eventName:T.a.InvalidResolvedUrl,scenario:j.a.GetIrmCapabilities}));const t=this.getCacheKey(C.IrmCapabilities,e.hashedDocumentId);let i=this.PromiseCache.get(t);if(i)return i;const s=E.a.start("GetIrmCapabilities",this.props.logger);return i=new Promise((async t=>{try{const i=await async function(e,t,i,r,s){const a=Object(d.a)(r),o={getToken:s=>{const o={...s,siteUrl:r,driveId:i,itemId:t};return e.getToken([`${a}/files.readwrite.all`],o)},url:`${r}/_api/v2.1/drives/${i}/items/${t}/opStream/capabilities?$select=canWrite,canPrint,canExtract,supportsCLP`,retryPolicy:w,timeoutMs:v},n=s?await Object(p.b)({...o,logger:s,nameForLogging:"GetItemIrmCapabilities",getAdditionalProps:async(e,t)=>Object(h.a)(e)}):await Object(p.a)(o);if(!n.result.ok||200!==n.result.status)throw new Error(`getItemIrmCapabilities failed with status : ${n.result.status}`);return await n.result.json()}(this.props.tokenProvider,e.itemId,e.driveId,e.siteUrl,this.props.logger);return s.setResult(!0,{supportsCLP:i.supportsCLP,canWrite:i.canWrite,canExtract:i.canExtract,canPrint:i.canPrint}),t(i)}catch(e){return s.setResult(!1,{errorType:T.a.GetIrmCapabilitiesError},e),t(void 0)}})),this.PromiseCache.set(t,i),i}async getPolicySettings(){let e=this.PromiseCache.get(C.PolicySettings.toString());if(e)return e;const t=E.a.start("GetPolicySettings",this.props.logger);return e=new Promise((async e=>{try{const i=await async function(e,t){const i=await Object(c.b)((t=>e.getToken(P,t)),"https://graph.microsoft.com/beta/me/security/informationProtection/labelPolicySettings","GetPolicySettings",t,void 0,void 0,void 0,v);if(!i.ok||200!==i.status)throw new Error(`getPolicySettings failed with status : ${i.status}`);return await i.json()}(this.props.tokenProvider,this.props.logger);return t.setResult(!0,{infoUrl:!!i.moreInfoUrl,isMandatory:i.isMandatory,isDefault:!!i.defaultLabelId,isDowngradeJustificationRequired:i.isDowngradeJustificationRequired}),e(i)}catch(i){return t.setResult(!1,{errorType:T.a.GetPolicySettingsError},i),e(void 0)}})),this.PromiseCache.set(C.PolicySettings.toString(),e),e}async getWatermarkInformation(e){if(!Object(r.e)(e))return void(this.props.logger&&Object(S.c)(this.props.logger,{eventName:T.a.InvalidResolvedUrl,scenario:j.a.GetWatermarking}));const t=this.getCacheKey(C.Watermark,e.hashedDocumentId);let i=this.PromiseCache.get(t);if(i)return i;const s=E.a.start("GetWatermarking",this.props.logger);return i=new Promise((async t=>{try{const i=await this.getCurrentLabel(e);if(i){const e=await I(this.props.tokenProvider,i.sensitivityLabelId);return this.labelMetadataCache=e.contentInfo,s.setResult(!0,{appliedLabel:!0,isWatermark:!!e.watermark,isContentInfo:!!e.contentInfo}),t(e.watermark)}return s.setResult(!0,{appliedLabel:!!i}),t(void 0)}catch(e){return s.setResult(!1,{errorType:T.a.GetWatermarkingError},e),t(void 0)}})),this.PromiseCache.set(t,i),i}async overrideDlpPolicyTip(e){throw new Error("Not Implemented..")}async getLabels(){let e=this.PromiseCache.get(C.Labels.toString());if(e)return e;const t=E.a.start("GetLabels",this.props.logger);return e=new Promise((async e=>{try{const i=await async function(e,t){const i=await Object(c.b)((t=>e.getToken(P,t)),"https://graph.microsoft.com/beta/me/security/informationProtection/sensitivityLabels?$filter=contentFormats/any(s:s eq 'file')","GetPolicyLabels",t,void 0,void 0,void 0,v);if(!i.ok||200!==i.status)throw new Error(`getPolicyLabel failed with status : ${i.status}`);return(await i.json()).value}(this.props.tokenProvider,this.props.logger);return t.setResult(!0),e(i)}catch(i){return t.setResult(!1,{errorType:T.a.GetLabelsError},i),e(void 0)}})),this.PromiseCache.set(C.Labels.toString(),e),e}async changeLabel(e,t){if(!Object(r.e)(e))return!1;const i=await async function(e,t,i,r,s,a){const o=Object(d.a)(r);let n={...s};s.id||(n.id=null);const l={getToken:s=>{const a={...s,siteUrl:r,driveId:i,itemId:t};return e.getToken([`${o}/files.readwrite.all`],a)},url:`${o}/_api/v2.0/drives/${i}/items/${t}/setSensitivityLabel`,requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},retryPolicy:w,timeoutMs:v};return 200===(a?await Object(p.b)({...l,logger:a,nameForLogging:"SetLabel",getAdditionalProps:async(e,t)=>Object(h.a)(e)}):await Object(p.a)(l)).result.status}(this.props.tokenProvider,e.itemId,e.driveId,e.siteUrl,t,this.props.logger);return i&&this.refreshAppliedLabel(e),i}async setCurrentLabel(e,t){if(!Object(R.c)(this.props.settingsProvider))return E.a.start("SetLabel",this.props.logger).setResult(!1,{settingName:R.d,settingValue:Object(R.c)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),!1;if(!Object(r.e)(e))return this.props.logger&&Object(S.c)(this.props.logger,{eventName:T.a.InvalidResolvedUrl,scenario:j.a.SetLabel}),!1;const i=E.a.start("SetLabel",this.props.logger);let s=!1;try{const r=await I(this.props.tokenProvider,t.id,t.justificationText,this.labelMetadataCache,this.props.logger);r.changeLabel&&(s=await this.changeLabel(e,t)),i.setResult(!0,{changeLabel:r.changeLabel,changeLabelStatus:s,assignmentMethod:t.assignmentMethod,actionSource:t.actionSource})}catch(e){i.setResult(!1,{errorType:T.a.SetLabelError},e)}return s||this.emit("sensitivityError"),s}async removeCurrentLabel(e,t){if(!Object(R.c)(this.props.settingsProvider))return E.a.start("RemoveLabel",this.props.logger).setResult(!1,{settingName:R.d,settingValue:Object(R.c)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),!1;if(!Object(r.e)(e))return this.props.logger&&Object(S.c)(this.props.logger,{eventName:T.a.InvalidResolvedUrl,scenario:j.a.RemoveLabel}),!1;const i=E.a.start("RemoveLabel",this.props.logger);let s=!1;try{const r=await async function(e,t,i,r,s){const a={contentInfo:i||L(t),downgradeJustification:{isDowngradeJustified:!!r,justificationMessage:r||""}},o=await Object(c.b)((,"https://graph.microsoft.com/beta/me/security/informationProtection/sensitivityLabels/evaluateRemoval","EvaluateRemoval",s,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},void 0,v);if(!o.ok||200!==o.status)throw new Error(`evaluateLabelRemoval failed with status : ${o.status}`);const n=f(await o.json());return null!=n&&n.metadataToRemove?{changeLabel:!0}:{changeLabel:!1}}(this.props.tokenProvider,t.id,this.labelMetadataCache,t.justificationText,this.props.logger);r.changeLabel&&(t.id="",s=await this.changeLabel(e,t)),s&&(this.labelMetadataCache=void 0),i.setResult(!0,{changeLabel:r.changeLabel,removeCurrentLabelStatus:s,assignmentMethod:t.assignmentMethod,actionSource:t.actionSource})}catch(e){i.setResult(!1,{errorType:T.a.RemoveLabelError},e)}return s||this.emit("sensitivityError"),s}async getDlpTooltip(e){if(!Object(r.e)(e))return void(this.props.logger&&Object(S.c)(this.props.logger,{eventName:T.a.InvalidResolvedUrl,scenario:j.a.GetDlpPolicyTip}));const t=this.getCacheKey(C.DlpPolicyTip,e.hashedDocumentId);let s=this.PromiseCache.get(t);if(s)return s;const a=E.a.start("GetDlpPolicyTip",this.props.logger);return s=new Promise((async t=>{try{const s=await async function(e,t,s,a,o,n){const l=Object(d.a)(a),c=await Object(r.a)(e,a,s,t),y=null==c?void 0:c.webDavUrl.replace(l,""),f={getToken:i=>{const r={...i,siteUrl:a,driveId:s,itemId:t};return e.getToken([`${l}/files.readwrite.all`],r)},url:`${a}/_api/web/getListItem('${y}')/getdlppolicytip`,retryPolicy:w,timeoutMs:v},P=n?await Object(p.b)({...f,logger:n,nameForLogging:"GetDlpPolicyTip",getAdditionalProps:async(e,t)=>Object(h.a)(e)}):await Object(p.a)(f);if(!P.result.ok||200!==P.result.status)throw new Error(`getDlpTooltip failed with status : ${P.result.status}`);const L=await P.result.text();return await async function(e,t){const r=(0,(t||await function(){return g||(g=i.e(753).then(i.bind(null,"EeC/")).then(()),g}()).createXML)(e,u),s=(new DOMParser).parseFromString(r,"text/xml"),a=s.querySelector("parsererror");if(a)throw new Error(`parseDlpPolicyTip failed to parse : ${a.textContent}`);const o=s.querySelector("content");if(o)return{generalText:m(o,"d:GeneralText"),appliedActionsText:m(o,"d:AppliedActionsText"),complianceUrl:m(o,"d:ComplianceUrl"),overrideOptions:parseInt(m(o,"d:OverrideOptions"),10),lastProcessedTime:m(o,"d:LastProcessedTime"),matchedConditionDescriptions:b(o,"d:MatchedConditionDescriptions")}}(L,o)}(this.props.tokenProvider,e.itemId,e.driveId,e.siteUrl,this.props.trustedTypesPolicy,this.props.logger);return s&&this.emit("dlpPolicyTip",s),a.setResult(!0,{tip:!!s,moreInfoUrl:!(null==s||!s.complianceUrl),overrideOptions:null==s?void 0:s.overrideOptions}),t(s)}catch(e){return a.setResult(!1,{errorType:T.a.GetDlpPolicyTipError},e),t(void 0)}})),this.PromiseCache.set(t,s),s}async getIsMandatoryLabeling(e){if(!Object(R.c)(this.props.settingsProvider))return E.a.start("IsMandatoryLabelingRequired",this.props.logger).setResult(!1,{settingName:R.d,settingValue:Object(R.c)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),!1;if(!Object(r.e)(e))return void(this.props.logger&&Object(S.c)(this.props.logger,{eventName:T.a.InvalidResolvedUrl,scenario:j.a.GetIsProtectionEnabled}));const t=this.getCacheKey(C.IsMandatoryLabelingRequired,e.hashedDocumentId);let i=this.PromiseCache.get(t);if(i)return i;const s=E.a.start("IsMandatoryLabelingRequired",this.props.logger);return i=new Promise((async e=>{const t=await this.getPolicySettings();if(!t)return s.setResult(!1,{policySettings:!!t}),e(void 0);const i=t.isMandatory;return s.setResult(!0,{isMandatoryLabelingRequired:i}),e(i)})),this.PromiseCache.set(t,i),i}async enforceMandatoryLabelExperience(e){if(!Object(r.e)(e))return void(this.props.logger&&Object(S.c)(this.props.logger,{eventName:T.a.InvalidResolvedUrl,scenario:j.a.EnforceMandatoryLabelExperience}));const t=E.a.start("EnforceMandatoryLabelExperience",this.props.logger),[i,s]=await Promise.all([this.getPolicySettings(),this.getCurrentLabel(e)]);null!=i&&i.isMandatory&&!s&&(i.defaultLabelId?this.delayExecuteMandatoryLabeling(e,1e4):this.executeMandatoryLabeling()),t.setResult(!0)}delayExecuteMandatoryLabeling(e,t){this.mandatoryLabelTimeout||(this.mandatoryLabelTimeout=window.setTimeout((async()=>{await this.getCurrentLabel(e)||this.executeMandatoryLabeling()}),t))}async initialize(){const e=E.a.start("Initialization",this.props.logger);await Promise.all([this.getLabels(),this.getPolicySettings()]),e.setResult(!0)}async monitorAppliedLabel(e){window.clearInterval(this.refreshTimer),this.refreshTimer=window.setInterval((async()=>{this.props.logger&&Object(S.c)(this.props.logger,{eventName:O.a.RefreshTimerTriggered}),await this.refreshAppliedLabel(e)}),9e5)}async refreshAppliedLabel(e){if(!Object(r.e)(e))return;const t=E.a.start("RefreshAppliedLabel",this.props.logger),i=await this.getCurrentLabel(e);this.PromiseCache.delete(this.getCacheKey(C.AppliedLabel,e.hashedDocumentId));const s=await this.getCurrentLabel(e),a=(null==i?void 0:i.sensitivityLabelId)!==(null==s?void 0:s.sensitivityLabelId);if(a){this.emit("sensitivityLabelChanged",s),this.PromiseCache.delete(this.getCacheKey(C.IrmCapabilities,e.hashedDocumentId)),this.PromiseCache.delete(this.getCacheKey(C.Watermark,e.hashedDocumentId));const[t,i]=await Promise.all([this.getIrmInformation(e),this.getWatermarkInformation(e)]);this.emit("IrmCapabilitiesChanged",t),this.emit("watermarkingChanged",i),this.PromiseCache.delete(this.getCacheKey(C.IsProtectionEnabled,e.hashedDocumentId));const r=await this.getHasProtection(e);this.emit("protectionChanged",r),Object(R.b)(this.props.settingsProvider)&&Object(M.b)(e,this,this.props.logger).catch(()}t.setResult(!0,{isRefreshed:a})}async processPolicySettings(e,t){const i=E.a.start("ProcessPolicySettings",this.props.logger);if(!Object(R.c)(this.props.settingsProvider))return void i.setResult(!1,{settingName:R.d,settingValue:Object(R.c)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider});const r=await this.getPolicySettings();if(!r)return void i.setResult(!1,{errorType:T.a.GetPolicySettingsError,scenario:j.a.ProcessPolicySettings});let s=!1;!r.defaultLabelId||null!=t&&t.sensitivityLabelId||(s=await this.executeDefaultLabeling(e,r.defaultLabelId),i.addAdditionalProps({defaultLabelingStatus:s}));let a=!1;!r.isMandatory||null!=t&&t.sensitivityLabelId||r.defaultLabelId&&s||(a=!0,this.executeMandatoryLabeling()),i.setResult(!0,{isDefault:!!r.defaultLabelId,defaultLabelingStatus:s,isMandatory:r.isMandatory,executeMandatoryLabel:a})}async executeDefaultLabeling(e,t){if(!Object(R.c)(this.props.settingsProvider))return!1;const i={id:t,assignmentMethod:"standard",actionSource:"defaultLabel"};return await this.setCurrentLabel(e,i)}async executeMandatoryLabeling(){Object(R.c)(this.props.settingsProvider)&&this.emit("mandatoryLabelRequired"),this.mandatoryLabelTimeout&&window.clearTimeout(this.mandatoryLabelTimeout)}dispose(){window.clearInterval(this.refreshTimer),window.clearTimeout(this.mandatoryLabelTimeout),this.removeAllListeners(),this.PromiseCache.clear(),this.labelMetadataCache=void 0}async getAppliedLabel(){throw new Error("Not Implemented..")}async getIsProtectionEnabled(){throw new Error("Not Implemented..")}async getWatermarking(){throw new Error("Not Implemented..")}async getIrmCapabilities(){throw new Error("Not Implemented..")}sync setLabel(e){throw new Error("Not Implemented..")}},PJyT:function(e,t,i){"use strict";i.d(t,"c",(function(){return n})),i.d(t,"b",(function(){return l})),i.d(t,"a",();var r=i("graM"),s=i("aFvx"),a=i("Ito+"),o=i("TVWn");const n={respectRetryAfterHeader:!0,maxRetries:3,filter:Object(r.c)([429,503]),backoffFn:Object(s.c)(100)};async function l(e,t,i,r,s,n,l){let c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,d=arguments.length>8?arguments[8]:void 0;const p=t.startsWith("http")?t:`https://graph.microsoft.com/v1.0/${t}`,h={getToken:e,url:p,tenantId:s,requestInit:n,retryPolicy:l,timeoutMs:c},g=r&&i?Object(a.b)({...h,logger:r,nameForLogging:i,doNotLogOnSuccess:d,getAdditionalProps:):Object(a.a)(h);return(await g).result}function c(e,t){const i=new Map;return function(){const r=t(...arguments),s=i.get(r);if(s)return s.then();const a=e(...arguments);return i.set(r,a),a.then((e=>("number"==typeof e&&200!==e&&404!==e&&i.delete(r),e)),()}}}}]);
//# sourceMappingURL=752.75bbe723385cc9897cf7.chunk.v7.js.map