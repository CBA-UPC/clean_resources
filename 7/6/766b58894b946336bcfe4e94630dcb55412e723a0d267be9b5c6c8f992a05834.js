(function(h,f,k,l,g){var n=h.smnLogicadSfManager;if(n)n.debug&&n.debug("smnLogicadSfManager is already loaded.");else{var c=function(){this.debugMode=!1;this.sfUrl="//cd.ladsp.com/script-sf/v5/sf.min.js";this.uaCheckerUrl="//cd.ladsp.com/script-sf/uachecker.js";this.redirectToJsUrl="//sf.ladsp.com/redirectToJs";this.clickRedirectUrls={C:"//sf.ladsp.com/clickRedirect?s=C&advertiserId={advertiserId}&url=",L:"//sf.ladsp.com/clickRedirect?s=L&url="};this.enabled=!0;this.test=!1;this.targetUrls=this.sfArrowType=
this.testAcceptIPs=g;this.ipAddressApiUrl="https://ip.ladsp.jp/userinfo";this.sfSiteIdParamName="smnLogicadSfSiteId";this.advertiserCookie={name:"__smn_logicad_sf",value:"1",path:"/",maxAgeSeconds:2592000};this.redirectToJsSiteIdParamName="smnLogicadSfSiteId";this._sequentialNo=this._advertiserId=this._sfSiteId=g};c.include=function(a,b,d){var e=f.createElement("script");b&&(e.onload=b);d&&(e.onerror=d);e.src=a;(f.body||f.head).appendChild(e)};c.prototype.debug=function(a){if(this.debugMode){var b=f.getElementById("debug");
if(b){var d=f.createElement("div");d.appendChild(f.createTextNode("["+(new Date).toGMTString()+"] "+a));b.appendChild(d)}else console.log("["+(new Date).toGMTString()+"] SmnLogicadSfManager: "+a)}};c.prototype.isIosSafari=c.prototype.ifIosSafari=function(a,b){var d=this;c.include(d.uaCheckerUrl,};c.prototype.getCookie=function(a){for(var b=f.cookie.split(/\s*;\s*/),d=0;d<b.length;d++){var e=
b[d].split(/\s*=\s*/,2);if(2==e.length&&l(e[0])==a)return l(e[1])}return g};c.prototype.setCookie=function(a){var b=k(a.name)+"="+k(a.value);a.path&&(b+="; path="+a.path);a.domain&&(b+="; domain="+a.domain);if(0<=a.maxAgeSeconds){var d=new Date;d.setTime(d.getTime()+1E3*a.maxAgeSeconds);a=d.toGMTString();b+="; expires="+a}else a.expires&&(b+="; expires="+a.expires);f.cookie=b+"; "};c.prototype.parseQuerys=function(a){var b={};a=a.split(/\s*[&]\s*/);for(var d=0;d<a.length;d++){var e=a[d].split(/\s*=\s*/,
2),c=1<=e.length?l(e[0]):g;e=2<=e.length?l(e[1]):g;b[c]=e}return b};c.prototype.addEvent=function(){return f.addEventListener?f.attachEvent?function(a,b,d){a.attachEvent("on"+b,}:function(a,b,d){var e=a["on"+b];a["on"+b]=}();c.prototype.getIpAddressFromResponseText=function(a){return(""+a).replace(/[\s]/g,"").match(/"ip_address":"([^"]+)"/)[1]};c.prototype.getIPAddress=function(a){var b=this,d=e=function(){for(var a=3,b=f.createElement("div"),d=b.all||[];b.innerHTML="\x3c!--[if gt IE "+ ++a+"]><br><![endif]--\x3e",d[0];);return 4<a?a:!a}();if(8!==e&&9!==e||!h.XDomainRequest){var c=h.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&(200!=c.status?d(c.status,c.responseText):a(b.getIpAddressFromResponseText(c.responseText)))}}else c=new XDomainRequest,
c.onload=c.onerror=c.open("GET",b.ipAddressApiUrl,!0);c.send()};c.prototype.getSfJsScriptElement=function(){for(var a=f.getElementsByTagName("script"),b,d,c=a.length-1;0<=c;c--)if(b=a[c],d=b.src,-1!=d.indexOf(this.sfUrl))return b;return g};c.prototype.hasAdvertiserCookie=function(){return!!this.getCookie(this.advertiserCookie.name)};c.prototype.setAdvertiserCookie=c.prototype.getSfSiteId=function(){for(;!this._sfSiteId;){for(var a;;){var b=this.getSfJsScriptElement();if(!b)break;b=b.src;var d=b.indexOf("#");if(-1==d)break;a=b.substring(d+1);a=this.parseQuerys(a)[this.sfSiteIdParamName];break}for(;!a;){if("undefined"===typeof smnLogicadSfSiteId){this.debug("parameter not found - smnLogicadSfSiteId");break}a=smnLogicadSfSiteId;break}if(!a)break;b=a.split("-");if(2!=b.length){this.debug("invalid parameter - smnLogicadSfSiteId");
break}this._sfSiteId=a;this._advertiserId=b[0];this._sequentialNo=b[1];this.debug("smnLogicadSfSiteId: "+this._sfSiteId);break}return this._sfSiteId};c.prototype.includeRedirectToJs=function(){c.include(this.redirectToJsUrl+"?force=1&"+this.redirectToJsSiteIdParamName+"="+this.getSfSiteId())};c.prototype.initialize=function(){var a=this;a.enabled?a.ifIosSafari(function(){a.hasAdvertiserCookie()?a.debug("has advertiser cookie."):a.getSfSiteId()&&(a.setAdvertiserCookie()?a.includeRedirectToJs():a.debug("can not set advertiser cookie."))},
:a.debug("not enabled.")};c.prototype.getAdvertiserId=function(){this.getSfSiteId();return this._advertiserId};c.prototype.getSequentialNo=c.prototype.getClickRedirectUrl=function(){var a=this.clickRedirectUrls[this.sfArrowType];if(!a)return g;a=a.replace("{advertiserId}",this.getAdvertiserId());return a=a.replace("{sequentialNo}",this.getSequentialNo())};c.prototype.encodeClickUrl=k;c.prototype.addEventToAnchor=
function(a,b){var d=this;this.addEvent(a,"click",function(){var a=this.href;this.href=a=b+d.encodeClickUrl(a)})};c.prototype.replaceHrefToAnchor=function(a,b){var d=a.href;d=b+this.encodeClickUrl(d);a.href=d};c.prototype.modifyAnchors=function(){for(var a=this.targetUrls,b=this.getClickRedirectUrl(),d=f.getElementsByTagName("a"),c=0;c<d.length;c++){var g=d[c];if(!g.getAttribute("onclick")){var m=g.href;if(m){if(0==m.trim().toLowerCase().indexOf("http:",0))var h="http:";else if(0==m.trim().toLowerCase().indexOf("https:",
0))h="https:";else continue;if(-1==m.indexOf("#",0)){for(var l=!1,k=0;k<a.length;k++)if(-1!=m.search(a[k])){l=!0;break}l&&this.replaceHrefToAnchor(g,h+b)}}}}this.debug("modifyAnchors: success")};c.prototype.execute=function(){var a=this;if(a.enabled)if(a.targetUrls)if(a.getClickRedirectUrl())if(a.test){var b=a.testAcceptIPs;b?a.getIPAddress(function(c){for(var d=0;d<b.length;++d)if(-1!=c.search(b[d])){a.modifyAnchors();return}a.debug("do not testing")}):this.debug("invalid testAcceptIPs")}else a.modifyAnchors();
else a.debug("invalid sfArrowType or clickRedirectUrl.");else a.debug("invalid targetUrls.");else a.debug("not enabled.")};(h.smnLogicadSfManager=new c).initialize()}})(window,document,encodeURIComponent,decodeURIComponent);
