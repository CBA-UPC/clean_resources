
var HDN=HDN||{};HDN.dataLayer=HDN.dataLayer||{};HDN.dataLayer.privacy={ccpaDoNotSell:false,gppVersion:"1.1",gppSections:"uspv1,usnatv1",gpp:{sectionList:[],supporedAPIs10:[],supporedAPIs11:[],applicableSections:[-1],gppString:"",parsedSections:{},},gppCalls10:[],gppCalls11:[],uspapiCalls:0,gppSites:["sfgate.com","sfchronicle.com","weekand.com","ctinsider.com","ctpost.com","greenwichtime.com","newstimes.com","stamfordadvocate.com","thehour.com","nhregister.com","middletownpress.com","registercitizen.com","ncadvertiser.com","theridgefieldpress.com","wiltonbulletin.com","darientimes.com","sheltonherald.com","trumbulltimes.com","milfordmirror.com",],gppSitesNonWCM:["puzzmo.com","hearstmediact.com",],gppSupported:false,};var[topLevelDomain,rootDomainSlug]=window.location.hostname.split(".").reverse();var rootDomain=rootDomainSlug+"."+topLevelDomain;if(HDN.dataLayer.privacy.gppSites.includes(rootDomain)||HDN.dataLayer.privacy.gppSitesNonWCM.includes(rootDomain)||navigator.userAgent.indexOf(" Richie/")>-1){HDN.dataLayer.privacy.gppSupported=true;}
if(window.location.href.indexOf("gppVersion=1.0")>-1){window.HDN.dataLayer.privacy.gppVersion="1.0";}
if(window.location.href.indexOf("gppVersion=1.1")>-1){window.HDN.dataLayer.privacy.gppVersion="1.1";}
if(window.location.href.indexOf("gppSections=")>-1){if(window.location.href.indexOf("gppSections=uspv1,usnatv1")>-1){window.HDN.dataLayer.privacy.gppSections="uspv1,usnatv1";}else if(window.location.href.indexOf("gppSections=uspv1")>-1){window.HDN.dataLayer.privacy.gppSections="uspv1";}else if(window.location.href.indexOf("gppSections=usnatv1")>-1){window.HDN.dataLayer.privacy.gppSections="usnatv1";}}
HDN.getRootDomain=function(){var temp=location.host.split(".").reverse();var rootDomain="."+temp[1]+"."+temp[0];return rootDomain;};HDN.getCookie=function(name){if(name=="")return"";thisCookie=document.cookie;var start=thisCookie.indexOf(name+"=");if(start==-1)return"";var end=thisCookie.indexOf(";",start);if(end==-1)end=thisCookie.length;var cookieval=thisCookie.substring(start,end);var pair=cookieval.split("=");var value=decodeURIComponent(pair[1]);return value;};HDN.setCookie=function(name,value,seconds){if(typeof seconds=="number"){var date=new Date();date.setTime(date.getTime()+seconds*1000);var expires="; expires="+date.toGMTString();}else{var expires="";}
document.cookie=name+"="+encodeURIComponent(value)+expires+"; path=/"+"; domain="+HDN.getRootDomain();};HDN.deleteCookie=HDN.randomString=function(length){var result="";var characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";var charactersLength=characters.length;for(var i=0;i<length;i++){result+=characters.charAt(Math.floor(Math.random()*charactersLength));}
return result;};HDN.setDoNotSellStatusToValue=function(doNotSell){HDN.dataLayer.privacy.ccpaDoNotSell=doNotSell;const gpcEnabled=!!window.navigator.globalPrivacyControl;const gpcEncodedSubsection=gpcEnabled?".YA":".QA";if(window.HDN.dataLayer.privacy.gppSections==="uspv1"){window.HDN.dataLayer.privacy.gpp.sectionList=[6];window.HDN.dataLayer.privacy.gpp.supporedAPIs10=["uspv1"];window.HDN.dataLayer.privacy.gpp.supporedAPIs11=["6:uspv1"];if(doNotSell){window.HDN.dataLayer.privacy.gpp.applicableSections=[6];window.HDN.dataLayer.privacy.gpp.gppString="DBABTA~1YYY";}else{window.HDN.dataLayer.privacy.gpp.applicableSections=[-1];window.HDN.dataLayer.privacy.gpp.gppString="DBABTA~1---";}}else if(window.HDN.dataLayer.privacy.gppSections==="uspv1,usnatv1"){window.HDN.dataLayer.privacy.gpp.sectionList=[6,7];window.HDN.dataLayer.privacy.gpp.supporedAPIs10=["uspv1","usnatv1"];window.HDN.dataLayer.privacy.gpp.supporedAPIs11=["6:uspv1","7:usnatv1"];if(doNotSell){window.HDN.dataLayer.privacy.gpp.applicableSections=[6,7];window.HDN.dataLayer.privacy.gpp.gppString="DBABzw~1YYY~BVQVAAAAAWA"+gpcEncodedSubsection;}else{window.HDN.dataLayer.privacy.gpp.applicableSections=[-1];window.HDN.dataLayer.privacy.gpp.gppString="DBABzw~1---~BVQqAAAAAWA"+gpcEncodedSubsection;}}else if(window.HDN.dataLayer.privacy.gppSections==="usnatv1"){window.HDN.dataLayer.privacy.gpp.sectionList=[7];window.HDN.dataLayer.privacy.gpp.supporedAPIs10=["usnatv1"];window.HDN.dataLayer.privacy.gpp.supporedAPIs11=["7:usnatv1"];if(doNotSell){window.HDN.dataLayer.privacy.gpp.applicableSections=[7];window.HDN.dataLayer.privacy.gpp.gppString="DBABLA~BVQVAAAAAWA"+gpcEncodedSubsection;}else{window.HDN.dataLayer.privacy.gpp.applicableSections=[-1];window.HDN.dataLayer.privacy.gpp.gppString="DBABLA~BVQqAAAAAWA"+gpcEncodedSubsection;}}
if(window.HDN.dataLayer.privacy.gpp.sectionList.includes(6)){window.HDN.dataLayer.privacy.gpp.parsedSections.uspv1=[{Version:1,Notice:doNotSell?"Y":"-",OptOutSale:doNotSell?"Y":"-",LspaCovered:doNotSell?"Y":"-",},];}
if(window.HDN.dataLayer.privacy.gpp.sectionList.includes(7)){window.HDN.dataLayer.privacy.gpp.parsedSections.usnatv1=[{Version:1,SharingNotice:1,SaleOptOutNotice:1,SharingOptOutNotice:1,TargetedAdvertisingOptOutNotice:1,SensitiveDataProcessingOptOutNotice:0,SensitiveDataLimitUseNotice:0,SaleOptOut:doNotSell?1:2,SharingOptOut:doNotSell?1:2,TargetedAdvertisingOptOut:doNotSell?1:2,SensitiveDataProcessing:[0,0,0,0,0,0,0,0,0,0,0,0,],KnownChildSensitiveDataConsents:[0,0,],PersonalDataConsents:0,MspaCoveredTransaction:1,MspaOptOutOptionMode:1,MspaServiceProviderMode:2,},{SubsectionType:1,Gpc:gpcEnabled,},];}};HDN.setDoNotSellStatus=function(){if(window.navigator.globalPrivacyControl){HDN.setDoNotSellStatusToValue(true);HDN.overrideDoNotSellStatus();return;}
var nowDate=new Date();var nowMs=nowDate.getTime();var nowPlusOneHourDate=new Date(nowMs+1*60*60*1000);var nowPlusOneHourMs=nowPlusOneHourDate.getTime();hnpdnsValue={dns:0,ms:nowPlusOneHourMs,};var hnpccparid=HDN.getCookie("hnpccparid");if(hnpccparid){var needToUpdateCookie=false;var hnpdns=HDN.getCookie("hnpdns");if(hnpdns){try{hnpdnsValue=JSON.parse(hnpdns);if(typeof hnpdnsValue.dns==="number"){if(hnpdnsValue.dns!==0&&hnpdnsValue.dns!==1){hnpdnsValue.dns=0;needToUpdateCookie=true;}}else{hnpdnsValue.dns=0;needToUpdateCookie=true;}
if(typeof hnpdnsValue.ms==="number"){var msDifference=hnpdnsValue.ms-nowMs;if(msDifference>3600000){hnpdnsValue.dns=0;needToUpdateCookie=true;}
if(msDifference<0){needToUpdateCookie=true;}}else{needToUpdateCookie=true;}}catch(e){needToUpdateCookie=true;}}else{needToUpdateCookie=true;}
if(needToUpdateCookie){hnpdnsValue.ms=nowPlusOneHourMs;if(location.host.indexOf("www.sfgate")===0||location.host.indexOf("m.sfgate")===0||location.host.indexOf("www.sfchronicle")===0||location.host.indexOf("cmf.")===0){var ajaxSite=location.protocol+"//"+location.host;}else{var ajaxSite="https://www.sfgate.com";}
var xhr=new XMLHttpRequest();xhr.open("GET",ajaxSite+"/hdn/tools/ccpaSetDoNotSell.php?hnpccparid="+hnpccparid);xhr.send(null);xhr.onreadystatechange=function(){var DONE=4;var OK=200;if(xhr.readyState===DONE){if(xhr.status===OK){var obj=JSON.parse(xhr.response);if(obj.doNotSell){hnpdnsValue.dns=1;HDN.setDoNotSellStatusToValue(true);}else{hnpdnsValue.dns=0;HDN.setDoNotSellStatusToValue(false);}
hnpdns=JSON.stringify(hnpdnsValue);HDN.setCookie("hnpdns",hnpdns,31536000);HDN.overrideDoNotSellStatus();}else{console.error(xhr.status);}}};}}
if(hnpdnsValue.dns){HDN.setDoNotSellStatusToValue(true);}else{HDN.setDoNotSellStatusToValue(false);}
HDN.overrideDoNotSellStatus();};HDN.setDoNotSellStatusOnRichie=function(){HDN.setDoNotSellStatusToValue(false);if(typeof window.richie!=="undefined"&&typeof window.richie.getCCPAOptOut!=="undefined"){if(!!window.richie.getCCPAOptOut()){HDN.setDoNotSellStatusToValue(true);}}
HDN.overrideDoNotSellStatus();};HDN.overrideDoNotSellStatus=function(){if(window.location.href.indexOf("hnpdns=")>-1){if(window.location.href.indexOf("hnpdns=1")>-1){HDN.setDoNotSellStatusToValue(true);}else if(window.location.href.indexOf("hnpdns=0")>-1){HDN.setDoNotSellStatusToValue(false);}}};HDN.removeStnPlayers=function(){var stnPlayers=Array.apply(null,document.getElementsByClassName("s2nPlayer"));stnPlayers.forEach(function(p){if(p.parentNode.classList.contains("hst-freeform")){p.parentNode.parentNode.removeChild(p.parentNode);}});};HDN.addGppIframeTest=function(version){version=version||window.HDN.dataLayer.privacy.gppVersion;let iframe=document.createElement("iframe");iframe.src="https://cmf.newstimes.com/file/128/69/12869-gpp-iframe-test.html?gppVersion="+version;iframe.name="gpp-iframe-test";iframe.height="100";iframe.width="100";document.body.appendChild(iframe);};if(HDN.dataLayer.privacy.gppSupported){let pendingCalls=[];let addFrame=function(){if(!window.frames["__uspapiLocator"]){if(document.body){const iframe=document.createElement("iframe");iframe.style.cssText="display:none";iframe.name="__uspapiLocator";document.body.appendChild(iframe);}else{setTimeout(addFrame,5);}}};addFrame();let getuspdata=function(apiver,callback){if(typeof callback==="function"){if(apiver!==null&&apiver!==undefined&&apiver!=1){if(typeof callback==="function")callback(null,false);return;}
if(HDN.dataLayer.privacy.ccpaDoNotSell){str="1YYY";}else{str="1---";}
if(str){callback({version:1,uspString:str,},true);}else{callback({version:null,uspString:null,},false);}}else{console.error("__uspapi: callback parameter not a function");}};window.__uspapi=new(function(win){if(win.__uspapi){try{if(win.__uspapi("__uspapi")){return win.__uspapi;}else{pendingCalls=win.__uspapi()||[];}}catch(nfe){return win.__uspapi;}}
let api=function(cmd){window.HDN.dataLayer.privacy.uspapiCalls++;try{return{getUSPData:getuspdata,__uspapi:}[cmd].apply(null,[].slice.call(arguments,1));}catch(err){}};return api;})(window);window.__uspapi_msghandler=function(event){const data=event&&event.data&&event.data.__uspapiCall;if(data){window.__uspapi(data.command,data.version,(returnValue,success)=>{event.source.postMessage({__uspapiReturn:{returnValue,success,callId:data.callId,},});});}};window.addEventListener("message",window.__uspapi_msghandler,false);window.__gpp=function(){var args=arguments;window.__gpp.queue=window.__gpp.queue||[];if(!args.length){return window.__gpp.queue;}
var command=args[0];var callback=args.length>1?args[1]:null;var parameter=args.length>2?args[2]:null;var version=args.length>3?args[3]:null;if(version===1||version==="1"||version==="1.0"){console.warn("_gpp version 1.0 has gone out of fashion. Client (ad partner) should use _gpp calls compatible with version 1.1");}
const dlp=window.HDN.dataLayer.privacy;const pingData={gppVersion:dlp.gppVersion,cmpStatus:"loaded",cmpDisplayStatus:dlp.gppVersion==="1.0"?"hidden":null,signalStatus:"ready",cmpId:1,supportedAPIs:dlp.gppVersion==="1.0"?dlp.gpp.supporedAPIs10:dlp.gpp.supporedAPIs11,apiSupport:dlp.gppVersion==="1.0"?dlp.gpp.supporedAPIs10:dlp.gpp.supporedAPIs11,sectionList:dlp.gppVersion==="1.0"?null:dlp.gpp.sectionList,applicableSections:dlp.gppVersion==="1.0"?null:dlp.gpp.applicableSections,gppString:dlp.gppVersion==="1.0"?null:dlp.gpp.gppString,parsedSections:dlp.gppVersion==="1.0"?null:dlp.gpp.parsedSections,};if(callback){window.HDN.dataLayer.privacy.gppCalls11.push({command,parameter});}else{window.HDN.dataLayer.privacy.gppCalls10.push({command,parameter});}
if(command==="ping"){if(callback){callback(pingData,true);}
return pingData;}else if(command==="addEventListener"){window.__gpp.events=window.__gpp.events||[];if(!("lastId"in window.__gpp)){window.__gpp.lastId=0;}
window.__gpp.lastId++;var lnr=window.__gpp.lastId;window.__gpp.events.push({id:lnr,callback:callback,parameter:parameter,});let returnValue={eventName:"listenerRegistered",listenerId:lnr,data:true,pingData,};if(callback){callback(returnValue,true);}
return returnValue;}else if(command==="removeEventListener"){let success=false;window.__gpp.events=window.__gpp.events||[];for(var i=0;i<window.__gpp.events.length;i++){if(window.__gpp.events[i].id==parameter){window.__gpp.events.splice(i,1);success=true;break;}}
if(callback){callback(success,true);}
return{eventName:"listenerRemoved",listenerId:parameter,data:success,pingData,};}else if(command==="hasSection"){let returnValue=false;if(typeof parameter==="string"&&parameter in dlp.gpp.parsedSections){returnValue=true;}
if(callback){callback(returnValue,true);}
return returnValue;}else if(command==="getSection"){let returnValue=null;if(typeof parameter==="string"&&parameter in dlp.gpp.parsedSections){returnValue=dlp.gpp.parsedSections[parameter];}
if(dlp.gppVersion==="1.0"&&Array.isArray(returnValue)){returnValue=returnValue[0];}
if(callback){callback(returnValue,true);}
return returnValue;}else if(command==="getField"){let returnValue=null;if(typeof parameter==="string"){const parts=parameter.split(".");if(parts.length===2){if(parts[0]in dlp.gpp.parsedSections){let coreSection=Array.isArray(dlp.gpp.parsedSections[parts[0]])?dlp.gpp.parsedSections[parts[0]][0]:dlp.gpp.parsedSections[parts[0]];returnValue=coreSection[parts[1]]||null;}}}
if(callback){callback(returnValue,true);}
return returnValue;}else if(command==="getGPPString"){return dlp.gpp.gppString;}else if(command==="getGPPData"){if(dlp.gppVersion!=="1.0"){console.warn("__gpp('getGPPData') is not supported in GPP version 1.1");return null;}
return{sectionId:3,gppVersion:1,sectionList:dlp.gppSectionList,applicableSections:dlp.applicableSections,gppString:dlp.gpp.gppString,pingData,};}else{window.__gpp.queue.push([].slice.apply(args));}};window.__gpp_msghandler=function(event){var msgIsString=typeof event.data==="string";var json;try{json=msgIsString?JSON.parse(event.data):event.data;}catch(e){json=null;}
if(typeof json==="object"&&json!==null&&"__gppCall"in json){var i=json.__gppCall;var version=i.version||window.HDN.dataLayer.privacy.gppVersion;if(i.command==="getGPPData"||version===1||version==="1"||version==="1.0"){console.warn("_gpp postMessage appears to be version 1.0. Client (ad partner) should update to 1.1. Origin: "+
event.origin);}
window.__gpp(i.command,"parameter"in i?i.parameter:null,version);}};window.__gpp_addFrame=function(n){if(!window.frames[n]){if(document.body){var i=document.createElement("iframe");i.style.cssText="display:none";i.name=n;document.body.appendChild(i);}else{window.setTimeout(window.__gpp_addFrame,10,n);}}};window.addEventListener("message",window.__gpp_msghandler,false);window.__gpp_addFrame("__gppLocator");if(navigator.userAgent.indexOf(" Richie/")>-1){HDN.setDoNotSellStatusOnRichie();}else{HDN.setDoNotSellStatus();}
if(HDN.dataLayer.privacy.ccpaDoNotSell){if(document.readyState==="complete"||document.readyState==="loaded"){HDN.removeStnPlayers();}else{document.addEventListener("DOMContentLoaded",;}}}