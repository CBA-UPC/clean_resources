;
(self.AMP=self.AMP||[]).push({m:0,v:"2312191621000",n:"amp-access",ev:"0.1",l:!0,f:function(t,n){!function(){r r;ar s=u=Array.isArray;r a=Object.prototype,h=a.hasOwnProperty,f=a.toString;ion b(t,n,i,r,e,s,u,o,c,a,h){return t}var w=);r E=/(\0)|^(-)$|([\x01-\x1f\x7f]|^-?[0-9])|([\x80-\uffff0-9a-zA-Z_-]+)|[^]/g;ar R=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/ar O="lf.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var L=self.__AMP_LOtion(t){return W(t,"timer")},it=function(t){return K(t,"viewer")},rt=function(t){return F(t,"vsync")},et=function(t){return F(t,"xhr")ar ct=function(){var },n=[1,3],i=[1,4],r=[1,18],e=[1,19],s=[1,14],u=[1,15],o=[1,16],a=[1,17],h=[1,21],f=[1,22],l=[5,6,7,10],v=[5,6,7,10,15,16,17,18,19,20,21],p=[5,6,7,10,15,16,17,18,19,20,21,25,27],d={trace:function(){},yy:{},aL:{"error":2,"result":3,"search_condition":4,"EOF":5,"OR":6,"AND":7,"NOT":8,"(":9,")":10,"predicate":11,"comparison_predicate":12,"truthy_predicate":13,"scalar_exp":14,"EQ":15,"DEQ":16,"NEQ":17,"LT":18,"LTE":19,"GT":20,"GTE":21,"atom":22,"field_ref":23,"literal":24,"DOT":25,"field_name":26,"[":27,"string":28,"]":29,"NAME":30,"STRING":31,"NUMERIC":32,"TRUE":33,"FALSE":34,"NULL":35,"$accept":0,"$end":1},hL:{2:"error",5:"EOF",6:"OR",7:"AND",8:"NOT",9:"(",10:")",15:"EQ",16:"DEQ",17:"NEQ",18:"LT",19:"LTE",20:"GT",21:"GTE",25:"DOT",27:"[",29:"]",30:"NAME",31:"STRING",32:"NUMERIC",33:"TRUE",34:"FALSE",35:"NULL"},cL:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,1],[11,1],[11,1],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[13,1],[14,1],[14,1],[22,1],[23,3],[23,4],[23,1],[26,1],[28,1],[24,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(t,n,i,r,e,s,u){var o=s.length-1;switch(e){case 1:return s[o-1];case 2:this.$=s[o-2]||s[o];break;case 3:this.$=s[o-2]&&s[o];break;case 4:this.$=!s[o];break;case 5:this.$=s[o-1];break;case 6:case 7:case 8:case 17:case 18:case 19:this.$=s[o];break;case 9:this.$=s[o-2]===s[o];break;case 10:throw new Error('"==" is not allowed, use "="');case 11:this.$=s[o-2]!==s[o];break;case 12:this.$=c(s[o-2])==c(s[o])&&s[o-2]<s[o];break;case 13:this.$=c(s[o-2])==c(s[o])&&s[o-2]<=s[o];break;case 14:this.$=c(s[o-2])==c(s[o])&&s[o-2]>s[o];break;case 15:this.$=c(s[o-2])==c(s[o])&&s[o-2]>=s[o];break;case 16:this.$=void 0!==s[o]&&null!==s[o]&&""!==s[o]&&0!==s[o]&&!1!==s[o];break;case 20:this.$="[object Object]"==Object.prototype.toString.call(s[o-2])&&s[o-2].hasOwnProperty(s[o])?s[o-2][s[o]]:null;break;case 21:this.$="[object Object]"==Object.prototype.toString.call(s[o-3])&&s[o-3].hasOwnProperty(s[o-1])?s[o-3][s[o-1]]:null;break;case 22:this.$=void 0!==r[s[o]]?r[s[o]]:null;break;case 23:this.$=t;break;case 24:this.$=t.substring(1,t.length-1);break;case 26:this.$=Number(t);break;case 27:this.$=!0;break;case 28:this.$=!1;break;case 29:this.$=null}},table:[{3:1,4:2,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{1:[3]},{5:[1,20],6:h,7:f},{4:23,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{4:24,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},t(l,[2,6]),t(l,[2,7]),t(l,[2,8]),t(l,[2,16],{15:[1,25],16:[1,26],17:[1,27],18:[1,28],19:[1,29],20:[1,30],21:[1,31]}),t(v,[2,17]),t(v,[2,18],{25:[1,32],27:[1,33]}),t(v,[2,19]),t(p,[2,22]),t(v,[2,25]),t(v,[2,26]),t(v,[2,27]),t(v,[2,28]),t(v,[2,29]),t(p,[2,23]),t([5,6,7,10,15,16,17,18,19,20,21,29],[2,24]),{1:[2,1]},{4:34,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{4:35,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},t(l,[2,4]),{6:h,7:f,10:[1,36]},{14:37,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{14:38,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{14:39,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{14:40,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{14:41,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{14:42,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{14:43,22:9,23:10,24:11,26:12,28:13,30:r,31:e,32:s,33:u,34:o,35:a},{26:44,30:r},{28:45,31:e},t([5,6,10],[2,2],{7:f}),t(l,[2,3]),t(l,[2,5]),t(l,[2,9]),t(l,[2,10]),t(l,[2,11]),t(l,[2,12]),t(l,[2,13]),t(l,[2,14]),t(l,[2,15]),t(p,[2,20]),{29:[1,46]},t(p,[2,21])],defaultActions:{20:[2,1]},parseErro},pars}},}(}return d.lexer=m,b.prototype=d,d.Parser=b,new b}(),at=ct,ht=function(}return t.prototype.evaluat},t}(var vt="__AMP__EXPERIMENT_TOGGLES}var dt,mt,b}(),wt=function(){return self.AMP.config.urls}(),yt=new Set(["c","v","a","ad"]),gction kt(t){return wt.cdnProxyRegex.test(gt(t).origin)}function Pt(t){return Et(function(t){if(!kt(t=gt(t)))return t.href;var n=t.pathname.split("/"),i=n[1];G(yt.has(i),"Unknown path prefix in url %s",t.href);var r=n[2],e="s"==r?"https://"+decodeURIComponent(n[3]):"http://"+decodeURIComponent(r);return G(e.indexOf(".")>0,"Expected a . in origin %s",e),n.splice(1,"s"==r?3:2),e+n.join("/"}(t.search)+(t.hash||"")}(t)).origin}var Tt="amp-access-client",Ot=function(){function t(t,n,i){this.ampdoc=t,this.zj=i,this._vt=G(n.authorization,'"authorization" URL must be specified'),At(this._vt,'"authorization"'),this.Dvt=!n.noPingback,this.Svt=n.pingback,this.Dvt&&(G(this.Svt,'"pingback" URL must be specified'),At(this.Svt,'"pingback"')),this.jvt=this.Nvt(n),this.zt=et(t.win),this.je=nt(t.win)}var n=t.prototype;return n.Nvt=function(t){if(!t.authorizationTimeout)return 3e3;var n=t.authorizationTimeout;return G("number"==typeof n,'"authorizationTimeout" must be a number'),x().development||(n=Math.min(n,3e3)),n},n.getConfi},n.getAuthorizationUrl=function(){return this._vt},n.isAuthorizationEnabled=function(){return!0},n.getAuthorizationTimeout=function(){return this.jvt},n.authorize=function(){var t=this;return M().fine(Tt,"Start authorization via ",this._vt),this.zj.buildUrl(this._vt,!1).then((function(n){return M().fine(Tt,"Authorization URL: ",n),t.je.timeoutPromise(t.jvt,t.zt.fetchJson(n,{credentials:"include"})).then((function(t){return t.json()}))}))},n.isPingbackEnabled=function(){return this.Dvt},n.pingback=function(){var t=this;return this.zj.buildUrl(D(this.Svt),!0).then((function(n){return M().fine(Tt,"Pingback URL: ",n),t.zt.sendSignal(n,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:""})}))},n.postAction=function(){},t}(),xt="__AMP__",It=function(){function t(t,n,i){this.t=t,this.Sbt=n,this.jb=i,this.h=null,this.kbt=null,this.Obt=this.Bw.bind(this),this._bt=0,this.Pbt={}}var n=t.prototype;return n.connec},n.disconnec},n.isConnecte},n.getTarge},n.Rb},n.getTargetOrigi},n.sendComman},n.sendCommandRsvp=function(t,n){var i=String(++this._bt),r=null,e=new Promise}));return this.Pbt[i]={promise:e,resolver:r},this.fw(i,t,n),e},n.f},n.Bw=function(t){var n=this,i=t,r=i.data;if(r&&r.sentinel==xt){var e=i.origin,s=r.cmd,u=r.payload||null;if(null==this.jb&&"start"==s&&(this.jb=e),null==this.jb&&i.source&&this.Rbt()==i.source&&(this.jb=e),e==this.jb){var o=r._rsvp,c=!!o&&"rsvp"!=s,a=this.xbt(o,s,u);c&&Promise.resolve(a).then((function(t){n.fw(o,"rsvp",{"result":t})}),(function(t){n.fw(o,"rsvp",{"error":String(t)})}))}}},n.xbt=function(t,n,i){if("rsvp"!=n)return this.kbt(n,i);var r=t&&this.Pbt[t];r&&("error"in i?r.resolver(Promise.reject(new Error(i.error))):r.resolver(i.result),delete this.Pbt[t])},t}(),Ut="amp-access-iframe",jt=function(){function t(t,n,i){var r,e,s=this;this.ampdoc=t,this.zj=i,this.hG=n,this.je=nt(t.win),this.tR=G(n.iframeSrc,'"iframeSrc" URL must be specified'),At(this.tR,'"iframeSrc"'),this.Ibt=n.iframeVars||null,this.Ibt&&G(u(this.Ibt),'"iframeVars" must be an array'),this.Hwt=G(n.defaultResponse,'"defaultResponse" must be specified'),this.jb=Et(this.tR).origin,this.jbt=null,this.Tbt=null,this.ib=t.win.document.createElement("iframe"),r=this.ib,void 0===(e=!1)&&(e=r.hasAttribute("hidden")),e?r.removeAttribute("hidden"):r.setAttribute("hidden",""),this.Nbt=new It(this.ampdoc.win}),this.jb),this.LS=null}var n=t.prototype;return n.disconnec},n.getConfi},n.isAuthorizationEnabled=function(){return!0},n.authoriz},n.isPingbackEnabled=function(){return!0},n.pingback=function(){var t=this;return this.connect().then((function(){return t.Nbt.sendCommandRsvp("pingback",{})}))},n.postActio},n.connec},n.Ubt=function(){var t=this;return new Promise((function(n){var i=y(JSON.stringify(t.hG));if(t.Ibt){var r=t.Ibt.join("&");n(t.zj.collectUrlVars(r,!1).then})))}else n(i)}))},n.Wwt=function(){var t=this,n=3e3*(x().development?2:1);return this.je.promise(n).then}))},n.Xwt=function(){var t=this;return this.connect().then})).then((function(n){return n&&e().then})),n}))},n.Dyt=function(){var t=this.ampdoc.win,n=t.sessionStorage||t.localStorage;if(!n)return null;try{var i=n.getItem(Ut);if(!i)return null;var r=y(i);return r.t+6048e5<this.ampdoc.win.Date.now()?null:r.d||null}catch(t){M().error(Ut,"failed to restore access response: ",t);try{n.removeItem(Ut)}catch(t){}return null}},n.Zwt=function(t){var n=this.ampdoc.win,i=n.sessionStorage||n.localStorage;if(i)try{t?i.setItem(Ut,JSON.stringify({"t":this.ampdoc.win.Date.now(),"d":t})):i.removeItem(Ut)}catch(t){M().error(Ut,"failed to store access response: ",t)}},n.xbt=function(t,n){var i=this;"connect"!=t||this.LS.then((function(t){i.Nbt.sendCommandRsvp("start",{"protocol":"amp-access","config":t}).then}))}))},t}(),Lt="amp-access-other",Nt=function(){function t(t,n,i){this.ampdoc=t,this.zj=i,this.Gyt=n.authorizationFallbackResponse||null,this.ec=kt(t.win.location)}var n=t.prototype;return n.getConfi},n.isAuthorizationEnable},n.authorize=function(){M().fine(Lt,"Use the authorization fallback for type=other"),D(!this.ec);var t=D(this.Gyt);return Promise.resolve(t)},n.isPingbackEnabled=function(){return!1},n.pingback=function(){return M().fine(Lt,"Ignore pingback"),e()},n.postAction=function(){},t}(),zt=["GET","POST"];function Ct(t,n){var i,r=lt({},n);if((i=n.body)&&"function"==typeof i.getFormData){var e=n.body;r.headers["Content-Type"]="multipart/form-data;charset=utf-8",r.bod}(e.entries())}return{input:t,init:r}}function Mt(t,n,i){var }(i,"text/html");}(t,n,r),n=function(t,n,i){return b("string"==typeof n),!1!==i.ampCors&&(}(t,n)),n}(t,n,r);var s=function(t){return F(t,"ampdoc")}(t),c=s.isSingleDoc()?s.getSingleDoc():null;return r.responseType="document",function(t,n,i,r){if(!n)return e();var s=r.prerenderSafe?e():n.whenFirstVisible(),c=it(n),a=kt(i),h=c.hasCapability("xhrInterceptor"),f=r.bypassInterceptorForDev&&!1;return a||!h||f?s:n.getRootNode().documentElement.hasAttribute("allow-xhr-interception")?s.then})).then((function(n){if(n||pt(t,"untrusted-xhr-interception")){var e={"originalRequest":Ct(i,r)};return c.sendMessageAwaitResponse("xhr",e).then((function(t){return function(t,n){i}("​​​",l(t),"Object expected: %s",t,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0),"document"!=n)return new Response(t.body,t.init);var i=v(),r={status:200,statusText:"OK",getRespons||null}};if(t.init){var e=t.init;u(e.headers)&&e.headers.forEach((function(t){var n=t[0],r=t[1];i[String(n).toLowerCase()]=String(r)})),e.status&&(r.status=parseInt(e.status,10)),e.statusText&&(r.statusText=String(e.statusText))}return new Response(t.body?String(t.body):"",r)}(t,r.responseType)}))}})):s}(t,c,n,r).then((function(t){return t?t.text(html")})):function(t,n){return new Promise((function(i,r){var e=new XMLHttpRequest;for(var s in e.open(n.method||"GET",t,!0),e.withCredentials="include"==n.credentials,e.responseType="document",n.headers)e.setRequestHeader(s,n.headers[s]);e.onreadystatechange=function(){if(!(e.readyState<2)){if(e.status<100||e.status>599)return e.onreadystatechange=null,void r(z().createExpectedError("Unknown HTTP status ".concat(e.status)));if(4==e.readyState){var t={status:e.status,statusText:e.statusText,headers:(u=e.getAllResponseHeaders(),o={},u.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var n=t.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();o[i]=r}})),o)},n=(s=new Response("",t),new Promise((function(t){if(s.ok)return t(s);var n=s.status,i=z().createError("HTTP error ".concat(n));throw i.re&t<600}(n),i.response=s,i}))xhr:e}}));i(n)}}var s,u,o},e.onerror=function(){r(z().createExpectedError("Request failure"))},e.ted"))},"POST"==n.method?e.send(n.body):e.send()}))}(n,r).then((function(t){return t.xhr.responseXML}))}))}var Dt="amp-access-server",Gt=function(){function t(t,n,i){this.ampdoc=t,this.zj=i,this.Kyt=new Ot(t,n,i),this.zt=et(t.win),this.je=nt(t.win),this._o=rt(t.win),this.Vyt=t.getMetaByName("i-amphtml-access-state");var r=pt(t.win,"amp-access-server");this.ec=kt(t.win.location)||r;var e=r?t.getParam("serverAccessService"):null;this.dR=e||Rt(t.win.location.href)}var n=t.prototype;return n.ges.Vyt}},n.isAuthorizationEnabled=function(){return!0},n.authorize=function(){var t=this;return M().fine(Dt,"Start authorization with ",this.ec?"proxy":"non-proxy",this.Vyt,this.Kyt.getAuthorizationUrl()),this.ec&&this.Vyt?(M().fine(Dt,"Proceed via server protocol"),this.zj.collectUrlVars(this.Kyt.getAuthorizationUrl(),!1).then((function(n){var i={};for(var r in n)null!=n[r]&&(i[r]=String(n[r]));var e={"url":Rt(t.ampdoc.win.location.href),"state":t.Vyt,"vars":i};return M().fine(Dt,"Authorization request: ",t.dR,e),t.je.timeoutPromise(t.Kyt.getAuthorizationTimeout(),Mt(t.ampdoc.win,t.dR,{method:"POST",body:"request="+encodeURIComponent(JSON.stringify(e)),headers:{"Content-Type":"application/x-www-form-urlencoded"}}))})).then((function(n){M().fine(Dt,"Authorization response: ",n);var i=y(D(n.querySelector('script[id="amp-access-data"]')).textContent);return M().fine(Dt,"- access data: ",i),t.Qyt(n).then((function(){return i}))}))):(M().fine(Dt,"Proceed via client protocol"),this.Kyt.authorize())},n.isPingbackEnabled=function(){return this.Kyt.isPingbackEnabled()},n.pingback=function(){return this.Kyt.pingback()},n.postAction=function(){},n.Qyt=function(t){var n=this,i=t.querySelectorAll("[i-amphtml-access-id]");return M().fine(Dt,"- access sections: ",i),this._o.mutatePromise((function(){for(var t=0;t<i.length;t++){var r=i[t],e=r.getAttribute("i-amphtml-access-id"),s=n.ampdoc.getRootNode().querySelector('[i-amphtml-access-id="'.concat(_(e),'"]'));s?s.parentElement.replaceChild(n.ampdoc.win.document.importNode(r,!0),s):M().warn(Dt,"Section not found: ",e)}})urn n}var Vt={"-":"+","_":"/",".":"="};function qt(t){return Kt(atob(t.replace(/[ Vt[t]}))))}var Jt=function(){function t(t){this.win=t,this.fwt=t.crypto&&(t.crypto.subtle||t.crypto.webkitSubtle)||null}var n=t.prototype;return nayload},n.isVerificationSuis.fwt},n.decodeAndVerify=function(t,n){var i=this;if(!this.fwt)throw new Error("Crypto is not supported on this platform");return new Pwt(t))})).then((function(t){var r=t.header.alg;if(!r||"RS256"!=r)throw new Error("Only alg=RS256 is supported");return i.vwt(n).then((function(n){var r=qt(t.sig);return i.fwt.verify({name:"RSASSA-PKCS1-v1_5"},n,r,Kt(t.verifiable))})iled")}))})):i[2]}},n.vwt=function(t){var n=this;return t.then((function(t){return n.fwt.importKeyob(n))}(t),{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"])}))},t}(),Qt="amp-access-server-jwt",$t="ampproject.org",Ht=function(){function t(t,n,i){this.ampdoc=t,this.zj=i,this.Kyt=new Ot(t,n,i),this.zt=et(t.win),this.je=nt(t.win),this._o=rt(t.win),this.Vyt=t.getMetaByName("i-amphtml-access-state");var r=pt(t.win,"amp-access-server-jwt");this.ec=kt(t.win.location)||r;var e=r?t.getParam("serverAccessService"):null;this.dR=e||Rt(t.win.location.href),this.Mw=n.publicKey||null,this.$yt=n.publicKeyUrl||null,G(this.Mw||this.$yt,'"publicKey" or "publicKeyUrl" must be specified'),this.$yt&&At(this.$yt,'"publicKeyUrl"'),this.Mw&&this.$yt&&z().warn(Qt,'Both "publicKey" and "publicKeyUrl" specified. The "publicKeyUrl" will be ignored.'),this.mwt=new Jt(t.win)}var n=t.prototype;return n.ges.$yt}},n.isAuthorizationEnabled=function(){return!0},n.authorize=function(){return M().fine(Qt,"Start authorization with ",this.ec?"proxy":"non-proxy",this.Vyt,this.Kyt.getAuthorizationUrl()),this.ec&&this.Vyt?this.Wyt():this.Zyt()},n.isPingbackEnabled=function(){return this.Kyt.isPingbackEnabled()},n.pingback=function(){return this.Kyt.pingback()},n.postAction=function(){},n.Byt=function(){var t=this,n=this.zj.buildUrl(this.Kyt.getAuthorizationUrl(),!1).then((function(n){return M().fine(Qt,"Authorization URL: ",n),t.je.timeoutPromise(3e3,t.zt.fetchText(n,{credentials:"include"}))})).then((function(t){return t.text()})).then((function(n){var i=t.mwt.decode(n);return G(i.amp_authdata,'"amp_authdata" must be present in JWT'),{encoded:n,jwt:i}}));return this.tgt()&&(this.mwt.isVerificationSupported()?n=n.then((function(n){return t.mwt.decodeAndVerify(n.encoded,t.ngt()).then((function(){return n}))})):z().warn(Qt,"Cannot verify signature on this browser since it doesn't support WebCrypto APIs"),n=jwt),n}))),n: ",t)}))},n.ngt=function(){return this.Mw?Promise.resolve(this.Mw):this.zt.fetchText(this.$yt).then((function(t){return t.text()}))opment,$t,r)},n.Zyt=function(){return M().fine(Qt,"Proceed via client protocol via ",this.Kyt.getAuthorizationUrl()),this.Byt(thdata}))},n.Wyt=function(){var t=this;return M().fine(Qt,"Proceed via server protocol"),this.Byt().then((function(n){var i=n.encoded,r=n.jwt.amp_autn("&")}({"url":Rt(t.ampdoc.win.location.href),"state":t.Vyt,"jwt":i});return M().fine(Qt,"Authorization request: ",t.dR,e),M().fine(Qt,"- access data: ",r),t.je.timeoutPromise(3e3,Mt(t.ampdoc.win,t.dR,{method:"POST",body:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})).then((function(n){return M().fine(Qt,"Authorization response: ",n),t.Qyt(n)})turn r}))}))},n.Qyt=function(t){var n=this,i=t.querySelectorAll("[i-amphtml-access-id]");return M().fine(Qt,"- access sections: ",i),this._o.mutatePromise((function(){for(var t=0;t<i.length;t++){var r=i[t],e=r.getAttribute("i-amphtml-access-id"),s=n.ampdoc.getRootNode().querySelector('[i-amphtml-access-id="'.concat(_(e),'"]'));s?s.parentElement.replaceChild(n.ampdoc.win.document.importNode(r,!0),s):M().warn(Qt,"Section not found: ",e)}}))},t}(),Wt="amp-access-vendor",Xt=function(){function t(t,n){this.ampdoc=t,this.rgt=G(n.vendor,'"vendor" name must be specified'),this.egt=n[this.rgt]||{},this.Dvt=!n.noPingback;var i=new s;this.sgt=i.promise,this.ugt=i.resolve}var n=t.prototype;return n.getVendorName=function(){return this.rgt},n.getConfig=function(){return this.egt},n.registet=null},n.isAuthorizationturn!0},n.authorize=function(){return M().fine(Wt,"Start authorization via ",this.rgt),this.sgt.then((function(t){return t.authorize()}))},n.isPingbackEnabled=function(){return this.Dvt},n.pingback=function(){return M().fine(Wt,"Pingback via ",this.rgt),this.sgt.then((function(t){return t.pingback()}))},n.postAction=function(){},t}();function Zt(t,n,i,r){var e,s,u;try{e=t.open(n,i,r)}catch(t){M().error("DOM","Failed to open url on target: ",i,t)}return!e&&"_top"!=i&&("number"!=typeof u&&(u=0),u+"noopener".length>(s=r||"").length||-1===s.indexOf("noopener",u))&&(e=t.open(n,"_top")),eg.urls}(),Yt="amp-access-login",tn=new RegExp("RETURpen()}var en=funmise=n}var n=t.prototype;return n.getLoginUrl=function(){return("string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise).then((function(t){return un(t,"RETURN_URL")}))},n.open=function(){var t=this;return this.getLoginUrl().then((function(n){return M().fine(Yt,"Open viewer dialog: ",n),t.viewer.sendMessageAwaitResponse("openDialog",{"url":n})}))},t}(),sn=function(){function t(t,n,i){this.win=t,this.viewer=n,this.urlOrPromise=i,this.Oi=null,this.Sc=null,this.ebt=null,this.ubt=null,this.obt=null,this.cbt=null}var n=t.prototype;return n.open=function(){var t=this;return G(!this.Oi,"Dialog already opened"),new P.hbt()})xoxo(),n})=null)},n.getLoginUrl=function(){var t=this;return("string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromiseabt())}))},n.hbt=function(){var t=this,n=this.win.screen,i=Math.floor(Math.min(700,.9*n.width)),r=Math.floor(Math.min(450,.9*n.height)),s=Math.floor((n.width-i)/2),u=Math.floor((n.height-r)/2),o="height=".concat(r,",width=").concat(i,",left=").concat(s,",top=").concat(u),c="".concat(o,",resizable=yes,scrollbars=yes"),a=this.abt();if(this.ubt=null,"string"==typeof this.urlOrPromise){var h=un(this.urlOrPromise,a);M().fine(Yt,"Open dialog: ",h,a,i,r,s,u),this.ebt=Zt(this.win,h,"_blank",c),this.ebt&&(this.ubt=e())}else M().fine(Yt,"Open dialog: ","about:blank",a,i,r,s,u),this.ebt=Zt(this.win,"","_blank",c),this.ebt&&(this.ubt=this.urlOrPromise.then((function(n){var i=un(n,a);M().fine(Yt,"Set dialog url: ",i),t.ebt.location.replac: "+t)})));this.ubt?this.ubfbull,n)})):this.lbt(null,new Error("failed to open dialog"))},n.fbt=function(t){var n=this,i=Et(t).origin;this.obt=this.win.setInterval((function(){n.ebt.closed&&(n.win.clearInterval(n.obt),n.obt=null,n.win.setTimeout((function(){n.lbt("")}),3e3))}),500),this.cbt=ut(this.win,"message",(function(t){M().fine(Yt,"MESSAGE:",t),t.origin==i&&ot(t)&&"amp"==ot(t).sentinel&&(M().fine(Yt,"Received message from dialog: ",ot(t)),"result"==ot(t).type&&(n.ebt&&n.ebt.postMessage({"sentinel":"amp","type":"result-ack"},i),n.lbt(ot(t).result)))}),void 0)},n.lbt=function(t,n){this.Oi&&(M().fine(Yt,"Login done: ",t,n),n?this.Sc(n):this.Oi(t),this.xo())},n.abt=function(){var t=this.viewer.getResolvedViewerUrl();return"".concat(Bt.cdn,"/v0/amp-login-done-0.1.html")+"?url="+encodeURIComponent(tent(n)}var on="amp-access",cn="client",an="server",hn="vendor",fn=function(){function t(t,n,i,r,e,u){this.ampdoc=t,this.ogt=i,this.cgt=r,this.agt=e,this.hgt=u,this.fgt=pt(t.win,"amp-access-server"),this.lgt=pt(t.win,"amp-access-jwt"),this.Sz=this.vgt(n),this.pgt=this.dgt(n),this.mgt=n.authorizationFallbackResponse,this.bgt=n.namespace||null,this.wgt=this.ygt(n),this.wj=V(u,"url-replace"),this.ggt=rn.bind(null,t),this.oet=null;var o=new s;this.Egt=o.promise,this.Sgt=o.resolve,this._gt={},this.Agt=null,this.Rgt=0}var n=t.prototype;return n.getNamespace=function(){return this.bgt},n.getType=function(){return this.Sz},n.getAdapter=function(){return this.wgt},n.getAuthResponse=function(){return this.oet},n.ygt=function(t){var n={buildUrl:this.buildUrl.bind(this),collectUrlVars:this.collectUrlVars.bind(this)},i=this.lgt&&!0===t.jwt;switch(this.Sz){case cn:return i?new Ht(this.ampdoc,t,n):new Ot(this.ampdoc,t,n);case"iframe":return new jt(this.ampdoc,t,n);case an:return i?new Ht(this.ampdoc,t,n):new Gt(this.ampdoc,t,n);case hn:return new Xt(this.ampdoc,t);case"other":return new Nt(this.ampdoc,t,n)}throw M().createError("Unsupported access type: ",this.Sz)},n.getAdaptenfig()},n.whenFirstAuthorized=function(){return this.Egt},n.vgt=function(t){var n,i=t.type;return G(!i||"client"===(n=i)||"iframe"===n||"server"===n||"vendor"===n||"other"===n,"Unknown access type: ".concat(i)),i||(i=t.vendor?hn:cn),i!=an||this.fgt||(z().warn(on,'Experiment "amp-access-server" is not enabled.'),i=cn),i==cn&&this.fgt&&(z().info(on,"Forcing access type: SERVER"),i=an),iturn i},n.kgt=function(){var t=this.ampdoc.getRootNode();return t.documentElement||t.body||t},n.g3=function(t){st(this.kgt(),t,void 0,!1)},n.start=function(){M().fine(on,"config:",this.Sz,this.pgt,this.wgt.getConfig()),this.Pgt()},n.buildUrl=function(t,n){var i=this;return this.uet(n).then((function(n){return i.wj.expandUrlAsync(t,n)}))},n.collectUrlVars=function(t,n){var i=this;return this.uet(ns(t,n)}))},n.uet=function(t){var n=this;return this.ogt().then((function(i){var r={"READER_ID":i,"ACCESS_READER_ID":i};return t&&(r.AUTHDATA=function(t){if(n.oet)return d(n.oet,t)}),r}))},n.runAuthorization=function(t){var n=this;return this.wgt.isAuthorizationEnabled()?this.wgt.authorize().catch((function(i){if(n.g3("access-authorization-failed"),n.mgt&&!t)return z().error(on,"Authorization failed: ",i),n.mgt;throw i})).then((function(t){return M().fine(on,"Authorization response: ",t),n.Tgt(t),n.Pgt(),t})).catch((function(t){throw z().error(on,"Authorization failed: ",t),n.Sgt(),t})):(M().fine(on,"Ignore authorization for type=",this.Sz),this.Sgt(),e()).Sgt()},n.reportViewToServer=function(){var t=this;return this.wgt.pingback().then((function(){M().fine(on,"Pingback complete"),t.g3("access-pingback-sent")})).catch((function(n){throw t.g3("access-pingback-failed"),z().createError("Pingback failed: ",n)}))},n.getLdoc,t)},n.loginWt(n,t)},n.logint(t,n)},n.Ogt=function(t,n){var i=this,r=Date.now();if(this.Agt&&r-this.Rgt<1e3)return this.Agt;M().fine(on,"Start login: ",t,n),this.xgt(n,"started");var e=this.ggt(t).then((function(t){M().fine(on,"Login dialog completed: ",n,t),i.Agt=null;var r=P(t).success,e="true"==r||"yes"==r||"1"==r;if(e?i.xgt(n,"success"):i.xgt(n,"rejected"),e||!r){i.wgt.postAction();var s=i.runAuthorization(!0);return i.agt(s),cgt(0)}))}})).catch((function(t){throw M().fine(on,"Login dialog failed: ",n,t),i.xgt(n,"failed"),i.Agt==e&&(i.Agt=null),t}));return this.Agt=e,this.Rgt=r,this.Agt},n.xgt=function(t,n){this.g3("access-login-".concat(n)),t&&this.g3("access-login-".concat(t,"-").concat(n))},n.Pgt=function(){var t=this;if(0==Object.keys(this.pgt).length)return null;var n=[],i=function(i){n.push(t.buildUrl(t.pgt[i],!0).then((function(n){return t._gt[i]=n,{type:i,url:n}})))};for(var r in this.pgt)i(r);return Promise.all(nurn!1}var pn=self.__AMP_ERRORS||[];self.__AMP_ERRORS=pn;var dn="amp-access",mn="__AMP_ACCESS__TEMPLATE",bn=function(){function t(t){var n=this;this.a}),4)ion(){}));var i,r,e,s=t.getElementById("amp-access");if(this.Igt=!!s,this.Igt){this.hgt=s,this.Ugt=Pt(t.win.location),this.je=nt(t.win),this._o=rt(t.win),this.jwt=q(t,"cid"),this.ls=it(t),this.Ro=K(t,"viewport"),this.Vw=function(t){return K(t,"templates")}(t),ator")}(t),this.BZ=(i=t.win,e="performance",B(r=Q(r=i),e)?W(r,e):null),this.iet=null,this.jgt=new ht,this.eE=this.Lgt();var u=this.ized()}));this.Ngt=!1,this.zgt=Promise.all(u),this.Ewt=null,this.Cgt=new w,this.zgt.then((function(){n.Ngt=!0,n.g3("access-authorization-received"),n.BZ&&(n.BZ.tick("aaa"),n.BZ.tickSinceVisible("aaav"),n.BZ.flush())})),t.getRootNode().addEventListener("amp:dom-update",this.Mgt.bind(this))}}var n=t.prototype;return n.getAccessR):null},n.ogt=function(){if(!this.iet){var t=e();this.iet=this.jw!0},t)}))}return this.iet},n.areFirstAuthorizationsCompleted=function(){return this.Ngt},n.onApplyAuthoriadd(t)},n.Lgt=function(){var t,n,i=this;G("SCRIPT"==(t=this.hgt).tagName&&"APPLICATION/JSON"==(null===(n=t.getAttribute("type"))||void 0===n?void 0:n.toUpperCase()),"".concat(dn," config should ")+'be inside a <script> tag with type="application/json"');var r=g(this.hgt.textContent,(function(t){throw z().createError('Failed to parse "amp-access" JSON: '+t)})),e={};if(u(r))for(var s=r,o=0;o<s.length;o++){var c=s[o].namespace;G(!!c,"Namespace required"),G(!e[c],"Namespace already used: "+c),e[c]=s[o]}else e[r.namespace||""]=r;var a=this.ogt.bind(this),h=this.cgt.bind(this),f=this.agt.bind(this);return Object.keys(e).map((function(t){return new fn(i.ampdoc,e[t],a,h,f,i.hgt)}))},n.Mgt=function(t){var n=this;if(this.Ngt){var i=t.target;return this.zgt(i,t)}))}},n.getVendo Error},n.isis.Igtody|| 0,!1)},n.qh=function(){return this.Igt?(this.Ggt(),this):(z().info(dn,'Access is disabled - no "id=amp-access" element'),this)s.$h()},n.$h=function(){var t=this;this.ls.onBroadcast((function(n){"amp-access-reauthorize"==n.type&&n.origin==t.Ugt&&t.Fgt()}))},n.agt=function(t){var n=this;this.Kgt(),t.then((function(){n.Ngt&&n.zgt.then((function(){n.ampdoc.whenReady().then((function(){var t=n.ampdoc.getRootNode(),i=n.combinedResponses();return n.Dgt(t,i)}))}))})).Ugt})},n.Fgt=function(t){var n=this;this.Vgt("amp-access-loading",!0);var i=this.ampdoc.whenFirstVisible().then((function(){return Promise.all(n.qgt(t)})))})).then((function(){return n.Vgt("amp-access-loading",!1),n.ampdoc.whenReady().then((function(){var t=n.ampdoc.getRootNode(),i=n.combinedResponses();return n.Dgt(t,i)}))}));return this.zgt=i,i},n.qgt=function(t){var n=this;return t.runAuthorization()r",!0)}))},n.getAuthdataField=function(t){var n=this;return this.Igt?this.zgt.then((function(){var i=d(n.combinedResponses(),t);return void 0!==i?i:null})):null},n.Dgt=function(t,n){for(var i=this,r=t.querySelectorAll("[amp-access]"),e=[],s=0;s<r.length;s++)e.push(this.Jgt(r[s],n));return Promise.all(efire()}))},n.Jgt=function(t,n){var i=this,r=t.getAttribute("amp-access"),e=!1;try{e=this.jgt.evaluate(r,n)}catch(t){z().error(dn,t)}if(e){var s=this.Qgt(t,n);if(s)return t(t,e)}))}return this.$gt(t,e)},n.$gt=function(t,n){var i=!t.hasAttribute("amp-access-hide");return n==i?e():this.Ph.mutateElee","")}))},n.Qgt=function(t,n){var i=this,r=[],e=t.querySelectorAll("[amp-access-template]");if(e.length>0)for(var s=function(s){var u=i.m3(t,e[s],n).catch((function(n){M().error(dn,"Template failed: ",n,e[s],t)}));r.push(u)},u=0;u<e.length;u++)s(u);return r.length>0?Promise.all(r):null},n.m3=function(t,n,i){var r=this,e=n,s=null;return"TEMPLATE"!=e.tagName&&(e=(s=e)[mn]),e?this.Vw.renderTemplate(e,i).then((function(t){return r._o.mutatePromise((function(){t.setAttribute("amp-access-template",""),t[mn]=e,e.parentElement?e.parentElement.replaceChild(t,e):s&&s.parentElement&&s.parentElement.replaceChild(t,s)}))})):Promise.reject(new Error("template not found"))},n.cgt=function(t){var n=this;this.ebled()}))&&(this.Ewt=null,this.ampdoc.whenReady().then((function(){n.ampdoc.isVisible()&&n.Awt(t),n.ampdoc.onVisibilityCAwt(t)}))})))},n.Awt=function(t){var n=this;return this.Ewt||(M().fine(dn,"start view monitoring"),this.Ewt=this.Swt(t n.zgt}).Hgt()})).catch((function(t){throw M().fine(dn,"view cancelled:",t),n.Ewt=null,t})),this.Ewt.then(this.Kgt.bind(this))),this.Ewt},n.Swt=function(t){var n=this;if(0==t)return e();var i=[];return new Promise((function(r,e){i.push(n.ampdoc.onVisibilityChanged((function(){n.ampdoc.isVisible()||e(new Error("CANCELLED"))})));var s,u,o,c=n.je.delay(r,t);cel(c)})),i.push(n.Ro.onScroll(r)),i.push((s=n.ampdoc.getRootNode(),u=r,o=ut(s,"l,o()}}),void 0)))})t()}))}),(function(t){throw i.frn t()})),t}))},n.Hgt=function(){for(var t=[],n=0;n<this.eE.length;n++)this.eE[n].getAdapter().isPingbackEnabled()&&t.push(this.eE[n].reportViewToServer());return Promise.all(t)},n.Vgt=function(t,n){var i=this;this._o.mutate((function(){i.kgt().classList.toggle(t,n)})):null},n.ge.eE[t]},n.Wgt=function(t){var n=t.indexOf("-"),i=1==this.eE.length,r=n>-1?t.substring(0,n):t,e=this.eE.e()==r}));if(e.length){var s=n>-1?t.substring(n+1):"";return e[0].loginWithType(s)}return G(i,"Login must match namespace: %s",r),this.eE[0].loginWithType(t)},n.combinedResponses=function(){if(1==this.eE.length&&!this.eE[0].getNamespace())return this.eE[0].getAuthResponse()||{};var t={};return this.eE.fonse()})),t},t}();t.registerServiceForDoc("a).qh()}))}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-access-0.1.js.map