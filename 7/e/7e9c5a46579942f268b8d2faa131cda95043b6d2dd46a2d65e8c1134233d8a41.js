;
(self.AMP=self.AMP||[]).push({m:0,v:"2312191621000",n:"amp-geo",ev:"0.1",l:!0,f:function(n,t){!function(){r e;a=Array.isArray,f=Object.prototype,s=(f.hasOwnProperty,f.toString); d=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var g=self.__AMP_LOG;AMP__EXPERIMENT_TOGGLES",G=function(n){return t="url",r=T(n),C(o=(e=T(r)).isSingleDoc()?e.win:e,t)?P(o,t):null;var t,r,e,o},N={"preset-eea":["AT","BE","BG","CQ","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IS","IE","IT","LV","LI","LT","LU","MT","NL","NO","PL","PT","RO","SK","SI","ES","SE","GB","AX","IC","EA","GF","PF","TF","GI","GP","GG","JE","MQ","YT","NC","RE","BL","MF","PM","SJ","VA","WF","EZ","CH"],"preset-us-ca":["us-ca"]},L=),x="amp-geo",F="amp-iso-country-",M="amp-iso-subdivision-",U=new RegExp("".concat(F,"(\\w+)")),H=new RegExp("".concat(M,"(\\w{2}-\\w{1,3})")),_="ampGeo",z=/^(?:(\w{2})(?:\s(\w{2}-\w{1,3}))?)?\s*/,B=new RegExp("^amp-iso-country-|^amp-geo-group-|^"+M,"i"),J="unknown",D=function(n){!d,n);var t,u,f=(t=d,u=),;function d(n){var t;return(t=f.call(this,n)).nO=0,t.Ze=!1,t.tO=J,t.rO=J,t.eO=[],t.oO=[],t}d.prerenderAllowed=var h=d.prototype;return h.buildCallback=function(){var n,t,r=this,e=this.element.children;e.length&&this.iO(1===e.length&&"SCRIPT"==(n=e[0]).tagName&&"APPLICATION/JSON"==(null===(t=n.getAttribute("type"))||void 0===t?void 0:t.toUpperCase()),"".concat(x,' can only have one <script type="application/json"> child'));var o=e.length?e[0].textContent,(function(){return r.iO(!1,"".concat(x," Unable to parse JSON"))})):{},i=this.uO(o||{});$.resolve(i)},h.iO=h.cO=h.aO=function(n){var t,o,i,u,c,f=this,s=n.getBody(),p=n.getRootNode().documentElement,d=(null==p?void 0:p.className.match(U))||s.className.match(U),h=z.exec(this.cO()),b=(t=this.win,o=(t||self).location,m(o.originalHash||o.hash))["amp-geo"];if(b&&null!==(i=this.win.AMP_CONFIG)&&void 0!==i&&i.canary){var y=z.exec(b.toLowerCase());y[1]&&(this.tO=y[1],y[2]&&(this.rO=y[2]),this.nO=2)}else if(!d||G(this.element).isProxyOrigin(this.win.location)&&(u=this.win,c=function(n){var t,e,o,i,u;if(n[R])return n[R];n[R]=l();var c=n[R],f=O(O({},null!==(t=n.AMP_CONFIG)&&void 0!==t?t:{}),null!==(e=n.AMP_EXP)&&void 0!==e?e:v((null===(o=n.__AMP_EXP)||void 0===o?void 0:o.textContent)||"{}"));for(var s in f){var p=f[s];"number"==typeof p&&p>=0&&p<=1&&(c[s]=Math.random()<p)}var d=null===(i=n.AMP_CONFIG)||void 0===i?void 0:i["allow-doc-opt-in"];if(a(d)&&d.length){var h=n.document.head.querySelector('meta[name="amp-experiments-opt-in"]');if(h)for(var b,y,g=r((null===(b=h.getAttribute("content"))||void 0===b?void 0:b.split(","))||[],!0);!(y=g()).done;){var S=y.value;d.includes(S)&&(c[S]=!0)}}Object.assign(c,n));var j=null===(u=n.AMP_CONFIG)||void 0===u?void 0:u["allow-url-opt-in"];if(a(j)&&j.length)for(var E,I=m(n.location.originalHash||n.location.hash),A=r(j,!0);!(E=A()).done;){var T=E.value,P=I["e-".concat(T)];"1"==P&&(c[T]=!0),"0"==P&&(c[T]=!1)}return c}(u),!c["amp-geo-ssr"]))h[1]?(this.nO=0,this.tO=h[1].toLowerCase(),h[2]&&(this.rO=h[2].toLowerCase())):""===h[0]&&L.geoApi?this.nO=3:""===h[0]&&(this.Ze=!0,w().error(x,"GEONOTPATCHED: amp-geo served unpatched, ISO country not set"));else{this.nO=1,this.tO=d[1];var g=(null==p?void 0:p.className.match(H))||s.className.match(H);g&&(this.rO=g[1])}return 3!==this.nO?e||(e=Promise.resolve(void 0)):this.fO().then((function(n){if(n){var t=n.country,r=n.subdivision;f.tO=t,r&&(f.rO="".concat(t,"-").concat(r))}else f.Ze=!0,w().error(x,"GEONOTPATCHED: amp-geo served unpatched and API response not valid, ISO country not set")}))},h.sO=h.fO=function(){var n,t=this.sO(L.geoApi);return t?(j().info(x,"API request is being used for country, this may result in FOUC"),(n=this.win,P(n,"timer")).timeoutPromise(6e4,this.win).fetchJson(t,{mode:"cors",method:"GET",credentials:"omit"}).then((function(n){return n.json()})).then((function(n){return/^[a-z]{2}$/i.test(n.country)?{country:n.country.toLowerCase(),subdivision:/^[a-z0-9]{1,3}$/i.test(n.subdivision)?n.subdivision.toLowerCase():null}:(j().error(x,'Invalid API response, expected schema not matched for property "country"'),null)})).catch((),"Timeout (".concat(60," sec) reached waiting for API response")).catch((function(n){return j().error(x,n),null}))):Promise.resolve(null)},h.lO=function(n){var t,r=this,e=n.ISOCountryGroups,o="<amp-geo> ISOCountryGroups";e&&(this.iO((t=e,"[object Object]"===s.call(t)),"".concat(o," must be an object")),this.oO=Object.keys(e),this.oO.forEach((function(n){r.iO(/^[a-z]+[a-z0-9]*$/i.test(n)&&!/^amp/.test(n),"".concat(o,"[").concat(n,"] name is invalid")),r.iO(a(e[n]),"".concat(o,"[").concat(n,"] must be an array")),r.vO(e[n])&&r.eO.push(n)})))},h.vO=function(n){var t=this,r=n.reduce((function(n,r){return/^preset-/.test(r)?(t.iO(a(N[r]),"<amp-geo> preset ".concat(r," not found")),n.concat(N[r])):(r===J||/^[a-zA-Z]{2}(?:-[0-9a-zA-Z]{1,3})?$/.test(r)?n.push(r):j().error(x," country %s not valid, will be ignored",r),n)}),[]).map(();return r.includes(this.tO)||this.rO!==J&&r.includes(this.rO)},h.pO=function(n,t){var r=new Set;return t&&p(t.classList,(function(n){B.test(n)&&r.add(n)})),p(n.classList,(),r},h.uO=function(n){var t=this,r=this.getAmpDoc(),e={};return r.whenReady().then(().then(().then((function(o){var i=r.getRootNode().documentElement;t.lO(n);var u=new Set;switch(t.nO){case 2:u=t.pO(o,i);case 0:case 3:e.ISOCountry=t.tO,e.ISOSubdivision=t.rO;var c=t.eO.map((function(n){return e[n]=!0,"amp-geo-group-"+n}));t.eO.length||c.push("amp-geo-no-group"),t.Ze&&c.push("amp-geo-error"),e.ISOCountryGroups=t.eO,c.push(F+t.tO),t.rO!==J&&c.push(M+t.rO),t.mutateElement((function(){var t=i&&i.classList,a=o.classList;if(u.add("amp-geo-pending"),u.forEach((),c.forEach((),n.AmpBind){var f=r.getElementById(_);f&&f.parentNode.removeChild(f);var s=r.win.document.createElement("amp-state"),l=r.win.document.createElement("script");l.setAttribute("type","application/json"),l.textContent=JSON.stringify(e),s.appendChild(l),s.id=_,o.appendChild(s)}}),i)}return{ISOCountry:t.tO,ISOSubdivision:t.rO,matchedISOCountryGroups:t.eO,allISOCountryGroups:t.oO,isInCountryGroup:t.isInCountryGroup.bind(t)}}))},h.isInCountryGroup=function(n){var t=this,r=n.trim().split(/,\s*/);return r.filter((function(n){return t.oO.indexOf(n)>=0})).length!==r.length?1:r.filter(().length>0?2:3},d}(n.BaseElement),$=null;$=new n.registerElement(x,D),n.registerServiceForDoc("geo",()}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-geo-0.1.js.map