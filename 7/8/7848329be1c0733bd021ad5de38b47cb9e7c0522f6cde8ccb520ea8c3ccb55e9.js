/*
 *  (c) 2000-2019 deviantART, Inc. All rights reserved.
 */
DWait.ready(["jms/pages/chat07/dAmnChat.js","jms/lib/browser.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/lib/jquery/jquery.current.js"],function(){DWait.ready(".domready",function(){var t=$(window),e=$("#window"),r=$("#head").length?62:50;t.on("resize.chatpage",$.throttle(50,).trigger("resize.chatpage"),$("#exitlink").attr("target","_top"),$("#chatroomusers form").on("submit",function(){var t=$(this).data("priv-class");return confirm("Are you sure you want to remove this user from "+t+"?")})}),window.DWait&&DWait.run("jms/pages/chat07/chatpage.js")});
DWait.ready(["jms/lib/browser.js"],function(){window.dAmn_Client_Agent="dAmn WebClient 0.7.pre-1",window.dAmn_Init=function(n,e){if(Browser.isIE&&!(document.documentMode>7))return alert("A newer version of Internet Explorer is required to use DeviantArt Chat."),void 0;try{dAmn_Client_LogCallback=e,dAmn_Client_PluginArea=dAmn_GetElement(n),dAmn_Client_PluginArea.style.width="0px",dAmn_Client_PluginArea.style.height="0px",dAmn_Log("Browser: "+navigator.userAgent),dAmn_Plugin=new dAmn_PluginObj(new dAmn_Plugin_WebSockets),dAmn_Plugin.load()}catch(t){alert("dAmn_Init() failed! : "+dAmn_ExceptionPrint(t))}},window.dAmn_AddLogCB=function(n){dAmn_LogCallbacks=dAmn_LogCallbacks.concat(n)},window.dAmn_RemLogCB=function(n){for(var e=dAmn_LogCallbacks.length;e--;)if(dAmn_LogCallbacks[e]==n)return dAmn_LogCallbacks=dAmn_LogCallbacks.slice(0,e).concat(dAmn_LogCallbacks.slice(e+1)),!0;return!1},window.dAmn_Connect=function(n){isWhitelisted(n)&&(dAmn_Client_Queues.Connect=dAmn_Client_Queues.Connect.concat(n),dAmn_ProcessQueues())},window.dAmn_Login=function(n,e){dAmn_Client_AuthToken=e,dAmn_Client_Queues.Login=dAmn_Client_Queues.Login.concat(new Pair(n,e)),dAmn_ProcessQueues()},window.dAmn_Logoff=function(){dAmn_Client_Queues.Logoff=dAmn_Client_Queues.Logoff.concat(1),dAmn_ProcessQueues()},window.dAmn_Rem_dAmnCB=function(n){dAmn_Callbacks=dAmn_arrayRemValue(dAmn_Callbacks,n)},window.dAmn_Add_dAmnCB=window.dAmn_Join=function(n){dAmn_Client_Queues.Join=dAmn_Client_Queues.Join.concat(n),dAmn_ProcessQueues()},window.dAmn_Part=function(n){dAmn_Client_Queues.Part=dAmn_Client_Queues.Part.concat(n),dAmn_ProcessQueues()},window.dAmn_Send=function(n,e){dAmn_Client_Queues.Send=dAmn_Client_Queues.Send.concat(new Pair(n,e)),dAmn_ProcessQueues()},window.dAmn_GetAttention=function(){dAmn_Client_Queues.GetAttention=dAmn_Client_Queues.GetAttention.concat(1),dAmn_ProcessQueues()},window.dAmn_Raw=function(n){dAmn_Client_Queues.Raw=dAmn_Client_Queues.Raw.concat(n),dAmn_ProcessQueues()},window.dAmn_Set=function(n,e,t){dAmn_Client_Queues.Set=dAmn_Client_Queues.Set.concat(new Triple(n,e,t)),dAmn_ProcessQueues()},window.dAmn_Get=function(n,e){dAmn_Client_Queues.Get=dAmn_Client_Queues.Get.concat(new Pair(n,e)),dAmn_ProcessQueues()},window.dAmn_Kick=function(n,e,t){dAmn_Client_Queues.Kick=dAmn_Client_Queues.Kick.concat(new Triple(n,e,t)),dAmn_ProcessQueues()},window.dAmn_Kill=function(n,e,t){dAmn_Client_Queues.Kill=dAmn_Client_Queues.Kill.concat(new Triple(n,e,t)),dAmn_ProcessQueues()},window.dAmn_ParseArgsNData=function(n){for(var e,t=Object();;){if(!n.length||"\n"==n.charAt(0))break;var i=dAmn_Client_RE.exec(n);t[i[1]]=i[2].replace(/\s*$/,""),n=n.substr(i[0].length)}return e=n&&n.length?n.substr(1):"",{args:t,body:e}},window.dAmn_ParsePacket=function(n){n||alert("packet data is null");var e=n;try{var t,i,o=n.search("\n");if(0==o)return null;var d=n.substr(0,o).replace(/\s*$/,"");t=d.match(/\S+/)[0];var r=d.search(" ");r&&(i=d.substr(r+1).match(/\S.*/)[0].replace(/\s*$/,""));var a=dAmn_ParseArgsNData(n.substr(o+1));return{cmd:t,param:i,args:a.args,body:a.body}}catch(m){return alert("parse packet exception: \n"+e+"\n\n----\n"+m),null}},window.dAmn_ExceptionPrint=function(n){if(n.stack){var e="\n";for(var t in n)"stack"!=t&&(e+=t+": "+n[t]+"\n");return e+=n.stack}return n.message?n.message:""+n},window.dAmn_arrayRemoveIndex=window.dAmn_arrayFindValue=function(n,e){for(var t=n.length,i=0;t>i;++i)if(n[i]==e)return i;return-1},window.dAmn_arrayAddUnique=function(n,e){return-1==dAmn_arrayFindValue(n,e)?n.concat(e):void 0},window.dAmn_arrayRemValue=function(n,e){for(var t=n.length,i=0;t>i;++i)if(n[i]==e)return dAmn_arrayRemoveIndex(n,i);return n},window.dAmn_arrayForEach=function(n,e){for(var t=n.length,i=0;t>i;++i)e(n[i],i)},window.dAmn_objForEach=function(n,e){for(var t in n)"object"==typeof n[t]&&e(n[t],t)},window.dAmn_objForEachString=function(n,e){for(var t in n)"string"==typeof n[t]&&e(n[t],t)},window.dAmn_objCount=function(n){var e=0;for(var t in n)"object"==typeof n[t]&&++e;return e},window.dAmn_stringIEqual=var n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];window.dAmn_print2Digits=function(n){return 10>n?"0"+(""+n):""+n},window.dAmn_printDate=function(t){var i=new Date(1e3*t);return n[i.getDay()]+" "+e[i.getMonth()]+" "+dAmn_print2Digits(i.getDate())+" "+i.getFullYear()+" ["+dAmn_print2Digits(i.getHours())+":"+dAmn_print2Digits(i.getMinutes())+":"+dAmn_print2Digits(i.getSeconds())+"]"},window.dAmn_printElapsedTime=function(n){var e,t="";0>n?(t="-",e=-n):e=n;var i=parseInt(e/604800);i&&(t+=i+" week",i>1&&(t+="s"),e-=604800*i,e&&(t+=" "));var o=parseInt(e/86400);o&&(t+=o+" day",o>1&&(t+="s"),e-=86400*o,e&&(t+=" "));var d=parseInt(e/3600);d&&(t+=d+" hour",d>1&&(t+="s"),e-=3600*d,e&&(t+=" "));var r=parseInt(e/60);return r&&(t+=r+" minute",r>1&&(t+="s"),e-=60*r,e&&(t+=" ")),e&&(t+=e+" second",e>1&&(t+="s")),n||(t+="0 seconds"),t},window.dAmn_printElement=window.dAmn_doInsertAdjacentHTML=function(n,e,t){try{if(n.insertAdjacentHTML)n.insertAdjacentHTML(e,t);else{var i=n.ownerDocument.createRange();switch(e){case"beforeBegin":i.setStartBefore(n),n.parentNode.insertBefore(i.createContextualFragment(t),n);break;case"afterBegin":n.firstChild?(i.setStartBefore(n.firstChild),n.insertBefore(i.createContextualFragment(t),n.firstChild)):n.innerHTML=t;break;case"beforeEnd":n.lastChild?(i.setStartAfter(n.lastChild),n.appendChild(i.createContextualFragment(t))):n.innerHTML=t;break;case"afterEnd":i.setStartAfter(n),n.parentNode.insertBefore(i.createContextualFragment(t),n.nextSibling)}}}catch(n){alert("doInsertAdjacentHTML caught error: "+n)}},window.dAmn_StringizePacket=function(n){var e="cmd: "+n.cmd+"\nparam: "+n.param+"\n-<args>-\n";if(n.args)for(var t in n.args)e+=t+"="+n.args[t]+"\n";return e+="-<body>-\n",n.body&&(e+=escape(n.body)),e+="\n-<end>-"},window.dAmn_DeleteChildren=window.dAmn_DeleteSelf=window.dAmn_classMatch=function(n,e){if(n){var t=n.split(" ");if(t&&dAmn_arrayFindValue(t,e)>=0)return!0}return!1},window.dAmn_findParentWClass=function(n,e){for(n=n.parentNode;n&&!dAmn_classMatch(n.className,e);)n=n.parentNode;return n},window.dAmn_MakeEl=function(n,e,t){var i=document.createElement(n);return e&&(i.className=e),t&&(i.innerHTML=t),i},window.dAmn_MakeDiv=function(n,e){return dAmn_MakeEl("DIV",n,e)},window.dAmn_MakeSpan=window.dAmn_MakeTextInput=function(){var n=dAmn_MakeEl("INPUT");return n.type="text",n},window.dAmn_MakeButton=function(n,e,t){var i=dAmn_MakeEl("INPUT",e,t);return i.type="button",i.value=n,i},window.dAmn_AddEl=function(n,e,t){return t&&n.firstChild?n.insertBefore(e,n.firstChild):n.appendChild(e),e},window.dAmn_InsertEl=function(n,e,t){return e?n.insertBefore(t,e):n.appendChild(t),t},window.dAmn_AddDiv=function(n,e,t,i){var o=dAmn_MakeEl("DIV",e,t);return dAmn_AddEl(n,o,i),o},window.dAmn_AddSpan=function(n,e,t,i){var o=dAmn_MakeEl("SPAN",e,t);return dAmn_AddEl(n,o,i),o},window.dAmn_AddNewEl=function(n,e,t,i){var o=dAmn_MakeEl(e,t,i);return dAmn_AddEl(n,o,!1)},window.dAmn_getOverflow=function(n){return n.currentStyle?n.currentStyle.overflow:window.getComputedStyle?window.getComputedStyle(n,"").getPropertyValue("overflow"):"unknown"},window.dAmn_getDisplay=function(n){return n.currentStyle?n.currentStyle.display:window.getComputedStyle?window.getComputedStyle(n,"").getPropertyValue("display"):"unknown"},window.dAmn_getPosition=function(n){return n.currentStyle?n.currentStyle.position:window.getComputedStyle?window.getComputedStyle(n,"").getPropertyValue("position"):"unknown"},window.dAmn_getBorderBottomWidth=window.dAmn_cursorToEnd=function(n){n.createTextRange?n.createTextRange().text+="":n.insertionPoint&&(n.insertionPoint=n.text.length)},window.dAmn_resizeFlexyRow=function(n,e,t){var i=0,o="0",d="0";e&&e.offsetHeight&&parseInt(e.offsetHeight)&&(d=e.offsetHeight),t&&t.offsetHeight&&parseInt(t.offsetHeight)&&(o=t.offsetHeight+i);var r=n.offsetHeight-d-o;return d+="px",o+="px",n.style.borderTopWidth!=d&&(n.style.borderTopWidth=d),n.style.borderBottomWidth!=o&&(n.style.borderBottomWidth=o),r},window.dAmn_resizeFlexyCol=function(n,e,t){var i=0,o="0px",d="0px";e&&e.offsetWidth&&parseInt(e.offsetWidth)&&(o=e.offsetWidth+"px"),t&&t.offsetWidth&&parseInt(t.offsetWidth)&&(d=t.offsetWidth+i+"px"),n.style.borderLeftWidth!=o&&(n.style.borderLeftWidth=o),n.style.borderRightWidth!=d&&(n.style.borderRightWidth=d)},window.dAmn_resizeInverted=function(){},window.dAmn_noHTML=function(n){return n?(n=n.replace(/</g,"&lt;"),n.replace(/>/g,"&gt;")):""},window.dAmn_Plugin_WebSockets=function(){this.name="WebSockets",this.url=null,this.connection=null,this.doCmd=function(n){if(ddt.log("damn","WebSockets::doCmd( "+JSON.stringify(n)+" )"),n&&this.clientObj){switch(n.cmd){case"send":this.connection.send(n.arg+"\0");break;case"connect":if(!isWhitelisted(n.arg))break;var e=n.arg.split(":"),t=e[0],i=e[1]?e[1]:80;this.connection&&this.connection.close&&this.connection.close(),this.url="ws://"+t+":"+i+"/dAmnChat",this.connection=new WebSocket(this.url),this.connection.onopen=this.connection.onclose=this.connection.onerror=this.connection.onmessage=function(n){var e;e="\0"==n.data.substr(n.data.length-1)?n.data.substr(0,n.data.length-1):n.data,dAmn_DoCommand("data",e)};break;case"disconnect":this.connection.close();break;case"ping":}dAmn_DoCommand("done")}else dAmn_Plugin.log("No clientObj!")},this.tryAccess=this.load=function(){this.loadCount++,"WebSocket"in window?(this.clientObj=!0,dAmn_DoCommand("info","WebSockets"),dAmn_DoCommand("init","init_arg")):dAmn_Plugin.tryNext("WebSockets not supported")},this.timeout=function(){dAmn_Plugin.log("WebSockets Timeout Function")}},window.dAmn_PluginObj=function(n){this.timer={},this.load=n.load,this.timeout=n.timeout,this.doCmd=n.doCmd,this.name=n.name,this.objName=n.objName,this.tryAccess=n.tryAccess,this.state="init",this.clientObj=null,this.loadCount=0,this.plugin_info={},dAmn_Plugin_timeout=n.timeout},window.dAmn_Plugin_jsPing_timeout=window.dAmn_Plugin_jsWait_timeout=function(){try{var n=dAmn_Plugin.tryAccess();if(!n)throw"noval";var e=new Date;dAmn_Plugin.begin_ts=e.getTime(),dAmn_Plugin.setTimer(1e3,dAmn_Plugin_jsPing_timeout,"dAmn_Plugin_jsPing_timeout"),o.concat(1),dAmn_Command("ping")}catch(t){var e=new Date,i=e.getTime()-dAmn_Plugin.begin_ts;isNaN(i)&&(i=0),1500>i?dAmn_Plugin.setTimer(100,dAmn_Plugin_jsWait_timeout,"dAmn_Plugin_jsWait_timeout"):2>dAmn_Plugin.loadCount?(dAmn_Plugin.log("seems inaccessible from javascript, trying again"),dAmn_Plugin.load()):dAmn_Plugin.tryNext("inaccessible from javascript")}},dAmn_PluginObj.prototype.getClientObj=function(){this.log("Looking for document."+this.objName+":"+document[this.objName]),this.clientObj=document[this.objName]||document.all&&document.all[this.objName],this.clientObj&&this.clientObj.length!==void 0&&(this.clientObj=0===this.clientObj.length?null:this.clientObj[0])},dAmn_PluginObj.prototype.setTimer=function(n,e,t){window.clearTimeout(this.timer.dAmn_Plugin_timeout),e?window.clearTimeout(this.timer[t]):(e=dAmn_Plugin_timeout,t="dAmn_Plugin_timeout"),this.timer[t]=window.setTimeout(e,n)},dAmn_PluginObj.prototype.info=function(n){var e=n.match(/([^:]+):(.+)/);e&&(this.plugin_info[e[1]]=e[2])},dAmn_PluginObj.prototype.getInfo=function(){var n="";for(var e in this.plugin_info)"version"!=e&&(n+=e+"="+this.plugin_info[e]+"\n");return n},dAmn_PluginObj.prototype.getPluginVersion=function(){return this.plugin_info.version?this.plugin_info.version:"Legacy "+this.name},dAmn_PluginObj.prototype.init=function(n){if(this.ponged)return ddt.log("damn","reinit notice"),void 0;if(this.timer)for(var e in this.timer)this.timer.hasOwnProperty(e)&&window.clearTimeout(this.timer[e]);if(this.timer={},this.state="initialized",0==n.search("dAmn Plugin")||"init_arg"==n)if(this.pluginVersion=n,this.clientObj||this.getClientObj(),this.clientObj){this.log("Loaded");var t=new Date;this.begin_ts=t.getTime(),this.setTimer(100,dAmn_Plugin_jsWait_timeout,"dAmn_Plugin_jsWait_timeout")}else this.tryNext("Unable to locate plugin object");else this.tryNext("Plugin can't pass args")},dAmn_PluginObj.prototype.pong=function(){if(this.timer)for(var n in this.timer)this.timer.hasOwnProperty(n)&&window.clearTimeout(this.timer[n]);return this.timer={},this.ponged=!0,!0},dAmn_PluginObj.prototype.log=dAmn_PluginObj.prototype.tryNext=function(n){this.log(n),dAmn_Plugins[this.name]?(dAmn_Plugin=new dAmn_PluginObj(dAmn_Plugins[this.name]),dAmn_Plugin.load()):dAmn_Log("Unable to find a suitable connection method.")},dAmn_Client_RE=/ *([_a-zA-Z0-9]+) *= *([^\n]*)\n/,dAmn_Client_Server="",window.dAmn_Client_Username="",dAmn_Client_Userinfo=Object(),dAmn_Client_AuthToken="",dAmn_Client_State="uninit",dAmn_Client_Queues=Object(),dAmn_Client_Queues.Connect=Array(),dAmn_Client_Queues.Login=Array(),dAmn_Client_Queues.Logoff=Array(),dAmn_Client_Queues.Join=Array(),dAmn_Client_Queues.Part=Array(),dAmn_Client_Queues.Send=Array(),dAmn_Client_Queues.Raw=Array(),dAmn_Client_Queues.Kick=Array(),dAmn_Client_Queues.Set=Array(),dAmn_Client_Queues.Get=Array(),dAmn_Client_Queues.Kill=Array(),dAmn_Client_Queues.javaData=Array(),dAmn_Client_Queues.GetAttention=Array(),dAmn_Client_LogCallback=null,dAmn_LogCallbacks=[],dAmn_Callbacks=[],dAmn_AutoPosObj=Object(),dAmn_Client_retry_connect=!1;var t="";window.Pair=function(n,e){this.a=n,this.b=e},window.Triple=window.dAmn_GetElement=function(n){try{if("string"==typeof n)var e=document.getElementById(n);else var e=n;if(1!=e.nodeType)throw e+" is not an element";return e}catch(t){throw"dAmn_GetElement('"+n+"') got exception: "+t}},window.dAmn_AutoPos_ResizeEvent=function(){dAmn_objForEach(dAmn_AutoPosObj,function(n){try{var e=n.e,t=n.pos;parseInt(e.parentNode.offsetLeft),parseInt(e.parentNode.offsetTop);var i,o,d,r,a=parseInt(e.parentNode.offsetWidth),m=parseInt(e.parentNode.offsetHeight);i=a*t[0][0]+t[0][1],e.style.left=i+"px",o=m*t[1][0]+t[1][1],e.style.top=o+"px",d=a*t[2][0]+t[2][1],e.style.right=a-d+"px",r=m*t[3][0]+t[3][1],e.style.bottom=m-r+"px";var s=d-i;0>s&&(s=0),e.style.width=s+"px";var s=r-o;0>s&&(s=0),e.style.height=s+"px","block"!=e.style.display&&(e.style.display="block"),e.style.margin="0px",e.style.padding="0px",e.style.position="absolute"}catch(e){alert("exception: "+dAmn_ExceptionPrint(e))}})},window.dAmn_Log=function(n){for(var e=dAmn_LogCallbacks.length;e--;)dAmn_LogCallbacks[e](n);dAmn_Client_LogCallback&&dAmn_Client_LogCallback(n),ddt.log("damn",n)},window.dAmn_PopQueue=function(n){var e=dAmn_Client_Queues[n][0];return dAmn_Client_Queues[n]=dAmn_Client_Queues[n].slice(1),e},window.dAmn_ProcessQueues=function(){var n;switch(dAmn_Client_State){case"loggedin":for(;dAmn_PopQueue("Logoff");)dAmn_Command("send","disconnect\n");for(;n=dAmn_PopQueue("Join");)dAmn_Command("send","join "+n+"\n");for(;n=dAmn_PopQueue("Part");)dAmn_Command("send","part "+n+"\n");for(;n=dAmn_PopQueue("Kick");)dAmn_Command("send","kick "+n.a+"\nu="+n.b+"\n\n"+n.c);for(;n=dAmn_PopQueue("Send");)dAmn_Command("send","send "+n.a+"\n\n"+n.b);for(;n=dAmn_PopQueue("Raw");)dAmn_Command("send",n);for(;n=dAmn_PopQueue("Set");)dAmn_Command("send","set "+n.a+"\np="+n.b+"\n\n"+n.c);for(;n=dAmn_PopQueue("Get");)dAmn_Command("send","get "+n.a+"\np="+n.b+"\n");for(;n=dAmn_PopQueue("Kill");)dAmn_Command("send","kill login:"+n.a+(n.b?"\nconn="+n.b:"")+"\n\n"+n.c);case"connected":for(;n=dAmn_PopQueue("Login");)dAmn_Command("send","login "+n.a+"\npk="+n.b+"\n");for(;dAmn_PopQueue("Logoff");)dAmn_Command("disconnect");for(;dAmn_PopQueue("GetAttention");)dAmn_Command("getAttention");break;case"init":for(;dAmn_PopQueue("Logoff");)alert("sending disconnect"),dAmn_Command("disconnect");for(;n=dAmn_PopQueue("Connect");)dAmn_Log("Opening connection to: '"+n+"'"),dAmn_Command("connect",n);case"uninit":}};var i=Array(),o=Array();if(window.dAmn_Command=function(n,e){window.DiFiBug&&DiFiBug.sessionUpdate("damn","> "+n,e,!0),i=i.concat(new dAmn_Cmd(n,e)),dAmn_Command_TrySend()},window.dAmn_Cmd=window.dAmn_Command_TrySend=function(){if(o)if(o=!1,i.length){var n=i[0];i=i.slice(1),dAmn_Plugin.doCmd(n)}else o=!0},window.dAmn_GenerateParsedPacket=function(n,e,t){var i=Object();return i.cmd=n,i.param=e,i.args=Object(),i.body=t,i},window.dAmn_Client_ReConnect=window.dAmnFlash_DoFSCommand=window.dAmnJava_DoCommand_real=function(){for(;v=dAmn_PopQueue("javaData");)dAmn_DoCommand(v.a,v.b)},window.dAmnJava_DoCommand=function(n,e){dAmn_Client_Queues.javaData=dAmn_Client_Queues.javaData.concat(new Pair(unescape(escape(n)),unescape(escape(e)))),window.setTimeout(dAmnJava_DoCommand_real,1)},window.dAmn_DoCommand=function(n,e){switch(ddt.log("damn","dAmn_DoCommand: command= "+n+", arg="+escape(e)),n){case"info":dAmn_Plugin.info(e);break;case"init":dAmn_Plugin.init(e);break;case"done":if("uninit"==dAmn_Client_State){if(!dAmn_Plugin.pong())break;dAmn_Plugin.log("Initialized"),dAmn_Client_State="init",dAmn_ProcessQueues()}o=!0,dAmn_Command_TrySend();break;case"connect":dAmn_Client_State="connected",dAmn_Client_Server=e,t="",dAmn_Command("send","dAmnClient 0.4\nagent="+dAmn_Client_Agent+" - "+dAmn_Plugin.getPluginVersion()+"\nbrowser="+navigator.userAgent+"\nurl="+window.location+"\n"+dAmn_Plugin.getInfo()),dAmn_ProcessQueues();break;case"disconnect":try{dAmn_Client_State="init",t?e&&(t+=" ("+e+")"):t=e,dAmn_Callbacks&&(dAmn_arrayForEach(dAmn_Callbacks,function(e){e(n,t)}),dAmn_Client_retry_connect&&(dAmn_Client_retry_connect=!1,window.setTimeout(dAmn_Client_ReConnect,2500)))}catch(i){}break;case"data":if(window.DiFiBug&&DiFiBug.sessionUpdate("damn","< recv",e,!0),pkt=dAmn_ParsePacket(e))try{switch(pkt.cmd){case"dAmnServer":dAmn_Callbacks&&dAmn_arrayForEach(dAmn_Callbacks,;break;case"disconnect":pkt.args.e&&(t=pkt.args.e);break;case"ping":dAmn_Command("send","pong\n"),dAmn_Callbacks&&dAmn_arrayForEach(dAmn_Callbacks,;break;case"login":if("ok"==pkt.args.e){try{dAmn_Client_Userinfo=dAmn_ParseArgsNData(pkt.body).args}catch(i){dAmn_Log("error: no userinfo -- "+pkt.body)}dAmn_Client_retry_connect=!0,dAmn_Client_Username=pkt.param,dAmn_Client_State="loggedin",dAmn_ProcessQueues()}else dAmn_Client_Userinfo=null;dAmn_Callbacks&&dAmn_arrayForEach(dAmn_Callbacks,;break;default:dAmn_Callbacks&&dAmn_arrayForEach(dAmn_Callbacks,}}catch(i){alert("dAmn 'data("+pkt.cmd+")' problem: "+dAmn_ExceptionPrint(i))}else alert("bad packet!")}},navigator.appName&&-1!=navigator.appName.indexOf("Microsoft")&&-1!=navigator.userAgent.indexOf("Windows")&&-1==navigator.userAgent.indexOf("Windows 3.1")){var d="On Error Resume Next\r\nSub dAmnFlash_FSCommand(ByVal command, ByVal args)\r\n    Call dAmnFlash_DoFSCommand(command, args)\r\nEnd Sub\r\n",r=document.createElement("script");r.type="text/vbscript",r.text=d,document.body.appendChild(r)}window.DWait&&DWait.run("jms/pages/chat07/dAmn.js")});
DWait.ready(["jms/lib/events.js","jms/legacy/modals.js","jms/lib/php.js","jms/lib/difi.js","jms/lib/bind.js","jms/lib/browser.js","jms/lib/jquery/jquery.current.js","jms/lib/crc32.js","jms/lib/php.js"],function(){function dAmnChatTabs_add(e,t,n){var a;if(dAmnChatTabs[e])dAmn_Log("tab already exists: "+e);else{var i=dAmn_MakeEl("A");dAmn_AddSpan(i,null,t);var s=e;i.onclick=function(){dAmnChatTabs_activate(s,!0)},i.appendChild(dAmn_MakeEl("I")),dAmnChatTabs[e]={id:e,name:t,el:n,data:0,tab_el:i},dAmnChatTabStack=dAmnChatTabStack.concat(e),dAmnChat_tabbar.appendChild(i),a=$("span.damnc-morelink",dAmnChat_tabbar)[0],a||(a=$('<span class="damnc-morelink" onclick="dAmn_newRoomClick();"><img src="https://st.deviantart.net/minish/chat/chatplus.gif" alt=""/> More</span>')[0]),dAmnChat_tabbar.appendChild(a)}}function dAmnChat_onCloseServerLog(){dAmnChat_lo_rb_el.style.display="none",dAmn_InvalidateLayout()}window.dAmnChat_Init=function(e){try{null==dAmnChatbase_onResize_prevfunc&&(dAmnChatbase_onResize_prevfunc=window.onresize,window.onresize=dAmnChatbase_onResize),dAmnChat_el=dAmn_GetElement(e),dAmn_DeleteChildren(dAmnChat_el),dAmnChat_lo_rf_el=dAmn_AddDiv(dAmnChat_el,"damn-lo-row-flex alt0 alt0-border"),dAmnChat_lo_rt_el=dAmn_AddDiv(dAmnChat_el,"damn-lo-row-top alt1 damnc-tabbar-outer"),dAmnChat_lo_rb_el=dAmn_AddDiv(dAmnChat_el,"damn-lo-row-bottom"),dAmnChat_header=dAmn_AddDiv(dAmnChat_lo_rt_el,"damnc-header"),dAmnChat_header.innerHTML='<h1><a href="https://chat.deviantart.com/">DeviantArt Chat</a></h1><a class="damnc-helplink" href="https://help.deviantart.com/deviantart/chatnetworkforums/"><img src="https://st.deviantart.net/minish/chat/chathelp.gif" alt=""/> Help</a>',dAmnChat_tabbar=dAmn_AddDiv(dAmnChat_lo_rt_el,"damnc-tabbar tabbar"),dAmnChat_serverlog_outer=dAmn_AddDiv(dAmnChat_lo_rb_el,"damnc-serverlog-outer"),dAmnChat_serverlog=dAmn_AddDiv(dAmnChat_serverlog_outer,"damnc-serverlog"),dAmnChat_AddImgBox(dAmnChat_serverlog_outer,"alert-ignore damnc-serverclose","close","close",dAmnChat_onCloseServerLog),dAmn_AddLogCB(dAmnChatbase_onLog),dAmn_Add_dAmnCB(dAmnChatbase_dAmnCB)}catch(t){alert("dAmnChat_Init() failed! : "+dAmn_ExceptionPrint(t))}},window.dAmn_formatNS=function(e,t){if(0==e.search("chat:"))return"#"+e.split(":")[1];if(0==e.search("pchat:")){var n=e.split(":");return t||!dAmn_stringIEqual(n[1],dAmn_Client_Username)&&!dAmn_stringIEqual(n[2],dAmn_Client_Username)?n[1]+","+n[2]:dAmn_stringIEqual(n[1],dAmn_Client_Username)?n[2]:n[1]}return 0==e.search("login:")?e.split(":")[1]:e},window.dAmn_format_pchat_ns=function(e,t){var n;return e=e.toLowerCase(),t=t.toLowerCase(),n=t>e?"pchat:"+e+":"+t:"pchat:"+t+":"+e},window.dAmnChatbase_dAmnCB=function(e,t){switch(e){case"data":var n=t.param;switch(t.cmd){case"join":"ok"==t.args.e?(dAmnChats[n]||(dAmnChats[n]=new dAmnChat(n)),dAmnChats[n].onData(t)):dAmnChatTab_active?dAmnChats[dAmnChatTab_active].onData(t):dAmn_Log("Unable to join '"+dAmn_formatNS(n)+"' reason: [ "+t.args.e+" ]");break;case"ping":break;default:dAmnChats[n]?dAmnChats[n].onData(t):dAmnChatTab_active?dAmnChats[dAmnChatTab_active].onData(t):dAmn_Log("Unable to handle data cmd: '"+t.cmd+"' for "+dAmn_formatNS(n))}break;case"login":"ok"==t?dAmn_Log("You have logged on as '"+dAmn_Client_Username+"' successfully. [ "+dAmn_Client_Userinfo.gpc+" ]"):dAmn_Log("Failed to logon as '"+dAmn_Client_Username+"' reason: [ "+t+" ]");break;case"connect":dAmn_Log("Connected to '"+t+"' [OK]"),dAmnChatTab_active&&dAmn_objForEach(dAmnChats,;break;case"shutdown":dAmn_objForEach(dAmnChats,function(e){e.onShutdown()});break;case"ping":break;case"disconnect":dAmn_objForEach(dAmnChats,function(e){e.onDisconnect(t)}),dAmnChatTab_active&&dAmn_DeleteChildren(dAmnChat_serverlog),dAmn_Log("You have been disconnected"+(t?". Reason: [ "+t+" ]":"[ no reason given ]")),dAmnChatbase_doLogClose=!0}},window.dAmnChat_Remove=function(e){dAmn_objCount(dAmnChats)>1&&(dAmnChats[e].doRemove(),delete dAmnChats[e],dAmnChatTabs_rem(e))},window.dAmnChatTabs_rem=function(e){dAmnChatTabs[e]?(dAmn_DeleteSelf(dAmnChatTabs[e].tab_el),delete dAmnChatTabs[e],dAmnChatTabStack=dAmn_arrayRemValue(dAmnChatTabStack,e),dAmnChatTab_active==e&&(dAmnChatTab_active=null,dAmnChatTabs_activateNext(!0))):dAmn_Log("Failed to remove tab: "+e)},window.dAmnChatTabs_activate_active=function(){dAmnChatTabs_activate(dAmnChatTab_active,!0),dAmnChatTabs_activate_timer=null},window.dAmnChatTabs_activate=function(e,t){if(dAmnChatTabs_activate_timer&&window.clearTimeout(dAmnChatTabs_activate_timer),dAmnChatTabs_activate_timer=null,t&&dAmnChatTabStack[0]!=e&&(dAmnChatTabStack=dAmn_arrayRemValue(dAmnChatTabStack,e),dAmnChatTabStack=[e].concat(dAmnChatTabStack)),dAmnChatTab_active!=e){if(dAmnChatTab_active){var n=dAmnChatTabs[dAmnChatTab_active];n.data=0;var a=dAmn_MakeEl("A"),i=dAmn_AddSpan(a,null,n.name),s=dAmnChatTab_active;a.onclick=a.appendChild(dAmn_MakeEl("I")),dAmnChat_tabbar.insertBefore(a,n.tab_el),dAmn_DeleteSelf(n.tab_el),n.tab_el=a,n.el.style.visibility="hidden"}if(dAmnChatTab_active=e){var r,n=dAmnChatTabs[dAmnChatTab_active],i=dAmn_MakeEl("STRONG",null,n.name);i.appendChild(dAmn_MakeEl("I"));for(r in dAmnChatTabs)if(r!=dAmnChatTab_active){$(i).addClass("withX"),i.appendChild($('<img src="https://st.deviantart.net/minish/chat/closebig.gif" alt="" onclick="dAmnChats[dAmnChatTab_active].onClose()" style="cursor:pointer"/>')[0]);break}dAmnChat_tabbar.insertBefore(i,n.tab_el),dAmn_DeleteSelf(n.tab_el),n.tab_el=i,dAmn_CalculateLayout(),n.el.style.visibility="visible",dAmnChats[e].channels.main.input.setFocus(),dAmnChatTabs_activate_timer=window.setTimeout(dAmnChatTabs_activate_active,5e3)}dAmn_InvalidateLayout()}},window.dAmnChatTabs_activateNext=function(e){var t=dAmn_arrayFindValue(dAmnChatTabStack,dAmnChatTab_active);return t>=0&&dAmnChatTabStack.length>t+1?(dAmnChatTabs_activate(dAmnChatTabStack[t+1],e),!0):dAmnChatTabStack.length?(dAmnChatTabs_activate(dAmnChatTabStack[0],e),!0):!1},window.dAmnChatTabs_flashTab=function(e){if(dAmnChatTab_active!=e.id&&"A"==e.tab_el.tagName){var t;switch(e.data){case 1:t="#333";break;case 2:t="#B64242"}e.tab_el.style.color!=t&&(e.tab_el.style.color=t,e.tab_el.style.fontWeight="bold"),e.tab_el.firstChild&&(e.tab_el.firstChild.style.visibility=1&e.flash_count?"hidden":"visible"),e.flash_count--&&(e.timer=window.setTimeout(function(){dAmnChatTabs_flashTab(e)},500))}},window.dAmnChatTabs_newData=function(e,t){if(dAmnChatTab_active!=e){var n=dAmnChatTabs[e];n&&(!n.data||t>n.data)&&(n.timer&&window.clearTimeout(n.timer),n.data=t,n.flash_count=6,dAmnChatTabs_flashTab(n))}};var dAmnChat_el=null,dAmnChat_lo_rf_el=null,dAmnChat_lo_rt_el=null,dAmnChat_lo_rb_el=null;window.dAmnChatTabs={},window.dAmnChatTabStack=[],window.dAmnChatTab_active=null,window.dAmnChats=Object();var dAmnChatTabs_activate_timer=null,dAmnChatbase_onResize_prevfunc=null,dAmn_layout_valid=!1,dAmn_layout_valid_override=!1;window.dAmn_InvalidateLayout=function(e){dAmn_layout_valid=!1,e&&(dAmn_layout_valid_override=!1),window.setTimeout(dAmn_CalculateLayout,1)},window.dAmn_CalculateLayout=function(){dAmn_layout_valid&&dAmn_layout_valid_override||(dAmn_layout_valid_override=!0,dAmnChatbase_onResize_cb(!1),dAmn_layout_valid=!0)},window.dAmnChatbase_onResize=function(e){dAmnChatbase_onResize_prevfunc&&dAmnChatbase_onResize_prevfunc(e),dAmnChatbase_onResize_cb(),window.setTimeout(1)},window.dAmnChatbase_onResize_cb=function(e){dAmn_resizeFlexyRow(dAmnChat_lo_rf_el,dAmnChat_lo_rt_el,dAmnChat_lo_rb_el),dAmn_objForEach(dAmnChats,function(t){t.onResize(e)})},window.dAmnChatbase_onLog=function(e){dAmn_addTimedDiv(dAmnChat_serverlog,"servermsg",e,"none"),dAmnChat_serverlog.scrollTop=dAmnChat_serverlog.scrollHeight,dAmn_InvalidateLayout()};var dAmnChatbase_doLogClose=!0;window.dAmnChatbase_imgbox_onclick=function(e){try{var t=e?e.target:window.event.srcElement;if(!t)throw"can't find srcElement";if(t=t.parentNode,!t.imgbox_cb)throw"can't find imgbox_cb";t.imgbox_cb(t.imgbox_arg)}catch(e){alert("closebox_onclick failed: "+dAmn_ExceptionPrint(e))}dAmn_CalculateLayout()},window.dAmnChat_ImgBoxHover_enter=function(){var e=this.childNodes[0],t=this.childNodes[1],n=Browser.isIE?0:1;t.style.left=e.offsetLeft+n+"px",t.style.top=e.offsetTop+n+"px",e.style.visibility="hidden",t.style.visibility="visible"},window.dAmnChat_ImgBoxHover_exit=function(){var e=this.childNodes[0],t=this.childNodes[1];e.style.visibility="visible",t.style.visibility="hidden"},window.dAmnChat_AddImgBox_Images=function(e,t,n,a){var i=dAmn_AddNewEl(e,"IMG");i.title=a,i.src=t.indexOf("close")>=0?"https://st.deviantart.net/minish/chat/closebig.gif":"https://i.deviantart.com/icons/damn/"+t+".png";var s=dAmn_AddNewEl(e,"IMG");s.style.display="none",s.title=a,s.src=t.indexOf("close")>=0?"https://st.deviantart.net/minish/chat/closebig.gif":"https://i.deviantart.com/icons/damn/"+n+".png"},window.dAmnChat_AddImgBox=function(e,t,n,a,i,s){var r=document.createElement("DIV");return r.className=t,r.onclick=dAmnChatbase_imgbox_onclick,r.imgbox_cb=i,r.imgbox_arg=s,dAmnChat_AddImgBox_Images(r,n,n+"_hover",a),e.appendChild(r),r},window.dAmnChatbase_onObjClose=window.dAmnEscape=window.dAmnChat=function(e){if("string"!=typeof e)throw"ns is not a string";this.ns=e,this.nstype=e.split(":")[0],this.connected=!1,this.joined=!1,this.room_el=dAmn_AddDiv(dAmnChat_lo_rf_el,"damncr",null),this.lo_rf_el=dAmn_AddDiv(this.room_el,"damn-lo-row-flex alt0 alt0-border"),this.lo_rt_el=dAmn_AddDiv(this.room_el,"damn-lo-row-top damncr-topbar alt0"),this.lo_cf_el=dAmn_AddDiv(this.lo_rf_el,"damn-lo-col-flex damncr-main alt0 alt0-border"),this.lo_cl_el=dAmn_AddDiv(this.lo_rf_el,"damn-lo-col-left damncr-leftbar alt0"),this.lo_cr_el=dAmn_AddDiv(this.lo_rf_el,"damn-lo-col-right damncr-members sidebar alt0"),this.title_el=dAmn_AddDiv(this.lo_rt_el,"damncr-title"),this.channels=Object(),this.channels.main=new dAmnChanMainChat,this.channels.main.Init(this,"main",this.lo_cf_el),"chat"==this.nstype&&(this.members=new dAmnChatMembers(this,this.lo_cr_el)),this.info_el=dAmn_MakeDiv("damncr-infoctr alt0"),this.channels.main.takeFocus([this.lo_rf_el,this.lo_rt_el,this.title_el])},window.dAmnChat_doRemove=window.dAmnChat_onResize=function(e){dAmn_resizeFlexyCol(this.lo_cf_el,this.lo_cl_el,this.lo_cr_el),dAmn_resizeFlexyRow(this.lo_rf_el,this.lo_rt_el,null),dAmn_objForEach(this.channels,,this.info_el.style.right=this.lo_cr_el.offsetWidth+"px"},window.dAmnChat_onData=function(e){if(e.param==this.ns)switch(e.cmd){case"join":"ok"==e.args.e?(this.connected=!1,dAmnChatbase_doLogClose&&(dAmnChatbase_doLogClose=!1,dAmnChat_onCloseServerLog()),this.channels.main.onSelfEvent(e.cmd,e.args.e)):this.channels.main.onErrorEvent(e.cmd,e.args.e);break;case"part":"ok"==e.args.e?(this.channels.main.onSelfEvent(e.cmd,e.args.r),this.connected=!1):this.channels.main.onErrorEvent(e.cmd,e.args.e),e.args.r||"ok"!=e.args.e||dAmnChat_Remove(this.ns);break;case"kick":"ok"!=e.args.e&&this.channels.main.onErrorEvent(e.cmd,e.args.u,e.args.e);break;case"kicked":this.channels.main.onSelfEvent(e.cmd,e.args.by,e.body),this.connected=!1;break;case"set":case"get":this.channels.main.onErrorEvent(e.cmd,e.args.e,e.args.p);break;case"send":this.channels.main.onErrorEvent(e.cmd,e.args.e);break;case"property":switch(e.args.p){case"members":if("chat"==this.nstype){this.members.ClearMembers();var t=e.body;do{var n=dAmn_ParsePacket(t);n&&(this.members.AddMember(n.param,n.args,!1),t=n.body)}while(n&&t);this.members.Refresh()}this.joined||(this.joined=!0,dAmnChatTabs_add(this.ns,dAmn_formatNS(this.ns),this.room_el,this),dAmnChatTabs_activate(this.ns,!0)),this.connected=!0;break;case"privclasses":for(var a=Array(),i=e.body.split("\n"),s=i.length;s--;)if(i[s]){var r=i[s].split(":");a=a.concat([{name:r[1],order:r[0]}])}a.sort(,this.members.pclist=a,this.members.Refresh();break;case"title":dAmnChanChat.prototype.FormatMsg(e.body,function(t){this.title_el.innerHTML=t,dAmn_InvalidateLayout(),this.channels.main.onEvent(e)}.bind(this));break;case"topic":e.args.c||(e.args.c="main"),this.channels[e.args.c]&&(this.channels[e.args.c].setTopic(e.body,e.args.by,e.args.ts),this.channels[e.args.c].onEvent(e));break;default:}break;case"recv":var o=dAmn_ParsePacket(e.body);switch(o.cmd){case"action":this.channels[o.param]&&this.channels[o.param].onAction(o.args.from,o.body);break;case"msg":this.channels[o.param]&&this.channels[o.param].onMsg(o.args.from,o.body);break;case"part":"chat"==this.nstype&&(this.members.DelMember(o.param),(null==o.args.s||"1"==o.args.s)&&this.channels.main.onEvent(o));break;case"kicked":"chat"==this.nstype&&this.members.DelMember(o.param,!0),this.channels.main.onEvent(o);break;case"join":var d=dAmn_ParseArgsNData(o.body);"chat"==this.nstype&&(this.members.AddMember(o.param,d.args,!0),(null==o.args.s||"1"==o.args.s)&&this.channels.main.onEvent(o));break;case"privchg":this.members.MoveMember(o.param,o.args.pc),this.channels.main.onEvent(o);break;case"admin":o.args.e?this.channels.main.onErrorEvent(o.param+" "+o.p,o.args.e,o.body):this.channels.main.onEvent(o);break;default:alert("unhandled: "+e.body)}break;default:e.args.e&&"ok"!=e.args.e&&this.channels.main.onErrorEvent(e.cmd,e.args.e)}else{var l=e.param.split(":");if(l&&"login"==l[0]&&2==l.length)switch(e.cmd){case"property":"info"==e.args.p&&this.channels.main.onUserInfo(l[1],e.args.body);break;case"get":"info"==e.args.p?this.channels.main.onErrorEvent("whois",l[1],e.args.e):this.channels.main.onParaErrorEvent(e.cmd,e.param,e.args.e)}else e.args.e&&this.channels.main.onParaErrorEvent(e.cmd,e.param,e.args.e)}dAmn_CalculateLayout()},window.dAmnChat_onClose=window.dAmnChat_onDisconnect=window.dAmnChat_onShutdown=window.dAmnChat_Send=function(e,t,n){dAmn_Send(this.ns,e+" "+t+"\n\n"+dAmnEscape(n))},dAmnChat.prototype.onDisconnect=dAmnChat_onDisconnect,dAmnChat.prototype.Send=dAmnChat_Send,dAmnChat.prototype.onShutdown=dAmnChat_onShutdown,dAmnChat.prototype.onResize=dAmnChat_onResize,dAmnChat.prototype.onClose=dAmnChat_onClose,dAmnChat.prototype.doRemove=dAmnChat_doRemove,dAmnChat.prototype.onData=dAmnChat_onData,window.dAmnChat_SetElement=window.dAmnChatMembers=function(e,t){this.cr=e,this.members={},this.element=dAmn_GetElement(t),this.pcs={}},window.dAmnChatMembers_SortMember=window.dAmnChatMembers_MatchMembers=function(e){var t=Array();return dAmn_objForEach(this.members,function(n,a){-1!=a.search(e)&&(t=t.concat(a))}),t},window.dAmnChatMembers_ClearMembers=window.dAmnChatMembers_AddMember=function(e,t,n,a){if(this.members[e]||(this.members[e]=new dAmnChatMember(e,this.cr.info_el,this.cr.lo_cr_el),this.pcs[t.pc]||(this.pcs[t.pc]={cnt:0}),++this.pcs[t.pc].cnt),a?this.members[e].count=a:this.members[e].count++,t.realname=t.realname.replace(/<[^>]+>/g,""),this.members[e].info=t,this.members[e].updateInfo(),n){if(this.members[e].updateHTML(),!this.members[e].attached){var i=Array();dAmn_objForEach(this.members,function(e){e.info.pc==t.pc&&(i=i.concat(e))}),i.sort(dAmnChatMembers_SortMember);for(var s=i.length;s--&&i[s].name!=e;);dAmn_InsertEl(this.pcs[t.pc].el,i[s+1]?i[s+1].el:null,i[s].el),i[s].attached=!0,this.pcs[t.pc].el.style.display="block"}dAmn_InvalidateLayout()}},window.dAmnChatMembers_DelMember=function(e,t){var n=this.members[e];if(n)if(t||0==--n.count){dAmn_DeleteSelf(n.el),n.attached=!1;var a=n.info.pc;try{--this.pcs[a].cnt||(this.pcs[a].el.style.display="none")}catch(i){}delete this.members[e]}else n.updateHTML();dAmn_InvalidateLayout()},window.dAmnChatMembers_MoveMember=function(e,t){var n=this.members[e];n&&(this.DelMember(e,!0),n.info.pc=t,this.AddMember(e,n.info,!0,n.count))},window.dAmnChatMembers_Refresh=function(){var e=Array();dAmn_objForEach(this.members,,e.sort(dAmnChatMembers_SortMember),this.pcs={};for(var t=this.pclist.length;t--;){var n=this.pcs[this.pclist[t].name]={el:dAmn_MakeEl("DL","simple"),cnt:0};dAmn_AddEl(n.el,dAmn_MakeEl("DT",null,this.pclist[t].name))}var t,a=e.length;for(t=0;a>t;++t){var n=this.pcs[e[t].info.pc];n&&(e[t].updateHTML(),dAmn_AddEl(n.el,e[t].el),++n.cnt)}dAmn_DeleteChildren(this.element);for(var t=this.pclist.length;t--;){var n=this.pcs[this.pclist[t].name];n&&(n.el.style.display=n.cnt?"block":"none",dAmn_AddEl(this.element,n.el))}dAmn_InvalidateLayout()},dAmnChatMembers.prototype.AddMember=dAmnChatMembers_AddMember,dAmnChatMembers.prototype.DelMember=dAmnChatMembers_DelMember,dAmnChatMembers.prototype.Refresh=dAmnChatMembers_Refresh,dAmnChatMembers.prototype.MatchMembers=dAmnChatMembers_MatchMembers,dAmnChatMembers.prototype.MoveMember=dAmnChatMembers_MoveMember,dAmnChatMembers.prototype.ClearMembers=dAmnChatMembers_ClearMembers,window.dAmnChat_onKey=function(e){var t,n;return e?(t=e.target,n=e.keyCode?e.keyCode:e.which):(e=window.event,t=e.srcElement,n=e.keyCode),t.dAmnInput_obj?t.dAmnInput_obj.onKey(e,n):!0},window.dAmnChatInput=function(e,t,n){this.cr=e,this.channel=t,this.cmds={me:[1,"action"],kick:[1,"kick"],demote:[0,"demote"],promote:[0,"promote"],ban:[1,"ban"],unban:[1,"unban"],say:[1,"npmsg"],topic:[1],title:[1],clear:[0],help:[0,"https://help.deviantart.com/deviantart/chat/"],join:[1],part:[0],list:[0],note:[1,"https://my.deviantart.com/notes/?tk="],whois:[1,""],kill:[1],raw:[1,""],admin:[1]},this.history=Array(),this.history_pos=-1,this.history_tmp="",this.tablist=null,this.form=dAmn_AddEl(n,dAmn_MakeEl("FORM")),this.form.setAttribute("autocomplete","off"),this.form.setAttribute("target","_self"),this.multiline=!0,this.toggleInput(!0),Browser.isChrome&&(document.onkeyup=function(e){9==e.keyCode&&e.ctrlKey&&dAmnChat_onKey(e)}),Browser.isIE||Browser.isSafari||Browser.isChrome?document.onkeydown=dAmnChat_onKey:document.onkeypress=dAmnChat_onKey},window.dAmnChatInput_toggleInput=function(e){dAmn_DeleteChildren(this.form);var t,n="";return this.chatinput_el&&(n=this.chatinput_el.value),t=(this.form.parentNode.parentNode.getElementsByTagName("input")||[])[0],t&&"button"==t.className||(t=null),this.multiline?(this.prev_multiline_str=n,this.chatinput_el=dAmn_AddEl(this.form,dAmn_MakeTextInput()),this.chatinput_el.setAttribute("autocomplete","off"),this.chatinput_el.value=n,this.multiline=!1,t&&(t.style.display="none")):(this.chatinput_el=dAmn_AddEl(this.form,dAmn_MakeEl("TEXTAREA")),this.multiline=!0,this.chatinput_el.value=this.prev_multiline_str?this.prev_multiline_str:n,t&&(t.style.display="inline")),this.chatinput_el.dAmnInput_obj=this,e||dAmn_InvalidateLayout(),this.multiline},window.dAmnChatInput_onKey=function(e,t,n){var a=this.chatinput_el;if(9==t){if(e.ctrlKey||e.shiftKey)return dAmnChatTabs_activateNext(),!1;if(this.tablist)this.tabindex++,this.tabindex%=this.tablist.length,a.value=a.value.substr(0,this.tabstart)+this.tablist[this.tabindex];else{this.tabstart=a.value.lastIndexOf(" ")+1;var i=a.value.substr(this.tabstart);if(i.length){var s;if("/"==i.charAt(0)){var r=RegExp("^"+i.substr(1)+"\\S*","i");s=Array(),dAmn_objForEach(this.cmds,function(e,t){-1!=t.search(r)&&(s=s.concat("/"+t+" "))})}else if(s=this.cr.members.MatchMembers(RegExp("^"+i+"\\S*","i")),0==this.tabstart)for(var o=s.length;o--;)s[o]+=": ";s.sort(),s.length&&(a.value=a.value.substr(0,this.tabstart)+s[0],s.length>1&&(this.tablist=s,this.tabindex=0))}}return!1}if(this.multiline||(this.prev_multiline_str=null),dAmnChatTabs_activate(this.cr.ns,!0),delete this.tablist,!(e.shiftKey||38!=t||this.multiline&&!e.ctrlKey))return this.history.length&&(-1==this.history_pos?(this.history_tmp=a.value,this.history_pos=this.history.length-1):this.history_pos&&--this.history_pos,a.value=this.history[this.history_pos]),!1;if(!(e.shiftKey||40!=t||this.multiline&&!e.ctrlKey))return-1!=this.history_pos&&(++this.history_pos,this.history_pos==this.history.length&&(this.history_pos=-1),a.value=-1==this.history_pos?this.history_tmp:this.history[this.history_pos]),!1;if(13==t&&(n||!this.multiline||e.shiftKey||e.ctrlKey)){if(a.value){if(-1!=this.history_pos&&this.history[this.history_pos]==a.value){var d=this.history.slice(0,this.history_pos),l=this.history.slice(this.history_pos+1);this.history=d.concat(l).concat(this.history[this.history_pos])}else this.history=this.history.concat(a.value),this.history.length>300&&(this.history=this.history.slice(1));if(this.history_pos=-1,e.shiftKey||!this.multiline&&e.ctrlKey)this.cr.Send("npmsg","main",a.value);else{var m=a.value.match(/^\/([a-z]+)([\s\S]*)/m);if(m){var h=m[1].toLowerCase(),c=null;if(m[2]){var _=m[2].match(/^\s([\s\S]*)/);_&&_.length&&(c=_[1])}if(this.cmds[h])if(this.cmds[h][0])if(c)switch(h){case"raw":c=c.replace(/\\\\/g,"\0"),c=c.replace(/\\n/g,"\n"),c=c.replace(/\0/g,"\\"),dAmn_Raw(dAmnEscape(c));break;case"note":var A=c.match(/^\s*(\S*)\s*$/);A?(DiFi.pushPost("Notes","show",[A[1]],function(e,t){e&&window.open("https://my.deviantart.com/notes/?tk="+t.response.content)}),DiFi.timer(10)):this.cr.channels.main.onErrorEvent("syntax","/note username");break;case"chat":var A=c.match(/^\s*(\S*)\s*$/);A?dAmn_Join(dAmn_format_pchat_ns(dAmn_Client_Username,A[1])):this.cr.channels.main.onErrorEvent("syntax","/chat username");break;case"whois":var A=c.match(/^\s*(\S*)\s*$/);A?dAmn_Get("login:"+A[1],"info"):this.cr.channels.main.onErrorEvent("syntax","/whois username");break;case"join":var A=c.match(/^\s*(\S*)\s*$/);if(A){var p=A[1].match(/^#?(.*)/);dAmn_Join("chat:"+p[1])}else this.cr.channels.main.onErrorEvent("syntax","/join #chatroom");break;case"topic":case"title":dAmn_Set(this.cr.ns,h,dAmnEscape(c));break;case"me":case"say":c?this.cr.Send(this.cmds[h][1],"main",c):this.cr.Send("msg","main",a.value);break;case"kick":var A=c.match(/^\s*(\S*)\s*(.*)$/);A?dAmn_Kick(this.cr.ns,A[1],dAmnEscape(A[2])):this.cr.channels.main.onErrorEvent("syntax","/kick username reason");break;case"kill":var A=c.match(/^\s*([^ \t:]+):([0-9]+)\s*(.*)$/);A?dAmn_Kill(A[1],A[2],A[3]):(A=c.match(/^\s*([^\s:]+)\s*(.*)$/),A?dAmn_Kill(A[1],null,dAmnEscape(A[2])):this.cr.channels.main.onErrorEvent("syntax","/kill username reason"));break;case"ban":case"unban":var A=c.match(/^\s*(\S*)\s*$/);A?this.cr.Send(this.cmds[h][1],A[1],""):this.cr.channels.main.onErrorEvent("syntax","/"+h+" username");break;case"admin":this.cr.Send("admin","",c)}else this.cr.channels.main.onErrorEvent(h,"insufficient parameters");else switch(h){case"help":window.open(this.cmds[h][1]);break;case"list":dAmn_newRoomClick();break;case"clear":var A;c&&(A=c.match(/^(\S*)/)),c&&A?this.channel.ClearUser(c):this.channel.Clear();break;case"away":case"back":this.cr.Send(this.cmds[h][1],"",c);break;case"part":if(c){var A=c.match(/^\s*(\S*)\s*$/);if(A){var p=A[1].match(/^#?(.*)/);dAmn_Part("chat:"+p[1])}else this.cr.channels.main.onErrorEvent("syntax","/part #chatroom")}else dAmn_Part(this.cr.ns);break;case"promote":case"demote":if(c){var A=c.match(/^\s*(\S*)\s*(\S*)\s*$/);A?this.cr.Send(this.cmds[h][1],A[1],A[2]):this.cr.channels.main.onErrorEvent("syntax","/"+h+" username privilegeclass")}else this.cr.Send(this.cmds[h][1],dAmn_Client_Username,"")}else this.cr.channels.main.onErrorEvent("unknown command",h)}else this.cr.Send("msg","main",a.value)}a.value="",a.focus()}return!1}return!0},window.dAmnChatInput_setFocus=function(e){e&&dAmnChatTabs_activate(this.cr.ns,!0),this.chatinput_el.focus(),dAmn_cursorToEnd(this.chatinput_el)},window.dAmnChatInput_appendText=dAmnChatInput.prototype.onKey=dAmnChatInput_onKey,dAmnChatInput.prototype.setFocus=dAmnChatInput_setFocus,dAmnChatInput.prototype.SetElement=dAmnChat_SetElement,dAmnChatInput.prototype.toggleInput=dAmnChatInput_toggleInput,dAmnChatInput.prototype.appendText=dAmnChatInput_appendText,window.dAmnChat_enterInfoCtr=window.dAmnChat_leaveInfoCtr=function(e){e.timeout&&window.clearTimeout(e.timeout),e.timeout=window.setTimeout(function(){dAmn_DeleteSelf(e)},100)};var dAmn_avatar_ext=[".gif",".gif",".jpg",".png"];window.dAmn_printAvatar=function(e,t){var n,a;if(t=parseInt(t),cachebuster=15&t>>2,t=3&t,a=dAmn_avatar_ext[t],a||(a=".gif"),cachebuster=cachebuster?"?"+cachebuster:"",t){var i=e.replace(/[^a-zA-Z0-9_]/g,"_");n=i.charAt(0)+"/"+i.charAt(1)+"/"+e,n=n.toLowerCase()}else n="default";return'<a target="_blank" href="'+PHP.userurl(e)+'">'+'<img alt="" src="https://a.deviantart.net/avatars/'+n+a+cachebuster+'" alt="'+e+'" title="'+e+'" width="50" height="50" onload="this.removeAttribute(\'width\');this.removeAttribute(\'height\')"/></a>'},window.dAmnChatMember=function(e,t,n){n.onmouseout&&n.onmouseover||(n.onmouseover=function(){dAmnChat_enterInfoCtr(t)},n.onmouseout=function(){dAmnChat_leaveInfoCtr(t)}),this.count=0,this.name=e,this.el=dAmn_MakeEl("DD","dAmnChatMember");var a=this;this.showinfo=function(){dAmnChat_enterInfoCtr(t);var e=a.el.parentNode.parentNode,n=e.parentNode;dAmn_DeleteChildren(t),dAmn_DeleteSelf(t),dAmn_AddEl(t,a.info_el),t.style.top=a.el.offsetTop-e.scrollTop+"px",t.style.right=e.offsetWidth+"px",t.onmouseover=function(){dAmnChat_enterInfoCtr(t)},t.onmouseout=function(){dAmnChat_leaveInfoCtr(t)},dAmn_AddEl(n,t)},this.el.onmouseover=function(){a.showtimer&&window.clearTimeout(a.showtimer),a.showtimer=window.setTimeout(25)},this.el.onmouseout=function(){a.showtimer&&window.clearTimeout(a.showtimer),a.showtimer=null,dAmnChat_leaveInfoCtr(t)}},window.dAmnChatMember_updateInfo=function(){this.info_el=dAmn_MakeDiv("damncri-member"),dAmn_AddDiv(this.info_el,"aside-left avatar alt1",dAmn_printAvatar(this.name,this.info.usericon));var e=dAmn_AddDiv(this.info_el,"bodyarea alt1-border"),t=dAmn_AddDiv(e,"b pp");dAmn_AddNewEl(t,"STRONG",null,PHP.userlink(this.name,this.info.symbol));var n=dAmn_AddDiv(t),a=dAmn_AddNewEl(n,"UL");this.info.realname&&dAmn_AddNewEl(a,"LI",null,this.info.realname),"guest"!=this.info.gpc&&dAmn_AddNewEl(a,"LI",null,"dAmn "+this.info.gpc)},window.dAmnChatMember_updateHTML=function(){var e=PHP.userlink(this.name,this.info.symbol,"/",!0);this.count>1&&(e+="["+this.count+"]"),this.el.innerHTML=e},dAmnChatMember.prototype.updateHTML=dAmnChatMember_updateHTML,dAmnChatMember.prototype.updateInfo=dAmnChatMember_updateInfo,window.dAmnChat_EmbededMedia_OnClick=function(Clicked,type,arg1,arg2,arg3){var Holder,Expand,Spans,i,outstr,Out=0;for(Holder=Clicked.parentNode.parentNode,i=-1,Spans=Holder.getElementsByTagName("span");Spans[++i]&&!Out;)Spans[i].className.indexOf("collapsible")>=0&&(Out=Spans[i]);if(Out.className.indexOf("standby")>=0)switch(type){case"img":outstr='<img src="'+arg1+'"',arg2&&(outstr+=' alt="'+arg2+'"'),arg3&&(outstr+=' title="'+arg3+'"'),outstr+="/>";break;case"iframe":outstr='<iframe src="'+arg1+'"',arg2&&(outstr+=' width="'+arg2+'"'),arg3&&(outstr+=' height="'+arg3+'"'),outstr+=">";break;case"embed":outstr='<embed src="'+arg1+'"',arg2&&(outstr+=' width="'+arg2+'"'),arg3&&(outstr+=' height="'+arg3+'"'),outstr+=">"}with(Expand=Holder.className.indexOf("collapsed")>=0,Holder.className=Expand?"expanded":"collapsed",Clicked.getElementsByTagName("img")[0])setAttribute("alt",Expand?"_":"^"),setAttribute("title",Expand?"Minimize":"Maximize"),setAttribute("src",Expand?"https://i.deviantart.com/icons/damn/minimize.gif":"https://i.deviantart.com/icons/damn/maximize.gif");if(!Browser.isIE){var sTmp=Holder.style.display;Holder.style.display="none",Holder.style.display=sTmp}return Out.innerHTML=outstr,!1};var dAmnChanChat_FormatEmbeded_Embed={},dAmnChanCHat_FormatEmbeded_Regex={img:/&img\t([^\t]+)\t([^\t]*)\t([^\t]*)\t/g,iframe:/&iframe\t([^\t]+)\t([^\t]*)\t([^\t]*)\t/g,embed:/&embed\t([^\t]+)\t([^\t]*)\t([^\t]*)\t/g},damn_select_emotes=[[";)",";) (Wink)","w/wink.gif","15","15","Expressions"],[":(",":( (Sad)","f/frown.gif","15","15","Expressions"],[":)",":) (Smile)","s/smile.gif","15","15","Expressions"],[":D",":D (Big Grin)","b/biggrin.gif","15","15","Expressions"],[":O",":O (Eek)","e/eek.gif","15","15","Expressions"],[":P",":P (Lick)","letters/=p.gif","15","15","Expressions"],[":blahblah:","You talk too much!","b/blahblah.gif","37","15","Moods"],[":boogie:","Boogie!","b/boogie.gif","25","25","Actions"],[":censored:","Censored","c/censored.gif","34","15","Other"],[":cheese:","Cheese","c/cheese.gif","16","16","Food &amp; Drink"],[":clap:","Clap","c/clap.gif","25","25","Actions"],[":confused:","Confused","c/confuse.gif","18","15","Moods"],[":cries:","Waaaah!","c/cries.gif","23","15","Actions"],[":dance:","Dance!","d/dance.gif","29","21","Actions"],[":evillaugh:","EVIL Laughter!","m/mwahaha.gif","29","15","Actions"],[":flirty:","Flirtatious","f/flirty.gif","30","26","Moods"],[":giggle:","Giggle","g/giggle.gif","17","15","Actions"],[":glomp:","Glomp!","g/glomp.gif","47","20","Actions"],[":heart:","Heart","h/heart.gif","15","13","Objects"],[":idea:","Idea","i/idea.gif","15","32","Actions"],[":ignore:","Ignore","i/ignore.gif","26","15","Actions"],[":kiss:","Kiss","k/kiss.gif","15","15","Other"],[":lolly:","lllo0o0olll and his beer","l/lolly.gif","25","21","DA People"],[":love:","Love","l/love.gif","23","16","Moods"],[":meditation:","Ohm... Ohm...","m/meditate.gif","29","23","Actions"],[":nod:","Nod","n/nod.gif","15","15","Actions"],[":ohmygod:","OMG!","o/ohmygod.gif","26","18","Expressions"],[":poke:","Poke!","p/poke.gif","44","14","Actions"],[":raincloud:","Grr.","r/raincloud.gif","24","27","Moods"],[":slow:","Slow","i/imslow.gif","19","19","Expressions"],[":tears:","Tears","t/tears.gif","15","15","Expressions"],[":wave:","Hi!","w/wave.gif","25","20","Actions"],[":whisper:","Whisper sweet nothings in my ear!","w/whisper.gif","31","21","Actions"],[":worship:","Worship","w/worship.gif","30","15","Actions"],[":wow:","Wow!","w/wow.gif","23","15","Expressions"]];window.dAmnChanChat=function(){dAmnChanChat_InitMap(["gif","jpg","bmp"],"image"),dAmnChanChat_InitMap(["mov","avi","mpg","wmv"],"movie"),dAmnChanChat_InitMap(["wav","mp3","mp2","ogg"],"audio"),dAmnChanChat_InitMap(["swf"],"flash")},dAmnChanChat.prototype.InitMap=function(e,t){for(var n=e.length;n--;)dAmnChanChat_FormatEmbeded_Embed[e[n]]=t},dAmnChanChat.prototype.onResize=function(e){dAmn_resizeFlexyRow(this.lo_rf_el,this.lo_rt_el,this.lo_rb_el),(e||this.scroll_once)&&(this.scroll_el.scrollTop=this.scroll_el.scrollHeight),this.prev_scroll_height&&this.prev_scroll_height==this.scroll_el.scrollHeight?(this.chat_el.style.display="none",this.chat_el.style.display="block",dAmn_InvalidateLayout(!0)):(this.prev_scroll_height=0,this.scroll_once=!1)},dAmnChanChat.prototype.onSmileyClick=function(e){if(e||(e=window.event),e.srcElement)e=srcElement;else{if(!e.target)return;e=e.target}e.dAmnchan&&(e.dAmnchan.input.appendText(e.alt),dAmn_DeleteSelf(dAmn_findParentWClass(e,"damncr-popup")))},dAmnChanChat.prototype.onSmiley=function(e){var t,n=dAmn_MakeDiv("damncr-popup alt1"),a=damn_select_emotes.length,i=160,s=4,r=i/s,o=i-r*(s-1);n.style.width=i+12+"px",n.style.padding="5px";var d,l;for(t=0;a>t;++t){var m=damn_select_emotes[t];0==t%s?(d=o-m[3],l=dAmn_AddNewEl(n,"DIV")):d=r-m[3];var h=dAmn_AddNewEl(l,"A");h.style.textAlign="center";var c=dAmn_AddNewEl(h,"IMG");c.title=m[1],c.alt=m[0],c.src="https://st.deviantart.net/emoticons/"+m[2],c.style.width=m[3]+"px",c.style.height=m[4]+"px",c.style.paddingLeft=d/2+"px",c.style.paddingRight=d-d/2+"px",c.dAmnchan=e,c.onclick=this.onSmileyClick}n.style.left=e.smiley_el.offsetLeft+"px",e.chatw_el.appendChild(n)},dAmnChanChat.prototype.onLines=function(e){dAmn_DeleteChildren(e.multi_el),e.input.toggleInput()?dAmnChat_AddImgBox_Images(e.multi_el,"lines_hover","lines","singleline input"):dAmnChat_AddImgBox_Images(e.multi_el,"lines","lines_hover","multiline input")
},dAmnChanChat.prototype.Init=function(e,t,n){this.cr=e,this.name=t,this.msgcount=0,this.parent_el=n,this.lo_rf_el=dAmn_AddDiv(n,"damn-lo-row-flex alt2 alt0-bottom-border alt1-top-border"),this.lo_rt_el=dAmn_AddDiv(n,"damn-lo-row-top alt0"),this.lo_rb_el=dAmn_AddDiv(n,"damn-lo-row-bottom alt0 damncrc-base"),this.topic_el=dAmn_AddDiv(this.lo_rt_el,"damncrc-topic alt1"),this.chatw_el=dAmn_AddDiv(this.lo_rf_el,"damncrc-chat-window alt2"),this.chato_el=dAmn_AddSpan(this.chatw_el,"damncrc-chat-outer alt2"),this.chati_el=dAmn_AddSpan(this.chato_el,"damncrc-chat-inner"),this.chat_el=dAmn_AddSpan(this.chati_el,"damncrc-chat"),this.scroll_el=this.chatw_el,this.iconbar_el=dAmn_AddDiv(this.lo_rb_el,"damncrc-iconbar ");var a,i=dAmn_AddDiv(this.iconbar_el,"damncrc-iconbar-ctrls"),s=dAmn_MakeButton("send","button"),r=this;s.style.display="none",s.onclick=function(e){return r.input.onKey(e?e:window.event,13,!0)},a=$("#dax-festival")[0],a&&(a=$("a",a).toArray(),a.pop(),a[0]&&(i.appendChild(a[0]),i.appendChild(document.createTextNode(" | ")))),"chat"==this.cr.ns.split(":")[0]&&(i.appendChild($('<a onclick="return popup(this.href, \'chatroom\', 700, 400);" href="https://chat.deviantart.com/manage/'+this.cr.ns.split(":")[1]+'">Chatroom Settings </a>&nbsp;')[0]),i.appendChild($("<b> | </b>")[0])),i.appendChild($('<a class="emoticons show_emoticons_modal" href="https://comments.deviantart.com/emoticons/" onclick="return false;" >Emoticons</a>&nbsp;')[0]),dAmn_AddEl(i,s),dAmn_AddDiv(this.iconbar_el,"damncrc-icon-roomname",PHP.userlink(dAmn_Client_Username,dAmn_Client_Userinfo.symbol,"/",!0)+(0==this.cr.ns.indexOf("chat:")?" on ":" - ")+dAmn_formatNS(this.cr.ns)),this.multi_el=dAmnChat_AddImgBox(this.iconbar_el,"damncrc-icon-multi","lines","multiline input",dAmnChanChat.prototype.onLines,this),this.input_el=dAmn_AddDiv(this.lo_rb_el,"damncrc-input "),this.input=new dAmnChatInput(e,this,this.input_el),this.Clear(),this.dd_down=function(e){e||(e=window.event),r.dd_down_xy={x:e.clientX,y:e.clientY}},this.dd_up=function(e){try{e||(e=window.event);var t={x:e.clientX,y:e.clientY},n={x:r.dd_down_xy.x-t.x,y:r.dd_down_xy.y-t.y};0>n.x&&(n.x=-n.x),0>n.y&&(n.y=-n.y),5>n.x&&5>n.y&&1==e.which&&r.input.setFocus(!0)}catch(e){}},this.takeFocus([this.lo_rf_el,this.lo_rt_el,this.lo_rb_el,this.topic_el,this.chatw_el,this.chato_el,this.chati_el,this.chat_el,this.iconbar_el]),this.subInit&&this.subInit()},dAmnChanChat.prototype.takeFocus=function(e){var t=this;dAmn_arrayForEach(e,},dAmnChanChat.prototype.setTopic=function(e){this.FormatMsg(e,function(e){e?(this.topic_el.innerHTML=e,this.topic_el.style.display="block"):(this.topic_el.style.display="none",this.topic_el.innerHTML=e),dAmn_InvalidateLayout()}.bind(this))},dAmnChanChat.prototype.addDiv=function(e,t,n){var a=!1,s=this.scroll_el.scrollTop+this.scroll_el.clientHeight,r=this.scroll_el.scrollHeight;if(10>r-s&&(a=!0),this.prev_scroll_height=0,this.chat_el.childNodes.length>=250)for(this.prev_scroll_height=this.scroll_el.scrollHeight,i=0;50>i;++i)dAmn_DeleteSelf(this.chat_el.childNodes[i]);t?e.style.display="inline-block":this.chat_el.appendChild(e),this.scroll_once=a,(2==n||1==n&&"pchat"==this.cr.nstype)&&dAmn_GetAttention(),dAmnChatTabs_newData(this.cr.ns,n),dAmn_InvalidateLayout()},dAmnChanChat.prototype.makeText=function(e,t,n,a){this.FormatMsg(n,function(n){var i=dAmn_MakeSpan("msg "+e);i.style.display="none";var s=document.createElement("br");this.chat_el.appendChild(s),this.chat_el.appendChild(i);var r=dAmn_AddSpan(i,"inner"),o=dAmn_AddSpan(r,"from");if(dAmn_AddSpan(o,null,t),n){var d=dAmn_AddSpan(r,"text");dAmn_AddSpan(d,null,n),this.wrapEl(i)}this.addDiv(i,!0,a)}.bind(this))},dAmnChanChat.prototype.wrapEl=function(e,t){var n=try{t=t||35;var a=$(e).find("span.text span");if(!a||!a.length)return!1;var i=dAmnChatbase_getTextNodesIn(a[0]),s=a.html(),r=!1;dAmn_objForEach(i,function(e){var a=e.nodeValue;if(a.length>=t){var i=a.match(RegExp("[^ ]{"+t+",}","g"));if(i.length>0){var o;for(o in i)"string"==typeof i[o]&&(s=s.replace(n(i[o]).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),n(dAmnChatbase_returnwordwraped(i[o])).replace(/&amp;#8203;/gi,"&#8203;")),r=!0)}}}.bind(this)),r&&a.html(s)}catch(o){}},dAmnChanChat.prototype.FormatEmbeded=function(e,t){for(var n,a,i=dAmnChanCHat_FormatEmbeded_Regex[e];null!=(n=i.exec(t));){var s,r=n[1].match(/https?:\/\/([^\/]+)(.*)/);if(r)if(r[2]){var o=r[2].match(/(.*\/)([^\/?]+)[?$]/);s=o?r[1]+("/"==o[1]?"/":"/.../")+o[2]:r[1]}else s=r[1];else s=n[1];var d;if("img"==e)d="image";else if("embed"==e){var l=n[1].match(/\.([a-zA-Z]+)$/);l?(d=dAmnChanChat_FormatEmbeded_Embed[l[1].toLowerCase()],d||(d="object")):d="object"}else d="iframe"==e?"website":"object";a='<a class="toggle" href="" onclick="return dAmnChat_EmbededMedia_OnClick(this,\''+e+"','"+n[1]+"','"+n[2]+"','"+n[3]+"')\">"+'<img src="https://i.deviantart.com/icons/damn/maximize.gif" alt="^" width="18" height="18" title="Maximize"/>'+"</a>",t=t.substr(0,n.index)+'<span class="collapsed"'+" onmouseover=\"if(this.className=='collapsed'){this.className='collapsed collapsed-hover';this.childNodes[0].className='exc alt1'}\""+" onmouseout=\"if(this.className.indexOf('collapsed')>=0){this.className='collapsed';this.childNodes[0].className='exc'}\""+">"+'<span class="exc alt1">'+'<a class="toggle" href="" onclick="return dAmnChat_EmbededMedia_OnClick(this,\''+e+"','"+n[1]+"','"+n[2]+"','"+n[3]+"')\">"+'<img src="https://i.deviantart.com/icons/damn/maximize.gif" alt="^" width="18" height="18" title="Maximize"/>'+"</a>"+'<span class="label"><a target="_blank" href="'+n[1]+'" title="'+n[1]+'">['+d+": <em>"+s+"</em>]</a></span> "+'<br/><span class="collapsible standby"> </span> '+"</span>"+"</span>"+t.substr(i.lastIndex)}return t},dAmnChanChat.prototype._oembedcache={},dAmnChanChat.prototype.FormatMsg=function(e,t){var n,a,i,s=$.Deferred(),r=[],o=[],d=0;if(s.always(t),!e)return s.resolveWith(this,[""]);for(e=e.replace(/&b\t/g,"<strong>").replace(/&\/b\t/g,"</strong>").replace(/&i\t/g,"<em>").replace(/&\/i\t/g,"</em>").replace(/&u\t/g,'<span style="text-decoration:underline">').replace(/&\/u\t/g,"</span>").replace(/&sub\t/g,"<sub>").replace(/&\/sub\t/g,"</sub>").replace(/&sup\t/g,"<sup>").replace(/&\/sup\t/g,"</sup>").replace(/&s\t/g,"<del>").replace(/&\/s\t/g,"</del>").replace(/&p\t/g,"<p>").replace(/&\/p\t/g,"</p>").replace(/&br\t/g,"<br/>").replace(/&code\t/g,"<code>").replace(/&\/code\t/g,"</code>").replace(/&bcode\t/g,"<pre><code>").replace(/&\/bcode\t/g,"</code></pre>").replace(/&li\t/g,"<li>").replace(/&\/li\t/g,"</li>").replace(/&ul\t/g,"<ul>").replace(/&\/ul\t/g,"</ul>").replace(/&ol\t/g,"<ol>").replace(/&\/ol\t/g,"</ol>").replace(/&acro\t([^\t]+)\t/g,'<acronym title="$1">').replace(/&\/acro\t/g,"</acronym>").replace(/&abbr\t([^\t]+)\t/g,'<abbr title="$1">').replace(/&\/abbr\t/g,"</abbr>").replace(/&a\t([^\t]+)\t([^\t]*)\t/g,'<a target="_blank" href="$1" title="$2">').replace(/&\/a\t/g,"</a>"),e=dAmnChanChat.prototype.FormatEmbeded("img",e),e=dAmnChanChat.prototype.FormatEmbeded("iframe",e),e=e.replace(/&\/iframe\t/g,"</iframe"),e=dAmnChanChat.prototype.FormatEmbeded("embed",e),e=e.replace(/&\/embed\t/g,"</embed"),e=e.replace(/&dev\t([^\t]?)\t([^\t]+)\t/g,,e=e.replace(/&link\t([^\t]+)\t&/g,function(e,t){var n="http://"==t.substr(0,7)?t.substr(7):t;return n.length>32&&(n=n.substring(0,30)+"&hellip;"),'<a target="_blank" href="'+t+'" title="'+t+'">'+n+"</a>"}),e=e.replace(/&link\t([^\t]+)\t([^\t]+)\t&\t/g,'<a target="_blank" href="$1" title="$1">$2</a>'),e=e.replace(/&emote\t([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)\t/g,'<img alt="$1" width="$2" height="$3" title="$4" src="https://st.deviantart.net/emoticons/$5"/>'),n=/&avatar\t([^\t]+)\t([^\t]+)\t/g;null!=(a=n.exec(e));)e=e.substr(0,a.index)+dAmn_printAvatar(a[1],a[2])+e.substr(n.lastIndex);for(d=e.length,n=/&thumb\t([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)\t/g;null!=(a=n.exec(e));){var l,m=a[1],h=a[2],c=a[3].split("x"),_=a[4],A=a[5],p=a[6].split(":"),u=c[0],b=c[1],f=100,g=100,v="https://www.deviantart.com/art/"+deviation_url_title(a[2])+"-"+a[1],C=!1;if(u/b>f/g?(b=parseInt(b*g/u),u=f):(u=parseInt(u*f/b),b=g),(u>c[0]||b>c[1])&&(u=c[0],b=c[1]),"0"!=p[1])i='<a target="_blank" href="'+v+'" title="'+h+'">[mature deviation:'+a[2]+"]</a>";else if("0"!=p[2])i='<a target="_blank" href="'+v+'" title="'+h+'">[deviation:'+a[2]+"]</a>";else if(A.match(/\.gif$/i))if(c[0]>100||c[1]>100)i='<a target="_blank" href="'+v+'" title="'+h+'">[deviation:'+a[2]+"]</a>";else{_=Math.abs(crc32(A))%3+1,A=A.replace(/:/,"/"),C="0"==p[0];var w="fc0"+_+".deviantart.net/"+A,y=A.split("/");y&&y.length>1&&(y=y[0].split("."),y&&y.length>2&&(w=A)),i='<a target="_blank" href="'+v+'"><img title="'+h+'" width="'+u+'" height="'+b+'" alt=":thumb'+m+':" src="https://'+w+'"/></a>'}else C="0"==p[0],l={$deferred:$.Deferred(),res:i},r.push(l.$deferred),this._oembedcache[m]=i=this._oembedcache[m]||$.ajax({url:"https://backend.deviantart.com/oembed?url="+encodeURIComponent("https://www.deviantart.com/deviation/"+m)+"&format=jsonp"+"&consumer=internal",timeout:5e3,dataType:"jsonp"}),setTimeout(function(e,t){return (this._oembedcache,m),6e4);o.push(function(t,n,a,i,s,r,o,l,m,h,c){return"string"!=typeof i&&i.done(function(e){e&&e.thumbnail_url_150?(i='<a target="_blank" href="'+s+'"><img title="'+r+'" width="'+o+'" height="'+l+'" alt=":thumb'+m+':" src="'+e.thumbnail_url_150+'"/></a>',h.$deferred.resolve()):e&&e.thumbnail_html?(i=e.thumbnail_html,c=!1,h.$deferred.resolve()):e&&!e.error?(i='<a target="_blank" href="'+s+'">['+r+"]</a>",c=!1,h.$deferred.resolve()):(i=":thumb"+m+":",h.$deferred.reject())}).fail(function(){i=":thumb"+m+":",h.$deferred.reject()}),function(){var t=e.length-d;c&&(i='<span class="shadow-holder"><span class="shadow" style="background-image:url(https://sh.deviantart.net/shadow/alpha-000000/5.1-0.6/'+o+"/"+l+'/null.png);">'+i+"</span></span>"),e=e.substr(0,n+t)+i+e.substr(a+t)}}(A,a.index,n.lastIndex,i,v,h,u,b,m,l,C&&!A.match(/\.gif$/i)&&!A.match(/\.png$/i)))}return $.when.apply($,r.length?r:[!0]).always(function(){for(var t;t=o.shift();)t();s.resolveWith(this,[e])}.bind(this)),s},dAmnChanChat.prototype.onMsg=function(e,t){var n;-1!=e.search(RegExp("([^A-Za-z]+|^)"+dAmn_Client_Username+"([^A-Za-z]+|$|s$|s[^A-Za-z]+)","i"))?n=" self-hl":-1!=t.search(RegExp("([^A-Za-z]+|^)"+dAmn_Client_Username+"([^A-Za-z]+|$|s$|s[^A-Za-z]+)","im"))&&(n=" other-hl"),this.makeText("u-"+e.toLowerCase()+(n?n:""),"&lt;"+e+"&gt;",t,n?2:1)},dAmnChanChat.prototype.onAction=function(e,t){var n="action u-"+e.toLowerCase();-1!=t.search(RegExp(dAmn_Client_Username,"im"))&&(n+=" alt0"),this.makeText(n,"* "+e,t,1)},dAmnChanChat.prototype.ClearUser=function(e){var t=e.split(" "),n=this.chat_el;$.each(t,function(e,t){var a=$(".u-"+t.toLowerCase(),n);a.prev("br").remove(),a.remove()}),dAmn_InvalidateLayout()},dAmnChanChat.prototype.Clear=function(){this.chat_el.innerHTML="",dAmn_InvalidateLayout()},window.dAmnChatbase_getTextNodesIn=function(e,t){var n=[],a=/^\s*$/,i=function(e){if(3===e.nodeType)(t||!a.test(e.nodeValue))&&n.push(e);else for(var s=0,r=e.childNodes.length;r>s;++s)i(e.childNodes[s])};return i(e),n},window.dAmnChatbase_returnwordwraped=function(e,t,n,a){if(n=n||"&#8203;",t=t||1,a=a||!0,!e)return e;var i=".{1,"+t+"}(\\s|$)"+(a?"|.{"+t+"}|.+$":"|\\S+?(\\s|$)");return e.match(RegExp(i,"g")).join(n)},window.dAmnChatbase_updateAlerts=function(e,t){for(var n=e.childNodes.length,a=!0;a&&n--;)"none"!=e.childNodes[n].style.display&&(e.childNodes[n].className&&-1!=e.childNodes[n].className.search("alert-ignore")||(a=!1));a&&(e.style.display="none"),t||dAmn_InvalidateLayout()},window.dAmnChatbase_removeAlert=function(e){try{var t=e.parentNode;e==t.last_d&&(t.style.display="none"),dAmn_DeleteSelf(e),t.scrollTop=t.scrollHeight,dAmnChatbase_updateAlerts(t.parentNode)}catch(n){}},window.dAmnChatbase_onHide=function(e,t){e.style.display="none",e.innerHTML="",dAmnChat_AddImgBox(e,"damncrc-hide","close","close",dAmnChatbase_onHide,e),t||dAmnChatbase_updateAlerts(e.parentNode)},window.dAmn_addTimedDiv=function(e,t,n,a){var i=dAmn_AddDiv(e,t,n);e.last_d=i,(!a||parseInt(a))&&window.setTimeout(a?1e3*a:5e3),e.style.display="block",e.parentNode.style.display="block",e.parentNode.parentNode.style.display="block",dAmn_InvalidateLayout()},window.dAmnChanMainChat=function(){this.subInit=function(){this.alerts_el=document.createElement("DIV"),this.alerts_el.className="damncr-main-alerts alt1",this.lo_rb_el.insertBefore(this.alerts_el,this.iconbar_el),this.chatreq_el=dAmn_AddDiv(this.alerts_el,"damncrc-alertbox alt2 damncrc-chatreq"),this.error_el=dAmn_AddDiv(this.alerts_el,"damncrc-alertbox alt2 damncrc-error"),this.info_el=dAmn_AddDiv(this.alerts_el,"damncrc-alertbox alt2 damncrc-info"),dAmnChatbase_onHide(this.chatreq_el,!0),dAmnChatbase_onHide(this.error_el,!0),dAmnChatbase_onHide(this.info_el,!0)}},dAmnChanMainChat.prototype=dAmnChanChat.prototype,dAmnChanMainChat.prototype.onEvent=function(e){switch(e.cmd){case"privchg":e.args.i&&"1"!=e.args.i||this.makeText(e.cmd,"** "+e.param+" has been made a member of <em>"+e.args.pc+"</em> by "+e.args.by+" * ",null,0);break;case"kicked":e.args.i&&"1"!=e.args.i||this.makeText(e.cmd,"** "+e.param+" was kicked by "+e.args.by+" * ",e.body,0);break;case"property":this.cr.connected&&this.makeText(e.cmd,"** "+e.args.p+" changed by "+e.args.by+" * ",null,0);break;case"part":this.makeText(e.cmd,"** "+e.param," has left"+(e.args.r?" ["+e.args.r+"]":""),0);break;case"join":this.makeText(e.cmd,"** "+e.param," has joined",0);break;case"admin":switch(e.param){case"create":this.makeText(e.cmd,"** privilege class <em>"+e.args.name+"</em> has been created by "+e.args.by+" with: "+e.args.privs,0);break;case"move":this.makeText(e.cmd,"** all members of <em>"+e.args.prev+"</em> have been made <em>"+e.args.name+"</em> by "+e.args.by+" -- "+(1==e.args.n?"1 member was affected":e.args.n+" members were affected"),0);break;case"remove":this.makeText(e.cmd,"** privilege class <em>"+e.args.name+"</em> has been removed by "+e.args.by+" -- "+(1==e.args.n?"1 member was affected":e.args.n+" members were affected"),0);break;case"update":"privclass"==e.args.p?this.makeText(e.cmd,"** privilege class <em>"+e.args.name+"</em> has been updated by "+e.args.by+" with: "+e.args.privs,0):this.makeText(e.cmd,"** <em>"+e.args.p+"</em> has been updated by "+e.args.by+" with: "+e.args.privs,0);break;case"rename":this.makeText(e.cmd,"** privilege class <em>"+e.args.prev+"</em> has been renamed to <em>"+e.args.name+"</em> by "+e.args.by,0);break;case"show":case"showverbose":this.onAdminShow(e.args.p,e.body)}}},dAmnChanMainChat.prototype.onAdminShow=function(e,t){var n=t.split("\n"),a=dAmn_MakeDiv("userinfo-outer"),i=dAmn_AddDiv(a,"userinfo-inner"),s=dAmn_AddDiv(i,"userinfo alt0"),r=this;dAmnChat_AddImgBox(s,"damncr-close","close","close",function(e){dAmn_DeleteSelf(e),r.scroll_once=!0,dAmn_InvalidateLayout()},a);var o,d,l=dAmn_AddDiv(s,"bodyarea alt1-left-border"),m=dAmn_AddDiv(l,"b read pcusers");switch(e){case"privclass":o="privilege class information:",d=function(e){var t=e.match(/^([^ ]+) order=([0-9]+)(.*)/);if(t){var n=dAmn_AddNewEl(h,"LI",null,"<em>"+t[2]+"</em> <strong>"+t[1]+"</strong>:"),a=dAmn_AddNewEl(n,"UL",null);dAmn_AddNewEl(a,"LI",null,t[3]?t[3]:"<em>default privileges</em>")}};break;case"users":o="privilege class members:",d=function(e){var t=e.match(/^([^:]+): (.*)/);if(t){var n=dAmn_AddNewEl(h,"LI",null,"<strong>"+t[1]+"</strong>:"),a=dAmn_AddNewEl(n,"UL",null);dAmn_AddNewEl(a,"LI",null,t[2]?t[2]:"<em>no members</em>")}};break;case"globalprivs":o="global privileges: ",o+=t?t:"(all default)",d=break;default:o="unknown("+e+")"}dAmn_AddDiv(m,"read","<strong>"+dAmn_formatNS(this.cr.ns,!0)+"</strong><br>"+o);var h=dAmn_AddNewEl(m,"UL");dAmn_arrayForEach(n,d),this.addDiv(a,null,0)},dAmnChanMainChat.prototype.onUserInfo=function(e){var t,n=[],a=dAmn_ParseArgsNData(pkt.body),i=a.body;do{var s=dAmn_ParsePacket(i);if(s){switch(s.cmd){case"conn":n=n.concat(s.args),t=n.length-1;break;case"agent":n[t].agent=s.args;break;case"debug":n[t].debug=s.args;break;case"ns":n[t].ns||(n[t].ns=[]),n[t].ns=n[t].ns.concat(s.param)}i=s.body}}while(s&&i);var r=a.args,o=dAmn_MakeDiv("userinfo-outer"),d=dAmn_AddDiv(o,"userinfo-inner"),l=dAmn_AddDiv(d,"userinfo alt0 damncri-member"),m=this;dAmnChat_AddImgBox(l,"damncr-close","close","close",function(e){dAmn_DeleteSelf(e),m.scroll_once=!0,dAmn_InvalidateLayout()},o);var h=dAmn_AddDiv(l,"damncri-member");dAmn_AddDiv(h,"aside-left avatar alt1",dAmn_printAvatar(e,r.usericon));var c=dAmn_AddDiv(h,"bodyarea alt1-left-border"),_=dAmn_AddDiv(c,"b read");dAmn_AddNewEl(_,"STRONG",null,PHP.userlink(e,r.symbol));var A=dAmn_AddDiv(_),p=dAmn_AddNewEl(A,"UL");r.realname&&dAmn_AddNewEl(p,"LI",null,r.realname),"guest"!=r.gpc&&dAmn_AddNewEl(p,"LI",null,"dAmn "+r.gpc);var u,b=n.length;if(b){var f=dAmn_AddDiv(_,"connarea");for(u=0;b>u;++u){var A=dAmn_AddDiv(f);b>1&&u&&(A.style.margin="0.5em 0 0 0"),b>1&&dAmn_AddNewEl(A,"EM",null,"connection "+(u+1+":"));var g=dAmn_AddNewEl(A,"UL"),v=new Date;if(dAmn_AddNewEl(g,"LI",null,'<strong>online:</strong> <acronym title="'+dAmn_printElapsedTime(parseInt(n[u].online))+' ago">'+dAmn_printDate(v.getTime()/1e3-parseInt(n[u].online))+"</acronym>"),dAmn_AddNewEl(g,"LI",null,"<strong>idle:</strong> "+dAmn_printElapsedTime(parseInt(n[u].idle))),n[u].debug){var p=dAmn_AddNewEl(g,"LI",null,"<strong>debug:</strong>");p=dAmn_AddNewEl(p,"UL",null),dAmn_objForEachString(n[u].debug,function(e,t){"recv"==t?dAmn_AddNewEl(p,"LI",null,"<strong>last-socket-recv:</strong> "+dAmn_printElapsedTime(parseInt(e.recv))):dAmn_AddNewEl(p,"LI",null,"<strong>"+t+":</strong> "+dAmn_noHTML(e))})}if(p=null,n[u].agent){var p=dAmn_AddNewEl(g,"LI",null,"<strong>agent:</strong> "+dAmn_noHTML(n[u].agent.agent));p=dAmn_AddNewEl(p,"UL",null),dAmn_objForEachString(n[u].agent,function(e,t){"agent"!=t&&dAmn_AddNewEl(p,"LI",null,"<strong>"+t+":</strong> "+dAmn_noHTML(e))})}if(n[u].ns){var C=dAmn_AddNewEl(g,"LI","chatrooms");dAmn_AddNewEl(C,"STRONG",null,"chatrooms: ");var w,y=n[u].ns.length;for(w=0;y>w;++w){var k=n[u].ns[w],c=dAmn_AddNewEl(C,"A",null,dAmn_formatNS(k,!0)+" ");c.onclick=function(){var e=k;return ()}}}}this.addDiv(o,null,0)},dAmnChanMainChat.prototype.onParaErrorEvent=function(e,t,n){"get"==e&&"bad namespace"==n&&(n="This user is not currently in any chatroom");var a='<span class="damn-error">'+e+' error: </span><span class="arg1">'+dAmn_formatNS(t)+'</span> <span class="arg2">('+n+")</span>";dAmn_addTimedDiv(this.error_el,"damn-error error-"+e,a)},dAmnChanMainChat.prototype.onErrorEvent=function(e,t,n){var a='<span class="damn-error">'+e+' error: </span><span class="arg1">'+t+"</span>";n&&(a+=' <span class="arg2">('+n+")</span>"),dAmn_addTimedDiv(this.error_el,"damn-error error-"+e,a)},dAmnChanMainChat.prototype.onSelfEvent=function(e,t,n){switch(e){case"shutdown":this.makeText(e,"*** dAmn server is shutting down *",null,2);break;case"disconnect":this.makeText(e,"*** You have been disconnected *",t?"["+t+"]":null,2);break;case"kicked":this.makeText(e,"*** You have been kicked by "+t+" * ",n,2);break;case"part":this.makeText(e,"*** You have left "+dAmn_formatNS(this.cr.ns)+" *",t?"["+t+"]":null,2);break;case"join":"pchat"==this.cr.nstype?this.makeText(e,"*** Now chatting with "+dAmn_formatNS(this.cr.ns)+" *",null,2):this.makeText(e,"*** You have joined "+dAmn_formatNS(this.cr.ns)+" *",null,2)}},window.deviation_url_title=function(e){return e=e.replace(/[^A-Za-z0-9]+/g,"-"),e=e.replace(/^-+/,""),e=e.replace(/-+$/,""),e||(e="-"),e},window.dAmn_newRoomClick=function(){var e;e=$('<div style="width:800px;height:520px"><form style="padding:18px 48px;background:#BAC5BA"><div class="chatroom-list" style="overflow:auto;height:420px"></div><div style="padding:16px 0 0 0;text-align:center"><input type="submit" name="cancel" value="Close" style="width:12ex;font-size:10pt"/></div></form></div>')[0],Modals.push(e),DiFi.pushPrivateGet("DAChat","chatrooms",[],function(e,t,n){var a,i,s;if(!t)return Modals.pop("cancel"),void 0;for(Events.hook($("div.chatroom-list",e)[0],"click",function(e){var t,n,a=e.target||e.srcElement;return(t=$(a).closest("a")[0])&&(n=t.href.match(/^h[t]tps?:\/\/chat.deviantart.com\/chat\/(.+)/))?(dAmn_Join("chat:"+n[1]),Modals.pop(),!1):!0}.bind(this)),a=$("div.chatroom-list",e)[0];a.firstChild;)a.removeChild(a.firstChild);for($(a).append(n.response.content.body),i=$("table",a)[0].cloneNode(!0),$(i).removeClass("zebra"),s=$("tr",i).toArray(),s.shift();s.length;)s.pop().style.display="none";i.style.marginBottom=0,a.parentNode.insertBefore(i,a),$("tr",a)[0].style.display="none"}.bind(this,e)),DiFi.timer(10)},window.DWait&&DWait.run("jms/pages/chat07/dAmnChat.js")});if(window.DWait){DWait.count()}