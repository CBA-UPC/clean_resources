import{delegate as t,lockScroll as o,forceRepaintSVG as m,debug}from"../base/croco.js";import{mediaQuery as l,LOGGERS as R,MODULE_ALREADY_INITIALIZED as _,noElement as G,getLocalData as p}from"../base/config.js";import{Mediator as i}from"../base/mediator.js";import{enableTransparentHeader as u}from"./header-transparent.js";import{toggleMenu as J}from"./header-responsive.js";import{updateTransparentHeader as h}from"./header-transparent.js";import{getGuestReinsurance as K}from"./guest-reinsurance.js";let g=false;let v=null;let j=null;let L=null;let A=null;let q=null;let S=null;let k=null;let T=null;let P=null;let $=null;let click=null;let N=null;const B=R.DEFAULT;const D="is-opened";const F="is-active";const I=[];const M=".js-menu-main";const W=".js-menu-item";const C=".js-menu-item-link";const X=".js-sub-nav";const Y=".js-nav-wrapper";const Z=".js-menu-header";const ee=".js-menu-open";const te=".js-menu-back";const ne=".js-menu-close";const se=".js-header";const oe=".js-search-bar-wrapper";function O(e){if(e.target.classList.contains("js-ada-loop-start")){A.focus()}if(e.target.classList.contains("js-ada-loop-stop")){L.focus()}}function open(t){if(!t.hasAttribute("hidden")){clearTimeout($)}t.removeAttribute("hidden");t.classList.add(D,F);setTimeout(200);import("./search/search-utils.js").then(;const i=document.querySelector(".js-menu-myaccount");if(i){p("navigation.myAccountPanel").then(async t=>{if(t){const{render:o}=await import("../vendors/lit-html/lit-html.js");const{tplMyAccountBurger:l}=await import("../templates/navigation/myaccount-panel.tpl.js");o(l(t),i);requestAnimationFrame(async()=>{m(i);const t=document.querySelector(".js-guest-reinsurance-burger-context");K(t)})}})}const l=document.querySelector(".js-menu-links");if(l){p("navigation").then(async result=>{if(result){const{render:t}=await import("../vendors/lit-html/lit-html.js");const{tplLinksBurger:o}=await import("../templates/navigation/links-panel.tpl.js");t(o(result),l);requestAnimationFrame(}})}}function close(t,o=false){t.classList.remove(D,F);if(document.documentElement.classList.contains("light-header")){T.classList.add("no-mob")}clearTimeout($);L=null;A=null;let l=t.children;q=l[0];S=l[l.length-1];q.removeEventListener("focus",O);S.removeEventListener("focus",O);q=null;S=null;requestAnimationFrame(h)}function setActive(t){const o=j.querySelectorAll(`${Y}.${F}`);[...o].forEach(;if(P){P.removeAttribute("role");P=null}}function reset(){document.documentElement.classList.remove("no-overflow");u(true);if(l.mobileAndTablet.matches){v.classList.remove(F);close(j,true)}const t=j.querySelectorAll(`.${D}`);[...t].forEach(;setActive()}function re(e,t){e.preventDefault();e.stopPropagation();const o=t.querySelectorAll(`.${D}`);[...o].forEach(;setActive(t)}async function le(t){const{render:o}=await import("../vendors/lit-html/lit-html.js");const{tplMenuHeader:l}=await import("../templates/header-burger.tpl.js");const{NAV:i,POPIN:u}=await p("wordings.ada");o(l(I,re,{previous:i.PREVIOUS,close:u.CLOSE_MENU}),t);m(t)}function U(e){e.stopPropagation();const t=e.delegateTarget;const o=t.closest(W).querySelector(X);if(o){e.preventDefault();const l=o.querySelector(Z);const level=parseInt(o.dataset.level);I[level]={targetedNav:o,label:t.textContent.trim()};I.length=level+1;if(l.children.length===0){le(l)}t.classList.add("js-focus");open(o);setActive(o)}}function ce(e){if(e.keyCode===13){U(e)}}function ie(e){const t=e.delegateTarget;close(t.closest(`.${D}`));setActive(t.closest(`.${D}`))}function V(e){o.unlock();close(j);k.setAttribute("role","banner");v.focus();reset()}function ae(e){e.preventDefault();v.classList.toggle(F);const isActive=v.classList.contains(F);h();if(isActive){open(j);setActive(j);o.lockAfterTransition(j,true);u(false);k.removeAttribute("role")}else{V(e);J(j)}}function H(add){if(add){t(j,C,"click",U);t(j,C,"keypress",ce)}else{click&&click.undelegate();N&&N.undelegate()}}function ue(){if(l.mobileAndTablet.matches){H(true)}v.addEventListener("click",ae);t(j,te,"click",ie);t(j,ne,"click",V)}export async function headerBurgerInit(){if(g){debug("error",B,_);return}const label=await p("wordings.home")||"";j=document.querySelector(M);if(j){v=document.querySelector(ee);k=document.querySelector(se);T=document.querySelector(oe);I[0]={targetedNav:j,label:label};ue();i.subscribe("header-burger.reset",reset);i.subscribe("header-burger.toggleBindEvents",H);g=true}else{debug("warn",B,"Menu is missing",G(M))}}