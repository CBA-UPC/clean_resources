!function(){var e={87851:function(e,t,o){"use strict";var r=o(9571),n=o(73355);t.Z=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];const s=(0,r.Z)().toString();return(0,n.U)()?new Promise(((e,o)=>{const r=t=>{try{if(t.data){const{data:n}=t,{payload:a}=n;if("PROXY_FETCH_RESPONSE"===n.EVENT_NAME&&a.token===s){if(a.fetchResponseBlob){const t=new Response(a.fetchResponseBlob.stream(),a.fetchResponseProps);e(t)}else a.fetchError?o(a.fetchError):o("Need to handle this");window.removeEventListener("message",r)}}}catch(e){console.log(e)}};window.addEventListener("message",r),(0,n.Z)({EVENT_NAME:"PROXY_FETCH",payload:{fetch:t,token:s}},"*")})):window.fetch(...t)}},73355:function(e,t,o){"use strict";o.d(t,{U:function(){return r}});const r=()=>!!window.BUGHERD_REACT_APP_SIDEBAR_MOUNT&&(window.BUGHERD_REACT_APP_SIDEBAR_MOUNT.getRootNode().querySelector("#bugherdCommunicator")||window.BUGHERD_EXTENSION_CONFIG&&window.BUGHERD_EXTENSION_CONFIG.extensionId);t.Z=function(){if(window.BUGHERD_REACT_APP_SIDEBAR_MOUNT){const e=window.BUGHERD_REACT_APP_SIDEBAR_MOUNT.getRootNode().querySelector("#bugherdCommunicator");if(e)return void e.contentWindow.postMessage(...arguments)}window.BUGHERD_EXTENSION_CONFIG&&window.BUGHERD_EXTENSION_CONFIG.extensionId?window.postMessage(...arguments):console.error("Couldn't find bugherdCommunicator iframe or window.BUGHERD_EXTENSION_CONFIG.extensionId to use for postMessage")}},40629:function(e){var t={cmd:"Cmd",ctrl:"Ctrl",alt:"Alt",shift:"Shift",joinWith:" + "},o={},r={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:"Space",36:"Home",33:"Page Up",34:"Page Down",35:"End",37:"Left",38:"Up",39:"Right",40:"Down",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",186:";",187:"=",188:",",189:"-",190:".",192:"`",222:"'"};function n(e){return{character:-1!==[16,17,18,91,93,224].indexOf(e.keyCode)?null:r[e.keyCode]||String.fromCharCode(e.keyCode),modifiers:{cmd:e.metaKey,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey}}}function s(e){return function(e){var t=n(e),r=t.modifiers,s=[];return r.cmd&&s.push(o.cmd),r.ctrl&&s.push(o.ctrl),r.alt&&s.push(o.alt),r.shift&&s.push(o.shift),t.character&&s.push(t.character),s}(e).join(o.joinWith)}e.exports=function(e){return o=Object.assign(t,e),s},e.exports.details=function(e){var t=n(e),o=t.modifiers,r=o.cmd||o.ctrl||o.alt||o.shift;return{hasKey:null!=t.character,hasModifier:r,map:t}}},9571:function(e,t,o){"use strict";var r;o.d(t,{Z:function(){return u}});var n=new Uint8Array(16);function s(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(n)}for(var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,i=[],c=0;c<256;++c)i.push((c+256).toString(16).substr(1));var d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&a.test(e)}(o))throw TypeError("Stringified UUID is invalid");return o},u=function(e,t,o){var r=(e=e||{}).random||(e.rng||s)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){o=o||0;for(var n=0;n<16;++n)t[o+n]=r[n];return t}return d(r)}}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,o),s.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";const e=(e,t,o)=>{o&&e.setAttribute(`data-${t}`,o)};var t=console.log;const r={default:{width:300,height:80,right:0},warning:{width:330,height:144,right:0}},n=()=>document.getElementById("bugherd_embed_communication_frame");let s=null;const a=(e,t)=>{t&&(s=t);const o=n(),{width:a,height:i,right:c}=r[e];o.style.width=`${a}px`,o.style.height=`${i}px`,o.style.top=function(e){return e?`calc((100% - ${(arguments.length>1&&void 0!==arguments[1]?arguments[1]:70)+10}px) * ${e/100})`:"0px"}(t||s,i),o.style.right=`${c}px`},i=e=>{n().style.display=e?"block":"none"},c=()=>{t("[AUTH] Destroying auth iframe"),window.removeEventListener("bugherd_loaded",c),n().remove(),window._bugHerd_sidebar2021=void 0},d={All:!0,"Google Analytics":!1,"Google Analytics 4":!1};var u=o(40629),l=o.n(u);const p=(e,t,o,r)=>{document.addEventListener("keyup",(function(e){const t=document.getElementById("bugherd_embed_communication_frame"),o=l()({})(e);"string"==typeof o&&t&&o===(r||"Cmd + Ctrl + B")&&(t.style.display="block")}));const n=e=>{!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={integrations:{...o.integrations,...d}};window.analytics&&window.analytics.track&&window.analytics.track(e,t,{...r,...o})}("Sidebar displayed",{project_id:t??null,source:e})},s=document.referrer.includes(o),a=window.location.search.includes("showBugherd=true");if(s&&n("app"),a){n("querystring");const e=setTimeout((()=>{const e=new URLSearchParams(window.location.search);e.delete("showBugherd");const t=`${window.location.protocol}//${window.location.host}${window.location.pathname}?${e.toString()}`;window.history.pushState({path:t},"",t)}),1e3);return()=>{clearTimeout(e)}}return!(!s&&!a)},g=(e,t)=>{const o=document.getElementById("bugherd_embed_communication_frame"),r=l()({})(t),n=e.shortcut_to_show_widget||"Cmd + Ctrl + B";"string"==typeof r&&o&&r===n&&(o.style.display="block")},m={hasStorageAccess:void 0,project:null,resources:null},_="hasStorageAccess"in document&&"requestStorageAccess"in document,w=()=>document.getElementById("bugherd_toggle"),h=e=>{w().onclick=e},E=(e,t)=>{if(!e)return;e.custom_logo_dark_background&&(document.getElementById("logo").src=e.custom_logo_dark_background);const o=w();if(o?.style){if(e.id){const r=t({projectId:e.id,preference:"togglePosition"});r&&(o.style.transform=`translate(0px, ${r}px)`)}e.toggle_vertical_position&&(o.style.top=`calc((100% - 70px) * ${e.toggle_vertical_position/100})`)}};var y=o(87851).Z;var f=o(9571);const b=e=>{let{projectId:t,preferences:o}=e;try{const e={...JSON.parse(window.localStorage.getItem(`sidebar_project_${t}`)),...o};window.localStorage.setItem(`sidebar_project_${t}`,JSON.stringify(e))}catch(e){console.log("Couldnt save user preferences to local storage",e)}},S=e=>{let{projectId:t,preference:o}=e;try{const e=JSON.parse(window.localStorage.getItem(`sidebar_project_${t}`));if(!e)return;return e[o]}catch(e){console.log("Couldnt get user preferences from local storage",e)}};function A(t){var o=document.createEvent("CustomEvent");if(o.initCustomEvent("bugherdSidebarParsed",!0,!0,JSON.stringify({status:"success",apiKey:t.apiKey})),document.dispatchEvent(o),"loading"===document.readyState)return void document.addEventListener("readystatechange",(e=>{"interactive"===e.target.readyState&&A(t)}));const{resources:r,apiKey:n,origin:s,embeddedByOldExtension:a}=t,{project:i,user:c}=r,d=["app-images","app-vendor",i.is_public&&!i.authenticated?"public":"app"];(t=>{let{apiKey:o,origin:r,project:n,bugsnagSidebarNewKey:s,embeddedByOldExtension:a,files:i,user:c}=t;const d=document.createElement("bugherd-sidebar");d.style.position="static",d.style.display="block",e(d,"projectid",n.id.toString()),e(d,"project",JSON.stringify(n)),e(d,"user",JSON.stringify(c)),e(d,"bugsnagsidebarnewkey",s),e(d,"embeddedByOldExtension",a.toString()),d.addEventListener("keydown",(e=>{e.stopPropagation()})),d.addEventListener("focusin",(e=>{e.stopPropagation()}));const u=d.attachShadow({mode:"open"});u.innerHTML='<div id="sidebar-root"></div>',window.BUGHERD_REACT_APP_SIDEBAR_MOUNT=u.getElementById("sidebar-root"),window.BUGHERD_API_KEY=o,(e=>{let{origin:t,files:o}=e;o.forEach((e=>{const o=document.createElement("script");o.src=`${t.replace("www.","sidebar.")}/clients/sidebar/${e}.1705477806422.js`,window.document.head.appendChild(o)}))})({origin:r,files:i}),document.body.appendChild(d)})({apiKey:n,origin:s,project:i,bugsnagSidebarNewKey:r.config.bugsnag_sidebar_new_key,embeddedByOldExtension:a,files:d,user:c})}let v=(e=>{let{embedUrl:t}=e;try{const e=JSON.parse(window.localStorage.getItem("BugHerd_change_project")||"[]"),o=window.localStorage.getItem("BugHerd_change_project_api_key"),r=new URL(t).search.replace(/^\?/,"").split("&").map((e=>e.split("="))).reduce(((e,t)=>(e[t[0]]=t[1],e)),{apikey:""}),n=r&&r.apikey?r.apikey:null,s=e.find((e=>e.from===n));return s?.to||o||n}catch{return null}})({embedUrl:document?.currentScript?.src||window.embedUrl});window.BUGHERD_EXTENSION_CONFIG?.apiKey&&(v=window.BUGHERD_EXTENSION_CONFIG.apiKey);let C=window.BUGHERD_EXTENSION_CONFIG?.domain||"https://localhost:3000",T="";if(document?.currentScript?.src){const e=new URL(document?.currentScript?.src);C=e.origin,T=e.search}const N=C.replace("www.","sidebar.");if("/sidebar/embed_html"===window.document.location.pathname)(e=>{let{sidebarOrigin:o,apiKey:r}=e;w();const n=(0,f.Z)();let s=!1;window.addEventListener("message",(e=>{if("COOKIE_CHECK"===e.data.eventName)t("[AUTH] Check cookies"),(async(e,o)=>{try{return await(async(e,o)=>{const r=await y(`${e}/sidebar/resources?apikey=${o}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),n=await r.json();return n.project.is_active?n.project.authenticated?(t("[AUTH] _bugherd_session5 cookie valid"),{state:"AUTHENTICATED",resources:n}):(document.cookie.includes("_bugherd_session5")?t("[AUTH] _bugherd_session5 cookie invalid"):t("[AUTH] _bugherd_session5 cookie does not exist"),{state:"UNAUTHENTICATED",resources:n}):(t("[AUTH] Bugherd project disabled"),{state:"PROJECT_DISABLED",resources:n})})(e,o)}catch(e){if(t("[AUTH] _bugherd_session5 ping error"),e instanceof Error)throw e;throw t("[AUTH] unknown error raised",e),new Error("Unknown Error")}})(o,r).then((o=>{let{resources:r,state:a}=o;const{project:i}=r;if("UNAUTHENTICATED"===a)return t("[AUTH] Unauthenticated"),E(i,S),void e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!1,resources:r}},e.origin);if(t("[AUTH] Authenticated"),i.active_task_id&&b({projectId:i.id,preferences:{route:`/sidebar/tasks/${i.active_task_id}`}}),!i.is_active)return e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!1,resources:r}},e.origin);i.has_access?w().className="loading":w().className="noAccess",E(i,S);const c=S({projectId:i.id,preference:"route"});let d=e.data.manuallyAuthenticated;window.sessionStorage.getItem("bugherdSidebarManuallyAuthenticated")&&(d=!0,window.sessionStorage.removeItem("bugherdSidebarManuallyAuthenticated")),c&&"/toggle"!==c||!d||b({projectId:i.id,preferences:{route:"/sidebar"}}),(d||s)&&b({projectId:i.id,preferences:{anonymousUserId:n,route:"/sidebar"}}),e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!0,resources:r}},e.origin)}));else if("AUTH_HAS_STORAGE_ACCESS"===e.data.eventName){t("[AUTH] AUTH_HAS_STORAGE_ACCESS");const o=t=>{e.source.postMessage({eventName:"AUTH_HAS_STORAGE_ACCESS_RESPONSE",payload:{success:t}},e.origin)};if(!_)return o(null);document.hasStorageAccess().then((e=>{o(!!e)})).catch((()=>{o(!1)}))}else if("AUTH_REQUEST_STORAGE_ACCESS"===e.data.eventName){let o;t("[AUTH] AUTH_REQUEST_STORAGE_ACCESS");const r=t=>{t||(w().className="error");const r=(new Date).getTime()-o<=250;e.source.postMessage({eventName:"AUTH_REQUEST_STORAGE_ACCESS_RESPONSE",payload:{success:t,isAutoDenied:r,anonymousUserId:n}},e.origin)};h((()=>{var e;o=(new Date).getTime(),e=r,document.requestStorageAccess().then((()=>{e(!0)}),(()=>{e(!1)})),s=!0}))}else"SHOW_UNAUTHENTICATED_UI"===e.data.eventName&&(w().className="",h((()=>{e.source.postMessage({eventName:"AUTH_REDIRECT_TO_LOGIN",payload:{anonymousUserId:n}},e.origin)})))}),!1)})({sidebarOrigin:N,apiKey:v});else{const e=document.getElementsByTagName("bugherd-sidebar")[0],o=document.querySelector('script[src*="sidebarv2"]')&&!document.currentScript?.getAttribute("src").includes("sidebarv2"),r=document.querySelector('script[src*="sidebarv2"]')&&document.currentScript?.getAttribute("src").includes("source=extension");if(e){const t=e.getAttribute("data-projectid");console.warn(`Bugherd: Wanted to embed project with apiKey ${v} but project with id ${t} was already embedded.`)}else if(o)console.warn("Bugherd: Wanted to embed project via new embed code (embed.js) but looks like old embed code exists (sidebarv2.js).");else if(window._bugHerd_sidebar2021)console.warn("Bugherd: Wanted to embed new sidebar but _bugHerd_sidebar2021 was already set");else{if(window._bugHerd_sidebar2021=!0,!v)throw new Error("Bugherd: sidebar is missing apiKey");(e=>{let{origin:o,search:r}=e;return(async e=>{let{origin:t,search:o}=e;try{await new Promise(((e,t)=>{if(document.body)return e(document.body);const o=setTimeout((()=>{t()}),4e3),r=new MutationObserver((function(){document.body&&document.head&&(r.disconnect(),clearTimeout(o),e(document.body))}));r.observe(document.documentElement,{childList:!0})}))}catch(e){return console.error("BugHerd wanted to start but document.body or document.head is null"),null}let r="allow-scripts allow-popups allow-same-origin allow-popups-to-escape-sandbox";"requestStorageAccess"in document&&(r+=" allow-storage-access-by-user-activation");const n=document.createElement("iframe");return n.id="bugherd_embed_communication_frame",n.name="embedCommunication",n.sandbox=r,n.style.display="none",n.style.border="none",n.style.position="fixed",n.style.zIndex="2147483647",n.style.right="0",n.style.height="calc((100% - 154px) * 0.9)",n.src=`${t}/sidebar/embed_html${o}`,document.body.appendChild(n),n})({origin:o,search:r}).then((e=>{if(null===e)throw Error("iFrame wasnt created");return new Promise(((r,n)=>{const s=o.replace("sidebar.","www.");window.addEventListener("bugherd_loaded",c);const d=e=>{let{project:t,resources:o}=e;const n=t.shortcut_to_show_widget;let c=!0;c=p(0,t.id,s,n),i(c),a("default",t.toggle_vertical_position),r({authenticated:!0,resources:o})},u=e=>{r({resources:e})};e.onload=()=>{window.addEventListener("message",(r=>((e,o)=>{let{onSuccess:r,onShowPublicFeedback:n,reject:s,iframe:d,origin:u}=o;"chrome"in window&&(m.hasStorageAccess=null);const l=`${u.replace("sidebar.","www.")}/users/sign_in?source=sidebar&utm_campaign=sidebar&redirect_to=${window.location.href}&anonymous_user_id=${e.data?.payload?.anonymousUserId}`,_=u.replace("sidebar.","www.");if("COOKIE_CHECK_RESPONSE"===e.data.eventName){m.project=e.data.payload.resources.project,m.resources=e.data.payload.resources,w=m.project,document.removeEventListener("keyup",g.bind(null,w)),document.addEventListener("keyup",g.bind(null,w));const o=m.project?.shortcut_to_show_widget;let l=!0;l=p(0,m.project.id,_,o);const h=window.location.search.includes("showBugherd=true"),E=document.referrer.includes(_);m.project.is_active?null===m.project.id?(t("[BUGHERD] There is no project associated with this API Key"),s(),c()):!m.project.is_public||m.project.authenticated||E&&h?!1===m.hasStorageAccess?(a("default",m.project.toggle_vertical_position),i(l),d.contentWindow.postMessage({eventName:"AUTH_REQUEST_STORAGE_ACCESS",payload:{origin:u}},u)):e.data.payload.success&&!m.project.has_access?(i(l),a("warning",m.project.toggle_vertical_position)):e.data.payload.success?r(m):null===m.hasStorageAccess?i(l):(d.contentWindow.postMessage({eventName:"SHOW_UNAUTHENTICATED_UI",payload:{origin:u,projectOrigin:window.location.origin}},u),a("warning",m.project.toggle_vertical_position),m.project.authenticated&&i(l)):n(m.resources):(t(`[BUGHERD] Project (${m.project.id}) is disabled`),s(),c())}else"AUTH_HAS_STORAGE_ACCESS_RESPONSE"===e.data.eventName?(m.hasStorageAccess=e.data.payload.success,null===e.data.payload.success?(t("[AUTH] hasStorageAccess: no api"),d.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:u}},u)):e.data.payload.success?(t("[AUTH] hasStorageAccess: true"),d.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:u}},u)):(t("[AUTH] hasStorageAccess: false"),d.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:u}},u))):"AUTH_REQUEST_STORAGE_ACCESS_RESPONSE"===e.data.eventName?e.data.payload.success?(m.hasStorageAccess=!0,t("[AUTH] requestStorageAccess: true"),a("default"),d.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:u,manuallyAuthenticated:!0}},u)):(t("[AUTH] requestStorageAccess: false"),a("warning"),e.data.payload.isAutoDenied&&(window.location.href=l)):"AUTH_REDIRECT_TO_LOGIN"===e.data.eventName&&(window.location.href=l);var w})(r,{onSuccess:d,onShowPublicFeedback:u,reject:n,iframe:e,origin:o})),!1),e.contentWindow.postMessage({eventName:"AUTH_HAS_STORAGE_ACCESS",payload:{origin:o}},o)}}))})).catch((()=>{console.error("Cannot initialize BugHerd")}))})({origin:N,search:T}).then((e=>{let{resources:t}=e;A({apiKey:v,origin:C,resources:t,embeddedByOldExtension:r})})).catch((e=>{e&&console.error("[AUTH] Unauthenticated",e)}))}}}()}();
//# sourceMappingURL=embed.1705477806422.js.map;
