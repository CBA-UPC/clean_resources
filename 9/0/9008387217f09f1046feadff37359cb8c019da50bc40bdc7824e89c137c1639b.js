/*! For license information please see beacon_web.min.js.LICENSE.txt */
!window,(function(){return [function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return u}));var r=n(0),o=);function i(e,t){if(!e)throw t instanceof Error?t:new Error(t)}nction u(e){return String(e[r.j])+String(e[r.l])}},function(e,t,n){(function(t){e.exports={1:[{}],2:[{1:1}],3:[{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?o=);undefined"==typeof Promise&&e(3);var a=Promise;l=void 0,d={},p=Object.prototype.toString;tion g(e,t){return new a((function(n,r){if(d[e.name]=d[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);v(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=o.open.apply(o,i);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore("local-forage-detect-blob-support")}catch(e){if("ConstraintError"!==e.name)throw e}}),a.onerror=a.onsuccess=))}function b(e){return g(e,!1)}{_driver:"asyncStorage",_initStorage:_support:),iterate:getItem:setItem:removeItem:clear:length:key:keys:dropInstance:,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A=/^~~local_forage_type~([^~]+)~/,N="__lfsc__:".length,k=N+"arbf".length,R=Object.prototype.toString;r C={serialize:function(e,t){var n="";if(e&&(n=R.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===R.call(e.buffer))){var r,o="__lfsc__:";e instanceof ArrayBuffer?(r=e,o+="arbf"):(r=e.buffer,"[object Int8Array]"===n?o+="si08":"[object Uint8Array]"===n?o+="ui08":"[object Uint8ClampedArray]"===n?o+="uic8":"[object Int16Array]"===n?o+="si16":"[object Uint16Array]"===n?o+="ur16":"[object Int32Array]"===n?o+="si32":"[object Uint32Array]"===n?o+="ui32":"[object Float32Array]"===n?o+="fl32":"[object Float64Array]"===n?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+D(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(e){t(null,e)}},deserialize:stringToBuffer:T,bufferToString:D};L={_driver:"webSQLStorage",_initStorage:_support:"function"==typeof openDatabase,iterate:getItem:setItem:removeItem:clear:length:key:keys:dropInstance:;r z={_driver:"localStorageWrapper",_initStorage:_support:),iterate:getItem:setItem:removeItem:clear:length:key:keys:dropInstance:,V=J=Array.isArray||K={},W={},H={INDEXEDDB:x,WEBSQL:L,LOCALSTORAGE:z},X=[H.INDEXEDDB._driver,H.WEBSQL._driver,H.LOCALSTORAGE._driver],Q=["dropInstance"],G=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Q),Y={description:"",driver:X.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};r ee=new(function(){eturn e.prototype.config=e.prototype.defineDriver=e.prototype.driver=e.prototype.getDriver=e.prototype.getSerializer=e.prototype.ready=e.prototype.setDriver=e.prototype.supports=e.prototype._extend=e.prototype._getSupportedDrivers=e.prototype._wrapLibraryMethodsWithReady=e.prototype.createInstance=e}());t.exports=ee},{3:3}]},{},[4])(4)}).call(this,n(21))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=function(){};function o(e){if(!e||!e.reduce||!e.length)throw new TypeError("createPipeline æ–¹æ³•éœ€è¦ä¼ å…¥è‡³å°‘æœ‰ä¸€ä¸ª pipe çš„æfunction(t null==t?void 0:t(e,o)}))}}))}},function(e,t,n){"use strict";var r=n(0),o=function(){function e(e,t,n,o){this.requestParams={},this.network=o,this.requestParams.attaid=r.a,this.requestParams.token=r.c,this.requestParams.product_id=e.appkey,this.requestParams.platform=n,this.requestParams.uin=t.deviceId,this.requestParams.model="",this.requestParams.os=n,this.requestParams.app_version=e.appVersion,this.requestParams.sdk_version=t.sdkVersion,this.requestParams.error_stack=""}return e.prototype.reportError=function(e,t){this.requestParams._dc=Math.random(),this.requestParams.error_msg=t,this.requestParams.error_code=e,this.network.get(r.b,{params:this.requestParams}).catch((frn r}));var r=function(){}},function(e,t,n){"use strict";var r=n(0),o=function(){function e(e,t,n,o){this.strategy={isEventUpOnOff:!0,httpsUploadUrl:r.i,requestInterval:30,blacklist:[],samplelist:[]},this.realSample={},this.appkey="",this.appkey=e.appkey,this.storage=n;try{var i=JSON.parse(this.storage.getItem(r.d));i&&this.processData(i)}catch(e){}this.needRequestConfig()&&this.requestConfig(e.appVersion,t,o)}return e.prototype.requestConfig=function(e,t,n){var o=this;this.storage.setItem(r.f,Date.now().toString()),n.post(r.e,{platformId:"undefined"==typeof wx?"3":"4",mainAppKey:this.appkey,appVersion:e,sdkVersion:t.sdkVersion,osVersion:t.userAgent,model:"",packageName:"",params:{A3:t.deviceId}}).then((function(e){if(0==e.data.ret)try{var t=JSON.parse(e.data.beaconConfig);t&&(o.processData(t),o.storage.setItem(r.d,e.data.beaconConfig))}catch(e){}else o.processData(null),o.storag"")})).catch((function(e){}is.realSample[u[0]]=u[1])}},e.prototype.needRequestConfig=function(){var e=Number(this.storage.getItem(r.f));return Date.now()-e>60*this.strategy.requestInterval*1eUrl+"?appkey="+this.appkeategy.blacklist.indexOf(e)},e.prototype.isEventUpOnOff=function(){return this.strategy.isEventUpOnOff.random()*Ma.__CANCEL__=!0,e.exports=r},function(e,t,n){"use strict";var r=n(20);n(9),n(5),n(10),n(1);t.default=r.a},function(e,t,n){"use strict";var r=n(1),o=n(5),i=n(0),a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},s=function(){function e(e){var t=this;this.lifeCycle=new r.a,this.uploadJobQueue=[],this.additionalParams={},this.delayTime=0,this._norON.stringify(e.events))}))}]),Object(r.b)(Boolean(e.appkey),"appkey must be initial"),this.config=a({},e)}return e.prototype.onUserAction=function(e,t){this.preReport(e,t,!1)},e.p,t){this.preReport(e,tror("602"," no eventCode")},e.pr.additionalParams[r]=e[r]}},e.prototype.setChannelId=function(e){this.commonInfo.channelID=String(e)},e.prototype.setOpenId=function(e){this.commonInfo.openid=String.commonInfo.unid=String(n this.commonInfo.deviceIdn(){return this.commonInfo},e.prototype.removeSendingId=function(e){var t=JSON.parse(this.storage.getItem(i.n)),n=t.indexOf(e);-1!=n&&(t.splice(n,1),this.storage.setItem(i.n,JSON.of e&&!0===e.isAxiosError}},function(e,t,n){"use striOpts",(function(){return E}));var r=n(19),o=n(6),i=n(8),a=n(0)his.appkey=n.config.appkey}return e.prototype.getSession=function(){var e=this.storage.getItem("session_storage_key");if(!e)return this.createSession();var t=JSON.parse(e)||{sessionId:void 0,sessionStart:void 0};if(!t.sessionId||!t.sessionStart)return this.createSession();var n=Number(this.storage.getItem(a.k));return Date.now()-n>this.duration?this.createSession():{sessionId:t.sessionId,sessionStart:t.sessionStart}},e.prototype.createSession=function(){var e=Date.now(),t={sessionId:this.appkey+"_"+e.toString(),sessionStart:e};this.storage.setItem("session_storage_key",JSON.stringify(t)),this.storage.setItem(a.k,e.toString());var n=this.storage.getItem("is_new_user");return this.beacon.onDirectUserAction("rqd_applaunched",{A21:n?"N":"Y"}),this.storage.setItem("is_new_user",JSON.stringify(!o?10:6}ap:void 0,done:!0}}([i,s])}}},y=function(){function e(e){var t=d(),n=[];n=t>8&&t<10?[l.a.LOCALSTORAGE]:[l.a.INDEXEDDB,l.a.WEBSQL,l.a.LOCALSTORAGE],this.store=l.a.createInstance({driver:n,name:"Beacon_"+e,version:1,size:2097152,storeName:"event_store_v2",description:"store beacon events"})}return e.prototype.insertEvent=function(e,t){return h(this,void 0,void 0,(function(){var n;return v(this,(function(r){switch(r.label){case 0:n=Object(s.c)(e.mapValue),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.store.setItem(n,e,t)];case 2:return[2,r.sent()];case 3:return r.sent(),[2,Promise.reject()];case 4:return[2]}}))}))},e.prototype.getEvents=function(){return h(this,void 0,void 0,(function(){var e;return v(this,(function(t){switch(t.label){case 0:e=[],t.label=1;case 1:return t.trys.push([1,3,ate((function(t){e.push(t)}))];case 2:return t.sent(),[2,Promise.all(e)];case 3:return t.sent(),[2,Promise.all(e)];case 4:return[2]}}))}))},e.prototype.removeEvent=function(e){return h(this,void 0,void 0,(function(){var t;return v(this,(function(n){switch(n.label){case 0:t=Object(s.c)(e.mapValue),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.store.removeItem(t)];case 2:return[2,n.sent()];case 3:return n.sent(),[2,Promise.reject()];case 4:return[2]}}))}))},e}(),m=n(4),g=n.n(m),b=function(){return(b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},w=function(){function e(e){g.a.interceptors.request.use(this.getRequestInteceptorn(e,t){return g.a,n){return g.a.post(e(e){return g.a.isCancel(e)},e.prototype.getRequestInteceptor=function(e){return function(t){var n=t.url,r=t.method,o=t.data,i=o,a=!1;if(e.onReportBeforeSend){var s=e.onReportBeforeSend({url:n,method:r,data:o});a=!(i=(null==s?void 0:s.data)||null)}return b(b({},t),{data:i,cancelTNo data for sdk, cancel.")})):vunction e(e){this.appkey=e}return e.prototype.getItem=function(e){try{return window.localStorage.getItem(this.getStoreKey(e))}catch(e){returngetStoreKey(e))}catch(e){}},e.prototype.setItem=function(e,t){try{window.localStorage.setItem(this.getStoreKey(e),t)}catch(e){}}tStoreKey(e),t)}catch(e){}}Key(e))}catch(e){return""}},e.prototype.getStoreKey=function(e){return a.o+this.appkey+"_"+e},e.prototype.createDeviceId=function(){try{var e=window.localStoragndom()*t.length));return n}(32),window.localStorage.setItem(a.g,e)),e}caoto ents)||this}return S(t,e),t}(u.a),O=function(e){function t(t){var n=e.call(this,t)||this;n.send=function(e,t,r){n.storage.setItem(a.k,Date.now().toString()),n.network.post(n.strategy.getUploadUrl(),e.data).then((function(r){100==r.data.result?n.delayTime=1e3*r.data.delayTime:n.delayTime=0,t&&t(e.data),e.data.events.forEach((function(e){n.store.removeEvent(e).then((function(){n.removeSendingId(Object(s.c)(e.mapValue))}))}))})).catch((function(t){var o=e.data.events;n.errorReport.reportError(t.code?t.code.toString():"600",t.message),r&&r(e.data),o.forEach((function(e){n.store.insertEvent(e,(function(e,t){e&&n.errorReport.reportError("604","insertEvent fail!"),n.removeSendingId(Object(s.c)(t.mapValue))}))}))}))};var r=d();return n.isUnderIE8=r>0&&r<8,n.isUnderIE8||(n.network=new w(t),n.storage=new _(t.appkey),n.initCommonInfo(t),n.store=new y(t.appkey),n.errorReport=new o.a(n.config,n.commonInfo,"web",n.network),n.strategy=new i.a(n.config,n.commonInfo,n.storage,n.network),n.logidStartTime=n.storage.getItem("logid_start"),n.logidStartTime||(n.logidStartTime=Date.now().toString(),n.storage.setItem("logid_start",n.logidStartTime)),n.initSession(t),n.onDirectUserAction("rn n.lifeCycle.emit("init")}),0),n.initDelayTime=t.delay?t.delay:1e3,n.cycleTask(n.initDelayTime)),n}return S(tnew c(this.storage,t,this)},t.prototype.initCommonInfo=function(e){var t=Number(this.storage.getItem(a.k)),n=JSON.parse(this.storage.getItem(a.n));(Date.now()-t>3e4||!n)&&this.storage.setItem(a.n,JSON.stringify([]));var r=[window.screen.width,window.screen.height];window.devicePixelRatio&&r.push(window.devicePixelRatio),this.commonInfo={deviceId:this.storage.createDeviceId(),language:navigator&&navigator.language||"zh_CN",query:window.location.search,userAgent:navigator.userAgent,pixel:r.join("*"),channelID:e.channelID?String(e.channelID):"",openid:e.openid?String(e.openid):"",unid:e.unionid?String(e.unionid):"",sdkVersion:"4.3.4-web"},this.config.appVersion=e.versionCode?String(e.versionCode):"",this.config.strictMode=e.strictMode},t.prototype.cycleTask=function(e){var t=this;setTimeout((function(){t.store.getEvents().then((function(e){var n=[],r=JSON.parse(t.storage.getItem(a.n));r||(r=[]),e&&e.forEach((function(e){var t=Object(s.c)(e.mapValue);-1==r.indexOf(t)&&(n.push(e),r.push(t))})),0!=n.length&&(t.storage.setItem(a.n,JSON.stringify(r)),t._normalLogPipeline(t.assembleData(n)))})),t.cycleTask(0==t.delayTime?t.initDelayTime:t.delayTime)}),e)},t.prototype.onReport=function(e,t,n){var r=this;if(this.isUnderIE8)this.errorReport.reportError("601","UnderIE8");else{var o=this.generateData(e,t,n);if(n&&0==this.delayTime)this._normalLogPipeline(this.assembleData(o));else{var i=o.shift();i"604","insertEvent fail!")}))}}},t.prototype.generateData=function(e,t,n){var r=[],o="4.3.4-web_"+(n?a.h:a.m),i=Number(this.storage.getItem(o));return i=i||1,t=I(I({},t),{A99:n?"Y":"N",A100:i.toString(),A72:"4.3.4-web",A88:this.logidStartTime}),i++,this.storage.setItem(o,i.toString()),r.push({eventCode:e,eventTime:Date.now().toString(),mapValue:Object(s.d)(t,this.config.strictMode)}),r},t.prototype.assembleData=function(e){var t=this.beaconSession.getSession();return{appVersion:this.config.appVersion?Object(s.e)(this.config.appVersion):"",sdkId:"js",sdkVersion:"4.3.4-web",mainAppKey:this.config.appkey,platformId:3,common:Object(s.d)(I(I({},this.additionalParams),{A2:this.commonInfo.deviceId,A8:this.commonInfo.openid,A12:this.commonInfo.language,A17:this.commonInfo.pixel,A23:this.commonInfo.channelID,A50:this.commonInfo.unid,A76:t.sessionId,A101:this.commonInfo.userAgent,A102:window.location.href,A104:document.referrer,A119:this.commonInfo.query}),!1),events:e}},t.prototype.onSendBeacon=function(e,t){if(this.isUnderIE8)this.errorReport.reportError("601","UnderIE8");else{var n=this.assembleData(this.generateData(e,t,!0));navigator.sendBeacon(this.strategy.getUploadUrl(),JSON.stringify(n))}},t}(r.default);t.default=O}]).default}));