;
(self.AMP=self.AMP||[]).push({m:1,v:"2312191621000",n:"amp-access",ev:"0.1",l:!0,f:function(t,i){(()=>{var i;ar e={isArray:n}=Array;function r(t,i){const s=[];let e=0;for(let n=0;n<t.length;n++){const r=t[n];i(r,n,t)?s.push(r):(e<n&&(t[e]=r),e++)}return e<t.length&&(t.length=e),s}var{hasOwnProperty:o,toString:h}=Object.prototype;tion f(t){return 1==(null==(i=t)?void 0:i.nodeType)?t.tagName.toLowerCase()+(t.id?`#${t.id}`:""):t;var i}function d(t,i,s,e,n,r,o,h,c,u,a){return t}function p(t){return JSON.parse(t)}r A=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;unction v(t){const i=u();if(!t)return i;let s;for(;s=A.exec(t);){const t=P(s[1],s[1]),e=s[2]?P(s[2].replace(/\+/g," "),s[2]):"";i[t]=e}return i}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var g=self.__AMP_LOG;S(t,i){return function(t,i){const s=z(t,i);if(s)return s;const n=L(t);return n[i]=function(){const t=new e,{promise:i,reject:s,resolve:n}=t;return i.catch((()=>{})),{obj:null,promise:i,resolve:n,reject:s,context:null,ctor:null}}(),n[i].promise}(C(t),i)}t=>x(t,"timer"),D=t=>M(t,"viewer"),F=t=>I(t,"vsync"),G=t=>I(t,"xhr");function J(t,i,s={},e=!0){var n;(n=t,n,"amp-analytics-instrumentation","amp-analytics")).then((n=>{n&&n.triggerEventForTarget(t,i,s,e)}))}function K(t,i,s,e){let n=t,r=s,o=const h=),c=!(null==e||!e.capture);return n.addEventListener(i,o,h?e:c),()=>{null==n||n.removeEventListener(i,o,h?e:c),r=null,n=null,o=null}}ar H=function(){var t=i=[1,3],s=[1,4],e=[1,18],n=[1,19],r=[1,14],o=[1,15],h=[1,16],c=[1,17],u=[1,21],a=[1,22],l=[5,6,7,10],f=[5,6,7,10,15,16,17,18,19,20,21],d=[5,6,7,10,15,16,17,18,19,20,21,25,27],p={trace:function(){},yy:{},tN:{"error":2,"result":3,"search_condition":4,"EOF":5,"OR":6,"AND":7,"NOT":8,"(":9,")":10,"predicate":11,"comparison_predicate":12,"truthy_predicate":13,"scalar_exp":14,"EQ":15,"DEQ":16,"NEQ":17,"LT":18,"LTE":19,"GT":20,"GTE":21,"atom":22,"field_ref":23,"literal":24,"DOT":25,"field_name":26,"[":27,"string":28,"]":29,"NAME":30,"STRING":31,"NUMERIC":32,"TRUE":33,"FALSE":34,"NULL":35,"$accept":0,"$end":1},eN:{2:"error",5:"EOF",6:"OR",7:"AND",8:"NOT",9:"(",10:")",15:"EQ",16:"DEQ",17:"NEQ",18:"LT",19:"LTE",20:"GT",21:"GTE",25:"DOT",27:"[",29:"]",30:"NAME",31:"STRING",32:"NUMERIC",33:"TRUE",34:"FALSE",35:"NULL"},nN:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,1],[11,1],[11,1],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[13,1],[14,1],[14,1],[22,1],[23,3],[23,4],[23,1],[26,1],[28,1],[24,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(t,i,s,e,n,r,o){var h=r.length-1;switch(n){case 1:return r[h-1];case 2:this.$=r[h-2]||r[h];break;case 3:this.$=r[h-2]&&r[h];break;case 4:this.$=!r[h];break;case 5:this.$=r[h-1];break;case 6:case 7:case 8:case 17:case 18:case 19:this.$=r[h];break;case 9:this.$=r[h-2]===r[h];break;case 10:throw new Error('"==" is not allowed, use "="');case 11:this.$=r[h-2]!==r[h];break;case 12:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]<r[h];break;case 13:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]<=r[h];break;case 14:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]>r[h];break;case 15:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]>=r[h];break;case 16:this.$=void 0!==r[h]&&null!==r[h]&&""!==r[h]&&0!==r[h]&&!1!==r[h];break;case 20:this.$="[object Object]"==Object.prototype.toString.call(r[h-2])&&r[h-2].hasOwnProperty(r[h])?r[h-2][r[h]]:null;break;case 21:this.$="[object Object]"==Object.prototype.toString.call(r[h-3])&&r[h-3].hasOwnProperty(r[h-1])?r[h-3][r[h-1]]:null;break;case 22:this.$=void 0!==e[r[h]]?e[r[h]]:null;break;case 23:this.$=t;break;case 24:this.$=t.substring(1,t.length-1);break;case 26:this.$=Number(t);break;case 27:this.$=!0;break;case 28:this.$=!1;break;case 29:this.$=null}},table:[{3:1,4:2,8:i,9:s,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{1:[3]},{5:[1,20],6:u,7:a},{4:23,8:i,9:s,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{4:24,8:i,9:s,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},t(l,[2,6]),t(l,[2,7]),t(l,[2,8]),t(l,[2,16],{15:[1,25],16:[1,26],17:[1,27],18:[1,28],19:[1,29],20:[1,30],21:[1,31]}),t(f,[2,17]),t(f,[2,18],{25:[1,32],27:[1,33]}),t(f,[2,19]),t(d,[2,22]),t(f,[2,25]),t(f,[2,26]),t(f,[2,27]),t(f,[2,28]),t(f,[2,29]),t(d,[2,23]),t([5,6,7,10,15,16,17,18,19,20,21,29],[2,24]),{1:[2,1]},{4:34,8:i,9:s,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{4:35,8:i,9:s,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},t(l,[2,4]),{6:u,7:a,10:[1,36]},{14:37,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:38,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:39,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:40,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:41,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:42,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:43,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{26:44,30:e},{28:45,31:n},t([5,6,10],[2,2],{7:a}),t(l,[2,3]),t(l,[2,5]),t(l,[2,9]),t(l,[2,10]),t(l,[2,11]),t(l,[2,12]),t(l,[2,13]),t(l,[2,14]),t(l,[2,15]),t(d,[2,20]),{29:[1,46]},t(d,[2,21])],defaultActions:{20:[2,1]},parseError:parse:,_=);eturn p.lexer=_,m.prototype=p,p.Parser=m,new m}(),Q=H; Y="__AMP__EXPERIMENT_TOGGLES";function Z(t,i){const s=function(t){var i,s,e,r,o;if(t[Y])return t[Y];t[Y]=u();const h=t[Y];d(h);const c=X(X({},null!==(i=t.AMP_CONFIG)&&void 0!==i?i:{}),null!==(s=t.AMP_EXP)&&void 0!==s?s:p((null===(e=t.__AMP_EXP)||void 0===e?void 0:e.textContent)||"{}"));for(const t in c){const i=c[t];"number"==typeof i&&i>=0&&i<=1&&(h[t]=Math.random()<i)}const a=null===(r=t.AMP_CONFIG)||void 0===r?void 0:r["allow-doc-opt-in"];if(n(a)&&a.length){const i=t.document.head.querySelector('meta[name="amp-experiments-opt-in"]');if(i){var l;const t=(null===(l=i.getAttribute("content"))||void 0===l?void 0:l.split(","))||[];for(const i of t)a.includes(i)&&(h[i]=!0)}}Object.assign(h,function(t){var i;let s="";try{var e;"localStorage"in t&&(s=null!==(e=t.localStorage.getItem("amp-experiment-toggles"))&&void 0!==e?e:"")}catch(t){}const n=(null===(i=s)||void 0===i?void 0:i.split(/\s*,\s*/g))||[],r=u();for(const t of n)t&&("-"==t[0]?r[t.substr(1)]=!1:r[t]=!0);return r}(t));const f=null===(o=t.AMP_CONFIG)||void 0===o?void 0:o["allow-url-opt-in"];if(n(f)&&f.length){const i=v(t.location.originalHash||t.location.hash);for(const t of f){const s=i[`e-${t}`];"1"==s&&(h[t]=!0),"0"==s&&(h[t]=!1)}}return h}(t);return!!s[i]}var tt,it=(()=>self.AMP.config.urls)(),st=new Set(["c","v","a","ad"]),et=function nt(t,i){return tt||(tt=self.document.createElement("a")),tt,t)}unction ot(t,i,s="source"){var e;return y(null!=t,"%s %s must be available",i,s),y("https:"==(e=et(e=t)).protocol||"localhost"==e.hostname||"127.0.0.1"==e.hostname||e.hostname,".localhost")||/^\/\//.test(t),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',i,s,t),t}unction ct(t){return it.cdnProxyRegex.test(et(t).origin)}function ut(t){return nt(function(t){if(!ct(t=et(t)))return t.href;const i=t.pathname.split("/"),s=i[1];y(st.has(s),"Unknown path prefix in url %s",t.href);const e=i[2],n="s"==e?"https://"+decodeURIComponent(i[3]):"http://"+decodeURIComponent(e);return y(n.indexOf(".")>0,"Expected a . in origin %s",n),i.splice(1,"s"==e?3:2),n+i.join("/")+function(t,i){if(!t||"?"==t)return"";const s=new RegExp("[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\\b[^&]*","g"),e=t.replace(s,"").replace(/^[?&]/,"");return e?"?"+e:""}(t.search)+(t.hash||"")}(t)).origin}var at=class{constructor(t,i,s){this.ampdoc=t,this.Qj=s,this.Sct=y(i.authorization,'"authorization" URL must be specified'),ot(this.Sct,'"authorization"'),this.Vct=!i.noPingback,this.jct=i.pingback,this.Vct&&(y(this.jct,'"pingback" URL must be specified'),ot(this.jct,'"pingback"')),this.Hct=this.Yct(i),this.s$=G(t.win),this.Re=$(t.win)}Yct(t){if(!t.authorizationTimeout)return 3e3;let i=t.authorizationTimeout;return y("number"==typeof i,'"authorizationTimeout" must be a number'),i=Math.min(i,3e3),i}etAuthorizationUrl(){return this.Sct}isAuthorizationEnabled(){return!0}getAuthorizationTimeout(){return this.Hct}authorize(){return this.Qj.buildUrl(this.Sct,!1).then((t=>this.Re.timeoutPromise(this.Hct,this.s$.fetchJson(t,{credentials:"include"})).then((t=>t.json()))))}isPingbackEnabled(){return this.Vct}pingback(){return this.Qj.buildUrl(R(this.jct),!0).then((t=>this.s$.sendSignal(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:""})))}postAction(){}},lt="__AMP__",ft="amp-access-iframe",dt=["GET","POST"];function pt(t,i){const s=X({},i);if((e=i.body)&&"function"==typeof e.getFormData){const t=i.body;s.headers["Content-Type"]="multipart/form-data;charset=utf-8",s.body=function(t){const i=[];for(let s=t.next();!s.done;s=t.next())i.push(s.value);return i}(t.entries())}var e;return{input:t,init:s}}function _t(t,i,e){let o=e,"text/html");o=t,i,o),i=function(t,i,s){return d("string"==typeof i),!1!==s.ampCors&&(i=function(t,i){return i),function(t,i,s,e){return t,rt("__amp_source_origin",s))}(i,0,ut(t.location.href))}(t,i)),i}(t,i,o);const h=(t=>I(t,"ampdoc"))(t),a=h.isSingleDoc()?h.getSingleDoc():null;return o.responseType="document",function(t,i,e,o){if(!i)return s();const h=o.prerenderSafe?s():i.whenFirstVisible(),a=D(i),l=ct(e),d=a.hasCapability("xhrInterceptor"),p=o.bypassInterceptorForDev&&!1;return l||!d||p?h:i.getRootNode().documentElement.hasAttribute("allow-xhr-interception")?h.then(().then((i=>{if(!i&&!Z(t,"untrusted-xhr-interception"))return;const s={"originalRequest":pt(e,o)};return a.sendMessageAwaitResponse("xhr",s).then((t=>function(t,i){if(function(t,i,s="Assertion failed",e){var n,o;if(i)return i;t&&-1==s.indexOf(t)&&(s+=t);let h=3;const c=s.split("%s");let u=c.shift();const a=[u];for(;c.length;){const t=arguments[h++],i=c.shift();u+=f(t)+i,a.push(t,i.trim())}const l=new Error(u);throw l.messageArray=r(a,(),null===(n=(o=self).__AMP_REPORT_ERROR)||void 0===n||n.call(o,l),l}("​​​",c(t),"Object expected: %s",t,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0),"document"!=i)return new Response(t.body,t.init);const s=u(),e={status:200,statusText:"OK",getResponseH|null};if(t.init){const i=t.init;n(i.headers)&&i.headers.forg(e)})),i.status&&(e.status=parseInt(i.status,10)),i.statusText&&(e.statusText=String(i.statusText))}return new Response(t.body?String(t.body):"",e)}(t,o.responseType)))})):h}(t,a,i,o).then((t=>t?t.text().tml"))):function(t,i){return new Promise(((s,e)=>{const n=new XMLHttpRequest;n.open(i.method||"GET",t,!0),n.withCredentials="include"==i.credentials,n.responseType="document";for(const t in i.headers)n.setRequestHeader(t,i.headers[t]);n.onreadystatechange=()=>{if(!(n.readyState<2)){if(n.status<100||n.status>599)return n.onreadystatechange=null,void e(E().createExpectedError(`Unknown HTTP status ${n.status}`));if(4==n.readyState){const i={status:n.status,statusText:n.statusText,headers:mt(n.getAllResponseHeaders())},e=(t=new Response("",i),new Pro=t,e}))).r:n})));s(e)}}var t},n.onerror=()=>{e(E().createExpectedError("Request failure"))},n.onabort=()=>{e(E().createExpectedError("Request aborted"))},"POST"==i.method?n.send(i.body):n.send()}))}(i,o).eXML}))))}function mt(t){const i={};return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){const s=t.split(":"),e=s.shift().trim();if(e){const t=s.join(":").trim();i[e]=t}n i}var vt={"-":"+","_":"/",".":"="};function gt(t){return Pt(atob(t.replace(/[-_vt[t]))))}var bt="ampproject.org",Et=class{constructor(t,i,s){this.ampdoc=t,this.Qj=s,this.t_t=new at(t,i,s),this.s$=G(t.win),this.Re=$(t.win),this.ar=F(t.win),this.i_t=t.getMetaByName("i-amphtml-access-state");const e=Z(t.win,"amp-access-server-jwt");this.Xo=ct(t.win.location)||e;const n=e?t.getParam("serverAccessService"):null;this.pb=n||ht(t.win.location.href),this.Ky=i.publicKey||null,this.s_t=i.publicKeyUrl||null,y(this.Ky||this.s_t,'"publicKey" or "publicKeyUrl" must be specified'),this.s_t&&ot(this.s_t,'"publicKeyUrl"'),this.Ky&&this.s_t,this.e_t=new class{constructor(t){this.win=t,this.n_t=t.crypto&&(t.crypto.subtle||t.crypto.webkitSubtle)|n_t}decodeAndVerify(t,i){if(!this.n_t)throw new Error("Crypto is not supported on this platform");return new Prot(t)))).then((t=>{const s=t.header.alg;if(!s||"RS256"!=s)throw new Error("Only alg=RS256 is supported");return this.o_t(i).then((i=>{const s=gt(t.sig);return this.n_t.verify({name:"RSASSA-PKCS1-v1_5"},i,s,Pt(t.verifiable))})).then((i=>{if(i)return t.payload;throw new Error("Signature verification failed")}))}))}r_t(t){function i(){throw new Error(`Invalid token: "${t}"`)}const s=t.split(".");3!=s.length&&i();const e=gt(s[0]),n=gt(s[1]);return{header:_(At(e),i),payload:_(At(n),i),verifiable:`${s[0]}.${s[1]}`,sig:s[2]}}o_t(t){return t.then((t=>this.n_t.importKey("(i))}(t),{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"])))}}(t.win)}gets_t}}isAuthorizationEnabled(){return!0}authorize(){return this.Xo&&this.i_t?this.h_t():this.c_t()}isPingbackEnabled(){return this.t_t.isPingbackEnab(){}u_t(){let t=this.Qj.buildUrl(this.t_t.getAuthorizationUrl(),!1).then((t=>this.Re.timeoutPromise(3e3,this.s$.fetchText(t,{credentials:"include"})))).then((t=>t.text())).then((t=>{const i=this.e_t.decode(t);return y(i.amp_authdata,'"amp_authdata" must be present in JWT'),{encoded:t,jwt:i}}));return this.a_t()&&(this.e_t.isVerificationSupported()&&(t=t.then((t=>this.e_t.decodeAndVerify(t.encoded,this.l_t()).then((()=>t))))),t=t.t),t)))),t.catch((t=>{throw E().createError("JWT fetch or validation failed: ",t)}))}l_t(){return this.Ky?Promise.resolve(this.Ky):this.s$.fetchText(this.s_t).then((t=>t.text()))}a_t(){returnt,e)}c_t(){return this.u_t().hdata))}h_t(){return this.u_t().then((t=>{const{encoded:i,jwt:s}=t,e=s.amp_authdata,r=function(t){const i=[];for(const e in t){let r=t[e];if(null!=r){r=n(s=r)?s:[s];for(let t=0;t<r.length;t++)i.push(rt(e,r[t]))}}var s;return i.join("&")}({"url":ht(this.ampdoc.win.location.href),"state":this.i_t,"jwt":i});return this.Re.timeoutPromise(3e3,_t(this.ampdoc.win,this.pb,{method:"POST",body:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}}))._t(t))).()=>e))}))}d_t(t){const i=t.querySelectorAll("[i-amphtml-access-id]");return this.ar.mutatePromise((()=>{for(let t=0;t<i.length;t++){const s=i[t],e=s.getAttribute("i-amphtml-access-id"),n=this.ampdoc.getRootNode().querySelector(`[i-amphtml-access-id="${m(e)}"]`);n&&n.parentElement.replaceChild(this.ampdoc.win.document.importNode(s,!0),n)})),n}va.urls)(),Rt=new RegExp("RETURN_n()}var Mt=se=i}getLoginUrl(){let t;return t="string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise,t.then((t=>St(t,"RETURN_URL")))}open(){return this.getLoginUrl().then((t=>this.viewer.sendMessageAwaitResponse("openDialog",{"url":t})))}},Vt=class{constructor(t,i,s){this.win=t,this.viewer=i,this.urlOrPromise=s,this.te=null,this.Ar=null,this.p_t=null,this.__t=null,this.m_t=null,this.A_t=null}open(){return y(!this.te,"Dialog already opened"),new Pro_t()})).()(),tull)}getLoginUrl(){let t;return t="string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise,t.then((t=>St(t,this.v_t())))}P_t(){const{screen:t}=this.win,i=Math.floor(Math.min(700,.9*t.width)),e=Math.floor(Math.min(450,.9*t.height)),n=`height=${e},width=${i},left=${Math.floor((t.width-i)/2)},top=${Math.floor((t.height-e)/2)},resizable=yes,scrollbars=yes`,r=this.v_t();if(this.__t=null,"string"==typeof this.urlOrPromise){const t=St(this.urlOrPromise,r);this.p_t=wt(this.win,t,"_blank",n),this.p_t&&(this.__t=s())}else this.p_t=wt(this.win,"","_blank",n),this.p_t&&(this.__t=this.urlOrPromise.then((t=>{const i=St(t,r);this.p_t.location.replace(i)}),(t=>{throw new Error("failed to resolve url: "+t)})));this.__t?this.__t.then((()=>{this.g_t(l,t)})):this.b_t(null,new Error("failed to open dialog"))}g_t(t){const i=nt(t).origin;this.m_t=this.win.setInterval((()=>{this.p_t.closed&&(this.win.clearInterval(this.m_t),this.m_t=null,this.win.setTim("")}),3e3))}),500),this.A_t=K(this.win,"message",(t=>{t.origin==i&&q(t)&&"amp"==q(t).sentinel&&"result"==q(t).type&&(this.p_t&&this.p_t.postMessage({"sentinel":"amp","type":"result-ack"},i),this.b_t(q(t).result))}),void 0)}b_t(t,i){this.te&&(i?this.Ar(i):this.te(t),this.Mn())}v_t(){const t=this.viewer.getResolvedViewerUrl();let i;return i=`${Tt.cdn}/v0/amp-login-done-0.1.html`,i+"?url="+encodeURIComponentt(i)}var kt="amp-access",Ot="client",Ut="server",Ct="ven!1}var Lt=self.__AMP_ERRORS||[];self.__AMP_ERRORS=Lt;var jt="amp-access",Nt="__AMP_ACCESS__TEMPLATE";t.registerServiceForDoc("access",(function(t){return new class{constructor(t){this.amp,4)}})=>{}));const i=t.getElementById("amp-access");if(this.E_t=!!i,!this.E_t)return;var s,e,n;this.w_t=i,this.T_t=ut(t.win.location),this.Re=$(t.win),this.ar=F(t.win),this.R_t=S(t,"cid"),this.Fe=D(t),this.Uu=M(t,"viewport"),this.tM=(t=>M(t,"templates"))(t),this.oc=(t=>M(t,"mutator"))(t),this.wtt=(s=t.win,n="performance",j(e=O(e=s),n)?x(e,n):null),this.Krt=null,this.y_t=new null}eve[t]}},this.Hw=this.M_t();const r=this.Hwzed()));this.V_t=!1,this.S_t=Promise.all(r),this.k_t=null,this.O_t=new null}add(t){return this.Vt||(this.Vt=[]),this.Vt.pue(t)}}remove(t){this,1)}(this.h=0)}fire(t){if(this.Vt)for(const i of this.Vt.slice()?t:0}},this.S_t.then((()=>{this.V_t=!0,this.tW("access-authorization-received"),this.wtt&&(this.wtt.tick("aaa"),this.wtt.tickSinceVisible("aaav"),this.wtt.flush())})),t.getRootNode().addEventListener("amp:dom-update",this.U_t.bind(tnull}C_t(){if(!this.Krt){const t=s();this.Krt=this.R_t.then((i=>i.get({scope:"amp-access",createCookieIfNotPresent:!0},t)))}return this.Krt}areFirstAuthorizationsCompleted(){return thid(t)}M_t(){var t,i;y("SCRIPT"==(t=this.w_t).tagName&&"APPLICATION/JSON"==(null===(i=t.getAttribute("type"))||void 0===i?void 0:i.toUpperCase()),`${jt} config should be inside a <script> tag with type="application/json"`);const r=_(this.w_t.textContent,(t=>{throw E().createError('Failed to parse "amp-access" JSON: '+t)})),o={};if(n(r)){const t=r;for(let i=0;i<t.length;i++){const s=t[i].namespace;y(!!s,"Namespace required"),y(!o[s],"Namespace already used: "+s),o[s]=t[i]}}else o[r.namespace||""]=r;const h=this.C_t.bind(this),u=this.x_t.bind(this),a=this.z_t.bind(this);return Object.keys(o).map((t=>new class{constructor(t,i,s,n,r,o){this.ampdoc=t,this.C_t=s,this.x_t=n,this.z_t=r,this.w_t=o,this.L_t=Z(t.win,"amp-access-server"),this.j_t=Z(t.win,"amp-access-jwt"),this.gC=this.N_t(i),this.$_t=this.D_t(i),this.F_t=i.authorizationFallbackResponse,this.G_t=i.namespace||null,this.J_t=this.K_t(i),thiace"))(o),this.q_t=It.bind(null,t),this.Hrt=null;const h=new e;this.H_t=h.promise,this.Q_t=h.resolve,this.W_t={},this.B_t=null,this.X_t=0}getNamespace(){return this.G_t}getType(){return this.gC}getAdapter(){return thi.Hrt}K_t(t){const i={buildUrl:this.buildUrl.bind(this),collectUrlVars:this.collectUrlVars.bind(this)},r=this.j_t&&!0===t.jwt;switch(this.gC){case Ot:return r?new Et(this.ampdoc,t,i):new at(this.ampdoc,t,i);case"iframe":return new class{constructor(t,i,s){var e,r;this.ampdoc=t,this.Qj=s,this.eG=i,this.Re=$(t.win),this.ov=y(i.iframeSrc,'"iframeSrc" URL must be specified'),ot(this.ov,'"iframeSrc"'),this.Y_t=i.iframeVars||null,this.Y_t&&y(n(this.Y_t),'"iframeVars" must be an array'),this.Z_t=y(i.defaultResponse,'"defaultResponse" must be specified'),this.Eb=nt(this.ov).origin,this.tAt=null,this.iAt=null,this.bv=t.win.document.createElement("iframe"),e=this.bv,void 0===(r=!1)&&(r=e.hasAttribute("hidden")),r?e.removeAttribute("hidden"):e.setAttribute("hidden",""),this.sAt=new class{constructor(t,i,s){this.i=t,this.eAt=i,this.Eb=s,this.o=null,this.nAt=null,this.rAt=this.VE.bind(this),this.oAt=0,this.hAt={}}crAt)}disc.Eb}getrnis.o}getTarget,i)}sendCommandRsvp(t,i){const s=String(++this.oAt);let e=null;const n=new Pro{e=t}));return this.hAt[s]={promise:n,resolver:e},this.sy(s,t,i},n)}VE(t){const i=t,{data:s}=i;if(!s||s.sentinel!=lt)return;const e=i.origin,n=s.cmd,r=s.payload||null;if(null==this.Eb&&"start"==n&&(this.Eb=e),null==this.Eb&&i.source&&this.cAt()==i.source&&(this.Eb=e),e!=this.Eb)return;const o=s._rsvp,h=!!o&&"rsvp"!=n,c=this.uAt(o,n,r);h&&Promise.resolve(c).then((t=>{this.sy(o,"rsvp",{"result":t})}),(t=>{this.sy(o,"rsvp",{"error":String(t)})}))}uAt(t,i,s){if("rsvp"!=i)return this.nAt(i,s);{const i=t&&this.hAt[t];i&&("error"in s?i.resolver(Promise.reject(new Error(s.error))):i.resolver(s.result),delete this.hAt[t])}}}(this.ampdocindow),this.Eb),this.Ig=null}disc)}isPingbackEnabled(){return!0}pingback(){return this.connect().then((()=>this.sAt.sendCommandRsvp("pingback",ull)}c.iAt}dAt(){return new Promise((t=>{const i=p(JSON.stringify(this.eG));if(this.Y_t){const s=this.Y_t.join("&");t(this.Qj.collectUrlVars(s,!1).=t,i))))}else t(i)}))}aAt(){return this.Re.promise(3e3).then((()=>this.pAt()||this.Z_t))}lAt(){return this.connect().then((()=>this.sAt.sendCommandRsvp("authorize",{}))).then((t=>(t&&s().At(t))),t)))}pAt(){const{win:t}=this.ampdoc,i=t.sessionStorage||t.localStorage;if(!i)return null;try{const t=i.getItem(ft);if(!t)return null;const s=p(t);return s.t+6048e5<this.ampdoc.win.Date.now()?null:s.d||null}catch(t){T().error(ft,"failed to restore access response: ",t);try{i.removeItem(ft)}catch(t){}return null}}fAt(t){const{win:i}=this.ampdoc,s=i.sessionStorage||i.localStorage;if(s)try{t?s.setItem(ft,JSON.stringify({"t":this.ampdoc.win.Date.now(),"d":t})):s.removeItem(ft)}catch(t){T().error(ft,"failed to store access response: ",t)}}uAt(t,i){"connect"!=t||this.Ig.then((t=>{this.sAt.sendCommandRsvp("start",{"protocol":"amp-access","config":t}).ull)}))}))}}(this.ampdoc,t,i);case Ut:return r?new Et(this.ampdoc,t,i):new class{constructor(t,i,s){this.ampdoc=t,this.Qj=s,this.t_t=new at(t,i,s),this.s$=G(t.win),this.Re=$(t.win),this.ar=F(t.win),this.i_t=t.getMetaByName("i-amphtml-access-state");const e=Z(t.win,"amp-access-server");this.Xo=ct(t.win.location)||e;const n=e?t.getParam("serverAccessService"):null;this.pb=n||ht(t.win.location.href)}geti_t}}isAuthorizationEnabled(){return!0}authorize(){return this.Xo&&this.i_t?this.Qj.collectUrlVars(this.t_t.getAuthorizationUrl(),!1).then((t=>{const i={};for(const s in t)null!=t[s]&&(i[s]=String(t[s]));const s={"url":ht(this.ampdoc.win.location.href),"state":this.i_t,"vars":i};return this.Re.timeoutPromise(this.t_t.getAuthorizationTimeout(),_t(this.ampdoc.win,this.pb,{method:"POST",body:"request="+encodeURIComponent(JSON.stringify(s)),headers:{"Content-Type":"application/x-www-form-urlencoded"}}))})).then((t=>{const i=p(R(t.querySelector('script[id="amp-access-data"]')).textContent);return this.d_t(t).then((()=>i))})):this.t_t.authorize()}isPingbackEnabled(){return this.t_t.isPingbackEnabled()}pingback(){return this.t_t.pingback()}postAction(){}d_t(t){const i=t.querySelectorAll("[i-amphtml-access-id]");return this.ar.mutatePromise((()=>{for(let t=0;t<i.length;t++){const s=i[t],e=s.getAttribute("i-amphtml-access-id"),n=this.ampdoc.getRootNode().querySelector(`[i-amphtml-access-id="${m(e)}"]`);n&&n.parentElement.replaceChild(this.ampdoc.win.document.importNode(s,!0),n)}}))}}(this.ampdoc,t,i);case Ct:return new class{constructor(t,i){this.ampdoc=t,this._At=y(i.vendor,'"vendor" name must be specified'),this.mAt=i[this._At]||{},this.Vct=!i.noPingback;const s=new e;this.AAt=s.promise,this.PAt=s.resolve}getVendorName(){return this._At}getConfig(){return this.mAt}registernull}isAuthorizationEnabled(){return!0}authorize(){return this.AAt.then((t=>t.authorize()))}isPingbackEnabled(){return thi()))}postAction(){}}(this.ampdoc,t);case"other":return new class{constructor(t,i,s){this.ampdoc=t,this.Qj=s,this.vAt=i.authorizationFallbackResponse||null,this.Xo=ct(t.win.loca.Xo}authorize(){R(!this.Xo);const t=R(this.vAt);return Promise.resolve(t)}isPingbackEnabled(){ret s()}postAction(){}}(this.ampdoc,t,i)}throw T().createError("Unsupported access type: ",this.gC)}getAdapterConfig(){return this.J_t.getConfig()}whenFirstAuthorized(){return this.H_t}N_t(t){let{"type":i}=t;var s;return y(!i||"client"===(s=i)||"iframe"===s||"server"===s||"vendor"===s||"other"===s,`Unknown access type: ${i}`),i||(i=t.vendor?Ct:Ot),i!=Ut||this.L_t||(i=Ot),i==Ot&&this.L_t&&(i=Ut)rn s}gAt(){const t=this.ampdoc.getRootNode();return t.documentElement||t.body||t}tW(t){J(this.gAt(),t,void At()}buildUrl(t,i){return this.Yrt(i).then((i=>this.Iy.expandUrlAsync(t,i)))}collectUi)))}Yrt(t){return this.C_t().then((i=>{const s={"READER_ID":i,"ACCESS_READER_ID":i};return t&&(s.AUTHDATA=t=>{if(this.Hrt)return l(this.Hrt,t)}),s}))}runAuthorization(t){return this.J_t.isAuthorizationEnabled()?this.J_t.authorize().catch((i=>{if(this.tW("access-authorization-failed"),this.F_t&&!t)return E().error(kt,"Authorization failed: ",i),this.F_t;throw i})).then((t=>(this.EAt(t),this.bAt(),t))).catch((t=>{throw E().error(kt,"Authorization failed: ",t),this.Q_t(),t})):(this.Q_t()_t()}reportViewToServer(){return this.J_t.pingback().then((()=>{this.tW("access-pingback-sent")})).catch((t=>{throw this.tW("access-pingback-failed"),E().createError("Pingback failed: ",t)}))}getLoc,t)}loginWi,i)}wAt(t,i){const s=Date.now();if(this.B_t&&s-this.X_t<1e3)return this.B_t;this.TAt(i,"started");const e=this.q_t(t).then((t=>{this.B_t=null;const s=v(t).success,e="true"==s||"yes"==s||"1"==s;if(e?this.TAt(i,"success"):this.TAt(i,"rejected"),e||!s){this.J_t.postAction();const t=this.runAuthorization(!0);return this.z_t(t),t.then((()=>{this.x_t(0)}))}})).catch((t=>{throw this.TAt(i,"failed"),this.B_t==e&&(this.B_t=null),t}));return this.B_t=e,this.X_t=s,this.B_t}TAt(t,i){this.tW(`access-login-${i}`),t&&this.tW(`access-login-${t}-${i}`)}bAt(){if(0==Object.keys(this.$_t).length)return null;const t=[];for(const i in this.$_t)t.push(this.buildUrl(this.$_t[i],!0).then((t=>(this.W_t[i]=t,{type:i,url:t}))));return Promise.all(t)}}(this.ampdoc,o[t],h,u,a,this.w_t)))}U_t(t){if(this.V_t){const i=t.target;return this.S_t.then((()=>{const t=this.combinedResponses();this.RAt(i,t)}))}}getVendorrror}isEnabled(){return this.Ey,!1)}On(){return this.E_t?(this.yAt(),this):thNn()}Nn(){this.Fe.onBroadcast((t=>{"amp-access-reauthorize"==t.type&&t.origin==this.T_t&&this.IAt()}))}z_t(t){this.MAt(),t.then((()=>{this.V_t&&this.S_t.then((()=>{this.ampdoc.whenReady().then((()=>{const t=this.ampdoc.getRootNode(),i=this.combinedResponses();return this.RAt(t,i)}))}_t})}IAt(t){this.VAt("amp-access-loading",!0);const i=this.ampdoc.whenFirstVisible().then((()=>Promise.all(this.Hw.map((t=>this.SAt(t)))))).then((()=>(this.VAt("amp-access-loading",!1),this.ampdoc.whenReady().then((()=>{const t=this.ampdoc.getRootNode(),i=this.combinedResponses();return this.RAt(t,i)})))));return this.S_t=i,i}SAt(t){return t.runAuthorization().c,!0)}))}getAuthdataField(t){return this.E_t?this.S_t.then((()=>{const i=l(this.combinedResponses(),t);return void 0!==i?i:null})):null}RAt(t,i){const s=t.querySelectorAll("[amp-access]"),e=[];for(let t=0;t<s.length;t++)e.push(this.kAt(s[t],i));return Promise.all(e).re()}))}kAt(t,i){const s=t.getAttribute("amp-access");let e=!1;try{e=this.y_t.evaluate(s,i)}catch(t){E().error(jt,t)}if(e){const s=this.OAt(t,i);if(s)return s.(t,e)))}return this.UAt(t,e)}UAt(t,i){const e=!t.hasAttribute("amp-access-hide");return i==e?s():this.oc.mutateElement(t,(()=>{i?t.removeAttribute("amp-access-hide"):t.setAttribute("amp-access-hide","")}))}OAt(t,i){const s=[],e=t.querySelectorAll("[amp-access-template]");if(e.length>0)for(let n=0;n<e.length;n++){const r=this.KB(t,e[n],i).catch((i=>{T().error(jt,"Template failed: ",i,e[n],t)}));s.push(r)}return s.length>0?Promise.all(s):null}KB(t,i,s){let e=i,n=null;return"TEMPLATE"!=e.tagName&&(n=e,e=n[Nt]),e?this.tM.renderTemplate(e,s).then((t=>this.ar.mutatePromise((()=>{t.setAttribute("amp-access-template",""),t[Nt]=e,e.parentElement?e.parentElement.replaceChild(t,e):n&&n.parentElement&&n.parentElement.replaceChild(t,n)})))):Promise.reject(new Error("template not found"))}x_t(t){this.Hw.led()))&&(this.k_t=null,this.ampdoc.whenReady().then((()=>{this.ampdoc.isVisible()&&this.CAt(t),this.ampdoc.onVisibilityChanged((()=>{this.ampdoc.isVisible()&&this.CAt(t)}))})))}CAt(t){return this.k_t||(this.k_t=this.xAt(t).s.S_t)).then((()=>(this.tW("access-viewed"),this.zAt()))).cll,t})),this.k_t.then(this.MAt.bind(this))),this.k_t}xAt(t){if(0==t)return s();const i=[];return new Promise(((s,e)=>{i.push(this.ampdoc.onVisibilityChanged((()=>{this.ampdoc.isVisible()||e(new Error("CANCELLED"))})));const n=this.Re.delay(s,t);i.el(n))),i.push(this.Uu.onScroll(s)),i.push(function(t,i,s,e){let n=s;const r=K(t,"click",(t=>{try{n(t)}finally{n=null,r()}}),void 0);return r}(this.ampdoc.getRootNode(),0,s))})).()))}),(t=>{throw i.for=>t())),t}))}zAt(){const t=[];for(let i=0;i<this.Hw.length;i++)this.Hw[i].getAdapter().isPingbackEnabled()&&t.push(this.Hw[i].reportViewToServer());return Promise.all(t)}VAt(t,i){this.ar.mutate((()=>{this.gAt().classList.toggle(t,i)null}getw[t]}LAt(t){const i=t.indexOf("-"),s=1==this.Hw.length,e=i>-1?t.substring(0,i):t,n=this.Hw.fi()==e));if(n.length){const s=i>-1?t.substring(i+1):"";return n[0].loginWithType(s)}return y(s,"Login must match namespace: %s",e),this.Hw[0].loginWithType(t)}combinedResponses(){if(1==this.Hw.length&&!this.Hw[0].getNamespace())return this.Hw[0].getAuthResponse()||{};const t={};return this.Hw.forEach((i=>t[i.getNamespace()]=i.getAuthResponse())),t}}(t).On()}))})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-access-0.1.mjs.map