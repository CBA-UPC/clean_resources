var SCFValidator=function(g,f){var e=this;this.items=[];this.context=null!==g?g:$(document.body);this.batch_processing=!1;g=$(this.context).attr("data-scf-validator-batch-processing");"undefined"!==typeof g&&"true"===g&&(this.batch_processing=!0);this.elements=$("[data-scf-validator]");$.each(this.elements,function(f,c){$($(c).closest("form")).is(e.context)&&e.items.push(new SCFValidatorItem(c,e.batch_processing))})};
SCFValidator.prototype.validate=function(){var g=[];$.each(this.items,;return g.every(function(f,e,g){return!0===f})};SCFValidator.prototype.reset=
var SCFValidatorItem=function(g,f){var e=this;this.element=g;g=$(this.element).data("scf-validator");null!==baseRules[g.validation]?(this.validation=baseRules[g.validation].regexp,this.message=baseRules[g.validation].text):(this.validation=baseRules["default"].regexp,this.message=baseRules["default"].text);this.callbacks={init:null,success:null,error:null,complete:null};this.evt="change";this.resetevt="focus";this.notification="highlight";this.notification_str="";this.error_css=this.anchor_element=
this.error_element=null;"undefined"!==typeof g.evt&&(this.evt=g.evt);"undefined"!==typeof g.resetevt&&(this.resetevt=g.resetevt);"undefined"!==typeof g.notification&&(this.notification=g.notification);"undefined"!==typeof g.callbacks&&"object"===typeof g.callbacks&&(this.callbacks=g.callbacks);null!==this.callbacks.init&&window[this.callbacks.init].call();"object"===typeof this.notification?(this.anchor_element=$("#"+this.notification.anchor),this.error_css=this.notification.css,this.notification_str=
"custom"):(this.anchor_element=this.element,this.notification_str=this.notification,this.error_css="scf-validation-highlight-error");$(this.element).on(e.resetevt,function(){e.reset()});if(!1===f)$(this.element).on(e.evt,function(){e.validate()?null!==e.callbacks.success&&window[e.callbacks.success].call():null!==e.callbacks.error&&window[e.callbacks.error].call();null!==e.callbacks.complete&&window[e.callbacks.complete].call()});return this};
SCFValidatorItem.prototype.validate=function(){$(this.element).hasClass(this.error_css)&&this.reset();var g=$(this.element).val();if((new RegExp(this.validation)).test(g))return!0;$(this.element).addClass(this.error_css);this.error_element=$('\x3cdiv class\x3d"alert alert-danger"\x3e'+this.message+"\x3c/div\x3e");switch(this.notification_str){case "highlight":$(this.error_element).insertAfter($(this.anchor_element));break;case "popup":alert(this.message);break;case "custom":$(this.error_element).appendTo($(this.anchor_element));
break;default:alert("Validation error message")}return!1};SCFValidatorItem.prototype.reset=function(){$(this.element).removeClass(this.error_css);null!==this.error_element&&$(this.error_element).remove()};
var baseRules={"default":{text:CQ.I18n.getMessage("Default match. Matches everything."),regexp:"[sS]*"},integer:{text:CQ.I18n.getMessage("Integer only"),regexp:/^\s*(\+|-)?\d+\s*$/},text:{text:CQ.I18n.getMessage("Text only. No digits"),regexp:"^[a-zA-Z ]*$"},numbers:{text:CQ.I18n.getMessage("Numbers only. No special chars, or letters"),regexp:"^[0-9]*$"},messagesubject:{text:CQ.I18n.getMessage("Please enter min 2, max 10, numbers, letters and/or some characters"),regexp:"^([a-zA-Z0-9 \"~\x26|'!@#$%*()-_\x3d+;?/{}]{2,10})$"},
email:{text:CQ.I18n.getMessage("Please enter valid email address"),regexp:/^(([^<>()\[\]\.,;:\s@"]+(\.[^<>()\[\]\.,;:\s@"]+)*)|(".+"))@(([^<>()[\]\.,;:\s@"]+\.)+[^<>()[\]\.,;:\s@"]{2,})$/i},noempty:{text:CQ.I18n.getMessage("Cannot be empty"),regexp:/\S/}};
(function(g,f,e,m){var c={VERSION:"0.0.1",Views:{},Models:{},Collections:{},config:{urlRoot:""},constants:{SOCIAL_SELECTOR:".social",JSON_EXT:".json",URL_EXT:".social.json",TRANSLATE_URL_EXT:".social.translate.json",ANALYTICS_BASE_RESOURCE_TYPE:"social/commons/components/analyticsbase"},Components:{},loadedComponents:{},templates:{},fieldManagers:{},DEBUG:1,INFO:2,WARN:3,ERROR:4};c.LOG_LEVEL=c.INFO;var k={debug:function(){c.LOG_LEVEL<=c.DEBUG&&window.console.debug.apply(window.console,arguments)},
info:function(){c.LOG_LEVEL<=c.INFO&&window.console.info.apply(window.console,arguments)},warn:function(){c.LOG_LEVEL<=c.WARN&&window.console.warn.apply(window.console,arguments)},error:function(){c.LOG_LEVEL<=c.ERROR&&window.console.error.apply(window.console,arguments)}},l=function(a,d){a=a.firstChild;for(var b=null;a;){switch(a.nodeType){case 1:b=l(a,d);break;case 8:if(a.nodeValue.match(d))return a}if(null!==b)break;a=a.nextSibling}return b};c.Router=new g.Router;g.History.started||g.history.start({pushState:!0,
hashChange:!1});c.View=g.View.extend({initialize:function(){this._rendered=!1;this._childViews={};this._parentView=void 0;this._sessionReady=this._modelReady=!1;this._renderedChildren=[];this._replacementTarget=null;this._destroyed=!1;""!==this.$el.html()&&(this.bindView(),this._rendered=!0);this.listenTo(this.model,"model:loaded",;this.listenTo(this.model,"model:cacheFixed",function(){this.render()});this.requiresSession&&!c.Session.isReady()&&this.listenTo(c.Session,
"model:loaded",;this._sessionReady=c.Session.isReady();e.isFunction(this.init)&&this.init.apply(this,arguments);if(c.Session.isReady())this.initContext();else c.Session.on("model:loaded",e.bind(this.initContext,this))},initContext:function(){if(e.isUndefined(c.Context)){c.Context={};var a=$(".scf-js-site-title").attr("href");this.sitePath=a=e.isUndefined(a)?"":a.substring(0,a.lastIndexOf(".html"));c.Context.siteTitle=0!==$(".scf-js-site-title").length?
$(".scf-js-site-title").text():"";c.Context.sitePath=this.sitePath;c.Context.groupTitle=0===$(".scf-js-group-navbar").length||e.isUndefined($(".scf-js-group-navbar").attr("data-group-title"))?"":$(".scf-js-group-navbar").data("group-title");c.Context.groupPath=0===$(".scf-js-group-navbar").length||e.isUndefined($(".scf-js-group-navbar").attr("data-group-path"))?"":$(".scf-js-group-navbar").data("group-path");c.Context.user=c.Session.get("authorizableId")}e.isFunction(this.initAnalytics)&&this.initAnalytics.apply(this,
arguments)},getContextForTemplate:function(){var a=void 0!==this.model?this.model.toJSON():this.context;return this.getMergedContexts(a)},getMergedContexts:function(a){e.isObject(a)||(a={});a.loggedInUser=c.Session.toJSON();a.environment={};a.environment.client=!0;return a},appendTo:function(a){this._rendered||this.render();f(a).append(this.el);this.trigger("view:ready",{view:this})},replaceElement:function(a){this._rendered||this.render();this._rendered?(f(a).replaceWith(this.$el),this._replacementTarget=
null,this.trigger("view:ready",{view:this})):this._replacementTarget=a},render:function(){if(!this._destroyed){var a=this;if(!this._modelReady&&!this.model._isReady||this.requiresSession&&!this._sessionReady)return this;this.unbindDataFields();for(var d in this._childViews)this._childViews[d].destroy(),delete this._childViews[d];this._renderedChildren=[];d=f(this.template(this.getContextForTemplate(),{data:{parentView:this}}));this._rendered||0<this.$el.parent().length?this.$el.html(d.html()):this.setElement(d);
e.each(this._childViews,;d=e.bind(function(){this.bindView();this._rendered=!0;this.afterRender&&this.afterRender();this.trigger("view:rendered",{view:this})},this);f.when(this._renderedChildren).done(d);null!==this._replacementTarget&&this.replaceElement(this._replacementTarget);return this}},bindView:function(){var a=this;this.unbindDataFields();this.$("[evt]").not(this.$("[data-scf-component] [evt]")).each(function(d,b){c.View.bindEvents(a,f(b))});this.$("[data-attrib]").not(this.$("[data-scf-component] [data-attrib]")).each(function(d,
b){c.View.bindDataFields(a,f(b))});this.$("[data-form]").not(this.$("[data-scf-component] [data-form]")).each(},addChildView:function(a){this._childViews[a.cid]=a;var d=f.Deferred();this._renderedChildren[a.cid]=d.promise();this.listenTo(a,"view:rendered",;this.listenTo(a,"view:destroyed",;return this},getChildView:removeChildView:function(a){this._renderedChildren.hasOwnProperty(a)&&
this._renderedChildren[a].fail();if(this._childViews.hasOwnProperty(a)){var d=this._childViews[a];d.stopListening();this.stopListening(d,"view:rendered");this._childViews[a]=void 0;delete this._childViews[a]}return this},getChildViews:function(){return this._childViews},setParent:function(a){this._parentView=a;a.addChildView(this);return this},renderChildView:function(a){a.render();if(null!==this.el){var d=null,b=null,c=new RegExp("s*?data-view\x3d'"+a.cid+"'");if(document.createNodeIterator&&NodeFilter&&
NodeFilter.SHOW_COMMENT){var x=document.createNodeIterator(this.el,NodeFilter.SHOW_COMMENT,!1);for(b=x.nextNode();null!==b;){d=b;b=x.nextNode();break}}else d=l(this.el,c);a.replaceElement(d)}},getField:setField:function(a,d){(a=this._fields[a])&&a.val(d)},focus:getForm:function(a){return"undefined"===typeof this._forms?null:this._forms[a]},destroy:function(){this.undelegateEvents();
this.unbindDataFields();this.stopListening();this.trigger("view:destroyed",{view:this});this._destroyed=!0},unbindDataFields:function(){for(var a in this._fields)this._fields.hasOwnProperty(a)&&e.isFunction(this._fields[a].destroy)&&this._fields[a].destroy();this._fields={}},log:k});c.View.extend=function(){var a=g.View.extend.apply(this,arguments);return c.Views[arguments[0].viewName]=a};c.Model=g.Model.extend({_cachedModels:{},_hasLoadedChildren:!1,parse:
addEncoding:function(a){window.FormData&&a instanceof window.FormData&&a.append("_charset_","UTF-8");a.hasOwnProperty("_charset_")||(a._charset_="UTF-8");return a},reload:function(a){this._isReady=!1;var d="";if(e.isFunction(this.url)){d=this.url();var b=this.url}else d=this.url;this.clear();e.isEmpty(d)||(this.url=d);this.fetch({dataType:"json",cache:!1,xhrFields:{withCredentials:!0},error:function(d,b){c.log.error("Error fetching model");c.log.error(b);d.clear();d._isReady=!0;d.trigger("model:loaded",
d);a&&"function"===typeof a.error&&a.error()},success:function(d){void 0!==b&&(d.url=b);d._isReady=!0;d.trigger("model:loaded",d);a&&"function"===typeof a.success&&a.success()}})},reset:function(a,d){this.clear().set(e.clone(this.defaults));a=this._parseRelations(a);this.set(a,d);return this},initialize:function(a){this.listenTo(c.Session,"logout:success",function(){this.reload()});this.listenTo(c.Session,"login:success",},constructor:function(a,d){"object"!==typeof a&&(a=
JSON.parse(a));a=this._parseRelations(a);g.Model.apply(this,[a,d])},url:function(){return this.urlRoot?this.urlRoot+this.id+c.constants.URL_EXT:c.config.urlRoot?c.config.urlRoot+this.id+c.constants.URL_EXT:this.id+c.constants.URL_EXT},_parseRelations:function(a){"object"!==typeof a&&(a=JSON.parse(a));var d=e.bind(function(d,b){a[b]||d.path||(a[b]=[]);if(a[b]||d.path){var h=a[b];if(e.isArray(h)){var n=[];e.each(h,function(a){if(e.isObject(a))f=e.isUndefined(c.Models[d.model])?c.Components[a.resourceType].Model:
c.Models[d.model],(l=f.findLocal(a.id))?l.reset(a):l=f.createLocally(a),n.push(l);else if(!e.isEmpty(a)){var b=a.substr(c.config.urlRoot.length);b=b.substr(0,b.lastIndexOf(c.constants.URL_EXT));f=c.Models[d.model];(l=f.findLocal("idFromUrl"))||(l=d.autofetch?f.find(b):new f({url:a}));f.prototype._cachedModels[b]=l;n.push(l)}});h=new (c.Collections[d.collection]||g.Collection);h.model=f;h.parent=this;h.set(n,{silent:!0});a[b]=h}else{if(e.isObject(h)){if(e.isUndefined(c.Models[d.model])&&e.isUndefined(c.Components[h.resourceType])){this.log.error("A relation key %s requested model %s but it is not available nor is the component type: %s",
b,d.model,h.resourceType);return}var f=c.Models[d.model]||c.Components[h.resourceType].Model;var l=f.findLocal(h.id)||f.createLocally(h)}else{if(!h)if(d.path)h="/"===d.path.substr(0,1)?d.path:c.config.urlRoot+a.id+"/"+d.path+c.constants.URL_EXT;else return;f=c.Models[d.model];l=d.autofetch?f.find(h,void 0,!0):f.findLocal(h,!0)||new f({url:h})}a[b]=l}}},this);e.each(this.relationships,d);return a},toJSON:function(){var a=g.Model.prototype.toJSON.apply(this);e.each(this.relationships,function(d,b){d=
a[b];if(0>=d.length)delete a[b];else if(e.isArray(d)){var c=[];e.each(d,function(a){a instanceof g.Model?c.push(a.toJSON()):c.push(a)});a[b]=c}else d instanceof g.Collection?a[b]=d.toJSON():d instanceof g.Model&&(a[b]=d.toJSON())});return a},log:k});c.Model.extend=function(){var a=g.Model.extend.apply(this,arguments);return c.Models[arguments[0].modelName]=a};c.View.bindEvents=function(a,d){var b=d.attr("evt");e.each(b.split(","),function(b){var c=b.split("\x3d");b=f.trim(c[0]);c=f.trim(c[1]);a[c]&&
(c=e.bind(a[c],a),d.off(b),d.on(b,c))})};c.View.bindDataFields=function(a,d){var n=d.attr("data-attrib");a._fields||(a._fields={});if(e.isUndefined(a._fields[n])){var h=d.attr("data-field-type"),f=new (e.isUndefined(c.fieldManagers[h])?b:c.fieldManagers[h])(d,{},a.model);a._fields[n]=function(){return{val:function(){return 0===arguments.length?f.getValue():f.setValue(arguments[0])},focus:destroy:}()}};c.View.bindDataForms=
function(a,d){var b=d.attr("data-form");a._forms||(a._forms={});a._forms[b]=new SCFValidator($(d),!1)};c.Model.findLocal=function(a,d){a=d?a.substr(c.config.urlRoot.length):a;if(this.prototype._cachedModels&&this.prototype._cachedModels[a])return this.prototype._cachedModels[a]};c.Model.createLocally=function(a){a=new this.prototype.constructor(a);a._isReady=!0;return this.prototype._cachedModels[a.get("id")]=a};c.Model.prototype.load=function(a){a&&this.set({id:a},{silent:!0});this.fetch({success:xhrFields:{withCredentials:!0}})};c.Model.prototype.getConfigValue=function(a){var d=this.get("configuration");return e.isEmpty(d)?null:d[a]};c.Model.prototype.destroy=function(a){this.constructor.prototype._cachedModels[this.get("id")]=void 0;this.trigger("destroy",this,this.collection,a)};c.Model.prototype.parseServerError=function(a,d,b){a=f.parseJSON(a.responseText);a.hasOwnProperty("status.code")&&(a.status=a.status||{},a.status.code=a["status.code"],delete a["status.code"]);
a.hasOwnProperty("status.message")&&(a.status=a.status||{},a.status.message=a["status.message"],delete a["status.message"]);return{error:b,details:a}};c.Model.find=function(a,d,b){var h=this;if(this.prototype._cachedModels&&this.prototype._cachedModels[a])return b=this.prototype._cachedModels[a],e.isFunction(d)&&d(b),b;var n=new this.prototype.constructor({id:a});b&&(n.url=a);this.prototype._cachedModels[a]=n;n.fetch({dataType:"json",xhrFields:{withCredentials:!0},error:function(b,n){204===n.status||
404===n.status?(c.log.debug("non existing resource"),b._isReady=!0,b.trigger("model:loaded",b),e.isFunction(d)&&d(b)):(c.log.error("Error fetching model"),c.log.error(n),h.prototype._cachedModels[a]=void 0)},success:function(a){a._isReady=!0;a.trigger("model:loaded",a);e.isFunction(d)&&d(a)}});return n};c.Collection=g.Collection.extend({});c.Collection.extend=function(){var a=g.Collection.extend.apply(this,arguments);return c.Collections[arguments[0].collectioName]=a};c.registerComponent=function(a,
d,b){c.Components[a]={Model:d,View:b,name:a}};c.addLoadedComponent=function(a,b,n){if(c.Components[a])return c.loadedComponents[a]||(c.loadedComponents[a]={}),c.loadedComponents[a][b.id]={model:b,view:n},c.loadedComponents[a][b.id]};c.findTemplate=function(a,b,n){2==arguments.length&&(n=b,b="");var d=n+"/"+b;if(c.templates[d])return c.templates[d];var e;f.ajax({async:!1,url:c.config.urlRoot+"/services/social/templates?resourceType\x3d"+n+"\x26ext\x3dhbs\x26selector\x3d"+b}).done(function(a,b){"success"==
b&&(e=m.compile(a),c.templates[d]=e)});return e};c.log=k;c.registerFieldType=function(a,b){e.isFunction(b.prototype.setValue)?e.isFunction(b.prototype.getValue)?e.isFunction(b.prototype.focus)?e.isFunction(b.prototype.destroy)?this.fieldManagers[a]=b:this.log.error('%s does not implement required method, "destroy"',a):this.log.error('%s does not implement required method, "focus"',a):this.log.error('%s does not implement required method, "getValue"',a):this.log.error('%s does not implement required method, "setValue"',
a)};var b=b.prototype.setValue=b.prototype.getValue=function(){return this.$el.val()};b.prototype.focus=function(){this.$el.focus()};b.prototype.destroy=function(){};c.View.prototype.launchModal=function(a,b,n){var d=f('\x3cdiv class\x3d"scf scf-modal-screen"\x3e\x3c/div\x3e'),l=f('\x3cdiv class\x3d"scf scf-modal-dialog" style\x3d"display:none;"\x3e\x3ch2 class\x3d"scf-modal-header"\x3e'+b+'\x3c/h2\x3e\x3cdiv class\x3d"scf-modal-close" tabindex\x3d"0" role\x3d"button" aria-pressed\x3d"false"\x3eX\x3c/div\x3e\x3c/div\x3e'),
g=a.parent();l.append(a);a.show();b=function(b){c.Util.mayCall(b,"preventDefault")&&b.preventDefault();a.hide();g.append(a);d.remove();l.remove();e.isFunction(n)&&n()};l.find(".scf-modal-close").keypress(function(b){13==b.which&&(c.Util.mayCall(b,"preventDefault")&&b.preventDefault(),a.hide(),g.append(a),d.remove(),l.remove(),e.isFunction(n)&&n())});l.find(".scf-modal-close").click(b);l.find(".scf-js-modal-close").click(b);f("body").append(d);f("body").append(l);var k=(window.innerWidth-l.innerWidth())/
2,m=(window.innerHeight-l.innerHeight())/2;l.css({top:m,left:k});l.show();c.Util.addTabbingInDialog(l);return b};c.View.prototype.overlayTemplate='\x3cdiv class\x3d"scf-overlay"\x3e\x3cdiv class\x3d"scf-overlay-header btn-toolbar"\x3e\x3cbutton class\x3d"btn btn-primary scf-ovelay-back-button" title\x3d"{{i18n "Back"}}"\x3e\x3cspan class\x3d"scf-icon-left"\x3e\x3c/span\x3e\x3c/button\x3e\x3ch3\x3e{{header}}\x3c/h3\x3e\x3c/div\x3e\x3c/div\x3e';c.View.prototype.loadOverlay=function(a,b,c,h){var d=m.compile(this.overlayTemplate),
n=f(d({header:c}));c=function(){n.remove();b.find(".scf-is-overlay-hidden").each(function(){f(this).removeClass("scf-is-overlay-hidden")});h&&e.isFunction(closeCallBack)&&closeCallBack()};b.children().each(;n.append(a);b.append(n);n.find(".scf-ovelay-back-button").click(c);return c};c.View.prototype.errorTemplate="\x3ch3\x3e{{details.status.message}}\x3c/h3\x3e";c.View.prototype.addErrorMessage=function(a,b){var d=m.compile(this.errorTemplate);
a=f(a);b=f(d(b));b.addClass("scf-js-error-message");a.before(b)};c.View.prototype.compileTemplate=c.View.prototype.clearErrorMessages=function(a,b){this.$el.find(".scf-js-error-message").remove();this.$el.find(".scf-error").removeClass("scf-error")};c.ChildView=c.View.extend({bindView:function(){},bindDataForms:function(){},bindDataFields:function(){},bindEvents:function(){},viewName:"ChildView"});c.Util={mayCall:function(a,b){return e.isUndefined(a)||e.isNull(a)?
!1:(a.hasOwnProperty(b)||null!==a[b])&&e.isFunction(a[b])},announce:listenTo:function(a,b){f(document).on(a,},startsWith:getContextPath:function(){var a=CQ.shared.HTTP.getPath(),b=CQ.shared.HTTP.getExtension();return(a=a.split(b))&&void 0!==a?1<a.length?a[1]:a[0]:""},addTabbingInDialog:function(a){a=a.find("select, input, textarea, button, a,div").filter(":visible");
var b=a.first(),c=a.last();b.focus();c.on("keydown",;b.on("keydown",;return close}};window.SCF=c})(Backbone,$CQ,_,Handlebars);
(function(g,f,e,m,c,k){var l=function(b,a,d){var c="";d&&e.log.warn("Forcing resource type is not supported when sling including on the client side");m.ajax({async:!1,url:e.config.urlRoot+b+(a?"."+a+".html":".html")}).done(function(a,b){"success"==b&&(c=a)});return new g.SafeString(c)};g.registerHelper("include",function(b,a){1===arguments.length&&(a=b,b=void 0);var d=a.data.parentView,f=c.isUndefined(a.hash.bind)?!0:a.hash.bind,h=a.hash.view,k=a.hash.template,q=a.hash.resourceType,p=a.hash.path,
m;(m=a.hash.model)||(h?(m=h.lastIndexOf("View"),m=-1!==m?h.substr(0,m)+"Model":h+"Model"):m=void 0);var u;if(c.isObject(b)){q=q||b.resourceType;var t=e.Components[q];c.isUndefined(t)&&q.match(/^(\/apps)|(\/libs)/)&&(t=q.substring(6),t=e.Components[t]);p=b.id;if(!p){var r=b.url;r||(e.log.warn("No resource id found for context: "),e.log.warn(b));r=r.substr(e.config.urlRoot.length);p=r=r.substr(0,r.lastIndexOf(e.constants.URL_EXT))}var v=k?e.findTemplate(p,k,q):e.findTemplate(p,q);h=h?e.Views[h]:d.model.get("resourceType")===
q&&d.model.id===p?e.ChildView:t?t.View:void 0;r=f?h:void 0;var w=m?e.Models[m]:t?t.Model:void 0;w=f?w:void 0;if(!r&&!v){if(p)return l(p,k,q);e.log.error("No view or template found for "+q+" and template "+k);return""}if(!r&&v)return new g.SafeString(v(e.View.prototype.getMergedContexts(b)));if(r&&!v)return e.log.error("No template found for "+q+" and template "+k),"";w&&p?((u=w.findLocal(p))||(u=w.createLocally(b)),u.isNew()&&u.load(p),f=new r({model:u})):f=new r({context:b});k&&v?f.template=v:v&&
(r.prototype.template=v)}else{u=p?"/"===p.slice(0,1):!1;if(!b&&!u)return e.log.error("Must provide context path when including "+q),"";p=u?p:b+"/"+p;q&&(t=e.Components[q]);f&&(t||h&&m)&&(r=t?t.View:e.Views[h],w=t?t.Model:e.Models[m]);if(r&&w)f=0===p.indexOf("http://"),u=w.find(p,void 0,f),f=new r({model:u}),k?f.template=e.findTemplate(p,k,q):"undefined"===typeof f.template&&(e.log.info("Getting default template for "+q),f.template=e.findTemplate(p,q,q));else return l(p,k,q)}f.setParent(d);!r.prototype.template&&
f.template&&r!=e.ChildView&&(r.prototype.template=e.findTemplate(u.get("id"),q));f.templateName=k||"default";f.resource=p;return new g.SafeString("\x3c!-- data-view\x3d'"+f.cid+"'--\x3e")});g.registerHelper("equals",function(b,a,d){if(3>arguments.length)throw Error("Handlebars Helper equal needs 2 parameters");return b!=a?d.inverse(this):d.fn(this)});g.registerHelper("lt",function(b,a){var d=arguments[arguments.length-1];return b<a?d.fn(this):d.inverse(this)});g.registerHelper("lastPath",function(b,
a){a=b.lastIndexOf("/");return b.slice(a+1)});g.registerHelper("getComponentName",;g.registerHelper("pretty-time",function(b,a){if(!b)return"";b=new Date(b);var d=(new Date).getTime()-b.getTime();f.locale(k.shared.I18n.getLocale());a=a.hash.daysCutoff?a.hash.daysCutoff:60;return 6E4>d?(b=Math.round(d/1E3)+"",1==b?new g.SafeString(k.I18n.get("{0} second ago",b)):new g.SafeString(k.I18n.get("{0} seconds ago",b))):36E5>d?(b=Math.round(d/6E4),1==b?new g.SafeString(k.I18n.get("{0} minute ago",
b)):new g.SafeString(k.I18n.get("{0} minutes ago",b))):864E5>d?(b=Math.round(d/36E5),1==b?new g.SafeString(k.I18n.get("{0} hour ago",b)):new g.SafeString(k.I18n.get("{0} hours ago",b))):d<864E5*a?(b=Math.round(d/864E5),1==b?new g.SafeString(k.I18n.get("{0} day ago",b)):new g.SafeString(k.I18n.get("{0} days ago",b))):new g.SafeString(f(b).format(k.I18n.get("MMM DD YYYY, h:mm A",null,"moment.js, communities moderation")))});g.registerHelper("pages",function(b,a){if(b.hasOwnProperty("selectedPage")&&
b.hasOwnProperty("totalPages")&&b.hasOwnProperty("pageSize")&&b.hasOwnProperty("basePageURL")){var d="";if(1>=b.totalPages)return d;var c=Math.abs(b.pageSize),h=b.orderReversed?"-":"",f=b.selectedPage,e=f;0<e-2&&5<b.totalPages?e-=2:2==e&&5<b.totalPages&&(e=1);5>=b.totalPages?e=1:2>b.totalPages-f&&(e=b.totalPages-4);f=e+5;for(f>b.totalPages&&(f=b.totalPages+1);e<f;e++)b.pageNumber=e,b.currentPageUrl=b.basePageURL+"."+(e-1)*c+"."+h+c+".html",b.currentPage=e==b.selectedPage,b.suffix=(e-1)*c+"."+h+c,
d+=a.fn(b);return d}return""});g.registerHelper("loadmore",function(b,a){var d=b.pageInfo,f=b.items;if(!b.totalSize||!d||c.isUndefined(d.selectedPage)||!b.totalSize||!d.pageSize||0>=b.totalSize)return"";b={};b.suffix=d.nextSuffix;var h=this.totalSize;c.isUndefined(f)||(h-=f.length);if(0===h)return"";d=d.nextPageURL;c.isUndefined(d)||-1===d.indexOf(".json",d.length-5)||(d=d.substr(0,d.length-5),d+=".html");b.remaining=h;b.moreURL=d;return a.fn(b)});g.registerHelper("dateUtil",function(b,a){var d=a.hash.format;
a=a.hash.timezone;b=b&&"number"==typeof b?new Date(b):(new Date).getTime();d=d.replace(/y/g,"Y");d=d.replace(/\bdd\b/gi,"DD");d=d.replace(/\bd\b/gi,"D");d=d.replace(/\bEEEE\b/gi,"dddd");f.locale(k.shared.I18n.getLocale());return a&&f.tz?new g.SafeString(f.tz(b,a).format(d)):new g.SafeString(f(b).format(d))});g.registerHelper("i18n",function(b,a){if(1<arguments.length){var d=c.rest(arguments);return k.I18n.get(b,d)}return k.I18n.get(b)});g.registerHelper("xss-htmlAttr",function(b,a){a=m("div");a.attr("data-xss",
b);b=a.attr("data-xss");return k.shared.XSS.getXSSValue(b)});g.registerHelper("xss-jsString",;g.registerHelper("xss-html",function(b,a){return m("\x3cdiv/\x3e").text(b).html()});g.registerHelper("xss-validHref",;g.registerHelper("dom-id",function(b,a){if(!b)return"";b=m.trim(b);b=b.replace(/\./g,"-");b=b.replace(/\//g,"-");return b=b.replace(/:/g,"-")});g.registerHelper("abbreviate",function(b,a){if(!b)return"";var d=
a.hash.maxWords,c=a.hash.maxLength,f=a.hash.safeString,e=m.trim(b);b=e.length;c=e.substring(0,c).split(" ");d=c.slice(0,c.length>d?d:c.length).join(" ");a=b!=d.length&&a.fn?a.fn(this):"";return f?new g.SafeString(d)+a:d+a});g.registerHelper("includeClientLib",function(b,a){return""});g.registerHelper("if-wcm-mode",;g.registerHelper("getContextPath",function(b,a){b="";Granite&&Granite.HTTP.getContextPath()&&(b=Granite.HTTP.getContextPath());return b})})(Handlebars,moment,SCF,
$CQ,_,CQ);
(function(g,f,e,m,c){c=f.View.extend({viewName:"Login",tagName:"div",className:"scf-login",init:function(){this._isReady=!1;this.listenTo(this.model,this.model.events.LOGGED_IN_SUCCESS,this.render);this.listenTo(this.model,this.model.events.LOGGED_OUT,this.render)},loginAction:function(){this.model.get("loggedIn")?(this.$el.children(".login-dialog").hide(),this.logout()):this.$el.children(".login-dialog").toggle().find("input:first").focus()},logout:login:function(){var c=this.getField("username"),
b=this.getField("password");""!==c&&""!==b&&this.model.login(c,b)}});var k=f.Model.extend({moderatorCheckAttribute:"moderatorCheck",events:{LOGGED_IN_SUCCESS:"login:success",LOGGED_IN_FAIL:"login:failed",LOGGED_OUT:"logout:success"},initialize:function(c,b){this._isReady=!1;void 0===m.shared.User.data||null===m.shared.User.data?this.initUser(b):this.getLoggedInUser(b)},defaults:{loggedIn:!1},isReady:checkIfModeratorFor:function(c){var b=this.attributes.hasOwnProperty(this.moderatorCheckAttribute)?
this.attributes[this.moderatorCheckAttribute]:[];return this.attributes.loggedIn&&e.contains(b,c)},checkIfUserCanPost:function(c){var b=this.attributes.hasOwnProperty("mayPost")?this.attributes.mayPost:[];return this.attributes.loggedIn&&e.contains(b,c)},setLanguage:function(c){c=c.preferences&&c.preferences.language?c.preferences.language:"en";m.shared.I18n.setLocale(document.documentElement.lang||c)},initUser:function(c){var b=m.shared.HTTP.externalize("/libs/granite/security/currentuser"+m.shared.HTTP.EXTENSION_JSON+
"?props\x3dpreferences/language");b=m.shared.HTTP.noCaching(b);var a=this;g.ajax({url:b,type:"GET",success:function(b){a.getLoggedInUser(c,b.home);a.setLanguage(b)},async:!1})},getLoggedInUser:function(c,b){var a=this;if(c.hasOwnProperty(k.moderatorCheckAttribute)){var d="?"+k.moderatorCheckAttribute+"\x3d";e.each(c[k.moderatorCheckAttribute],;d=d.substring(0,d.length-1)}var l="";void 0!==b?l=b:(m.shared.User.initialized||m.shared.User.init(),l=m.shared.User.data.home);g.ajax({url:f.config.urlRoot+
"/services/social/getLoggedInUser"+d+"\x26h\x3d"+l,xhrFields:{withCredentials:!0},type:"GET"}).done(function(b){b.name&&(a.set({loggedIn:!0}),a.set(b));a._isReady=!0;"undefined"!==typeof c&&c.silent?a.trigger("model:loaded",{model:a,silent:!0}):a.trigger("model:loaded",{model:a,silent:!1})})},logout:function(){var c=this;g.ajax({url:f.config.urlRoot+"/services/social/logout",xhrFields:{withCredentials:!0},type:"GET"}).always(function(){c.clear();c.trigger(c.events.LOGGED_OUT)})},login:function(c,
b){var a=this;g.ajax({url:f.config.urlRoot+"/libs/login.html/j_security_check",xhrFields:{withCredentials:!0},data:{j_username:c,j_password:b,j_validate:"true"},type:"POST"}).success(function(b,f,e,k){null!==e.getResponseHeader("Set-Cookie")&&""===e.getResponseHeader("Set-Cookie")?this.trigger(this.events.LOGGED_IN_FAIL,{user:c}):(a.getLoggedInUser(),a.trigger(a.events.LOGGED_IN_SUCCESS,{user:c}))})}});k.moderatorCheckAttribute="moderatorCheck";f.LoginView=c;f.LoginModel=k;f.registerComponent("login",
f.LoginModel,f.LoginView)})($CQ,SCF,_,CQ,Granite);
(function(g,f,e,m,c){m=CQ.shared.HTTP.getContextPath();c.events=c.events||{};c.events.BOOTSTRAP_REQUEST="scf-bootstrap-request";c.config.urlRoot=window.location.protocol+"//"+window.location.host;null!==m&&0<m.length&&(c.config.urlRoot+=m);var k=function(a){var b=a.model;if(c.Components[a.type]){var f=a.template?c.findTemplate(a.id,a.template,a.type):c.findTemplate(a.id,a.type),e=new c.Components[a.type].View({model:b,el:a.el});a.template?e.template=f:c.Components[a.type].View.prototype.template=
f;e.templateName=a.template||"default";e.resource=a.id;g.each(c.loadedComponents,function(a){g.each(a,function(a,d){b.attributes.hasOwnProperty("parentId")?d===b.attributes.parentId&&e.setParent(a.view):(void 0===e._parentView||null===e._parentView)&&(d=e.$el.parents("[data-component-id][data-scf-component]"))&&1===d.length&&(a=d.attr("data-component-id"),d=d.attr("data-scf-component"),d=c.loadedComponents[d],void 0!==d&&(a=d[a],void 0!==a&&a.hasOwnProperty("view")&&e.setParent(a.view)))})});b.cacheFixed&&
e.render();a.view=e}},l=function(a){if(c.Components[a.type]){var b=a.modelHolder;var e=c.Components[a.type].Model;if(0<b.length){var h=f(b[0]).text();""===h&&(h=b[0].text);b=f.parseJSON(h);a.id=b.id;(e=e.findLocal(a.id))||(e=c.Components[a.type].Model.createLocally(b))}else(e=e.findLocal(a.id))||(e=c.Components[a.type].Model.find(a.id));a.model=e}},b=function(a){return{id:a.attr("data-component-id"),type:a.data("scf-component"),template:a.data("scf-template"),modelHolder:f("script[type\x3d'application/json'][id\x3d'"+
a.attr("data-component-id")+"']"),el:a}};m=function(){var a=[],d=[];f("[data-scf-component]").each(function(e,f){e=b($(f));c.loadedComponents[e.type]&&c.loadedComponents[e.type][e.id]||d.push(e);a.push(e)});if(0<d.length){var e={silent:!0};e[c.LoginModel.moderatorCheckAttribute]=g.map(a,function(a){if(-1===a.id.indexOf("/content/usergenerated"))return a.id;try{var b=JSON.parse(a.modelHolder.text())}catch(q){return!1}return b.hasOwnProperty("sourceComponentId")&&-1===b.sourceComponentId.indexOf("/content/usergenerated")?
b.sourceComponentId:!1});e[c.LoginModel.moderatorCheckAttribute]=g.compact(e[c.LoginModel.moderatorCheckAttribute]);c.Session?c.Session.getLoggedInUser(e,void 0):(e=new c.LoginModel({},e),c.Session=e)}g.each(d,;g.each(d,function(a){k(a);c.addLoadedComponent(a.type,a.model,a.view)})};f(document).ready(m);e.History.started||e.history.start({pushState:!0,hasChange:!1});$(document).on(c.events.BOOTSTRAP_REQUEST,m);c.addComponent=function(a){a=$(a);if(0===a.length)throw"Could not find requested element on page.";
var d=b(a);if(null===d)throw"Component is already loaded.";if(!d.id)throw"Component does not have a data-component-id attribute, which is required";if(!d.type)throw"Component does not have a data-scf-component attribute, which is required.";var e=d.id;a=d.type;var h=d.template;d=d.el;var g=f("script[type\x3d'application/json'][id\x3d'"+e+"']");h={id:e,type:a,template:h,modelHolder:g,el:d};e=l(h);h=k(h);return c.addLoadedComponent(a,e,h)};c.unloadComponent=function(a,b){if(null===c.loadedComponents[b])throw"Type "+
b+" is not registered with SCF.";var d=c.loadedComponents[b][a];if(null===d||void 0===d)throw"Could not find component with ID: "+a;d.view.destroy();d.model=null;delete c.loadedComponents[b][a]}})(_,$CQ,Backbone,Handlebars,SCF);
(function(g,f,e,m){var c=function(c,g,b,a){a={};a=e.extend(g,a);a=e.extend(this.config,a);g=c.get()[0];if(e.isUndefined(window.CKEDITOR))SCF.log.error('Rich text editor requested but unable to find CKEDITOR please include client library category: "%s" or disable RTE',"ckeditor");else{this.$el=c;var d=this.$el.data("editorheight"),l=SCF.config.urlRoot+b.get("id")+SCF.constants.URL_EXT,h=b.get("configuration");h=h&&h.isAttachmentAllowed;void 0===a.extraPlugins&&(a.extraPlugins=window.CKEDITOR.config.extraPlugins?
window.CKEDITOR.config.extraPlugins+",":void 0);b.attributes&&b.attributes.configuration&&b.attributes.configuration.enableMentions&&(a.extraAllowedContent="a[*]",a.mentions=[{feed:function(a,c){a=a.query;$.ajax({async:!1,url:Granite.HTTP.externalize(window.location.origin+(b.attributes.sourceComponentId?b.attributes.sourceComponentId:b.attributes.id)+'/userlist.social.0.20.json?type\x3dusers\x26filter\x3d[{"operation":"CONTAINS","./@rep:principalName":"'+a+'"},{"operation":"CONTAINS","./@rep:principalName":"'+
a+'*"},{"operation":"CONTAINS","profile/@givenName":"'+a+'*"},{"operation":"CONTAINS","profile/@familyName":"'+a+'*"}]\x26fromPublisher\x3dtrue\x26_charset_\x3dutf-8'),type:"GET",success:function(a){void 0!=a.items&&c(JSON.parse(JSON.stringify(a.items)))}})},minChars:4,itemsLimit:20,itemTemplate:'\x3cli data-id\x3d"{id}"\x3e\x3cimg src\x3d"{avatarUrl}" alt\x3d"{name}"\x3e{name}\x3c/li\x3e',outputTemplate:'\x3ca href \x3d "{friendlyUrl}" class \x3d "social-mention" data-social-mention-authorizableid \x3d "{authorizableId}"\x3e{name}\x3c/a\x3e'}]);
var k=a.toolbar[0].items;"social/journal/components/hbs/journal"===b.get("resourceType")||"social/calendar/components/hbs/calendar"===b.get("resourceType")||"social/ideation/components/hbs/ideation"===b.get("resourceType")||"social/ideation/components/hbs/idea"===b.get("resourceType")||("social/calendar/components/hbs/event"===b.get("resourceType")||"social/journal/components/hbs/entry_topic"===b.get("resourceType"))&&"comment"!==c[0].dataset.rteType?(c=k.indexOf("oembed"),-1===c&&a.toolbar[0].items.push("oembed"),
void 0===a.extraPlugins?a.extraPlugins="oembed":0<a.extraPlugins.length&&-1===a.extraPlugins.indexOf("oembed")&&(a.extraPlugins=a.extraPlugins.concat(",oembed"))):(c=k.indexOf("oembed"),0<c&&k.splice(c,1));h?(a.filebrowserUploadUrl=l,a.uploadUrl=l,c=k.indexOf("Image"),-1===c&&a.toolbar[0].items.push("Image"),void 0===a.extraPlugins?a.extraPlugins="image2,uploadimage":0<a.extraPlugins.length&&-1===a.extraPlugins.indexOf("image2,uploadimage")&&(a.extraPlugins=a.extraPlugins.concat(",image2,uploadimage"))):
(c=k.indexOf("Image"),-1===c&&a.toolbar[0].items.push("Image"),void 0===a.extraPlugins?a.extraPlugins="image2":0<a.extraPlugins.length&&-1===a.extraPlugins.indexOf("image2")&&(a.extraPlugins=a.extraPlugins.concat(",image2")));c=f(g).attr("name");e.isEmpty(c)&&(c=b.get("id"),l=c.lastIndexOf("/"),c=c.slice(l+1),c=f(g).data("attrib")+"-"+c,f(g).attr("name",c));this.$el.data("editorresize")&&(a.resize_enabled=!0);e.isNumber(d)&&(a.height=d);window.CKEDITOR.instances[c]?void 0===this.editor&&(this.editor=
window.CKEDITOR.instances[c]):this.editor=window.CKEDITOR.replace(g,a);this.model=b;h&&(this.editor.on("fileUploadRequest",this.attachFileFromDragAndDrop),this.editor.on("fileUploadResponse",this.handleFileUploadResponse),this.changeImagePluginDialog())}};c.prototype.destroy=function(){if(this.editor)try{this.editor.filter&&this.editor.window&&this.editor.window.getFrame()?(this.editor.destroy(!0),this.editor.removeAllListeners()):(this.editor.removeAllListeners(),window.CKEDITOR.remove(this.editor),
window.CKEDITOR.fire("instanceDestroyed",null,this.editor))}catch(k){SCF.log.error("Couldn't destroy editor: %o",k)}delete this.editor};c.prototype.getFileIFrameFromDialog=function(c){c=c.contents;for(var e=0;e<c.length;e++){var b=c[e];if("Upload"==b.id){b=b.elements;for(var a=0;a<b.length;a++){var d=b[a],f=d.id;"uploadButton"==f&&(d.onClick=this.setCustomFileButtonClick,d["for"]=["Upload","file"]);"upload"==f&&(d.id="file")}}}};c.prototype.setCustomFileButtonClick=function(g){var l=g.sender["for"],
b=g.data.dialog;l=b.getContentElement(l[0],l[1]);var a=f("#"+l.domId+" iframe").contents().find("form");l=e.bind(function(a){a=("object"!==typeof a.response?JSON.parse(a.response):a.response).url;a=CQ.shared.HTTP.encodePath(a);b.getContentElement("info","src").setValue(a);b.selectPage("info");0!==f(".cke_dialog_ui_input_text").length&&f(".cke_dialog_ui_input_text").focus()},this);var d=e.bind(function(a){SCF.log.error("Failed to upload file"+a);alert("Failed to upload file "+a.responseJSON.error.message)},
this),k=a.find("input:file")[0].files;"undefined"!=typeof k&&(a=a.attr("action"),c.prototype.attachFile.call(this,k,a,l,d));g.stop();return!1};c.prototype.handleFileUploadResponse=function(c){c.stop();c=c.data;var e=c.fileLoader.xhr,b=e.responseText;b=JSON.parse(b);"object"!==typeof b.response&&(b.response=JSON.parse(b.response));200==e.status&&(c.uploaded=1,c.url=CQ.shared.HTTP.encodePath(b.response.url),c.name=b.response.properties.name)};c.prototype.attachFileFromDragAndDrop=function(c){var e=
c.data.fileLoader,b=e.xhr,a;window.FormData&&(a=new FormData);a&&(a.append("file",e.file),a.append("id","nobot"),a.append(":operation","social:uploadImage"),a.append("_charset_","UTF-8"),b.open("POST",e.uploadUrl,!0),b.setRequestHeader("Accept","application/json"),b.withCredentials=!0,b.send(a));c.stop()};c.prototype.attachFile=function(c,e,b,a){var d;window.FormData&&(d=new FormData);d&&(f.each(c,,d.append("id","nobot"),d.append(":operation","social:uploadImage"),
d.append("_charset_","UTF-8"),f.ajax(e,{dataType:"json",type:"POST",processData:!1,contentType:!1,xhrFields:{withCredentials:!0},data:d,success:b,error:a}))};c.prototype.changeImagePluginDialog=function(){if(!c.isImageDialogDefinitionChanged){c.isImageDialogDefinitionChanged=!0;var e=this;window.CKEDITOR.on("dialogDefinition",function(c){"image2"==c.data.name&&e.getFileIFrameFromDialog(c.data.definition)})}};c.prototype.config={toolbar:[{name:"basicstyles",items:"Bold Italic Underline NumberedList BulletedList Outdent Indent JustifyLeft JustifyCenter JustifyRight JustifyBlock TextColor".split(" ")}],
autoParagraph:!1,autoUpdateElement:!1,removePlugins:"elementspath",resize_enabled:!1};c.prototype.setValue=c.prototype.getValue=function(){return this.editor.getData()};c.prototype.focus=function(){return this.editor.focus()};c.isImageDialogDefinitionChanged=!1;SCF.registerFieldType("ckeditor",c);SCF.registerFieldType("rte",c)})(Backbone,$CQ,_,Handlebars);
(function(g,f,e,m,c){e=function(e,b,a){this.containerEl=e;var d=f(e).data("tag-filter"),l=f(e).data("tag-limit");f(e).tagit({fieldName:name,allowSpaces:!1,placeholderText:CQ.I18n.getMessage("Add a tag"),animate:!1,minLength:2,removeConfirmation:!0,showAutocompleteOnFocus:!1,tagSource:function(a,b){f.ajax({url:c.config.urlRoot+"/services/tagfilter",data:{term:a.term,tagfilter:d,tagFilterLimit:l,pagePath:CQ.shared.HTTP.getPath(),_charset_:"UTF-8"},dataType:"json",success:)}});g.isEmpty(a.get("tags"))||f.each(a.get("tags"),function(a,b){f(e).tagit("createTag",b.title,b.tagId,b.value)})};e.prototype.getValue=function(){var c=[];f(this.containerEl).find("li").each(function(){var b=$(this).find("input").attr("value");g.isEmpty(b)||c.push(b)});return c};e.prototype.setValue=function(){};e.prototype.focus=function(){f(this.el).focus()};e.prototype.destroy=function(){};var k=function(e,b,a){this.modelTags=a.get("tags");this.templatesSource=
this.defaultTemplates;b&&b.hasOwnProperty("templates")&&(this.templatesSource=g.extend(this.defaultTemplates,b.templates));this.compiledTemplates=function(a){var b={},c;for(c in a)b[c]=m.compile(a[c]);return b}(this.templatesSource);var d=e.get()[0],l=f(d).data("tag-filter");e=f(d).data("tag-limit");var h=k.tagsByFilterVal[l];if(h)this.initTagFields(h,d);else{var x=this;f.ajax({url:c.config.urlRoot+"/services/tagfilter",data:{tagfilter:l,tagFilterLimit:e},dataType:"json",async:!1,success:function(a){h=
a;k.tagsByFilterVal[l]=h;x.initTagFields(h,d)}})}};k.prototype.initTagFields=function(c,b){var a=f(this.compiledTemplates.inputField(c));this.selectedTags={};var d=this;c=f(b);c.after(a);b=c.prop("attributes");f.each(b,;a.removeAttr("data-attrib");var e=f(this.compiledTemplates.tagsContainer(this.modelTags));if(!g.isUndefined(this.modelTags)&&null!==this.modelTags&&this.modelTags.hasOwnProperty("length"))for(b=0;b<this.modelTags.length;b++)this.selectedTags[this.modelTags[b].tagId]=
this.modelTags[b];a.after(e);e.find(".scf-js-remove-tag").click(function(a){a=f(a.target).closest("[data-attrib]");delete d.selectedTags[a.attr("data-attrib")];a.remove()});c.remove();a.change(function(){f(a).find("option:selected").each(function(){var a=f(this).text(),b=f(this).val();f(this).removeAttr("selected");if(!(b in d.selectedTags)){var c=f(d.compiledTemplates.tag({tagid:b,label:a}));e.append(c);d.selectedTags[b]=a;c.find(".scf-js-remove-tag").click(function(){c.remove();delete d.selectedTags[b]})}});
f(f(this).find("option[disabled]")[0]).removeAttr("disabled").attr("selected","selected").attr("disabled","disabled")})};k.prototype.getValue=k.prototype.setValue=function(){if(tags instanceof Array)for(var c;c<tags.length;c++){var b=tags[c];this.selectedTags[b.tagId]=b.title}};k.prototype.focus=function(){f(this.el).focus()};k.prototype.destroy=k.prototype.defaultTemplates={inputField:'\x3cselect size\x3d"1"\x3e\x3coption disabled selected\x3eadd a tag\x3c/option\x3e{{#each this}}\x3coption value\x3d"{{tagid}}"\x3e{{label}}\x3c/option\x3e{{/each}}\x3c/select\x3e',
tagsContainer:'\x3cul class\x3d"scf-horizontal-tag-list"\x3e{{#each this}}\x3cli class\x3d"scf-selected-tag " data-attrib\x3d"{{tagId}}"\x3e\x3cspan class\x3d"scf-js-remove-tag scf-remove-tag"\x3e\x3c/span\x3e {{title}}\x3c/li\x3e{{/each}}\x3c/div\x3e',tag:'\x3cli class\x3d"scf-selected-tag "\x3e\x3cspan class\x3d"scf-js-remove-tag scf-remove-tag"\x3e\x3c/span\x3e {{label}}\x3c/li\x3e'};k.tagsByFilterVal={};c.registerFieldType("tags",k);c.registerFieldType("smarttags",e);c.TagManager=k;c.SmartTagManager=
e})(_,$CQ,Backbone,Handlebars,SCF);
(function(g,f,e,m,c){var k=function(b,a,d){var e=f(b);e.autocomplete({source:function(d,g){d=f(b).val();var h={operation:"CONTAINS","./@rep:principalName":d};h=[h];h.push({operation:"like","profile/@givenName":d});h.push({operation:"like","profile/@familyName":d});h=JSON.stringify(h);f.ajax({url:c.Context.sitePath+"/configuration.social.0.20.json",type:"GET",success:function(b){var c=a+".social.0.20.json";c=CQ.shared.HTTP.addParameter(c,"filter",h);c=CQ.shared.HTTP.addParameter(c,"type","users");
c=CQ.shared.HTTP.addParameter(c,"fromPublisher","true");c=CQ.shared.HTTP.addParameter(c,"_charset_","utf-8");c=CQ.shared.HTTP.addParameter(c,"groupId","community-"+b.siteId+"-members");$.get(c,function(a){a=a.items;e.data("lastQueryResult",a);g(a)})}})},minLength:3,change:function(a,b){d.model.set("composedForValid",d.validateUser(e.val()))},select:function(a,b){d.model.set("composedForValid",!0);f(this).val(b.item.authorizableId);return!1},setvalue:function(a){this.element.val(a);this.input.val(a);
f(this).val(a)}}).data("uiAutocomplete")._renderItem=function(a,b){return b.avatarUrl?f("\x3cli\x3e\x3c/li\x3e").append("\x3ca\x3e\x3cimg src\x3d'"+b.avatarUrl+"' width\x3d'30' height\x3d'30'/\x3e\x26nbsp;"+b.name+"\x3c/a\x3e").data("item.autocomplete",b).appendTo(a):f("\x3cli\x3e\x3c/li\x3e").append("\x3ca\x3e"+b.name+"\x3c/a\x3e").data("item.autocomplete",b).appendTo(a)}};e=function(b,a,c){this.$el=f(b);this.model=c;this.config=a;this.modelId=this.model.get("forumId");g.isEmpty(this.modelId)&&(this.modelId=
this.model.get("id"));k(f(b),this.modelId+"/userlist",this)};var l=function(b,a){for(var c in b)if(b[c].authorizableId===a)return!0;return!1};e.prototype.validateUser=function(b){var a=!1;if(0===b.trim().length)return!0;this.$el.data("lastQueryResult")&&l(this.$el.data("lastQueryResult"),b)&&(a=!0);a||(a=this.searchUsers(b),a=l(a,b));return a};e.prototype.searchUsers=function(b){var a;$.get(this.modelId+"/userlist.social.0.20.json?search\x3d"+b+"\x26showUsers\x3dtrue",;return a=
a||[]};e.prototype.getValue=e.prototype.setValue=function(){this.$el.autocomplete().setValue(this.model.get("author").id)};e.prototype.focus=e.prototype.destroy=function(){(this.$el.data("autocomplete")||this.$el.data("lastQueryResult"))&&this.$el.autocomplete("destroy")};c.registerFieldType("userdropdown",e);c.UserDropDown=e})(_,$CQ,Backbone,Handlebars,SCF);