!function(){var e={87851:function(e,t,o){"use strict";var r=o(9571),n=o(73355);t.Z=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];const s=(0,r.Z)().toString();return(0,n.U)()?new Promise(((e,o)=>{const r=t=>{try{if(t.data){const{data:n}=t,{payload:a}=n;if("PROXY_FETCH_RESPONSE"===n.EVENT_NAME&&a.token===s){if(a.fetchResponseBlob){const t=new Response(a.fetchResponseBlob.stream(),a.fetchResponseProps);e(t)}else a.fetchError?o(a.fetchError):o("Need to handle this");window.removeEventListener("message",r)}}}catch(e){console.log(e)}};window.addEventListener("message",r),(0,n.Z)({EVENT_NAME:"PROXY_FETCH",payload:{fetch:t,token:s}},"*")})):window.fetch(...t)}},73355:function(e,t,o){"use strict";o.d(t,{U:function(){return r}});const r=()=>!!window.BUGHERD_REACT_APP_SIDEBAR_MOUNT&&(window.document.querySelector("#bugherd_embed_communication_frame")||window.BUGHERD_EXTENSION_CONFIG&&window.BUGHERD_EXTENSION_CONFIG.extensionId);t.Z=function(){if(window.BUGHERD_REACT_APP_SIDEBAR_MOUNT){const e=window.document.querySelector("#bugherd_embed_communication_frame");if(e)return void e.contentWindow.postMessage(...arguments)}window.BUGHERD_EXTENSION_CONFIG&&window.BUGHERD_EXTENSION_CONFIG.extensionId?window.postMessage(...arguments):console.error("Couldn't find bugherd_embed_communication_frame iframe or window.BUGHERD_EXTENSION_CONFIG.extensionId to use for postMessage")}},40629:function(e){var t={cmd:"Cmd",ctrl:"Ctrl",alt:"Alt",shift:"Shift",joinWith:" + "},o={},r={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:"Space",36:"Home",33:"Page Up",34:"Page Down",35:"End",37:"Left",38:"Up",39:"Right",40:"Down",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",186:";",187:"=",188:",",189:"-",190:".",192:"`",222:"'"};function n(e){return{character:-1!==[16,17,18,91,93,224].indexOf(e.keyCode)?null:r[e.keyCode]||String.fromCharCode(e.keyCode),modifiers:{cmd:e.metaKey,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey}}}function s(e){return function(e){var t=n(e),r=t.modifiers,s=[];return r.cmd&&s.push(o.cmd),r.ctrl&&s.push(o.ctrl),r.alt&&s.push(o.alt),r.shift&&s.push(o.shift),t.character&&s.push(t.character),s}(e).join(o.joinWith)}e.exports=function(e){return o=Object.assign(t,e),s},e.exports.details=function(e){var t=n(e),o=t.modifiers,r=o.cmd||o.ctrl||o.alt||o.shift;return{hasKey:null!=t.character,hasModifier:r,map:t}}},9571:function(e,t,o){"use strict";var r;o.d(t,{Z:function(){return u}});var n=new Uint8Array(16);function s(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(n)}for(var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,i=[],c=0;c<256;++c)i.push((c+256).toString(16).substr(1));var d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&a.test(e)}(o))throw TypeError("Stringified UUID is invalid");return o},u=function(e,t,o){var r=(e=e||{}).random||(e.rng||s)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){o=o||0;for(var n=0;n<16;++n)t[o+n]=r[n];return t}return d(r)}}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,o),s.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";const e=(e,t,o)=>{o&&e.setAttribute(`data-${t}`,o)};const t=function(){};var r=(()=>{const e=new URLSearchParams(window.location.search).keys(),o=Array.from(e).map((e=>"bugherddebug"===e.toLowerCase())).some((e=>e)),r="true"===window.BugHerdConfig?.debug;return o||r?(console.log("[BUGHERD] BugHerd debug logging is enabled"),function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return console.log("[BUGHERD]",...t)}):t})();const n={default:{width:300,height:80,right:0},warning:{width:330,height:144,right:0}},s=()=>document.getElementById("bugherd_embed_communication_frame");let a=null;const i=(e,t)=>{t&&(a=t);const o=s(),{width:r,height:i,right:c}=n[e];o.style.width=`${r}px`,o.style.height=`${i}px`,o.style.top=function(e){return e?`calc((100% - ${(arguments.length>1&&void 0!==arguments[1]?arguments[1]:70)+10}px) * ${e/100})`:"0px"}(t||a,i),o.style.right=`${c}px`},c=e=>{s().style.display=e?"block":"none"},d=()=>{r("[AUTH] Destroying auth iframe"),window.removeEventListener("bugherd_loaded",d),c(!1),window._bugHerd_sidebar2021=void 0},u={All:!0,"Google Analytics":!1,"Google Analytics 4":!1};var l=o(40629),p=o.n(l);let g=window.location.search.includes("showBugherd=true");const m=(e,t,o)=>{document.addEventListener("keyup",(function(e){const t=document.getElementById("bugherd_embed_communication_frame"),r=p()({})(e);"string"==typeof r&&t&&r===(o||"Cmd + Ctrl + B")&&(t.style.display="block")}));const r=e=>{!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={integrations:{...o.integrations,...u}};window.analytics&&window.analytics.track&&window.analytics.track(e,t,{...r,...o})}("Sidebar displayed",{source:e})},n=document.referrer.includes(t);if(n&&r("app"),g){r("querystring");const e=setTimeout((()=>{const e=new URLSearchParams(window.location.search);e.delete("showBugherd");const t=`${window.location.protocol}//${window.location.host}${window.location.pathname}?${e.toString()}`;window.history.pushState({path:t},"",t)}),1e3);return()=>{clearTimeout(e)}}return!(!n&&!g)},_=(e,t)=>{const o=document.getElementById("bugherd_embed_communication_frame"),r=p()({})(t),n=e.shortcut_to_show_widget||"Cmd + Ctrl + B";"string"==typeof r&&o&&r===n&&(o.style.display="block")},w={hasStorageAccess:void 0,project:null,resources:null},h="hasStorageAccess"in document&&"requestStorageAccess"in document,E=e=>document.requestStorageAccess().then((()=>{e(!0)}),(()=>{e(!1)})),y=()=>document.getElementById("bugherd_toggle"),f=e=>{y().onclick=e},b=(e,t)=>{if(!e)return;e.custom_logo_dark_background&&(document.getElementById("logo").src=e.custom_logo_dark_background);const o=y();if(o?.style){if(e.id){const r=t({projectId:e.id,preference:"togglePosition"});r&&(o.style.transform=`translate(0px, ${r}px)`)}e.toggle_vertical_position&&(o.style.top=`calc((100% - 70px) * ${e.toggle_vertical_position/100})`)}};var S=o(87851).Z;var A=o(9571);const v=e=>{let{projectId:t,preferences:o}=e;try{const e={...JSON.parse(window.localStorage.getItem(`sidebar_project_${t}`)),...o};window.localStorage.setItem(`sidebar_project_${t}`,JSON.stringify(e))}catch(e){console.log("Couldnt save user preferences to local storage",e)}},C=e=>{let{projectId:t,preference:o}=e;try{const e=JSON.parse(window.localStorage.getItem(`sidebar_project_${t}`));if(!e)return;return e[o]}catch(e){console.log("Couldnt get user preferences from local storage",e)}};function T(t){var o=document.createEvent("CustomEvent");if(o.initCustomEvent("bugherdSidebarParsed",!0,!0,JSON.stringify({status:"success",apiKey:t.apiKey})),document.dispatchEvent(o),"loading"===document.readyState)return void document.addEventListener("readystatechange",(e=>{"interactive"===e.target.readyState&&T(t)}));const{resources:r,apiKey:n,origin:s,embeddedByOldExtension:a}=t,{project:i,user:c}=r,d=["app-images","app-vendor",i.is_public&&!i.authenticated?"public":"app"];(t=>{let{apiKey:o,origin:r,project:n,bugsnagSidebarNewKey:s,embeddedByOldExtension:a,files:i,user:c}=t;const d=document.createElement("bugherd-sidebar");d.style.position="static",d.style.display="block",e(d,"projectid",n.id.toString()),e(d,"project",JSON.stringify(n)),e(d,"user",JSON.stringify(c)),e(d,"bugsnagsidebarnewkey",s),e(d,"embeddedByOldExtension",a.toString()),d.addEventListener("keydown",(e=>{e.stopPropagation()})),d.addEventListener("focusin",(e=>{e.stopPropagation()}));const u=d.attachShadow({mode:"open"});u.innerHTML='<div id="sidebar-root"></div>',window.BUGHERD_REACT_APP_SIDEBAR_MOUNT=u.getElementById("sidebar-root"),window.BUGHERD_API_KEY=o,(e=>{let{origin:t,files:o}=e;o.forEach((e=>{const o=document.createElement("script");o.src=`${t.replace("www.","sidebar.")}/clients/sidebar/${e}.1706836797443.js`,window.document.head.appendChild(o)}))})({origin:r,files:i}),document.body.appendChild(d)})({apiKey:n,origin:s,project:i,bugsnagSidebarNewKey:r.config.bugsnag_sidebar_new_key,embeddedByOldExtension:a,files:d,user:c})}let U=(e=>{let{embedUrl:t}=e;try{const e=JSON.parse(window.localStorage.getItem("BugHerd_change_project")||"[]"),o=window.localStorage.getItem("BugHerd_change_project_api_key"),r=new URL(t).search.replace(/^\?/,"").split("&").map((e=>e.split("="))).reduce(((e,t)=>(e[t[0]]=t[1],e)),{apikey:""}),n=r&&r.apikey?r.apikey:null,s=e.find((e=>e.from===n));return s?.to||o||n}catch{return null}})({embedUrl:document?.currentScript?.src||window.embedUrl});window.BUGHERD_EXTENSION_CONFIG?.apiKey&&(U=window.BUGHERD_EXTENSION_CONFIG.apiKey);let N=window.BUGHERD_EXTENSION_CONFIG?.domain||"https://localhost:3000",O="";if(document?.currentScript?.src){const e=new URL(document?.currentScript?.src);N=e.origin,O=e.search}const H=N.replace("www.","sidebar.");if("/sidebar/embed_html"===window.document.location.pathname)(e=>{let{sidebarOrigin:t,apiKey:o}=e;y();const n=(0,A.Z)();let s=!1;window.addEventListener("message",(e=>{if("COOKIE_CHECK"===e.data.eventName)r("[AUTH] Check cookies"),(async(e,t)=>{try{return await(async(e,t)=>{const o=await S(`${e}/sidebar/resources?apikey=${t}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),n=await o.json();return n.project.is_active?n.project.authenticated?(r("[AUTH] _bugherd_session5 cookie valid"),{state:"AUTHENTICATED",resources:n}):(document.cookie.includes("_bugherd_session5")?r("[AUTH] _bugherd_session5 cookie invalid"):r("[AUTH] _bugherd_session5 cookie does not exist"),{state:"UNAUTHENTICATED",resources:n}):(r("[AUTH] Bugherd project disabled"),{state:"PROJECT_DISABLED",resources:n})})(e,t)}catch(e){if(r("[AUTH] _bugherd_session5 ping error"),e instanceof Error)throw e;throw r("[AUTH] unknown error raised",e),new Error("Unknown Error")}})(t,o).then((t=>{let{resources:o,state:a}=t;const{project:i}=o;if("UNAUTHENTICATED"===a)return r("[AUTH] Unauthenticated"),b(i,C),void e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!1,resources:o}},e.origin);if(r("[AUTH] Authenticated"),i.active_task_id&&v({projectId:i.id,preferences:{route:`/sidebar/tasks/${i.active_task_id}`}}),!i.is_active)return e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!1,resources:o}},e.origin);i.has_access?y().className="loading":y().className="noAccess",b(i,C);const c=C({projectId:i.id,preference:"route"});let d=e.data.manuallyAuthenticated;window.sessionStorage.getItem("bugherdSidebarManuallyAuthenticated")&&(d=!0,window.sessionStorage.removeItem("bugherdSidebarManuallyAuthenticated")),c&&"/toggle"!==c||!d||v({projectId:i.id,preferences:{route:"/sidebar"}}),(d||s)&&v({projectId:i.id,preferences:{anonymousUserId:n,route:"/sidebar"}}),e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!0,resources:o}},e.origin)}));else if("AUTH_HAS_STORAGE_ACCESS"===e.data.eventName){r("[AUTH] AUTH_HAS_STORAGE_ACCESS");const t=t=>{e.source.postMessage({eventName:"AUTH_HAS_STORAGE_ACCESS_RESPONSE",payload:{success:t}},e.origin)};if(!h)return t(null);navigator.permissions.query({name:"storage-access"}).then((e=>{if("granted"===e.state)return E(t);document.hasStorageAccess().then((e=>{t(!!e)})).catch((()=>{t(!1)}))})).catch((e=>{"Type error"===e?.message?document.hasStorageAccess().then((e=>{t(!!e)})).catch((()=>{t(!1)})):(r("[AUTH] AUTH_HAS_STORAGE_ACCESS error",e),t(!1))}))}else if("AUTH_REQUEST_STORAGE_ACCESS"===e.data.eventName){let t;r("[AUTH] AUTH_REQUEST_STORAGE_ACCESS");const o=o=>{o||(y().className="error");const r=(new Date).getTime()-t<=250;e.source.postMessage({eventName:"AUTH_REQUEST_STORAGE_ACCESS_RESPONSE",payload:{success:o,isAutoDenied:r,anonymousUserId:n}},e.origin)};f((()=>{t=(new Date).getTime(),E(o),s=!0}))}else"SHOW_UNAUTHENTICATED_UI"===e.data.eventName&&(y().className="",f((()=>{e.source.postMessage({eventName:"AUTH_REDIRECT_TO_LOGIN",payload:{anonymousUserId:n}},e.origin)})))}),!1)})({sidebarOrigin:H,apiKey:U});else{const e=document.getElementsByTagName("bugherd-sidebar")[0],t=document.querySelector('script[src*="sidebarv2"]')&&!document.currentScript?.getAttribute("src").includes("sidebarv2"),o=document.querySelector('script[src*="sidebarv2"]')&&document.currentScript?.getAttribute("src").includes("source=extension");if(e){const t=e.getAttribute("data-projectid");console.warn(`Bugherd: Wanted to embed project with apiKey ${U} but project with id ${t} was already embedded.`)}else if(t)console.warn("Bugherd: Wanted to embed project via new embed code (embed.js) but looks like old embed code exists (sidebarv2.js).");else if(window._bugHerd_sidebar2021)console.warn("Bugherd: Wanted to embed new sidebar but _bugHerd_sidebar2021 was already set");else{if(window._bugHerd_sidebar2021=!0,!U)throw new Error("Bugherd: sidebar is missing apiKey");(e=>{let{origin:t,search:o}=e;return(async e=>{let{origin:t,search:o}=e;try{await new Promise(((e,t)=>{if(document.body)return e(document.body);const o=setTimeout((()=>{t()}),4e3),r=new MutationObserver((function(){document.body&&document.head&&(r.disconnect(),clearTimeout(o),e(document.body))}));r.observe(document.documentElement,{childList:!0})}))}catch(e){return console.error("BugHerd wanted to start but document.body or document.head is null"),null}let r="allow-scripts allow-popups allow-same-origin allow-popups-to-escape-sandbox";"requestStorageAccess"in document&&(r+=" allow-storage-access-by-user-activation");const n=document.createElement("iframe");return n.id="bugherd_embed_communication_frame",n.name="embedCommunication",n.sandbox=r,n.style.display="none",n.style.border="none",n.style.position="fixed",n.style.zIndex="2147483647",n.style.right="0",n.style.height="calc((100% - 154px) * 0.9)",n.src=`${t}/sidebar/embed_html${o}`,document.body.appendChild(n),n})({origin:t,search:o}).then((e=>{if(null===e)throw Error("iFrame wasnt created");return new Promise(((o,n)=>{const s=t.replace("sidebar.","www.");window.addEventListener("bugherd_loaded",d);const a=e=>{let{project:t,resources:r}=e;const n=t.shortcut_to_show_widget;let a=!0;a=m(0,s,n),c(a),i("default",t.toggle_vertical_position),o({authenticated:!0,resources:r})},u=e=>{o({resources:e})};e.onload=()=>{window.addEventListener("message",(o=>((e,t)=>{let{onSuccess:o,onShowPublicFeedback:n,reject:s,iframe:a,origin:u}=t;const l=`${u.replace("sidebar.","www.")}/users/sign_in?source=sidebar&utm_campaign=sidebar&redirect_to=${window.location.href}&anonymous_user_id=${e.data?.payload?.anonymousUserId}`,p=u.replace("sidebar.","www.");if("COOKIE_CHECK_RESPONSE"===e.data.eventName){w.project=e.data.payload.resources.project,w.resources=e.data.payload.resources,g=w.project,document.removeEventListener("keyup",_.bind(null,g)),document.addEventListener("keyup",_.bind(null,g));const t=w.project?.shortcut_to_show_widget,l=window.location.search.includes("showBugherd=true")||document.referrer.includes(p);let h=!0;h=m(0,p,t),w.project.is_active?null===w.project.id?(r("[BUGHERD] There is no project associated with this API Key"),s(),d()):!w.project.is_public||w.project.authenticated||l?!1!==w.hasStorageAccess||w.resources?.project.authenticated?e.data.payload.success&&!w.project.has_access?(c(h),i("warning",w.project.toggle_vertical_position)):e.data.payload.success?(c(h),o(w)):null===w.hasStorageAccess?(i("default",w.project.toggle_vertical_position),c(h)):(a.contentWindow.postMessage({eventName:"SHOW_UNAUTHENTICATED_UI",payload:{origin:u,projectOrigin:window.location.origin}},u),i("warning",w.project.toggle_vertical_position),w.project.authenticated&&c(h)):(i("default",w.project.toggle_vertical_position),c(h),a.contentWindow.postMessage({eventName:"AUTH_REQUEST_STORAGE_ACCESS",payload:{origin:u}},u)):n(w.resources):(r(`[BUGHERD] Project (${w.project.id}) is disabled`),s(),d())}else"AUTH_HAS_STORAGE_ACCESS_RESPONSE"===e.data.eventName?(w.hasStorageAccess=e.data.payload.success,null===e.data.payload.success?(r("[AUTH] hasStorageAccess: no api"),a.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:u}},u)):e.data.payload.success?(r("[AUTH] hasStorageAccess: true"),a.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:u}},u)):(r("[AUTH] hasStorageAccess: false"),a.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:u}},u))):"AUTH_REQUEST_STORAGE_ACCESS_RESPONSE"===e.data.eventName?e.data.payload.success?(w.hasStorageAccess=!0,r("[AUTH] requestStorageAccess: true"),i("default"),a.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:u,manuallyAuthenticated:!0}},u)):(r("[AUTH] requestStorageAccess: false"),i("warning"),e.data.payload.isAutoDenied&&(window.location.href=l)):"AUTH_REDIRECT_TO_LOGIN"===e.data.eventName&&(window.location.href=l);var g})(o,{onSuccess:a,onShowPublicFeedback:u,reject:n,iframe:e,origin:t})),!1),e.contentWindow.postMessage({eventName:"AUTH_HAS_STORAGE_ACCESS",payload:{origin:t}},t)}}))})).catch((()=>{console.error("Cannot initialize BugHerd")}))})({origin:H,search:O}).then((e=>{let{resources:t}=e;T({apiKey:U,origin:N,resources:t,embeddedByOldExtension:o})})).catch((e=>{e&&console.error("[AUTH] Unauthenticated",e)}))}}}()}();
//# sourceMappingURL=embed.1706836797443.js.map;
