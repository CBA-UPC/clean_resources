(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([[5466],{12308:function(e){"undefined"!=typeof self&&self,e.exports=function(e){var t={};eturn r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,(function(t){return e[t]}).bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(e,t,r){"use strict";var i="object"==typeof Reflect?Reflect:null,n=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},o=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise(function(r,i){function n(r){e.removeListener(t,o),i(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&"function"==typeof e.on&&g(e,"error",n,{once:!0})})},(a.EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function f(e,t,r,i){var n,o;return u(r),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,r.listener||r),n=e._events),o=n[t]),void 0===o?(o=n[t]=r,++e._eventsCount):("function"==typeof o?o=n[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),0<(n=l(e))&&o.length>n&&!o.warned&&(o.warned=!0,(i=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",i.emitter=e,i.type=t,i.count=o.length,console)),e}function h(e,t,r){return(t=(function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}).bind(e={fired:!1,wrapFn:void 0,target:e,type:t,listener:r})).listener=r,e.wrapFn=t}function p(e,t,r){var e=e._events;return void 0===e||void 0===(e=e[t])?[]:"function"==typeof e?r?[e.listener||e]:[e]:r?function(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(e):y(e,e.length)}function d(e){var t=this._events;if(void 0!==t){if("function"==typeof(t=t[e]))return 1;if(void 0!==t)return t.length}return 0}function y(e,t){for(var r=Array(t),i=0;i<t;++i)r[i]=e[i];return r}function g(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function n(o){i.once&&e.removeEventListener(t,n),r(o)})}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){if((s=0<t.length?t[0]:s)instanceof Error)throw s;throw(i=Error("Unhandled error."+(s?" ("+s.message+")":""))).context=s,i}var s=o[e];if(void 0===s)return!1;if("function"==typeof s)n(s,this,t);else for(var a=s.length,c=y(s,a),r=0;r<a;++r)n(c[r],this,t);return!0},a.prototype.on=a.prototype.addListener=function(e,t){return f(this,e,t,!1)},a.prototype.prependListener=function(e,t){return f(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},a.prototype.off=a.prototype.removeListener=function(e,t){var r,i,n,o,s;if(u(t),void 0!==(i=this._events)&&void 0!==(r=i[e])){if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,o=r.length-1;0<=o;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,n=o;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}}return this},a.prototype.removeAllListeners=function(e){var t,r=this._events;if(void 0!==r){if(void 0===r.removeListener)0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]);else if(0==arguments.length){for(var i,n=Object.keys(r),o=0;o<n.length;++o)"removeListener"!==(i=n[o])&&this.removeAllListeners(i);this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0}else if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;0<=o;o--)this.removeListener(e,t[o])}return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},a.prototype.listenerCount=d,a.prototype.eventNames=function(){return 0<this._eventsCount?o(this._events):[]}},function(e,t,r){(function(t){e.exports=function(){"use strict";function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self;var i=r(function(e,t){var r,i,n,o,s,a,c,u,l,f,h,p,d;e.exports=r||(i=Math,n=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),a=(s=(o={}).lib={}).Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<n;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-(i+o)%4*8}else for(o=0;o<n;o+=4)t[i+o>>>2]=r[o>>>2];return this.sigBytes+=n,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=i.ceil(t/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,r=[],n=function(e){var t=987654321;return function(){var r=((t=36969*(65535&t)+(t>>16)&4294967295)<<16)+(e=18e3*(65535&e)+(e>>16)&4294967295)&4294967295;return r/=4294967296,(r+=.5)*(i.random()>.5?1:-1)}},o=0;o<e;o+=4){var s=n(4294967296*(t||i.random()));t=987654071*s(),r.push(4294967296*s()|0)}return new c.init(r,e)}}),l=(u=o.enc={}).Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(r,t/2)}},f=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(r,t)}},h=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},p=s.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,r=t.words,n=t.sigBytes,o=this.blockSize,s=n/(4*o),a=(s=e?i.ceil(s):i.max((0|s)-this._minBufferSize,0))*o,u=i.min(4*a,n);if(a){for(var l=0;l<a;l+=o)this._doProcessBlock(r,l);var f=r.splice(0,a);t.sigBytes-=u}return new c.init(f,u)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),s.Hasher=p.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new d.HMAC.init(e,r).finalize(t)}}}),d=o.algo={},o)}),n=r(function(e,t){var r,n,o,s,a,c,u,l,f;e.exports=(r=Math,o=(n=i.lib).WordArray,s=n.Hasher,a=i.algo,c=[],u=[],function(){function e(e){return 4294967296*(e-(0|e))|0}for(var t=2,i=0;i<64;)(function(e){for(var t=r.sqrt(e),i=2;i<=t;i++)if(!(e%i))return!1;return!0})(t)&&(i<8&&(c[i]=e(r.pow(t,.5))),u[i]=e(r.pow(t,1/3)),i++),t++}(),l=[],f=a.SHA256=s.extend({_doReset:function(){this._hash=new o.init(c.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],n=r[1],o=r[2],s=r[3],a=r[4],c=r[5],f=r[6],h=r[7],p=0;p<64;p++){if(p<16)l[p]=0|e[t+p];else{var d=l[p-15],y=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,g=l[p-2],m=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;l[p]=y+l[p-7]+m+l[p-16]}var v=i&n^i&o^n&o,b=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),_=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&f)+u[p]+l[p];h=f,f=c,c=a,a=s+_|0,s=o,o=n,n=i,i=_+(b+v)|0}r[0]=r[0]+i|0,r[1]=r[1]+n|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0,r[5]=r[5]+c|0,r[6]=r[6]+f|0,r[7]=r[7]+h|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=r.floor(i/4294967296),t[15+(n+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA256=s._createHelper(f),i.HmacSHA256=s._createHmacHelper(f),i.SHA256)}),o=(r(function(e,t){var r,n;e.exports=(r=i.lib.Base,n=i.enc.Utf8,void(i.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,c=s.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;o.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))}),r(function(e,t){e.exports=i.HmacSHA256})),s={hmac:function(e,t){return o(t,e)},sha256:function(e){return n(e)}},a=["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id"],c="aws4_request",u=function(e){try{return encodeURIComponent(e).replace(/[^A-Za-z0-9_.~\-%]+/g,escape).replace(/[*]/g,function(e){return"%".concat(e.charCodeAt(0).toString(16).toUpperCase())})}catch(e){return""}},l=function(e){return Object.keys(e).sort().map(function(t){var r=e[t];if(null!=r){var i=u(t);if(i)return Array.isArray(r)?"".concat(i,"=").concat(r.map(u).sort().join("&".concat(i,"="))):"".concat(i,"=").concat(u(r))}}).filter(function(e){return e}).join("&")};return function(){var t,r;function i(e,t,r){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,i),this.request=e,this.request.headers=e.headers||{},this.serviceName=t,r=r||{},this.signatureCache="boolean"!=typeof r.signatureCache||r.signatureCache,this.operation=r.operation,this.signatureVersion=r.signatureVersion}return t=[{key:"addAuthorization",value:function(e,t){var r=this.iso8601(t).replace(/[:\-]|\.\d{3}/g,"");this.addHeaders(e,r),this.request.headers.Authorization=this.authorization(e,r)}},{key:"addHeaders",value:function(e,t){this.request.headers["X-Amz-Date"]=t,e.sessionToken&&(this.request.headers["x-amz-security-token"]=e.sessionToken),this.request.body&&(this.request.headers["X-Amz-Content-Sha256"]=s.sha256(JSON.stringify(this.request.body)).toString())}},{key:"authorization",value:function(e,t){var r=[],i=this.credentialString(t);return r.push("".concat("AWS4-HMAC-SHA256"," Credential=").concat(e.accessKeyId,"/").concat(i)),r.push("SignedHeaders=".concat(this.signedHeaders())),r.push("Signature=".concat(this.signature(e,t))),r.join(", ")}},{key:"signature",value:function(e,t){var r=this.getSigningKey(e,t.substr(0,8),this.request.region,this.serviceName,this.signatureCache);return s.hmac(r,this.stringToSign(t),"hex")}},{key:"stringToSign",value:function(e){var t=[];return t.push("AWS4-HMAC-SHA256"),t.push(e),t.push(this.credentialString(e)),t.push(this.hexEncodedHash(this.canonicalString())),t.join("\n")}},{key:"canonicalString",value:function(){var e=[],t=this.request.pathname||"/";return e.push(this.request.method.toUpperCase()),e.push(t),e.push(l(this.request.params)||""),e.push("".concat(this.canonicalHeaders(),"\n")),e.push(this.signedHeaders()),e.push(this.hexEncodedBodyHash()),e.join("\n")}},{key:"canonicalHeaders",value:function(){var e=this,t=[];Object.keys(this.request.headers).forEach(function(r){t.push([r,e.request.headers[r]])}),t.sort(function(e,t){return e[0].toLowerCase()<t[0].toLowerCase()?-1:1});var r=[];return t.forEach(function(t){var i=t[0].toLowerCase();if(e.isSignableHeader(i)){var n=t[1];if(null==n||"function"!=typeof n.toString)throw Error("Header ".concat(i," contains invalid value"));r.push("".concat(i,":").concat(e.canonicalHeaderValues(n.toString())))}}),r.join("\n")}},{key:"canonicalHeaderValues",value:function(e){return e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")}},{key:"signedHeaders",value:function(){var e=this,t=[];return Object.keys(this.request.headers).forEach(function(r){r=r.toLowerCase(),e.isSignableHeader(r)&&t.push(r)}),t.sort().join(";")}},{key:"credentialString",value:function(e){return this.createScope(e.substr(0,8),this.request.region,this.serviceName)}},{key:"hexEncodedHash",value:function(e){return s.sha256(e)}},{key:"hexEncodedBodyHash",value:function(){return this.request.headers["X-Amz-Content-Sha256"]?this.request.headers["X-Amz-Content-Sha256"]:this.request.body?this.hexEncodedHash(l(this.request.body)):this.hexEncodedHash("")}},{key:"isSignableHeader",value:function(e){return 0===e.toLowerCase().indexOf("x-amz-")||0>a.indexOf(e)}},{key:"iso8601",value:function(e){return void 0===e&&(e=new Date),e.toISOString().replace(/\.\d{3}Z$/,"Z")}},{key:"getSigningKey",value:function(e,t,r,i){var n=s.hmac("AWS4".concat(e.secretAccessKey),t),o=s.hmac(n,r),a=s.hmac(o,i);return s.hmac(a,c)}},{key:"createScope",value:function(e,t,r){return[e.substr(0,8),t,r,c].join("/")}}],e(i.prototype,t),r&&e(i,r),i}()}()}).call(this,r(7))},function(e,t,r){e.exports=function(){return r(8)('!function(t){var n={};function __webpack_require__(r){var e;return(n[r]||(e=n[r]={i:r,l:!1,exports:{}},t[r].call(e.exports,e,e.exports,__webpack_require__),e.l=!0,e)).exports}__webpack_require__.m=t,__webpack_require__.c=n,__webpack_require__.d=function(r,e,t){__webpack_require__.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:t})},__webpack_require__.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},__webpack_require__.t=function(e,r){if(1&r&&(e=__webpack_require__(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(__webpack_require__.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)__webpack_require__.d(t,n,function(r){return e[r]}.bind(null,n));return t},__webpack_require__.n=function(r){var e=r&&r.__esModule?function getDefault(){return r.default}:function getModuleExports(){return r};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=9)}([function(r,e,t){r.exports=function(){var r=r||function(u,t){var n=Object.create||function(){function F(){}return function(r){var e;F.prototype=r;e=new F;F.prototype=null;return e}}();var r={};var e=r.lib={};var i=e.Base=function(){return{extend:function(r){var e=n(this);if(r)e.mixIn(r);if(!e.hasOwnProperty("init")||this.init===e.init)e.init=function(){e.$super.init.apply(this,arguments)};e.init.prototype=e;e.$super=this;return e},create:function(){var r=this.extend();r.init.apply(r,arguments);return r},init:function(){},mixIn:function(r){for(var e in r)if(r.hasOwnProperty(e))this[e]=r[e];if(r.hasOwnProperty("toString"))this.toString=r.toString},clone:function(){return this.init.prototype.extend(this)}}}();var h=e.WordArray=i.extend({init:function(r,e){r=this.words=r||[];if(e!=t)this.sigBytes=e;else this.sigBytes=r.length*4},toString:function(r){return(r||o).stringify(this)},concat:function(r){var e=this.words;var t=r.words;var n=this.sigBytes;var i=r.sigBytes;this.clamp();if(n%4)for(var a=0;a<i;a++){var o=t[a>>>2]>>>24-a%4*8&255;e[n+a>>>2]|=o<<24-(n+a)%4*8}else for(var a=0;a<i;a+=4)e[n+a>>>2]=t[a>>>2];this.sigBytes+=i;return this},clamp:function(){var r=this.words;var e=this.sigBytes;r[e>>>2]&=4294967295<<32-e%4*8;r.length=u.ceil(e/4)},clone:function(){var r=i.clone.call(this);r.words=this.words.slice(0);return r},random:function(r){var e=[];var t=function(e){var e=e;var t=987654321;var n=4294967295;return function(){t=36969*(t&65535)+(t>>16)&n;e=18e3*(e&65535)+(e>>16)&n;var r=(t<<16)+e&n;r/=4294967296;r+=.5;return r*(u.random()>.5?1:-1)}};for(var n=0,i;n<r;n+=4){var a=t((i||u.random())*4294967296);i=a()*987654071;e.push(a()*4294967296|0)}return new h.init(e,r)}});var a=r.enc={};var o=a.Hex={stringify:function(r){var e=r.words;var t=r.sigBytes;var n=[];for(var i=0;i<t;i++){var a=e[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16));n.push((a&15).toString(16))}return n.join("")},parse:function(r){var e=r.length;var t=[];for(var n=0;n<e;n+=2)t[n>>>3]|=parseInt(r.substr(n,2),16)<<24-n%8*4;return new h.init(t,e/2)}};var s=a.Latin1={stringify:function(r){var e=r.words;var t=r.sigBytes;var n=[];for(var i=0;i<t;i++){var a=e[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(r){var e=r.length;var t=[];for(var n=0;n<e;n++)t[n>>>2]|=(r.charCodeAt(n)&255)<<24-n%4*8;return new h.init(t,e)}};var c=a.Utf8={stringify:function(r){try{return decodeURIComponent(escape(s.stringify(r)))}catch(r){throw new Error("Malformed UTF-8 data")}},parse:function(r){return s.parse(unescape(encodeURIComponent(r)))}};var v=e.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new h.init;this._nDataBytes=0},_append:function(r){if(typeof r=="string")r=c.parse(r);this._data.concat(r);this._nDataBytes+=r.sigBytes},_process:function(r){var e=this._data;var t=e.words;var n=e.sigBytes;var i=this.blockSize;var a=i*4;var o=n/a;if(r)o=u.ceil(o);else o=u.max((o|0)-this._minBufferSize,0);var s=o*i;var c=u.min(s*4,n);if(s){for(var v=0;v<s;v+=i)this._doProcessBlock(t,v);var f=t.splice(0,s);e.sigBytes-=c}return new h.init(f,c)},clone:function(){var r=i.clone.call(this);r._data=this._data.clone();return r},_minBufferSize:0});var f=e.Hasher=v.extend({cfg:i.extend(),init:function(r){this.cfg=this.cfg.extend(r);this.reset()},reset:function(){v.reset.call(this);this._doReset()},update:function(r){this._append(r);this._process();return this},finalize:function(r){if(r)this._append(r);var e=this._doFinalize();return e},blockSize:512/32,_createHelper:function(t){return function(r,e){return new t.init(e).finalize(r)}},_createHmacHelper:function(t){return function(r,e){return new p.HMAC.init(t,e).finalize(r)}}});var p=r.algo={};return r}(Math);return r}()},function(r,e,t){r.exports=function(F){F.lib.Cipher||function(o){var r=F;var e=r.lib;var t=e.Base;var c=e.WordArray;var n=e.BufferedBlockAlgorithm;var i=r.enc;var a=i.Utf8;var s=i.Base64;var v=r.algo;var f=v.EvpKDF;var u=e.Cipher=n.extend({cfg:t.extend(),createEncryptor:function(r,e){return this.create(this._ENC_XFORM_MODE,r,e)},createDecryptor:function(r,e){return this.create(this._DEC_XFORM_MODE,r,e)},init:function(r,e,t){this.cfg=this.cfg.extend(t);this._xformMode=r;this._key=e;this.reset()},reset:function(){n.reset.call(this);this._doReset()},process:function(r){this._append(r);return this._process()},finalize:function(r){if(r)this._append(r);var e=this._doFinalize();return e},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(r){if(typeof r=="string")return S;else return m}return function(n){return{encrypt:function(r,e,t){return selectCipherStrategy(e).encrypt(n,r,e,t)},decrypt:function(r,e,t){return selectCipherStrategy(e).decrypt(n,r,e,t)}}}}()});var h=e.StreamCipher=u.extend({_doFinalize:function(){var r=this._process(!!"flush");return r},blockSize:1});var p=r.mode={};var l=e.BlockCipherMode=t.extend({createEncryptor:function(r,e){return this.Encryptor.create(r,e)},createDecryptor:function(r,e){return this.Decryptor.create(r,e)},init:function(r,e){this._cipher=r;this._iv=e}});var _=p.CBC=function(){var r=l.extend();r.Encryptor=r.extend({processBlock:function(r,e){var t=this._cipher;var n=t.blockSize;xorBlock.call(this,r,e,n);t.encryptBlock(r,e);this._prevBlock=r.slice(e,e+n)}});r.Decryptor=r.extend({processBlock:function(r,e){var t=this._cipher;var n=t.blockSize;var i=r.slice(e,e+n);t.decryptBlock(r,e);xorBlock.call(this,r,e,n);this._prevBlock=i}});function xorBlock(r,e,t){var n=this._iv;if(n){var i=n;this._iv=o}else var i=this._prevBlock;for(var a=0;a<t;a++)r[e+a]^=i[a]}return r}();var d=r.pad={};var y=d.Pkcs7={pad:function(r,e){var t=e*4;var n=t-r.sigBytes%t;var i=n<<24|n<<16|n<<8|n;var a=[];for(var o=0;o<n;o+=4)a.push(i);var s=c.create(a,n);r.concat(s)},unpad:function(r){var e=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=e}};var g=e.BlockCipher=u.extend({cfg:u.cfg.extend({mode:_,padding:y}),reset:function(){u.reset.call(this);var r=this.cfg;var e=r.iv;var t=r.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else{var n=t.createDecryptor;this._minBufferSize=1}if(this._mode&&this._mode.__creator==n)this._mode.init(this,e&&e.words);else{this._mode=n.call(t,this,e&&e.words);this._mode.__creator=n}},_doProcessBlock:function(r,e){this._mode.processBlock(r,e)},_doFinalize:function(){var r=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){r.pad(this._data,this.blockSize);var e=this._process(!!"flush")}else{var e=this._process(!!"flush");r.unpad(e)}return e},blockSize:128/32});var k=e.CipherParams=t.extend({init:function(r){this.mixIn(r)},toString:function(r){return(r||this.formatter).stringify(this)}});var x=r.format={};var B=x.OpenSSL={stringify:function(r){var e=r.ciphertext;var t=r.salt;if(t)var n=c.create([1398893684,1701076831]).concat(t).concat(e);else var n=e;return n.toString(s)},parse:function(r){var e=s.parse(r);var t=e.words;if(t[0]==1398893684&&t[1]==1701076831){var n=c.create(t.slice(2,4));t.splice(0,4);e.sigBytes-=16}return k.create({ciphertext:e,salt:n})}};var m=e.SerializableCipher=t.extend({cfg:t.extend({format:B}),encrypt:function(r,e,t,n){n=this.cfg.extend(n);var i=r.createEncryptor(t,n);var a=i.finalize(e);var o=i.cfg;return k.create({ciphertext:a,key:t,iv:o.iv,algorithm:r,mode:o.mode,padding:o.padding,blockSize:r.blockSize,formatter:n.format})},decrypt:function(r,e,t,n){n=this.cfg.extend(n);e=this._parse(e,n.format);var i=r.createDecryptor(t,n).finalize(e.ciphertext);return i},_parse:function(r,e){if(typeof r=="string")return e.parse(r,this);else return r}});var w=r.kdf={};var b=w.OpenSSL={execute:function(r,e,t,n){if(!n)n=c.random(64/8);var i=f.create({keySize:e+t}).compute(r,n);var a=c.create(i.words.slice(e),t*4);i.sigBytes=e*4;return k.create({key:i,iv:a,salt:n})}};var S=e.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:b}),encrypt:function(r,e,t,n){n=this.cfg.extend(n);var i=n.kdf.execute(t,r.keySize,r.ivSize);n.iv=i.iv;var a=m.encrypt.call(this,r,e,i.key,n);a.mixIn(i);return a},decrypt:function(r,e,t,n){n=this.cfg.extend(n);e=this._parse(e,n.format);var i=n.kdf.execute(t,r.keySize,r.ivSize,e.salt);n.iv=i.iv;var a=m.decrypt.call(this,r,e,i.key,n);return a}})}()}(t(0),t(5))},function(r,e,t){r.exports=function(a){return function(){var r=a;var e=r.lib;var t=e.BlockCipher;var n=r.algo;var f=[];var v=[];var u=[];var h=[];var p=[];var l=[];var _=[];var d=[];var y=[];var g=[];(function(){var r=[];for(var e=0;e<256;e++)if(e<128)r[e]=e<<1;else r[e]=e<<1^283;var t=0;var n=0;for(var e=0;e<256;e++){var i=n^n<<1^n<<2^n<<3^n<<4;i=i>>>8^i&255^99;f[t]=i;v[i]=t;var a=r[t];var o=r[a];var s=r[o];var c=r[i]*257^i*16843008;u[t]=c<<24|c>>>8;h[t]=c<<16|c>>>16;p[t]=c<<8|c>>>24;l[t]=c;var c=s*16843009^o*65537^a*257^t*16843008;_[i]=c<<24|c>>>8;d[i]=c<<16|c>>>16;y[i]=c<<8|c>>>24;g[i]=c;if(!t)t=n=1;else{t=a^r[r[r[s^a]]];n^=r[r[n]]}}})();var k=[0,1,2,4,8,16,32,64,128,27,54];var i=n.AES=t.extend({_doReset:function(){if(this._nRounds&&this._keyPriorReset===this._key)return;var r=this._keyPriorReset=this._key;var e=r.words;var t=r.sigBytes/4;var n=this._nRounds=t+6;var i=(n+1)*4;var a=this._keySchedule=[];for(var o=0;o<i;o++)if(o<t)a[o]=e[o];else{var s=a[o-1];if(!(o%t)){s=s<<8|s>>>24;s=f[s>>>24]<<24|f[s>>>16&255]<<16|f[s>>>8&255]<<8|f[s&255];s^=k[o/t|0]<<24}else if(t>6&&o%t==4)s=f[s>>>24]<<24|f[s>>>16&255]<<16|f[s>>>8&255]<<8|f[s&255];a[o]=a[o-t]^s}var c=this._invKeySchedule=[];for(var v=0;v<i;v++){var o=i-v;if(v%4)var s=a[o];else var s=a[o-4];if(v<4||o<=4)c[v]=s;else c[v]=_[f[s>>>24]]^d[f[s>>>16&255]]^y[f[s>>>8&255]]^g[f[s&255]]}},encryptBlock:function(r,e){this._doCryptBlock(r,e,this._keySchedule,u,h,p,l,f)},decryptBlock:function(r,e){var t=r[e+1];r[e+1]=r[e+3];r[e+3]=t;this._doCryptBlock(r,e,this._invKeySchedule,_,d,y,g,v);var t=r[e+1];r[e+1]=r[e+3];r[e+3]=t},_doCryptBlock:function(r,e,t,n,i,a,o,s){var c=this._nRounds;var v=r[e]^t[0];var f=r[e+1]^t[1];var u=r[e+2]^t[2];var h=r[e+3]^t[3];var p=4;for(var l=1;l<c;l++){var _=n[v>>>24]^i[f>>>16&255]^a[u>>>8&255]^o[h&255]^t[p++];var d=n[f>>>24]^i[u>>>16&255]^a[h>>>8&255]^o[v&255]^t[p++];var y=n[u>>>24]^i[h>>>16&255]^a[v>>>8&255]^o[f&255]^t[p++];var g=n[h>>>24]^i[v>>>16&255]^a[f>>>8&255]^o[u&255]^t[p++];v=_;f=d;u=y;h=g}var _=(s[v>>>24]<<24|s[f>>>16&255]<<16|s[u>>>8&255]<<8|s[h&255])^t[p++];var d=(s[f>>>24]<<24|s[u>>>16&255]<<16|s[h>>>8&255]<<8|s[v&255])^t[p++];var y=(s[u>>>24]<<24|s[h>>>16&255]<<16|s[v>>>8&255]<<8|s[f&255])^t[p++];var g=(s[h>>>24]<<24|s[v>>>16&255]<<16|s[f>>>8&255]<<8|s[u&255])^t[p++];r[e]=_;r[e+1]=d;r[e+2]=y;r[e+3]=g},keySize:256/32});r.AES=t._createHelper(i)}(),a.AES}(t(0),(t(10),t(11),t(5),t(1)))},function(r,e,t){r.exports=function(e){return e.mode.ECB=function(){var r=e.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(r,e){this._cipher.encryptBlock(r,e)}});r.Decryptor=r.extend({processBlock:function(r,e){this._cipher.decryptBlock(r,e)}});return r}(),e.mode.ECB}(t(0),t(1))},function(r,e,t){r.exports=function(r){return r.enc.Utf8}(t(0))},function(r,e,t){r.exports=function(o){return function(){var r=o;var e=r.lib;var t=e.Base;var f=e.WordArray;var n=r.algo;var i=n.MD5;var a=n.EvpKDF=t.extend({cfg:t.extend({keySize:128/32,hasher:i,iterations:1}),init:function(r){this.cfg=this.cfg.extend(r)},compute:function(r,e){var t=this.cfg;var n=t.hasher.create();var i=f.create();var a=i.words;var o=t.keySize;var s=t.iterations;while(a.length<o){if(c)n.update(c);var c=n.update(r).finalize(e);n.reset();for(var v=1;v<s;v++){c=n.finalize(c);n.reset()}i.concat(c)}i.sigBytes=o*4;return i}});r.EvpKDF=function(r,e,t){return a.create(t).compute(r,e)}}(),o.EvpKDF}(t(0),(t(12),t(13)))},function(r,e,t){r.exports=function(r){return r.pad.Pkcs7}(t(0),t(1))},function(r,e,t){r.exports=function(r){return r.pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding}(t(0),t(1))},function(r,e,t){r.exports=function(a){return function(){if(typeof ArrayBuffer!="function")return;var r=a;var e=r.lib;var t=e.WordArray;var i=t.init;var n=t.init=function(r){if(r instanceof ArrayBuffer)r=new Uint8Array(r);if(r instanceof Int8Array||typeof Uint8ClampedArray!=="undefined"&&r instanceof Uint8ClampedArray||r instanceof Int16Array||r instanceof Uint16Array||r instanceof Int32Array||r instanceof Uint32Array||r instanceof Float32Array||r instanceof Float64Array)r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);if(r instanceof Uint8Array){var e=r.byteLength;var t=[];for(var n=0;n<e;n++)t[n>>>2]|=r[n]<<24-n%4*8;i.call(this,t,e)}else i.apply(this,arguments)};n.prototype=t}(),a.lib.WordArray}(t(0))},function(r,e,t){"use strict";t.r(e);var e=t(2),o=t.n(e),e=t(3),s=t.n(e),e=t(6),c=t.n(e),e=t(7),v=t.n(e),e=t(8),f=t.n(e),e=t(4),u=t.n(e);function crc32(r,e){for(var t=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],n=("undefined"!=typeof Int32Array&&(t=new Int32Array(t)),-1^~~e),i=(r=new Uint8Array(r)).length,a=0;a<i;a++)n=t[255&(n^r[a])]^n>>>8;return(-1^n)>>>0}function dec2hex(r){if(void 0!==r)return function toEight(r){return r.length<8?toEight(r="0".concat(r)):r}(Number(r).toString(16))}self.onmessage=function(r){var r=r.data,e=r[0],t=r[1],n=r[2],i=r[3],a=r[4],r=r[5];i?(i=f.a.create(e),i=crc32(r=function wordArrayToUint8Array(r){for(var e=r.sigBytes,t=r.words,n=new Uint8Array(e),i=0,a=0;i!==e;){var o=t[a++];if(n[i++]=(4278190080&o)>>>24,i===e)break;if(n[i++]=(16711680&o)>>>16,i===e)break;if(n[i++]=(65280&o)>>>8,i===e)break;n[i++]=255&o}return n}((r&&e.byteLength%16!=0?o.a.encrypt(i,u.a.parse(a),{mode:s.a,padding:c.a}):o.a.encrypt(i,u.a.parse(a),{mode:s.a,padding:v.a})).ciphertext),0),postMessage([r.buffer,dec2hex(i),t,n],[r.buffer])):(a=crc32(e,0),postMessage([e,dec2hex(a),t,n],[e]))}},function(r,e,t){r.exports=function(i){return function(){var r=i;var e=r.lib;var c=e.WordArray;var t=r.enc;var n=t.Base64={stringify:function(r){var e=r.words;var t=r.sigBytes;var n=this._map;r.clamp();var i=[];for(var a=0;a<t;a+=3){var o=e[a>>>2]>>>24-a%4*8&255;var s=e[a+1>>>2]>>>24-(a+1)%4*8&255;var c=e[a+2>>>2]>>>24-(a+2)%4*8&255;var v=o<<16|s<<8|c;for(var f=0;f<4&&a+f*.75<t;f++)i.push(n.charAt(v>>>6*(3-f)&63))}var u=n.charAt(64);if(u)while(i.length%4)i.push(u);return i.join("")},parse:function(r){var e=r.length;var t=this._map;var n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<t.length;i++)n[t.charCodeAt(i)]=i}var a=t.charAt(64);if(a){var o=r.indexOf(a);if(o!==-1)e=o}return parseLoop(r,e,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function parseLoop(r,e,t){var n=[];var i=0;for(var a=0;a<e;a++)if(a%4){var o=t[r.charCodeAt(a-1)]<<a%4*2;var s=t[r.charCodeAt(a)]>>>6-a%4*2;n[i>>>2]|=(o|s)<<24-i%4*8;i++}return c.create(n,i)}}(),i.enc.Base64}(t(0))},function(r,e,t){r.exports=function(o){return function(f){var r=o;var e=r.lib;var t=e.WordArray;var n=e.Hasher;var i=r.algo;var F=[];(function(){for(var r=0;r<64;r++)F[r]=f.abs(f.sin(r+1))*4294967296|0})();var a=i.MD5=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(r,e){for(var t=0;t<16;t++){var n=e+t;var i=r[n];r[n]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360}var a=this._hash.words;var o=r[e+0];var s=r[e+1];var c=r[e+2];var v=r[e+3];var f=r[e+4];var u=r[e+5];var h=r[e+6];var p=r[e+7];var l=r[e+8];var _=r[e+9];var d=r[e+10];var y=r[e+11];var g=r[e+12];var k=r[e+13];var x=r[e+14];var B=r[e+15];var m=a[0];var w=a[1];var b=a[2];var S=a[3];m=FF(m,w,b,S,o,7,F[0]);S=FF(S,m,w,b,s,12,F[1]);b=FF(b,S,m,w,c,17,F[2]);w=FF(w,b,S,m,v,22,F[3]);m=FF(m,w,b,S,f,7,F[4]);S=FF(S,m,w,b,u,12,F[5]);b=FF(b,S,m,w,h,17,F[6]);w=FF(w,b,S,m,p,22,F[7]);m=FF(m,w,b,S,l,7,F[8]);S=FF(S,m,w,b,_,12,F[9]);b=FF(b,S,m,w,d,17,F[10]);w=FF(w,b,S,m,y,22,F[11]);m=FF(m,w,b,S,g,7,F[12]);S=FF(S,m,w,b,k,12,F[13]);b=FF(b,S,m,w,x,17,F[14]);w=FF(w,b,S,m,B,22,F[15]);m=GG(m,w,b,S,s,5,F[16]);S=GG(S,m,w,b,h,9,F[17]);b=GG(b,S,m,w,y,14,F[18]);w=GG(w,b,S,m,o,20,F[19]);m=GG(m,w,b,S,u,5,F[20]);S=GG(S,m,w,b,d,9,F[21]);b=GG(b,S,m,w,B,14,F[22]);w=GG(w,b,S,m,f,20,F[23]);m=GG(m,w,b,S,_,5,F[24]);S=GG(S,m,w,b,x,9,F[25]);b=GG(b,S,m,w,v,14,F[26]);w=GG(w,b,S,m,l,20,F[27]);m=GG(m,w,b,S,k,5,F[28]);S=GG(S,m,w,b,c,9,F[29]);b=GG(b,S,m,w,p,14,F[30]);w=GG(w,b,S,m,g,20,F[31]);m=HH(m,w,b,S,u,4,F[32]);S=HH(S,m,w,b,l,11,F[33]);b=HH(b,S,m,w,y,16,F[34]);w=HH(w,b,S,m,x,23,F[35]);m=HH(m,w,b,S,s,4,F[36]);S=HH(S,m,w,b,f,11,F[37]);b=HH(b,S,m,w,p,16,F[38]);w=HH(w,b,S,m,d,23,F[39]);m=HH(m,w,b,S,k,4,F[40]);S=HH(S,m,w,b,o,11,F[41]);b=HH(b,S,m,w,v,16,F[42]);w=HH(w,b,S,m,h,23,F[43]);m=HH(m,w,b,S,_,4,F[44]);S=HH(S,m,w,b,g,11,F[45]);b=HH(b,S,m,w,B,16,F[46]);w=HH(w,b,S,m,c,23,F[47]);m=II(m,w,b,S,o,6,F[48]);S=II(S,m,w,b,p,10,F[49]);b=II(b,S,m,w,x,15,F[50]);w=II(w,b,S,m,u,21,F[51]);m=II(m,w,b,S,g,6,F[52]);S=II(S,m,w,b,v,10,F[53]);b=II(b,S,m,w,d,15,F[54]);w=II(w,b,S,m,s,21,F[55]);m=II(m,w,b,S,l,6,F[56]);S=II(S,m,w,b,B,10,F[57]);b=II(b,S,m,w,h,15,F[58]);w=II(w,b,S,m,k,21,F[59]);m=II(m,w,b,S,f,6,F[60]);S=II(S,m,w,b,y,10,F[61]);b=II(b,S,m,w,c,15,F[62]);w=II(w,b,S,m,_,21,F[63]);a[0]=a[0]+m|0;a[1]=a[1]+w|0;a[2]=a[2]+b|0;a[3]=a[3]+S|0},_doFinalize:function(){var r=this._data;var e=r.words;var t=this._nDataBytes*8;var n=r.sigBytes*8;e[n>>>5]|=128<<24-n%32;var i=f.floor(t/4294967296);var a=t;e[(n+64>>>9<<4)+15]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360;e[(n+64>>>9<<4)+14]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;r.sigBytes=(e.length+1)*4;this._process();var o=this._hash;var s=o.words;for(var c=0;c<4;c++){var v=s[c];s[c]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}return o},clone:function(){var r=n.clone.call(this);r._hash=this._hash.clone();return r}});function FF(r,e,t,n,i,a,o){var s=r+(e&t|~e&n)+i+o;return(s<<a|s>>>32-a)+e}function GG(r,e,t,n,i,a,o){var s=r+(e&n|t&~n)+i+o;return(s<<a|s>>>32-a)+e}function HH(r,e,t,n,i,a,o){var s=r+(e^t^n)+i+o;return(s<<a|s>>>32-a)+e}function II(r,e,t,n,i,a,o){var s=r+(t^(e|~n))+i+o;return(s<<a|s>>>32-a)+e}r.MD5=n._createHelper(a);r.HmacMD5=n._createHmacHelper(a)}(Math),o.MD5}(t(0))},function(r,e,t){r.exports=function(o){return function(){var r=o;var e=r.lib;var t=e.WordArray;var n=e.Hasher;var i=r.algo;var u=[];var a=i.SHA1=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(r,e){var t=this._hash.words;var n=t[0];var i=t[1];var a=t[2];var o=t[3];var s=t[4];for(var c=0;c<80;c++){if(c<16)u[c]=r[e+c]|0;else{var v=u[c-3]^u[c-8]^u[c-14]^u[c-16];u[c]=v<<1|v>>>31}var f=(n<<5|n>>>27)+s+u[c];if(c<20)f+=(i&a|~i&o)+1518500249;else if(c<40)f+=(i^a^o)+1859775393;else if(c<60)f+=(i&a|i&o|a&o)-1894007588;else f+=(i^a^o)-899497514;s=o;o=a;a=i<<30|i>>>2;i=n;n=f}t[0]=t[0]+n|0;t[1]=t[1]+i|0;t[2]=t[2]+a|0;t[3]=t[3]+o|0;t[4]=t[4]+s|0},_doFinalize:function(){var r=this._data;var e=r.words;var t=this._nDataBytes*8;var n=r.sigBytes*8;e[n>>>5]|=128<<24-n%32;e[(n+64>>>9<<4)+14]=Math.floor(t/4294967296);e[(n+64>>>9<<4)+15]=t;r.sigBytes=e.length*4;this._process();return this._hash},clone:function(){var r=n.clone.call(this);r._hash=this._hash.clone();return r}});r.SHA1=n._createHelper(a);r.HmacSHA1=n._createHmacHelper(a)}(),o.SHA1}(t(0))},function(r,e,t){r.exports=function(o){(function(){var r=o;var e=r.lib;var t=e.Base;var n=r.enc;var v=n.Utf8;var i=r.algo;var a=i.HMAC=t.extend({init:function(r,e){r=this._hasher=new r.init;if(typeof e=="string")e=v.parse(e);var t=r.blockSize;var n=t*4;if(e.sigBytes>n)e=r.finalize(e);e.clamp();var i=this._oKey=e.clone();var a=this._iKey=e.clone();var o=i.words;var s=a.words;for(var c=0;c<t;c++){o[c]^=1549556828;s[c]^=909522486}i.sigBytes=a.sigBytes=n;this.reset()},reset:function(){var r=this._hasher;r.reset();r.update(this._iKey)},update:function(r){this._hasher.update(r);return this},finalize:function(r){var e=this._hasher;var t=e.finalize(r);e.reset();var n=e.finalize(this._oKey.clone().concat(t));return n}})})()}(t(0))}]);',null)}},function(e,t,r){var i,n,o,s,a,c,u,l,f,h,p,d,y;e.exports=y||(i=Math,n=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),a=(s=(o={}).lib={}).Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=a.extend({init:function(e,t){e=this.words=e||[],void 0!=t?this.sigBytes=t:this.sigBytes=4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<n;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-(i+o)%4*8}else for(var o=0;o<n;o+=4)t[i+o>>>2]=r[o>>>2];return this.sigBytes+=n,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=i.ceil(t/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,r=[],n=function(e){var e=e,t=987654321;return function(){var r=((t=36969*(65535&t)+(t>>16)&4294967295)<<16)+(e=18e3*(65535&e)+(e>>16)&4294967295)&4294967295;return r/=4294967296,(r+=.5)*(i.random()>.5?1:-1)}},o=0;o<e;o+=4){var s=n(4294967296*(t||i.random()));t=987654071*s(),r.push(4294967296*s()|0)}return new c.init(r,e)}}),l=(u=o.enc={}).Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(r,t/2)}},f=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(r,t)}},h=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},p=s.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,r=t.words,n=t.sigBytes,o=this.blockSize,s=n/(4*o),a=(s=e?i.ceil(s):i.max((0|s)-this._minBufferSize,0))*o,u=i.min(4*a,n);if(a){for(var l=0;l<a;l+=o)this._doProcessBlock(r,l);var f=r.splice(0,a);t.sigBytes-=u}return new c.init(f,u)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),s.Hasher=p.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new d.HMAC.init(e,r).finalize(t)}}}),d=o.algo={},o)},function(e,t,r){var i;e.exports=(i=r(3),function(e){var t=i.lib,r=t.WordArray,n=t.Hasher,o=i.algo,s=[],a=[];(function(){function t(e){return(e-(0|e))*4294967296|0}for(var r=2,i=0;i<64;)(function(t){for(var r=e.sqrt(t),i=2;i<=r;i++)if(!(t%i))return!1;return!0})(r)&&(i<8&&(s[i]=t(e.pow(r,.5))),a[i]=t(e.pow(r,1/3)),i++),r++})();var c=[],u=o.SHA256=n.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],n=r[1],o=r[2],s=r[3],u=r[4],l=r[5],f=r[6],h=r[7],p=0;p<64;p++){if(p<16)c[p]=0|e[t+p];else{var d=c[p-15],y=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,g=c[p-2],m=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;c[p]=y+c[p-7]+m+c[p-16]}var v=u&l^~u&f,b=i&n^i&o^n&o,_=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),S=h+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+v+a[p]+c[p],w=_+b;h=f,f=l,l=u,u=s+S|0,s=o,o=n,n=i,i=S+w|0}r[0]=r[0]+i|0,r[1]=r[1]+n|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+u|0,r[5]=r[5]+l|0,r[6]=r[6]+f|0,r[7]=r[7]+h|0},_doFinalize:function(){var t=this._data,r=t.words,i=8*this._nDataBytes,n=8*t.sigBytes;return r[n>>>5]|=128<<24-n%32,r[(n+64>>>9<<4)+14]=e.floor(i/4294967296),r[(n+64>>>9<<4)+15]=i,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});i.SHA256=n._createHelper(u),i.HmacSHA256=n._createHmacHelper(u)}(Math),i.SHA256)},function(e,t,r){var i;e.exports=(i=r(3),r(4),r(6),i.HmacSHA256)},function(e,t,r){var i,n,o;e.exports=void(n=(i=r(3)).lib.Base,o=i.enc.Utf8,i.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var n=this._oKey=t.clone(),s=this._iKey=t.clone(),a=n.words,c=s.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;n.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}}))},function(e,t){var r=function(){return this}();try{r=r||Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var i=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(i.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(t)return new Worker(t);throw Error("Inline worker is not supported")}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return rr});var t=r(0),i=r.n(t),n="{tosDomain}/upload/v1/{oid}?uploadid={uploadId}&part_number={part_number}&phase=transfer",o="{tosDomain}/upload/v1/{oid}",s={debug:!1,region:"us-east-1",external:{},getSliceFunc:null,uploadSliceCount:3,retryUploadTime:2,retryProcess:!0,retryProcessTime:3,retryTaskTime:2,progressMonitorTime:10,progressMonitorSpeed:50,schema:"https",enableDiskBreakpoint:!0,replace:{}},a=function(){return(a=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(i=o.next()).done;)s.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return s}(arguments[t]));return e}function u(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)}function l(e){return function(e){if("string"==typeof e){for(var t=[],r=e.split("z"),i=0;i<r.length;i++){var n=64^+parseInt(r[i],25),n=String.fromCharCode(n);t.push(n)}return t.join("")}}(e)}function f(e){var t=document.createElement("a");return t.href=e,t}function h(e){var t={};try{f(e).search.slice(1).split("&").forEach(function(e){var r,i,n=e.split("=");n.length&&(r=n[0],i=n[1]);try{t[r]=decodeURIComponent(void 0===i?"":i)}catch(e){t[r]=i}})}catch(e){}return t}function p(e){for(var t=0,r=0,i=(e+="").length,n=0;n<i;n++)(0x7fffffffffff<(t=31*t+e.charCodeAt(r++))||t<-140737488355328)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t}function d(e,t){try{return x.get(e,{domain:t||document.domain})}catch(e){return""}}unction g(){return(function e(t){return t?(t^16*Math.random()>>t/4).toString(10):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e)})().replace(/-/g,"").slice(0,19)}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function v(e,t,r,i){try{var n=e.match(/\/v\d\//),o=n?n[0]:-1!==e.indexOf("/v1/")?"/v1/":"/v2/",s=e.split(o)[0];s?t.forEach(function(n){var n=function(e){var t,r="";for(t in e)e.hasOwnProperty(t)&&void 0!==e[t]&&(r+="&"+t+"="+encodeURIComponent(JSON.stringify(e[t])));return"&"===r[0]?r.slice(1):r}(n),o=new Image(1,1);o.onload=function(){o=null,r&&r()},o.onerror=function(){o=null,i&&i(e,t,V)},o.src=s+"/gif?"+n}):i(e,t,J)}catch(r){i&&i(e,t,X,r.message)}}var b,_,S,w,k=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var r=this;e&&t&&"function"==typeof t&&this.on(e,function i(n){t(n),r.off(e,i)})},e.prototype.off=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&(t?-1!==(t=this._hooks[e].indexOf(t))&&this._hooks[e].splice(t,1):this._hooks[e]=[])},e.prototype.emit=function(e,t,r){r?e&&(-1!==this._cache.indexOf(r)?this._emit(e,t):(this._hooksCache.hasOwnProperty(r)||(this._hooksCache[r]={}),this._hooksCache[r].hasOwnProperty(e)||(this._hooksCache[r][e]=[]),this._hooksCache[r][e].push(t))):this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&c(this._hooks[e]).forEach(function(e){try{e(t)}catch(e){}})},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),x=(S=+Date.now()+Number((""+Math.random()).slice(2,8)),(t={exports:{}}).exports=),t.exports),O=),C={getItem:function(e){try{var t=localStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(e){}return r||{}}catch(e){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,r)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return d(e,t)},setCookie:function(e,t,r,i){y(e,t,r,i)},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},T={getItem:function(e){try{var t=sessionStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(e){}return r||{}}catch(e){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,r)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return d(e,t)},setCookie:isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},E=function(){function e(e,t){this._storage=t&&"session"===t?T:!e&&C.isSupportLS?C:new O}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,r,i){this._storage.setCookie(e,t,r,i)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),D=function(){function e(e,t,r){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=r}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,r=document.referrer,i=r?f(r).hostname:"",n=h(window.location.href),o=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web",n=(this.utm=function(e,t,r,i){var n=new E(!1),o=new E(!1,"session"),s=e?"_tea_utm_cache_"+e:"_tea_utm_cache",a=e?"_$utm_from_url_"+e:"_$utm_from_url",c={},u=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],l={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var f,h,p=!1;for(f in l)l[f]&&(-1!==u.indexOf(f)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[f]=l[f]):c[f]=l[f],p=!0);p?(o.setItem(a,"1"),n.setCookie(s,JSON.stringify(c),i,r)):(h=n.getCookie(s,r))&&(c=JSON.parse(h)),o.getItem(a)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return l}return c}(this.appid,n,this.domain,this.cookie_expire),this.browser()),s=this.os();return{browser:n.browser,browser_version:n.browser_version,platform:o,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:r,referrer_host:i,utm:this.utm,latest_data:this.last(r,i)}},e.prototype.last=e.prototype.browser=e.prototype.os=function(){for(var e,t="",r="",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<i.length;n++){var o=i[n];if(o.r.test(this.userAgent)){"Mac OS X"===(t=o.s)&&this.isNewIpad()&&(t="iOS");break}}function s(e,t){return(e=e.exec(t))&&e[1]?e[1]:""}function a(e,t){return(e=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t))?e.slice(1)[0]:""}switch(/Windows/.test(t)&&(r=s(/Windows (.*)/,t),t="windows"),t){case"Mac OS X":r=a("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),t="mac";break;case"Android":r=s(/Android ([\.\_\d]+)/,e=this.userAgent)||s(/Android\/([\.\_\d]+)/,e),t="android";break;case"iOS":r=this.isNewIpad()?a("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(r=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?r[1]+"."+r[2]+"."+(0|r[3]):"",t="ios"}return{os_name:t,os_version:r}},e.prototype.getDeviceModel=function(e){var t,r,i="";try{"android"===e?navigator.userAgent.split(";").forEach(function(e){-1<e.indexOf("Build/")&&(i=e.slice(0,e.indexOf("Build/")))}):"ios"!==e&&"mac"!==e&&"windows"!==e||(i=this.isNewIpad()?"iPad":(r=(t=navigator.userAgent.replace("Mozilla/5.0 (","")).indexOf(";"),t.slice(0,r)))}catch(e){}return i.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&1<navigator.maxTouchPoints},e}(),j={sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},P={va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",in:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},I={sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z21z1ez4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",in:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z49z23z21z1cz18z21z22z4ez18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k"},A={sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az23z21z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az23z21z4az22z1gz1iz22z1mz1iz4az1az1mz1k"},z="5.1.2_oversea",R=function(){function e(e,t){this.collector=e,this.config=t,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","_staging_flag"],this.regStr=RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}return e.prototype.checkVerify=function(e){var t,r,i,n=this;return!!(e&&e.length&&(e=e[0])&&(t=e.events,r=e.header,t)&&t.length)&&(i=!0,t.forEach(function(e){e?(n.checkEventName(e.event)||(i=!1,e.checkEvent=" $ or __"),n.checkEventParams(e.params)||(i=!1,e.checkParams=" $ or __")):(i=!1,e.checkEvent="")}),i=!!this.checkEventPa){return!!e&&this.calculate(e,"event")},e.prototype.checkEventParams=function(e){var t=e;if("string"==typeof e&&(t=JSON.parse(t)),Object.keys(t).length)for(var r in t)return!(!this.calculate(r,"params")||"string"==typeof t[r]&&1024<t[r].length);return!0},e.prototype.calculate=function(e,t){return -1!==("event"===t?this.eventNameWhiteList:this.paramsNameWhiteList).indexOf(e)||!RegExp("^\\$").test(e)&&!RegExp("^__").test(e)},e}(),B=((b=ee=ee||{}).Init="init",b.Config="config",b.Start="start",b.Ready="ready",b.TokenComplete="token-complete",b.TokenStorage="token-storage",b.TokenFetch="token-fetch",b.TokenError="token-error",b.ConfigUuid="config-uuid",b.ConfigWebId="config-webid",b.ConfigDomain="config-domain",b.CustomWebId="custom-webid",b.TokenChange="token-change",b.TokenReset="token-reset",b.ConfigTransform="config-transform",b.EnvTransform="env-transform",b.SessionReset="session-reset",b.SessionResetTime="session-reset-time",b.Event="event",b.Events="events",b.EventNow="event-now",b.CleanEvents="clean-events",b.BeconEvent="becon-event",b.SubmitBefore="submit-before",b.SubmitScuess="submit-scuess",b.SubmitAfter="submit-after",b.SubmitError="submit-error",b.SubmitVerify="submit-verify",b.DestoryInstance="destory-instance",b.Stay="stay",b.ResetStay="reset-stay",b.StayReady="stay-ready",b.SetStay="set-stay",b.RouteChange="route-change",b.RouteReady="route-ready",b.Ab="ab",b.AbVar="ab-var",b.AbAllVars="ab-all-vars",b.AbConfig="ab-config",b.AbExternalVersion="ab-external-version",b.AbVersionChangeOn="ab-version-change-on",b.AbVersionChangeOff="ab-version-change-off",b.AbOpenLayer="ab-open-layer",b.AbCloseLayer="ab-close-layer",b.AbReady="ab-ready",b.AbComplete="ab-complete",b.AbTimeout="ab-timeout",b.Profile="profile",b.ProfileSet="profile-set",b.ProfileSetOnce="profile-set-once",b.ProfileUnset="profile-unset",b.ProfileIncrement="profile-increment",b.ProfileAppend="profile-append",b.ProfileClear="profile-clear",b.Autotrack="autotrack",b.AutotrackReady="autotrack-ready",b.CepReady="cep-ready",b.TracerReady="tracer-ready",b.sessionRecord="session-record",b.SessionRecordStart="session-record-start",b.SessionRecordPause="session-record-pause",b.SessionRecordEnd="session-record-end",b.SessionRecordReport="session-record-report",b.VisualCollectReady="visual-collect-ready",b.VisualApiReady="visual-api-ready",b.VisualApiUpdate="visual-api-update",(_=w=w||{}).DEBUGGER_MESSAGE="debugger-message",_.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",_.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",_.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",_.DEBUGGER_MESSAGE_EVENT="debugger-message-event",_.DEVTOOL_WEB_READY="devtool-web-ready",ee),U=void 0,t=(new Date).getTimezoneOffset(),M=parseInt(""+-t/60,10),F=60*t,N=function(){function e(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var r=new D(t.app_id,t.cookie_domain||"",t.cookie_expire||6048e5).init(),e=(this.eventCheck=new R(e,t),"__tea_cache_first_"+t.app_id),t=(this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new E(!1,"session"),this.localStorage=new E(!1,"local"),this.channelUrl="tcpy"===t.channel_type||"ttp"===t.channel_type?{WEBID_URL:"/v1/user/webid",TOB_URL:"",REPORT_URL:"/v1/list"}:{WEBID_URL:"/webid",TOB_URL:"/tobid",REPORT_URL:"/list"},t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage),this.localStorage.getItem(e));t&&1==t?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(e,"1")),this.envInfo={user:{user_unique_id:U,user_type:U,user_id:U,user_is_auth:U,user_is_login:U,device_id:U,web_id:U,ip_addr_id:U,user_unique_id_type:U},header:{app_id:U,app_name:U,app_install_id:U,install_id:U,app_package:U,app_channel:U,app_version:U,ab_version:U,os_name:r.os_name,os_version:r.os_version,device_model:r.device_model,ab_client:U,traffic_type:U,client_ip:U,device_brand:U,os_api:U,access:U,language:r.language,region:U,app_language:U,app_region:U,creative_id:r.utm.creative_id,ad_id:r.utm.ad_id,campaign_id:r.utm.campaign_id,log_type:U,rnd:U,platform:r.platform,sdk_version:z,sdk_lib:"js",province:U,city:U,timezone:M,tz_offset:F,tz_name:U,sim_region:U,carrier:U,resolution:r.screen_width+"x"+r.screen_height,browser:r.browser,browser_version:r.browser_version,referrer:r.referrer,referrer_host:r.referrer_host,width:r.screen_width,height:r.screen_height,screen_width:r.screen_width,screen_height:r.screen_height,utm_term:r.utm.utm_term,utm_content:r.utm.utm_content,utm_source:r.utm.utm_source,utm_medium:r.utm.utm_medium,utm_campaign:r.utm.utm_campaign,tracer_data:JSON.stringify(r.utm.tracer_data),custom:{},wechat_unionid:U,wechat_openid:U}},this.ab_version="",this.ab_uuid_cache={},this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(r),this.initDomain(),this.initABData()}return e.prototype.initDomain=function(e){var t=this.initConfig.channel_domain;t?this.domain=t:(t=e||this.initConfig.channel,e=(this.initConfig&&this.initConfig.channel_type?"tcpy"===this.initConfig.channel_type?I:A:j)[t],t(e){this.customDomain=ain||e&&this.initDomain(e),this.domain},e.prototype.initABData=function(){var e,t="__tea_sdk_ab_version_"+this.initConfig.app_id,r=null;r=this.initConfig.ab_cross?(e=this.localStorage.getCookie(t,this.initConfig.ab_cookie_domain))?JSON.parse(e):null:this.localStorage.getItem(t),this.setAbCache(r)},e.prototype.setAbCache=function(e){this.ab_cache=e},e.prototype.getAbCache=function(){return (){this.ab_cache={},this.ab_version=""},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return thisf(e)&&this.ab_uuid_cache[""ion(e){return this.ab_uuid_cache[""+e]},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.channelUrl.REPORT_URL;break;case"webid":t=this.channelUrl.WEBID_URL;break;case"tobid":t=this.channelUrl.TOB_URL}return e="",this.initConfig.caller&&(e="?sdk_version="+z+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+thisInfo.header.custom[t]nction(e){this.envInfo.header.app_id=e},e.prototype.set=function(e){var t=this;Object.keys(e).forEach(function(r){var i,n,o;void 0!==e[r]&&null!==e[r]||t.delete(r);try{t.eventCheck.calculate(r,"config")}catch(e){}"traffic_type"===r&&t.isLast&&(t.envInfo.header.custom.$latest_traffic_source_type=e[r]),"evtParams"===r?t.evtParams=a({},t.evtParams||{},e.evtParams||{}):"_staging_flag"===r?t.evtParams=a({},t.evtParams||{},{_staging_flag:e._staging_flag}):"reportErrorCallback"===r&&"function"==typeof e[r]?t.reportErrorCallback=e[r]:(o=n="",-1<r.indexOf(".")&&(n=(i=r.split("."))[0],o=i[1]),n?"user"===n||"header"===n?t.envInfo[n][o]=e[r]:t.envInfo.header.custom[o]=e[r]:Object.hasOwnProperty.call(t.envInfo.user,r)?-1<["user_type","ip_addr_id"].indexOf(r)?t.envInfo.user[r]=e[r]&&Number(e[r]):-1<["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(r)?t.envInfo.user[r]=e[r]&&String(e[r]):-1<["user_is_auth","user_is_login"].indexOf(r)?t.envInfo.user[r]=!!e[r]:"device_id"===r&&(t.envInfo.user[r]=e[r]):Object.hasOwnProperty.call(t.envInfo.header,r)?t.envInfo.header[r]=e[r]:t.envInfo.header.custom[r]=e[r])})},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){this.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}},e.prototype.setStore=function(e){try{var t,r;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.keys(e).length&&(r=Object.assign(e,t),this.storage.setItem(this.configKey,r))}catch(e){this.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}},e.prototype.getStore=function(){try{var e;return this.configPersist&&(e=this.storage.getItem(this.configKey)||{},Object.keys(e).length)?e:null}catch(e){return this.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message}),null}},e.prototype.delete=function(e){try{var t;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}},e}(),H=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog},e.prototype.warn=function(e){this.isLog},e.prototype.error=function(e){this.isLog},e.prot Spider","Yisouspider","Googleent)||(r=!1,this.s&&(r=!0)}),r))},e}(),G=function(){function e(e,t){this.collect=e,this.native=t}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&!!AppLogBridge}catch(e){return!1}},t.bridgeReady=function(){var e=this;return new Promise(function(t,r){try{e.bridgeInject()?AppLogBridge.hasStarted(function(e){e?t(!0):r(!1)}):r(!1)}catch(e){r(!1)}})},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e))}catch(e){}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach(function(r){"user_unique_id"===r?t.setUserUniqueId(e[r]):e[r]?t.addHeaderInfo(r,e[r]):t.removeHeaderInfo(r)})}catch(e){}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge",time:Date.now(),data:[{events:[{event:e,params:t}]}],code:200,status:"success"})}catch(e){}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){}},e}(),K=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.eventCheck=new R(e,t),this.cacheStorgae=new E(!0),this.localStorage=new E(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=t.report_url||this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.refer_key="__tea_cache_refer_"+this.configManager.get("app_id"),this.collect.on(B.Ready,function(){r.reportAll(!1)}),this.collect.on(B.ConfigDomain,function(){r.reportUrl=r.configManager.getUrl("event")}),this.collect.on(B.Event,function(e){r.event(e)}),this.collect.on(B.BeconEvent,function(e){r.beconEvent(e)}),this.collect.on(B.CleanEvents,function(){r.reportAll(!1)}),this.linster()},e.prototype.linster=function(){var e,t=this;window.addEventListener("unload",function(){t.reportAll(!0)},!1),e=function(){t.reportAll(!0)},navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&t.reportAll(!0)},!1)}pe:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e){e=c(e,this.cacheStorgae.getItem(this.beconKey)||[]),this.cacheStorgae.setItem(this.beconKey,e),this.collect.destroy||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheSt&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},e.prototype.report=function(e){var t;!this.collect.destroy&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(t=this.cacheStorgae.getItem(this.eventKey)||[]).length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var r=0;r<e.length;r+=this.eventLimit){var i=e.slice(r,r+this.eventLimit),n=this.split(this.routeChange?e.refer_key:this.configManager.get("referrer")}catch(e){t=document.referrer}return t},e.prototype.merge=function(e,t){var r=this,i=this.configManager.get(),n=i.header,o=i.user,s=(n.custom=JSON.stringify(n.custom),n.referrer=this.handleRefer(),this.configManager.get("evtParams")),c=this.configManager.get("user_unique_id_type"),i=e.map(function(e){try{Object.keys(s).length&&!t&&(e.params=a({},s,e.params)),c&&(e.params.$user_unique_id_type=c);var i,n,u=r.configManager.getAbCache(),l=r.configManager.getAbUuidCache(o.user_unique_id);return u&&u.uuid&&u.uuid===o.user_unique_id&&(i=r.configManager.getAbVersion(),r.config.enable_ab_uuid?l&&l.length&&(n=l.join(","),i)&&i.includes(n)&&(e.ab_sdk_version=i):i&&(e.ab_sdk_version=i)),e.session_id=r.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}catch(t){return r.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:t.message}),e}}),e=JSON.parse(JSON.stringify({events:i,user:o,header:n})),i=(e.local_time=Math.floor(Date.now()/1e3),e.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,e.verbose=1,[]);return i.push(e),i},e.prototype.split=function(e){return e.map(function(e){var t=[];return t.push(e),t})},e.prototype.send=function(e,t){var r=this;e.length&&!this.config.disable_track_event&&e.forEach(function(e){try{var i=JSON.parse(JSON.stringify(e)),n=(r.config.filter&&(i=r.config.filter(i)),r.collect.eventFilter&&i&&(i=r.collect.eventFilter(i)),i||e),o=JSON.parse(JSON.stringify(n));r.eventCheck.checkVerify(o),n.length&&(r.collect.emit(B.SubmitBefr.colcollect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:o,code:t,failType:"",status:"fail"})},timeout:r.timeout,useBeacon:!r.config.disable_sendbeacon&&t,withCredentials:r.enable_ttwebid}),r.collect.emit(B.SubmitAfter,n))}catch(e){r.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}})},e}(),q=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new E(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(B.ConfigUuid,function(e){r.setUuid(e)}),this.collect.on(B.ConfigWebId,function(e){r.setWebId(e)}),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e,t=this;this.enableCookie?(e=this.storage.getCookie(this.tokenKey,this.cookieDomain),this.cacheToken=e&&"string"==typeof e?JSON.parse(e):{}):this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(B.CustomWebId,function(){t.tokenReady=!0,t.collect.emit(B.TokenComplete)}):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.=e.indexOf("MiniProgram"GE,{type:w.DEBUGGER_MESSAGE_SDK,info:"WEBID",logType:"fetch",level:"error",time:Date.now(),data:null}),e.collect.logger.warn("appid: "+e.config.app_id+", get webid error, use local webid~")},timeout:3e5})},e.prototype.complete=function(e){var t=e.web_id,r=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:r}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(B.TokenComplete)},e.prototype.completeTtWid=functioken||(this.cacheToken={}),this.cacheToken.user_unique_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(B.TokenChange,"uuid"),this.collect.emit(B.SessionReset))):this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(B.TokenReset))},e.prototype.setWebId=function(e){var t,r;e&&!this.config.enable_ttwebid&&(this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now(),t=this.configManager.get("web_id"),(r=this.configManager.get("user_unique_id"))&&r!==t||(thiable_ttwebid?(this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cob_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},success:function(e){e&&0===e.e?t(e.tobid):t("")},fail:function(){t("")},time:3e4,withCredentials:e.enable_ttwebid}):t("")})},e}(),W=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.storage=new E(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(B.SessionReset,function(){r.resetSessionId()}),this.collect.on(B.SessionResetTime,function(){r.updateSessionIdTime()}))},e.prototype.updateSessionIdTime=function(){var e,t=this.storage.getItem(this.sessionKey);t&&t.sessionId&&(e=t.timestamp,Date.now()-e>this.expireTime?t={sessionId:m(),timestamp:Date.now()}:t.timestamp=Date.now(),this.storage.setItem(this.sessionKey,t),this.resetExpTime())},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:m(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime)},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return!this.disableSession&&e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.resetSessionId=function(){var e={sessionId:m(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:m(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}(),J=4001,V=4e3,X=4002,Q=function(){function e(e,t){this.collector=e,this.config=t,this.requestType=t.request_type||"xhr",this.supportBeacon=!(!window.navigator||!window.navigator.sendBeacon),this.errorCode={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:500h=func=e.data,i=e.method,n=e.success,o=e.fail;window.fetch?fetch(t,{method:i||"POST",headers:{"Content-Type":"application/json; charset=utf-8"}useRequest({url:t,data:r,method:i,success:n,fail:o}))},e.prototype.useBeacon=function(e){var t=e.url,r=e.data,i=e.success,e=e.fail;window.navigator.sendBeacon(t,JSON.stringify(r))?i&&i():e&&e(r,this.errorCode.BEACON_FALSE)},e.prototype.useRequest=function(e){var t=this,r=e.url,i=e.data,n=e.method,o=e.success,s=e.fail,a=e.timeout,c=e.useBeacon,u=e.withCredentials,l=e.app_key,f=e.forceXhr;if(c&&this.supportBeacon)this.useBeacon({url:r,data:i,method:n,success:o,fail:s});else if("fetch"!==this.requestType||f)th.open(p,""+r,!0),h.setRequestHeader("Content-Type","application/json; charset=utf-8"),l&&h.setRequestHeader("X-MCS-AppKey",.ontimeout=function(){s&&s(i,t.errorCode.TIMEOUT)}),h.onload=function(){if(o){var e=null;if(h.responseText){try{e=JSpage_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load())}ret){}},e.prototype.parseUrl=function(){var e={};try{var t=window.location.href.split("?")[1].split("&");t.length&&t.forEach(function(t){t=t.split("="),e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])})}catch(e){}return e},e.prototype.load=function(){try{var e=this.parseUrl();if(e.open_devtool_web&&e.app_id){if(par(),this.setStorage(),the.prototype.getStorage=ftorage=function(){this.car").web_id,e.info[2]..collect.configManager.get("user").web_id),void e.updateInfo();case w.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var r=t.data[0],i=r.events;if(!i.length)return;i.forEach(function(r){r.checkShow=!0,r.searchShow=!0,r.success=t.status,r.type=-1!==e.filterEvent.indexOf(r.event)?"sdk":"cus",r.type=e.collect.bridgeReport?"bridge":r.type,r.info="","fail"===t.status&&(r.info={message:"codrn}})},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",function(t){if(t.origin===location.origin){if(t&&t.data&&"devtool:web:readdy)return;e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t()})}})},e.prototype.sendData=function(e,t){try{(window.opener||window.parent).postMessage({type:e,payload:t},this.devToolOrigin)}catch(e){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),e=(t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: absolute;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n   gger-applog-web" class="debugger-applog-web">AppLog</div>',document.createElement("div"));t.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(e),document.getElementsByTagName("body")[0].appendChild(t),document.getElementById("debugger-applog-web").addEventListener("click",function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)})},e}(),Z={autotrack:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"},retry:{src:{sg:"https://sf16-scmps://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/visual.js"},object:"LogVisual"}},Y=["et","profile","heartbeat","monitor"],ee=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroy=!1,this.sdkReady=!1,this.adapters={},this.loadType="base",this.name=e,this.hook=new k,this.remotePlugin=new Map,this.Types=B,this.adapters.storage=E}return e.usePlugin=function(t,r,i){if(r){for(var n=!1,o=0,s=e.plugins.length;o<s;o++)if(e.plugins[o].name===r){e.plugins[o].plugin=t,e.plugins[o].options=i||{},n=!0;break}n||e.plugins.push({name:r,plugin:t,options:i})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,r){e&&("full"===this.loadType&&Y.includes(e)||(t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:r}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk")))},e.prototype.init=function(t){var r,i=this;try{r=JSON.parse(JSON.stringify(t))}catch(e){r=t}this.logger=new H(this.name,r.log),this.inited?this.logger.warn("[instance: "+this.name+"], every instance's api: init,  can be call only one time!"):r&&u(r)?r.app_id&&"number"==typeof(t=r.app_id)&&!isNaN(t)?r.app_key&&"string"!=typeof r.app_key?this.logger.warn("app_key param is error, must be string, please check!"):(t=r.channel_type&&"tcpy"===r.channel_type?["sg","va","in"]:["sg","va"],r.channel_domain||-1!==t.indexOf(r.channel)||(this.logger.warn("channel must "+t.join(" ,")+"!!!"),r.channel="sg"),this.spider=new L,this.spider.checkSpider(r)?this.logger.warn("The current environment may be a spider, can not report!"):(this.appBridge=new G(this,r.enable_native),this.requestManager=new Q(this,r),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new N(this,r),this.debugger=new $(this,r),this.initConfig=r,this.emit(B.Init),this.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"SDK INIT",data:r,level:"info",time:Date.now()}),r.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.setAppid(r.app_id),this.eventManager=new K,this.tokenManager=new q,this.sessionManager=new W,Promise.all([new Promise(function(e){i.once(B.TokenComplete,function(){e(!0)})}),new Promise(function(e){i.once(B.Start,function(){e(!0)})})]).then(function(){try{e.plugins.reduce(function(e,t){var r=t.plugin,t=t.options,t=Object.assign(i.initConfig,t),r=new r;return r.apply(i,t),e.push(r),e},i.pluginInstances)}catch(e){i.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}i.sdkReady=!0,i.emit(B.Ready),i.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"SDK ",time:Date.now(),level:"info",data:i.configManager.get("user")}),i.logger.info("appid: "+r.sage("[tea-sdk]read:"+JSON.stringify(i.configManager.get("user"))),i.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"SDK ",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})}),i.on(B.TokenReset,function(){i.logger.info("appid: "+r.app_id+" token reset, new userInfo:"+JSON.stringify(i.configManager.get("user"))),i.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"SDK ",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})}),i.on(B.RouteChange,function(e){e.init||r.disable_route_report||i.pageView()})}),this.tokenManager.apply(this,r),this.eventManager.apply(this,r),this.sessionManager.apply(this,r)),this.inited=!0)):this.logger.warn("app_id param is error, must be number, please check!"):this.logger.warn("init params error,please check")},e.prototype.config=function(e){if(this.inited){if(e&&u(e)){var t,r;try{t=JSON.parse(JSON.stringify(t))}catch(r){t=e}this.bridgeReport?this.appBridge.setConfig(t):(t._staging_flag&&1===t._staging_flag&&(this.staging=!0),t.disable_auto_pv&&(this.disableAutoPageView=!0,delete t.disable_auto_pv),e=a({},t),this.initConfig&&this.initConfig.configPersist&&((r=this.configManager.getStore())&&(e=Object.assign(r,t)),this.configManager.setStore(t)),e.web_id,e.user_unique_id,r=function(e,t){var r={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<e.hasOwnProperty("web_id")&&this.emit(B.ConfigWebId,e.web_id),e.hasOwnProperty("user_unique_id")&&this.emit(B.ConfigUuid,e.user_rn("config must be use after function init")},e.prototype.setDomain=function(e){this.cConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.p!this.sended&&(this.sended=!0,this.emit(B.Start),this.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"SDK START",level:"info",time:Date.now()}),this.bridgeReport)&&(this.pageView(),this.emit(B.Ready))},e.prototype.event=function(e,t){var r=this;try{idge.onEventV3(t,JSON.stringify(e))}):i.length&&(this.emit(B.Event,i),this.emit(B.SessionResetTime))}catch(e){this.logger.warn("something error, please check"),this.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e,t){var r;Array.isArray(e)?this.logger.warn("beconEvent not support batch report, please check"):(r=[],(e=this.processEvent(e,t||{}))&&(r.push(e),r.length)&&(this.emit(B.BeconEvent,r),this.emit(B.SessionResetTime)))},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var r,i,n;return e?(/^event\./.test(r=e)&&(r=e.slice(6)),n=void((i="object"!=typeof(i=t)?{}:i).profile?delete i.profile:i.event_index=S+=1),i.local_ms?(n=i.local_ms,delete i.local_ms)me_ms:n,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}):(th(r){return this.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:r.message}),{event:e,params:t}}},e.prototype.filterEvent=function(e){this.eventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,r){this.hook.emit(e,t,r)},e.prototype.rototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){var t;void 0===e&&(e={}),thison.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+(this.configManager&&this.configeview",t)):this.logger.warn("nction(){this.emit(B.CleanEv(B.CustomWebId))},e.prototype.setWebId=function(e){this.config({web_id:")}s.appBridge.setNativeAppId(e)},e.prototype.resetStayDuration=functioit(B.ResetStay,{url_path:e,title:t,url:r},B.Stay)},e.prototype.resetStayParams=function(e,t,r){this.emit(B.SetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:r=void 0===r?"":r},B.Stay)},e.prototype.getToken=function(e,t){var r,i,n,o=this;this.inited?(r=!1,i=function(t){var i;if(!r)return r=!0,i=o.configManager.get().user,t&&(i.tobid=t,i["diss".split("").reverse().join("")]=t),e(a({},i))},n=function(){o.tokenManager.getTobId().then(function(e){i(e)})},this.sdkReady?n():(t&&setTimeout(function(){i()},t),this.on(B.Ready,function(){n()}))):this.logger.warn("predefinePageView should call after init")},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(B.ProfileSet,e,B.Profile),this.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"SDK profileSet",level:"info",time:Date.now(),data:e})},e.prototype.profile:"info",time:Date.now(),daIncrement",level:"info",time:DatefileUnset(e):this.e_SDK,info:"SDK proofileAppend=function(e){thisgify(e)):this.emit(B.ProfileAppentime:Date.now(),data:e})},e.prototype.setExternalAbVersion=function(e){this.emit(B.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,B.Ab)},e.prototype.getVar=function(e,t,r,ilback:r,uuid:i},B.Ab)},emit(B.AbConfig,{params:e,callback:t},B.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(B.AbVersionChangeOn,e,B.Ab),function(){t.emit(B.AbVersionChangeOff,e,B.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(B.AbVersionChangeOff,e,B.Ab)},e.prototype.openOverlayer=function(){this.emit(B.AbOpenLayer,"",B.Ab)},e.prototype.closeOverlayer=function(){this.emit(B.AbCloseLayer,"",B.Ab)},e.prototype.getAllVars=function(e){this.emit(B.AbAllVars,e,B.Ab)},e.prototype.autoInitializationRangers=function(e){var t=e.app_id,r=e.channel,i=e.onTokenReady,e=j[r]+"/webid",n=new E(!1),o="__tea_cache_tokens_"+t;(r=n.getItem(o))&&r.web_id?i(r.web_id):function(e,t,r,i,n,o,s,a){var c=window.navigator.userAgent;if(-1===window.navigrosoft InteSIE 8.0")&&-1===c.indexOf("MSIE 9.0")){if(s)return window.navigator&&window.navigator.sendBeacon?window.navigator.sendBeacon(e,JSON.stringify(t))?n():o(e,t,4003):v(e,t,n,o)}else v(e,t,n,o);!function(e,t,r,i,n,o,s){try{var a=new XMLHttpRequest;a.open("POST",""+e,!0),a.setRequestHeader("Content-Type","application/json; charset=utf-8"),i&&(a.withCredentials=!0),a.onload=function(){if(n){var e=null;if(a.responseText){try{e=JSON.parse(a.responseText)}catch(t){e={}}n(e,t)}}},r&&(a.timeoa.send(JSON.stringify(t))}catch(e){}}(e,t,3e3,i,n,o,void 0)}(e,{app_key:"",app_id:t,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},0,!1,function(e){e&&0===e.e?(i(e.web_id),e={web_id:e.web_id,user_uniquenction(){i("")},!0)},e.prototype.destoryInstace=function(){this.destroy||(this.destroy=!0,this.off(B.TokenComplete),this.emit(B.DestoryInstance))},e.prototype.destroyInstance=function(){this.destroy||(this.destroy=!0,this.off(B.TokenComplete),this.emit(B.DestoryInstance))},e.plugins=[],e}(),t=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;t.event_verify_url&&"string"==typeof t.event_verify_url&&(this.url=t.event_verify_url+"/v1/list_test",this.url&&(t=e.Types,e.on(t.SubmitBefore,function(t){e.requestManager.useBeacon({url:r.url,data:t})})))},e}(),et=function(){functiope.apply=function(e,t){var r=this,i=(this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list",e.Types);this.eventCheck=new R(e,t),this.cache={},this.collect.on(i.Profil){r.setOnceProfile(e)}),this.collect.on(i.ProfileUnset,function(e){r.unsetProfile(e)}),this.collect.on(i.ProfileIncrement,function(e){r.incrementProfile(e)}),this.collect.on(i.ProfileAppend,function(e){r.appendProfile(e)}),this.collect.on(i.ProfileClear,function(){r.cache={}}),this.ready(i.Profile)},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(Object.keys(r).length)for(var i in r)!function(e){r[e].length&&r[e].forEach(function(r){t.collect.hook.emit(e,r)})}(i)}},e.prototype.report=function(e,t){void 0===t&&(t={});try{var r,i;this.config.disable_track_event||((r=[]).push(this.collect.processEvent(e,t)),i=this.collect.eventManager.merge(r),this.collect.requestManager.useRequest({url:this.reportUrl,data:i}),this.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:i,code:200,status:"success"}))}catch(e){this.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}},e.prototype.setProfile=function(e){(e=this.formatParams(e))&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set",a({},e,{profile:!0})))},e.prototype.setOnceProfile=function(e){(e=this.forma},e.prototype.incrementProfile=function(e){e&&this.report("__profile_increment",a({},e,{profile:!0}))},e.prototype.unsetProfile=function(e){var t;e&&((t={})[e]="1",this.report("__profile_unset",a({},t,{profile:!0})))},e.prototype.appendProfile=function(e){if(e){var t,r={};for(t in e)("string"==typeof e[t]||"Array"===Object.prototype.toString.call(e[t]).slice(8,-1))&&(r[t]=e[shCache=(e).forEach(function(r){t.cache[r]={val:t.clone(e[r]),timestamp:Date.now()}})},e.prototype.formatParams=function(e,t){var r=this;void 0===t&&(t=!1);try{if(e&&"[obys(n);if(s.length&],e},{})}}catch(e){this.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}},e.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return this.collect.emit(w.DEBUGGER_MESSAGE,{type:e.nction(e){try{return ect.emit(w.DEBUGGER_MESSAi,n;e.clearIntervalFunc=(t=fun),function(){window.erval(),e=this.collect.Types,this.collect.on(e.SessionReset,function(){r.process()}))},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvs.isSessionhasEvent=!0,th.on(t.SubmitError,funr i=e[0],n=i.user,o=i.header,s=[],a=(e.forEach(function(e){e.events.forEach(function(e){s.push(e)})}),{events:s.map(function(e){return{event:"on_error",params:JSON.stringal_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(o),user:JSON.stringify(n)}),local_time_ms:Date.now()}}),user:{user_unique_id:n.user_unique_id},header:{}});setTimeout(function(){r.collect.requestManager.useRequest({url:r.url,data:[a],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(e){}},e}(),en="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,eo=function(){function e(){}return e.prototype.n={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach(function(t,r){var i,n;"sdk"===t?Z.hasOwnProperty(r)&&(i=Z[r].object,n=""+Z[r].src[e.channel],e.exist(r,i,n)):"object"==typeof t&&(t.src?e.excollect,this.config):t&&t(this.collect,this.config)}catch(e){this.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}},e.prototype.loadPlugin=function(e,t,r,i){var n=this;try{var o=document.createElement("script");o.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(r),o.onerror=function(){i(t)},o.onload=function(){n._plugin[e].forEach(function(e){e()})},document.getElementsByTagName("head")[0].appendChild(o)}catch(e){this.collect.emit(w.DEBUGGER_MESSAGE,{type:w.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}},e}(),eo=(ee.usePlugin(eo,"extend"),ee.usePlugin(t,"et"),ee.usePlugin(et,"profile"),ee.usePlugin(er,"heartbeat"),ee.usePlugin(ei,"monitor"),new ee("default")),es=eo,ea={selectRoute:900,browserError:1e3,crc32:1e3,preUpload:1001,initUploadID:1002,process:1003,fileMerge:1004,complete:1005},ec="video",eu="image",el="object",ef={video:"video_upload",image:"image_upload",object:"object_upload"},eh="imagex";function ep(e){return(ep="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ed(){return(ed=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function ey(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!==ep(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==ep(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"===ep(i)?i:String(i)),n)}}var eg=function(){var e,t;function r(e,t){switch(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this.options=e,this.context=t,this.teaLog=es,this.options.region){case"us-east-1":case"us-east-2":case"us-east-5":case"us-east-red":case"gcp":case"US-TTP":default:this.tea_app_id=2643,this.tea_channel="va";break;case"boei18n":case"ap-singapore-1":this.tea_app_id=2643,this.tea_channel="sg"}this.teaLog.init({app_id:this.tea_app_id,channel:this.tea_channel,log:!1,disable_sdk_monitor:!0,disable_auto_pv:!0}),this.teaLog.config({evtParams:{sdk_version:"2.0.6",line_app_id:this.options.appId},user_unique_id:this.options.userId}),this.teaLog.start()}return e=[{key:"send",value:function(e){var t=this.context,r=e.key,t=t.tasks[r],i=ea[e.stage]||999,t=e.fileType||t&&t.fileType,n=e.fileSize||0,o={log_type:ef[t],stage:i,fk:r,fs:n,req:e.req,res:e.res,ts:Math.round(Date.now()/1e3),sst:e.stageStartTime,set:e.stageEndTime,dur:e.duration,tdur:e.totalDuration,durs:e.duration/1e3,tdurs:e.totalDuration/1e3,eslr:e.enableSelectRoute,ucsrr:e.useClientSelectRouteResult,skipCommit:!!e.skipCommit},r=e.type,r="error"===r||"retry"===r?r:i,s="".concat("image"===t?"image":"video","_")+r;switch(i){case 1e3:this.teaLog.event(s,ed({},o,{type:e.type,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,crc32Array:e.crc32Array,isDirect:e.isDirect})}));break;case 1001:this.teaLog.event(s,ed({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,err:e.extra&&e.extra.error,msg:e.extra&&e.extra.message,sig:e.signature,stk:e.proxyStsToken})}));break;case 1002:this.teaLog.event(s,ed({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,upid:e.uploadID})}));break;case 1003:e.isAllFinish||e.isDirect||(delete o.sst,delete o.set,delete o.dur),this.teaLog.event(s,ed({},o,{type:e.type,oid:e.oid,errc:e.extra&&e.extra.errorCode,upload_host:e.tosDomain,af:e.isAllFinish,cst:e.crc32StartTime,cet:e.crc32EndTime,cdur:e.crc32Duration,slst:e.sliceStartTime,slet:e.sliceEndTime,sldurs:e.sliceDuration&&e.sliceDuration/1e3,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,si:e.sliceIndex,af:e.isAllFinish})}));break;case 1004:default:this.teaLog.event(s,ed({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message})}));break;case 1005:this.teaLog.event(s,ed({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,speed:Math.round(n/(e.totalDuration/1e3)/1024),ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,err:e.extra&&e.extra.error,msg:e.extra&&e.extra.message,vid:e.uploadResult&&e.uploadResult.Vid})}));break;case 900:this.teaLog.event(s,ed({},o,{type:e.type,errc:e.extra&&e.extra.errorCode,race_info:e.raceInfo,client_ip:e.lastClientIp,uc:e.useCache,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,err:e.extra&&e.extra.error,msg:e.extra&&e.extra.message})}))}}},{key:"console",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){this.options.debug})}],ey(r.prototype,e),t&&ey(r,t),Object.defineProperty(r,"prototype",{wrString:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map(function(t){return"".concat(t,"=").concat(encodeURIComponent(e[t]))}).join("&")},supportChunked:function(){var e=window.Blob||window.WebKitBlob;try{var t=e.prototype;return!(!FormData||!(t.slice||t.webkitSlice||t.mozSlice))}catch(e){return!1}},supportXhr:function(){return!!window.FormData||window.ProgressEvent&&window.FileReader},supportCrc32:function(){var e=window.FileReader&&window.FileReader.prototype.readAsBinaryString;return"undefined"!=typeof Int32Array&&e&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice)},storage:function(e){var t=e,e={removeItem:function(e){delete t.cache[e]},setItem:function(e,r){t.cache[e]=r},getItem:function(e){return t.cache[e]},clear:function(){delete t.cache,t.cache={}}};if(!(1<arguments.length&&void 0!==arguments[1])||arguments[1])try{if(window.localStorage)return window.localStorage.setItem("",""),window.localStorage}catch(e){}return e},noop:function(){},getUnique:function(e){return"".concat(e,"_").concat((new Date).getTime(),"_").concat(parseInt(1e6*Math.random()))},getFileSliceLength:function(e,t){var r=e.size;return t&&"function"==typeof t?2097152>t(r)?2097152:t(r)||r:209715200<r?10485760:r<=209715200&&2097152<=r?5242880:e.size},getFileSuffix:function(e){if(e&&"[object String]"===Object.prototype.toString.call(e)){var t=e.lastIndexOf(".");if(0<t&&(e="."+e.substring(t+1)).length<=8)return e}},fileSlice:function(e,t,r){return(e.slice||e.webkitSlice||e.mozSlice).call(e,t,r)},getPathByURL:function(e){return/^(?:(https?\:)\/\/)?(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/.exec(e)[5]||"/"},crypto:{hmac:function(e,t){return em()(t,e)},sha256:function(e){return ev()(e)}},date:{iso8601:function(e){return(e=void 0===e?eb.date.getDate():e).toISOString().replace(/\.\d{3}Z$/,"Z")}},Buffer:Uint8Array,generateKey:function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=r.length,n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*i));return t}};function e_(e){return(e_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eS(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!==e_(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==e_(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"===e_(i)?i:String(i)),n)}}function ew(e,t){return(ew=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function ek(e){return(ek=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ex=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ew(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=ek(o);return function(e,t){if(t&&("object"===e_(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=ek(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(){var e;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(e=n.call(this)).xhr=new XMLHttpRequest,e._data=null,e}return t=[{key:"_ajax",value:function(e){var t=this,r=this.xhr;r.upload.onprogress=function(e){t.emit("progress",e)},r.onreadystatechange=function(i){4===r.readyState&&(r.upload.onprogress=eb.noop,r.onreadystatechange=eb.noop,r.params=e,t._data&&t._data.url&&(r.currentUrl=t._data.url),200<=r.status&&r.status<300?t.emit("complete",r):400<=r.status&&t.emit("error",r))},r.onerror=function(){r.errText="unknow net error",t.emit("error",r)},r.ontimeout=function(){r.errText="timeout",t.emit("error",r)},r.onabort=function(){r.errText="abort",t.emit("error",r)},r.send(e)}},{key:"send",value:function(e){var t=this;return this._data=e,this.xhr.open(e.method||"POST",e.url||"",!0),e.headers&&Object.keys(e.headers).forEach(function(r){t.xhr.setRequestHeader(r,e.headers[r])}),this.xhr.timeout=e.timeout||0,e.ontimeout&&(this.xhr.ontimeout=e.ontimeout),e.binary?this.sendAsBinary(e):e.custom?"object"===e_(e.custom)?this.sendAsCustom(JSON.stringify(e.custom)):"none"===e.custom?(delete e.custom,this.sendAsCustom()):this.sendAsCustom(e.custom):this.sendAsFormData(e)}},{key:"sendAsBinary",value:function(e){return this.xhr.setRequestHeader("Content-Type","application/octet-stream"),this.xhr.setRequestHeader("Content-Disposition",'attachment; filename="'.concat(encodeURI(e.filename),'"')),this._ajax(e.file)}},{key:"sendAsFormData",value:function(e){t=(t=e.formData?"function"==typeof e.formData?e.formData():e.formData:t)||[];for(var t,r=new FormData,i=0,n=t.length;i<n;i++){var o=r[i];r.append(o.name,o.value)}return e.file&&r.append(e.field,e.file,e.name),this._ajax(r)}},{key:"sendAsCustom",value:function(e){return this._ajax(e)}},{key:"abort",value:function(){this.xhr.onreadystatechange=eb.noop,this.xhr.abort()}},{key:"getResponse",value:function(){return this.xhr.response}},{key:"getText",value:function(){return this.xhr.responseText}},{key:"getJson",value:function(){return JSON.parse(this.xhr.responseText)}}],eS(o.prototype,t),r&&eS(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}(),er=r(1),eO=r.n(er);function eC(e){return(eC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eT(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function eE(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eT(Object(r),!0).forEach(function(t){var i,n;i=t,n=r[t],(i=eP(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eT(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function eD(){return(eD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function ej(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,eP(i.key),i)}}function eP(e){return e=function(e,t){if("object"!==eC(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==eC(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"===eC(e)?e:String(e)}function eI(e,t){return(eI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function eA(e){return(eA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ez=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eI(e,t)}(s,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=eA(s); s(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,s),(r=n.call(this)).options=e,r.config=t,r.uploaderCtx=e.context,r.file=e.file,r.cacheKey="__bd_uploader_cache",r}return t=[{key:"start",value:function(e,t){this._st=Date.now(),this.uploaderCtx._broadcast("startSelectRoute",null,!0),this.clientIp=e.clientIp,this.selectRouteTimeout=e.svar r=t.lastClientIp,i=t.lastSelectRouteTime;if(e&&e!==r)return null;if((new Date).getTime()-i<this.selectRouteCacheTime)return t}return null}},{key:"startSelectRoute",value:function(){var e=this,t=this.config.region,r=new ex,i=(r.on("complete",function(t){if(t.response)try{var r,i=JSON.parse(t.response);i.ResponseMetadata.Error?e.fail({xhr:t,errorCode:i.ResponseMetadata.Error.CodeN,error:i.ResponseMetadata.Error.Code,message:i.ResponseMetadata.Error.Message}):(r=i.Result.Domains,e.race(r,t))}catch(r){e.fail({error:"catch error: ".concat(r.toString()),xhr:t})}else e.fail({error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t})}),r.on("error",function(t){var r={error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t};t.response&&(t=JSON.parse(t.response)).ResponseMetadata&&t.ResponseMetadata.Error&&(r.errorCode=t.ResponseMetadata.Error.CodeN,r.error=t.ResponseMetadata.Error.Code,r.message=t.ResponseMetadata.Error.Message),e.fail(r)}),this.config.videoHost),n=this.config.videoConfig&&this.config.videoConfig.spaceName,n={Action:"GetUploadCandidates",Version:"2020-11-19",SpaceName:n=this.options.type===el&&this.config.objectConfig&&this.config.objectConfig.spaceName?this.config.objectConfig.spaceName:n},o=this.opET",url:"".concat(i,"?").c|i.webkitSlice||i.mozSlice).call(i,0,Math.min(this.selectRouteFileSize,i.size)),s=e.map(function(e){return{domainName:e.Name,domainInfo:e,percent:0,startTime:(new Date).getTime(),endTime:(new Date).getTime(),complete:!1}}),a=0,c=s.length;s.forEach(function(e,i){var n=new ex;n.on("complete",function(){s[i].endTime=(new Date).getTction(e){var t=e.domainInfo,i={oid:t.StoreID,tosDomain:"".concat(r.config.schema,"://").concat(t.Name)},i=eb.urlTemplate(o,i)+"?speedtest",t=t.Sign;e.transport.send({method:"post",url:i,headers:{Authorization:t,"Content-CRC32":"ignore"},file:n,binary:1,timeout:r.selectRouteTimeout})})}},{key:"formatRaceInfo",value:function(e,t){e.sort(function(e,t){return e.percent<t.percent?1:e.percent>t.percent?-1:e.error?1:t.error?-1:0}),e.forEach(function(e){delete e.transport}),e={geEndTime:Date.now(),dur",eE(eE({},e),{},{useCache:r}),!0),this.completeCallback({selectRouteResult:e.raceInfo})}},{key:"fail",value:function(e){var t={error:e.error,errorCode:e.errorCode,message:e.message};this.uploaderCtx.logger.send(eD(eE({stage:"selectRoute",stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,fileSize:this.file&&this.file.size,extra:t,type:"warn"},this.formatXhr(e.xhr)))),this.uploaderCtx._broadcast("completeSelectRoute",eE({type:"warn"},t),!0),this.completeCallback()}},{key:"formatXhr",value:function(e){return{req:{url:e.currentUrl,param:e.params},res:{status:e.status,header:e.getAllResponseHeaders(),body:e.responseText}}}}],ej(s.prototype,t),r&&ej(s,r),Object.defineProperty(s,"prototype",{writable:!1}),s}(),eR={crc32:function(e,t){for(var r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],i=("undefined"!=typeof Int32Array&&(r=new Int32Array(r)),-1^~~t),n=(e=new Uint8Array(e)).length,o=0;o<n;o++)i=r[255&(i^e[o])]^i>>>8;return(-1^i)>>>0},dec2hex:function(e){if(void 0!==e)return function e(t){return t.length<8?e(t="0".concat(t)):t}(Number(e).toString(16))}};function eB(e){return(eB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eU(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!==eB(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==eB(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"===eB(i)?i:String(i)),n)}}var eM=function(){var e,t;function r(e,t,i,n){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,r),this.file=e,this.successProcess=i,this.failProcess=n,this.sliceLength=t,this.retryTime=0,this.fileSize=e.size,this.crc32Array=[]}return e=[{key:"start",value:function(){this.readFileCrc32(this.file)}},{key:"readFileCrc32",value:function(e){var t=this,r=this.sliceLength,i=e.slice||e.webkitSlice||e.mozSlice,n=new FileReader,o=0,s=0,a=0;(function c(){s<e.size&&(s=Math.min(o+r,e.size),104857600<e.size)&&e.size-s<=5242880&&(s=e.size),n.readAsArrayBuffer(i.call(e,o,s)),n.onload=function(r){r=r.target.result,a=eR.crc32(r,0),t.crc32Array.push({start:o,end:s,crc32:eR.dec2hex(a),buffer:r}),(o=s)<e.size?c():t.success(t.crc32Array)}})()}},{key:"success",value:function(e){this.successProcess(e)}},{key:"fail",value:function(e,t,r,i){3<=this.retryTime?this.failProcess():(this.readFileCrc32(e,t,r,i),this.retryTime++)}}],eU(r.prototype,e),t&&eU(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}(),eF="The format of stsToken is incorrect.";function eN(e){return(eN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eH(){return(eH=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function eL(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function eG(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!==eN(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==eN(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"===eN(i)?i:String(i)),n)}}var eK=function(){var e,t;function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(fun.isDirect,this.isImageBatchUpload=e.isImageBatchUpload,this.file=e.file,this.type=(this.isImageBatchUpload?null==(e=this.file[0])?void 0:e.type:null==(e=this.file)?void 0:e.type)||"",this.sliceLength=eb.getFileSliceLength(this.file,t.getSliceFunc),this.config=t}return e=[{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.crc32(this.file,this.sliceLength)}},{key:"crc32",value:function(e,t){var r=this;if(this.isImageBatchUpload)for(var i=e.length,n=[],o=function(t){new eM(e[t],e[t].size,function(e){n[t]=e[0],n.filter(function(e){return!!e}).length===i&&r.success(n)},function(e){r.fail(e)}).start()},s=0;s<i;s++)o(s);else e&&e.size&&!(e.size<=0)?this.isDirect?new eM(e,e.size,function(e){r.success(e)},function(e){r.fail({errorCode:1000003,message:"get crc32 error: ".concat(e&&e.message)})}).start():this.sliceFile(e,t,function(e){r.success(e)},function(e){r.fail(e)}):this.fail({errorCode:1000003,message:"There is a problem with the input file or fileSize."})}},{key:"sliceFile",value:function(e,t,r,i){for(var n=[],o=e.size,s=e.slice||e.webkitSlice||e.mozSlice,a=0,c=0,u=0;c<o;)c=Math.min(a+t,o),n.push({start:a,end:c=104857600<o&&o-c<=5242880?o:c,crc32:0}),a=c;try{!function t(a){var c=new FileReader,l=n[a].start,f=n[a].end;c.readAsArrayBuffer(s.call(e,l,f)),c.onload=function(e){e=e.target.result,u=eR.dec2hex(eR.crc32(e,0)),n[a].crc32=u,f===o?r(n):t(n.length-1)},c.onerror=function(e){var t=e.target.error.name,e=e.target.error.message;i({crc32Array:n,errorCode:1000003,message:t+": "+e})}}(0)}catch(e){i({message:e&&e.toString()})}}},{key:"getCrc32Key",value:function(e,t){var r;return(t="[object Array]"===Object.prototype.toString.call(t)?function(e){if(Array.isArray(e))return eL(e)}(r=t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||function(e,t){var r;if(e)return"string"==typeof e?eL(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?eL(e,t):void 0}(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}():[t]).push(e[0].crc32,e[e.length-1].crc32),this.config.instanceId&&t.push(this.config.instanceId),t.join("_")}},{key:"success",value:function(e){var t=this.context,r=this.key,i=[],n=[];if(this.isImageBatchUpload)for(var o=0;o<this.file.length;o++)i.push(this.file[o].size),n.push(this.file[o].name);else i=this.file.size,n=this.file.name;var s=this.getCrc32Key(e,i),t=t.tasks[r];t&&this.successProcess(eH(t,{key:r,crc32Array:e,crc32Key:s,sdkVersion:"2.0.6",sliceLength:this.sliceLength,extra:{message:"get crc32 success"},stage:"crc32",type:"success",fileSize:i,fileName:n,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st,isDirect:this.isDirect,isImageBatchUpload:this.isImageBatchUpload}))}},{key:"fail",value:function(e){var t=this.context,r=this.key,i=e&&e.message?e.message:"get crc32 error",n=e&&e.errorCode,e=e&&e.crc32Array,t=eH(t.tasks[r],{crc32Array:e,extra:{message:i,errorCode:n},type:"error",stage:"crc32",stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st});this.failProcess(t)}}],eG(r.prototype,e),t&&eG(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}(),eq={checkFile:function(){},checkStsToken:function(e){return!e||e.SessionToken&&e.SecretAccessKey&&(e.AccessKeyId||e.AccessKeyID)},checkServiceName:function(e,t,r){if("vod"===r||r===eh)return r;if(e!==ec){if(e===eu)return eh;if(e===el){if(t.objectConfig&&t.objectConfig.spaceName)return"vod";if(t.objectConfig&&t.objectConfig.serviceId)return eh;if(t.videoConfig&&t.videoConfig.spaceName)return"vod";if(t.imageConfig&&t.imageConfig.serviceId)return eh}}return"vod"}};function eW(e){return(eW="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eJ(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function eV(){return(eV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function eX(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,eQ(i.key),i)}}function eQ(e){return e=function(e,t){if("object"!==eW(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==eW(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"===eW(e)?e:String(e)}function e$(e,t){return(e$=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function eZ(e){return(eZ=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eY=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e$(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=eZ(o);return function(e,t){if(t&&("object"===eW(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only ion o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=n.call(this)).options=e,r.config=t,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.systemTimeGap=0,r.retryTime=t.retryTaskTime||2,r.hasRetryTime=0,r.isImageBatchUpload=!!r.options.isImageBatchUpload,r.isDirect=r.options.isDirect,r}return t=[{key:"start",value:function(e,t,r){this.startOptions=e,this.failProcess=r,this.successProcess=t,this._st=Date.now(),r=(e=this.uploaderCtx._getCache(this.currFileCtx.crc32Key))?JSON.parse(e):{},!this.isDirect&&r.oid&&r.UploadID?this.resumeFromCache(r):this.startPreUpload()}},{key:"startPreUpload",n,r=new ex,i=(r.on("complete",function(t){if(t.response){var r=null;try{var i=JSON.parse(t.response);if(i.ResponseMetadata.Error)return e.fail({xhr:t,errorCode:i.ResponseMetadata.Error.CodeN,error:i.ResponseMetadata.Error.Code,message:i.ResponseMetadata.Error.Message});var n,o,s,a,c,u,l,f=eq.checkServiceName(e.options.type,e.config,e.options.serviceType),h=i.Result,p=f===eh?h.UploadAddress:h.InnerUploadAddress.UploadNodes[0],d=p.StoreInfos,y=p.UploadHosts,g=p.SessionKey,m=p.UploadHeader,v=f===eh?y[0]:p.UploadHost,b=null==(n=d[0])?void 0:n.UploadID,_=[],S=[];e.isImageBatchUpload&&1<d.length?d.forEach(function(e){_.push(e.Auth),S.push(e.StoreUri)}):(_=d[0].Auth,S=d[0].StoreUri),"vod"===f&&(o=h.InnerUploadAddress.UploadNodes).length&&1<o.length&&(a={SessionKey:(s=o[1]).SessionKey,UploadHeader:s.UploadHeader,StoreInfo:s.StoreInfos[0],UploadHost:s.UploadHost}),e.startOptions&&e.startOptions.enableSelectRoute&&(l=!0,e.startOptions.selectRouteResult)&&(u=!(((c=e.startOptions.selectRouteResult)[0]&&c[0].domainName)!==v)),r=eV(e.currFileCtx,{key:e.options.key,useBackupDomain:e.uploaderCtx.useBackupDomair)}return e.fail({error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t})}),r.on("error",function(t){var r;(e.options.type===eu&&e.config.imageFallbackHost||e.options.type===ec&&e.config.videoFallbackHost)&&!e.uploaderCtx.useBackupDomain?(e.hasRetryTime<e.retryTime-1?e.hasRetryTime++:e.uploaderCtx.useBackupDomain=!0,e.startPreUpload()):(r={error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t},t.response&&(t=JSON.parse(t.response)).ResponseMetadata&&t.ResponseMetadata.Error&&(r.errorCode=t.ResponseMetadata.Error.CodeN,r.error=t.ResponseMetadata.Error.Code,r.message=t.ResponseMetadata.Error.Message),e.fail(r))}),""),n={},o=this.uploaderCtx.useBackupDomain,s=eq.checkServiceName(this.options.type,this.config,this.options.serviceType),a=(s===eh&&(i=o?this.config.imageFallbackHost:this.config.imageHost,n={Action:"ApplyImageUpload",Version:"2018-08-01"},this.options.type===eu&&(this.config.imageConfig&&this.config.imageConfig.serviceId?n.ServiceId=this.config.imageConfig.serviceId:n.SpaceName=this.config.videoConfig&&this.config.videoConfig.spaceName),this.options.type===el&&(n.ServiceId=this.config.objectConfig&&this.config.objectConfig.serviceId||this.config.imageConfig&&this.config.imageConfig.serviceId),this.currFileCtx.fileSize&&1<this.currFileCtx.fileSize.length&&(n.UploadNum=this.currFileCtx.fileSize.length),this.options.storeKey)&&(a=this.options.storeKey,"[object Array]"===Object.prototype.toString.call(a)?n.StoreKeys=a:"[object String]"===Object.prototype.toString.call(a)&&(n.StoreKeys=[a])),"vod"===s&&(a=this.config.videoConfig&&this.config.videoConfig.spaceName,this.options.type===el&&this.config.objectConfig&&this.config.objectConfig.spaceName&&(a=this.config.objectConfig.spaceName),i=o?this.config.videoFallbackHost:this.config.videoHost,n={Action:"ApplyUploadInner",Version:"2020-11-19",SpaceName:a,FileType:this.options.type,IsInner:1},this.config.enOID&&(n.EnOID=1),(this.options.testHost||this.config.testHost)&&(n.TestHost=this.options.testHost||this.config.testHost),this.startOptions)&&this.startOptions.selectRouteResult&&(o=this.startOptions.selectRouteResult,n.ClientBestHosts=o.map(function(e){return e.domainName}).join(",")),this.currFileCtx.fileSize&&(n.FileSize=this.currFileCtx.fileSize),this.config.useFileExtension&&this.currFileCtx.fileName&&(this.options.type===el||this.options.type===eu)&&(a=this.currFileCtx.fileName,o=eb.getFileSuffix(a))&&(n.FileExtension=o),this.config.accountId&&(n["X-Account-Id"]=this.config.accountId),(this.options.type===eu||this.options.type===el)&&this.config.bizType&&(n.BizType=this.config.bizType,n.AppID=this.config.appId,n.UserID=this.config.userId),this.config.openExperiment&&(n.app_id=this.config.appId,n.user_id=this.config.userId),n.s=Math.random().toString(36).substr(2),this.options.fileSize&&(n.FileSize=this.options.fileSize),this.currFileCtx.proxyStsToken||this.config.stsToken),o=eb.toQueryString(n),c=a.AccessKeyID,u=a.AccessKeyId,l=a.SecretAccessKey,f=a.SessionToken,a=a.CurrentTime,o={method:"GET",url:"".concat(i,"?").concat(o),timeout:this.config.gatewayTimeout||3e4,region:t,params:n,pathname:eb.getPathByURL(i)},t=new eO.a(o,s),n=(this.config.useServerCurrentTime&&6e4<Math.abs(new Date(a)-new Date)&&(this.systemTimeGap=new Date(a)-new Date),this.systemTimeGap?new Date((new Date).getTime()+this.systemTimeGap):new Date);t.addAuthorization({accessKeyId:u||c,secretAccessKey:l,sessionToken:f},n),r.send(o)}},{key:"resumeFromCache",value:function(e){var t=this,r=this.options.key,i=new e3===o.code&&0<o.data.partlist.length))return t.startPreUpload();var s=t.confirmCache(o.data.partlist),a=e.hasMerge?5:s.isAllFinished?4:3,n=eV(t.currFileCtx,e,{key:r,xhr:i,extra:{message:"prepare upload from cache success"},stage:"preUpload",type:"success",percent:0,cacheTask:a,proxyStsToken:t.options.stsToken,currentTask:1,status:1,isBreak:1,crc32Array:s.crc32Array,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st,totalDuration:Date.now()-t._st+t.currFileCtx.totalDuration})}catch(e){return t.startPreUpload()}t.successProcess(n)}),i.on("error",function(e){400<=e.status?t.startPreUpload():t.fail({error:"request error",xhr:e})}),this.config.userId);i.send({method:"get",url:eb.urlTemplate("{tosDomain}/upload/v1/{oid}?uploadid={uploadId}&action=part_list",{tosDomain:e.tosDomain,oid:e.oid,uploadId:e.UploadID=arguments[t],i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eJ(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({Authorization:e.signature,"X-Storage-U":encodeURIComponent(n)},e.UploadHeader),timeout:3e4})}},{key:"confirmCache",value:function(e){var t=this.currFileCtx.crc32Array,r={},i=(e.forEach(function(e){void 0===r[e.num-1]&&(r[e.num-1]={tag:!0,crc32:e.crc32})}),!0),e=t.map(function(e,t){return r[t]&&r[t].tag&&r[t].crc32?(e.crc32=r[t].crc32,pload error: UNKNOWN",n=(r&&(n=0===r.status?"prepare upload error: NETERROR":e.message||"prepare upload error: ".concat(r.status)),eV(this.currFileCtx,{extra:{message:n,error:e.error,errorCode:i},type:"error",stage:"preUpload",xhr:r,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}));this.isImageBatchUpload&&(n.successImage=[],n.failImage=null==(e=this.currFileCtx)?void 0:e.crc32Array.map(function(e,r){return{crc32:e.crc32,fileSize:null==(e=t.currFileCtx)?void 0:e.fileSize[r],fileName:null==(e=t.currFileCtx)?void 0:e.fileName[r],finishSize:0,success:!1}})),this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(n)}}],eX(o.prototype,t),r&&eX(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function e1(e){return(e1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e0(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function e2(){return(e2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function e3(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,e4(i.key),i)}}function e4(e){return e=function(e,t){if("object"!==e1(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==e1(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"===e1(e)?e:String(e)}function e5(e,t){return(e5=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function e6(e){return(e6=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var e8=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e5(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=e6(o);return function(e,t){if(t&&("object"===e1(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=e6(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=n.call(this)).options=e,r.config=t,r.transport=new ex,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.eventInit(),r}return t=[{key:"initUpload",value:function(e){e&&(e=this.currFileCtx.fallbackStoreInfo)&&(e2(this.currFileCtx,{oid:e.StoreInfo.StoreUri,tosDomain:"".concat(this.config.schema,"://").concat(e.UploadHost),signature:e.StoreInfo.Auth,UploadHeader:e.UploadHeader,SessionKey:e.SessionKey}),this.uploaderCtx._saveTask(this.options.key));var e={oid:this.currFileCtx.oid,tosDomain:this.currFileCtx.tosDomain},e=eb.urlTemplate("{tosDomain}/upload/v1/{oid}?uploadmode=part&phase=init",e),t=this.config.userId;this.transport.send({method:(Object(r),!0).forEach(fail({error:"fail! response.code: ".concat(n.code,", fail message: ").concat(n.message),code:null==n?void 0:n.code,message:null==n?void 0:n.message,xhr:t});r=e2(e.currFileCtx,{UploadID:o,percent:0,type:"success",extra:{message:"init upload id success"},stage:"initUploadID",xhr:t,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration})}catch(r){return e.fail({error:"catch error: ".concat(r.message||JSON.stringify(r)),xhr:t})}return e.successProcess(r)}),this.transport.on("error",function(t){e.fail({error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t})})}},{key:"fail",value:function(e){var t=this.options.context,r=this.options.key,t=e2(t.tasks[r],{extra:{message:"init upload id error, ".concat(e.error),errorCode:(null==e?void 0:e.code)||1002e3},type:"error",stage:"initUploadID",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration});this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(t)}}],e3(o.prototype,t),r&&e3(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function e7(e){return(e7="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e9(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e9(Object(r),!0).forEach(function(t){var i,n;i=t,n=r[t],(i=tr(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e9(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function tt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,tr(i.key),i)}}function tr(e){return e=function(e,t){if("object"!==e7(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==e7(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"===e7(e)?e:String(e)}function ti(e,t){return(ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tn(e){return(tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var to=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ti(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tn(o);return function(e,t){if(t&&("object"===e7(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this t))throw TypeError("Cannot -CRC32":this.crc32,"X-Stthis.uploadUrl||(this.ength}),!1):(this.en=1<arguments.length&&s.fileSlice.byteLengon:Date.now()-this._strror",te({message:"slice upload failed: UNAUTHORIZED"},t)):(r="slice upload failed: UNKNOWN",e&&(r=e.status?"slice upload failed: ".concat((null==n?void 0:n.message)||e.status):"slice upload failed: NETERROR"),this.retryCount<this.retryTime?(setTimeout(function(){i.upload(!0,te({message:r},t))},1e3),this.retryCount++):this.emit("error",te({message:r,code:null==n?void 0:n.code},t))))}},{key:"process",value:function(e){this.cancel||this.emit("progress",{crc32:this.crc32,loaded:e.loaded||0,total:e.total||0})}},{key:"abort",value:function(){this.transport&&(thispe,t),r&&tt(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}(),ei=r(2),ts=r.n(ei);function ta(e){return(ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tc(){return(tc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tu(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function tl(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!==ta(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==ta(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"===ta(i)?i:String(i)),n)}}function tf(e,t){return(tf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function th(e){return(th=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tp=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tf(e,t)}(s,i.a);var e,t,r,o=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=th(s);return function(e,t){if(t&&("object"===ta(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=th(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function s(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(=-1,t.lastCalculateSpeedSize=0,t.uploadHandlers={},t}return t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this..tasks[thiss.initl==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,o,s,a=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(i=o.call(r)).done)&&(a.push(i.value),a.length!==t);c=!0);}catch(e){u=!0,n=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}jects must have a [Symbol.infig.clientEncrypt,}},{key:"threadUpload",value:funcers).forEach(function(t){e.worker&&this.worker.terminate(),this.worker=null,this.clearMonitor()}},{key:"setProgressMonitor",value:function(){var e=this;this.progressMonitorInterval=setInterval(function(){var t,r=e.finishSize;r-e.lastIntervalSize<e.progressMonitorTime*e.progressMonitorSpeed*1024?(t=tc(e.currentCtx,{stage:"process",type:"warn",extra:{message:"percent are not updated in ".concat(e.progressMonitorTime," seconds")}}),e.context.logger.send(t),e.context._broadcast("slowProgress",t),e.clearMonitor()):e.lastIntervalSize=r},1e3*this.progressMonitorTime)}},{key:"clearMonitor",value:function(){this.progressMonitorInterval&&clearInterval(this.progressMonitorInterval)}},{key:"upload",value:function(e,t,r){var i=this,o=e.crig.uploadTimeout,t=(this.config.clientEncrypt||(t=eb.fileSlice(this.file,e.start,e.end)),new to({sliceItem:t,c.UploadHeader,userId:a,method:"POST",retryTime:this.retryUploadTime,timeout:c}));t.on("complete",function(t){1===i.currentCtx.status&&(t.start=e.start,t.crc32StartTime=e.crc32StartTime,t.crc32EndTime=e.crc32EndTime,t.crc32Duration=e.crc32Duration,t.index=r,i.fileSliceSuccess(t))}),t.on("error",function(t){1===i.currentCtx.status&&(t.start=e.start,t.crc32StartTime=e.crc32StartTime,t.crc32EndTime=e.crc32EndTime,t.crc32Duration=e.crc32Duration,t.index=r,i.fail(t))}),t.on("progress",function(t){1===iage:"process",perceneEndTime:Date.now(),duration:Daus:t.status,body:t.responseTa:n,totalDuration:i-this._lastSaveTime+this.currentCtx.totalDuration,sliceStartTime:e.sliceStartTime,sliceEndTime:e.sliceEndTime,sliceDuration:e.sliceDuration,crc32StartTime:e.crc32StartTime,crc32EndTime:e.crc32EndTime,crc32Duration:e.crc32Duration})),this._lastSaveTime=i,this.uploading.splice(this.uploading.indexOf(r),1),this.uploadHandlers[r]&&delete this.uploadHandlers[r],this.finishArr.length>=this.crc32Array.length?(this.stop(),this.success(e.xhr)):this.threadUpload()}},{key:"getFinishSize",value:function(e,t){var r=t.crc32,i=0;return e.forEach(function(e){e.crc32===r?(e.loaded=t.loaded,i+=t.loaded):(e.loaded||(e.loaded=0),i+=e.loaded)}),i}},{key:"process",value:function(e){var t=this.currentCtx.realtimeSpeed||0,r=this.currentCtx.fileSize,i=(this.finishSize=this.getFinishSize(this.crc32Array,e),this.finishSize>this.lastFinishSize&&((e=new Date).getTime()-this.lastCalculateSpeedTime>1e3*this.realtimeSpeedInterval&&(n=e.getTime()-this.lastCalculateSpeedTime,t=Math.floor((i=this.finishSize-this.lastCalculateSpeedSize)/n),this.lastCalculateSpeedTime=e.getTime(),this.lastCalculateSpeedSize=this.finishSize),this.lastFinishSize=this.finishSize),Math.floor(this.finishSize/r*1e4)/100||0),n=tc(this.currentCtx,{stage:"process",percent:i,realtimeSpeed:t});i>this.lastProcessPercent&&100!==i&&(this.lastProcessPercent=i,this.context._broadcast("progress",n))}},{key:"errorFormat",value:function(e){var t=this.currentCtx.totalDuration,r=Date.now()-this._st,i=e.index,n=e.crc32?{message:e.message,data:e.crc32,size:e.size}:e.extra,n=(n.errorCode=(null==e?void 0:e.code)||n.errorCode||1003e3,tc(this.currentCtx,{extra:n,sliceIndex:i,stage:"process",req:{},res:{},totalDuration:r+t,sliceStartTime:e.sliceStartTime,sliceEndTime:e.sliceEndTime,sliceDuration:e.sliceDuration,crc32StartTime:e.crc32StartTime,crc32EndTime:e.crc32EndTime,crc32Duration:e.crc32Duration}));return e.xhr&&(i=e.xhr,n.req={url:e.xhr.currentUrl},n.res={status:i.status,body:i.responseText,header:i.getAllResponseHeaders()},delete e.xhr),n}}],tl(s.prototype,t),r&&tl(s,r),Object.defineProperty(s,"prototype",{writable:!1}),s}();function td(e){return(td="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ty(){return(ty=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tg(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function tm(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,tv(i.key),i)}}function tv(e){return e=function(e,t){if("object"!==td(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==td(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"===td(e)?e:String(e)}function tb(e,t){return(tb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function t_(e){return(t_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tS=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tb(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=t_(o);return function(e,t){if(t&&("object"===td(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=t_(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t)ength;i++)r=(r?"".concat(r,","):"").concat(i+1,":").concat(t[i].crc32);var e=eb.urlTemplate("{tosDomain}/upload/v1/{oid}?uploadmode=part&phase=finish&uploadid={uploadId}",e),n=this.config.userId,n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tg(Object(r),!0).forEach(functionble:!0,writable:!0}):e[in=o.data)||!n.key)return e.fai),code:null==o?voidt.message||JSON.stringify(t)),xhr:r})}return e.successProcess(i)}),this.transport.on("error",function(t){e.fail({error:"request fail: ".concat(t.statusText||t.errText),xhr:t})})}},{key:"getProcessIndex",value:function(e){var t=0;return e.forEach(function(e,r){"process"===e.stage&&(t=r)}),t}},{key:"fail",value:function(e){e=ty(this.currFileCtx,{extra:{message:"merge file error, ".concat(e.error),errorCode:(null==e?void 0:e.code)||1004e3},type:"error",stage:this.options.stage,xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}),this.failProcess(e)}}],tm(o.prototype,t),r&&tm(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function tw(e){return(tw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tk(){return(tk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tx(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!==tw(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==tw(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"===tw(i)?i:String(i)),n)}}function tO(e,t){return(tO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tC(e){return(tC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tT=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tO(e,t)}(s,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tC(s);return function(e,t){if(t&&("object"===tw(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been calles=e,t.file=e.file,tconfig.retryUploadTime||0,t.processRetry=0,t.lastFinishSize=-1,t.lastProcessPercent=-1,t.lastIntervalSize=-1,t.uploader={},t._uploadProcessMap={},t}return t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this.currentCtx=this.context.tasks[this.key],this.crc32Array=this.context.tasks[this.key].crc32Array,this._uploadSize=this.isImageBatchUpload?this.currentCtx.fileSize.reduce(function(e,t){return e+t}):this.file.size,this._st=Date.now(),this.upload()}},{key:"stop",value:function(){var e=this;this.uploader&&Object.keys(this.uploader).forEach(function(t){e.uploader[t]&&(e.uploader[t].abort(),e.uploader[t].destroy())})}},{key:"upload",value:function(){for(var e=this,t=this.crc32Array.length,r=0,i=0,n=0;n<t;n++){var s=this.crc32Array[n],a=s.buffer,s=s.crc32,c=this.currentCtx.signature,c="[object Array]"===Object.prototype.toString.call(c)?c[n]:c,u=tb.urlTemplate(.config.uploadTimeout,p=void 0,d=this.isImageBatchUpload?(p=this.currentCtx.fileSize[n],this.currentCtx.fileName[n]):(p=this.file.size,this.file.name);this._uploadProcessMap[s]&&this._uploadProcessMap[s].success?r+=1:(this._uploadProcessMap[s]={crc32:s,fileSize:p,fileName:d,oid:u,finishSize:0,success:!1},(p=new to({sliceItem:a,crc32:s,url:l,signature:c,uploadHeader:this.currentCtx.UploadHeader,userId:f,retryTime:this.retryUploadTime,method:"POST",timeout:h})).on("complete",function(n){r++,e._uploadProcessMap[n.crc32].finishSize=n.size,e.hr)}),p.on("error",function(r){++i===t&&e.fail(r)}),p.on("progress",function(t){e.process(t)}),p.upload(),this.uploader[s]=p)}}},{key:"success",value:function(e){this.finishArr=[];var t=Date.now()-this._st,t=this._uploadSize/t,r=tk(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"direct upload success"},speed:t,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration});this.isImageBatchUpload&&(r.successImage=[],r.failImage=[],Object.values(this._uploadProcessMap).forEach(function(e){(e.success?r.successImage:r.failImage).push(e)})),this.uploader=null,this._uploadProcessMap=null,this.successProcess(r)}},{key:"fail",value:function(e){e=tk(this.currentCtr: ".concat(e.message||e.xhr.errText),errorCode:e.code||1003e3},type:"error",stage:"process",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration}),this.isImageBatchUpload&&(e.failImage=Object.values(this._uploadProcessMap)),this.uploader=null,this._uploadProcessMap=null,this.failProcess(e)}},{key:"process",value:function(e){var t=this._uploadSize,e=(this._uploadProcessMap[e.crc32].finishSize=Math.max(this._uploadProcessMap[e.crc32].finishSize,e.loaded),this.finishSize=Object.values(this._uploadProcessMap).reduce(function(e,t){return e+t.finishSize},0),this.finishSize>this.lastFinishSize&&(this.lastFinishSize=this.finishSize),Math.floor(this.finishSize/t*1e4)/100||0),t=tk(this.currentCtx,{stage:"process",percent:e});e>this.lastProcessPercent&&100!==e&&(this.lastProcessPercent=e,this.context._broadcast("progress",t))}}],tx(s.prototype,t),r&&tx(s,r),Object.defineProperty(s,"prototype",{writable:!1}),s}();function tE(e){return(tE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tD(){return(tD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tj(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!==tE(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==tE(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"===tE(i)?i:String(i)),n)}}function tP(e,t){return(tP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tI(e){return(tI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tA=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tP(e,t)}(s,i.a);var e,t,r,o=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tI(s);return function(e,t){if(t&&("object"===tE(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't ==arguments[1]?arguments[ray=[],t.uploadSliceCount=0,t.isCalcCrc32=!1,t.isFileReading=!1,t.hasStarted=!1,t.hasCompleteUpload=!1,t}return t=[{key:"start",value:function(e,t,r)itWorker()}},{key:"initWorker",valuec32=!1;var r=t.data[0],i=t.datareadAsArrayBuffer(r),e.onload=ploadQueue.length||this.isFileReading||this.success()}},{key:"startUploadQueue",value:function(){var e;this.uploadSliceCount<=this.maxUploadSliceCount&&0<this.uploadQueue.length&&this.uploadQueue[0].crc32?(e=this.uploadQueue.shift(),this.uploadSliceCount++,this.upload({sliceItem:e.fileSliceBuffer,index:e.index,crc32:e.crc32})):0<this.uploadQueue.length&&!this.uploadQueue[0].crc32&&this.startCrc32Queue()}},{key:"startCrc32Queue",value:function(){if(!this.isCalcCrc32)for(var e=0;e<this.uploadQueue.length;e++){var t=this.uploadQueue[e];if(!t.iceBuffer,t.index],[t.fileSliceBuffer]);breaow(),i={message:"strea_lastSaveTime+this.currentCtx.totalDuration})),tD(this.currentCtx,{uploadQueueLength:this.uploadQueue.length,sliceIndex:t}));this.context._broadcast("stream-progress",n),this.uploadSliceCount--,this.hasCompleteUpload&&0===this.uploadQueue.length?this.success(e.xhr):this.startUploadQueue()}},{key:"success",value:function(e){this.isAllSuccess||(e=tD(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"all slice upload success"},crc32Array:this.crc32Array,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration}),this.successProcess(e))}},{key:"fail",value:function(e){var t=e.index,e=tD(this.currentCtx,{extra:{message:"stream slice upload error"},type:"error",stage:"process",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration,sliceIndex:t});this.context.logger.send(tD({},e)),this.context._broadcast("error",e)}}],tj(s.prototype,t),r&&tj(s,r),Object.defineProperty(s,"prototype",{writable:!1}),s}();function tz(e){return(tz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tR(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function tB(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tR(Object(r),!0).forEach(function(t){var i,n;i=t,n=r[t],(i=tF(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tR(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function tU(){return(tU=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tM(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,tF(i.key),i)}}function tF(e){return e=function(e,t){if("object"!==tz(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==tz(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"===tz(e)?e:String(e)}function tN(e,t){return(tN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tH(e){return(tH=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tL=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tN(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tH(o);return function(e,t){if(t&&("object"===tz(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tH(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=n.call(this)).options=e,r.config=t,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.isImageBatchUpload=!!r.options.isImageBatchUpload,r.skipCommit=e.skipCommit,r.transport=new ex,r.eventInit(),r}return t=[{key:"commitUpload",value:function(){var e,t,r=this.options.key,r=this.options.context.tasks[r],i=this.config.region,n="",o={},s=this.uploaderCtx.useBackupDomain,a=eq.checkServiceName(this.options.type,this.config,this.options.serviceType),c=(a===eh&&(n=s?this.config.imageFallbackHost:this.config.imageHost,o={Action:"CommitImageUpload",Version:"2018-08-01"},t={SessionKey:r.SessionKey},this.options.type===eu&&(this.config.imageConfig&&this.config.imageConfig.serviceId?o.ServiceId=this.config.imageConfig.serviceId:o.SpaceName=this.config.videoConfig&&this.config.videoConfig.spaceName,Array.isArray(e=this.config.imageConfig&&this.config.imageConfig.processAction)&&0<e.length&&(t.Functions=e),this.config.skipMeta)&&(o.SkipMeta=!0),this.options.type===el&&(o.ServiceId=this.config.objectConfig&&this.config.objectConfig.serviceId||this.config.imageConfig&&this.config.imageConfig.serviceId),e=JSON.stringify(t)),"vod"===a&&(c=this.config.videoConfig&&this.config.videoConfig.spaceName,this.options.type===el&&this.config.objectConfig&&this.config.objectConfig.spaceName&&(c=this.config.objectConfig.spaceName),n=s?this.config.videoFallbackHost:this.config.videoHost,o={Action:"CommitUploadInner",Version:"2020-11-19",SpaceName:c},t={SessionKey:r.SessionKey,Functions:[]},s=this.config.videoConfig&&this.config.videoConfig.processAction,this.options.type===el&&this.config.objectConfig&&this.config.objectConfig.processAction&&(s=this.config.objectConfig.processAction),Array.isArray(s)&&0<s.length&&(t.Functions=s),(this.config.videoConfig&&this.config.videoConfig.callbackArgs||this.options.callbackArgs)&&(t.CallbackArgs=this.options.callbackArgs||this.config.videoConfig.callbackArgs),this.options.type===ec&&this.config.skipDownload&&(o.SkipDownload=!0),this.options.type===el&&this.options.objectSync&&(t.ObjectSync=this.options.objectSync),this.options.type===ec&&this.options.needExactFormat&&(t.needExactFormat=this.options.needExactFormat),e=JSON.stringify(t)),this.config.accountId&&(o["X-Account-Id"]=this.config.accountIdte((new Date).getTime()+o):new Date;i.addAuthorization({accessKeyId:l||u,secretAccessKey:f,sessionToken:s},n),this.transport.send(c)}},{key:"start",value:function(e,t,r){if(this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.skipCommit)return this.successProcess(tU(this.currFileCtx,{stage:"complete",type:"success",percent:100,extra:{message:"upload successful, skip commit"},stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._.currFileCtx.totalDuration,skipCommit:this.skipCommit}));try{this.commitUpload()}catch(e){this.fail({error:"catch error: ".concat(e.toString())})}}},{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){var r=null;try{var i=JSON.parse(t.response);if(i.ResponseMetadata.Error)return e.fail({xhr:t,errorCode:i.ResponseMetadata.Error.CodeN,error:i.ResponseMetadata.Error.Code,message:i.ResponseMetadata.Error.Message});var n,o,s=eq.checkServiceName(e.options.typege:"upload successful"},uploadResult:c,xhr:t,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration,skipCommit:e.skipCommit})}catch(r){return e.fail({error:"catch error: ".concat(r.message||r.toString()),xhr:t})}return e.successProcess(r)}),this.transport.on("error",function(t){var r={error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t};t.response&&(t=JSON.parse(t.response)).ResponseMetadata&&t.ResponseMetadata.Error&&(r.errorCode=t.ResponseMetadata.Error.CodeN,r.error=t.ResponseMetadata.Error.Code,r.message=t.ResponseMetadata.Error.Message),e.fail(r)})}},{key:"fail",value:function(e){var t=this.options.context,r=this.options.key,i=e.xhr,n=e.errorCode||1005e3,o="commit upload error: UNKNOWN",t=(i&&(o=0===i.status?"commit upload error: NETERROR":e.message||"commit upload error: ".concat(i.status)),tU(t.tasks[r],{extra:{message:o,error:e.error,errorCode:n},type:"error",stage:"complete",xhr:i,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration,skipCommit:this.skipCommit}));this.failProcess(t)}}],tM(o.prototype,t),r&&tM(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function tG(e){return(tG="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tK(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function tq(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tK(Object(r),!0).forEach(function(t){var i,n;i=t,n=r[t],(i=tV(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tK(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function tW(){return(tW=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tJ(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,tV(i.key),i)}}function tV(e){return e=function(e,t){if("object"!==tG(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==tG(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"===tG(e)?e:String(e)}function tX(e,t){return(tX=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tQ(e){return(tQ=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var t$=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tX(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tQ(o);return function(e,t){if(t&&("object"===tG(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0een called")}(e)}(this,oadID"!==e.stage||(e.arg=tW(e.arg,t)),e)&&e.func.call(e.context,e.arg,functi&&r.isDirect?n.fail(r):!n.taskError[o]||n.taskError[o]<n.retryTaskTime?(n.taskError[o]?n.taskError[o]++:n.taskError[o]=1,i=n.errorFormat(r,!0),n.uploaderCtx.logger.send(i),"initUploadID"===e.stage?n.execTask(e,tq(tq({},{type:"success"});try{rCtx.logger.send(e)}},{key:"fail",value:function(e){var t=this.uploaderCtx,r=e.key,e=this.errorFormat(e);try{t._broadcast("error",e)}catch(e){throw Error(e)}t.tasks[r].isBreak?t._cancel(r):t._pause(r),t.logger.send(e)}},{key:"cancel",value:function(e){var t,r=this.key,i=this.uploaderCtx.tasks[r].currentTask;this.uploaderCtx.taskList[r].forEach(function(e){i===e.index&&(t=e)}),e?3===i&&this.uploaderCtx.tasks[r].isDirect&&t&&null!=(e=t)&&null!=(e=e.context)&&e.stop():(this.tasks=[],t&&3===t.index&&t.context.stop(),this.uploaderCtx._removeTaskCache(r))}},{key:"restart",value:function(){this.uploadesponseHeaders(),body:r.responseText},e.extra&&(e.extra.req=e.req,e.extra.res=e.res),delete e.xhr),tW(e,t)}}],tJ(o.prototype,t),r&&tJ(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function tZ(e){return(tZ="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tY(){return(tY=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwr];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!==tZ(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==tZ(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"===tZ(i)?i:String(i)),n)}}function t0(e,t){return(t0=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function t2(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function t3(e){return(t3=Object.setPrototypeOf?Object.getPrototypeOf.bind()r be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&t0(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=t3(o);returnrs may only return object or undefined");return t2(e)}(this,e?(t=t3(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e)r("Cannot call a class point),t.logger=t.config.noLog?{send:function(){}}:new eg(t.config,t2(t)),t}return t=[{key:"_mergeOptions",value:function(e,t){t&&"object"===tZ(t)&&(tY(e,t),Object.keys(t).forEach(function(r){"vodDomain"===r&&(e.replace[r]=t[r])}))}},{key:"_setCache",value:function(e,t){this.storage.setItem(e,t)}},{key:"_getCache",value:function(e){return this.storage.getItem(e)}},{key:"_removeCache",value:function(e){e?this.storage.removeItem(e):this.storage.clear()}},{key:"_addTask",value:function(e,t){var r=this.tasks,i=this.taskList;r[e]&&r[e].task?i[e].push(t):(i[e]=[],i[e].push(t),r[e]=r[e]||{},r[e].task=new t$([],this.config,this,e)),r[e].task.addTask(t)}},{key:"_broadcast",value:function(e,t,r){if(r)this.emit(e,t);else if(1===(r=this.tasks[t.key].status)||0===r)try{this.emit(e,t)}catch(e){if(!(r=!("[object Error]"!==Object.prototype.toString.call(e)))||"Error"===e.name)throw e}}},{key:"_addCrc32ProcessTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=r.isDirect,r=r.isImageBatchUpload,e=new eK({file:e.file,context:this,key:t,isDirect:i,isImageBatchUpload:void 0!==r&&r},this.config),i={context:e,func:e.start,arg:{},key:t,index:0,stage:"crc32"};this._addTask(t,i)}},{key:"_addPreUploadTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=r.isDirect,r=r.isImageBatchUpload,i={file:e.file,stsToken:e.stsToken,context:this,type:e.type||ec,preUploadUriParams:e.preUploadUriParams||{},storeKey:e.storeKey,testHost:e.testHost,key:t,isDirect:i,isImageBatchUpload:void 0!==r&&r,fileSize:e.fileSize,serviceType:e.serviceTalue:function(e,t){var r=(2<argumentage:"process"};this._addTaskadID"},this._addTask(t,e)}},{key:"_addUploadProcessTask",value:function(e,t){e={context:e=new tp({file:e.file,context:this,key:t},this.config),func:e.start,arg:{},key:t,index:3,stage:"process"},this._addTask(t,e)}},{key:"_addStreamUploadTask",value:function(e,t){this.streamUploadTask=new tA({context:this,key:t},this.config);var r={context:this.streamUploadTask,func:this.streamUploadTask.start,arg:{},key:t,index:3,stage:"process"};this._addTask(t,r)}},{key:"_mergeFileTask",value:function(e,t){e={context:e=new tS({file:e.file,context:this,stage:"fileMerge",key:t},this.config),func:e.start,arg:{},key:t,index:4,stage:"fileMerge"},this._addTask(t,e)}},{key:"_getMetaInfoTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=r.isImageBatchUpload,r=r.skipCommit,i={file:e.file,context:this,data:e.data,type:e.type||ec,callbackArgs:e.callbackArgs,objectSync:e.objectSync,needExactFormat:e.needExactFormat,key:t,isImageBatchUpload:void 0!==i&&i,skipCommit:void 0!==r&&r,serviceType:e.serviceType||null},r=new tL(i,this.config),e={context:r,func:r.start,arg:{},key:t,index:5,stage:"complete"};this._addTask(t,e)}},{key:"_addAllUploadProcess",value:function(e,t){var r=e.type===eu&&"[object Array]"===Object.prototype.toString.call(e.file),i=(this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||ec,this.tasks[t]Task(e,t,{isDirect:i,isImageBatchUpload:r}),this._addPreUploadTask(e,t,{isDirect:i,isImageBatchUpload:r}),i?this._addDirectUploadTask(e,t,{isImageBatchUpload:r}):(this._addInitUploadIDTask(e,t),this._addUploadProcessTask(e,t),this._mergeFileTask(e,t)),!(!this.config.skipCommit||eq.checkServiceName(e.type,this.config)!==eh));this._getMetaInfoTask(e,t,{isImageBatchUpload:r,skipCommit:i})}},{key:"_addAllUploadProcessClientEncrypt",value:function(e){var t,r=this;return e.type===eu&&Array.isArray(e.file)?(t=[],e.file.forEach(function(i){t.push(r._createClientEncryptTask({stsToken:e.stsToken,type:e.type,file:i}))}),t):this._createClientEncryptTask(e)}},{key:"_createClientEncryptTask",ocessTask(e,t,{isDirect:!1,isIoadIDTask(e,t),this._addUploadProcesmmit||eq.checkServiceName(e.type,this.config)!==eh));return this._getMetaInfoTask(e,t,{isImageBatchUpload:!1,skipCommit:r}),t}},{key:"_addAllStreamUploadProcess",value:function(e,t){this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||ec,this.tasks[t].proxyStsToken=e.stsToken,this._addPreUploadTask(e,t),this._addInitUploadIDTask(e,t),this._addStreamUploadTask(e,t),this._mergeFileTask(e,t),this._getMetaInfoTask(e,t)}},{key:"_addStreamSlice",value:function(e){var t=e.fileSlice,e=e.index;this.streamUploadTask.addStreamSlice({fileSlice:t,index:e})}},{key:"_completeStreamUpload",vavigator.userAgent.toLowerCase().match(/msie ([\d.]+)/);i&&i[1]&&9>=Number(i[1])?(this._broadcast("error",tY(r[e],{key:e,status:0ser below ie10"},type:"error"})),this.logger.send(r[e]),this._cancel(e)):r[e]&&(3===r[e].status?this._restart(e):(r[e].startTime=(new Date).getTime(),r[e].task&&1!==r[e].status&&r[e].task.tasks.length&&(r[e].status=1,this.logger.send(tY({},r[e],{extra:{message:"start upload"},type:"start",key:e})),r[e].task.start(t))))}},{key:"_selectRoute",value:function(e,t){new ez({stsToken:this.lastStsToken,context:this,type:ec,file:this.lastFile},this.config).start(e,t)}},{key:"_restart",value:function(e){var t,r,i=this,n=this.tasks;n[e]&&(t=n[e].task,r=n[e].currentTask||0,this.taskList[e].forEach(fuaskList[e])}},{key:"_pause",value:function(e){var t=this.tasks;t[e]&&(t[e].status=3,t[e].task.cancel(!0),t[e].isDirect||this._saveTask(e))}},{key:"_removeTaskCache",value:function(e){var t=this.tasks;t[e]&&(t=t[e].crc3:"_saveTask",value:function(e,t){if(t=(e=tY({},this.tasks[e],t||{})).crc3(t,this.serializeCacheInfo(e))}catch(e){}}},{key:"serializeCacheInfo",value:function(e){var t="";delete e.task,delete e.xhr,delete e.crc32Array;try{t=JSON.stringify(e)}catch(i){var r={};Object.keys(e).forEach(function(t){"task"!==t&&"xhr"!==t&&"crc32Array"!==t&&(r[t]queueSuccess",value:functr[e])}},{key:"_removeFile"on(i){var i=r[i],n=tY({},{key:"_getOption",value:function(e){var t=tY({},this.config);return Object.keys(t).forE.push.apply(i,r)),i}function t8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?t6(Object(r),!0).forEach(function(t){var i,n;i=t,n=r[t],(i=t9(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Objectable=!0,"value"inTypeError("@@toPrimittypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var rr=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&re(e,t)}(n,t4);var e,t,r,i=(e=fuoolean.prototype.valueOf.cal 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=rt(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function n(){return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),i.apply(this,arguments)}return t=[{key:"start",value:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.abort=!1,r.selectRoute?this._selectRoute(r,function(r){r=t8(t8({},r),{},{enableSelectRoute:!0}),e?t._run(e,r):t._batchAction(t._run.bind(t),r)}):e?this._run(e):this._batchAction(this._run.bind(this))}},{key:"addFile",value:function(e){var t;return e&&eq.checkStsToken(e.stsToken)?e.file&&this.config.clientEncrypt?this._addAlls(e,t),t):null:(this.emit("error",{ll)}},{key:"addImageFile"q.checkStsToken(e.stsToken)?e.file?(e.type=e.type||eu,t=eb.getUnique("file"),this._addAllUploadProcess(e,t),t):null:(this.emit("error",{extra:{message:eF,errorCode:1000002}}),nutsToken(e.stsToken)?(t=eb.getUnique("file"),this._addAllStreamUploadProcess(e,t),t):(this.emit("error",{extra:{message:eF,errorCode:1000002}}),null)(e){var t=e.fileSlice,e=e.index;this._addStreamSlice({fileSlice:t,index:e})}},{key:"completeStreamUpload",value:function(){this._completeStreamUpload()}},{keyr.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:r.t=function(e,t){if(1&t&&(e=r(e)),8&t||4&t&&"object"==typeof e&&e&&e.__eumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i=function(e){var t=e&&e.__y:function(e,t,r){return Function.prototype.apply.call(e,t,r)},o=i&&"function"==typeof i.ownKeys?i.ownKeys:Objecta.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise(function(r,i){function n(r){e.removeListener(t,o),i(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&"function"==typeof e.on&&g(e,"error",n,{once:!0})})},(a.EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function f(e,t,r,i){var n,o;return u(r),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,r.listener||r),n=e._events),o=n[t]),void 0===o?(o=n[t]=r,++e._eventsCount):("function"==typeof o?o=n[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),0<(n=l(e))&&o.length>n&&!o.warned&&(o.warned=!0,(ied. Use emitter.se[t])?[]:"function"==typeof e?r?[e.listener||e]:[e]:r?function(e){for(var t=Array(e.len!==t)retuf e.addEventListener)throw Tperty(a,"defaultMaxListenerson(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Recers=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var te,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){if((s=0<t.length?t[0]:s)instanceof Error)throw s;throw(i=Error("Unhandled error."+(s?" ("+s.message+")":""))).context=s,i}var s=o[e];if(void 0===s)return!1;if("function"==typeof s)n(s,this,t);else for(var a=s.length,c=y(s,a),r=0;r<a;++r)n(c[r],this,t);return!0},a.prototype.on=a.prototype.addListener=function(e,t){return f(this,e,t,!1)},a.prototype.prependListener=fuion(e,t){return u(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},a.prototype.off=a.prototype.removeListener=function(e,t){var r,i,n,o,s;if(u(t),void 0===(i=this._events)||void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,o=r.length-1;0<=o;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,n=o;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.removeAllListeners=function(e){var t,r=this._events;if(void 0===r)return this;in 0==arguments.l_eventsCount?this._events=Object.create(null):deletys(r),o=0;o<n.length;++o)"removeListener"!==(i=n[o])&&this.removstener(e,t);else if(void 0!==t)for(o=t.length-1;0<=o;o-urn p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},a.prototype.listenerCount=d,a.prototype.eventNames=function(){return 0<this._eventsCount?o(this._events):[]}},function(e,t,r){(function(t){e.exports=function(){"use strict";function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self;var i=r(function(e,t){var r,i,n,o,s,a,c,u,l,f,h,p,d;e.exports=r|{var r;return e.prototype=t,r=new e,e.prototype=null,r}}()ar e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<n;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-(i+o)%4*8}else for(o=0;o<n;o+=4)t[i+o>>>2]=r[o>>>2];return this.sigBytes+=n,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=i.ceil(t/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,r=[],n=function(e){var t=987654321;return function(){var r=((t=36969*(65535&t)+(t>>16)&4294967295)<<16)+(e=18e3*(65535&e)+(e>>16)&4294967295)&4294967295;return r/=4294967296,(r+=.5)*(i.random()>.5?1:-1)}},o=0;o<e;o+=4){var s=n(4294967296*(t||i.random()));t=987654071*s(),r.push(4294967296*s()|0)}return new c.init(r,e)}}),l=(u=o.enc={}).Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(r,t/2)}},f=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(r,t)}},h=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},p=s.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,r=t.words,n=t.sigBytes,o=this.blockSize,s=n/(4*o),a=(s=e?i.ceil(s):i.max((0|s)-this._minBufferSize,0))*o,u=i.min(4*a,n);if(a){for(var l=0;l<a;l+=o)this._doProcessBlock(r,l);var f=r.splice(0,a);t.sigBytes-=u}return new c.init(f,u)},clone:function(){var e=a.clone.call(thction(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e+}(),l=[],f=t+p];else{var d=l[p-15],y=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,g=l[p-2],m=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;l[p]=y+l[p-7]+m+l[p-16]}var v=i&n^i&o^n&o,b=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),_=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&f)+u[p]+l[p];h=f,f=c,c=a,a=s+_|0,s=o,o=n,n=i,i=_+(b+v)|0}r[0]=r[0]+i|0,r[1]=r[1]+n|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0,r[5]=r[5]+c|0,r[6]=r[6]+f|0,r[7]=r[7]+h|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=r.floor(i/4294967296),t[15+(n+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA256=s._createHelper(f),i.HmacSHA256=s._createHmacHelper(f,n;e.expor,void(i:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),._{hmac:function(e,t){return o(t,e)},sha256:funresigned-expires","expect","x-amzn-trace-id"],c="aws4_request",u=function(e){try{return encodeURIComponent(e).replace(/[^A-Za-z0-9_.~\-%]+/g,escape).replace(/[*]/g,function(e){return"%".concat(e.charCodeAt(0).toString(16).toUpperCase())})}catch(e){return""}},l=functi.sort().join("&".concat(i,"="))):"".concat(i,"=").concat(u(r))}}).filter(function(e){return e}).join("&")};return function(){var t,r;function i(e,t,r){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,i),this.request=e,this.request.headers=e.headers||{},this.serviceName=t,r=r||{},this.signatureCache="boolean"!=typeof r.signatureCache||r.signatureCache,this.operation=r.operation,this.signatureVersion=r.signatureVersion}return t=[{key:"addAuthorization",value:function(e,t){var r=this.iso8601(t).replace(/[:\-]|\.\d{3}/g,"");this.addHeaders(e,r),this.request.headers.Authorization=this.authorization(e,r)}},{key:"addHeaders",value:function(e,t){this.request.headers["X-Amz-Date"]=t,e.sessionToken&&(this.request.headers["x-amz-shorization",value:function(e,t,value:function(e,t){var r=this.getSigningKey(e,t.substr(0,8),this.request.region,this.serviceName,tgToSign( t.push("AWS4-HMAC-SHA256"),t.push(e),t.push(this.credentialString(e)),t.push(this.hexEncodedHash(this.canonicalString())),t.join("\n")}},{key:"canonicalString",value:function(){var e=[],t=this.request.pathname||"/";return e.push(this.request.method.toUpperCase()),e.push(t),e.push(l(this.request.params)||""),e.push("".concat(this.hexEncodedBodyHash()),t.sort(function(e,t){return e[0].toLowerCase();if(e.isSignab=n||"function"!=typeof n.toString)throw Error("Header ".concat(i," contains invalid value"));r.push("".concat(i,":").concat(e.canonicalHeaderValues(n.toString())))}}),r.join("\n")}},{key:"canonicalHeaderValues",value:function(e){return e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")}},{key:"signedHeaders",value:function(){var e=this,t=[];return Object.&&t.push(r)}),t.sort().join(";")}},{key:"credentialString",value:function(e){return this.createScope(e.substr(0,8),this.request.region,this.serviceName)}},{key:"hexEncodxEncodedBodyHash",value:function(){return this.request.h.enc;var v=n.Utf8;var i=r.algo;var a=i.HMAC=t.extend({init:function(r,e){r=this._hasnalize(e);e.clamp();var i=this._oKe._hashepdate(r);return this},fi n}})}a,c,u,l,f,h,p,d,y;e.exports=y|prototype{}).libeturn t)&&(tne:function(){return this.init.prototype.extend(this)}},c=s.WordArray=a.exte){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<n;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-e.leng t,r=[],n=function(e){vrn r/=(4294967296*s()|0)}re){var ((15&o).toString(16))}return i.join("")},par[i>>>3]|{for(var y:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){retueredBlata=new=typeof esigBytes},_process:functiono),a=(s=e?i.ceil(sa;l+=o)this._doProcessBlock(r,l);var f=r.splice(0,a);t.sigBytes-=u}return new c.init(f,u)},clone:function(){var e=a.clone.call(function(e){return this._append(e),this._pthis._append(e), c=[],u=o.SH;else{17)^(g<<13|g>>>19)^g>>>10;c[p]=y+c[p-7]+m+c[p-16]}var v=u&l^~u&f,b=i&n^i&o^n&o,_=(i<.reset(),t.finalize(this._oKey.clone().concat(r))}})=function(){return this}();try{r=r||Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var i=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(i.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(t)retu{var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(i=o.next()).done;)s.push(i.value)}catch(e){n={error:e}}final,r.off(e,i)})},e.prototype.off=function(e,t){e&&this._hooks[e]&&this._hooks[e].leng,escape);var a,c="";for(ao[a]&&(c+="="+o[a].split("=t+"="+r+c}}functionument){for(var n={},o=dit("; "):[],s=0;s<o.length;s++){var a=o[s].split("="),c=a.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=t(a[0]),c=(i.read||i)(c,u)||t(c);if(r)try{c=JSON.parse(c)}catch(e){}if(n[u]=c,e===u)break}catch(e){}}return e?n[e]:n}}return n.set=o,n.get=function(e){return s(e,!1)},n.getJSON=function(e){return s(e,!0)},n.remove=function(t,r){o(t,"",e(r,{expires:-1}))},n.defaults={},n.withConverter=r,n}(function(){})}(),t.exports),his.cache[type.getCookie=function(e){this.getItem(e)},e.prototype.setCookie=function(e,t){this.setItem(e,t)},e}(),g={getItem:function(e){try{var t=localStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.paem(e,r)}ry{return d.get(e,{domain:t||document.domain})}catch(e){return""}},setCookie:f|document.xpires:new Date(oangers.setItem(e,t)}tem("_ranger-test-key"),!0}catch(e){return!1}}()},v=function(){function e(e,t){this._storage=t&&"session"===t?m:!e&&g.isSupportLS?g:new y}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,r,i){this._storage.setCookie(e,t,r,i)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),b=function(){function e(e,t,r){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=r}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,r=document.referrer,i=r?c(r).hostname:"",n=u(window.location.href),o=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web",n=(this.utm=function(e,t,r,i){var n=new v(!1),o=new v(!1,"session"),s=e?"_tea_utm_cache_"+e:"_tea_utm_cache",a=e?"_$utm_from_url_"+e:"_$utm_from_url",c={},u=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],l={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var f,h,p=!1;for(f in l)l[f]&&(-1!==u.indexOf(f)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[f]=l[f]):c[f]=l[f],p=!0);p?(o.setItem(a,"1"),n.setCookie(s,JSON.stringify(c),i,r)):(h=n.getCookie(s,r))&&(c=JSON.parse(h)),o.getItem(a)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return l}return c}(this.appid,n,this.domain,this.cookie_expire),this.browser()),s=this.os();return{browser:n.browser,browser_version:n.browser_version,platform:o,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:r,referrer_host:i,utm:this.utm,latest_data:this.last(r,i)}},e.prototype.last=function(e,t){var r="",i="",n="",o=location.hostname,s=!1;return e&&t&&o!==t&&(i=t,s=!0,(o=u(r=e)).keyword&&(n=o.keyword)),{$latest_referrer:r,$latest_referrer_host:i,$latest_search_keyword:n,isLast:s}},e.prototype.browser=function(){var e,t="",r=""+parseFloat(this.appVersion),i=this.userAgent;return -1!==i.indexOf("Edge")||-1!==i.indexOf("Edg")?(t="Microsoft Edge",r=-1!==i.indexOf("Edge")?(e=i.indexOf("Edge"),i.substring(e+5)):(e=i.indexOf("Edg"),i.substring(e+4))):-1!==(e=i.indexOf("MSIE"))?(t="Microsoft Internet Explorer",r=i.substring(e+5)):-1!==(e=i.indexOf("Lark"))?(t="Lark",r=i.substring(e+5,e+11)):-1!==(e=i.indexOf("MetaSr"))?(t="sougoubrowser",r=i.substring(e+7,e+10)):-1!==i.indexOf("MQQBrowser")||-1!==i.indexOf("QQBrowser")?(t="qqbrowser",-1!==i.indexOf("MQQBrowser")?(e=i.indexOf("MQQBrowser"),r=i.substring(e+11,e+15)):-1!==i.indexOf("QQBrowser")&&(e=i.indexOf("QQBrowser"),r=i.substring(e+10,e+17))):-1!==i.indexOf("Chrome")?-1!==(e=i.indexOf("MicroMessenger"))?(t="weixin",r=i.substring(e+15,e+20)):-1!==(e=i.indexOf("360"))?(t="360browser",r=i.substring(i.indexOf("Chrome")+7)):-1!==i.indexOf("baidubrowser")||-1!==i.indexOf("BIDUBrowser")?(-1!==i.indexOf("baidubrowser")?(e=i.indexOf("baidubrowser"),r=i.substring(e+13,e+16)):-1!==i.indexOf("BIDUBrowser")&&(e=i.indexOf("BIDUBrowser"),r=i.substring(e+12,e+15)),t="baidubrowser"):-1!==(e=i.indexOf("xiaomi"))?r=-1!==i.indexOf("openlanguagexiaomi")?(t="openlanguage xiaomi",i.substring(e+7,e+13)):(t="xiaomi",i.substring(e-7,e-1)):-1!==(e=i.indexOf("TTWebView"))?(t="TTWebView",r=i.substring(e+10,e+23)):-1===(e=i.indexOf("Chrome"))&&-1===(e=i.indexOf("Chrome"))||(t="Chrome",r=i.substring(e+7)):-1!==i.indexOf("Safari")?-1!==(e=i.indexOf("QQ"))?(t="qqbrowser",r=i.substring(e+10,e+16)):-1!==(e=i.indexOf("Safari"))&&(t="Safari",r=i.substring(e+7),-1!==(e=i.indexOf("Version"))&&(r=i.substring(e+8))):-1!==(e=i.indexOf("Firefox"))?(t="Firefox",r=i.substring(e+8)):-1!==(e=i.indexOf("MicroMessenger"))?(t="weixin",r=i.substring(e+15,e+20)):-1!==(e=i.indexOf("QQ"))&&(t="qqbrowser",r=i.substring(e+3,e+8)),{browser:t,browser_version:r=-1!==(i=(r=-1!==(i=(r=-1!==(i=r.indexOf(";"))?r.substring(indows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],o=0;o<n.length;o++){var s=n[o];if(s.r.test(this.userAgent)){"Mac OS X"===(r=s.s)&&this.isNewIpad()&&(r="iOS");break}}function a(e,t){return(e=e.exec(t))&&e[1]?e[1]:)/,e=this.userAgent))?rAgent):(i=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?i[1]+"."+i[2]+"."+(0|i[3]):"",r="ios"}return{os_name:r,os_version:i}},e.prototype.getDeviceModel=function(e){var t,r,i="";try{"android"===e?navigator.userAgent.split(";").forEach(function(e){-1<e.indexOf("Build/")&&(i=e.slice(0,e.indexOf("Build/")))}):"ios"!==e&&"mac"!==e&&"windows"!==e||(i=this.isNewIpad()?"iPad":(r=(t=navigator.userAgent.replace("Mozilla/5.0 (","")).indexOf(";"),t.slice(0,r)))}catch(e){}return i.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&1<navigator.maxTouchPoints},e}(),_={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},S="5.0.23_3",w=void 0,t=(new Date).getTimezoneOffset(),k=parseInt(""+-t/60,10),x=60*t,O=function(){function e(e){this.is_first_time=!0,this.configPersist=!1,this.initConfig=e;var t=new b(e.app_id,e.cookie_domain||"",e.cookie_expire||6048e5).init(),r="__tea_cache_first_"+e.app_id;this.configKey="__tea_cache_config_"+e.app_id,this.sessionStorage=new v(!1,"session"),this.localStorage=new v(!1,"local"),e.configPersist&&(this.configPersist=!0,this.storage=1===e.configPersist?this.sessionStorage:this.localStorage),this.localStorage.getItem(r)?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(r,"1")),this.envInfo={user:{user_unique_id:w,user_type:w,user_id:w,user_is_auth:w,user_is_login:w,device_id:w,web_id:w,ip_addr_id:w},header:{app_id:w,app_name:w,app_install_id:w,install_id:w,app_package:w,app_channel:w,app_version:w,os_name:t.os_name,os_version:t.os_version,device_model:t.device_model,ab_client:w,traffic_type:w,client_ip:w,device_brand:w,os_api:w,access:w,language:t.language,region:w,app_language:w,app_region:w,ab_version:w,creative_id:t.utm.creative_id,ad_id:t.utm.ad_id,campaign_id:t.utm.campaign_id,log_type:w,rnd:w,platform:t.platform,sdk_version:S,sdk_lib:"js",province:w,city:w,timezone:k,tz_offset:x,tz_name:w,sim_region:w,carrier:w,resolution:t.screen_width+"x"+t.screen_height,browser:t.browser,browser_version:t.browser_version,referrer:t.referrer,referrer_host:t.referrer_host,width:t.screen_width,height:t.screen_height,screen_width:t.screen_width,screen_height:t.screen_height,utm_term:t.utm.utm_term,utm_content:t.utm.utm_content,utm_source:t.utm.utm_source,utm_medium:t.utm.utm_medium,utm_campaign:t.utm.utm_campaign,tracer_data:JSON.stringify(t.at_unionid:w,wechat_openid:w}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.initDomain()}return e.prototype.initDomain=function(){var e=this.initConfig.channel_domain;e?this.domain=e:(e=this.initConfig.channel,this.domain=function(e,t){if("string"==typeof e&&"number"==typeof t){for(var r=[],i=String.fromCharCode((t=t<=25?t:t%25)+97),n=e.split(i),o=0;o<n.length;o++){var s=64^+parseInt(n[o],t),s=String.fromCharCode(s);r.push(s)}return r.join("")}}(_[e],25))},e.prototype.setDomain=function(e){this.domain=e},e.prototype.getDomain=function(){return this.domain},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||"/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid"}return e="",this.initConfig.caller&&(e="?sdk_version="+S+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+e},e.prototype.set=function(e){var t=this;Object.keys(e).forEach(function(r){var i,n,s;void 0!==e[r]&&null!==e[r]||t.delete(r),"evtParams"===r?t.evtParams=o({},t.evtParams||{},e.evtParams||{}):"_staging_flag"===r?t.evtParams=o({},t.evtParams||{},{_staging_flag:e._staging_flag}):"reportErrorCallback"===r&&"function"==typeof e[r]?t.reportErrorCallback=e[r]:(s=n="",-1<r.indexOf(".")&&(n=(i=r.split("."))[0],s=i[1]),n?"user"===n||"header"===n?t.envInfo[n][s]=e[r]:t.envInfo.header.custom[s]=e[r]:t.envInfo.user.hasOwnProperty(r)?-1<["user_type","ip_addr_id"].indexOf(r)?t.envInfo.user[r]=e[r]&&Number(e[r]):-1<["user_id","web_id","user_unique_id"].indexOf(r)?t.envInfo.user[r]=e[r]&&String(e[r]):-1<["user_is_auth","user_is_login"].indexOf(r)?t.envInfo.user[r]=!!e[r]:"device_id"===r&&(t.envInfo.user[r]=e[r]):t.envInfo.header.hasOwnProperty(r)?t.envInfo.header[r]=e[r]:t.envInfo.header.custom[r]=e[r])})},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:this.envInfo.user.hasOwnProperty(e)?this.envInfo.user[e]:this.envInfo.header.hasOwnProperty(e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.prototype.setStore=function(e){try{if(!this.configPersist)return;var t,r=this.storage.getItem(this.configKe.length&&(t=Object.assign(e,r),this.storage.setItem(this.configKey,t))}catch(e){}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey);return e&&Object.keys(e).length?e:null}catch(e){return null}},e.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey);t&&t.hasOwnProperty(e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){}},e}(),C=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog},e.prototype.warn=function(e){this.isLog},e.prototype.error=function(e){this.isLog},e.prototype.throw=function(e){throw this.error(this.name),Error(e)},e}(),T=((f=L=L||{}).Init="init",f.Config="config",f.Start="start",f.Ready="ready",f.TokenComplete="token-complete",f.TokenStorage="token-storage",f.TokenFetch="token-fetch",f.TokenError="token-error",f.ConfigUuid="config-uuid",f.ConfigWebId="config-webid",f.ConfigDomain="config-domain",f.CustomWebId="custom-webid",f.TokenChange="token-change",f.TokenReset="token-reset",f.ConfigTransform="config-transform",f.EnvTransform="env-transform",f.SessionReset="session-reset",f.SessionResetTime="session-reset-time",f.Event="event",f.Events="events",f.EventNow="event-now",f.CleanEvents="clean-events",f.BeconEvent="becon-event",f.SubmitBefore="submit-before",f.SubmitScuess="submit-scuess",f.SubmitAfter="submit-after",f.SubmitError="submit-error",f.SubmitVerify="submit-verify",f.Stay="stay",f.ResetStay="reset-stay",f.StayReady="stay-ready",f.SetStay="set-stay",f.RouteChange="route-change",f.RouteReady="route-ready",f.Ab="ars="ab-all-vars",f.AbConfig="ab-config",f.AbExternalVersion="ab-external-version",f.AbVersionChangeOn="ab-version-change-on",f.AbVersionChangeOff="ab-version-change-off",f.AbOpenLayer="ab-open-layer",f.AbCloseLayer="ab-closy",f.AbComplete="ab-complete",f.Profile="profile",f.ProfileSet="profile-set",f.ProfileSeofile-append",f.ProfileClear="profile-clear",f.Autotrack="autotrack",f.AutotrackReady="autotrack-ready",f.CepReady="cep-ready",f.TracerReady="tracer-ready",L),E=function(){function e(e)rn!!this.native&&!!AppLogBridge}catch(e){return!1}},t.bridgeReady=function(){var e=this;retppLogBridge.)}})},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach(function(r){"user_unique_id"===r?t.setUserUniqueId(e[r]):config[r]?t.addHeaderInfo(r,e[r]):t.removeHeaderInfo(r)})}catch(e){}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){}},t.addHeaderInfo=function(e,t){try{AppLoction(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEvene=function(e){try{AppLogBrid}},t.profil.profileIncrement(e)}catch(e){}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){}},e}(),D={XHR_ON:500,TIMEOUT:5005};function j(e,t,r,i,n,o,s,a){try{var c=new XMLHttpRequest;c.open(a||"POST",""+e,!0),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),s&&c.setRequestHeader("X-thCredentials=!0),c.onload=function(){if(n){var e=null;if(c.responseText){try{e=JSON.parse(c.responseText)}catch(t){e={}}n(e,t)}}},r&&(c.timeout=r,c.ontimeout=function(){o&&o(t,D.TIMEOUT)}),c.onerror=function(){c.abort(),o&&o(t,D.XHR_ON)},c.send(JSON.stringify(t))}catch(e){}}function P(e,t,r,i){try{var n=e.match(/\/v\d\//),o=n?n[0]:-1!==e.indexOf("/v1/")?"/v1/":"/v2/",s=e.split(o)[0];if(!s)return void i(e,t,R);t.forEach(function(n){var n=function(e){var t,r="";flice(1):r}(n),o=new Image(1,1);o){var a=window.navigator.userAgent;i&-1===a.indexOf("MSIE 9.0")){if(s)return window.navigator&&window.navigator.sendBeacon?window.navigator.sendBeacon(e,JSON.stringify(t))?n():o(e,t,4003):P(e,t,n,o)}else P(e,t,n,o);j(e,t,r,i,n,o)}function A(){return(function e(t){return t?(t^16*Math.random()>>t/4).toString(10):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e)})().replace(/-/g,"").slice(0,19)}function z(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var R=4001,B=4e3,U=4002,M=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCs;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new v(!0),this.localStorage=new v(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.tiT.ConfigDomain,functio}),this.collect.on(T.Event,function(e){r.event(e)}),this.collect.on(T.BeconEvent,function(e){r.beconEvent(e)}),this.collect.on(T.CleanEvents,function(){r.reportAll(!1)}),this.linster()},e.prototype.linster=function(){var e,t=this;window.addEventListener("unload",function(){t.reportAll(!0)userAgent.match(/\(i[^;]+;( U;)? CPU.+Mtotype.event=function(e)imeout),i.length>=tcheStorgae.setItem(thison=function(){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},e.prototype.report=function(e){var t;!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(t=this.cacheStorgae.getItem(this.eventKey)||[]).length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var r=0;r<e.length;r+=this.eventLimit){var i=e.slice(r,r+this.eventLimit),n=this.split(this.merge(i));this.send(n,t)}else n=this.split(this.merge(e)),this.send(n,t)},e.prototype.merge=function(e){var t=this,r=this.configManagis.configManager.get("evtParams")),r=e.map(function(e){Object.keys(s).length&&(e.params=o({},s,e.params));var r=t.localStorage.getItem(t.abKey);return r&&r.uuid&&r.uuid===n.user_unique_id&&t.configManager.getAbVersion()&&(e.ab_sdk_version=t.configManager.getAbVersion()),e.session_id=t.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}),e=JSON.parse(JSON.stringify({events:r,user:n,header:i})),r=(e.local_time=Math.floor(Date.now()/1e3),e.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,[]);return r.push(e),r},e.prototype.split=function(e){return e.map(function(e){var t=[];return t.push(e),t})},e.prototype.send=function(e,t){vi=r.config.filter(i)),r.(e){}})},e}(),F=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new v(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(T.ConfigU,function(e){r.setWebId(e)}),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.c}):this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(T.CustomWebId,function(){t.tokenReady=!0,t.collect.emit(T.TokenComplete)}):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:A(),user_unique_id:this.configManager.get("user_unique_id")||A()}):this.remoteWebid()},e.prototype.indow.navigator.userAgear e=this;j(this.configManomplete({web_id:e.configManager.get("web_id")||t.web_id,user_unique_id:e.configManager.get("user_unique_id")||t.web_id}):e.collect.emit(T.TokenError)},function(){e.collect.emit(T.TokenError)})},e.prototype.complete=function(e){var t=e.web_id,r=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:r}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(T.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e=r||(this.configManag!this.config.enable_ttwebid&&(this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),),t=this.configManager.get("web_id"),(r=this.configManager.get("user_unique_id"))&&r!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(T.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(T.TokenChange,"Storage=function(e){e.bleCustomWebid?"custom":new Promise(function(r){j(t,{apptype.apply=function(e,t){function(){r.resetSessionunction(){var e,t=this.state.now(),this.storage.setIhis.storage.getItem(tTime)},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return!this.disableSession&&e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.resetSessionId=function(){var e={sessionId:z(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:z(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}(),H={autotrack:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/route.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/cep.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{sr-us/log-sdk/collect/5.this.adapters={},this.name=e,this.hook=new p,this.logger=new C(e),this.remotePlugin=new Map,this.Types=T,this.adapters.fetch=j,this.adapters.storage=v}return e.usePlugin=function(t,r,i){if(r){for(var n=!1,o=0,s=e.plugins.length;o<s;o++)if(e.plugins[o].name===r){e.plugins[o].plugin=t,e.plugins[o].options=i||{},n=!0;break}n||e.plugins.push({name:r,plugin:t,options:i})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,r){e&&(t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:r}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instaugin.set(e,"sdk"))},e.prototype.init=fun"!=typeof t.app_key||(t.channel_domain||-1!==["cn","sg","va"].indexOf(t.channel)||(t.channel="cn"),this.appBridge=new E(t.Native),this.bridgeReport=this.appBridge.bridgeInject(),this.config.bridgeReport||(thier.set({app_id:t.app.sessionManager=new N,Promise.all([new Promise(function(e){i.once(T.TokenComplete,function(){e(!0)})}),new Promise(function(e){i.once(T.Start,function(){e(!0)})})]).then(function(){try{e.plugins.reduce(function(e,t){var r=t.plugin,t=t.options,t=Object.assign(i.initConfig,t),r=new r;return r.apply(i,t),e.push(r),e},i.pluginInstances)}catch(e){}i.sdkReady=!0,i.emit(T.Ready);try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){}t.disable_auto_pv||i.pageView(),i.on(T.TokenChange,function(e){"webid"===e&&i.pageView()}),i.on(T.TokenReset,function(){}),i.on(T.RouteChange,function(e){e.init||t.disable_route_report||i.pageView()})}),this.tokenManager.apply(this,t),this.eventManager.apply(this,t),this.sessionManager.apply(this,t),this.emit(T.Init)),this.inited=!0))},e.prototype.config=function(e){var t,r;this.inited?e&&a(e)?this.bridgeReport?this.appBridge.setConfig(e):(e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv),t=o({},e),this.initConfig&&this.initConfig.configPersist&&((r=this.configManager.getStore())&&(t=Object.assign(r,e)),this.configManager.setStore(e)),t.web_id,t.user_unique_id,r=function(e,t){var r={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&(r[n[i]]=e[n[i]]);return r}(t,["web_id","user_unique_id"]),t.hasOwnProperty("web_id")&&this.emit(T.ConfigWebId,t.web_id),t.hasOwnProperty("user_uniques.configManager.set(r)):this.logger.warn("config params is error, please check"):this.logger.warn("config must be use after function init")},e.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(T.ConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(T.Start))},e.prototype.event=function(e,t){var r=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var i=[];Array.isArray(e)?e.forEach(function(e){i.push(r.processEvent(e[0],e[1]||{}))}):i.push(this.processEvent(e,t)),this.bridgeReport?i.forEach(function(e){var t=e.event,e=e.params;r.appBridge.onEventV3(t,JSON.stringify(e))}):i.length&&(this.emit(T.Event,i),this.emit(T.SessionResetTime))}catch(e){}},e.prototype.beconEvent=function(e,t){var r;this.initConfig&&this.initConfig.disable_track_event||Array.isArray(e)||((r=[]).push(this.processEvent(e,t||{})),r.length&&(this.emit(T.BeconEvent,r),this.emit(T.SessionResetTime)))},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var r=e,i=(/^event\./.test(e)&&(r=e.slice(6)),t),n=void((i="object"!=typeof i?{}:i).peventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,r){this.hook.emit(e,t,r)},e.prototype.set=function(e){this.hook.set(e)},e.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){void 0===e&&(e={});var t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+this.configManager.is_first_time},t=o({},t,e);this.event("predefine_pageview",t)},e.prototype.clearEventCache=function(){this.emit(T.CleanEvents)},e.prototype.setWebIDviaUnionID=function(e){var t;e&&(t=l(e),this.config({web_id:""+t,wechat_unionid:e}),this.emit(T.CustomWebId))},e.prototype.setWebIDviaOpenID=function(e){var t;e&&(t=l(e),this.config({web_id:""+t,wechat_openid:e}),this.emit(T.CustomWebId))},e.prototype.resetStayDuration=function(e,t,r){this.emit(T.ResetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:r=void 0===r?"":r},T.Stay)},e.prototype.resetStayParams=function(e,t,r){this.emit(T.SetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:r=void 0===r?"":r},T.Stay)},e.prototype.getToken=function(e,t){function r(t){var r;s||(s=!0,r=n.configManager.get().user,t&&(r.tobid=t,r["diss".split("").reverse().join("")]=t),e(o({},r)))}function i(){n.tokenManager.getTobId().then(function(e){r(e)})}var n=this,s=!1;this.sdkReady?i():(t&&setTimeout(function(){r()},t),this.on(T.Ready,function(){i()}))},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(T.ProfileSet,e,T.Profile)},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(T.ProfileSetOnce,e,T.Profile)},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(T.ProfileIncrement,e,T.Profile)},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(T.ProfileUnset,e,T.Profile)},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(T.ProfileAppend,e,T.Profile)},e.prototype.setExternalAbVersion=function(e){this.emit(T.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,T.Ab)},e.prototype.getVar=function(e,t,r){this.emit(T.AbVar,{name:e,defaultValue:t,callback:r},T.Ab)},e.prototype.getABconfig=function(e,t){this.emit(T.AbConfig,{param:e,callback:t},T.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(T.AbVersionChangeOn,e,T.Ab),function(){t.emit(T.AbVersionChangeOff,e,T.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(T.AbVersionChangeOff,e,T.Ab)},e.prototype.openOverlayer=functi(T.AbCloseLayer,"",T.Ab)},e.prototype.getAllVars=function(e){this.emit(T.AbAllVars,e,T.Ab)},e.prototype.autoInitializationRangers=function(e){var t=e.app_id,r=e.channel,i=e.onTokenReady,e=_[r]+"/webid",n=new v(!1),o="__tea_cache_tokens_"+t;(r=n.getItem(o))&pp_key:"",app_id:t,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,function(e){e&&0===e.e?(i(e.web_id),e={web_id:e.web_id,user_unique_id:e.web_id,timestamp:Date.now()},n.setItem(o,e)):i("")},function(){i("")},!0)},e.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(T.TokenComplete))},e.plugins=[],e}(),L=function(){function e(){}return e.prototype.apply=function(e,t){var r=this,i=e.adapters.fetch;t.event_verify_url&&"string"==typeof t.event_verify_url&&(this.url=t.event_verify_url+"/v1/list_test",this.url&&(t=e.Types,e.on(t.SubmitBefore,function(e){i(r.url,e,3e4)})))},e}(),G=function(){function e(){}return e.prototype.apply=function(e,t){var r=this,t=(this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list",e.Types),e=e.adapters.fetch;this.fetch=e,this.cache={},this.collect.on(t.ProfileSet,function(e){r.setProfile(e)}),this.collect.on(t.ProfileSetOnce,function(e){r.setOnceProfile(e)}),this.collect.on(t.ProfileUnset,function(e){r.unsetProfile(e)}),this.collect.on(t.ProfileIncrement,function(e){r.incrementProfile(e)}),this.collect.on(t.ProfileAppend,function(e){r.appendProfile(e)}),this.collect.on(t.ProfileClear,function(){r.cache={}}),this.ready(t.Profile)},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(Object.keys(r).length)for(var i in r)!function(e){r[e].length&&r[e].forEach(function(r){t.collect.hook.emit(e,r)})}(i)}},e.prototype.report=function(e,t){void 0===t&&(t={});try{if(this.config.disable_track_event)return;var r=[],i=(r.push(this.collect.processEvent(e,t)),this.collect.eventManager.merge(r));this.fetch(this.reportUrl,i)}catch(e){}},e.prototype.setProfile=function(e){(e=this.formatParams(e))&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set",o({},e,{profile:!0})))},e.prototype.setOnceProfile=function(e){(e=this.formatParams(e,!0))&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set_once",o({},e,{profile:!0})))},e.prototype.incrementProfile=function(e){e&&this.report("__profile_increment",o({},e,{profile:!0}))},e.prototype.unsetProfile=function(e){var t;e&&((t={})[e]="1",this.report("__profile_unset",o({},t,{profile:!0})))},e.prototype.appendProfile=function(e){if(e){var t,r={};for(t in e)("string"==typeof e[t]||"Array"===Object.prototype.toString.call(e[t]).slice(8,-1))&&(r[t]=e[t]);Object.keys(r).length&&this.report("__profile_append",o({},r,{profile:!0}))}},e.prototype.:t.clone(e[r]),timoid 0===t&&(t=!1);try{if(!e||"[object Object]"!==Object.prototype.toString.call(e))return;var i,n={};for(i in e)("string"==typeof e[i]||"number"==typeof e[i]||"Array"===Object.prototype.toString.call(e[i]).slice(8,-1))&&(n[i]=e[i]);var o=Object.keys(n);if(!o.length)return;var s=Date.now();return o.filter(function(i){var n=r.cache[i];return t?!n:!(n&&r.compare(n.val,e[i])&&s-n.timestamp<r.duration)}).reduce(function(e,t){return e[t]=n[t],e},{})}catch(e){}},e.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}},e.prototype.clone=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return e}},e.prototype.unReady=function(){},e}(),K=function(){function e(){var e=this;this.setInterval=function(){var t,r,i,n;e.clearIntervalFunc=(t=function(){e.isSessionhasEvent&&e.endCurrentSession()},r=e.sessionInterval,void 0===t&&(t=function(){}),void 0===r&&(r=1e3),i=Date.now()+r,n=window.setTimeout(function e(){var o=Date.now()-i;t(),i+=r,n=window.setTimeout(e,Math.max(0,r-o))},r),function(){window.clearTimeout(n)})},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var r=this;this.collect=e,t.disable_heartbeat||(this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval(),e=this.collect.Types,this.collect.on(e.SessionReset,function(){r.process()}))},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=ssionhasEvent||(this.isSestUrl("event"),r=this.collect.Types,this.collect.on(r.Ready,function(){i.sdkOnload()}),this.collect.on(r.SubmitError,function(e){var t=e.eventData,e=e.errorCode;i.sdkError(t,e)})))},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),r=t.header,i=t.user,n=r.app_id,o=r.app_name,s=r.sdk_version,a=i.web_id,c={events:[{event:"onload",params:JSON.stringify({app_id:n,app_name:o||"",sdk_version:s,sdk_type:"npm",sdk_config:this.config,sdk_desc:"TOC"}),local_time_ms:Date.now()}],user:{user_unique_id:a},header58151b0ed37e")},16)}catch(e){}},e.header,s=[],a=(e.forEach(function(e){e.events.forEach(function(e){s.push(e)})}),{events:s.map(function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:o.app_id,app_name:o.appdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(o),user:JSON.stringify(n)}),local_time_ms:Date.now()}}),user:{user_unique_id:n.user_unique_id},header:{}});setTimeout(function(){r.fetch(r.url,[a],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(e){}},e}(),W=function(){function e(){this.verifyReady=!1,this.waitTime=5e3,this.cleanStatus=!1}return e.prototype.apply=function(e,t){var r=this,t=(this.collector=e,this.config=t,e.adapters.storage);this.cacheStorgae=new t(!1,"session"),this.eventStorage=[],this.collector.on("submit-verify",function(e){e&&e.length&&r.eventStore(e[0])}),this.checkCache()},e.prototype.checkCache=function(){var e=this,t=(this.verifyCookieKey="__applog_verify_set_"+this.config.app_id,this.cacheStorgae.getCookie(this.verifyCookieKey),this.cacheStorgae.getItem(this.verifyCookieKey)),r=(this.sign=t&&t.sign||"",this.origin=t&&t.origin||"*",setTimeout(function(){e.cleanVerify(),clearTimee));window.addEventListener("message",function(t){t&&t.data&&"simulator:verify"===t.data.type&&(clearTimeout(r),e.receMessage(t))},!0)},e.prototype.receMessage=function(e){var t;this.cleanStatus||(t=e.data,this.verifyReady=!0,this.sign=t.sign,this.origin=e.origin,this.cacheStorgae.setItem(this.verifyCookieKey,JSON.stringify({sign:t.sign,origin:e.origin})),this.eventStorage.length&&this.postVerify(this.eventStorage,t.sign,e.origin))},e.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e,this.sign,this.origin):this.eventStorage.push(e))},e.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[]},e.prototype.postVerify=function(e,t,r){try{var i=[],n=(Array.isArray(e)?e.forEach(function(e){i.push(e)}):i.push(e),{type:"simulator:verify:event",sign:t,pageUrl:window.location.href,events:i});(window.opener||window.parent).postMessage(n,r)}catch(e){}},e}(),J="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,V=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach(function(t,r){var i,n;"sdk"===t?H.hasOwnProperty(r)&&(i=H[r].object,n=H[r].src[e.chante.now(),e.exist(r,i,n)):"object"==typeof t&&(t.src?e.exist(r,t.call,t.src):e.process(r,t.instance,"INSTANCE"))})}catch(e){}},e.prototype.exist=function(e,t,r){var i=this;J[t]?this.process(e,J[t]):this.loadPlugin(e,r,function(){i.process(e,J[t])},function(){})},e.prototype.process=function(e,t,r){try{var i;r?(i=new t).apply&&i.apply(this.collect,this.config):t&&t(this.collect,this.config)}catch(e){}},e.prototype.loadPlugin=function(e,t,r,i){var n=this;try{var o=document.createElement("script");o.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(r),o.onerror=function(){i(t)},o.onload=function(){n._plugin[e].forEach(function(e){e()})},document.getElementsByTagName("head")[0].appendChild(o)}catch(e){}},e}(),V=(t.usePlugin(V,"extend"),t.usePlugin(W,"verify"),t.usePlugin(L,"et"),t.usePlugin(G,"profile"),t.usePlugin(K,"heartbeat"),t.usePlugin(q,"monitor"),new t("default")),X=V,Q={browserError:1e3,crc32:1e3,preUpload:1001,initUploadID:1002,process:1003,fileMerge:1004,complete:1005},$="video",Z="image",Y="object",ee={video:"video_upload",image:"image_upload",object:"object_upload"},et="imagex",er={cn:"cn-north-1",us:"us-east-1",sg:"ap-singapore-1","cn-north-1":"cn-north-1","us-east-1":"us-east-1","ap-singapore-1":"ap-singapore-1",boe:"boe",boei18n:"boei18n","US-TTP":"US-TTP"},ei={"cn-north-1":"https://vod.bytedanceapi.com","us-east-1":"https://vod.us-east-1.bytedanceapi.com","ap-singapore-1":"https://vod.ap-singapore-1.bytedanceapi.com"},en={"cn-north-1":"https://open.bytedanceapi.com","us-east-1":"https://open.us-east-1.bytedanceapi.com","ap-singapore-1":"https://open.ap-singapore-1.bytedanceapi.com"},eo={"cn-north-1":"https://imagex.bytedanceapi.com","us-east-1":"https://imagex.us-east-1.bytedanceapi.com","ap-singapore-1":"https://imagex.ap-singapore-1.bytedanceapi.com"},es={"cn-north-1":"https://open.bytedanceapi.com","us-east-1":"https://imagex-us-east-1.bytevcloudapi.com","ap-singapore-1":"https://imagex-ap-singapore-1.bytevcloudapi.com"};function ea(){return(ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function ec(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var eu=function(){var e,t;function r(e,t){switch(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this.options=e,this.context=t,this.teaLog=X,this.tea_app_id=2562,this.tea_channel="cn",this.options.region){case"us":case"us-east-1":case"gcp":case"US-TTP":this.tea_app_id=2643,this.tea_channel="va";break;case"sg":case"ap-singapore-1":this.tea_app_id=2643,this.tea_channel="sg";break;default:this.tea_app_id=2562,this.tea_channel="cn"}this.teaLog.init({app_id:this.tea_app_id,channel:this.tea_channel,log:!1,disable_sdk_monitor:!0,disable_auto_pv:!0}),this.teaLog.config({evtParams:{sdk_version:"1.1.10",line_app_id:this.options.appId},user_unique_id:this.options.userId}),this.teaLog.start()}return e=[{key:"send",value:function(e){var t=this.context,r=e.key,t=t.tasks[r],i=Q[e.stage]||999,t=e.fileType||t.fileType,n=e.fileSize||0,o={log_type:ee[t],stage:i,fk:r,fs:n,req:e.req,res:e.res,ts:Math.round(Date.now()/1e3),sst:e.stageStartTime,set:e.stageEndTime,dur:e.duration,tdur:e.totalDuration,durs:e.duration/1e3,tdurs:e.totalDuration/1e3},r=e.type,r="error"===r||"retry"===r?r:i,s="".concat("image"===t?"image":"video","_")+r;switch(i){case 1e3:this.teaLog.event(s,ea({},o,{type:e.type,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,crc32Array:e.crc32Array,isDirect:e.isDirect})}));break;case 1001:this.teaLog.event(s,ea({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,err:e.extra&&e.extra.error,msg:e.extra&&e.extra.message,sig:e.signature,stk:e.proxyStsToken})}));break;case 1002:this.teaLog.event(s,ea({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,upid:e.uploadID})}));break;case 1003:e.isAllFinish||e.isDirect||(delete o.sst,delete o.set,delete o.dur),this.teaLog.event(s,ea({},o,{type:e.type,oid:e.oid,errc:e.extra&&e.extra.errorCode,upload_host:e.tosDomain,af:e.isAllFinish,cst:e.crc32StartTime,cet:e.crc32EndTime,cdur:e.crc32Duration,slst:e.sliceStartTime,slet:e.sliceEndTime,sldurs:e.sliceDuration&&e.sliceDuration/1e3,ex:JSON.stringify({errc:e,o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message})}));break;case 1005:this.teaLog.event(s,ea({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extult&&e.uploadRefunction(e)"prototype",{writable:!1}),r}(),W=r(5),el=r.n(W),L=r(4),ef=r.n(L),eh={urlTemplate:function(e,t){var r;return Object.keys(t=t||{}).forEach(function(i){r=RegExp("{".concat(i,"}"),"g"),e=e.replace(r,t[i])}),e},toQueryString:funct&void 0!{};retur){retuponent(e[t]))}).join("&")},supportChunked:function(){var e=window.Blob||window.WebKitBlob;try{var t=e.prototype;return!(!FormData||!(t.sli.ProgressEvent&&window.FileReader},supportCrc32:function(){var e=window.FileReader&&window.FileReader.prototype.readAsBinaryString;return"undefined"!=typeof Int32Array&&e&&(blob.slicm:functionif(window.locfunction(e){rw Date)Int(1e6*Math.ra2>t(r)?2097152:t(r)||r:20971520if(0<t&&(e=57260610801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],i=("undefined"!=typeof Int32Array&&(r=new Int32Array(r)),-1^~~t),n=(e=new Uint8Array(e)>8;return(-1^i)>>>0},dec2hex:function(e){if(void 0!==e)return function e(t){return t.length<8?e(t="0".concat(t)):t}(Number(e).toString(16))}};function ed(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ey=function(){var e,t;function r(e,t,i,n){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,r),this.file=e,this.successProcess=i,this.failProcess=n,thisnction(){this.readFileCrc32(this.file)}},{key:"readFileCrc32",value:function(e){var t=this,r=this.sliceLength,i=e.slice||e.webkitSlice||e.mozSlice,n=new FileReader,o=0,s=0,a=0;(function c(){s<e.size&&(s=Math.min(o+r,e.size),104857600<e.size&&e.size-s<=5242880&&(s=e.size)),n.readAsArrayBuffer(i.call(e,o,s)),n.onload=function(r){r=r.target.result,a=ep.crc32(r,0),t.crc32Array.push({start:o,end:s,crc32:ep.dec2hex(a),buffer:r}),(o=s)<e.size?c():t.success(t.crc32Array)}})()}},{key:"success",value:function(e){this.successProcess(e)}},{key:"fail",value:function(e,t,r,i){3<=this.retryTime?this.failProcess():(this.readFileCrc32(e,t,r,i),this.retryTime++)}}],ed(r.prototype,e),t&&ed(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}(),eg="The format of stsToken is incorrect.";function em(){return(em=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function ev(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function eb(e,t){bject.defineProperty(e,i.key,i)}}var e_=function(){var e,t;function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,r),this.context=e.context,this.key=e.key,this.isDirect=e.isDirect,this.isImageBatchUpload=e.isImageBatchUpload,this.file=e.file,this.type=(this.isImageBatchUpload?this.file[0]:this.file).type||"",this.sliceLength=eh.getFileSliceLength(this.file,t.getSliceFunc),this.config=t}return e=[{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.crc32(this.file,this.sliceLength)}},{key:"crc32",value:function(e,t){var r=this;this.isImageBatchUpload?function(){for(var t=e.length,i=[],n=0;n<t;n++)new ey(e[n],e[n].size,function(e){i.push(e[0]),i.length===t&&r.success(i)},function(e){r.fail(e)}).start()}():e&&e.size&&!(e.size<=0)?this.isDirect?new ey(e,e.size,function(e){r.success(e)},function(e){r.fail({errorCode:1000003,message:"get crc32 error: ".concat(e&&e.message)})}).start():this.sliceFile(e,t,function(e){r.success(e)},function(e){r.fail(e)}):this.fail({errorCode:1000003,message:"There is a problem with the input file or fileSize."})}},{key:"sliceFile",value:functionebkitS,a=c2Array:n,errorCode:1000003,message:t+": "+e})}}(0)}catch(e){i({message:e&&e.toString()})}}},{key:"getCrc32Key",value:function(e,t){var r;return(t="[object Array]"===Object.prototype.toString.call(t)?function(e){if(Array.isArray(e))return ev(e)}(r=t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||function(e,t){if(e){if("string"==typeof e)return ev(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ev(e,t):void 0}}(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}():[t]).push(e[0].crc32,e[e.length-1].crc32),t.join("_")}},{key:"success",value:function(e){var t=this.context,r=this.key,i=[],n=[];if(this.isImageBatchUpload)for(var o=0;o<this.file.length;o++)i.push(this.file[o].size),n.push(this.file[o].name);else i=this.file.size,n=this.file.name;var s=this.getCrc32Key(e,i),t=t.tasks[r];t&&this.successProcess(em(t,{key:r,crc32Array:e,crc32Key:s,sdkVersion:"1.1.10",sliceLength:this.sliceLength,extra:{message:"get crc32 success"},stage:"crc32",type:"success",fileSize:i,fileName:n,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st,isDirect:this.isDirect,isImageBatchUpload:this.isImageBatchUpload}))}},{key:"fail",value:function(e){var t=this.context,r=this.key,i=e&&e.message?e.message:"get crc32 error",n=e&&e.errorCode,e=e&&e.crc32Array,t=em(t.tasks[r],{crc32Array:e,extra:{message:i,errorCode:n},type:"error",stage:"crc32",stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st});this.failProcess(t)}}],eb(r.prototype,e),t&&eb(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}();function eS(e){return(eS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ew(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ek(e,t){return(ek=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function ex(e){return(ex=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eO=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ek(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],functiass as a function")net error",t.emit("error",rod||"POST",e.url||"",!0),e.heendAsCustom(JSON.stringify(e.custom)):"none"===e.custom?(delete e.custom,this.sen,{key:"sendAsBinary",value:function(e){return this.xhr.setRequestHeader("Content-TypetRequestHeader("ContenURI(e.filename),'"')),this._ajax(e.file)}},{key:"sendAsFormData",value:function(e){t=(t=e.formData?"function"==typeof e.formData?e.formData():e.fe,o.value)}return e.file&&r.append(e.field,e.file,e.name),this._ajax(r)}},{key:"sendAsCustom",value:function(e){return this._ajax(e)}},{key:"abort",value:function(){this.xhr.onreadystatechange=eh.noop,this.xhr.abort()}},{key:"getResponse",value:function(){return this.xhr.response}},{key:"getText",value:function(){return this.xhr.responseText}},{key:"getJson",value:function(){return JSON.parse(this.xhr.responseText)}}],ew(o.prototype,t),r&&ew(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}(),G=r(1),eC=r.n(G),eT={checkFile:function(){},checkStsToken:function(e){return!e||e.SessionToken&&e.SecretAccessKey&&(e.AccessKeyId||e.AccessKeyID)},checkServiceName:function(e,t){if(e===$)return"vod";if(e===Z)return et;if(e===Y){if(t.objectConfig&&t.objectConfig.spaceName)return"vod";if(t.objectConfig&&t.objectConfig.serviceId)return et;if(t.videoConfig&&t.videoConfig.spaceName)return"vod";if(t.imageConfig&&t.imageConfig.serviceId)return et}return"vod"}};function eE(e){return(eE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eD(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function ej(){return(ej=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function eP(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function eI(e,t){return(eI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function eA(e){return(eA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ez=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eI(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=eA(o);return function(e,t){if(t&&("object"===eE(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=eA(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=n.call(this)).options=e,r.config=t,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.systemTimeGap=0,r.retryTime=t.retryTaskTime||2,r.hasRetryTime=0,r.isImageBatchUpload=!!r.options.isImageBatchUpload,r.isDirect=r.options.isDirect,r}return t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this._st=Date.now(),t=(r=this.uploaderCtx._getCache(this.currFileCtx.crc32Key))?JSON.parse(r):{},!this.isDirect&&t.oid&&(t.uploadID||t.UploadID)?this.resumeFromCache(t):this.startPreUpload()}},{key:"startPreUpload",value:function(){var e=this,t=er[this.config.region],r=new eO,i=(r.on("complete",function(t){if(t.response)try{var r,i,n,o,s,a,c,u,l,f,h,p,d=JSON.parse(t.response);d.ResponseMetadata.Error?e.fail({xhr:t,errorCode:d.ResponseMetadata.Error.CodeN,error:d.ResponseMetadata.Error.Code,message:d.ResponseMetadata.Error.Message}):(r=eT.checkServiceName(e.options.type,e.config),i=d.Result,o=(n=r===et?i.UploadAddress:i.InnerUploadAddress.UploadNodes[0]).StoreInfos,s=n.UploadHosts,a=n.SessionKey,u=void 0===(c=n.UploadHeader)?{}:c,l=r===et?s[0]:n.UploadHost,f=[],h=[],e.isImageBatchUpload&&1<o.length?o.forEach(function(e){f.push(e.Auth),h.push(e.StoreUri)}):(f=o[0].Auth,h=o[0].StoreUri),p=ej(e.currFileCtx,{key:e.options.key,useBackupDomain:e.uploaderCtx.useBackupDomain,signature:f,type:"success",extra:{message:"prepare upload success"},stage:"preUpload",oid:h,systemTimeGap:e.systemTimeGap,tosDomain:"".concat(e.config.schema,"://").concat(l),xhr:t,UploadHeader:u,SessionKey:a,UploadID:o[0].UploadID,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration}),e.successProcess&&e.successProcess(p))}catch(r){e.fail({error:"catch error: ".concat(r.toString()),xhr:t})}else e.fail({error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t})}),r.on("error",function(t){var r;e.uploaderCtx.useBackupDomain?(r={error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t},t.response&&(t=JSON.parse(t.response)).ResponseMetadata&&t.ResponseMetadata.Error&&(r.errorCode=t.ResponseMetadata.Error.CodeN,r.error=t.ResponseMetadata.Error.Code,r.message=t.ResponseMetadata.Error.Message),e.fail(r)):(e.hasRetryTime<e.retryTime-1?e.hasRetryTime++:e.uploaderCtx.useBackupDomain=!0,e.startPreUpload())}),""),n={},o=this.uploaderCtx.useBackupDomain,s=eT.checkServiceName(this.options.type,this.config),o=(s===et&&(i=this.config.imageHost||(o?es:eo)[t],n={Action:"ApplyImageUpload",Version:"2018-08-01"},this.options.type===Z&&(this.config.imageConfig&&this.config.imageConfig.serviceId?n.ServiceId=this.config.imageConfig.serviceId:n.SpaceName=this.config.videoConfig&&this.config.videoConfig.spaceName),this.options.type===Y&&(n.ServiceId=this.config.objectConfig&&this.config.objectConfig.serviceId||this.config.imageConfig&&this.config.imageConfig.serviceId),this.currFileCtx.fileSize&&1<this.currFileCtx.fileSize.length&&(n.UploadNum=this.currFileCtx.fileSize.length),this.options.storeKey&&(a=this.options.storeKey,"[object Array]"===Object.prototype.toString.call(a)?n.StoreKeys=a:"[object String]"===Object.prototype.toString.call(a)&&(n.StoreKeys=[a]))),"vod"===s&&(a=this.config.videoConfig&&this.config.videoConfig.spaceName,this.options.type===Y&&this.config.objectConfig&&this.config.objectConfig.spaceName&&(a=this.config.objectConfig.spaceName),i=this.config.videoHost||(o?en:ei)[t],n={Action:"ApplyUploadInner",Version:"2020-11-19",SpaceName:a,FileType:this.options.type,IsInner:1},this.currFileCtx.fileSize&&(n.FileSize=this.currFileCtx.fileSize),this.config.enOID&&(n.EnOID=1),this.config.testHost&&(n.TestHost=this.config.testHost)),this.config.useFileExtension&&this.currFileCtx.fileName&&(this.options.type===Y||this.options.type===Z)&&(o=this.currFileCtx.fileName,(a=eh.getFileSuffix(o))&&(n.FileExtension=a)),this.config.accountId&&(n["X-Account-Id"]=this.config.accountId),(this.options.type===Z||this.options.type===Y)&&this.config.bizType&&(n.BizType=this.config.bizType,n.AppID=this.config.appId,n.UserID=this.config.userId),this.config.openExperiment&&(n.app_id=this.config.appId,n.user_id=this.config.userId),n.s=Math.random().toString(36).substr(2),this.options.fileSize&&(n.fileSize=this.options.fileSize),this.currFileCtx.proxyStsToken||this.config.stsToken),a=eh.toQueryString(n),c=o.AccessKeyID,u=o.AccessKeyId,l=o.SecretAccessKey,f=o.SessionToken,o=o.CurrentTime,a={method:"GET",url:"".concat(i,"?").concat(a),timeout:this.config.gatewayTimeout||3e4,region:t,params:n,pathname:eh.getPathByURL(i)},t=new eC.a(a,s),n=(this.config.useServerCurrentTime&&6e4<Math.abs(new Date(o)-new Date)&&(this.systemTimeGap=new Date(o)-new Date),this.systemTimeGap?new Date((new Date).getTime()+this.systemTimeGap):new Date);t.addAuthorization({accessKeyId:u||c,secretAccessKey:l,sessionToken:f},n),r.send(a)}},{key:"resumeFromCache",value:function(e){var t=this,r=this.options.key,i=new eO,n=(i.on("complete",function(i){try{var n,o,s,a=JSON.parse(i.response);0===a.success&&0<a.payload.partList.length?(n=t.confirmCache(a.payload.partList),o=e.hasMerge?5:n.isAllFinished?4:3,s=ej(t.currFileCtx,e,{key:r,xhr:i,extra:{message:"prepare upload from cache success"},stage:"preUpload",type:"success",percent:0,cacheTask:o,proxyStsToken:t.options.stsToken,currentTask:1,status:1,isBreak:1,crc32Array:n.crc32Array,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st,totalDuration:Date.now()-t._st+t.currFileCtx.totalDuration}),t.successProcess&&t.successProcess(s)):t.startPreUpload()}catch(e){t.startPreUpload()}}),i.on("error",function(e){400<=e.status?t.startPreUpload():t.fail({error:"request error",xhr:e})}),this.config.userId);i.send({method:"get",url:eh.urlTemplate(this.config.getUploadListUrl,{tosDomain:e.tosDomain,oid:e.oid,uploadId:e.uploadID||e.UploadID}),headers:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eD(Object(r),!0).forEach(function(t){var i;i=r[t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eD(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({Authorization:e.signature,"X-Storage-U":encodeURIComponent(n)},e.UploadHeader),timeout:3e4})}},{key:"confirmCache",value:function(e){var t=this.currFileCtx.crc32Array,r={},i=(e.forEach(function(e){void 0===r[e.partNumber-1]&&(r[e.partNumber-1]={tag:!0,crc32:e.crc32})}),!0),e=t.map(function(e,t){return r[t]&&r[t].tag&&r[t].crc32?(e.crc32=r[t].crc32,e.finished=!0,e.loaded=e.end-e.start):i=!1,e});return{isAllFinished:i,crc32Array:e}}},{key:"fail",value:function(e){var t=e.xhr,r=e.errorCode||1001e3,i="prepare upload error: UNKNOWN",i=(t&&(i=0===t.status?"prepare upload error: NETERROR":e.message||"prepare upload error: ".concat(t.status)),ej(this.currFileCtx,{extra:{message:i,error:e.error,errorCode:r},type:"error",stage:"preUpload",xhr:t,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}));this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(i)}}],eP(o.prototype,t),r&&eP(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function eR(e){return(eR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eB(){return(eB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function eU(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function eM(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function eF(e,t){return(eF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function eN(e){return(eN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eH=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eF(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=eN(o);return function(e,t){if(t&&("object"===eR(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=eN(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=n.call(this)).options=e,r.config=t,r.transport=new eO,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.eventInit(),r}return t=[{key:"initUpload",value:function(){var e=this.options.context,t=this.options.key,r={oid:e.tasks[t].oid,tosDomain:e.tasks[t].tosDomain},r=eh.urlTemplate(this.config.initUploadFileUrl,r),i=this.config.userId;this.transport.send({method:"post",url:r,headers:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eU(Object(r),!0).forEach(function(t){var i;i=r[t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eU(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({Authorization:e.tasks[t].signature,"X-Storage-U":encodeURIComponent(i)},this.currFileCtx.UploadHeader),timeout:3e4})}},{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.initUpload()}},{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){try{var r,i=JSON.parse(t.response),n=i.payload.uploadID;0===i.success&&n?(r=eB(e.currFileCtx,{UploadID:n,percent:0,type:"success",extra:{message:"init upload id success"},stage:"initUploadID",xhr:t,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration}),e.successProcess(r)):e.fail({error:"fail! res.success: ".concat(i.success,", uploadId:").concat(n),xhr:t})}catch(r){e.fail({error:"catch error: ".concat(JSON.stringify(r)),xhr:t})}}),this.transport.on("error",function(t){e.fail({error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t})})}},{key:"fail",value:function(e){var t=this.options.context,r=this.options.key,t=eB(t.tasks[r],{extra:{message:"init upload id error, ".concat(e.error),errorCode:1002e3},type:"error",stage:"initUploadID",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration});this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(t)}}],eM(o.prototype,t),r&&eM(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function eL(e){return(eL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eG(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function eK(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eG(Object(r),!0).forEach(function(t){var i;i=r[t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eG(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function eq(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function eW(e,t){return(eW=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function eJ(e){return(eJ=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var eV=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eW(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=eJ(o);return function(e,t){if(t&&("object"===eL(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=eJ(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=e.sliceItem,i=e.crc32,s=e.url,a=e.signature,c=e.uploadHeader,u=e.userId,l=e.retryTime,f=e.timeout,e=e.method,e=void 0===e?"put":e;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).fileSlice=r,t.crc32=i,t.uploadUrl=s,t.uploadHeader=c,t.signature=a,t.userId=u,t.retryTime=l||0,t.method=e,t.retryCount=0,t.timeout=f||18e5,t.ready=!1,t.cancel=!1,t.transport=new eO,t.eventInit(),t}return t=[{key:"upload",value:function(e,t){this.isParamsValid()&&(this._st=Date.now(),this.transport&&this.transport.send({method:this.method,url:this.uploadUrl,headers:eK({Authorization:this.signature,"Content-CRC32":this.crc32,"X-Storage-U":encodeURIComponent(this.userId)},this.uploadHeader),file:this.fileSlice,binary:1,timeout:this.timeout}),e&&this.emit("retry",t))}},{key:"isParamsValid",value:function(){return this.fileSlice&&(this.fileSlice.size||this.fileSlice.byteLength)?this.crc32?!!this.uploadUrl||(this.emit("error",{message:"slice upload failed: NOURL",crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength}),!1):(this.emit("error",{message:"slice upload failed: NOCRC32",crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength}),!1):(this.emit("error",{message:"slice upload failed: NOCONTENT",crc32:this.crc32}),!1)}},{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){e.success(t)}),this.transport.on("error",function(t){e.fail(t)}),this.transport.on("progress",function(t){e.process(t)})}},{key:"success",value:function(e){this.ready=!0;var t=Date.now()-this._st,r=this.fileSlice.size||this.fileSlice.byteLength;this.emit("complete",{crc32:this.crc32,size:r,speed:r/t,xhr:e,sliceStartTime:this._st,sliceEndTime:Date.now(),sliceDuration:Date.now()-this._st})}},{key:"fail",value:function(e){var t=this;if(!this.cancel){var r={crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength,xhr:e,sliceStartTime:this._st,sliceEndTime:Date.now(),sliceDuration:Date.now()-this._st};if(e&&401===e.status)this.emit("error",eK({message:"slice upload failed: UNAUTHORIZED"},r));else{var i="slice upload failed: UNKNOWN";if(e&&(i=e.status?"slice upload failed: ".concat(e.status):"slice upload failed: NETERROR"),this.retryCount<this.retryTime)return setTimeout(function(){t.upload(!0,eK({message:i},r))},1e3),void this.retryCount++;this.emit("error",eK({message:i},r))}}}},{key:"process",value:function(e){this.cancel||this.emit("progress",{crc32:this.crc32,loaded:e.loaded||0,total:e.total||0})}},{key:"abort",value:function(){this.transport&&(this.cancel=!0,this.transport.abort())}},{key:"destroy",value:function(){this.transport=null}}],eq(o.prototype,t),r&&eq(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}(),K=r(2),eX=r.n(K);function eQ(e){return(eQ="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e$(){return(e$=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function eZ(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function eY(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function e1(e,t){return(e1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function e0(e){return(e0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var e2=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e1(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=e0(o);return function(e,t){if(t&&("object"===eQ(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=e0(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).file=e.file,t.context=e.context,t.key=e.key,t.config=r,t.finishArr=[],t.errorLength=0,t.finishSize=0,t.retryUploadTime=Number(r.retryUploadTime)||2,t.progressMonitorTime=Number(r.progressMonitorTime)||10,t.progressMonitorSpeed=Number(r.progressMonitorSpeed)||50,t.uploadSliceCount=Number(r.uploadSliceCount)||3,t.realtimeSpeedInterval=Number(r.realtimeSpeedInterval)||5,t.processRetry=0,t.lastFinishSize=-1,t.lastProcessPercent=-1,t.lastIntervalSize=-1,t.lastCalculateSpeedTime=-1,t.lastCalculateSpeedSize=0,t.uploadHandlers={},t}return t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this.errorLength=0,this.currentCtx=this.context.tasks[thisst=Date.now(),this._lastSaveTime=Date.now(),this.lastCalculateSpeedTime=this._st,this.initWorker(),this.setProgressMonitor(),this.threadUpload()}},{key:"initWorker",value:function(){var e,t=this;this.worker||(e=this.crc32Array,this.worker=new eX.a,this.worker.onmessage=function(r){var i,r=function(e){if(Array.isArray(e))return e}(i=r.data)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,o=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(i=r.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){a=!0,n=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw n}}return o}}(i,4)||function(e,t){if(e){if("string"==typeof e)return eZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?eZ(e,t):void 0}}(i,4)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=r[0],o=r[1],s=r[2],r=r[3],a=(new Date).getTime(),c=e[s];c.crc32=o,c.crc32StartTime=r,c.crc32EndTime=a,c.crc32Duration=a-r,t.upload(c,n,s)})}},{key:"read",value:function(e,t){var r=this,i=this.file,n=i.slice||i.webkitSlice||i.mozSlice,o=new FileReader;o.onload=function(e){var i=(new Date).getTime();r.worker.postMessage([e.target.result,t,i,!!r.config.clientEncrypt,r.currentCtx.clientEncryptKey,r.crc32Array.length-1===t],[e.target.result])},o.onerror=function(){r.stop(),r.fail({extra:{message:"An error occurred reading the file",errorCode:1003003}})},o.readAsArrayBuffer(n.call(i,e.start,e.end))}},{key:"threadUpload",value:function(){if(this.uploading.length<this.uploadSliceCount){var e=this.lastIndex,t=this.crc32Array[e];if(t){if(t.finished){if(-1===this.finishArr.indexOf(t.start)&&(this.finishArr.push(t.start),this.finishArr.length>=this.crc32Array.length))return this.stop(),void this.success()}else t.loaded=0,this.uploading.push(e),this.read(t,e);this.lastIndex++,this.threadUpload()}}}},{key:"stop",value:function(){var e=this;Object.keys(this.uploadHandlers).forEach(function(t){e.uploadHandlers[t].abort(),e.uploadHandlers[t].destroy()}),this.uploadHandlers={},this.worker&&this.worker.terminate(),this.worker=null,this.clearMonitor()}},{key:"setProgressMonitor",value:function(){var e=this;this.progressMonitorInterval=setInterval(function(){var t,r=e.finishSize;r-e.lastIntervalSize<e.progressMonitorTime*e.progressMonitorSpeed*1024?(t=e$(e.currentCtx,{stage:"process",type:"warn",extra:{message:"percent are not updated in ".concat(e.progressMonitorTime," seconds")}}),e.context.logger.send(t),e.context._broadcast("slowProgress",t),e.clearMonitor()):e.lastIntervalSize=r},1e3*this.progressMonitorTime)}},{key:"clearMonitor",value:function(){this.progressMonitorInterval&&clearInterval(this.progressMonitorInterval)}},{key:"upload",value:function(e,t,r){var i=this,n=e.crc32,o=(this.context._saveTask(this.key,{crc32Array:this.crc32Array}),{number:r+1,uploadId:this.currentCtx.UploadID||this.currentCtx.uploadID,oid:this.currentCtx.oid,tosDomain:this.currentCtx.tosDomain}),o=eh.urlTemplate(this.config.uploadChunkedUrl,o),s=this.config.userId,a=this.config.uploadHttpMethod||"put",c=this.config.uploadTimeout,t=(this.config.clientEncrypt||(t=eh.fileSlice(this.file,e.start,e.end)),new eV({sliceItem:t,crc32:n,url:o,signature:this.currentCtx.signature,uploadHeader:this.currentCtx.UploadHeader,userId:s,method:a,retryTime:this.retryUploadTime,timeout:c}));t.on("complete",function(t){1===i.currentCtx.status&&(t.start=e.start,t.crc32StartTime=e.crc32StartTime,t.crc32EndTime=e.crc32EndTime,t.crc32Duration=e.crc32Duration,t.index=r,i.fileSliceSuccess(t))}),t.on("error",function(t){1===i.currentCtx.status&&(t.start=e.start,t.crc32StartTime=e.crc32StartTime,t.crc32EndTime=e.crc32EndTime,t.crc32Duration=e.crc32Duration,t.index=r,i.fail(t))}),t.on("progress",function(t){1===i.currentCtx.status&&(t.start=e.start,t.index=r,i.process(t))}),t.on("retry",function(t){1===i.currentCtx.status&&(t.start=e.start,t.index=r,i.retry(t))}),t.upload(),this.uploadHandlers[r]=t}},{key:"success",value:function(e){this.finishArr=[];var t=Date.now()-this._st,t=this._uploadSize/t,t=e$(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"upload all success"},speed:t,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._lastSaveTime+this.currentCtx.totalDuration,isAllFinish:!0});this.worker&&this.worker.terminate(),this.successProcess(t)}},{key:"fail",value:function(e){var t=this.errorFormat(e);t.type="error",void 0!==e.statusCode&&e$(this.currentCtx,{statusCode:e.statusCode}),this.errorLength||(this.context.logger.send(e$({},t)),this.stop(),this.context._broadcast("error",t),this.currentCtx.isBreak?this.context._cancel(this.key):this.context._pause(this.key),this.errorLength++)}},{key:"retry",value:function(e){e=this.errorFormat(e),this.context.logger.send(e$({},e,{type:"retry"}))}},{key:"fileSliceSuccess",value:function(e){var t,r=e.index,i=Date.now(),n=(-1===this.finishArr.indexOf(e.start)&&this.finishArr.push(e.start),this.crc32Array[r].finished=!0,this.crc32Array[r].speed=e.speed,{message:"slice upload success"});if(e.xhr&&(t=e.xhr,n.currentUrl=t.currentUrl||"",e$(this.currentCtx,{req:{url:t.currentUrl,param:t.params},res:{status:t.status,body:t.responseText,header:t.getAllResponseHeaders()}}),delete e.xhr),this.context.logger.send(e$(this.currentCtx,{stage:"process",type:"success",sliceIndex:r,extra:n,totalDuration:i-this._lastSaveTime+this.currentCtx.totalDuration,sliceStartTime:e.sliceStartTime,sliceEndTime:e.sliceEndTime,sliceDuration:e.sliceDuration,crc32StartTime:e.crc32StartTime,crc32EndTime:e.crc32EndTime,crc32Duration:e.crc32Duration})),this._lastSaveTime=i,this.context._saveTask(this.key),this.uploading.splice(this.uploading.indexOf(r),1),this.uploadHandlers[r]&&delete this.uploadHandlers[r],this.finishArr.length>=this.crc32Array.length)return this.stop(),void this.success(e.xhr);this.threadUpload()}},{key:"getFinishSize",value:function(e,t){var r=t.crc32,i=0;return e.forEach(function(e){e.crc32===r?(e.loaded=t.loaded,i+=t.loaded):(e.loaded||(e.loaded=0),i+=e.loaded)}),i}},{key:"process",value:function(e){var t=this.currentCtx.realtimeSpeed||0,r=this.currentCtx.fileSize,i=(this.finishSize=this.getFinishSize(this.crc32Array,e),this.finishSize>this.lastFinishSize&&((e=new Date).getTime()-this.lastCalculateSpeedTime>1e3*this.realtimeSpeedInterval&&(n=e.getTime()-this.lastCalculateSpeedTime,t=Math.floor((i=this.finishSize-this.lastCalculateSpeedSize)/n),this.lastCalculateSpeedTime=e.getTime(),this.lastCalculateSpeedSize=this.finishSize),this.lastFinishSize=this.finishSize),Math.floor(this.finishSize/r*1e4)/100||0),n=e$(this.currentCtx,{stage:"process",percent:i,realtimeSpeed:t});i>this.lastProcessPercent&&100!==i&&(this.lastProcessPercent=i,this.context._broadcast("progress",n))}},{key:"errorFormat",value:function(e){var t=this.currentCtx.totalDuration,r=Date.now()-this._st,i=e.index,n=e.crc32?{message:e.message,data:e.crc32,size:e.size}:e.extra,n=(n.errorCode=n.errorCode||1003e3,e$(this.currentCtx,{extra:n,sliceIndex:i,stage:"process",req:{},res:{},totalDuration:r+t,sliceStartTime:e.sliceStartTime,sliceEndTime:e.sliceEndTime,sliceDuration:e.sliceDuration,crc32StartTime:e.crc32StartTime,crc32EndTime:e.crc32EndTime,crc32Duration:e.crc32Duration}));return e.xhr&&(i=e.xhr,n.req={url:e.xhr.currentUrl},n.res={status:i.status,body:i.responseText,header:i.getAllResponseHeaders()},delete e.xhr),n}}],eY(o.prototype,t),r&&eY(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function e3(e){return(e3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e4(){return(e4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function e5(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function e6(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function e8(e,t){return(e8=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function e7(e){return(e7=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var e9=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e8(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=e7(o);return function(e,t){if(t&&("object"===e3(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=e7(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,argurrFileCtx.tosDomain},t=this.currFileCtx.crc32Array,r="",i=0;i<t.length;i++)r=(r?"".concat(r,","):"").concat(i+1,":").concat(t[i].crc32);var e=eh.urlTemplate(this.config.uploadMergeUrl,e),n=this.config.userId,n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e5(Object(r),!0).forEach(function(t){var i;i=r[t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e5(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({Authorization:this.currFileCtx.signature,"X-Storage-U":encodeURIComponent(n)},this.currFileCtx.UploadHeader);this.config.clientEncrypt&&(n["x-upload-encryption-mode"]=2,n["x-upload-encryption-key"]=btoa(this.currFileCtx.clientEncryptKey)),this.transport.send({method:"post",url:e,headers:n,custom:r})}},{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.mergeFile()}},{key:"eventInit",value:function(){var e=this,t=this.options.stage;this.transport.on("complete",function(r){try{var i=JSON.parse(r.response);0===i.success&&i.payload.key?(e4(e.currFileCtx,{stage:t,type:"success",hasMerge:!0,extra:{message:"merge file success"},xhr:r,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration}),e.successProcess(e.currFileCtx)):e.fail({error:"fail! result.success:".concat(i.success),xhr:r})}catch(t){e.fail({error:"response parse error: ".concat(JSON.stringify(t)),xhr:r})}}),this.transport.on("error",function(t){e.fail({error:"request fail: ".concat(t.statusText||t.errText),xhr:t})})}},{key:"getProcessIndex",value:function(e){var t=0;return e.forEach(function(e,r){"process"===e.stage&&(t=r)}),t}},{key:"fail",value:function(e){e=e4(this.currFileCtx,{extra:{message:"merge file error, ".concat(e.error),errorCode:1004e3},type:"error",stage:this.options.stage,xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}),this.failProcess(e)}}],e6(o.prototype,t),r&&e6(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(){return(tt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ti(e,t){return(ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tn(e){return(tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var to=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ti(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tn(o);return function(e,t){if(t&&("object"===te(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tn(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=1<arguments.lengnceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).options=e,t.file=e.file,t.context=e.context,t.key=e.key,t.config=r,t.finishArr=[],t.errorLength=0,t.finishSize=0,t.retryUploadTime=0,t.processRetry=0,t.lastFinishSize=-1,t.lastProcessPercent=-1,t.lastIntervalSize=-1,t}return t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this.currentCtx=this.context.tasks[this.key],this.crc32Array=this.context.tasks[this.key].crc32Array,this._uploadSize=this.file.size,this._st=Date.now(),this.upload()}},{key:"stop",value:function(){this.uploader&&(this.uploader.abort(),this.uploader.destroy())}},{key:"upload",value:function(){for(var e=this,t=this.crc32Array.length,r=0,i=0,n=0;n<t;n++){var o=this.crc32Array[n],s=o.buffer,o=o.crc32,a=this.currentCtx.oid,c=this.currentCtx.signature,a={oid:"[object Array]"===Object.prototype.toString.call(a)?a[n]:a,tosDomain:this.currentCtx.tosDomain},a=eh.urlTemplate(this.config.directUploadFileUrl,a),u=this.config.userId,l=this.config.uploadHttpMethod||"put",f=this.config.uploadTimeout,s=new eV({sliceItem:s,crc32:o,url:a,signature:"[object Array]"===Object.prototype.toString.call(c)?c[n]:c,uploadHeader:this.currentCtx.UploadHeader,userId:u,retryTime:this.retryUploadTime,method:l,timeout:f});s.on("complete",function(n){i+ ++r===t&&e.success(n.xhr)}),s.on("error",function(r){++i===t&&e.fail(r.xhr)}),s.on("progress",function(t){e.process(t)}),s.upload(),this.uploader=s}}},{key:"success",value:function(e){this.finishArr=[];var t=Date.now()-this._st,t=this._uploadSize/t,t=tt(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"direct upload success"},speed:t,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration});this.successProcess(t)}},{key:"fail",value:function(e){e=tt(this.currentCtx,{extra:{message:"direct upload error: ".concat(e.errText),errorCode:1003e3},type:"error",stage:"process",xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration}),this.failProcess(e)}},{key:"process",value:function(e){var t=this.currentCtx.fileSize,e=(this.finishSize=e.loaded,this.finishSize>this.lastFinishSize&&(this.lastFinishSize=this.finishSize),Math.floor(this.finishSize/t*1e4)/100||0),t=tt(this.currentCtx,{stage:"process",percent:e});e>this.lastProcessPercent&&100!==e&&(this.lastProcessPercent=e,this.context._broadcast("progress",t))}}],tr(o.prototype,t),r&&tr(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function ts(e){return(ts="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ta(){return(ta=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tc(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tu(e,t){return(tu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tl(e){return(tl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tf=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tu(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tl(o);return function(e,t){if(t&&("object"===ts(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tl(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).options=e,t.file=e.file,t.context=e.context,t.key=e.key,t.config=r,t.errorLength=0,t.retryUploadTime=Number(r.retryUploadTime)||2,t.maxUploadSliceCount=Number(r.uploadSliceCount)||5,t.uploadQueue=[],t.crc32Array=[],t.uploadSliceCount=0,t.isCalcCrc32=!1,t.isFileReading=!1,t.hasStarted=!1,t.hasCompleteUpload=!1,t}return t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this.currentCtx=this.context.tasks[this.key],this.hasStarted=!0,this._st=Date.now(),this.initWorker()}},{key:"initWorker",value:function(){var e=this;this.worker||(this.worker=new eX.a,this.worker.onmessage=function(t){e.isCalcCrc32=!1;var r=t.data[0],i=t.data[2],n=t.data[1];e.uploadQueue.forEach(function(t,o){t.index===i&&(e.uploadQueue[o].crc32=n,e.uploadQueue[o].fileSliceBuffer=r,e.crc32Array[i]={crc32:n})}),e.startUploadQueue()},this.startUploadQueue())}},{key:"addStreamSlice",value:function(e){var t=this,r=e.fileSlice,i=e.index,e=(this.isFileReading=!0,new FileReader);e.readAsArrayBuffer(r),e.onload=function(e){t.isFileReading=!1,e=e.target.result,t.uploadQueue.push({fileSliceBuffer:e,index:i}),t.hasStarted&&t.startUploadQueue()}}},{key:"completeStreamUpload",value:function(){this.hasCompleteUpload=!0,0!==this.uploadQueue.length||this.isFileReading||this.success()}},{key:"startUploadQueue",value:function(){var e;this.uploadSliceCount<=this.maxUploadSliceCount&&0<this.uploadQueue.length&&this.uploadQueue[0].crc32?(e=this.uploadQueue.shift(),this.uploadSliceCount++,this.upload({sliceItem:e.fileSliceBuffer,index:e.index,crc32:e.crc32})):0<this.uploadQueue.length&&!this.uploadQueue[0].crc32&&this.startCrc32Queue()}},{key:"startCrc32Queue",value:function(){if(!this.isCalcCrc32)for(var e=0;e<this.uploadQueue.length;e++){var t=this.uploadQueue[e];if(!t.crc32){this.isCalcCrc32=!0,this.worker.postMessage([t.fileSliceBuffer,t.index],[t.fileSliceBuffer]);break}}}},{key:"upload",value:function(e){var t=this,r=e.sliceItem,i=e.index,e=e.crc32,n=this.currentCtx.signature,o={number:i+1,uploadId:this.currentCtx.UploadID||this.currentCtx.uploadID,oid:this.currentCtx.oid,tosDomain:this.currentCtx.tosDomain},o=eh.urlTemplate(this.config.uploadChunkedUrl,o),s=this.config.userId,r=new eV({sliceItem:r,crc32:e,url:o,signature:n,uploadHeader:this.currentCtx.UploadHeader,userId:s,retryTime:this.retryUploadTime,method:"put",timeout:this.config.uploadTimeout});r.on("complete",function(e){1===t.currentCtx.status&&(e.index=i,t.fileSliceSuccess(e))}),r.on("error",function(e){1===t.currentCtx.status&&(e.index=i,t.fail(e))}),r.upload()}},{key:"fileSliceSuccess",value:function(e){var t=e.index,r=Date.now(),i={message:"stream slice upload success"},n=(e.xhr&&(n=e.xhr,i.currentUrl=n.currentUrl||"",ta(this.currentCtx,{req:{url:n.currentUrl,param:n.params},res:{status:n.status,body:n.responseText,header:n.getAllResponseHeaders()}}),delete e.xhr),this.context.logger.send(ta(this.currentCtx,{stage:"process",type:"success",sliceIndex:t,extra:i,totalDuration:r-this._lastSaveTime+this.currentCtx.totalDuration})),ta(this.currentCtx,{uploadQueueLength:this.uploadQueue.length,sliceIndex:t}));this.context._broadcast("stream-progress",n),this.uploadSliceCount--,this.hasCompleteUpload&&0===this.uploadQueue.length?this.success(e.xhr):this.startUploadQueue()}},{key:"success",value:function(e){this.isAllSuccess||(e=ta(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"all slice upload success"},crc32Array:this.crc32Array,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration}),this.successProcess(e))}},{key:"fail",value:function(e){var t=e.index,e=ta(this.currentCtx,{extra:{message:"stream slice upload error"},type:"error",stage:"process",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration,sliceIndex:t});this.context.logger.send(ta({},e)),this.context._broadcast("error",e)}}],tc(o.prototype,t),r&&tc(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function th(e){return((e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function ty(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?td(Object(r),!0).forEach(function(t){var i;i=r[t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):td(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function tg(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tm(e,t){return(tm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tv(e){return(tv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tb=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tm(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tv(o);return function(e,t){if(t&&("object"===th(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tv(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(r=n.call(this)).options=e,r.config=t,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.isImageBatchUpload=!!r.options.isImageBatchUpload,r.transport=new eO,r.eventInit(),r}return t=[{key:"commitUpload",value:function(){var e,t,r=this.options.key,r=this.options.context.tasks[r],i=er[this.config.region],n="",o={},s=this.uploaderCtx.useBackupDomain,a=eT.checkServiceName(this.options.type,this.config),c=(a===et&&(n=this.config.imageHost||(s?es:eo)[i],o={Action:"CommitImageUpload",Version:"2018-08-01",SessionKey:r.SessionKey},this.options.type===Z&&(this.config.imageConfig&&this.config.imageConfig.serviceId?o.ServiceId=this.config.imageConfig.serviceId:o.SpaceName=this.config.videoConfig&&this.config.videoConfig.spaceName,Array.isArray(c=this.config.imageConfig&&this.config.imageConfig.processAction)&&0<c.length&&((e={SessionKey:r.SessionKey,Functions:[]}).Functions=c,t=JSON.stringify(e)),this.config.skipMeta&&(o.SkipMeta=!0)),this.options.type===Y&&(o.ServiceId=this.config.objectConfig&&this.config.objectConfig.serviceId||this.config.imageConfig&&this.config.imageConfig.serviceId)),"vod"===a&&(c=this.config.videoConfig&&this.config.videoConfig.spaceName,this.options.type===Y&&this.config.objectConfig&&this.config.objectConfig.spaceName&&(c=this.config.objectConfig.spaceName),n=this.config.videoHost||(s?en:ei)[i],o={Action:"CommitUploadInner",Version:"2020-11-19",SpaceName:c},e={SessionKey:r.SessionKey,Functions:[]},s=this.config.videoConfig&&this.config.videoConfig.processAction,this.options.type===Y&&this.config.objectConfig&&this.config.objectConfig.processAction&&(s=this.config.objectConfig.processAction),Array.isArray(s)&&0<s.length&&(e.Functions=s),(this.config.videoConfig&&this.config.videoConfig.callbackArgs||this.options.callbackArgs)&&(e.CallbackArgs=this.options.callbackArgs||this.config.videoConfig.callbackArgs),this.options.type===$&&this.config.skipDownload&&(o.SkipDownload=!0),t=JSON.stringify(e)),this.config.accountId&&(o["X-Account-Id"]=this.config.accountId),eh.toQueryString(o)),s=this.currFileCtx.proxyStsToken||this.config.stsToken,u=s.AccessKeyID,l=s.AccessKeyId,f=s.SecretAccessKey,s=s.SessionToken,c={method:"POST",url:"".concat(n,"?").concat(c),timeout:this.config.gatewayTimeout||3e4,region:i,params:o,headers:{},pathname:eh.getPathByURL(n)},i=(e?(c.custom=t,c.body=e):(c.custom="none",c.headers["Content-Type"]="application/json"),new eC.a(c,a)),o=r.systemTimeGap,n=o?new Date((new Date).getTime()+o):new Date;i.addAuthorization({accessKeyId:l||u,secretAccessKey:f,sessionToken:s},n),this.transport.send(c)}},{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now();try{this.commitUpload()}catch(e){this.fail({error:"catch error: ".concat(e.toString())})}}},{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){try{var r,i,n,o,s,a,c=JSON.parse(t.response);c.ResponseMetadata.Error?e.fail({xhr:t,errorCode:c.ResponseMetadata.Error.CodeN,error:c.ResponseMetadata.Error.Code,message:c.ResponseMetadata.Error.Message}):(r=eT.checkServiceName(e.options.type,e.config),i=c.Result,n={},r===et?e.isImageBatchUpload?(o=i.Results,s=i.PluginResult||[],o.forEach(function(e,t){o[t]=ty(ty({},o[t]),s[t])}),n=o):tp(n=i.Results[0],i.PluginResult&&i.PluginResult[0]):n=i.Results[0],a=tp(e.currFileCtx,{stage:"complete",type:"success",percent:100,extra:{message:"upload successful"},uploadResult:n,xhr:t,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration}),e.successProcess&&e.successProcess(a))}catch(r){e.fail({error:"catch error: ".concat(r.toString()),xhr:t})}}),this.transport.on("error",function(t){var r={error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t};t.response&&(t=JSON.parse(t.response)).ResponseMetadata&&t.ResponseMetadata.Error&&(r.errorCode=t.ResponseMetadata.Error.CodeN,r.error=t.ResponseMetadata.Error.Code,r.message=t.ResponseMetadata.Error.Message),e.fail(r)})}},{key:"fail",value:function(e){var t=this.options.context,r=this.options.key,i=e.xhr,n=e.errorCode||1005e3,o="prepare upload error: UNKNOWN",t=(i&&(o=0===i.status?"prepare upload error: NETERROR":e.message||"prepare upload error: ".concat(i.status)),tp(t.tasks[r],{extra:{message:o,error:e.error,errorCode:n},type:"error",stage:"complete",xhr:i,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}));this.failProcess(t)}}],tg(o.prototype,t),r&&tg(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function t_(e){return(t_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tS(){return(tS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tw(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tk(e,t){return(tk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tx(e){return(tx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tO=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tk(e,t)}(o,i.a);var e,t,r,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tx(o);return function(e,t){if(t&&("object"===t_(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tx(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function o(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length?arguments[2]:void 0,s=3<arguments.length?arguments[3]:void 0;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e)).tasks=e,t.config=r,t.key=s,t.uploaderCtx=i,t.current=0,t.length=t.tasks.length,t.taskError={},t.uploadList=[],t.retryTaskTime=r.retryTaskTime||2,t}return t=[{key:"start",value:function(){var e=this.tasks.shift();e&&(this.current=e.index,this.execTask(e))}},{key:"execTask",value:function(e){var t,r,i=this,n=e.key,o=this.uploaderCtx,s=o.tasks[n];s&&(t=s.cacheTask,r=o.taskList[n].length,t&&0<e.index&&e.index<t?this.start():(s.currentTask=e.index,1===s.status&&e&&e.func.call(e.context,e.arg,function(t){var s;o.taskList[n]&&((s=o.taskList[n][e.index+1])&&0!==e.index?o._saveTask(n,{currentTask:s.index,stage:s.stage}):e.index===r-1&&o._removeTaskCache(n),0<i.tasks.length?i.start():o._queueSuccess(n),i.success(t))},function(t){var r;t.xhr&&400<=t.xhr.status?i.fail(t):!i.taskError[n]||i.taskError[n]<i.retryTaskTime?(i.taskError[n]?i.taskError[n]++:i.taskError[n]=1,r=i.errorFormat(t,!0),i.uploaderCtx.logger.send(r),i.execTask(e)):(t.key=n,i.fail(t))})))}},{key:"addTask",value:function(e){this.tasks.push(e)}},{key:"success",value:function(e){var t;e.xhr&&(t=e.xhr,e.req={url:t.currentUrl,param:t.params},e.res={status:t.status,header:t.getAllResponseHeaders(),body:t.responseText},delete e.xhr),tS(e,{type:"success"});try{this.uploaderCtx._broadcast(e.stage,e)}catch(e){}this.uploaderCtx.logger.send(e)}},{key:"fail",value:function(e){var t=this.uploaderCtx,r=e.key,e=this.errorFormat(e);try{t._broadcast("error",e)}catch(e){}t.tasks[r].isBreak?t._cancel(r):t._pause(r),t.logger.send(e)}},{key:"cancel",value:function(e){var t,r;e||(e=this.key,t=this.uploaderCtx.tasks[e].currentTask,this.uploaderCtx.taskList[e].forEach(function(e){t===e.index&&(r=e)}),this.tasks=[],r&&3===r.index&&r.context.stop(),this.uploaderCtx._removeTaskCache(e))}},{key:"restart",value:function(){this.uploadList.forEach(function(e){e.cancel=!1}),this.start()}},{key:"errorFormat",value:function(e,t){var r,t={type:t?"retry":"error"};return e.xhr&&(r=e.xhr,e.req={url:r.currentUrl,param:r.params},e.res={status:r.status,header:r.getAllResponseHeaders(),body:r.responseText},e.extra&&(e.extra.req=e.req,e.extra.res=e.res),delete e.xhr),tS(e,t)}}],tw(o.prototype,t),r&&tw(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}();function tC(e){return(tC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tT(){return(tT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tE(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tD(e,t){return(tD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tj(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tP(e){return(tP=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tI=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tD(e,t)}(s,i.a);var e,t,r,o=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tP(s);return function(e,t){if(t&&("object"===tC(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return tj(e)}(this,e?(t=tP(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function s(e){var t;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).config=tT({},n),t._mergeOptions(t.config,e),t.tasks={},t.taskList={},t.cache={},t.storage=eh.storage(tj(t)),t.logger=t.config.noLog?{send:function(){}}:new eu(t.config,tj(t)),t}return t=[{key:"_mergeOptions",value:function(e,t){t&&"object"===tC(t)&&(tT(e,t),Object.keys(t).forEach(function(r){"vodDomain"===r&&(e.replace[r]=t[r])}))}},{key:"_setCache",value:function(e,t){this.storage.setItem(e,t)}},{key:"_getCache",value:function(e){return this.storage.getItem(e)}},{key:"_removeCache",value:function(e){e?this.storage.removeItem(e):this.storage.clear()}},{key:"_addTask",value:function(e,t){var r=this.tasks,i=this.taskList;r[e]&&r[e].task?i[e].push(t):(i[e]=[],i[e].push(t),r[e]=r[e]||{},r[e].task=new tO([],this.config,this,e)),r[e].task.addTask(t)}},{key:"_broadcast",value:function(e,t){var r=this.tasks[t.key].status;if(1===r||0===r)try{this.emit(e,t)}catch(e){if(!(r=!("[object Error]"!==Object.prototype.toString.call(e)))||"Error"===e.name)throw e}}},{key:"_addCrc32ProcessTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=r.isDirect,r=r.isImageBatchUpload,e=new e_({file:e.file,context:this,key:t,isDirect:i,isImageBatchUpload:void 0!==r&&r},this.config),i={context:e,func:e.start,arg:{},key:t,index:0,stage:"crc32"};this._addTask(t,i)}},{key:"_addPreUploadTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=r.isDirect,r=r.isImageBatchUpload,i={file:e.file,stsToken:e.stsToken,context:this,type:e.type||$,preUploadUriParams:e.preUploadUriParams||{},storeKey:e.storeKey,key:t,isDirect:i,isImageBatchUpload:void 0!==r&&r,fileSize:e.fileSize||null},r=new ez(i,this.config),e={context:r,func:r.start,arg:{},key:t,index:1,stage:"preUpload"};this._addTask(t,e)}},{key:"_addDirectUploadTask",value:function(e,t){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).isImageBatchUpload,e=new to({file:e.file,context:this,key:t,isImageBatchUpload:void 0!==r&&r},this.config),r={context:e,func:e.start,arg:{},key:t,index:3,stage:"process"};this._addTask(t,r)}},{key:"_addInitUploadIDTask",value:function(e,t){e={context:e=new eH({file:e.file,context:this,key:t},this.config),func:e.start,arg:{},key:t,index:2,stage:"initUploadID"},this._addTask(t,e)}},{key:"_addUploadProcessTask",value:function(e,t){e={context:e=new e2({file:e.file,context:this,key:t},this.config),func:e.start,arg:{},key:t,index:3,stage:"process"},this._addTask(t,e)}},{key:"_addStreamUploadTask",value:function(e,t){this.streamUploadTask=new tf({context:this,key:t},this.config);var r={context:this.streamUploadTask,func:this.streamUploadTask.start,arg:{},key:t,index:3,stage:"process"};this._addTask(t,r)}},{key:"_mergeFileTask",value:function(e,t){e={context:e=new e9({file:e.file,context:this,stage:"fileMerge",key:t},this.config),func:e.start,arg:{},key:t,index:4,stage:"fileMerge"},this._addTask(t,e)}},{key:"_getMetaInfoTask",value:function(e,t){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).isImageBatchUpload,e={file:e.file,context:this,data:e.data,type:e.type||$,callbackArgs:e.callbackArgs,key:t,isImageBatchUpload:void 0!==r&&r},r=new tb(e,this.config),e={context:r,func:r.start,arg:{},key:t,index:5,stage:"complete"};this._addTask(t,e)}},{key:"_addAllUploadProcess",value:function(e,t){var r=e.type===Z&&"[object Array]"===Object.prototype.toString.call(e.file),i=(this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||$,this.tasks[t].fileSize=e.file&&e.file.size,this.tasks[t].proxyStsToken=e.stsToken,e.file.size<=eh.getFileSliceLength(e.file)||r);this._addCrc32ProcessTask(e,t,{isDirect:i,isImageBatchUpload:r}),this._addPreUploadTask(e,t,{isDirect:i,isImageBatchUpload:r}),i?this._addDirectUploadTask(e,t,{isImageBatchUpload:r}):(this._addInitUploadIDTask(e,t),this._addUploadProcessTask(e,t),this._mergeFileTask(e,t)),this._getMetaInfoTask(e,t,{isImageBatchUpload:r})}},{key:"_addAllUploadProcessClientEncrypt",value:function(e){var t,r=this;return e.type===Z&&Array.isArray(e.file)?(t=[],e.file.forEach(function(i){t.push(r._createClientEncryptTask({stsToken:e.stsToken,type:e.type,file:i}))}),t):this._createClientEncryptTask(e)}},{key:"_createClientEncryptTask",value:function(e){var t=eh.getUnique("file");return this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||$,this.tasks[t].fileSize=e.file&&e.file.size,this.tasks[t].proxyStsToken=e.stsToken,this.tasks[t].clientEncryptKey=eh.generateKey(16),this._addCrc32ProcessTask(e,t,{isDirect:!1,isImageBatchUpload:!1}),this._addPreUploadTask(e,t,{isDirect:!1,isImageBatchUpload:!1}),this._addInitUploadIDTask(e,t),this._addUploadProcessTask(e,t),this._mergeFileTask(e,t),this._getMetaInfoTask(e,t,{isImageBatchUpload:!1}),t}},{key:"_addAllStreamUploadProcess",value:function(e,t){this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||$,this.tasks[t].proxyStsToken=e.stsToken,this._addPreUploadTask(e,t),this._addStreamUploadTask(e,t),this._mergeFileTask(e,t),this._getMetaInfoTask(e,t)}},{key:"_addStreamSlice",value:function(e){var t=e.fileSlice,e=e.index;this.streamUploadTask.addStreamSlice({fileSlice:t,index:e})}},{key:"_completeStreamUpload",value:function(){this.streamUploadTask.completeStreamUpload()}},{key:"_run",value:function(e){var t=this.tasks,r=navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/);if(r&&r[1]&&9>=Number(r[1]))return this._broadcast("error",tT(t[e],{key:e,status:0,stage:"browserError",extra:{message:"cannot support the browser below ie10"},type:"error"})),this.logger.send(t[e]),void this._cancel(e);t[e]&&(3===t[e].status?this._restart(e):(r=new Date,t[e].startTime=r.getTime(),t[e].task&&1!==t[e].status&&t[e].task.tasks.length&&(t[e].status=1,this.logger.send(tT({},t[e],{extra:{message:"start upload"},type:"start",key:e})),t[e].task.start())))}},{key:"_restart",value:function(e){var t,r,i=this,n=this.tasks;n[e]&&(t=n[e].task,r=n[e].currentTask||0,this.taskList[e].forEach(function(n,o){n.index===r&&(t.tasks=i.taskList[e].slice(o))}),t&&1!==n[e].status&&t.tasks.length&&(n[e].status=1,t.restart()))}},{key:"_cancel",value:function(e){var t=this.tasks;t[e]&&(t[e].status=2,t[e].task.cancel(),delete this.taskList[e])}},{key:"_pause",value:function(e){var t=this.tasks;t[e]&&(t[e].status=3,t[e].task.cancel(!0),this._saveTask(e))}},{key:"_removeTaskCache",value:function(e){var t=this.tasks;t[e]&&(t=t[e].crc32Key)&&this._removeCache(t)}},{key:"_saveTask",value:function(e,t){(t=(e=tT({},this.tasks[e],t||{})).crc32Key)&&(delete e.task,delete e.xhr,delete e.crc32Array,this._setCache(t,JSON.stringify(e)))}},{key:"_queueSuccess",value:function(e){var t,r=this.tasks;r[e]&&(t=new Date,r[e].endTime=t.getTime(),r[e].time=r[e].endTime-r[e].startTime,r[e].status=0,this.taskList[e]=[])}},{key:"_removeFile",value:function(e){delete this.tasks[e]}},{key:"_batchAction",value:function(e){Object.keys(this.tasks).forEach(function(t){e&&e(t)})}},{key:"_refreshSTSToken",value:function(e){var t=this,r=this.tasks;Object.keys(r).forEach(function(i){var i=r[i],n=tT({},i,{proxyStsToken:e}),o=(i.proxyStsToken=e,n.crc32Key);o&&(delete n.task,delete n.xhr,delete n.crc32Array,i.proxyStsToken=e,t._setCache(o,JSON.stringify(n)))})}},{key:"_setOption",value:function(e){this._mergeOptions(this.config,e)}},{key:"_getOption",value:function(e){var t=tT({},this.config);return Object.keys(t).forEach(function(e){(-1<e.indexOf("Url")||"replace"===e||"log"===e)&&delete t[e]}),e?t[e]:t}},{key:"_userCancel",value:function(e){var t=this,r=this.tasks;e?(this._cancel(e),this.logger.send(tT({},r[e],{type:"cancel"})),delete this.tasks[e]):Object.keys(r).forEach(function(e){t._cancel(e),t.logger.send(tT({},r[e],{type:"cancel"})),delete t.tasks[e]})}},{key:"_userPause",value:function(e){var t=this,r=this.tasks;e?(this._pause(e),this.logger.send(tT({},r[e],{type:"pause"}))):Object.keys(r).forEach(function(e){t._pause(e),t.logger.send(tT({},r[e],{type:"pause"}))})}}],tE(s.prototype,t),r&&tE(s,r),Object.defineProperty(s,"prototype",{writable:!1}),s}();function tA(e){return(tA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tz(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tR(e,t){return(tR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tB(e){return(tB=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tU=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tR(e,t)}(n,tI);var e,t,r,i=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var t,r=tB(n);return function(e,t){if(t&&("object"===tA(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,e?(t=tB(this).constructor,Reflect.construct(r,arguments,t)):r.apply(this,arguments))});function n(){return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),i.apply(this,arguments)}return t=[{key:"start",value:function(e){this.abort=!1,e?this._run(e):this._batchAction(this._run.bind(this))}},{key:"addFile",value:function(e){var t;return e&&eT.checkStsToken(e.stsToken)?e.file&&this.config.clientEncrypt?this._addAllUploadProcessClientEncrypt(e):e.file?(t=eh.getUnique("file"),this._addAllUploadProcess(e,t),t):null:(this.emit("error",{extra:{message:eg,errorCode:1000002}}),null)}},{key:"addImageFile",value:function(e){var t;return e&&eT.checkStsToken(e.stsToken)?e.file?(e.type=e.type||Z,t=eh.getUnique("file"),this._addAllUploadProcess(e,t),t):null:(this.emit("error",{extra:{message:eg,errorCode:1000002}}),null)}},{key:"addStreamUploadTask",value:function(e){if(!e||!eT.checkStsToken(e.stsToken))return this.emit("error",{extra:{message:eg,errorCode:1000002}}),null;var t=eh.getUnique("file");return this._addAllStreamUploadProcess(e,t),t}},{key:"addStreamSlice",value:function(e){var t=e.fileSlice,e=e.index;this._addStreamSlice({fileSlice:t,index:e})}},{key:"completeStreamUpload",value:function(){this._completeStreamUpload()}},{key:"removeFile",value:function(e){e&&this._removeFile(e)}},{key:"cancel",value:function(e){e?this._userCancel(e):this._batchAction(this._userCancel.bind(this))}},{key:"pause",value:function(e){this._userPause(e)}},{key:"restart",value:function(e){e?this._restart(e):this._batchAction(this._restart.bind(this))}},{key:"refreshSTSToken",value:function(e){this._refreshSTSToken(e)}},{key:"setOption",value:function(e){this._setOption(e)}},{key:"getOption",value:function(e){return this._getOption(e)}}],tz(n.prototype,t),r&&tz(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}()}]).default}}]);