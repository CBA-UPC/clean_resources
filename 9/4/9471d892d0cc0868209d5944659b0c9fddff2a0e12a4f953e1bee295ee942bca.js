"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[17509],{84149:(e,n,t)=>{t.d(n,{Vu:()=>v,Xk:()=>_,ZW:()=>P,qD:()=>w});var o=t(42947),r=t(54620),i=t(61248),s=t(33487),a=t(49669);st u="login",p=g=p("USER_PRC_DATA"),y=p("USER_DATA"),f=p("OPEN_LOGIN"),m=p("LOADING"),v=(p("USER_LOGIN_STATUS"),{IDLE:"IDLE",LOADING:"LOADING",DONE:"DONE"});function P(e){return{type:y,payload:{userData:e}}}unction w(){return e=>new Promise(((n,t)=>{e(I(v.LOADING)),function(){const e=(0,r.ej)("ssoid"),n=(0,r.ej)("TicketId")||(0,r.ej)("Ticketid")||(0,r.ej)("ticketId"),t=window&&window.App&&window.App.state&&window.App.state.isMobile?s.YLK:s.rR3;return o.Z.get(`${t}`,{headers:{ticketId:n,ssoId:e}})}().then((o=>{(0,i.fx)(null==o?void 0:o.data),e(null==o?void 0:o.data)),e(I(v.DONE)),null!=o&&o.data?n(o.data):t(new Error("Error in fetching prc data"))})).catch((n=>{e(I(v.DONE)),t(new Error(null==n?void 0:n.response))}))}))}.Z.register(u,(function(e={userPrcData:null},n={}){switch(n.type){case y:{const t=e.userData||{};return c(c({},e),{},{userData:c(c({},t),n.payload.userData)})}case g:{const t=e.userPrcData||{};return c(c({},e),{},{userPrcData:c(c({},t),n.payload.userPrcData)})}case f:return c(c({},e),{},{openLogin:n.payload.openLogin});case m:return c(c({},e),{},{isLoading:n.payload||v.IDLE});default:return e}}))},22651:(e,n,t)=>{t.r(n),t.d(n,{default:()=>O});var o=t(67294),r=t(94829),i=t(61248),s=t(33487),a=t(45697),l=t.n(a),c=t(42947),d=t(37974),u=t(84149),p=t(54620),g=t(99408),y=t(41459),f=t(39911);const m="PAYMENT_SUCCESS",v="PAYMENT_PENDING",P="PAYMENT_FAILED",I="PAYMENT_UNREACHABLE",w=({isWapView:e,geoCountry:n,msid:t,storyTitle:a,userPrcData:l,loading:d})=>{const w=(0,i.Qw)();let _="";const $=(e,n,o={})=>{let r="",i="";const s=localStorage.getItem("oldPRC"),l=null==o?void 0:o.clickNudgeInfoValue,c=null==l?void 0:l.msid,d=null==l?void 0:l.storyTitle;if(e===m?("PAY_PER_ARTICLE"===n?(i=a,r=s?`TOIPlus_PRCNA_success_PerStory_${t}_${s}`:`TOIPlus_PAID_success_PerStory_${t}`):"TOI_PLUS"===n||"TOIPLUS"===n||"TOI+"===n||"TIMESPRIME"===n?s?t&&a?(r=`TOIPlus_PRCNA_success_story_${t}_(${s},${w})`,i=`Ps-${w}`):(r=`TOIPlus_PRCNA_success_(${s},${w})`,i=`Ps-${w}`):c&&d?(r=`TOIPlus_PAID_success_story_${c}`,i=d):(r="TOIPlus_PAID_success",i=`Ps-${w}/${_||"TOIPlusPAID"}`):(r="TOIPlus_PAID_success",i=`Ps-${w}/${_||"TOIPlusPAID"}`),localStorage.removeItem("oldPRC")):e===v?(r=t?`TOIPlus_PRCNA_pending_story_${t}_${s}`:`TOIPlus_PRCNA_pending_${s}`,i=`Ps-${w}`):e===P?(r="TOIPlus_PAID_fail",i=`Ps-${w}`):e===I&&(r="TOIPlus_NoResponsefromserver_PostPayment",i=`Ps-${w}`,"PAY_PER_ARTICLE"===n&&(r=`${r}_PerStory`)),!(t&&a&&c&&d)){const o={msid:t,storyTitle:a,prc:w,oldPRC:s,screenType:e,clickNudgeInfoValue:l,planAccessType:n};(0,y.Z)("postProcessOrder_Log",o)}var u,p;u=r,p=i,"undefined"!=typeof window&&(0,g.Z)("ga","send","event","TOIPlus",u,p)},T=t=>{let o;localStorage.setItem("paymentSuccess",!0);const i={};i.headers={"X-CLIENT-ID":e?s.eXJ:s.lIm,"X-SITE-APP-CODE":s.LuN};const a=`${s.$vF}/subscription/merchant/TOI/product/TOIPLUS/initTrans/${t}/findSubscription`;c.Z.get(a,i).then((e=>{const t=e.data.subscriptionDetail,{userDetail:i}=e.data;if(t){o=m;const e=t.planName;let a;if("undefined"!=typeof window&&window.localStorage&&localStorage.getItem("nudgeClickInfo")&&(a=JSON.parse(localStorage.getItem("nudgeClickInfo"))),"PAY_PER_ARTICLE"===e?(_="PAY_PER_ARTICLE",sessionStorage.setItem("pps_planstatus",o)):_="TOI_PLUS"===e?"TOIPlusPAID":"TIMESPRIME"===e?"TOIPlus_TimesPrimePaid":t.planName,(0,r.WU)(`${e}_`,"dimension33"),(o===m||o===P)&&(s=["paymentSuccess","toi_cookie","retry_popup_closed","nudgeClickInfo"],Array.isArray(s)&&s.length&&s.forEach((),o===m)){(0,r.SX)("event","conversion",{send_to:"AW-877820074/83xdCPmvgoQDEKrxyaID",value:`${t.finalBillingAmount||0}`,currency:`${t.currency||""}`,transaction_id:`${i.transcode}`}),"undefined"!=typeof window&&"function"==typeof window.fbq&&window.fbq("track","Purchase",{currency:`${t.currency||""}`,value:`${t.finalBillingAmount||0}`});switch((0,p.ej)("utm_source")){case"admitad":{const e=document.createElement("img"),n=`https://ad.admitad.com/r?campaign_code=eefe603b78&action_code=1&uid=${(0,p.ej)("utm_source_id")}&order_id=${i.transcode}&tariff_code=1&price=${t.finalBillingAmount||0}&payment_type=sale&currency_code=${t.currency||""}`;e.src=n,e.width="1",e.height="1",document.body.appendChild(e);break}case"xapads":{const e=`https://trck.xapads.com/pixel?adid=60b9c6969c0169097767493b&goal_value=subscription&sale_amount=${Math.ceil(t.finalBillingAmount/2)}&currency=INR&sub1=${i.transcode}&sub2=${t.finalBillingAmount||0}&sub3=${n}`;document.body.appendChild(`<img src='${e}'>`);break}case"affle":{const e=`https://cost.affcost.com/pixel?adid=60b89b72c3d5391cfa6a5317&sub1=${i.transcode}&sale_amount=${t.finalBillingAmount||0}`;document.body.appendChild(`<img src='${e}'>`);break}}const e=window.location.href.replace("transcode","transcode_exp");window.history.pushState({},"",e)}$(o,e,{clickNudgeInfoValue:a})}var s})).catch(()};return(0,o.useEffect)((()=>{var e;if(!(localStorage.getItem(f.Z)&&(null===(e=JSON.parse(localStorage.getItem(f.Z)))||void 0===e?void 0:e.orderStatus))){const e=(()=>{let e="";return"undefined"!=typeof window&&(e=(0,r.vl)("transcode")),e})();e&&d!==u.Vu.LOADING&&d===u.Vu.DONE&&T(e)}}),[l,d]),o.createElement(o.Fragment,null)};w.propTypes={isWapView:l().bool.isRequired,userData:l().shape({}),msid:l().string,storyTitle:l().string,geoCountry:l().string},w.defaultProps={userData:{},msid:"",storyTitle:"",geoCountry:""};const _=(0,d.$j)((,null)(w);var $;onst A=e=>{const{msid:n,storyTitle:t}=e,s=(0,i.Th)(),{userData:a,isWapView:l,currencyCode:c}=e;return o.createElement(o.Fragment,null,(()=>{let e="";return"undefined"!=typeof window&&(e=(0,r.vl)("transcode")),e})()&&o.createElement(o.Fragment,null,T(_,{userData:a,isWapView:l,currencyCode:c,geoCountry:s,msid:n,storyTitle:t})))};A.defaultProps={userData:{},currencyCode:"",msid:"",storyTitle:"",userPrcData:{}};const O=A},39911:41459:(e,n,t)=>{t.d(n,{Z:);var o=t(54620);async function r(e="",n={}){var t,r,i,s,a,l,c,d,u;try{var p,g,y,f,m,v,P,I,w;const _=(0,o.ej)("_ga");let $=!1;const T=async()=>new Promise(((e,n)=>{let t="Unknown";const o=r=e=>e===eval.toString().length,i=()=>{void 0!==navigator.maxTouchPoints?(()=>{const e=String(Math.random());try{window.indexedDB.open(e,1).onupgradeneeded=n=>{let t;const r=n.target,i=null==r?void 0:r.result;try{i.createObjectStore("test",{autoIncrement:!0}).put(new Blob),o(!1)}catch(e){let n=e;if(t=e.message,e instanceof Error&&(n=null!=t?t:e),"string"!=typeof n)return o(!1);const r=/BlobURLs are not yet supported/.test(n);return o(r)}finally{i.close(),window.indexedDB.deleteDatabase(e)}}}catch(e){return o(!1)}})():(()=>{const e=window.openDatabase,n=window.localStorage;try{e(null,null,null,null)}catch(e){return o(!0)}try{n.setItem("test","1"),n.removeItem("test")}catch(e){return o(!0)}o(!1)})()},s=()=>{navigator.webkitTemporaryStorage.queryUsageAndQuota(((e,n)=>{o(n<(()=>{const e=window;return void 0!==e.performance&&void 0!==e.performance.memory&&void 0!==e.performance.memory.jsHeapSizeLimit?performance.memory.jsHeapSizeLimit:1073741824})())}),()},a=()=>{void 0!==self.Promise&&void 0!==self.Promise.allSettled?s():(0,window.webkitRequestFileSystem)(0,1,(()=>{o(!1)}),()};(()=>{const e=navigator.vendor;return void 0!==e&&0===e.indexOf("Apple")&&r(37)})()?(t="Safari",i()):(()=>{const e=navigator.vendor;return void 0!==e&&0===e.indexOf("Google")&&r(33)})()?(t=(()=>{const e=navigator.userAgent;return e.match(/Chrome/)?void 0!==navigator.brave?"Brave":e.match(/Edg/)?"Edge":e.match(/OPR/)?"Opera":"Chrome":"Chromium"})(),a()):void 0!==document.documentElement&&void 0!==document.documentElement.style.MozAppearance&&r(37)?(t="Firefox",o(void 0===navigator.serviceWorker)):void 0!==navigator.msSaveBlob&&r(39)?(t="Internet Explorer",o(void 0===window.indexedDB)):n(new Error("detectIncognito cannot determine the browser"))})),A=await T();$=null==A?void 0:A.isPrivate;const O=null==A?void 0:A.browserName;let b=`\n    Referrer URL is ${null===(p=document)||void 0===p?void 0:p.referrer},\n    Network is ${null===(g=navigator)||void 0===g||null===(y=g.connection)||void 0===y?void 0:y.effectiveType},\n    Network Speed is ${null===(f=navigator)||void 0===f||null===(m=f.connection)||void 0===m?void 0:m.downlink} Mb/s,\n    Current URL is ${null===(v=window)||void 0===v||null===(P=v.location)||void 0===P?void 0:P.href},\n    UserAgent is ${null===(I=navigator)||void 0===I?void 0:I.userAgent},\n    isGA loaded -  ${"function"==typeof ga},\n    Geo Location is ${JSON.stringify(null===(w=window)||void 0===w?void 0:w.geoinfo)},\n    geo country cookie  - ${(0,o.ej)("geo_country")},\n    isPrivateMode - ${$},\n    Browser Name - ${O}\n    `;switch(e){case"planpage":default:b=`${b} `;break;case"processOrder_Log":b=`${b} \n Process Order ::\n        _ga cookie is ${_},\n\n        Local Storage ::\n\n        isLocalStorageObject - ${"undefined"!=typeof localStorage}\n        Initiation page is ${null==n||null===(t=n.nudgeClickInfo)||void 0===t?void 0:t.initiationPage},\n        Nudge Name is ${null==n||null===(r=n.nudgeClickInfo)||void 0===r?void 0:r.nudgeName},\n        Subscription Type is ${null==n||null===(i=n.options)||void 0===i?void 0:i.orderType},\n\n        \n -------- If initiation page is story page then -------- \n\n        story title is ${null==n||null===(s=n.nudgeClickInfo)||void 0===s?void 0:s.storyTitle} (required for every payment from story page), \n\n        isPayperStory : ${"PAY_PER_ARTICLE"===(null==n||null===(a=n.options)||void 0===a?void 0:a.orderType)}\n        if payperstory true, nudgeClickInfo msid is ${null==n||null===(l=n.nudgeClickInfo)||void 0===l?void 0:l.initiateMsId},\n        options msid is ${null==n||null===(c=n.options)||void 0===c?void 0:c.initiateMsId}\n        `;break;case"postProcessOrder_Log":b=`${b} \n\n        category : PostPaymentDetails,\n        msid : ${null==n?void 0:n.msid}\n        storyTitle: ${null==n?void 0:n.storyTitle}\n        prc: ${null==n?void 0:n.prc}\n        oldPrc: ${null==n?void 0:n.oldPRC}\n        popUpScreenType: ${null==n?void 0:n.screenType}\n        accessType: ${null==n?void 0:n.planAccessType}\n        nudgeClickInfo: {\n          msid: ${null==n||null===(d=n.clickNudgeInfoValue)||void 0===d?void 0:d.msid},\n          storyTitle: ${null==n||null===(u=n.clickNudgeInfoValue)||void 0===u?void 0:u.storyTitle}, \n        }\n\n        `}const h=`https://chat.googleapis.com/v1/spaces/AAAAdzvHYZ0/messages?key=${"AIzaSyDdI0hCZtE6vySjMm-WEfRq3CPzqKqqsHI&token=0KWNHsfirvee1-OC50ThL-P6j2NlA9bADG3w1P_zsWU%3D"}`,D={method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:b})},S=await fetch(h,D);if(200!==S.status)throw new Error(S.statusText)}catch(e){console.log("error in api response",e)}}}}]);
//# sourceMappingURL=ToiSubscriptionLoader_es6_module.d3cb39c5.chunk.js.map