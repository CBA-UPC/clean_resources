import{P as y,H as h,Q as c,L as p,A as s,B as o,I as n,J as l,G as f,O as u}from"./vendor_6ed58054_r24-02-0_b0_t240129-161140.js";import{useCsrViewStorePaymentInfo as _}from"./csrViewStorePaymentInfo_4f7a2838_r24-02-0_b0_t240129-161140.js";import{u as G}from"./index_31ad23dc_r24-02-0_b0_t240129-161140.js";import{a as N}from"./csrViewStoreCheckout_89574990_r24-02-0_b0_t240129-161140.js";import{useCsrViewStorePaypal as I}from"./csrViewStorePaypal_322e05fd_r24-02-0_b0_t240129-161140.js";import{useCsrViewStoreAfterpay as P}from"./csrViewStoreAfterpay_7d0945dc_r24-02-0_b0_t240129-161140.js";import{useCsrViewStoreBraintree as v}from"./csrViewStoreBraintree_b6a44787_r24-02-0_b0_t240129-161140.js";import{a as k}from"./csrGlobalStoreCart_c99ec818_r24-02-0_b0_t240129-161140.js";import{u as g}from"./csrViewStoreCart_eff1e54c_r24-02-0_b0_t240129-161140.js";import{S as B}from"./SvgIcon_e55bd28a_r24-02-0_b0_t240129-161140.js";import{T as E}from"./TextInputGroup_667d632a_r24-02-0_b0_t240129-161140.js";import{k as w,l as R}from"./regexLocalization_16c032f3_r24-02-0_b0_t240129-161140.js";import{aa as C,ab as V}from"./lsanalytics-cart_5cb2710b_r24-02-0_b0_t240129-161140.js";import{_ as L}from"./_plugin-vue_export-helper_c27b6911_r24-02-0_b0_t240129-161140.js";const S={components:{SvgIcon:B,TextInputGroup:E},data(){return{isValidNumber:!0,isValidPIN:!0,giftNumberLabel:this.$t("i18n.giftCardNumberLabel"),giftPINLabel:this.$t("i18n.giftCardPinLabel"),giftNumber:"",giftPIN:"",numberErrorType:"",pinErrorType:"",giftNumberLength:21,giftPINLength:4,isNumberReady:!1,isPINReady:!1,isInvalidCardOrPin:!1,showGiftcardBalance:!1,giftCardBalanceFormatted:"",disableCheckBalanceButton:!1,updatedCurrencyCode:this.currencyCode}},props:{isDisabled:Boolean,fromCheckout:{type:Boolean,default:!0},currencyCode:{type:String,default:"USD"}},computed:{...y(N,["giftCardPin","giftCardNumber"]),...h(P,["afterpayOrderReady"]),...h(G,["locale"]),...h(k,["cart"]),...y(g,["giftCardError","giftCardExists","giftCardBalance","giftCardInsufficientError"]),...h(g,["hasGiftCardNumber","hasGiftCards","hasZeroBalance"]),numberErrorMsg(){switch(this.numberErrorType){case"regex":return this.$t("i18n.giftCardNumError");default:return""}},pinErrorMsg(){switch(this.pinErrorType){case"regex":return this.$t("i18n.giftCardPinError");default:return""}},getGiftCardNumber(){return this.giftNumber?this.giftNumber:this.hasGiftCardNumber?this.cart.additionalPaymentInfos[0].number:null},getGiftCardPingiftCardAmount(){return this.hasGiftCardNumber?this.cart.additionalPaymentInfos[0].appliedAmount.formattedValue:null},giftCardInsufficientErrorMsg(){return`Your ${this.$t("i18n.giftCardEndingIn").toLowerCase()} ${this.truncatedGiftCardNumber()} has a balance of ${this.giftCardAmount}. Please enter payment details below.`}},methods:{...c(I,["resetPaypalAuth","resetPaypalAuthIfNeeded"]),...c(N,["resetGiftCard"]),...c(v,["resetBraintreeAuth"]),...c(g,["applyGiftCardToCart","removeGiftCardFromCart","checkGiftCardBalance"]),...c(_,["clearSavedPaymentInfo"]),async applyGiftCard(){const e={giftCardNumber:this.giftNumber,pin:this.giftPIN};C("apply"),await this.applyGiftCardToCart({giftCardDetailInput:e}),this.hasGiftCards&&this.hasZeroBalance&&(await this.resetPaypalAuth(),this.resetBraintreeAuth(),this.clearSavedPaymentInfo())},async removeGiftCard(){C("remove"),this.resetPaypalAuthIfNeeded(),await this.removeGiftCardFromCart()},truncatedGiftCardNumber(){if(this.hasGiftCardNumber){const e=this.getGiftCardNumber,t=e.length;return e.slice(t-4)}return null},evaluateNumber(e,t=!0){const r=w(e);return t&&(this.numberErrorType=r.errorType,this.isValidNumber=r.isValid),r.isValid===!0&&e.length===this.giftNumberLength?(this.isNumberReady=!0,this.giftNumber=e):(this.showGiftcardBalance=!1,this.isNumberReady=!1),r.isValid},evaluatePIN(e,t=!0){const r=R(e);return t&&(this.pinErrorType=r.errorType,this.isValidPIN=r.isValid),r.isValid===!0&&e.length===this.giftPINLength?(this.isPINReady=!0,this.giftPIN=e):(this.showGiftcardBalance=!1,this.isPINReady=!1),r.isValid},clearInputs(){if(this.$refs&&this.$refs.inputContainer){const e=Array.from(this.$refs.inputContainer.querySelectorAll("input"));e.length&&e.forEach(,this.isNumberReady=!1,this.isPINReady=!1,this.giftNumber="",this.giftPIN=""}},checkGiftCardBalanceLocal(){this.isPINReady||this.evaluatePIN(""),this.isNumberReady||this.evaluateNumber(""),!(!this.isNumberReady||!this.isPINReady)&&(this.showGiftcardBalance=!1,this.checkGiftCardBalance({giftNumber:this.giftNumber,giftPIN:this.giftPIN}).then(e=>{if(this.clearGiftCardPin(),e.errors&&e.errors.length>0)this.giftCardError=!0;else{const{giftCardBalance:t,currencyCode:r}=e.data.checkGiftCardBalance;this.showGiftcardBalance=!0,this.updatedCurrencyCode=r,this.giftCardError=!1,this.giftCardExists=!0,this.giftCardBalance=t,V(t)}}))},clearGiftCardPin,watch:{hasGiftCardNumber(e){!e&&!this.giftCardExists&&(C("check balance"),this.resetGiftCard(),this.clearInputs())},giftCardBalance(e){const t=this.locale.replace("_","-");this.giftCardBalanceFormatted=new Intl.NumberFormat(t,{style:"currency",currency:this.updatedCurrencyCode}).format(e)}},beforeUnmount,A={class:"gift-card"},T=["aria-label"],x={key:0,class:"lsco-row"},O={class:"lsco-container gift-card__header"},F={key:1,class:"lsco-row gift-card__error"},M={key:0,class:"error-copy"},D={key:1,class:"error-copy"},j={key:2,class:"lsco-row",ref:"inputContainer"},U={key:0,class:"lsco-col-xs-21 lsco-col-md-5 lsco-col-md-offset-1"},Z=["disabled"],q={key:3,class:"lsco-row"},z={class:"gift-card__balance"},H={key:4,class:"lsco-row"},J=["disabled"],Q={key:1,class:"gift-card__info"},W={key:0,class:"lsco-row gift-card__error global-alerts"},Y={class:"error-copy"},K={class:"applied-msg"},X={class:"gift-card__token"},$={class:"gift-card__token--label"},ee={class:"gift-card-number"},te={class:"gift-card-amount"};function re(e,t,r,ae,i,a){const m=p("SvgIcon"),b=p("TextInputGroup");return s(),o("div",A,[e.hasGiftCardNumber?(s(),o("div",Q,[e.giftCardInsufficientError&&r.fromCheckout?(s(),o("div",W,[u(m,{name:"error-exclamation","set-aria-hidden":!0}),n("p",Y,l(a.giftCardInsufficientErrorMsg),1)])):f("",!0),n("p",K,l(e.$t("i18n.giftCardAppliedText")),1),n("div",X,[n("button",{onClick:t[4]||(t[4]=(...d)=>a.removeGiftCard&&a.removeGiftCard(...d)),type:"button",class:"gift-card__remove","aria-label":"Delete gift card"},[u(m,{name:"close","set-aria-hidden":!0})]),n("div",$,[n("span",ee,l(e.$t("i18n.giftCardEndingIn"))+" "+l(a.truncatedGiftCardNumber()),1),n("span",te,l(a.giftCardAmount),1)])])])):(s(),o("div",{key:0,class:"gift-card__form",role:"form","aria-label":e.$t("i18n.giftCardLabel")},[r.fromCheckout?f("",!0):(s(),o("div",x,[n("div",O,l(e.$t("i18n.checkGCBalance")),1)])),e.giftCardError||e.afterpayOrderReady?(s(),o("div",F,[u(m,{name:"error-exclamation","set-aria-hidden":!0}),e.giftCardError?(s(),o("p",M,l(e.$t("i18n.giftCardError")),1)):f("",!0),e.afterpayOrderReady?(s(),o("p",D,l(e.$t("i18n.afterpayGCError")),1)):f("",!0)])):f("",!0),e.afterpayOrderReady?f("",!0):(s(),o("div",j,[u(b,{id:"gift-number",class:"lsco-col-xs-21 lsco-col-md-5","disable-state-update":!0,value:a.getGiftCardNumber,onCallback:t[0]||(t[0]=d=>this.giftNumber=d),type:"text","label-text":i.giftNumberLabel,validation:a.evaluateNumber,"is-valid":i.isValidNumber,"error-msg":a.numberErrorMsg,maxlength:i.giftNumberLength},null,8,["value","label-text","validation","is-valid","error-msg","maxlength"]),u(b,{id:"gift-pin",class:"lsco-col-xs-21 lsco-col-md-5 lsco-col-md-offset-1",type:"text","disable-state-update":!0,value:a.getGiftCardPin,onCallback:t[1]||(t[1]=,"label-text":i.giftPINLabel,validation:a.evaluatePIN,"is-valid":i.isValidPIN,"error-msg":a.pinErrorMsg,maxlength:i.giftPINLength},null,8,["value","label-text","validation","is-valid","error-msg","maxlength"]),r.fromCheckout?f("",!0):(s(),o("div",U,[n("button",{onClick:t[2]||(t[2]=(...d)=>a.checkGiftCardBalanceLocal&&a.checkGiftCardBalanceLocal(...d)),type:"button",class:"gift-card__button","aria-label":"check gift card balance",disabled:(!i.isPINReady||!i.isNumberReady)&&i.disableCheckBalanceButton},l(e.$t("i18n.checkBalanceCTA")),9,Z)]))],512)),!r.fromCheckout&&i.showGiftcardBalance?(s(),o("div",q,[n("span",z,l(e.$t("i18n.giftcardRemainingBalance"))+" "+l(i.giftCardBalanceFormatted),1)])):f("",!0),!e.afterpayOrderReady&&r.fromCheckout?(s(),o("div",H,[n("button",{class:"gift-card__button lsco-col-xs-21 lsco-col-md-5 lsco-col-lg-3",onClick:t[3]||(t[3]=,disabled:!i.isPINReady||!i.isNumberReady},l(e.$t("i18n.giftCardApplyText")),9,J)])):f("",!0)],8,T))])}const ye=L(S,[["render",re],["__scopeId","data-v-202c0581"]]);export{ye as g};
