// Web app's Firebase configuration
const firebaseConfig = {
apiKey: "AIzaSyBiV2EcGWm_K2CQRNZSrkOLWXV4m5POBpI",
    authDomain: "el-universal-oaxaca.firebaseapp.com",
    projectId: "el-universal-oaxaca",
    storageBucket: "el-universal-oaxaca.appspot.com",
    messagingSenderId: "907417517429",
    appId: "1:907417517429:web:487854c1f005b77697e73c"
};

const subscribeToNotification = function (token) {

  const request = new XMLHttpRequest();
  request.onreadystatechange = function () {
    if (request.readyState === 4) {
      const response = JSON.parse(request.response);
      if (request.status === 200) {
        localStorage.setItem('notificationEnabled', true);
        localStorage.setItem('firToken', token);
      } else {
        localStorage.setItem('notificationEnabled', false);
      }
    }
  }

  request.open('POST', 'https://notificaciones.eluniversal.com.mx/v1/push/subscribe');
  request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  request.send(JSON.stringify({
    "token": token,
    "topic": "web",
    "appId": 8
  }));
}

const unsubscribeNotification = function (token) {
  const request = new XMLHttpRequest();
  request.onreadystatechange = function () {

    if (request.readyState === 4) {
      const response = JSON.parse(request.response);
      if (request.status === 200) {
        localStorage.setItem('notificationEnabled', false);
        localStorage.setItem('firToken', null);
      } else {
        localStorage.setItem('notificationEnabled', true);
      }
    }
  }

  request.open('POST', 'https://notificaciones.eluniversal.com.mx/v1/push/unsubscribe');
  request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  request.send(JSON.stringify({
    "token": token,
    "topic": "web",
    "appId": 8
  }));
}

// Adding service worker
if ('serviceWorker' in navigator && 'Notification' in window) {
  window.addEventListener('load', function () {
    navigator.serviceWorker.register('/sites/default/files/firebase-messaging-sw.js')
      // navigator.serviceWorker.register('firebase-messaging-sw.js')
      .then((registration) => {
		
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        var messaging = firebase.messaging();
        messaging.usePublicVapidKey("BHhH94Chgd4FFySm5cKOkltzU3HdiBEdqITDTbsxlJdjV0ReRc9_Imqp8VrrjEfs7eke7ochc_uXlJdazvCvNgc");
        messaging.useServiceWorker(registration);

        Notification.requestPermission(function (permission) {
          const notificationEnabled = localStorage.getItem('notificationEnabled');

          if (permission === 'granted' && notificationEnabled != true && typeof (Storage) !== "undefined") {
            messaging.getToken().then(function (currentToken) {
			  
              if (currentToken) {

                subscribeToNotification(currentToken);
              }
            }).catch(function (err) {
              console.log('An error occurred while retrieving token. ', err);
            });
          } else if (permission === 'granted' && (notificationEnabled === null || notificationEnabled == false )) {
            messaging.getToken().then(function (currentToken) {
			
              if (currentToken) {

                subscribeToNotification(currentToken);
              }
            }).catch(function (err) {
              console.log('An error occurred while retrieving token. ', err);
            });

          } else if (permission === 'denied' && notificationEnabled == true) {
            messaging.getToken().then(function () {
              unsubscribeNotification(localStorage.getItem('firToken'));
            }).catch(function (err) {
              console.log('An error occurred while retrieving token. ', err);
              unsubscribeNotification(localStorage.getItem('firToken'));
            });
          }

          // Callback fired if Instance ID token is updated.
          messaging.onTokenRefresh(function (currentToken) {
            unsubscribeNotification(currentToken);
            messaging.getToken().then(function (refreshedToken) {
              subscribeToNotification(refreshedToken);
            }).catch(function (err) {
              console.log('Unable to retrieve refreshed token ', err);
            });
          });
        })

        messaging.onMessage(function (payload) {
		  
          return registration.showNotification(payload.data.title, {
            body: payload.data.body,
            image: payload.data.note_image,
            data: payload.fcmOptions.link,
            icon: 'https://sanluisdev.eluniversal.com.mx/sites/all/themes/eluniversal/favicon.ico',
            badge: 'https://sanluisdev.eluniversal.com.mx/sites/all/themes/eluniversal/favicon.ico'
          });
        });
      });
  });
}
;/*})'"*/
;/*})'"*/
s.trigger("changeId",this,g,s)}if(!r){a.length&&(this._pending=s);for(var m=0;m<a.length;m++)this.trigger("change:"+a[m],this,l[a[m]],s)}if(d)return this;if(!r)for(;this._pending;)s=this._pending,this._pending=!1,this.trigger("change",this,s);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var s in this.attributes)t[s]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,s=this._changing?this._previousAttributes:this.attributes,o={};for(var n in e){var r=e[n];i.isEqual(s[n],r)||(o[n]=r,t=!0)}return!!t&&o},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,s=e.success;return e.success=function(i){var o=e.parse?t.parse(i,e):i;if(!t.set(o,e))return!1;s&&s.call(e.context,t,i,e),t.trigger("sync",t,i,e)},q(this,e),this.sync("read",this,e)},save:function(e,t,s){var o;null==e||"object"==typeof e?(o=e,s=t):(o={})[e]=t;var n=(s=i.extend({validate:!0,parse:!0},s)).wait;if(o&&!n){if(!this.set(o,s))return!1}else if(!this._validate(o,s))return!1;var r=this,a=s.success,d=this.attributes;s.success=function(e){r.attributes=d;var t=s.parse?r.parse(e,s):e;if(n&&(t=i.extend({},o,t)),t&&!r.set(t,s))return!1;a&&a.call(s.context,r,e,s),r.trigger("sync",r,e,s)},q(this,s),o&&n&&(this.attributes=i.extend({},d,o));var l=this.isNew()?"create":s.patch?"patch":"update";"patch"!==l||s.attrs||(s.attrs=o);var h=this.sync(l,this,s);return this.attributes=d,h},destroy:function(e){e=e?i.clone(e):{};var t=this,s=e.success,o=e.wait,n=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){o&&n(),s&&s.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var r=!1;return this.isNew()?i.defer(e.success):(q(this,e),r=this.sync("delete",this,e)),o||n(),r},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||G();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var s=this.validationError=this.validate(e,t)||null;return!s||(this.trigger("invalid",this,s,i.extend(t,{validationError:s})),!1)}});var b=t.Collection=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},_={add:!0,remove:!0,merge:!0},S={add:!0,remove:!1},y=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var s,o=Array(e.length-i),n=t.length;for(s=0;s<o.length;s++)o[s]=e[s+i];for(s=0;s<n;s++)e[s+i]=t[s];for(s=0;s<o.length;s++)e[s+n+i]=o[s]};i.extend(b.prototype,a,{model:f,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,S))},remove:function(e,t){t=i.extend({},t);var s=!i.isArray(e);e=s?[e]:e.slice();var o=this._removeModels(e,t);return!t.silent&&o.length&&(t.changes={added:[],merged:[],removed:o},this.trigger("update",this,t)),s?o[0]:o},set:function(e,t){if(null!=e){(t=i.extend({},_,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var s=!i.isArray(e);e=s?[e]:e.slice();var o=t.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var n,r,a=[],d=[],l=[],h=[],c={},u=t.add,g=t.merge,m=t.remove,p=!1,v=this.comparator&&null==o&&!1!==t.sort,f=i.isString(this.comparator)?this.comparator:null;for(r=0;r<e.length;r++){n=e[r];var b=this.get(n);if(b){if(g&&n!==b){var S=this._isModel(n)?n.attributes:n;t.parse&&(S=b.parse(S,t)),b.set(S,t),l.push(b),v&&!p&&(p=b.hasChanged(f))}c[b.cid]||(c[b.cid]=!0,a.push(b)),e[r]=b}else u&&(n=e[r]=this._prepareModel(n,t))&&(d.push(n),this._addReference(n,t),c[n.cid]=!0,a.push(n))}if(m){for(r=0;r<this.length;r++)c[(n=this.models[r]).cid]||h.push(n);h.length&&this._removeModels(h,t)}var A=!1,T=!v&&u&&m;if(a.length&&T?(A=this.length!==a.length||i.some(this.models,(function(e,t){return e!==a[t]})),this.models.length=0,y(this.models,a,0),this.length=this.models.length):d.length&&(v&&(p=!0),y(this.models,d,null==o?this.length:o),this.length=this.models.length),p&&this.sort({silent:!0}),!t.silent){for(r=0;r<d.length;r++)null!=o&&(t.index=o+r),(n=d[r]).trigger("add",n,this,t);(p||A)&&this.trigger("sort",this,t),(d.length||h.length||l.length)&&(t.changes={added:d,removed:h,merged:l},this.trigger("update",this,t))}return s?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var s=0;s<this.models.length;s++)this._removeReference(this.models[s],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return n.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e,e.idAttribute)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var s=t.length;return i.isFunction(t)&&(t=t.bind(this)),1===s||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){var t=(e=i.extend({parse:!0},e)).success,s=this;return e.success=function(i){var o=e.reset?"reset":"set";s[o](i,e),t&&t.call(e.context,s,i,e),s.trigger("sync",s,i,e)},q(this,e),this.sync("read",this,e)},create:function(e,t){var s=(t=t?i.clone(t):{}).wait;if(!(e=this._prepareModel(e,t)))return!1;s||this.add(e,t);var o=this,n=t.success;return t.success=function(e,t,i){s&&(e.off("error",this._forwardPristineError,this),o.add(e,i)),n&&n.call(i.context,e,t,i)},s&&e.once("error",this._forwardPristineError,this),e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e,t){return e[t||this.model.prototype.idAttribute||"id"]},values:function(){return new T(this,w)},keys:function(){return new T(this,C)},entries:function(){return new T(this,P)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){return this._isModel(e)?(e.collection||(e.collection=this),e):((t=t?i.clone(t):{}).collection=this,(s=this.model.prototype?new this.model(e,t):this.model(e,t)).validationError?(this.trigger("invalid",this,s.validationError,t),!1):s);var s},_removeModels:function(e,t){for(var i=[],s=0;s<e.length;s++){var o=this.get(e[s]);if(o){var n=this.indexOf(o);this.models.splice(n,1),this.length--,delete this._byId[o.cid];var r=this.modelId(o.attributes,o.idAttribute);null!=r&&delete this._byId[r],t.silent||(t.index=n,o.trigger("remove",o,this,t)),i.push(o),this._removeReference(o,t)}}return e.length>0&&!t.silent&&delete t.index,i},_isModel:function(e){return e instanceof f},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes,e.idAttribute);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes,e.idAttribute);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,s){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,s),"changeId"===e){var o=this.modelId(t.previousAttributes(),t.idAttribute),n=this.modelId(t.attributes,t.idAttribute);null!=o&&delete this._byId[o],null!=n&&(this._byId[n]=t)}}this.trigger.apply(this,arguments)},_forwardPristineError:function(e,t,i){this.has(e)||this._onModelEvent("error",e,t,i)}});var A="function"==typeof Symbol&&Symbol.iterator;A&&(b.prototype[A]=b.prototype.values);var T=function(e,t){this._collection=e,this._kind=t,this._index=0},w=1,C=2,P=3;A&&(T.prototype[A]=function(){return this}),T.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var e,t=this._collection.at(this._index);if(this._index++,this._kind===w)e=t;else{var i=this._collection.modelId(t.attributes,t.idAttribute);e=this._kind===C?i:[i,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var E=t.View=function(e){this.cid=i.uniqueId("view"),this.preinitialize.apply(this,arguments),i.extend(this,i.pick(e,O)),this._ensureElement(),this.initialize.apply(this,arguments)},I=/^(\S+)\s*(.*)$/,O=["model","collection","el","id","attributes","className","tagName","events"];i.extend(E.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var s=e[t];if(i.isFunction(s)||(s=this[s]),s){var o=t.match(I);this.delegate(o[1],o[2],s.bind(this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}});var V=function(e,t,i,s){switch(t){case 1:return function(){return e[i](this[s])};case 2:return function(t){return e[i](this[s],t)};case 3:return function(t,o){return e[i](this[s],D(t,this),o)};case 4:return function(t,o,n){return e[i](this[s],D(t,this),o,n)};default:return function(){var t=n.call(arguments);return t.unshift(this[s]),e[i].apply(e,t)}}},N=function(e,t,s,o){i.each(s,(function(i,s){t[s]&&(e.prototype[s]=V(t,i,s,o))}))},D=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?R(e):i.isString(e)?function(t){return t.get(e)}:e},R=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}},M={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},x={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};i.each([[b,M,"models"],[f,x,"attributes"]],(function(e){var t=e[0],s=e[1],o=e[2];t.mixin=function(e){var s=i.reduce(i.functions(e),(function(e,t){return e[t]=0,e}),{});N(t,e,s,o)},N(t,i,s,o)})),t.sync=function(e,s,o){var n=F[e];i.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var r={type:n,dataType:"json"};if(o.url||(r.url=i.result(s,"url")||G()),null!=o.data||!s||"create"!==e&&"update"!==e&&"patch"!==e||(r.contentType="application/json",r.data=JSON.stringify(o.attrs||s.toJSON(o))),o.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),o.emulateHTTP&&("PUT"===n||"DELETE"===n||"PATCH"===n)){r.type="POST",o.emulateJSON&&(r.data._method=n);var a=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",n),a)return a.apply(this,arguments)}}"GET"===r.type||o.emulateJSON||(r.processData=!1);var d=o.error;o.error=function(e,t,i){o.textStatus=t,o.errorThrown=i,d&&d.call(o.context,e,t,i)};var l=o.xhr=t.ajax(i.extend(r,o));return s.trigger("request",s,l,o),l};var F={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var L=t.Router=function(e){e||(e={}),this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},B=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,U=/\*\w+/g,z=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(L.prototype,a,{preinitialize:function(){},initialize:function(){},route:function(e,s,o){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(s)&&(o=s,s=""),o||(o=this[s]);var n=this;return t.history.route(e,(function(i){var r=n._extractParameters(e,i);!1!==n.execute(o,r,s)&&(n.trigger.apply(n,["route:"+s].concat(r)),n.trigger("route",s,r),t.history.trigger("route",n,s,r))})),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(z,"\\$&").replace(B,"(?:$1)?").replace(k,(function(e,t){return t?e:"([^/?]+)"})).replace(U,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var s=e.exec(t).slice(1);return i.map(s,(function(e,t){return t===s.length-1?e||null:e?decodeURIComponent(e):null}))}});var H=t.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},W=/^[#\/]|\s+$/g,j=/^\/+|\/+$/g,$=/#.*$/;H.started=!1,i.extend(H.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(W,"")},start:function(e){if(H.started)throw new Error("Backbone.history has already been started");if(H.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._trailingSlash=this.options.trailingSlash,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(j,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var s=document.body,o=s.insertBefore(this.iframe,s.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var n=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?n("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?n("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),H.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),i.some(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!H.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;this._trailingSlash||""!==e&&"?"!==e.charAt(0)||(i=i.slice(0,-1)||"/");var s=i+e;e=e.replace($,"");var o=this.decodeFragment(e);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,s);else{if(!this._wantsHashChange)return this.location.assign(s);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var n=this.iframe.contentWindow;t.replace||(n.document.open(),n.document.close()),this._updateHash(n.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var s=e.href.replace(/(javascript:|#).*$/,"");e.replace(s+"#"+t)}else e.hash="#"+t}}),t.history=new H;var Z=function(e,t){var s,o=this;return s=e&&i.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},i.extend(s,o,t),s.prototype=i.create(o.prototype,e),s.prototype.constructor=s,s.__super__=o.prototype,s};f.extend=b.extend=L.extend=E.extend=H.extend=Z;var G=function(){throw new Error('A "url" property or function must be specified')},q=function(e,t){var i=t.error;t.error=function(s){i&&i.call(t.context,e,s,t),e.trigger("error",e,s,t)}};return t}(n,i,e,t)}.apply(t,s),void 0===o||(e.exports=o)},84:(e,t,i)=>{var s,o;o=window,void 0===(s=function(){return function(e){var t,i=function(){var t,i,s,o,n,r,a=[],d=a.concat,l=a.filter,h=a.slice,c=e.document,u={},g={},m={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},p=/^\s*<(\w+|!)[^>]*>/,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,f=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,b=/^(?:body|html)$/i,_=/([A-Z])/g,S=["val","css","html","text","data","width","height","offset"],y=["after","prepend","before","append"],A=c.createElement("table"),T=c.createElement("tr"),w={tr:c.createElement("tbody"),tbody:A,thead:A,tfoot:A,td:T,th:T,"*":c.createElement("div")},C=/^[\w-]*$/,P={},E=P.toString,I={},O=c.createElement("div"),V={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},N=Array.isArray||function(e){return e instanceof Array};function D(e){return null==e?String(e):P[E.call(e)]||"object"}function R(e){return"function"==D(e)}function M(e){return null!=e&&e==e.window}function x(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function F(e){return"object"==D(e)}function L(e){return F(e)&&!M(e)&&Object.getPrototypeOf(e)==Object.prototype}function B(e){var t=!!e&&"length"in e&&e.length,i=s.type(e);return"function"!=i&&!M(e)&&("array"==i||0===t||"number"==typeof t&&t>0&&t-1 in e)}function k(e){return l.call(e,(function(e){return null!=e}))}function U(e){return e.length>0?s.fn.concat.apply([],e):e}function z(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function H(e){return e in g?g[e]:g[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function W(e,t){return"number"!=typeof t||m[z(e)]?t:t+"px"}function j(e){var t,i;return u[e]||(t=c.createElement(e),c.body.appendChild(t),i=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==i&&(i="block"),u[e]=i),u[e]}function $(e){return"children"in e?h.call(e.children):s.map(e.childNodes,(function(e){if(1==e.nodeType)return e}))}function Z(e,t){var i,s=e?e.length:0;for(i=0;i<s;i++)this[i]=e[i];this.length=s,this.selector=t||""}function G(e,s,o){for(i in s)o&&(L(s[i])||N(s[i]))?(L(s[i])&&!L(e[i])&&(e[i]={}),N(s[i])&&!N(e[i])&&(e[i]=[]),G(e[i],s[i],o)):s[i]!==t&&(e[i]=s[i])}function q(e,t){return null==t?s(e):s(e).filter(t)}function Y(e,t,i,s){return R(t)?t.call(e,i,s):t}function K(e,t,i){null==i?e.removeAttribute(t):e.setAttribute(t,i)}function Q(e,i){var s=e.className||"",o=s&&s.baseVal!==t;if(i===t)return o?s.baseVal:s;o?s.baseVal=i:e.className=i}function X(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?s.parseJSON(e):e):e}catch(t){return e}}function J(e,t){t(e);for(var i=0,s=e.childNodes.length;i<s;i++)J(e.childNodes[i],t)}return I.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var i=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(i)return i.call(e,t);var s,o=e.parentNode,n=!o;return n&&(o=O).appendChild(e),s=~I.qsa(o,t).indexOf(e),n&&O.removeChild(e),s},n=function(e){return e.replace(/-+(.)?/g,(function(e,t){return t?t.toUpperCase():""}))},r=function(e){return l.call(e,(function(t,i){return e.indexOf(t)==i}))},I.fragment=function(e,i,o){var n,r,a;return v.test(e)&&(n=s(c.createElement(RegExp.$1))),n||(e.replace&&(e=e.replace(f,"<$1></$2>")),i===t&&(i=p.test(e)&&RegExp.$1),i in w||(i="*"),(a=w[i]).innerHTML=""+e,n=s.each(h.call(a.childNodes),(function(){a.removeChild(this)}))),L(o)&&(r=s(n),s.each(o,(function(e,t){S.indexOf(e)>-1?r[e](t):r.attr(e,t)}))),n},I.Z=function(e,t){return new Z(e,t)},I.isZ=function(e){return e instanceof I.Z},I.init=function(e,i){var o;if(!e)return I.Z();if("string"==typeof e)if("<"==(e=e.trim())[0]&&p.test(e))o=I.fragment(e,RegExp.$1,i),e=null;else{if(i!==t)return s(i).find(e);o=I.qsa(c,e)}else{if(R(e))return s(c).ready(e);if(I.isZ(e))return e;if(N(e))o=k(e);else if(F(e))o=[e],e=null;else if(p.test(e))o=I.fragment(e.trim(),RegExp.$1,i),e=null;else{if(i!==t)return s(i).find(e);o=I.qsa(c,e)}}return I.Z(o,e)},(s=function(e,t){return I.init(e,t)}).extend=function(e){var t,i=h.call(arguments,1);return"boolean"==typeof e&&(t=e,e=i.shift()),i.forEach((function(i){G(e,i,t)})),e},I.qsa=function(e,t){var i,s="#"==t[0],o=!s&&"."==t[0],n=s||o?t.slice(1):t,r=C.test(n);return e.getElementById&&r&&s?(i=e.getElementById(n))?[i]:[]:1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType?[]:h.call(r&&!s&&e.getElementsByClassName?o?e.getElementsByClassName(n):e.getElementsByTagName(t):e.querySelectorAll(t))},s.contains=c.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},s.type=D,s.isFunction=R,s.isWindow=M,s.isArray=N,s.isPlainObject=L,s.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},s.isNumeric=function(e){var t=Number(e),i=typeof e;return null!=e&&"boolean"!=i&&("string"!=i||e.length)&&!isNaN(t)&&isFinite(t)||!1},s.inArray=function(e,t,i){return a.indexOf.call(t,e,i)},s.camelCase=n,s.trim=function(e){return null==e?"":String.prototype.trim.call(e)},s.uuid=0,s.support={},s.expr={},s.noop=function(){},s.map=function(e,t){var i,s,o,n=[];if(B(e))for(s=0;s<e.length;s++)null!=(i=t(e[s],s))&&n.push(i);else for(o in e)null!=(i=t(e[o],o))&&n.push(i);return U(n)},s.each=function(e,t){var i,s;if(B(e)){for(i=0;i<e.length;i++)if(!1===t.call(e[i],i,e[i]))return e}else for(s in e)if(!1===t.call(e[s],s,e[s]))return e;return e},s.grep=function(e,t){return l.call(e,t)},e.JSON&&(s.parseJSON=JSON.parse),s.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),(function(e,t){P["[object "+t+"]"]=t.toLowerCase()})),s.fn={constructor:I.Z,length:0,forEach:a.forEach,reduce:a.reduce,push:a.push,sort:a.sort,splice:a.splice,indexOf:a.indexOf,concat:function(){var e,t,i=[];for(e=0;e<arguments.length;e++)t=arguments[e],i[e]=I.isZ(t)?t.toArray():t;return d.apply(I.isZ(this)?this.toArray():this,i)},map:function(e){return s(s.map(this,(function(t,i){return e.call(t,i,t)})))},slice:function(){return s(h.apply(this,arguments))},ready:function(t){if("complete"===c.readyState||"loading"!==c.readyState&&!c.documentElement.doScroll)setTimeout((function(){t(s)}),0);else{var i=function(){c.removeEventListener("DOMContentLoaded",i,!1),e.removeEventListener("load",i,!1),t(s)};c.addEventListener("DOMContentLoaded",i,!1),e.addEventListener("load",i,!1)}return this},get:function(e){return e===t?h.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each((function(){null!=this.parentNode&&this.parentNode.removeChild(this)}))},each:function(e){return a.every.call(this,(function(t,i){return!1!==e.call(t,i,t)})),this},filter:function(e){return R(e)?this.not(this.not(e)):s(l.call(this,(function(t){return I.matches(t,e)})))},add:function(e,t){return s(r(this.concat(s(e,t))))},is:function(e){return"string"==typeof e?this.length>0&&I.matches(this[0],e):e&&this.selector==e.selector},not:function(e){var i=[];if(R(e)&&e.call!==t)this.each((function(t){e.call(this,t)||i.push(this)}));else{var o="string"==typeof e?this.filter(e):B(e)&&R(e.item)?h.call(e):s(e);this.forEach((function(e){o.indexOf(e)<0&&i.push(e)}))}return s(i)},has:function(e){return this.filter((function(){return F(e)?s.contains(this,e):s(this).find(e).size()}))},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!F(e)?e:s(e)},last:function(){var e=this[this.length-1];return e&&!F(e)?e:s(e)},find:function(e){var t=this;return e?"object"==typeof e?s(e).filter((function(){var e=this;return a.some.call(t,(function(t){return s.contains(t,e)}))})):1==this.length?s(I.qsa(this[0],e)):this.map((function(){return I.qsa(this,e)})):s()},closest:function(e,t){var i=[],o="object"==typeof e&&s(e);return this.each((function(s,n){for(;n&&!(o?o.indexOf(n)>=0:I.matches(n,e));)n=n!==t&&!x(n)&&n.parentNode;n&&i.indexOf(n)<0&&i.push(n)})),s(i)},parents:function(e){for(var t=[],i=this;i.length>0;)i=s.map(i,(function(e){if((e=e.parentNode)&&!x(e)&&t.indexOf(e)<0)return t.push(e),e}));return q(t,e)},parent:function(e){return q(r(this.pluck("parentNode")),e)},children:function(e){return q(this.map((function(){return $(this)})),e)},contents:function(){return this.map((function(){return this.contentDocument||h.call(this.childNodes)}))},siblings:function(e){return q(this.map((function(e,t){return l.call($(t.parentNode),(function(e){return e!==t}))})),e)},empty:function(){return this.each((function(){this.innerHTML=""}))},pluck:function(e){return s.map(this,(function(t){return t[e]}))},show:function(){return this.each((function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=j(this.nodeName))}))},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var t=R(e);if(this[0]&&!t)var i=s(e).get(0),o=i.parentNode||this.length>1;return this.each((function(n){s(this).wrapAll(t?e.call(this,n):o?i.cloneNode(!0):i)}))},wrapAll:function(e){if(this[0]){var t;for(s(this[0]).before(e=s(e));(t=e.children()).length;)e=t.first();s(e).append(this)}return this},wrapInner:function(e){var t=R(e);return this.each((function(i){var o=s(this),n=o.contents(),r=t?e.call(this,i):e;n.length?n.wrapAll(r):o.append(r)}))},unwrap:function(){return this.parent().each((function(){s(this).replaceWith(s(this).children())})),this},clone:function(){return this.map((function(){return this.cloneNode(!0)}))},hide:function(){return this.css("display","none")},toggle:function(e){return this.each((function(){var i=s(this);(e===t?"none"==i.css("display"):e)?i.show():i.hide()}))},prev:function(e){return s(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return s(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each((function(t){var i=this.innerHTML;s(this).empty().append(Y(this,e,t,i))})):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each((function(t){var i=Y(this,e,t,this.textContent);this.textContent=null==i?"":""+i})):0 in this?this.pluck("textContent").join(""):null},attr:function(e,s){var o;return"string"!=typeof e||1 in arguments?this.each((function(t){if(1===this.nodeType)if(F(e))for(i in e)K(this,i,e[i]);else K(this,e,Y(this,s,t,this.getAttribute(e)))})):0 in this&&1==this[0].nodeType&&null!=(o=this[0].getAttribute(e))?o:t},removeAttr:function(e){return this.each((function(){1===this.nodeType&&e.split(" ").forEach((function(e){K(this,e)}),this)}))},prop:function(e,t){return"string"!=typeof(e=V[e]||e)||1 in arguments?this.each((function(s){if(F(e))for(i in e)this[V[i]||i]=e[i];else this[e]=Y(this,t,s,this[e])})):this[0]&&this[0][e]},removeProp:function(e){return e=V[e]||e,this.each((function(){delete this[e]}))},data:function(e,i){var s="data-"+e.replace(_,"-$1").toLowerCase(),o=1 in arguments?this.attr(s,i):this.attr(s);return null!==o?X(o):t},val:function(e){return 0 in arguments?(null==e&&(e=""),this.each((function(t){this.value=Y(this,e,t,this.value)}))):this[0]&&(this[0].multiple?s(this[0]).find("option").filter((function(){return this.selected})).pluck("value"):this[0].value)},offset:function(t){if(t)return this.each((function(e){var i=s(this),o=Y(this,t,e,i.offset()),n=i.offsetParent().offset(),r={top:o.top-n.top,left:o.left-n.left};"static"==i.css("position")&&(r.position="relative"),i.css(r)}));if(!this.length)return null;if(c.documentElement!==this[0]&&!s.contains(c.documentElement,this[0]))return{top:0,left:0};var i=this[0].getBoundingClientRect();return{left:i.left+e.pageXOffset,top:i.top+e.pageYOffset,width:Math.round(i.width),height:Math.round(i.height)}},css:function(e,t){if(arguments.length<2){var o=this[0];if("string"==typeof e){if(!o)return;return o.style[n(e)]||getComputedStyle(o,"").getPropertyValue(e)}if(N(e)){if(!o)return;var r={},a=getComputedStyle(o,"");return s.each(e,(function(e,t){r[t]=o.style[n(t)]||a.getPropertyValue(t)})),r}}var d="";if("string"==D(e))t||0===t?d=z(e)+":"+W(e,t):this.each((function(){this.style.removeProperty(z(e))}));else for(i in e)e[i]||0===e[i]?d+=z(i)+":"+W(i,e[i])+";":this.each((function(){this.style.removeProperty(z(i))}));return this.each((function(){this.style.cssText+=";"+d}))},index:function(e){return e?this.indexOf(s(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return!!e&&a.some.call(this,(function(e){return this.test(Q(e))}),H(e))},addClass:function(e){return e?this.each((function(t){if("className"in this){o=[];var i=Q(this);Y(this,e,t,i).split(/\s+/g).forEach((function(e){s(this).hasClass(e)||o.push(e)}),this),o.length&&Q(this,i+(i?" ":"")+o.join(" "))}})):this},removeClass:function(e){return this.each((function(i){if("className"in this){if(e===t)return Q(this,"");o=Q(this),Y(this,e,i,o).split(/\s+/g).forEach((function(e){o=o.replace(H(e)," ")})),Q(this,o.trim())}}))},toggleClass:function(e,i){return e?this.each((function(o){var n=s(this);Y(this,e,o,Q(this)).split(/\s+/g).forEach((function(e){(i===t?!n.hasClass(e):i)?n.addClass(e):n.removeClass(e)}))})):this},scrollTop:function(e){if(this.length){var i="scrollTop"in this[0];return e===t?i?this[0].scrollTop:this[0].pageYOffset:this.each(i?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var i="scrollLeft"in this[0];return e===t?i?this[0].scrollLeft:this[0].pageXOffset:this.each(i?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),i=this.offset(),o=b.test(t[0].nodeName)?{top:0,left:0}:t.offset();return i.top-=parseFloat(s(e).css("margin-top"))||0,i.left-=parseFloat(s(e).css("margin-left"))||0,o.top+=parseFloat(s(t[0]).css("border-top-width"))||0,o.left+=parseFloat(s(t[0]).css("border-left-width"))||0,{top:i.top-o.top,left:i.left-o.left}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent||c.body;e&&!b.test(e.nodeName)&&"static"==s(e).css("position");)e=e.offsetParent;return e}))}},s.fn.detach=s.fn.remove,["width","height"].forEach((function(e){var i=e.replace(/./,(function(e){return e[0].toUpperCase()}));s.fn[e]=function(o){var n,r=this[0];return o===t?M(r)?r["inner"+i]:x(r)?r.documentElement["scroll"+i]:(n=this.offset())&&n[e]:this.each((function(t){(r=s(this)).css(e,Y(this,o,t,r[e]()))}))}})),y.forEach((function(i,o){var n=o%2;s.fn[i]=function(){var i,r,a=s.map(arguments,(function(e){var o=[];return"array"==(i=D(e))?(e.forEach((function(e){return e.nodeType!==t?o.push(e):s.zepto.isZ(e)?o=o.concat(e.get()):void(o=o.concat(I.fragment(e)))})),o):"object"==i||null==e?e:I.fragment(e)})),d=this.length>1;return a.length<1?this:this.each((function(t,i){r=n?i:i.parentNode,i=0==o?i.nextSibling:1==o?i.firstChild:2==o?i:null;var l=s.contains(c.documentElement,r);a.forEach((function(t){if(d)t=t.cloneNode(!0);else if(!r)return s(t).remove();r.insertBefore(t,i),l&&J(t,(function(t){if(!(null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src)){var i=t.ownerDocument?t.ownerDocument.defaultView:e;i.eval.call(i,t.innerHTML)}}))}))}))},s.fn[n?i+"To":"insert"+(o?"Before":"After")]=function(e){return s(e)[i](this),this}})),I.Z.prototype=Z.prototype=s.fn,I.uniq=r,I.deserializeValue=X,s.zepto=I,s}();return e.Zepto=i,void 0===e.$&&(e.$=i),function(t){var i,s=1,o=Array.prototype.slice,n=t.isFunction,r=function(e){return"string"==typeof e},a={},d={},l="onfocusin"in e,h={focus:"focusin",blur:"focusout"},c={mouseenter:"mouseover",mouseleave:"mouseout"};function u(e){return e._zid||(e._zid=s++)}function g(e,t,i,s){if((t=m(t)).ns)var o=p(t.ns);return(a[u(e)]||[]).filter((function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||o.test(e.ns))&&(!i||u(e.fn)===u(i))&&(!s||e.sel==s)}))}function m(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function p(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function v(e,t){return e.del&&!l&&e.e in h||!!t}function f(e){return c[e]||l&&h[e]||e}function b(e,s,o,n,r,d,l){var h=u(e),g=a[h]||(a[h]=[]);s.split(/\s/).forEach((function(s){if("ready"==s)return t(document).ready(o);var a=m(s);a.fn=o,a.sel=r,a.e in c&&(o=function(e){var i=e.relatedTarget;if(!i||i!==this&&!t.contains(this,i))return a.fn.apply(this,arguments)}),a.del=d;var h=d||o;a.proxy=function(t){if(!(t=w(t)).isImmediatePropagationStopped()){t.data=n;var s=h.apply(e,t._args==i?[t]:[t].concat(t._args));return!1===s&&(t.preventDefault(),t.stopPropagation()),s}},a.i=g.length,g.push(a),"addEventListener"in e&&e.addEventListener(f(a.e),a.proxy,v(a,l))}))}function _(e,t,i,s,o){var n=u(e);(t||"").split(/\s/).forEach((function(t){g(e,t,i,s).forEach((function(t){delete a[n][t.i],"removeEventListener"in e&&e.removeEventListener(f(t.e),t.proxy,v(t,o))}))}))}d.click=d.mousedown=d.mouseup=d.mousemove="MouseEvents",t.event={add:b,remove:_},t.proxy=function(e,i){var s=2 in arguments&&o.call(arguments,2);if(n(e)){var a=function(){return e.apply(i,s?s.concat(o.call(arguments)):arguments)};return a._zid=u(e),a}if(r(i))return s?(s.unshift(e[i],e),t.proxy.apply(null,s)):t.proxy(e[i],e);throw new TypeError("expected function")},t.fn.bind=function(e,t,i){return this.on(e,t,i)},t.fn.unbind=function(e,t){return this.off(e,t)},t.fn.one=function(e,t,i,s){return this.on(e,t,i,s,1)};var S=function(){return!0},y=function(){return!1},A=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,T={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function w(e,s){if(s||!e.isDefaultPrevented){s||(s=e),t.each(T,(function(t,i){var o=s[t];e[t]=function(){return this[i]=S,o&&o.apply(s,arguments)},e[i]=y}));try{e.timeStamp||(e.timeStamp=Date.now())}catch(e){}(s.defaultPrevented!==i?s.defaultPrevented:"returnValue"in s?!1===s.returnValue:s.getPreventDefault&&s.getPreventDefault())&&(e.isDefaultPrevented=S)}return e}function C(e){var t,s={originalEvent:e};for(t in e)A.test(t)||e[t]===i||(s[t]=e[t]);return w(s,e)}t.fn.delegate=function(e,t,i){return this.on(t,e,i)},t.fn.undelegate=function(e,t,i){return this.off(t,e,i)},t.fn.live=function(e,i){return t(document.body).delegate(this.selector,e,i),this},t.fn.die=function(e,i){return t(document.body).undelegate(this.selector,e,i),this},t.fn.on=function(e,s,a,d,l){var h,c,u=this;return e&&!r(e)?(t.each(e,(function(e,t){u.on(e,s,a,t,l)})),u):(r(s)||n(d)||!1===d||(d=a,a=s,s=i),d!==i&&!1!==a||(d=a,a=i),!1===d&&(d=y),u.each((function(i,n){l&&(h=function(e){return _(n,e.type,d),d.apply(this,arguments)}),s&&(c=function(e){var i,r=t(e.target).closest(s,n).get(0);if(r&&r!==n)return i=t.extend(C(e),{currentTarget:r,liveFired:n}),(h||d).apply(r,[i].concat(o.call(arguments,1)))}),b(n,e,d,a,s,c||h)})))},t.fn.off=function(e,s,o){var a=this;return e&&!r(e)?(t.each(e,(function(e,t){a.off(e,s,t)})),a):(r(s)||n(o)||!1===o||(o=s,s=i),!1===o&&(o=y),a.each((function(){_(this,e,o,s)})))},t.fn.trigger=function(e,i){return(e=r(e)||t.isPlainObject(e)?t.Event(e):w(e))._args=i,this.each((function(){e.type in h&&"function"==typeof this[e.type]?this[e.type]():"dispatchEvent"in this?this.dispatchEvent(e):t(this).triggerHandler(e,i)}))},t.fn.triggerHandler=function(e,i){var s,o;return this.each((function(n,a){(s=C(r(e)?t.Event(e):e))._args=i,s.target=a,t.each(g(a,e.type||e),(function(e,t){if(o=t.proxy(s),s.isImmediatePropagationStopped())return!1}))})),o},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach((function(e){t.fn[e]=function(t){return 0 in arguments?this.bind(e,t):this.trigger(e)}})),t.Event=function(e,t){r(e)||(e=(t=e).type);var i=document.createEvent(d[e]||"Events"),s=!0;if(t)for(var o in t)"bubbles"==o?s=!!t[o]:i[o]=t[o];return i.initEvent(e,s,!0),w(i)}}(i),function(t){var i,s,o=+new Date,n=e.document,r=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,a=/^(?:text|application)\/javascript/i,d=/^(?:text|application)\/xml/i,l="application/json",h="text/html",c=/^\s*$/,u=n.createElement("a");function g(e,i,s){var o=t.Event(i);return t(e).trigger(o,s),!o.isDefaultPrevented()}function m(e,t,i,s){if(e.global)return g(t||n,i,s)}function p(e){e.global&&0==t.active++&&m(e,null,"ajaxStart")}function v(e){e.global&&! --t.active&&m(e,null,"ajaxStop")}function f(e,t){var i=t.context;if(!1===t.beforeSend.call(i,e,t)||!1===m(t,i,"ajaxBeforeSend",[e,t]))return!1;m(t,i,"ajaxSend",[e,t])}function b(e,t,i,s){var o=i.context,n="success";i.success.call(o,e,n,t),s&&s.resolveWith(o,[e,n,t]),m(i,o,"ajaxSuccess",[t,i,e]),S(n,t,i)}function _(e,t,i,s,o){var n=s.context;s.error.call(n,i,t,e),o&&o.rejectWith(n,[i,t,e]),m(s,n,"ajaxError",[i,s,e||t]),S(t,i,s)}function S(e,t,i){var s=i.context;i.complete.call(s,t,e),m(i,s,"ajaxComplete",[t,i]),v(i)}function y(e,t,i){if(i.dataFilter==A)return e;var s=i.context;return i.dataFilter.call(s,e,t)}function A(){}function T(e){return e&&(e=e.split(";",2)[0]),e&&(e==h?"html":e==l?"json":a.test(e)?"script":d.test(e)&&"xml")||"text"}function w(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function C(e){e.processData&&e.data&&"string"!=t.type(e.data)&&(e.data=t.param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()&&"jsonp"!=e.dataType||(e.url=w(e.url,e.data),e.data=void 0)}function P(e,i,s,o){return t.isFunction(i)&&(o=s,s=i,i=void 0),t.isFunction(s)||(o=s,s=void 0),{url:e,data:i,success:s,dataType:o}}u.href=e.location.href,t.active=0,t.ajaxJSONP=function(i,s){if(!("type"in i))return t.ajax(i);var r,a,d=i.jsonpCallback,l=(t.isFunction(d)?d():d)||"Zepto"+o++,h=n.createElement("script"),c=e[l],u=function(e){t(h).triggerHandler("error",e||"abort")},g={abort:u};return s&&s.promise(g),t(h).on("load error",(function(o,n){clearTimeout(a),t(h).off().remove(),"error"!=o.type&&r?b(r[0],g,i,s):_(null,n||"error",g,i,s),e[l]=c,r&&t.isFunction(c)&&c(r[0]),c=r=void 0})),!1===f(g,i)?(u("abort"),g):(e[l]=function(){r=arguments},h.src=i.url.replace(/\?(.+)=\?/,"?$1="+l),n.head.appendChild(h),i.timeout>0&&(a=setTimeout((function(){u("timeout")}),i.timeout)),g)},t.ajaxSettings={type:"GET",beforeSend:A,success:A,error:A,complete:A,context:null,global:!0,xhr:function(){return new e.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:l,xml:"application/xml, text/xml",html:h,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,dataFilter:A},t.ajax=function(o){var r,a,d=t.extend({},o||{}),l=t.Deferred&&t.Deferred();for(i in t.ajaxSettings)void 0===d[i]&&(d[i]=t.ajaxSettings[i]);p(d),d.crossDomain||((r=n.createElement("a")).href=d.url,r.href=r.href,d.crossDomain=u.protocol+"//"+u.host!=r.protocol+"//"+r.host),d.url||(d.url=e.location.toString()),(a=d.url.indexOf("#"))>-1&&(d.url=d.url.slice(0,a)),C(d);var h=d.dataType,g=/\?.+=\?/.test(d.url);if(g&&(h="jsonp"),!1!==d.cache&&(o&&!0===o.cache||"script"!=h&&"jsonp"!=h)||(d.url=w(d.url,"_="+Date.now())),"jsonp"==h)return g||(d.url=w(d.url,d.jsonp?d.jsonp+"=?":!1===d.jsonp?"":"callback=?")),t.ajaxJSONP(d,l);var m,v=d.accepts[h],S={},P=function(e,t){S[e.toLowerCase()]=[e,t]},E=/^([\w-]+:)\/\//.test(d.url)?RegExp.$1:e.location.protocol,I=d.xhr(),O=I.setRequestHeader;if(l&&l.promise(I),d.crossDomain||P("X-Requested-With","XMLHttpRequest"),P("Accept",v||"*/*"),(v=d.mimeType||v)&&(v.indexOf(",")>-1&&(v=v.split(",",2)[0]),I.overrideMimeType&&I.overrideMimeType(v)),(d.contentType||!1!==d.contentType&&d.data&&"GET"!=d.type.toUpperCase())&&P("Content-Type",d.contentType||"application/x-www-form-urlencoded"),d.headers)for(s in d.headers)P(s,d.headers[s]);if(I.setRequestHeader=P,I.onreadystatechange=function(){if(4==I.readyState){I.onreadystatechange=A,clearTimeout(m);var e,i=!1;if(I.status>=200&&I.status<300||304==I.status||0==I.status&&"file:"==E){if(h=h||T(d.mimeType||I.getResponseHeader("content-type")),"arraybuffer"==I.responseType||"blob"==I.responseType)e=I.response;else{e=I.responseText;try{e=y(e,h,d),"script"==h?(0,eval)(e):"xml"==h?e=I.responseXML:"json"==h&&(e=c.test(e)?null:t.parseJSON(e))}catch(e){i=e}if(i)return _(i,"parsererror",I,d,l)}b(e,I,d,l)}else _(I.statusText||null,I.status?"error":"abort",I,d,l)}},!1===f(I,d))return I.abort(),_(null,"abort",I,d,l),I;var V=!("async"in d)||d.async;if(I.open(d.type,d.url,V,d.username,d.password),d.xhrFields)for(s in d.xhrFields)I[s]=d.xhrFields[s];for(s in S)O.apply(I,S[s]);return d.timeout>0&&(m=setTimeout((function(){I.onreadystatechange=A,I.abort(),_(null,"timeout",I,d,l)}),d.timeout)),I.send(d.data?d.data:null),I},t.get=function(){return t.ajax(P.apply(null,arguments))},t.post=function(){var e=P.apply(null,arguments);return e.type="POST",t.ajax(e)},t.getJSON=function(){var e=P.apply(null,arguments);return e.dataType="json",t.ajax(e)},t.fn.load=function(e,i,s){if(!this.length)return this;var o,n=this,a=e.split(/\s/),d=P(e,i,s),l=d.success;return a.length>1&&(d.url=a[0],o=a[1]),d.success=function(e){n.html(o?t("<div>").html(e.replace(r,"")).find(o):e),l&&l.apply(n,arguments)},t.ajax(d),this};var E=encodeURIComponent;function I(e,i,s,o){var n,r=t.isArray(i),a=t.isPlainObject(i);t.each(i,(function(i,d){n=t.type(d),o&&(i=s?o:o+"["+(a||"object"==n||"array"==n?i:"")+"]"),!o&&r?e.add(d.name,d.value):"array"==n||!s&&"object"==n?I(e,d,s,i):e.add(i,d)}))}t.param=function(e,i){var s=[];return s.add=function(e,i){t.isFunction(i)&&(i=i()),null==i&&(i=""),this.push(E(e)+"="+E(i))},I(s,e,i),s.join("&").replace(/%20/g,"+")}}(i),(t=i).fn.serializeArray=function(){var e,i,s=[],o=function(t){if(t.forEach)return t.forEach(o);s.push({name:e,value:t})};return this[0]&&t.each(this[0].elements,(function(s,n){i=n.type,(e=n.name)&&"fieldset"!=n.nodeName.toLowerCase()&&!n.disabled&&"submit"!=i&&"reset"!=i&&"button"!=i&&"file"!=i&&("radio"!=i&&"checkbox"!=i||n.checked)&&o(t(n).val())})),s},t.fn.serialize=function(){var e=[];return this.serializeArray().forEach((function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))})),e.join("&")},t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var i=t.Event("submit");this.eq(0).trigger(i),i.isDefaultPrevented()||this.get(0).submit()}return this},function(){try{getComputedStyle(void 0)}catch(i){var t=getComputedStyle;e.getComputedStyle=function(e,i){try{return t(e,i)}catch(e){return null}}}}(),i}(o)}.call(t,i,t,e))||(e.exports=s)},999:function(e,t,i){e.exports=function(){var e="1.13.6",t="object"==typeof self&&self.self===self&&self||"object"==typeof i.g&&i.g.global===i.g&&i.g||Function("return this")()||{},s=Array.prototype,o=Object.prototype,n="undefined"!=typeof Symbol?Symbol.prototype:null,r=s.push,a=s.slice,d=o.toString,l=o.hasOwnProperty,h="undefined"!=typeof ArrayBuffer,c="undefined"!=typeof DataView,u=Array.isArray,g=Object.keys,m=Object.create,p=h&&ArrayBuffer.isView,v=isNaN,f=isFinite,b=!{toString:null}.propertyIsEnumerable("toString"),_=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],S=Math.pow(2,53)-1;function y(e,t){return t=null==t?e.length-1:+t,function(){for(var i=Math.max(arguments.length-t,0),s=Array(i),o=0;o<i;o++)s[o]=arguments[o+t];switch(t){case 0:return e.call(this,s);case 1:return e.call(this,arguments[0],s);case 2:return e.call(this,arguments[0],arguments[1],s)}var n=Array(t+1);for(o=0;o<t;o++)n[o]=arguments[o];return n[t]=s,e.apply(this,n)}}function A(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function T(e){return null===e}function w(e){return void 0===e}function C(e){return!0===e||!1===e||"[object Boolean]"===d.call(e)}function P(e){return!(!e||1!==e.nodeType)}function E(e){var t="[object "+e+"]";return function(e){return d.call(e)===t}}var I=E("String"),O=E("Number"),V=E("Date"),N=E("RegExp"),D=E("Error"),R=E("Symbol"),M=E("ArrayBuffer"),x=E("Function"),F=t.document&&t.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof F&&(x=function(e){return"function"==typeof e||!1});var L=x,B=E("Object"),k=c&&B(new DataView(new ArrayBuffer(8))),U="undefined"!=typeof Map&&B(new Map),z=E("DataView");function H(e){return null!=e&&L(e.getInt8)&&M(e.buffer)}var W=k?H:z,j=u||E("Array");function $(e,t){return null!=e&&l.call(e,t)}var Z=E("Arguments");!function(){Z(arguments)||(Z=function(e){return $(e,"callee")})}();var G=Z;function q(e){return!R(e)&&f(e)&&!isNaN(parseFloat(e))}function Y(e){return O(e)&&v(e)}function K(e){return function(){return e}}function Q(e){return function(t){var i=e(t);return"number"==typeof i&&i>=0&&i<=S}}function X(e){return function(t){return null==t?void 0:t[e]}}var J=X("byteLength"),ee=Q(J),te=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function ie(e){return p?p(e)&&!W(e):ee(e)&&te.test(d.call(e))}var se=h?ie:K(!1),oe=X("length");function ne(e){for(var t={},i=e.length,s=0;s<i;++s)t[e[s]]=!0;return{contains:function(e){return!0===t[e]},push:function(i){return t[i]=!0,e.push(i)}}}function re(e,t){t=ne(t);var i=_.length,s=e.constructor,n=L(s)&&s.prototype||o,r="constructor";for($(e,r)&&!t.contains(r)&&t.push(r);i--;)(r=_[i])in e&&e[r]!==n[r]&&!t.contains(r)&&t.push(r)}function ae(e){if(!A(e))return[];if(g)return g(e);var t=[];for(var i in e)$(e,i)&&t.push(i);return b&&re(e,t),t}function de(e){if(null==e)return!0;var t=oe(e);return"number"==typeof t&&(j(e)||I(e)||G(e))?0===t:0===oe(ae(e))}function le(e,t){var i=ae(t),s=i.length;if(null==e)return!s;for(var o=Object(e),n=0;n<s;n++){var r=i[n];if(t[r]!==o[r]||!(r in o))return!1}return!0}function he(e){return e instanceof he?e:this instanceof he?void(this._wrapped=e):new he(e)}function ce(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,J(e))}he.VERSION=e,he.prototype.value=function(){return this._wrapped},he.prototype.valueOf=he.prototype.toJSON=he.prototype.value,he.prototype.toString=function(){return String(this._wrapped)};var ue="[object DataView]";function ge(e,t,i,s){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&me(e,t,i,s)}function me(e,t,i,s){e instanceof he&&(e=e._wrapped),t instanceof he&&(t=t._wrapped);var o=d.call(e);if(o!==d.call(t))return!1;if(k&&"[object Object]"==o&&W(e)){if(!W(t))return!1;o=ue}switch(o){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return n.valueOf.call(e)===n.valueOf.call(t);case"[object ArrayBuffer]":case ue:return me(ce(e),ce(t),i,s)}var r="[object Array]"===o;if(!r&&se(e)){if(J(e)!==J(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;r=!0}if(!r){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,l=t.constructor;if(a!==l&&!(L(a)&&a instanceof a&&L(l)&&l instanceof l)&&"constructor"in e&&"constructor"in t)return!1}s=s||[];for(var h=(i=i||[]).length;h--;)if(i[h]===e)return s[h]===t;if(i.push(e),s.push(t),r){if((h=e.length)!==t.length)return!1;for(;h--;)if(!ge(e[h],t[h],i,s))return!1}else{var c,u=ae(e);if(h=u.length,ae(t).length!==h)return!1;for(;h--;)if(!$(t,c=u[h])||!ge(e[c],t[c],i,s))return!1}return i.pop(),s.pop(),!0}function pe(e,t){return ge(e,t)}function ve(e){if(!A(e))return[];var t=[];for(var i in e)t.push(i);return b&&re(e,t),t}function fe(e){var t=oe(e);return function(i){if(null==i)return!1;var s=ve(i);if(oe(s))return!1;for(var o=0;o<t;o++)if(!L(i[e[o]]))return!1;return e!==Te||!L(i[be])}}var be="forEach",_e="has",Se=["clear","delete"],ye=["get",_e,"set"],Ae=Se.concat(be,ye),Te=Se.concat(ye),we=["add"].concat(Se,be,_e),Ce=U?fe(Ae):E("Map"),Pe=U?fe(Te):E("WeakMap"),Ee=U?fe(we):E("Set"),Ie=E("WeakSet");function Oe(e){for(var t=ae(e),i=t.length,s=Array(i),o=0;o<i;o++)s[o]=e[t[o]];return s}function Ve(e){for(var t=ae(e),i=t.length,s=Array(i),o=0;o<i;o++)s[o]=[t[o],e[t[o]]];return s}function Ne(e){for(var t={},i=ae(e),s=0,o=i.length;s<o;s++)t[e[i[s]]]=i[s];return t}function De(e){var t=[];for(var i in e)L(e[i])&&t.push(i);return t.sort()}function Re(e,t){return function(i){var s=arguments.length;if(t&&(i=Object(i)),s<2||null==i)return i;for(var o=1;o<s;o++)for(var n=arguments[o],r=e(n),a=r.length,d=0;d<a;d++){var l=r[d];t&&void 0!==i[l]||(i[l]=n[l])}return i}}var Me=Re(ve),xe=Re(ae),Fe=Re(ve,!0);function Le(){return function(){}}function Be(e){if(!A(e))return{};if(m)return m(e);var t=Le();t.prototype=e;var i=new t;return t.prototype=null,i}function ke(e,t){var i=Be(e);return t&&xe(i,t),i}function Ue(e){return A(e)?j(e)?e.slice():Me({},e):e}function ze(e,t){return t(e),e}function He(e){return j(e)?e:[e]}function We(e){return he.toPath(e)}function je(e,t){for(var i=t.length,s=0;s<i;s++){if(null==e)return;e=e[t[s]]}return i?e:void 0}function $e(e,t,i){var s=je(e,We(t));return w(s)?i:s}function Ze(e,t){for(var i=(t=We(t)).length,s=0;s<i;s++){var o=t[s];if(!$(e,o))return!1;e=e[o]}return!!i}function Ge(e){return e}function qe(e){return e=xe({},e),function(t){return le(t,e)}}function Ye(e){return e=We(e),function(t){return je(t,e)}}function Ke(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 3:return function(i,s,o){return e.call(t,i,s,o)};case 4:return function(i,s,o,n){return e.call(t,i,s,o,n)}}return function(){return e.apply(t,arguments)}}function Qe(e,t,i){return null==e?Ge:L(e)?Ke(e,t,i):A(e)&&!j(e)?qe(e):Ye(e)}function Xe(e,t){return Qe(e,t,1/0)}function Je(e,t,i){return he.iteratee!==Xe?he.iteratee(e,t):Qe(e,t,i)}function et(e,t,i){t=Je(t,i);for(var s=ae(e),o=s.length,n={},r=0;r<o;r++){var a=s[r];n[a]=t(e[a],a,e)}return n}function tt(){}function it(e){return null==e?tt:function(t){return $e(e,t)}}function st(e,t,i){var s=Array(Math.max(0,e));t=Ke(t,i,1);for(var o=0;o<e;o++)s[o]=t(o);return s}function ot(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}he.toPath=He,he.iteratee=Xe;var nt=Date.now||function(){return(new Date).getTime()};function rt(e){var t=function(t){return e[t]},i="(?:"+ae(e).join("|")+")",s=RegExp(i),o=RegExp(i,"g");return function(e){return e=null==e?"":""+e,s.test(e)?e.replace(o,t):e}}var at={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},dt=rt(at),lt=rt(Ne(at)),ht=he.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},ct=/(.)^/,ut={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},gt=/\\|'|\r|\n|\u2028|\u2029/g;function mt(e){return"\\"+ut[e]}var pt=/^\s*(\w|\$)+\s*$/;function vt(e,t,i){!t&&i&&(t=i),t=Fe({},t,he.templateSettings);var s=RegExp([(t.escape||ct).source,(t.interpolate||ct).source,(t.evaluate||ct).source].join("|")+"|$","g"),o=0,n="__p+='";e.replace(s,(function(t,i,s,r,a){return n+=e.slice(o,a).replace(gt,mt),o=a+t.length,i?n+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":s?n+="'+\n((__t=("+s+"))==null?'':__t)+\n'":r&&(n+="';\n"+r+"\n__p+='"),t})),n+="';\n";var r,a=t.variable;if(a){if(!pt.test(a))throw new Error("variable is not a bare identifier: "+a)}else n="with(obj||{}){\n"+n+"}\n",a="obj";n="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+n+"return __p;\n";try{r=new Function(a,"_",n)}catch(e){throw e.source=n,e}var d=function(e){return r.call(this,e,he)};return d.source="function("+a+"){\n"+n+"}",d}function ft(e,t,i){var s=(t=We(t)).length;if(!s)return L(i)?i.call(e):i;for(var o=0;o<s;o++){var n=null==e?void 0:e[t[o]];void 0===n&&(n=i,o=s),e=L(n)?n.call(e):n}return e}var bt=0;function _t(e){var t=++bt+"";return e?e+t:t}function St(e){var t=he(e);return t._chain=!0,t}function yt(e,t,i,s,o){if(!(s instanceof t))return e.apply(i,o);var n=Be(e.prototype),r=e.apply(n,o);return A(r)?r:n}var At=y((function(e,t){var i=At.placeholder,s=function(){for(var o=0,n=t.length,r=Array(n),a=0;a<n;a++)r[a]=t[a]===i?arguments[o++]:t[a];for(;o<arguments.length;)r.push(arguments[o++]);return yt(e,s,this,this,r)};return s}));At.placeholder=he;var Tt=y((function(e,t,i){if(!L(e))throw new TypeError("Bind must be called on a function");var s=y((function(o){return yt(e,s,t,this,i.concat(o))}));return s})),wt=Q(oe);function Ct(e,t,i,s){if(s=s||[],t||0===t){if(t<=0)return s.concat(e)}else t=1/0;for(var o=s.length,n=0,r=oe(e);n<r;n++){var a=e[n];if(wt(a)&&(j(a)||G(a)))if(t>1)Ct(a,t-1,i,s),o=s.length;else for(var d=0,l=a.length;d<l;)s[o++]=a[d++];else i||(s[o++]=a)}return s}var Pt=y((function(e,t){var i=(t=Ct(t,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var s=t[i];e[s]=Tt(e[s],e)}return e}));function Et(e,t){var i=function(s){var o=i.cache,n=""+(t?t.apply(this,arguments):s);return $(o,n)||(o[n]=e.apply(this,arguments)),o[n]};return i.cache={},i}var It=y((function(e,t,i){return setTimeout((function(){return e.apply(null,i)}),t)})),Ot=At(It,he,1);function Vt(e,t,i){var s,o,n,r,a=0;i||(i={});var d=function(){a=!1===i.leading?0:nt(),s=null,r=e.apply(o,n),s||(o=n=null)},l=function(){var l=nt();a||!1!==i.leading||(a=l);var h=t-(l-a);return o=this,n=arguments,h<=0||h>t?(s&&(clearTimeout(s),s=null),a=l,r=e.apply(o,n),s||(o=n=null)):s||!1===i.trailing||(s=setTimeout(d,h)),r};return l.cancel=function(){clearTimeout(s),a=0,s=o=n=null},l}function Nt(e,t,i){var s,o,n,r,a,d=function(){var l=nt()-o;t>l?s=setTimeout(d,t-l):(s=null,i||(r=e.apply(a,n)),s||(n=a=null))},l=y((function(l){return a=this,n=l,o=nt(),s||(s=setTimeout(d,t),i&&(r=e.apply(a,n))),r}));return l.cancel=function(){clearTimeout(s),s=n=a=null},l}function Dt(e,t){return At(t,e)}function Rt(e){return function(){return!e.apply(this,arguments)}}function Mt(){var e=arguments,t=e.length-1;return function(){for(var i=t,s=e[t].apply(this,arguments);i--;)s=e[i].call(this,s);return s}}function xt(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function Ft(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}}var Lt=At(Ft,2);function Bt(e,t,i){t=Je(t,i);for(var s,o=ae(e),n=0,r=o.length;n<r;n++)if(t(e[s=o[n]],s,e))return s}function kt(e){return function(t,i,s){i=Je(i,s);for(var o=oe(t),n=e>0?0:o-1;n>=0&&n<o;n+=e)if(i(t[n],n,t))return n;return-1}}var Ut=kt(1),zt=kt(-1);function Ht(e,t,i,s){for(var o=(i=Je(i,s,1))(t),n=0,r=oe(e);n<r;){var a=Math.floor((n+r)/2);i(e[a])<o?n=a+1:r=a}return n}function Wt(e,t,i){return function(s,o,n){var r=0,d=oe(s);if("number"==typeof n)e>0?r=n>=0?n:Math.max(n+d,r):d=n>=0?Math.min(n+1,d):n+d+1;else if(i&&n&&d)return s[n=i(s,o)]===o?n:-1;if(o!=o)return(n=t(a.call(s,r,d),Y))>=0?n+r:-1;for(n=e>0?r:d-1;n>=0&&n<d;n+=e)if(s[n]===o)return n;return-1}}var jt=Wt(1,Ut,Ht),$t=Wt(-1,zt);function Zt(e,t,i){var s=(wt(e)?Ut:Bt)(e,t,i);if(void 0!==s&&-1!==s)return e[s]}function Gt(e,t){return Zt(e,qe(t))}function qt(e,t,i){var s,o;if(t=Ke(t,i),wt(e))for(s=0,o=e.length;s<o;s++)t(e[s],s,e);else{var n=ae(e);for(s=0,o=n.length;s<o;s++)t(e[n[s]],n[s],e)}return e}function Yt(e,t,i){t=Je(t,i);for(var s=!wt(e)&&ae(e),o=(s||e).length,n=Array(o),r=0;r<o;r++){var a=s?s[r]:r;n[r]=t(e[a],a,e)}return n}function Kt(e){var t=function(t,i,s,o){var n=!wt(t)&&ae(t),r=(n||t).length,a=e>0?0:r-1;for(o||(s=t[n?n[a]:a],a+=e);a>=0&&a<r;a+=e){var d=n?n[a]:a;s=i(s,t[d],d,t)}return s};return function(e,i,s,o){var n=arguments.length>=3;return t(e,Ke(i,o,4),s,n)}}var Qt=Kt(1),Xt=Kt(-1);function Jt(e,t,i){var s=[];return t=Je(t,i),qt(e,(function(e,i,o){t(e,i,o)&&s.push(e)})),s}function ei(e,t,i){return Jt(e,Rt(Je(t)),i)}function ti(e,t,i){t=Je(t,i);for(var s=!wt(e)&&ae(e),o=(s||e).length,n=0;n<o;n++){var r=s?s[n]:n;if(!t(e[r],r,e))return!1}return!0}function ii(e,t,i){t=Je(t,i);for(var s=!wt(e)&&ae(e),o=(s||e).length,n=0;n<o;n++){var r=s?s[n]:n;if(t(e[r],r,e))return!0}return!1}function si(e,t,i,s){return wt(e)||(e=Oe(e)),("number"!=typeof i||s)&&(i=0),jt(e,t,i)>=0}var oi=y((function(e,t,i){var s,o;return L(t)?o=t:(t=We(t),s=t.slice(0,-1),t=t[t.length-1]),Yt(e,(function(e){var n=o;if(!n){if(s&&s.length&&(e=je(e,s)),null==e)return;n=e[t]}return null==n?n:n.apply(e,i)}))}));function ni(e,t){return Yt(e,Ye(t))}function ri(e,t){return Jt(e,qe(t))}function ai(e,t,i){var s,o,n=-1/0,r=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,d=(e=wt(e)?e:Oe(e)).length;a<d;a++)null!=(s=e[a])&&s>n&&(n=s);else t=Je(t,i),qt(e,(function(e,i,s){((o=t(e,i,s))>r||o===-1/0&&n===-1/0)&&(n=e,r=o)}));return n}function di(e,t,i){var s,o,n=1/0,r=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,d=(e=wt(e)?e:Oe(e)).length;a<d;a++)null!=(s=e[a])&&s<n&&(n=s);else t=Je(t,i),qt(e,(function(e,i,s){((o=t(e,i,s))<r||o===1/0&&n===1/0)&&(n=e,r=o)}));return n}var li=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function hi(e){return e?j(e)?a.call(e):I(e)?e.match(li):wt(e)?Yt(e,Ge):Oe(e):[]}function ci(e,t,i){if(null==t||i)return wt(e)||(e=Oe(e)),e[ot(e.length-1)];var s=hi(e),o=oe(s);t=Math.max(Math.min(t,o),0);for(var n=o-1,r=0;r<t;r++){var a=ot(r,n),d=s[r];s[r]=s[a],s[a]=d}return s.slice(0,t)}function ui(e){return ci(e,1/0)}function gi(e,t,i){var s=0;return t=Je(t,i),ni(Yt(e,(function(e,i,o){return{value:e,index:s++,criteria:t(e,i,o)}})).sort((function(e,t){var i=e.criteria,s=t.criteria;if(i!==s){if(i>s||void 0===i)return 1;if(i<s||void 0===s)return-1}return e.index-t.index})),"value")}function mi(e,t){return function(i,s,o){var n=t?[[],[]]:{};return s=Je(s,o),qt(i,(function(t,o){var r=s(t,o,i);e(n,t,r)})),n}}var pi=mi((function(e,t,i){$(e,i)?e[i].push(t):e[i]=[t]})),vi=mi((function(e,t,i){e[i]=t})),fi=mi((function(e,t,i){$(e,i)?e[i]++:e[i]=1})),bi=mi((function(e,t,i){e[i?0:1].push(t)}),!0);function _i(e){return null==e?0:wt(e)?e.length:ae(e).length}function Si(e,t,i){return t in i}var yi=y((function(e,t){var i={},s=t[0];if(null==e)return i;L(s)?(t.length>1&&(s=Ke(s,t[1])),t=ve(e)):(s=Si,t=Ct(t,!1,!1),e=Object(e));for(var o=0,n=t.length;o<n;o++){var r=t[o],a=e[r];s(a,r,e)&&(i[r]=a)}return i})),Ai=y((function(e,t){var i,s=t[0];return L(s)?(s=Rt(s),t.length>1&&(i=t[1])):(t=Yt(Ct(t,!1,!1),String),s=function(e,i){return!si(t,i)}),yi(e,s,i)}));function Ti(e,t,i){return a.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))}function wi(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[0]:Ti(e,e.length-t)}function Ci(e,t,i){return a.call(e,null==t||i?1:t)}function Pi(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[e.length-1]:Ci(e,Math.max(0,e.length-t))}function Ei(e){return Jt(e,Boolean)}function Ii(e,t){return Ct(e,t,!1)}var Oi=y((function(e,t){return t=Ct(t,!0,!0),Jt(e,(function(e){return!si(t,e)}))})),Vi=y((function(e,t){return Oi(e,t)}));function Ni(e,t,i,s){C(t)||(s=i,i=t,t=!1),null!=i&&(i=Je(i,s));for(var o=[],n=[],r=0,a=oe(e);r<a;r++){var d=e[r],l=i?i(d,r,e):d;t&&!i?(r&&n===l||o.push(d),n=l):i?si(n,l)||(n.push(l),o.push(d)):si(o,d)||o.push(d)}return o}var Di=y((function(e){return Ni(Ct(e,!0,!0))}));function Ri(e){for(var t=[],i=arguments.length,s=0,o=oe(e);s<o;s++){var n=e[s];if(!si(t,n)){var r;for(r=1;r<i&&si(arguments[r],n);r++);r===i&&t.push(n)}}return t}function Mi(e){for(var t=e&&ai(e,oe).length||0,i=Array(t),s=0;s<t;s++)i[s]=ni(e,s);return i}var xi=y(Mi);function Fi(e,t){for(var i={},s=0,o=oe(e);s<o;s++)t?i[e[s]]=t[s]:i[e[s][0]]=e[s][1];return i}function Li(e,t,i){null==t&&(t=e||0,e=0),i||(i=t<e?-1:1);for(var s=Math.max(Math.ceil((t-e)/i),0),o=Array(s),n=0;n<s;n++,e+=i)o[n]=e;return o}function Bi(e,t){if(null==t||t<1)return[];for(var i=[],s=0,o=e.length;s<o;)i.push(a.call(e,s,s+=t));return i}function ki(e,t){return e._chain?he(t).chain():t}function Ui(e){return qt(De(e),(function(t){var i=he[t]=e[t];he.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),ki(this,i.apply(he,e))}})),he}qt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=s[e];he.prototype[e]=function(){var i=this._wrapped;return null!=i&&(t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0]),ki(this,i)}})),qt(["concat","join","slice"],(function(e){var t=s[e];he.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),ki(this,e)}}));var zi=Ui({__proto__:null,VERSION:e,restArguments:y,isObject:A,isNull:T,isUndefined:w,isBoolean:C,isElement:P,isString:I,isNumber:O,isDate:V,isRegExp:N,isError:D,isSymbol:R,isArrayBuffer:M,isDataView:W,isArray:j,isFunction:L,isArguments:G,isFinite:q,isNaN:Y,isTypedArray:se,isEmpty:de,isMatch:le,isEqual:pe,isMap:Ce,isWeakMap:Pe,isSet:Ee,isWeakSet:Ie,keys:ae,allKeys:ve,values:Oe,pairs:Ve,invert:Ne,functions:De,methods:De,extend:Me,extendOwn:xe,assign:xe,defaults:Fe,create:ke,clone:Ue,tap:ze,get:$e,has:Ze,mapObject:et,identity:Ge,constant:K,noop:tt,toPath:He,property:Ye,propertyOf:it,matcher:qe,matches:qe,times:st,random:ot,now:nt,escape:dt,unescape:lt,templateSettings:ht,template:vt,result:ft,uniqueId:_t,chain:St,iteratee:Xe,partial:At,bind:Tt,bindAll:Pt,memoize:Et,delay:It,defer:Ot,throttle:Vt,debounce:Nt,wrap:Dt,negate:Rt,compose:Mt,after:xt,before:Ft,once:Lt,findKey:Bt,findIndex:Ut,findLastIndex:zt,sortedIndex:Ht,indexOf:jt,lastIndexOf:$t,find:Zt,detect:Zt,findWhere:Gt,each:qt,forEach:qt,map:Yt,collect:Yt,reduce:Qt,foldl:Qt,inject:Qt,reduceRight:Xt,foldr:Xt,filter:Jt,select:Jt,reject:ei,every:ti,all:ti,some:ii,any:ii,contains:si,includes:si,include:si,invoke:oi,pluck:ni,where:ri,max:ai,min:di,shuffle:ui,sample:ci,sortBy:gi,groupBy:pi,indexBy:vi,countBy:fi,partition:bi,toArray:hi,size:_i,pick:yi,omit:Ai,first:wi,head:wi,take:wi,initial:Ti,last:Pi,rest:Ci,tail:Ci,drop:Ci,compact:Ei,flatten:Ii,without:Vi,uniq:Ni,unique:Ni,union:Di,intersection:Ri,difference:Oi,unzip:Mi,transpose:Mi,zip:xi,object:Fi,range:Li,chunk:Bi,mixin:Ui,default:he});return zi._=zi,zi}()},974:(e,t,i)=>{"use strict";i.d(t,{z:()=>s});var s={UNIT_TYPES:{INLINE:0,INTERSTITIAL:1,SLIDER_OUTSTREAM:2,SLIDER_INSTREAM:3,EXPANDABLE:4,"300X600":5,INLINE_FEED:6,COFFEEBREAK:7,SLIDESHOW:8,INLINE_INSTREAM:9,COFFEEBREAK_MOBILE:10,"300X600_MOBILE":11,INLINE_MOBILE:12,INTERSTITIAL_MOBILE:14,SLIDER_OUTSTREAM_MOBILE:15,SLIDER_INSTREAM_MOBILE:16,EXPANDABLE_MOBILE:17,INLINE_INSTREAM_MOBILE:18,INLINE_OUT_OF_VIEW:19,INLINE_OUT_OF_VIEW_MOBILE:20,INLINE_VIEWABILITY_EXPAND:21,INLINE_VIEWABILITY_EXPAND_MOBILE:22,INLINE_INSTREAM_VIEWABILITY_EXPAND:23,INLINE_INSTREAM_VIEWABILITY_EXPAND_MOBILE:24,INLINE_FEED_MOBILE:25,WIDGET_ITEM:26,WIDGET_ITEM_MOBILE:27,NEW_INLINE:28,NEW_INLINE_MOBILE:29,NEW_INLINE_ADJACENT:30,NEW_INLINE_ADJACENT_MOBILE:31,FEED_MANAGER:32,FEED_MANAGER_MOBILE:33,MSN_WIDGET:34,SLIDER_INSTREAM_VFORCE:36,SLIDER_INSTREAM_MOBILE_VFORCE:37},STREAM_TYPES:{IN_STREAM:1,OUT_STREAM:0},UNITS_STREAM_TYPE:{INLINE:0,INTERSTITIAL:0,SLIDER_OUTSTREAM:0,SLIDER_INSTREAM:1,EXPANDABLE:1,"300X600":1,OMNI_TAG:0},APPEND_TYPE:{BEFORE_BEGIN:0,AFTER_BEGIN:1,BEFORE_END:2,AFTER_END:3,APPEND_IN_FIRST:4},INVALID_SELECTOR_TAG_NAMES:{IMG:0,UL:1,BUTTON:3,INPUT:4,LABEL:5},OMNI_TAG_UNIT_NAMES:{rightrail1:1,rightrail2:2,rightrail3:3,inlineTop:4,inlineMiddle:5,inlineBottom:6,interstitial:7,sliderOutstream1:8,sliderOutstream2:9,sliderInstream1:10,sliderInstream2:11,coffeeBreak:12,expandable1:13,expandable2:14,expandable3:15,invalidUnitName:1e3},ROLL_TYPE:{preroll:0,"pre-roll":0,midroll:-1,"mid-roll":-1,postroll:-2,"post-roll":-2},TAB_STATE:{focus:0,blur:1,tabOut:2},DFP_KEYWORDS:["google","dfp","gpt"],MIME_TYPES:{1:"video/mp4",5:"video/webm",7:"video/ogg",10:"video/mp4",11:"video/ogg",12:"video/webm"},SUB_UNIT_TYPE:{PLAIN:0,START_FROM_SLIDER:1,DETACH_TO_SLIDER:2,SUPER_SLIDER:3,INLINE_SINGLE_SELECTOR:4,INLINE_MULTI_SELECTOR:5,STICKY_BELOW:6,STICKY_ABOVE:7,STICKY_BELOW_ABOVE:8,WIDGET:9,MID_ARTICLE_AS_FEED:10},FEED_SELECTOR:"tbl-feed-container",RECO_REEL_SUB_UNIT_TYPE:{PLAIN:0,START_FROM_SLIDER_RBOX:1,DETACH_TO_SLIDER_RBOX:2},AD_CHOICE_TYPE:{TITLE:"title",VIDEO_AD:"videoAd",SLIDER:"slider"},REPLAY_AD_CLICK:{ALL:"all",RESTART_PLAYER:"restartPlayer"},DISPLAY_FILLER:{BEFORE_AD:{NONE:"none",D2D:"d2d",CONTENT:"content",STATIC:"static",none:"none"},BETWEEN_ADS:{LOADING:"loading",D2D:"d2d",CONTENT:"content",STATIC:"static",none:"none"},ON_TIMEOUT:{CLOSE:"close",D2D:"d2d",CONTENT:"content",STATIC:"static",none:"none"}},TITLE_POSITION:{ABOVE:"above",BELOW:"below"},DEBUG_DATA:{pn:"pn",sqg:"sqg",sqv:"sqv",rv:"rv",sqp:"sqp",rvps:"rvps",rvvs:"rvvs",pps:"pps",ppsc:"ppsc",vms:"vms",gpps:"gpps",gppsc:"gppsc",ft:"ft",fsc:"fsc",fpc:"fpc",sa:"sa",pi:"pi",dt:"dt",vb:"vb",dur:"dur",ttv:"ttv",bovpg:"bovpg",bovpv:"bovpv",be:"be",pap:"pap",mty:"mty",esv:"esv",rot:"rot",roid:"roid",rom:"rom",tti:"tti"},DEBUG_DATA_PIXELS:{ft:"ft",fsc:"fsc",fpc:"fpc"},PREDICT_NAMES:{distancePercentPredict:0,distancePixelsPredict:1,getAdFailPredict:2,multiAdPredict:4,playerReadyPredict:5,autoKillPredict:7,firstScrollPredict:8,emptyQueuePredict:9,intersectionPredict:11,fullEligibilityPredict:12,mp4Predict:17,timePredict:19,msnFullEligibilityPredict:23,feedInViewPredict:24,recoReelPredict:25,postRepeatPredictor:26,adxPredict:27,immediateStartPredict:29},ANIMATION_TYPE:{none:0,attaching:1,detaching:2,expanding:3,collapsing:4},ANIMATION_TIMER:{none:0,sliderClose:1e3},FLOATING_VIEW_TOP_COMPONENT:{video:0,loading:1,repeat:2,d2d:3,content:4},FRAME_TYPE:{plainPage:0,friendlyIframe:1,nonFriendlyIframe:2,amp:3,inApp:4},CHECK_FOR_RV_PRIORITY:{onEligibility:"hasReachedEligibility",pixelsFromSelector:"hasReachedPixelsFromSelector",intersectionPercent:"intersectionPercent",beforeLoaderEnd:"beforeLoaderEnd"},TIMER_NAMES:{viewability:"viewability",viewabilityOneS:"viewabilityOneS",viewability100:"viewability100",viewabilityAMP:"viewabilityAMP"},AD_STATUS:{new:0,adLoaded:1,startAd:2,adImpression:3,adPlay:4,adError:5,adComplete:6},GENERAL_ERROR:{1:"empty data from player"},CSS_PROPERTIES_FROM_RBOX:["font","@font-face","font-family","font-feature-settings","@font-feature-values","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-weight","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","line-break","line-height","outline","outline-color","outline-offset","outline-style","outline-width","text-decoration-line","text-underline-position","padding","padding-bottom","padding-left","padding-right","padding-top","margin","margin-bottom","margin-left","margin-right","margin-top","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","text-transform","z-index","text-align","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-indent","text-justify","text-orientation","text-overflow","text-shadow","text-transform","text-underline-position","direction","color"],NATIVE_AD:{DESC_TITLE_FONT_RATIO:.8,FIT_TO_SIZE:{TITLE:"title",FULL:"full",NONE:"none"}},UNIT_QUERY_LANGUAGE:{SUPPORTED_CONFIG_FLAGS:["stickyCard"],MAPPING:[{search:"@Ad@",replaceWith:"activeAd"}]},ITEM_TYPE:{IMA:27},ADX:{ADVERTISER:"66216755",ITEM_TYPE:27,ADVTYPE:7},RV_TYPES:{NON_RV:0,RV:1,ANY:"any"},MEDIA_TYPE:{MP4:1,VPAID:2,ADX:5},MEDIA_TYPE_ID_TO_NAME:{1:"video",2:"vpaid",6:"omid"},VIDEO_READY_STATE:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},TRC_PERFORMANCE_ACTIONS:{START:"Start",STOP:"Stop"},OS:{IOS:"iOS"},BROWSER:{IE:"IE",EDGE:"Edge",FIREFOX:"Firefox"},WF_ACTION:{START:"start",STOP:"stop"},TIME_UNITS:{SECOND:1e3,HALF_MINUTE:3e4},VIDEO_REEL:{NAME:"INSTREAM",PLAY:"play",CLOSE:"close"},DEFAULT_TIME_LIMITS:{REPEAT_SLIDER_TIMER_SECS:5e3},CANCEL_GET_AD_REASONS:{LOST_ELIGIBILITY:"cancelGetAdOnLostEligibility"},ARROW_KEYS_CODES:{LEFT:37,UP:38,RIGHT:39,DOWN:40},INSERT_OPTIONS:{BEFORE:"before",AFTER:"after"},PAUSE_REASONS:{UNKNOWN:"unknown",LOST_ELIGIBILITY:"lost eligibility",BLOCKED_BY_EXTERNAL_UNIT:"blocked by external unit",AD_SWAPPED:"ad swapped",UNIT_TERMINATED:"unit terminated",SLIDER_LOST_ELIGIBILITY:"slider lost eligibility",PERMANENT_CLOSE:"permanent close"},EXC_REASONS:{PUBVIDEO:"publisher video detection",DETACH_TO_SLIDER:"not attached to selector"},ADS_QUEUE_STATUS:{CHECKED:"checked",RV1_HUNT:"rv1Hunt"}}},207:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});const s={player:void 0,oppsula:void 0,pms:void 0,serviceLoader:void 0,microServices:{base_url:"//vidstat.taboola.com/",async:!0,PMS:{version:"2.2.1"}}}},503:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});class s{constructor(){if("instance"in this.constructor)throw new Error("Cannot instantiate more than one '".concat(this.constructor.name,"'"));if("Singleton"==this.constructor.name)throw new Error("Cannot instantiate abstract class 'Singleton'");this.constructor.instance=this}static getInstance(){return"instance"in this||this.create(...arguments),this.instance}static create(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new s(...t)}}var o=i(999),n=i(84);class r extends s{constructor(){var{addTrace:e=!1,isDebug:t=!1,isConsole:i=t,isSaveLog:s=t,extraLogGA:n=!1,version:r,isGA:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.addTrace=e,this.isDebug=o.parseBool(t),this.isConsole=o.parseBool(i),this.isSaveLog=o.parseBool(s),this.isGA=o.parseBool(a),this.extraLogGA=n,this.dataIndexName="units_debug_logs",this.isDebug&&(window.cmLogs=window.cmLogs||[]),this.initModel={}}static create(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new r(...t)}pushLog(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(window.cmLogs.push({ts:(new Date).getTime(),message:e,obj:t}),"cmTag: init"===e&&(this.initModel=t,console.log("cmTag: init obj:",JSON.stringify(t)),this.sessionID=this.getUniqSessionId(),this.showSessionID()))}info(e,t){this.isDebug&&this._hasConsoleMethod("info")&&(console.info("cmTag: ".concat(e),t),this.pushLog("cmTag: ".concat(e),t),this.addTrace&&this._hasConsoleMethod("trace")&&console.trace())}debug(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: RoyalBlue",t),this.pushLog("cmTag: ".concat(e),t))}error(e,t){this._hasConsoleMethod("error")&&(console.error("cmTag: ".concat(e),t),this.pushLog("cmTag: ".concat(e),t))}ga(e,t,i){return this.extraLogGA&&this.info("GA extra log",{unitType:e,action:t,version:i}),this._ga.send(e,t,i)}success(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: green",t),this.pushLog("cmTag: ".concat(e),t))}important(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: purple",t),this.pushLog("cmTag: ".concat(e),t))}warning(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: orange",t),this.pushLog("cmTag: ".concat(e),t))}pixel(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: #00A0B2",t),this.pushLog("cmTag: ".concat(e),t))}sendToServer(e,t){var i="no data";try{var s=JSON.stringify(t);t&&(i=s)}catch(e){}var o="".concat(this.initModel["player.settings.kbnul"],"/putes/").concat(this.dataIndexName);n.ajax({type:"POST",url:o,data:JSON.stringify({message:e,dataObject:i,timestamp:(new Date).toISOString(),sessionID:this.sessionID}),contentType:"text/plain"})}getUniqSessionId(){return"".concat(this.getRandomNumber()).concat(this.getRandomNumber()).concat(this.getRandomNumber())}showSessionID(){var e=document.createElement("div");e.setAttribute("id","_cm-session-id-div"),e.setAttribute("style","background: black; color: wheat; position: fixed; top: 0; left: 0;z-index:999999999");var t=document.createTextNode("SessionID: ".concat(this.sessionID)),i=document.createElement("button");i.innerHTML="X",i.addEventListener("click",(function(){document.querySelector("#_cm-session-id-div").remove()})),e.appendChild(t),e.appendChild(i),document.querySelector("body").appendChild(e)}getRandomNumber(){return Math.floor(10*Math.random())}_hasConsoleMethod(e){return console&&console[e]&&"function"==typeof console[e]}predict(e){this.info("%c ".concat(e),"color: #bada55")}}class a{constructor(){var{unitType:e,className:t,version:i,isDebug:s=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.unitType=e,this.className=t,this.version=i,this.isDebug=s,this._logger=r.getInstance({isDebug:this.isDebug,version:this.version})}info(e,t){this._logger.info("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}success(e,t){this._logger.success("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}important(e,t){this._logger.important("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}warning(e,t){this._logger.warning("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}pixel(e,t){this._logger.pixel("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}debug(e,t){this.isDebug&&this._logger.debug("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}error(e,t){this.isDebug&&this._logger.error("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}predict(e){this._logger.predict("unit type: ".concat(this.unitType,", predictor: ").concat(this.className,", predictlog: ").concat(e))}}},853:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var s,o=i(503),n=i(84),r=i(999);class a{constructor(e,t,i){this.conf=e,this.log=new o.Z({unitType:"Manager",className:"ScrollManager",version:this.conf.version,isDebug:this.conf.isDebug}),this.log.info("Created"),this.window=t||window,this.$window=n(window),this.windowHeight=this.$window.height(),this.windowWidth=this.$window.width(),this.scrollElement=r.isEmpty(i)?this.window:n(i)[0],this.$scrollElement=n(this.scrollElement),this.timeBetweenEvents=100,this.lastTimeStamp=0,this.lastScrollTop=this.$scrollElement.scrollTop(),this.pps=0,this.ppsChange=0,this.vms=1/0,this.direction=1,this.maxMSBetweenEvents=2e3,this.scrollEndTimeout=this.conf.scrollEndTimeout;var s=r.throttle(this.onScroll.bind(this),this.timeBetweenEvents);this.scrollElement.addEventListener("scroll",s)}getPps(){return this.pps}onScroll(e){clearTimeout(this.scrollEnd),this.pps=0;var t=e.timeStamp-this.lastTimeStamp;this.lastTimeStamp=e.timeStamp;var i=this.$scrollElement.scrollTop()-this.lastScrollTop;this.lastScrollTop=this.$scrollElement.scrollTop(),this.direction=i<0?-1:1,t<this.maxMSBetweenEvents&&this.changePPS(i/t*1e3),r.parseBool(this.conf.isLogScroll)&&this.log.info("onScroll - pps: "+this.direction*this.pps),this.scrollEnd=setTimeout(this.onScrollEnd.bind(this),this.scrollEndTimeout)}onScrollEnd(){r.parseBool(this.conf.isLogScroll)&&this.log.warning("onScrollEnd"),this.changePPS(0),r.forEach(this.onScrollEndCBList,function(e){e()}.bind(this))}changePPS(e){this.ppsChange=e-this.pps,this.pps=e,0===this.pps&&(this.vms=1/0),this.vms=this.windowHeight/this.pps*1e3,r.forEach(this.onScrollPPSChange,(function(e){setTimeout(e,0)}))}registerForPPSChange(e){this.onScrollPPSChange=this.onScrollPPSChange||[];var t=this.onScrollPPSChange.indexOf(e);return-1!==t?t:this.onScrollPPSChange.push(e)-1}deRegisterForPPSChange(e){var t=this.onScrollPPSChange.indexOf(e);this.onScrollPPSChange.splice(t,1)}registerForScrollEnd(e){this.onScrollEndCBList=this.onScrollEndCBList||[];var t=this.onScrollEndCBList.indexOf(e);return-1!==t?t:this.onScrollEndCBList.push(e)-1}deRegisterForScrollEnd(e){var t=this.onScrollEndCBList.indexOf(e);this.onScrollEndCBList.splice(t,1)}}const d=function(e,t,i){return s||(s=new a(e,t,i)),s}},234:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});const s={readyState:"ready",adManagerState:{empty:"empty",hasAds:"hasAds",stopped:"stopped",paused:"paused"},adState:{failed:"failed",playing:"playing",paused:"paused",continueAd:"continueAd",completed:"completed",autoKill:"autoKill",repeating:"repeating",skipped:"skipped"},adQState:{impression:"impression",q0:"q0",q1:"q1",q2:"q2",q3:"q3",completed:"completed",repeating:"repeating"},getAdState:{notCalled:"notCalled",gettingAd:"gettingAd",gotAd:"gotAd",waiting:"waiting",failed:"failed",stopped:"stopped",finished:"finished"},playerState:{error:"error",stopped:"stopped",closed:"closed",restarted:"restarted"},containerViewState:{rendered:"rendered",eligible:"eligible",playing:"playing",collapsed:"collapsed",attached:"attached",detached:"detached"},videoViewState:{rendered:"rendered",attached:"attached",detached:"detached"},repeatState:{hiding:"hiding",showing:"showing",spinning:"spinning",clicked:"clicked"},loadingViewState:{hiding:"hiding",showing:"showing",clicked:"clicked"},clickThruState:{clicked:"clicked",waiting:"waiting"},timerState:{working:"started",paused:"paused",stopped:"stopped",done:"done"},closeState:{terminate:"terminate",containerViewClosed:"containerViewClosed",videoViewClosed:"videoViewClosed",adManagerStop:"adManagerStop",playerClosed:"playerClosed"},tabState:{focus:"focus",blur:"blur",tabOut:"tabOut"},floatingView:{detach:"detach",attach:"attach",postAttach:"postAttach",permanentClosed:"permanentClosed"},externalUnit:{playing:"playing",stopped:"stopped"},brandingDisplayState:{show:"show",hide:"hide"},storiesUnitState:{videoImpression:"videoImpression",videoPause:"videoPause",videoResume:"videoResume",videoEnd:"videoEnd",videoViewable:"videoViewable"},storiesRboxState:{onVideoCardDisplayed:"onVideoCardDisplayed",categoriesHidden:"categoriesHidden",categoriesDisplay:"categoriesDisplay",videoSkipped:"videoSkipped"}}},832:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var s=i(72);const o=class{createStateHandlers(e){(0,s.L)(this,e)}}},777:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(72),o=i(316),n=i(999);class r extends o.View{constructor(e){super(e)}renderTemplate(){if(this.template&&this.model&&(this.template=n.template(this.template),this.$el.append(this.template(this.model.attributes)),this.ui)){var e={};for(var t in this.ui)e[t]=this.$el.find(this.ui[t]);this.ui=e}}createStateHandlers(e){(0,s.L)(this,e)}}const a=r},386:(e,t,i)=>{"use strict";i.d(t,{O:()=>s.Z,s:()=>o.Z});var s=i(832),o=i(777)},72:(e,t,i)=>{"use strict";i.d(t,{L:()=>o});var s=i(999),o=(e,t)=>{if(e.model&&s.isArray(t)){var i=e=>{var{self:t,funcName:i,withBind:o,args:n}=e;s.isString(i)&&s.isFunction(t[i])&&(o?t[i].bind(t,...n)():t[i](...n))};s.each(t,function(t){var{event:o,funcName:n,isListenOnce:r=!1,withBind:a=!0}=t;if(s.isArray(o)&&function(t){var{event:o,funcName:n,isListenOnce:r,withBind:a}=t,d=r?"listenToOnce":"listenTo",l=!0,h=!1,c=[];s.forEach(o,function(e){var t=e.split(":")[0],i=e.split(":")[1];c.push({eventName:t,stateName:i})}.bind(e));var u=function(t){if(!r||!h){var o=!0;s.forEach(c,(function(t){(void 0!==e.model.get(t.eventName)?e.model.get(t.eventName).toString():void 0)!==t.stateName&&(o=!1)})),o&&l?(l=!1,h=!0,i({self:e,funcName:n,withBind:a,args:arguments})):o||t()}};s.forEach(o,function(t){(e=>{var t=e.self,i=e.event,s=e.func,o=e.listen,n=e.isListenOnce,r=e.onEventNotEqual,a=i.split(":")[0],d=i.split(":")[1],l=function(){var e=function(){};n&&(e=function(){t.model.listenToOnce(t.model,"change:".concat(a),l)}),t.model.get(a).toString()===d?s.call(t,e):n?(r(),e()):r()}.bind(t);t.model[o](t.model,"change:".concat(a),l)})({self:e,func:u,event:t,withBind:a,listen:d,isListenOnce:r,onEventNotEqual:function(){l=!0}.bind(e)})}.bind(e))}({event:o,funcName:n,isListenOnce:r,withBind:a}),s.isString(o)&&s.isString(n)){var d=r?"listenToOnce":"listenTo";o.match(":")?(e=>{var{self:t,funcName:s,event:o,withBind:n,listen:r,isListenOnce:a}=e,d=o.split(":")[0],l=o.split(":")[1],h=function(){t.model.get(d).toString()==l?i({self:t,funcName:s,withBind:n,args:arguments}):a&&t.model.listenToOnce(t.model,"change:".concat(d),h)}.bind(t);t.model[r](t.model,"change:".concat(d),h)})({self:e,funcName:n,event:o,withBind:a,listen:d,isListenOnce:r}):e.model[d](e.model,"change:".concat(o),function(){i({self:e,funcName:n,withBind:a,args:arguments})}.bind(e))}}.bind(e))}}},249:(e,t,i)=>{"use strict";i.d(t,{B:()=>g});var s={setAdConfigAfter:"setSubModel",isPlacementSingleAd:!0,continueToPlayInNexCard:{isActive:!1}},o={setAdConfigAfter:"onAdSetToUnits",stopPredicts:!0,isKeepViewOnMidroll:!0,isKeepUnitOnMidroll:!0,isPlacementSingleAd:!0,isReplayAd:!0,isPreventNextAd:!0},n={isMultiAd:!1,isReplayAd:!0},r={isReplayAd:!0},a={setAdConfigAfter:"onAdSetToUnits",revertAfter:"_adVideoEnd",stickyCard:{isActive:!1,restrictions:{adTypeNotAllowed:!0}},hipCardPlacement:1,isNeedHipCard:!0,isNeedAdjacCard:!0,adjacCardPlacement:1},d={setAdConfigAfter:"onAdSetToUnits",revertAfter:"_adVideoEnd",isNeedAdjacCard:!0,adjacCardPlacement:1},l={setAdConfigAfter:"onAdSetToUnits",isTakeoverWidget:!0,isForceDontDie:!0,detachToSlider:{isDetachToSlider:!1},isMultiAd:!1,isReplayAd:!0,isKeepViewOnMidroll:!0},h={setAdConfigAfter:"setSubModel",isReplayable:!0},c={isReplayable:!0},u={isReplayable:!0},g={singleAd:{name:"singleAd",playerType:"singleAd",priority:1,defaultConfigFile:{isMultiAd:!1},unitsConfigFiles:{FEED_MANAGER:s,FEED_MANAGER_MOBILE:s,WIDGET_ITEM:o,WIDGET_ITEM_MOBILE:o,INLINE_INSTREAM:n,INLINE_MOBILE:n,SLIDER_INSTREAM:r,SLIDER_MOBILE:r}},rv:{name:"rv",priority:3},adjacency:{name:"adjacency",playerType:"adjacencyAd",priority:2,defaultConfigFile:{stickyCard:{isActive:!1,restrictions:{adTypeNotAllowed:!0}}},unitsConfigFiles:{FEED_MANAGER:d,FEED_MANAGER_MOBILE:d,WIDGET_ITEM:l,WIDGET_ITEM_MOBILE:l,RECO_REEL_WIDGET:{isReplayAd:!0,isMultiAd:!1}}},hip:{name:"hip",playerType:"hipAd",defaultConfigFile:{},unitsConfigFiles:{FEED_MANAGER:a,FEED_MANAGER_MOBILE:a}},replayable:{name:"replayable",defaultConfigFile:{},unitsConfigFiles:{FEED_MANAGER:h,FEED_MANAGER_MOBILE:h,INLINE_INSTREAM:c,INLINE_MOBILE:c,WIDGET_ITEM:u,WIDGET_ITEM_MOBILE:u},priority:4}}},120:(e,t,i)=>{"use strict";i.d(t,{S:()=>d,b:()=>l});var s=i(999);function o(e,t,i,s,o,n,r){try{var a=e[n](r),d=a.value}catch(e){return void i(e)}a.done?t(d):Promise.resolve(d).then(s,o)}function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class d{constructor(e){this.sessionId=this._setSessionId(e.model),this._setData(e.model),this.sendingDataToElastic=this._decideSendingDataToElastic(e.model),this.kbnul=e.model.get("kbnul"),this.apiUrl="".concat(this.kbnul,"/putes/unitsanalytics"),this.events=[],this.timeFromSessionStart=this._getCurrentTime(),this.maxEventsToLog=e.model.get("elasticLogger.maxEventsToLog"),this.sendingDataToElastic&&(this.sendInterval=setInterval(this.sendDataToElastic.bind(this),1e3*e.model.get("elasticLogger.secondsBetweenEvents")))}_setData(e){var t={unitType:e.get("unitType"),subUnit:e.get("subUnitType"),wurflData:{os:{name:e.get("wurfl.os.name"),version:e.get("wurfl.os.version")},browser:{name:e.get("wurfl.browser.name"),version:e.get("wurfl.browser.version")}},frameType:e.get("frameType"),country:e.get("country"),abTest:e.get("abTest"),unitVersion:e.get("unitVersion"),playerVersion:this._cleanPlayerVersion(e.get("player.urls.playerLocation")),liteUnitVersion:e.get("liteUnitVersion"),dast:e.get("dast"),redId:e.get("redId"),isApp:e.get("isApp")};this.data={_id:this.sessionId,session_data:r(r({},t),e.get("isApp")?{appName:e.get("appName"),appId:e.get("appId")}:{})}}_cleanPlayerVersion(e){return e.substring(e.lastIndexOf("/")+1)}isSendingDataToElastic(){return this.sendingDataToElastic}_decideSendingDataToElastic(e){return e.get("elasticLogger.isActive")&&s.isFactor(e.get("gaFactor"))&&e.get("isReportToKibana")?(e.set("gaFactor",1),e.set("shouldSendDataToElastic",!0),!0):(e.set("shouldSendDataToElastic",!1),!1)}_setSessionId(e){var t=s.generateGuid(10);return e.set("elasticSessionId",t),t}log(e){var{message:t,severity:i,extraData:s}=e;this.events.length>=this.maxEventsToLog||this.events.push({eventData:{message:t,severity:i,extraData:s},timeFromSessionStart:this._getCurrentTime()-this.timeFromSessionStart})}sendDataToElastic(){var e,t=this;return(e=function*(){t.data.timeline=t._buildTimeline();try{var e=yield fetch(t.apiUrl,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(t.data)});yield e.json()}catch(e){t.error=e.message}t.events=[]},function(){var t=this,i=arguments;return new Promise((function(s,n){var r=e.apply(t,i);function a(e){o(r,s,n,a,d,"next",e)}function d(e){o(r,s,n,a,d,"throw",e)}a(void 0)}))})()}_getCurrentTime(){return(new Date).getTime()}_buildTimeline(){var e={};return this.events=this.events.sort(((e,t)=>e.timeFromSessionStart-t.timeFromSessionStart)),this.events.forEach(((t,i)=>{e["ev".concat(i)]=t})),e}}var l={INFO:"info",WARNING:"warning",ERROR:"error"}}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return i[e].call(n.exports,n,n.exports,o),n.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,i)=>(o.f[i](e,t),t)),[])),o.u=e=>"units/33_7_5/infra/cmAdService.js",o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="adUnits:",o.l=(i,s,n,r)=>{if(e[i])e[i].push(s);else{var a,d;if(void 0!==n)for(var l=document.getElementsByTagName("script"),h=0;h<l.length;h++){var c=l[h];if(c.getAttribute("src")==i||c.getAttribute("data-webpack")==t+n){a=c;break}}a||(d=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",t+n),a.src=i),e[i]=[s];var u=(t,s)=>{a.onerror=a.onload=null,clearTimeout(g);var o=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((e=>e(s))),t)return t(s)},g=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),d&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var s=i.length-1;s>-1&&!e;)e=i[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e+"../../../"})(),(()=>{var e={552:0};o.f.j=(t,i)=>{var s=o.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var n=new Promise(((i,o)=>s=e[t]=[i,o]));i.push(s[2]=n);var r=o.p+o.u(t),a=new Error;o.l(r,(i=>{if(o.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var n=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+n+": "+r+")",a.name="ChunkLoadError",a.type=n,a.request=r,s[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var s,n,[r,a,d]=i,l=0;if(r.some((t=>0!==e[t]))){for(s in a)o.o(a,s)&&(o.m[s]=a[s]);if(d)d(o)}for(t&&t(i);l<r.length;l++)n=r[l],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0},i=self.webpackChunkadUnits=self.webpackChunkadUnits||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=o(999),t=o.n(e),i=(o(84),o(316)),s=o.n(i),n=o(316);function r(e){var i,s;if(!t().isObject(e)||t().isFunction(e))return e;if(e instanceof n.Collection||e instanceof n.Model)return e;if(t().isDate(e))return new Date(e.getTime());if(t().isRegExp(e))return new RegExp(e.source,e.toString().replace(/.*\//,""));if(e instanceof HTMLElement||e.nodeType&&1===e.nodeType)return e;if(e instanceof CSSStyleDeclaration)return JSON.stringify(function(e){var t=!!document.documentMode,i=!t&&!!window.StyleMedia;if(!t&&!i)return e;var s={};for(var o in e)s[o]=e[o];return s}(e));s=t().isArray(e||t().isArguments(e)),i=function(e,t,i){return s?e.push(r(t)):e[i]=r(t),e};return t().reduce(e,i,s?[]:{})}function a(e){return null!=e&&((e.prototype==={}.prototype||e.prototype===Object.prototype)&&t().isObject(e)&&!t().isArray(e)&&!t().isFunction(e)&&!t().isDate(e)&&!t().isRegExp(e)&&!t().isArguments(e))}function d(e){return t().filter(t().keys(e),(function(t){return a(e[t])}))}function l(e){return t().filter(t().keys(e),(function(i){return t().isArray(e[i])}))}function h(e,i,s){var o,n,r,a,c,u,g,m;if(null==s&&(s=20),s<=0)return console.warn("_.deepExtend(): Maximum depth of recursion hit."),t().extend(e,i);for(n=function(t){return i[t]=h(e[t],i[t],s-1)},c=0,g=(a=t().intersection(d(e),d(i))).length;c<g;c++)n(a[c]);for(o=function(s){return i[s]=t().union(e[s],i[s])},u=0,m=(r=t().intersection(l(e),l(i))).length;u<m;u++)o(r[u]);return t().extend(e,i)}function c(e){var i={},s=f.keyPathSeparator;for(var o in e){var n=e[o];if(n&&n.constructor===Object&&!t().isEmpty(n)){var r=c(n);for(var a in r){var d=r[a];i[o+s+a]=d}}else i[o]=n}return i}function u(e,i,s){for(var o=f.keyPathSeparator,n=i.split(o),r=e,a=0,d=n.length;a<d;a++){if(s&&!t().has(r,n[a]))return!1;if(null==(r=r[n[a]])&&a<d-1&&(r={}),void 0===r)return!!s||r}return!!s||r}function g(e,i,s,o){o=o||{};for(var n=f.keyPathSeparator,r=i.split(n),a=e,d=0,l=r.length;d<l&&void 0!==a;d++){var h=r[d];d===l-1?o.unset?delete a[h]:a[h]=s:(void 0!==a[h]&&t().isObject(a[h])||(a[h]={}),a=a[h])}}function m(e){var i={};return"object"!=typeof e?e:(t().each(e,(function(e,t,s){i[t]=p(e)})),i)}function p(e){if(e&&"["===e[0]&&"]"===e[e.length-1]){let t;try{t=JSON.parse(e)}catch(i){t=e}e=t}if(t().isArray(e)){var i=[];return t().each(e,(function(e){i.push(p(e))})),i}return"object"!=typeof e||t().isElement(e)?"true"===e||!0===e||"false"!==e&&!1!==e&&(""===e||isNaN(e)?e:Number(e)):m(e)}function v(e,t){g(e,t,null,{unset:!0})}t().mixin({deepClone:r,isBasicObject:a,basicObjects:d,arrays:l,deepExtend:function(){var e,i,s,o;if(s=2<=arguments.length?[].slice.call(arguments,0,o=arguments.length-1):(o=0,[]),i=arguments[o++],t().isNumber(i)||(s.push(i),i=20),s.length<=1)return s[0];if(i<=0)return t().extend.apply(this,s);for(e=s.shift();s.length>0;)e=h(e,r(s.shift()),i);return e}});const f=s().Model.extend({constructor:function(e,i){var s,o=e||{};this.cid=t().uniqueId("c"),this.attributes={},i&&i.collection&&(this.collection=i.collection),i&&i.parse&&(o=this.parse(o,i)||{}),(s=t().result(this,"defaults"))&&(o=t().deepExtend({},s,o)),this.set(o,i),this.changed={},this.initialize.apply(this,arguments)},toJSON:function(e){return t().deepClone(this.attributes)},get:function(e){return u(this.attributes,e)},set:function(e,i,s,o=!0){var n,r,a,d,l,h,p,b;if(null==e)return this;if("object"==typeof e?(r=e,s=i||{}):(r={})[e]=i,o&&(r=m(r)),s||(s={}),!this._validate(r,s))return!1;for(n in a=s.unset,l=s.silent,d=[],h=this._changing,this._changing=!0,h||(this._previousAttributes=t().deepClone(this.attributes),this.changed={}),b=this.attributes,p=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]),r=c(r))i=r[n],t().isEqual(u(b,n),i)||d.push(n),t().isEqual(u(p,n),i)?v(this.changed,n):g(this.changed,n,i),a?v(b,n):g(b,n,i);if(!l){d.length&&(this._pending=!0);for(var _=f.keyPathSeparator,S=0,y=d.length;S<y;S++){e=d[S];this.trigger("change:"+e,this,u(b,e),s);for(var A=e.split(_),T=A.length-1;T>0;T--){var w=t().first(A,T).join(_),C=w+_+"*";this.trigger("change:"+C,this,u(b,w),s),this.trigger("change:"+w,this,u(b,e),s)}}}if(h)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,s);return this._pending=!1,this._changing=!1,this},clear:function(e){var i={},s=c(this.attributes);for(var o in s)i[o]=void 0;return this.set(i,t().extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!t().isEmpty(this.changed):void 0!==u(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&c(this.changed);var i=this._changing?this._previousAttributes:this.attributes;e=c(e),i=c(i);var s,o=!1;for(var n in e)t().isEqual(i[n],s=e[n])||((o||(o={}))[n]=s);return o},previous:function(e){return null!=e&&this._previousAttributes?u(this._previousAttributes,e):null},previousAttributes:function(){return t().deepClone(this._previousAttributes)}});f.keyPathSeparator=".";const b=f;s().DeepModel=b;var _,S=o(974),y=o(503),A=o(84);function T(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function w(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var C=null,P=e.flatten;e.mixin({setConfig(e){(C=e).isDebug&&(_=new y.Z({unitType:C.unitType,className:"utils",version:C.version,isDebug:C.isDebug}))},parseBool:function(e){return"true"===e||!0===e||1===e||"1"===e},el:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=document.createElement(e);for(var s in t)null!=t[s]&&(i[s]=t[s]);return i},loadJs:function(t,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return document.head.appendChild(e.el("script",function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?T(Object(i),!0).forEach((function(t){w(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({src:t,onload:i,async:!0},s)))},loadCss:(t,i)=>document.head.appendChild(e.el("link",{href:t,onload:i,rel:"stylesheet",type:"text/css"})),loadJsArr:function(t,i){var s;i&&(s=t.length);for(var o=0;o<t.length;o++)t[o].indexOf(".css")>-1?e.loadCss(t[o],n):e.loadJs(t[o],n);function n(){0===--s&&e.defer(i.bind(this))}},getUrlVars:function(e){for(var t,i=[],s=(e=e||window).location.href.slice(e.location.href.indexOf("?")+1).split("&"),o=0;o<s.length;o++)t=s[o].split("="),i.push(t[0]),i[t[0]]=t[1];return i},firePixelConditional:function(t,i,s,o){t&&e.firePixel(i,s,o)},firePixel:function(t,i,s){t&&(s&&(t=e.addParametersToUrl(t,s,-1===t.indexOf("?"))),e.log("pixel","firing pixel: "+i+" url: "+t),document.createElement("IMG").src=t)},fireIframePixel:function(t,i){if(t){e.log("pixel","firing pixel: "+i+" url: "+t);var s=document.createElement("iframe");s.src=t,s.style.display="none";var o=document.getElementsByTagName("body")[0];o||(o=document.getElementsByTagName("html")[0]),o||(o=document.getElementsByTagName("div")[0]),o?o.appendChild(s):e.log("debug","fireIframePixel - Failed to fire iframe pixel.")}else e.log("pixel","fireIframePixel","Url empty.")},getViewabilityPercent(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.offsetHeight,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.offsetWidth,o=t.getBoundingClientRect(),n=Math.max(0,o.top),r=Math.min(e.viewport().height,o.bottom),a=Math.max(0,o.left);return 100*(r-n)*(Math.min(e.viewport().width,o.right)-a)/(i*s)},isVisible(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.offsetHeight,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.offsetWidth,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50;return e.getViewabilityPercent(t,i,s)>=o},viewport:()=>({get height(){return e.viewport().object.document.documentElement.clientHeight},get width(){return e.viewport().object.document.documentElement.clientWidth},get object(){return top}}),getVideoHeight(e){var t=parseInt(9/16*e);return isNaN(t)?0:t},getVideoWidth(e){var t=parseInt(16/9*e);return isNaN(t)?0:t},getVideoBestSize(e,t){var i=this.getVideoHeight(e);return t>=i?t=i:e=this.getVideoWidth(t),{width:e,height:t}},getVideoHeightByRatio(e,t){var i=parseInt(1/t*e);return isNaN(i)?0:i},getVideoWidthByRatio(e,t){var i=parseInt(t*e);return isNaN(i)?0:i},isElementInHead(e){if(!e)return!1;for(;e!==document.body&&e!==document.head;)e=e.parentNode;return e===document.head},getViewPercent:function(t,i,s,o,n){var r,a=e.isEmpty(o)?A(this.getTopWindow()):A(o);r=window.taboolaBridge&&window.taboolaBridge.active?this.calcViewportPositionInApp(o):{top:0,left:0,right:a.width(),bottom:a.height()};var d=Number(s)||0,l=Number(i)||0,h=n?t.getClientRects()[0]:t.getBoundingClientRect(),c={top:h.top,left:h.left};if(c.right=c.left+l,c.bottom=c.top+d,r.right<c.left||r.left>c.right||r.bottom<c.top||r.top>c.bottom)return 0;var u=Math.min(1,(c.bottom-r.top)/d),g=Math.min(1,(r.bottom-c.top)/d);return Math.min(1,(c.right-r.left)/l)*Math.min(1,(r.right-c.left)/l)*u*g*100},isViewable:function(t,i,s,o){var n=e.getViewPercent(t,i,s);return!(n<=0)&&n>=(o=o||100)},getViewPercentageDeltas:function(e,t,i){var s=A(window),o={top:s.scrollTop(),left:s.scrollLeft()};o.right=o.left+s.width(),o.bottom=o.top+s.height();var n=Number(i)||0,r=Number(t)||0,a=A(e).offset();return a.right=a.left+r,a.bottom=a.top+n,{top:Math.min(1,(a.bottom-o.top)/n),bottom:Math.min(1,(o.bottom-a.top)/n),left:Math.min(1,(a.right-o.left)/r),right:Math.min(1,(o.right-a.left)/r)}},getValidSelectorElements(t,i,s){var o=[];return i=i||100,s=s||0,t&&(e.isArray(t)||this.isZeptoCollection(t))&&(o=e.filter(t,(function(t){var o=t.getBoundingClientRect();return o.width>=i&&o.height>=s&&!e.has(S.z.INVALID_SELECTOR_TAG_NAMES,t.tagName)}))),o},filterObject(e,t){if(e){for(var i={},s=0;s<t.length;s++){var o=e[t[s]];void 0!==o&&(i[t[s]]=o)}return i}},assignWithoutUndefinedValues(e,t){for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e},stripObject(t,i){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100;if(t){var a={};for(var d in t)if(!(d in i)){var l=t[d];o&&e.isElement(l)||s&&e.isFunction(l)||(n&&!e.isFunction(l)&&e.isObject(l)&&(l=r>0?this.stripObject(l,[],s,o,n,r--):"{stripElements} - value is Object, but max depth reached."),a[d]=l)}return a}},arrayToObj(e){if(e){for(var t={},i=0;i<e.length;i++)void 0!==e[i]&&(t[i]=e[i]);return t}},getTopOfEl(t){if(t){var i=t,s=0;if(document.getElementById||document.all)do{for(t.offsetLeft-t.scrollLeft,s+=t.offsetTop-t.scrollTop,t=t.offsetParent,i=e.getParentNode(i);i!=t;)i.scrollLeft,s-=i.scrollTop,i=e.getParentNode(i)}while(t&&t.offsetParent);else document.layers&&(s+=t.y,t.x);return s}},getParentNode:e=>e.parentNode&&e.parentNode.host?e.parentNode.host:e.parentNode,getLeftOfEl:e=>window.pageXOffset+e.getBoundingClientRect().left,PrefixedEvent(t,i,s,o){s=s.toLowerCase(),e.each(["webkit","moz","MS","o",""],(function(e){t[i](e+s,o)}))},oneAnimationEnd(t,i){var s=e.debounce(i,200);this.PrefixedEvent(t,"one","transitionend",s),this.PrefixedEvent(t,"one","animationend",s)},addParametersToUrl(e,t,i){var s=e;return s+=i?"?":"&",A.each(t,(function(e,t){void 0!==t&&""!==t&&(s+=e+"="+t+"&")})),s},skipTransitionCss(e,t){e.addClass("none-transition"),e.css(t),this.flushCss(e[0]),e.removeClass("none-transition")},flushCss(e){e.offsetHeight},getTopWindow(){var e=window;try{for(;e.document!==e.top.document;)e=e.top;return e}catch(e){return window}},isInIframe:function(e){return!!e&&(e.inIframe||e.inDFP)},isInFriendlyIframe:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cmTag.config.iframeData;return!!e&&(this.isInIframe(e)&&e.isFriendlyIframe)},hideDFPIframe:function(t){if(this.isInFriendlyIframe(t)){t.iframe.style.display="none";for(var i=t.iframe.parentNode;e.some(S.z.DFP_KEYWORDS,(function(e){return-1!==i.id.indexOf(e)}));)i.style.display="none",i=i.parentNode}},onceDocReady:function(e){return/complete|loaded|interactive/.test(document.readyState)&&document.body?e():A("document").one("DOMContentLoaded",e),this},crc32:function(e){if(!e||"string"!=typeof e)return 0;var t;void 0===t&&(t=0);var i=0;t^=-1;for(var s=0,o=(e=this.utf8Encode(e)).length;s<o;s++)i=255&(t^e.charCodeAt(s)),t=t>>>8^"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*i,8);return-1^t},utf8Encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t},isMouseOver:function(e){return 0!==e.filter(":hover").length},rollNumbers:function(e){return!!e&&100*Math.random()<e},isFactor:function(t){return e.isNumber(t)&&t===e.random(1,t)},sendMail:function(t,i,s){function o(){emailjs.init("user_kHlYxxusLRTxC6yr3PjQl"),emailjs.send("gmail","units_support",t).then(i,s)}i=i||function(){},s=s||function(){},window.emailjs?o():e.loadJs("//cdn.emailjs.com/dist/email.min.js",o)},isValidEmail:function(e){return!0},toCssObj:function(e){return"string"==typeof e?JSON.parse(e):e},isLayerVisible:function(e){function t(e,t){return window.getComputedStyle?document.defaultView.getComputedStyle(e,null)[t]:e.currentStyle?e.currentStyle[t]:void 0}return function e(i,s,o,n,r,a,d){var l=i.parentNode;return!!function(e){for(;e=e.parentNode;)if(e===document)return!0;return!1}(i)&&(9===l.nodeType||"0"!==t(i,"opacity")&&"none"!==t(i,"display")&&"hidden"!==t(i,"visibility")&&(void 0!==s&&void 0!==o&&void 0!==n&&void 0!==r&&void 0!==a&&void 0!==d||(s=i.offsetTop,r=i.offsetLeft,n=s+i.offsetHeight,o=r+i.offsetWidth,a=i.offsetWidth,d=i.offsetHeight),!l||("hidden"!==t(l,"overflow")&&"scroll"!==t(l,"overflow")||!(r+2>l.offsetWidth+l.scrollLeft||r+a-2<l.scrollLeft||s+2>l.offsetHeight+l.scrollTop||s+d-2<l.scrollTop))&&(i.offsetParent===l&&(r+=l.offsetLeft,s+=l.offsetTop),e(l,s,o,n,r,a,d))))}(e)},getOffset(t,i){if(t&&(Array.isArray(t)||this.isZeptoCollection(t))&&t[0]&&(t=t[0]),t){if(1===i)return A(t).offset();var s=t,o=t,n=0,r=0;if(document.getElementById||document.all)do{for(r+=t.offsetLeft-t.scrollLeft,n+=t.offsetTop-t.scrollTop,t=t.offsetParent,o=e.getParentNode(o);o&&o!=t;)r-=o.scrollLeft,n-=o.scrollTop,o=e.getParentNode(o)}while(t&&t.offsetParent);else document.layers&&(n+=t.y,r+=t.x);return{top:n,left:A(s).offset().left||r}}},flatten(e){var t={};for(var i in e)t[i]=e[i];return t},cssObjToString(e){var t=!!document.documentMode,i=!t&&!!window.StyleMedia,s=window.navigator.userAgent.indexOf("Firefox")>-1;return(t||i||s)&&(e=this.flatten(e)),JSON.stringify(e)},isModel(e,t,i){return i?i.model.get(e)===t:this.model.get(e)===t},generateGuid(e,t){var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s=[],o=0;for(t=t||i.length,e=e||22,o=0;o<e;o++)s[o]=i[0|Math.random()*t];return s.join("")},isObserverSupported(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=window[e],s=void 0!==i,o=!1;return s&&(o=-1!==i.toString().indexOf("[native code]")),o||t&&s},isHeightValid(e){var t=!0;return e||(t=!1),t},isWidthValid(e){var t=!0;return e||(t=!1),t},setTrcObserver(e){TRC.intersections,TRC.intersections.observe&&TRC.intersections.observe(e)},dispatchTRC(t,i){e.dispatchTRCWithPayload(t,void 0,i)},dispatchTRCWithPayload(t,i,s){if(window.TRC&&window.TRC.dispatch)try{window.TRC.dispatch(t,i),e.log("info","dispatched TRC event: ".concat(t))}catch(i){s&&s.set("TRCDispatchFailed",!0),e.log("error","dispatched TRC event: ".concat(t," is failed, error: ").concat(i))}},getOffsetWithContainer(e,t,i){if(!i)return this.getOffset(e,t);var s=this.getOffset(e,t),o=this.getOffset(A(i));return{top:s.top-o.top,left:s.left-o.left}},getIframeDocument(e){try{if(e.tagName&&"iframe"==e.tagName.toLowerCase())return e.contentWindow.console.error&&(e.contentWindow.console.error=function(){}),e.contentDocument}catch(e){return null}},DOMIterator(e,t,i,s){try{var o=this.getIframeDocument(e)||e;if(!o)return;o.querySelectorAll(t).forEach((e=>{this.DOMIterator(e,t,i,s)})),i(o.querySelectorAll(s))}catch(e){}},isBrowserIE11:e=>-1!==e.name.indexOf("ie")&&11===e.version,forceElementRedrawWithBorderChange(e,t,i){if(this.isBrowserIE11(e)&&!i){var s=A(t);s&&s.css&&(s.css("border","1px solid transparent"),setTimeout(function(){s&&s.css&&s.css("border","none")}.bind(s)))}},hasPassedPixelFromSelector(t,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;if(t){var n,r;if(t.nodeType)n=[t];else{var a=t.toString();n=r=A(a)}o&&(n=this.getValidSelectorElements(r));var d=n[0];if(i=A(i)[0],window.taboolaBridge){var l=taboolaBridge.data;if(l&&l.boundingClientRect){var h=l.boundingClientRect.top-l.rootBounds.bottom,c=h<s;return e.log("info","###hasPassedPixelsFromSelector"+c+" - "+h+"/"+s),c}}var u=void 0!==i,g=u?i.clientHeight:window.innerHeight,m=u?g+i.scrollTop:g+window.pageYOffset,p=s;return this.getTopOfEl(d)-p<=m}},getViewportHeight:e=>void 0!==(e=A(e)[0])?e.clientHeight:window.innerHeight,calcViewportPositionInApp(e){var t=window.taboolaBridge.data,i=t.boundingClientRect;return{top:i.y<0?0-i.y:0,left:0,right:i.width,bottom:i.y>t.rootBounds.height?0:Math.abs(i.y-t.rootBounds.height)}},getOrganicCard(){var e,t=(null===(e=TRCImpl)||void 0===e?void 0:e.boxes)||{};for(var i in t){var s=t[i]||{},o=s.isFeedCard,n=!1;if(s.itemsTypes&&s.itemsTypes["is-organic"]&&(n=s.itemsTypes["is-organic"]),n&&o&&s.boxes.length)return s.mode}},getRootElementFontSize:()=>parseFloat(getComputedStyle(document.documentElement).fontSize),convertRem(e){return e*this.getRootElementFontSize()},flattenArray:(e,t)=>P(e,t,!1),offsetFromBottomOfViewPort:e=>e.getBoundingClientRect().top-(window.innerHeight||document.documentElement.clientHeight),sendingEventToTaboolaBridge(e,t){window.taboolaBridge&&window.taboolaBridge.emit("videoEvent",{type:e,value:t})},setAnimationPlayState(e,t){e.style.webkitAnimationPlayState=t,e.style.animationPlayState=t},recoReelPlayStateAnimation(e,t,i){var s=t+1,o=A('[data-progress-bar-index="'.concat(t,'"] .tbl-progress-runner'),e)[0],n=A(".videoCube_".concat(s,"_child .thumbBlock"),e)[0];o&&this.setAnimationPlayState(o,i),n&&this.setAnimationPlayState(n,i);var r=A(".videoCube_".concat(s,"_child .tbl-vrl-video-wrapper video"),e)[0];if(r){this.toggleRecoReelVideo(r,i);var a=A(".vrl-cta",e.parentElement)[0];a&&this.setAnimationPlayState(a,i)}},toggleRecoReelVideo(e,t){"paused"===t?e.pause():e.play()},getRandomFromList:e=>!(e.length<1)&&e[Math.floor(Math.random()*e.length)],isSendBeaconSupported:()=>!(!navigator||!e.isFunction(navigator.sendBeacon)),getSubUnitType(e){var t=e.isMidArticle,i=e.isSticky,s=e.isDetachBelow,o=e.isDetachAbove,n=e.isStartFromSlider,r=e.isDetachToSlider;return t?S.z.SUB_UNIT_TYPE.MID_ARTICLE_AS_FEED:i||!n||r?i||n||!r?!i&&n&&r?S.z.SUB_UNIT_TYPE.SUPER_SLIDER:i&&s&&!o?S.z.SUB_UNIT_TYPE.STICKY_BELOW:i&&!s&&o?S.z.SUB_UNIT_TYPE.STICKY_ABOVE:i&&s&&o?S.z.SUB_UNIT_TYPE.STICKY_BELOW_ABOVE:void 0:S.z.SUB_UNIT_TYPE.DETACH_TO_SLIDER:S.z.SUB_UNIT_TYPE.START_FROM_SLIDER},getRecoReelSubUnitType(e){var t=e.isRecoReelEnableRboxSlider||!1,i=e.isRecoReelStartFromRboxSlider||!1;return t&&i?S.z.RECO_REEL_SUB_UNIT_TYPE.START_FROM_SLIDER_RBOX:t&&!i?S.z.RECO_REEL_SUB_UNIT_TYPE.DETACH_TO_SLIDER_RBOX:S.z.RECO_REEL_SUB_UNIT_TYPE.PLAIN},isReadMoreOnPage:()=>window.TRC&&void 0!==window.TRC.readMoreVisible,isMidArticleOnReadMorePage(e){return this.isReadMoreOnPage()&&e},isReadMoreObserverNeededOnPage:(t,i)=>t&&i&&window.TRC&&window.TRC.readMoreVisible&&e.isObserverSupported("IntersectionObserver"),trcPerformanceMeasurement(t,i,s){try{if(t&&e.isTRCPerformanceEnabled()){var o="".concat(i).concat(s);window.TRC.performance.mark(o,null,"","",i,window.TRC.PerfEvenType[s.toUpperCase()])}}catch(e){}},isTRCPerformanceEnabled:()=>window.TRC&&window.TRC.performance&&window.TRC.performance.mark,copyCSSFromPlaceholder(t,i,s){if(t&&i&&s&&0!==s.length){var o=window.getComputedStyle(i),n={};e.forEach(s,(e=>{n[e]=o[e]})),t.css(n)}},getDeltaBetweenRects(e,t){if(!e)return t||{};if(!t)return e||{};var i={};for(var s in e)if(void 0!==t[s]){var o=e[s]-t[s];o&&(i[s]=o)}return i},buildObserverThresholdList(){for(var e=[],t=1;t<=20;t++){var i=t/20;e.push(i)}return e.push(0),e},getRequiredHeight(t,i){var s=i.get("width"),o=document.querySelector("[".concat(t,"]"));if(o){var n=o.getBoundingClientRect().width;return e.getVideoHeight(n)}return e.getVideoHeight(s)},getFeedTitleHeight(){var e=document.querySelector(".tbl-feed-header");return e?A(e).height():0},getPlacement(e){var t=e.get("placement");return t=(t=t.replace("Feed - ","")).split(" |")[0]},getMarginToStartCard(e,t,i){if(this.isPlacementWithScAdjacency(e)){var s=document.querySelector(t);if(s)return A(s).offset().top-A(i).offset().top}return 0},isPlacementWithScAdjacency:t=>t.get("placementWithScAdjacency")===e.getPlacement(t),isLanguageRTL(e){var t=e.get("language");return e.get("rtlLanguagesArray").includes(t)},loadFromTRC(e,t,i,s){this.isServiceValid(e,t)&&this.isServiceLoadedOnTRC(e,t)&&this.onServiceLoaded(e,t,i,s)},isServiceValid:(e,t)=>e&&t,isServiceLoadedOnTRC:(e,t)=>window.TRC&&window.TRC[e]&&window.TRC[e][t],onServiceLoaded(e,t,i,s){if(i)try{i(window.TRC[e][t])}catch(e){s&&s()}},isSliderCutOffEnabled:(e,t)=>e.get("isSliderCutOff")&&t&&!t.alwsldr,clickThru(e){this.model.get("isInAppBridgeOn")&&window.taboolaBridge&&window.taboolaMobile&&window.taboolaMobile.getSupportedFeatures&&window.taboolaMobile.getSupportedFeatures().VideoClick?window.taboolaBridge.emit("videoClick",e):window.open(e)},defer(e){var t,i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=null===(t=window)||void 0===t||null===(t=t.TRC)||void 0===t||null===(i=t.Fader)||void 0===i?void 0:i.call(t);if(C.deferTasks&&C.deferTasks.isActive){var n=e.bind(s);o?o(n):setTimeout(n,0)}else e.apply(s)},isZeptoCollection:e=>A.zepto.isZ(e),log(e,t){_&&_[e](t)}});var E=o(386),I=o(999);class O extends E.O{constructor(e){super(e.model),this.model=e.model,this.onPredict=e.onPredict,this.adProperties=e.adProperties,this.onPredictCallback=e.onPredictCallback,this.currentKey=0,this.log=new y.Z({unitType:this.model.get("unitType"),className:"basePredictService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this._bindEvents()}_bindEvents(){}_setCuerrentKey(e){this.currentKey=I.last(e.split(".")),this.model.set("adsManagerLastPredictKey",this.currentKey)}_predicted(e){if(!this.model.get("isGetRv1OnlyForEligible.isActive")||e!=S.z.RV_TYPES.RV||this.model.get("isEligibleToPlay")){if(this.model.set("lastPredictPoint",e),this.model.set("lastPredictPath",this.predictPath),this.model.get(this.predictPath+".isStartWF")&&this.startWf&&(this.log.info("startWF predicted"),this.startWf()),this._checkIsGet1OnlyOnAdLoaded()&&parseInt(e)===S.z.RV_TYPES.RV&&!this.model.get("playerHasRvInQ"))return this.log.warning("no rv=1 in adLoaded skipping predict"),void this.model.set("isSkippedDistancePredict",!0);this.predictPath&&!this.model.get(this.predictPath+".isActive")||(this._logPredict(e),this.onPredict(e,this.log.className,this.adProperties))}else this.model.get("isGetRv1OnlyForEligible.delayPrediction")&&this._delayRvPredict(e)}_checkIsGet1OnlyOnAdLoaded(){var e=this.model.get("predictors.isGet1OnlyAfterAdLoaded");return this.predictPath&&void 0!==this.model.get("".concat(this.predictPath,".isGet1OnlyAfterAdLoaded"))&&(e=this.model.get("".concat(this.predictPath,".isGet1OnlyAfterAdLoaded"))),e}_logPredict(e){var t="predicted with key: "+e;this.adProperties?this.log.info(t+" with properties: ",this.adProperties):this.log.info(t)}_delayRvPredict(e){this.delayedPredictPointKey=e,this.delayStartTimeStamp=Date.now(),this.model.set("delayRvPredict",S.z.PREDICT_NAMES[this._getPredictName()]),this.createStateHandlers([{event:"isEligibleToPlay:true",funcName:"_predictOnDelayRvPredict",isListenOnce:!0}])}_predictOnDelayRvPredict(){this.model.set("executeDelayedRvPredict",{name:S.z.PREDICT_NAMES[this._getPredictName()],time:Date.now()-this.delayStartTimeStamp}),this._predicted(this.delayedPredictPointKey)}_getPredictName(){return this.predictPath.split(".")[1]}}const V=O;const N=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"autoKillPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.autoKill",this.predictPoint="".concat(this.predictPath,".predictPoint"),this.allowedPredictPoint=this.model.get("".concat(this.predictPath,".allowedPredictPoint")),this.log.predict("predict created")}_bindEvents(){this.createStateHandlers([{event:"adState:autoKill",funcName:"_onAutoKillPredict"}])}_onAutoKillPredict(){if(this._canPredict()){var e=this._getLastAutoKilledAdKey();this.log.predict("predicted with key ".concat(e)),setTimeout(this._predicted.bind(this,e),0)}else this.log.predict("Not allowed to predict")}_canPredict(){return this.allowedPredictPoint===this._getLastAutoKilledAdKey()}_getLastAutoKilledAdKey(){return this.model.get("lastAutoKilledPredict")}};var D=o(84),R=o(999),M=(e,t)=>{e.model=t,e.parentSelectorStr=void 0,e.model.get("permanentCard")?e.parentSelectorStr='[data-card-index="'.concat(e.model.get("permanentCard"),'"]'):e.model.get("predictors.isUseWidgetSelector")?e.parentSelectorStr=e.model.get("widgetSelector"):e.model.get("isRecoReelAboveFeed")?e.parentSelectorStr=e.model.get("aboveFeedSelector"):e.model.get("midArticleSelector")?e.parentSelectorStr=e.model.get("midArticleSelector"):e.parentSelectorStr=e.model.get("parentSelector");return{getParentSelector:()=>{if(e.parentSelectorStr){var t=e.parentSelectorStr.toString(),i=D(t);return e.model.get("predictors.isNeedValidateParentSelector")?R.getValidSelectorElements(i)[0]:i[0]}},calcPredicts:()=>{var t=e.model.get(e.predictPoints);R.each(t,((t,i)=>{e._calcPredict(t,i)}))}}},x=o(853),F=o(316);const L=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"baseDistancePredicts",version:this.model.get("version"),isDebug:this.model.get("isDebug")})}_initPredict(e){this.predictPoint=e.predictPoint,this.predictKey=e.predictKey,this.startWf=e.startWfFunc,this.utils=M(this,this.model),this.scrollManager=new x.Z,this._setParentSelector()}_setParentSelector(){if(!this.isSelectorFound){var e=this.utils.getParentSelector();e?(this.isSelectorFound=!0,this.parentSelector=e,this.log.info("parentSelector found staring to predict viewability"),this._bindEvents(),this._calcPredict()):(this.log.info("no parentSelector can't predict distance waiting for parentSelector"),F.once("window:scroll:change",this._setParentSelector.bind(this)),this.model.listenToOnce(this.model,"change:parentSelector",this._setParentSelector.bind(this)))}}_bindEvents(){this.parentSelector&&(window.taboolaBridge&&!this.registeredOnNotifyExternalRects&&(this.registeredOnNotifyExternalRects=!0,window.taboolaBridge.on("notifyExternalRects",this._calcPredict.bind(this))),F.once("window:scroll:change",this._calcPredict.bind(this)))}_calcPredict(){}_onDistancePredicted(e){if(this.log.predict("predict key ".concat(e,": max pps = ").concat(this.maxPPS,", current pps = ").concat(this.scrollManager.pps)),this.maxPPS&&Math.abs(this.scrollManager.pps)>this.maxPPS)return this.log.warning("Distance Predicted, speed is too high",this.scrollManager.pps),this.model.set("isSkippedDistancePredict",!0),void this.log.predict("predict key ".concat(e,": skipping on pps"));this.log.warning("Distance Predicted, speed is OK",this.scrollManager.pps),this.log.predict("predict key ".concat(e,": predicted")),this._predicted(e)}};var B=o(84),k=o(999);const U=class extends L{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"distancePercentPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.distancePercent",this.maxPPS=this.model.get("predictors.distancePercent.maxPPS"),this.utils=M(this,this.model),this._initPredict(e)}_calcPredict(){if(!this.isPredicted){var e=B(this.model.get("scrollSelector"))[0],t=void 0!==e,i=t?e.clientHeight:window.innerHeight,s=t?i+e.scrollTop:i+window.pageYOffset,o=100/(this.predictPoint||1),n=k.getTopOfEl(this.parentSelector),r=n+this.model.get("height")/(100/this.model.get("viewPercent")||1),a=i+(r-i)/o;this.model.get("logViewabilityCalc")&&this.log.info("\ntopParentSelector: "+n+",\neligibilityPoint: "+r+",\nstartPoint: "+i+",\nbottomViewPort: "+s+",\npredictionPoint: "+a+",\ncalc: predictionPoint <= bottomViewPort: "+(a<=s)),a<=s?(this.model.set("distancePercentPredictData",{topParentSelector:n,bottomViewPort:s,eligibilityPoint:r,startPoint:i,predictionPoint:this.predictionPoint,predictKey:this.predictKey}),this.isPredicted=!0,this._onDistancePredicted(this.predictKey)):this._bindEvents()}}};const z=e=>class extends e{onScrollSpeedChangeCallback(){this.scrollManager.getPps()>this.maxPPS?this.log.predict("onScrollSpeedChangeCallback - Could not predict, scroll speed higher then maxPPS"):this._isAllowedForPredictOnScrollEnd()?(this.log.predict("onScrollSpeedChangeCallback - Predicted!"),this._predictWithPredictKey()):this.log.predict("onScrollSpeedChangeCallback - Could not predict, not eligible to play")}};var H=o(999);const W=z(class extends L{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"distancePixelsPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.distancePixels",this.maxPPS=this.model.get("predictors.distancePixels.maxPPS"),this.log.predict("predict created with key = ".concat(e.predictKey,", predict point = ").concat(e.predictPoint,", maxPPS = ").concat(this.maxPPS)),this._initPredict(e),this.model.get("".concat(this.predictPath,".isListenToScrollSpeedChange"))&&this.scrollManager.registerForPPSChange(this.onScrollSpeedChangeCallback.bind(this))}_calcPredict(){this.isPredicted||(this.isPixelsPoint=H.hasPassedPixelFromSelector(this.parentSelectorStr,this.model.get("scrollSelector"),this.predictPoint,this.model.get("predictors.isNeedValidateParentSelector")),this.isPixelsPoint?(this.model.set("distancePixelPredictData",{predictionPoint:this.predictionPoint,predictKey:this.predictKey}),this.isPredicted=!0,this.log.predict("predict key ".concat(this.predictKey,": distance from selector is lower than ").concat(this.predictPoint,"px, checking max pps")),this._predictWithPredictKey()):this._bindEvents())}_isAllowedForPredictOnScrollEnd(){return this.isPixelsPoint}_predictWithPredictKey(){this._onDistancePredicted(this.predictKey)}});var j=o(234),$=o(999);const Z=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"getAdFailPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.allowedPredictPoints="predictors.getAdFail.allowedPredictPoints",this.keysToPredict=this.model.get(this.allowedPredictPoints),this.log.predict("predict created with keys to predict ".concat(this.keysToPredict))}_bindEvents(){this.createStateHandlers([{event:"getAdState:failed",funcName:"_onFailedToGetAd"}])}_onFailedToGetAd(){var e=this.model.get("lastFailedPredict");this._shouldPredict(e)&&(this.adProperties=this.model.get("lastFailedPredictProperties"),setTimeout(this._predicted.bind(this,this.model.get("lastFailedPredict")),200))}_shouldPredict(e){var t=!1;return t=Array.isArray(this.keysToPredict)?$.contains(this.keysToPredict,e):"any"===this.keysToPredict.toString()||this.keysToPredict===e,this.log.predict("can predict key ".concat(e," = ").concat(t)),t}};const G=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"multiAdPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.multiAd",this.predictPoints="".concat(this.predictPath,".predictPoints"),this.predictKey=e.predictKey,this.predictOptions=this.model.get("".concat(this.predictPoints,".").concat(this.predictKey)),this.log.predict("predict created with key = ".concat(this.predictKey)),this.predictOptions.hasOwnProperty("secondsUntilComplete")?(this.secondsUntilAdComplete=this.predictOptions.secondsUntilComplete,this.log.predict("predict created with key = ".concat(this.predictKey,", seconds to ad complete = ").concat(this.secondsUntilAdComplete)),this._bindPredictSecondsUntilAdEnd()):this.predictOptions.hasOwnProperty("qState")&&(this.adQState=this.predictOptions.qState,this.log.predict("predict created with key = ".concat(this.predictKey,", ad quartile = ").concat(this.adQState)),this._bindPredictAdQState())}_bindPredictSecondsUntilAdEnd(){this.createStateHandlers([{event:"activeAdCurrentTime",funcName:"_checkAdTimeLeft"}])}_bindPredictAdQState(){var e=this.adQState;this.createStateHandlers([{event:"adQState:".concat(e),funcName:"_onPredictPoint"}])}_checkAdTimeLeft(){var e=this.model.get("adDuration");if(e){var t=e<this.secondsUntilAdComplete?e:this.secondsUntilAdComplete,i=this.model.get("activeAdCurrentTime");e-i<=t&&!this.timePredicted&&(this.timePredicted=!0,this.log.predict("ad duration = ".concat(e,", ad current time = ").concat(i)),this._onPredictPoint())}}_allowPredict(){var e=this.model.get("activeAdData");return!(!(this.model.get("isEligibleToPlay")&&this.model.get("isMultiAd")&&e)||e.singleAd)}_onPredictPoint(){if(this._allowPredict())return this.log.predict("allowing predict - in multi ad mode"),void this._predicted(this.predictKey);this.log.predict("disallowing predict - in single ad mode")}};const q=class extends V{constructor(e){super(e),this.startWf=e.startWfFunc,this._init()}_init(){this.initialized||(this.log=new y.Z({unitType:this.model.get("unitType"),className:"playerReadyPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.playerReady",this.predictKey=this.model.get(this.predictPath+".predictPoint"),this.predictPoint=this.predictPath+".predictPoint",this.initialized=!0,this.log.predict("predict created with key = ".concat(this.predictKey)))}_bindEvents(){!this.initialized&&this._init(),"ready"===this.model.get("playerState")?(this.log.predict("player is ready"),this._onPlayerReady()):(this.log.predict("waiting for player ready event"),this.createStateHandlers([{event:"playerState:ready",funcName:"_onPlayerReady",isListenOnce:!0}]))}_onPlayerReady(){this._predicted(this.predictKey)}};var Y=o(316),K=o(84);const Q=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"firstScrollPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.firstScroll",this.predictPoints=this.predictPath+".predictPoints",this.predictKey=this.model.get(this.predictPath+".predictPoints"),this.startWf=e.startWfFunc,this.isPredicted=!1,this.log.predict("predict created with predict key = ".concat(this.predictKey)),this.model.get("isEligibleToPlay")?(this.log.predict("eligible to play on creation, calling predict"),this._callPredict()):this._onFirstScroll()}_bindEvents(){Y.once("window:scroll:change",this._onFirstScroll.bind(this)),this.createStateHandlers([{event:"isEligibleToPlay:true",funcName:"_callPredict"}])}_onFirstScroll(){if(!this.isPredicted){var e=window.pageYOffset,t=5,i=K(this.model.get("scrollSelector"))[0];if(void 0!==i){var s=i.clientHeight;e=s+i.scrollTop,t=s+5}t<=e?(this.log.predict("scrolled more than 5px, calling predict"),this._callPredict()):this._bindEvents()}}_callPredict(){this.isPredicted||(this.isPredicted=!0,this._predicted(this.predictKey))}};const X=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"emptyQueuePredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.log.predict("predict created"),this.predictKey=this.model.get("predictors.emptyQueue.predictPoints"),this._bindEmptyQueuePredict()}_bindEvents(){}_bindEmptyQueuePredict(){this.createStateHandlers([{event:"adManagerState:".concat(j.Z.adManagerState.empty),funcName:"_onQEmpty"}])}_allowPredict(){return this.model.get("isMultiAd")}_onQEmpty(){if(this.model.get("getAdState")!==j.Z.getAdState.gettingAd)return this.log.predict("queue is empty, no get ad is process"),void this._onPredictPoint();this.log.predict("queue is empty, waiting for get ad reply")}_onPredictPoint(){if(this._allowPredict())return this.log.predict("predict allowed - in multi ad mode"),void this._predicted(this.predictKey);this.log.predict("predict disallowed - in single ad mode")}};var J=o(316);const ee=z(class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"fullEligibilityPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPoint=e.predictPoint,this.predictKey=this.model.get("predictors.fullEligibility.predictPoints"),this.predictPath="predictors.fullEligibility",this.startWf=e.startWfFunc,this.hadGetAdRv=!1,this.maxPPS=this.model.get("predictors.fullEligibility.maxPPS"),this.log.predict("predict created with key = ".concat(this.predictKey,", maxPPS = ").concat(this.maxPPS)),this.scrollManager=new x.Z,this.model.get("".concat(this.predictPath,".isListenToScrollSpeedChange"))&&this.scrollManager.registerForPPSChange(this.onScrollSpeedChangeCallback.bind(this)),this._bindEvents()}_bindEvents(){if(this.scrollManager)if(this.createStateHandlers([{event:"getAdState:".concat(j.Z.getAdState.gettingAd),funcName:"_onGettingAd",isListenOnce:!0}]),this.model.get("frameType")===S.z.FRAME_TYPE.plainPage)this.log.predict("listening to window scroll"),J.once("window:scroll:change",this._calcPredict.bind(this)),this.scrollManager.registerForScrollEnd(this._calcPredict.bind(this));else{var e=this.model.get("predictors.fullEligibility.checkPredictsSeconds");this.log.predict("checking eligibility every ".concat(e)),this.calcPredictInterval=setInterval(this._calcPredict.bind(this),1e3*e)}else this.log.predict("predict aborted, scroll manager not created")}_onGettingAd(){if(1===this.model.get("lastGetAdKey"))return this.hadGetAdRv=!0,void this.log.predict("stop predict because get ad 1 in process");this.createStateHandlers([{event:"getAdState:".concat(j.Z.getAdState.gettingAd),funcName:"_onGettingAd",isListenOnce:!0}])}_calcPredict(){this.hadGetAdRv||this.isPredicted||(this._canPredict()&&this.maxPPS&&Math.abs(this.scrollManager.pps)<this.maxPPS?(this.isPredicted=!0,this.calcPredictInterval&&(clearInterval(this.calcPredictInterval),this.calcPredictInterval=void 0),this.model.set("fullEligibilityPredicted",!0),this.log.predict("allowed due to max pps - current pps = ".concat(this.scrollManager.pps," is lower than max pps ").concat(this.maxPPS)),this._predicted(this.predictKey)):(this.log.predict("disallowed due to max pps - current pps = ".concat(this.scrollManager.pps," is higher than or equal to max pps ").concat(this.maxPPS)),J.once("window:scroll:change",this._calcPredict.bind(this))))}_canPredict(){var e=this.model.get("adState")===j.Z.adState.playing,t=this.model.get("isEligibleToPlay"),i=this.model.get("isSkippedDistancePredict"),s=t&&i&&!e;if(this.log.predict("can predict = is eligible (".concat(t,") && skipped distance predict (").concat(i,") && no other ad playing (").concat(!e,") = ").concat(s)),s&&this._checkIsGet1OnlyOnAdLoaded()){var o=this.model.get("playerHasRvInQ");s=s&&o,this.log.predict("can predict = is player having RV1 in queue = ".concat(this.model.get("playerHasRvInQ")))}return s}_isAllowedForPredictOnScrollEnd(){return this._canPredict()}_predictWithPredictKey(){this._predicted(this.predictKey)}});var te=o(999),ie=o(84);class se{constructor(e){this.model=e,this.log=new y.Z({unitType:"Util",className:"DeatchUtil",version:this.model.get("version"),isDebug:this.model.get("isDebug")})}setSliderSize(){if(this.detachToSlider=this.model.get("detachToSlider"),this.model.get("stickyCard.isActive")){var e=this.model.get("width"),t=this.model.get("height"),i=this.getStickyPosition();return this.detachToSlider.position.horizontalOffset=i.left,this.detachToSlider.position.verticalOffset=i.top,this.detachToSlider.position.horizontal="left",this.detachToSlider.position.vertical="top",this.model.set("detachToSlider.width",e),void this.model.set("detachToSlider.height",t)}this.originalSliderWidth&&(this.detachToSlider.width=this.originalSliderWidth,this.originalSliderWidth=void 0),this.originalSliderHeight&&(this.detachToSlider.height=this.originalSliderHeight,this.originalSliderHeight=void 0),this.originalSliderHeight=this.detachToSlider.height;var s=this.model.get("width"),o=this.detachToSlider.liquidSize.isActive?this.calcLiquidWidth():this.detachToSlider.width;(s>o||this.detachToSlider.liquidSize.isDisableWidthLimit)&&(s=o);var n=te.getVideoHeightByRatio(s,this.model.get("aspectRatioNum")<=1?1.77:this.model.get("aspectRatioNum"));this.model.set("detachToSlider.width",s),this.model.set("detachToSlider.height",n)}getStickyPosition(){var e=ie(this.model.get("containerViewPlaceHolder")),t=e.length?e.offset().left:0,i=this.model.get("stickyCard.offset.top")||0,s=t+(this.model.get("stickyCard.offset.left")||0);return{top:"".concat(i),left:"".concat(s)}}setSliderSizeVertical(){this.detachToSlider=this.model.get("detachToSlider");var e=te.getVideoHeight(this.model.get("width")),t=this.detachToSlider.liquidSize.isActive?this.calcLiquidHeight():this.detachToSlider.height;e>t&&(e=t);var i=te.getVideoWidthByRatio(e,this.model.get("aspectRatioNum"));this.model.set("detachToSlider.width",i),this.model.set("detachToSlider.height",e)}calcLiquidWidth(){this.detachToSlider=this.model.get("detachToSlider");var e=this.detachToSlider.liquidSize.minWidth,t=this.detachToSlider.liquidSize.maxWidth,i=window.innerWidth*(this.detachToSlider.liquidSize.widthPercent/100);return t&&i>t&&(i=t),i<e&&(i=e),i}calcLiquidHeight(){this.detachToSlider=this.model.get("detachToSlider");var e=this.detachToSlider.liquidSize.maxHeight,t=window.innerHeight*(this.detachToSlider.liquidSize.heightPercent/100);return e&&t>e&&(t=e),t}setStickParams(){var e=this.model.get("stickyCard.navBarSelector"),t=document.querySelector(e),i=this.model.get("stickyCard.offset.top");if(t){var s=t.offsetHeight||0;this.model.set("stickyCard.offset.top",i+s)}}}var oe=function(){var e;return function(t){return e||(e=new se(t)),e}}();const ne=oe;var re=o(999);const ae=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"intersectionPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPoint=e.predictPoint,this.predictKey=e.predictKey,this.isSliderOn=this.model.get("detachToSlider")&&(this.model.get("detachToSlider").isStartFromSlider||this.model.get("detachToSlider").isDetachToSlider),this.isSuperSlider=!!this.isSliderOn&&(this.model.get("detachToSlider.isStartFromSlider")&&this.model.get("detachToSlider.isDetachToSlider")),this.isAMP=this.model.get("frameType")===S.z.FRAME_TYPE.amp,this.predictPath="predictors.intersection",this.startWf=e.startWfFunc,this.utils=M(this,this.model),this.predictDelayTime=this.model.get("".concat(this.predictPath,".predictDelayTime")),this.scrollManager=new x.Z,this.maxPPS=this.model.get("".concat(this.predictPath,".maxPPS")),this.log.predict("predict created with key = ".concat(this.predictKey,", predict point = ").concat(this.predictPoint,"% view, predictDelayTime = ").concat(this.predictDelayTime)),this._setSelector()}_initObserver(){var e=[0,this.predictPoint/100];this.isAMP&&this.isSliderOn&&(this.detachUtil=ne(this.model),this.detachUtil.setSliderSize(),e=re.buildObserverThresholdList());var t={rootMargin:"0px",threshold:e};this.observer=new IntersectionObserver(this._observerCallback.bind(this),t),this.observer.observe(this.parentSelector)}_setSelector(){if(!this.isSelectorFound){var e=this.utils.getParentSelector();e?(this.isSelectorFound=!0,this.selectorTimeOut&&(clearTimeout(this.selectorTimeOut),this.selectorTimeOut=void 0),this.parentSelector=e,this.log.predict("parent selector found, starting observer"),this.log.info("parentSelector found staring to predict viewability"),this._bindEvents(),this._initObserver()):(this.log.predict("parent selector couldn't be found, trying again in 1s"),this.log.info("no parentSelector can't predict distance waiting for parentSelector"),this.model.listenToOnce(this.model,"change:parentSelector",this._setSelector.bind(this)),this.selectorTimeOut=setTimeout(this._setSelector.bind(this),1e3))}}_isIntersectingTest(e){return this.isAMP&&this.isSliderOn?e[0].intersectionRect.height>this.model.get("detachToSlider.height"):100*e[0].intersectionRatio>=this.predictPoint}_observerCallback(e,t){var i=this.scrollManager.getPps();if(!this.isPredicted){var s=this._isIntersectingTest(e);this.isSuperSlider&&this.isAMP&&s&&this.model.set("isSliderEligibleToPlay",!0),s?this._isLowerThenMaxPPS()?(this._onPrediction(),this.log.predict("intersected and predicted")):this.log.predict("intersected but can't predict - current pps (".concat(i,") is higher then maxPps (").concat(this.maxPPS,")")):this.log.predict("lost intersection")}}_isLowerThenMaxPPS(){return!this.maxPPS||Math.abs(this.scrollManager.getPps())<this.maxPPS}_onPrediction(){this.isPredicted=!0,this.log.predict("predicted"),this._predicted(this.predictKey),this.observer.disconnect()}};const de=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"timePredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.time",this.modelKey=e.modelKey?e.modelKey:e.predictKey?"".concat(this.predictPath,".predictPoints.").concat(e.predictKey):this.predictPath,this.predictKey=e.predictKey||this.model.get("".concat(this.modelKey,".predictPoints")),this.isActive=this.model.get("".concat(this.modelKey,".isActive")),this.isActive&&(this.length=1e3*this.model.get("".concat(this.modelKey,".lengthInSeconds")),this.length&&(this.repeat=this.model.get("".concat(this.modelKey,".repeat"))||1,this.log.predict("predict created with key = ".concat(this.predictKey,", length = ").concat(this.length,"ms, repeat = ").concat(this.repeat)),this._bindTimePredict(),this._startPredictTimer()))}_bindEvents(){}_bindTimePredict(){this.createStateHandlers([{event:"time:".concat(this.predictPath),funcName:"_startPredictTimer"}])}_canRepeatPredict(){return this.repeat>0}_canStartTimer(){return!this.stopped&&this._canRepeatPredict()}_startPredictTimer(){if(this._canStartTimer())return this.timer&&(this.timer=clearTimeout(this.timer)),this.log.info("Starting timer",this.predictKey),this.log.predict("repeating ".concat(this.repeat," more times")),void(this.timer=setTimeout((()=>{--this.repeat,this._predicted(this.predictKey),this._startPredictTimer()}),this.length));this.log.predict("no more repeats")}stop(){this.log.info("Timer predict stopped"),this.log.predict("stopping timer"),this.timer=clearTimeout(this.timer),this.stopped=!0}};const le=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"mp4Predict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.mp4",this.predictKey=this.model.get(this.predictPath+".predictPoint"),this.predictPoint=this.predictPath+".predictPoint",this.log.predict("predict created with key = ".concat(this.predictKey))}_bindEvents(){this.createStateHandlers([{event:"playerQueue",funcName:"_onPlayerQueueStatusChange"}])}_onPlayerQueueStatusChange(){this.adsListFromPlayer=this.model.get("playerQueue"),this._allowPredict()?(this.log.predict("found rv1 video ad in player queue, predicting"),this._predicted(this.predictKey),this.model.stopListening(this.model,"change:playerQueue")):this.log.predict("didn't find rv1 video ad in player queue, waiting for next queue change")}_allowPredict(){return this.adsListFromPlayer.filter((e=>"video"===e.mt&&!0===e.rv)).length>0}};var he=o(84);class ce extends E.O{constructor(e,t){super(e),this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:this.constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.cardsSelector=t,this.usedCards=[]}_setMinDistance(){this.minCardDistance=this.model.get("cardsMinDistance")||0;var e=he(window).height();this.minCardDistance<e&&(this.minCardDistance=e,this.model.set("cardsMinDistance",e))}getCard(e){}cancelGetCard(){}setCardAsUsed(e){this.usedCards.push(e)}_getPlaceHolders(){}_isElementBelowView(e){}}const ue=ce;var ge=o(84),me=o(999),pe=o(316);const ve=class extends ue{constructor(e,t){super(e),this.model=e,this.cardsSelector=t,this.usedCards=[],this.shouldSearchForNewCard=!0,this._setMinDistance(),this._createDecisionFuncs()}_createDecisionFuncs(){this.decisionsFuncs=[this._isNotUsedCard,this._isBelowUsedCard,this._viewPortFunc,this._isMinDistanceOk]}getCard(e,t){if(this.shouldSearchForNewCard||t){t||this.log.info("searching for card");var i=void 0;this.cb=e;for(var s=this._getPlaceHolders(),o=s.length-1;o>=0;o--)this._isCardSuitable(s[o])&&(i=s[o]);i?(this.log.info("found card: ",i),this.model.set("eligiblePlaceholder",i),this._callCardCB(e,i)):(this.shouldSearchForNewCard=!1,this._registerListeners())}}_getPlaceHolders(){var e=this.getElementsForMsnPlaceHolders();return this.model.get("msnWebComponentsEnabled")?this._getShadowDOMPlaceholders(e):this._getNonShadowDOMPlaceholders(e)}_newShadowDomDrilldown(e,t){for(var i=0;i<t.length;i++)e&&e.shadowRoot&&(e=e.shadowRoot.querySelector(t[i]));return e}_extractDrilldownArray(){return this.model.get("msnNewDomDrillDown")?this.model.get("msnNewDomDrillDown").split(","):[]}_returnArrayOfShadowRootNodes(e){return e&&e.shadowRoot&&e.shadowRoot.querySelectorAll(this.cardsSelector)?Array.prototype.slice.call(e.shadowRoot.querySelectorAll(this.cardsSelector)):ge(this.cardsSelector)}getElementsForMsnPlaceHolders(){var e=document.querySelectorAll(this.model.get("msnFeedRootSelector")),t=this._extractDrilldownArray()||[],i=[];return me.forEach(e,(e=>{var s=this._newShadowDomDrilldown(e,t);s&&s.shadowRoot?i.push(this._returnArrayOfShadowRootNodes(s)):i.push(this._returnArrayOfShadowRootNodes(e))}),this),me.flattenArray(i)}_getNonShadowDOMPlaceholders(e){var t=[];this.model.get("msnCanOpenFirstRow")?t=this._getRowPlaceHolder(1,this.model.get("msnMinimumCardInFirstRow")):this.model.get("msnCanOpenSecondRow")&&(t=this._getRowPlaceHolder(2,this.model.get("msnMinimumCardInSecondRow")));for(var i=0;i<e.length;i++)t.push(e[i]);return t}_getNewShadowDomPlaceholder(e,t){if(t||t.shadowRoot){var i=t.shadowRoot.querySelector(this.model.get("msnNewDomSecondSizeSelector"));e.push(i.parentElement)}}_getOriginalShadowDomPlaceholder(e,t){t&&t.parentElement&&e.push(t.parentElement)}_getShadowDOMPlaceholders(e){var t=[],i=this.model.get("msnSizeSelector"),s=this.model.get("msnNewDomSizeSelector");return e&&e.length&&i&&e.forEach((e=>{if(e&&e.shadowRoot){var o=e.shadowRoot.querySelector(i),n=e.shadowRoot.querySelector(s);n?this._getNewShadowDomPlaceholder(t,n):this._getOriginalShadowDomPlaceholder(t,o)}})),t}_getRowPlaceHolder(e,t){for(var i=[],s=[],o=document.querySelectorAll(this.model.get("msnUpperRowsSelector")),n=1,r=0,a=0;a<o.length&&n<=e;a++){var d=o[a],l=d.style.top&&me.convertRem(parseFloat(d.style.top));if(r!==l&&n++,n===e)!this.model.get("msnIsOpenOnSponsoredCards")&&d.querySelector(this.model.get("msnSponsoredSelector"))||s.push(d);r=l}s.length>=t&&("rtl"===document.querySelector("html").getAttribute("dir").toLowerCase()?i.push([s[1],s[0]]):i.push([s[0],s[1]]));return i}getEligiblePlaceHolders(){var e=this._getPlaceHolders()||[];return me.flattenArray(e)}_isCardSuitable(e){for(var t=0;t<this.decisionsFuncs.length;t++){var i=this.decisionsFuncs[t].bind(this),s=e;if(me.isArray(e)&&(s=e[0]),!i(s))return!1}return!0}_registerListeners(){pe.once("window:scroll:change",this._onScroll.bind(this),this)}_unRegisterListeners(){pe.off("window:scroll:change",this._onScroll.bind(this),this)}_callCardCB(e,t){this.shouldSearchForNewCard=!0,this.cb({cardToHide:me.isArray(t)?t[0]:t,additionalCard:me.isArray(t)?t[1]:void 0}),this.cb=void 0}_onScroll(){this.getCard(this.cb,!0)}setCardAsUsed(e){var t={cardEl:e,offsetTop:me.getTopOfEl(e)};me.extend(t,e.getBoundingClientRect()),t.offsetBottom=t.offsetTop+t.height,this.usedCards.push(t)}_isNotUsedCard(e){return!this.usedCards.some((t=>t.cardEl===e))}_isBelowUsedCard(e){var t=me.getTopOfEl(e);return me.every(this.usedCards,(function(e){var i=e.offsetBottom;return t>i}))}_viewPortFunc(e){return this.model.get("isOpenInViewPort")&&this._isCardInViewPort(e)||this._isElementBelowView(e)}_isCardInViewPort(e){return me.getViewPercent(e,e.offsetWidth,e.offsetHeight)>=this.model.get("cardViewPercent")}_isElementBelowView(e){return e.getBoundingClientRect().top>(window.innerHeight||document.documentElement.clientHeight)}_isMinDistanceOk(e){var t=me.getTopOfEl(e),i=this.minCardDistance;return me.every(this.usedCards,(function(e){return t-e.offsetBottom>=i}))}};var fe=o(316),be=o(999);const _e=z(class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"msnFullEligibilityPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.msnFullEligibility",this.maxPPS=this.model.get("".concat(this.predictPath,".maxPPS")),this.predictKey=this.model.get("".concat(this.predictPath,".predictPoints")),this.msnWebComponentsEnabled=this.model.get("msnWebComponentsEnabled"),this.cardLocator=new ve(this.model,this.model.get("msnSelector")),this.scrollManager=new x.Z,this.availableCardsElements=this.cardLocator.getEligiblePlaceHolders(),this.model.get("".concat(this.predictPath,".isListenToScrollSpeedChange"))&&this.scrollManager.registerForPPSChange(this.onScrollSpeedChangeCallback.bind(this)),Array.isArray(this.availableCardsElements)&&this.availableCardsElements.length&&(this.msnWebComponentsEnabled?this._observeByScroll():this._observeByObserver())}_observeByScroll(){this.onScroll=this._onScroll.bind(this),fe.on("window:scroll:change",this.onScroll)}_onScroll(){this.availableCardsElements.forEach((e=>{this.isPixelsPoint=be.hasPassedPixelFromSelector(e,void 0,this.predictPoint,!1),this.isPixelsPoint&&this._canPredict()&&this.isPixelsPoint&&this._predictWithPredictKey()}))}_observeByObserver(){this.intersectionObserver=new IntersectionObserver(this.intersectionCallback.bind(this),{root:null,threshold:1,rootMargin:"0px"}),this._observePossibleCards()}_observePossibleCards(){this.availableCardsElements.forEach((e=>{this.intersectionObserver.observe(e)}))}intersectionCallback(e,t){this.isSelectorsInViewPort=e.some((e=>e.isIntersecting)),this.isSelectorsInViewPort&&this._canPredict()&&this.isSelectorsInViewPort&&this._predictWithPredictKey()}_canPredict(){var e=this.scrollManager.getPps();if(e>this.maxPPS)return this.log.predict("Can't predict, current pps (".concat(e,") is higher then maxPps (").concat(this.maxPPS,")")),!1;var t=this.model.get("adState")===j.Z.adState.playing,i=this.model.get("isEligibleToPlay"),s=i&&!t;if(this.log.predict("can predict = is eligible (".concat(i,") && no other ad playing (").concat(!t,") = ").concat(s)),s&&this._checkIsGet1OnlyOnAdLoaded()){var o=this.model.get("playerHasRvInQ");s=s&&o,this.log.predict("can predict = is player having RV1 in queue = ".concat(this.model.get("playerHasRvInQ")))}return s}_predictWithPredictKey(){fe.off("window:scroll:change",this.onScroll),this._predicted(this.predictKey)}_isAllowedForPredictOnScrollEnd(){return this._canPredict()}});var Se=o(999);function ye(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Ae=(e,t)=>{var i;return[0,0,-1*(Se.getRequiredHeight("data-card-index",e)*+(null!==(i=e.get("predictors.feedInViewPredict.firstCardHeightRatio"))&&void 0!==i?i:1)+Se.getFeedTitleHeight()+Se.getMarginToStartCard(e,'[data-card-index="'.concat(3,'"]'),t)),0].map((e=>"".concat(e,"px"))).join(" ")};const Te=class extends V{constructor(e){super(e),ye(this,"reportToLog",(e=>t=>{this.log.debug(e(t),t)})),ye(this,"setupAdIsNotPlayingListener",(()=>{var e=()=>this.model.get("adState")!==j.Z.adState.playing;this.model.set("adIsNotPlaying",e.call(this)),this.handleAdStateChange=()=>{this.model.set("adIsNotPlaying",e.call(this)),this._reportAdStateChange(e.call(this))},this._reportAdStateChange(e.call(this)),this.model.on("change:adState",this.handleAdStateChange)})),ye(this,"setupFeedInViewObserver",(()=>{var e=e=>{this.model.set("isInView",e),this._reportFeedInView(e)};this.disconnectIntersectionObserver=function(e){var{root:t=null,threshold:i=0,rootMargin:s="0px 0px 0px 0px"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,n=new IntersectionObserver((e=>{var[{isIntersecting:t}]=e;o(t)}),{root:t,threshold:i,rootMargin:s});return n.observe(e),()=>n.disconnect()}(this.VIDEO_CONTAINER_SELECTOR,this.permanentCard?{threshold:.5}:{threshold:0,rootMargin:Ae(this.model,this.VIDEO_CONTAINER_SELECTOR)},(t=>{e(t)})),(()=>{var t=this.VIDEO_CONTAINER_SELECTOR.getBoundingClientRect().top<window.innerHeight;e(t)})()})),ye(this,"scrollHandler",(()=>{this.model.set("isNotScrolling",!1),this._reportScrolling(!0),clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((()=>{this.model.set("isNotScrolling",!0),this._reportScrolling(!1)}),1e3*(this.scrollDebouncer||1))})),ye(this,"setupScrollListener",(()=>{window.addEventListener("scroll",this.scrollHandler),this.model.set("isNotScrolling",!0),this._reportScrolling(!1)})),ye(this,"_reportFeedInView",(e=>{this.reportToLog((e=>"".concat(this.permanentCard?"Permanent card "+this.permanentCard:"Feed"," ").concat(e?"IN":"OUTSIDE"," view")))(e)})),ye(this,"_reportAdStateChange",(e=>{this.reportToLog((e=>"Ad is ".concat(e?"NOT PLAYING":"PLAYING")))(e)})),ye(this,"_reportScrolling",(e=>{this.reportToLog((e=>"User is ".concat(e?"SCROLLING":"NOT SCROLLING")))(e)}));var t=this.model;this.debounceTimeout=null,this.scrollDebouncer=this.model.get("predictors.feedInViewPredict.scrollDebounceSeconds")||.5,this.predicted=!1,this.predictPath="predictors.feedInViewPredict",this.permanentCard=t.get("permanentCard"),this.RV_LEVEL=t.get("".concat(this.predictPath,".predictPoints")),this.VIDEO_CONTAINER_SELECTOR=M(this,this.model).getParentSelector(),this.log=new y.Z({className:"feedInViewPredict",unitType:"".concat(t.get("unitType")," (").concat(t.get("subUnitType"),")"),version:t.get("version"),isDebug:t.get("isDebug")}),this.boundEvaluateCombinedConditions=this.evaluateCombinedConditions.bind(this),this.setupScrollListener(),this.setupFeedInViewObserver(),this.setupAdIsNotPlayingListener(),this._bindEvents(),setTimeout((()=>{this.evaluateCombinedConditions()}),50)}_bindEvents(){this.model.on("change:isInView",this.boundEvaluateCombinedConditions),this.model.on("change:adIsNotPlaying",this.boundEvaluateCombinedConditions),this.model.on("change:isNotScrolling",this.boundEvaluateCombinedConditions)}_unBindEvents(){this.model.off("change:isInView",this.boundEvaluateCombinedConditions),this.model.off("change:adIsNotPlaying",this.boundEvaluateCombinedConditions),this.model.off("change:adState",this.handleAdStateChange),this.model.off("change:isNotScrolling",this.boundEvaluateCombinedConditions),window.removeEventListener("scroll",this.scrollHandler)}evaluateCombinedConditions(){var e=this.model.get("isInView"),t=this.model.get("adIsNotPlaying"),i=this.model.get("isNotScrolling");e&&t&&i&&(this.log.predict("Positive prediction made"),this._predicted(this.RV_LEVEL),this.predicted=!0,this._unBindEvents(),this.disconnectIntersectionObserver())}};const we=class extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"recoReelPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPoint=e.predictPoint,this.predictKey=e.predictKey,this.predictPath="predictors.recoReel",this.scrollManager=new x.Z,this.maxPPS=this.model.get("".concat(this.predictPath,".maxPPS")),this._setElement(),this.recoReelContainer&&(this._initObserver(),this.log.predict("predict created with key = ".concat(this.predictKey,", predict point = ").concat(this.predictPoint,"% view")))}_setElement(){var e=this.model.get("recoReelContainer");e&&(this.recoReelContainer=e.parentElement)}_initObserver(){var e={rootMargin:"0px",threshold:[0,this.predictPoint/100]};this.observer=new IntersectionObserver(this._observerCallback.bind(this),e),this.observer.observe(this.recoReelContainer)}_isIntersectingTest(e){return 100*e[0].intersectionRatio>=this.predictPoint}_observerCallback(e,t){var i=this.scrollManager.getPps();this.isPredicted||(this._isIntersectingTest(e)?this._isLowerThenMaxPPS()?(this._onPrediction(),this.log.predict("intersected and predicted")):this.log.predict("intersected but can't predict - current pps (".concat(i,") is higher then maxPps (").concat(this.maxPPS,")")):this.log.predict("lost intersection"))}_isLowerThenMaxPPS(){return!this.maxPPS||Math.abs(this.scrollManager.getPps())<this.maxPPS}_onPrediction(){this.isPredicted=!0,this.log.predict("predicted"),this._predicted(this.predictKey),this.observer.disconnect()}};class Ce extends V{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"postRepeatPredictor",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.postRepeat",this.predictPoints=this.model.get("".concat(this.predictPath,".predictPoints")),this.waitBeforePredictMs=this.model.get("".concat(this.predictPath,".waitBeforePredictMs"))}_bindEvents(){super._bindEvents(),this.createStateHandlers([{event:"repeatShown",funcName:"_onRepeatShown"},{event:"repeatState:showing",funcName:"_onRepeatShown"},{event:"repeatState:clicked",funcName:"_onRepeatClicked"}])}_onRepeatShown(){this._waitBeforePredicting()}_isAllowedToPredict(){return this.model.get("isEligibleToPlay")?this.model.get("closeState")?(this.log.predict("unit is closed, ignoring"),!1):this.model.get("adState")!==j.Z.adState.playing||(this.log.predict("ad is playing"),!1):(this.log.predict("unit is not eligible to play, ignoring"),!1)}_onRepeatClicked(){this.log.predict("clear post repeat predict timeout"),this.predictTimeout&&(clearTimeout(this.predictTimeout),this.predictTimeout=null),this.log.predict("post repeat predict timeout cleared")}_waitBeforePredicting(){this.log.predict("waiting for 2 seconds before predicting"),this.predictTimeout=setTimeout((()=>{this._isAllowedToPredict()?(this.log.predict("predicting"),this._predicted(this.predictPoints),this.log.predict("predicted"),this.model.increaseCounter("postRepeatMode")):this.log.predict("Can't predict, ignoring")}),this.waitBeforePredictMs)}}var Pe=o(999);const Ee=z(class extends L{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"adxPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.adx",e.predictKey=this.model.get(this.predictPath+".predictPoint"),this._initPredict(e),this.utils=M(this,this.model),this.maxPPS=this.model.get("".concat(this.predictPath,".maxPPS")),this.predictPoint=this.model.get("".concat(this.predictPath,".pixelsFromSelectors"))||100,this.model.get("".concat(this.predictPath,".isListenToScrollSpeedChange"))&&this.scrollManager.registerForPPSChange(this.onScrollSpeedChangeCallback.bind(this)),this._bindAdxLoadEvent(),this.log.predict("predict created")}_calcPredict(){this.predicted||(this.isPixelsPoint=Pe.hasPassedPixelFromSelector(this.parentSelectorStr,this.model.get("scrollSelector"),this.predictPoint,this.model.get("predictors.isNeedValidateParentSelector")),this.isPixelsPoint?(this.predicted=!0,this.log.info("distance from selector is lower than ".concat(this.predictPoint,"px")),this._loadAdxAd()):this._bindEvents())}_bindAdxLoadEvent(){this.log.predict("listening to Adx events"),this.model.on("loadNewAdxAd",this._loadAdxAd.bind(this))}_loadAdxAd(){this.log.predict("loading new adx and pulling from queue"),this._onDistancePredicted(this.predictKey)}});var Ie=o(999);const Oe=z(class extends L{constructor(e){super(e),this.log=new y.Z({unitType:this.model.get("unitType"),className:"immediateStartPredict",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictPath="predictors.immediateStart",e.predictKey=this.model.get(this.predictPath+".predictPoint"),this._initPredict(e),this.utils=M(this,this.model),this.maxPPS=this.model.get("".concat(this.predictPath,".maxPPS")),this.predictPoint=this.model.get("".concat(this.predictPath,".pixelsFromSelectors"))||100,this.model.get("".concat(this.predictPath,".isListenToScrollSpeedChange"))&&this.scrollManager.registerForPPSChange(this.onScrollSpeedChangeCallback.bind(this)),this.log.predict("predict created")}_calcPredict(){this.isPixelsPoint=Ie.hasPassedPixelFromSelector(this.parentSelectorStr,this.model.get("scrollSelector"),this.predictPoint,this.model.get("predictors.isNeedValidateParentSelector")),this._bindEvents(),this.isPixelsPoint&&(this.log.info("distance from selector is lower than ".concat(this.predictPoint,"px")),this._loadAd())}_loadAd(){this.log.predict("loading new ad and pulling from queue"),this._onDistancePredicted(this.predictKey)}});const Ve=class{constructor(e){this.syncUrl=e.get("sync"),this.syncUrl&&(this.log=new y.Z({unitType:e.get("unitType"),className:this.constructor.name,version:e.get("version"),isDebug:e.get("isDebug")}),this.timePredict=new de({model:e,onPredict:this._syncCookies.bind(this),predictKey:"cookieSync",modelKey:"predictors.time.cookieSync"}),this._syncCookies())}_syncCookies(){this.log.info("Cookie sync request",this.syncUrl);var e=document.createElement("iframe");e.style.display="none",e.src=this.syncUrl,e.onerror=()=>{this._stopSync()},document.body.appendChild(e)}_stopSync(){this.log.info("Stopping cookie sync"),this.timePredict.stop()}};var Ne=o(207),De=o(999);class Re extends E.O{constructor(e){super(e),this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:"GDPRManager",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this._init()}_init(){var e=window.__cmp,t=S.z.UNIT_TYPES[this.model.get("unitType")],i=t===S.z.UNIT_TYPES.EXPANDABLE||t===S.z.UNIT_TYPES.EXPANDABLE_MOBILE,s=t===S.z.UNIT_TYPES["300X600"]||t===S.z.UNIT_TYPES["300X600_MOBILE"];(i||s)&&!this.model.get("isStayInIframe")&&this._isInFriendlyIframe()&&(e=De.getTopWindow().__cmp),void 0!==e?(this.model.set("hasCMPonPage",!0),e("getConsentData",null,this._getConsentDataCB.bind(this))):(this.model.set("hasCMPonPage",!1),this.model.set("canStartPlayer",!0))}_getConsentDataCB(e){var t=e.gdprApplies,i=e.consentData||"";this._setPlayerParams(t,i)}_setPlayerParams(e,t){Ne.Z.player?(Ne.Z.player.set("gdprApplies",e),Ne.Z.player.set("cdb",t)):(this.model.set("gdprApplies",e),this.model.set("consentDaisyBit",t),this.model.set("canStartPlayer",!0))}_isInFriendlyIframe(){return this._isInIframe()&&cmTag.config.iframeData.isFriendlyIframe}_isInIframe(){return cmTag.config.iframeData.inIframe||cmTag.config.iframeData.inDFP}}const Me=Re;function xe(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Fe=class{constructor(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;xe(this,"_isSendBeaconSupported",(()=>!(!navigator||"function"!=typeof navigator.sendBeacon))),this.useSendBeacon=this._isSendBeaconSupported()&&i,this.baseUrl=e,this.useSendBeacon||(this.async=null==s||s,this.withCredentials=null==o||o,this.timeout=n||5e3,this.contentType=t||"application/x-www-form-urlencoded")}_onFail(){this.gotResponse||(this.gotResponse=!0)}send(e,t){this.useSendBeacon?this._sendBeacon(e,t):this._sendXHR(e,t)}_sendBeacon(e,t){var i=void 0!==t?"?rst=".concat(t):"",s="".concat(this.baseUrl).concat(i);navigator.sendBeacon(s,e)}_sendXHR(e,t){if(this.baseUrl){var i=new XMLHttpRequest,s=void 0!==t?"?rst=".concat(t):"",o="".concat(this.baseUrl).concat(s);return i.open(e?"POST":"GET",o,!0),i.withCredentials=this.withCredentials,i.setRequestHeader("Content-type",this.contentType),i.async=this.async,i.timeout=this.timeout,i.gotResponse=!1,this._setHttpEvents(i),i.send(e),!0}return!1}_setHttpEvents(e){e.addEventListener("error",this._onFail),e.addEventListener("abort",this._onFail),e.addEventListener("timeout",this._onFail),e.addEventListener("readystatechange",(()=>{if(4==this.readyState){if(this.gotResponse)return;this.gotResponse=!0}}))}};const Le=class{constructor(){this.models={},this.data={psthdrs:"application/json",timbtopps:2e3}}setModel(e,t){this.models[e]=t}get(e,t){var i;if(t&&this.models.hasOwnProperty(e)){var s=(null===(i=this.models)||void 0===i?void 0:i[e].get(t))||void 0;return s||this._getFromData(t)}}getBillableEvents(e){return(this.get(e,"billableEvents")||[]).concat((this.get(e,"bllblevt")||"").split(",").map((e=>parseInt(e,10))))}_getFromData(e){var t=e.toString();return t.includes(".")?t.split(".").reduce(((e,t)=>e&&e[t]),this.data):this.data[t]}destroy(){[this.models,this.data]=[void 0,void 0]}};var Be=e=>e?1:0,ke=(e,t)=>{try{var i=[];return JSON.stringify(e,((e,t)=>{if(null!=t&&"object"==typeof t){if(i.indexOf(t)>-1)return;i.push(t)}return t}),t)}catch(e){return""}};const Ue={KIBANA_URL:"vidanalytics.taboola.com/putes/units-ads-analytics",SERVICES:{UNIT:"unit",PLAYER:"player"},EXTRA_PARAMS_EXCEPTIONS:["vidCurrentTime"],OPPS_PARAMETERS_MAPING:{player:{pstn:"pstn",mob:"isMobile",unv:"unit_version",unit_type:"unit_type",pv:"playerVersion",fdScore:"fdScore",abt:"ab_test",agl:"preset.level",su:"subUnitType",awr:"performance.dtsvrRoundTripAverageDuration",pm:"performance.performanceMeasurment",dtsvrRoundTripAverageDuration:"performance.dtsvrRoundTripAverageDuration",mp:"modifiedPlacement",sts:"playerRepeatCount",ft:"frameType",be:"playerHasRvInQ",pt:"ab_test",width:"width",height:"height",cmDast:"auc_dast"},unit:{pstn:"pstn",mob:"isMobile",unv:"unit_version",unit_type:"unit_type",fdScore:"fdScore",abt:"abTest",agl:"preset.level",awr:"performance.dtsvrRoundTripAverageDuration",pm:"performance.performanceMeasurment",su:"subUnitType",ft:"frameType",mp:"modifiedPlacement",vstt:"isInTab",cmDast:"cmDast",be:"playerHasRvInQ",sts:"playerRepeatCount"}},MAX_ES_STRING_LENGTH:32766};var ze=o(999);function He(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function We(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const je=class{constructor(e,t){var i=e.get("player.urls.oppsRequest")||"".concat(e.get("opps_base_path"),"/OpportunityServlet"),s=e.get("player.urls.nonBllboppsRequest")||"".concat(e.get("non_bllb_opps_base_path"),"/OpportunityServlet"),o=e.get("sendBeacon");this.opps=[],this.fireOppsInterval=null,this.stopped=!1,this.store=new Le,this.setSource(t,e),this.oppRequest=new Fe(i,this.store.get(t,"psthdrs"),o),this.nonBllbOppRequest=new Fe(s,this.store.get(t,"psthdrs"),o),this._setFireOppsInterval(t)}_activateCallbacks(e){for(var t=0;t<this[e].length;t++){var i=this[e][t];this[e].splice(this[e].indexOf(i),1),i()}}_addAbTests(e,t){return"".concat(e.requiredViewabilityDrawn?"!ronrv":"").concat(e.moatSampling?"!mtsmp":"").concat(this.store.get(t,"isReadMoreOnPage")?"!rdmr":"")}_addExtraParams(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?He(Object(i),!0).forEach((function(t){We(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):He(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},e);return Object.keys(t).forEach((e=>{Ue.EXTRA_PARAMS_EXCEPTIONS.indexOf(e)<0&&(i[e]=t[e])})),i}_addCmTagParams(e,t){var i=this.store.get(e,"oppsQS")||{};Object.assign(t,i)}_addDelayedParams(e,t,i,s){var o=this._getDelayedParams(t,i,s)||{};Object.assign(e,o)}_getDelayedParams(e,t,i){var s=Ue.OPPS_PARAMETERS_MAPING[e],o=this.store.get(e,s.width),n=this.store.get(e,s.height);return{"auc-dast":this.store.get(e,s.cmDast)||void 0,sts:i.STS||this.store.get(e,s.sts),wp:i.WP,vpd:t.pubId||i.VPD,vptd:t.tagId||i.VPTD,vmt:(t.isRon?1:0)||i.VMT||0,pt:ze.crc32(this.store.get(e,s.pt)||999),w:o||void 0,h:n||void 0,rv:t.requiredViewability}}buildOppsData(e,t,i){var s,o=Ue.OPPS_PARAMETERS_MAPING[e],{tagItem:n}=i,{lineItemStats:r}=n,a=i.extraData||{},d=i.playerParams||{},l=n.vpaidWrapperData||(n.vpaidWrapper&&n.vpaidWrapper.tag?n.vpaidWrapper.tag.vpaidWrapperData:void 0);s=e===Ue.SERVICES.UNIT?this.store.get(e,"vstt")?1:0:Be(!document.hidden);var h,c,u={tms:Date.now(),st:(h=n.rollType,c={"pre-roll":0,preroll:0,"mid-roll":-1,midroll:-1,"post-roll":-2,postroll:-2},c.hasOwnProperty(h)?c[h]:0),sts:this.store.get(e,o.sts),rs:n.sequenceId,os:1*n.waterfallTagId+1,d:(new Date).getTime()-n.created,rst:t,dast:n.vidDast||n.dast,pstn:this.store.get(e,o.pstn)||1,dp:ze.crc32(n.dp),mob:Be(this.store.get(e,o.mob)),vstt:s,unv:this.store.get(e,o.unv),unt:ze.crc32(this.store.get(e,o.unit_type)),abt:"".concat(this.store.get(e,o.abt)).concat(this._addAbTests(n,e)),frd:this.store.get(e,o.fdScore),agl:this.store.get(e,o.agl),rp:l&&l.vastPrice,mty:n.mty||l&&l.mediatype,fv_t:r&&r.tries,fv_c:r&&r.conversions,fv_f:r&&r.fails,fv_fr:r&&r.failsRow,awr:this.store.get(e,o.awr),pm:this.store.get(e,o.pm),su:this.store.get(e,o.su),pdast:i.playerDAST,extpvid:window.TRCImpl&&window.TRCImpl.external_page_view,vpd:n.pubId,vptd:n.tagId,pv:this.store.get(e,o.pv)||999,vmt:Number(n.isRon)||0,ft:this.store.get(e,o.ft),ttv:n.timeToVimp,bovpv:n.bovpv,bovpg:n.bovpg,be:this.store.get(e,o.be)?1:0,pap:void 0!==n.pap?n.pap:"",rv:n.requiredViewability,mp:this.store.get(e,o.mp),sp:i.activeData?i.activeData.sp:void 0,prdid:void 0!==i.predictorId?i.predictorId:void 0};return this._addCmTagParams(e,u),u=this._addExtraParams(u,a),this._addDelayedParams(u,e,n,d),u}send(e,t,i){if(!this.stopped){var s=this.buildOppsData(e,t,i);this._isBillableEvent(e,t)||!this.store.get(e,"cmbopps")?this.oppRequest.send(ke([s]),t):this.opps.push(s)}}_setFireOppsInterval(e){this.stopped||this.fireOppsInterval||(this.fireOpps=this._fireOpps.bind(this),this.fireOppsInterval=setInterval(this.fireOpps,this.store.get(e,"timbtopps")))}destroy(){this.stopped||(this.fireOppsInterval=clearInterval(this.fireOppsInterval),this._fireOpps(),this.stopped=!0,this.store&&this.store.destroy(),[this.store,this.fireOpps,this._destroy]=[void 0,void 0,void 0])}_fireOpps(){this.stopped||(this.opps.length>0&&this.nonBllbOppRequest.send(ke(this.opps)),this.opps=[])}_isBillableEvent(e,t){return this.store.getBillableEvents(e).indexOf(parseInt(t,10))>-1}setSource(e,t){this.store&&this.store.setModel(e,t)}};class $e extends E.O{constructor(e){super(e.model),this.model=e.model,this.log=new y.Z({unitType:this.model.get("unitType"),className:"OppsulaManager",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.oppsArr=[],this._loadOppsula()}_loadOppsula(){this.oppsula=new je(this.model,"unit"),this._sendOppsFromArr()}send(e,t){this.oppsula.send("unit",t,e)}_sendOppsFromArr(){this.oppsArr.splice(0).forEach((e=>this.send(...e)))}}var Ze=function(){var e;return function(t){return e||(e=new $e(t)),e}}();const Ge=Ze;var qe=o(84),Ye=o(999),Ke=o(316);class Qe{constructor(e,t,i){this.window=e||window,this.conf=t,this.$window=qe(window),this.windowHeight=this.$window.height(),this.windowWidth=this.$window.width(),this.setScrollableSelector(i),this._timeBetweenEvents=100,this.keyPressMap={17:!1,18:!1,84:!1,86:!1},this._setScrollListener(),this._setMouseMoveListener(),this._setTabViewListener(),this._setOrientationChangeListener(),this._setResizeListener(),this._setTaboolaReadMoreListener()}_setScrollListener(){var e=Ye.throttle(this._trigger.bind(this,"window:scroll:change"),this._timeBetweenEvents);this.scrollSelector.addEventListener("scroll",e)}_setMouseMoveListener(){var e=Ye.throttle(this._trigger.bind(this,"window:mouse:move"),this._timeBetweenEvents);this.window.addEventListener("mousemove",e)}_setOrientationChangeListener(){var e=Ye.throttle(this._trigger.bind(this,"window:orientation:change"),this._timeBetweenEvents);window.addEventListener("orientationchange",e)}_setResizeListener(){var e=Ye.throttle(this._handleResizeEvent.bind(this),this._timeBetweenEvents);window.addEventListener("resize",e)}_setTabViewListener(){this.isTabOut="hidden"===document.visibilityState,this.window.document.addEventListener("visibilitychange",this._handleVisibilityChange.bind(this)),this.window.addEventListener("focus",this._handleTabEvents.bind(this),!0),this.window.addEventListener("blur",this._handleTabEvents.bind(this),!0),this._shouldUsePageEventsForTabStatus()&&(this.window.addEventListener("pageshow",this._handleTabEvents.bind(this),!0),this.window.addEventListener("pagehide",this._handleTabEvents.bind(this),!0))}_shouldUsePageEventsForTabStatus(){return this.conf.usePageEventsForTabStatus&&!0===this.conf.isMobile}_handleResizeEvent(e){var t=this.$window.height(),i=t-this.windowHeight;this.windowHeight=t;var s=this.$window.width(),o=s-this.windowWidth;this.windowWidth=s,this._trigger("window:resize:change",{heightChange:i,widthChange:o})}_handleVisibilityChange(e){this.isTabOut="hidden"===document.visibilityState,this._handleTabEvents(e)}_handleTabEvents(e){this._trigger("window:tab:change",this._getTabState(e.type))}_getTabState(e){return this.isTabOut?S.z.TAB_STATE.tabOut:"focus"===e||"pageshow"===e?S.z.TAB_STATE.focus:S.z.TAB_STATE.blur}_trigger(e,t){Ke.trigger(e,t)}_setTaboolaReadMoreListener(){window._taboola=window._taboola||[],_taboola.push({listenTo:"readmore.click",handler:function(){Ke&&Ke.trigger("taboola:readmore:click")}})}setScrollableSelector(e){this.scrollSelector="document"===e?document:Ye.isEmpty(e)?this.window:qe(e)[0]}}var Xe=function(){var e;return function(t,i,s){return e||(e=new Qe(t,i,s)),e}}();const Je=Xe;var et={atr:{},platform:{Desktop:{atr:{}},Mobile:{atr:{secondsBW:20}}}},tt={demo:{strength:101,atr:{},1:{atr:{originId:15,"preroll.pubId":133128,"preroll.pubTagId":779408,"midroll.pubId":133128,"midroll.pubTagId":779408,"postroll.pubId":133128,"postroll.pubTagId":779408,pubId:133128,pubTagId:779408,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1,mntmbtwfs:999,mintimwf:999e3,mxtmbtwfs:999,time_between_waterfall:999,frrst1aftrrst93:!1,rmvrvlwntwrk:!1}},onOutOfView:"pause",isPWOV:!1,noaop:1}},2:{atr:{isDebug:!0,originId:15,"preroll.pubId":133128,"preroll.pubTagId":779408,"midroll.pubId":133128,"midroll.pubTagId":779408,"postroll.pubId":133128,"postroll.pubTagId":779408,pubId:133128,pubTagId:779408,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1}},onOutOfView:"pause"}},3:{atr:{isDebug:!0,originId:15,"preroll.pubId":133128,"preroll.pubTagId":1184655,"midroll.pubId":133128,"midroll.pubTagId":1184655,"postroll.pubId":133128,"postroll.pubTagId":1184655,pubId:133128,pubTagId:1184655,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1}},isPWOV:!1}},4:{atr:{isDebug:!0,originId:15,"preroll.pubId":133128,"preroll.pubTagId":1046821,"midroll.pubId":133128,"midroll.pubTagId":1046821,"postroll.pubId":133128,"postroll.pubTagId":1046821,pubId:133128,pubTagId:1046821,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1}},onOutOfView:"pause"}},5:{atr:{originId:15,"preroll.pubId":133128,"preroll.pubTagId":1633025,"midroll.pubId":133128,"midroll.pubTagId":1633025,"postroll.pubId":133128,"postroll.pubTagId":1633025,pubId:133128,pubTagId:1633025,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1}},onOutOfView:"pause",isPWOV:!1}}},level:{strength:1,atr:{},101:{atr:{pubId:165757,pubTagId:946347,preroll:{pubId:165757,pubTagId:946347},midroll:{pubId:165757,pubTagId:946347},postroll:{pubId:165757,pubTagId:946347}}},2:{atr:{secondsToClose:120,secondsBW:20}},3:{atr:{secondsToClose:120,pubId:208401,pubTagId:1047981,preroll:{pubId:208401,pubTagId:1047981},midroll:{pubId:208401,pubTagId:1047981},postroll:{pubId:208401,pubTagId:1047981}},units:{FEED_MANAGER:et,INLINE_INSTREAM_OLD:et,INLINE_INSTREAM_VFORCE:et,SLIDER_INSTREAM:et,SLIDER_OUTSTREAM:et,WIDGET_ITEM:et}},4:{atr:{pubId:292045,pubTagId:1565025,preroll:{pubId:292045,pubTagId:1565025},midroll:{pubId:292045,pubTagId:1565025},postroll:{pubId:292045,pubTagId:1565025}}},5:{atr:{pubId:383725,pubTagId:2077655,preroll:{pubId:383725,pubTagId:2077655},midroll:{pubId:383725,pubTagId:2077655},postroll:{pubId:383725,pubTagId:2077655}}}},isFireAllPixels:{strength:101,atr:{},1:{atr:{pixels:{startWithABT:{isFire:!0},getAdAny:{isFire:!0},getAdNoRV:{isFire:!0},getAd:{isFire:!0},secondsToCloseTimer:{isFire:!0},secondsToCloseGlobalTimer:{isFire:!0},midrollCollapseTimer:{isFire:!0}}}},2:{atr:{pixels:{getAdAny:{isFire:!0},getAdNoRV:{isFire:!0},getAd:{isFire:!0}}}}},predictorsPresets:{strength:101,1:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q1"}}},playerReady:{isActive:!0,predictPoint:0},distancePixels:{isActive:!0,predictPoints:{1:{pixelsFromSelectors:10}}}}}},2:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q0"}}},playerReady:{isActive:!1},distancePixels:{isActive:!0,predictPoints:{1:{pixelsFromSelectors:10}}},firstScroll:{isActive:!0,predictPoints:[0,0]}}}},3:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q0"}}},playerReady:{isActive:!0,predictPoint:0},distancePixels:{isActive:!1},firstScroll:{isActive:!1}}}},4:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q1"}}},playerReady:{isActive:!0,predictPoint:0},distancePixels:{isActive:!1},firstScroll:{isActive:!1}}}},5:{atr:{predictors:{multiAd:{isActive:!1},playerReady:{isActive:!0,predictPoint:0},distancePixels:{isActive:!1},firstScroll:{isActive:!1}}}},99:{atr:{predictors:{autoKill:{isActive:!1},getAdFail:{isActive:!1},multiAd:{isActive:!1},playerReady:{isActive:!1},distancePercent:{isActive:!1},distancePixels:{isActive:!1},firstScroll:{isActive:!1}}}},101:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q1"}}},playerReady:{isActive:!0,predictPoint:0},distancePixels:{isActive:!0,predictPoints:{1:{pixelsFromSelectors:10}}}}}}},isDebug:{strength:102,1:{atr:{player:{settings:{encwfrs:!1}}}}}},it=o(999);class st{constructor(e){this.opions=e}getPreset(e){var t=e.key,i=e.value,s=e.unitType,o=e.platform;if(tt[t]&&tt[t][i]){var n=tt[t],r=tt[t].strength||1,a=tt[t].atr||{};return a=it.extend(a,n[i].atr),n[i]&&n[i].units&&(a=this._getFromUnits(a,n[i].units,s,o)||a),{presetData:a,strength:r}}}_getFromUnits(e,t,i,s){if(t[i]){var o=t[i].atr||{};return e=it.extend(e,o),t[i].platform&&(e=this._getByPlatform(e,t[i].platform,s)||e),e}}_getByPlatform(e,t,i){if(t[i]){var s=t[i].atr||{};return e=it.extend(e,s)}}}var ot=null,nt=e=>/\{\s*\[native code\]\s*\}/.test(""+e);const rt=new class{constructor(){return ot||(ot=this),ot}set(e,t,i){nt(window[e])&&nt(window[e].prototype[t])||(this.iframe||this.createIframe(),this.iframe.contentWindow[e].prototype[t]&&(window[e].prototype||(window[e]=function(){}),window[e].prototype[t]=this.iframe.contentWindow[e].prototype[t],i&&(window[e]=this.iframe.contentWindow[e])))}setWindowFunctions(e){e&&(this.iframe||this.createIframe(),e.split(",").forEach(function(e){var t=e.split(".");this.setWindowNestedFunctions(window,t)}.bind(this)))}createIframe(){this.iframe=document.createElement("iframe"),this.iframe.style.width=0,this.iframe.style.height=0,this.iframe.style.visibility="hidden",this.iframe.style.display="none",document.body.appendChild(this.iframe)}setWindowNestedFunctions(e,t){var i=t.shift();0==t.length?e[i]=this.iframe.contentWindow[i]:this.setWindowNestedFunctions(e[i],t)}};const at=class{constructor(){this.arrayFrom()}arrayFrom(){var e,t,i,s;Array.from||(Array.from=(e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},i=Math.pow(2,53)-1,s=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),i)},function(e){var i=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var o,n=arguments.length>1?arguments[1]:void 0;if(void 0!==n){if(!t(n))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(o=arguments[2])}for(var r,a=s(i.length),d=t(this)?Object(new this(a)):new Array(a),l=0;l<a;)r=i[l],d[l]=n?void 0===o?n(r,l):n.call(o,r,l):r,l+=1;return d.length=a,d}))}};var dt=o(999),lt={init:function(e){dt.trcPerformanceMeasurement(e.trcPerformanceMeasurementEnabled,"videoBeforeCMTagNativeCode",S.z.TRC_PERFORMANCE_ACTIONS.START),rt.set("Function","bind"),rt.set("Event","constructor",!0),rt.set("Array","forEach",!1),rt.set("Array","every",!1),rt.setWindowFunctions(e.nativeFunctions),dt.trcPerformanceMeasurement(e.trcPerformanceMeasurementEnabled,"videoBeforeCMTagNativeCode",S.z.TRC_PERFORMANCE_ACTIONS.STOP),new at,window.cmTag.customDataForTest={startWithABT:!1},!!e.gaFactor&&dt.isFactor(parseInt(e.gaFactor))&&window.addEventListener("error",(function(t){try{if(-1==t.filename.indexOf("infra/cmTag"))return;var i={timestamp:(new Date).toISOString(),message:t.message,lineNum:t.lineno,fullUrl:window.location.href,userAgent:window.navigator.userAgent,firedStartWithABT:window.cmTag.customDataForTest.startWithABT,unitType:e.unitType};t.error&&(i.callStack=t.error.stack);var s=new XMLHttpRequest;s.open("POST","//vidanalytics.taboola.com/putes/cm_units_error_logs",!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded");var o=JSON.stringify(i);s.send(o)}catch(t){}}))}};class ht{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return window.cmTag.autoPlayDetectorInstance?(window.cmTag.autoPlayDetectorInstance.callbacks.push(e),window.cmTag.autoPlayDetectorInstance.safelyRunCallbacks()):(this.isMobile=t.isMobile,this.src=t.src,this.timeout=t.timeout||250,this.autoPlaySupport={unmuted:!1},this.unmutedVideo=this.creatVideo(),this.callbacks=[e],this.testVideo(this.unmutedVideo),window.cmTag.autoPlayDetectorInstance=this),window.cmTag.autoPlayDetectorInstance}creatVideo(){var e=document.createElement("video");return e.tbData={isMuted:!1},this.setVideoAttributes(e),this.setVideoStyle(e),this.isMobile&&document.body.appendChild(e),e}setVideoAttributes(e){e.src=this.src,e.type="video/mp4",e.setAttribute("playsinline",!0)}setVideoStyle(e){e.style.left="0",e.style.top="0",e.style.height="0px",e.style.width="0px",e.style.position="absolute",e.style.display="none"}testVideo(e){e.tbData.timeupdateHandler=this.handleSupported.bind(this,e),e.addEventListener("timeupdate",e.tbData.timeupdateHandler),e.tbData.timeout=setTimeout(this.handleNotSupported.bind(this,e,"no promise - timeout"),this.timeout);var t=e.tbData.promise=e.play();void 0===t||e.tbData.isResolved||t.then((()=>{this.handleSupported(e)})).catch((t=>{this.handleNotSupported(e,t.message)}))}handleSupported(e){e.tbData.isResolved||(e.tbData.isMuted===e.muted?(this.handleResolved(e),this.autoPlaySupport.unmuted={supported:!0},this.safelyRunCallbacks()):this.handleNotSupported(e,"Muted by browser"))}handleNotSupported(e,t){e.tbData.isResolved||(this.handleResolved(e),this.autoPlaySupport.unmuted={supported:!1,error:t},this.safelyRunCallbacks())}handleResolved(e){e.tbData.isResolved=!0,this.removeTimeupdateEventListener(e),clearTimeout(e.tbData.timeout)}removeTimeupdateEventListener(e){e.removeEventListener("timeupdate",e.tbData.timeupdateHandler),e.tbData.timeupdateHandler=void 0,delete e.tbData.timeupdateHandler}safelyRunCallbacks(){this.supportIsKnown()&&(this.callbacks.map((e=>{e(this.autoPlaySupport)})),this.callbacks=[])}supportIsKnown(){return this.autoPlaySupport.unmuted}}var ct=o(316),ut=o(999);const gt=class{constructor(e){this.callBacks={},this.model=e,this._mapCallbackNames(),this._setCallbacks()}_setCallbacks(){this._isValidCallback(this.callbackNames.conversion)&&(this.callBacks.onConversion=this._getCallbackFromModel("onConversion"),ct.on("global:creativeEvent",this._onGlobalCreativeEvent.bind(this,this.callbackNames.conversion))),this._isValidCallback(this.callbackNames.fill)&&(this.callBacks.onFilledImpression=this._getCallbackFromModel("onFilledImpression"),ct.on("filledImpression",this._onGlobalCreativeEvent.bind(this,this.callbackNames.fill))),this._isValidCallback(this.callbackNames.impression)&&(this.callBacks.onImpression=this._getCallbackFromModel("onImpression"),ct.on("onImpression",this._onGlobalCreativeEvent.bind(this,this.callbackNames.impression))),this._isValidCallback(this.callbackNames.play)&&(this.callBacks.onPlay=this._getCallbackFromModel("onPlay"),ct.on("global:adState:playing",this._onGlobalCreativeEvent.bind(this,this.callbackNames.play))),this._isValidCallback(this.callbackNames.terminate)&&(this.callBacks.onTerminate=this._getCallbackFromModel("onTerminate"),ct.once("global:closeState:changed",this._onGlobalCreativeEvent.bind(this,this.callbackNames.terminate))),this._isValidCallback(this.callbackNames.passback)&&(this.callBacks.onPassback=this._getCallbackFromModel("onPassback"),ct.once("global:passback",this._onGlobalCreativeEvent.bind(this,this.callbackNames.passback)))}_getCallbackFromModel(e){return this.model[e]||this.model.get(e)}_onGlobalCreativeEvent(e,t){e=e||{},this.callBacks[e.type]&&this.callBacks[e.type](t),e.name&&ut.dispatchTRC("api::video."+e.name,this.model)}_isValidCallback(e){var t=this._getCallbackFromModel(e.type);if("string"==typeof t){var i=this._getCallbackFunction(t);t=new Function("additionalData",i),delete this.model[e.type],delete this.model.attributes[e.type],Object.defineProperty(this.model,e.type,{value:t})}return!(!ut.isFunction(t)&&!this._isApiCallbackExist(e.name))}_getCallbackFunction(e){var t=e.substr(e.indexOf("{")+1);return t.substr(0,t.lastIndexOf("}"))}_isApiCallbackExist(e){if(TRC&&TRC._taboolaClone)for(var t=0;t<TRC._taboolaClone.length;t++)if(TRC._taboolaClone[t].listenTo=="video."+e)return!0;return!1}_mapCallbackNames(){this.callbackNames={conversion:{type:"onConversion",name:"conversion"},fill:{type:"onFilledImpression",name:"fill"},impression:{type:"onImpression",name:"impression"},play:{type:"onPlay",name:"play"},terminate:{type:"onTerminate",name:"terminate"},passback:{type:"onPassback",name:"passback"}}}};var mt=o(999);cmTag.multiUnitManager=cmTag.multiUnitManager||new class{addUnit(e,t){mt.isEmpty(window.TRC.videoUnitList)&&(window.TRC.videoUnitList={}),this.unitsList=window.TRC.videoUnitList||{},this.unitsList[e]=t,window.TRC.videoUnitList=this.unitsList,this._listenUnitsEvents(e)}_listenUnitsEvents(e){this.unitsList[e].on("change:isUnitEligible",this._onUnitEligibilityChange.bind(this,e))}_onUnitEligibilityChange(e,t,i){mt.size(this.unitsList)>1&&(!0===i||!1===i)&&this._decidePlayOrPause()}_decidePlayOrPause(){var e=[];mt.each(this.unitsList,(t=>{var i=t.get("redId"),s="CUSTOM"==this._getUnitType(i);this._isUnitEligibleToPlay(i)?e.push({redId:i,viewPercent:t.get("unitViewablePercent"),isCustomVideo:s}):s&&this._pauseUnit(i)})),e.length>0&&(e=this._sortViewableUnits(e),mt.each(e,((e,t)=>{0===t?this._playUnit(e.redId):e.isCustomVideo&&this._pauseUnit(e.redId)})))}_sortViewableUnits(e){return e.sort(((e,t)=>e.isCustomVideo===t.isCustomVideo?t.viewPercent-e.viewPercent:!e.isCustomVideo&&t.isCustomVideo?-1:1))}_pauseUnit(e){this.unitsList[e].set("multiUnitManager.state","pause")}_playUnit(e){this.unitsList[e].set("multiUnitManager.state","play")}_isUnitEligibleToPlay(e){return this.unitsList[e].get("isEligibleToPlay")||this.unitsList[e].get("isUnitEligible")||this.unitsList[e].get("isUnitViewable")}_isUnitAllowToPlay(e){return"pause"!=this.unitsList[e].get("multiUnitManager.state")&&this._isUnitEligibleToPlay(e)}_isUnitPlaying(e){return this.unitsList[e].get("generalPlayingUnitState")}_getUnitType(e){return this.unitsList[e].get("unitType")}};const pt=cmTag.multiUnitManager;var vt=o(120);class ft{constructor(e){this.logsMap=[],this.elasticLogger=e.model.get("elasticLogger")}log(e,t){try{if(!this.elasticLogger.isSendingDataToElastic())return;this.logsMap.includes(e)||(this.logsMap.push(e),this.elasticLogger.log({message:"usage:unit:"+e,severity:vt.b.INFO,extraData:t}))}catch(e){}}}var bt=o(999),_t=o(316),St=o(84);function yt(e,t,i){var s,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!1;lt.init(e);var r,a,d,l={unit:void 0,model:void 0,placement:void 0,isUnitPlay:!1},h=new y.Z({unitType:e.unitType,className:"cmTagMainBase",version:e.version,isDebug:e.isDebug});function c(){s=function(i,s){bt.trcPerformanceMeasurement(s.trcPerformanceMeasurementEnabled,"videoCreateUnitModel".concat(s.perfUnitType),S.z.TRC_PERFORMANCE_ACTIONS.START);var o=new _t.DeepModel;o.set(s),t&&t._settings&&(h.info("settings by FPP",t._settings),o.set(t._settings));!function(e){if(e.onPassback)return void(e.isApiPassbackExist=!0);if(TRC&&TRC._taboolaClone)for(var t=0;t<TRC._taboolaClone.length;t++)if("video.passback"==TRC._taboolaClone[t].listenTo)return void(e.isApiPassbackExist=!0);e.isApiPassbackExist=!1}(o.attributes);var n=new i(o.attributes);new gt(n);if(bt.parseBool(e.isUseCMP))new Me(n);else n.set("canStartPlayer",!0);return function(e){var t=new vt.S({model:e});e.set("elasticLogger",t,{},!1)}(n),function(e){var t=new ft({model:e});e.set("codeUsageLogger",t,{},!1)}(n),function(e){var t={model:e};Ne.Z.oppsula=new Ge(t)}(n),function(e){if(!e.get("isVideoAutoplayDetectorEnabled"))return;Ne.Z.autoPlayDetector=new ht(e.handleAutoPlayData.bind(e),{isMobile:e.get("isMobile"),timeout:1e3*e.get("autoplayDetectorTimeoutSec"),src:e.get("player.urls.blankLocation").replace(/{{(.+?)}}/g,((t,i)=>e.get(i)))})}(n),bt.trcPerformanceMeasurement(s.trcPerformanceMeasurementEnabled,"videoCreateUnitModel".concat(s.perfUnitType),S.z.TRC_PERFORMANCE_ACTIONS.STOP),n}(i.model,e),bt.defer(u.bind(this,i.unitController,s,void 0,o))}function u(t,i,s,o){bt.parseBool(e.isWaitForStartEvent)?(l.unit=t,l.model=i,l.placement=s,l.isUnitPlay=o,i.fireUnitDelayedPixel(),window.TRC=window.TRC||{},window.TRCImpl=window.TRCImpl||{},window.TRC.videoFunctions={},window.TRC.videoFunctions.startEvent=function(){n||(l.model.fireUnitLoadAfterDelayPixel(),g(l.unit,l.model,l.placement,l.isUnitPlay),n=!0)}):g(t,i,s,o)}function g(e,i,s,o){var n=new e({model:i,placementElement:s});o&&(t.play=n.play.bind(n))}function m(){window.TRC=window.TRC||{},_t.$=St,bt.templateSettings={interpolate:/\{\{(.+?)\}\}/g},h.info("init",e),cmTag.utils=bt,cmTag.$=St,t&&(t._events&&(t._events.forEach((function(e){_t.on(e.name,e.cb)})),t.on=function(e,t){_t.on(e,t)}),t.trigger=function(e,t){_t.trigger(e,t)}),cmTag.config||(cmTag.config=e)}function p(){h.info("PMS Loaded"),Ne.Z.pms=new st,function(){var t,i;if(e.perfUnitType=(t=e.unitType,i=t.replace(/_/g,"").toLowerCase(),"".concat(i.charAt(0).toUpperCase()).concat(i.substring(1))),bt.trcPerformanceMeasurement(e.trcPerformanceMeasurementEnabled,"videoInitToRender".concat(e.perfUnitType),S.z.TRC_PERFORMANCE_ACTIONS.START),e.unitName=e.cm_unitName?e.cm_unitName:e.unitType,e.urlPrefix){var o=e.urlPrefix.split("/");e.unitVersion=o[o.length-2],e.unitVersion=e.unitVersion.replace(/_/g,"")}else e.unitVersion=e.version.replace(/_/g,"");c(),s.get("multiUnitManager.isActive")&&pt.addUnit(s.get("redId"),s),s.get("cookieMatchActive")&&new Ve(s)}(),cmTag.units=cmTag.units||{},cmTag.units[bt.now()]=e}r=e.isStartUnitOnWindowLoaded,a=function(){m();var t=function(){var t=window;return bt.isInFriendlyIframe(cmTag.config.iframeData)&&(t=bt.getTopWindow()),e.isHideIframe&&bt.hideDFPIframe(e.iframeData),t}();!function(t){var{config:i={}}=cmTag,{scrollSelector:s}=i;new x.Z(e,t,s)}(t),function(t){var{config:i={}}=cmTag,{scrollSelector:s}=i;new Je(t,e,s)}(t),bt.setConfig(e),function(){bt.defer(p.bind(this))}()},d=r?window:document,"loading"!=document.readyState?a():d.addEventListener("DOMContentLoaded",a)}const At=class{constructor(e,t,i,s){this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:"timerService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.doneFunction=i||function(){},this.time=s||0,this.conditions=t||{startCondition:{stateToListen:"",state:""},pauseCondition:{stateToListen:"",state:""},continueCondition:{stateToListen:"",state:""},stopCondition:{stateToListen:"",state:""},isStartOnce:!1},this._startListeningToConditions(),this.timerState=j.Z.readyState}_startListeningToConditions(){this.conditions.startCondition&&(this.conditions.isStartOnce?this.model.listenToOnce(this.model,"change:"+this.conditions.startCondition.state,this.start.bind(this)):this.model.listenTo(this.model,"change:"+this.conditions.startCondition.state,this.start.bind(this))),this.conditions.pauseCondition&&this.model.listenTo(this.model,"change:"+this.conditions.pauseCondition.state,this.pause.bind(this)),this.conditions.continueCondition&&this.model.listenTo(this.model,"change:"+this.conditions.continueCondition.state,this.continue.bind(this)),this.conditions.stopCondition&&this.model.listenTo(this.model,"change:"+this.conditions.stopCondition.state,this.stop.bind(this))}start(e,t){this.conditions.startCondition.stateToListen!==t&&"any"!==this.conditions.startCondition.stateToListen||(this.timerState=j.Z.timerState.working,this.stTime=(new Date).valueOf(),this.timeout=setTimeout(this.done.bind(this),this.time),this.timeLeft=this.time)}pause(e,t){if(this.timerState===j.Z.timerState.working&&(!t||this.conditions.pauseCondition.stateToListen===t)){this.timerState=j.Z.timerState.paused,this._clearTimer();var i=(new Date).valueOf()-this.stTime;this.timeLeft-=i}}continue(e,t){this.timerState===j.Z.timerState.paused&&(!t||t&&this.conditions.continueCondition.stateToListen===t)&&(this.timerState=j.Z.timerState.working,this.timeout=setTimeout(this.done.bind(this),this.timeLeft),this.stTime=(new Date).valueOf())}stop(e,t,i,s){this.timeout&&(s||this.conditions.stopCondition.stateToListen===t)&&(this.timerState=j.Z.timerState.stopped,this._clearTimer())}done(){this.timerState=j.Z.timerState.done,this.doneFunction(),this.timeout=void 0}getTimerState(){return this.timerState}_clearTimer(){clearTimeout(this.timeout),this.timeout=void 0}isTimerActive(){return this.timerState===j.Z.timerState.working||this.timerState===j.Z.timerState.paused}};var Tt=o(84),wt=".tbl-read-more-box";class Ct extends E.O{constructor(e){super(),this.model=e.model,this.log=new y.Z({unitType:this.model.get("unitType"),className:this.constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.model.set("readMoreIsVisible",!1),this._initObserver()}_bindEvents(){TRC.listen("readMoreClicked",this._clearObservers.bind(this)),this.createStateHandlers([{event:"impressionCount:1",funcName:"_observerCallback",isListenOnce:!0}])}_initObserver(){var e=Tt(".tbl-read-more-btn")[0]||Tt(wt)[0],t={rootMargin:(this.model.get("readMoreObserver.observerMargin")||"10")+"px",threshold:0},i=Tt(wt)[0].getBoundingClientRect();this._isReadMoreInitiallyInViewport(i)?this.model.set("readMoreIsInitiallyInViewport",!0):this._unitIsAboveReadMore(i)||(this._bindEvents(),this.readMoreObserver=e&&new IntersectionObserver(this._observerCallback.bind(this),t),this.readMoreObserver&&this.readMoreObserver.observe(e))}_observerCallback(e){e[0]&&e[0].isIntersecting?(this.model.set("hasImpBeforeReadMoreViewable",!1),this.model.set("isReadMoreInViewport",!0),window.TRC.listen("readMoreClicked",(()=>this._onReadMoreClick()))):this.model.get("impressionCount")>0&&void 0===this.model.get("hasImpBeforeReadMoreViewable")&&this.model.set("hasImpBeforeReadMoreViewable",!0)}_onReadMoreClick(){this.model.set("readMoreClicked",!0),this.model.set("isReadMoreInViewport",!1),this._clearObservers()}_clearObservers(){this.readMoreObserver&&this.readMoreObserver.disconnect()}_isReadMoreInitiallyInViewport(e){return!!e&&(e.top>=0&&e.left>=0&&e.bottom<=window.innerHeight&&e.right<=window.innerWidth)}_unitIsAboveReadMore(e){var t=this.model.get("parentSelector"),i=t&&Tt(t)[0],s=i&&i.getBoundingClientRect();return!s||!e||s.bottom<=e.top}}const Pt=Ct;var Et=o(999),It=o(316),Ot=o(84);class Vt extends E.O{constructor(e){super(e),this.model=e.model,this.model.get("msnWebComponentsEnabled")||this.model.set("height",Et.getVideoHeight(this.model.get("width"))),this.log=new y.Z({unitType:this.model.get("unitType"),className:this.constructor.name||"UnitController",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.containerView=void 0,this.videoView=void 0,this.adService=void 0,this.playerService=void 0,this.isClosedByUser=!1,this.createStateHandlers([{event:"closeState",funcName:"handleCloseState"},{event:"topParentSelectorLost:true",funcName:"_onParentSelectorLost"}]),this.model.listenTo(this.model,"ad:stoppedByUser",this.terminate.bind(this,!0)),this.model.get("placementOffsetValidation.isActive")&&this.createStateHandlers([{event:"isEligibleToPlay:false",funcName:"_checkPlacementPositionChange"}]),"undefined"!=typeof TRC&&TRC.listen&&TRC.listen("trcReset",this._onTRCReset.bind(this)),this._createTimers(),this._handleMidArticleReadMore()}_createTimers(){if(this.model.get("isMultiAd")&&this.model.get("midrollTimeout")>0){var e={startCondition:{stateToListen:j.Z.adManagerState.empty,state:"adManagerState"},stopCondition:{stateToListen:j.Z.adManagerState.hasAds,state:"adManagerState"}};this.getAdTimer=new At(this.model,e,this.terminate.bind(this,!1,"midrollCollapse"),1e3*this.model.get("midrollTimeout"))}else if(this.model.get("isMultiAd")&&this.model.get("secondsToCloseFeed")>0){var t={startCondition:{stateToListen:j.Z.adManagerState.empty,state:"adManagerState"},stopCondition:{stateToListen:j.Z.adManagerState.hasAds,state:"adManagerState"}};this.getAdTimer=new At(this.model,t,this.pause.bind(this,"midrollCollapse"),1e3*this.model.get("secondsToCloseFeed"))}var i=this.model.get("secondsToClose");if(i>0){var s={startCondition:{stateToListen:!0,state:"firstGetAdFired"},stopCondition:{stateToListen:j.Z.adQState.impression,state:"adQState"},isStartOnce:!0};this.secondsToCloseTimer=new At(this.model,s,this.terminate.bind(this,!1,"secondsToClose"),1e3*i)}var o=this.model.get("secondsToCloseGlobal");if(o>0){var n={startCondition:{stateToListen:"",state:""}};"showReplay"===this.model.get("onTimerClose")?this.secondsToCloseGlobalTimer=new At(this.model,n,this.pause.bind(this,"secondsToCloseGlobal"),1e3*this.model.get("secondsToCloseGlobal")):this.secondsToCloseGlobalTimer=new At(this.model,n,this.terminate.bind(this,!1,"secondsToCloseGlobal"),1e3*o),this.secondsToCloseGlobalTimer.start(this.model,"")}this._createSecondsToPassbackTimer()}terminate(e,t){this.log.info("Terminate reason: "+t),this.isClosedByUser=e,this._setTimerReason(t),this.model.set("closeState",j.Z.closeState.terminate)}_setTimerReason(e){this.model.set("closeTimer",e)}handleCloseState(e,t){switch(this.log.info("handleCloseState",t),It.trigger("global:closeState:changed"),t){case j.Z.closeState.terminate:this.containerView?this.containerView.close(this.isClosedByUser):this.model.set("closeState",j.Z.closeState.containerViewClosed);break;case j.Z.closeState.containerViewClosed:this.nativeAdView&&this.nativeAdView.hide(),this.videoView?this.videoView.close(this.isClosedByUser):this.model.set("closeState",j.Z.closeState.videoViewClosed);break;case j.Z.closeState.videoViewClosed:this.adService?this.adService.close():this.model.set("closeState",j.Z.closeState.adManagerStop);break;case j.Z.closeState.adManagerStop:this.playerService&&(this.playerService.close(),this._stopListening())}}_stopListening(){this.model.off(),It.off()}pause(e){this._setTimerReason(e),this.adService&&this.adService.pauseGetAds()}_onParentSelectorLost(){this.overKill("parentSelectorLost")}_onTRCReset(){this.overKill("TRCReset"),this._resetFmOnPage()}_resetFmOnPage(){setTimeout(function(){this.model.off(),window.isCmTagFMOnPage=!1}.bind(this),500)}overKill(e){this.log.info("overKill reason: "+e),this.adService&&this.adService.pauseGetAds(),this.adsManager&&(this.adsManager.pauseGetAds(),this.adsManager.close()),this.playerService.playerDiv&&this.playerService.playerDiv.hide(),this.containerView&&this.containerView.$el&&this.containerView&&this.containerView.$el.hide();var t=Ot("._cm-video");t&&t.hide(),this.secondsToCloseGlobalTimer&&this.secondsToCloseGlobalTimer.stop(this.model,"",{},!0),this.model.set("closeState",j.Z.closeState.terminate),this._setTimerReason(e)}_createSecondsToPassbackTimer(){if(this.model.get("secondsToPassback")){this.passBackTimer=new At(this.model,{startCondition:{stateToListen:"",state:""},stopCondition:{stateToListen:!0,state:"isFirstAdLoaded"}},this._triggerPassback.bind(this,"Passback"),1e3*this.model.get("secondsToPassback")),this.passBackTimer.start(this.model,"")}}_triggerPassback(){this.model.get("isFirstAdLoaded")||(this.log.info("Passback timer done"),It.trigger("global:passback",{isApiPassbackExist:this.model.get("isApiPassbackExist")}),this.model.set("closeState",j.Z.closeState.terminate))}_handleMidArticleReadMore(){Et.isReadMoreObserverNeededOnPage(this.model.get("readMoreObserver.isActive"),this.model.get("isHip"))&&(this.readMoreObserver=new Pt({model:this.model}))}_checkPlacementPositionChange(){if(!this.model.get("isEligibleToPlay")&&!this.placementOffsetValidationChecked&&this.model.get("placementOffsetValidation.isActive")&&this.model.get("eligibleContainerOffset")){this.placementOffsetValidationChecked=!0;var{left:e,top:t,el:i}=this.model.get("eligibleContainerOffset"),s=Et.getOffsetWithContainer(i,this.model.get("offsetGetterType"),this.model.get("videoContainerSelector"));if(s&&(s.top!==t||s.left!==e)){var o={debug:"!url:"+(window&&window.location&&window.location.href?window.location.href:""),yOffset:s.top-t,xOffset:s.left-e};Et.firePixel(this.model.getPixel("pixels.placementPushedOutOfViewport"),"placement position changed to Out Of Viewport",o)}}}}const Nt=Vt;const Dt={"AR-EG":"","AR-AE":"","AR-SA":"","CS-CZ":"Reklama","DA-DK":"Annonce","DE-DE":"Anzeige","DE-AT":"Anzeige","DE-CH":"Anzeige","EL-GR":"Ad","EN-AE":"Ad","EN-AU":"Ad","EN-CA":"Ad","EN-GB":"Ad","EN-IE":"Ad","EN-IN":"Ad","EN-SG":"Ad","EN-PH":"Ad","EN-MY":"Ad","EN-NZ":"Ad","EN-US":"Ad","EN-ZA":"Ad","EN-XL":"Ad","ES-ES":"Publicidad","ES-AR":"Patrocinado","ES-CO":"Patrocinado","ES-CL":"Patrocinado","ES-PE":"Patrocinado","ES-MX":"Patrocinado","ES-US":"Patrocinado","ES-XL":"Patrocinado","ES-VE":"Patrocinado","EN-ID":"Ad","FI-FI":"Mainos","FR-FR":"Sponsoris","FR-BE":"Sponsoris","FR-CA":"Pub","FR-CH":"Sponsoris","HE-IL":"","HI-IN":"","HU-HU":"Hird.","ID-ID":"Ad","IT-IT":"Ann.","JA-JP":"PR","KO-KR":"AD","NB-NO":"Annonse","NL-NL":"Adv","NL-BE":"Adv","PL-PL":"Reklama","PT-BR":"Publicidade","PT-PT":"Pub","RU-RU":"","SV-SE":"Annons","TH-TH":"Ad","TR-TR":"R","VI-VN":"Ad","ZH-CN":"","ZH-TW":"","ZH-HK":""};var Rt=o(316),Mt=o(999),xt=o(84);const Ft=Rt.View.extend({events:{click:"_openAdChoice"},className:"_cm-ad-choice",initialize(e){this.log=new y.Z({unitType:this.model.get("unitType"),className:"AdChoice",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.log.info("Ad Choice ".concat(e.type," initialized.")),this.container=e.container,this.parentPlaceholder=e.parent,this.placementType=e.type,this.shouldHandelDetachAttach=S.z.UNIT_TYPES[this.model.get("unitType")]===S.z.UNIT_TYPES.FEED_MANAGER&&this.placementType!==S.z.AD_CHOICE_TYPE.TITLE,this.placementModel=this._getAdChoicePlacementModel(e.type),this.titlePosition=this.model.get("components.adChoice.position"),this.icon=this.model.get("components.adChoice.icon"),this._translateText(),this._bindEvents(),this.render(),this._firstVideoViewStateHandle(),this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener()},forceShowAdChoice(){this._show()},render(){this.template=Mt.template('<a class="_cm-ad-choice-text" target="_blank">{{text}}</a> <a class="_cm-ad-choice-logo" target="_blank"></a> '),this.$el.append(this.template(this.placementModel)),this.$el.children("._cm-ad-choice-logo").css({background:"url("+this.icon+") no-repeat"}),this.placementModel.isActive&&(this.placementModel.adViewStyle&&this.$el.css(Mt.toCssObj(this.placementModel.adViewStyle)),this.$el.find("._cm-ad-choice-text").css(Mt.toCssObj(this.placementModel.style)),this.$el.find("._cm-ad-choice-logo").css(Mt.toCssObj(this.placementModel.logoStyle))),this._setAdChoiceUrl(),this._alignTitle(),xt(this.container).append(this.el)},_bindEvents(){this.shouldHandelDetachAttach&&(this.log.info("Ad Choice ".concat(this.placementType," is listening to videoViewState")),this.listenTo(this.model,"change:videoViewState",this._handleVideoViewState.bind(this))),this.listenTo(this.model,"change:adPlayingWithAdChoice",this._onAdPlayingWithAdChoiceChange.bind(this)),this.listenTo(this.model,"change:content.isContentPlay",this._onAdPlayingWithAdChoiceChange.bind(this)),this.listenTo(this.model,"change:adjustWideFeed",this._onAdjustWideFeed.bind(this));var e=this.model.get("wurfl.browser.name");e!==S.z.BROWSER.IE&&e!==S.z.BROWSER.EDGE||this.listenTo(this.model,"change:isExpandEnded",this._onExpandEnded.bind(this))},_onExpandEnded(){this.log.info("onExpandEnded - IE or Edge detected");var e=this;this.$el.hide(),window.setTimeout((function(){e.$el.show()}),0)},_getAdChoicePlacementModel(e){var t;switch(e){case S.z.AD_CHOICE_TYPE.TITLE:t=this.model.get("components.adChoice.title");break;case S.z.AD_CHOICE_TYPE.VIDEO_AD:t=this.model.get("components.adChoice.videoAd");break;case S.z.AD_CHOICE_TYPE.SLIDER:t=this.model.get("components.adChoice.slider");break;default:t={text:"",style:{},logoStyle:{}}}return t},_getSCardSelector:function(){var e;switch(S.z.UNIT_TYPES[this.model.get("unitType")]){case S.z.UNIT_TYPES.WIDGET_ITEM:e='*[data-placement-name="'+this.model.get("placement")+'"]';break;case S.z.UNIT_TYPES.FEED_MANAGER:e=".tbl-feed-container .trc-content-sponsored";break;case S.z.UNIT_TYPES.INLINE_INSTREAM:case S.z.UNIT_TYPES.INLINE:case S.z.UNIT_TYPES.SLIDER_INSTREAM:e=".trc_rbox_container .trc-content-sponsored";break;default:e=""}return e},_setAdChoiceUrl(){this._selector=this._getSCardSelector();var e=this._extractUrl(this._selector);xt("._cm-ad-choice-text",this.$el).attr("href",e),xt("._cm-ad-choice-logo",this.$el).attr("href",e)},_extractUrl(e){var t,i,s=xt(e)[0];s?(xt(window).width()<=768||this.model.get("isMobile")?(t=xt(s).find("a.trc_mobile_adc_link"),this._isOpenNewTab=!0):t=xt(s).find("a.trc_desktop_adc_link"),i=t.length>0?xt(t[0]).attr("href").replace(/(Card)(\D*)(\d+)/,"Card "+this.model.get("cardNumber")):this.model.get("components.adChoice.fallbackUrl")):((xt(window).width()<=768||this.model.get("isMobile"))&&(this._isOpenNewTab=!0),i=this.model.get("components.adChoice.fallbackUrl"));return i},_alignTitle:function(){if(this.placementType===S.z.AD_CHOICE_TYPE.TITLE&&this._selector){var e=getComputedStyle(xt(this._selector)[0]);e&&"rtl"===e.direction&&xt(this.container).css("text-align","left !important")}},_firstVideoViewStateHandle(){S.z.UNIT_TYPES[this.model.get("unitType")]===S.z.UNIT_TYPES.FEED_MANAGER&&this.placementType!==S.z.AD_CHOICE_TYPE.TITLE&&this._handleVideoViewState()},_handleVideoViewState(){switch(this.model.get("videoViewState")){case j.Z.videoViewState.attached:this._onAttach();break;case j.Z.videoViewState.detached:this._onDetach()}},_onAttach(){switch(this.placementType){case S.z.AD_CHOICE_TYPE.VIDEO_AD:this._show();break;case S.z.AD_CHOICE_TYPE.SLIDER:this._hide()}},_onDetach(){switch(this.placementType){case S.z.AD_CHOICE_TYPE.VIDEO_AD:this._hide();break;case S.z.AD_CHOICE_TYPE.SLIDER:this._show()}this._updateAdChoicesVisibility()},_openAdChoice(e){this._firePixel("pixels.adChoice","adChoice click pixel."),window.TRC&&(this._isOpenNewTab||window.TRC.aboutUs&&window.TRC.aboutUs.open&&window.TRC.aboutUs.open(e))},_firePixel(e,t){var i=this.model.getPixel(e);Mt.firePixel(i,t)},_show(){this.placementModel.isActive&&!this.model.get("adPlayingWithAdChoice")&&this.$el.show(),this._validateComponentVisibilityStatus(!0)},_hide(){this.placementModel.isActive&&this.$el.hide(),this._validateComponentVisibilityStatus(!1)},_validateComponentVisibilityStatus(e){var t=this.componentsVisibilityListener&&this.model.get(this.componentsVisibilityListener);void 0!==t&&e!==t&&this.model.set(this.componentsVisibilityListener,e)},_updateAdChoicesVisibility(){this.model.get("adPlayingWithAdChoice")&&this.placementType!==S.z.AD_CHOICE_TYPE.TITLE?this._hide():this._show()},_onAdPlayingWithAdChoiceChange(){this.model.get("content.isContentPlay")&&!this.model.get("components.adChoice.isActiveOnContent")?this._hide():this.shouldHandelDetachAttach?this._handleVideoViewState():this._updateAdChoicesVisibility()},_onAdjustWideFeed(){var e=this.model.get("adjustWideFeed");this.titlePosition===S.z.TITLE_POSITION.BELOW&&(e?xt(this.parentPlaceholder).addClass("_cm-wide-feed-title-below"):xt(this.parentPlaceholder).removeClass("_cm-wide-feed-title-below"))},_translateText(){this.model.get("components.adChoice.isTranslateText")&&this.model.get("language")&&this.model.set("components.adChoice.videoAd.text",Dt[this.model.get("language").toUpperCase()])},_setComponentsVisibilityListener(){this.listenTo(this.model,"change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange.bind(this)),this.model.get(this.componentsVisibilityListener)||this._hide()},_onComponentsVisibilityChange(){this.model.get(this.componentsVisibilityListener)?this._show():this._hide()}});var Lt=o(999),Bt=o(84);class kt{constructor(e){this.model=e,this.log=new y.Z({unitType:"Util",className:"AnimationUtil",version:this.model.get("version"),isDebug:this.model.get("isDebug")})}expand(e){e.$el.height()>=e.height?this.log.info("No expand needed"):this.aniamteHeight(e)}collapse(e){e.$el.height()<=e.height?this.log.info("No collapse needed"):this.aniamteHeight(e)}aniamteHeight(e){this.model.set("isAnimationRunning",!0);var t={transition:"height "+e.timeMS+"ms",height:e.height};requestAnimationFrame((()=>{e.$el.css(t)})),this.oneAnimationEnd(e.$el,e.cb,e.timeMS)}aniamteOpacity(e){this.model.set("isAnimationRunning",!0);var t={transition:"opacity "+e.timeMS+"ms",opacity:e.opacity};requestAnimationFrame((()=>{e.$el.css(t)})),this.oneAnimationEnd(e.$el,e.cb,e.timeMS)}attach(e){if(e.$el){var t={top:e.target.top,left:e.target.left};if(e.isAnimated){t.width=this.model.get("videoPlaceholderSize.width")+"px",t.height=this.model.get("videoPlaceholderSize.height")+"px";var i=e.$el.offset(),s={position:"absolute",top:i.top+"px",left:i.left+"px",width:i.width+"px",height:i.height+"px"};requestAnimationFrame((()=>{e.$el.css(s),Lt.flushCss(e.$el[0])})),t.transition="all "+e.timeMS+"ms ease",t=Bt.extend(t,e.additionalCss),requestAnimationFrame(function(){e.$el.css(t)}.bind(this))}else{var o={position:"absolute",top:"auto",bottom:"auto",left:"auto",right:"auto"};t=Bt.extend(o,t),t=Bt.extend(o,e.additionalCss),e.$el.css(o),requestAnimationFrame((()=>{Lt.flushCss(e.$el[0])}))}this.oneAnimationEnd(e.$el,e.cb,e.timeMS)}else this.log.warning("Called attach without an element!")}detach(e){var t,i;if(this.model.get("nextUp.isActive")&&this.model.get("nextUp.selector")&&(t=document.querySelector(this.model.get("nextUp.selector")),i=getComputedStyle(t.parentElement).bottom),e.isAmp)this.detachSliderAmp(e);else{var s={position:"fixed",top:"auto",bottom:"auto",left:"auto",right:"auto"};if(e.isSlideIn)t?(s[e.sliderOptions.position.horizontal]=0,s[e.sliderOptions.position.vertical]=i):(s[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",s[e.sliderOptions.position.vertical]=e.sliderOptions.position.verticalOffset+"px"),s.height=this.model.get("detachToSlider.height")+"px",e.isSlideVertically?s.height=0:s.width=0;else{var o=Bt.extend({},e.$el[0].getBoundingClientRect());o.right=window.innerWidth-o.left-o.width,o.bottom=window.innerHeight-o.bottom,s[e.sliderOptions.position.horizontal]=o[e.sliderOptions.position.horizontal]+"px",s[e.sliderOptions.position.vertical]=o[e.sliderOptions.position.vertical]+"px"}var n={transition:"all "+e.timeMS+"ms ease"};t?(n[e.sliderOptions.position.vertical]=i,n[e.sliderOptions.position.horizontal]=0):(n[e.sliderOptions.position.vertical]=e.sliderOptions.position.verticalOffset+"px",n[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px"),n.width=this.model.get("detachToSlider.width")+"px",n.height=this.model.get("detachToSlider.height")+"px",e.isAnimated?(e.$el.css(s),requestAnimationFrame((()=>{e.$el.css(s),Lt.flushCss(e.$el[0])})),requestAnimationFrame(function(){e.$el.css(n)}.bind(this))):(e.$el.css(s),n.transition="none !important",e.$el.css(n)),this.oneAnimationEnd(e.$el,e.cb,e.timeMS+1)}}detachSliderAmp(e){var t={position:"absolute",top:"auto",bottom:"auto",left:"auto",right:"auto"};e.isSlideIn?(t[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",t.top=this._getSliderPositionVerticalAmp(e.sliderOptions),t.height=this.model.get("detachToSlider.height")+"px",e.isSlideVertically?t.height=0:t.width=0):(t[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",t.top=this._getSliderPositionVerticalAmp(e.sliderOptions));var i={position:"absolute",top:"auto",bottom:"auto",left:"auto",right:"auto",transition:"all  ".concat(e.sliderOptions.detachAnimationTime," ").concat(e.sliderOptions.animationStyle)};i[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",i.top=this._getSliderPositionVerticalAmp(e.sliderOptions),i.width=this.model.get("detachToSlider.width")+"px",i.height=this.model.get("detachToSlider.height")+"px",e.isSlideIn&&e.$el.css(t),requestAnimationFrame(function(){e.$el.css(i)}.bind(this)),setTimeout(function(){this.correctSliderDetachPosition({$el:e.$el,sliderOptions:e.sliderOptions,isSlideVertically:e.isStickyCardActive})}.bind(this),e.sliderOptions.animationTime+10),this.oneAnimationEnd(e.$el,e.cb,e.timeMS+1)}detachAmpSticky(e){Lt.dispatchTRC("videoSliderOn",this.model),e.timeMS=150;var t={transition:"top "+e.timeMS+"ms ease-in-out",position:"absolute"};t[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",t[e.sliderOptions.position.vertical]=e.sliderOptions.position.verticalOffset+"px",t.width=this.model.get("detachToSlider.width")+"px",t.height=this.model.get("detachToSlider.height")+"px",e.$el.css(t),this.oneAnimationEnd(e.$el,e.cb,e.timeMS+1)}correctSliderDetachPosition(e){Lt.dispatchTRC("videoSliderOn",this.model);var t=e.sliderOptions.amp.correctionAnimationTime,i={transition:"top "+t+"ms ease-in-out",position:"absolute"};i.top=this._getSliderPositionVerticalAmp(e.sliderOptions),e.$el.css(i),this.oneAnimationEnd(e.$el,e.cb,t+1)}slideOut(e){var t={transition:"all "+e.timeMS+"ms linear"};e.isVerticalSlideOut?(t[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",t[e.sliderOptions.position.vertical]="-"+(e.sliderOptions.height+parseFloat(e.sliderOptions.position.verticalOffset))+"px"):(t[e.sliderOptions.position.horizontal]="-"+(e.sliderOptions.width+parseFloat(e.sliderOptions.position.horizontalOffset))+"px",t[e.sliderOptions.position.vertical]=e.sliderOptions.position.verticalOffset+"px"),requestAnimationFrame(function(){e.$el.css(t)}.bind(this)),this.oneAnimationEnd(e.$el,e.cb,e.timeMS)}oneAnimationEnd(e,t,i){setTimeout(function(){this.model.set("isAnimationRunning",!1),e.css("transition","none"),t&&t()}.bind(this),i)}PrefixedEvent(e,t,i,s){i=i.toLowerCase(),Lt.each(["webkit","moz","MS","o",""],(function(o){e[t](o+i,s)}))}_getSliderPositionVerticalAmp(e){var t=0,i=this.model.get("ampPageTopLimit")||0,s=this.model.get("ampPageBottomLimit")||0;return"bottom"===e.position.vertical?(t=s-e.height-e.position.verticalOffset,t=Math.max(0,t)):t=i+e.position.verticalOffset,"".concat(t,"px")}updateModel(e){this.model=e}}var Ut=function(){var e;return function(t){return e||(e=new kt(t)),e.updateModel(t),e}}();const zt=Ut;var Ht=o(999),Wt=o(316),jt=o(84),$t={title:"._cm-ad-title",placeholder:"._cm-feed-manager-video-placeHolder"};class Zt extends E.s{initialize(e){this.log=new y.Z({unitType:this.model.get("unitType"),className:"SubFeedContainerView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.globalModel=e.globalModel,this.elasticLogger=this.model.get("elasticLogger"),this.lastAdReported=-1,this.ad=e.ad,this.titlePosition=this.model.get("components.adChoice.position"),this.template=this.titlePosition===S.z.TITLE_POSITION.ABOVE?'<div class="_cm-ad-title"></div> <div class="_cm-feed-manager-video-placeHolder"></div> ':'<div class="_cm-feed-manager-video-placeHolder"></div> <div class="_cm-ad-title"></div> ',this.subUnitId=this.model.get("subUnitId"),this.model.set("containerViewState",j.Z.readyState),this.listenTo(this.model,"change:closeState",this._onCloseStateChange.bind(this)),this.isAnimateOnOpen=this.model.get("animation.onTransitionOpen"),this.isAnimateOnClose=this.model.get("isAnimateOnClose")||this.model.get("animation.onTransitionClose")&&"close"===this.model.get("onTimerClose"),this.openCloseAmnimation={transition:"height "+this.model.get("animation.transitionAnimationTime")+"ms"},this.noAmnimationCss={transition:"none"};var t=this.model.get("detachToSlider");this.isSuperSliderMode=t.isStartFromSlider&&t.isDetachToSlider,this.isStartFromSlider=t.isStartFromSlider,Ht.isSliderCutOffEnabled(this.model,this.ad.adData)&&(this.isSuperSliderMode=!1,this.isStartFromSlider=!1,this.model.set("isSuperSlider",!1),this._logToElasticLogger(this.ad,"Slider cut off",vt.b.INFO,{event:"disable super slider mode"})),this.animationStartEndPoint={height:"0"},this.animationUtil=zt(this.model)}_logToElasticLogger(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vt.b.INFO,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.elasticLogger&&e&&t&&(s.adId=e.adId,this.elasticLogger.log({message:t,severity:i,extraData:s}))}_bindWindowEvents(){this.listenTo(Wt,"window:orientation:change",this._orientationChange.bind(this)),this.listenTo(Wt,"window:resize:change",this._onwindoResize.bind(this)),this.listenTo(this.model,"change:isAdClosed",this._onAdClosed.bind(this)),this.listenTo(Wt,"window:scroll:change",this._onPlaceHolderDomChange.bind(this,!1)),this.listenTo(Wt,"feed:resize:change",this._onPlaceHolderDomChange.bind(this,!1)),this.listenTo(Wt,"taboola:readmore:click",this._onPlaceHolderDomChange.bind(this,!0)),this.listenTo(this.model,"change:aspectRatioNum",this._onPlaceHolderDomChange.bind(this,!0)),this.listenTo(Wt,"publisher:dom:change",this._onPublisherDOMChange.bind(this,!0)),this.listenTo(this.model,"change:isAdClosedByTimer",this._onAdClosed.bind(this))}render(e,t){this.log.info("rendering subunit:",this.subUnitId),this.container=e,this.$container=jt(this.container),this.renderTemplate(),this._customize(),this.el.id="_cm-video-unit",this.$el.addClass("ContainerView_"+t),this._addAdChoiceTitle(),jt(e).append(this.el),this._adjustWideFeed(),this.isAnimateOnOpen&&(this.isSuperSliderMode||this.isStartFromSlider)&&this._runAnimation(!0,null),this._onPlaceHolderDomChange(),this.model.set("containerViewPlaceHolder",this.ui.placeholder[0]),this._bindWindowEvents(),this.model.set("containerViewState",j.Z.containerViewState.rendered),this._triggerRenderEvent()}_onAdClosed(e,t){t&&this.isAnimateOnClose&&this._runAnimation(!1,this.closeAndRemove.bind(this))}terminate(e,t){this.terminated||(this.stopListening(Wt,"window:scroll:change"),this.stopListening(Wt,"feed:resize:change"),this.model.set("closeState",j.Z.closeState.closeUnit),this.terminated=!0)}hide(){this.$el.hide(),this.$container.hide()}remove(){this.$el.remove(),this.$container.remove()}close(){this.log.info("close"),this.isClosed||(this.isClosed=!0,"WIDGET_ITEM"===this.model.get("unitType")?(this._runAnimation(!1,this.hide.bind(this)),this.model.set("closeState",j.Z.closeState.containerViewClosed)):setTimeout(function(){this.model.set("closeState",j.Z.closeState.containerViewClosed)}.bind(this),1500))}closeAndRemove(){this.terminate(),this.remove()}_onCloseStateChange(){if(this.model.get("closeState")===j.Z.closeState.closeUnit)this.close()}_customize(){var e=this.model.get("customization.unitContainer"),t=this.model.get("customization.placeHolder"),i=this.model.get("customization.adTitle");this._customizeFeed(),this.$el.css(Ht.toCssObj(e)),this.ui.title.css(Ht.toCssObj(i)),this.ui.placeholder.css(Ht.toCssObj(t))}_addAdChoiceTitle(){this.model.get("components.adChoice.isActive")&&this.model.get("components.adChoice.title.isActive")&&(this.adChoice=new Ft({model:this.model,container:this.ui.title,parent:this.el,type:S.z.AD_CHOICE_TYPE.TITLE}))}_customizeFeed(){this.ui.title.text(this.model.get("unitTitle"))}_onwindoResize(){this._onPlaceHolderDomChange()}_onPlaceHolderDomChange(){this._onPublisherDOMChange()}_isVideoContainerSelectorStillOnPage(e){return!!(e&&Ht.isZeptoCollection(e)&&e[0])}_onPublisherDOMChange(){if(this.model.get("videoContainerSelector")&&!this._isVideoContainerSelectorStillOnPage(jt(this.model.get("videoContainerSelector")))){if(this.ad.adId===this.lastAdReported)return;return this._logToElasticLogger(this.ad,"videoContainerSelector: ".concat(this.model.get("videoContainerSelector")," is not on page"),vt.b.ERROR,{event:"no video feed container selector"}),void(this.lastAdReported=this.ad.adId)}this.terminated||(this._calcPlaceholderSize(),this._calcPlaceholderPosition())}_calcPlaceholderSize(){this.isAnimatioRunning||(this.isSuperSliderMode?this._calcPlaceholderSizeFeed(!1,this.$container.width()):this._calcPlaceholderSizeFeed())}_runAnimation(e,t){if(e&&this.model.get("isSuperSlider"))this.$el.css({display:"none"});else if(this.isAnimatioRunning=!0,e){this.$el.css(this.animationStartEndPoint);var i=this.ui.placeholder.width(),s=this._getVideoHeightByRatio(i);this.model.set("videoPlaceholderSize",{width:i,height:s}),this.animationUtil.expand({$el:this.$el,timeMS:this.model.get("animation.transitionAnimationTime"),height:this.model.get("height"),cb:this.postAnimation.bind(this,this._calcPlaceholderSizeFeed.bind(this,!0))})}else this.animationUtil.collapse({$el:this.$el,timeMS:this.model.get("animation.transitionAnimationTime"),height:0,cb:this.postAnimation.bind(this,t)})}postAnimation(e){this._removeAnimation(),e&&e()}_removeAnimation(){this.isAnimatioRunning=!1,this.$el.css(this.noAmnimationCss)}_calcPlaceholderSizeFeed(e,t){var i=this.ui.placeholder.width()||t,s=this._getVideoHeightByRatio(i);i&&s?((e||this.model.get("videoPlaceholderSize.width")!==i||this.model.get("videoPlaceholderSize.height")!==s)&&(this.model.set("width",i),this.model.set("height",s),this.$el.css({height:s+this.ui.title.height(),width:i}),this.titlePosition===S.z.TITLE_POSITION.BELOW&&this.ui.placeholder.css({height:s}),this.model.set("videoPlaceholderSize",{width:i,height:s}),this.model.get("videoViewState")!==j.Z.videoViewState.detached&&this.model.trigger("change:videoPlaceholderSize",this.model,this.model.get("videoPlaceholderSize"))),this._adjustWideFeed()):this.log.error("_calcPlaceholderSizeFeed calculated width=0 or height=0",{width:i,height:s,subUnitId:this.subUnitId})}_getVideoHeightByRatio(e){return this.model.isVerticalVideoEnabled(e)?Ht.getVideoHeightByRatio(e,this.model.get("aspectRatioNum")):Ht.getVideoHeight(e)}_calcPlaceholderPosition(){var e=Ht.getOffsetWithContainer(this.ui.placeholder,this.model.get("offsetGetterType"),this.model.get("videoContainerSelector")),t=this.model.get("videoPlaceholderPosition");t&&t.top===e.top&&t.left===e.left||this.model.set("videoPlaceholderPosition",{top:e.top,left:e.left})}_adjustWideFeed(){var e=this.model.get("maxVideoWidth"),t=this.$el.parent();if(e&&t){var i=t.width();i>=e?(this._setMaxVideoSize(e),this.$el.addClass("_cm-wide-feed"),this.model.set("adjustWideFeed",!0)):(this.$el.removeClass("_cm-wide-feed"),this._setMaxVideoSize(i),this.model.set("adjustWideFeed",!1))}}_setMaxVideoSize(e){var t=this._getVideoHeightByRatio(e)+this.ui.title.height();this.$el.css({maxHeight:t,maxWidth:e})}_orientationChange(){this._onPlaceHolderDomChange()}_updateBrandingStyle(){var e=document.querySelector(".videoCube"),t=e.querySelector(".video-label-box .video-title");this.model.set("customization.titleContainer.title",Ht.cssObjToString(getComputedStyle(t)));var i=e.querySelector(".video-label-box .branding");this.model.set("customization.titleContainer.branding",Ht.cssObjToString(getComputedStyle(i)))}_triggerRenderEvent(){var e=this.model.get("cardNumber");e&&Wt.trigger("newCardRendered",{cardNumber:Math.abs(e),isSlider:e<0,subUnitType:this.model.get("subUnitType")})}_SuperSliderClose(){this.isSuperSliderMode=!1,this.terminate()}getVideoPlaceholder(){return this.ui.placeholder}get className(){return"_cm-feed-manager"}get ui(){return this.UI?this.UI:this.UI=$t}set ui(e){return this.UI=e}}const Gt=Zt;var qt=o(777);var Yt=o(84),Kt=o(999),Qt="_cm-native-ad",Xt={title:"._cm-native-ad-title",ctaButtone:"._cm-native-ad-cta-button",description:"._cm-native-ad-description",icon:"._cm-native-ad-icon",branding:"._cm-native-ad-branding",adChoice:"._cm-ad-choice",placeholder:"._cm-feed-manager-video-placeHolder",wrapper:"._cm-native-ad-bottom"};class Jt extends qt.Z{constructor(e){super(e),this.model=e.model,this.globalModel=e.globalModel,this.shouldHideBrandingText=e.shouldHideBrandingText||!1,this.shouldFitToSize=e.shouldFitToSize||!1,this.sendNasOpp=e.sendNasOpp||!1,this.elasticLogger=this.model.get("elasticLogger"),this.isMultiFloatingNASElements=e.isMultiFloatingNASElements||!1,e.additionalCss&&this._addAdditionalCss(e.additionalCss),this.log=new y.Z({unitType:this.model.get("unitType"),className:constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.template=this._isTitleOnTop()?'<div class="_cm-native-ad-top"> <div class="_cm-native-ad-title" data-click-name="adTitleClick"></div> <div class="_cm-native-ad-cta-wrapper"> <div class="_cm-native-ad-cta-button" data-click-name="adCtaButtonClick"></div> </div> <div class="_cm-native-ad-description" data-click-name="adDescriptionClick"></div> <div class="_cm-native-ad-icon"></div> <div class="_cm-native-ad-branding" data-click-name="adBrandingClick"></div> <div class="_cm-ad-choice"></div> </div> ':'<div class="_cm-native-ad-bottom"> <div class="_cm-native-ad-title" data-click-name="adTitleClick"></div> <div class="_cm-native-ad-cta-wrapper"> <div class="_cm-native-ad-cta-button" data-click-name="adCtaButtonClick"></div> </div> <div class="_cm-native-ad-description" data-click-name="adDescriptionClick"></div> <div class="_cm-native-ad-icon"></div> <div class="_cm-native-ad-branding" data-click-name="adBrandingClick"></div> <div class="_cm-ad-choice"></div> </div> ',this.container=Yt(e.container),this.nativeAdMapping=this.globalModel.get("nativeAdMapping"),(this.model.get("stickyCard.isActive")||!this.model.get("detachToSlider.isStartFromSlider")&&!this.model.get("detachToSlider.isDetachToSlider"))&&(this.isSticky=!0,this._setToModel("floatingNAS.isActive",!1)),this.model.get("isPreviewAdSettings")&&(window.setPreviewAdSettings=e=>{var{title:t,description:i,branding:s}=e;this.model.set("adNativeSettings",{[this.nativeAdMapping.title]:t,[this.nativeAdMapping.description]:i,[this.nativeAdMapping.branding]:s}),this._updateAdData()}),this.bindEvents()}_setToModel(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.model.set(e,t,i),this.globalModel&&this.globalModel.set(e,t,i)}_render(){this.renderTemplate(),this._adjustRTL(),this._adjustToDarkMode(),this.$el.addClass(Qt),this.container.append(this.$el),this._addAdChoiceTitle(),this.rendered=!0}_adjustRTL(){var e=this._getCssFromSelector(this.model.get("rboxCssSelectors.title"));e&&"rtl"===e.direction&&(this.ui.wrapper.css({"flex-direction":"row-reverse",direction:"ltr"}),this.ui.icon.addClass("_cm-native-ad-icon-rtl").removeClass("_cm-native-ad-icon"))}_adjustToDarkMode(){this.model.get("adjustToDarkMode.isActive")&&(this._logToElasticLogger("adjust to dark mode"),this.ui.wrapper.css({"background-color":"unset !important"}))}_logToElasticLogger(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vt.b.INFO,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.elasticLogger&&e&&this.elasticLogger.log({message:e,severity:t,extraData:i})}bindEvents(){this.createStateHandlers([{event:"adNativeSettings",funcName:"_updateAdData"},{event:"repeatState:".concat(j.Z.repeatState.hiding),funcName:"show"},{event:"loadingViewState:".concat(j.Z.loadingViewState.hiding),funcName:"show"},{event:"floatingView:".concat(j.Z.floatingView.detach),funcName:"detach"},{event:"floatingView:".concat(j.Z.floatingView.attach),funcName:"attach"},{event:"floatingView:".concat(j.Z.floatingView.postAttach),funcName:"postAttach"},{event:"floatingView:".concat(j.Z.floatingView.permanentClosed),funcName:"permanentClosed"}])}_updateAdData(){this.rendered||this._render(),this.adNativeSettings=this.model.get("adNativeSettings"),this._displayTitleOnTop(),this._setRandomTitle(),this._handleBranding(),this.isClickable=this.adNativeSettings.isClickable;var e=this.model.get("rboxCssSelectors.title");this._updateContainerViewTitleVisibility(),this._adjustDescFontToTitleFont(e),this._updateTitleContainerEl(this.ui.ctaButtone,this.adNativeSettings[this.nativeAdMapping.ctaButtone],"",this.model.get("customization.cta")),this._updateTitleContainerEl(this.ui.title,this.adNativeSettings[this.nativeAdMapping.title],e,this.model.get("customization.title")),this._updateTitleContainerEl(this.ui.description,this.adNativeSettings[this.nativeAdMapping.description],this.model.get("rboxCssSelectors.description"),this.model.get("customization.description")),this._updateTitleContainerEl(this.ui.branding,this.adNativeSettings[this.nativeAdMapping.branding],this.model.get("rboxCssSelectors.branding"),this.model.get("customization.branding")),this._updateIcon(this.adNativeSettings[this.nativeAdMapping.icon]),this._createFloatingNAS(),this._adjustRTLByLanguage(),this._isSuperSlider()?this.hide():this.show(),this._fitToSize(),this._checkSendNasOpp(),this.adDataUpdated=!0,this.model.trigger("nativeAdSettingsUpdated")}_adjustRTLByLanguage(){if(Kt.isLanguageRTL(this.model)){var e={"text-align":"right",direction:"rtl"};this.ui.title.css(e),this.ui.description.css(e),this.ui.branding.css(e),this.ui.wrapper.css(e)}}_checkSendNasOpp(){this.sendNasOpp&&(this.detached?this.model.trigger("displayingNASTitleOnly"):this.model.trigger("displayingFullNAS"))}_setRandomTitle(){this.model.get("getRandomNativeAdTitle")&&!this.adNativeSettings[this.nativeAdMapping.title]&&(this.adNativeSettings[this.nativeAdMapping.title]=Kt.getRandomFromList(this.model.get("randomTitlesList")))}_displayTitleOnTop(){this._isTitleOnTop()&&(this.model.set("isTitleOnTop",!0),this.model.set("getRandomNativeAdTitle",!1),this._displayTitleOnly(),Yt(this.ui.title).css({"max-width":"340px"}),setTimeout((()=>Yt(this.ui.title).css({"max-width":"225px"})),2e3))}_isTitleOnTop(){return this.model.get("unitType").indexOf("RECO_REEL_WIDGET")>-1&&this.model.get("frameType")===S.z.FRAME_TYPE.amp&&this.model.get("showTitleOnTop")}_handleBranding(){this.shouldHideBrandingText&&(this.containerHeight=this.containerHeight||Yt("._cm-widget-item").height(),this.model.trigger("change:customization.titleContainer.branding.displayState",this._hasNASTitle()?j.Z.brandingDisplayState.hide:j.Z.brandingDisplayState.show))}_fitToSize(){if(this.shouldFitToSize)if(this.hasNAS=this._hasNASTitle(),this.hasNAS){if(!this.detached){this.fitToSizeDisplaying=S.z.NATIVE_AD.FIT_TO_SIZE.NONE;var e=this.model.get("videoPlaceholderSize");this.containerHeight&&e&&(this._canFitTitleAndDescription(e)?this._canFitTitleOnly(e)?(this.fitToSizeDisplaying=S.z.NATIVE_AD.FIT_TO_SIZE.TITLE,this._displayTitleOnly(),this.model.trigger("displayingNASTitleOnly")):this.hide():(this.fitToSizeDisplaying=S.z.NATIVE_AD.FIT_TO_SIZE.FULL,this.show(),this.model.trigger("displayingFullNAS")))}}else this.hide()}_canFitTitleAndDescription(e){return Number(e.height)+this.el.getBoundingClientRect().height>this.containerHeight}_canFitTitleOnly(e){return Number(e.height)+this.ui.title.height()<this.containerHeight}_displayTitleOnly(){this.ui.title.show(),this.ui.description.hide(),this.ui.ctaButtone.hide(),this.ui.branding.hide(),this.ui.icon.hide(),this.container.height(this.containerHeight)}_isSuperSlider(){return this.model.get("detachToSlider.isStartFromSlider")&&this.model.get("detachToSlider.isDetachToSlider")&&-1===this.model.get("unitType").indexOf("MID_ARTICLE_SLIDER")}_updateContainerViewTitleVisibility(){var e=this.adNativeSettings.title||this.adNativeSettings.ctatext||this.adNativeSettings.desc||this.adNativeSettings.sponsored,t=this.container.find("._cm-ad-title");e?(t.hide(),this.ui.adChoice.show()):(t.show(),this.ui.adChoice.hide())}_adjustDescFontToTitleFont(e){var t=this.model.get("customization.description");if(!t)try{var i=parseInt(this._getCssFromSelector(e).fontSize);isNaN(i)||(t={},Kt.extend(t,{"font-size":i*S.z.NATIVE_AD.DESC_TITLE_FONT_RATIO+"px"}),this.model.set("customization.description",t))}catch(e){this.log.info("No title selector found - apply default values")}}_updateTitleContainerEl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;(e.text(t),t)?(this._applyCssFromSelector(e,i,s),e.show()):e===this.ui.ctaButtone&&e.hide();this._updateTitleContainerClickability(e)}_applyCssFromSelector(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=Kt.pick(this._getCssFromSelector(t),S.z.CSS_PROPERTIES_FROM_RBOX);Kt.extend(s,i),e.css(Kt.toCssObj(s))}_getCssFromSelector(e){if(!e)return{};var t="string"==typeof e?document.querySelector(e):e;return t&&getComputedStyle(t)}_updateTitleContainerClickability(e){this.isClickable?(e[0].onclick=this._onClick.bind(this),e.css({cursor:"pointer"}),e.attr("role","link")):(e[0].onclick=null,e.css({cursor:"default"}),e.removeAttr("role"))}_onClick(e){var t=e.target.getAttribute("data-click-name");this.model.set("nativeAdClick",t,{silent:!0}),this.model.trigger("change:nativeAdClick",t)}_updateIcon(e){e?(this.iconImg||this._createIconImg(),this.iconImg.src=e,this._updateTitleContainerClickability(this.ui.icon),this.ui.icon.show()):this.ui.icon.hide()}_createIconImg(){this.iconImg=document.createElement("img"),this.iconImg.className="_cm-native-ad-icon-img",this.iconImg.setAttribute("data-click-name","adIconClick"),this.iconImg.addEventListener("error",this._onError.bind(this)),this.ui.icon.css(Kt.toCssObj(Kt.extend({},this.model.get("customization.icon")))),this.ui.icon.append(this.iconImg)}_onError(){this.log.error("can't load native ad icon"),this.ui.icon.hide()}_addAdChoiceTitle(){this.model.get("components.adChoice.isActive")&&this.model.get("components.adChoice.title.isActive")&&(this.adChoice=new Ft({model:this.model,container:this.ui.adChoice,parent:this.el,type:S.z.AD_CHOICE_TYPE.TITLE}))}_addAdditionalCss(e){Yt(this.el).addClass(e)}hide(){this.$el.hide()}show(){this._isSuperSlider()||this.$el.show()}_createFloatingNAS(){this.globalModel.get("floatingNAS.isActive")&&(this.hasNAS=this._hasNASTitle(),this.hasNAS&&(this.isMultiFloatingNASElements&&this._removePreviousFloatingNASElement(),this.ui.floatingNAS={},this._createFloatingNASWrapper(),this._createFloatingNASTitle(),this._appendFloatingNAS()))}_removePreviousFloatingNASElement(){this.ui.floatingNAS&&this.ui.floatingNAS.wrapper&&this.ui.floatingNAS.wrapper.parentElement.removeChild(this.ui.floatingNAS.wrapper)}_createFloatingNASWrapper(){this.ui.floatingNAS.wrapper=document.createElement("div"),this.ui.floatingNAS.wrapper.className="".concat(Xt.wrapper.replace(/^\./,"")," _cm-native-ad-bottom-floating"),this.shouldFitToSize&&!this.detached&&Yt(this.ui.floatingNAS.wrapper).addClass("hide"),this.ui.floatingNAS.wrapper.style.width=this.model.get("detachToSlider.width")+"px"}_createFloatingNASTitle(){this.ui.floatingNAS.title=this.ui.title[0].cloneNode(!0),this.ui.floatingNAS.title.className+=" _cm-native-ad-title-floating"}_appendFloatingNAS(){this.ui.floatingNAS.wrapper.appendChild(this.ui.floatingNAS.title),this._getActiveAd().appendChild(this.ui.floatingNAS.wrapper)}_getActiveAd(){return document.getElementsByClassName("_cm-ad-active")[0]||this.container.get(0)}_getFloatingView(){return document.getElementsByClassName("_cm-floating-view")[0]}_hasNASTitle(){return"string"==typeof this.adNativeSettings[this.nativeAdMapping.title]}detach(){this.isSticky||this.shouldFitToSize&&this.fitToSizeDisplaying===S.z.NATIVE_AD.FIT_TO_SIZE.NONE||(this.detached=!0,this.hasNAS&&(this.ui.floatingNAS.wrapper.style.width=this.model.get("detachToSlider.width")+"px",this.ui.floatingNAS.wrapper.className=this.ui.floatingNAS.wrapper.className.replace(" hide","")))}attach(){this.isSticky||this.shouldFitToSize&&this.fitToSizeDisplaying===S.z.NATIVE_AD.FIT_TO_SIZE.NONE||this.hasNAS&&this.detached&&(this.ui.floatingNAS.wrapper.style.width=this.model.get("width")+"px")}postAttach(){this.isSticky?this._displayFitToSizeNAS():this.shouldFitToSize&&this.fitToSizeDisplaying===S.z.NATIVE_AD.FIT_TO_SIZE.NONE||(this.hasNAS&&this.detached&&(this._handleActiveAdWithoutNAS(),this.ui.floatingNAS.wrapper.className+=" hide",this._displayFitToSizeNAS()),this.detached=!1)}_displayFitToSizeNAS(){this.shouldFitToSize&&this.fitToSizeDisplaying!==S.z.NATIVE_AD.FIT_TO_SIZE.NONE&&(this.fitToSizeDisplaying===S.z.NATIVE_AD.FIT_TO_SIZE.TITLE?this._displayTitleOnly():this.fitToSizeDisplaying===S.z.NATIVE_AD.FIT_TO_SIZE.FULL&&this.show())}triggerDetachIfRendered(){this.adDataUpdated&&this.model.trigger("nativeAdSettingsUpdated")}getFloatingNASHeight(){return this.ui.floatingNAS&&this.ui.floatingNAS.wrapper?this.ui.floatingNAS.wrapper.getBoundingClientRect().height:0}getNASHeight(){return this.shouldFitToSize&&this.fitToSizeDisplaying!==S.z.NATIVE_AD.FIT_TO_SIZE.NONE?this.fitToSizeDisplaying===S.z.NATIVE_AD.FIT_TO_SIZE.TITLE?this.ui.title.height():this.el.getBoundingClientRect().height:0}onAdComplete(){this.prevAdNAS=this.hasNAS,this.adDataUpdated=!1,this.hasNAS&&this.detached&&this._isSuperSlider()&&this._handleActiveAdWithoutNAS()}onAdDisplayChange(){if(this.hasNAS&&this.detached){if(this.prevAdNAS&&this._isSuperSlider())return;this._handleFloatingViewWithNAS(),this._isSuperSlider()&&this._handleActiveAdWithNAS()}}onAdSwapped(){this.hasNAS=this._hasNASTitle()||this._isActiveAdContainNAS(),this.detached&&this.hasNAS!==this.prevAdNAS&&(this.hasNAS?this._handleFloatingViewWithNAS():this._handleActiveAdWithNAS()),this.adDataUpdated=!0,this.prevAdNAS=this.hasNAS}_handleFloatingViewWithNAS(){var e=this._getFloatingView();e&&(e.style.bottom=parseInt(e.style.bottom)+this.getFloatingNASHeight()+"px")}_handleActiveAdWithNAS(){var e=this._getActiveAd();e&&(e.style.height=parseInt(e.style.height)+this.getFloatingNASHeight()+"px")}_handleActiveAdWithoutNAS(){var e=this._getActiveAd();if(e){var t=parseInt(e.style.height);t>this.model.get("videoPlaceholderSize").height&&(e.style.height=t-this.getFloatingNASHeight()+"px")}}_isActiveAdContainNAS(){var e=this._getActiveAd();return!!e&&e.getElementsByClassName("_cm-native-ad-bottom-floating").length>0}permanentClosed(){this._isSuperSlider()&&this.hide()}hideFloatingNAS(){this.detached&&this.ui.floatingNAS&&Yt(this.ui.floatingNAS.wrapper).addClass("hide")}showFloatingNAS(){this.detached&&this.ui.floatingNAS&&Yt(this.ui.floatingNAS.wrapper).removeClass("hide")}get className(){return Qt}get ui(){return this.UI?this.UI:this.UI=Xt}set ui(e){return this.UI=e}}const ei=Jt;var ti=o(72);const ii=o(316).View.extend({className:"_cm-disc-text",id:"_cm-css-reset",initialize:function(e){this.log=new y.Z({unitType:e.unitType,className:"disclosureTextView",version:e.model.get("version"),isDebug:e.model.get("isDebug")}),this.disclosureText='<div class="title text opt-out-hidden">{text}</div> ',this.container=e.container,this._rendered=!1,this._bindEvents(),this.createStateHandlers=ti.L},render:function(){this._rendered||(this._rendered=!0,this.container.appendChild(this.el),"detached"===this.model.get("videoViewState")?this.model.get("detachToSlider.components.disclosureText.isActive")?this.show():this.hide():this.model.get("components.disclosureText.isActive")?this.show():this.hide())},_bindEvents:function(){(this.model.get("detachToSlider.isStartFromSlider")||this.model.get("detachToSlider.isDetachToSlider"))&&this.listenTo(this.model,"change:videoViewState",this._onVideoViewStateChange)},_onVideoViewStateChange:function(e,t){switch(t){case"detached":0==this.model.get("detachToSlider.components.disclosureText.isActive")?this.hide():this.show();break;case"attached":this.model.get("components.disclosureText.isActive")?this.show():this.hide()}},hide:function(){this.$el.hide()},show:function(){var e="detached"===this.model.get("videoViewState")?this.model.get("detachToSlider.components.disclosureText.text"):this.model.get("components.disclosureText.text");this.$el[0].innerHTML="",this.$el.append(this.disclosureText.replace("{text}",e)),this.$el.show()}});var si=o(999);class oi{constructor(e){this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:this.constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")})}setReportingObserver(e){if(!this.reportingObserver&&si.isObserverSupported("ReportingObserver")){var t={types:this.model.get("reportingObserver.types"),buffered:!0};this.reportingObserver=new ReportingObserver(e.bind(this),t),this.reportingObserver.observe(),this._bindUnloadEvents(e)}}_bindUnloadEvents(e){window.addEventListener("unload",(t=>{var i=this.reportingObserver.takeRecords();e(i)}))}}var ni=function(){var e;return function(t){return e||(e=new oi(t)),e}}();const ri=ni;var ai="data-cm-v-ad-id";class di{constructor(e,t){if(di.instance)return di.instance;this.viewabilityPercent=e/100,this.viewPercent100=t/100,this.threshold=[0,this.viewabilityPercent,this.viewPercent100,1],di.instance=this,this.elementsToObserve={},this.observerOptions={root:null,rootMargin:"0px",threshold:this.threshold},this.intersectionObserver=this._createObserver(this._observerCallback.bind(this),this.observerOptions)}_observerCallback(e){e.map((e=>{var t=e.intersectionRatio,i=e.target.getAttribute(ai),s=this.viewabilityPercent<=t,o=this.viewPercent100<=t;this.elementsToObserve[i].model.set("isViewableByOb",s),this.elementsToObserve[i].model.set("isViewableByOb100",o)}))}_createObserver(e,t){return new IntersectionObserver(e,t)}startObserverElement(e,t,i){e.setAttribute(ai,t),this.elementsToObserve[t]={element:e,model:i},this.elementsToObserve[t].model.set("isViewableByOb100",i.get("isViewable100")),this.intersectionObserver.observe(e)}stopObserveElement(e){this.intersectionObserver.unobserve(this.elementsToObserve[e].element),delete this.elementsToObserve[e]}stopObserver(){this.intersectionObserver.disconnect()}}var li=o(999);class hi extends E.O{constructor(e){if(super(),this.constructor===hi)throw new Error("Can't instantiate abstract class!");this.model=e.model,this.log=new y.Z({unitType:this.model.get("unitType"),className:this.constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.timers={},this.isAmp=this.model.get("frameType")===S.z.FRAME_TYPE.amp&&this.model.get("isUseAmpObserver"),this.onViewability=e.onViewability||function(){},this.isFirstUpdate=!0,this.traceViewabilitySeconds=this.model.get("traceViewabilitySeconds"),this.traceViewability100Seconds=this.model.get("traceViewability100Seconds"),this._startAdViewabilityObserver()}_startAdViewabilityObserver(){this.viewabilityObserverHelper=new di(this.model.get("viewabilityPercent")||50,this.model.get("100viewPercent")||100)}updateActiveAd(e){this.activeAdId!==e.adId&&(this.isFirstUpdate&&(this._bindEvents(),this.isFirstUpdate=!1),this.activeAd=e,(this.activeAdId||0===this.activeAdId)&&this.viewabilityObserverHelper.stopObserveElement(this.activeAdId),this.activeAdId=e.adId,this._startViewabilityObserverOfElement(e),this._initViewabilityHandler())}_startViewabilityObserverOfElement(e){var t=this._getElementForObserver(e),i=this.activeAdId,s=this.model;this.viewabilityObserverHelper.startObserverElement(t,i,s)}_getElementForObserver(e){var t=this._getWrapperElement(e);return this.model.get("isUseVideoElementForViewabilityObserver")?this._getAdVideoElementFromWrapper(t):t}_getWrapperElement(e){return e.vpaidWrapper.localTarget||e.vpaidWrapper.adTarget}_getAdVideoElementFromWrapper(e){return e.querySelector("video")}_initViewabilityHandler(){throw new Error("Abstract method!")}_bindEvents(){this.createStateHandlers([{event:"activeAdCurrentTime",funcName:"_checkViewability"},{event:"isViewableByOb:true",funcName:"_updateViewabilityTimes"},{event:"isViewableByOb100:true",funcName:"_update100ViewabilityTime"}])}_updateViewabilityTimes(){this._updateViewabilityTime(),this._updateOneSecViewabilityTime(),this._update100ViewabilityTime()}_updateViewabilityTime(){if(this.model.get("isViewableByOb")&&this.model.get("isInTab")){var e=this.model.get("activeAdCurrentTime");this.activeAdViewabilityTime=e+this.traceViewabilitySeconds}else this.activeAdViewabilityTime=void 0}_updateOneSecViewabilityTime(){if(this.model.get("isViewableByOb")&&this.model.get("isInTab")){var e=this.model.get("activeAdCurrentTime");this.activeAdOneSecViewabilityTime=e+1}else this.activeAdOneSecViewabilityTime=void 0}_update100ViewabilityTime(){if(this.model.get("isViewableByOb100")&&this.model.get("isInTab")){var e=this.model.get("activeAdCurrentTime");this.activeAd100ViewabilityTime=e+this.traceViewability100Seconds}else this.activeAd100ViewabilityTime=void 0}_checkViewability(){if(this.activeAd){var e=this.model.get("activeAdCurrentTime");this._checkNormalViewability(e),this._checkOneSecViewability(e),this._check100Viewability(e)}}_checkNormalViewability(e){var t=this.model.get("activeAdData")?this.model.get("activeAdData").mediatype:void 0,i=this.model.get("mediatypesArraySkippingViewableCheckAtSendOppMoment"),s=this.model.get("isViewableByOb");i&&t&&i.includes(t)&&(s=!0),this._testViewability(s,e,this.activeAdViewabilityTime,this.activeAd.isViewed)&&this._onViewability()}_checkOneSecViewability(e){this._testViewability(this.model.get("isViewableByOb"),e,this.activeAdOneSecViewabilityTime,this.activeAd.isViewedOneS)&&this._onViewabilityOneS()}_check100Viewability(e){this._testViewability(this.model.get("isViewableByOb100"),e,this.activeAd100ViewabilityTime,this.activeAd.isViewed100)&&this._onViewability100()}_testViewability(e,t,i,s){return e&&t>=i&&!s}_onViewability(){this.activeAd&&(this.activeAd.onViewability(),li.dispatchTRC(j.Z.storiesUnitState.videoViewable,this.model),this.onViewability())}_onViewabilityOneS(){this.activeAd&&this.activeAd.onViewabilityOneS()}_onViewability100(){this.activeAd&&this.activeAd.onViewability100()}}const ci=hi;class ui extends ci{constructor(e){super(e)}_initViewabilityHandler(){this._bindPlay()}_bindPlay(){this.model.get("adState")!==j.Z.adState.playing?this.createStateHandlers([{event:"adState:".concat(j.Z.adState.playing),funcName:"_startTestingViewability",isListenOnce:!0}]):this._startTestingViewability()}_startTestingViewability(){this._updateViewabilityTimes(),this._checkViewability(),this._bindPause()}_bindPause(){this.model.get("adState")!==j.Z.adState.paused?this.createStateHandlers([{event:"adState:".concat(j.Z.adState.paused),funcName:"_stopAllViewability",isListenOnce:!0}]):this._stopAllViewability()}_stopAllViewability(){this._bindPlay()}}class gi extends ci{constructor(e){super(e)}_initViewabilityHandler(){this._startViewabilityTimers()}_startViewabilityTimers(){this.model.get("isViewableByOb")?this._startViewabilityTime():this.createStateHandlers([{event:["isViewableByOb:true","isInTab:true"],funcName:"_startViewabilityTime"},{event:"isViewableByOb:false",funcName:"_clearViewabilityTime"}]),this.model.get("isViewableByOb100")&&this._startViewability100Time(),this.createStateHandlers([{event:["isViewableByOb100:true","isInTab:true"],funcName:"_startViewability100Time"},{event:"isViewable100:false",funcName:"_clearViewability100"},{event:"adState:".concat(j.Z.adState.paused),funcName:"clearAllViewabilityTimers",isListenOnce:!0},{event:"isInTab:false",funcName:"_clearViewabilityTime"}])}_startViewabilityTime(){this.activeAd&&!this.activeAd.isViewed&&(this._startViewabilityTimer(S.z.TIMER_NAMES.viewability,this._onViewability.bind(this),this.traceViewabilitySeconds),this._startViewabilityTimer(S.z.TIMER_NAMES.viewabilityOneS,this._onViewabilityOneS.bind(this),1))}_startViewabilityTimer(e,t,i){this.timers[e]||(this.timers[e]=setTimeout(t,1e3*i))}_onViewability(){this.timers[S.z.TIMER_NAMES.viewability]=void 0,this.activeAd.onViewability()}_startViewability100Time(){this.activeAd&&!this.activeAd.isViewed&&this._startViewabilityTimer(S.z.TIMER_NAMES.viewability100,this._onViewability100.bind(this),this.traceViewability100Seconds)}_startViewabilityAMPTime(){this.activeAd&&!this.activeAd.isViewed&&this._startViewabilityTimer(S.z.TIMER_NAMES.viewabilityAMP,this._onViewabilityAMP.bind(this),this.traceViewabilitySeconds)}clearAllViewabilityTimers(){this._clearViewabilityTime(),this._clearViewability100()}_clearViewabilityTime(){this._clearViewabilityTimer(S.z.TIMER_NAMES.viewability),this._clearViewabilityTimer(S.z.TIMER_NAMES.viewabilityOneS)}_clearViewability100(){this._clearViewabilityTimer(S.z.TIMER_NAMES.viewability100)}_clearViewabilityAMP(){this._clearViewabilityTimer(S.z.TIMER_NAMES.viewabilityAMP)}_clearViewabilityTimer(e){this.timers[e]&&(clearTimeout(this.timers[e]),this.timers[e]=void 0)}_onViewabilityOneS(){this.timers[S.z.TIMER_NAMES.viewabilityOneS]=void 0,this.activeAd.onViewabilityOneS()}_onViewability100(){this.timers[S.z.TIMER_NAMES.viewability100]=void 0,this.activeAd.onViewability100()}_onViewabilityAMP(){this.timers[S.z.TIMER_NAMES.viewabilityAMP]=void 0,this.activeAd.onViewability()}}class mi{constructor(){this.cache={}}getViewabilityService(e){var{model:t,ad:i,onViewabilityCallback:s}=e,o=i.supportVideoCurrentTimeEvents&&t.get("isUseNewViewabilityCalc")?ui:gi,n=this.cache[o];return n||(this.cache[o]=n=new o({model:t,onViewability:s})),n}}var pi=o(999),vi=pi.now().toString(),fi=function(){this.activeAd&&(this.activeAd.unmute(),this.currModel.set("volumeMuted",!1))},bi=function(){this.activeAd&&(this.activeAd.mute(),this.currModel.set("volumeMuted",!0))},_i={video:"._cm-video-ad"};class Si extends E.s{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"VideoView",i=arguments.length>2?arguments[2]:void 0;super(e),this.eligibilityService=e.eligibilityService||{},this.log=new y.Z({unitType:this.model.get("unitType"),className:t,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.model.set("videoAdId",this.videoAdId),this.ad=e.adjs,this.currModel=i||this.model,this._setVolumeAnimationTrigger(),this._bindEvents(),this._bindBlockedByExternalUnitChange(),this._initPerformanceMonitor(),this._viewabilitySerivcesFactory=new mi}_bindEvents(){}_initPerformanceMonitor(){this.currModel.get("reportingObserver.isActive")&&(this.performanceMonitor=new ri(this.currModel),this.performanceMonitor.setReportingObserver(this.reportingObserverCB.bind(this)))}reportingObserverCB(e){var t=this.currModel.get("reportingObserver.ids");t&&t.length>0&&(e=pi.filter(e,(e=>e.body&&e.body.id&&pi.contains(t,e.body.id)))),this.activeAd?pi.forEach(e,(e=>{this._setReportingObserverAdData(e),this.activeAd.oppsService.fireBeaconOpp("reportingObserver")})):this.model.get("pixels.reportingObserver.isFire")&&this._fireReportObserverPixel(e)}_setReportingObserverAdData(e){this.activeAd.adData.rot=e.type,this.activeAd.adData.roid=e.body&&e.body.id,this.activeAd.adData.rom=e.body&&e.body.message}_fireReportObserverPixel(e){pi.forEach(e,(e=>{var t={debug:"rot:".concat(e.type,"!roid:").concat(e.body.id,"!rom:").concat(e.body.message,"!")},i=this.model.getPixel("pixels.reportingObserver"),s=pi.addParametersToUrl(i,t,-1===i.indexOf("?"));pi.isSendBeaconSupported()&&navigator.sendBeacon(s)}))}_setVolumeEvents(){this.currModel.on("change:volumeMuted",this._handleVolume.bind(this)),this.currModel.get("autoplaySoundOn")?(this._bindOnHoverListeners(),this.checkVolumeStatus()):this.createStateHandlers([{event:"autoplaySoundOn:true",funcName:"_bindOnHoverListeners",isListenOnce:!0},{event:"autoplaySoundOn:true",funcName:"checkVolumeStatus",isListenOnce:!0}])}checkVolumeStatus(){this.currModel.get("autoplaySoundOn")&&"on"===this.currModel.get("volume")?(this.log.info("Unmute first video because volume=on"),this.currModel.set("volumeMuted",!1)):this.currModel.set("volumeMuted",!0)}hide(){this.$el.hide()}show(){this.$el.show()}close(){this.model.set("closeState",j.Z.closeState.videoViewClosed)}_customize(){var e=this.model.get("additionalCss");this.$el.css(pi.toCssObj(e))}_rePosition(e,t){this.$el.css(t)}_onLoadingClick(){this.ui.video[0].id=this.videoAdId,this.replayAd()}replayAd(){this.model.get("isReplayAd")&&this.repeatingAd&&(this.activeAd=this.repeatingAd,this.activeAd.vpaidWrapper.restartAd(),this._resizeRepeatingAd(),this.activeAd.setToModel("adQState",j.Z.adQState.repeating,this.repeatingAd.adId),this.activeAd.setToModel("adState",j.Z.adState.repeating,this.repeatingAd.adId)),this.model.set("isAdClosedByTimer",!1)}_onDisplayingFullNAS(){this.activeAd&&this.activeAd.onDisplayingFullNAS()}_onDisplayingNASTitleOnly(){this.activeAd&&this.activeAd.onDisplayingNASTitleOnly()}_setNasOppEvents(){this.model.listenTo(this.model,"displayingFullNAS",this._onDisplayingFullNAS.bind(this)),this.model.listenTo(this.model,"displayingNASTitleOnly",this._onDisplayingNASTitleOnly.bind(this))}_handleVolume(){this.activeAd&&(this.currModel.get("volumeMuted")?this.activeAd.mute():this.activeAd.unmute())}get id(){return"_cm-css-reset"}get videoAdId(){return vi}get ui(){return this.UI?this.UI:this.UI=_i}set ui(e){return this.UI=e}get _onMouseEnter(){return fi}get _onMouseLeave(){return bi}onAdComplete(){this.setRepeatingAd(),this.activeAd=void 0,this.model.get("isMultiAd")?this.checkEligible():this.model.set("closeState",j.Z.closeState.terminate)}checkEligible(){this.model.get("isInTab")&&this.isEligibleToPlay()?(this.activeAd||this.getReadyAd(),this.activeAd&&this.playAd()):this.activeAd&&this.activeAd.pause(S.z.PAUSE_REASONS.LOST_ELIGIBILITY)}isEligibleToPlay(){return this.model.get("isEligibleToPlay")}getReadyAd(){this.model.get("hasReadyAd")&&(this._onPostRepeatImpression(),this.model.get("volumeMuted")||this.model.get("wurfl.os.name")!==S.z.OS.IOS||this.model.set("volumeMuted",!0),this.activeAd=this.model.getNextAd(),this.activeAd&&-1===this.model.get("unitType").indexOf("RECO_REEL_WIDGET")&&this.model.set("aspectRatioNum",this.activeAd.getAspectRatioNum()),this.postGetAd())}onGotRVAd(){this.currModel.get("hasReadyAd")&&this.currModel.get("isNextAdRV")&&!this.isCurrentAdRV&&(this.activeAd&&this.isEligibleToPlay()?this.swapToNewReadyAd():this.hadPossibleRV=!0)}swapToNewReadyAd(){this.isSwappedAd=!0,this.swappedAd=this.activeAd,this.swappedAd.onAdSwappedOut(),this.pauseAd(S.z.PAUSE_REASONS.AD_SWAPPED),this.getReadyAd(),this._swapNativeAdSettings(),setTimeout((()=>{this.activeAd.onAdSwappedIn()}),0)}_swapNativeAdSettings(){this.nativeAdSettings&&this.nativeAdSettings.onAdSwapped()}hasReadyAdChangeSubUnit(){this.log.info("hasReadyAdChangeSubUnit",this.globalModel.get("hasReadyAd")),!this.isRepeatMode&&this.globalModel.get("hasReadyAd")&&this.isEligibleToPlay()&&this.getReadyAd()}setRepeatMode(e){this.isRepeatMode=e}postGetAd(){}playAd(){this.log.info("@@play ad",this.model.get("unitType")),this.activeAd&&(this.log.info("Play Ad !!!!",this.activeAd),this.activeAd.play(),this.activeAd.isUsed||(this.activeAd.isUsed=!0),this.model.get("components.volume.isActive")&&setTimeout(this._fireVolumeStateCheck.bind(this),0),this.viewabiltyService=this._viewabilitySerivcesFactory.getViewabilityService({model:this.model,ad:this.activeAd,onViewabilityCallback:this._onViewability.bind(this)}),this.viewabiltyService.updateActiveAd(this.activeAd))}pauseAd(e){this.activeAd&&this.activeAd.pause(e)}_onViewability(){this.log.info("Viewability reached"),this.stickyViewCallback&&this.stickyViewCallback()}_addDisclosureText(){(this.model.get("components.disclosureText.isActive")||this.model.get("detachToSlider.components.disclosureText.isActive"))&&(this.disclosureTextView=new ii({model:this.model,container:this.el}),this.disclosureTextView.render())}_fireVolumeStateCheck(){this._startAnimationOnce(),this._handleVolume(),this.currModel.trigger("lastVolumeStateCheck")}_setVolumeAnimationTrigger(){this._startAnimationOnce=pi.once((()=>{this.currModel.trigger("startVolumeAnimation")}))}_unBindOnHoverListeners(){this.el.removeEventListener("mouseenter",this._onMouseEnter.bind(this)),this.el.removeEventListener("mouseleave",this._onMouseLeave.bind(this))}_bindOnHoverListeners(){this.currModel.get("autoplaySoundOn")&&"onHover"===this.currModel.get("volume")&&!this.currModel.get("volumeUserInteraction")&&(this.el.addEventListener("mouseenter",this._onMouseEnter.bind(this)),this.el.addEventListener("mouseleave",this._onMouseLeave.bind(this)),this.currModel.on("change:volumeUserInteraction",this._unBindOnHoverListeners.bind(this)))}setRepeatingAd(){this.model.get("isReplayAd")&&this.activeAd&&this.activeAd.vpaidWrapper.isReplayable?this.repeatingAd=this.activeAd:this.repeatingAd=null}_bindBlockedByExternalUnitChange(){this.currModel.on("change:blockedByExternalUnit",this._onBlockedByExternalUnitChange.bind(this))}_onBlockedByExternalUnitChange(){this.currModel.get("blockedByExternalUnit")?(this.pauseAd(S.z.PAUSE_REASONS.BLOCKED_BY_EXTERNAL_UNIT),this.activeAd&&this.activeAd.fireAdOppOnce("adPausedOtherUnitIsPlaying")):this.checkEligible()}_resizeRepeatingAd(){setTimeout((()=>{var e=this.isDetached?this.model.get("detachToSlider.width"):this.model.get("width"),t=this.isDetached?this.model.get("detachToSlider.height"):this.model.get("height");this.activeAd.vpaidWrapper.resizeAd(e,t)}),0)}_onPostRepeatImpression(){this.repeatingAd&&(this.repeatingAd.vpaidWrapper&&this.repeatingAd.vpaidWrapper.stop&&this.repeatingAd.vpaidWrapper.stop("post_repeat"),this.repeatingAd=null,this.activeAd=null)}}const yi=Si;const Ai='<div id="_cm-css-reset" class="_cm-repeat-div"> <div class="_cm-repeat-view-wrapper"> <div class="_cm-repeat-buttons-wrapper"> <img class="_cm-repeat-button"/> <img class="_cm-repeat-button-hover"/> </div> <div class="_cm-learn-more-buttons-wrapper"> <img class="_cm-learn-more-button"/> <img class="_cm-learn-more-button-hover"/> </div> </div> </div> ',Ti={JP:!0};var wi=o(316),Ci=o(84),Pi=o(999);const Ei=wi.View.extend({className:"_cm-loading",id:"_cm-css-reset",initialize:function(e){this.log=new y.Z({unitType:"Component",className:"LoadingView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),e.globalModel&&(this.globalModel=e.globalModel),this.container=e.container,this.isShowReplayScreen=e.isStartWithReplay,this.isReplayable=e.isReplayable,this._createStatesAction(),this._bindEvents(),this.render()},_bindEvents:function(){this.listenTo(this.model,"change:adQState",this._onAdStateChange.bind(this,this.adStateActions)),this.listenTo(this.model,"change:adManagerState",this._onAdStateChange.bind(this,this.getAdStateActions)),this.model.on("change:viewTopComponent",this._toggleLoadingVisibility,this),this.model.on("change:repeatState",this._onReplayAdShowing,this),this.globalModel&&this.listenTo(this.globalModel,"change:adManagerState",this._onGlobalModelAdStateChange.bind(this,this.getAdStateActions))},_createStatesAction:function(){this.adStateActions={q0:this._onAdPlaying.bind(this),completed:this._onVideoComplete.bind(this),stopped:this._stop.bind(this)},this.getAdStateActions={stopped:this._stop.bind(this)}},_onGlobalModelAdStateChange:function(e,t,i){if(i==j.Z.adManagerState.stopped){var s=e[i];s&&s()}},_onAdStateChange:function(e,t,i){var s=e[i];s&&s()},render:function(){this.$el.append('<div class="_cm-loading-div"></div> '),this.loadingDiv=this.$el.find("._cm-loading-div"),"css"==this.model.get("components.Loading.type")?this.loadCss():"img"==this.model.get("components.Loading.type")&&this.loadImage(),this._applyAdditionalCss(),this.isShowReplayScreen&&this.$el.css("background","transparent"),this.$el.hide(),this.container.appendChild(this.el),this._renderReapet(),this.currentActiveImage=this.innerDisplay},_renderReapet(){this.repeatEl=Ci(Ai),this._setBackground(),this._setRepeatIcon(),this.learnMoreWrapper=this.repeatEl.find("._cm-learn-more-buttons-wrapper"),this.learnMoreWrapper.hide(),this.model.get("renderLearnMore")&&this._setLearnMoreIcon(),this.repeatEl.hide(),this.loadingDiv.append(this.repeatEl)},_setRepeatIcon(){this.repeatViewWrapper=this.repeatEl.find("._cm-repeat-view-wrapper"),this.repeatButtonsWrapper=this.repeatEl.find("._cm-repeat-buttons-wrapper");var e,t,i=this.repeatEl.find("._cm-repeat-button"),s=this.repeatEl.find("._cm-repeat-button-hover");this._isTranslationExist()?(e=this.model.get("components.Repeat.replayIconByLang"),t=this.model.get("components.Repeat.replayHoverIconByLang")):(e=this.model.get("components.Repeat.replayIcon"),t=this.model.get("components.Repeat.replayHoverIcon")),this._setButtonSrc(i,s,e,t)},_setLearnMoreIcon(){var e,t,i=this.repeatEl.find("._cm-learn-more-button"),s=this.repeatEl.find("._cm-learn-more-button-hover");this._isTranslationExist()?(e=this.model.get("components.Repeat.learnMoreIconByLang"),t=this.model.get("components.Repeat.learnMoreHoverIconByLang")):(e=this.model.get("components.Repeat.learnMoreIcon"),t=this.model.get("components.Repeat.learnMoreHoverIcon")),this._setButtonSrc(i,s,e,t),this.model.get("adClickThroughUrl")?this.repeatEl.click(this._onLearnMoreClick.bind(this)):this.listenTo(this.model,"change:adClickThroughUrl",this._updateLearnMoreUrl)},_isTranslationExist(){return this.model.get("components.Repeat.isTranslateText")&&this.model.get("language")&&Ti[this.model.get("language").toUpperCase()]},_setButtonSrc(e,t,i,s){e.attr("src",i),t.attr("src",s)},_setBackground(){var e=this.model.get("components.Repeat.backgroundImage");this.repeatEl.css("background-image",'url("'+e+'") !important')},loadCss:function(){var e=document.createElement("div");e.className="_cm-loading-icon",this.loadingDiv.append(e),this.innerDisplay=Ci(e)},loadImage:function(){var e=document.createElement("img");e.src=this.model.get("components.Loading.imgUrl"),e.className="_cm_loader_img",this.loadingDiv.append(e),this.innerDisplay=Ci(e)},hide:function(){this.isRepeatShowing=!1,this.$el.hide(),this._setModel("loadingViewState",j.Z.loadingViewState.hiding)},show:function(){this.isShowReplayScreen&&this._showRe(),this.$el.show(),this._setLoadingViewSize(this.currentActiveImage.width(),this.currentActiveImage.height()),this._setModel("loadingViewState",j.Z.loadingViewState.showing)},showRepeat:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._stop(e),this.globalModel.increaseCounter("repeatShown")},_onRepeatClick:function(e){e.stopPropagation(),this.log.info("User click"),this.clickEventRegistered=!1,this._setModel("loadingViewState",j.Z.loadingViewState.clicked),this.repeatEl.hide(),this.innerDisplay.show(),this.currentActiveImage=this.innerDisplay,this._setLoadingViewSize(this.currentActiveImage.width(),this.currentActiveImage.height())},_onLearnMoreClick(e){Pi.clickThru.call(this,this.model.get("adClickThroughUrl")),this._triggerModel("change:learnMoreClick",this.learnMoreWrapper),this.model.increaseCounter("learnMoreWasClicked",!0)},_onAdPlaying:function(){this.hide()},_onVideoComplete:function(){var e=this.model.get("activeAdData");this.model.get("displayFiller.betweenAds")!==S.z.DISPLAY_FILLER.BETWEEN_ADS.CONTENT&&e&&!e.singleAd&&this.show()},_stop(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.model.get("isAdClosedByTimer")||this.model.get("closeState")||(this.clickEventRegistered||(this.repeatButtonsWrapper.one("click",this._onRepeatClick.bind(this)),this.clickEventRegistered=!0),this.show(),this.innerDisplay.hide(),this.currentActiveImage=this.repeatEl,this._setLoadingViewSize("auto","auto"),this.learnMoreWrapper&&this.model.get("adClickThroughUrl")&&this.model.get("renderLearnMore")&&this.learnMoreWrapper.show(),this.isReplayable||this.repeatButtonsWrapper.hide(),e&&this.repeatViewWrapper.addClass("_cm-repeat-view-wrapper-detached"),this.repeatEl.show())},_showRe(){this.isRepeatShowing||(this.innerDisplay.hide(),this.clickEventRegistered||(this.repeatButtonsWrapper.one("click",this._onRepeatClick.bind(this)),this.clickEventRegistered=!0),this.currentActiveImage=this.repeatEl,this._setLoadingViewSize("auto","auto"),this.learnMoreWrapper&&this.model.get("adClickThroughUrl")&&this.model.get("renderLearnMore")&&this.learnMoreWrapper.show(),this.isReplayable||this.repeatButtonsWrapper.hide(),this.repeatEl.show(),this.isRepeatShowing=!0)},_setLoadingViewSize(e,t){this.loadingDiv.css({width:e,height:t})},_setModel(e,t){this.globalModel&&this.globalModel.set(e,t),this.model.set(e,t)},_triggerModel(e,t){this.globalModel&&this.globalModel.trigger(e,t),this.model.trigger(e,t)},_applyAdditionalCss(){var e=this.model.get("additionalCss");e&&((e["z-index"]||e.zIndex)&&this.$el.css({"z-index":e["z-index"]}))},_updateLearnMoreUrl(){this.model.get("adClickThroughUrl")&&(this.repeatEl.click(this._onLearnMoreClick.bind(this)),this.learnMoreWrapper.show())},_toggleLoadingVisibility(){var e=this.model.get("viewTopComponent");this.log.info("_onTopComponentChange",e),e===S.z.FLOATING_VIEW_TOP_COMPONENT.loading?this.show():this.hide()},_onReplayAdShowing:function(){this.model.get("repeatState")===j.Z.repeatState.showing&&this.hide()},resize(e){this._isLoadingViewDisplayed()&&this.loadingDiv.css(e)},onAttach(){this._isLoadingViewDisplayed()&&this.repeatViewWrapper.removeClass("_cm-repeat-view-wrapper-detached")},_isLoadingViewDisplayed(){return this.model.get("loadingViewState")===j.Z.loadingViewState.showing}});var Ii=o(316),Oi=o(84),Vi=o(999);const Ni=Ii.View.extend({className:"_cm-repeat",id:"_cm-css-reset",initialize:function(e){this.log=new y.Z({unitType:"Component",className:"RepeatView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.container=e.container,this.active=!1,this._createStatesAction(),this._bindEvents(),this._render()},_render(){this.repeatEl=Oi(Ai),this._setRepeatIcon(),this.learnMoreWrapper=this.repeatEl.find("._cm-learn-more-buttons-wrapper"),this.learnMoreWrapper.hide(),this.model.get("renderLearnMore")&&this._setLearnMoreIcon(),this._setBackground(),this.$el.hide(),this.$el.append(this.repeatEl),this.container.appendChild(this.el)},_setRepeatIcon(){this.repeatWrapper=this.repeatEl.find("._cm-repeat-buttons-wrapper");var e,t,i=this.repeatEl.find("._cm-repeat-button"),s=this.repeatEl.find("._cm-repeat-button-hover");this._isTranslationExist()?(e=this.model.get("components.Repeat.replayIconByLang"),t=this.model.get("components.Repeat.replayHoverIconByLang")):(e=this.model.get("components.Repeat.replayIcon"),t=this.model.get("components.Repeat.replayHoverIcon")),this._setButtonSrc(i,s,e,t),this.repeatWrapper.click(this._onClick.bind(this))},_setLearnMoreIcon(){var e,t,i=this.repeatEl.find("._cm-learn-more-button"),s=this.repeatEl.find("._cm-learn-more-button-hover");this._isTranslationExist()?(e=this.model.get("components.Repeat.learnMoreIconByLang"),t=this.model.get("components.Repeat.learnMoreHoverIconByLang")):(e=this.model.get("components.Repeat.learnMoreIcon"),t=this.model.get("components.Repeat.learnMoreHoverIcon")),this._setButtonSrc(i,s,e,t),this.model.get("adClickThroughUrl")?this.learnMoreWrapper.click(this._onLearnMoreClick.bind(this)):this.listenTo(this.model,"change:adClickThroughUrl",this._updateLearnMoreUrl)},_isTranslationExist(){return this.model.get("components.Repeat.isTranslateText")&&this.model.get("language")&&Ti[this.model.get("language").toUpperCase()]},_setButtonSrc(e,t,i,s){e.attr("src",i),t.attr("src",s)},_setBackground(){var e=this.model.get("components.Repeat.backgroundImage");this.repeatEl.css("background-image",'url("'+e+'") !important')},hide:function(){this.$el.hide(),this.active=!1,this.isSpinning=!1,this.model.set("repeatState",j.Z.repeatState.hiding)},show:function(){this.learnMoreWrapper&&this.model.get("adClickThroughUrl")&&this.model.get("renderLearnMore")&&this.learnMoreWrapper.show(),this.repeatWrapper&&this.model.get("dontRenderRepeatButton")&&this.repeatWrapper.hide(),this.$el.show(),this.active=!0,this.model.set("repeatState",j.Z.repeatState.showing)},_bindEvents:function(){this.listenTo(this.model,"change:adQState",this._onAdStateChange)},_onClick:function(e){e.stopPropagation(),this.isSpinning||this.model.getPixel&&Vi.firePixel(this.model.getPixel("pixels.repeatClick"),"repeat click Pixel"),this.model.set("repeatState",j.Z.repeatState.clicked),this.trigger("cm:repeat:click")},_createStatesAction:function(){this.adStateActions={q0:this._onAdPlaying.bind(this),completed:this._onVideoComplete.bind(this),repeating:this._onAdPlaying.bind(this)}},_onAdStateChange:function(e,t){var i=this.adStateActions[t];i&&i()},_onAdPlaying:function(){setTimeout((()=>{this.hide()}),100)},_onVideoComplete:function(){this.model.get("isReplayAd")&&this.show()},_onLearnMoreClick(e){Vi.clickThru.call(this,this.model.get("adClickThroughUrl")),this.model.increaseCounter("learnMoreWasClicked",!0)},_updateLearnMoreUrl(){this.model.get("adClickThroughUrl")&&(this.learnMoreWrapper.click(this._onLearnMoreClick.bind(this)),this.learnMoreWrapper.show())},addAdditionalCss(e){Oi(this.repeatEl).addClass(e)}});const Di='<?xml version="1.0" encoding="utf-8"?> <svg version="1.1" id="_x2014__x5F_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 99 99" xml:space="preserve"> <style>.st0{fill:#fff}</style> <g> <g stroke="null" id="svg_1"> <g stroke="null" id="svg_2"> <path stroke="null" id="svg_3" d="m82.77256,91.4817c-1.64243,0 -3.25444,-0.644 -4.50148,-1.9964l-65.57555,-69.42328c-2.49406,-2.6404 -2.49406,-6.92301 0,-9.56341c2.49406,-2.6404 6.53931,-2.6404 9.03337,0l65.57555,69.45548c2.49406,2.6404 2.49406,6.92301 0,9.56341c-1.24703,1.3202 -2.88946,1.9642 -4.53189,1.9642z" class="st0"/> </g> <g stroke="null" id="svg_4"> <path stroke="null" id="svg_5" d="m17.19702,91.4817c-1.64243,0 -3.25444,-0.644 -4.50148,-1.9964c-2.49406,-2.6404 -2.49406,-6.92301 0,-9.56341l65.57555,-69.42328c2.49406,-2.6404 6.53931,-2.6404 9.03337,0c2.49406,2.6404 2.49406,6.92301 0,9.56341l-65.57555,69.45548c-1.24703,1.3202 -2.88946,1.9642 -4.53189,1.9642z" class="st0"/> </g> </g> </g> </svg> ';var Ri=o(316),Mi=o(999);const xi=Ri.View.extend({className:"_cm-close-area",id:"_cm-close-area",closeButtonRenderd:!1,events:{"click ":"_onClick"},initialize:function(e){this.log=new y.Z({unitType:e.unitType,className:"closeButtonView",version:e.model.get("version"),isDebug:e.model.get("isDebug")}),this.container=e.container,this._rendered=!1,this._bindEvents(),this.createStateHandlers=ti.L,this.render(),this.hide()},render:function(){this._rendered||(this._rendered=!0,this.isInDelay=!1,this.$el.append(Di),this.container.appendChild(this.el))},_bindEvents:function(){this.listenTo(this.model,"change:state",this._onStateChange),this.listenTo(this.model,"change:adState",this._onStateChange),(this.model.get("detachToSlider.isStartFromSlider")||this.model.get("detachToSlider.isDetachToSlider"))&&this.model.get("detachToSlider.hasCloseButton")&&this.listenTo(this.model,"change:videoViewState",this._onVideoViewStateChange)},_onPlaying:function(){this.model.get("videoViewState")!==j.Z.videoViewState.attached||this.model.get("hasCloseButton")?this._startRender():this.isInDelay&&(this.closeButtonRenderd=!1,clearTimeout(this.delayTimeout))},_startRender:function(){if(this.closeButtonRenderd)this.show();else{this.closeButtonRenderd=!0;var e=this.model.get("components.CloseButtonView.delay");this.isInDelay=!0,this.delayTimeout=setTimeout(this.render.bind(this),e)}},_onClick:function(){this.model.get("onClose")||"OMNI_TAG"==this.model.get("unitType")||Mi.firePixel(this.model.getPixel("pixels.close"),"close (user clicked the close button)"),this.model.set("state",this.model.STATE.STOPPED_BY_USER),Ri.trigger("Ad:stoppedByUser"),this.model.trigger("ad:stoppedByUser")},_onStateChange:function(e,t){if("playing"===t)this._onPlaying()},_onVideoViewStateChange:function(e,t){"detached"===t&&!this.closeButtonRenderd&&this.model.get("detachToSlider.hasCloseButton")&&this._startRender(),"attached"!==t||this.model.get("hasCloseButton")||this.hide()},hide:function(){this.$el.hide()},show:function(){this.$el.show()}});var Fi=o(316),Li=o(999),Bi=o(84),ki={display:"inline !important"},Ui={display:"none !important"},zi={transition:"width 2000ms !important",width:"32px !important"},Hi={width:"32px !important"};const Wi=Fi.View.extend({className:"_cm-volume-area",id:"_cm-css-reset",events:{click:"_toggleVolume"},initialize(e){this._setInitialParameters(e),this._isHandleDetach(),this._hasCloseButton(),this._initVolumeState(),this._createStatesAction(),this._setMinimizeOnClickCallback(),this._bindEvents(),this.render(),this.log.info("Volume Button initialized.")},_bindEvents(){this.listenTo(this.currModel,"change:volumeMuted",this._onVolumeChange.bind(this)),this.listenTo(this.currModel,"startVolumeAnimation",this._minimizeAfterRender.bind(this)),this._handleDetach&&this.listenTo(this.model,"change:videoViewState",this._handleVideoViewState.bind(this)),this.currModel.on("lastVolumeStateCheck",this._onLastVolumeStateCheck,this),this.model.on("change:viewTopComponent",this.setButtonVisible,this),this.listenTo(this.model,"change:adQState",this._onAdStateChange),this.model.on("showVolumeButtonOnBackFromSwap",this.show,this)},_setComponentsVisibilityListener(){this.model.on("change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange,this),this.model.get(this.componentsVisibilityListener)||this.hide()},render(){this._initTemplate(),this._setPosition(),this._styleCustomization(),this._checkIfMinimized(),this._renderComponent()},_initTemplate(){var e=Li.template('<div class="_cm-volume-border"> <svg class="_cm-volume-mute" data-name="_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 351.22 266.75"> <defs> <style>.cls-1{fill:#fff}</style> </defs> <g id="_Group_" data-name="&lt;Group&gt;"> <g id="_Group_2" data-name="&lt;Group&gt;"> <path class="cls-1" d="M338,185.84c-.48-3.15-1.39-6.11-5.31-7.4H330c-3.63.93-6.33,3-8.93,5.29L249.59,246H170.26c-7.93,0-14.35,5.59-14.35,12.5V370.1c0,6.9,6.42,12.5,14.35,12.5h85.1l66.91,58.27a19,19,0,0,0,6,3.71c3.92,1.44,7.13.29,8.73-3.12a14.33,14.33,0,0,0,1.22-6.29V189.22A22.39,22.39,0,0,0,338,185.84Z" transform="translate(-155.91 -178.44)"/> </g> </g> <path class="cls-1" d="M486.13,381.62a20.93,20.93,0,0,1-14.85-6.15l-97.62-97.62a21,21,0,1,1,29.69-29.7L501,345.77a21,21,0,0,1-14.85,35.85Z" transform="translate(-155.91 -178.44)"/> <path class="cls-1" d="M388.5,381.62a21,21,0,0,1-14.84-35.85l97.62-97.62a21,21,0,1,1,29.7,29.7l-97.63,97.62A20.93,20.93,0,0,1,388.5,381.62Z" transform="translate(-155.91 -178.44)"/> </svg> <svg class="_cm-volume-unmute" data-name="_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 311.81 266.75"> <defs> <style>.cls-1{fill:#fff}</style> </defs> <g id="_Group_" data-name="&lt;Group&gt;"> <path id="_Path_" data-name="&lt;Path&gt;" class="cls-1" d="M465.85,290.12A124.1,124.1,0,0,0,453.19,253a127.55,127.55,0,0,0-21.66-29.51c-3.38-3.47-7.4-5.23-12.25-4.6a13.27,13.27,0,0,0-11.5,9.27c-1.87,5.38-.66,10.26,3.23,14.43,1,1.05,2,2,2.95,3.1a96.67,96.67,0,0,1,25.09,55.19,95.28,95.28,0,0,1-1.17,29.52,96.57,96.57,0,0,1-26.52,50.23,13.74,13.74,0,0,0-4.23,12.12,13.25,13.25,0,0,0,9.2,11.27c5.3,1.85,10.15.74,14.31-3.08.82-.74,1.57-1.56,2.33-2.36a125,125,0,0,0,34.74-87.88A131.18,131.18,0,0,0,465.85,290.12Z" transform="translate(-155.91 -178.44)"/> <path id="_Path_2" data-name="&lt;Path&gt;" class="cls-1" d="M420.23,307.35a87,87,0,0,0-6.32-28.82A88,88,0,0,0,395,249.69a14,14,0,0,0-24.29,11.22,16.39,16.39,0,0,0,4.73,8.92c13.86,14.79,19.22,32.3,16.05,52.27a58.5,58.5,0,0,1-16.83,32.54A14,14,0,0,0,388.48,378c3.13-.88,5.44-2.88,7.6-5.18,16.05-17.16,23.94-37.57,24.15-61C420.23,310.31,420.29,308.83,420.23,307.35Z" transform="translate(-155.91 -178.44)"/> <path id="_Path_3" data-name="&lt;Path&gt;" class="cls-1" d="M338,185.84c-.48-3.15-1.39-6.11-5.31-7.4H330c-3.63.93-6.33,3-8.93,5.29L249.59,246H170.26c-7.93,0-14.35,5.59-14.35,12.5V370.1c0,6.9,6.42,12.5,14.35,12.5h85.1l66.91,58.27a19,19,0,0,0,6,3.71c3.92,1.44,7.13.29,8.73-3.12a14.33,14.33,0,0,0,1.22-6.29V189.22A22.39,22.39,0,0,0,338,185.84Z" transform="translate(-155.91 -178.44)"/> </g> </svg> <div class="_cm-volume-text">{{expandedText}}</div> </div> ')(this._settings);this.$el.append(e)},_renderComponent(){var e=this.model.get("wurfl.browser.name");e===S.z.BROWSER.IE||e===S.z.BROWSER.EDGE?setTimeout((()=>{Bi(this.container).append(this.el)}),200):Bi(this.container).append(this.el)},_setInitialParameters(e){this.log=new y.Z({unitType:this.model.get("unitType"),className:"volumeButtonView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.container=e.container,this.currModel=e.globalModel?e.globalModel:this.model,this._settings=this.model.get("components.volume"),this._isMuted=!0,this._unitType=S.z.UNIT_TYPES[this.model.get("unitType")],this._isAlwaysBottom=this.model.get("components.volume.isAlwaysBottom"),this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener()},_initVolumeState(){void 0===this.currModel.get("volumeMuted")&&this.currModel.set("volumeMuted",!0)},_setMinimizeOnClickCallback(){this._minimizeOnClick=Li.once(this._minimize.bind(this,zi))},_onLastVolumeStateCheck(){this._onVolumeChange()},_toggleVolume(){this._isMuted?(this._unMute(),this._fireUnmute()):(this._mute(),this._fireMute()),this._minimizeOnClick(),this.currModel.set("volumeUserInteraction",!0)},_mute(){this._showMute(),this._hideUnmute(),this._isMuted=!0},_unMute(){this._hideMute(),this._showUnmute(),this._isMuted=!1},_fireMute(){this.currModel.set("volumeMuted",!0),this.currModel.set("onUnMuteClicked",!1)},_fireUnmute(){this.currModel.set("volumeMuted",!1),this.currModel.set("onUnMuteClicked",!0)},_onVolumeChange(){this.currModel.get("volumeMuted")?this._mute():this._unMute()},_minimizeAfterRender(){this.currModel.get("volumeMustBeMinimized")?this._minimize(Hi):setTimeout(function(){this._isMinimized||this._minimize(zi)}.bind(this),this._settings.timeToMinimize)},_minimize(e){Bi("#_cm-css-reset._cm-volume-area > ._cm-volume-border").css(e),this._isMinimized=!0,this.currModel.set("volumeMustBeMinimized",!0)},_hideMute(){Bi("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-mute").css(Ui)},_showMute(){Bi("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-mute").css(ki)},_hideUnmute(){Bi("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-unmute").css(Ui)},_showUnmute(){Bi("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-unmute").css(ki)},_setPosition(){this.hasCloseButton||this._isAlwaysBottom?this.$el.addClass("_cm-volume-area-bottom"):this.$el.addClass("_cm-volume-area-top"),this._handleDetach&&this._handleVideoViewState()},_isHandleDetach(){this._handleDetach=!1,this._unitType===S.z.UNIT_TYPES.FEED_MANAGER&&!1===this.model.get("hasCloseButton")&&!0===this.model.get("detachToSlider.hasCloseButton")&&(this._handleDetach=!0)},_hasCloseButton(){this._unitType!==S.z.UNIT_TYPES.FEED_MANAGER&&this._unitType!==S.z.UNIT_TYPES.INLINE_INSTREAM&&this._unitType!==S.z.UNIT_TYPES.MSN_WIDGET||(this.hasCloseButton=this.model.get("closeButton.hasCloseButton")),this._unitType!==S.z.UNIT_TYPES.WIDGET_ITEM&&this._unitType!==S.z.UNIT_TYPES.EXPANDABLE&&this._unitType!==S.z.UNIT_TYPES.EXPANDABLE_MOBILE||(this.hasCloseButton=this.model.get("components.CloseButtonView.hasCloseButton")),this._unitType,S.z.UNIT_TYPES.SLIDER_INSTREAM,this._unitType,S.z.UNIT_TYPES.EXPANDABLE},_handleVideoViewState(){if(!this._isAlwaysBottom){var e=this.model.get("videoViewState");e===j.Z.videoViewState.attached&&(this.$el.addClass("_cm-volume-area-top"),this.$el.removeClass("_cm-volume-area-bottom")),e===j.Z.videoViewState.detached&&this.hasCloseButton&&(this.$el.addClass("_cm-volume-area-bottom"),this.$el.removeClass("_cm-volume-area-top"))}},_styleCustomization(){this._settings.style&&(Li.isEmpty(this._settings.style.border)||Bi("#_cm-css-reset._cm-volume-area > ._cm-volume-border").css(this._settings.style.border),Li.isEmpty(this._settings.style.mute)||Bi("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-mute").css(this._settings.style.mute),Li.isEmpty(this._settings.style.unmute)||Bi("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-unmute").css(this._settings.style.unmute),Li.isEmpty(this._settings.style.text)||Bi("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-text").css(this._settings.style.text))},_checkIfMinimized(){this._unitType===S.z.UNIT_TYPES.FEED_MANAGER&&this.currModel.get("volumeMinimized")&&this._minimize(Hi)},setButtonVisible(){this.log.info("_onTopComponentChange",this.model.get("viewTopComponent")),this.model.get("viewTopComponent")===S.z.FLOATING_VIEW_TOP_COMPONENT.video?this.show():this.hide()},hide(){this.$el.hide()},show(){this.$el.show()},_createStatesAction:function(){this.adStateActions={q0:this.show.bind(this),completed:this.hide.bind(this),repeating:this.show.bind(this)}},_onAdStateChange:function(e,t){var i=this.adStateActions[t];i&&i()},_onComponentsVisibilityChange(){this.currModel.get(this.componentsVisibilityListener)?this.show():this.hide()}});const ji=o(316).View.extend({className:"video_controls show",id:"video_controls",initialize:function(e){this.log=new y.Z({unitType:e.unitType,className:"progressBarView",version:e.model.get("version"),isDebug:e.model.get("isDebug")}),this.model=e.model,this.container=e.container,this.video=e.video,this._bindEvents(),this.render()},_bindEvents:function(){this.video.addEventListener("ended",this.resetProgress.bind(this)),this.model.listenTo(this.model,"change:mute",this.muteChanged.bind(this)),this.model.listenTo(this.model,"change:content.startProgressBar",this.ManageProgressBarInterval.bind(this))},render:function(){this.container.appendChild(this.el),this.$el.append('<div class="video_controls video_controls_main_area"> <div class="cm_video_controls_progressbar_area"> <div class="cm_video_controls_progressbar_bg white_bg"></div> <div class="cm_video_controls_progressbar blue_bg"></div> </div> <div class="cm_video_controls_mute interactive"> <div class="cm_video_controls_volume display_mute"></div> <div class="cm_video_controls_volume display_unmute"></div> </div> <div class="cm_video_controls_playpause interactive show"> <div class="pause show"></div> <div class="play hide"></div> </div> </div> '),this.setControls(),this.show()},setControls(){this.setProgressBarComponent(),this.setPlayPauseButton(),this.setMuteButton()},hide:function(){this.$el.hide()},show:function(){this.$el.show()},setProgressPercent(e){this.progressDiv.style.width=e+"%"},resetProgress(){this.progressDiv.classList.add("init_bg"),this.setProgressPercent(0)},playClicked(){this.model.set("content.playClicked",!0),this.model.set("content.pauseClicked",!1),this.pauseButton.classList.add("show"),this.pauseButton.classList.remove("hide"),this.playButton.classList.remove("show"),this.playButton.classList.add("hide")},pauseClicked(){this.model.set("content.pauseClicked",!0),this.playButton.classList.add("show"),this.playButton.classList.remove("hide"),this.pauseButton.classList.remove("show"),this.pauseButton.classList.add("hide")},muteClicked(){this.model.get("mute")?this.unMute():this.mute()},muteChanged(){this.model.get("mute")?this.setMuteClasses():this.setUnMuteClasses()},mute(){this.model.set("mute",!0),this.setMuteClasses()},unMute(){this.model.set("mute",!1),this.setUnMuteClasses()},setMuteClasses(){this.muteImg.style.display="block",this.unmuteImg.style.display="none"},setUnMuteClasses(){this.muteImg.style.display="none",this.unmuteImg.style.display="block"},setProgressBarComponent(){this.progressDiv=this.$el.find(".blue_bg")[0],this.progressComponentDiv=this.$el.find(".cm_video_controls_progressbar_area")[0],this.model.get("components.contentVideo.hideProgressBar")&&(this.progressComponentDiv.style.display="none"),this.resetProgress()},setMuteButton(){this.muteButton=this.$el.find(".cm_video_controls_mute").get(0),this.model.get("components.contentVideo.hideMuteButton")&&(this.muteButton.style.display="none"),this.muteImg=this.$el.find(".cm_video_controls_mute .display_mute").get(0),this.unmuteImg=this.$el.find(".cm_video_controls_mute .display_unmute").get(0),this.muteImg.style.backgroundImage='url("'.concat(this.model.get("components.contentVideo.muteImgUrl"),'")'),this.unmuteImg.style.backgroundImage='url("'.concat(this.model.get("components.contentVideo.unmuteImgUrl"),'")'),this.muteButton.onclick=this.muteClicked.bind(this),this.muteChanged()},setPlayPauseButton(){this.playButton=this.$el.find(".play")[0],this.pauseButton=this.$el.find(".pause")[0],this.pauseButton.style.backgroundImage='url("'.concat(this.model.get("components.contentVideo.pauseImgUrl"),'")'),this.model.get("components.contentVideo.hidePlayButton")&&(this.pauseButton.classList.remove("show"),this.pauseButton.classList.add("hide")),this.playButton.onclick=this.playClicked.bind(this),this.pauseButton.onclick=this.pauseClicked.bind(this)},ManageProgressBarInterval(){this.model.get("content.startProgressBar")?this.progressInterval=setInterval(this.setProgress.bind(this),100):this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null)},setProgress(){this.setProgressPercent(this.video.currentTime/this.video.duration*100)}});var $i=o(84),Zi=o(999);class Gi extends E.s{constructor(e){super(e);var t=this.model.get("unitType"),i=this.model.get("version"),s=this.model.get("isDebug");this.compatibleUnitType=[S.z.UNIT_TYPES.FEED_MANAGER,S.z.UNIT_TYPES.FEED_MANAGER_MOBILE,S.z.UNIT_TYPES.SLIDER_INSTREAM,S.z.UNIT_TYPES.SLIDER_INSTREAM_MOBILE],this.log=new y.Z({className:"ContentVideoView",unitType:t,version:i,isDebug:s}),this.model=e.model,this.maxVideoToShow=this._getMaxVideoPlayValue(t),this.container=e.container,this.$el.css({display:"none"}),this.isHidden=!0,$i(this.container).append(this.$el),this._addContentStyleObserver(),this.contentTimer=null,this.totalContentDuration=0,this.adxThreshold=this.model.get("adxThreshold")||5*S.z.TIME_UNITS.SECOND,this.model.get("repeat")&&this.model.set("components.contentVideo.isRepeat",!0),this.handleMouseActivity(),this.bindRenderShowEvents()}bindRenderShowEvents(){var e=[];this.model.get("displayFiller.beforeAd")===S.z.DISPLAY_FILLER.BEFORE_AD.CONTENT&&e.push({event:"player.playlist",funcName:"render"}),this.model.get("displayFiller.betweenAds")===S.z.DISPLAY_FILLER.BETWEEN_ADS.CONTENT&&e.push({event:"adQState:completed",funcName:"render"}),this.model.get("displayFiller.onTimeout")===S.z.DISPLAY_FILLER.ON_TIMEOUT.CONTENT&&e.push({event:"closeTimer:midrollCollapse",funcName:"render"}),e.length>0&&e.push({event:"closeState",funcName:"onCloseState"}),this.createStateHandlers(e)}render(){this.model.get("hasReadyAd")&&!this.model.get("timeBetweenAds")||(this.log.info("Content is being loaded!"),this.video||(this.$el.append('<div class="cm_video_content_wrapper"> <div class="_cm-background-loading"></div> <video class="cm_video_content_video_element"></video> </div> '),this.el.id="_cm-css-reset",this._customize(),this.playList=this.model.get("player.playlist"),this.currentTrackIndex=0,this.initVideo(),this._addVideoControls(),this.initLoadingBackground(),this.bindEvents()),this.show())}_addVideoControls(){this.videoControls=new ji({container:this.el,model:this.model,video:this.video})}bindEvents(){this.createStateHandlers([{event:"isEligibleToPlay",funcName:"checkEligible"},{event:"isInTab",funcName:"checkEligible"},{event:"mute:true",funcName:"mute"},{event:"mute:false",funcName:"unMute"},{event:"content.playClicked:true",funcName:"play"},{event:"content.pauseClicked:true",funcName:"pause"},{event:"adQState:q0",funcName:"hide"},{event:"adState:playing",funcName:"hide"},{event:"blockedByExternalUnit:true",funcName:"pause"},{event:"blockedByExternalUnit:false",funcName:"play"},{event:"getAdSuccess",funcName:"setMaxVideoForTermination"}])}initVideo(){this.video=this.$el.find("video")[0],this.model.get("contentClickUrl")&&(this.video.onclick=this.contentClickThru.bind(this),this.video.style.cursor="pointer"),this.video.src=this.playList[this.currentTrackIndex].url,this.video.addEventListener("ended",this.onEnd.bind(this)),this.video.addEventListener("loadeddata",this.onLoaded.bind(this)),this.video.addEventListener("playing",this.onPlaying.bind(this)),this.video.muted=!0,this.video.setAttribute("muted",""),this.video.setAttribute("playsinline","")}initLoadingBackground(){this.$loadingImg=this.$el.find("._cm-background-loading"),-1!==!this.$loadingImg.index()?this.$loadingImg.css({backgroundImage:'url("'.concat(this.model.get("components.contentVideo.X"),'")')}):this.log.warning("No loading background found!")}show(){this.isTerminated||(this.model.set("content.isContentPlay",!0),this.log.info("Content video show"),this.isHidden=!1,this.el.style.display="block",this.play())}hide(){this.isTerminated||(this.model.set("content.isContentPlay",!1),this.getTotalContentDuration(),this.log.info("Content video hide"),this.isHidden=!0,this.el.style.display="none",this.pause())}getTotalContentDuration(){if(!this.isHidden){var e=performance.now();this.totalContentDuration+=e-this.startTime}return this.totalContentDuration}play(){if(this.video){if(this.model.get("content.playClicked")||!this.model.get("content.pauseClicked")){this.model.set("content.playClicked",!1),this.model.set("content.startProgressBar",!0);var e=this.video.play();this.model.set("isExternalComponentBlockingAdFromPlay",!0,{silent:!0}),void 0!==e?e.catch((e=>{this.model.set("isExternalComponentBlockingAdFromPlay",!1),this.log.info("Auto-play was prevented",e)})).then((()=>{this.log.info("Auto-play content video started"),this.startTime=performance.now(),this.isHidden||this.model.set("content.isContentPlay",!0),this.model.get("adxSessionDuration")&&this.model.set("adxDurationDebtPay",!0),this.contentTimer=setTimeout((()=>{this.model.set("adxDurationDebtPay",!1),this.model.set("isExternalComponentBlockingAdFromPlay",!1)}),1e3*this.getTimeoutBeforeOrBetweenAds())})):this.model.set("isExternalComponentBlockingAdFromPlay",!1)}}else this.log.warning("Play was called without video render!")}reportVideoContentId(){var e=this.playList[this.currentTrackIndex],t=e.id;if(!(t===this.model.previous("organicVideoPlaying"))){var i=e.pixelId;this.model.set("pixels.organicVideoPlaying.id",i),this.model.set("organicVideoPlaying",t)}}getTimeoutBeforeOrBetweenAds(){var e=this.model.get("isFirstAd");if("content"===this.model.get("displayFiller.beforeAd")&&e&&this.model.get("timeBeforeFirstAd")>0)return this.model.get("timeBeforeFirstAd");if("content"===this.model.get("displayFiller.betweenAds")&&!e){if(this.model.get("adxSessionDurationCounter"))return this.adxThreshold/1e3;if(this.model.get("timeBetweenAds")>0)return this.model.get("timeBetweenAds")}return 0}pause(){this.video?(this.model.set("content.startProgressBar",!1),this.video.pause()):this.log.warning("Pause was called without video render!")}mute(){this.video.muted=!0,this.video.setAttribute("muted",""),this.model.set("mute",!0)}unMute(){this.video.muted=!1,this.video.removeAttribute("muted"),this.model.set("mute",!1)}onLoaded(){this.$loadingImg&&this.$loadingImg.hide()}onPlaying(){this.model.get("components.contentVideo.isActive")&&this.model.get("displayFiller.beforeAd")===S.z.DISPLAY_FILLER.BEFORE_AD.CONTENT&&this.model.trigger("contentReadySliderShow"),this.reportVideoContentId()}setMaxVideoForTermination(){this.maxVideoToShow=this.model.get("getAdSuccess")?this._getMaxVideoPlayValue(this.model.get("unitType")):this.currentTrackIndex}onEnd(){if(!this.isTerminated&&(this.$loadingImg&&this.$loadingImg.show(),this.model.get("components.contentVideo.isRepeat"))){if(this.currentTrackIndex++,this.currentTrackIndex>=this.maxVideoToShow)return void this.terminate();var e=this.playList[this.currentTrackIndex];e||(this.currentTrackIndex=0,e=this.playList[this.currentTrackIndex]),this.video.src=e.url,this.model.set("content.isContentPlay",!1),clearTimeout(this.contentTimer),this.model.set("isExternalComponentBlockingAdFromPlay",!1,{silent:!0}),this.play()}}handleMouseActivity(){"onHover"===this.model.get("volume")&&(this.el.onmouseenter=this.onMouseEnter.bind(this),this.el.onmouseleave=this.onMouseLeave.bind(this))}onMouseEnter(){this.unMute()}onMouseLeave(){this.mute()}contentClickThru(){window.open(this.model.get("contentClickUrl"))}_customize(){var e=this.model.get("components.contentVideo.additionalCss");this.$el.css(Zi.toCssObj(e))}get className(){return"_cm-content-video"}checkEligible(){this.isEligibleToPlay()?this.play():this.pause()}isEligibleToPlay(){return!this.isHidden&&!this.model.get("blockedByExternalUnit")&&(this.model.get("isInTab")?!!this.model.get("isEligibleToPlay")||this.model.get("videoViewState")===j.Z.videoViewState.detached:this.model.get("videoViewState")===j.Z.videoViewState.detached&&"play"===this.model.get("detachToSlider").onOutOfView)}onCloseState(){this.isTerminated||(this.model.get("closeState")!==j.Z.closeState.terminate&&this.model.get("closeState")!==j.Z.closeState.adManagerStop?this.model.isLoadcomponent("content","onTimeout")?this.video?this.show():this.render():this.hide():this.terminate())}terminate(){this.log.info("Terminate"),this.isTerminated||(clearTimeout(this.contentTimer),this.model.set("content.isContentPlay",!1),this.model.set("isExternalComponentBlockingAdFromPlay",!1,{silent:!0}),this.model.set("components.contentVideo.isActive",!1,{silent:!0}),this.isTerminated=!0,this.video&&(this.hide(),this.mute(),this.video.removeAttribute("src"),this.video.load(),this._destroy()),this.log.info("Content is terminated."))}_getMaxVideoPlayValue(e){var t=this.model.get("components.contentVideo.maxAllowed");return this.compatibleUnitType.includes(S.z.UNIT_TYPES[e])?t||2:Number.POSITIVE_INFINITY}_destroy(){this.video.removeEventListener("ended",this.onEnd),this.video.removeEventListener("loadeddata",this.onLoaded),this.video.removeEventListener("playing",this.onPlaying),this.mo&&this.mo.disconnect(),this.container&&this.container.parentElement&&this.container.parentElement.removeChild(this.container),this.container=this.mo=void 0}_addContentStyleObserver(){var e=this.$el[0];e&&window.MutationObserver&&(this.mo=new window.MutationObserver((()=>{"none"!==e.style.display&&this.isHidden&&(e.style.display="none")})),this.mo.observe(e,{attributes:!0,attributeFilter:["style"]}))}}const qi=Gi;var Yi=o(84),Ki=o(999);const Qi=class extends yi{constructor(e,t,i){if(super(e,"SubVideoViewDetachable",i),this.subUnitId=this.model.get("subUnitId"),this.isFirstAd=!0,this.cardNumber=this.model.get("cardNumber"),this.globalModel=i,this.container=Yi(this.model.get("videoContainerSelector")||"body")[0],this.animationTimeOut=null,this.sliderOptions=this.model.get("detachToSlider"),this.detachOptions=this.model.get("detachToSlider"),this.isDetachActive=this.model.get("detachToSlider.isStartFromSlider")||this.model.get("detachToSlider.isDetachToSlider"),this.isDetachedHasCloseButton=this.isDetachActive&&this.model.get("detachToSlider.hasCloseButton"),this.isAttachedHasCloseButton=this.model.get("hasCloseButton"),this.isFirstDetach=!0,this.isDetached=!1,this.isFistImpression=!0,this.isGotImpression=!0,this.attachedOnceToNewCard=!1,this.closeButtonDelayd=!1,this.scrollManager=new x.Z,this._setAd(t),this.model.get("detachToSlider.isStartFromSlider")){var s=this.model.get("width"),o=this.model.get("detachToSlider.liquidSize.isActive")?this._calcLiquidWidth():this.model.get("detachToSlider.width");s>o&&(this.model.set("width",o),this.model.set("height",Ki.getVideoHeight(o)))}else this.isFirstDetach=!1;this.render(),this.feedPlayerSize={width:this.model.get("width"),height:this.model.get("height")},this.isClosedByButton=!1,this.isAnimateOnOpen=this.model.get("animation.onTransitionOpen"),this.isAnimateOnClose=this.model.get("isAnimateOnClose")||this.model.get("animation.onTransitionClose")&&"close"===this.model.get("onTimerClose"),this.animationCss={transition:"all 500ms ease-in-out"},this.animationCssFirstSlide={transition:"all 1s ease"},this.openCloseAmnimation={transition:"height "+this.model.get("animation.transitionAnimationTime")+"ms"},this.noAmnimationCss={transition:"none"},this.animationStartEndPoint={height:"0"};var n={startCondition:{stateToListen:"",state:""}},r=this.model.get("isPlacementSingleAd")?0:1e3*this.model.get("secondsToCloseFeed");this.getAdTimer=new At(this.model,n,this.onLocalTimerEnd.bind(this,"midrollCollapse subUnit"),r),this.contentTimer=new At(this.model,n,this.onLocalTimerEnd.bind(this,"Content tiemr subUnit"),1e3*this.model.get("contentTimerSeconds")),this.sliderOptions.isStartFormSlider||"rendered"!==this.model.get("containerViewState")||(this.checkEligible(),this.containerViewStateRendered()),this._bindSubViewEvents(),this.sliderOptions.isStartFromSlider&&this.onUnitStart(),this.adCompleted=!1,this._addUIComponents(),this._addContentView()}_setAd(e){this.isFirstAd?this._switchFromActiveAd("set ad first ad switch"):this.isFirstAd=!1,this.el=e.vpaidWrapper.adTarget,this.model.get("isReplayAd")&&e.vpaidWrapper.isReplayable&&e.vpaidWrapper.dontDie&&e.vpaidWrapper.dontDie(),this.$el=Yi(this.el),this.globalModel.get("volumeMuted")||this.model.get("wurfl.os.name")!==S.z.OS.IOS||this.globalModel.set("volumeMuted",!0),this._setAdBase(e)}_switchToActiveAd(e){this.$el.removeClass("_cm-ad"),this.$el.addClass("_cm-ad-active"),this.log.warning("switchToActiveAd",this.cardNumber)}_switchFromActiveAd(e){this.isDetached&&(this.log.warning("switchFromActiveAd",this.cardNumber),this.$el.addClass("_cm-ad"),this.$el.removeClass("_cm-ad-active")),this.repeatingAd&&this.repeatingAd.vpaidWrapper&&Yi(this.repeatingAd.vpaidWrapper.adTarget).css({display:"none !important"})}_bindEvents(){this.createStateHandlers([{event:"videoPlaceholderSize",funcName:"onVideoPlaceholderSizeChange",withBind:!1},{event:"videoPlaceholderPosition",funcName:"setVideoPlaceholderPosition",withBind:!1},{event:"containerViewState:rendered",funcName:"containerViewStateRendered"},{event:"isEligibleToPlay",funcName:"isEligibleToPlayChange"},{event:"isInTab",funcName:"isInTabChange"},{event:"loadingViewState:clicked",funcName:"_onLoadingClick"},{event:"adQState:completed",funcName:"onAdComplete"},{event:"isEligibleToPlay",funcName:"checkEligible"},{event:"isInTab",funcName:"checkEligible"},{event:"learnMoreWasClicked",funcName:"_onLearnMoreClick"}])}_bindSubViewEvents(){this.isDetachActive&&this.model.get("detachToSlider").liquidSize.isActive&&Yi(window).on("resize",this._onResize.bind(this))}_onResize(){if(this.isDetached){var e=this.getDetachPositionAndSize().size;this._resize(this.model,e),this.model.trigger("change:videoViewSize",e)}}onVideoPlaceholderSizeChange(){this.currentSize=null,this.setVideoPlaceholderSize()}setVideoPlaceholderSize(){var e=this.model.get("videoPlaceholderSize");this.isDetached||this._resize(arguments[0],e)}setVideoPlaceholderPosition(){if(!this.isDetached){var e=this.model.get("videoPlaceholderPosition");this._rePosition(this.model,{top:e.top,left:e.left}),this.repeatingAd&&this.$el!==Yi(this.repeatingAd.vpaidWrapper.adTarget)&&Yi(this.repeatingAd.vpaidWrapper.adTarget).css(arguments[1])}}render(){this._customize(),this.$el.css({width:this.model.get("width")}),this.$el.addClass("_cm-video-with-slider"),this.model.set("targetId",this.videoAdId),this.model.set("videoViewState",j.Z.videoViewState.rendered),this._addDisclosureText(),this.log.info("new video view is renderd. subUnitId="+this.subUnitId),Ki.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoInitToRender".concat(this.model.get("perfUnitType")),S.z.TRC_PERFORMANCE_ACTIONS.STOP)}containerViewStateRendered(){this.model.get("detachToSlider.isStartFromSlider")||this.attach()}cleanAnimation(e){setTimeout(function(){this.$el.css({transition:""})}.bind(this),e)}isInTabChange(){this.model.get("isInTab")&&this.model.get("videoViewState")===j.Z.videoViewState.attached&&(this.$el.css({position:"absolute"}),this.isFirstDetach=!1),this.model.get("isInTab")&&!this.model.get("isEligibleToPlay")&&this.model.get("videoViewState")===j.Z.videoViewState.rendered&&this.isEligibleToPlayChange(),this.activeAd&&this.activeAd.vpaidWrapper&&this.model.get("isInTab")&&Ki.forceElementRedrawWithBorderChange(this.model.get("wurfl.browser"),this.activeAd.vpaidWrapper.adTarget)}attach(){this.sliderOptions.isStartFromSlider||this.attachedOnceToNewCard?this._attachFromSlider():(this.attachedOnceToNewCard=!0,this._attachNewCard()),this._closeButtonHide(),this.globalModel.get("isSliderOn")&&!this.model.get("detachToSlider.isDetachToSlider")&&this.globalModel.set("isSliderOn",!1)}_attachNewCard(){this.log.info("attaching new card to placeholder:",this.subUnitId),this._attachToCard(),this.model.set("videoViewState",j.Z.videoViewState.attached),this.isAnimateOnOpen&&this._runAnimation(!0,null),setTimeout(function(){!this.model.get("isEligibleToPlay")&&this.model.get("detachToSlider.isDetachToSlider")&&this.model.get("videoViewState")!==j.Z.videoViewState.detached&&(this.log.info("gotad _attachNewCard fix detach"),this.isEligibleToPlayChange(),this.checkEligible())}.bind(this),300)}_runAnimation(e,t){this.isAnimatioRunning=!0,e?(this.$el.css(this.animationStartEndPoint),this.$el.css(this.openCloseAmnimation),setTimeout(function(){this.currentSize=null,this._resize(this.model,this.model.get("videoPlaceholderSize"))}.bind(this),100),setTimeout(function(){this._removeAnimation()}.bind(this),this.model.get("animation.transitionAnimationTime")+100)):(this.$el.css(this.openCloseAmnimation),setTimeout(function(){this.$el.css(this.animationStartEndPoint)}.bind(this),100),setTimeout(function(){this._removeAnimation(),this.$el.hide()}.bind(this),this.model.get("animation.transitionAnimationTime")+100)),t&&t()}_removeAnimation(){this.$el.css(this.noAmnimationCss)}_attachToCard(){this.currentSize=null,this._rePosition(this.model,this.model.get("videoPlaceholderPosition")),this._resize(this.model,this.model.get("videoPlaceholderSize")),this.$el.css(this.model.get("videoPlaceholderSize")),this.$el.css(this.model.get("additionalCss")),this.log.info("done attaching",this.$el),this._closeButtonHide()}_attachFromSlider(){clearTimeout(this.animationTimeOut),this.log.info("attaching slider to placeholder",this.subUnitId);var e=this.$el.offset();this.cleanStyle();var t={position:"absolute",width:e.width+"px",height:e.height+"px"};Yi.extend(t,this.model.get("additionalCss")),this.$el.css(t),this._rePosition(this.model,{top:e.top+"px",left:e.left+"px"}),this.isFirstDetach=!1,this.animationTimeOut=setTimeout(this.postAttach.bind(this),100)}postAttach(){this.model.get("detachToSlider").animation&&this.$el.css(this.animationCss);var e=this.model.get("videoPlaceholderSize");this._rePosition(this.model,this.model.get("videoPlaceholderPosition")),this._resize(this.model,e),this.model.set("videoViewState",j.Z.videoViewState.attached),this.model.trigger("change:videoViewSize",this.model.get("videoPlaceholderSize")),this.isDetached=!1,this.cleanAnimation(500),this.isAttachedHasCloseButton&&setTimeout(this._closeButtonShow.bind(this),500)}detach(){if(!this.isDetached){clearTimeout(this.animationTimeOut),this.log.info("detaching to placeholder"),this.isDetached=!0,this.model.set("videoViewState",j.Z.videoViewState.detached);var e={},t={};this._closeButtonHide(),this.isFirstDetach?(e={position:"fixed"},t[this.model.get("detachToSlider").position.horizontal]="-"+(this.model.get("detachToSlider").width+this.model.get("detachToSlider").position.horizontalOffset)+"px",t[this.model.get("detachToSlider").position.vertical]=this.model.get("detachToSlider").position.verticalOffset+"px",e.width=0,e.height=Ki.getVideoHeight(this.model.get("detachToSlider").width)+"px"):(this.cleanStyle(),t=this._getFixedPositionCss(),e.width=this.model.get("videoPlaceholderSize").width+"px",e.height=this.model.get("videoPlaceholderSize").height+"px"),Yi.extend(e,this.model.get("additionalCss")),this.$el.css(e),this._rePosition(this.model,t),this.animationTimeOut=setTimeout(this.postDetach.bind(this),100)}}_getFixedPositionCss(){var e=Yi.extend({},this.$el[0].getBoundingClientRect());e.right=window.innerWidth-e.left-e.width,e.bottom=window.innerHeight-e.bottom;var t={position:"fixed",top:"auto",bottom:"auto",left:"auto",right:"auto"};return t[this.model.get("detachToSlider").position.horizontal]=e[this.model.get("detachToSlider").position.horizontal]+"px",t[this.model.get("detachToSlider").position.vertical]=e[this.model.get("detachToSlider").position.vertical]+"px",t}postDetach(){var e=500;this.$el.css({position:"fixed"}),this.model.get("detachToSlider").animation&&!1===this.isFirstDetach&&this.$el.css(this.animationCss),!0===this.isFirstDetach&&(this.isFirstDetach=!1,this.$el.css(this.animationCssFirstSlide),e=1200);var t=this.getDetachPositionAndSize();this._resize(this.model,t.size),this._rePosition(this.model,t.position),this.model.trigger("change:videoViewSize",t.size),Ki.isEmpty(this.model.get("detachToSlider").customCss)||this.$el.css(JSON.parse(this.model.get("detachToSlider").customCss)),this.cleanAnimation(e),this._updateCloseButtonContainer(),setTimeout(this._closeButtonShow.bind(this),e)}cleanStyle(){this.$el.removeAttr("style")}onUnitStart(){this.log.warning("onAdImpression isEligibleToPlay",this.model.get("isEligibleToPlay")),this.isGotImpression=!0;var e=this.detachOptions.isStartFromSlider&&this.detachOptions.isDetachToSlider;this.model.get("isEligibleToPlay")&&!e&&(this.isFirstDetach=!1,this.detachOptions.isStartFromSlider=!1,this.attach()),(!this.model.get("isEligibleToPlay")||e)&&this.model.get("detachToSlider").isStartFromSlider&&this.isFistImpression&&(this.isFistImpression=!1,this.model.get("isInTab")&&(this._playAd(),this.detach()))}isEligibleToPlayChange(){if(this.isGotImpression)return this.model.get("isEligibleToPlay")&&this.isAdClosedByTimer&&this.isAnimateOnClose?(this.model.set("isAdClosedByTimer",!0),void this._runCloseAnimation()):void(!this.model.get("isEligibleToPlay")||this.model.get("videoViewState")!==j.Z.videoViewState.detached||!this.model.get("renderWasCalled")||this.sliderOptions.isStartFromSlider&&this.sliderOptions.isDetachToSlider?!this.model.get("isEligibleToPlay")&&(this.model.get("videoViewState")===j.Z.videoViewState.attached||this.model.get("videoViewState")===j.Z.videoViewState.rendered)&&this.isDetachActive&&this.model.get("detachToSlider.isDetachToSlider")&&this.model.get("isInTab")&&"string"==typeof this.model.get("adState")&&this._isDetachAvailable()&&this.detach():this.attach())}_isDetachAvailable(){return this.el.getBoundingClientRect().top>0?this.model.get("detachToSlider.isDetachAbove"):this.model.get("detachToSlider.isDetachBelow")}close(){this.log.info("close"),this.permanentAttach(),this.$el.height(0),setTimeout(function(){this.permanentClose()}.bind(this),1500)}permanentClose(){this.log.info("permanentClose"),this.activeAd?(this.activeAd.pause(S.z.PAUSE_REASONS.PERMANENT_CLOSE),this.activeAd=void 0):this.$el.remove(),this.terminateContent()}checkAndClose(e){return!(this.isDetached||!this.isEligibleToPlay()||!this.isAnimateOnClose||this.model.get("isPlacementSingleAd"))&&(this._runCloseAnimation(),this.log.info("Close because of: ",e),!0)}closeAndRemove(){this.$el&&(this.activeAd&&this.activeAd.pause(S.z.PAUSE_REASONS.PERMANENT_CLOSE),this.$el.remove(),this._closeLoadingView(),this._closeButtonHide(),this.isDetached=!1,this.close(),this.globalModel.set("isSliderClosed",!1))}permanentAttach(){var e=this.isDetached;this.$el.css(this.animationCss),this._closeButtonHide(),this.model.set("detachToSlider.isDetachToSlider",!1),this.globalModel.set("isSliderOn",!1),e&&this._permanentAttachAnimation(),this.globalModel.set("isSliderClosed",!0),this.terminateContent()}_permanentAttachAnimation(){this.isAnimatioRunning=!0,setTimeout(function(){this.$el.css({width:"1px"})}.bind(this),100),setTimeout(function(){this.isAnimatioRunning=!1,this.$el.css({transition:""}),this._rePosition(this.model,this._getPositionResetCSS()),this.$el.css({position:"absolute"}),this.$el.css(this.model.get("additionalCss")),this._rePosition(this.model,this.model.get("videoPlaceholderPosition"));var e=this.model.get("videoPlaceholderSize");e||(e={width:1,height:1}),this.isDetached=!1,this.isDetachActive=!1,this._resize(this.model,e),this.model.set("videoViewState",j.Z.videoViewState.attached),this.checkEligible(),this.model.get("isSuperSlider")&&(this.model.set("isSuperSliderClosed",!0),this.globalModel.set("isSuperSliderClosed",!0),this._updateSubAdsEligibilityStatus(!1)),this.model.set("isPermanentAttachAnimationDone",!0)}.bind(this),600)}_onStateChange(e,t){t===e.STATE.STOPPED_BY_USER&&this.close()}_calcLiquidWidth(){var e=this.model.get("detachToSlider").liquidSize.minWidth,t=this.model.get("detachToSlider").liquidSize.maxWidth,i=window.innerWidth*(this.model.get("detachToSlider").liquidSize.widthPercent/100);return t&&i>t&&(i=t),i<e&&(i=e),i}getDetachPositionAndSize(e){var t=Math.floor(this.model.get("detachToSlider").liquidSize.isActive?this._calcLiquidWidth():this.model.get("detachToSlider").width),i=Ki.getVideoHeight(t),s={position:this._getPositionResetCSS(),size:{width:t,height:i}};return s.position[this.model.get("detachToSlider").position.horizontal]=this.model.get("detachToSlider").position.horizontalOffset+"px",s.position[this.model.get("detachToSlider").position.vertical]=this.model.get("detachToSlider").position.verticalOffset+"px",s}_resize(e,t){this.currentSize&&this.currentSize.width===t.width&&this.currentSize.height===t.height||(this.log.info("_resize sizeObj: ",t),this.$el.css(t),this.activeAd&&this.activeAd.vpaidWrapper?this.activeAd.resize(t):this.repeatingAd&&this.repeatingAd.vpaidWrapper&&this.repeatingAd.resize(t),this.currentSize=t)}onTimerEnd(e){(this.log.info("SubVideo midroll:",e),this.isContentViewActive())||(this.ad$el&&this.ad$el.height(0),this.activeAd=void 0,this.ad$el=void 0,this._startLoadingView(),this.checkAndClose(e)&&(this.isAdClosedByTimer=!0),this.permanentAttach(),this.isViewed=!1)}onLocalTimerEnd(e){this.log.info("SubUnit onLocalTimerEnd card number: ",this.model.get("cardNumber")),this.isRepeateMode=!this.isReplayMode,this.isDetached?(this.createStateHandlers([{event:"isPermanentAttachAnimationDone",funcName:"_showRepeat",isListenOnce:!0}]),this.permanentAttach()):this._showRepeat(),this.isSkipCollapse?this.isSkipCollapse=!1:this.checkAndClose("LocalTimerEnd: "+e)}_runCloseAnimation(){this.model.set("isAdClosedByTimer",!0),this._runAnimation(!1,null)}onAdComplete(){if(this.model.get("isReplayAd")&&(this.repeatingAd=this.activeAd,this.isReplayMode=!1),this.model.get("isCardBelongToTempAd")&&this.onConditionComplete(),this.activeAd=void 0,this.ad$el=void 0,this._handleMidroll(),!this.model.get("isMultiAd"))return this.permanentAttach(),void this.checkAndClose("Single Ad Complete");this.isViewed=!1,this.checkEligible()}isEligibleToPlay(){return this.model.get("isInTab")?!!this.model.get("isEligibleToPlay")||this.model.get("videoViewState")===j.Z.videoViewState.detached:this.model.get("videoViewState")===j.Z.videoViewState.detached&&"play"===this.model.get("detachToSlider").onOutOfView}checkEligible(){if(!this.isRepeateMode){var e=this.isEligibleToPlay();this._setCardId(),e?(this.activeAd||(this.getReadyAd(),this.loadingView&&this.loadingView.show()),this.activeAd&&(this.loadingView&&this.loadingView.hide(),this.log.info("Play Ad sub unit: "+this.subUnitId+" ad:"+this.activeAd.adId),this._playAd(),this._stopLocalTimers())):this.activeAd&&(this.log.info("Pause Ad sub unit: "+this.subUnitId+" ad:"+this.activeAd.adId),this.activeAd.pause(S.z.PAUSE_REASONS.LOST_ELIGIBILITY),this._clearViewabilityTime());!e&&this.isFirstDetach&&(e=!0),this._updateSubAdsEligibilityStatus(e)}}hasRedyAdChangeSubUnit(){this.log.info("hasRedyAdChangeSubUnit",this.globalModel.get("hasReadyAd")),!this.isRepeateMode&&this.globalModel.get("hasReadyAd")&&this.isEligibleToPlay()&&this.getReadyAd()}_setCardId(){this.isDetached?this.model.set("cardNumber",-1*this.cardNumber):this.model.set("cardNumber",this.cardNumber)}getReadyAd(e){if(this.globalModel.get("hasReadyAd")&&!this.model.get("isPlacementSingleAd")){var t=this.globalModel.getNextAd();if(!t)return;this.globalModel.get("lastAdID")||this.globalModel.set("lastAdID",t.adId),this.log.info("Video View Got new ad of type : "+parseInt(t.adData.requiredViewability?"1":"0"),t),this._switchFromActiveAd("getReadyAd"),this.oldAdUi=this.$el;this.activeAd;this._setAd(t),this.activeAd.setSubModel(this.model),this.isDetached?this._resetElDetached():this._attachToCard(),this.checkEligible()}else this.log.warning("Could not find ad"),this.watingForAd=!0,this.globalModel.once("change:hasReadyAd",this.hasRedyAdChangeSubUnit.bind(this))}_onViewability(){this.isViewed=!0,this.viewabilityTimer=void 0,this.activeAd&&this.activeAd.onViewability(),this.log.info("!!@ _onViewability",this.model.get("tempAdCondition")),"viewability"===this.model.get("tempAdCondition")&&this.onConditionComplete()}_startLoadingView(e){this.$el.hasClass("_cm-loading")||(this.loadingView=new Ei({model:this.model,container:this.container,globalModel:this.globalModel,isStartWithReplay:this.model.get("isPlacementSingleAd")&&!this.isDetached,isReplayable:this.model.get("isReplayable")}),this._switchFromActiveAd("_startLoadingView"),this.el=this.loadingView.el,this.$el=this.loadingView.$el,this.currentSize=null,this.isDetached?this._resetElDetached():this._attachToCard()),this.loadingView.show(),this.isEligibleToPlay()||(this.isSkipCollapse=!0),e||this.getAdTimer.start(this.model,"")}_startRepeatView(){this.repeatView=new Ni({model:this.model,container:this.container,globalModel:this.globalModel}),this._switchFromActiveAd("_startRepeatView"),this.el=this.repeatView.el,this.$el=this.repeatView.$el,this._updateCloseButtonContainer(),this.isDetached?this._resetElDetached():this._attachToCard(),this.repeatView.show()}_resetElDetached(){this.currentSize=null;var e=this.getDetachPositionAndSize();this.$el.css("position","fixed"),this._resize(this.model,e.size),this._rePosition(this.model,e.position),this.model.trigger("change:videoViewSize",e.size),Ki.isEmpty(this.model.get("detachToSlider").customCss)||this.$el.css(JSON.parse(this.model.get("detachToSlider").customCss))}_closeLoadingView(){this.loadingView&&(this.log.info("loading view closed"),this.loadingView.hide(),this.loadingView.remove(),this.loadingView=void 0)}_addCloseButton(){this.closeButtonView||!this.isDetachedHasCloseButton&&!this.isAttachedHasCloseButton||(this.log.info("Creating Close Button"),!0===Ki.parseBool(this.model.get("closeButton.hasCloseButton"))&&(this.closeButtonView=new xi({model:this.model,container:this.el})))}_renderCloseButton(){if(this.closeButtonDelayd)this.closeButtonView.render(),this.closeButtonView.show();else{this.closeButtonDelayd=!0;var e=this.model.get("components.CloseButtonView.delay");setTimeout(this._renderCloseButton.bind(this),e)}}_updateCloseButtonContainer(){this.closeButtonView&&Yi(this.closeButtonView.el).appendTo(this.$el)}_closeButtonShow(){this.closeButtonView&&(this.isAttachedHasCloseButton||this.model.get("videoViewState")===j.Z.videoViewState.detached)&&this.closeButtonView.show()}_closeButtonHide(){this.closeButtonView&&this.closeButtonView.hide()}_onLoadingClick(){this.isReplayMode||(this.model.get("isReplayAd")&&this.repeatingAd&&this.repeatingAd.vpaidWrapper.isReplayable?this._setRepeatingAd():this.getAdTimer.start(this.model,"")),this.model.set("isAdClosedByTimer",!1),this.model.set("closeTimer",void 0),this.isRepeateMode=!1,this.globalModel.once("change:hasReadyAd",this.hasRedyAdChangeSubUnit.bind(this))}_setRepeatingAd(){var e=this.repeatingAd;this.isReplayMode=!0,this.el=e.vpaidWrapper.adTarget,this.$el=Yi(this.el),this.$el.css({position:"absolute"}),this.$el.css({display:"block !important"}),this._setAdBase(e),this.isDetached?this._resetElDetached():this._attachToCard(),e.vpaidWrapper.restartAd(),this.log.info("replaying ad "+e.adId),e.setToModel("adQState",j.Z.adQState.repeating,e.adId),e.setToModel("adState",j.Z.adState.repeating,e.adId),e.adState=j.Z.adState.repeating}_setAdBase(e){this.$el.attr("data-adId",e.adId),this.activeAd=e,this.ad$el=this.$el,this._updateCloseButtonContainer(),this._updateDisclosureTextContainer(),this._updateAdChoiceContainer(),this._updateVolumeButton(),this.$el.addClass("_cm-video"),this._switchToActiveAd("set ad"),this.$el.addClass("_cm-sub-unit-id-"+this.subUnitId),this._setVolumeEvents(),this.model.set("videoViewContainer",this.$el),this._closeLoadingView(),this.isDetached&&e.vpaidWrapper.nonVideoVpaid&&this.permanentAttach()}_updateDisclosureTextContainer(){this.disclosureTextView&&this.disclosureTextView.$el.appendTo(this.$el)}_updateAdChoiceContainer(){this.adChoiceArr&&this.adChoiceArr.length>0&&this.adChoiceArr.forEach(function(e){e.$el.appendTo(this.$el)}.bind(this))}_getPositionResetCSS(){return{top:"auto",bottom:"auto",left:"auto",right:"auto"}}createBasicAdDataObj(e){var t=e.adData;return{adId:e.adId,requiredViewability:t.requiredViewability,playerSequenceId:t.sequenceId,dp:t.dp.toString()}}createNewAdData(e,t){var i={newAd:this.createBasicAdDataObj(e)},s=Yi(this.model.get("scrollSelector"))[0],o=null!=s,n=o?s.clientHeight:window.innerHeight,r=o?n+s.scrollTop:n+window.pageYOffset,a=this.model.get("parentSelector");a=Ki.isArray(a)?a[0]:a,a=Yi(a)[0];var d=Ki.getTopOfEl(a);return i.newAd.isEligible=this.model.get("isEligibleToPlay"),i.newAd.hadEligibility=this.model.get("hadEligibility"),i.newAd.hadLostEligibility=!!this.model.get("lostEligibilityTime"),i.newAd.topParentSelector=d,i.newAd.bottomViewPort=r,i.adId=t,i}createOldAdData(e,t){return{oldAd:this.createBasicAdDataObj(e),adId:t}}_addAdChoice(){var e=this.model.get("components.adChoice");e.isActive&&(e.videoAd.isActive&&!this.isDetachActive?this._initVideoViewAdChoice():this._initAdChoiceDetachable())}_initVideoViewAdChoice(){this.adChoiceArr=[],this.adChoice=new Ft({model:this.model,container:this.el,type:S.z.AD_CHOICE_TYPE.VIDEO_AD}),this.adChoiceArr.push(this.adChoice)}_initAdChoiceDetachable(){this.adChoiceArr=[],this.model.get("components.adChoice.videoAd.isActive")&&(this.adChoiceVideoAd=new Ft({model:this.model,container:this.el,type:S.z.AD_CHOICE_TYPE.VIDEO_AD}),this.adChoiceArr.push(this.adChoiceVideoAd)),this.model.get("components.adChoice.slider.isActive")&&(this.adChoiceSlider=new Ft({model:this.model,container:this.el,type:S.z.AD_CHOICE_TYPE.SLIDER}),this.adChoiceArr.push(this.adChoiceSlider))}_rePosition(e,t){if(t.top){if(!this.isDetached&&t.top<=this.model.get("minTopForVideo")&&t.left<=this.model.get("minLeftForVideo"))return this.globalModel.set("top0Left0",!0),void this.globalModel.set("topParentSelectorLost",!0);if(this.model.get("isPlayerOutOfViewport")&&t.top&&this.activeAd){t.top,this.globalModel.get("topOffsetPosition");this.activeAd.vpaidWrapper.adTarget.parentElement.style.top="-"+this.globalModel.get("topOffsetPosition")+"px"}this.$el.css(t)}}_playAd(){this.playAd()}_updateSubAdsEligibilityStatus(e){e?this.globalModel.set("lastCardOutOfViewport",void 0):this.globalModel.set("lastCardOutOfViewport",this.model.get("subUnitId")),this.globalModel.set("subAdsEligibility."+this.model.get("subAdId"),e)}injectAd(e,t){this.model.set("isCardBelongToTempAd",!0),this.model.set("tempActiveAdCondition",t),e.setSubModel(this.model),this._setAd(e),this.$el.height(this.model.get("videoPlaceholderSize.height")),this._rePosition(this.model,this.model.get("videoPlaceholderPosition")),this.isEligibleToPlay(),this.log.info("is Viewability fired",e.isViewabilityFired)}extractAd(e){this.model.set("isCardBelongToTempAd",!0),this.model.set("tempAdCondition",e),this.ad$el&&this.ad$el.css("height","0"),this._removeAnimation(),this.activeAd=void 0,this.ad$el=void 0,this._startLoadingView(!0),this._clearViewabilityTime()}onConditionComplete(){this.model.set("isCardBelongToTempAd",!1),this.model.set("tempAdCondition",!1),this.listeningToCondition=!1,this.globalModel.set("temAdCondition",!0)}onTempAdEnd(){this.log.info("@!! onTempAdEnd subUnitId: ",this.subUnitId),this.log.info("@!! onTempAdEnd isCardBelongToTempAd: ",this.model.get("isCardBelongToTempAd")),this.model.get("isCardBelongToTempAd")&&(this.model.set("isCardBelongToTempAd",!1),this.model.set("tempAdCondition",!1),this.listeningToCondition=!1,this.onLocalTimerEnd("Temp Card Close"))}_addUIComponents(){this._addCloseButton(),this._addAdChoice(),this._adVolumeButton()}_adVolumeButton(){this.model.get("components.volume.isActive")&&(this.volume=new Wi({model:this.model,container:this.el,globalModel:this.globalModel}))}_updateVolumeButton(){this.volume&&this.volume.$el.appendTo(this.$el)}_showRepeat(){this.loadingView&&this.loadingView.showRepeat()}getActiveAd(){return this.activeAd}getEl(){return this.el}getModel(){return this.model}isContentViewActive(){return!!this.model.get("components.contentVideo.isActive")&&(!(!this.model.get("detachToSlider.isStartFromSlider")||!this.model.get("detachToSlider.isDetachToSlider"))&&!!this.isDetached)}_addContentView(){this.isContentViewActive()&&(this.contentView=new qi({model:this.globalModel,container:this.container}),this.log.info("Content was created."))}_showContentView(){this.contentView?(this._switchFromActiveAd("_startLoadingView"),this.el=this.contentView.el,this.$el=this.contentView.$el,this.$el.removeClass("_cm-ad"),this.$el.removeClass("_cm-ad-active"),this.currentSize=null,this.isDetached?this._resetElDetached():this.log.warning("Should not start content when attached!!!"),this.contentTimer.start(this.model,"")):this.log.warning("There is no content view available!")}terminateContent(){this.isContentViewActive()||this.contentView&&this.contentView.terminate()}_handleMidroll(){this.isContentViewActive()?this._showContentView():this._startLoadingView()}_stopLocalTimers(){this.getAdTimer.stop(this.model,"",null,!0),this.contentTimer.stop(this.model,"",null,!0)}};var Xi=o(316),Ji=o(84),es=o(999);class ts extends E.O{constructor(e,t){super(e),this.model=e,this.globalModel=t,this.model.set("isEligibleToPlay",!1),this.model.get("isTestParentSelector")&&this._bindScroll(),this.model.get("isInAppBridgeOn")&&window.taboolaBridge&&this._observeInAppIntersectionChange(),this.oldRect={},this.viewabilityPercent=this.model.get("viewabilityPercent"),this.printCurrentViewPercent=this.model.get("printCurrentViewPercent"),this.isListenToScrollSpeedChange=this.model.get("eligibility.isListenToScrollSpeedChange"),this.isListenToScrollSpeedChange&&(this.scrollManager=new x.Z,this.maxPPS=this.model.get("eligibility.maxPPS"),this.scrollManager.registerForPPSChange(this._testEligibility.bind(this)))}_bindScroll(){this._testTopParentSelector(),Xi.on("window:scroll:change",this._testTopParentSelector.bind(this))}_isLowerThenMaxPPS(){return!this.maxPPS||Math.abs(this.scrollManager.getPps())<this.maxPPS}_initObserver(){var e={rootMargin:"0px",threshold:[0,this.model.get("viewPercent")/100,this.model.get("viewabilityPercent")/100,this.model.get("100viewPercent")/100]};if(this.model.get("stickyCard.isActive")){var t=this.model.get("stickyCard.observerThreshold");t&&e.threshold.push(...t)}this.observer=new IntersectionObserver(this._observerCallback.bind(this),e),this.log.info("IntersectionObserver was created")}bindEvent(){}_getDimensions(e){var t=Ji(e);return{width:t.width()||this.model.get("width"),height:t.height()||this.model.get("height")}}_calculateEligibility(){this.model.get("isUseObserver")||(this.inViewDiv=this._getInViewDiv()),this._testEligibility()}_onTabEvent(e){}_printCurrentViewPercent(e,t){this.printCurrentViewPercent&&this.log.info("".concat(e,": "),t||0)}_getInViewDiv(){for(var e=0;e<this.placeHolders.length;e++){var t=this.placeHolders[e],i=this._getDimensions(t),s=es.getViewPercent(t,i.width,es.getVideoHeight(i.width),this.model.get("scrollSelector"));this._printCurrentViewPercent("currViewPercent",s);var o=this.model.get("viewPercent")||100;if(this.model.set("isViewable",this.viewabilityPercent<=s),this.model.set("isViewable100",s>=this.model.get("100viewPercent")),this.model.get("stickyCard.isActive")){var n=s<this.model.get("stickyCard.attachPercent")&&this._canStickToTop(t);this.model.set("isEligibleToStick",n)}if(o<=s)return this.placeHolders[e]}}_observerCallback(e,t){this.inViewDiv=void 0;for(var i=0;i<e.length;i++){var s=100*e[i].intersectionRatio;if(this.model.set("isViewable100",s>=this.model.get("100viewPercent")),this.model.set("isViewable",this.viewabilityPercent<=s),this.model.get("stickyCard.isActive")){var o=s<this.model.get("stickyCard.attachPercent")&&e[i].boundingClientRect.top<=0;this.model.set("isEligibleToStick",o)}if(s>=this.model.get("viewPercent")){this.inViewDiv=e[i];break}}this._testEligibility()}_testEligibility(){}_testTopParentSelector(){var e=this._getTopParentSelector();this.topParentSelector||(this.topParentSelector=e),this.topParentSelector&&!e&&this.model.get("isCheckTopParentSelectorLost")&&(this.model.set("topParentSelectorLost",!0),this._stopObserver())}_getTopParentSelector(){var e=this.model.get("parentSelector");return e=Array.isArray(e)?e[0]:e,e=Ji(e)[0],es.getTopOfEl(e)}_observeInAppIntersectionChange(){window.taboolaBridge.on("intersectionChanged",this._onIntersectionChanged.bind(this)),window.taboolaBridge.active=!0}_onIntersectionChanged(e){var t=e.rects.boundingClientRect,i={width:function(){return t.width},height:function(){return Math.abs(t.top-window.taboolaBridge.data.rootBounds.height)},top:function(){var e=0;return t.top<0&&(e-=t.top),e}};this.model.set("scrollSelector",i),this._calculateEligibility()}_canStickToTop(e){return!!e&&e.getBoundingClientRect().top<=0}_getFromModel(e){return(this.globalModel||this.model).get(e)}_stopObserver(){this.observer&&this.observer.disconnect&&this.observer.disconnect()}_setToModel(e,t){this.model.set(e,t),this.globalModel&&this.globalModel.set(e,t)}}const is=ts;var ss=o(84),os=o(316),ns=o(999);const rs=class extends is{constructor(e,t){super(e),this.log=new y.Z({unitType:"Service",className:"FeedEligibility",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.placeHolder=ss(this.model.get("parentSelector"))[0],this.bindEvent(),this.model.get("isUseObserver")?(this._initObserver(),this.observer.observe(this.placeHolder)):this._initEligibilityListener()}bindEvent(){this.createStateHandlers([{event:"getAdState",funcName:"_calculateEligibility"},{event:"feedxToggle",funcName:"_updateFeedSelector"},{event:"feedContainerChanged",funcName:"_updateFeedSelector"},{event:"isInTab",funcName:"_onTabEvent"}])}_initEligibilityListener(){this._calculateEligibility(),os.on("window:scroll:change",this._calculateEligibility.bind(this))}_onTabEvent(e,t){t?this._calculateEligibility():this.model.set("isEligibleToPlay",!1)}_getInViewDiv(){var e=window.innerHeight+window.pageYOffset;if(ns.getTopOfEl(this.placeHolder)+1<=e)return this.placeHolder}_observerCallback(e,t){this.inViewDiv=void 0;for(var i=0;i<e.length;i++)if(e[i].isIntersecting){this.inViewDiv=e[i];break}this._testEligibility()}_testEligibility(){this.inViewDiv?(this.model.set("isEligibleToPlay",!0),this.model.set("isEligibleToPlayFirstTime",!0)):this.model.set("isEligibleToPlay",!1)}_testTopParentSelector(){var e=!1,t=this.model.get("ParentSelector"),i=ss(t);ns.forEach(i,(t=>{ns.getTopOfEl(t)&&(this.hadValidParent=!0,e=!0)})),this.hadValidParent&&!e&&this.model.get("isCheckTopParentSelectorLost")&&(this.model.set("topParentSelectorLost",!0),this.observer&&this.observer.disconnect&&this.observer.disconnect())}_updateFeedSelector(){this.placeHolder=ss(this.model.get("parentSelector"))[0],this.observer&&this.observer.observe(this.placeHolder),this._calculateEligibility()}};var as=o(999),ds=o(84);const ls=class extends yi{constructor(e){super(e,"SubFeedVideoView "+e.model.get("cardNumber"),e.globalModel),this.isFirstAd=!0,this.isWaitingContentViewTimeout=!1,this.globalModel=e.globalModel,this.nativeAdSettings=e.nas,this.animationUtil=zt(this.model),this.isSliderAllow=this.ad.adData.alwsldr,this.detachToSlider=this.model.get("detachToSlider"),this.currentAnimation=S.z.ANIMATION_TYPE.none,this.isStickyCardActive=this.model.get("stickyCard.isActive"),this.sliderWasCutOff=!1,this.render(),this._setAd(e.adjs),this.isStickyCardActive&&(this._setStickyCardParams(),this.stickyViewCallback=e.stickyViewCallback)}render(){this.$el.addClass("_cm-video-with-slider"),this.model.set("videoViewState",j.Z.videoViewState.rendered),as.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoInitToRender".concat(this.model.get("perfUnitType")),S.z.TRC_PERFORMANCE_ACTIONS.STOP)}_setStickyCardParams(){var e=this.getStickyPosition();this.detachToSlider.position.horizontalOffset=e.left,this.detachToSlider.position.verticalOffset=e.top,this.detachToSlider.position.horizontal="left",this.detachToSlider.position.vertical="top"}getStickyPosition(){var e=this.$el.offset(),t={top:this.model.get("stickyCard.offset.top")||0,left:this.model.get("stickyCard.offset.left")||0};return{top:"".concat(t.top),left:"".concat(e.left+t.left)}}_bindEvents(){this.createStateHandlers([{event:"blockedByExternalUnit",funcName:"_onBlockedByExternalUnitChange"},{event:"isInTab",funcName:"onIsInTabChange"}]);var e=this.model.get("isMultiAd")&&!this.model.get("isPlacementSingleAd");this.model.get("isForceSwapToRV")&&e&&(this.currModel.on("change:hasReadyAd",this.onGotRVAd.bind(this)),this.currModel.on("change:isNextAdRV",this.onGotRVAd.bind(this))),as.isSliderCutOffEnabled(this.model,this.ad.adData)&&this.currModel.on("change:isNextAdNotAllowSlider",this._onGotNotAllowSliderAd.bind(this)),this.model.listenTo(this.model,"displayingFullNAS",this._onDisplayingFullNAS.bind(this)),this.model.listenTo(this.model,"displayingNASTitleOnly",this._onDisplayingNASTitleOnly.bind(this))}_onGotNotAllowSliderAd(){this.FeedEligibilityService=new rs(this.model,this.model.get("parentSelector")),this.model.once("change:isEligibleToPlayFirstTime",this._handleNotAllowSliderAd.bind(this)),this.model.on("change:isEligibleToPlay",this.checkEligible.bind(this))}_handleNotAllowSliderAd(){this.activeAd||this.getReadyAd()}_setAd(e){var t,i;this.isFirstAd?this._switchFromActiveAd("set ad first ad switch"):this.isFirstAd=!1,this.model.get("predictors.postRepeat.isActive")&&null!==(t=e.adTypeConfig)&&void 0!==t&&null!==(t=t.singleAd)&&void 0!==t&&t.isPlacementSingleAd&&this.model.set("components.contentVideo.isActive",!1),this.el=e.vpaidWrapper.adTarget,this.isCurrentAdRV=e.adData.requiredViewability,this.model.get("isReplayAd")&&e.vpaidWrapper.isReplayable&&e.vpaidWrapper.dontDie&&e.vpaidWrapper.dontDie(),this.globalModel.get("volumeMuted")||"iOS"!==(null===(i=this.ua)||void 0===i?void 0:i.os.name)||this.globalModel.set("volumeMuted",!0),this.$el=ds(this.el),this.activeAd=e,this.$el.addClass("_cm-video"),this._switchToActiveAd("set ad"),this._setVolumeEvents(),this.model.set("videoViewContainer",this.$el)}_switchFromActiveAd(e){this.log.info("@@@ _switchFromActiveAd"),this.log.warning("switchFromActiveAd",this.cardNumber),this.$el.addClass("_cm-ad"),this.$el.removeClass("_cm-ad-active"),this.model.get("isReplayAd")||this.model.set("isActiveAd",!1),this.repeatingAd&&this.repeatingAd.vpaidWrapper&&ds(this.repeatingAd.vpaidWrapper.adTarget).css({display:"none !important"})}_switchToActiveAd(e){this.$el.removeClass("_cm-ad"),this.$el.addClass("_cm-ad-active"),this.model.set("isActiveAd",!0),this.changeBackgroundColor(),this.log.info("switchToActiveAd",this.cardNumber)}detach(e,t,i){if(e||!this.isDetached){this.log.info("detaching"),this.currentAnimation=S.z.ANIMATION_TYPE.detaching;var s=!this.model.get("stickyCard.isActive");this.changeBackgroundColor(s),this.$el.css(this.model.get("additionalCss")),this.nativeAdSettings?(this.model.once("nativeAdSettingsUpdated",this._detach.bind(this,e,t,i)),this.nativeAdSettings.triggerDetachIfRendered()):this._detach(e,t,i),this.isDetached=!0,this.model.set("videoViewState",j.Z.videoViewState.detached),this.checkEligible()}}_detach(e,t,i){var s=ds.extend(!0,{},this.detachToSlider);this.nativeAdSettings.hasNAS&&s.height&&(s.height+=this.nativeAdSettings.getFloatingNASHeight(),this.model.set("detachToSlider.height",s.height));var o=t||this.model.get("videoViewState")!==j.Z.videoViewState.detached?i:0;this.animationUtil.detach({$el:this.$el,timeMS:o,sliderOptions:s,isSlideIn:t,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this),isAmp:this.model.get("frameType")===S.z.FRAME_TYPE.amp}),this.nativeAdSettings.hasNAS&&this.model.set("detachToSlider.height",s.height-this.nativeAdSettings.getFloatingNASHeight())}detachAmpSticky(e,t,i,s){if(e||!this.isDetached){this.log.info("detaching"),this.currentAnimation=S.z.ANIMATION_TYPE.detaching;var o=!this.model.get("stickyCard.isActive");this.changeBackgroundColor(o),this.$el.css(this.model.get("additionalCss")),this.animationUtil.detachAmpSticky({$el:this.$el,timeMS:i,sliderOptions:s,isSlideIn:t,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this)}),this.isDetached=!0,this.model.set("videoViewState",j.Z.videoViewState.detached),this.checkEligible()}}correctSliderAMPOffset(e){this.currentAnimation=S.z.ANIMATION_TYPE.detaching,this.animationUtil.correctSliderDetachPosition({$el:this.$el,sliderOptions:e,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this)})}postDetach(){this.currentAnimation===S.z.ANIMATION_TYPE.detaching&&(this.currentAnimation=S.z.ANIMATION_TYPE.none,as.isEmpty(this.model.get("detachToSlider").customCss)||this.$el.css(JSON.parse(this.model.get("detachToSlider").customCss)),(this.model.get("frameType")!==S.z.FRAME_TYPE.amp||this.model.get("isViewableAMP"))&&this.activeAd&&(this._playAd(),this.activeAd.onDetached()))}resize(e,t,i){if(!this.currentSize||this.currentSize.width!==e.width||this.currentSize.height!==e.height||t){if(!i||t){var s=ds.extend(!0,{},e);this.nativeAdSettings&&this.nativeAdSettings.hasNAS&&(s.height+=this.nativeAdSettings.getFloatingNASHeight()),this.$el.css(s)}0!==e.height&&0!==e.width&&(this.activeAd&&this.activeAd.vpaidWrapper?this.activeAd.resize(e):this.repeatingAd&&this.repeatingAd.vpaidWrapper&&this.repeatingAd.resize(e),this.currentSize=ds.extend(!0,{},e),this.model.trigger("change:videoViewSize",e))}}_playNextAd(){this.activeAd.recheckSize(),this.playAd()}_playAd(){if(!this.isWaitingContentViewTimeout){var e=this.model.get("components.contentVideo.isActive");if(!this.isFirstAd&&e){this.isWaitingContentViewTimeout=!0;var t=1e3*this.model.get("timeBetweenAds");window.setTimeout((()=>{this.isWaitingContentViewTimeout=!1,this.activeAd&&(this.isSwappedAd&&this.model.trigger("showVolumeButtonOnBackFromSwap"),this._playNextAd.call(this))}),t)}else this._playNextAd()}}onAdComplete(){this.isFirstAd&&(this.isFirstAd=!1);var e=!1;if(this.nativeAdSettings&&this.nativeAdSettings.onAdComplete(),this.model.get("isReplayAd")&&this.activeAd&&(this.repeatingAd=this.activeAd,e=!0),this.handlePlayerOutOfViewport(),this._switchFromActiveAd("end off ad"),e||(this.activeAd=void 0),this._shouldSwapAdBack())return this.isSwappedAd=!1,this._setAd(this.swappedAd),this.model.trigger("showVolumeButtonOnBackFromSwap"),this._swapNativeAdSettings(),this.swappedAd=void 0,this.postGetAd(),e||this.activeAd.onResumeAfterSwapOut(),void(this.isWaitingContentViewTimeout&&this.model.set("videoView.showingAd",!1));this._shouldWaitForNonSliderEligibility()?this.globalModel.set("notAllowSliderWaitingForEligibility",!0):(this.model.set("videoView.showingAd",!1),this.model.get("isCardBelongToTempAd")&&this.onConditionComplete(),this.model.get("isMultiAd")&&!this.model.get("isPlacementSingleAd")?this._shouldSwapAdBack()?this.swapBackToSavedAd():this.checkEligible():this.isSingleAdCompleted=!0)}_shouldSwapAdBack(){return this.isSwappedAd&&!(this.currModel.get("hasReadyAd")&&this.currModel.get("isNextAdRV"))}_shouldWaitForNonSliderEligibility(){return this.currModel.get("isNextAdNotAllowSlider")&&as.isSliderCutOffEnabled(this.currModel,this.ad.adData)&&this.currModel.get("hasReadyAd")&&this.isDetached}_onViewability(){this.activeAd?(yi.prototype._onViewability.call(this),this.log.info("!!@ _onViewability",this.model.get("tempAdCondition")),"viewability"===this.model.get("tempAdCondition")&&this.onConditionComplete()):this.log.warning("Viewability without active ad was called!")}onIsInTabChange(){this.activeAd&&this.activeAd.vpaidWrapper&&this.model.get("isInTab")&&as.forceElementRedrawWithBorderChange(this.model.get("wurfl.browser"),this.activeAd.vpaidWrapper.adTarget),this.checkEligible()}checkEligible(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRepeatMode||e){var t=this.isEligibleToPlay();this._setCardId(),t?(this.activeAd||this.getReadyAd(),this.activeAd&&(this.hadPossibleRV&&(this.onGotRVAd(),this.hadPossibleRV=!1),this.log.info("Play Ad sub unit: "+this.subUnitId+" ad:"+this.activeAd.adId),this._shouldSkipPlayingNotAllowSliderAd()?this.pauseAd():this._playAd())):this.pauseAd(),!t&&this.isFirstDetach&&(t=!0),this._updateSubAdEligibilityStatus(t)}}_shouldSkipPlayingNotAllowSliderAd(){return this.globalModel.get("notAllowSliderWaitingForEligibility")}_updateSubAdEligibilityStatus(e){e?(this.log.info("!!!@@@ _updateSubAdEligibilityStatus","set underfind"),this.globalModel.set("lastCardOutOfViewport",void 0)):(this.log.info("!!!@@@ _updateSubAdEligibilityStatus",this.model.get("subUnitId")),this.globalModel.set("lastCardOutOfViewport",this.model.get("subUnitId"))),this.globalModel.set("subAdsEligibility."+this.model.get("subAdId"),e)}isEligibleToPlay(){return!this.model.get("blockedByExternalUnit")&&(this.model.get("isInTab")?!!this.model.get("isEligibleToPlay")||this.model.get("videoViewState")===j.Z.videoViewState.detached:this.model.get("videoViewState")===j.Z.videoViewState.detached&&"play"===this.model.get("detachToSlider").onOutOfView)}_setCardId(){this.isDetached?this.model.set("cardNumber",-1*this.cardNumber):this.model.set("cardNumber",this.cardNumber)}getReadyAd(){if(!this.isSingleAdCompleted||this.globalModel.get("postRepeatMode"))if(this.globalModel.get("hasReadyAd")){var e=this.globalModel.getNextAd();if(!e)return;this.globalModel.get("lastAdID")||this.globalModel.set("lastAdID",e.adId),this.log.info("Video View Got new ad of type : "+parseInt(e.adData.requiredViewability?"1":"0"),e),this._switchFromActiveAd("getReadyAd"),this._setAd(e),this.activeAd.setSubModel(this.model),this.postGetAd()}else this.log.warning("Could not find ad"),this.watingForAd=!0,this.globalModel.once("change:hasReadyAd",this.hasReadyAdChangeSubUnit.bind(this))}postGetAd(){this.repositionVideo(),this.resize(this.currentSize,!0),this.isWaitingContentViewTimeout||this.model.set("videoView.showingAd",!0),this.sliderWasCutOff&&this._setAd(this.activeAd),this.checkEligible(this.sliderWasCutOff)}expand(){if(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$el){this.log.info("Expand"),this.currentAnimation=S.z.ANIMATION_TYPE.expanding;var e=this.model.get("videoPlaceholderSize");this.resize(e);var t={height:0,width:e.width};this.resize(t),this.animationUtil.expand({$el:this.$el,timeMS:this.model.get("animation.transitionAnimationTime"),height:this.model.get("videoPlaceholderSize.height"),cb:this.postExpand.bind(this)})}}postExpand(){this.currentAnimation===S.z.ANIMATION_TYPE.expanding&&(this.currentAnimation=S.z.ANIMATION_TYPE.none)}collapse(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$el;e&&this.animationUtil.collapse({$el:e,timeMS:this.model.get("animation.transitionAnimationTime"),height:0,cb:null})}reAttach(e,t,i){this.animationUtil.expand({$el:this.model.get("videoViewContainer"),timeMS:this.model.get("animation.transitionAnimationTime"),height:this.model.get("height"),cb:this.attach.bind(this)})}attach(e,t,i){this.log.info("Attaching to card",this.$el),this.currentAnimation=S.z.ANIMATION_TYPE.attaching,this.isDetached=!1,this.changeBackgroundColor(!1),this.animationUtil.attach({$el:this.$el,target:this.model.get("videoPlaceholderPosition"),isAnimated:e,timeMS:t,additionalCss:this.model.get("additionalCss"),size:this.model.get("videoPlaceholderSize"),cb:this.postAttach.bind(this,i)}),this.handlePlayerOutOfViewport(),this.model.set("videoViewState",j.Z.videoViewState.attached)}postAttach(e){this.currentAnimation===S.z.ANIMATION_TYPE.attaching&&(this.currentAnimation=S.z.ANIMATION_TYPE.none,this.log.info("Attached",this.$el),e&&(this.isFirstDetach=!1,this.model.trigger("change:videoViewSize",this.model.get("videoPlaceholderSize"))),this.activeAd&&this.activeAd.onAttached(),this.checkEligible())}slideOut(e,t){this.animationUtil.slideOut({$el:this.$el,timeMS:e,sliderOptions:this.detachToSlider,isVerticalSlideOut:t,cb:null}),this.isDetached=!1,this.model.set("videoViewState",j.Z.videoViewState.attached),this.pauseAd(),this.model.get("isSuperSlider")&&(this.model.set("isSuperSliderClosed",!0),this.globalModel.set("isSuperSliderClosed",!0),this._updateSubAdEligibilityStatus(!1))}runSlideOutAnimation(e,t){this.animationUtil.slideOut({$el:this.$el,timeMS:e,sliderOptions:this.detachToSlider,isVerticalSlideOut:t,cb:null})}onTimerEnd(){this.activeAd=void 0}pauseAd(e){this.activeAd&&(this.log.info("Pause Ad sub unit: "+this.subUnitId+" ad:"+this.activeAd.adId),this.activeAd.pause(e))}_skipAd(){this.activeAd&&(this.sliderWasCutOff=!0,this.log.info("Skip Ad sub unit: "+this.subUnitId+" ad:"+this.activeAd.adId),this.activeAd.skipAd(),this.activeAd=void 0)}handlePlayerOutOfViewport(){var e=this.activeAd&&this.activeAd.vpaidWrapper&&this.activeAd.vpaidWrapper.adTarget.parentElement;this.model.get("isPlayerOutOfViewport")&&e&&(e.style.top="-"+this.globalModel.get("topOffsetPosition")+"px")}terminate(){this.log.info("terminate"),this.$el&&(this.activeAd&&this.activeAd.pause(S.z.PAUSE_REASONS.UNIT_TERMINATED),this.$el.remove(),this.isDetached=!1,this.close(),this.globalModel.set("isSliderClosed",!1))}close(){this.log.info("close"),this.$el.height(0),setTimeout(function(){this.permanentClose()}.bind(this),1500)}permanentClose(){this.log.info("permanentClose"),this.activeAd?(this.activeAd.pause(S.z.PAUSE_REASONS.PERMANENT_CLOSE),this.activeAd=void 0):this.$el.remove()}getActiveAd(){return this.activeAd}getEl(){return this.el}getModel(){return this.model}extractAd(){this.$el&&this.$el.css("height","0"),this.activeAd=void 0,this.$el=void 0}injectAd(e){e.setSubModel(this.model),this._setAd(e),this.$el.height(this.model.get("videoPlaceholderSize.height")),this.isEligibleToPlay(),this.log.info("is Viewability fired",e.isViewabilityFired)}onConditionComplete(){this.model.set("isCardBelongToTempAd",!1),this.model.set("tempAdCondition",!1),this.globalModel.set("temAdCondition",!0)}isRepeatingAd(){return this.repeatingAd&&this.repeatingAd.vpaidWrapper.isReplayable}startRepeatingAd(){var e=this.repeatingAd;e.setNativeAdClickListener(),this._setAd(e),this.$el.css({display:"block !important"}),this.postGetAd(),e.vpaidWrapper.restartAd(),this.log.info("replaying ad "+e.adId),e.setToModel("adQState",j.Z.adQState.repeating,e.adId),e.setToModel("adState",j.Z.adState.repeating,e.adId),e.adState=j.Z.adState.repeating,setTimeout(this.activeAd.recheckSize.bind(this.activeAd),0)}repositionVideo(){this._isSliderNotAllow()&&!this.isFirstAd?this.isDetached=!1:this.isDetached?(this.isDetached=!1,this.detach(!1,0)):this.attach(!1,0,!1)}_isSliderNotAllow(){return this.activeAd&&as.isSliderCutOffEnabled(this.model,this.activeAd.adData)}onSliderClose(){this.activeAd&&this.activeAd.onSliderClose()}changeBackgroundColor(e){!e&&this.model.get("style.videoBackgroundColor")&&this.$el.css("background-color",this.model.get("style.videoBackgroundColor")),e&&this.$el.css("background-color","transparent")}swapBackToSavedAd(){this.isSwappedAd=!1,this._setAd(this.swappedAd),this.swappedAd=void 0,this.model.set("aspectRatioNum",this.activeAd.aspectRatioNum),this.postGetAd()}_bindBlockedByExternalUnitChange(){}_onBlockedByExternalUnitChange(){this.model.get("blockedByExternalUnit")?(this._pauseAd(S.z.PAUSE_REASONS.BLOCKED_BY_EXTERNAL_UNIT),this.activeAd&&this.activeAd.fireAdOppOnce("adPausedOtherUnitIsPlaying")):this.checkEligible()}_pauseAd(e){this.activeAd&&this.activeAd.pause(e)}};class hs extends E.s{constructor(e){super(e),this.log=new y.Z({unitType:e.unitType,className:"closeButtonView",version:e.model.get("version"),isDebug:e.model.get("isDebug")}),this._setInitialParameters(e),e.isSkipRender||this.render(),this.bindEvents()}_setInitialParameters(e){this.container=e.container,this._rendered=!1,this.currModel=e.globalModel?e.globalModel:this.model}render(){if(!this._rendered){this._rendered=!0,this.el.id="_cm-close-area",this.$el.addClass("_cm-close-area"),this.$el.append(Di);var e=this.model.get("wurfl.browser.name").toLowerCase();-1===e.indexOf(S.z.BROWSER.FIREFOX.toLowerCase())&&-1===e.indexOf(S.z.BROWSER.IE.toLowerCase())&&-1===e.indexOf(S.z.BROWSER.EDGE.toLowerCase())||this.$el.addClass("_cm-close-ie-fix"),this.container.appendChild(this.el)}}bindEvents(){this.$el.on("click",(()=>{this._onClick()})),this.listenTo(this.currModel,"change:closeButton.isShowing",this.setButtonVisible.bind(this))}_onClick(){this.currModel.trigger("change:closeButtonClick",!0)}setButtonVisible(e,t){t?this.show():this.hide()}hide(){this.$el.hide()}show(){this.$el.show()}}const cs=hs;var us=o(84),gs=o(316),ms=o(999);function ps(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function vs(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ps(Object(i),!0).forEach((function(t){fs(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ps(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function fs(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class bs extends E.s{constructor(e){super(e),this.cardNumber=this.model.get("cardNumber"),this.log=new y.Z({unitType:this.model.get("unitType"),className:"SubFeedFloatingView "+this.cardNumber,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.isAmp=window.TRC&&window.TRC.isAMP,this.isNextUpActive=this.model.get("nextUp.isActive"),this.nativeAdSettings=e.nas,this.globalModel=e.globalModel,this.eligibilityService=e.eligibilityService||{},this.container=us(this.model.get("videoContainerSelector")||"body")[0],this.enableStickyOnNonAllowSlider=this.model.get("enableStickyOnNonAllowSlider"),this.animationUtil=zt(this.model),this.detachToSlider=this.model.get("detachToSlider")||{},this.attachedOnceToNewCard=!1,this.isDetachActive=this.detachToSlider.isStartFromSlider||this.detachToSlider.isDetachToSlider,this.isStickyCardActive=this.model.get("stickyCard.isActive"),this.isStickyCardActive&&this.globalModel.set("floatingNAS.isActive",!1),this.isDetachedHasCloseButton=this.isDetachActive&&this.detachToSlider.hasCloseButton,this.isAttachedHasCloseButton=this.model.get("hasCloseButton"),this.isAnimateOnClose=this.model.get("isAnimateOnClose")||this.model.get("animation.onTransitionClose")&&"close"===this.model.get("onTimerClose"),this.isForceDetachOnGotAd=(this.isDetachActive||this.isStickyCardActive)&&this.model.get("detachToSlider.forceDetach.isActive");var t={startCondition:{stateToListen:"",state:""}},i=this._getSecondsForLoadingTimer();this.loadingTimer=new At(this.model,t,this.onLocalTimerEnd.bind(this,"midrollCollapse subUnit"),i),this.contentTimer=new At(this.model,t,this.onLocalTimerEnd.bind(this,"Content timer subUnit"),1e3*this.model.get("contentTimerSeconds")),this.currentAnimation=S.z.ANIMATION_TYPE.none,this._setStickParams(),this._setSliderSize(),this.render(),this.renderComponenets(),this.subFeedVideoView=new ls(vs(vs({},e),{},{stickyViewCallback:this.permanentAttach.bind(this)})),this._bindEvents(),this.startUnit()}_getSecondsForLoadingTimer(){return 1e3*(this.model.get("isPlacementSingleAd")?this.model.get("secondsToCloseSingleAdFeed")||0:this.model.get("secondsToCloseFeed"))}_bindEvents(){this.createStateHandlers([{event:"isEligibleToPlay",funcName:"isEligibleToPlayChange"},{event:"closeButtonClick",funcName:"_onCloseButtonClick"},{event:"loadingViewState:clicked",funcName:"_onLoadingClick"},{event:"adQState:completed",funcName:"onAdComplete"},{event:"adQState:q0",funcName:"_onAdActive"},{event:"isEligibleToStick",funcName:"isEligibleToPlayChange"},{event:"videoView.showingAd",funcName:"onAdDisplayChange"},{event:"videoPlaceholderSize",funcName:"onVideoPlaceholderSizeChange",withBind:!1},{event:"videoPlaceholderPosition",funcName:"onVideoPlaceholderPosition",withBind:!1},{event:"aspectRatioNum",funcName:"onAspectRatioChange"},{event:"isInTab",funcName:"onIsInTabChange"},{event:"blockedByExternalUnit",funcName:"_onBlockedByExternalUnit"},{event:"isActiveAd:true",funcName:"_show"},{event:"isActiveAd:false",funcName:"_hide"}]),this.isContentViewActive()&&this.globalModel.listenTo(this.globalModel,"change:content.isContentPlay",this._onContentViewPlay.bind(this)),this.globalModel.on("change:postRepeatMode",this._handlePostRepeatMode.bind(this)),this.model.get("stickyCard.isActive")&&(gs.on("window:scroll:change",this._onWindowScroll.bind(this)),gs.on("window:resize:change",this.onWindowResize,this),this.model.get("feedCardElig.isActive")&&this.globalModel.on("change:ampPageTopLimit",this._correctAMPOffset.bind(this))),this.isDetachActive&&this.model.get("frameType")===S.z.FRAME_TYPE.amp&&(this.model.set("ampPageBottomLimit",this.globalModel.get("ampPageBottomLimit")),this.model.set("ampPageTopLimit",this.globalModel.get("ampPageTopLimit")),this.globalModel.on("change:ampPageBottomLimit",this._correctSliderAMPOffset.bind(this)));var e=this.getActiveAd();e&&ms.isSliderCutOffEnabled(this.model,e.adData)&&this.globalModel.get("isSuperSlider")&&this.globalModel.once("change:notAllowSliderWaitingForEligibility",this._reAttachSlider.bind(this))}startUnit(){this.model.get("isEligibleToPlay")&&!this.globalModel.get("isSuperSlider")?this.startUnitAttached():this.model.get("isSuperSlider")&&this.model.get("frameType")===S.z.FRAME_TYPE.amp?this.globalModel.get("isSliderEligibleToPlay")?this.startUnitDetached():this.globalModel.on("change:isSliderEligibleToPlay",this.startUnitDetached.bind(this)):this.model.get("isOpenFloatingViewInViewPort")?this.model.get("detachToSlider.isStartFromSlider")&&!this._isSliderNotAllow()?this.startUnitDetached():this._isForceAdDetach()?(this.hadForcedDetach=!0,this.isDetachedHasCloseButton=this.detachToSlider.hasCloseButton,this.startUnitDetached()):this.createStateHandlers([{event:"isEligibleToPlay",funcName:"startUnitAttached",isListenOnce:!0,withBind:!0}]):this.startUnitAttached(!0)}_isSliderNotAllow(){var e=this.getActiveAd();return ms.isSliderCutOffEnabled(this.model,e&&e.adData)}_isStickyDisabled(){return!this.isStickyCardActive||!this.enableStickyOnNonAllowSlider}_isForceAdDetach(){if(!this.isForceDetachOnGotAd||this.globalModel.get("hadStickyDetach"))return!1;var e=this._isActiveAdCanStick()&&!this.globalModel.get("isEligibleToPlay");return this.log.info("force ad detach:",e),e}startUnitAttached(e){this.isAttachingOnStart=!0,this.attach(!1,!0),e||this.playAd()}startUnitDetached(){this.isFirstDetach=!0,this._startFromSlider()}_startFromSlider(){this.detach(),this.playAd()}render(){this.el.id="_cm-css-reset",this.$el.addClass("_cm-floating-view"),this.$el.css({width:this.model.get("width"),height:0}),this.container.appendChild(this.el)}renderComponenets(){this.createCloseButton(),this.createLoadingView(),this._addAdChoice(),this._adVolumeButton(),this._addDisclosureText(),this._addContentView()}_onLoadingClick(){this.isReplayMode||(this.model.get("isReplayAd")&&this.subFeedVideoView.isRepeatingAd()?(this.log.warning("Repeating ad should play"),this.subFeedVideoView.startRepeatingAd(),this.isReplayMode=!0,this.hideLoadingView()):(this.log.info("@@@ loadingTimer start"),this.loadingTimer.start(this.model,""))),this.model.set("isAdClosedByTimer",!1),this.model.set("closeTimer",void 0),this.subFeedVideoView.setRepeatMode(!1),this.globalModel.once("change:hasReadyAd",this.subFeedVideoView.hasReadyAdChangeSubUnit.bind(this.subFeedVideoView))}_setSliderSize(){if(this.detachToSlider){var e,t=this.model.get("width");if(this.model.get("stickyCard.isActive")){e=this.model.get("height");var i=this.getStickyPosition();return this.detachToSlider.position.horizontalOffset=i.left,this.detachToSlider.position.verticalOffset=i.top,this.detachToSlider.position.horizontal="left",this.detachToSlider.position.vertical="top",this.model.set("detachToSlider.width",t),void this.model.set("detachToSlider.height",e)}this.originalSliderWidth&&(this.detachToSlider.width=this.originalSliderWidth,this.originalSliderWidth=void 0),this.originalSliderHeight&&(this.detachToSlider.height=this.originalSliderHeight,this.originalSliderHeight=void 0),this.originalSliderHeight=this.detachToSlider.height;var s=this.detachToSlider.liquidSize&&this.detachToSlider.liquidSize.isActive?this._calcLiquidWidth():this.detachToSlider.width;this.isNextUpActive?(t=window.innerWidth,e=this.model.get("nextUp.height")||80):(t>s&&(t=s),e=ms.getVideoHeightByRatio(t,this.model.get("aspectRatioNum")<=1?1.77:this.model.get("aspectRatioNum"))),this.model.set("detachToSlider.width",t),this.model.set("detachToSlider.height",e)}}_setStickParams(){var e=this.model.get("stickyCard.navBarSelector"),t=document.querySelector(e),i=this.model.get("stickyCard.offset.top");if(t){var s=t.offsetHeight||0;this.model.set("stickyCard.offset.top",i+s)}}_setStickyOffsetAMP(){this.ampOffsetTop=this.globalModel.get("ampPageTopLimit")}_getCardTopOffset(e,t){var i='[data-card-index="'.concat(e,'"]'),s=us(i);if(!s)return 0;var o=s.offset();return o.top+o.height*(1-t)}getStickyPosition(){var e=us(this.model.get("containerViewPlaceHolder")),t=e.length?e.offset().left:0,i=this.model.get("stickyCard.offset.top")||0;this.model.get("feedCardElig.isActive")&&(this._setStickyOffsetAMP(),this.ampOffsetTop&&(i+=this.ampOffsetTop));var s=t+(this.model.get("stickyCard.offset.left")||0);return{top:"".concat(i),left:"".concat(s)}}_calcLiquidWidth(){this.detachToSlider=this.model.get("detachToSlider");var e=this.detachToSlider.liquidSize.minWidth,t=this.detachToSlider.liquidSize.maxWidth,i=window.innerWidth*(this.detachToSlider.liquidSize.widthPercent/100);return t&&i>t&&(i=t),i<e&&(i=e),i}_calcLiquidHeight(){this.detachToSlider=this.model.get("detachToSlider");var e=this.detachToSlider.liquidSize.maxHeight,t=window.innerHeight*(this.detachToSlider.liquidSize.heightPercent/100);return e&&t>e&&(t=e),t}_reAttach(){this.reAttached||(this.expanded=!1,this.reAttached=!0,this.model.get("isEligibleToPlay")?(this.globalModel.set("notAllowSliderWaitingForEligibility",!1),this._reAttachSlider()):(this._permanentCloseSlider(),this.model.once("change:isEligibleToPlay",this._reAttachSlider.bind(this))))}detach(e,t){if(this.model.set("floatingView",j.Z.floatingView.detach),e||!this.isDetached){this.log.info("detaching"),this.isStickyCardActive||ms.dispatchTRC("videoSliderOn",this.globalModel),this.currentAnimation=S.z.ANIMATION_TYPE.detaching;var i=t?0:this.model.get("animation.detach");this.isFirstDetach&&(i=this.model.get("animation.firstDetach")),this._setSliderSize();var s={width:this.model.get("detachToSlider.width"),height:this.model.get("detachToSlider.height")};this._resize(s,!this.isFirstDetach),this.$el.css(this.model.get("additionalCss")),this.model.get("stickyCard.isActive")&&this.model.get("frameType")===S.z.FRAME_TYPE.amp?(this._setStickyOffsetAMP(),this._setSliderSize(),this.animationUtil.detachAmpSticky({$el:this.$el,timeMS:i,sliderOptions:this.detachToSlider,isSlideIn:this.isFirstDetach,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this)}),this.subFeedVideoView.detachAmpSticky(e,this.isFirstDetach,i,this.detachToSlider)):(this.nativeAdSettings?(this.model.once("nativeAdSettingsUpdated",this._detach.bind(this,e,t,i)),this.nativeAdSettings.triggerDetachIfRendered()):this._detach(e,t,i),this.subFeedVideoView.detach(e,this.isFirstDetach,i)),this.isStickyCardActive&&this.globalModel.set("hadStickyDetach",!0),this.isDetached=!0,this.isPlaceholderHidden||this.isStickyCardActive||(this.subFeedVideoView.collapse(us(this._getPlaceHolderId())),this.isPlaceholderHidden=!0)}}_detach(e,t,i){var s=us.extend(!0,{},this.detachToSlider);this.nativeAdSettings.hasNAS&&(s.position.verticalOffset+=this.nativeAdSettings.getFloatingNASHeight()),this.animationUtil.detach({$el:this.$el,timeMS:i,sliderOptions:s,isSlideIn:this.isFirstDetach,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this),isAmp:this.model.get("frameType")===S.z.FRAME_TYPE.amp}),this.model.get("detachToSlider.forceAttach.isActive")&&this._closeSliderWhenOutOfFeed()}_closeSliderWhenOutOfFeed(){var e=document.querySelector(".".concat(S.z.FEED_SELECTOR));this.forceAttachObserver=new IntersectionObserver((t=>{var i=t[0];!i.isIntersecting&&i.boundingClientRect.top>=0&&(this.terminate(),this.forceAttachObserver.unobserve(e))})),this.forceAttachObserver.observe(e)}postDetach(){this.currentAnimation===S.z.ANIMATION_TYPE.detaching&&(this.currentAnimation=S.z.ANIMATION_TYPE.none,!0===this.isFirstDetach&&(this.isFirstDetach=!1),this.isDetachedHasCloseButton?this._showCloseButton(this.model.get("stickyCard.isActive")):this._hideCloseButton())}_resize(e,t,i){this.currentSize&&this.currentSize.width===e.width&&this.currentSize.height===e.height||(t&&!i||(this.$el.css(e),this.loadingView&&this.loadingView.resize(e)),this.currentSize=us.extend(!0,{},e),this.subFeedVideoView.resize(e,i,t))}onIsInTabChange(){!this.model.get("isInTab")||this.model.get("isEligibleToPlay")||this.model.get("videoViewState")!==j.Z.videoViewState.rendered||this.model.get("blockedByExternalUnit")||this.isEligibleToPlayChange()}isEligibleToPlayChange(){this.currentAnimation===S.z.ANIMATION_TYPE.none&&(this.canAttach()?this.attach():this.canDetach()&&this.detach(),this.subFeedVideoView.checkEligible())}canAttach(){return(!this.model.get("stickyCard.isActive")||!this.model.get("isEligibleToStick"))&&(!!this.globalModel.get("isEligibleToPlay")&&(this.model.get("videoViewState")===j.Z.videoViewState.detached&&(!!this.model.get("renderWasCalled")&&!this.globalModel.get("isSuperSlider"))))}canDetach(){return this.detachToSlider=this.model.get("detachToSlider"),(!this.isStickyCardActive||!this.currAdDetach)&&(!this.model.get("isEligibleToPlay")&&((!this._isSliderNotAllow()||!this._isStickyDisabled())&&(this.model.get("isEligibleToPlay")||this.model.get("isOpenFloatingViewInViewPort")?(this.model.get("videoViewState")===j.Z.videoViewState.attached||this.model.get("videoViewState")===j.Z.videoViewState.rendered)&&(!!this.getActiveAd()&&(this.model.get("loadingViewState")!==j.Z.loadingViewState.showing&&(!!this.detachToSlider.isDetachToSlider&&(!!this.model.get("isInTab")&&(!!this._isDetachAvailable()&&(!this.globalModel.get("blockedByExternalUnit")&&!(this.isAmp&&!this.model.get("isEligibleToPlay")))))))):(this.model.set("isOpenFloatingViewInViewPort",!0),!1))))}_isDetachAvailable(){return!this.globalModel.get("stickyCard.isActive")&&this.globalModel.get("disableDetach")?(this.globalModel.set("disableDetach",!0),!1):this.model.get("frameType")===S.z.FRAME_TYPE.amp?this.model.get("AMPElemBelowVisible")?this.model.get("detachToSlider.isDetachBelow"):this.model.get("detachToSlider.isDetachAbove"):this.el.getBoundingClientRect().top>0?this.model.get("detachToSlider.isDetachAbove"):this.model.get("detachToSlider.isDetachBelow")}_runAnimation(e){e?this.expand():this.collapse()}expand(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$el;if(!this.expanded){this.expanded=!0;var t={height:0,width:this.model.get("videoPlaceholderSize").width};this._resize(t),this.currentAnimation=S.z.ANIMATION_TYPE.expanding,this.animationUtil.expand({$el:e,timeMS:this.model.get("animation.transitionAnimationTime"),height:this.model.get("videoPlaceholderSize.height"),cb:()=>{this.postExpand()}}),this.subFeedVideoView.expand(e)}}postExpand(){this.currentAnimation===S.z.ANIMATION_TYPE.expanding&&(this.currentAnimation=S.z.ANIMATION_TYPE.none,this.isEligibleToPlayChange())}collapse(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$el;this.animationUtil.collapse({$el:e,timeMS:this.model.get("animation.transitionAnimationTime"),height:0,cb:null}),this.subFeedVideoView.collapse()}_getPlaceHolderId(){return"#cm_place_holder_".concat(this.cardNumber).replace(".","")}attach(e,t,i){if(!this.isDetached){var s=this.model.get("videoPlaceholderPosition");if(s)if(isNaN(s.top))this.isStickyCardActive||ms.dispatchTRC("videoSliderOff",this.globalModel);else{var o=this.model.get("animation.attach"),n=(this.detachToSlider.isStartFromSlider||this.isForceDetachOnGotAd)&&this.isDetached||this.attachedOnceToNewCard,r=!e&&n&&this.model.get("detachToSlider").animation;this.isFirstDetach=!1,this.attachedOnceToNewCard=!0,this.log.info("Attaching",this.$el),this.currentAnimation=S.z.ANIMATION_TYPE.attaching,this.model.get("stickyCard.isActive")&&(r=!1),this.isDetached=!1,this.model.set("floatingView",j.Z.floatingView.attach),this.animationUtil.attach({$el:this.$el,target:this.model.get("videoPlaceholderPosition"),isAnimated:r,timeMS:o,additionalCss:this.model.get("additionalCss"),cb:this.postAttach.bind(this,n)}),(this.isAttachingOnStart||i)&&(this.isAttachingOnStart=!1,this.expand(i?us(this._getPlaceHolderId()):this.$el)),this.subFeedVideoView.attach(r,o,n),(n||!this.model.get("animation.onTransitionOpen")||i)&&setTimeout(function(){this._resize(this.model.get("videoPlaceholderSize"),r,!0)}.bind(this),0),this.globalModel.get("isSliderOn")&&!this.model.get("detachToSlider.isDetachToSlider")&&this.globalModel.set("isSliderOn",!1),this.isAttachedHasCloseButton?this._showCloseButton():this._hideCloseButton(),this.loadingView&&this.loadingView.onAttach()}}}postAttach(e){this.model.set("floatingView",j.Z.floatingView.postAttach),this.currentAnimation===S.z.ANIMATION_TYPE.attaching&&(this.isStickyCardActive||ms.dispatchTRC("videoSliderOff",this.globalModel),this.currentAnimation=S.z.ANIMATION_TYPE.none,this.log.info("Attached",this.$el),e&&(this.isFirstDetach=!1),!this.model.get("animation.onTransitionOpen")||e?this.isEligibleToPlayChange():this.expand())}_reAttachSlider(){this.isPermanentAttachCalled||(this.globalModel.set("notAllowSliderWaitingForEligibility",!1),this.model.set("detachToSlider.isStartFromSlider",!1),this.globalModel.set("isSliderOn",!1),this.globalModel.set("isSliderClosed",!0),this.globalModel.set("floatingNAS.isActive",!1),this.model.set("floatingView",j.Z.floatingView.attach),this.isDetached&&this.$el.hasClass("_cm-ad-active")?this._slideOut((()=>{this._hideCloseButton(!0),this.attach(!1,!1,!0),this.getActiveAd()||this.showLoadingView(),this._setAdChoice()})):(this.isDetached=!1,this.attach(!1,this.$el.hasClass("_cm-ad-active"),!0),this._setAdChoice()),this.isPlaceholderHidden=!1,this.terminateContent())}_setAdChoice(){this.adChoiceSlider&&this.adChoiceSlider.forceShowAdChoice()}permanentAttach(){this.isPermanentAttachCalled||(this.model.set("detachToSlider.isStartFromSlider",!1),this.model.set("detachToSlider.isDetachToSlider",!1),this.globalModel.set("isSliderOn",!1),this.globalModel.set("isSliderClosed",!0),this.globalModel.set("floatingNAS.isActive",!1),this.model.set("floatingView",j.Z.floatingView.permanentClosed),this.isDetached?this._slideOut((()=>{this._hideCloseButton(!0),this.model.get("stickyCard.isActive")&&this.attach(!0),this.getActiveAd()||this.showLoadingView()})):this.attach(!0),this.terminateContent(),this.isPermanentAttachCalled=!0)}_slideOut(e){if(this.isDetached){var t=this.model.get("animation.slideOut"),i=this.model.get("stickyCard.isActive")||this.isNextUpActive;this._runSlideOutAnimation(e),this.subFeedVideoView.slideOut(t,i),this.isDetached=!1}}_runSlideOutAnimation(e){var t=this.model.get("animation.slideOut"),i=this.model.get("stickyCard.isActive");this.animationUtil.slideOut({$el:this.$el,timeMS:t,sliderOptions:this.detachToSlider,isVerticalSlideOut:i,cb:e}),this.subFeedVideoView.runSlideOutAnimation(t,i)}_runSlideInAnimation(){}onAdComplete(){this.model.set("isReplayAd",this._isSingleAd()),this.model.get("isReplayAd")&&(this.isReplayMode=!1),this.model.get("isMultiAd")||this.model.get("isReplayAd")&&(this.log.info("Single ad completed, stays detach"),this.checkAndClose("Single ad"),this.showLoadingView()),this.globalModel.get("postRepeatMode")&&this.checkAndClose("post repeat mode"),this.isContentViewActive()&&this.model.set("aspectRatioNum",this.model.get("defaultAspectRatioNum")),this.subFeedVideoView.onAdComplete()}checkAndClose(e){return!(this.isDetached||!this.model.get("isEligibleToPlay")||!this.isAnimateOnClose||this.model.get("isPlacementSingleAd"))&&(this.log.info("Close because of: ",e),this.collapse(this.reAttached?us(this._getPlaceHolderId()):this.$el),this.model.set("isAdClosed",!0),!0)}onTimerEnd(e){this.model.set("viewTopComponent",S.z.FLOATING_VIEW_TOP_COMPONENT.repeat),this.log.info("midroll:",e),this.subFeedVideoView.setRepeatMode(!0),this.showLoadingView(),this.checkAndClose(e),this.permanentAttach(),this.subFeedVideoView.onTimerEnd()}playAd(){this.subFeedVideoView._playAd(),this.log.info("@@@ loadingTimer stop"),this._stopLocalTimers(),this.createStateHandlers([{event:"isSliderEligibleToPlay",funcName:"_onSliderEligibilityChange"}])}_onSliderEligibilityChange(){if(this.isDetached&&!this.isPermanentAttachCalled){var e=this.getActiveAd();e&&(this.model.get("isSliderEligibleToPlay")?e.play():e.pause(S.z.PAUSE_REASONS.SLIDER_LOST_ELIGIBILITY))}}_addAdChoice(){var e=this.model.get("components.adChoice");e&&e.isActive&&(e.videoAd.isActive&&(this.adChoice=new Ft({model:this.model,container:this.el,type:S.z.AD_CHOICE_TYPE.VIDEO_AD})),e.slider.isActive&&(this.isDetachActive||this.isForceDetachOnGotAd)&&(this.adChoiceSlider=new Ft({model:this.model,container:this.el,type:S.z.AD_CHOICE_TYPE.SLIDER})))}createCloseButton(){!this.closeButtonView&&(this.isDetachedHasCloseButton||this.isAttachedHasCloseButton||this.isForceDetachOnGotAd)&&(this.log.info("Creating Close Button"),!0===this.model.get("closeButton.hasCloseButton")&&(this.closeButtonView=new cs({model:this.model,container:this.el,isSkipRender:!1}),this.closeButtonView.hide()))}_onCloseButtonClick(){var e;this.isDetached?(this._permanentCloseSlider(),this.subFeedVideoView.onSliderClose(),null===(e=this.contentView)||void 0===e||e.pause()):(this.log.info("Close button click: close card"),this.checkAndClose())}_permanentCloseSlider(){this.model.set("detachToSlider.isStartFromSlider",!1),this.model.set("detachToSlider.isDetachToSlider",!1),this.globalModel.set("isSliderOn",!1),this.globalModel.set("isSliderClosed",!0),this.globalModel.set("floatingNAS.isActive",!1),this.model.set("floatingView",j.Z.floatingView.permanentClosed),this._slideOut((()=>{this._hideCloseButton(!0),this.model.get("stickyCard.isActive")&&this.attach(!0),this.subFeedVideoView.isDetached=!1}))}_showCloseButton(e){e&&void 0===this.closeButtonTimer?this.closeButtonTimer=setTimeout(this.model.set.bind(this.model,"closeButton.isShowing",!0),this.model.get("components.CloseButtonView.delay")):e||this.model.set("closeButton.isShowing",!0)}_hideCloseButton(){clearTimeout(this.closeButtonTimer),this.closeButtonTimer=void 0,this.model.set("closeButton.isShowing",!1)}_adVolumeButton(){this.model.get("components.volume.isActive")&&(this.volume=new Wi({model:this.model,container:this.el,globalModel:this.globalModel}))}onAdDisplayChange(e,t){this.log.info("@@@ onAdDisplayChange"),t?(this.model.set("viewTopComponent",S.z.FLOATING_VIEW_TOP_COMPONENT.video),this.log.info("@@@ ad started displaying"),this._stopLocalTimers(),this.nativeAdSettings&&this.nativeAdSettings.onAdDisplayChange()):(this.log.info("@@@ ad stopped displaying"),this.isContentViewActive()?(this.hideLoadingView(),this.model.set("viewTopComponent",S.z.FLOATING_VIEW_TOP_COMPONENT.content),this._stopLocalTimers()):(this.loadingTimer.start(this.model,"",null,!0),this.model.set("viewTopComponent",S.z.FLOATING_VIEW_TOP_COMPONENT.loading)))}onVideoPlaceholderPosition(){this.model.get("isAdClosed")||this.isDetached||this.attach(!0)}onVideoPlaceholderSizeChange(e,t){this.isDetached||this.currentAnimation!==S.z.ANIMATION_TYPE.none||this.model.get("videoViewState")!==j.Z.videoViewState.attached||(this._setSliderSize(),this._resize(this.model.get("videoPlaceholderSize")))}onAspectRatioChange(e,t){if(this.isDetached){if(this._isSliderNotAllow())return void this._reAttach();if(this._setSliderSize(),this.isContentViewActive())return;this.detach(!0,!0)}}_addDisclosureText(){(this.model.get("components.disclosureText.isActive")||this.model.get("detachToSlider.components.disclosureText.isActive"))&&(this.disclosureTextView=new ii({model:this.model,container:this.el}),this.disclosureTextView.render())}createLoadingView(){this.log.info("@@@ createLoadingView"),this.loadingView=new Ei({model:this.model,container:this.el,globalModel:this.globalModel,isReplayable:this.model.get("isReplayable")})}showLoadingView(){this.loadingView&&!this.loadingTimer.isTimerActive()&&(this.log.info("@@@ showLoadingView"),this.loadingView.showRepeat(this.isDetached&&!this.globalModel.get("hadStickyDetach")),this.model.set("viewTopComponent",S.z.FLOATING_VIEW_TOP_COMPONENT.loading))}hideLoadingView(){this.loadingView&&this.loadingView.hide()}onLocalTimerEnd(e){this.log.info("SubUnit onLocalTimerEnd card number: ",this.model.get("cardNumber")),this.subFeedVideoView.setRepeatMode(!0);var t=!1;(this.globalModel.get("isSliderOn")||this.hadForcedDetach)&&(this.permanentAttach(),t=!0),this.checkAndClose("LocalTimerEnd: "+e)||t||this.showLoadingView()}closeAndRemove(){this.terminate()}terminate(){this.log.info("terminate"),this.hideLoadingView(),this._hideCloseButton(),this.permanentAttach(),this.subFeedVideoView.terminate(),this.$el.hide(),this.$el.remove()}permanentClose(){this.subFeedVideoView.permanentClose()}getActiveAd(){return this.subFeedVideoView?this.subFeedVideoView.getActiveAd():{}}getEl(){return this.subFeedVideoView.getEl()}getModel(){return this.subFeedVideoView.getModel()}extractAd(e){this.model.set("isCardBelongToTempAd",!0),this.model.set("tempAdCondition",e),this.showLoadingView(),this.subFeedVideoView.extractAd()}injectAd(e,t){this.model.set("isCardBelongToTempAd",!0),this.model.set("tempActiveAdCondition",t),this.hideLoadingView(),this.subFeedVideoView.injectAd(e),this.attach(!0)}onTempAdEnd(){this.log.info("@!! onTempAdEnd subUnitId: ",this.subUnitId),this.log.info("@!! onTempAdEnd isCardBelongToTempAd: ",this.model.get("isCardBelongToTempAd")),this.model.get("isCardBelongToTempAd")&&(this.model.set("isCardBelongToTempAd",!1),this.model.set("tempAdCondition",!1),this.onLocalTimerEnd("Temp Card Close"))}isContentViewActive(){return!!this.model.get("components.contentVideo.isActive")&&(!(!this._isSuperSlder()&&!this._wasSliderCutOff())&&!this.model.get("isPlacementSingleAd"))}_isSuperSlder(){return this.model.get("detachToSlider.isStartFromSlider")&&this.model.get("detachToSlider.isDetachToSlider")}_wasSliderCutOff(){var e=this.getActiveAd();return ms.isSliderCutOffEnabled(this.model,e)&&this.subFeedVideoView&&this.subFeedVideoView.sliderWasCutOff}_addContentView(){this.isContentViewActive()&&(this.contentView=new qi({model:this.globalModel,unitType:this.model.get("unitType"),container:this.el}))}terminateContent(){this.isContentViewActive()||this.contentView&&this.contentView.terminate()}_stopLocalTimers(){this.loadingTimer.stop(this.model,"",null,!0),this.contentTimer.stop(this.model,"",null,!0)}_onWindowScroll(){if(this.isDetached&&this.model.get("stickyCard.isActive")){var e=us(this.model.get("videoContainerSelector"));if(e.offset()){var t=e.offset().top,i=t+e.height(),s=this.$el.offset().top,o=s<t;(i<s+this.$el.offset().height&&!this.model.get("detachToSlider.forceDetach.isActive")||o)&&(this.log.info("Unstick Sticky Ad"),this.permanentAttach())}}}onWindowResize(){this.model.get("stickyCard.isActive")&&this.isDetached&&this.currentAnimation===S.z.ANIMATION_TYPE.none&&(this._setSliderSize(),this.detach(!0,!0))}_correctAMPOffset(){if(this.model.get("stickyCard.isActive")&&this.isDetached&&this.currentAnimation===S.z.ANIMATION_TYPE.none){var e=this.model.get("containerViewPlaceHolder").getBoundingClientRect();if(this.containerViewPlaceHolderPosition=e.top+e.height,this.globalModel.get("ampPageTopLimit")-this.containerViewPlaceHolderPosition<0)return void this.attach();this.detach(!0,!0)}}_correctSliderAMPOffset(){this.model.set("ampPageBottomLimit",this.globalModel.get("ampPageBottomLimit")),this.model.set("ampPageTopLimit",this.globalModel.get("ampPageTopLimit")),this.isDetached&&this.currentAnimation===S.z.ANIMATION_TYPE.none&&(this.currentAnimation=S.z.ANIMATION_TYPE.detaching,this.animationUtil.correctSliderDetachPosition({$el:this.$el,sliderOptions:this.detachToSlider,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this)}),this.subFeedVideoView.correctSliderAMPOffset(this.detachToSlider))}_isActiveAdCanStick(){return!this.globalModel.get("stickyCard.restrictions.adTypeNotAllowed")&&!this.globalModel.get("stickyCard.restrictions.sessionNotAllowed")&&(("any"===this.model.get("stickyCard.restrictions.rv")||this.model.get("activeAdRV")===this.model.get("stickyCard.restrictions.rv"))&&this._getQueryFuncResult())}_getQueryFuncResult(){var e=this.globalModel.get("stickyCard.restrictions.isActive.decisionFunction"),t=this.subFeedVideoView.getActiveAd(),i=t&&t.vpaidWrapper&&t.vpaidWrapper.tag;if(e){if(!i)return this.log.warning("no activeAdData - can't evaluate QueryFuncResult"),!1;var s=e(this.model.attributes,i);return this.log.info("query language function results for sticky.isActive",{activeAd:i,function:e,result:s}),s}return!0}_onContentViewPlay(e,t){t?this.adChoiceSlider._hide():this.adChoiceSlider._show()}_onBlockedByExternalUnit(){this.model.get("floatingView")===j.Z.floatingView.detach&&(this.model.get("blockedByExternalUnit")?this._runSlideOutAnimation((()=>{})):(this.isFirstDetach=!0,this.isDetached=!0,this.detach(!0,!1)))}_isSingleAd(){var e=this.getActiveAd();if(e)return e.vpaidData.singleAd}_setStickyDisabled(e){this.currAdDetach=!1,e.adData.su=S.z.SUB_UNIT_TYPE.PLAIN,e.oppsService.stickyDisabled()}_setIsAdCanDetach(){var e=this.subFeedVideoView.getActiveAd();this.model.get("stickyCard.isActive")&&(e&&e.vpaidData&&e.vpaidData.adjacency||!this._getQueryFuncResult())&&this._setStickyDisabled(e)}_hide(){this.model.get("components.contentVideo.isActive")||this.$el.hide()}_show(){this.$el.show()}_onAdActive(){this._setIsAdCanDetach()}_handlePostRepeatMode(){this.subFeedVideoView.getReadyAd()}}const _s=bs;var Ss=o(84),ys=o(316),As=o(999);const Ts=class extends is{constructor(e,t,i,s){super(e,i),this.globalModel=i,this.globalModel.get("isEligibleToPlay")&&this.model.set("isEligibleToPlay",!0),this.model.set("isInTab",this.globalModel.get("isInTab")),this.log=new y.Z({unitType:"Service",className:"SubFeedEligibility",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.placeHolders=[Ss(t)[0]],this.isEligibile=null,this.isEligibileOldVal=null,this.bindEvent(),this.model.get("isUseObserver")?(this._initObserver(),this.observer.observe(this.placeHolders[0]),this.model.get("frameType")===S.z.FRAME_TYPE.amp&&this.setAMPObservers()):this._initEligibilityListener()}bindEvent(){this.globalModel.listenTo(this.globalModel,"change:isInTab",this._onTabEvent.bind(this)),this.createStateHandlers([{event:"getAdState",funcName:"_calculateEligibility"}])}_initEligibilityListener(){"rendered"===this.model.get("containerViewState")?this._calculateEligibility():this.createStateHandlers([{event:"containerViewState:rendered",funcName:"_calculateEligibility"}]),ys.on("window:scroll:change",this._calculateEligibility.bind(this))}_onTabEvent(e,t){this.model.set("isInTab",t),t?this._calculateEligibility():this.model.set("isEligibleToPlay",!1)}_getInViewDiv(){for(var e=0;e<this.placeHolders.length;e++){var t=this.placeHolders[e],i=this._getDimensions(t),s=As.getViewPercent(t,i.width,i.height,this.model.get("scrollSelector"),this.model.get("useClientRectForViewPercentCalc"));this._printCurrentViewPercent("currViewPercent",s);var o=this.model.get("viewPercent")||100;if(this.model.set("isViewable",this.model.get("viewabilityPercent")<=s),this.model.set("isViewable100",s>=this.model.get("100viewPercent")),this.model.get("stickyCard.isActive")){var n=s<this.model.get("stickyCard.attachPercent")&&this._canStickToTop(t);this.model.set("isEligibleToStick",n)}if(o<=s)return this.placeHolders[e]}}_testEligibility(){this.inViewDiv?(this.isEligibile=!0,this.model.set("isEligibleToPlay",!0),!this.model.get("eligiblePlaceholder")&&As.isModel("getAdState",j.Z.getAdState.gotAd,this)&&this.model.set("eligiblePlaceholder",this.inViewDiv),this._switchObserverToScroll()):(this.isEligibile=!1,this.model.set("isEligibleToPlay",!1)),this.isEligibileOldVal!==this.isEligibile&&(this.log.info("Sub unit eligiblity="+this.isEligibile,"subUnitId="+this.model.get("subUnitId")),this.isEligibileOldVal=this.isEligibile)}resetPlaceHolders(){this.placeHolders=[]}setAMPObservers(){var e=this.model.get("cardNumber"),t=Ss('[data-card-index="'.concat(e+.5,'"]')).get(0);this.AMPBelowObserver=new IntersectionObserver(this.AMPElemBelowCallback.bind(this),{rootMargin:"0px",threshold:[0]}),this.log.info("AMP IntersectionObserver was created"),this.AMPBelowObserver.observe(t)}AMPElemBelowCallback(e){this.model.set("AMPElemBelowVisible",e[0].intersectionRatio>0)}_switchObserverToScroll(){this.observer&&(this._stopObserver(),this.observer=void 0,this._setToModel("isUseObserver",!1),ys.on("window:scroll:change",this._calculateEligibility.bind(this)))}};var ws=o(999),Cs=o(316);const Ps=class{constructor(e,t){this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:"MutationObserverService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.options=t,this.setObserver()}setObserver(){var e=ws.throttle((this.options.callback||this._observerCallback).bind(this),100);this.config={attributes:!0,childList:!0,characterData:!0,subtree:!0,attributeOldValue:!0},this.observer=new MutationObserver(e)}observe(e){e&&this.observer.observe(e,this.config)}_observerCallback(e){this._trigger("publisher:dom:change",{})}_trigger(e,t){Cs.trigger(e,t)}};var Es=o(84);const Is=class extends Nt{constructor(e){super(e),this.globalModel=e.globalModel,this.model=e.model,this.container=e.container,this.parentSelector=this.model.get("parentSelector"),this.model.set("renderWasCalled",!1),this.ad=e.ad,this.closeButtonDelayd=!1,this.createStateHandlers([{event:"playerState:ready",funcName:"_onPlayerStateReady"},{event:"playerState:restarted",funcName:"_onPlayerStateReady"},{event:"isEligibleToPlay:true",funcName:"_onFirstEligibility",listenOnce:!0}]),this.globalModel.on("change:blockedByExternalUnit",this._setBlockedByExternalUnit.bind(this)),this.ad.setSubModel(this.model),this.model.get("isSuperSlider")&&this.createStateHandlers([{event:"isSuperSliderClosed",funcName:"_SuperSliderClose",listenOnce:!0}]),this.isVVDetachable=this.model.get("detachToSlider.isStartFromSlider")||this.model.get("detachToSlider.isDetachToSlider"),this.model.set("videoViewContainer",this.ad.vpaidWrapper.adTarget),this.containerView=new Gt({model:this.model,globalModel:this.globalModel,ad:e.ad}),this.render(e.container),this.SubFeedEligibilityService=new Ts(this.model,this.containerView.getVideoPlaceholder(),this.globalModel,this.ad&&this.ad.vpaidData?this.ad.vpaidData.rv:void 0),this.globalModel.get("components.nativeAd.isActive")&&(this.nativeAdView=new ei({model:this.model,globalModel:this.globalModel,container:this.container,sendNasOpp:!0})),this._createVideoView();var t=this.model.get("observedContainerSelector");t&&this._setMutationObserver(t)}_setMutationObserver(e){var t=Es(e)[0];t&&(this.mutationObserverService=new Ps(this.model,{}),this.mutationObserverService.observe(t))}_createVideoView(){this.model.get("isUseFloatingView")?this.videoView=new _s({model:this.model,adjs:this.ad,globalModel:this.globalModel,nas:this.nativeAdView,eligibilityService:this.SubFeedEligibilityService}):this.videoView=new Qi({model:this.model,eligibilityService:this.SubFeedEligibilityService},this.ad,this.globalModel)}render(e){this.model.get("renderWasCalled")||(this.containerView.render(e,this.ad.adId),this.log.info("render was called with container: "+e,"subUnitId="+this.model.get("subUnitId")),setTimeout(function(){this.model.set("renderWasCalled",!0)}.bind(this),100))}terminate(e,t){this._setTimerReason(t),e&&this.isVVDetachable?(this.videoView.permanentAttach(),this.videoView.checkAndClose()):this.model.set("closeState",j.Z.closeState.terminate)}terminateOnContainerChange(){this.SubFeedEligibilityService.resetPlaceHolders(),this.isTerminatedByFeedX=!0,this.containerView.closeAndRemove(),this.videoView.closeAndRemove()}overKill(e){this.model.set("closeState",j.Z.closeState.terminate),this.videoView.permanentClose(),this.containerView._runAnimation(!1),this.model.off()}pause(e){this.log.info("pause: ",e),this._setTimerReason(e),this.isTerminatedByFeedX||this.videoView.onTimerEnd(e)}_createTimers(){}_onFirstEligibility(){this.model.set("gotFirstEligibility",!0)}_SuperSliderClose(){this.overKill("Close SuperSlider")}_setBlockedByExternalUnit(){this.model.set("blockedByExternalUnit",this.globalModel.get("blockedByExternalUnit"))}};var Os=o(84),Vs=o(999),Ns=o(316),Ds="tbl-data-mutation-observer";class Rs{constructor(e,t){this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:this.constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.feedSelector=this.model.get("parentSelector"),this.isObserveFeedParent=this.model.get("isObserveFeedParent"),this._bindEvents(),this._initMutationObserver(t)}_bindEvents(){"undefined"!=typeof TRC&&TRC.listen&&(TRC.listen("trcResponseHandled",this._updateMutationObserver.bind(this)),TRC.listen("feed-x-toggle",this._onFeedXToggle.bind(this)),TRC.listen("feedContainerChanged",this._onFeedContainerChanged.bind(this)))}_initMutationObserver(e){var t=Os(e||this.feedSelector);this._setObservers(t);var i=this.model.get("mutationSelectorsArray");if(i){var s=Os(i.toString());Vs.forEach(s,this._setMutationObserver,this)}}_setObservers(e){this.isObserveFeedParent?Vs.forEach(this._getParents(e),this._setMutationObserver,this):Vs.forEach(e,this._setMutationObserver,this)}_getParents(e){for(var t=[],i=0;i<e.length;i++){var s=e[i];s.parentElement&&t.push(s.parentElement)}return t}_setMutationObserver(e){if(e&&!e.getAttribute(Ds)){var t=Vs.throttle(this._trigger.bind(this,"feed:resize:change",{}),100),i=new MutationObserver(t);e.setAttribute(Ds,!0),i.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0,attributeOldValue:!0})}}_updateMutationObserver(){var e=Os(this.feedSelector);if(e){var t=e.not("[".concat(Ds,"]"));this._setObservers(t)}}_updateFeedSelector(){this.feedSelector=this.model.get("parentSelector"),this._updateMutationObserver()}_onFeedXToggle(e){this._onFeedContainerChanged({eventName:"feedxToggle",containerSelector:e.data})}_onFeedContainerChanged(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.eventName,i=this["".concat(t,"ContainerChanged")];Vs.isFunction(i)&&i.bind(this)(),this.log.info("feed container changed",t),e.containerSelector||this.log.error("no valid explore-more selector"),this.model.set("parentSelector",e.containerSelector),this._updatePlacement(e.placement),this._updateFeedSelector(e.containerSelector),this.model.increaseCounter(t),this.model.increaseCounter("feedContainerChanged")}exploreMoreContainerChanged(){this.model.get("disableExploreMoreVideo")&&this.model.set("resetFeedVideo",!0)}_updatePlacement(e){e&&(this.model.set("placement",e),this.model.set("modifiedPlacement",e))}_trigger(e,t){Ns.trigger(e,t)}}var Ms=function(){var e;return function(t,i){return e||(e=new Rs(t,i)),e}}();const xs=Ms;var Fs=o(999),Ls=o(316);class Bs extends E.O{constructor(e){super(e),this.model=e,this.log=new y.Z({unitType:"FEED_MANAGER",className:"ContinuePlayAdInNextCard",version:this.model.get("version"),isDebug:this.model.get("isDebug")})}_startWatchDivLeaveVeiwPort(e){this.trakingElement=e,this._watchScroll()}_testElementInViewPort(){var e=Fs.getViewPercent(this.trakingElement,this.model.get("width"),Fs.getVideoHeight(this.model.get("width")),this.model.get("scrollSelector"));this.log.info("ContinuePlayAdInNextCard",this.trakingElement.getBoundingClientRect()),this.log.info("ContinuePlayAdInNextCard",e),0===e?(Ls.off("window:scroll:change",this._testElementInViewPort,this),this.model.set("elementOutOfView",!0)):this._watchScroll()}_watchScroll(){Ls.once("window:scroll:change",this._testElementInViewPort.bind(this),this)}}const ks=Bs;var Us=o(999),zs=o(316);class Hs extends E.O{constructor(e){super(e.model),this.model=e.model,this.log=new y.Z({unitType:this.model.get("unitType"),className:"PlayPriorityHandler",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.isRvPriority=this.model.get("isRvPriority")&&this._isAllowedInFT(),this.isHadFirstSetAd=!1,this.detachToSlider=this.model.get("detachToSlider"),this.isStickyCardActive=this.model.get("stickyCard.isActive"),this.isDetachActive=this.detachToSlider&&(this.detachToSlider.isStartFromSlider||this.detachToSlider.isDetachToSlider),this.isForceDetachOnGotAd=(this.isDetachActive||this.isStickyCardActive)&&this.model.get("detachToSlider.forceDetach.isActive"),this._bindEvents()}_isAllowedInFT(){return!!this.model.get("playPriority.isAllowInIframes")||this.model.get("frameType")===S.z.FRAME_TYPE.plainPage}_bindEvents(){}setNextAd(e){this.lastAd=e,this._isForceAdToDetach(e)?this._setReadyAd(e):this.isRvPriority&&!this.isHadFirstSetAd?this._handleRvPriority(e):this._setReadyAd(e)}_isForceAdToDetach(e){if(!this.isForceDetachOnGotAd||this.model.get("hadStickyDetach"))return!1;var t=this.model.get("detachToSlider.forceDetach.restrictions.rv"),i="any"===t||t===e.adData.requiredViewability;return this.log.info("force ad detach:",{isForced:i,activeAdRV:e.adData.requiredViewability}),i}_setReadyAd(e){e.onAdSetToUnits(),this.lastSetAdId=e.adId;var t=e.adData.requiredViewability,i=!e.adData.alwsldr;this.model.setNextAd(e),setTimeout(function(){this.model.set("isNextAdRV",t),this.model.set("isNextAdNotAllowSlider",i),this.model.set("hasReadyAd",!0)}.bind(this),0)}_handleRvPriority(e){var t=!1;if(e.adData.requiredViewability)t=!0;else{var i=this._isAtDecisionPoint();t=this._shouldSetReadyAd(i)}t&&(this._setReadyAd(e),e._bringToFront(),this.isHadFirstSetAd=!0)}_shouldSetReadyAd(e){if(!e)return!1;return this.model.get("playPriority.isAlwaysWaitForRv")?!this.model.get("playerHasRvInQ"):!this.model.get("playerHasRvInQ")||this.model.get("isSkippedDistancePredict")||this._isLoaderInRequiredPercentage()}_isAtDecisionPoint(){if(!this.model.get("playPriority.checkForRvPriority"))return!1;var e=this.model.get("playPriority.checkForRvPriority");return this[S.z.CHECK_FOR_RV_PRIORITY[e]].bind(this)()}_reCheckAd(e){this.isHadFirstSetAd||(this.hasListener=!1,this.setNextAd(this.lastAd))}hasReachedEligibility(){return!(!this.model.get("isEligibleToPlay")&&!this.model.get("hadEligibility"))||(this.hasListener?void 0:(this._waitForEligibility(),this.hasListener=!0,!1))}_waitForEligibility(){this.createStateHandlers([{event:"isEligibleToPlay:true",funcName:"_reCheckAd",isListenOnce:!0}])}hasReachedPixelsFromSelector(){if(void 0===this.model.get("playPriority.pixelsFromSelector"))return!1;var e=Us.hasPassedPixelFromSelector(this.model.get("parentSelector"),this.model.get("scrollSelector"),this.model.get("playPriority.pixelsFromSelector"),this.model.get("isNeedValidateParentSelector"));return e||this.hasListener||(this.hasListener=!0,zs.once("window:scroll:change",this._reCheckAd.bind(this))),e}intersectionPercent(){if(void 0===this.model.get("playPriority.intersectionPercent"))return!1}_activeSecondsToGetRVTime(){}_secondsAfterGetAdRv(){}beforeLoaderEnd(){return!!this._isLoaderInRequiredPercentage()||(this.createStateHandlers([{event:"loaderCurrCount",funcName:"_reCheckAd",isListenOnce:!0}]),!1)}_isLoaderInRequiredPercentage(){return this.model.get("loaderCurrCount")>=this.model.get("playPriority.loaderPercent")}}const Ws=Hs;var js=o(249),$s=o(999),Zs=o(316);function Gs(e,t,i,s,o,n,r){try{var a=e[n](r),d=a.value}catch(e){return void i(e)}a.done?t(d):Promise.resolve(d).then(s,o)}class qs extends E.O{constructor(e,t){super(e),this.model=e,this.eligibilityService=t,this.log=new y.Z({unitType:this.model.get("unitType"),className:"adsManager",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.model.set("adState",j.Z.readyState),this.model.set("getAdState",j.Z.getAdState.notCalled),this.model.set("adManagerState",j.Z.adManagerState.empty,{silent:!0}),this._createAdsList(),this.model.set("nextPredict",NaN),this.adId=0,this.currentAdIndex=-1,this.model.set("activeTag",!1),this.model.set("activeAd",!1),this.model.set("impressionCount",0),this.playPriorityHandler=new Ws({model:this.model}),this._bindEvents(),$s.sendingEventToTaboolaBridge("sessionStart",this.model.get("unitName")),this.model.get("isCancelGetAdOnEligibilityLost.isActive")&&(this.cancelGetAdOnEligibilityLostForRVAny=this.model.get("isCancelGetAdOnEligibilityLost.includeRVAny"),this._trackEligibilityLost())}_createAdsList(){for(var e in this.adsList={},S.z.RV_TYPES)this.adsList[S.z.RV_TYPES[e]]=[]}_bindEvents(){this.createStateHandlers([{event:"getAdState:failed",funcName:"_onFailedToGetAd"},{event:"hasReadyAd:false",funcName:"_updateNextAd"},{event:"cancelRV:true",funcName:"_cancelAllRVCalls"},{event:"adState:playing",funcName:"_onFirstAdPlay",isListenOnce:!0},{event:"exploreMore",funcName:"_onExploreMore"}])}adPredict(e,t){var i=this.model.get("adxDurationDebtPay");if(this._countReadyAdsByRV(!1,S.z.RV_TYPES.NON_RV)==this.model.get("maxNonRvVimpsInQueue")&&this.model.set("onMaxNonRvVimpsInQueue",!0),!(this._countReadyAdsByRV(!1,S.z.RV_TYPES.RV)>=this.model.get("maxVimpsInQueue")&&this._countReadyAdsByRV(!1,S.z.RV_TYPES.NON_RV)>=this.model.get("maxNonRvVimpsInQueue"))){var s=this.model.get("nextPredict");s!==S.z.RV_TYPES.RV||!this.model.get("isGettingRv1Ad")||this.model.get("immediateStartAdInPrediction")?i&&!this.model.get("isRV1InQueue")||(this.firstGetAdFired||(this.log.info("First Get Ad Fired"),this.model.set("firstGetAdFired",!0),this.firstGetAdFired=!0),this._checkIfAlreadyHas1InList(),$s.isArray(s)?$s.forEach(s,(i=>{(!this.alreadyHas1InList||this.alreadyHas1InList&&0===i||this.alreadyHas1InList&&this.hasRV1AdxInQueue)&&(this.createNewAd(i,e,t),this._checkIfAlreadyHas1InList())}),this):(!this.alreadyHas1InList||this.alreadyHas1InList&&0===s||this.alreadyHas1InList&&this.hasRV1AdxInQueue)&&this.createNewAd(s,e,t),"mp4Predict"===this.model.get("nextPredictName")?this.model.set("mp4Predict",!0):this.model.set("mp4Predict",!1)):this.log.warning("Already getting rv1 ad, ignoring")}}_isAdListContainsDuplicateKeys(e){return this.adsList[e].some((t=>(t.adQState===j.Z.adQState.readyState||t.adQState===j.Z.adQState.impression)&&t.getAdKey===e))}createNewAd(e,t,i){var s,n=this;return(s=function*(){if(n.model.get("isAllowDuplicateKey")||!n._isAdListContainsDuplicateKeys(e)){var s=n.model.get("nextPredictName");n.model.set("adId",n.adId);var{AdService:r}=yield o.e(942).then(o.bind(o,298)),a=new r({model:n.model,ppKey:e,adId:n.adId,impressionCb:n.onAdImpression.bind(n),completeCb:n.onAdComplete.bind(n),predictName:s,getAdProperties:i,predictId:t});n.adsList[e].push(a),n.adId++}},function(){var e=this,t=arguments;return new Promise((function(i,o){var n=s.apply(e,t);function r(e){Gs(n,i,o,r,a,"next",e)}function a(e){Gs(n,i,o,r,a,"throw",e)}r(void 0)}))})()}_checkIfAlreadyHas1InList(){this.alreadyHas1InList=!1,this.hasRV1AdxInQueue=!1,$s.forEach(this.adsList[S.z.RV_TYPES.RV],(e=>{if("multiAdPredict"!==this.model.get("nextPredictName"))return this.alreadyHas1InList=!0,this.hasRV1AdxInQueue=e.predictId===S.z.PREDICT_NAMES.adxPredict,!1}),this)}onAdImpression(e){e.setActiveTag(),this._updateNextAd(),this.model.set("adManagerState",j.Z.adManagerState.hasAds),this.model.get("hadReady")||this.model.get("isEligibilityNomination")||this.model.get("isRvPriority")||(this.eligibilityService?(this.eligibilityService._calculateEligibility(),this.model.get("isEligibleToPlay")?this._triggerReady():this.createStateHandlers([{event:"isEligibleToPlay:true",funcName:"_triggerReady",isListenOnce:!0}])):this._triggerReady(),this.model.set("hadReady",!0));var t=e.getAdData();if(this._isRV1withRV0InStack=function(){return t.requiredViewability&&this.adsList[S.z.RV_TYPES.NON_RV].length>0},"any"===e.getAdKey&&this._moveAdFromAnyQueue(e,t.requiredViewability),e.rv=t.requiredViewability,e.itemType=t.itemType,this.model.increaseCounter(t.requiredViewability?"adsList.rvAds":"adsList.nonRvAds"),!this.model.get("isEligibleToPlay")&&this.model.get("lostEligibilityTime")&&e.fireSkipVimp1EligibilityLost(t.requiredViewability),t.requiredViewability&&!this._isSwapEnabled()){var i=this.getPlayingAdRVType();void 0!==i&&e.fireSkipVimp1AdIsPlaying(i)}this._isRV1withRV0InStack()&&e.onAdPlayingRV1StackWithRV0()}_isSwapEnabled(){return this.model.get("isForceSwapToRV")}_triggerReady(){Zs.trigger("ready")}_moveAdFromAnyQueue(e,t){$s.each(this.adsList[S.z.RV_TYPES.ANY],((t,i)=>{t.adId===e.adId&&this.adsList[S.z.RV_TYPES.ANY].splice(i,1)})),this.adsList[t?S.z.RV_TYPES.RV:S.z.RV_TYPES.NON_RV].push(e)}getPlayingAdRVType(){return this.adsList[S.z.RV_TYPES.NON_RV].some((e=>e.adState===j.Z.adState.playing))?S.z.RV_TYPES.NON_RV:this.adsList[S.z.RV_TYPES.RV].some((e=>e.adState===j.Z.adState.playing))?S.z.RV_TYPES.RV:void 0}onAdComplete(e,t){if(this._removeAd(e.adId,e.adData&&void 0!==e.adData.requiredViewability?e.adData.requiredViewability:e.getAdKey,!1),this.model.get("hasReadyAd")){var i=this.model.getStorage("nextAd");(null==i?void 0:i.adId)===e.adId&&this.model.set("hasReadyAd",!1)}t&&!this.model.get("hasReadyAd")&&(this.model.set("lastAutoKilledPredict",e.getAdKey),this.model.set("adState",e.adState))}close(){this.model.set("adManagerState",j.Z.adManagerState.stopped),this.model.set("closeState",j.Z.closeState.adManagerStop)}pauseGetAds(){for(var e in this.model.set("adManagerState",j.Z.adManagerState.paused),this.adsList)this.adsList[e]=[];this.model.set("hasReadyAd",!1)}_cancelAllRVCalls(){$s.forEach(this.adsList[S.z.RV_TYPES.RV],function(e){e.cancelGetAd(),this._removeAd(e.adId,S.z.RV_TYPES.RV,!0)}.bind(this)),this.model.set("cancelRV",!1)}_removeAdsByKeyAndStatus(e,t){$s.forEach(this.adsList[e],function(i){t.indexOf(i.getAdState)>-1&&(i.cancelGetAd(),this._removeAd(i.adId,e,!0))}.bind(this))}_onFailedToGetAd(){var e,t=this.model.get("getAdCurrId");for(var i in this.adsList)e||(e=$s.find(this.adsList[i],(function(e){return e.adId===t}),this));this.model.set("lastFailedPredictProperties",e.getAdProperties),this.model.set("lastFailedPredict",e.getAdKey),this._removeAd(t,e.adData&&void 0!==e.adData.requiredViewability?e.adData.requiredViewability:e.getAdKey,!0)}_removeAd(e,t,i){var s=this,o=t?S.z.RV_TYPES.RV:S.z.RV_TYPES.NON_RV;$s.size(this.adsList[o])>0&&(this.adsList[o]=this.adsList[o].filter((function(t){return t.adId===e&&s.model.decreaseCounter(t.rv?"adsList.rvAds":"adsList.nonRvAds"),t.adId!==e}))),0===this.countReadyAds(i)&&this.model.set("adManagerState",j.Z.adManagerState.empty)}_filterAds(){var e=[];for(var t in this.adsList)e=e.concat(this.adsList[t].filter((e=>e.adQState===j.Z.adQState.impression&&!e.isUsed&&(this.getPlayingAdRVType()===S.z.RV_TYPES.NON_RV||this._isAllowAd(e)))));return e}_updateNextAd(){var e=this,t=this._filterAds(),i=this._chooseBestAd(t),s=t[i];s&&(this.playPriorityHandler.setNextAd(s),s.getAdKey&&s.getAdKey===S.z.RV_TYPES.RV&&this._countReadyAdsByRV(!0,S.z.RV_TYPES.RV)>1&&s.oppsService.onAdPlayingNextAdReadyRV1());var o=s;if(this.model.get("hasReadyAd")){var n=this.model.get("playPriority.type"),r=function(t){$s.each(e.adsList[t],function(e,s){i===s&&t==o.getAdKey||e.adQState===j.Z.adQState.impression&&o&&o.getAdData&&("rpox"===n?e.reportRpoxSkip(o.getAdData()):"ppKey"===n&&e.reportPpKeySkip(o.getAdData()))}.bind(e))};for(var a in this.adsList)r(a)}}_chooseBestAd(e){var t=0;if(1===$s.size(e))return t;var i=this.model.get("playPriority.type")||"rpox";if("ppKey"===i)$s.find(e,((e,i)=>{e.getAdKey===this.model.get("playPriority.key")&&(t=i)}));else if("function"===i){var s=this.model.get("playPriority.func");t=s(e)}else"rpox"===i&&(t=this.priorityByRpox(e));return t}priorityByRpox(e){var t=0,{model:i}=this,s=0;return $s.each(e,((e,i)=>{e.rpox>=s&&(s=e.rpox,t=i)})),t}_hasPlayingAd(){return!!this.model.get("activeTag")}countReadyAds(e){var t=0;for(var i in this.adsList)t+=this._countReadyAdsByRV(e,i);return t}_countReadyAdsByRV(e,t){var i=0;return $s.forEach(this.adsList[t],(function(t){(e&&t.adQState!==j.Z.adQState.readyState||t.adQState===j.Z.adQState.impression)&&i++}),this),i}_onFirstAdPlay(){this.model.set("hadPlayedAd",!0)}_isAllowAd(e){return this._isAllowSingleAd(e)}_isAllowSingleAd(e){if(this.model.get("postRepeatMode"))return!0;var t=e.adTypeConfig&&e.adTypeConfig.singleAd&&e.adTypeConfig.singleAd.isPlacementSingleAd;return!(t&&this.model.get("hadPlayedAd")||this.model.get("isPreventNextAd"))&&(!t||!this._isAdTypeDropped(js.B.singleAd.name))}_isAdTypeDropped(e){var t=this.model.get("droppedAdTypes");return!!$s.isArray(t)&&0!==(t=t.filter((t=>e===t))).length}_getLastActiveAd(){for(var e in this.adsList){var t=this.adsList[e].filter((e=>e.adId===this.model.get("lastActiveAd")));if(t&&t[0])return t}return[]}_onExploreMore(){this.model.get("exploreMoreConfig.clearAdsQ")&&this._removeAdsByKeyAndStatus(S.z.RV_TYPES.NON_RV,["gotAd","waiting","failed","stopped","finished"]);var e=this.model.get("exploreMoreConfig.maxNonRvVimpsInQueue");e&&this.model.set("maxNonRvVimpsInQueue",e)}_trackEligibilityLost(){this.createStateHandlers([{event:"isEligibleToPlay:false",funcName:"_cancelGetAdOnLostEligibility"}])}_cancelGetAdOnLostEligibility(){this._cancelGetAdOnLostEligibilityByRVType(S.z.RV_TYPES.RV),this.cancelGetAdOnEligibilityLostForRVAny&&this._cancelGetAdOnLostEligibilityByRVType(S.z.RV_TYPES.ANY)}_cancelGetAdOnLostEligibilityByRVType(e){this.adsList[e].map((e=>{e.getAdState===j.Z.getAdState.gettingAd&&(e.cancelGetAd(S.z.CANCEL_GET_AD_REASONS.LOST_ELIGIBILITY),this.model.fireCancelGetAdOnEligibilityLost())}))}}const Ys=qs;var Ks=o(316),Qs=o(84),Xs=o(999);class Js extends E.O{constructor(e){super(e),this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:"pixelsService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.hadEligibility=!1,this.hadImpression=!1,this.playerHadRvInQ=!1,this.shouldFirePauseAfterPlay=!1,this.adsList={},this._bindEvents(),this.model.set("hadEligibility",!1)}_bindEvents(){this.createStateHandlers([{event:"adQState:impression",funcName:"_onAdImpression"},{event:"adState:playing",funcName:"_onAdPlaying"},{event:"adState:completed",funcName:"_onAdCompleted"},{event:"loadingViewState:clicked",funcName:"_onRepeatClicked"},{event:"isEligibleToPlay",funcName:"_onEligibilityChange"},{event:"closeTimer",funcName:"_fireTimerPixel"},{event:"isTerminateOnResize:true",funcName:"_onTerminateOnResize"},{event:"noAdjacInFirstWFs:true",funcName:"_onNonAdjacInFirstWFs"},{event:"readMoreClicked:true",funcName:"_onReadMoreClick",isListenOnce:!0},{event:"TRCDispatchFailed:true",funcName:"_onTRCDispatchFailed",isListenOnce:!0},{event:"organicVideoPlaying",funcName:"_reportOrganicVideoId"},{event:"onMaxNonRvVimpsInQueue",funcName:"_reportOnMaxNonRvVimpsInQueue",isListenOnce:!0}]),Ks.once("global:passback",this._onPassbackFunctionCalled.bind(this))}_onAdImpression(){this._firePixel(this.model.getPixel("pixels.addImpresion"),"addImpresion (the player got an ad)")}_onAdPlaying(){var e=this.model.get("activeAdData");!e||!e.adId||this.adsList[e.adId]&&this.adsList[e.adId].hadPlay||(this.adsList[e.adId]=e,this.adsList[e.adId].hadPlay=!0,this._firePixel(this.model.getPixel("pixels.conversion"),"conversion (the ad is playing)"))}_onAdCompleted(){this.isViewed=!1,this.activeTag=void 0}_onEligibilityChange(e,t,i){this.stopSendingEligibility||(t&&!this.hadEligibility?this._onEligibility():!t&&this.hadEligibility&&i&&!i.isValidation&&(this._firePixel(this.model.getPixel("pixels.lostEligibility"),"Lost first eligible"),this.model.set("lostEligibilityTime",(new Date).getTime()),this.stopSendingEligibility=!0))}_onEligibility(){this.model.set("hadEligibility",!0),this.hadEligibility=!0,this._firePixel(this.model.getPixel("pixels.eligible"),"First eligible")}_onRepeatClicked(){this._firePixel(this.model.getPixel("pixels.repeatClick"),"repeat click Pixel")}_firePixel(e,t,i){if(e&&this.model.get("isFirePixel")){e=this._setAdditionalData(e,i),this.log.pixel("firing pixel: "+t+" url: "+e);var s=document.createElement("IMG");return s.src=e,s}}_setAdditionalData(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.model.get("modifiedPlacement")&&(t.mp=this.model.get("modifiedPlacement")),this.model.get("subUnitType")&&(t.su=this.model.get("subUnitType")),this._addParametersToUrl(e,t,-1===e.indexOf("?"))}_addParametersToUrl(e,t,i){var s=e;return s+=i?"?":"&",Qs.each(t,(function(e,t){void 0!==t&&""!==t&&(s+=e+"="+t+"&")})),s}_fireTimerPixel(e,t){this.model.get("pixels.".concat(t,"Timer.isFire"))&&this._firePixel(this.model.getPixel("pixels.".concat(t,"Timer")),"".concat(t," timer"))}_onTerminateOnResize(){this._firePixel(this.model.getPixel("pixels.terminateOnResize"),"closeDueResize")}_onPassbackFunctionCalled(){(Xs.isFunction(this.model.get("onPassback"))||this.model.get("isApiPassbackExist"))&&this._firePixel(this.model.getPixel("pixels.passbackFunctionCalled"),"passback function called")}_onNonAdjacInFirstWFs(){this._firePixel(this.model.getPixel("pixels.noAdjacInFirstWFs"),"noAdjacInFirstWFs")}_onTRCDispatchFailed(){this._firePixel(this.model.getPixel("pixels.TRCDispatchFailed"),"TRCDispatchFailed")}_reportOrganicVideoId(){this._firePixel(this.model.getPixel("pixels.organicVideoPlaying"),"Playing Organic video")}_reportOnMaxNonRvVimpsInQueue(){this._firePixel(this.model.getPixel("pixels.onMaxNonRvVimpsInQueue"),"onMaxNonRvVimpsInQueue")}}const eo=Js;var to=o(999);const io=class{constructor(e){this.model=e,this._loadOvaMediaPlayer()}_loadOvaMediaPlayer(){var e="".concat(this.model.get("player.urls.playerLocation"),"/OvaMediaPlayer.js");window.OvaMediaPlayer?this._onOvaMediaPlayerLoaded():to.loadJs(e,this._onOvaMediaPlayerLoaded.bind(this),{crossOrigin:"anonymous"})}_onOvaMediaPlayerLoaded(){this.model.set("isPlayerLoaded",!0)}};var so=o(999);class oo{constructor(e){this.adsList=[],this.listeners=[],this.registerIndex=0,this.model=e}updateAdsList(e){e&&!so.isEmpty(e)?(this.adsList=e.items,this._notifyListeners(e)):(this.model.set("generalErrorData",1),this.model.increaseCounter("generalError"))}_notifyListeners(e){this.isPlayerHasRvInQ(e),this.isPlayerHasAdxInQ(e);var t=[];this.listeners.forEach((e=>{var i=this._findAdsByStatusAndType(e.type,e.typeValue,e.status,e.cb);e.isListenOnce&&i&&t.push(e.index)})),t.forEach((e=>this.unregisterToPlayerQueueStatusChange(e)))}_findAdsByStatusAndType(e,t,i,s){var o=!1,n=[];return this.adsList.forEach((s=>{(!e||this[e]&&this[e](s,t))&&(!i||S.z.AD_STATUS[i]&&s.vw&&s.vw.st===S.z.AD_STATUS[i])&&(n.push(s),o=!0)})),o&&so.isFunction(s)&&s(n),o}singleAd(e,t){return!!(t&&e.sa||!t&&!e.sa)}adjacency(e,t){return!!(t&&e.adjc||!t&&!e.adjc)}hip(e,t){return!!(t&&e.hip||!t&&!e.hip)}registerIsPlayerHasRvInQ(e){this.isPlayerHasRvInQCb=e}registerIsPlayerHasAdxInQ(e){this.isPlayerHasAdxInQCb=e}isPlayerHasRvInQ(e){this.isPlayerHasRvInQCb&&e.requiredViewabilityCount&&this.isPlayerHasRvInQCb()}isPlayerHasAdxInQ(e){this.isPlayerHasAdxInQCb&&this.isPlayerHasAdxInQCb(e.adxCount>0)}registerToPlayerQueueStatusChange(e){var{type:t,typeValue:i,status:s=S.z.AD_STATUS.new,cb:o,isListenOnce:n=!1}=e,r={type:t,typeValue:i,status:s,cb:o,isListenOnce:n,index:this.registerIndex};return this.registerIndex=this.registerIndex+1,this.listeners.push(r),r.index}unregisterToPlayerQueueStatusChange(e){this.listeners=this.listeners.filter((t=>t.index!==e))}}var no=function(){var e;return function(t){return e||(e=new oo(t)),e}}();const ro=no;var ao=o(999),lo=o(316),ho=o(84);class co extends E.O{constructor(e){var t;super(e),this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:"playerService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.oppsula=null===(t=Ne.Z.oppsula)||void 0===t?void 0:t.oppsula,this.isRestarted=!1}_init(){this._bindEvents(),this.model.get("isPlayerLoaded")&&this._onPlayerLoaded()}_bindEvents(){this.createStateHandlers([{event:"isPlayerLoaded",funcName:"_onPlayerLoaded"},{event:"getAdState:stopped",funcName:"_pausePlayer"},{event:"isInTab",funcName:"_onTabEvent"},{event:"startWF",funcName:"startWf"},{event:"canStartPlayer:true",funcName:"_onPlayerLoaded"},{event:"isReadMoreInViewport",funcName:"_onReadMoreInViewport"},{event:"publisherVideoDetected",funcName:"_onPublisherVideoDetectChange"}])}_onPlayerLoaded(){if(this.model.get("isPlayerLoaded")&&this.model.get("canStartPlayer")&&!this.player&&this._validatePlayerSize()){if(this.isMuted="on"!==this.model.get("volume"),this.volume="off"!==this.model.get("volume")?40:0,this.contentIndex=0,this.playlist=this.model.get("player.playlist"),this.playlist&&ao.isEmpty(this.playlist))return void this.model.listenToOnce(this.model,"change:player.playlist",this._onPlayerLoaded.bind(this));ao.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoPlayerInit",S.z.TRC_PERFORMANCE_ACTIONS.START);var e=this.playlist[this.contentIndex];this.model.set("isInIdleMode",!this.model.get("isInTab")&&this.model.get("isCallIDLE"));var t=this._getAdTypesToDrop();this.data={abTest:this.model.get("abTest"),ad_controls:this.model.get("player.hasAdControls"),aspect_ratio:this.model.get("aspectRatio"),auc_dast:this.model.get("cmDast"),autostart:this.model.get("autoPlay"),base_url:this.model.get("urls.base"),bf_factor:this.model.get("player.bfFactor"),bug_feature:this.model.get("player.hasBFeature"),cfr:this.model.get("cfr"),cipid:this.model.get("cipid"),cirf:decodeURIComponent(this.model.get("referrer")),creativeId:this.model.get("creativeId"),controls:this.model.get("player.hasControls"),country:this.model.get("country"),debug:this.model.get("isDebug")?["*"]:[],default_ad_parameters:this.model.get("defaultAdParameters"),default_ad_timeout:this.model.get("adMaxPlaySeconds"),default_b2b:this.model.get("player.b2b"),fire99:this.model.get("player.isFire99"),ga_factor:this.model.get("gaFactor"),ga_frame_src:this.model.get("gaFrameSrc"),image:this.model.get("loaderImage"),interrupt_loading:this.model.get("interruptLoading"),ip:this.model.get("ip"),isViewable:this.model.get("isPlayerViewable"),keywords:this.model.get("adTitle"),min_vpaid_run_time:this.model.get("player.minVpaidRunTime"),no_debug_report:this.model.get("noDebugReport"),oid:this.model.get("originId"),opps_base_path:this.model.get("player.urls.oppsBasePath"),non_bllb_opps_base_path:this.model.get("player.urls.nonBllbOppsBasePath"),page_url:decodeURIComponent(this.model.get("referrer")),referrer:decodeURIComponent(this.model.get("referrer")),repeat:this.model.get("repeat"),ron_percent:this.model.get("ronPercent"),schedule_auto:this.model.get("timeBetweenAds"),tags:this.model.get("tags"),time_between_waterfall:this.model.get("secondsBW"),use_flash_bypass:this.model.get("player.isBypassFlash"),use_flash_player:this.model.get("player.isFlashPlayer"),version:this.model.get("adTitle"),vertical:this.model.get("vertical"),wf_base_path:this.model.get("player.urls.wfBasePath"),domain_wf_base_path:this.model.get("player.urls.domainWfBasePath"),wf_url:this.model.get("player.urls.wfRequest"),opps_url:this.model.get("player.urls.oppsRequest"),height:""+parseInt(this.model.get("height")),width:""+parseInt(this.model.get("width")),dplayerSettings:this.model.get("player.settings"),loadrsrc:!0,preset:this.model.get("preset"),isDFP:this.model.get("iframeData.inDFP"),can_opt_out:!1,description:e.title,domain:window.location.hostname,mute:this.isMuted,title:e.title,volume:this.volume,isIdleMode:this.model.get("isInIdleMode"),dlywf:this.model.get("dlywf"),target_id:this.getTarget(),schedule:this.model.getScheduleArr(),dtagid:this.model.get("dtagid"),dpubid:this.model.get("dpubid"),isMobile:this.model.get("isMobile"),queue_size:this.model.get("player.settings.queueSize"),max_ready_vpaid:this.model.get("player.settings.maxReadyVpaid"),adto:this.model.get("player.settings.adto"),vakll:this.model.get("player.settings.vakll"),mintimwf:this.model.get("player.settings.mintimwf"),agressiveLevel:this.model.get("preset.level"),suppressContentZindex:this._getSuppressContentZindex(),vimpFireEvent:this.model.get("vimpFireEvent"),subUnitType:this.model.get("subUnitType"),vForce:this.model.get("vForce.isActive"),get_ad_timeout_seconds:this.model.get("vForce.getAdTimeoutSeconds"),wf_manual:this.model.get("wfManual"),wf_dynmc_ps:this.model.get("wfDynamicPause"),run_wf_when_empty:this.model.get("runWfWhenEmpty"),rndmt:this.model.get("rndmt"),unit_name:this.model.get("unitName"),unit_loader_version:this.model.get("version"),unit_main_version:this.model.get("unitVersion"),mprdct:this.model.get("player.settings.mprdct"),gdprApplies:this.model.get("gdprApplies"),cdb:this.model.get("consentDaisyBit"),oppsQS:this.model.get("oppsQS"),adTypesToDrop:t,red_id:this.model.get("redId"),files:[e],pixelsUrl:this.model.get("pixels.url"),numOfWfUntilDcSwitch:this.model.get("numOfWfUntilDcSwitch"),isReadMoreOnPage:ao.isMidArticleOnReadMorePage(this.model.get("isHip")),isSliderCutOff:this.model.get("isSliderCutOff"),enableStickyOnNonAllowSlider:this.model.get("enableStickyOnNonAllowSlider"),onPlayerClose:this._onPlayerClose.bind(this),onPlayerError:this._onPlayerError.bind(this),onPlayerReady:this._onPlayerReady.bind(this),onPlayerStop:this._onPlayerStop.bind(this),wurfl:{os:{name:this.model.get("wurfl.os.name"),version:this.model.get("wurfl.os.version")},browser:{name:this.model.get("wurfl.browser.name"),version:this.model.get("wurfl.browser.version")}},shouldSendDataToElastic:this.model.get("shouldSendDataToElastic"),elasticSessionId:this.model.get("elasticSessionId"),oppsula:this.oppsula,shouldLoadAdxScript:this.model.get("withAdx"),isImmediateStartPredictorEnabled:this.model.get("predictors.immediateStart.isActive")},ao.extend(this.data,this.extraData||{}),ao.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoOvaMediaPlayerInit",S.z.TRC_PERFORMANCE_ACTIONS.START),this.player=new OvaMediaPlayer(this.data),ao.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoOvaMediaPlayerInit",S.z.TRC_PERFORMANCE_ACTIONS.STOP),Ne.Z.player=this.player,this.player.on("AdClickThru",this._onAdClickThru.bind(this)),this.player.on("emptyFirstWaterfall",this._triggerPassback.bind(this)),ao.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoPlayerInit",S.z.TRC_PERFORMANCE_ACTIONS.STOP),this._registerListeners(),this._onPublisherVideoDetectChange(this.model,this.model.get("publisherVideoDetected"))}}_registerListeners(){this.player.on&&this.player.on("AdImpression",this._onAdImpression.bind(this))}_onAdImpression(){this.hadImpression||(lo.trigger("filledImpression"),this.hadImpression=!0)}_validatePlayerSize(){var e=this.model.get("width"),t=this.model.get("height"),i=!0;return ao.isWidthValid(e)?ao.isHeightValid(t)||(this.model.set("height",ao.getVideoHeight(e)),this.model.set("playerHeightLost",!0)):(i=!1,this.model.set("playerWidthLost",!0)),i}_getSuppressContentZindex(){return this.model.get("suppressContentZindex")&&this.model.get("vForce.isActiv")||!1}_onAdClickThru(){this.model.set("clickThruState",j.Z.clickThruState.clicked)}_onPlayerReady(){this.playerQueueSeeker=new ro(this.model),this.playerQueueSeeker.registerIsPlayerHasRvInQ(this.isPlayerHasRvInQ.bind(this)),this.playerQueueSeeker.registerIsPlayerHasAdxInQ(this.isPlayerHasAdxInQ.bind(this)),this.playerQueueSeeker.registerToPlayerQueueStatusChange({instance:this,type:void 0,typeValue:void 0,status:"adLoaded",cb:this.isFirstAdLoaded.bind(this),isListenOnce:!0}),this._onTabEvent(this.model,this.model.get("isInTab")),this.model.set("playerVersion",this.player.get("player_version")),this.model.set("playerRepeatCount",this.player.repeatCount),this.model.set("playerState",j.Z.readyState),this.player.on("AdVolumeChange",this._onVolumeChange.bind(this)),this.player.on("AdPaused",this._onAdPaused.bind(this)),this.player.on("AdPlaying",this._onAdPlaying.bind(this)),this.player.on("UserInteractionPauseState",this._onPausedChanged.bind(this)),this.player.on("queueStatus",this.playerQueueSeeker.updateAdsList.bind(this.playerQueueSeeker)),this.player.on("queueStatus",this._onQueueStatusChange.bind(this)),this.player.on("adxAdStop",this._onAdxAdStop.bind(this)),this.isRestarted?(this.model.set("playerState",j.Z.playerState.restarted),this.model.get("player.settings.dlywf")&&this.startWf()):this.model.set("playerState",j.Z.readyState),this.model.get("isContainerRatioNotValidForTakeOver")&&this.dropAds(js.B.adjacency.name)}_onAdxAdStop(e){this.model.set("playerQueue",e.items),this.model.trigger("loadNewAdxAd")}_onQueueStatusChange(e){this.model.set("playerQueue",e.items)}_onPausedChanged(e){this.model.set("generalPlayingUnitState",!e)}_onAdPaused(){this.model.set("generalPlayingUnitState",!1)}_onAdPlaying(){this.model.set("generalPlayingUnitState",!0)}_onPlayerClose(){this._setGeneralPlayingUnitState(!1),this.model.set("playerState",j.Z.playerState.closed)}_setGeneralPlayingUnitState(e){this.model.set("generalPlayingUnitState",null),this.model.set("generalPlayingUnitState",e)}_onPlayerStop(){this.model.set("playerState",j.Z.playerState.stopped)}_onPlayerError(){this.model.set("playerState",j.Z.playerState.error)}isPlayerHasRvInQ(){this.model.set("playerHasRvInQ",!0)}isPlayerHasAdxInQ(e){this.model.set("playerHasAdxInQ",e)}isFirstAdLoaded(){this.model.set("isFirstAdLoaded",!0)}close(){setTimeout(function(){this.player&&(this.player.closeCleanPlayer(),this.player=null,this.model.set("closeState",j.Z.closeState.playerClosed),this.model.set("playerState",j.Z.playerState.closed),this.log.info("player was closed"))}.bind(this),0)}_pausePlayer(){this.close()}_onLoadingClick(){this.isRestarted=!0,setTimeout(this._onPlayerLoaded.bind(this),0)}_hasPlayer(){return this.player&&!this.player.playerIsClosed}_onVolumeChange(e){this.isMuted=0===e.adVolume}getTarget(){if(this.model.get("targetId"))return this.model.get("targetId").toString();var e=ao.now().toString(),t=ho("<div>");return t.attr("id",e),t.css({width:this.model.get("width")+"px",height:0,position:"absolute",top:0,left:0,display:"none"}),"FEED_MANAGER"!==this.model.get("unitType")&&t.css({}),t.appendTo("body"),this.playerDiv=t,e}_onTabEvent(e,t){this.model.get("isCallIDLE")&&this.player&&this.player.startIdleMode&&this.player.stopIdleMode&&(t?(this.player.stopIdleMode(),this.model.set("isInIdleMode",!1),this.log.info("Stop idle mode")):(this.player.startIdleMode(),this.model.set("isInIdleMode",!0),this.log.info("Start idle mode")))}_onPublisherVideoDetectChange(e,t){var i;null!==(i=this.player)&&void 0!==i&&i.onPublisherVideoDetectChange&&this.player.onPublisherVideoDetectChange(t)}startWf(){this._hasPlayer()&&this.player.startWf&&!this.model.get("isInIdleMode")?(this.log.info("Starting Waterfall"),this.player.startWf()):this.model.get("isInIdleMode")&&this.createStateHandlers([{event:"isInIdleMode:false",funcName:"startWf",isListenOnce:!0}])}_getAdTypesToDrop(){var e=this.model.get("adsToDrop")||[];Array.isArray(e)||(e=[e]);var t=js.B.adjacency.name+"Ad";return this._canGetAdjacCard()||e.push(t),ao.isPlacementWithScAdjacency(this.model)&&(e.includes(t)||e.push(t),e.push(js.B.hip.name+"Ad")),e}_triggerPassback(){var e=this.model.get("isApiPassbackExist");!this.model.get("isFirstAdLoaded")&&e&&(this.log.info("Waterfall returned Empty"),lo.trigger("global:passback",{isApiPassbackExist:e}),this.model.set("closeState",j.Z.closeState.terminate))}}const uo=co;var go=o(84),mo=o(999);const po=class extends uo{constructor(e){super(e),this._init()}_bindEvents(){super._bindEvents(),this.createStateHandlers([{event:"getAdState:stopped",funcName:"_pausePlayer"},{event:"adState:playing",funcName:"_onFirstAdPlay",isListenOnce:!0}])}_onPlayerLoaded(){this.extraData={vpdcntrcstmcss:this.model.get("vpaidDivCss"),target_id:this.getTarget()},super._onPlayerLoaded()}_onPlayerReady(){super._onPlayerReady(),this._canGetAdjacCard()||(this.log.info("drop adjacency ad from player"),this._dropAdFromPlayer(js.B.adjacency.name+"Ad")),this.model.get("wurfl.browser.name")===S.z.BROWSER.IE&&go(".vpaid-player-container").addClass("vpaid-player-container-ie-fix")}close(){setTimeout(function(){this.player&&(this.player.closeCleanPlayer(),this.player=null,this.model.set("closeState",j.Z.closeState.playerClosed),this.model.set("playerState",j.Z.playerState.closed),this.log.info("player was closed"),this.createStateHandlers([{event:"loadingViewState:clicked",funcName:"_onLoadingClick",isListenOnce:!0}]),"onHover"===this.model.get("volume")&&this.model.stopListening(this.model,"change:isMouseOn"))}.bind(this),0)}_pausePlayer(){!this.model.get("isReplayAd")||this.model.get("topParentSelectorLost")||this.model.get("isReasonSecondsToCloseGlobal")?this.close():(this.player.startIdleMode(),this.createStateHandlers([{event:"loadingViewState:clicked",funcName:"_stopIdlemode",isListenOnce:!0}]))}_stopIdlemode(){this.model.get("replayAdClick")!=S.z.REPLAY_AD_CLICK.ALL&&this.model.get("replayAdClick")!=S.z.REPLAY_AD_CLICK.RESTART_PLAYER||this.player.stopIdleMode()}getTarget(){if(this.model.get("targetId"))return this.model.get("targetId").toString();if(this.model.get("isVpaidNoContainerMode"))return this.model.get("videoContainerSelector")?this.model.get("videoContainerSelector").toString():"body";var e=mo.now().toString(),t=go("<div>");t.attr("id",e);var i=0,s=go("body");if(s.length>0&&this.model.get("isPlayerOutOfViewport")){var o=s[0].getBoundingClientRect();i=window.innerHeight+-1*o.top+100}this.model.set("topOffsetPosition",i);var n=this.model.get("width")+"px";window.TRC&&!0===window.TRC.isAMP&&(n="100%"),t.css({width:n,height:0,position:"absolute",top:i+"px",left:0}),"FEED_MANAGER"!==this.model.get("unitType")?t.css({display:"none"}):t.addClass("_cm-ad-feed-manager");var r=this.model.get("additionalCss");if(r){var a=r["z-index"]||r.zIndex;a&&t.css({"z-index":a})}var d=this.model.get("videoContainerSelector")||"body";return t.appendTo(d),this.playerDiv=t,e}_onFirstAdPlay(){this.model.get("predictors.postRepeat.isActive")||(this._dropAdFromPlayer(js.B.singleAd.name),this.log.info("first ad play - dropping single ads from player Q"))}_dropAdFromPlayer(e){this.player&&this.player.dropAds&&this.player.dropAds(e)}_canGetAdjacCard(){if(this.model.get("detachToSlider.isStartFromSlider")&&this.model.get("detachToSlider.isDetachToSlider"))return!0;var e=this.model.get("startCard"),t=this.model.get("firstCardForAdjac"),i=this.model.get("permanentCard"),s=!(e!==t&&e||i!==t&&i);return!!mo.getOrganicCard()&&s}updatePlacement(){var e=this.model.get("modifiedPlacement");this.model.get("updatePlacementOnContainerChange")&&this._updateWfParameter("pstn",e),this.player.set("modifiedPlacement",e)}_updateWfParameter(e,t){this.player&&this.player.updateWfParameter&&this.player.updateWfParameter(e,t)}};var vo=o(832),fo=o(999);class bo extends vo.Z{constructor(e){var{model:t,onPredictCallback:i}=e;super({model:t,onPredictCallback:i}),this.model=t,this.onPredictCallback=i,this.log=new y.Z({unitType:this.model.get("unitType"),className:"seerService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.activePredict={},this._handleForcePredict(),this._createPlayerReadyPredict(),this._createRequestedPredictors()}_handleForcePredict(){var e=this.model.get("seer.force");Array.isArray(e)?(this._activatePredictors(e),this._disableAllPredictsExpectGiven(...e)):"string"==typeof e&&(this._activatePredictor(e),this._disableAllPredictsExpectGiven(e))}_disableAllPredictsExpectGiven(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s=this.model.get("predictors");Object.keys(s).filter((e=>"isGet1OnlyAfterAdLoaded"!==e&&!t.includes(e))).forEach(this._disablePredict.bind(this))}_disablePredict(e){this.model.set("predictors.".concat(e,".isActive"),!1),this.model.set("predictors.".concat(e,".isStartWF"),!1)}multiAd(){this.activePredict.multiAd||(this.activePredict.multiAd=[]);var e=this.model.get("predictors.multiAd.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"qState",predictArr:this.activePredict.multiAd,predict:G})}emptyQueue(){this.activePredict.emptyQueue=this._createPredict(X,this.getAdProperties("emptyQueue"))}getAdFail(){this.activePredict.getAdFailPredict=this._createPredict(Z,this.getAdProperties("getAdFail"))}autoKill(){this.activePredict.autoKillPredict=this._createPredict(N,this.getAdProperties("autoKill"))}fullEligibility(){this.activePredict.fullEligibilityPredict=this._createPredict(ee,this.getAdProperties("fullEligibility"))}distancePercent(){this.activePredict.distancePercent||(this.activePredict.distancePercent=[]);var e=this.model.get("predictors.distancePercent.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"requirePercentageToSelector",predictArr:this.activePredict.distancePercent,predict:U})}distancePixels(){this.activePredict.distancePixels||(this.activePredict.distancePixels=[]);var e=this.model.get("predictors.distancePixels.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"pixelsFromSelectors",predictArr:this.activePredict.distancePixels,predict:W})}immediateStart(){this.activePredict.immediateStartPredictor=this._createPredict(Oe,this.getAdProperties("immediateStart"))}adx(){this.activePredict.adxPredictor=this._createPredict(Ee,this.getAdProperties("adx"))}firstScroll(){this.activePredict.firstScrollPredict=this._createPredict(Q,this.getAdProperties("firstScroll"))}time(){this.activePredict.time||(this.activePredict.time=[]);var e=this.model.get("predictors.time.predictPoints");"number"==typeof e||Array.isArray(e)?this._createPredict(de,{}):this._createMultiPointPredict({predictPoints:e,predictArr:this.activePredict.time,predict:de})}intersection(){this.activePredict.intersectionPredict||(this.activePredict.intersectionPredict=[]);var e=this.model.get("predictors.intersection.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"intersectionPercent",predictArr:this.activePredict.intersectionPredict,predict:ae})}mp4(){this.activePredict.mp4Predict=this._createPredict(le,this.getAdProperties("mp4"))}msnFullEligibility(){this.activePredict.msnFullEligibilityPredict=this._createPredict(_e,{})}feedInViewPredict(){this.activePredict.feedInViewPredict=this._createPredict(Te,this.getAdProperties("feedInViewPredict"))}recoReel(){this.activePredict.recoReelPredict||(this.activePredict.recoReelPredict=[]);var e=this.model.get("predictors.recoReel.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"percentage",predictArr:this.activePredict.recoReelPredict,predict:we})}postRepeat(){this.activePredict.postRepeat=this._createPredict(Ce,{})}_createPlayerReadyPredict(){this.log.debug("Creating player ready predict"),this.model.get("predictors.playerReady")&&this.model.get("predictors.playerReady.isActive")&&(this.activePredict.playerPredict=this._createPredict(q,this.getAdProperties("playerReady"))),this.log.debug("playerReadyPredict created")}onPredict(e,t,i){this.model.get("stopPredicts")&&S.z.PREDICT_NAMES[t]!==S.z.PREDICT_NAMES.postRepeatPredictor||(this.model.set("nextPredictName",t),this.model.set("nextPredict",e),this.onPredictCallback(t?S.z.PREDICT_NAMES[t]:-1,i))}startWF(){this.model.set("startWF",!0)}_createRequestedPredictors(){if(this.model.get("playerState")===j.Z.readyState){var e=this.model.get("predictors");Object.keys(e).forEach((t=>{var i=e[t];i&&this[t]&&(i.isActive||i.isStartWF)&&!this.activePredict[t]&&(this.log.info("Predict activePredict",t),fo.defer(this[t].bind(this)))}))}else this.model.listenToOnce(this.model,"change:playerState",this._createRequestedPredictors.bind(this))}_activatePredictors(e){e.forEach((e=>{this._activatePredictor(e)}))}_activatePredictor(e){this.model.set("predictors.".concat(e,".isActive"),!0)}_createMultiPointPredict(e){var t=e.predictPoints,i=e.pointKey,s=e.predictArr,o=e.predict;fo.each(t,((e,t)=>{s.push(this._createPredict(o,{predictPoint:e[i],predictKey:void 0!==e.key?e.key:t,adProperties:{adProperties:e.adProperties,excAdProperties:e.excAdProperties}}))}))}_createPredict(e,t){return fo.extend(t,{model:this.model,onPredict:this.onPredict,startWfFunc:this.startWF,onPredictCallback:this.onPredictCallback}),new e(t)}getAdProperties(e){return{adProperties:{adProperties:this.model.get("predictors.".concat(e,".adProperties")),excAdProperties:this.model.get("predictors.".concat(e,".excAdProperties"))}}}}const _o=bo;var So=o(316),yo=o(999);class Ao extends E.O{constructor(e){super(e),this.model=e,this.shouldConsiderBlurAsTabOut=this.model.get("usePageEventsForTabStatus")&&!0===this.model.get("isMobile");var t=function(e){return e.get("isUseHasFocus")?document.hasFocus():!document.hidden}(this.model);this.model.set("isInTab",t),this.log=new y.Z({unitType:this.model.get("unitType"),className:"tabStatusService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.bindEvent()}bindEvent(){this.model.listenTo(So,"window:tab:change",this._onTabEvent.bind(this))}_onTabEvent(e){this.model.set("tabState",yo.find(Object.keys(S.z.TAB_STATE),(t=>S.z.TAB_STATE[t]===e))),this._isTabOut(e)?this.model.set("isInTab",!1):this.model.set("isInTab",!0)}_isTabOut(e){return e===S.z.TAB_STATE.tabOut||!!this.shouldConsiderBlurAsTabOut&&e===S.z.TAB_STATE.blur}}const To=Ao;const wo=class{constructor(e,t){this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:"ObserverService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.options=t,this.setObserver()}observe(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++)e[t].dataset.elViewPercent||this.observer.observe(e[t])}unobserve(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++)this.observer.unobserve(e[t])}setObserver(){this.setDefaults(),this.observer=new IntersectionObserver(this.observerCallback.bind(this),this.options);var e=this.options.targetEl;this.observe(e)}setDefaults(){var e=this.options;e.threshold=e.threshold||[0,this.model.get("viewPercent")/100,this.model.get("viewabilityPercent")/100],e.rootMargin=e.rootMargin||"0px",e.targetEl=Array.isArray(e.targetEl)?e.targetEl:[e.targetEl]}observerCallback(e,t){this.options.callback&&this.options.callback(e,t),e.forEach((e=>{e.target.dataset.elViewPercent=e.intersectionRatio.toString()}))}getViewPercent(e){return 100*parseFloat(e.dataset.elViewPercent)}isElIntersectingViewport(e){return this.getViewPercent(e)>0}isElViewPercentReached(e){return this.getViewPercent(e)>this.model.get("viewPercent")}isElViewabilityPercentReached(e){return this.getViewPercent(e)>this.model.get("viewabilityPercent")}};var Co=o(999),Po=o(84),Eo=o(316);class Io extends E.O{constructor(e){super(e),this.model=e,this.log=new y.Z({unitType:this.model.get("unitType"),className:"CardLocator",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.noAboveSelector=this.model.get("fmNoAboveSelector"),this.noBelowSelector=this.model.get("fmNoBelowSelector"),this.isSingleFeed=this._isSingleFeed(),this._resetCardLocatorParams(),this.maxPPS=this.model.get("getCardMaxPPS"),this.scrollManager=new x.Z,this._setMinDistance(),this._decisionCallbacks=[{callback:this._biggerThenLastCard,onFalseRunNext:!1},{callback:this._isCardInViewPort,onFalseRunNext:!1},{callback:this._biggerThenMinDistance,onFalseRunNext:!1},{callback:this._canHaveVideoBrotherAbove.bind(this),onFalseRunNext:!1},{callback:this._isAtViewPercent,onFalseRunNext:!1}],this._decisionCallbacksOutOfView=[{callback:this._biggerThenLastCard,onFalseRunNext:!1},{callback:this._biggerThenMinDistance,onFalseRunNext:!1},{callback:this._canHaveVideoBrotherOutOfView.bind(this),onFalseRunNext:!1},{callback:this._isCardInViewPortOutOfView,onFalseRunNext:!1}],this._isGetCardOnEligibility=this.model.get("isGetCardOnEligibility"),this._isGetCardOnEligibility&&(this._viewPercent=this.model.get("cardEligibilityPercent")),this._isStartFromSlider=this.model.get("detachToSlider.isStartFromSlider"),this._setFeedContainer(),this._startCard=0,this._isOpenInViewPort=this.model.get("isOpenInViewPort"),this._permanentCard=this.model.get("permanentCard"),void 0===this._isOpenInViewPort&&(this._isOpenInViewPort=!0),this._initCardsObserver()}_setFeedContainer(){this._feedContainer=this.model.get("feedContainer");var e=this.model.get("feedContainerChanged")>0;Co.isElement(this._feedContainer)&&!e&&(this._setFeedContainers(),this._setFeedCardsElementArray()),this._validateContainer(),this.isSingleFeed&&this._overwriteVideoContainerSelector(),this._resetCardLocatorParams()}_setFeedCardsElementArray(){this._feedContainer=void 0,this._feedCardsElementArray=[],Co.each(this._feedContainers,(e=>{var t=e.querySelectorAll(this.model.get("feedCardSelector"));t.length>0&&(this._feedContainer||(this._feedContainer=e),this._feedCardsElementArray.push(...t))}))}_initCardsObserver(){this.model.get("isUseObserverForCardLocator")&&(this.cardObserver=new wo(this.model,{targetEl:this._getCardsElemArr()}))}_setMinDistance(){this._minDistance=this.model.get("cardsMinDistance");var e=Po(window).height();this._minDistance<e&&(this._minDistance=e,this.model.set("cardsMinDistance",e))}_bindListeners(){Eo.on("window:orientation:change",this._getCardOnDomEvent,this),Eo.on("window:resize:change",this._getCardOnDomEvent,this),Eo.on("window:scroll:change",this._getCardOnDomEvent,this),Eo.on("feed:resize:change",this._getCardOnDomEvent,this),this.maxPPS&&void 0===this.scrollEndIndex&&(this.scrollEndIndex=this.scrollManager.registerForScrollEnd(this._getCardOnDomEvent.bind(this))),this._listenersBinded=!0}_unBindListeners(){Eo.off("window:orientation:change",this._getCardOnDomEvent,this),Eo.off("window:resize:change",this._getCardOnDomEvent,this),Eo.off("window:scroll:change",this._getCardOnDomEvent,this),Eo.off("feed:resize:change",this._getCardOnDomEvent,this),this.maxPPS&&void 0!==this.scrollEndIndex&&(this.scrollManager.deRegisterForScrollEnd(this._getCardOnDomEvent.bind(this)),this.scrollEndIndex=void 0),this._listenersBinded=!1}_biggerThenLastCard(e){return!this._lastCardElement||this._getCardNumber(e)>this._getCardNumber(this._lastCardElement)}_isCardInViewPort(e){return!!e&&this.getViewPercentMethod(e)>0}_isCardInViewPortOutOfView(e,t){var i=this.getViewPercentMethod(e),s=t?this.getViewPercentMethod(t):0;return i>0&&i<99.9&&s<=0}_biggerThenMinDistance(e){return!this._lastCardElement||this._isMinDistancePassed(e)}_isMinDistancePassed(e){return!(Po(e)[0].offsetTop-(Po(this._lastCardElement)[0].offsetTop+Po(this._lastCardElement).height())<this._minDistance)}_canHaveVideoBrotherAbove(e,t){var i=!e.hasAttribute(this.noAboveSelector);if(!t)return i;var s=!t.hasAttribute(this.noBelowSelector);return i&&s}_canHaveVideoBrotherOutOfView(e,t){var i=!e.hasAttribute(this.noBelowSelector);if(!t)return i;var s=!t.hasAttribute(this.noAboveSelector);return i&&s}_isCurrentCardIsValid(e,t){var i;i=this._isOpenInViewPort?this._decisionCallbacks:this._decisionCallbacksOutOfView;for(var s=0;s<i.length;s++){var o=i[s];if(!1===o.callback.call(this,e,t)&&!1===o.onFalseRunNext)return!1}return!0}_getCardNumber(e){return Po(e).data("card-index")}_getCardOnDomEvent(e){this.maxPPS&&Math.abs(this.scrollManager.pps)>this.maxPPS||(this._isOpenInViewPort?this._searchCard():this._searchCardPerf())}_searchCard(e){var t=this.getCardsArray(this._feedCardsElementArray);if(this.observeCards(t),this._permanentCard&&this._permanentCard>0)return this._getPermanentCard(t);t=t.reverse(),e&&(this._lastCardElement=this._getLastCardInViewPort(t),this.log.info("Once out of view - Last card updated to - ",this._getCardNumber(this._lastCardElement)));for(var i=0;i<t.length;i++){var s=t[i],o=t[i+1];if(this._isCurrentCardIsValid(s,o)){this._insert="before";var n=this._isCardInViewPort(t[1]);if(0===i&&!n&&t.length>1){if(s.hasAttribute(this.noBelowSelector))continue;this._insert="after"}return this._updateLastCard(s),this._unBindListeners(),this.log.info("found valid card: "+this._lastCardElementId),this.model.set("hasValidCard",this._lastCardElementId),{cardElement:s,cardNumber:this._lastCardElementId,insert:this._insert}}}if(this._isForceAdDetach()||!this._isGetCardOnEligibility||this._isStartFromSlider&&!this._lastCardElement){var r=this._tryFirstCard(t[t.length-1]);if(r)return r;var a=this._tryLastCard(t[0]);if(a)return a}}_isForceAdDetach(){return this.model.get("detachToSlider.isDetachToSlider")&&this.model.get("detachToSlider.forceDetach.isActive")&&!this._isFeedContainerBelowViewport()}_isFeedContainerBelowViewport(){return this._feedContainer.getBoundingClientRect().top>0}_searchCardPerf(){var e=this.getCardsArray(this._feedCardsElementArray);if(this.observeCards(e),this._permanentCard&&this._permanentCard>0)return this._getPermanentCard(e);e=e.reverse();for(var t=1;t<e.length;t++){var i=e[t],s=e[t-1];if(this._isCurrentCardIsValid(i,s)){if(i=e[t-1],this._insert="before",1===t){if(i.hasAttribute(this.noBelowSelector))continue;this._insert="after"}return this._updateLastCard(i),this._unBindListeners(),this.log.info("found valid card: "+this._lastCardElementId),this.model.set("hasValidCard",this._lastCardElementId),{cardElement:i,cardNumber:this._lastCardElementId,insert:this._insert}}}var o=this._tryFirstCard(e[e.length-1]);if(o)return o;var n=this._tryLastCardPerf(e[0]);return n||void 0}_tryFirstCard(e){if(!this._lastCardElement&&this.isFeedNotInViewport()&&this._isCloseToTop()){if(!this._canHaveVideoBrotherAbove(e))return;return this._unBindListeners(),this._updateLastCard(e),this._insert="before",this.model.set("hasValidCard",this._lastCardElementId),{cardElement:this._lastCardElement,cardNumber:this._lastCardElementId,insert:this._insert}}}_tryLastCard(e){if(this.isFeedNotInViewport()&&!this._isCloseToTop())return this._getIfLastCard(e)}_tryLastCardPerf(e){if((this._isCardInViewPort(e)||this.isFeedNotInViewport())&&!this._isCloseToTop())return this._getIfLastCard(e)}_getIfLastCard(e){if(!e.hasAttribute(this.noBelowSelector))return!this._lastCardElement||this._isMinDistancePassed(e)&&this._lastCardElement!==e?(this._unBindListeners(),this._updateLastCard(e),this._insert="after",this.model.set("hasValidCard",this._lastCardElementId),{cardElement:this._lastCardElement,cardNumber:this._lastCardElementId,insert:this._insert}):void 0}_getCardByCardNumber(e){if(this.log.info("getCard by number was called. cardNumber = "+e),e==this._lastCardElementId)return this._unBindListeners(),this.model.set("hasValidCard",void 0,{silent:!0}),{cardElement:this._lastCardElement,cardNumber:this._lastCardElementId,insert:this._insert}}_updateLastCard(e){this._lastCardElement=e,this._lastCardElementId=this._getCardNumber(e)}getCard(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isOpenInViewPort=this.model.get("isOpenInViewPort"),t.cardNumber?this._getCardByCardNumber(t.cardNumber):this.isOpenOnCardFound?void this.log.info("Has permanent card already - ",this._permanentCard):(this.maxPPS&&Math.abs(this.scrollManager.pps)>this.maxPPS?this.log.info("Can't get card scroll is to fast waiting for user to slow down"):(this.log.info("getCard was called"),e=this._isOpenInViewPort?this._searchCard(t.onceOutOfView):this._searchCardPerf()),e||this._listenersBinded||(this.log.info("Waiting for valid card - binding listeners"),this._bindListeners()),e)}_isCloseToTop(){var e=document.body,t=document.documentElement,i=Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)/2;return Po(window).height()/2+Po(window).scrollTop()<=i}isFeedNotInViewport(){return this._feedContainer&&this.getViewPercentMethod(this._feedContainer)<=0}_getPermanentCard(e){for(var t=0;t<e.length;t++)if(this._permanentCard===this._getCardNumber(e[t])){if(this._isGetCardOnEligibility&&!this._isAtViewPercent(e[t]))return;return this._unBindListeners(),this._lastCardElement=e[t],this._lastCardElementId=this._permanentCard,this._insert="before",this.isOpenOnCardFound=!0,this.model.set("hasValidCard",this._permanentCard),{cardElement:e[t],cardNumber:this._permanentCard,insert:this._insert}}}_getLastCardInViewPort(e){for(var t,i=0;i<e.length;i++)if(this._isCardInViewPort(e[i])){t=e[i];break}return!t||this._getCardNumber(t)<this._lastCardElementId?this._lastCardElement:t}_isAtViewPercent(e){if(!this._isGetCardOnEligibility)return!0;var t=Po(window),i={top:t.scrollTop(),left:t.scrollLeft()};i.right=i.left+t.width(),i.bottom=i.top+t.height();var s=Po(e).width(),o=Co.getVideoHeight(s)+25;if(!s||!o)return!1;var n=Po(e).offset();n.right=n.left+s,n.bottom=n.top+o,n.bottom<i.top&&(n.bottom+=t.scrollTop());var r=Math.min(1,(n.bottom-i.top)/o),a=Math.min(1,(i.bottom-n.top)/o),d=(Math.min(1,(n.right-i.left)/s),Math.min(1,(i.right-n.left)/s),r*a*100);return this.log.info("Video card view percent - ",d),d>=this._viewPercent}_sliceByStartCard(e){return this._startCard>0?e.slice(this._startCard-1):e}getCardsArray(e){this._setFeedCardsElementArray();var t=Array.prototype.slice.call(e);return this._sliceByStartCard(t)}getViewPercentMethod(e){return this.model.get("isUseObserverForCardLocator")?this.cardObserver.getViewPercent(e):Co.getViewPercent(e,e.offsetWidth,e.offsetHeight,this.model.get("scrollSelector"),this.model.get("useClientRectForViewPercentCalc"))}_getCardsElemArr(){var e=this.getCardsArray(this._feedCardsElementArray);return e.push(...this._feedContainers),e}observeCards(e){this.cardObserver&&this.cardObserver.observe(e)}_unObserveCards(e){this.cardObserver&&this.cardObserver.unobserve(e)}updateFeedSelector(){this._unObserveCards(this._getCardsElemArr()),this._setFeedContainer(),this.observeCards(this._getCardsElemArr())}_resetCardLocatorParams(){this._lastCardElement=null,this._startCard=0,this._isFeedHasScCard()}getSpecificCard(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.lastSpecificCard===e)return Eo.off("window:scroll:change",this.getSpecificCard.bind(this,e,t)),void Eo.off("feed:resize:change",this.getSpecificCard.bind(this,e,t));var i=Po('[data-card-index="'.concat(e,'"]'))[0];if(!i&&(this.model.get("rv0PlayOnFurtherCard")||this.model.get("videoReelCompensation")))for(var s=e;s>0;s--){var o=document.querySelector('[data-card-index="'.concat(s,'"]'));if(o){e=s,i=o;break}}if(i&&(t||this._isCurrentCardIsValid(i)||this._tryFirstCard(i)||this.model.get("rv0PlayOnFurtherCard")||this.model.get("videoReelCompensation")))return this._updateLastCard(i),setTimeout((()=>{this.hasListenersForSpecific=!1}),0),Eo.off("window:scroll:change",this.getSpecificCard.bind(this,e,t)),Eo.off("feed:resize:change",this.getSpecificCard.bind(this,e,t)),this._insert="before",this.lastSpecificCard=e,this.model.set("hasValidCard",this._lastCardElementId),{cardElement:i,cardNumber:e,insert:"before"};this.hasListenersForSpecific||(this.hasListenersForSpecific=!0,Eo.on("window:scroll:change",this.getSpecificCard.bind(this,e,t)),Eo.on("feed:resize:change",this.getSpecificCard.bind(this,e,t)))}_isSingleFeed(){var e=Po(this.model.get("parentSelector"));return e&&1===e.length}_setFeedContainers(){var e=this._feedContainer.getAttribute(["data-feed-main-container-id"]),t=document.querySelectorAll("[data-feed-main-container-id='".concat(e,"']"));this._feedContainers=Array.prototype.slice.call(t)}_setFeedContainersByPlacement(){var e=this.model.get("parentSelector"),t=Co.getPlacement(this.model),i=document.querySelectorAll("".concat(e,"[data-parent-placement-name='").concat(t,"']"));this._feedContainers=Array.prototype.slice.call(i)}_overwriteVideoContainerSelector(){(!this.model.get("detachToSlider.isStartFromSlider")||!this.model.get("detachToSlider.isDetachToSlider"))&&!1!==this.model.get("videoContainerSelector")&&this.model.set("videoContainerSelector",this.model.get("parentSelector"))}_validateContainer(){var e=!this._feedCardsElementArray||0===this._feedCardsElementArray.length,t=this.model.get("feedContainerChanged")>0;if((e||t)&&(this._setFeedContainersByPlacement(),this._setFeedCardsElementArray(),0===this._feedCardsElementArray.length)){var i={debug:"!url:"+(window&&window.location&&window.location.href?window.location.href:"")};Co.firePixel(this.model.getPixel("pixels.feedHasNoCardsToOpen"),"feedHasNoCardsToOpen",i)}}_isFeedHasScCard(){this.model.get("placementWithScAdjacency")===Co.getPlacement(this.model)&&(this.model.set("hasScAdjacency",!0),this._startCard=3)}}const Oo=Io;var Vo=o(84),No=o(999);class Do extends E.O{constructor(e){super(e),this.model=e,this.adjacCardPlacement=this.model.get("adjacCardPlacement"),this.log=new y.Z({unitType:this.model.get("unitType"),className:"organicCardInjector",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this._bindEvents()}_bindEvents(){}injectOrganicCard(e){if(this.adjacCardPlacement=this.model.get("adjacCardPlacement")||this.adjacCardPlacement,!this._isCardOrganic(this.adjacCardPlacement)&&!this.isOrganicCardInjected){this.organicContainer=Vo(e)[0];var t=No.getOrganicCard();if(!t)return this.log.error("missing mode can't inject organic"),!1;if(!this.organicContainer)return this.log.error("missing container to inject an organic card"),!1;var i=document.createElement("div");i.id="taboola-adjacent-organic-card",i.classList.add("tbl-feed-card"),i.dataset.cardIndex=this.adjacCardPlacement-.25,this.organicContainer.insertAdjacentElement("afterend",i),window._taboola=window._taboola||[];var s=this._getPlacementName();return this.isOrganicCardInjected=!0,this.model.set("isOrganicCardInjected",!0),_taboola.push({mode:t,container:"taboola-adjacent-organic-card",placement:s,target_type:"mix"}),!0}}_getPlacementName(){var e=Vo(this.model.get("parentSelector"))[0];if(e&&e.dataset&&e.dataset.parentPlacementName)return e.dataset.parentPlacementName+" | Card 0"}_isCardOrganic(e){var t=Vo('[data-card-index="'.concat(e,'"]'))[0];return!(!t||!t.querySelector(".trc-content-organic"))}}var Ro=function(){var e;return function(t){return e||(e=new Do(t)),e}}();const Mo=Ro;var xo=o(84),Fo=o(999),Lo=o(316);class Bo extends E.O{constructor(e){super(e),this.model=e,this.videoElements=[],this.log=new y.Z({unitType:this.model.get("unitType"),className:"PublisherVideoDetector",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.pubVideoTagsSelector=this.model.get("publisherVideoSelector")||"video",this._registerHooks(),this.isPublisherVideoDetected(),this._bindEvents()}_bindEvents(){this.model.get("isDetectIframeVideos")&&this.createStateHandlers([{event:"adState:playing",funcName:"_detectIframeVideos"},{event:"adQState:q1",funcName:"_detectIframeVideos"},{event:"adQState:q2",funcName:"_detectIframeVideos"},{event:"adQState:q3",funcName:"_detectIframeVideos"}])}_extractVideoTagsFromShadowRoot(e){return e.reduce(((e,t)=>{var i=t.shadowRoot.querySelector(this.pubVideoTagsSelector);return i?[...e,i]:e}),[])}_getPubVideoTags(e){if(!this.model.get("adxDetector"))return xo(this.pubVideoTagsSelector).toArray();var t=[...document.querySelectorAll("*")].filter((e=>null!==e.shadowRoot));return[...this._extractVideoTagsFromShadowRoot(t),...document.querySelectorAll(e)]}isPublisherVideoDetected(){return this.pubVideoTags=this._getPubVideoTags(this.pubVideoTagsSelector),this._findPubVideo(this.pubVideoTags),this.model.get("isDetectPubIframeVideo")&&this._iframeIterator(window.document,this._findPubVideo),!!this.model.get("publisherVideoDetected")&&(this._monitorPubVideos(),!0)}_findPubVideo(e){!this.model.get("publisherVideoDetected")&&e.length>0||Fo.isFunction(this.isPubVideoDetectedHook)&&this.isPubVideoDetectedHook()?(this.model.set("publisherVideoDetected",!0),this.log.info("found Pub Video in:",e)):this.model.set("publisherVideoDetected",!1)}_monitorPubVideos(){if(!this.model.get("isNoPubVideoInView")&&!this.isLookingForPubVideo){var e=xo(this.pubVideoTagsSelector).last()[0],t=e&&e.getBoundingClientRect(),i=this.model.get("pubVidDetectorThreshold");t&&t.bottom<=i?(this.log.info("started Publisher Video Detector Timer"),this.isLookingForPubVideo=!0,setTimeout(this.isPubVideoInView.bind(this),this.model.get("publisherDetectorDelayInMs"))):Lo.once("window:scroll:change",this._monitorPubVideos.bind(this))}}_filterInstreamPlayerVideo(e){this.pubVideoTags=this.pubVideoTags.filter((t=>!e.contains(t)))}isPubVideoInView(){return this.pubVideoTags=this._getPubVideoTags(this.pubVideoTagsSelector),this._filterCmAdPlayerVideo(),this.model.get("adxDetector")&&this._filterInstreamPlayerVideo(this.model.get("instreamContainerElement")),this.model.set("isPubVideoViewable",!1),this._isViewableElements(this.pubVideoTags),this.isLookingForPubVideo=!1,this.model.get("isPubVideoViewable")?(this.log.info("Timeout - Publisher Video in View"),Lo.once("window:scroll:change",this._monitorPubVideos.bind(this)),!0):(this.model.set("isNoPubVideoInView",!0),this.log.info("No publisher video in view - can continue with regular flow"),!1)}_isPubVideoReady(){return this.pubVideoInView.readyState>0}_filterCmAdPlayerVideo(){this.pubVideoTags&&0!==this.pubVideoTags.length&&(this.pubVideoTags=this.pubVideoTags.filter((e=>!e.className.includes("cm-ad-player"))))}_detectIframeVideos(){this.model.get("publisherIframeVideoDetected")||(this.iframeWithVideos=[],this._getIframeWithVideos(window.document,"iframe",this.pubVideoTagsSelector),this._isViewableElements(this.iframeWithVideos))}_iframeIterator(e,t){try{Fo.DOMIterator(e,"iframe",t.bind(this),this.pubVideoTagsSelector)}catch(e){}}_getIframeWithVideos(e,t,i){try{var s=Fo.getIframeDocument(e)||e;if(!s)return;for(var o=s.querySelectorAll(t),n=0;n<o.length;n++){(Fo.getIframeDocument(o[n])||o[n]).querySelectorAll(i).length>0&&!this._isCurrentUnit(o[n])&&this.iframeWithVideos.push(o[n]),Fo.DOMIterator(o[n],t,i)}}catch(e){return}}_isCurrentUnit(e){var t=xo(e).parents(),i=this.model.get("videoViewContainer");for(var s in t)if(t[s]===i)return!0;return!1}_isViewableElements(e){if(e){for(var t=this.model.get("pubViewabilityPercent"),i=0;i<e.length;i++){var s=xo(e[i]),o=parseInt(s.width()),n=parseInt(s.height());if(t<Fo.getViewPercent(e[i],o,n,this.model.get("scrollSelector")))return this.model.set("isPubVideoViewable",!0),this.pubVideoInView=this.pubVideoTags[i],void("iframe"===e[i].tagName.toLowerCase()&&this.model.set("publisherIframeVideoDetected",!0))}Fo.isFunction(this.isPubVideoInViewHook)&&this.isPubVideoInViewHook()?this.model.set("isPubVideoViewable",!0):this.model.set("isPubVideoViewable",!1)}}_registerHooks(){Fo.isFunction(this.model.get("isPubVideoDetectedHook"))&&(this.isPubVideoDetectedHook=this.model.get("isPubVideoDetectedHook")),Fo.isFunction(this.model.get("isPubVideoInViewHook"))&&(this.isPubVideoInViewHook=this.model.get("isPubVideoInViewHook"))}}const ko=Bo;class Uo{constructor(e){this.model=e,this.timeoutDebounce=!1,this.timeoutThrottle=!1,this.isTimeoutThrotle=!1,this.arr=[],this.docHeight=0,this.createElementsOnPage()}createElementsOnPage(){this.ampHelperContainer=document.createElement("div"),this.ampHelperContainer.className="_cm-amp-helper-container",document.querySelector("body").appendChild(this.ampHelperContainer),this.createObserver(),this.createObserverElementsObservers(),this.createPageObserver()}createObserver(){this.intersectionObserver=new IntersectionObserver(function(e){e.map((e=>{this.arr[e.target.dataset.indexNumber]={intersect:e.isIntersecting,off:e.target.offsetTop},this.callFindIndex()}))}.bind(this))}callFindIndex(){clearTimeout(this.timeoutDebounce),this.timeoutDebounce=setTimeout(this.findIndex.bind(this),this.model.get("detachToSlider.amp.timeoutDebounce")),!this.isTimeoutThrotle&&this.model.get("detachToSlider.amp.timeoutThrottle")&&(this.isTimeoutThrotle=!0,this.timeoutThrottle=setTimeout(this.findIndex.bind(this),this.model.get("detachToSlider.amp.timeoutThrottle")))}createObserverElementsObservers(){for(var e=document.body.clientHeight,t=this.docHeight,i=t;i<e;i++){var s=document.createElement("div");s.className="_cm-amp-helper-observer",s.setAttribute("data-index-number",i),this.ampHelperContainer.appendChild(s)}for(var o=document.querySelectorAll("._cm-amp-helper-observer"),n=t;n<o.length;n++)this.intersectionObserver.observe(o[n]);this.docHeight=document.body.clientHeight}findIndex(){clearTimeout(this.timeoutThrottle),this.isTimeoutThrotle=!1;for(var e=0,t=0,i=0;i<this.arr.length;i++)if(this.arr[i].intersect){e=i;break}for(var s=e;s<this.arr.length&&(t=s,this.arr[s].intersect);s++);this.model.set("ampPageTopLimit",this.arr[e].off),this.model.set("ampPageBottomLimit",this.arr[t].off)}createPageObserver(){var e=document.querySelector(this.model.get("parentSelector"));new MutationObserver(function(e,t){this.createObserverElementsObservers()}.bind(this)).observe(e,{attributes:!0,childList:!0,subtree:!1})}getArr(){return this.arr}}var zo=o(999),Ho=o(84),Wo=o(316);function jo(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class $o extends E.O{constructor(e){super(e),jo(this,"_isSCMitigationAllowed",(()=>{var e;if(this.model.get("forceSCMAllow"))return!0;var{adsList:t}=null===(e=this.playerService)||void 0===e?void 0:e.playerQueueSeeker;return!t.some((e=>e.rv||!e.alwsldr))})),this.model=e.model,this.initialModel=this.createSubModel(),this.initialModel.set("detachToSlider",this.model.get("detachToSlider")),this.controllersArray=[],this.model.set("subAdsEligibility",{}),this.log=new y.Z({unitType:this.model.get("unitType"),className:this.constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this._overrideVideoContainer(),this.impCount=0,this._addStyleToHeader(),this._createTimers(),this._setSubUnitType(),this.model.set("height",zo.getVideoHeight(this.model.get("width"))),this.isSuperSlider=this.model.get("detachToSlider.isStartFromSlider")&&this.model.get("detachToSlider.isDetachToSlider"),this._bindEvents(),this.windowEventManager=Je(),this.elasticLogger=this.model.get("elasticLogger"),this.adsManager=new Ys(this.model),this.model.get("isDetectPubVideo")&&(this.pubVidDetector=new ko(this.model)),this.pubVidDetector&&this.pubVidDetector.isPubVideoInView()&&this.model.get("isDelaySeer")?this.createStateHandlers([{event:"isNoPubVideoInView",funcName:"_startDelayedServices",isListenOnce:!0}]):this.seerService=new _o({model:this.model,onPredictCallback:this.adsManager.adPredict.bind(this.adsManager)}),this.playerLoader=new io(this.model),this.playerService=new po(this.model),this.pixelsService=new eo(this.model),this.feedEventManager=new xs(this.model,this.model.get("parentSelector"));var t=this.model.get("detachToSlider.isStartFromSlider");this.tabStatusService=new To(this.model),t?this.model.set("isEligibleToPlay",!0):this.FeedEligibilityService=new rs(this.model,this.model.get("parentSelector")),this.model.get("frameType")===S.z.FRAME_TYPE.amp&&(this.AmpIntersectionHelper=new Uo(this.model)),this.cardLocator=new Oo(this.model),this.log.info("Feed Manager created",this.model),this.isSliderOn=this.model.get("detachToSlider").isStartFromSlider||this.model.get("detachToSlider").isDetachToSlider,this.model.set("isSliderOn",this.isSliderOn),this.firstCardCalled=!1,this.animation=this.model.get("animation"),this.ContinuePlayAdInNextCard=new ks(this.model),this._removeCardForDemo(),this._crossUnitInfo(),this.playerQueueSeeker=new ro(this.model)}_overrideVideoContainer(){var e=Ho(this.model.get("parentSelector"));e&&1===e.length||(this._updateModels("videoContainerSelector",!1),this.log.info("multiple feeds detected, setting videoContainerSelector to false"))}_createTimers(){this._createSecondsToCloseTimer(),this._createSecondsToCloseGlobalTimer(),this._createSecondsToPassbackTimer()}_onLoadingClick(){this._createSecondsToCloseGlobalTimer()}_createSecondsToCloseTimer(){var e=this.model.get("secondsToClose");if(e>0){var t={startCondition:{stateToListen:!0,state:"firstGetAdFired"},stopCondition:{stateToListen:j.Z.adQState.impression,state:"adQState"},isStartOnce:!0};this.secondsToCloseTimer=new At(this.model,t,this.terminate.bind(this,!1,"secondsToClose"),1e3*e)}}_createSecondsToCloseGlobalTimer(){this.secondsToCloseGlobalTimer&&this.secondsToCloseGlobalTimer.stop(this.model,void 0,{},!0);var e=this.model.get("secondsToCloseGlobal");if(e>0){var t={startCondition:{stateToListen:"",state:""}};"showReplay"===this.model.get("onTimerClose")||"close"===this.model.get("onTimerClose")?this.secondsToCloseGlobalTimer=new At(this.model,t,this.pause.bind(this,"secondsToCloseGlobal"),1e3*this.model.get("secondsToCloseGlobal")):this.secondsToCloseGlobalTimer=new At(this.model,t,this.terminate.bind(this,!1,"secondsToCloseGlobal"),1e3*e),this.secondsToCloseGlobalTimer.start(this.model,"")}}_createSecondsToPassbackTimer(){if(this.model.get("secondsToPassback")){this.passBackTimer=new At(this.model,{startCondition:{stateToListen:"",state:""},stopCondition:{stateToListen:!0,state:"isFirstAdLoaded"}},this._triggerPassback.bind(this,"Passback"),1e3*this.model.get("secondsToPassback")),this.passBackTimer.start(this.model,"")}}subAdsEligibilityChange(){if(this.log.info("subAdsEligibilityChange, is continueToPlayInNexCard",this.model.get("continueToPlayInNexCard.isActive")),this.model.get("continueToPlayInNexCard.isActive")&&!this.model.get("isSliderOn")&&(this.log.info("subAdsEligibilityChange "),this._isContinuaPLayAdInNextCard()))return this.ContinuePlayAdInNextCard._startWatchDivLeaveVeiwPort(this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView.getEl()),void this.createStateHandlers([{event:"elementOutOfView",funcName:"_onTempAdOutOffView",isListenOnce:!0},{event:"temAdCondition:true",funcName:"_onAdCondition",isListenOnce:!0}]);this._getCard("subAdsEligibility")}_hasViableSubUnits(){var e=this.model.get("subAdsEligibility");for(var t in e)if(!0===e[t])return!0;return!1}createSubFeedController(e,t,i){if(this.log.info("videoCardIniOptions ",e),this.log.info("Creating Sub Unit: card number: "+e.cardNumber+" adId:"+t.adId),this.log.info("Last Ad ID = "+this.model.get("lastAdID")+" Next Ad ID = "+t.adId),this.model.get("lastAdID")!==t.adId||this.tempActiveAd||zo.isSliderCutOffEnabled(this.model,t.adData)){this.model.set("lastAdID",t.adId),this.controllersArray.length>1&&(t.isUsed=!0),0===this.controllersArray.length&&t.vpaidWrapper.nonVideoVpaid&&this._setIniModelToNoslider();var s=this.getSubModel();0===this.controllersArray.length&&this._setIniModelToNoslider(),s.set("parentSelector",this.model.get("parentSelector"));var o=this._isSuperSlider(t);s.set("isSuperSlider",o),this.model.set("isSuperSlider",o);var n=void 0;if(this.model.get("isNeedAdjacCard")&&!s.get("isSuperSlider")&&this._isNotAllowedInNonOrganicCard(t)){var r=!1;if(zo.getOrganicCard()&&(n=this.createVideoCardPlaceHolder(e),s.set("adjacCardPlacement",this.model.get("adjacCardPlacement")),s.set("isNeedAdjacCard",!0),this.organicCardInjector=new Mo(this.model),r=this.organicCardInjector.injectOrganicCard("#"+n)),0==r)return this.model.set("organicInjectorFail",!0),void this.overKill("organic card injection fail")}else n=this.createVideoCardPlaceHolder(e);s.set("width",Ho("#"+n).width()),s.set("cardNumber",e.cardNumber-.5),s.set("subAdId",n),s.set("subUnitId",this.controllersArray.length),s.set("isOpenFloatingViewInViewPort",this.model.get("isOpenFloatingViewInViewPort")),i&&(s.set("isCardBelongToTempAd",!0),s.set("tempAdCondition",this.tempActiveAdCondition),s.set("isOpenInViewPort",!1)),this.log.info("newModel",s.get("tempAdCondition"));var a=new Is({model:s,globalModel:this.model,container:"#"+n,ad:t});this.controllersArray.push(a),this.tempActiveAd&&setTimeout(function(){this.tempActiveAd=void 0}.bind(this))}}_isSuperSlider(e){return!!this.isSuperSlider&&(!zo.isSliderCutOffEnabled(this.model,e.adData)||!!(e&&e.vpaidData&&e.vpaidData.allowSlider))}_isNotAllowedInNonOrganicCard(e){return!(e&&e.vpaidWrapper&&e.vpaidWrapper.tag&&e.vpaidWrapper.tag.getValueByKey&&e.vpaidWrapper.tag.getValueByKey("nbladnoorgnc"))}_getSCMitigatorCardOptions(){this.model.set("rv0PlayOnFurtherCard",!0);var e=this.model.get("cardNumForRV0"),t=this.cardLocator.getSpecificCard(e,!1);return this.model.set("rv0PlayOnFurtherCard",!1),t}_getCard(e){if(this._isGettingNewCardAvailable()){var t;this.firstCardCalled=!0,this.log.info("Requesting New Card, Reason: "+e),this.isOpenInViewPortChange=!1,this.model.get("isOpenMP4OutOfViewPort")&&(this.model.get("detachToSlider.isStartFromSlider")||this.model.get("isEligibleToPlayFirstTime")||!this.model.get("mp4Predict")||(this.log.info("MP4 Predict - card open out of view"),this.isOpenInViewPort=this.model.get("isOpenInViewPort"),this.model.set("isOpenInViewPort",!1),this.model.set("isOpenFloatingViewInViewPort",!1),this.isOpenInViewPortChange=!0));var i,s,o=this._peekNextAd()||this.model.peekNextSliderCutOffAd();if(o&&!zo.isEmpty(o)&&!o.rv&&this.model.get("SCMitigationFlow")&&this._isSCMitigationAllowed())o.inSCMitigationFlow=!0,t=this._getSCMitigatorCardOptions(),this._logToElasticLogger(o,"RV0 SC Mitigation: card: ".concat(null===(i=t)||void 0===i?void 0:i.cardNumber,", desiredCard: ").concat(this.model.get("cardNumForRV0")),vt.b.INFO,{cardNumber:null===(s=t)||void 0===s?void 0:s.cardNumber});else if(this.model.get("videoReelCompensation")&&cmTag.config.isVidReelPlaying){var n=this.model.get("cardNumberVR")||2;t=this.cardLocator.getSpecificCard(n,!1)}else if(this.model.get("isNeedAdjacCard")&&!this.hadAdjac)t=this.cardLocator.getSpecificCard(this.model.get("adjacCardPlacement"));else if(zo.isSliderCutOffEnabled(this.model,o&&o.adData)&&!this._isSuperSlider(o)){var r=this.model.get("sliderCutOffDefaultCard"),a=this.model.get("isSuperSlider")||o&&o.adData&&o.adData.mty===S.z.MEDIA_TYPE.VPAID;this._logToElasticLogger(o,"Slider cut off",vt.b.INFO,{card:r,isForce:a,event:"search for specific card"}),this.model.get("detachToSlider.isStartFromSlider")&&this.model.set("isEligibleToPlay",!1),t=this.cardLocator.getSpecificCard(r,a)}else this.model.get("isSliderClosed")?this.model.get("isNeedHipCard")?t=this.cardLocator.getSpecificCard(this.model.get("hipCardPlacement")):(t=this.cardLocator.getCard({onceOutOfView:!0}),this.model.set("isSliderClosed",!1)):t=this.cardLocator.getCard();t?this._onCardReturn(t):this._waitForCard(),this.isOpenInViewPortChange&&(this.model.set("isOpenInViewPort",this.isOpenInViewPort),this.model.set("isOpenFloatingViewInViewPort",this.isOpenInViewPort))}}_logToElasticLogger(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vt.b.INFO,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.elasticLogger&&e&&t&&(s.adId=e?e.adId:-1,this.elasticLogger.log({message:t,severity:i,extraData:s}))}_isGettingNewCardAvailable(){if(!this.isWaitingForCard)return this._hasViableSubUnits()?(this.log.info("Has Viable SubUnits, don't get cards"),!1):this.controllersArray.length===this.model.get("maxVideoCards")?(this.log.info("Max number of cards reached , don't get cards "),!1):this.model.get("hasReadyAd")||this.tempActiveAd?!this.model.get("isSliderOn")||!this.firstCardCalled||(this.log.info("Slider is active, don't get cards "),!1):(this.log.info("Don't have ready ads, don't get cards "),!1);this.log.info("Waiting for card, don't get cards")}_waitForCard(){this.log.info("No Card available waiting for card"),this.isWaitingForCard=!0,this.createStateHandlers([{event:"hasValidCard",funcName:"_onNewCardAvailable",isListenOnce:!0}])}_onCardReturn(e){this.videoCardIniOptions=e;var t=this.model.peekNextAd()||this.model.peekNextSliderCutOffAd();if(this.model.get("isNeedAdjacCard")&&!this.hadAdjac){if(e.cardNumber!==this.model.get("adjacCardPlacement"))return void this._getCard("card found but need Adjac");this.hadAdjac=!0,this._disableStickyForSession()}else if(this.model.get("isNeedHipCard")){if(e.cardNumber!==this.model.get("hipCardPlacement"))return void this._getCard("card found but need hip")}else if(zo.isSliderCutOffEnabled(this.model,t&&t.adData)&&t&&t.vpaidData&&!t.vpaidData.allowSlider){var i=this.model.get("sliderCutOffDefaultCard"),s=e.cardNumber===i;if(this._logToElasticLogger(t,"Slider cut off",s?vt.b.INFO:vt.b.WARNING,{requiredCard:i,foundCard:e.cardNumber,event:"found ".concat(s?"valid":"wrong"," card")}),!s)return void this._getCard("card found but need slider cut off default card")}if(this.isWaitingForCard=!1,this.log.info("Got New Card",e),!this._hasViableSubUnits())if(this.tempActiveAd)this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView.extractAd(),this.createSubFeedController(e,this.tempActiveAd,!0);else{var o=this.getReadyAd()||this.model.getNextSliderCutOffAd();o&&this.createSubFeedController(e,o)}}newAdLoaded(){this.log.info("newAdLoaded")}_onNewCardAvailable(){this.log.info("newCardAvailable");var e=this.cardLocator.getCard({cardNumber:this.model.get("hasValidCard")});this._onCardReturn(e)}createSubModel(){return Ho.extend(!0,{},this.model)}getSubModel(){return Ho.extend(!0,{},this.initialModel)}addNewSub(){setTimeout(function(){this.createSubFeedController(),this.addNewSub()}.bind(this),4e4)}_bindEvents(){this.createStateHandlers([{event:"subAdsEligibility",funcName:"subAdsEligibilityChange"},{event:["hasReadyAd:true","blockedByExternalUnit:false"],funcName:"onHasReadyAd"},{event:"closeState",funcName:"_closeStateChange"},{event:"loadingViewState:clicked",funcName:"_onLoadingClick"},{event:"topParentSelectorLost:true",funcName:"_onParentSelectorLost"},{event:"feedxToggle",funcName:"_onFeedContainerChanged"},{event:"feedContainerChanged",funcName:"_onFeedContainerChanged"},{event:"exploreMore",funcName:"_onExploreMore"},{event:"resetFeedVideo",funcName:"_onVideoReset"},{event:"crossUnitInfo",funcName:"_crossUnitInfo"}]),"undefined"!=typeof TRC&&TRC.listen&&(TRC.listen("trcReset",this._onTRCReset.bind(this)),TRC.listen("videoReset",this._onVideoReset.bind(this))),this.isSuperSlider&&this.createStateHandlers([{event:"isSuperSliderClosed:true",funcName:"_SuperSliderClose",listenOnce:!0}])}_closeStateChange(){this.log.warning("CloseState changed to: ",this.model.get("closeState")),this.model.get("closeState")===j.Z.closeState.terminate?this.adService?this.adService.close():this.model.set("closeState",j.Z.closeState.adManagerStop):this.model.get("closeState")===j.Z.closeState.adManagerStop&&this.playerService&&(this.playerService.close(),this.model.off(),Wo.off())}onHasReadyAd(){if(this.log.info("onHasReadyAd"),!this.model.get("isDetectPubVideo")||this.pubVidDetector&&!this.pubVidDetector.isPubVideoInView()){if(this._shouldDelayGetCardOnSliderCutOff()){var e=this._peekNextAd();return this._logToElasticLogger(e,"Slider cut off",vt.b.INFO,{event:"delay get card"}),this.model.setNextSliderCutOffAd(this._peekNextAd()),void this.createStateHandlers([{event:"adState:".concat(j.Z.adState.completed),funcName:"onHasReadyAd",listenOnce:!0}])}this._getCard("on Ad Impression")}else this.model.increaseCounter("adWaitForPubVideoToStop"),Wo.once("window:scroll:change",(()=>{this.onHasReadyAd()}))}_shouldDelayGetCardOnSliderCutOff(){if(!this.model.get("isSliderCutOff"))return!1;if(this.model.get("adState")!==j.Z.adState.playing)return!1;var e=this._peekNextAd();return!(!e||!zo.isSliderCutOffEnabled(this.model,e))}createVideoCardPlaceHolder(e){var t=Ho("<div>");this.isSuperSlider?this.isSuperSlider=!1:(t.addClass("tbl-feed-card"),t.addClass("cm-video-card"));var i=.5;"before"===e.insert&&(i=-.5);var s=e.cardNumber+i,o=("cm_place_holder_"+s).replace(".","");return t.attr("id",o),t.attr("data-card-index",s),!this.model.get("isForceFullContainerWidth")&&this.model.get("exploreMore")||t.css({width:"100%"}),Ho(e.cardElement)[e.insert](t),this._isSubUnitTypeMidArticleAsFeed()&&(t.css({}),t.addClass("mid-article-as-feed")),o}getReadyAd(){if(this.model.get("hasReadyAd"))return this.model.getNextAd()}_peekNextAd(){if(this.model.get("hasReadyAd"))return this.model.peekNextAd()}pause(e){"secondsToCloseGlobal"===e&&this.model.get("isReplayAd")&&this.model.set("isReasonSecondsToCloseGlobal",!0),this.log.info("Pause Timer reason: "+e+" Cards Number: "+this.controllersArray.length),this.adsManager&&this.adsManager.pauseGetAds();for(var t=0;t<this.controllersArray.length;t++)this.controllersArray[t].pause(e);this._setTimerReason(e)}terminate(e,t){this.log.info("Terminate reason: "+t);for(var i=0;i<this.controllersArray.length;i++)this.controllersArray[i].terminate(e,t);this.model.set("closeState",j.Z.closeState.terminate),this._setTimerReason(t)}overKill(e){this.log.info("overKill reason: "+e),this.adsManager.pauseGetAds(),this.playerService.playerDiv&&this.playerService.playerDiv.hide();for(var t=0;t<this.controllersArray.length;t++)this.controllersArray[t].overKill(e);this.model.set("closeState",j.Z.closeState.terminate),this.model.set("getAdState",j.Z.getAdState.stopped),this._setTimerReason(e),this.model.off(),this.secondsToCloseGlobalTimer&&this.secondsToCloseGlobalTimer.stop(this.model,"",{},!0)}_isSubUnitTypeMidArticleAsFeed(){return this.model.get("subUnitType")===S.z.SUB_UNIT_TYPE.MID_ARTICLE_AS_FEED}_removeCardForDemo(){if(this.model.get("isCloseScOnConversion")){var e=document.getElementsByClassName("trc-content-sponsored");e.length>0&&(e[e.length-1].parentElement.parentElement.parentElement.style.display="none")}}_setTimerReason(e){this.model.get("closeTimer")===e?this.model.trigger("change:closeTimer",this.model,e):this.model.set("closeTimer",e)}_onTRCReset(){this.overKill("TRCReset"),this._resetFmOnPage()}_onVideoReset(){this.overKill("videoReset"),this._resetFmOnPage()}_onParentSelectorLost(){this.overKill("parentSelectorLost"),this._resetFmOnPage()}_resetFmOnPage(){setTimeout(function(){this.model.off(),window.isCmTagFMOnPage=!1}.bind(this),500)}_setSubUnitType(){var e={isMidArticle:this.model.get("midArticleAsFeed"),isSticky:this.model.get("stickyCard.isActive"),isDetachBelow:this.model.get("detachToSlider.isDetachBelow"),isDetachAbove:this.model.get("detachToSlider.isDetachAbove"),isStartFromSlider:this.model.get("detachToSlider.isStartFromSlider"),isDetachToSlider:this.model.get("detachToSlider.isDetachToSlider")};this.model.set("subUnitType",zo.getSubUnitType(e))}_addStyleToHeader(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode("#_cm-css-reset._cm-ad video { visibility: hidden !important; }")),e.appendChild(t)}_SuperSliderClose(){this.closedSuperSliderController=this.controllersArray.splice(0,1)[0]}_setIniModelToNoslider(){this.model.get("stickyCard.isActive")&&!this.model.get("stickyCard.restrictions.isFirstCardOnly")||(this.initialModel.set("detachToSlider.isStartFromSlider",!1),this.initialModel.set("detachToSlider.isDetachToSlider",!1))}_onTempAdOutOffView(){this.log.info("_onTempAdOutOffView"),this.model.set("elementOutOfView",!1);var e=this._isFutureCardExist();!0===e.createNewCard?this._getCard("continueToPlayInNexCard"):(0===e.futureCardIndex||e.futureCardIndex)&&(this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView.extractAd(this.tempActiveAdCondition),this.controllersArray[e.futureCardIndex].videoView.injectAd(this.tempActiveAd,this.tempActiveAdCondition),this.log.info("@Opp fire _onCardReturn rv:",this.tempActiveAd))}_isContinuaPLayAdInNextCard(){return this.log.info("lastCardOutOfViewport: ",this.model.get("lastCardOutOfViewport")),!(0!==this.model.get("lastCardOutOfViewport")&&!this.model.get("lastCardOutOfViewport"))&&this._isActiveAdPassesCondition()}_isActiveAdPassesCondition(){var e=this._getTempActiveAd();if(!e)return!1;if(!e.isPWOV()){var t=this._getCondition(e);if(!t)return!1;this.log.info("!!!_isActiveAdPassesCondition",t);var i=this._checkAdCondition(e,t);return i?(this.tempActiveAd=e,this.tempActiveAdCondition=t):(this.tempActiveAd=void 0,this.tempActiveAdCondition=void 0),this.log.info("!!!_isActiveAdPassesCondition isPassesCondition",i),this.log.info("!!!_isActiveAdPassesCondition tempActiveAd",this.tempActiveAd),this.log.info("!!!_isActiveAdPassesCondition tempActiveAdCondition",this.tempActiveAdCondition),i}}_getCondition(e){var t=e.adData.requiredViewability?[1]:[0];e.vpaidWrapper.isCPCV&&t.push("CPCV");for(var i=null,s=0;s<t.length;s++)if(i=this.model.get("continueToPlayInNexCard")[t[s]]?this.model.get("continueToPlayInNexCard")[t[s]]:i,"completion"==this.model.get("continueToPlayInNexCard")[t[s]])return"completion";return i}_isFutureCardExist(){var e={futureCardIndex:void 0,createNewCard:!1};this.log.info("!!!@@@ lastCardOutOfViewport",this.model.get("lastCardOutOfViewport"));var t=this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView.getEl().getBoundingClientRect().top>0;if(t&&0===this.model.get("lastCardOutOfViewport"))return e;if(!t){for(var i=this.model.get("lastCardOutOfViewport");i<this.controllersArray.length;i++)if(!this.controllersArray[i].videoView.getActiveAd()&&this.controllersArray[i].videoView.getModel().get("isCardBelongToTempAd"))return e.futureCardIndex=i,e;return e.createNewCard=!0,e}for(var s=this.model.get("lastCardOutOfViewport")-1;s>-1;s--)if(!this.controllersArray[s].videoView.getActiveAd()&&this.controllersArray[s].videoView.getModel().get("isCardBelongToTempAd"))return e.futureCardIndex=s,e;return e}_checkAdCondition(e,t){return this.log.info("!!!_checkAdCondition condition:",t),this.log.info("!!!_checkAdCondition isViewabilityFired",e.isViewabilityFired),"viewability"!==t||!e.isViewabilityFired}_getTempActiveAd(){var e=this.model.get("lastCardOutOfViewport");if(this.log.info("check if posible temp ad",e),e&&this.controllersArray[e]&&this.controllersArray[e].videoView)return this.controllersArray[e].videoView.getActiveAd()}_onAdCondition(){this.log.info("add condition done");for(var e=0;e<this.controllersArray.length;e++)this.controllersArray[e].videoView.getModel().get("isCardBelongToTempAd")&&this.controllersArray[e].videoView.onTempAdEnd();this.model.set("temAdCondition",!1),this.tempActiveAd=void 0}_onFeedContainerChanged(){this.playerService.updatePlacement(),this.model.set("hasValidCard",void 0,{silent:!0}),this._closeHiddenFeedSubUnits(),this.cardLocator.updateFeedSelector(),this.model.set("subAdsEligibility",{},{silent:!0}),this.model.set("isSliderClosed",!1,{silent:!0}),this.isWaitingForCard=!1,this.firstCardCalled=!1,this._getCard("feedContainerChanged")}_closeHiddenFeedSubUnits(){this.closedSuperSliderController&&this.closedSuperSliderController.terminateOnContainerChange();for(var e=0;e<this.controllersArray.length;e++){var t=this.controllersArray[e],i=t.model.get("closeState"),s=t.parentSelector!==this.model.get("parentSelector");!i&&s&&t.terminateOnContainerChange()}}_triggerPassback(){this.model.get("isFirstAdLoaded")||(this.log.info("Passback timer done"),Wo.trigger("global:passback",{isApiPassbackExist:this.model.get("isApiPassbackExist")}),this.model.set("closeState",j.Z.closeState.terminate))}_disableStickyForSession(){this.model.set("detachToSlider.isDetachToSlider",!1),this.model.set("isSliderOn",!1),this.model.set("stickyCard.restrictions.sessionNotAllowed",!0)}_updateModels(e,t){this.model.set(e,t),this.initialModel.set(e,t)}_onExploreMore(){this.model.get("stickyCard.isActive")||(this._updateModels("detachToSlider.isStartFromSlider",!1),this._updateModels("detachToSlider.isDetachToSlider",!1)),this._updateModels("isEligibleToStick",!1)}_startDelayedServices(){this.seerService||(this.seerService=new _o({model:this.model,onPredictCallback:this.adsManager.adPredict.bind(this.adsManager)}))}_crossUnitInfo(){this.model.get("crossUnitInfo")&&this.model.get("crossUnitInfo.state")===j.Z.externalUnit.playing?this._blockedByExternalUnit():this._resumeByExternalUnit()}_blockedByExternalUnit(){this._updateModels("blockedByExternalUnit",!0),this._updateControllersModels("blockedByExternalUnit",!0)}_resumeByExternalUnit(){this._updateModels("blockedByExternalUnit",!1),this._updateControllersModels("blockedByExternalUnit",!1)}_updateControllersModels(e,t){for(var i=0;i<this.controllersArray.length;i++)this.controllersArray[i].model.set(e,t)}}const Zo=$o;var Go=o(316),qo=o(999);const Yo=Go.DeepModel.extend({STATE:{READY:0,GOT_AD:1,PLAYING:2,PAUSED:3,PAUSED_BY_USER:4,STOPPED_BY_USER:5,DETACHED:6,ATTACHED:7,DONE:8,PLAYER_READY:9,PLAYER_CLOSE:10,PLAYER_STOP:11,AD_STOPPED:12,OPT_OUT:13,OPEN_WITH_PAUSE:14,WAITING_FOR_EXPAND:15,REPEAT_STAND_BY:16,REPEAT_SPINNING:17,SKIPPED_BY_USER:18},defaults:{isDebug:!1},storage:{},initialize:function(){this.log=new y.Z({unitType:this.get("unitType"),className:"BaseUnitModel",version:this.get("version"),isDebug:this.get("isDebug")}),this._parseFrameType();var e=this.get("demo");e&&this.set("preset.demo",e),this.get("isDebug")&&this.set("preset.isDebug",1);var t=this.get("isFireAllPixels");t&&this.set("preset.isFireAllPixels",t);var i=this.get("predictorsPresets");i&&this.set("preset.predictorsPresets",i);var s=this._getSettingsByConditions();this.set(s.preset);var o=this._getPresets(Ne.Z.pms);for(var n in this.log.info("Presets Settings: ",[o.weakerThenSetByCon,o.strongerThenSetByCon]),o.weakerThenSetByCon)this.set(o.weakerThenSetByCon[n].presetData);for(var r in this.set(s.settings),o.strongerThenSetByCon)this.set(o.strongerThenSetByCon[r].presetData);this._setUrlParameters(),this._processPushArray(),this.get("baseReport")&&this.get("oppsBasePath)")&&this.set("oppsBasePath",this.get("baseReport")),this.set("isUseObserverChanged",!1),this.get("isUseObserver")&&!qo.isObserverSupported("IntersectionObserver",this.get("isUseNonNativeObserver"))&&(this.set("isUseObserver",!1),this.set("isUseObserverChanged",!0)),this.get("isUseObserverForCardLocator")&&!qo.isObserverSupported("IntersectionObserver",this.get("isUseNonNativeObserver"))&&this.set("isUseObserverForCardLocator",!1),this.volume=this.get("volume"),this.set("volume","off"),this._bindEvents(),this.log.info("unit model created:",this.attributes),this._handleABTest(),this._handleLiteUnitPixels(),(this.get("isApiPassbackExist")||this.get("onPassback"))&&(this.set("dlywf",!1),this.set("player.settings.rvfrquesttsemttr","any")),"body"===String(this.get("videoContainerSelector")).toLowerCase()&&this.set("videoContainerSelector",!1),this._setQueriesFunctions(),this._setCrossUnitCommunication(),this.get("isChangePredictPointsWithAny")&&this._changeAnyToZeroInPredictors(),this.get("disableAttachWhenStartFromSlider")&&this._decideSuperSlider(),!0===this.get("isGetRv1OnlyForEligible")&&(this.set("isGetRv1OnlyForEligible.isActive",!0),this.set("isGetRv1OnlyForEligible.delayPrediction",!0))},get(e){var t=Go.DeepModel.prototype.get.call(this,e);if(!t||"string"!=typeof t)return t;for(var i=t.match(/\{\{(.*?)\}\}/g);i;){for(var s=0;s<i.length;s++){var o=i[s].substr(2,i[s].length-4),n=Go.DeepModel.prototype.get.call(this,o);n||(n=""),t=t.replace(i[s],n)}i=t.match(/\{\{(.*?)\}\}/g)}return t},_setQueriesFunctions(){qo.forEach(S.z.UNIT_QUERY_LANGUAGE.SUPPORTED_CONFIG_FLAGS,(e=>{var t=this.get("".concat(e,".restrictions"));qo.forEach(t,((t,i,s)=>{var o="".concat(e,".restrictions.").concat(i),n=this.get("".concat(o,".queries"));if(n){var r=this.get("".concat(o,".default"));r=qo.isBoolean(r)?r:'"'.concat(r,'"');var a=this._getQueryFunction(n,r);this.set("".concat(o,".decisionFunction"),a)}}))}))},_getQueryFunction(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i="";qo.forEach(e,(e=>{i+=this._getQueryIfStatment(e)})),t=void 0!==t?"return ".concat(t,";"):"";var s="".concat(i,"\n").concat(t);return new Function("model","activeAd",s)},_getQueryIfStatment(e){var t=e.rule,i=e.valueIfTrue;return i=qo.isBoolean(i)?i:'"'.concat(i,'"'),qo.forEach(S.z.UNIT_QUERY_LANGUAGE.MAPPING,(e=>{t=t.split(e.search).join(e.replaceWith)}),this),"if(".concat(t,"){return ").concat(i,"};\n")},getPixel:function(e){!this.pixel&&this._createPixel();var t=this.get(e);if("pixels.conversion"===e&&Go.trigger("global:creativeEvent",{type:"conversion"}),t&&t.isFire)return this.pixel({type:t.type||"",pixelId:t.id,timestamp:Date.now(),subUnit:this.get("subUnitType")})},_createPixel:function(){var e=this.get("pixels.url")+"?cijs=convusmp&ttype={{type}}&cisd=convusmp&cipid="+this.get("cipid")+"&crid="+this.get("creativeId")+"&dast="+this.get("dast")+"&cmcv=&pix={{pixelId}}&cb={{timestamp}}&uv="+this.get("unitVersion")+"&tms={{timestamp}}&su={{subUnit}}";this.get("abTest")&&(e+="&abt="+this.get("abTest")),this.get("referrerUrl")&&(e+="&ru="+this.get("referrerUrl")),e+="&ft="+this.get("frameType"),e=this._addPixelParameter("tagCpmFloor","cft",e),e=this._addPixelParameter("unitId","blid",e),e=this._addPixelParameter("unitName","unm",e),e=this._addPixelParameter("debugKey1","dk1",e),e=this._addPixelParameter("debugKey2","dk2",e),e=this._addPixelParameter("order","order",e),this.pixel=qo.template(e)},_addPixelParameter:function(e,t,i){return(this.get(e)||0===this.get(e)||!1===this.get(e))&&(i+="&"+t+"="+this.get(e)),i},getImpressionPixel:function(){this.get("player.isFire99")},_getSchedule:function(e,t,i){return{roll_type:e,url:this.get("player.urls.vpaidLocation"),volume:"on"===this.get("volume")?100:0,mute:"on"!==this.get("volume"),oid:this.get("originId"),mfp:this.get("mfp"),sortOrderType:this.get("sortOrderType"),ad_parameters:JSON.stringify(this.get("demandConfig")),pubid:t,tagid:i,defaultTagTimeout:this.get("defaultTagTimeout"),totaltimeout:this.get("totalTimeout"),noaop:this.get("noaop"),skip_vast:!0}},_handleABTest:function(){if(this.get("abTest")&&this.get("pixels.startWithABT.isFire")){window.cmTag.customDataForTest.startWithABT=!0;var e={debug:"pn:!sqg:!torgn:"+(window.performance.timeOrigin?window.performance.timeOrigin:"")+"!ts:"+Date.now()};qo.firePixel(this.getPixel("pixels.startWithABT"),"AB Test started",e)}},_handleLiteUnitPixels:function(){this.get("isFirePixel")&&(qo.firePixel(this.getPixel("pixels.unitLoaded"),"Unit loaded from lite unit",{mntl:this.get("preset.level")}),qo.firePixel(this.getPixel("pixels.unitLoadedWithFill"),"Unit loaded from lite unit with fill"))},_processPushArray:function(){var e=this.get("pushedArr")||[];"FEED_MANAGER"!==this.get("unitType")&&"INLINE_FEED"!==this.get("unitType")&&"MSN_WIDGET"!==this.get("unitType")&&"WIDGET_ITEM"!==this.get("unitType")||this._setFeedManagerSubType(e);var t={};if(e)for(var i in e.forEach((e=>{var i=Object.keys(e)[0];t[i]||(t[i]=[]),t[i].push(e[i])})),t){var s=t[i],o=this.get(i);o&&s.push(o);var n=s.sort().join("!");this.set(i,n)}},_setFeedManagerSubType(e){var t=this.get("stickyCard.isActive"),i=this.get("detachToSlider.isDetachBelow"),s=this.get("detachToSlider.isDetachAbove"),o=this.get("detachToSlider.isStartFromSlider"),n=this.get("detachToSlider.isDetachToSlider"),r="ufm";t||o||n?t||!o||n?t||o||!n?!t&&o&&n?r+="_vD":t&&i&&!s?r+="_vE":t&&!i&&s?r+="_vF":t&&i&&s&&(r+="_vG"):r+="_vC":r+="_vB":r+="_vA",e.push({abTest:r})},_removeSoundOnHover(){var e,t=this.get("wurfl.browser.name").toLowerCase(),i=this.get("wurfl.browser.version"),s=this.get("noSoundBrowsers");s&&s[t]&&(e=s[t].minVersion),i>=e&&this.set("volume","off")},setStorage(e,t){this.storage[e]=t},getStorage(e){return this.storage[e]},setNextAd(e){this.setStorage("nextAd",e)},setNextSliderCutOffAd(e){this.setStorage("nextSliderCutOffAd",e)},getNextSliderCutOffAd(){var e=this.getStorage("nextSliderCutOffAd");return this.setNextSliderCutOffAd(void 0),e},peekNextSliderCutOffAd(){return this.getStorage("nextSliderCutOffAd")},getNextAd(){var e=this.getStorage("nextAd");return e&&(this.log.info("NEXT AD TYPE = "+parseInt(e.adData.requiredViewability?"1":"0"),e),e.isUsed=!0),this.setStorage("nextAd",void 0),setTimeout(this.set.bind(this,"hasReadyAd",!1),0),e},getNextAdRv(){var e=this.getStorage("nextAd");if(e)return e.adData.requiredViewability},peekNextAd(){return this.getStorage("nextAd")},_bindEvents(){this.on("change:getAdState",this._onAdImpression)},_onAdImpression(){"gotAd"!==this.get("getAdState")||this._gotAd||(this.log.info("Triggering filledImpression event."),Go.trigger("filledImpression",{lineItemId:this.get("lineItemId"),placement:this.get("placement"),redId:this.get("redId")}),this._gotAd=!0)},_setUrlParameters(){for(var e,t,i,s=this._getWindow(),o=s.location.href.slice(s.location.href.indexOf("?")+1).split("&"),n=0;n<o.length;n++)0===(t=(e=o[n].split("="))[0]).indexOf("cm_")&&(t=t.slice(3),i=decodeURIComponent(e[1]),this.set(t,i))},_getWindow(){var e=this.get("isStayInIframe"),t=this.get("iframeData");return!0===e&&qo.isInFriendlyIframe(t)||!qo.getTopWindow?window:qo.getTopWindow()},_getPresets(e){var t={strongerThenSetByCon:[],weakerThenSetByCon:[]},i=this.get("isMobile")?"Mobile":"Desktop";for(var s in this.get("preset")){var o=e.getPreset({key:s,value:this.get("preset.".concat(s)),unitType:this.get("unitName"),platform:i});o&&(o.strength>100?t.strongerThenSetByCon.push(o):t.weakerThenSetByCon.push(o))}return t.strongerThenSetByCon=qo.sortBy(t.strongerThenSetByCon,"strength"),t.weakerThenSetByCon=qo.sortBy(t.weakerThenSetByCon,"strength"),t},increaseCounter(e){var t=this.get(e);t?t++:t=1,this.set(e,t)},decreaseCounter(e){var t=this.get(e);!t||t<=0||(t--,this.set(e,t))},_parseFrameType(){var e=S.z.FRAME_TYPE.plainPage;void 0!==window.taboolaMobile?e=S.z.FRAME_TYPE.inApp:window.TRC&&window.TRC.isAMP?e=S.z.FRAME_TYPE.amp:qo.isInIframe(this.get("iframeData"))&&(e=qo.isInFriendlyIframe(this.get("iframeData"))?S.z.FRAME_TYPE.friendlyIframe:S.z.FRAME_TYPE.nonFriendlyIframe),this.set("frameType",e),this.set("player.settings.frameType",e)},_getSettingsByConditions(){var e={preset:{},settings:{}},t=this.get("settingsByConditions");if(t&&t.length>0)for(var i=0;i<t.length;i++){var s=t[i].conditions,o=t[i].settings;if(this._checkConditions(s))for(var n in o)-1!==n.indexOf("preset")?e.preset[n]=o[n]:e.settings[n]=o[n]}return e},_checkConditions(e){for(var t=!0,i=0;i<e.length;i++)if(e[i].func)e[i].func(this)||(t=!1);else if(e[i].val&&"function"==typeof e[i].val){var s=e[i].val(this);this.get(e[i].key)!==s&&(t=!1)}else this.get(e[i].key)!==e[i].val&&(t=!1);return t},fireUnitDelayedPixel(){qo.firePixel(this.getPixel("pixels.unitDelayed"),"unit delayed")},fireUnitLoadAfterDelayPixel(){qo.firePixel(this.getPixel("pixels.unitLoadAfterDelay"),"unit delayed")},isLoadcomponent(e,t){return this.get("displayFiller."+t)===e},appendArray(e,t,i){var s=this.get(e);qo.isArray(s)||(s=[]),i&&s.includes(t)||(s.push(t),this.set(e,s))},handleAutoPlayData(e){this.log.info("autoplayDetector returned",e),this.set("AutoPlayDetectorData",e),e&&e.unmuted&&e.unmuted.supported?(this.set("volume",this.volume),this.set("autoplaySoundOn",!0)):(this.set("volume","off"),this.set("autoplaySoundOn",!1)),this.log.info("Unit set volume to: ",this.get("volume"))},_setStickyCardParams:function(){this.set("detachToSlider.isDetachAbove",!1),this.set("detachToSlider.isDetachBelow",!0),this.set("detachToSlider.isDetachToSlider",!0),this.set("detachToSlider.isStartFromSlider",!1),this.set("animation.detach",this.get("stickyCard.detachAnimationTime"))},_setCrossUnitCommunication(){if(this.get("isUseCrossUnitCommunication")){if(0===document.querySelectorAll("._cm-communication-input").length){var e=document.createElement("div");e.className="_cm-communication-input",e.setAttribute("data-unit-info",""),document.querySelector("body").appendChild(e)}this._observeCrossUnitCommunication()}},_observeCrossUnitCommunication(){if(this.get("isObserveCrossUnitCommunication")){var e=document.querySelector("._cm-communication-input");this.crossUnitCommunicatioObserver=new MutationObserver(this._updateCrossUnitData.bind(this)),this.crossUnitCommunicatioObserver.observe(e,{attributes:!0,childList:!1,subtree:!1}),this.on("closeState:".concat(j.Z.closeState.terminate),this._stopCrossUnitCommunicationObserver),this._updateCrossUnitData()}},_updateCrossUnitCommunication(e){this.get("isUseCrossUnitCommunication")&&this.get("isUpdateCrossUnitCommunication")&&document.querySelector("._cm-communication-input").setAttribute("data-cross-unit-info",JSON.stringify(e))},_updateCrossUnitData(e,t){var i=document.querySelector("._cm-communication-input").dataset.crossUnitInfo;i&&i.unit!==this.get("unitType")&&this.set("crossUnitInfo",JSON.parse(i))},_stopCrossUnitCommunicationObserver(){this.crossUnitCommunicatioObserver.disconnect()},fireCancelGetAdOnEligibilityLost(){qo.firePixel(this.getPixel("pixels.cancelGetAdOnEligibilityLost"),"cancel GetAd on EligibilityLost")},_changeAnyToZeroInPredictors(){var e=this.get("predictors");e&&(Object.keys(e).forEach((t=>{var i=e[t].predictPoints,s=e[t].predictPoint,o=e[t].allowedPredictPoints;i&&(e[t].predictPoints=this._validateAndChangePredictPointsIfAny(i)),o&&(e[t].allowedPredictPoints=this._validateAndChangePredictPointsIfAny(o)),s&&(e[t].predictPoint=this._validateAndChangePredictPointsIfAny(s))})),this.set("predictors",{}),this.set("predictors",e))},_validateAndChangePredictPointsIfAny:e=>"string"==typeof e&&"any"===e.toLowerCase()?0:e,_decideSuperSlider(){this.get("detachToSlider.isStartFromSlider")&&this.set("detachToSlider.isDetachToSlider",!0)}}),Ko=Yo.extend({initialize:function(){Yo.prototype.initialize.call(this),this.set("player.playlist",[{url:this.get("player.urls.blankLocation"),name:"Blank",title:"Blank",type:"video/mp4"}]),this.get("frameType")!==S.z.FRAME_TYPE.plainPage&&(window.taboolaBridge||(this.set("predictors.distancePixels.isActive",!1),this.set("predictors.distancePixels.isStartWF",!1)),this.set("predictors.distancePercent.isActive",!1),this.set("predictors.distancePercent.isStartWF",!1)),window.category=this.get("category")},getScheduleArr:function(){var e=[];return e.push(this._getSchedule("pre-roll",this.get("pubId"),this.get("pubTagId"))),e},_onContentLoad:function(){window.playlist.forEach((function(e,t,i){i[t].image=this.get("player.urls.contentImagesLocation")+"/"+e.image,i[t].title=e.title.replace(/([A-Z])/g,"$1").replace(/^./,(function(e){return e.toUpperCase()})),i[t].url=this.get("player.urls.organicContentVideosLocation")+"/"+i[t].filename,i[t].name=i[t].filename,i[t].type="video/mp4"}),this),this.set("player.playlist",window.playlist)},isVerticalVideoEnabled:function(e){return(e||this.get("videoPlaceholderSize.width"))<=this.get("verticalWidthThreshold")}});var Qo=o(999);const Xo=Ko.extend({initialize:function(){Ko.prototype.initialize.call(this),window.TRC&&!0===window.TRC.isAMP&&(this.set("detachToSlider.isDetachToSlider",!1),this.set("detachToSlider.isStartFromSlider",!1),this.set("feedCardElig.isActive",!0),this.set("stickyCard.restrictions.adPercent.percent",.1)),this.get("components.contentVideo.isActive")&&(window.category=this.get("category")||"entertainment",Qo.loadJs(this.get("player.urls.contentLocation"),this._onContentLoad.bind(this))),(this.get("detachToSlider.isStartFromSlider")||this.get("detachToSlider.isDetachToSlider"))&&this.set("stickyCard.isActive",!1),this.get("detachToSlider.isStartFromSlider")&&this.set("isRvPriority",!1),(this.get("detachToSlider.isStartFromSlider")||this.get("detachToSlider.isDetachToSlider")||this.get("permanentCard"))&&this.set("getCardMaxPPS",void 0),this.get("stickyCard.isActive")&&this._setStickyCardParams()}});var Jo=o(999),en=o(84);const tn=Ko.extend({initialize:function(){if(Ko.prototype.initialize.call(this),window.TRC&&!0===window.TRC.isAMP&&(this.set("isPlayerOutOfViewport",!1),this.set("feedCardElig.isActive",!0),this.set("stickyCard.restrictions.adPercent.percent",.1)),this.get("components.contentVideo.isActive")&&(window.category=this.get("category")||"entertainment",Jo.loadJs(this.get("player.urls.contentLocation"),this._onContentLoad.bind(this))),(this.get("detachToSlider.isStartFromSlider")||this.get("detachToSlider.isDetachToSlider"))&&this.set("stickyCard.isActive",!1),this.get("detachToSlider.isStartFromSlider")&&this.set("isRvPriority",!1),(this.get("detachToSlider.isStartFromSlider")||this.get("detachToSlider.isDetachToSlider")||this.get("permanentCard"))&&this.set("getCardMaxPPS",void 0),this.get("isCheckInAppPlayerSize")){var e=en(this.get("parentSelector")).width();this.set("width",e),this.set("height",Jo.getVideoHeight(e))}this.get("stickyCard.isActive")&&this._setStickyCardParams()}});window.startCMTagMain=function(e,t){var{isMobile:i=!1}=e;yt(e,t,{model:i?tn:Xo,unitController:Zo})}})()})();