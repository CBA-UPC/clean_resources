/*
 *  (c) 2000-2023 deviantART, Inc. All rights reserved.
 */
window.vms_feature||(window.vms_feature=,window.DWait&&DWait.run("jms/lib/vms_feature.js");

!function(n){var i=function(i,t,a){var e,r,o,d=(i||"").split("."),f=t||n;for(e=0,r=d.length;e<r;e++){if(o=d[e],"object"!=typeof f[o]){if(!a)return f[o];f[o]={}}f,f=f[o]}return f},t=function(n,t,a){var e=(n||"").split("."),r=e.pop(),o=i(e.join("."),a,!0);return t&&(o[r]=t),o},a=function(n,t,a){var e=i(n,a);return void 0===e?t:e};n.da=n.da||{},n.da.namespace=i,n.da.define=t,n.da.get=a}(window),window.DWait&&DWait.run("jms/lib/namespace.js");

function setBrowserObjectAttributes(){Browser.isKHTML=navigator.userAgent.indexOf("KHTML")>=0,Browser.isTrident=navigator.userAgent.indexOf("Trident")>=0,Browser.isWebkit=navigator.userAgent.indexOf("WebKit")>=0&&!Browser.isTrident,Browser.isGecko=!Browser.isKHTML&&"Gecko"==navigator.product,Browser.isChrome=Browser.isWebkit&&navigator.userAgent.indexOf("Chrome")>=0,Browser.isFirefox=Browser.isGecko&&navigator.userAgent.indexOf("Firefox")>=0,Browser.isSafari=!Browser.isChrome&&Browser.isWebkit&&navigator.userAgent.indexOf("Safari")>=0,Browser.isIE=!Browser.isGecko&&void 0!=navigator.cpuClass&&"Microsoft Internet Explorer"==navigator.appName,Browser.isOpera=navigator.userAgent.indexOf("Opera")>=0,Browser.isIE8=Browser.isIE&&navigator.userAgent.indexOf("MSIE 8")>=0,Browser.isIE9=Browser.isIE&&navigator.userAgent.indexOf("MSIE 9")>=0,Browser.isIE10=Browser.isIE&&navigator.userAgent.indexOf("MSIE 10")>=0,Browser.isIE11=null!==navigator.userAgent.match(/Trident\/7\.0.+rv:11\.0/),Browser.isIE11&&(Browser.isIE=!0),Browser.isWebkit&&(matches=navigator.userAgent.match(/WebKit\/(\d+\.\d+)/))&&(Browser.webkitVersion=parseFloat(matches[1])),Browser.isMac=navigator.appVersion.indexOf("Mac")>=0,Browser.isTux=navigator.appVersion.indexOf("Linux")>=0,Browser.isWin=navigator.appVersion.indexOf("Windows")>=0,Browser.isPhantom="callPhantom"in window,Browser.isTouch="ontouchstart"in window&&!Browser.isPhantom,Browser.isWindowsPhone=navigator.userAgent.indexOf("Windows Phone")>=0,Browser.isKindleFire=navigator.userAgent.indexOf("Silk")>=0,Browser.isAndroid=navigator.userAgent.indexOf("Android")>=0&&!Browser.isWindowsPhone&&!Browser.isKindleFire,Browser.isBB=navigator.userAgent.indexOf("BB10")>=0,Browser.isWebOS=navigator.userAgent.indexOf("webOS")>=0,Browser.isPhone=navigator.userAgent.indexOf("iPhone")>=0&&!Browser.isWindowsPhone,Browser.isPad=navigator.userAgent.indexOf("iPad")>=0,Browser.isPod=navigator.userAgent.indexOf("iPod")>=0,Browser.isIOS=Browser.isPhone||Browser.isPad||Browser.isPod,Browser.isMobile=Browser.isIOS||Browser.isAndroid||Browser.isBB||Browser.isWebOS||Browser.isWindowsPhone||Browser.isKindleFire,Browser.isSmallMobile=Browser.isMobile&&window.innerWidth<=667}Browser={},setBrowserObjectAttributes(),Browser.isTouch&&void 0===Browser.touchTested&&DWait.ready(".domready",function(){document.body.className+=" is_touch",Browser.touchTested=!0}),(Browser.isIE10||Browser.IE11)&&void 0===Browser.ieFixup&&DWait.ready(".domready",function(){document.body.className+=" ie gte10",Browser.ieFixup=!0}),window.DWait&&DWait.run("jms/lib/browser.js");

/**
 * @license
 * Base.js, version 1.1a
 * Copyright 2006-2010, Dean Edwards
 * License: http://www.opensource.org/licenses/mit-license.php
 */
window.console||(window.console={log:function(){},trace:function(){},info:function(){},warn:function(){}}),window.deviantART||(window.deviantART={}),window.Base=function(){},Base.extend=Base.prototype={extend:,Base=Base.extend({constructor:,{ancestor:Object,version:"1.1",forEach:implement:toString:),window.DWait&&DWait.run("jms/lib/Base.js");

Function.prototype.bind||(Function.prototype.bind=,window.DWait&&DWait.run("jms/lib/bind.js");

/**
 * @license
 * jQuery JavaScript Library v1.11.1
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-05-01T17:42Z
 */
!"undefined"!=typeof window?window:this,function(e,t){(){return!0}ush,K=J.indexOf,Z={},ee=Z.toString,te=Z.hasOwnProperty,ne={},re=ie=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,oe=/^-ms-/,ae=/-([\da-z])/gi,se=re.fn=re.prototype={jquery:"1.11.1",constructor:re,selector:"",length:0,toArray:get:pushStack:each:map:slice:first:last:eq:end:push:Q,sort:J.sort,splice:J.splice},re.extend=re.fn.extend=re.extend({expando:"jQuery"+("1.11.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:noop:function(){},isFunction:function(e){return"function"===re.type(e)},isArray:Array.isArray||isWindow:isNumeric:isEmptyObject:isPlainObject:type:globalEval:camelCase:nodeName:each:trim:makeArray:inArray:merge:grep:map:guid:1,proxy:now:support:ne}),re.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),;var le=function(e){,E,k,S,A,j,D,L,H,q,_,M,O,F="sizzle"+-new Date,B=e.document,W=0,P=0,R=n(),$=n(),z=n(),I=X="undefined",U=1<<31,V={}.hasOwnProperty,J=[],Y=J.pop,G=J.push,Q=J.push,K=J.slice,Z=J.indexOf||ee="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",te="[\\x20\\t\\r\\n\\f]",ne="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",re=ne.replace("w","w#"),ie="\\["+te+"*("+ne+")(?:"+te+"*([*^$|!~]?=)"+te+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+te+"*\\]",oe=":("+ne+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ie+")*)|.*)\\)|)",ae=new RegExp("^"+te+"+|((?:^|[^\\\\])(?:\\\\.)*)"+te+"+$","g"),se=new RegExp("^"+te+"*,"+te+"*"),le=new RegExp("^"+te+"*([>+~]|"+te+")"+te+"*"),ue=new RegExp("="+te+"*([^\\]'\"]*?)"+te+"*\\]","g"),ce=new RegExp(oe),fe=new RegExp("^"+re+"$"),de={ID:new RegExp("^#("+ne+")"),CLASS:new RegExp("^\\.("+ne+")"),TAG:new RegExp("^("+ne.replace("w","w*")+")"),ATTR:new RegExp("^"+ie),PSEUDO:new RegExp("^"+oe),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+te+"*(even|odd|(([+-]|)(\\d*)n|)"+te+"*(?:([+-]|)"+te+"*(\\d+)|))"+te+"*\\)|)","i"),bool:new RegExp("^(?:"+ee+")$","i"),needsContext:new RegExp("^"+te+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+te+"*((?:-\\d)?\\d*)"+te+"*\\)|)(?=[^-]|$)","i")},pe=/^(?:input|select|textarea|button)$/i,he=/^h\d$/i,me=/^[^{]+\{\s*\[native \w/,ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,ve=/'|\\/g,be=new RegExp("\\\\([\\da-f]{1,6}"+te+"?|("+te+")|.)","ig"),xe=try{Q.apply(J=K.call(B.childNodes),B.childNodes),J[B.childNodes.length].nodeType}catch(e){Q={apply:J.length?}b=t.support={},T=t.isXML=j=t.setDocument=t.matches=t.matchesSelector=t.contains=t.attr=t.error=t.uniqueSort=w=t.getText=x=t.selectors={cacheLength:50,createPseudo:r,match:de,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:CHILD:PSEUDO:,filter:{TAG:CLASS:ATTR:CHILD:PSEUDO:,pseudos:{not:r(,has:r(,contains:r(,lang:r(,target:root:focus:enabled:function(e){return!1===e.disabled},disabled:checked:selected:empty:parent:header:function(e){return he.test(e.nodeName)},input:function(e){return pe.test(e.nodeName)},button:text:first:s(,last:s(,eq:s(,even:s(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:s(,lt:s(,gt:s(}},x.pseudos.nth=x.pseudos.eq;for(v in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[v]=v);for(v in{submit:!0,reset:!0})x.pseudos[v]=v);return u.prototype=x.filters=x.pseudos,x.setFilters=new u,C=t.tokenize=
N=t.compile=E=t.select=b.sortStable=F.split("").sort(I).join("")===F,b.detectDuplicates=!!A,j(),b.sortDetached=i(,i(||o("type|href|height|width",,b.attributes&&i(||o("value",,i(||o(ee,,t}(e);re.find=le,re.expr=le.selectors,re.expr[":"]=re.expr.pseudos,re.unique=le.uniqueSort,re.text=le.getText,re.isXMLDoc=le.isXML,re.contains=le.contains;var ue=re.expr.match.needsContext,ce=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,fe=/^.[^:#\[\.,]*$/;re.filter=re.fn.extend({find:filter:function(e){return this.pushStack(r(this,e||[],!1))},not:is:);var de,pe=e.document,he=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(re.fn.init=.prototype=re.fn,de=re(pe);var me=/^(?:parents|prev(?:Until|All))/,ge={children:!0,contents:!0,next:!0,prev:!0};re.extend({dir:sibling:),re.fn.extend({has:closest:index:add:addBack:),re.each({parent:parents:function(e){return re.dir(e,"parentNode")},parentsUntil:function(e,t,n){return re.dir(e,"parentNode",n)},next:function(e){return i(e,"nextSibling")},prev:nextAll:function(e){return re.dir(e,"nextSibling")},prevAll:function(e){return re.dir(e,"previousSibling")},nextUntil:function(e,t,n){return re.dir(e,"nextSibling",n)},prevUntil:siblings:children:contents:,;var ye=/\S+/g,ve={};re.Callbacks=re.extend({Deferred:when:);var be;re.fn.ready=re.extend({isReady:!1,readyWait:1,holdReady:ready:),re.ready.promise=var xe,we="undefined";for(xe in re(ne))break;ne.ownLast="0"!==xe,ne.inlineBlockNeedsLayout=!1,re(,),re.acceptData=var Te=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ce=/([A-Z])/g;re.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:data:removeData:_data:_removeData:),re.fn.extend({data:removeData:function(e){return this.each(function(){re.removeData(this,e)})}}),re.extend({queue:dequeue:_queueHooks:),re.fn.extend({queue:dequeue:function(e){return this.each(function(){re.dequeue(this,e)})},clearQueue:promise:);var Ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ee=["Top","Right","Bottom","Left"],ke=Se=re.access=Ae=/^(?:checkbox|radio)$/i;!),);var je=/^(?:input|select|textarea)$/i,De=/^key/,Le=/^(?:mouse|pointer|contextmenu)|click/,He=/^(?:focusinfocus|focusoutblur)$/,qe=/^([^.]*)(?:\.(.+)|)$/;re.event={global:{},add:remove:trigger:dispatch:handlers:fix:props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:,mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:,special:{load:{noBubble:!0},focus:{trigger:delegateType:"focusin"},blur:{trigger:delegateType:"focusout"},click:{trigger:_default:,beforeunload:{postDispatch:},simulate:,re.removeEvent=pe.removeEventListener?re.Event=re.Event.prototype={isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,preventDefault:stopPropagation:stopImmediatePropagation:,re.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},,ne.submitBubbles||(re.event.special.submit={setup:postDispatch:teardown:),ne.changeBubbles||(re.event.special.change={setup:handle:teardown:),ne.focusinBubbles||re.each({focus:"focusin",blur:"focusout"},,re.fn.extend({on:one:off:trigger:triggerHandler:);var _e="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Me=/ jQuery\d+="(?:null|\d+)"/g,Oe=new RegExp("<(?:"+_e+")[\\s/>]","i"),Fe=/^\s+/,Be=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,We=/<([\w:]+)/,Pe=/<tbody/i,Re=/<|&#?\w+;/,$e=/<(?:script|style|link)/i,ze=/checked\s*(?:[^=]|=\s*.checked.)/i,Ie=/^$|\/(?:java|ecma)script/i,Xe=/^true\/(.*)/,Ue=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ve={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ne.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Je=m(pe),Ye=Je.appendChild(pe.createElement("div"));Ve.optgroup=Ve.option,Ve.tbody=Ve.tfoot=Ve.colgroup=Ve.caption=Ve.thead,Ve.th=Ve.td,re.extend({clone:buildFragment:cleanData:),re.fn.extend({text:append:prepend:before:after:remove:empty:clone:html:replaceWith:detach:domManip:),re.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},;var Ge,Qe={};!);var Ke,Ze,et=/^margin/,tt=new RegExp("^("+Ne+")(?!px)[a-z%]+$","i"),nt=/^(top|right|bottom|left)$/;e.getComputedStyle?(Ke=Ze=:pe.documentElement.currentStyle&&(Ke=Ze=,),re.swap=var rt=/alpha\([^)]*\)/i,it=/opacity\s*=\s*([^)]*)/,ot=/^(none|table(?!-c[ea]).+)/,at=new RegExp("^("+Ne+")(.*)$","i"),st=new RegExp("^([+-])=("+Ne+")","i"),lt={position:"absolute",visibility:"hidden",display:"block"},ut={letterSpacing:"0",fontWeight:"400"},ct=["Webkit","O","Moz","ms"];re.extend({cssHooks:{opacity:{get:},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:ne.cssFloat?"cssFloat":"styleFloat"},style:css:),re.each(["height","width"],,ne.opacity||(re.cssHooks.opacity={get:set:),re.cssHooks.marginRight=k(ne.reliableMarginRight,,re.each({margin:"",padding:"",border:"Width"},,re.fn.extend({css:show:hide:toggle:),re.Tween=H,H.prototype={constructor:H,init:cur:run:,H.prototype.init.prototype=H.prototype,H.propHooks={_default:{get:set:},H.propHooks.scrollTop=H.propHooks.scrollLeft={set:,re.easing={linear:swing:,re.fx=H.prototype.init,re.fx.step={};var ft,dt,pt=/^(?:toggle|show|hide)$/,ht=new RegExp("^(?:([+-])=|)("+Ne+")([a-z%]*)$","i"),mt=/queueHooks$/,gt=[O],yt={"*":[};re.Animation=re.extend(B,{tweener:prefilter:),re.speed=re.fn.extend({fadeTo:animate:stop:finish:),re.each(["toggle","show","hide"],,re.each({slideDown:_("show"),slideUp:_("hide"),slideToggle:_("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},,re.timers=[],re.fx.tick=re.fx.timer=re.fx.interval=13,re.fx.start=re.fx.stop=re.fx.speeds={slow:600,fast:200,_default:400},re.fn.delay=);var vt=/\r/g;re.fn.extend({val:),re.extend({valHooks:{option:{get:,select:{get:set:}}),re.each(["radio","checkbox"],;var bt,xt,wt=re.expr.attrHandle,Tt=/^(?:checked|selected)$/i,Ct=ne.getSetAttribute,Nt=ne.input;re.fn.extend({attr:function(e,t){return Se(this,re.attr,e,t,arguments.length>1)},removeAttr:),re.extend({attr:removeAttr:attrHooks:{type:{set:}}),xt={set:,re.each(re.expr.match.bool.source.match(/\w+/g),,Nt&&Ct||(re.attrHooks.value={set:),Ct||(bt={set:,wt.id=wt.name=wt.coords=re.valHooks.button={get:set:bt.set},re.attrHooks.contenteditable={set:,re.each(["width","height"],),ne.style||(re.attrHooks.style={get:set:);var Et=/^(?:input|select|textarea|button|object)$/i,kt=/^(?:a|area)$/i;re.fn.extend({prop:removeProp:),re.extend({propFix:{for:"htmlFor",class:"className"},prop:propHooks:{tabIndex:{get:}}),ne.hrefNormalized||re.each(["href","src"],,ne.optSelected||(re.propHooks.selected={get:),re.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],,ne.enctype||(re.propFix.enctype="encoding");var St=/[\t\r\n\f]/g;re.fn.extend({addClass:removeClass:toggleClass:hasClass:),re.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),,re.fn.extend({hover:bind:unbind:delegate:undelegate:);var At=re.now(),jt=/\?/,Dt=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;re.parseJSON=re.parseXML=var Lt,Ht,qt=/#.*$/,_t=/([?&])_=[^&]*/,Mt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ot=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ft=/^(?:GET|HEAD)$/,Bt=/^\/\//,Wt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Pt={},Rt={},$t="*/".concat("*");try{Ht=location.href}catch(e){Ht=pe.createElement("a"),Ht.href="",Ht=Ht.href}Lt=Wt.exec(Ht.toLowerCase())||[],re.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ht,type:"GET",isLocal:Ot.test(Lt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":re.parseJSON,"text xml":re.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:ajaxPrefilter:W(Pt),ajaxTransport:W(Rt),ajax:getJSON:getScript:),re.each(["get","post"],,re.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],,re._evalUrl=re.fn.extend({wrapAll:wrapInner:wrap:unwrap:),re.expr.filters.hidden=re.expr.filters.visible=var zt=/%20/g,It=/\[\]$/,Xt=/\r?\n/g,Ut=/^(?:submit|button|image|reset|file)$/i,Vt=/^(?:input|select|textarea|keygen)/i;re.param=re.fn.extend({serialize:serializeArray:),re.ajaxSettings.xhr=void 0!==e.ActiveXObject?X;var Jt=0,Yt={},Gt=re.ajaxSettings.xhr();e.ActiveXObject&&re(e).on("unload",,ne.cors=!!Gt&&"withCredentials"in Gt,Gt=ne.ajax=!!Gt,Gt&&re.ajaxTransport(,re.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":}),re.ajaxPrefilter("script",,re.ajaxTransport("script",;var Qt=[],Kt=/(=)\?(?=&|$)|\?\?/;re.ajaxSetup({jsonp:"callback",jsonpCallback:),re.ajaxPrefilter("json jsonp",,re.parseHTML=var Zt=re.fn.load;re.fn.load=re.expr.filters.animated=var en=e.document.documentElement;re.offset={setOffset:,re.fn.extend({offset:position:offsetParent:),re.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},,re.each(["top","left"],,re.each({Height:"height",Width:"width"},,re.fn.size=
re.fn.andSelf=re.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return re});var tn=e.jQuery,nn=e.$;return re.noConflict=typeof t===we&&(e.jQuery=e.$=re),re}),window.DWait&&DWait.run("jms/lib/jquery/jquery-stable.js");

DWait.ready(["jms/lib/jquery/jquery-stable.js"],function(){window.DWait&&window.DWait.ready&&window.DWait.run&&(window.DWait.run(".jquery"),$(document).ready(function(){window.DWait.run(".domready"),window.DWait.ready(".allready",})),window.DWait&&DWait.run("jms/lib/jquery/jquery.current.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js"],function(){/**
 * @license
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built In easIng capabilities added In jQuery 1.1
 * to offer multiple easIng options
 *
 * Copyright (c) 2007 George Smith
 * Licensed under the MIT License:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 */
jQuery.easing.jswing=jQuery.easing.swing,jQuery.easing.def="easeOutQuad",jQuery.extend(jQuery.easing,{swing:easeInQuad:easeOutQuad:easeInOutQuad:easeInCubic:easeOutCubic:easeInOutCubic:easeInQuart:easeOutQuart:easeInOutQuart:easeInQuint:easeOutQuint:easeInOutQuint:easeInSine:easeOutSine:easeInOutSine:easeInExpo:easeOutExpo:easeInOutExpo:easeInCirc:easeOutCirc:easeInOutCirc:easeInElastic:easeOutElastic:easeInOutElastic:easeInBack:easeOutBack:easeInOutBack:easeInBounce:easeOutBounce:easeInOutBounce:),window.DWait&&DWait.run("jms/lib/jquery/plugins/jquery.easing.js")});

DWait.ready(["jms/lib/gmi.js","jms/lib/jquery/jquery.current.js","jms/lib/Base.js"],function(){!function(t){function i(i,e){var n,r=t.isFunction(i)?i:t.noop;return r!==t.noop||"string"!=typeof i||e||(e=i),t.isFunction(e)?n=e:e&&window[e]&&(n=window[e]),function(){var i=this,e=GMIBase.getOne(i,n);if(e)return r&&r.call(e,i),!e.gmi_lifecycle&&(e.gmi_lifecycle="constructed")&&t(i).data("gmi_instance",e).bind("lifecycle",t.noop),e}}function e(t,i,r,s){if(s=s||"gmi-","object"==typeof i){for(var a in i)e(t,a,i[a],s);return t}return void 0!==r?(t.each(n,[i,r,s]),t):n.call(t.get(0),i,r,s)}function n(i,e,n){var r=t(this),s=n+i,a=void 0!==e;if(a&&r.attr(s,e),obj=r.data("gmi_instance")){if(void 0==i)return obj.gmi_args;a?(obj.gmi_args[i]=e,this.dataset&&this.dataset!==obj.gmi_args&&(this.dataset[i]=e)):e=obj.gmi_args[i]}return a?e:e||r.attr(s)}window.$.fn.base=Base.extend({constructor:function(t,i,e){this.gmi_node=t,this.gmi_args=i||{},window.jQuery&&(this.$=jQuery(t)),jQuery.isFunction(e)?this.inlineConstructor=e:jQuery.isObject(e)&&jQuery.extend(this,e),this.gmiConstructor()},gmiConstructor:inlineConstructor:function(){},gmiDestructor:function(){},hooks:function(){}});t.extend(t.fn,{gmi:function(t,e){return this.map(i(t,e))},gmi1:function(e){var n;return!!(n=this.get(0))&&i(t.noop,e).call(n)},gmiNodes:gmiEach:function(e){var n=t.expr[":"];return this.each(function(){if(n["gmi-active"](this)||n.gmi(this)){var t=i().call(this);if(t)return e.call(t,this)}}),this},gmiWake:function(){return this.each(,this},gmiUp:gmiClean:function(i){return this.each(function(){1===this.nodeType&&(i&&this.firstChild&&t(this).find(":gmi-active").gmiClean(!1),t.cleanData(this),this.removeAttribute("gmindex"))}),this},gmiAttr:gmiPurge:function(){var i={"data-gmiclass":!0,name:!1,id:!1},e=function(t,i){if(i){var e=t.substr(5);this.removeData(e),this.removeAttr(t)}else 0===String(this.attr(t)).indexOf("gmi-")&&this.removeAttr(t)};this.gmiClean(),this.each(function(){t.each(i,t.proxy(e,t(this)))})}}),t.extend(t.expr[":"],{gmi:function(t,i,e){var n=t.getAttribute("data-gmiclass");return n||(n=t.name||t.getAttribute("name")||t.id||!1,n=!(!n||!n.indexOf||0!==n.indexOf("gmi-"))&&n.substr(4)),e&&e[3]?n==e[3]:!!n},"gmi-active":),t.event.special.lifecycle={setup:teardown:function(i){var e,n,r=t(this);if(e=r.data("gmi_instance")){if(r.removeData("gmi_instance"),e.gmi_lifecycle in{deleted:"",destructing:""})return;e.gmi_lifecycle="destructing",e.gmiDestructor&&e.gmiDestructor(),this.dataset&&this.dataset===e.gmi_args&&delete this.dataset,e.gmi_node=e.gmi_args=e.$=null,e.gmi_lifecycle="deleted"}return(n=r.attr("gmindex"))&&(r.removeAttr("gmindex"),delete GMIBase.index[n]),!1}},DWait.init("GMI.wake",function(i){var e=t(i).closest(":gmi");return!(e.data("gmi_instance")||e.attr("gmindex"))})}(jQuery),window.DWait&&DWait.run("jms/lib/jquery/plugins/jquery.gmi.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js"],function(){!function(e){e.fn.someData=function(a){return e.isArray(a)||e.isPlainObject(a)||(a=Array.prototype.slice.call(arguments)),e.someData(this[0],a)},e.someData=function(a,i){var r,t,n,u=e(a),l={},s=[];if(e.isArray(i))s=i;else{if(!e.isPlainObject(i))throw"Invalid list argument provided";for(r in i)s.push(r);l=e.extend(!0,{},i)}if(u.length)for(t=0,n=s.length;t<n;t++)r=s[t],value=u.data(r),void 0!==value&&null!==value&&(l[r]=value);return l}}(jQuery),window.DWait&&DWait.run("jms/lib/jquery/plugins/jquery.somedata.js")});

!function(t,e,i){* @license
   * Copyright (c) 2011 Felix Gnass [fgnass at neteye dot de]
   * Licensed under the MIT license
   */
var p,u=["webkit","Moz","ms","O"],c={},d=),h={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto"},y=y.defaults={},l(y.prototype,{spin:function(t){this.stop();var e,i,r=this,n=r.opts,a=r.el=s(o(0,{className:n.className}),{position:"relative",width:0,zIndex:n.zIndex}),l=n.radius+n.length+n.width;if(t&&(t.insertBefore(a,t.firstChild||null),i=f(t),e=f(a),s(a,{left:("auto"==n.left?i.x-e.x+(t.offsetWidth>>1):parseInt(n.left,10)+l)+"px",top:("auto"==n.top?i.y-e.y+(t.offsetHeight>>1):parseInt(n.top,10)+l)+"px"})),a.setAttribute("aria-role","progressbar"),r.lines(a,r.opts),!p){var u=0,c=n.fps,d=c/n.speed,h=(1-n.opacity)/(d*n.trail/100),y=d/n.lines;!)}return r},stop:lines:function(t,e){or(var a,l=0;l<e.lines;l++)a=s(o(),{position:"absolute",top:1+~(e.width/2)+"px",transform:e.hwaccel?"translate3d(0,0,0)":"",opacity:e.opacity,animation:p&&n(e.opacity,e.trail,l,e.lines)+" "+1/e.speed+"s linear infinite"}),e.shadow&&r(a,s(i("#000","0 0 4px #000"),{top:"2px"})),r(t,r(a,i(e.color,"0 0 1px rgba(0,0,0,.1)")));return t},opacity:),function(){ar e=s(o("group"),{behavior:"url(#default#VML)"});!a(e,"transform")&&e.adj?(d.addRule(".spin-vml","behavior:url(#default#VML)"),y.prototype.lines=function(e,i){r a,l=i.length+i.width,f=2*l,p=2*-(i.width+i.length)+"px",u=s(o(),{position:"absolute",top:p,left:p});if(i.shadow)for(a=1;a<=i.lines;a++)n(a,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(a=1;a<=i.lines;a++)n(a);return r(e,u)},y.prototype.opacity=:p=a(e,"animation")}(),"function"==typeof define&&define.amd?define(function(){return y}):t.Spinner=y}(window,document),window.DWait&&DWait.run("jms/thirdparty/lib/spin.js");

DWait.ready(["jms/dwait/dwait.js","jms/lib/bind.js"],function(){!function(){var t=function(t,e,a){t.addEventListener?t.addEventListener(e,a,!1):t.attachEvent&&t.attachEvent("on"+e,a)},e=window.DWait&&(DWait.download=function(a,n,d){var i,r,o,s,c,l,u,m=document.getElementsByTagName("head")[0],w=document.getElementsByTagName("html")[0];for(a instanceof Array||(a=[a]),l=function(t,a,n,d){if(!t.readyState||"complete"==t.readyState||"loaded"==t.readyState||"IMG"==t.tagName){if(t.dwait_callback_done)return;t.dwait_callback_done=!0,"string"==typeof a&&(a=new Function(a)),a(!0,t,t.getAttribute("src")),n&&(e(n,"error",arguments.callee),n.parentNode.removeChild(n)),e(t,"load",arguments.callee),e(t,"readystatechange",arguments.callee),DWait.downloads[t.getAttribute("src")]="completed"}},i=0;i!=a.length;i++)if(DWait.downloads[a[i]])o=1;else switch(DWait.downloads[a[i]]=!0,"string"==typeof d?d:a[i].replace(/\?.*$/,"").split(".").pop().toLowerCase()){case"js":r=document.createElement("script"),r.setAttribute("type","text/javascript"),r.setAttribute("src",a[i]),r.setAttribute("charset","utf-8"),n&&(c=a[i],s=l.bind(this,r,n,!1),n=null,t(r,"load",s),t(r,"readystatechange",s)),m.appendChild(r);break;case"css":r=document.createElement("link"),r.setAttribute("type","text/css"),r.setAttribute("rel","stylesheet"),r.setAttribute("href",a[i]),n&&(c=a[i],u=document.createElement("img"),u.src=c,s=l.bind(this,r,n,u),t(r,"load",s),t(r,"readystatechange",s),t(u,"error",s),w.appendChild(u),n=null),m.appendChild(r);break;default:throw new Error('DWait cannot download "'+a[i]+'"')}o&&n&&setTimeout(n,1)}),window.DWait&&(DWait.downloads={})}(),window.DWait&&DWait.run("jms/dwait/download.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js"],function(){$(function(){window.self!=window.top&&"https:"==window.location.protocol&&document.referrer&&!function(t){var o=["deviantart.com","sta.sh","deviantart.net","micahgoulart.wixsite.com","node.deviantart.lan:3000","localhost:3000"];if("backend.deviantart.com"==document.domain)return!0;var e=t.split("/")[2];return!e||RegExp("\\.("+o.join("|").split(".").join("\\.")+")$").test("."+e)}(document.referrer)&&($("body").empty(),$("<a>Go to DeviantArt.com</a>").attr({href:window.location.href,target:"_top"}).css({display:"block",position:"fixed",overflow:"hidden",left:0,top:0,width:"100%",height:"100%","z-index":9999,background:"#D6E1D1 url(//st.deviantart.net/minish/main/errors/logo.png) no-repeat","text-decoration":"underline",padding:"40px 10px 10px 10px",color:"#0084B0","font-size":"11px"}).appendTo("body"))}),window.DWait&&DWait.run("jms/lib/clickjacking_blocker.js")});

DWait.ready(["jms/lib/station.js","cssms/lib/modals.css","jms/lib/Base.js","jms/lib/browser.js","jms/lib/pubsub.js","jms/lib/events.js","jms/lib/popup2.js","jms/lib/jquery/jquery.current.js"],function(){window.Modals={$space:null,$fade:null,ready:!1,adopted_holder:!1,stack:[],init:function(e,s){this.$space&&this.$space.length?this.$space.addClass(e).data("modal-class",e):(this.$space=$("#modalspace"),this.$space.length?this.adopted_holder=!0:(this.$space=$('<div id="modalspace"></div>').appendTo(document.body),e&&this.$space.addClass(e)),this.ready=!0),this.$fade||(this.$fade=$("#modalfade")),this.$fade.length||(this.$fade=$('<div id="modalfade"></div>').appendTo(document.body)),s&&this.$fade.addClass(s)},topModal:function(){return Modals.stack.length?Modals.stack[Modals.stack.length-1][0]:null},push:function(e,s,a,o,t,n,d){var l=Modals.topModal();if(Popup2.hideAll(),!Popup2.anyActivePopup()||e&&e.is_modal_instance&&e.options.ignoreinvincible){Modals.init(t,n);var i;if(i=e.is_modal_instance?e:Modals.factory(e,{modalDOM:function(e){var s=$("<div>").addClass("loading modal").addClass(a);$('<a href="" />').addClass("x").on("click",function(){return PubSub.publish("Modals.closeViaX",{id:d}),Modals.pop("cancel"),!1}).appendTo(s);return s}}),i.modalspace_class=t,a&&i.getjQNode().addClass(a),o||(l&&(l.getDOM().style.zIndex=199,l.removeShadow()),Modals.$space.show(),Modals.$fade.show()),Modals.stack.push([i,s]),this&&this.no_form_hook||Events.hook(i.getDOM(),"submit",Modals.submit),!o){i.$content_node.css("display","block");var c=$("<div>").addClass("modal-wrapper").append(i.getDOM()),r=$("<div>").addClass("modal-cel").append(c);Modals.$space.append(r)}if(i.addShadow(),$("body").off("keyup.modals").on("keyup.modals",Modals.escape),PubSub.publish("PreviewStream.keyboard_stop"),PubSub.subscribe({eventname:"Duperbrowse.closed",subscriber:this,callback:Modals.pop}),this&&this.no_form_hook||Events.hook(i.getDOM(),"click",Modals.click),1==Modals.stack.length){Popup2.hideOverlayElements(i.options.modalDOM({}));var u="modal-active";Modals.$space.hasClass("absolute")?u+=" modal-is-absolute":u+=" modal-is-relative",$(document.body).addClass(u),Browser.isIE&&(document.body.runtimeStyle.backgroundImage="url(//st.deviantart.net/minish/main/blank.gif)",document.body.runtimeStyle.backgroundAttachment="fixed")}return i.getDOM()}},pop:function(e){if(Modals.stack.length){var s=Modals.stack[Modals.stack.length-1],a=s[0].getDOM();if(s){if("function"==typeof s[1]){var o="FORM"==a.tagName?a:$("form",a)[0];if(0==s[1].call(a,e,o?Modals.serializeForm(o):null))return!1}a.onsubmit&&a.onsubmit.calls&&(Events.unhook(n,"submit",Modals.submit),Events.unhook(n,"click",Modals.click)),$("body").off("keyup.modals"),PubSub.publish("PreviewStream.keyboard_start"),a.parentNode&&$(a).parents(".modal-cel").detach()}if(Modals.stack.pop(),0==Modals.stack.length)Popup2.showOverlayElements(),Modals.$space.css("display","none"),Modals.$fade.css("display","none").prop("class",""),$(document.body).removeClass("modal-active modal-is-absolute modal-is-relative"),PubSub.unsubscribe({eventname:"Duperbrowse.closed",subscriber:this}),Modals.adopted_holder?(Modals.$space.remove(),Modals.$space=null,Modals.ready=!1):s&&s[0]&&s[0].modalspace_class&&Modals.$space.removeClass(s[0].classname);else{var t=Modals.topModal();t.getDOM().style.zIndex=201,t.addShadow()}}},close:function(e,s){if(0!=Modals.stack.length)for(var a=Modals.stack.length-1;a>=0;a--)if(Modals.stack[a][0]==e||Modals.stack[a][0].getDOM()==e){var o=Modals.stack[a];Modals.stack.splice(a,1),Modals.stack.push(o),Modals.pop(s);break}},escape:function(e){if(27==e.keyCode)if(Popup2.anyActivePopup())Popup2.hideAll();else{var s=Modals.stack[Modals.stack.length-1];if(s&&s[0].options.disableEscape)return;Modals.pop("cancel")}},click:function(e){var s=void 0,a=e.srcElement||e.target;if(("INPUT"==a.tagName||(a=$(a).closest("button")[0]))&&"submit"==a.type&&(s=$(a).closest("form")[0])&&$(a).closest("div.modal")[0]==Modals.topModal().getDOM())return"cancel"!=a.name&&window.validateForm&&!validateForm(s,!0)||Modals.pop(a.name),window.event&&(event.cancelBubble=!0),!1},submit:function(e){return window.event&&(event.cancelBubble=!0),!1},serializeForm:function(e){for(var s={},a=Modals.getFormControls(e),o=a.length,t=0;t<o;t++){var n=a[t];if(n.name)if("radio"==n.type)n.checked&&(s[n.name]=n.value);else if("checkbox"==n.type)if(n.checked&&n.name.indexOf("[]")>0){var d=n.name.split("[]")[0];s[d]||(s[d]=[]),s[d].push(n.value)}else s[n.name]=n.checked;else s[n.name]=n.value}return s},getFormControls:function(e,s){var a=[];return $(e).find("input, select, textarea").each(function(e,o){s&&$(o).attr("name")!==s||a.push(o)}),a},updateSize:function(e,s){if(Modals.stack.length){var a=Modals.topModal();e&&a.$node.width(e),s&&a.$node.height(s),$(window).trigger("modal_resize",[a.getDOM(),a.getjQNode().width(),a.getjQNode().height()])}},getTopModalSize:function(){var e=Modals.topModal();if(Modals.stack.length)return{w:e.getjQNode().width(),h:e.getjQNode().height()}},factory:adopt:function(e){var s=Modals.factory($(e).find("*"));return s.$node=$(e),s}},window.ModalInstance=Base.extend({is_modal_instance:!0,$content_node:null,$node:null,options:{},buttons:[],defaults:{showCloseButton:!0,showButtonsSeparator:!0,buttonContainerExtraClass:"",noShadows:!1,disableEscape:!1,modalDOM:function(e){var s="loading modal modal-rounded";e.extraClassy&&(s+=" "+e.extraClassy);var a=$("<div>").addClass(s);return e.showCloseButton&&a.append($('<a href="" />').addClass("x").on("click",function(){return PubSub.publish("Modals.closeViaX",{identifier:e.identifier}),Modals.pop("cancel"),!1})),a},identifier:null},constructor:function(e,s){this.$content_node=$(e),this.options={},this.options=$.extend(this.options,this.defaults,s||{}),this.buttons=[]},getjQNode:function(){return this.$node||(this.$node=$(this.options.modalDOM(this.options)).append(this.$content_node).append(this.makeButtons())),this.$node},getDOM:function(){return Popup2.hideOverlayElements(this.getjQNode()),this.getjQNode().get(0)},addShadow:function(){this.options.noShadows||this.getjQNode().addClass("with-shadow")},removeShadow:addButton:function(e,s,a){var o;switch(typeof a){case"function":o=a;break;default:a="cancel";case"string":o=this.buttons.push({button_text:e||"Cancel",classes:s||"smbutton-lightgreen",click_cb:o})},makeButtons:function(){if(!this.buttons.length)return null;var e="modal-button-holder"+(this.options.showButtonsSeparator?" modal-separated ":" ")+this.options.buttonContainerExtraClass,s=$("<div>").addClass(e);return $.each(this.buttons,function(e,a){s.append($('<a class="smbutton smbutton-size-default smbutton-shadow"></a>').addClass(a.classes).html(a.button_text).on("click",a.click_cb))}),s}}),window.DWait&&DWait.run("jms/legacy/modals.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/ddt.js","jms/lib/Base.js"],function(){!function(){var e=Base.extend({constructor:publish:function(e,n,s){if(-1===e.indexOf("."))throw new Error("PubSub has a naming convention you must follow: Package.event_name");if(this.subscriptions["*.*"]&&"*.*"!==e&&this.publish("*.*",{eventname:e,payload:n}),this.subscriptions[e]){"*.*"===e||s||(ddt.log("PubSub","Event",e,n),ddt.log("PubSub"+e.split(".")[0],e,n));var t=[];for(var i in this.subscriptions[e]){var r=this.subscriptions[e][i],a=r.subscriber,u=r.callback,o=u.bind(a);t.push({callback:o,eventname:e,payload:n})}for(var b in t){var c=t[b];try{c.callback(c.eventname,c.payload)}catch(e){ddt.error("PubSub","Callback threw",{err:e.message,ev:c.eventname},["pubsub"])}}}else this.queued_payloads[e]||(this.queued_payloads[e]=[]),"*.*"===e||s||ddt.log("PubSub","Queueing event",e,n),this.queued_payloads[e].push(n);return this._publish_to_parent(e,n,s),this},_publish_to_parent:function(e,n,s){window.parent!=window&&window.parent.postMessage&&window.parent.postMessage(this._create_message(e,n,s),"*")},_create_message:function(e,n,s){s=s||!1;var t={_type:"PubSubEvent",eventname:e,payload:this._stringifyMessage({_fromWindow:window.name,data:n}),quiet:s};return this._stringifyMessage(t)},subscribe:function(e){if(arguments.length>1)throw new Error("PubSub subscribe called with multiple arguments, you probably meant to use an array");var n;if(e instanceof Array){for(n in e)e.hasOwnProperty(n)&&this.subscribe(e[n]);return this}if(!e.eventname)throw new Error("Must specify an eventname");if(!e.subscriber)throw new Error("Must specify a subscriber for "+e.eventname);if(!e.callback)throw new Error("Must specify a callback for "+e.eventname);if(-1===e.eventname.indexOf("."))throw new Error("PubSub has a naming convention you must follow: Package.event_name");this.subscriptions[e.eventname]||(this.subscriptions[e.eventname]=[]);var s=!1;for(n in this.subscriptions[e.eventname])if(this.subscriptions[e.eventname][n].subscriber==e.subscriber){s=!0,ddt.log("PubSub","Skipping subscription, already subscribed");break}if(!s){var t={subscriber:e.subscriber,callback:e.callback};if(this.subscriptions[e.eventname].push(t),this.queued_payloads[e.eventname]){if(!e.empty_queue_if_first_subscriber)for(var i in this.queued_payloads[e.eventname]){var r=this.queued_payloads[e.eventname][i];ddt.log("PubSub","Unqueueing event",e.eventname,r),this.publish(e.eventname,r)}delete this.queued_payloads[e.eventname]}}return this},unsubscribe:function(e){var n;if(e instanceof Array)for(n in e)this.unsubscribe(e[n]);else{if(!e.eventname)throw new Error("Must specify an eventname");if(!e.subscriber)throw new Error("Must specify a subscriber");if(-1===e.eventname.indexOf("."))throw new Error('PubSub has a naming convention you must follow: Package.event_name. "'+e.eventname+'" is not acceptable.');if(this.subscriptions[e.eventname]){var s=[];for(var n in this.subscriptions[e.eventname]){var t=this.subscriptions[e.eventname][n];t.subscriber!=e.subscriber&&s.push(t)}return delete this.subscriptions[e.eventname],s.length&&(this.subscriptions[e.eventname]=s),this}}},_stringifyMessage:function(e){var n=[];try{return JSON.stringify(e,function(e,s){if(s&&(s.nodeType||s.window===s))return s.toString();if(s&&"object"==typeof s&&null!==s){if(-1!==$.inArray(s,n))return;n.push(s)}return s})}catch(n){return ddt.error("PubSub","This payload can't be completely stringified",{event:n,obj:e}),""}}});window.PubSub=new e,window.PubSub.classdef=e}(),window.DWait&&DWait.run("jms/lib/pubsub.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/ddt.js","jms/lib/pubsub.js"],function(){!function(){var e=window.PubSub.classdef.extend({constructor:function(){this.base(),$(window).on("message",this.handlers.message_handler.bind(this))},handlers:{message_handler:function(e){try{var t=JSON.parse(e.originalEvent.data);t.payload&&(t.payload=JSON.parse(t.payload))}catch(e){return}t._type&&"PubSubEvent"==t._type&&this.publish(t.eventname,t.payload,t.quiet)}},publish:function(e,t,s){"*.*"!==e&&ddt.log("PubSubCrossFrame","Event",e,"has bubbled up to window",window.name,t),this.base(e,t,s)},publishToWindow:function(e,t,s,a){e&&e.postMessage?e.postMessage(this._create_message(t,s,a),"*"):ddt.error("PubSubCrossFrame","Invalid target window",e)}});jQuery.fn.toJSON=function(){return"[object jQuery]"},jQuery.Event.prototype.toJSON=function(){var e="altKey bubbles button cancelable clientX clientY ctrlKey detail eventPhase keyCode layerX layerY metaKey pageX pageY shiftKey timeStamp type which x y".split(" "),t={};return $.each(e,,JSON.stringify(t)},window.PubSubCrossFrame=new e,window.postMessage&&window.postMessage(JSON.stringify({_type:"PubSubEvent",eventname:"PubSubCrossFrame.loaded",payload:JSON.stringify({})}),"*")}(),window.DWait&&DWait.run("jms/lib/pubsubcrossframe.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/pubsub.js","jms/lib/ddt.js","jms/lib/glbl.js","jms/lib/Base.js"],function(){!function(t){var a=Base.extend({_a_state_was_pushed:!1,_ignore_hashchange_to:null,_previous_location:null,_current_state_id:null,_state_history:[],handlers:{push:function(a,e){"Location.push"===a||"string"!=typeof e||(e={url:e});var s=t.extend({state:null,url:void 0,replace:"Location.replace"===a},e);if(this._set_location(s.url,e.replace)){if(Glbl("Location.pushstate_enabled")){try{s.replace?(history.replaceState(s.state,"",Glbl("Location.path")),ddt.log("Location","Replaced state",s)):(history.pushState(s.state,"",Glbl("Location.path")),ddt.log("Location","Pushed state",s))}catch(t){ddt.warn("Location","Failed to push/replace state",t,e)}this._a_state_was_pushed=!0}else s.replace?this._replace_current_state_in_history(s):this._push_state_to_history(s),s.url=this._add_state_to_url(s.url,s.state),window.location.hash=this._ignore_hashchange_to=s.url;e.pageview&&PubSub.publish("DaPx.update_pageview_data",e.pageview),PubSub.publish("Location.changed_from_push",{origin:s.replace?"replacestate":"pushstate",path:s.url,state:s.state,log_data:e.log_data})}},popstate:function(t){if(!this._a_state_was_pushed)return void(Glbl("Location.pushstate_enabled")&&PubSub.publish("Location.changed_without_push",{origin:"popstate",path:this._previous_location,state:t.state}));this._set_to_current_browser_values()&&PubSub.publish("Location.changed",{origin:"popstate",path:this._previous_location,state:t.state})},hashchange:function(t){var a=this._ignore_hashchange_to===window.location.hash;this._ignore_hashchange_to=null,a||this._set_to_current_browser_values()&&PubSub.publish("Location.changed",{origin:"hashchange",path:this._previous_location,state:this._get_current_state_from_history()})},redirect_to_canonical_url:function(){ddt.log("Location","Redirecting to canonical URL",Glbl("Location.path")),window.location=Glbl("Location.path")}},constructor:function(){this._set_to_current_browser_values(),PubSub.subscribe([{eventname:"Location.set",subscriber:this,callback:this.handlers.push},{eventname:"Location.replace",subscriber:this,callback:this.handlers.push},{eventname:"Location.push",subscriber:this,callback:this.handlers.push},{eventname:"Location.redirect_to_canonical_url",subscriber:this,callback:this.handlers.redirect_to_canonical_url}]),window.addEventListener("popstate",this.handlers.popstate.bind(this)),t(window).bind("hashchange",this.handlers.hashchange.bind(this));var a=window.location.pathname+window.location.search;a!=Glbl("Location.path")&&PubSub.publish("Location.changed",{path:a,origin:"constructor",state:null})},_set_to_current_browser_values:function(){var a=t("<div>").text(window.location.hash).html().substr(1),e=!1;if(0==a.length)e=!1;else try{e=t("#"+a).length>0}catch(t){e=!1}if(a.length>0&&!e){var s=a.match(/[?&]_sid=([abcdef0-9]+)/);return s?(this._current_state_id=s[1],a=a.replace(s[0],"")):this._current_state_id=null,this._set_location(a)}var i=window.location.pathname+window.location.search,o=this._set_location(i);return!o&&e&&PubSub.publish("Location.anchor_changed",{origin:"anchorchange",path:window.location.pathname+window.location.search,state:null}),o},_set_location:function(t,a){return Glbl("Location.path")!=t?(this._previous_location=Glbl("Location.path"),Glbl("Location.path",t),this._set_params(),!0):!!a},_get_current_state_from_history:function(){if(!this._current_state_id)return null;for(var t=this._state_history.length-1;t>=0;t--)if(this._current_state_id===this._state_history[t].id)return this._state_history[t].state},_replace_current_state_in_history:function(t){if(!this._current_state_id)return this._push_state_to_history(t);for(var a=this._state_history.length-1;a>=0;a--)if(this._current_state_id===this._state_history[a].id){this._state_history[a].state=t;break}},_push_state_to_history:function(t){if(Glbl("Location.pushstate_enabled"))throw"Location attempting to push hash state when pushState is enabled, wtf?";var a=this._state_history[this._state_history.length-1]||{};if(this._current_state_id&&this._current_state_id!==a.id)for(var e=this._state_history.length-1;e>=0;e--)if(this._current_state_id===this._state_history[e].id){this._state_history=this._state_history.slice(0,e+1);break}t.id=this._current_state_id=Math.floor(2147483646*Math.random()).toString(16),this._state_history.push(t)},_set_params:function(){var a=/\?(.*)/,e={},s=Glbl("Location.path"),i=function(t){var a;t=t||"";try{a=decodeURIComponent(t.split("+").join(" "))}catch(e){a=decodeURIComponent(escape(t.split("+").join(" ")))}return a};a.test(s)&&t.each(a.exec(s)[1].split("&"),function(t,a){var s=a.split("=");try{if(i(s[0]).match(/^(.*)\[\]$/g)){var o=i(s[0]).replace("[]","");return e[o]||(e[o]=[]),void e[o].push(i(s[1]))}e[i(s[0])]=i(s[1])}catch(t){ddt.warn("Location","Failed to parse URI component",s,t)}}),Glbl("Location.get_params",e)},_add_state_to_url:function(t,a){return t=(t||"").replace(/[&?]_sid=[^&]*/,""),null!==a&&(t+=(-1===t.indexOf("?")?"?":"&")+"_sid="+encodeURIComponent(this._current_state_id)),t}});Glbl("Location.pushstate_enabled",void 0!==window.history&&void 0!==window.history.pushState),new a}(jQuery),window.DWait&&DWait.run("jms/lib/location.js")});

window.popup||(window.popup=function(e,n,t,o,i,w){var e=e||"",t=t||500,n=n||"DA",o=o||600,a=(screen.width-t)/2,p=(screen.height-o)/2.1,r=window.open(e,n,"left = "+a+", top = "+p+", toolbar = 0, scrollbars = 1, location = 0, status = "+(w?1:0)+", statusmenubar = 0, resizable = 1, width="+t+", height="+o);return window.event&&(event.cancelBubble=!0),!!i&&r}),window.DWait&&DWait.run("jms/lib/popupwindow.js");

DWait.ready(["jms/lib/glbl.js"],function(){!function(){var t=window.self.location.hostname,i=window.self.location.pathname;Glbl("Site.is_deviantart",/\bdeviantart.com$/.test(t)),Glbl("Site.is_stash",/\bsta.sh$/.test(t)&&!/^\/writer\//.test(i)),Glbl("Site.is_stash_writer",/\bsta.sh$/.test(t)&&/^\/writer\//.test(i))}(),window.DWait&&DWait.run("jms/lib/site.js")});

GUID={latest:1e4,get:,window.DWait&&DWait.run("jms/lib/guid.js");

DWait.ready(["jms/lib/jquery/jquery.current.js"],function(){Events={hook:function(n,e,t){return $(n).bind(e,t)},unhook:stop:function(){return window.event&&(window.event.cancelBubble=!0),!1}},window.DWait&&DWait.run("jms/lib/events.js")});

DWait.ready(["jms/lib/browser.js","jms/lib/ddt.js","jms/lib/pubsub.js"],function(){PRIV_LOGGEDIN=-1,PRIV_VERIFIED=-100,DiFi={_queue:[],_queuedType:"",_queuedPage:"",_queuedAd:[],_forceHttp:!1,metadataPrefix:1,first_page:!0,_lastresponse:!1,_analogPayload:{},pushPublicStaticGet:function(e,i,a,r,t){return DiFi.push("static",e,i,a,r,t)},pushPublicGet:function(e,i,a,r,t){return DiFi.push("public",e,i,a,r,t)},pushPrivateGet:function(e,i,a,r,t){return DiFi.push("private",e,i,a,r,t)},pushPost:function(e,i,a,r,t){var o=DiFi.push("post",e,i,a,r,t);return window.PubSub&&PubSub.publish("DiFi.pushPost",{api:e,method:i,args:a}),o},setAnalogPayload:function(e,i){DiFi._analogPayload[e]=i},unsetAnalogPayload:clearAnalogPayload:_timer:null,timer:function(e){DiFi._timer&&(clearTimeout(DiFi._timer),e*=.6),DiFi._timer=setTimeout("DiFi.send()",e)},_siCallbacks:{},_pageCallbacks:{},push:function(e,i,a,r,t,o){switch(e){case"static":DiFi._queuedType&&"static"!=DiFi._queuedType&&DiFi.send(),DiFi._queuedType="static";break;case"public":DiFi._queuedType||(DiFi._queuedType="public");break;case"private":DiFi._queuedType in{post:0,page:0}||(DiFi._queuedType="private");break;case"post":DiFi._queuedType="post";break;default:ddt.warn("difi","Unknown type",e)}ddt.log("difi","Push:",e,"(",DiFi._queuedType,")",i,a,r),("DeviationView"===i&&"getExtrasHTML"===a||"MultiSubmit"===i&&"sync_tabs"===a)&&(DiFi._forceHttp=!0),DiFi._queue.push({class:i,method:a,args:r,callback:t,callback_obj:o,original:arguments}),DiFi._queue.length>80&&"post"!=DiFi._queuedType&&(DiFi._queuedType in{static:0,page:0}?DiFi.send():DiFi._queuedType="post")},cached:{},cache:function(e,i,a,r){DiFi.cached[e+";"+i+";"+a.join(",")]=r},send:function(){var e,i,a,r,t,o,s,n,l,u,c,d,p,D,f,F;for(DiFi._timer&&(clearTimeout(DiFi._timer),DiFi._timer=null),l="",r=[],t=[],s=[],p=[],u=0;a=DiFi._queue[u];u++)a.args=DiFi._normalizeArgs(a.args),i=a.class+";"+a.method,(e=DiFi.cached[i+";"+a.args.join(",")])?(a.result=e,s.push(a)):DiFi.overrides[i]&&(e=DiFi.overrides[i](a.class,a.method,a.args,a.callback,a.callback_obj))?(a.result={request:{class:a.class,method:a.method,args:a.args},response:{status:"SUCCESS",content:e}},s.push(a)):(n=i,window.Profile&&deviantART.debug&&p.push({api:a.class,request:a.args,dre_horizontal:!0}),t.push([a.callback,a.callback_obj]),n==l?(o=JSON.stringify(a.args),r[r.length-1]+=","+DiFi._urlescapeCall(o)):(o=JSON.stringify(a.class)+","+JSON.stringify(a.method)+","+JSON.stringify(a.args),r.push(DiFi._urlescapeCall(o)),l=n));if(f="ui="+(("; "+document.cookie+";").match("; userinfo=([^;]*)")||[])[1],r=("post"==DiFi._queuedType?f+"&":"")+"c%5B%5D="+r.join("&c%5B%5D="),D=DiFi._queuedType,DiFi._queuedPage,DiFi._queue.length=0,DiFi._queuedType="",DiFi._queuedPage="",t.length)if(r+="&iid="+DiFi._urlescapeCall(Glbl("DaPx.last_logid")||0),r+="&mp="+DiFi.metadataPrefix++,Object.keys(DiFi._analogPayload).length>0&&(F=DiFi._normalizeArgs(DiFi._analogPayload),F=JSON.stringify(F),r+="&ap="+DiFi._urlescapeCall(F)),D in{public:0,private:0,post:0})r+="&t=json",window.Profile&&deviantART.debug&&Profile.add("DiFi",{id:"N/A"+Math.round(1e4*Math.random()),uri:"/global/difi/",type:"post"==D?"Post":"Private Get",data:p}),DiFi._request("post"==D?"POST":"GET",r,t);else{if("static"!=D)throw new Error("Cannot send as "+D);r+="&t=jsonp&callback=DiFi._callbackSI&extraarg=lookup",DiFi._siCallbacks[r]||(DiFi._siCallbacks[r]=[]),DiFi._siCallbacks[r].push(t),e=document.createElement("script"),e.setAttribute("type","text/javascript"),e.setAttribute("src",document.location.protocol+"//backend.deviantart.com/global/difi/?"+r),document.getElementsByTagName("head")[0].appendChild(e),window.Profile&&deviantART.debug&&Profile.add("DiFi",{id:r,type:"DiFi Backend Request"})}for(u=0;d=s[u];u++){var u;for("function"==typeof d.callback&&(d.callback=[d.callback],d.callback_obj=[d.callback_obj]),c=0;d.callback&&d.callback[c];c++)d.callback[c].call(d.callback_obj[c],!0,d.result)}DiFi._forceHttp=!1},_asciiSafe:_normalizeArgs:function(e,i){if(e instanceof Array)for(var a=0,r=e.length;a<r;a++)e[a]=DiFi._normalizeArgsImpl(e[a],i);else if("object"==typeof e)for(var a in e)e===e[a]?ddt.trace("difi","Ignored attempt to normalize an object with circular references, key:",a):e[a]=DiFi._normalizeArgsImpl(e[a],i);return e},_normalizeArgsImpl:function(e,i){switch("number"!=typeof i&&(i=0),typeof e){case"number":e=String(e);break;case"string":e=DiFi._asciiSafe(e);break;case"object":i<100&&(e=DiFi._normalizeArgs(e,i+1))}return e},_urlescapeCall:_request:function(e,i,a){var r,t="",o=!0;for(var s in a)for(var n in a[s])void 0===a[s][n]||window.$&&window.$.noop&&a[s][n]===window.$.noop||(o=!1);o&&(i+="&ace=true"),!deviantART.debug||0!=window.location.href.indexOf("file:")&&5!=location.href.indexOf("//127.0.0.1/")||(Browser.isGecko&&netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),t=document.location.protocol+"//www.deviantart.com"),r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Msxml2.XMLHTTP"),"POST"==e?(r.open(e,t+"/global/difi/?",!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):r.open(e,t+"/global/difi/?"+i,!0),window.Profile&&deviantART.debug&&Profile.add("DiFi",{id:"N/A"+Math.round(1e4*Math.random()),type:"DiFi POST Request",src:unescape(i)}),Browser.isKHTML&&(DiFi._safariTimer=setTimeout(1e5)),r.callbacks=a,r.onreadystatechange=r.send("POST"==e?i:"")},_handleStateChange:function(e){if(4==e.readyState){var i;if(200==e.status&&""!=e.responseText){Browser.isGecko&&window.deviantART&&deviantART.debug&&0==window.location.href.indexOf("file:")&&netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");try{i=JSON.parse(DiFi._asciiSafe(e.responseText))}catch(a){i=null,vms_feature("dre")&&Browser.isIE&&alert("IE DRE\n"+e.responseText)}}else i=null;if(window.Profile&&deviantART.debug&&Profile.add("DiFi",{id:"N/A"+Math.round(1e4*Math.random()),type:"DiFi XMLHTTP Response",data:i||"ERROR: "+e.responseText}),DiFi._lastresponse=e.responseText,0==e.status&&DiFi._unloading)return;DiFi._handleCallbacks(e.callbacks,i),Browser.isKHTML&&clearTimeout(DiFi._safariTimer)}},_callbackSI:function(e,i){var a,r;if(window.Profile&&deviantART.debug&&Profile.add("DiFi",{id:i,type:"DiFi SI Response",data:e}),e&&e.DiFi&&"SUCCESS"==e.DiFi.status)for(a=0;r=e.DiFi.response.calls[a];a++)"SUCCESS"==r.response.status&&DiFi.cache(r.request.class,r.request.method,r.request.args,r);if(DiFi._siCallbacks[i])for(;DiFi._siCallbacks[i].length>0;)DiFi._handleCallbacks(DiFi._siCallbacks[i].shift(),e)},_handleCallbacks:function(e,i){var a,r,t,o,s,n,l;for(o=i&&i.DiFi&&"SUCCESS"==i.DiFi.status,a=0;r=e[a];a++)if(r[0]){if(o?(t=i.DiFi.response.calls[a],window.DIFI_RECORD&&"SUCCESS"==t.response.status&&DiFi.cache(t.request.class,t.request.method,t.request.args,t)):t=i&&i.DiFi&&i.DiFi.response.details&&i.DiFi.response.details.calls?i.DiFi.response.details.calls[a]:{request:void 0,response:{status:"NOEXEC_HALT",content:i&&i.DiFi.response||{error:{code:"ERR_INVALID_RESPONSE",human:"No valid response received."}}}},r[0]instanceof Array||(r[0]=[r[0]],r[1]=[r[1]]),vms_feature("dre")&&i&&i.DiFi&&i.DiFi.developer_info&&i.DiFi.developer_info.profile_info&&i.DiFi.developer_info.profile_info.dumpid){var u=i.DiFi.developer_info.profile_info;ddt.log("difi","DRE:","https://admin.deviantart.com/dre/share?dumpid="+u.dumpid+"&token="+u.dumptoken)}if(t=t||{response:{}},s="SUCCESS"==(t.response||{}).status,l=0,!s&&t.request)for(n=0;h=this.errorHooks[n];n++)if(h(s,t,r)){l=1;break}if(!l)for(n=0;n!=r[0].length;n++)r[0][n]&&(ddt.log("difi","Callback:",t.request&&t.request.method?t.request.class+"."+t.request.method:"UNKNOWN",s,t),r[0][n].call(r[1][n],s,t))}},errorHooks:[],overrides:{},override:function(e,i,a){i=e+";"+i,DiFi.overrides[i]=a},STR_ERR_BUFFER_PERIOD:500,stdErr:function(e,i,a){var r;DiFi.stderr_output||(DiFi.stderr_output=[]),r=this.stdErrFormat(i),i&&i.error&&"ERR_INVALID_RESPONSE"==i.error.code?console.log("DiFi error: backend probably became unaccessible or ran into fatals",r):(DiFi.stderr_output.push((e||"")+(e&&r?" - ":"")+(r||"")||"Unknown Error"),setTimeout(DiFi.stdErrKaboom,a?1:DiFi.STR_ERR_BUFFER_PERIOD))},stdErrFormat:function(e){return"string"==typeof e?e:e&&e.error?e.error.human||e.error.details||e.error:"Unknown Error"},stdErrKaboom:function(){var e;DiFi.stderr_output.length&&(e=DiFi.stderr_output.length>1?"Some errors have occurred:\n\n- ":"An error has occurred:\n\n",e+=DiFi.stderr_output.join("\n- "),DiFi.stderr_output=[],alert(e))},stdErrCallback:function(e,i){return e||DiFi.stdErr("",i.response.content),e}};var e=!1;window.onbeforeunload&&(e=window.onbeforeunload),window.onbeforeunload=window.DWait&&DWait.run("jms/lib/difi.js")});

DWait.ready([".domready","cssms/lib/popup.css","jms/lib/pubsub.js","jms/lib/glbl.js","jms/lib/browser.js","jms/lib/ddt.js","jms/lib/jquery/jquery.current.js","jms/lib/Base.js"],function(){var e=window.Popup2=Base.extend({default_options:{classes:"",content:"",removed:!1,switched:!1,created:!1,shown:!1,hidden:!1,destroy:!1,invincible:!1,append:!1,blur_invincible:!1,events:[]},constructor:function(t,i,s){this.name=t,this.parent=i,this.$parent=$(i).first(),s=$.extend({},this.default_options,s),this.events=s.events,s.classes&&($.isFunction(s.classes)?this.classes=s.classes():this.classes=s.classes),this.destroy=s.destroy,this.invincible=s.invincible,this.blur_invincible=s.blur_invincible,this.append=s.append,this.content=s.content,this.created=s.created,this.shown=s.shown,this.hidden=s.hidden,this.switched_callback=s.switched,this.removed=s.removed,this.destroy&&e.hideAll(),this.rendered=!1,e.popups[t]=this},visible:render:function(){var e;this.rendered||(this.$node=$("<div>",{class:"popup2"+(this.classes?" popup2-"+this.classes:"")}),e=$.isFunction(this.content)?this.content():this.content,"object"==$.type(e)?this.$node.prepend($(e)):this.$node.html(e),this.append?this.$parent.append(this.$node):this.$parent.prepend(this.$node),this.created&&this.created.call(this,this),this.bindEvents(),this.rendered=!0)},bindEvents:function(){var e=function(e){if($(this).hasClass("disabled"))return!1;var t=e.data.cb.call(this,e);return"boolean"==$.type(t)&&!1===t?t:(e.data.popup.hide(),t)};$.each(this.events,function(t,i){i.selector||(i.selector=null),this.$node.on(i.event,i.selector,{popup:this,cb:i.callback},e)}.bind(this))},default_position_options:{align:"left",valign:"bottom",keepOnScreen:!0,screenPadding:5,absolute:!1,fixedElem:!1,bump:{top:0,left:0}},position:function(e,t){this.render(),t=$.extend(!0,{},this.default_position_options,t);var i,s=e.width(),n=e.height(),o=e.offset(),h=this.$node.width(),p=this.$node.height(),r=t.screenPadding,l=$(window).scrollLeft(),d=$(window).scrollTop(),a=$(window).width(),c=$(window).height();if(t.absolute)return i=t.bump;switch(i=o,t.fixedElem&&(i.top-=d,i.left-=l),t.align){case"center":i.left+=Math.round(s/2),i.left-=Math.round(h/2);break;case"right":i.left-=h,i.left+=s}var u=!1;switch(t.valign){case"top":i.top-=p;break;case"bottom":i.top+=n;break;case"center":i.top+=Math.round(n/2),i.top-=Math.round(p/2),u=!0;break;case"undertop":u=!0}return u&&("left"==t.align?i.left-=h:"right"==t.align&&(i.left+=h)),i.top+=t.bump.top,i.left+=t.bump.left,t.keepOnScreen&&(t.fixedElem?(i.left=Math.min(i.left,a-h),i.top=Math.min(i.top,c-p),i.left=Math.max(i.left,0),i.top=Math.max(i.top,0)):(i.left=Math.min(i.left,l+a-r-h),i.top=Math.min(i.top,d+c-r-p),i.left=Math.max(i.left,l+r),i.top=Math.max(i.top,d+r))),i.right=i.left+s,i.bottom=i.top+n,i.width=s,i.height=n,i},show:function(t){return this.render(),this.shown&&this.shown.call(this,this),this.$node.hide(),this.$node.css("top",t.top+"px").css("left",t.left+"px"),this.$node.show(),e.hideOverlayElements(this.$node),!0},hide:function(){if(this.render(),this.destroy)return this.destroy=!1,void this.remove();this.hidden&&this.hidden.call(this,this),this.$node.hide(),e.showOverlayElements()},remove:function(){this.hide(),this.removed&&this.removed.call(this,this),this.$node.remove(),delete e.popups[this.name]},switched:function(){this.render(),this.switched_callback&&this.switched_callback.call(this,this),this.$node.hide()},addHotKeys:function(e,t){for(var i=0;i<t.length;i++){if(t[i].modifiers.length>0)for(var s=0;s<t[i].modifiers.length;s++){var n=t[i].modifiers[s];switch(n){case"cmd":Browser.isMac?t[i].key="&#8984;"+t[i].key:t[i].key="Ctrl+"+t[i].key;break;case"shift":Browser.isMac?t[i].key="&#8679;"+t[i].key:t[i].key="Shift+"+t[i].key}}var o=this.$node.find(e+t[i].rel);o.find(".hotkey").remove(),o.append('<span class="hotkey">'+t[i].key+"</span>")}}},{hideOverlayElements:function(t){if(t&&t.length){var i=$(e.overlayElements).not(".never-hide-me, .menucompatible").not(,s=t.offset();s.right=s.left+t.width(),s.bottom=s.top+t.height();var n=function(){var e=$(this).offset();return e.right=e.left+$(this).width(),e.bottom=e.top+$(this).height(),s.left<e.right&&e.left<s.right&&s.top<e.bottom&&e.top<s.bottom};i=i.filter(n),Glbl("Site.is_stash")&&i.not(".objective embed, .objective object, #pdf-viewer object"),i.addClass("menucompatible"),PubSub.publish("AdhesionAd.disable")}},showOverlayElements:function(){$(e.overlayElements).filter(":not(.never-hide-me), .menucompatible").removeClass("menucompatible"),PubSub.publish("AdhesionAd.enable")},overlayElements:"iframe, embed, object:not(.no-select), .popup-unfriendly, #flash_target_1"+(Browser.isIE?", #output select":""),popups:{},hideAll:function(t){for(var i in e.popups)e.popups[i].invincible||t&&e.popups[i].blur_invincible||!e.popups[i].visible()||e.popups[i].hide()},switchPopup:function(t,i){for(var s in e.popups)s!=t.name&&e.popups[s].visible()&&e.popups[s].switched();t.show(i)},anyActivePopup:function(){for(var t in e.popups)if(e.popups[t].visible())return!0;return!1},activePopup:function(){for(var t in e.popups)if(e.popups[t].visible())return t},getPopup:isVisible:function(t){return!(!e.getPopup(t)||!e.getPopup(t).visible())},getActivePopup:documentClick:function(t){PubSub.publish("Popup2.document_clicked",t),e.anyActivePopup()&&($(t.target).closest("div.popup2").length||e.hideAll())}});$(document).bind("mousedown.popup2",e.documentClick),$(window).bind("resize.popup2",e.hideAll),vms_feature("dre")||Browser.isIE8||$(window).bind("blur.popup2",,window.DWait&&DWait.run("jms/lib/popup2.js")});

DWait.ready(["jms/lib/station.js","jms/lib/browser.js","jms/lib/jquery/jquery.current.js"],function(){Ruler={document:{jq_node:function(e){var o=$(e),t=o.offset(),r={x:t.left,y:t.top,w:o.width(),h:o.height()};return r.x2=r.x+r.w,r.y2=r.y+r.h,r},node:function(e,o){var t=e,r={x:0,y:0};r.w=t.offsetWidth,r.h=t.offsetHeight;do{r.x+=t.offsetLeft,r.y+=t.offsetTop}while(t=t.offsetParent);return r.x2=r.x+r.w,r.y2=r.y+r.h,o?Ruler.scrollCompensate(e,r):r},pointer:function(e,o){var t={x:e.clientX,y:e.clientY};return Browser.isIE?(t.x+=document.body.scrollLeft||document.documentElement.scrollLeft,t.y+=document.body.scrollTop||document.documentElement.scrollTop):(Browser.isOpera||Browser.isChrome||Browser.isSafari||!Browser.isKHTML)&&(t.x+=window.pageXOffset,t.y+=window.pageYOffset),o&&(t.x+=o.x,t.y+=o.y),Ruler.mouseCache=t,t}},screen:{rect:function(){return{x:Browser.isGecko||Browser.isOpera?window.pageXOffset:document.body.scrollLeft||document.documentElement.scrollLeft,y:Browser.isGecko||Browser.isOpera?window.pageYOffset:document.body.scrollTop||document.documentElement.scrollTop,w:window.innerWidth||document.documentElement.offsetWidth,h:window.innerHeight||document.documentElement.offsetHeight,x2:window.innerWidth||document.documentElement.offsetWidth,y2:window.innerHeight||document.documentElement.offsetHeight}},node:function(e,o,t){var r,n;return r=Ruler.document.node(e,o),n=Browser.isGecko||Browser.isOpera?window.pageYOffset:document.body.scrollTop||document.documentElement.scrollTop,r.y-=n,r.y2-=n,t&&(r.y-=t,r.y2-=t),r},pointer:function(e,o){var t={x:e.clientX,y:e.clientY};return!Browser.isKHTML||Browser.isSafari||Browser.isChrome||(t.x-=window.pageXOffset,t.y-=window.pageYOffset),o&&(t.x+=o.x,t.y+=o.y),t}},clickMod:function(e,o){return e.x-=o.x,e.y-=o.y,e},hitTest:function(e,o,t){var r;for(o instanceof Array||(o=[o]),i=0;i!=o.length;i++)if(r=o[i],t&&t.y2_buffer&&(r.y2=r.y+r.h-t.y2_buffer),e.x>r.x+(t?t.x:0)&&e.y>r.y+(t?t.y:0)&&e.x<r.x2+(t?t.x:0)&&e.y<r.y2+(t?t.y:0))return i;return null},scrollCompensate:function(e,o){var t,r,n;for(t=Browser.isGecko||Browser.isOpera,n=t?window.pageYOffset:document.body.scrollTop||document.documentElement.scrollTop,r=t?window.pageXOffset:document.body.scrollLeft||document.documentElement.scrollLeft;(e=e.parentNode)&&e!=document.body;)e.scrollTop&&(o.y-=e.scrollTop,o.y2-=e.scrollTop),e.scrollLeft&&(o.x+=e.scrollLeft,o.x2-=e.scrollLeft),(window.getComputedStyle&&"fixed"==getComputedStyle(e,"").getPropertyValue("position")||e.currentStyle&&"fixed"==e.currentStyle.position||e.runtimeStyle&&"fixed"==e.runtimeStyle.position)&&(o.y-=n,o.y2+=n,o.x+=r,o.x2+=r);return o}},Ruler.document.mouse=Ruler.document.pointer,Ruler.screen.mouse=Ruler.screen.pointer,window.DWait&&DWait.run("jms/lib/ruler.js")});

DWait.ready(["jms/lib/browser.js"],function(){Station={INTERVAL:25,DRAW_EVERY_FRAME:!1,SPEED:1,data:[],animations:[],passiveGet:function(t){var o;for(o=0;o!=Station.data.length;o++)if(Station.data[o][0]==t)return Station.data[o];return null},addNode:function(t){var o=[t,{}];return Station.data.push(o),o},activeGet:nullInterpolator:function(t){return t},push:function(t,o){var a,n,e,i,r,p,l;for(e=Station.activeGet(t),i=Station.animations.length,p=2,l=(new Date).valueOf();arguments[p];)"function"==typeof arguments[p]?a=arguments[p]:(n=arguments[p].from,void 0===n&&(n=Station.read(e,o)||0),a={data:e,property:o,from:n,to:arguments[p].to,f:arguments[p].f||Station.nullInterpolator,marker:l},"substr"==this.numbers[o]&&(a.special=a.to,a.from=0,a.to=a.special.length),a.velocity&&(a.px=a.from-a.velocity),window.SPRINGY_THING&&(a.time=null,a.f=Vadavadavada.spring),void 0==arguments[p].time&&arguments[p].f||(a.ticktock=0,a.ticks=Math.max(Math.round((arguments[p].time||0)*Station.SPEED/Station.INTERVAL),1))),r?r.STATION_next=a:Station.animations.push(a),r=a,p++,"string"==typeof arguments[p]&&(o=arguments[p++]);return Station.loopOn(),i},run:function(){var t;return t=Station.push.apply(this,arguments),Station.loop(t),t},stopAnimation:function(t){var o,a;for(o=0;o!=Station.animations.length;o++)(a=Station.animations[o])&&a.data&&a.data[0]==t&&(Station.animations[o]=null)},numbers:{left:"px",top:"px",bottom:"px",right:"px","left%":"%",marginLeft:"px",marginTop:"px",marginBottom:"px",marginRight:"px",paddingLeft:"px",paddingTop:"px",paddingBottom:"px",paddingRight:"px",borderLeft:"px",borderTop:"px",borderBottom:"px",borderRight:"px",width:"px",height:"px",fontSize:"px",opacity:"float",zoom:"float",scrollLeft:"direct",scrollTop:"direct",innerHTML:"direct",nodeValue:"substr",backgroundPositionX:"bgxhax",backgroundPositionY:"bgyhax",zIndex:"",letterSpacing:"px"},loop:function(t){var o,a,n,e,i,r;if(Station.looper){for(r=(new Date).valueOf(),a=t||0;a!=Station.animations.length;a++){if(t>=0&&t!=a)return;if(o=Station.animations[a]){if(void 0==t&&(o.ticks||o.complete)){if(o.complete||o.ticktock>=o.ticks){for(Station.animations[a]=null;"function"==typeof o.STATION_next;)o.STATION_next.call(o,o.data[0]),o=o.STATION_next;o.STATION_next&&(o.STATION_next.marker=r,Station.animations.push(o.STATION_next));continue}o.ticktock+=Math.max(1,Math.floor((r-o.marker)*Station.SPEED/Station.INTERVAL)),o.marker=r,o.ticktock=Math.min(o.ticktock,o.ticks)}i=!0,"string"!=typeof o.to&&Station.numbers[o.property]?o.ticks?(n=o.ticktock/o.ticks,y=o.f(n),to=o.from+y*(o.to-o.from)):(void 0==o.px&&(o.px=o.from),e=o.f(o.from-o.to,o.px-o.to),o.px=o.from,o.complete=e.complete,to=o.to+e.result,o.from=to):to=o.to,Station.apply(o.data,o.property,to,o.special)}}i||Station.loopOff()}},apply:function(t,o,a,n){var e;if(t.nodeType&&(t=Station.activeGet(t)),e=Station.numbers[o])switch(e){case"float":Browser.isIE&&"opacity"==o?t[0].style.filter="alpha(opacity="+100*a+")":t[0].style[o]=a;break;case"substr":t[0][o]=n.substr(0,Math.round(a));break;case"direct":t[0][o]=a;break;case"%":t[0].style[o.replace(/%/g,"")]=Math.round(a)+"%";break;case"bgxhax":t[0].style.backgroundPosition=Math.round(a)+"px 0";break;case"bgyhax":t[0].style.backgroundPosition="0 "+Math.round(a)+"px";break;default:t[0].style[o]=Math.round(a)+e}else t[0].style[o]=a;t[1][o]=a},loopOn:loopOff:function(){Station.looper&&(clearInterval(Station.looper),Station.looper=null,Station.animations.length=0)},stop:read:function(t,o){var a;return a=t.nodeType?Station.passiveGet(t):t,a?a[1][o]:Browser.isIE?t.runtimeStyle[o]||t.currentStyle[o]:(o=o.replace(/([A-Z])/g,"-$1").toLowerCase(),t.style[o]||getComputedStyle(t,"").getPropertyValue(o))},looper:null,f:{inversion:,overlayEnd:overlay:function(t){var o;return o=t.cloneNode(!0),Station.apply(o,"opacity",.99),Station.apply(o,"position","absolute"),Station.apply(o,"width",t.offsetWidth),Station.apply(o,"zIndex",30),o.disabled=!0,t.parentNode.insertBefore(o,t),o}};var t=1;Interpolators={line:function(t){return t},sineCurve:pulse:function(o){var a,n;if(1==t&&1!=o&&(t=1/arguments.callee(1)),(o*=8)<1)a=o-(1-Math.exp(-o));else{var e=Math.exp(-1);o-=1,n=1-Math.exp(-o),a=e+n*(1-e)}return a*t}},Vadavadavada={spring:function(t,o){var a,n,e;return e=t-o,n=.2,a=-t*n,e+=a,t+=e,t*=1-1/Math.pow(Math.abs(t/2e3)+1.3,2),{result:t,complete:!(Math.round(t)||Math.round(o))}}},window.DWait&&DWait.run("jms/lib/station.js")});

DWait.ready(["jms/lib/bind.js"],function(){LiquidSwitch=LiquidSwitch.prototype={destroy:function(t){t||(this.state=this.start_state,this.target_time=null,this.tick()),this.ticker&&clearInterval(this.ticker)},change:function(t,i,e,s){var a;this.interrupt=!0,a=(new Date).valueOf(),this.target_time&&t==this.target_state?this.target_time=Math.min(this.target_time,a+i):this.target_time=a+i,this.target_time=Math.max(this.target_time,(this.last_change||0)+e),this.target_state=t,s&&t==this.state&&(this.state=null),this.ticker||(this.ticker=setInterval(this.tick.bind(this),25),this.tick())},tick:function(){var t;t=(new Date).valueOf(),(!this.target_time||t>=this.target_time)&&(this.ticker&&clearInterval(this.ticker),this.ticker=null,this.target_time=null,this.target_state!=this.state&&(this.interrupt=!1,!1===this.f(this.target_state,this.state)||this.interrupt||(this.last_change=t,this.state=this.target_state)))}},window.DWait&&DWait.run("jms/lib/liquidswitch.js")});

DWait.ready(["jms/lib/pubsub.js","jms/lib/station.js","jms/lib/jquery/jquery.current.js"],function(){window.LitBox={_disabled:!1,hover:function(t,i){if(!LitBox._disabled){var o=t.getAttribute("data-litbox-timeout");if(o)return clearTimeout(o),void t.removeAttribute("data-litbox-timeout");var e=$(t),a=e.find("q"),r=a.position(),n=a.height()-e.height()+10;n<=0||(Station.stopAnimation(a[0]),Station.run(a[0],"top",{from:r.top,to:r.top-n,time:i?n/2*25*3:25*n*3}))}},out:function(t){if(!LitBox._disabled){var i=t.getAttribute("data-litbox-timeout");if(!i){var o=this;return void t.setAttribute("data-litbox-timeout",setTimeout(function(){o.out(t)},0))}clearTimeout(i),t.removeAttribute("data-litbox-timeout"),t=t.getElementsByTagName("q")[0],Station.stopAnimation(t),Station.run(t,"display",{to:"block",time:100},"top",{from:parseInt(Station.read(t,"top"),10)||0,to:0,f:Interpolators.pulse,time:600})}},start:function(t){LitBox._disabled=!1},stop:function(t,i){if(i.length>0){var o=i.find("q");o.length>0&&(Station.stopAnimation(o[0]),Station.apply(o[0],"top",0))}LitBox._disabled=!0}},PubSub.subscribe([{eventname:"LitBox.start",subscriber:LitBox,callback:LitBox.start,empty_queue_if_first_subscriber:!0},{eventname:"LitBox.stop",subscriber:LitBox,callback:LitBox.stop,empty_queue_if_first_subscriber:!0}]),window.DWait&&DWait.run("jms/lib/litbox.js")});

DWait.ready(["jms/lib/events.js","jms/lib/gmi.js"],function(){DTLocal={},DTLocal.infect=function(l){var t;l.constructor&&!l.constructor.localCache&&(l.constructor.localCache={});for(t in DTLocal.infection)l[t]=DTLocal.infection[t];l.local={}},DTLocal.infection={localUID:function(){return this.local_uid_counter||(this.local_uid_counter=100),this.local_uid_counter++},localDestroy:function(){this.localRecv&&this.localRecv("lastcall"),this.localClean(),this.localRecv&&this.localRecv("destroy")},localClean:function(l,t){var o,c,e;for(o in this.local){if("function"==typeof l||l instanceof RegExp){if(l instanceof RegExp){if(!o.match(l))continue}else if(!(this.local[o]instanceof l))continue;e=o}else e=l||o;if(e in this.local){if(t||!this.local[e]){this.local[e]=null;continue}if(this.local[e]instanceof Array)this.local[e][0]==clearInterval?clearInterval(this.local[e][1]):this.local[e][0]==clearTimeout?clearTimeout(this.local[e][1]):this.local[e][0].apply(this,this.local[e].slice(1));else if(this.local[e].nodeType)this.local[e].parentNode&&this.local[e].parentNode.removeChild(this.local[e]);else{if("function"!=typeof this.local[e].localDestroy&&"function"!=typeof this.local[e].gmiConstructor)continue;c=this.local[e],this.local[e]=null,c.localDestroy?c.localDestroy():GMI._delete(c),delete c}delete this.local[e]}if("string"==typeof l)return}},getLocalEventHook:function(l,t,o){return Events.hook(l,t,o),[Events.unhook,l,t,o]},getLocalSetTimeout:function(l,t){return[clearTimeout,setTimeout(l,t)]},getLocalSetInterval:function(l,t){return[clearInterval,setInterval(l,t)]},localEventHook:function(l,t,o){this.local[this.localUID()]=this.getLocalEventHook.apply(this,arguments)},localSetTimeout:function(l,t){this.local[this.localUID()]=this.getSetTimeout.apply(this,arguments)},localSetInterval:function(l,t){this.local[this.localUID()]=this.getSetInterval.apply(this,arguments)}},window.DWait&&DWait.run("jms/lib/dtlocal.js")});

DWait.ready(["jms/lib/glbl.js","jms/dwait/download.js","jms/lib/pubsub.js","jms/lib/bind.js","jms/lib/jquery/jquery.current.js"],function(){window.gWebPage={update:function(e,a,t){var i,s;if(e.pageData&&!(e.pageData instanceof Array))for(i in e.pageData)"deviant"==i?deviantART.deviant=e.pageData[i]:deviantART.pageData[i]=e.pageData[i];if(e.title&&e.title.length&&(document.title=e.title),e.css&&($("style#difi-page-css").remove(),$("head").append('<style id="difi-page-css" type="text/css">'+e.css+"</style>")),e.rollups){var l,d,i;for(l in e.rollups)DWait.R[l]=e.rollups[l]}if(e.deps)for(i=0;i<e.deps.length;i++){var n=e.deps[i];if((!n[3]||!n[3].media||/Screen/.test(n[3].media))&&!DWait.L[n[0]])if($('link[rel="stylesheet"][href^="'+n[1]+'"]').length>0||$('script[src^="'+n[1]+'"]').length>0)DWait.R[n[1]]&&delete DWait.R[n[1]];else{s=gWebPage.downloadDone.bind(gWebPage,n[1],a?a.pull():null);var o;o=n[2]?n[1]+"?"+n[2]:n[1],DWait.download(o,s,n[3]&&n[3].media?"css":"js")}}if(e.downloads){var l,d,i;for(l in e.downloads)if(!DWait.T[l]){d=[];for(i in e.downloads[l])$('link[rel="stylesheet"][href^="'+e.downloads[l][i]+'"]').length>0||$('script[src^="'+e.downloads[l][i]+'"]').length>0||d.push(e.downloads[l][i]);d.length&&(DWait.T[l]=d)}DWait.retrip()}if(e.dwaitcalls)for(i=0;i<e.dwaitcalls.length;i++)DWait.ready.apply(t||this,e.dwaitcalls[i]);DWait.init_domready(),e.assets&&PubSub.publish("gWebPage.assets",e.assets),PubSub.publish("gWebPage.update",e)},downloadDone:,window.DWait&&DWait.run("jms/lib/gwebpage.js")});

window.SpinnerPresets={green:{lines:15,length:0,width:3,radius:4,color:"#84b247",trail:60,shadow:!1,hwaccel:!1,zIndex:1},big_white:{lines:15,length:15,width:5,radius:20,color:"#fff",trail:60,shadow:!0,hwaccel:!1,zIndex:1}},window.DWait&&DWait.run("jms/lib/spinpreset.js");

REG_OLD_DEVIATION_2=/^h[t]tps?:\/\/()www.deviantart\....\/(?:deviation|view)\/()([0-9]+)\/?(?:\?.*)?$/,REG_DEVIATION_2=/^h[t]tps?:\/\/([^\.]+)\.deviantart\....\/(?:art\/|journal\/)?([0-9A-Za-z\-\.]+)\-([0-9]+)\/?(?:\?.*)?$/,REG_DEVIATION_3=/^h[t]tps?:\/\/([^\.]+)\.deviantart\....\/(?:[0-9A-Za-z\-\_]+)\/(?:art\/|journal\/)?([0-9A-Za-z\-\.]+)\-([0-9]+)\/?(?:\?.*)?$/,REG_COLLECTION=/^h[t]tps?:\/\/([^\.]+)\.deviantart\....\/(?:gallery|favourites)\/\#_?()([0-9A-Za-z\-]+)\/?$/,REG_COLLECTION_2=/^h[t]tps?:\/\/([^\.]+)\.deviantart\....\/(?:[0-9A-Za-z\-\_]+)\/(?:gallery|favourites)\/\#_?()([0-9A-Za-z\-]+)\/?$/,RESOURCE_DEVIATION=1,RESOURCE_GALLERIES=20,RESOURCE_FAVCOLLECTIONS=21,MYSTERY=0,window.DWait&&DWait.run("jms/pages/lub/lub_constants.js");

DWait.ready(["cssms/pages/misc/subble.css","jms/lib/ruler.js","jms/lib/jquery/jquery.current.js"],function(){window.Subby={warning:function(t,e,s,i){var n,o,r,u=$(t);e=void 0===e?"Get":e||"",s=s||"this feature",i=i?" "+i:"",upsell_text="as a <strong>Core Deviant</strong>",o='<div class="subblebubble">'+e+" <strong>"+s+"</strong>"+i+" "+upsell_text+" </div>",n=$(o).css({visibility:"hidden",position:"absolute","z-index":300}).appendTo("body"),u.addClass("subble").data("subby",n),r=Subby.getPosition(n[0],Ruler.document.jq_node(t)),n.css({left:r.x,top:r.y,visibility:"visible"})},getPosition:function(t,e){var s,i;return i={x:e.x,y:e.y2,w:t.offsetWidth,h:t.offsetHeight},i.x2=i.x+i.w,i.y2=i.y+i.h,s=Ruler.screen.rect(),i.x2+30>s.x2&&(i.x=Math.max(0,e.x2-i.w),i.x2=i.x+i.w),i.y2>s.y2&&(i.y=Math.max(0,e.y-i.h),i.y2=i.y+i.h),i},out:function(t){var e;e=$(t).data("subby"),e&&e.remove(),$(t).data("subby",null)},getPremiumCheckoutUrl:,window.DWait&&DWait.run("jms/pages/subby.js")});

DWait.ready(["cssms/pages/misc/subble.css","jms/lib/jquery/jquery.current.js"],function(){!function(){window.QuickTip={show:function(i,s,o){var n,p=$(i);n=p.data("quicktip"),n||(n=new t(p,s,o),p.data("quicktip",n)),n.show()}};var t=function(t,s,o){var n={timeout:null,mode:"mouseover",close_wait:150,visible:!1,gravity:{x:"l",y:"b"},position:{x:0,y:0},classes:""};this.options=$.extend(n,o||{}),this.template=i[s||"simple"],this.$anchor=t,this.build_body(),this.build_tip()};t.prototype={show:function(){if(this.$tip.closest("html").length||this.$tip.appendTo("body"),!this.cancel_close()&&!this.options.visible){switch(this.calculate_position(),this.options.mode){case"only_close_on_outside_click":$(document).on("click.quicktip",this.close.bind(this));break;default:this.$anchor.on("mouseleave.quicktip",this.close.bind(this)),this.$tip.on("mouseenter.quicktip",this.cancel_close.bind(this)).on("mouseleave.quicktip",this.close.bind(this))}this.options.visible=!0,this.template.show.call(this)}},build_body:function(){var t=this.$anchor.data(),i=$("<div>").addClass("message");if(t.quicktipTitle&&i.append($("<strong>").text(t.quicktipTitle)),t.quicktipText){var s=$("<span>").text(t.quicktipText);i.append(s.text().replace(":br:","<br>"))}t.quicktipFinal&&i.append($("<em>").text(t.quicktipFinal)),t.quicktipFinalStrong&&i.append($("<strong>").text(t.quicktipFinalStrong)),this.$tip_body=i},build_tip:function(){var t=this.$anchor.data(),i=!1;t.quicktipHref&&t.quicktipHref.match("^https?://")?i=t.quicktipHref:this.$anchor.is("a")&&(i=this.$anchor.attr("href")),i?(this.$tip=$("<a>").attr("href",i),this.$anchor.attr("target")&&this.$tip.attr("target",this.$anchor.attr("target")),this.$anchor.attr("onclick")&&this.$tip.attr("onclick",this.$anchor.attr("onclick"))):this.$tip=$("<div>"),this.$tip.addClass(this.options.classes).addClass(this.template.classes||"").append(this.$tip_body)},calculate_position:function(){var t=$(window).width(),i=this.$anchor.offset(),s=this.$anchor.outerWidth(),o=this.$anchor.outerHeight(),n=this.$tip.outerHeight(),p=this.$tip.width();this.$tip.removeClass("gravity-"+this.options.gravity.y+this.options.gravity.x),i.left+p>t?this.options.gravity.x="r":i.left-p<0&&(this.options.gravity.x="l"),i.top-n<0&&(this.options.gravity.y="t"),"l"===this.options.gravity.x?this.options.position.x=i.left:this.options.position.x=i.left+s-p,"t"===this.options.gravity.y?this.options.position.y=i.top+o:this.options.position.y=i.top-n,this.$tip.addClass("gravity-"+this.options.gravity.y+this.options.gravity.x)},cancel_close:function(){return!!this.options.timeout&&(clearTimeout(this.options.timeout),this.options.timeout=null,!0)},close:function(){var t=this;this.options.timeout=setTimeout(function(){t.template.close.call(t),t.cancel_close(),t.$tip.off(".quicktip"),t.$anchor.off(".quicktip"),t.options.visible=!1},this.options.close_wait)}};var i={fade_up_in:{classes:"quicktip",show:function(){var t="b"==this.options.gravity.y?10:-10;this.$tip.css({top:this.options.position.y+t,left:this.options.position.x}).show().animate({top:this.options.position.y,opacity:1})},close:function(){var t="b"==this.options.gravity.y?10:-10,i=this;this.$tip.animate({top:i.options.position.y+t,opacity:0},}},subby:{classes:"quicktip",show:function(){this.options.position.x+="l"==this.options.gravity.x?-5:5,i.fade_up_in.show.call(this)},close:function(){i.fade_up_in.close.call(this)}},submit:{classes:"quicktip white-tip",show:function(){this.options.position.x+="l"==this.options.gravity.x?-5:5,i.fade_up_in.show.call(this)},close:,password:{classes:"quicktip simple-tip",show:function(){this.$tip.css({top:this.$anchor.offset().top-this.$tip.outerHeight()+33,left:this.$anchor.offset().left-8-this.$tip.outerWidth(),opacity:1}).removeClass("gravity-"+this.options.gravity.y+this.options.gravity.x).addClass("right-bottom").show()},close:function(){this.$tip.hide()}},simple:{classes:"quicktip simple-tip",show:function(){this.$tip.css({top:this.options.position.y,left:this.options.position.x,opacity:1}).show()},close:function(){this.$tip.hide()}},symbol:{classes:"quicktip simple-tip",show:function(){this.$tip.css({top:this.options.position.y-4,left:this.options.position.x-5,opacity:1}).show()},close:function(){this.$tip.hide()}}}}(),window.DWait&&DWait.run("jms/pages/quicktip.js")});

DWait.ready(["jms/lib/ddt.js","jms/lib/jquery/jquery.current.js","jms/lib/Base.js"],function(){window.GMIBase||(window.GMIBase=Base.extend({constructor:function(e,t){this.gmi_node=e,this.gmi_args=t||{},window.jQuery&&(this.$=jQuery(e)),this.gmiConstructor()},gmiConstructor:function(){},gmiQuery:function(e,t,n,i){var r,o,a,s,u,m,d,g,c;if("string"==typeof arguments[0]&&(i=arguments[2],n=arguments[1],t=arguments[0],e=this.gmi_node||document),n||(n={}),d=[],r=document.getElementsByName("gmi-"+t),e!=document){for(o=[],a=0;a!=r.length;a++)for(s=r[a];s;s=s.parentNode)if(s==e){o.push(r[a]);break}}else o=r;for(g=GMIBase.getConstructor(t),a=0;u=o[a];a++){if(n.match){m=1;for(s in n.match)if(String(u.getAttribute("gmi-"+s)||"")!=String(n.match[s])){m=0;break}if(!m)continue}c=GMIBase.getOne(u,g,i),-1!=c&&null!=c&&d.push(c)}return d},gmiQueryAsync:function(e,t,n,i,r){var o,a,s,u,m,d,g,c;if("string"==typeof arguments[0]&&(i=arguments[2],n=arguments[1],t=arguments[0],e=this.gmi_node||document),n||(n={}),d=[],o=document.getElementsByName("gmi-"+t),e!=document){for(a=[],s=0;s!=o.length;s++)for(u=o[s];u;u=u.parentNode)if(u==e){a.push(o[s]);break}}else a=o;g=GMIBase.getConstructor(t);var l=0,f=a.length;setTimeout(function e(){if(m=a[l],l<f){var t=!0;if(n.match)for(u in n.match)if(String(m.getAttribute("gmi-"+u)||"")!=String(n.match[u])){t=!1;break}t&&-1!=(c=GMIBase.getOne(m,g,i))&&null!=c&&d.push(c),++l,setTimeout(e,1)}else r&&r(d)},1)},gmiUp:function(e,t,n){var i,r,o;i=arguments[0]&&arguments[0].nodeType?1:0,r=i?arguments[0]:this.gmi_node,e=arguments[0+i],t=arguments[1+i],n=arguments[2+i],e&&(e="gmi-"+e);for(var a={};n||(r=r.parentNode);)if(n=!1,r.getAttribute)if(o=r.getAttribute("gmi-redirect"),o&&a[r]&&window.console&&console.log("thwarted gmi-redirect loop",e,r),o&&!a[r])a[r]=!0,r=GMIBase.index[o].gmi_node,n=1;else if(r.getAttribute("name")&&(!e||r.getAttribute("name")==e)){if(t){t--;continue}return GMIBase.getOne(r)}},gmiApply:function(e,t,n,i){var r,o;return e.setAttribute("gmindex",o=++GMIBase.current_lookup),i||(e.setAttribute("id","gmi-"+t),e.id="gmi-"+t),e.setAttribute("name","gmi-"+t),e.name="gmi-"+t,r=GMIBase.getConstructor(t),GMIBase.index[o]=new r(e,n)},gmiCreate:function(e,t){return GMI.gmiApply(document.createElement("div"),e,t)},gmiRefresh:function(){for(i in this.gmi_args)this.$.attr("gmi-"+i,this.gmi_args[i])}}),GMIBase.index={},GMIBase.current_lookup=0,GMIBase.getOne=function(node,constructor_shortcut,passive){var eax,i,a,options;if(!(i=node.getAttribute("gmindex"))){if(passive)return null;for(options={},i=0;a=node.attributes[i];i++)0==a.name.indexOf("gmi-")?options[a.name.substr(4)]=a.value:0==a.name.indexOf("gmon-")?options[a.name.substr(5)]=eval("("+a.value+")"):0==a.name.indexOf("data-")&&(options[a.name.substr(5)]=a.value);node.dataset||(node.dataset=options),node.setAttribute("gmindex",i=++GMIBase.current_lookup),GMIBase.index[i]=-1;try{(constructor_shortcut=GMIBase.getConstructorFromNode(node,constructor_shortcut))&&(eax=new constructor_shortcut(node,options),GMIBase.index[i]=eax)}catch(e){if(node.removeAttribute("gmindex"),delete GMIBase.index[i],!e.message||!e.message.match(/gmi class not declared/i))throw e;return ddt.trace("gmi",e.message),window.onerror&&window.onerror(e.message,"deviantart.com/gmi.js",0),-1}}return GMIBase.index[i]},GMIBase._deleteNode=function(e){var t;if(t=GMIBase.getOne(e,null,!0))return this._delete(t);e.parentNode&&e.parentNode.removeChild(e),delete e},GMIBase._delete=function(e,t){var n,i;if(e instanceof Array)for(i=0;i!=e.length;i++)arguments.callee.call(this,e[i],t);else n=e.gmi_node,e.gmi_lifecycle="destructing",e.gmiDestructor&&e.gmiDestructor(),e.gmi_lifecycle="deleted",delete GMIBase.index[n.getAttribute("gmindex")],n.setAttribute("gmindex",""),t||(n.parentNode&&n.parentNode.removeChild(n),window.attachEvent||(n.innerHTML=""))},GMIBase.getConstructor=function(name){try{return eval(name)}catch(e){return new Function("",'throw new Error("GMI Class not declared: '+name+'")')}},GMIBase.getConstructorFromNode=function(e,t){if(jQuery.isFunction(t))return t;var n,i;if(t)e.setAttribute("data-gmiclass",n=t);else if(!(n=e.getAttribute("data-gmiclass"))){var r=e.getAttribute("name")||e.getAttribute("id")||"";"gmi-"==r.substr(0,4)&&(n=r.substr(4))}return(i=GMIBase.getConstructor(n))&&(i.GMIClass=n),i},GMIBase.default_constructor=window.GMI=GMI=new GMIBase,GMI.getOne=GMIBase.getOne,GMI.query=GMI.gmiQuery,GMI.up=GMI.gmiUp,GMI.apply=GMI.gmiApply,GMI.create=GMI.gmiCreate,GMI._delete=GMIBase._delete,GMI._deleteNode=GMIBase._deleteNode,GMI.evCancel=function(){return window.event&&(event.cancelBubble=!0),!1},window.$gm=GMI.gmiQuery),window.DWait&&DWait.run("jms/lib/gmi.js")});

/**
 * @license
 * ===============================================================================
 * Crc32 is a JavaScript function for computing the CRC32 of a string
 * ...............................................................................
 *
 * Version: 1.2 - 2006/11 - http://noteslog.com/category/javascript/
 *
 * -------------------------------------------------------------------------------
 * Copyright (c) 2006 Andrea Ercolino
 * http://www.opensource.org/licenses/mit-license.php
 * ===============================================================================
 */
!function(){crc32=function(D,B){B==window.undefined&&(B=0);var A=0,C=0;B^=-1;for(var E=0,F=D.length;E<F;E++)A=255&(B^D.charCodeAt(E)),C="0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*A,8),B=B>>>8^C;return-1^B},fletcher16=function(D){for(var B,A=D.length,C=255,E=255,F=0;A;){B=A>20?20:A,A-=B;do{E+=C+=D.charCodeAt(F++)}while(--B);C=(255&C)+(C>>8),E=(255&E)+(E>>8)}return C=(255&C)+(C>>8),(E=(255&E)+(E>>8))<<8|C}}(),window.DWait&&DWait.run("jms/lib/crc32.js");

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/pubsub.js"],function(){QuantcastHelper={account:"p-915Y6SMHQQJHI",init:function(){PubSub.subscribe([{eventname:"PageViewTracker.pageview",subscriber:this,callback:this.handlers.pageview}])},replaceLabel:function(e,t){if(!window.__qc||!window.__qc.qopts)return void console.log("[QC] quantcast not present");var n=__qc.qopts.labels||"",a=n.split(/,/);for(var s in a)a[s]==e&&(a[s]=t);n=a.join(","),__qc.qpixelsent=[],_qevents.push({qacct:this.account,labels:n})},replaceLabelAll:function(e){if(!window.__qc||!window.__qc.qopts)return void console.log("[QC] quantcast not present");var t=__qc.qopts.labels||"",n=t.split(/,/),a=[];for(var s in n)-1!=n[s].indexOf("UserStatus.")&&a.push(n[s]);$.isArray(e)?a=a.concat(e):a.push(e),t=a.join(","),__qc.qpixelsent=[],_qevents.push({qacct:this.account,labels:t})},addLabel:function(e){if(!window.__qc||!window.__qc.qopts)return void console.log("[QC] quantcast not present");var t=__qc.qopts.labels||"";t+=","+e,__qc.qpixelsent=[],_qevents.push({qacct:this.account,labels:t})},handlers:{pageview:},QuantcastHelper.init(),window.DWait&&DWait.run("jms/lib/quantcast.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/lib/pubsub.js","jms/lib/Base.js","jms/thirdparty/lib/dapx/dapx.tracker.js","jms/lib/ddt.js"],function(){var e=Base.extend({constructor:function(e,t){this.client="**",this.initialized=!1,this.daid=0,this.runtimeid=0,this.impression_ctr=0,this.event_ctr=0,this.pre_init_queue=[],this.last_url=!1,this.pageviewevent=!1,this.userid=!1,this.iframes=[],this.is_iframe=window!==window.top,this.top_logid=e,this.iframe_id=t,this.init_log_data={},this.pageview_cache={},PubSub.subscribe([{eventname:"DaPx.initialize",subscriber:this,callback:this.handlers.initialize},{eventname:"DaPx.do_delayed_initialize",subscriber:this,callback:this.handlers.do_delayed_initialize},{eventname:"DaPx.send_event",subscriber:this,callback:this.handlers.send_event},{eventname:"DaPx.send_click_event",subscriber:this,callback:this.handlers.send_click_event},{eventname:"DaPx.send_form_submission_event",subscriber:this,callback:this.handlers.send_form_submission_event},{eventname:"DaPx.send_standard_event",subscriber:this,callback:this.handlers.send_standard_event},{eventname:"DaPx.update_pageview_data",subscriber:this,callback:this.handlers.update_pageview_data},{eventname:"DaPx.force_send_pageview_event",subscriber:this,callback:this.handlers.send_pageview},{eventname:"Location.changed",subscriber:this,callback:this.handlers.send_pageview},{eventname:"Location.changed_from_push",subscriber:this,callback:this.handlers.send_pageview},{eventname:"Location.changed_without_push",subscriber:this,callback:this.handlers.send_pageview}]),$(document).on("click","[data-dapx_click_event]",this.handlers.receive_click_event.bind(this)),$(document).on("submit","[data-dapx_submit_event]",this.handlers.receive_submit_event.bind(this)),$(window).on("message.dapx",this.handlers.receive_postmessage.bind(this))},get_instanceid:get_local_logid:get_client_logid:get_pageview_ctr:update_globals:function(){Glbl("DaPx.local_logid",this.get_local_logid()),Glbl("DaPx.last_logid",this.get_client_logid())},format_screen_coordinates:function(e){return e+"@"+Math.round($(window).width())+"x"+Math.round($(window).height())+":"+Math.round($(window).scrollLeft())+","+Math.round($(window).scrollTop())},send:function(e){if(!this.initialized)return void this.pre_init_queue.push(e);e.userid&&(ddt.warn("dapx","Userid already set in payload; unsetting",e),delete e.userid),((deviantART||{}).deviant||{}).loggedIn?e.userid=deviantART.deviant.id:this.userid&&(e.userid=this.userid),e.event&&ddt.log("dapx","Sending event",e.event),dapx("send",e)},validate_eventname:function(e){var t=["daweb","damobileweb"],i=["pageview"];if(!/^[\w-]+:[\w-]*:[\w-]*:[\w-]*:[\w-]*:[\w-]+$/.test(e))return ddt.error("dapx","Invalid event name",e),!1;var a=e.split(":");return t.indexOf(a[0])<0?(ddt.error("dapx","Invalid event client",e),!1):!(i.indexOf(a[5])<0)||(ddt.error("dapx","Invalid event action",e),!1)},parse_eventname:function(e){if(!this.validate_eventname(e))return{};var t=e.split(":"),i={client:t[0],view:t[1],action:t[5]};return t[2]&&(i.section=t[2]),t[3]&&(i.component=t[3]),t[4]&&(i.element=t[4]),i},send_init_events:function(){this.initialized=!0,this.handlers.send_pageview.call(this,null,{origin:"_dapx_init",log_data:this.init_log_data}),this.pre_init_queue.length&&($.each(this.pre_init_queue,function(e,t){t.type=t.type.replace("**",this.client),t.instanceid=this.get_instanceid(),t.logid="1."+e,this.send(t)}.bind(this)),this.pre_init_queue=[])},getDeviationResourceType:handlers:{initialize:function(e,t){this.client=t.client,this.daid=t.daid,this.runtimeid=t.requestid+"-"+(new Date).getTime().toString(36),this.userid=t.userid,this.pageviewevent=t.eventid,this.init_log_data=t.log_data,t.delay_init_event?ddt.log("dapx","Init delayed",t):this.send_init_events()},do_delayed_initialize:send_pageview:function(e,t){if(!window.dapx)return void ddt.warn("dapx","Cannot log: window.dapx is missing");if(this.is_iframe)return void ddt.warn("dapx","iframe logging is disabled");if(!this.initialized)return void ddt.log("dapx","Delayed pageview swallowing event");var i=String(window.location);if(i==this.last_url)return void ddt.warn("dapx","Tried to send multiple pageviews for the same location");if(this.pageview_cache[i]&&(this.pageviewevent=this.pageview_cache[i]),!this.validate_eventname(this.pageviewevent))return void ddt.warn("dapx","Invalid pageview event",a);this.last_url=i,this.pageview_cache[i]=this.pageviewevent,this.impression_ctr+=1,this.event_ctr=0,this.update_globals();var a={type:this.client+"cp",instanceid:this.get_instanceid(),logid:this.get_local_logid(),url:i,referrer:document.referrer,appmechanic:t.origin,screen_coordinates:this.format_screen_coordinates("0,0"),event:this.pageviewevent};"init"===t.log_data&&(t.log_data=this.init_log_data),$.isPlainObject(t.log_data)&&$.each(t.log_data,function(e,t){a[e]=t}),this.send(a);var e=this.parse_eventname(this.pageviewevent),n={eventname:"pageview",view:e.view,referer:document.referrer};switch(e.component&&(n.component=e.component),n.view){case"art":var d;t.state&&t.state.item&&t.state.item.itemid?d=t.state.item.itemid:deviantART.pageData&&deviantART.pageData.deviationid&&(d=deviantART.pageData.deviationid),n.typeid=this.getDeviationResourceType(n.component),n.itemid=d;break;case"profile":var s=$(":gmi(GalleryEditor)");if(s.length)n.typeid=s.attr("gmi-typeid"),n.itemid=s.attr("gmi-itemid");else{var o=$(":gmi(Gruser)");n.typeid=4,n.itemid=o.attr("gmi-id")}}n.version="notes"===n.view?"eclipse;major":"eclipse;minor",PubSub.publish("BILogger.logEvent",n)},send_event:function(e,t){if(!window.dapx)return void ddt.warn("dapx","Cannot log: window.dapx is missing");if(!t.event)return void ddt.warn("dapx","Cannot log event; no event name specified",t);this.event_ctr+=1,this.update_globals();var i=$.extend({type:this.client+"ce",instanceid:this.get_instanceid(),logid:this.get_local_logid()},t);this.send(i)},send_standard_event:function(e,t){var i=this.pageviewevent?this.pageviewevent.split(":"):["invalid","other","","","",""],a=[t.client||i[0],t.view||i[1],t.section||i[2],t.component||i[3],t.element||i[4],t.action||"click"],e=a.join(":");if(!this.validate_eventname(e))return void ddt.warn("dapx","Attempt to update pageview to invalid event name",t);var n={event:e};t.log_data&&$.each(t.log_data,,this.handlers.send_event.call(this,"",n)},receive_postmessage:function(e){if(e&&e.originalEvent&&"dapxif"==e.originalEvent.data){var t;$.each(this.iframes,function(i,a){a===e.originalEvent.source&&(t=i+1)}),t||(t=this.iframes.push(e.originalEvent.source));var i=this.get_instanceid()+"-"+this.get_local_logid()+","+t;e.originalEvent.source.postMessage("dapxif:"+i,"*")}},send_click_event:function(e,t){var i=t.event,a=$(t.element),n=t.payload;if(this.handlers.send_event.call(this,null,n),t.overrideEventCapture)t.eventCaptured&&dapx("manual_flush"),setTimeout(t.hitCallback,500);else{var d=a.attr("href"),s=a.attr("target"),o=!i.defaultPrevented&&!1!==i.returnValue&&!i.altKey&&!i.ctrlKey&&!i.metaKey&&!i.shiftKey&&i.which<2&&d&&0!==d.indexOf("javascript:")&&"#"!==d[0]&&"_blank"!=s&&!(window.Admin||{}).active&&!n.nofollow;o&&(i.preventDefault(),dapx("manual_flush"),d=a[0].href,s&&0===s.indexOf("_")&&(s=s.substring(1))),setTimeout(function(){if(o){(window[s]||window).top.location=d}},500)}},receive_click_event:function(e){var t=$(e.target);t.data("dapx_click_event")||(t=t.closest("[data-dapx_click_event]")),this.handlers.send_click_event.call(this,null,{event:e,element:t.get(0),payload:t.data("dapx_click_event")})},send_form_submission_event:function(e,t){var i=t.event,a=$(t.element),n=t.payload;if(a.data("dapx_has_submitted"))return void(t.overrideEventCapture&&t.hitCallback());if(this.handlers.send_event.call(this,null,n),a.data("dapx_has_submitted",!0),t.overrideEventCapture)t.eventCaptured&&dapx("manual_flush"),setTimeout(t.hitCallback,500);else{var d=a.attr("target"),s=!i.defaultPrevented&&!1!==i.returnValue&&"_blank"!=d;s&&(i.preventDefault(),dapx("manual_flush")),setTimeout(500)}},receive_submit_event:function(e){var t=$(e.target);t.data("dapx_submit_event")||(t=t.closest("[data-dapx_submit_event]")),this.send_form_submission_event(null,{event:e,element:t.get(0),payload:t.data("dapx_click_event")})},update_pageview_data:function(e,t){if(this.pageviewevent){var i=this.pageviewevent.split(":");t.view&&(i[1]=t.view),i[2]=t.section||"",i[3]=t.component||"",i[4]="",i[5]="pageview",i.splice(6,i.length);var a=i.join(":");if(!this.validate_eventname(a))return void ddt.warn("dapx","Attempt to update pageview to invalid event name",t);this.pageviewevent=a,ddt.log("dapx","Updated pageview event",this.pageviewevent)}}}}),t=Base.extend({constructor:function(){this.canonical_ads=[],this.monitored_adids={},this.monitored_adids_details={},this.monitoring_adids={},this.nodes_by_adid={},this.tick_timer=0,this.scroll_tick_lock=!1,this.handlers.scroll_tick_debounced=$.debounce(100,this.handlers.scroll_tick.bind(this)),PubSub.subscribe([,{eventname:"DaPx.send_ad_event",subscriber:this,callback:this.handlers.send_ad_event},{eventname:"DaPx.send_ad_event_from_node",subscriber:this,callback:this.handlers.send_ad_event_from_node},{eventname:"DaPx.send_ads_reused",subscriber:this,callback:this.handlers.send_ads_reused},{eventname:"Duperbrowse.closed",subscriber:this,callback:this.handlers.send_ads_after_duperbrowse_close}]),$(window).on({"message.dapxads":this.handlers.receive_postmessage.bind(this),"scroll.dapxads":this.handlers.scroll_tick_debounced}),$(document).on("visibilitychange.dapxads",this.handlers.scroll_tick_debounced)},calculate_ad_visibility:function(e){var t=$(window),i=$(e),a=i.offset()||{},n={h:t.height(),t:t.scrollTop(),b:t.scrollTop()+t.height()},d={h:i.height(),t:a.top,b:i.height()+a.top};return d.b<n.t||n.b<d.t?0:d.t>n.t&&d.b<n.b?1:Math.abs((Math.max(n.t,d.t)-Math.min(n.b,d.b))/d.h)},monitor_ad_visibility:function(e,t){e&&!this.monitored_adids[e]&&this.nodes_by_adid[e]&&(this.monitoring_adids[e]||(this.monitoring_adids[e]={started:this.calculate_ad_visibility($(this.nodes_by_adid[e]))?$.now():-1,samples:[]},this.monitored_adids_details[e]=t),this.monitoring_adids[e].started>0&&this.set_timeout_to_poll_ad_visibility())},set_timeout_to_poll_ad_visibility:function(){clearTimeout(this.tick_timer),this.tick_timer=setTimeout(this.handlers.scroll_tick_debounced,1e3)},handlers:{send_ad_event:function(t,i){PubSub.publish("DaPx.send_event",$.extend({type:e.client+"ad"},i))},send_ad_event_from_node:function(t,i){var a,n;if(i.node){var d=$(i.node),s=d.data("dapx-adid");n=d.data("da-safety"),a=d.data("ad-id"),s&&(i.event_payload.adframe_logid=s);var o=d.data("ad-campaignid");o&&(i.event_payload.ad_campaignid=o),document.hidden?i.event_payload.advp=-3:document.hasChildNodes(i.node)?d.is(":visible")?i.event_payload.hasOwnProperty("advp")||(i.event_payload.advp=parseFloat(this.calculate_ad_visibility(i.node).toFixed(2))):i.event_payload.advp=-1:i.event_payload.advp=-2;var r=d.offset()||{};i.event_payload.screen_coordinates=e.format_screen_coordinates(Math.round(r.left)+","+Math.round(r.top))}if(i.event_payload.cp_logid==e.get_pageview_ctr()&&delete i.event_payload.cp_logid,i.event_payload&&"ad_rendered"==i.event_payload.event&&(i.event_payload.details&&0==i.event_payload.details.meta_safety&&n&&(i.event_payload.details.meta_safety=n),i.event_payload.details&&!1===i.event_payload.details.meta_adunit&&a&&(i.event_payload.details.meta_adunit=a),i.event_payload.details&&1==i.event_payload.details.meta_bidder&&"safe"!=i.event_payload.details.meta_safety&&(i.event_payload.details.meta_bidder=!1),i.event_payload.details&&1==i.event_payload.details.meta_bidder&&"nobid"!=i.event_payload.details.meta_estimate)){var l=!1;for(var _ in i.event_payload.details)if(_.match(/^meta_provider_/)){l=!0;break}l||ddt.alert("dapx","Bidder log without bidders",i.event_payload,["dapx"])}if(this.handlers.send_ad_event.call(this,"DaPx.send_ad_event",i.event_payload),i.node){if(!s){var s=e.get_local_logid();$(i.node).data("dapx-adid",s),1!=e.get_pageview_ctr()||this.nodes_by_adid.hasOwnProperty(s)||this.canonical_ads.push(s),this.nodes_by_adid[s]=i.node}"ad_rendered"==i.event_payload.event&&(this.monitored_adids[s]=!1,this.monitor_ad_visibility(s,i.event_payload.details))}},scroll_tick:function(){document.hidden||this.scroll_tick_lock||(this.scroll_tick_lock=!0,$.each(this.monitoring_adids,function(e,t){var i=$(this.nodes_by_adid[e]);if(t&&i.is(":visible")){var a=this.calculate_ad_visibility(i);a>=.5?(t.samples.push(a),-1==t.started?(t.started=$.now(),this.set_timeout_to_poll_ad_visibility()):$.now()-t.started>=1e3&&(this.monitored_adids[e]=!0,this.monitoring_adids[e]=!1,this.handlers.send_ad_event_from_node.call(this,null,{node:i,event_payload:{event:"ad_viewed",advp:parseFloat((t.samples.reduce(/t.samples.length).toFixed(2)),details:this.monitored_adids_details[e]||!1}}),this.monitored_adids_details[e]=!1)):-1!=t.started&&(t.started=-1,t.samples=[])}}.bind(this)),this.scroll_tick_lock=!1)},send_ads_reused:function(e,t){if(t&&t.length){for(var i=t.length-1;i>=0;--i){var a=t[i];if(this.nodes_by_adid[a]){if(document.hasChildNodes(this.nodes_by_adid[a]))continue;t.splice(i,1),this.nodes_by_adid[a]=null}}t.length&&this.handlers.send_ad_event.call(this,null,{event:"ads_reused",ad_logids:t.join(",")})}},receive_postmessage:function(t){var i=String(t&&t.originalEvent&&t.originalEvent.data);if(i=i.match(/^(dapxad):({.*)$/)||i.match(/^(dapxadr)(.*)$/)||[],3==i.length){if(!t.originalEvent.origin.match(/^http(|s):\/\/(www\.da-ads\.com|staging\.deviantart\.lan|www\.deviantart.com)$/))return void ddt.warn("dapx","advertising postmessage received from invalid origin",t.originalEvent.origin,t.originalEvent.data);var a=i[1],n=i[2];if("dapxadr"==a)return void t.originalEvent.source.postMessage("dapxadr:"+e.get_pageview_ctr(),"*");try{n=JSON.parse(n)}catch(e){return}var d=null;$("iframe").each(function(e,i){if(i.contentWindow==t.originalEvent.source)return d=this,!1}),this.handlers.send_ad_event_from_node.call(this,null,{node:d,event_payload:n})}},send_ads_after_duperbrowse_close:function(e,t){this.handlers.scroll_tick_debounced(),this.handlers.send_ads_reused.call(this,e,this.canonical_ads)}}}),i=function(i,a){window.DaPx=e=new e(i,a),window.DaPxAds=t=new t};if(window===window.top)i();else{var a;$(window).on("message.dapxiframes",function(e){var t=String(e&&e.originalEvent&&e.originalEvent.data).match(/^dapxif:([^,]*),(.*)$/)||[];3==t.length&&(clearTimeout(a),$(window).off("message.dapxiframes"),i(t[1],t[2]))});var n=0,d=function(){window.top.postMessage("dapxif","*"),++n<10&&(a=setTimeout(d,150))};d()}window.DWait&&DWait.run("jms/lib/dapx.js")});

DWait.ready(["jms/lib/ruler.js","jms/lib/jquery/jquery.current.js","jms/lib/Base.js"],function(){window.Selection={},window.SimpleSelection=Base.extend({constructor:function(e,t){this.setRoot(e),this.callback=t||this.fnull},fnull:function(){},setRoot:function(e){this.root=e},getAllSelectable:isSelectable:isSelected:function(e){return(" "+e.className+" ").indexOf(" selected ")>=0},getSelection:function(e){var t,i,l;for(l=e?{}:[],t=this.getAllSelectable(),i=0;t[i];i++)this.isSelected(t[i])&&(e?l[i]=t[i]:l.push(t[i]));return l},setSelection:function(e,t){if(e&&!this.isSelectable(e))throw new Error("Cannot select "+e);if(Selection.focused=this,e&&this.isSelected(e))return!0;var i,l;for(l=this.getSelection(),i=0;l[i];i++)this.deselect(l[i]);return e&&(this.next_sel_click_volatile=!1,this.select(e)),this.callback(this.getSelection(void 0),l,t),!0},setRelativeSelection:function(e,t,i,l,n){var s,c,r;if(r=t?"relative_keyboard":"relative",c=this.getAllSelectable(),!(c.length<1))return s=this.getSelection(!0),i?this.setNewAdditiveSelection.call(this,s,r,e,c,t,l,n):this.setNewSelection.call(this,s,r,e,c),this.getSelection(!0)},setNewSelection:function(e,t,i,l){for(var n in e)return n=Number(n),void(n+i<0?this.setSelection(l[0],t):this.setSelection(l[Math.min(l.length-1,n+i)],t));this.setSelection(l[i>0?0:l.length-1],t)},setNewAdditiveSelection:function(e,t,i,l,n,s,c){if(jQuery.isEmptyObject(e))return this.setRelativeSelection(i,n);var r=0,a=null;for(var o in e)o=Number(o),null===a&&(a=o),r+=1;var h=null,u=0;for(var f in s)f=Number(f),null===h&&(h=f),u+=1;var S=f;null===h&&(h=a,S=d,u=r);var d=o;if(i<0)if(r>1&&a==h&&d!=S){if(!c)for(var v=Math.max(d,d+i)-1;v>=Math.min(d,d+i);v--)this.deselect(l[Math.max(a,v+1)])}else for(var v=Math.max(a,a+i)-1;v>=Math.min(a,a+i);v--)this.select(l[Math.max(0,v)]);else if(r>1&&d==S&&a!=h){if(!c)for(var v=Math.min(a,a+i);v<Math.max(a,a+i);v+=1)this.deselect(l[Math.min(d,v)])}else for(var v=Math.min(d,d+i);v<Math.max(d,d+i);v+=1)this.select(l[Math.min(l.length-1,v+1)]);this.callback(this.getSelection(void 0),e,t)},setVerticallyRelativeSelection:function(e,t,l,n,s){var c,r;if(t?"relative_keyboard":"relative",r=this.getAllSelectable(),!(r.length<1)){if(c=this.getSelection(!0),jQuery.isEmptyObject(c)&&l)return this.setVerticallyRelativeSelection(e,t);var a=null,o=0;for(i in r){var h=Ruler.screen.node(r[i]);if(null===a)a=h.y;else if(h.y!=a)break;o++}return this.setRelativeSelection(e*o,t,l,n,s)}},select:function(e){this.isSelected(e)||(e.className+=" selected")},deselect:function(e){e.className=e.className.replace(/\s*\bselected\b/g,"")},deselectAll:),window.DWait&&DWait.run("jms/lib/simple_selection.js")});

DWait.ready(["jms/lib/bind.js","jms/lib/Base.js"],function(){window.CBC=Base.extend({constructor:function(t,i,a){this.active_tasks=0,this.failures=[],this.active=!1,this.callback=t,this.granular_callback=i,this.current_granular_params=a||[]},pull:function(t){return this.active_tasks++,this.distributable_callback.bind(this,t,this.current_granular_params)},start:function(){this.active=!0,this.checkForCompleteness()},setGranularParams:function(t){this.current_granular_params=t?t instanceof Array?t:[t]:[]},finish:function(){this.active&&(this.callback(this),this.active=!1)},checkForCompleteness:distributable_callback:function(t,i){var a,s,c;if(c=this.granular_callback,t||c){for(s=[],a=2;a<arguments.length;a++)s.push(arguments[a]);t&&t.apply(window,s),c&&c.apply(window,i.concat(s))}this.active_tasks--,this.checkForCompleteness()}}),window.DWait&&DWait.run("jms/lib/cbc.js")});

DWait.ready(["jms/lib/bind.js","jms/lib/gmi.js"],function(){GSTREAM_MAX_LENGTH=1e4,GStream=GMIBase.extend({gmiConstructor:function(){this.gs_dedupe_on_splice=!0,this.contents=[],this.graveyard=[],this.domReadMeta(),this.domReadState()},REQUEST_FETCH:1,domFindVisible:function(){},domReadOne:function(){},domReadState:function(){var t,s;s=this.domFindVisible();for(t in s)s.constructor.prototype[t]||(this.contents[t]=this.domReadOne(s[t]));!this.gs_offset&&this.contents.length<this.gs_count_per_page&&!this.gs_more_to_load&&(this.gs_total=this.contents.length)},domReadMeta:function(){this.gs_offset=0,this.gs_count_per_page=24,this.gs_fetch_size=48,this.gs_fetch_bank=0,this.gs_total=this.gmi_args.total||void 0,this.gs_empty=this.gmi_args.empty},domDrawRange:function(t,s){var i,e,n;for(i=0;i!=s;i++)if(!(i+t<this.gs_offset)){if(i+t>=Math.min(this.gs_total||GSTREAM_MAX_LENGTH,this.gs_offset+this.gs_count_per_page))break;this.domDrawItem(t+i,this.contents[t+i])==this.REQUEST_FETCH&&(void 0===e?e=this.gs_offset+i:n=this.gs_offset+i)}void 0!=e&&this.dataFetch(e,Math.max(this.gs_fetch_size,1+(n?n-e:0)))},domDrawItem:function(t,s){},domRemoveItem:domClearAll:function(){var t,s;t=this.domFindVisible();for(s in t)this.domRemoveItem(t[s])},dataSplice:function(t,s,i){var e,n,o,a,h,r=0;if(this.gs_dedupe_on_splice&&i)for(e=0;e!=i.length;e++)(n=this.dataIndexOf(i[e]))>=0&&(this.gs_hold_exposure=!0,i[e]=this.dataSplice(n,1,[])[0]||i[e],this.gs_hold_exposure=!1,n!=t+e&&r++);for(this.gs_empty&&i.length&&(this.gmi_node.innerHTML="",this.gs_empty=!1),e=this.contents.length;e<t;e++)this.contents[e]=null;for(h=this.contents.splice.apply(this.contents,[t,s].concat(i||[])),this.graveyard=this.graveyard.concat(h),void 0!==this.gs_total&&(this.gs_total+=(i||[]).length-h.length),e=0;e<s;e++)t+e>=this.gs_offset&&e<this.gs_count_per_page&&(o||(o=this.domFindVisible()),(a=o[t+e])&&(this.domRemoveItem(a),r++));var d=i?i.length:0;return r=Math.max(r,d,(this.gs_total||this.contents.length)+(d-r)-t%this.gs_count_per_page),i&&i.length&&(this.domDrawRange(t,r),r=0),r>0&&!this.gs_hold_exposure&&this.domDrawRange(this.gs_offset+(this.gs_count_per_page-r),r),h},dataIndexOf:function(t){var s;for(s=0;s!=this.contents.length;s++)if(this.contents[s]&&this.dataCompare(this.contents[s],t))return s;return-1},dataFetch:function(t,s){},dataFilterArray:function(t,s,e){var n={};for(i=0;i!=s.length;i++)n[i+t]=s[i];return this.dataFilter(n,e)},dataFilter:function(t,s){var i,e,n,o,a;o={};for(e in t)if(!(e in t.constructor.prototype)){for(void 0===a&&(a=Number(e)),n=t[e],i=0;i!=this.graveyard.length;i++)if(this.graveyard[i]&&this.dataCompare(this.graveyard[i],n)){s?this.graveyard.splice(i):i=-1;break}-1!=i&&(o[a++]=n)}return o},dataCompare:function(){return!1},dataAdd:function(t){var s,i;i=this.gs_offset+this.gs_count_per_page;for(s in t)this.contents[s]=t[s],s>=this.gs_offset&&s<i&&this.domDrawItem(s,this.contents[s])},commsAskForTargets:commsRecvDrop:function(){},commsNonInputEvent:function(){}}),window.DWait&&DWait.run("jms/lib/gstream/gstream.js")});

DWait.ready(["jms/lib/station.js","jms/lib/simple_selection.js","jms/lib/difi.js","jms/lib/bind.js","jms/lib/jquery/jquery.current.js","jms/lib/gstream/gstream.js"],function(){window.ResourceStream=GStream.extend({gmiConstructor:function(){if(this.active_fetches={},this.base(),1===parseInt(this.gmi_args.duperbrowse_enabled,10)){this.$.removeClass("dwait");var e=this,t="Duperbrowse"+(this.gmi_args.duperbrowse_class||"Standard")+"ResourceStream";window[t]?(ddt.log("Duperbrowse","Factory resource stream"),DuperbrowseStandardResourceStream.prototype.factory(e.gmi_args,e)):DWait.ready("jms/pages/duperbrowse/stream/"+(this.gmi_args.duperbrowse_class||"Standard").toLowerCase()+".resource.stream.js",function(){ddt.log("Duperbrowse","Factory resource stream Dwait"),DuperbrowseStandardResourceStream.prototype.factory(e.gmi_args,e)})}},domReadOne:function(e){var t=(e.getAttribute("collect_rid")||"0:0").split(":");return[Number(t[0]),Number(t[1]),e]},domFindVisible:function(){var e={},t=this;return this.$.find("span.thumb, .tt-a, .tt-crop, .rs-customicon-cont, .gl-text").filter(.each(function(s){e[s+t.gs_offset]=this}),e},domReadMeta:function(){var e;if(this.gmi_args.query_params?(e=this.gmi_args.query_params.favby||this.gmi_args.query_params.gallery||"",this.gs_offset=Number(this.gmi_args.query_params.offset)||0,this.gs_count_per_page=this.gmi_args.query_params.length=Number(this.gmi_args.count_per_page),this.gs_title=this.gmi_args.title,this.gs_more_to_load=this.gmi_args.has_more):(e=this.gmi_args.query||"",this.gs_offset=Number(this.gmi_args.offset)||0,this.gs_count_per_page=Number(this.gmi_args.count_per_page)||24,this.gs_title=this.gmi_args.title,this.gs_more_to_load=this.gmi_args.more_to_load),e){var t=this.gs_offset;$(this.gmi_node).find(".tt-a,.tt-aa").each(function(){$(this).find("a.thumb, a.t").each(function(){var s=$(this),i=s.attr("href");if(i&&-1!=i.indexOf("/art/")&&-1==i.indexOf("?q=")){var r=i.indexOf("?")>-1?"&":"?";s.attr("href",i+r+"q="+encodeURIComponent(e)+"&qo="+t)}}),t++})}1===parseInt(this.gmi_args.duperbrowse_enabled,10)?this.gs_fetch_size=this.gs_count_per_page:this.gs_fetch_size=Math.max(24,this.gs_count_per_page),this.gs_fetch_bank=0},removeThumbFromView:function(e){var t=this.domFindVisible();(v=t[e])&&this.domRemoveItem(v)},refreshResources:function(e){this.removeThumbFromView(e),this.contents.splice(e,1);var t=Object.keys(this.contents).length,s=this.gs_offset+this.gs_count_per_page-1;t>this.gs_count_per_page?this.domDrawItem(s,this.contents[s]):this.gs_more_to_load&&this.dataFetch(s)},domDrawItem:function(e,t,s){var i,r,a;if(!(e>this.contents.length)){if(s=s||this.domFindVisible(),void 0==t)r=this.REQUEST_FETCH;else{if("string"==typeof t[2]){var o=document.createElement("div");o.innerHTML=t[2],t[2]=o.getElementsByTagName("*")[0]}i=t[2]}if(s[e]){if(i!=s[e]){if(a=this.preview_selector)if(a.isSelected(s[e])){var n=i.getAttribute("collect_rid");n&&n!=(s[e].getAttribute("collect_rid")||n)&&(a=null)}else a=null;if(void 0!=i&&($(i).insertBefore(s[e]),this.domRemoveItem(s[e])),a){if(!a.isSelectable(i))return void a.setRelativeSelection(1);a.setSelection(i)}}}else i&&(this.emMakeEditable(i),this.gmi_node.appendChild(i));return i&&i.setAttribute("gs_offset",e),r}},domRemoveItem:function(e){e.parentNode&&("A"==(e.nextSibling||{}).tagName&&e.parentNode.removeChild(e.nextSibling),e.parentNode.removeChild(e))},dataFetch:function(e){var t,s;s=(new Date).valueOf();var i={};this.gmi_args.query_params?i=this.gmi_args.query_params:this.gmi_args.fetch_proxy&&(i=this.gmi_args.fetch_proxy.gmi_args.query_params),i.offset=e,t=["PortalCore","get_result_thumbs",["gruser",i]];var r=t.join(";");t.push(this.dataFetchComplete.bind(this,r,e,this.gs_count_per_page,s)),this.active_fetches[r]>(new Date).valueOf()||(this.active_fetches[r]=(new Date).valueOf()+2e4,DiFi.pushPublicGet.apply(DiFi,t),DiFi.timer(this.gs_difi_delay||1))},dataFetchComplete:function(e,t,s,i,r,a){r?(this.cleanUpData(a.response.content.resources),this.gs_more_to_load=a.response.content.has_more,this.dataAdd(this.dataFilterArray(t,a.response.content.resources))):"NOEXEC_HALT"==a.response.status&&"file:"!=window.document.location.protocol||DiFi.stdErr(null,a.response.content)},dataAdd:function(e){var t=this.contents.map(;for(var s in e){if(-1==t.indexOf(e[s][1])){if(this.contents.length<this.gmi_args.count_per_page||$(this.gmi_node).find(".tt-a,.tt-aa").length<this.gmi_args.count_per_page){var i=$(e[s][2])[0];this.emMakeEditable(i),$(this.gmi_node).append(i)}this.contents[s]=e[s]}}},cleanUpData:function(e){var t;for(t in e)t in e.constructor.prototype||("number"!=typeof e[t][0]&&(e[t][0]=Number(e[t][0])),"number"!=typeof e[t][1]&&(e[t][1]=Number(e[t][1])))},dataCompare:setQuery:function(e){this.resource_stream_query=e,this.gs_offset=0,this.gs_total=e?void 0:0,this.contents=[],this.domDrawRange(0,24)},emMakeEditable:function(e){GMI.query(e,"GalleryArrowMenu")[0]||GMI.create("GalleryArrowMenu",{stream_proxy:this,has_remove_menu:this.gmi_args.has_remove_menu,selection_proxy:this.selector,browse_view_mode:this.gmi_args.browse_view_mode,mode:((this.gmiUp("Gruser")||this).gmi_args.group,"modern")}).addToStreamItem(e)}}),window.ResourceTV=ResourceStream.extend({}),window.GPageButton=ResourceStream.extend({domDrawItem:function(){},dataSplice:function(){},domFindVisible:function(){}}),window.RES_SEL_EXT={getAllSelectable:function(){var e,t,s;e=[];var i=$(this.root).children();for(t=0;s=i[t];t++)if(this.isSelectable(s))e.push(s);else if(1==s.nodeType&&"gmi-ResourceScatter"==s.getAttribute("name"))break;return e},isSelectable:function(e){var t=e.parentNode;if(!t)return!1;var s=$(e);if(s.closest("[rs_ignore]").length)return!1;var i=!1;try{i=1==window.deviantART.deviant.browseadult}catch(e){}return t==this.root&&s.is(".tt-a, .rs-customicon, .gl-text")&&!(!i&&s.is(".tt-ismature")&&s.closest("#browse2").length)&&!e.getAttribute("rs_ignore")}},window.ResourceStreamSimpleSelection=SimpleSelection.extend(RES_SEL_EXT),window.DWait&&DWait.run("jms/lib/gstream/resource_stream.js")});

DWait.ready(["jms/lib/difi.js","jms/lib/bind.js","jms/lib/jquery/jquery.current.js","jms/lib/gstream/resource_stream.js"],function(){window.PortalCoreResourceStream=ResourceStream.extend({dataFetch:function(e,t){var s=$.extend(this.gmi_args.query_params,{offset:Number(e),length:Number(t)}),r=this.gmi_args.portal||"gruser",i=["PortalCore","get_result_thumbs",[r,s]],a=i.join(";");i.push(this.dataFetchComplete.bind(this,a,e,t)),this.active_fetches[a]>(new Date).valueOf()||(this.active_fetches[a]=(new Date).valueOf()+2e4,DiFi.pushPublicGet.apply(DiFi,i),DiFi.timer(this.gs_difi_delay||1))},dataFetchComplete:function(e,t,s,r,i){var a=i.response.content;this.active_fetches[e]=1,r?(this.cleanUpData(a.resources),this.dataAdd(this.dataFilterArray(Number(t),a.resources instanceof Array?a.resources:[]))):"NOEXEC_HALT"!=i.response.status&&DiFi.stdErr(null,a)}}),window.DWait&&DWait.run("jms/lib/gstream/portal_core_resource_stream.js")});

DWait.ready(["jms/lib/Base.js"],function(){WatchableObject=Base.extend({constructor:addListener:function(i){if(!i)throw new Error("Blank listener");return this._wo_listeners.push(i),!0},removeListener:function(i){var s;for(s=0;s!=this._wo_listeners.length;s++)if(this._wo_listeners[s]==i)return this._wo_listeners.splice(s,1),this._wo_sm_i>=s&&this._wo_sm_i--,!0;return!1},broadcast:function(){if(void 0!=this._wo_sm_i)throw new Error("Possible WO feedback loop");try{for(this._wo_sm_i=0;this._wo_sm_i!=this._wo_listeners.length;this._wo_sm_i++)this._wo_listeners[this._wo_sm_i].apply(this,arguments)}finally{this._wo_sm_i=void 0}}}),window.DWait&&DWait.run("jms/lib/wo.js")});

DWait.ready(["jms/lib/browser.js","jms/lib/jquery/jquery.current.js","jms/lib/bind.js","jms/lib/wo.js"],function(){BFC=WatchableObject.extend({boot:function(){this.shout=this.shout.bind(this),"onhashchange"in window?window.onhashchange=this.event:this.location_interval||(this.location_interval=setInterval(this.shout,150),this.shout())},unboot:function(){this.location_interval?(clearInterval(this.location_interval),this.location_interval=null):window.onhashchange=null},addListener:function(t){this.shout(),this.base(t),t("navigate",this.previous)},event:function(){BackForward.shout()},shout:function(t){var o;if("string"==typeof t?o=t:window.location.hash.length>0?(o=$("<div>").text(window.location.hash).html().substr(1),o=o.replace("&amp;","&")):o="",this.previous!=o){if((new Date).valueOf()<(this.timeout||0))return;this.previous=o,this.broadcast("navigate",o)}},load:function(t,o){this.previous!=t&&(this.shout(t),t||(this.timeout=(new Date).valueOf()+800),window.location.hash=t)},iframe:function(t){var o;document.frames.da_backforward||($("<iframe>",{name:"da_backforward",id:"da_backforward",css:{position:"absolute",left:0,top:"-1000px",width:"1px",height:"1px"}}).prependTo("body"),this.IE_bypass_firstrun&&""!=window.location.hash||arguments.callee("")),o=document.frames.da_backforward,o.document.open("text/html"),o.document.write("<html><head><title>"+document.title+"</title></head><body onload=\"parent.location.hash = '"+t+"';parent.BackForward.shout()\"></body></html>"),o.document.close()}}),BackForward=new BFC,$(BackForward.boot()),window.DWait&&DWait.run("jms/lib/backforward.js")});

DWait.ready(["jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/lib/glbl.js","jms/lib/bind.js","jms/lib/backforward.js","jms/lib/wo.js"],function(){window.URLManagerBase=WatchableObject.extend({constructor:function(t,a){var i;this.base(),this.options=a||{},this.defaults=t||{},this.map={},this.cb=!1;for(i in this.defaults)this.map[i]=this.defaults[i];this.options.no_hash_change||BackForward.boot(),this.backforward_listen=BackForward.addListener(this.backforwardCallback.bind(this))},destructor:addListener:function(t,a){return a&&t(this.map,this.map),this.base(t)},set:function(t){var a,i;i={};for(a in this.map)i[a]=a in t?t[a]:this.map[a];this.options.no_hash_change?this.broadcast(i):BackForward.load(this.locationStateToString(i))},setLoadCallback:function(t){this.cb=t},backforwardCallback:function(t,a){var i;i=this.locationStringToState(a,{}),this.broadcast(i)},broadcast:function(t){window.Messages&&!Glbl("Location.pushstate_enabled")&&($.isEmptyObject(t)||$.each(t,function(a,i){"string"===$.type(i)&&i.match(/[?&]_sid=([abcdef0-9]+)/)&&(t[a]=i.replace(/[?&]_sid=([abcdef0-9]+)/,""),Glbl("Duperbrowse.message_centre_hack_skip_next_state_change",!0))}));var a,i,s;a={};for(i in this.defaults)(s=i in t?t[i]:(this.options.ignore_blanks?this.map[i]:null)||this.defaults[i])!=this.map[i]&&(a[i]=s,this.map[i]=s);for(i in a){this.base(t,a);break}this.cb&&(this.cb(),this.cb=!1)},locationStateToString:function(){throw new Error("I need subclassing")},locationStringToState:),window.URLQueryString=URLManagerBase.extend({locationStateToString:function(t,a){var i,s;s=[];for(i in this.map)i in t&&t[i]!=this.defaults[i]&&escape(t[i])&&s.push(i+"="+escape(t[i]));return s.join("&")},locationStringToState:function(t){var a,i,s;for(t=t.split("&"),s={},a=0;a!=t.length;a++)i=t[a].split("="),i[0]in this.map&&(s[i[0]]=unescape(i.slice(1).join("=")));return s}}),REG_BROWSE_OVERLAY=/^(edit)?\/d[0-9a-z]+$/,window.BrowseAwareURLQueryString=URLQueryString.extend({backforwardCallback:function(t,a){(a||"").match(REG_BROWSE_OVERLAY)||this.base.apply(this,arguments)}}),window.DWait&&DWait.run("jms/lib/urlmanager.js")});

DWait.ready(["jms/lib/urlmanager.js"],function(){window.URLBrowseLink=URLManagerBase.extend({locationStateToString:function(t,i){return t.deviationid?"/d"+Number(t.deviationid).toString(36):this.sp_url_backup||""},locationStringToState:function(t){var i="edit"==t.substr(0,4)?6:2,n=t.match(REG_BROWSE_OVERLAY)?parseInt(t.substr(i),36):this.spBackupURL(t);return{mode:6==i?"edit":"view",deviationid:n}},spBackupURL:),window.DWait&&DWait.run("jms/pages/superbrowse/browse_urlm.js")});

DWait.ready(["jms/lib/cbc.js","jms/lib/Base.js"],function(){PreviewLoaderQueueMasterCount=0,PreviewLoaderQueue=Base.extend({GUID:7,LOADER_WANT_IMAGE:1,LOADER_NOT_NEEDED:2,LOADER_FAILED:3,LOADER_COMPLETE:4,constructor:function(e,u){this.queue={},this.args=e,this.debug_label=u,this.current_pid=1e3,this.GUID+=PreviewLoaderQueueMasterCount++},setRequest:function(e,u,i,t){var s;e="d"+e,s=this.queue[e]||{},s.state!=this.LOADER_COMPLETE&&(s.working||i!=this.LOADER_NOT_NEEDED?this.queue[e]={state:i,working:s.working||0,node:u,cbc:t,cbcf:t&&t.pull()}:(this.queue[e]&&this.queue[e].cbc&&(this.queue[e].cbc.failures.push({err:"DO_NOT_WANT",human:"No longer desired"}),this.queue[e].cbcf()),this.queue[e]=null,delete this.queue[e]),this.runRequests())},queueCount:function(e){var u,i=0;for(u in this.queue)!this.queue[u].working&&e||i++;return i},runRequests:function(){var e,u,i,t,s;for(e=0,this.$_(u,null,"Look for jobs"),s=0;2!=s;s++)for(u in this.queue)if(i=this.queue[u],0==s&&i.working?e++:1!=s||i.state!=this.LOADER_WANT_IMAGE||i.working||(e++,i.working=1,this.$_(u,i,"Run"),i.pid=this.current_pid++,setTimeout(this.requestDone.bind(this,u,!1,i.pid),8e3),t=new CBC(this.requestDone.bind(this,u)),this.args.callback(u,i.node,t),t.start()),e>=1)break},requestDone:function(e,u,i){var t;if(!1===u){if(!this.queue[e]||i&&i!=this.queue[e].pid)return this.queue[e]&&(this.queue[e].working=0,this.queue[e].state=this.LOADER_FAILED),void this.$_(e,this.queue[e],"Fail: Soft");this.$_(e,this.queue[e],"Fail: Hard"),this.queue[e].working=0,this.queue[e].timeout_pid=i,t=1}else t=1,this.$_(e,this.queue[e],"Success");this.queue[e]&&this.queue[e].cbc?(u||this.queue[e].cbc.failures.push(i?"Loading timeout":"Unknown Failure"),this.queue[e].cbcf()):u&&this.$_(e,this.queue[e],"No callback"),t&&delete this.queue[e],this.runRequests()},_debugQueue:function(){var e,u,i;i={};for(e in this.queue)u=this.queue[e],i[e]=Number(u.working)+" / "+Number(u.working)+" ! "+(u.timeout_pid||"_");return i},$_:function(e,u,i){"Images"==this.debug_label&&window.DiFiBug&&DiFiBug.sessionUpdate(this,this.GUID+" ["+this.queueCount()+":"+this.queueCount(1)+"] "+(e||"%")+" ! "+i,!1,!0,!0)}}),$dppd=window.DWait&&DWait.run("jms/pages/superbrowse/loader_queue.js")});

DWait.ready(["jms/lib/pubsub.js","jms/lib/gmi.js"],function(){window.PreviewStreamControls=GMIBase.extend({gmiConstructor:function(){this.gmi_node.style.display="none",this.gmi_node.innerHTML=this.template,this.gmi_node.onmousemove=this.mouseOver.bind(this)},gmiDestructor:function(){delete this.switcher},template:'<a class="lrx l-arrow lldr" href="" onmousedown="GMI.up(this).left();" onclick="return GMI.evCancel()"><span class="slrx"></span></a> <a class="lrx r-arrow rrdr" href="" onmousedown="GMI.up(this).right();" onclick="return GMI.evCancel()"><span class="slrx"></span></a> <a class="lrx x-arrow h-ignore" href="" onclick="GMI.up(this).back();return GMI.evCancel()"><span class="flrx h-ignore">show all</span><span class="slrx h-ignore"></span></a> <a class="lrx x-text" href="" onclick="GMI.up(this).back();return GMI.evCancel()">show all</a> ',back:left:right:mouseOver:updateState:function(e,s){}}),window.DWait&&DWait.run("jms/pages/superbrowse/preview_controls_light.js")});

DWait.ready(["jms/lib/simple_selection.js","jms/pages/superbrowse/preview_stream.js","jms/pages/lub/lub_constants.js","jms/lib/gstream/resource_stream.js"],function(){window.PreviewStreamSelection=ResourceStreamSimpleSelection.extend({onclick:function(e){var t;for(e=e||window.event,t=e.target||e.srcElement;"A"!=t.tagName&&(t=t.parentNode););return!t||!(t.href.match(REG_DEVIATION_2)||t.href.match(REG_OLD_DEVIATION_2)||t.href.match(REG_DEVIATION_3))||this.base(e)},select:deselect:isSelected:function(e){return(e.className||"").indexOf("ps-selected")>=0},isSelectable:function(e){var t;return!!this.base(e)&&(t=OUTLINE_PreviewStream.previewLinkFromThumb(e),Boolean((e.className||"").indexOf("placeholder")>=0||(e.className||"").indexOf("tt-special")>=0||t&&(t.href.match(REG_DEVIATION_2)||t.href.match(REG_OLD_DEVIATION_2)||t.href.match(REG_DEVIATION_3))))},setRelativeSelection:function(e,t){var s,i,a,l,n;i=this.getSelection(!0),l=this.preview_stream_owner;for(a in i){if(a=Number(a),i=this.getAllSelectable(),a+e<0&&l.gs_offset>0)n=Math.max(0,l.gs_offset-l.gs_count_per_page),this.setSelection(null,"temporary_blank_selection"),l.previewLoadOffset(n),i=this.getAllSelectable(),s=i.length-1;else if(a+e>=l.gs_count_per_page||e>0&&a==i.length-1){if((n=l.gs_offset+l.gs_count_per_page)>l.contents.length||"1"!==l.gs_more_to_load)return;this.setSelection(null,"temporary_blank_selection"),l.previewLoadOffset(n),i=this.getAllSelectable(),s=0}break}void 0!=s?this.setSelection(i[s],t?"relative_keyboard":"relative"):this.base(e,t)},setSelection:function(e,t){return e&&this.isSelected(e)?(this.callback(this.getSelection(),[],t),!0):this.base(e,t)},onkeydown:),window.DWait&&DWait.run("jms/pages/superbrowse/preview_selection.js")});

DWait.ready(["jms/lib/browser.js","jms/lib/gstream/resource_stream.js"],function(){OUTLINE_PreviewStream={previewLinkFromThumb:function(e){var o;return o="object"==typeof e&&e.getElementsByTagName("a")||[],o[0]&&!o[0].href?o[1]:o[0]},domClearAll:function(){var e,o;e=this.domFindVisible();for(o in e)this.gmi_node.removeChild(e[o])}},window.PreviewStream=ResourceStream.extend(OUTLINE_PreviewStream),PreviewStream.scrollTo=function(e){window.scrollTo?window.scrollTo(0,e):(Browser.isGecko?document.documentElement:document.body).scrollTop=e||0,0===e&&Browser.isChrome&&setTimeout(1)},window.DWait&&DWait.run("jms/pages/superbrowse/preview_stream.js")});

DWait.ready([".domready","jms/lib/jquery/jquery.current.js","jms/lib/glbl.js","jms/lib/pubsub.js","jms/lib/Base.js"],function(){!function(o,i){var e=Base.extend({_GA_List:{1:"BrowseArt",2:"PrintsShop",3:"Journals",4:"Chat",5:"Today",6:"Forum",8:"MyProfile",10:"HelpFAQ",11:"MyJournal",18:"MyGallery",19:"MyFavorites",23:"RandomDeviant",24:"RandomDeviation",27:"DailyDeviation",33:"MyFriends",34:"Wallpaper",39:"Discover",40:"Critiques",42:"MyPortfolio",44:"Groups",45:"RandomGroup",54:"MyPoints",55:"MyEarnings",56:"Correspondence",90:"Muro",97:"Stash"},$node:null,constructor:function(){this.$node=o("#overhead"),this.$node.on},setHTML:function(i){if(i||this.backup){var e=this.$node.find("tr>*:not(.oh-mmain):not(.oh-gap):not(.oh-keep):not(.collectmenu)").detach();this.backup||(this.backup=e),i||(i=this.backup,this.backup=null);var n=o(i);Glbl("Site.is_stash")&&n.each(function(i,e){o(e).hasClass(".shorturl-publicview")&&this.$node.find("tr>.oh-gap").after(n.splice(i,1))}),this.$node.find("tr>.oh-mmain").after(n)}}});i.da_overhead_box=new e}(jQuery,window),window.DWait&&DWait.run("jms/chrome/overhead_html.js")});

DWait.ready(["jms/lib/jquery/plugins/jquery.easing.js","jms/lib/ruler.js","jms/lib/browser.js","jms/lib/events.js","jms/pages/lub/lub_constants.js","jms/lib/station.js","jms/lib/popup2.js","jms/lib/pubsub.js","jms/lib/difi.js","jms/lib/jquery/jquery.current.js","jms/lib/gmi.js"],function(){ResourceViewFavouriteButton=GMIBase.extend({add_text:"Add to Favourites",remove_text:"In Favourites",remove_text_alt:"Remove Favourite",add_collection_text:"Add new...",adding_text:"...",removing_text:"...",add_success_text:"Thanks!",remove_success_text:"Removed",gmiConstructor:function(){this.alive=1,this.refresh(),this.bind(),this.is_faved=Boolean(Number(this.gmi_args.is_faved)),PubSub.subscribe({eventname:"Lub.deviation_favourited",subscriber:this,callback:this.simulateButtonClick})},gmiDestructor:function(){this.alive=0,PubSub.unsubscribe({eventname:"Lub.deviation_favourited",subscriber:this})},bind:function(){var e=this;$(this.gmi_node).mouseover(this.mouseOver.bind(this)).mouseout(this.mouseOut.bind(this)).mousemove(this.mouseMove.bind(this)).click(,"gmi-ResourceViewFavouriteButton"==$(this.gmi_node).attr("id")&&(this.favesnav=$(this.gmi_node).parent().find("#favesnav ul"),this.favesnav.mousedown(this.favesnavMouseDown.bind(this)).mouseover(this.favesnavMouseDelay.bind(this)).mouseleave(this.favesnavMouseOut.bind(this)),this.favesnav_arrow=$(this.gmi_node).parent().find("#favesnav div.favesnav-downarrow"),this.favesnav_arrow.mouseover(this.favesnavMouseOver.bind(this)).mouseover(this.favesnavMouseAppearDelay.bind(this)).mouseleave(this.favesnavMouseOut.bind(this)).click(function(){return!1})),e.favesnav.bind("ADD_TO_COLLECTION",function(t,i,s){DiFi.pushPost("Deviation","add_favourite_to_folder",[e.gmi_args.id,i],function(t,s){if(!t)return void DiFi.stdErr("Could not add this deviation to your favourites. Please try again");e.got(!0,null,null,!1),PubSub.publish("BILogger.logEvent",{eventname:"click_add_to_collection_done",creatorid:e.gmi_args.creatorid,collectionid:i,typeid:e.gmi_args.typeid,itemid:e.gmi_args.id,sectionname:"side_bar",rank:0,view:"art"})}),DiFi.send()}),e.favesnav.bind("CREATE_COLLECTION",function(t){var i=e.favesnav.find("input.collection_name").val();""!=$.trim(i)&&$.trim(i)!=e.add_collection_text&&(e.favesnav.find("input.collection_name").val(e.add_collection_text),DiFi.pushPost("Gallections","create",[e.gmi_args.userid,RESOURCE_FAVCOLLECTIONS,i],function(t,s){if(!t)return void DiFi.stdErr("Could not create a collection",s.response.content.error);e.favesnav.trigger("ADD_TO_COLLECTION",s.response.content.gallectionid,!1),ResourceViewFavouriteButton.add_collection(s.response.content.gallectionid,i),i.length>22&&(i=i.substring(0,20)+"&hellip;");var n=$('<a href="#" cgalleryid="'+s.response.content.gallectionid+'">'+i+"</a>");e.favesnav.find("li.list").append(n),n.click(function(){return e.favesnav.trigger("ADD_TO_COLLECTION",s.response.content.gallectionid,!1),!1})}),DiFi.send())})},set:function(e,t,i,s){var n,o;if(this.alive){if(e&&(n=this.$.find("i, em").get(0),n.className=(s?"":"icon ")+e),o=this.$.find("b, strong, .label").get(0),o.innerHTML=t,"gmi-ResourceViewFavouriteButton"==$(this.gmi_node).attr("id"))return;o.style.color=i||"#121516"}},get:function(e,t){var i;return i=this.$.find("b, strong, .label").get(0),i.textContent||i.innerText},send:function(e){var t,i;this.busy||(this.mouseOut({currentTarget:this.gmi_node}),this.busy=1,t=!this.is_faved,i=t?"add_favourite":"remove_favourite",this.set("iconx-favesstar",t?this.adding_text:this.removing_text),DiFi.pushPost("Deviation",i,[this.gmi_args.id],this.got.bind(this),this),DiFi.timer(1),t&&PubSub.publish("BILogger.logEvent",{eventname:"thumb_fave",typeid:this.gmi_args.typeid,rank:0,view:"art",itemid:this.gmi_args.id,creatorid:this.gmi_args.creatorid}))},got:function(e,t,i,s){var n;if(this.busy=0,e)if(n=!this.is_faved||s,this.set("iconx-favesstar",n?this.add_success_text:this.remove_success_text,n?"#196BA7":null),n?$(this.gmi_node).addClass("active"):$(this.gmi_node).removeClass("active"),ResourceViewFavouriteButton.cache[this.gmi_args.id]=n,this.is_faved=n,this.busy=1,this.resetTimeout=setTimeout(this.reset.bind(this),2500),PubSub.publish("ResourceViewFavouriteButton.set",{id:this.gmi_args.id,faved:n}),s||window.da_minish_lub&&window.da_minish_lub.modCookie(!1,!0),n){if(!s){var o=$("em",this.gmi_node).offset();o.top-=10,$('<span id="favup-star"></span>').css(o).insertAfter("body").animate({top:"-=36"},{duration:650,complete:function(){$(this).remove()},easing:"easeOutSine"})}window.deviantART.pageData.catpath&&0!==window.deviantART.pageData.catpath.indexOf("flash")&&setTimeout(this.popupReminder.bind(this),400),PubSub.publish("Deviation.add_favourite",{deviationid:this.gmi_args.id})}else PubSub.publish("Deviation.remove_favourite",{deviationid:this.gmi_args.id});else this.reset(!0,this.is_faved),i||DiFi.stdErr("Unable to +favourite",t.response.content)},refresh:function(){void 0!==ResourceViewFavouriteButton.cache[this.gmi_args.id]&&!this.busy&&this.alive&&this.reset(null,ResourceViewFavouriteButton.cache[this.gmi_args.id])},reset:function(e,t){var i;this.busy=0,i=!0===t||!1===t?t:Number(!0===e)^Number(this.is_faved),this.set("iconx-favesstar",i?this.remove_text:this.add_text),i?$(this.gmi_node).addClass("active"):$(this.gmi_node).removeClass("active"),i?$(this.gmi_node).parent().find("#favesnav").hide():$(this.gmi_node).parent().find("#favesnav").show()},simulateButtonClick:function(e,t){this.gmi_args.id==t.deviationid&&this.got(!0,null,!1,!0)},popupReminder:function(){var e,t;if(this.alive&&!(window.TalkPostWrapper||{}).one_comment_posted&&this.gmi_args.comments_allowed){if(e=$(".dev-title-avatar"),!e.is(":visible"))return;e=e.find("img:first"),e.length&&(t=new Popup2("favedOverMore","body",{classes:"darkspeech",content:"<div class=dsp>&nbsp;</div><i class=pbq></i>",destroy:!0,shown:function(){Station.push(this.$node.get(0).firstChild.firstChild,"nodeValue",{from:"",to:"Don't forget to\nadd a comment!",time:500,f:Interpolators.line})},events:[{selector:"*",event:"click",callback:function(){GMI.query("TalkPostWrapper")[0].talkpost.focus()}}]}),t.show(t.position(e,{valign:"top",keepOnScreen:!1})))}},populateCollectionMenu:function(e){var t=this;t.favesnav.html(""),t.favesnav.append("<li><div>Add To:</div></li>");var i=$('<li class="list"></li>');t.favesnav.append(i);for(var s=0,n=e.length;s<n;s++){var o=e[s];o.featured=!1,"Featured"==o.title&&(o.title="Favourites",o.featured=!0),o.title.length>22&&(o.title=o.title.substring(0,20)+"&hellip;"),i.append('<a href="#" data-featured="'+o.featured+'" cgalleryid="'+o.gallectionid+'">'+o.title+"</a>")}t.favesnav.append('<li class="add_new"><input class="collection_name wide" value="'+t.add_collection_text+'" /><a class="new_collection">Add</a></li>'),t.favesnav.find("a").click(function(){if($(this).hasClass("new_collection"))return t.favesnav.trigger("CREATE_COLLECTION"),!1;var e=$(this).attr("cgalleryid");return t.favesnav.trigger("ADD_TO_COLLECTION",[e,$(this).data("featured")]),!1}),t.favesnav.find("input.collection_name").bind({focus:function(){t.favesnav.addClass("stick stick-perm"),$(this).val()==t.add_collection_text&&($(this).removeClass("wide").val(""),$(this).next("a").show())},blur:function(){t.favesnav.removeClass("stick stick-perm"),""==$(this).val().trim()&&($(this).addClass("wide").val(t.add_collection_text),$(this).next("a").hide())},keypress:function(e){13==(e.keyCode?e.keyCode:e.which)&&t.favesnav.trigger("CREATE_COLLECTION")}})},mouseOver:function(e){this.gmi_node==e.currentTarget&&this.is_faved&&!this.busy&&$(this.gmi_node).addClass("remove smbutton-red").find("b,strong").html(this.remove_text_alt)},mouseOut:function(e){this.gmi_node==e.currentTarget&&$(this.gmi_node).hasClass("remove")&&$(this.gmi_node).removeClass("remove smbutton-red").find("b,strong").html(this.remove_text)},mousePos:{left:0,top:0},mouseMove:favesnavMouseOver:function(e){if(this.favesnav_arrow[0]==e.currentTarget&&!$(this.gmi_node).hasClass("remove")&&!$(this.gmi_node).hasClass("active")){var t,i=this;this.favesnavMouseDelay(),this.favesnav.hasClass("favesnav-load")||(t={eventname:"click_add_to_collection",typeid:this.gmi_args.typeid,itemid:this.gmi_args.id,sectionname:"side_bar",rank:0},Glbl("Bi.view")?t.view=Glbl("Bi.view"):null!==e.currentTarget.baseURI.match(/\/watch/)?t.view="watch":e.currentTarget.baseURI.match(/[A-Za-z0-9\-]{3,20}\/art\//)?t.view="art":t.view="other",Glbl("Bi.component")&&(t.component=Glbl("Bi.component")),PubSub.publish("BILogger.logEvent",t),void 0===ResourceViewFavouriteButton.collection_cache?(this.favesnav.addClass("favesnav-load"),DiFi.pushPrivateGet("Gallections","get_gallections",[i.gmi_args.userid,RESOURCE_FAVCOLLECTIONS],function(e,t){if(i.favesnav.removeClass("favesnav-load"),!e)return void DiFi.stdErr("Could not get the list of your collections");ResourceViewFavouriteButton.collection_cache=[];for(var s=0,n=t.response.content.length;s<n;s++)ResourceViewFavouriteButton.add_collection(t.response.content[s].gallectionid,t.response.content[s].title);i.populateCollectionMenu(ResourceViewFavouriteButton.collection_cache)}),DiFi.send()):i.populateCollectionMenu(ResourceViewFavouriteButton.collection_cache))}},favesnavUnstick:null,favesnavMouseDelay:function(){var e=this.favesnav;e.addClass("stick"),clearTimeout(this.favesnavUnstick),e.hasClass("favesnav-wait")&&!e.hasClass("stick-perm")?e.removeClass("stick"):this.favesnavUnstick=setTimeout(300)},favesnavMouseAppearDelay:function(){var e=this.favesnav;e.addClass("favesnav-wait"),clearTimeout(this.favesnavAppear),this.favesnavAppear=setTimeout(function(){e.removeClass("favesnav-wait"),clearTimeout(this.adsAppear),Popup2.hideOverlayElements($(this.favesnav))},150)},favesnavMouseOut:function(){var e=$("#favesnav");clearTimeout(this.favesnavAppear),e.hasClass("favesnav-wait")||(this.favesnavMouseDelay(),this.adsAppear=setTimeout(function(){Popup2.showOverlayElements()},300)),e.removeClass("favesnav-wait")},favesnavMouseDown:),ResourceViewFavouriteButton.cache={},ResourceViewFavouriteButton.collection_cache=void 0,ResourceViewFavouriteButton.add_collection=function(e,t){void 0===ResourceViewFavouriteButton.collection_cache&&(ResourceViewFavouriteButton.collection_cache=[]),ResourceViewFavouriteButton.collection_cache.push({gallectionid:e,title:t})},DWait.init("ResourceViewFavouriteButton.click",,ResourceViewWatchButton=ResourceViewFavouriteButton.extend({send:function(){var e;this.busy||(this.busy=1,e="Add"==this.get().substr(0,3),this.set("",e?"Adding...":"Removing..."),e?DiFi.pushPost("Friends","addFriendGetAttributes",[this.gmi_args.username,"deviation"],this.got.bind(this),this):DiFi.pushPost("Friends","removeFriend",[this.gmi_args.username],this.got.bind(this),this),DiFi.timer(1))},got:function(e,t,i){var s;this.busy=0,e?(s="Add"==this.get().substr(0,3),this.set("",s?"Now Watching!":"Removed",s?"#196BA7":null),ResourceViewFavouriteButton.cache[this.gmi_args.id]=s,this.busy=1,setTimeout(this.reset.bind(this),2500)):(this.reset(!0),i||DiFi.stdErr("Unable to alter deviantWATCH",t.response.content))},refresh:function(){},reset:function(e,t){var i;this.busy=0,i=!0===t||!1===t?t:Number(!0===e)^Number(this.get().substr(0,3)in{Now:1,Add:1}),this.set(i?"i25":"i24",i?"Remove from deviantWATCH":"Add to deviantWATCH",!1,!0)}}),ResourceViewCollectButton=ResourceViewFavouriteButton.extend({gmiConstructor:function(){this.base(),this.mouseup_handler=this.mouseup_handler.bind(this),Events.hook(document.documentElement,"mouseup",this.mouseup_handler)},gmiDestructor:function(){this.base(),Events.unhook(document.documentElement,"mouseup",this.mouseup_handler)},send:function(){return this.ignore_onclick?(this.ignore_onclick=0,!1):this.busy?this.off():this.on()},on:function(){if(this.busy)return!1;this.busy=1;var e,t;return!!(e=document.getElementById("deviation-collect-bubble"))&&(Browser.isIE&&"iframe"!=e.firstChild.tagName.toLowerCase()&&document.getElementsByTagName("iframe").length&&e.insertBefore(document.createElement("iframe"),e.firstChild),"block"!=e.style.display&&(t=!document.getElementsByTagName("film").length,t?(e.style.left="0px",e.style.top="-25px",e.style.position="relative"):(e.style.left="152px",e.style.top=Ruler.document.node(document.getElementById("collect-button")).y-(t?Ruler.screen.rect().y2:-7)-6+"px"),e.style.display="block"),!1)},off:function(){if(this.busy){this.busy=0;document.getElementById("deviation-collect-bubble").style.display="none"}},mouseup_handler:function(e){var t=e.target||e.srcElement;!this.busy||"gmi-ResourceViewCollectButton"!=t.id&&"gmi-ResourceViewCollectButton"!=t.parentNode.id&&"gmi-ResourceViewCollectButton"!=t.parentNode.parentNode.id||(this.ignore_onclick=1),$(t).closest("#deviation-collect-bubble")[0]||this.busy&&setTimeout(this.off.bind(this),500)},got:refresh:function(){},reset:function(){this.set("","Request as Print"),GMI._delete(this)}}),ResourceViewShare=GMIBase.extend({gmiConstructor:function(){var e=$("body"),t=this.$.find(".social-title"),i=this.$.find(".share-button"),s=i.filter(".more"),n=s.find(".deviation-share-links-dropdown"),o=t.text();i.on("mouseenter.share",function(){t.text($(this).data("title")||o)}).on("mouseleave.share",function(){t.text(o)}),n.on("mousedown.share",,s.on("mousedown.share",function(){s.toggleClass("active").hasClass("active")?(n.appendTo(e).css($(this).offset()).fadeIn(),Popup2.hideOverlayElements(n),setTimeout(function(){e.on("mousedown.share",,n.find("input.link").click()},0)):(n.find("input").attr("selectionEnd",0),n.hide().appendTo(s),Popup2.showOverlayElements(),e.off("mousedown.share"))}),this.gmiDestructor=function(){e.trigger("mousedown.share"),e.add(i).add(n).add(s).off(".share")}}}),ResourceViewShareTumblr=GMIBase.extend({gmiConstructor:function(){this.$node=$(this.gmi_node),this.$node.click(function(){if($(this).hasClass("tumblr-tab"))return!0;var e=$(this).data("deviation-id"),t=$(this).attr("openurl"),i=window.open("about:blank","sharetumblr"+e,"toolbar=0,status=0,resizable=yes,width=450,height=480");return!i||(i.document.open(),i.document.write('<meta http-equiv="refresh" content="0; url='+t+'">'),i.document.close(),!1)})},gmiDestructor:),window.DWait&&DWait.run("jms/pages/superbrowse/resview/devbuttons.js")});

DWait.ready(["jms/lib/gmi.js"],function(){window.GPageButton||(window.GPageButton=GMIBase.extend({gmiConstructor:function(){}})),window.DWait&&DWait.run("jms/pages/superbrowse/resview/extras.js")});

DWait.ready(["jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/lib/pubsub.js","jms/lib/browser.js","jms/lib/jquery/jquery.current.js","jms/lib/gmi.js"],function(){RESVIEW_OUTLINE={gmiConstructor:function(){},gmiDestructor:function(){},deviationChangeView:,ResourcePageMetaPane=GMIBase.extend(RESVIEW_OUTLINE).extend({gmiConstructor:),ResourcePageAboutPane=GMIBase.extend(RESVIEW_OUTLINE),ResourcePageAd=GMIBase.extend({gmiConstructor:function(){this.position=this.position.bind(this),this.refresh2=this.refresh2.bind(this),this.z=new AdZone([" "," "],{section:"deviation"},"300x250",this.gmi_args.timer||8,null),this.z.frame_zone=this.gmi_args.frame_zone,this.z.no_ignores=1,this.z.allow_key_changes=1,this.z.no_refetch_while_busy=1,this.z.always_flush_difi=1,this.reset(300,250,0,1),this.gmi_node.style.marginBottom="7px",this.gmi_node.style.position="relative"},gmiDestructor:reset:function(t,i,s,e){var o;this.gmi_node.style.width=t+"px",this.gmi_node.style.height=i+"px",o=t+"x"+i,this.z.master_anchor=this.gmi_node,this.z.size=o,this.mature=s,e||this.refresh()},hide:function(){this.z.hide(),this.gmi_node.style.display="none"},refresh:function(t,i,s){if(void 0!=t){if(this.last_id==t&&i==this.mature)return;this.last_id=t}this.z.hide(),this.gmi_node.style.display="block",void 0!=i&&(this.mature=i),this.z.keys.catid=s||0,this.z.keys.deviationid=t||0,this.z.need(this.mature,0),this.refresh2()},refresh2:position:function(t){!0===t?(this.z.hide(),this.z.position(),setTimeout(this.refresh2,150)):this.z.position()}}),ResourcePageLowerAd=ResourcePageAd.extend({}),ResViewSizer_img=GMIBase.extend({gmiConstructor:),ResViewSizer_fullimg=ResViewSizer_img,ResViewSizer_cinemaplayer=GMIBase.extend({adjustTextAd:function(){$("body").hasClass("fullview")||$(".textbanner-ad").css("top",this.$.height()+20)},gmiDestructor:function(){this.restoreTextAd()},restoreTextAd:),function(){var t=0;window.ResourcePageBtfDockAd=GMIBase.extend({gmiConstructor:function(){this.$win=$(window),Browser.isPad||(this.event_ns="scroll.BtfDockAd"+ ++t,this.dock_padding_btm=0,this.dock_padding_top=12,$("#head").length&&(this.dock_padding_top=72),this.$bubbleview=this.$.closest(".bubbleview"),this.$rescontainer=this.$.closest(":gmi(DeviationPageView)"),this.$metapane=this.$rescontainer.find(".dev-view-meta"),this.$bubbleview.length&&(this.bv_cached_height=this.$bubbleview.height(),PubSub.publish("ResourcePageBtfDockAd.state_changed",{state:"relative",el:this.$}),this.bindScroll(this.normalScrollHandler)))},gmiDestructor:function(){this.unbindScroll()},bindScroll:function(t){return DWait.ready("jms/lib/jquery/plugins/jquery.throttle-debounce.js",function(){this.$win.on(this.event_ns,$.throttle(100,t.bind(this)))}.bind(this)),this},unbindScroll:rebindScroll:sbClosed:function(){PubSub.unsubscribe({eventname:"Duperbrowse.closed",subscriber:this}),this.rebindScroll(this.normalScrollHandler)},sbOpen:function(){PubSub.subscribe({eventname:"Duperbrowse.closed",subscriber:this,callback:this.sbClosed}),this.unbindScroll()},readBounds:function(){if(!this.bounds||this.$bubbleview.height()!=this.bv_cached_height){if(this.bv_cached_height=this.$bubbleview.height(),!this.bv_cached_height)return this.sbOpen(),{top:0,btm:0,h:0};var t=this.$rescontainer.offset().top;if(this.bounds){var i=this.$.css("position"),s=this.$.css("top");this.$.css({position:"relative",top:"auto"}),this.bounds.h=this.$.height(),this.bounds.top=this.$.offset().top-this.dock_padding_top,this.bounds.btm=t+this.$rescontainer.outerHeight()-this.dock_padding_top-this.bounds.h,this.$.css({position:i,top:s})}else{var e=this.$.height();if("none"===this.$.css("display")&&(this.unbindScroll(),this.$.remove(),this.$=$()),!e||!this.$.parent().length)return{top:0,btm:0,h:0};this.bounds={h:e,top:this.$.offset().top-this.dock_padding_top,btm:t+this.$rescontainer.outerHeight()-this.dock_padding_top-e}}this.bounds.btm-=15,this.bounds.able=this.bounds.top<this.bounds.btm-t}return this.bounds},normalScrollHandler:function(){var t=this.readBounds(),i=this.$win.scrollTop();t.able&&t.top<=i&&(this.$.css({position:"fixed",top:this.dock_padding_top}),this.rebindScroll(this.undockedScrollHandler),PubSub.publish("ResourcePageBtfDockAd.state_changed",{state:"fixed",el:this.$}),this.h1evt||(this.h1evt=!0,this.undockedScrollHandler()))},undockedScrollHandler:function(){var t=this.readBounds(),i=this.$win.scrollTop();i>=t.btm?(this.$.css({position:"absolute",top:t.btm+this.dock_padding_btm-this.$metapane.offset().top}),this.rebindScroll(this.btmdockScrollHandler),PubSub.publish("ResourcePageBtfDockAd.state_changed",{state:"absolute",el:this.$})):i<=t.top&&(this.$.css({position:"relative",top:"auto"}),this.rebindScroll(this.normalScrollHandler),PubSub.publish("ResourcePageBtfDockAd.state_changed",{state:"absolute",el:this.$}))},btmdockScrollHandler:function(){var t=this.readBounds(),i=this.$win.scrollTop();t.btm>i&&(this.$.css({position:"fixed",top:this.dock_padding_top}),this.rebindScroll(this.undockedScrollHandler),PubSub.publish("ResourcePageBtfDockAd.state_changed",{state:"fixed",el:this.$}))}})}(),window.DWait&&DWait.run("jms/pages/superbrowse/resview/respage_components.js")});

DWait.ready([".domready","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/lib/popup2.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/lib/browser.js","jms/lib/gwebpage.js","jms/lib/difi.js","jms/lib/pubsub.js","jms/lib/glbl.js","jms/lib/gmi.js","jms/pages/superbrowse/resview/respage_components.js","jms/lib/gstream/resource_stream.js"],function(){!function(i){function e(i,e,t,s){var n=i/t,o=e/s,a={w:i,h:e};return n<=1&&o<=1?a:(n>o?(a.w=t,a.h=Math.round(e/n)):(a.h=s,a.w=Math.round(i/o)),a)}function t(i,t,s,n){var o,v=(document.body||{}).clientWidth||window.innerWidth||document.documentElement.offsetWidth,f=window.innerHeight||document.documentElement.offsetHeight,w=v-a-l-d,g=w-_,b=f-r-u-h-c-m,p={};return g=Math.max(300,g),b=Math.max(300,b),o=e(i,t,g,b),o.h<200&&(o.top=Math.round((200-o.h)/2)),s<=v?(p.w=s,p.h=n,o.top&&(p.top=o.top)):(dw=s/v,p.w=v,p.h=Math.round(n/dw)),{normal:o,full:p,full_zoomed:{w:s,h:n}}}function s(e){var t=i(e.currentTarget),s=t.closest(":gmi(DeviationPageView)").removeClass("agegated").gmi1();s?s.display_mature():t.length&&t.closest(".blogcontrol, .gr-featured_deviation, .deviation-plain-view").find(".dev-content-mature-hidden").removeClass("dev-content-mature-hidden").end().find(".dev-content-mature").hide()}var n=!(window.deviantART||{deviant:{}}).deviant.loggedIn||(window.deviantART||{deviant:{}}).deviant.ads,o=Boolean(((window.deviantART||{}).pageData||{}).with_apps),a=331,l=10,d=10,_=0,h=n?60:0,r=43,u=o?25:0,c=8,m=12;(((deviantART||{}).pageData||{}).ads||{}).atf_top_970x90&&(h=90);var v=function(i,e,t,s,n,o){this.name=i,this.layout_class=e,this.full_width=Boolean(t),this.in_zoom_cycle=Boolean(s),this.$content=n,this.default_mode=o},f={};window.DeviationPageView=GMIBase.extend({_available_modes:[],_view_modes:{},_current_mode:"normal",_default_mode:"normal",_$meta:null,_$deviation:null,_$about:null,_$normal:null,_$full:null,_$agegate:null,_$detached_deviation_contents:null,_contains_embeds:null,_display_sizes:null,_original_sizes:null,_user_zoomed_in:!1,_is_fullwidth_layout:!1,_on_resize_callback:null,gmiConstructor:function(){var e=this.$.children(".dev-view-main-content");this.gmi_args.fullview_requested&&(this.gmi_args.fullview_requested="1"==this.gmi_args.fullview_requested),this._$meta=this.$.children(".dev-view-meta"),this._$about=e.children(".dev-view-about"),this._is_fullwidth_layout=!Boolean(this._$about.siblings(".dev-view-deviation").length),this._is_fullwidth_layout?this._$deviation=this.$.children(".dev-view-deviation"):this._$deviation=e.children(".dev-view-deviation");var t=this._$deviation.children(".dev-content-mature-hidden, .dev-content-blocked-hidden").addBack();if(this._$normal=t.children("img.dev-content-normal"),this._$full=t.children("img.dev-content-full"),this._$agegate=t.find(".devpage_gate"),this._contains_embeds=Boolean(this._$deviation.find("iframe").length),this._available_modes=[],this._user_zoomed_in=Boolean(((window.deviantART.pageData||{}).user||{}).fullview_all),this._is_normal_content()){this._view_modes={normal:new v("normal","normal",!1,!0,this._$normal,!0),full:new v("full","full",!0,!0,this._$full,!0),full_zoomed:new v("full_zoomed","full_zoomed",!0,!0,this._$full,!0)},this._original_sizes={normal:{w:Number(this._$normal.attr("width")),h:Number(this._$normal.attr("height"))},full:{w:Number(this._$full.attr("width")),h:Number(this._$full.attr("height"))}};var s=this.gmi_args.fullview_requested||this._user_zoomed_in;this._default_mode=this._current_mode=s?"full":"normal"}else{var n=this._$deviation.find(".dev-content-mature-hidden, .dev-content-blocked-hidden"),o=(this._$deviation.find(".journal-wrapper"),n.length?n:this._$deviation),a=o.children().not(".dev-content-hidden");this._view_modes={default:new v("default","normal",!1,!1,a,!0)},this._default_mode=this._current_mode="default"}var l=this._$deviation.find(".dev-content-mature");l.length&&(this._view_modes.mature=new v("mature","normal",!1,!1,l,!0),this._current_mode="mature"),this._$deviation.find(".dev-content-blocked").length&&(this._view_modes.blocked=new v("blocked","normal",!1,!1,l,!0),this._current_mode="blocked"),this._on_resize_callback=i.throttle(50,this._on_resize.bind(this)),i(window).on("resize",this._on_resize_callback),this._on_resize(),this._$deviation.find(".dev-challenge-box").css("visibility","visible"),"full"!=this._current_mode&&this._should_force_full()?this.change_to_mode("full",!0):"full"==this._current_mode?-1==i.inArray("full",this._available_modes)?this.change_to_mode("normal"):this.change_to_mode("full",!0):"default"==this._current_mode&&this.change_to_mode("default",!0),"mature"===this._current_mode&&f[this.gmi_args.deviationid]&&this.display_mature(),this._$normal.add(this._$full).on("click.dev-page-view",this._image_click.bind(this)),Glbl("Minibrowse.opened")||(PubSub.subscribe([{eventname:"Minibrowse.closed",subscriber:this,callback:this.handlers.minibrowse_close.bind(this)}]),this._contains_embeds&&PubSub.subscribe([{eventname:"Minibrowse.open",subscriber:this,callback:this.handlers.minibrowse_open.bind(this)}])),i(":gmi(ResourcePageBtfDockAd)",this._$meta).gmi(),i(":gmi(ResourceStream)",this._$meta).gmi()},gmiDestructor:function(){i(window).off("resize",this._on_resize_callback),this._$deviation.find("img").off(".dev-page-view")},_calc_sizes:function(){this._original_sizes&&(this._display_sizes=t(this._original_sizes.normal.w,this._original_sizes.normal.h,this._original_sizes.full.w,this._original_sizes.full.h)),this._determine_available_modes()},_determine_available_modes:function(){if(this._available_modes=["normal"],this._original_sizes&&(this._original_sizes.full.w>this._display_sizes.normal.w||this._user_zoomed_in)&&(this._available_modes.push("full"),this._display_sizes.full.w<this._original_sizes.full.w&&this._available_modes.push("full_zoomed")),!this._original_sizes){this._available_modes=["default"];var i=this._$deviation.find(".journal-wrapper");if(i.length&&this.gmi_args.fullview_requested){var e=this._$deviation.find(".dev-content-mature-hidden, .dev-content-blocked-hidden"),t=e.length?e:this._$deviation,s=t.children().not(".dev-content-hidden");this._available_modes.push("full"),this._view_modes.full=new v("full","full",!0,!0,s,!0),this._default_mode=this._current_mode="full"}(0===i.length&&this._$deviation.find("film,iframe,#news-special").length||0==i.length&&this.gmi_args.fullview_requested)&&(this._view_modes.default.layout_class="full",this._view_modes.default.full_width=!0)}for(var n in this._view_modes)this._view_modes.hasOwnProperty(n)&&!this._view_modes[n].default_mode&&this._available_modes.push(this._view_modes[n].name);return this._available_modes},_should_force_full:function(){return-1!==i.inArray("full",this._available_modes)&&this._original_sizes.full.h>=25*this._original_sizes.full.w},_is_normal_content:function(){return this._$normal.length&&!this._$deviation.find("#pdf-viewer").length},_on_resize:function(){if(this._calc_sizes(),this._original_sizes){var i=this._$normal.add(this._$agegate),e=this._$normal.siblings(".dev-challenge-box");i.width(this._display_sizes.normal.w).height(this._display_sizes.normal.h),e.width(this._display_sizes.normal.w),this._display_sizes.normal.top?(i.css({top:this._display_sizes.normal.top+"px",position:"relative"}),e.css("margin-top",this._display_sizes.normal.top+"px")):(i.css("top","0px"),e.css("margin-top","0")),"full"==this._current_mode&&(this._$full.width(this._display_sizes.full.w).height(this._display_sizes.full.h),e.width(this._display_sizes.full.w),this._display_sizes.full.top?(this._$full.css({top:this._display_sizes.full.top+"px",position:"relative"}),e.css("margin-top",this._display_sizes.full.top+"px")):(this._$full.css("top","0px"),e.css("margin-top","0")))}else this._$agegate.length>0&&this._$agegate.css({width:"100%",height:"auto",top:"0"});this._set_zoom_cursor()},_image_click:function(){if(this._view_modes[this._current_mode].in_zoom_cycle){var i=this._cycleable_available_modes();if(i.length>1){for(var e=!1,t=0;t<i.length;t++){if(e)return void this.change_to_mode(i[t]);i[t]==this._current_mode&&(e=!0)}e&&this.change_to_mode(i[0])}}},_cycleable_available_modes:function(){var i,e=[];for(i=0;i<this._available_modes.length;i++)this._view_modes[this._available_modes[i]].in_zoom_cycle&&e.push(this._available_modes[i]);return e},_set_zoom_cursor:function(){this.$.removeClass("cursor-zoom-in cursor-zoom-out");var e=this._cycleable_available_modes(),t=i.inArray(this._current_mode,e);e.length>1&&t>=0&&(e[this._available_modes.length-1]==this._current_mode||-1==t?this.$.addClass("cursor-zoom-out"):this.$.addClass("cursor-zoom-in"))},change_to_mode:function(e,t){if(-1!=i.inArray(e,this._available_modes)&&(t||e!=this._current_mode)){var s=this._view_modes[this._current_mode],n=this._view_modes[e];this._current_mode=e,this.$.removeClass("view-mode-normal view-mode-full view-mode-"+s.layout_class).addClass("view-mode-"+n.layout_class),Glbl("Site.is_mobile")||(n.full_width&&!this._is_fullwidth_layout?(this._$deviation.insertBefore(this._$about.parent(".dev-view-main-content")),this._is_fullwidth_layout=!0):!n.full_width&&this._is_fullwidth_layout&&(this._$deviation.insertBefore(this._$about),this._is_fullwidth_layout=!1),i("body").toggleClass("fullview",n.full_width)),"full"==n.name&&this._display_sizes&&n.$content.width(this._display_sizes.full.w).height(this._display_sizes.full.h),"full_zoomed"==n.name&&this._display_sizes&&n.$content.width(this._display_sizes.full_zoomed.w).height(this._display_sizes.full_zoomed.h),this._$deviation.children(":visible:not(.dev-content-mature, .dev-content-blocked, .dev-challenge-box)").hide(),n.$content.show();var o=n.$content.filter(":visible"),a=this._$deviation.children(".dev-challenge-box");return a.css("width",o.css("width")),"auto"!=o.css("top")&&a.css("margin-top",o.css("top")),this._set_zoom_cursor(),window.setTimeout(1),s.name}},get_about_content_node_for_abuse:function(){return this._$about.find(".dev-view-about-content")},get_meta_content_node_for_abuse:get_deviation_offset_for_abuse:add_custom_view_mode:function(e,t,s,n){this._$deviation.find(".dev-content-"+e).remove();var o=new v(e,t,s,!1,i('<div class="dev-content-'+e+'"></div>').append(n).hide(),!1);return this._$deviation.append(o.$content),this._view_modes[e]=o,this._determine_available_modes(),this},get_view_mode_sizes:function(i){if(this._display_sizes&&this._display_sizes[i])return this._display_sizes[i]},display_mature:function(){f[this.gmi_args.deviationid]=1,this._$deviation.find(".dev-content-mature-hidden").children().appendTo(this._$deviation),this._$deviation.find(".dev-content-mature-hidden,.dev-content-mature").remove(),this.change_to_mode(this._default_mode,!0)},handlers:{minibrowse_open:function(i,e){null===this._$detached_deviation_contents&&(this._$detached_deviation_contents=this._$deviation.contents().detach())},minibrowse_close:function(i,e){this.change_to_mode(this._default_mode,!0),this._$detached_deviation_contents&&(this._$deviation.append(this._$detached_deviation_contents),this._$detached_deviation_contents=null)}}}),DeviationPageView.edit_check=function(){!Glbl("Minibrowse.opened")&&location.href.match(/[?|&]edit=1/)?DWait.ready("jms/pages/ile/ile.js",function(){i(".dev-page-container").prepend(i("#ile-container")),PubSub.publish("InlineEditor.open")}):location.href.match(/[?|&]edit=1/)&&PubSub.publish("DeviationPageEditor.preload"),Glbl("Site.is_deviantart")&&"edit"==location.hash.replace(/^#/,"")&&PubSub.publish("DeviationPageEditor.open")},DeviationPageView.edit_check(),DeviationPageView.scale_to_fit=e,DeviationPageView.get_max_content_height=function(i){var e=i?0:r+u;return(window.innerHeight||document.documentElement.offsetHeight)-e-h},window.DownloadButton=GMIBase.extend({$:null,events:{click:function(e){if(i("body > .download_ad").length&&window.DownloadAd.open(this.gmi_args.deviationid,this.gmi_args.download_url))return!1;if("open_in_window"==this.gmi_args.download_type&&!Glbl("Site.is_mobile")){return this.open_download_window(this.gmi_args.download_url,this.gmi_args.download_width,this.gmi_args.download_height)}return!0}},handlers:{continue_download:function(i,e){if(e.id==this.gmi_args.deviationid&&e.url==this.gmi_args.download_url)if("open_in_window"==this.gmi_args.download_type&&!Glbl("Site.is_mobile")&&e.from_click){var t=this.open_download_window(this.gmi_args.download_url,this.gmi_args.download_width,this.gmi_args.download_height);t&&(window.location=this.gmi_args.download_url)}else window.location=this.gmi_args.download_url}},gmiConstructor:function(){this.bind()},gmiDestructor:function(){this.$.off(".download_button"),PubSub.unsubscribe([{eventname:"DownloadAd.close",subscriber:this}])},bind:function(){this.$.on("click.download_button",this.events.click.bind(this)),PubSub.subscribe([{eventname:"DownloadAd.close",subscriber:this,callback:this.handlers.continue_download}])},open_download_window:function(i,e,t){var s;if(Browser.isTouch)return!0;if(Browser.isChrome||Browser.isSafari){var s=window.open(i,null,"toolbar = 0, scrollbars = 1, location = 0, statusbar = 0, menubar = 0, resizable = 1, width= "+(e||640)+", height= "+(t||480));return!s}if(!(s=window.open("",null,"toolbar = 0, scrollbars = 1, location = 0, statusbar = 0, menubar = 0, resizable = 1, width= "+(e||640)+", height= "+(t||480))))return!0;window.event&&(event.cancelBubble=!0);var n=Glbl("Site.is_stash")?"#888":"#76827B";return s.document.open(),s.document.write('<html><body style="padding:0;margin:0;background:'+n+'"><img src="'+i.replace(/"/g,"&quot;")+'"></body></html>'),s.document.close(),s.focus(),!1}}),DWait.init("DeviationPageView.display_mature",,DWait.init("DeviationPageView.meta_info",function(e){i(".embed-code").on("click",function(){i(this).select()}).on("touchend",function(){i(this).removeAttr("readonly").get(0).setSelectionRange(0,999),i(this).attr("readonly",!0)})})}(jQuery),window.DWait&&DWait.run("jms/pages/deviation/dev-page-view.js")});

DWait.ready(["jms/lib/cookie.js","jms/lib/jquery/jquery.current.js"],function(){window.cancelEvent||(cancelEvent=function(){return window.event&&(event.cancelBubble=!0,event.returnValue=!1),!1}),window.Litty={states:{2:"size",4:"black",8:"font",16:"indent",32:"center"},labels:{size:"A<span>A</span>",font:"T",indent:"&para;",black:"<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>",center:"&#9374;"},toggles:{any:function(t){return $(".free-literature").eq(0).toggleClass("mod-"+t).hasClass("mod-"+t)},black:function(){Litty.toggles.any("black")},center:function(){var t=$(".free-literature div.text"),e=t.width(),n=Litty.toggles.any("center"),i=t.width();n&&e==i?$(".free-literature").eq(0).addClass("mod-center-forced"):$(".free-literature").eq(0).removeClass("mod-center-forced")},indent:function(){var t,e,n,i;if(t=$(".free-literature div.text"),t.length&&!t.find("span.push").length){e=$("br",t).toArray();do{i=$("<span>",{class:"push",html:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}),n?n.nextSibling&&i.insertAfter(n):t[0].firstChild&&i.prependTo(t)}while(n=e.pop())}Litty.toggles.any("indent")}},initty:function(){var t,e,n,i;if(deviantART.pageData.deviation_poetry||deviantART.pageData.deviation_prose){if(i=Litty.read(),t=$(".free-literature"),t.find(".textbar").length)return;if(t.length){n=[];for(e in Litty.labels)("indent"!=e||deviantART.pageData.deviation_prose)&&n.push('<a href="" class="t-'+e+'" onclick="return Litty.click(this)">'+Litty.labels[e]+"</a>");$("<div>",{class:"textbar ch"}).html(n.join("\n")).prependTo(t)}for(e in Litty.states)if(i&e){if("indent"==Litty.states[e]&&!deviantART.pageData.deviation_prose)continue;Litty.toggle(Litty.states[e])}t.length&&t.css("visibility","visible")}$(".journal-category").on("click",".deviation-full-data",function(){var t=$(this).attr("collect_rid").split(":")[1];window.location="//deviantart.com/deviation/"+t})},read:function(){return Cookie.get("litview"+(deviantART.pageData.deviation_poetry?"poetry":"prose"),0)},store:function(t){return Cookie.set("litview"+(deviantART.pageData.deviation_poetry?"poetry":"prose"),t)},toggle:function(t){Litty.toggles[t]?Litty.toggles[t]():Litty.toggles.any(t)},click:function(t){var e,n;t.blur(),e=t.className.match(/t\-(.+)\b/)[1],Litty.toggle(e);for(n in Litty.states)if(e==Litty.states[n])return Litty.store(Litty.read()^n),cancelEvent();return alert("Unavailable"),cancelEvent()}},window.DWait&&DWait.run("jms/pages/deviation/litty.js")});

DWait.ready([".domready","jms/lib/jquery/jquery.current.js","jms/legacy/modals.js","jms/lib/gmi.js","jms/lib/gwebpage.js","jms/lib/difi.js","jms/lib/pubsub.js","jms/lib/glbl.js","jms/lib/Base.js"],function(){!function(e){var i=Base.extend({inline_editor_preloaded:{},handlers:{edit_deviation:function(){if(Glbl("DeviationPageEditor.toggling"))return!1;var e=deviantART.pageData.deviationid;PubSub.publish("Location.set","/deviation/edit/"+e),this.inline_editor_preloaded[e]?this.handlers.open_inline_editor(this.inline_editor_preloaded[e].success,this.inline_editor_preloaded[e].data):(DiFi.pushPost("DeviationView","getInlineEditor",[e],this.handlers.open_inline_editor.bind(this)),DiFi.send()),Glbl("DeviationPageEditor.toggling",!0),this.get_dev_page_container().css("cursor","wait"),this.get_dev_page_view().hide()},uncache_editor:function(){this.inline_editor_preloaded[this.get_deviationid()]=null},preload_inline_editor:function(){var e=this.get_deviationid();this.get_deviation_userid()===window.deviantART.deviant.id&&(this.inline_editor_preloaded[e]||(DiFi.pushPost("DeviationView","getInlineEditor",[e],bind(this)),DiFi.timer(100)))},open_inline_editor:function(i,t){this.get_deviationid().toString(36);if(Glbl("DeviationPageEditor.toggling",!1),!i){var n=t.response.content&&t.response.content.error||"Please try again.";return alert("Loading editor failed, "+n),e("#ile-container").length>0&&e("#ile-container").delay(300).fadeOut(150,,e(".edit_buttons a").css("cursor","default"),this.get_dev_page_container().removeClass("editmode"),!1}e(t.response.content.html).hide().appendTo(this.get_dev_page_container()),gWebPage.update(t.response.content,null,null),DWait.ready("jms/pages/ile/ile.js",function(){PubSub.publish("InlineEditor.open")})},delete_deviation:function(e,i){var t=(i||{}).id,n=(i||{}).redir;if(Glbl("Site.is_stash")){var a=GMI.query("StashThumb",{match:{deviationid:t,type:"flat"}})[0];if(!confirm("Do you really want to delete this item?"))return;return void(void 0!==a?a.controls__deletenow():(DiFi.pushPost("Stashes","delete_deviation_from_stashes",[t],function(e,i){e?window.location.href="https://sta.sh/":alert("An unexpected error occured while trying to delete this item. Please try again later.")}),DiFi.send()))}n=n||"https://me.deviantart.com/";var o=this;Modals.push(document.getElementById("delete_modal").getElementsByTagName("form")[0].cloneNode(!0),function(e,i){if("delete"==e){if(!confirm("About to delete deviation; this cannot be undone!\n\nAre you sure?"))return!1;DiFi.pushPost("Deviation","DeleteSingle",[t,i.reasonid],function(e,i){e?(o.track_deletion_event("successful"),alert("Deviation deleted successfully."),window.location.href=n):(o.track_deletion_event("error"),alert("An unexpected error occured while trying to delete deviation. Please try again later."))}),DiFi.send()}})}},constructor:function(){PubSub.subscribe([{eventname:"DeviationPageEditor.open",subscriber:this,callback:this.handlers.edit_deviation},{eventname:"DeviationPageEditor.preload",subscriber:this,callback:this.handlers.preload_inline_editor},{eventname:"DeviationPageEditor.uncache",subscriber:this,callback:this.handlers.uncache_editor},{eventname:"DeviationPageEditor.delete",subscriber:this,callback:this.handlers.delete_deviation}])},get_dev_page_container:get_dev_page_view:function(){return this.get_dev_page_container().find(":gmi(DeviationPageView)")},get_deviationid:function(){return Number(this.get_dev_page_view().gmi1().gmi_args.deviationid)},get_deviation_userid:function(){return Number(this.get_dev_page_view().gmi1().gmi_args.userid)},track_deletion_event:function(e){var i="new_delete_"+e;deviantART.pageData.deviation_is_recent&&(i+="_recent")}});DWait.init("DeviationPageEditor.open_editor",function(i,t){e(i).click(function(){return PubSub.publish("DeviationPageEditor.open"),!1})}),new i}(jQuery),window.DWait&&DWait.run("jms/pages/deviation/dev-page-editor.js")});

DWait.init("InlineEditor.open_standalone",,window.DWait&&DWait.run("jms/pages/deviation/standalone-edit-page.js");

DWait.ready(["jms/lib/ddt.js","jms/lib/pubsub.js","jms/lib/pubsubcrossframe.js"],function(){!function(s){function t(){var s=[{eventname:"ddt.log",callback:this.ddt,subscriber:this},{eventname:"ddt.info",callback:this.ddt,subscriber:this},{eventname:"ddt.warn",callback:this.ddt,subscriber:this},{eventname:"ddt.error",callback:this.ddt,subscriber:this},{eventname:"ddt.trace",callback:this.ddt,subscriber:this},{eventname:"ddt.alert",callback:this.ddt,subscriber:this}];PubSubCrossFrame.subscribe(s),PubSub.subscribe(s)}if(t.prototype.ddt=function(s,t){if(vms_feature("dre")){if(!t||!t.message||!t.namespace)return void console.warn("Invalid ddt payload.");var d=s.split(".")[1],i=t.message;t._fromWindow&&(i="("+t._fromWindow+") "+i),ddt[d](t.namespace,i,t.data||null,t.tags||null,!0)}},!s.da_ddt_pubsub_initialized){s.da_ddt_pubsub_initialized=1;new t}}(window),window.DWait&&DWait.run("jms/lib/ddt.pubsub.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/legacy/modals.js"],function(){if(DWait.init("DevPageBlockButtons.init",function(o,e){var n=$(o).data("deviationid"),t=$(o).data("username");$(".block-unhide",o).on("click",function(o){o.preventDefault(),DiFi.pushPost("User","unblockDeviation",[n],function(o,e){o?window.location.reload():alert(e.reponse.content.error)}),DiFi.send()}),$(".block-user-block",o).on("click",function(o){o.preventDefault(),DiFi.pushPost("User","block",[t],function(o,e){o?window.location.reload():alert(e.response.content.error)}),DiFi.send()}),$(".block-user-unblock",o).on("click",function(o){o.preventDefault(),DiFi.pushPost("User","unblock",[t],function(o,e){o?window.location.reload():alert(e.response.content.error)}),DiFi.send()})}),window.safeLocalGet("ModerationMessage")){window.localStorage.removeItem("ModerationMessage");var o=Modals.factory(document.getElementById("moderation_success_modal").cloneNode(!0),{cssShadows:!0,showButtonsSeparator:!1});o.addButton("OK","smbutton-blue",,Modals.push(o)}window.DWait&&DWait.run("jms/pages/deviation/block_buttons.js")});

DWait.ready(["jms/lib/minibrowse.view.js","jms/lib/jquery/jquery.current.js","jms/lib/difi.queue.js","jms/lib/pubsub.js","jms/lib/glbl.js","jms/lib/Base.js"],function(){!function(e){new(Base.extend({_main_html_dimensions_cache:{},_main_html_data_cache:{},_item_options_cache:{},_extras_html_data_cache:{},_itemid:null,_difi_queue:null,_preloading:{},handlers:{open:function(i,t){var s=t,a="view",n="Minibrowse.preload"===i,_=!1;e.isPlainObject(t)&&(s=t.id,a=t.mode||"view",n&&(_=t.direction||!1)),s&&("Minibrowse.open"==i&&(this._is_it_too_fast(),this._itemid=s,Glbl("Minibrowse.opened",!0),Glbl("Minibrowse.mode",a),Glbl("Minibrowse.itemid",parseInt(s,10)),PubSub.publish("Minibrowse.item_has_been_opened",s)),Glbl("Minibrowse.opened")&&this._too_fast&&!n||!0===this._preloading[s]?(this._open_timeout&&clearTimeout(this._open_timeout),this._open_timeout=setTimeout(function(){this.handlers._open.call(this,s,a,n,_)}.bind(this),350)):this.handlers._open.call(this,s,a,n,_))},_open:function(e,i,t,s){if(this._itemid==e||t){var a={};if(Glbl("Duperbrowse.preload_active")>1&&(a.current_id=Glbl("Minibrowse.itemid")),t&&(a.preload=!0),t||PubSub.publish("MinibrowseView.take_over_page"),"edit"==i)a.edit=1;else{if(void 0!==this._item_options_cache[e]){"print"==this._item_options_cache[e].view_mode&&(a.purchase="print")}void 0!==this._main_html_dimensions_cache[e]?(ddt.log("duperbrowse","Simulating item from dimensions cache",this._main_html_dimensions_cache[e]),this.handlers._main_html_loaded.call(this,!0,this._simulate_main_html_loaded_from_dimensions(e,this._main_html_dimensions_cache[e].width,this._main_html_dimensions_cache[e].height,this._main_html_dimensions_cache[e].src,this._main_html_dimensions_cache[e].full_src,this._main_html_dimensions_cache[e].full_width,this._main_html_dimensions_cache[e].full_height,this._main_html_dimensions_cache[e].transparent,this._main_html_dimensions_cache[e].alt),t,s)):this._main_html_data_cache[e]?(ddt.log("duperbrowse","Loading item from data cache",this._main_html_data_cache[e]),this.handlers._main_html_loaded.call(this,!0,this._main_html_data_cache[e],t,s)):(ddt.log("duperbrowse","Requesting item from difi",e),this._difi_queue.push("post","DeviationView","getMainHTML",[e],function(e,i){this.handlers._main_html_loaded.call(this,e,i,t,s)}.bind(this)))}void 0!==this._extras_html_data_cache[e]&&void 0!==this._extras_html_data_cache[e][i]?this.handlers._extras_html_loaded.call(this,!0,this._extras_html_data_cache[e][i],t):s||(t&&(this._preloading[e]=!0),Glbl("Duperbrowse.disable_extras_loading")||this._difi_queue.push("post","DeviationView","getExtrasHTML",[e,"",a,{}],function(i,s){t&&void 0!==this._preloading[e]&&delete this._preloading[e],this.handlers._extras_html_loaded.call(this,i,s,t)}.bind(this)));var n="default";t&&(n=s?"preview":"preload"),this._difi_queue.send(n)}},cache_main_html_dimensions:function(e,i){this._main_html_dimensions_cache[i.id]=i},cache_item_options:uncache:function(e,i){void 0!==this._main_html_dimensions_cache[i]&&delete this._main_html_dimensions_cache[i],void 0!==this._main_html_data_cache[i]&&delete this._main_html_data_cache[i],void 0!==this._extras_html_data_cache[i]&&delete this._extras_html_data_cache[i],void 0!==this._item_options_cache[i]&&delete this._item_options_cache[i]},close:function(e){Glbl("Minibrowse.opened",!1),Glbl.del("Minibrowse.mode"),Glbl.del("Minibrowse.itemid"),PubSub.publish("MinibrowseView.restore_page"),PubSub.publish("Minibrowse.closed")},_main_html_loaded:function(e,i,t,s){ddt.log("duperbrowse","main html loaded",i,t,s),e&&i&&i.response?(void 0===i.simulated&&(this._main_html_data_cache[i.request.args[0]]=i),t?(PubSub.publish("MinibrowseView.preload_main",i.response),s&&PubSub.publish("MinibrowseView.preload_preview",{direction:s,response:i.response})):parseInt(i.request.args[0],10)===Glbl("Minibrowse.itemid")&&PubSub.publish("MinibrowseView.populate_main",i.response)):PubSub.publish("MinibrowseView.populate_failed",{which:"main"})},_extras_html_loaded:function(i,t,s){if(i){try{if(t.response.content.pageData.deviant.loggedIn!==deviantART.deviant.loggedIn)return void window.location.reload()}catch(e){}this._extras_html_data_cache[t.request.args[0]]={};var a=void 0!==t.request.args[2].edit;a?this._extras_html_data_cache[t.request.args[0]].edit=t:this._extras_html_data_cache[t.request.args[0]].view=t,s?PubSub.publish("MinibrowseView.preload_extra",t.response):parseInt(t.request.args[0],10)===Glbl("Minibrowse.itemid")&&PubSub.publish("MinibrowseView.populate_extra",e.extend(t.response,{edit:a})),PubSub.publish("Minibrowse.extras_loaded")}else PubSub.publish("MinibrowseView.populate_failed",{which:"extras"})},reload_extras:function(e,i){this._difi_queue.push("post","DeviationView","getExtrasHTML",[i.itemid,"",i.extras_parameters,{}],function(e,i){this.handlers._extras_html_loaded.call(this,e,i,!1)}.bind(this)),this._difi_queue.send("default")},preview_prev:function(e,i){void 0!==this._main_html_dimensions_cache[i]&&PubSub.publish("MinibrowseView.preview_prev",this._main_html_dimensions_cache[i])},preview_next:function(e,i){void 0!==this._main_html_dimensions_cache[i]&&PubSub.publish("MinibrowseView.preview_next",this._main_html_dimensions_cache[i])}},constructor:function(){this._difi_queue=new DiFiQueue({active_buffer_size:1,queue_callback:function(e){for(var i=[],t=[],s=e.length-1;s>=0;--s){if("default"==e[s].group){i.push(e[s]);break}"preview"==e[s].group&&t.length<2&&t.push(e[s])}return 0===i.length&&(i=t),0===i.length&&e.length>0&&i.push(e[e.length-1]),i}}),PubSub.subscribe([{eventname:"Minibrowse.open",subscriber:this,callback:this.handlers.open},{eventname:"Minibrowse.close",subscriber:this,callback:this.handlers.close},{eventname:"Minibrowse.cache_main_html_dimensions",subscriber:this,callback:this.handlers.cache_main_html_dimensions},{eventname:"Minibrowse.cache_item_options",subscriber:this,callback:this.handlers.cache_item_options},{eventname:"Minibrowse.uncache",subscriber:this,callback:this.handlers.uncache},{eventname:"Minibrowse.preload",subscriber:this,callback:this.handlers.open},{eventname:"Minibrowse.reload_extras",subscriber:this,callback:this.handlers.reload_extras}])},_simulate_main_html_loaded_from_dimensions:function(e,i,t,s,a,n,_,l,h){a||(a=s,n=i,_=t);Glbl("Site.is_deviantart");var o='<img collect_rid="1:'+e+'" src="'+s+'"  width="'+i+'" height="'+t+'" alt="'+h+'" class="dev-content-normal" data-embed-id="'+e+'" data-embed-type="deviation" data-embed-format="thumb"><img collect_rid="1:'+e+'" src="'+a+'"  width="'+n+'" height="'+_+'" alt="'+h+'" class="dev-content-full" data-embed-id="'+e+'" data-embed-type="deviation" data-embed-format="thumb">';return Glbl("Site.is_mobile")&&((i<300||t<300)&&(s=a,i=n,t=_),o='<img collect_rid="1:'+e+'" src="'+s+'"  width="'+i+'" height="'+t+'" alt="'+h+'" class="dev-content-full" >'),{simulated:!0,request:{args:[e]},response:{content:{html:o,pageData:{deviation_preload_type:"image",deviationid:e}}}}},_is_it_too_fast:function(){if(void 0===this._last_open_call)this._last_open_call=e.now();else{var i=e.now()-this._last_open_call;i<350?this._too_fast=!0:i>450&&(this._too_fast=!1),this._last_open_call=e.now()}}}))}(jQuery),window.DWait&&DWait.run("jms/lib/minibrowse.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/gwebpage.js","jms/lib/glbl.js","jms/lib/pubsub.js","jms/lib/Base.js","jms/pages/deviation/dev-page-view.js"],function(){!function(e){var i=Base.extend({_saved_title:"",constructor:function(){PubSub.subscribe([{eventname:"MinibrowseView.take_over_page",subscriber:this,callback:this.handlers.take_over_page},{eventname:"MinibrowseView.restore_page",subscriber:this,callback:this.handlers.restore_page},{eventname:"MinibrowseView.populate_main",subscriber:this,callback:this.handlers.populate_main}])},handlers:{take_over_page:function(i){!this._saved_title&&document.title&&(this._saved_title=document.title),this._clear_page(),e("body > div#output").hide();var t=this._get_container();t.length||(t=e('<div class="dev-page-container bubbleview minibrowse-container"></div>'),t.appendTo("body"));var a=Boolean((deviantART.pageData.user||{}).fullview_all),v='<div class="dev-page-view view-mode-normal" data-gmiclass="DeviationPageView">';Glbl("Site.is_mobile")?v+='<div class="dev-view-deviation" data-dwait-deps="jms/mobile/deviation.view.js" data-dwait-domready="MobileDeviation.init"></div><div class="dev-view-about"><div class="dev-about-bg-border"><div class="dev-about-bg-gradient"></div></div><div class="dev-view-about-content"></div></div><div class="dev-view-meta"><div class="dev-view-meta-content"></div></div>':v+=a?'<div class="dev-view-deviation"></div><div class="dev-view-main-content"><div class="dev-view-about"><div class="dev-about-bg-border"><div class="dev-about-bg-gradient"></div></div><div class="dev-view-about-content"></div></div></div><div class="dev-view-meta"><div class="dev-view-meta-content"></div></div>':'<div class="dev-view-main-content"><div class="dev-view-deviation"></div><div class="dev-view-about"><div class="dev-about-bg-border"><div class="dev-about-bg-gradient"></div></div><div class="dev-view-about-content"></div></div></div><div class="dev-view-meta"><div class="dev-view-meta-content"></div></div>',v+='<div class="dev-right-col-bg"></div><div style="clear:both;"></div></div>',e(v).appendTo(t),Glbl("Duperbrowse.disable_safari_scroll_fix")||setTimeout(function(){e(window).scrollTop(0)},1)},restore_page:function(i){e("body > div#output").show(),this._clear_page(!0),this._saved_title&&(document.title=this._saved_title),this._saved_title=null},populate_main:function(i,t){if(!t.content||!e.isPlainObject(t.content))return void PubSub.publish("MinibrowseView.populate_failed",{which:"main"});var a=Boolean((deviantART.pageData.user||{}).fullview_all);t.content.pageData.is_journal&&(a=t.content.pageData.is_journal_fullview_forced),Glbl("Site.is_mobile")&&(a=!0),e("body").removeClass("superwide").toggleClass("fullview",a),this._get_deviation().html(t.content.html);var v=e(":gmi(DeviationPageView)").toggleClass("view-mode-full",a).toggleClass("view-mode-normal",!a);v.gmiAttr("deviationid",t.content.pageData.deviationid),v.gmiAttr("fullview_requested",a?1:0),void 0!==t.content&&gWebPage.update(t.content),v.gmi()}},_clear_page:function(e){var i=this._get_container();e?(PubSub.publish("DeviationAds.minibrowse_destroy"),i.remove()):i.children().not(".dp-ad-chrome").remove()},_get_container:_get_about:_get_meta:function(){return this._get_container().find("> .dev-page-view > .dev-view-meta .dev-view-meta-content")},_get_deviation:);new i;var t={factory:function(e,t){new(i.extend(t))}};PubSub.subscribe({eventname:"MinibrowseView.js_factory",subscriber:t,callback:t.factory})}(jQuery),window.DWait&&DWait.run("jms/lib/minibrowse.view.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/Base.js"],function(){!function(e,i){var t=Base.extend({pushes:[],group:null,wait:!1,_timer:null,_deferred:null,_killed:!1,constructor:merge:function(e){for(var i=this.pushes,t=0,s=e.length;t<s;t++)i=i.concat(e[t].pushes);return this.pushes=i,this},promise:function(){this.deferred=e.Deferred();for(var i=0,t=this.pushes.length;i<t;i++)DiFi.push.apply(DiFi,this._wrap_difi(this.pushes[i],this.deferred));return this.wait?DiFi.timer(this.wait):DiFi.send(),this._timer=setTimeout(this._kill.bind(this),6e4),this.deferred.promise()},_kill:function(){this.deferred&&"pending"===this.deferred.state()&&(this.deferred.resolve("killed"),this._killed=!0,console.log("[DiFi] Request killed after timeout")),clearTimeout(this._timer),this._timer=null},_wrap_difi:function(i,t){var s=i[4],u=i[5],r={request:void 0,response:{status:"NOEXEC_HALT",content:{error:"Request timed out",details:"Request timed out and was killed",human:"The request took too long and was cancelled, please try later"}}};return e.isFunction(s)&&(i[4]=function(e,i){if(this._killed)return void s.call(u||null,!1,r);s.call(u||null,e,i),t.resolve(e)}.bind(this)),i}});i.DiFiQueue=Base.extend({_buffer:[],_active_buffer:[],_push_queue:[],options:{},constructor:function(i){var t={active_buffer_size:1,queue_callback:null,wait_for_more:!1};this.options=e.extend(t,i),this._buffer=[],this._active_buffer=[],this._push_queue=[]},push:function(e,i,t,s,u,r){this._push_queue.push([e,i,t,s,u,r])},send:function(e){e=e||"default",0!==this._push_queue.length&&(this._buffer.push(new t(this._push_queue,e,this.options.wait_for_more)),this._push_queue=[],this._waiting()||this._flush())},_flush:function(e){if(e&&this.options.queue_callback&&(this._buffer=this.options.queue_callback(this._buffer)),0!==this._buffer.length&&!this._waiting()){var i=this._buffer[0].merge(this._buffer.slice(1));this._active_buffer.push(i.promise().done(this._handle.bind(this))),this._buffer=[]}},_handle:function(){this._active_buffer=e.map(this._active_buffer,function(e){if("pending"===e.state())return e}),this._flush(!0)},_waiting:)}(jQuery,window),window.DWait&&DWait.run("jms/lib/difi.queue.js")});

DWait.ready(["jms/lib/bind.js","jms/lib/events.js"],function(){DiFiHolder={up:function(){this.count=(this.count||0)+1,1==this.count&&this.on()},down:function(){this.count=(this.count||0)-1,this.count||this.off()},downWithCallback:function(){DiFiHolder.down(),DiFi.stdErrCallback.apply(this,arguments)},getStdCallback:on:function(){DiFiHolder.on_please=1,setTimeout(DiFiHolder.on2,1)},on2:function(){DiFiHolder.on_please&&Events.hook(document.body,"click",DiFiHolder.click)},off:function(){DiFiHolder.on_please=0,Events.unhook(document.body,"click",this.click),this.queued_click&&(window.location.href=this.queued_click,this.queued_click=null)},click:function(i){var t,e,n,o;if(i=i||window.event,i.ctrlKey||i.metaKey||i.altKey||i.shiftKey)return!0;for(t=i.target||i.srcElement;t&&"A"!=t.tagName;)if(!(t=t.parentNode))return!0;return e=t.href||"",n=t.href.indexOf("#"),o=window.location.href.split("#"),!e||n>=0&&n<3||0==e.indexOf(o[0]+"#")||o[0]==e||(DiFiHolder.queued_click==e?DiFiHolder.impatience(e):(DiFiHolder.queued_click=e,t.style.cursor="wait",DiFi.timer(1),!1))},impatience:function(i){return!i||confirm("This page is still saving.\n\nAre you sure you want to go to a different page?")}},window.DWait&&DWait.run("jms/lib/difi_hold.js")});

DWait.ready(["jms/pages/lub/lub_constants.js","jms/lib/ruler.js","jms/lib/bind.js","jms/lib/surfer.js","jms/lib/ddd.utils.js","jms/lib/ddd.js","jms/lib/jquery/jquery.current.js","jms/lib/station.js","jms/lib/gmi.js","jms/lib/Base.js"],function(){window.ResourceComms=new(Base.extend({ready:!1,constructor:function(){DWait.ready(".jqready",bind(this)),document.documentElement.onmousedown=this.mouseDown.bind(this)},broadcastPrepareClones:function(e){var t,a,r,s,d,i;for(s=[],t=0;a=e[t];t++)a&&"object"==typeof a[2]?((d=GMI.query(a[2],"GalleryArrowMenu")[0])&&(i=d.gmi_node.parentNode,i.removeChild(d.gmi_node)),r=a[2].cloneNode(!0),(eax=r.getElementsByTagName("img")[0])&&Station.apply(eax,"opacity",1),s.push([a[0],a[1],r]),d&&i&&i.insertBefore(d.gmi_node,i.firstChild)):s.push(a);return s},broadcastDataSplice:function(e,t,a,r,s){var d,i,o;for(r=r||[],d=this.getEveryone(e?{match:e}:null),i=0;i!=d.length;i++){for(o=0;o!=r.length;o++)if(r[o]==d[i]){o=-1;break}-1!=o&&(t[2]&&d[i]!=a&&(t[2]=this.broadcastPrepareClones(t[2])),d[i].dataSplice.apply(d[i],t))}},mouseDown:function(e){var t,a;if(e=e||window.event,a=e.target||e.srcElement,!this.ready)return!0;if(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button>1)return!0;if($(a).hasClass("dwaiting"))return!0;if(document.body.className.indexOf("modal-active")>=0)return!0;for(;a&&a!=this.gmi_node;){if(1==a.nodeType&&(t=a.getAttribute("collect_rid"))&&!$(a).hasClass("tt-special")&&(this.clicked_stream=GMI.up(a),-1!=this.clicked_stream&&("gmi-StashThumb"==this.clicked_stream.gmi_node.id&&(this.clicked_stream=GMI.up(this.clicked_stream.gmi_node)),!(-1==this.clicked_stream||window.PreviewStream&&this.clicked_stream instanceof PreviewStream||window.StashStream&&this.clicked_stream instanceof StashStream||"function"!=typeof this.clicked_stream.dataSplice)))){if(window.DDD&&DDD.mouseDown.call(a,e,this))return this.dragged_rid=t.split(":"),this.dragged_rid[0]=Number(this.dragged_rid[0]),this.dragged_rid[1]=Number(this.dragged_rid[1]),e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1;break}a=a.parentNode}},ddd:{snap:function(e){var t,a,r,s,d,i,o,n,c,h=function(e){e.drag_data={rects:[],selected:[],selected_details:[],surfers:[],share:null}};if("gmi-StashStream"==this.clicked_stream.gmi_node.id)return h(this);this.clicked_stream.selector&&(d=this.clicked_stream.selector.getSelection()),d&&d.length||(d=[this.getStreamNode(this.clicked_stream,this.ddd.node)||this.ddd.node]),i=this.clicked_stream.domFindVisible(),c=[];for(t in i)for(a=0;a!=d.length;a++)i[t]==d[a]&&c.push(this.clicked_stream.contents[t]);if(d.length!=c.length)throw h(this),new Error("Selection Mismatch");for(this.drag_data={rects:[],selected:d,selected_details:c,surfers:[]},r=this.getEveryone(),t=0;s=r[t];t++){if(!1===(o=s.commsAskForTargetsEnh(this.clicked_stream,d,c))&&s==this.clicked_stream)return h(this);this.drag_data.rects=this.drag_data.rects.concat(o),o.length&&s==this.clicked_stream&&(n=1)}for(e.target&&$(e.target).closest(".no-lub").length>0&&(n=1),t=0;t!=d.length;t++)this.drag_data.surfers.push(this.createSurfer(e,this.clicked_stream,c[t],d[t]));for(t=0;eax=this.drag_data.surfers[t];t++)eax.node.style.display="block";DDDUtils.mix(this),this.dddTickStart(e),1!=c.length||!window.da_minish_lub||n&&!da_minish_lub.out?this.drag_data.share=null:(this.drag_data.share=window.da_minish_lub,this.drag_data.share.init(),this.drag_data.shared_rid=c[0],this.drag_data.share.drag_index=$(this.ddd.node).index(),this.drag_data.share.ddd.node=this.ddd.node,this.drag_data.share.ddd.snap.call(this.drag_data.share,e,this,this.drag_data.shared_rid,this.drag_data.surfers[0]),void 0!==$(this.ddd.node).data("bi")&&"sectionname"in $(this.ddd.node).data("bi")&&(this.drag_data.share.sectionname=$(this.ddd.node).data("bi").sectionname))},drag:function(e,t){var a,r,s;if(DDD.subject){if(e&&this.dddTickUpdate&&this.dddTickUpdate(e),a=(new Date).valueOf(),"object"==typeof e)this.drag_event_cache={clientX:e.clientX,clientY:e.clientY,x:e.x,y:e.y};else if(!(e=this.drag_event_cache))return;for(s=0;r=this.drag_data.surfers[s];s++)Surfer.update(r,e);if(!(a-this.drag_snap_time<500)){if(a-(this.drag_lores_time||0)<100&&!t)return void(this.drag_lores_timer||(this.drag_lores_timer=setTimeout(this.ddd.drag.bind(this),100)));this.drag_lores_timer=null,this.drag_lores_time=a;var d;this.drag_data.hover&&(this.drag_data.hover.owner.commsDragHover(this.clicked_stream,this.drag_data.hover,!1,!1,this.drag_data.surfers),this.drag_data.hover=null),d=Ruler.hitTest(Ruler.document.pointer(e),this.drag_data.rects,this.clicked_stream.hit_rect),null!==d&&(this.drag_data.hover=this.drag_data.rects[d],this.drag_data.hover.owner.commsDragHover(this.clicked_stream,this.drag_data.hover,!0,!1,this.drag_data.surfers)),this.drag_data.share?(this.drag_data.share.ddd.drag.call(this.drag_data.share,e,this,this.drag_data.shared_rid),this.drag_data.top_drag_offset=230):this.drag_data.top_drag_offset=0}}},drop:function(e){var t,a,r,s;if(this.dddTickEnd&&this.dddTickEnd(e),this.drag_lores_timer&&(clearTimeout(this.drag_lores_timer),this.drag_lores_timer=null),this.drag_data.share&&this.drag_data.share.ddd.drop.call(this.drag_data.share,e,this,this.drag_data.shared_rid))return this.drag_data={},!0;if(this.drag_data.hover&&(t=this.drag_data.hover.owner,t.commsDragHover(this.clicked_stream,this.drag_data.hover,!1,!0,this.drag_data.surfers),a=this.drag_data.selected_details,t!=this.clicked_stream&&(a=this.broadcastPrepareClones(a)),t.commsRecvDrop(this.clicked_stream,a,this.drag_data.hover),this.drag_data.hover=null,t!=this.clicked_stream))for(r=0;s=this.drag_data.surfers[r];r++)Surfer.dissolve(s,e);else for(r=0;s=this.drag_data.surfers[r];r++)Surfer.flyHome(s,e)}},getStreamNode:function(e,t){if(e.get_stream_node_from_clicked_node)return e.get_stream_node_from_clicked_node(t);for(;t&&t.parentNode!=e.gmi_node;)t=t.parentNode;return t},getEveryone:function(e){return GMI.query("EditableResourceStream",e).concat(GMI.query("EditableResourceStack",e)).concat(GMI.query("EditableResourceTV",e)).concat(GMI.query("EditableFolderStream",e)).concat(GMI.query("EditableResourceCustomIcon",e)).concat(GMI.query("GPageButton"))},createSurfer:function(e,t,a,r){var s,d,i,o,n,c,h,l;if(t.commsMakeCustomSurfer&&(s=t.commsMakeCustomSurfer(e,a,r)))return s;switch(Number(a[0])){case RESOURCE_DEVIATION:if(l=(r.getElementsByTagName("img")||[])[0]||r,$(l).hasClass("lit")||$(l).parents(".freeform").length){var m,g=$(r).closest('[data-sigil*="torpedo-thumb"]');if(g.length){s=Surfer.create(e,g.get(0),.5,.8,!0,!1,"torpedo-container");break}m=$(r).find("span").get(0);var _=$(m).find(".gmbutton2, .details, .t, small").hide(),u=$(this.ddd.node).find(".shadow"),f=u.css("background-image");u.css("background-image",""),s=Surfer.create(e,m,1,void 0,!0),u.css("background-image",f),_.show();break}s=Surfer.create(e,l);var v=$(e.target).closest("div[collect_rid]");v.hasClass("tt-ismature")&&!deviantART.deviant.browseadult?(i=v.width(),o=v.height()):(i=l.width||l.offsetWidth,o=l.height||l.offsetHeight),(i>150||o>150)&&(s.modified=!0,s.node.style.width=150/Math.max(i,o)*i+"px",s.node.style.height=150/Math.max(i,o)*o+"px",s.mod_down.x*=150/Math.max(i,o),s.mod_down.y*=150/Math.max(i,o));break;case RESOURCE_GALLERIES:case RESOURCE_FAVCOLLECTIONS:if(d=" "+r.className+" ",d.indexOf(" tt-tv150 ")>=0?(r=r.getElementsByTagName("div")[1],d=" "+r.className+" "):d.indexOf(" rs-customicon ")>=0&&(r=$(r).find("a.rs-customicon-link img").get(0),d=" "+r.className+" "),n=d.indexOf(" tv150 ")>=0){for(s=Surfer.create(e,r,1,void 0,!0),c=s.node.getElementsByTagName("div"),h=0;h!=c.length;h++)if(d=" "+s.node.className+" ",d.indexOf(" a-stream ")>=0){c[h].className+=" stream";break}s.node.className+=n?" surfer-tv150 tv150":" surfer-tv200 tv200"}else d.indexOf(" rs-customicon-inner ")>=0?(s=Surfer.create(e,r,void 0,void 0,!0),s.node.className+=" surfer-rs-customicon"):d.indexOf(" gl-text ")>=0?(s=Surfer.create(e,r,void 0,void 0,!0),s.node.className+=" surfer-gl-text"):(s=Surfer.create(e,r,void 0,void 0,!0),s.node.className+=" surfer-stack stackctrl")}return s}})),window.DWait&&DWait.run("jms/lib/gstream/resource_comms.js")});

DWait.ready(["jms/lib/gstream/resource_stream.js"],function(){ResourceStack=ResourceStream.extend({findIconSlots:function(){var t,i,e,s;for(s=[],t=this.gmi_node.getElementsByTagName("div")[1].childNodes,i=0;e=t[i];i++)(e.className||"").indexOf("icon")>=0&&s.push(e);return s.reverse(),s},dataFetch:function(){},domFindVisible:function(){var t,i,e,s,r;for(r=this.findIconSlots(),i={},s=0,t=0;e=r[t];t++)e.firstChild&&(i[s+++this.gs_offset]=e.firstChild);return i},domReadMeta:domDrawItem:function(t,i){var e;if(!(void 0!==this.gs_total&&t>=this.gs_total)){if(void 0==i)return this.REQUEST_FETCH;if(e=this.findIconSlots(),e[t])if("string"==typeof i[2])e[t].innerHTML=i[2];else{for(;e[t].firstChild;)e[t].removeChild(e[t].firstChild);e[t].appendChild(i[2])}}},commsRecvDrop:function(t,i,e){var s;s=[];for(var r=0;r!=e.length;r++)s[r]=this.processDroppedItem(e[r]);this.dataSplice(0,0,s)},processDroppedItem:function(t){return window.da_minish_lub&&(t[2]=da_minish_lub.stacktileFromThumb150([Number(t[0]),t[1]],t[2])||t[2]),t}}),window.DWait&&DWait.run("jms/lib/gstream/resource_stack.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/station.js","jms/lib/difi.js","jms/lib/renamer.js","jms/lib/popup2.js","jms/lib/browser.js","jms/lib/jquery/jquery.current.js","jms/lib/gmi.js"],function(){window.GalleryArrowMenu=GMIBase.extend({gmiConstructor:function(){this.cmn=0,this.has_remove_menu=0!=this.gmi_args.has_remove_menu,"legacy"==this.gmi_args.mode?this.gmi_node.innerHTML='<img onclick="setTimeout(GMI.up(this).click.bind(GMI.up(this)), 1)" style="cursor:pointer;position:relative;z-index:30" src="https://st.deviantart.net/minish/gallery/menu-button-b.gif" alt="Menu"/>':(this.gmi_node.className="gm-chaos gmbuttons gmbuttons-arrowmenu"+("folder"==this.gmi_args.mode?" gmbuttons-folder":""),this.gmi_node.innerHTML='<a class="gmbutton2 gmbutton2chaos gmbutton2hidden" onclick="Popup2.hideAll();this.className += \' active\';setTimeout(GMI.up(this).click.bind(GMI.up(this), 1), 1);return GMI.evCancel()">Menu</a>')},gmiDestructor:function(){!this.folder&&this.stream_item&&this.removeFromStreamItem(),this.popup&&(this.popup.remove(),delete this.popup)},DEFAULT_LABEL:"Folder",addToStreamItem:function(e){if(this.stream_item)throw new Error("addToStreamItem called twice");this.stream_item=e;var i,t;if(i=e.getElementsByTagName("*")[0],"legacy"==this.gmi_args.mode){for(this.stream_item_backup=e.innerHTML,t="B"==i.firstChild.tagName?2:1;i.childNodes[t];)i.removeChild(i.childNodes[t]);i.appendChild(this.gmi_node)}else i.insertBefore(this.gmi_node,i.firstChild);this.gmiUp("Gruser")&&this.gmiUp("Gruser").gmi_args.group||(this.stream_item.ondblclick=this.click.bind(this));var s=this.$.closest("grid"==this.gmi_args.browse_view_mode?".tt-w":".tt-fh"),r={};if("static"!==s.css("position"))this.$.css({top:6,right:5,zIndex:3,margin:0});else if(s.length>0){var n=$("#output");n.is(":hidden")&&(r={position:n.css("position"),left:n.css("left")},n.css({position:"absolute",left:"-9999px"}).show()),this.$.css({marginLeft:s.innerWidth()-26+"px",zIndex:1}),$.isEmptyObject(r)||n.css(r).hide()}},removeFromStreamItem:function(){this.stream_item.ondblclick=null,this.gmi_node.parentNode&&this.gmi_node.parentNode.removeChild(this.gmi_node),"legacy"==this.gmi_args.mode&&(this.stream_item.innerHTML=this.stream_item_backup)},getRID:function(){return this.gmi_args.stream_proxy.domReadOne(this.stream_item).slice(0,2)},addToFolderItem:function(e){var i;this.stream_item=e,this.folder=this.findAnyFolder(),this.gmi_node.style.position="absolute",this.gmi_node.style.top=Browser.isIE&&8==document.documentMode?"-"+this.stream_item.firstChild.offsetHeight+"px":"-3px",i="A"==(e.nextSibling||{}).tagName?e.nextSibling:e,i.style.position="relative",i.appendChild(this.gmi_node),this.buddy_link=i,this.findRenameLink()},findRenameLink:function(){folder=GMI.query(this.stream_item,"EditableResourceTV")[0],folder?this.rename_link=folder.gmi_node.parentNode.getElementsByTagName("div")[0]:this.rename_link=this.buddy_link.firstChild},addToTextItem:function(e){this.stream_item=e,this.folder=GMI.getOne(e),e.style.position="relative",this.gmi_node.style.position="absolute",this.gmi_node.style.top="-20px",this.gmi_node.style.right="-4px",e.appendChild(this.gmi_node),this.rename_link=this.buddy_link=e.getElementsByTagName("a")[0]},addToCustomIcon:function(e){this.stream_item=e,this.folder=GMI.getOne(e),e.style.position="relative",this.gmi_node.style.position="absolute",this.gmi_node.style.top=e.className.match(/\brs-customicon-no-label\b/)?"-12px":"-5px",e.appendChild(this.gmi_node),this.rename_redirect=!0,this.rename_link=this.buddy_link=e.getElementsByTagName("a")[0]},addToSectionItem:function(e){var i;this.stream_item=e,this.gmi_node.className+=" gm-astro",this.folder=this.findAnyFolder(),this.gmi_node.style.position="absolute",this.gmi_node.style.top="-13px",this.gmi_node.style.right="6px",i=e,i.style.position="relative",i.appendChild(this.gmi_node),this.buddy_link=i,this.rename_link=e.getElementsByTagName("a")[0]||e.getElementsByTagName("b")[e.getElementsByTagName("b")-1]},HR:'<div class="blockmenu-hr"></div>',click:function(){var e;this.gmi_args.selection_proxy&&(this.gmi_args.selection_proxy.isSelected(this.stream_item)||this.gmi_args.selection_proxy.setSelection(this.stream_item));var i=$("legacy"==this.gmi_args.mode?this.gmi_node.firstChild:this.gmi_node);(e=this.popup)||(e=this.popup=new Popup2("GalleryArrowMenu","body",{classes:"cruiser",content:'<div class="blockmenu"><div style="position:relative">'+this.getDefaultMenuHTML()+"</div></div>",created:function(e){e.$node.attr("gmi-redirect",this.gmi_node.getAttribute("gmindex"))}.bind(this),hidden:bind(this),removed:bind(this),shown:function(){i.addClass("active")},destroy:!0})),e.show(e.position(i))},menuClick:function(e,i,t,s){switch(e){case"back":this.setMenuHTML(this.getDefaultMenuHTML(),"left");break;case"unfav":case"remove":this.menuSubClick(e,i);break;case"move":case"copy":this.getFolderList(function(i,t,r,n){function a(e,i){var t,s,n;for(s=Number(e[1]),n=[],t=0;t!=r.length;t++)if(r[t]&&Number(r[t].parentid)==s){if(i)return!0;n.push(r[t])}return!i&&n}var o,l,m,h,d,u,c,g,p,_;for(t=Number(t),d=t?a([i,t],!1):r,_="folder"==this.gmi_args.mode?"create_folder":"edit_folder",m=Number(this.gmi_args.stream_proxy.gmi_args.set_id||this.gmi_args.stream_proxy.gmiUp("GalleryEditor").gmi_args.itemid),this.gmi_args.stream_proxy.gmi_args.browse_mode&&(m=null),o=[],l=0;l!=d.length;l++)if(d[l]&&(t||!Number(d[l].parentid))){g=d[l].behavior||{};var f="";if(a(d[l].rid,!0)&&(o.push("<a "+f+' href="" class="f blockmenu-morelink" onclick="GMI.up(this).menuClick(\''+e+"', "+d[l].rid[0]+", "+d[l].rid[1]+');return GMI.evCancel()">more &#9658;</a>'),f=' style="margin-right:56px" '),Number(d[l].rid[1])==m||!g[_]&&(p=1)){if(!("Featured"!=d[l].title&&g[_]||f))continue;o.push("<div "+f+" class=blockdisabled>"+d[l].title+"</div>")}else o.push("<a "+f+' href="" class=f onclick="GMI.up(this).menuSubClick(\''+e+"', "+d[l].rid[0]+", "+d[l].rid[1]+",undefined,"+("Featured"==d[l].title)+","+("folder"==this.gmi_args.mode)+');return GMI.evCancel()">'+d[l].title+"</a>")}if(o.length||(c=!0,o.push("<div class=blockdisabled>"+(p?"All "+(this.gmi_args.item_label||this.DEFAULT_LABEL)+"s are read only!":"You have no "+(this.gmi_args.item_label||this.DEFAULT_LABEL)+"s yet!")+"</div>")),t)for(l=0;l!=r.length;l++)if(Number(r[l].rid[1])==t){u=r[l].parentid||0;break}h=u?"'"+e+"', "+i+", "+u+", 'left'":t?"'"+e+"', 0, 0, 'left'":"'back'",this.setMenuHTML('<a href="" class=f onclick="GMI.up(this).menuClick('+h+');return GMI.evCancel()"><span class="blockmenu-left-arrow">'+(Browser.isMac?"&#9664;":"&#9668;")+"</span> Back</a>"+this.HR+(c?"":'<div class="blockdisabled">'+{move:"Move",copy:"Copy"}[e]+" to:</div>")+o.join(""),n?s||"right":"none")}.bind(this,i,t),s);break;case"rename":this.active_renamer&&(this.active_renamer.localDestroy(),this.active_renamer=null),this.rename_redirect?window.location=this.rename_link.href+"?edit_options=1":(this.rename_link_previous_style={none:"none"}[this.rename_link.style.display],this.active_renamer=new Renamer(this,this.renamed.bind(this),this.rename_link.innerHTML),this.rename_link.replaceChild(this.active_renamer.node,this.rename_link.firstChild),setTimeout(this.renameFocus.bind(this),10)),Popup2.hideAll();break;case"delete":var r,n;confirm("Are you sure?")&&(r=this.gmiUp("EditableFolderStream"),n=this.folder,r.emSplice(r.dataIndexOf([Number(n.gmi_args.set_typeid),Number(n.gmi_args.set_id)]),1),Popup2.hideAll(),GalleryArrowMenu.ggi_result=null)}},emRenameClick:menuDone:function(){this.gmi_node.firstChild&&(this.gmi_node.firstChild.className=this.gmi_node.firstChild.className.replace(/\bactive\b/,"")),this.gmi_args.selection_proxy&&this.gmi_args.selection_proxy.getSelection().length<=1&&this.gmi_args.selection_proxy.setSelection(null)},menuSubClick:function(e,t,s,r,n,a){var o,l,m,h,d=this.gmi_args.stream_proxy;if(r||this.gmi_args.selection_proxy&&(m=this.gmi_args.selection_proxy.getSelection()),Popup2.hideAll(),o=this.getRID(),(l=d.dataIndexOf(o))<0)return DiFi.stdErr("Sorry! Unable to "+e+" item due to missing index.",null);switch(e){case"unfav":d.emUnfav(l,1);break;case"remove":case"copy":var u=[];destination_rid="remove"==e?void 0:[t,s],destination_offset="remove"==e?void 0:0,read_only="copy"==e,d.emSplice(l,1,u,destination_rid,destination_offset,read_only);break;case"move":"EditableResourceStream"==d.gmi_args.gmiclass?d.moveResourceToFolder(l,[t,s]):d.emSplice(l,1,null,[t,s])}if(t==RESOURCE_FAVCOLLECTIONS||"unfav"==e){var c=($(":gmi(Gruser)").gmi1().gmi_args||{}).group,g=["source-gruser","collectionowner-"+(c?"group":"user")];switch(e){case"copy":c?"suggest_favourite":"add_favourite",g.push("collectiontype-"+(n?"default":"collection"));break;case"move":a?"move_collection":("move_favourite",g.push("fromcollectiontype-"+("Featured"==d.gs_title?"default":"collection")),g.push("tocollectiontype-"+(n?"default":"collection")));break;case"remove":case"unfav":"remove_favourite";var p="all";"remove"==e&&(p="Featured"==d.gs_title?"default":"collection"),g.push("collectiontype-"+p)}}if(!r&&void 0!=m)for(i=0;i<m.length;i++)m[i]!=this.stream_item&&(h=GMI.query(m[i],"GalleryArrowMenu")[0])&&h.menuSubClick(e,t,s,!0)},ANIPUSH:100,setMenuHTML:function(e,i){if(this.cmn++,this.set_menu_html=e,"none"==i)return this.popup.$node.get(0).firstChild.firstChild.innerHTML=e,void this._adaptPopupHeight();this.menu_animating||(this.menu_animating=!0,this.popup.$node.css("overflow","hidden"),Station.run(this.popup.$node.get(0).firstChild.firstChild,"left",{from:0,to:"right"==i?-this.ANIPUSH:this.ANIPUSH,time:150,f:Interpolators.pulse},this._setMenuHTML_midpoint.bind(this,e,i)),Station.run(this.popup.$node.get(0).firstChild.firstChild,"opacity",{from:1,to:0,time:150,f:Interpolators.sineCurve}),this.menu_animating=!0)},_setMenuHTML_midpoint:function(e,i){this.popup.$node.get(0).firstChild.firstChild.innerHTML=e,Station.run(this.popup.$node.get(0).firstChild.firstChild,"left",{from:"right"==i?this.ANIPUSH:-this.ANIPUSH,to:0,time:150,f:Interpolators.pulse},this._setMenuHTML_end.bind(this,e)),Station.run(this.popup.$node.get(0).firstChild.firstChild,"opacity",{from:0,to:1,time:150,f:Interpolators.sineCurve})},_adaptPopupHeight:function(){var e=this.popup.$node[0];e.style.cssText=e.style.cssText.replace(/height:\s?350px\s?\!\s?important;\s?/,""),this.popup.$node.height()>350?(this.popup.$node.css("overflow","auto"),this.popup.$node.css("overflow-x","hidden"),e.style.cssText="height: 350px !important;"+e.style.cssText):this.popup.$node.css("overflow","hidden");var i=$("legacy"==this.gmi_args.mode?this.gmi_node.firstChild:this.gmi_node);this.popup.show(this.popup.position(i,{keepOnScreen:!0}))},_setMenuHTML_end:function(e){this.menu_animating=!1,e!=this.set_menu_html&&this.setMenuHTML(this.set_menu_html,"none"),this._adaptPopupHeight()},getDefaultMenuHTML:function(){var e,i,t;if("folder"==this.gmi_args.mode){if(!(t=this.folder))return'<div class="blockdisabled">This menu is having a bad day and cannot be displayed</div>';e=t.gmi_args.behavior||{},i=this.gmiUp("GMFrame_Gruser"),i||console.log("Missing sidebar widget frame");var s=(this.gmiUp("EditableFolderStream").gmi_args.behavior||{}).create_subfolder;return(this.getSiblingHeaderHTML()+(e.edit_folder&&"Featured"!=(this.rename_link||this.gmi_node).firstChild.nodeValue?'<a class=f href="#" onclick="GMI.up(this).menuClick(\'rename\');return GMI.evCancel()">Rename this '+(this.gmi_args.item_label||this.DEFAULT_LABEL)+"</a>":"")+(e.delete_folder&&"Featured"!=(this.rename_link||this.gmi_node).firstChild.nodeValue?'<a class=f href="#" onclick="GMI.up(this).menuClick(\'delete\');return GMI.evCancel()">Delete this '+(this.gmi_args.item_label||this.DEFAULT_LABEL)+"...</a>":"")+(e.delete_folder&&s&&"Featured"!=(this.rename_link||this.gmi_node).firstChild.nodeValue?'<a class=f href="##" onclick="GMI.up(this).menuClick(\'move\', null, null, \'right\');return GMI.evCancel();"><span class="blockmenu-right-arrow">&#9658;</span>Move this '+(this.gmi_args.item_label||this.DEFAULT_LABEL)+" to...&nbsp;&nbsp;&nbsp;</a>":"")||'<div class="blockdisabled">This item cannot be Renamed or Deleted</div>')+(i&&i.canBehave("edit")?(e.edit_folder||e.delete_folder?'<div class="blockmenu-hr"></div>':"")+"<a class=f href=\"###\" onclick=\"GMI.up(this).gmiUp('GMFrame_Gruser').loadView('config');Popup2.hideAll();return GMI.evCancel()\">Edit this Widget</a>":"")}e=this.gmi_args.stream_proxy.gmi_args.behavior||{};var r=e.edit_folder,n=this.gmi_args.stream_proxy.gmi_args.set_typeid;n!=RESOURCE_FAVCOLLECTIONS&&n!=RESOURCE_GALLERIES||"set_id"in this.gmi_args.stream_proxy.gmi_args||(r=!1);var a="group"==this.gmi_args.stream_proxy.gmi_args.gruser_type,o=$(this.gmi_node).closest(".tt-a").hasClass("tt-special");return this.getSiblingHeaderHTML()+(r&&!o?'<a class=f href="#" onclick="GMI.up(this).menuClick(\'move\', null, null, \'right\');return GMI.evCancel()"><span class="blockmenu-right-arrow">&#9658;</span>Move to...&nbsp;&nbsp;&nbsp;</a>':"")+(o?"":'<a class=f href="##" onclick="GMI.up(this).menuClick(\'copy\', null, null, \'right\');return GMI.evCancel()"><span class="blockmenu-right-arrow">&#9658;</span>Copy to...&nbsp;&nbsp;&nbsp;</a>')+(r&&this.has_remove_menu?(o?"":this.HR)+'<a class=f href="###" onclick="GMI.up(this).menuClick(\'remove\', '+n+');return GMI.evCancel()">Remove from This '+(this.gmi_args.item_label||this.DEFAULT_LABEL)+"</a>":"")+(n==RESOURCE_FAVCOLLECTIONS&&!a&&this.has_remove_menu?this.HR+'<a class=f href="###" onclick="GMI.up(this).menuClick(\'unfav\');return GMI.evCancel()">Remove from Favourites</a>':"")},findAnyFolder:function(){return GMI.query(this.stream_item,"EditableResourceTV")[0]||GMI.query(this.stream_item,"EditableResourceStack")[0]||GMI.query(this.stream_item,"EditableResourceStream")[0]},getSiblingHeaderHTML:function(){var e;return this.gmi_args.selection_proxy&&(e=this.gmi_args.selection_proxy.getSelection(),e.length>1)?'<div class="blockdisabled">'+e.length+" Selected</div>"+this.HR:""},getFolderList:function(e,i){if(GalleryArrowMenu.ggi_result)return e(GalleryArrowMenu.ggi_result,!0);this.setMenuHTML('<a href="" class=f onclick="GMI.up(this).menuClick(\'back\');return GMI.evCancel()"><span class="blockmenu-left-arrow">'+(Browser.isMac?"&#9664;":"&#9668;")+"</span> Back</a>"+this.HR+'<div class="blockdisabled">Please Wait...</div>',i),DiFi.pushPrivateGet("Gallections","get_gallections_with_permissions",[this.gmi_args.stream_proxy.gmiUp("Gruser").gmi_args.id,this.gmi_args.stream_proxy.gmi_args.set_typeid||this.gmiUp("GalleryEditor").gmi_args.typeid,(this.folder?this.folder.gmi_args.set_id:this.gmi_args.stream_proxy.gmi_args.set_id)||this.gmiUp("GalleryEditor").gmi_args.set_id],function(e,i,t,s){var r;if(i==this.cmn){if(!t)return DiFi.stdErr("Unable to fetch folder list.",s.response.content),void Popup2.hideAll();r=[],jQuery.each(s.response.content,function(e,i){i.rid=[Number(i.resource_typeid),Number(i.galleryid)],i.is_root_folder&&(i.parentid=0),r[i.position]=i}.bind(this)),e(GalleryArrowMenu.ggi_result=r)}}.bind(this,e,this.cmn)),DiFi.send()},renameFocus:renamed:function(e,i){var t,s;if(this.active_renamer){delete this.active_renamer,e=this.makeValidNameString(e),this.updateNameDisplay(e||i),this.rename_link_previous_style&&(this.rename_link.style.display=this.rename_link_previous_style),t=this.gmiUp("GalleryEditor");var r=function(e,t){return e||(this.updateNameDisplay(i),t.response&&t.response.content&&t.response.content.error?alert(t.response.content.error):alert("There was a problem renaming this folder.\n\nPlease try again or choose a different name.")),GalleryArrowMenu.ggi_result=null,e}.bind(this);s=this.findGruserid(),e&&e!=i&&this.performRename(s,this.folder.gmi_args.set_typeid,this.folder.gmi_args.set_id,e,r),t&&t.updateChannels()}},updateNameDisplay:performRename:function(e,i,t,s,r){DiFi.pushPost("Gallections","rename",[e,i,t,s],r),DiFi.timer(1)},findGruserid:function(){if(this.gmi_args.gruser_id)return this.gmi_args.gruser_id;var e=this.gmiUp("GalleryEditor");return e?e.gmi_args.gruser_id:this.gmiUp("Gruser").gmi_args.id},makeValidNameString:function(e){return e=e.replace(/[^a-zA-Z0-9\-_\ \.\?$'\":\,\+]/g," "),e=e.replace(/(?:^\s+|\s+$)/g,""),e=e.replace(/\s{2,}/g," "),e=e.substr(0,44),e.match(/^[a-zA-Z0-9\-_\ \,\.\?$'\"]{1,44}$/)?e:null}}),window.DWait&&DWait.run("jms/pages/gallery/arrowmenu.js")});

DWait.ready(["jms/lib/bind.js","jms/lib/station.js","jms/lib/gstream/resource_stack.js","jms/lib/jquery/jquery.current.js","jms/lib/browser.js","jms/lib/ruler.js","jms/lib/gstream/resource_comms.js","jms/lib/difi_hold.js","jms/lib/difi.js","jms/lib/gmi.js","jms/lib/gstream/resource_stream.js","jms/lib/selection.js"],function(){window.ResourceStreamSelection=Selection.extend(RES_SEL_EXT),window.EditableResourceStream=ResourceStream.extend(EditableResourceStream_proto={hit_rect:{x:0,y:0,y2_buffer:5},gmiConstructor:dataSplice:function(e,t,i){var s;return 0==this.contents.length&&(this.gmi_node.innerHTML=""),s=this.base(e,t,i),this.scatter_hook&&this.scatter_hook.resize(),s},domRemoveItem:function(e){GMI._delete(GMI.query(e,"GalleryArrowMenu")),this.base(e)},emUnfav:function(e,t){if(!t||this.gmi_args.set_typeid!=RESOURCE_FAVCOLLECTIONS||"group"==this.gmi_args.gruser_type)return!1;var i=this.contents.slice(e,e+t),s=0,r=i.length;for(s=0;s<r;s++){var o=i[s][0];o==RESOURCE_GALLERIES||o==RESOURCE_FAVCOLLECTIONS?this.gmi_args.set_id&&DiFi.pushPost("Gallections","remove_resource",[this.gmi_args.gruser_id,this.gmi_args.set_typeid,this.gmi_args.set_id,i[s][0],i[s][1]],DiFiHolder.getStdCallback()):DiFi.pushPost("Deviation","remove_favourite",[i[s][1]],DiFiHolder.getStdCallback())}return DiFi.timer(10),this.dataSplice(e,t),!0},moveResourceToFolder:function(e,t){this.gmi_args.gruser_type||this.gmiUp("EditableFolderStream").gmi_args.gruser_type;if(t){var i=this.contents[e];DiFi.pushPost("Gallections","move_resource",[this.gmi_args.gruser_id,this.gmi_args.set_typeid,this.gmi_args.set_id,t[1],i[0],i[1],0],DiFiHolder.getStdCallback()),DiFi.timer(1)}var s=GMI.query("EditableResourceStream",{set_typeid:this.gmi_args.set_typeid,set_id:this.gmi_args.set_id});s.length&&s[0].refreshResources(e)},emSplice:function(e,t,i,s,r,o){var n,a;this.gmi_args.gruser_type||this.gmiUp("EditableFolderStream").gmi_args.gruser_type;if(t)if(n=this.contents.slice(e,e+t),s){for(a=0;a!=n.length;a++)o?DiFi.pushPost("Gallections","add_resource",[this.gmi_args.gruser_id,s[0],s[1],n[a][0],n[a][1],r+a],DiFiHolder.getStdCallback()):DiFi.pushPost("Gallections","move_resource",[this.gmi_args.gruser_id,this.gmi_args.set_typeid,this.gmi_args.set_id,s[1],n[a][0],n[a][1],r+a],DiFiHolder.getStdCallback());ResourceComms.broadcastDataSplice({set_typeid:Number(s[0]),set_id:Number(s[1])},[r,0,n],this,[this])}else if(!o)for(a=0;a!=n.length;a++)this.gmi_args.set_id&&DiFi.pushPost("Gallections","remove_resource",[this.gmi_args.gruser_id,this.gmi_args.set_typeid,this.gmi_args.set_id,n[a][0],n[a][1]],DiFiHolder.getStdCallback());if(i&&i.length)for(a=0;a!=i.length;a++)this.tmp_from_stream?DiFi.pushPost("Gallections","add_resource",[this.gmi_args.gruser_id,this.gmi_args.set_typeid,this.gmi_args.set_id,i[a][0],i[a][1],e+a],DiFiHolder.getStdCallback()):this.gmi_args.set_id&&DiFi.pushPost("Gallections","add_resource",[this.gmi_args.gruser_id,this.gmi_args.set_typeid,this.gmi_args.set_id,i[a][0],i[a][1],e+a],DiFiHolder.getStdCallback());DiFi.timer(1),o||ResourceComms.broadcastDataSplice({set_typeid:this.gmi_args.set_typeid,set_id:this.gmi_args.set_id},arguments,this,null)},emReceiver:function(e){if(this.edit_mode!=e&&"deleted"!=this.gmi_lifecycle)if(this.edit_mode=e,e){var t,i;this.selector=new(this.override_selection_type||window.ResourceStreamSelection)(this.gmi_node),this.gmi_args.no_selection||this.selector.hook(this.emGetSelectionParams()),t=this.domFindVisible();for(i in t)this.emMakeEditable(t[i])}else GMI._delete(this.gmiQuery("GalleryArrowMenu")),this.selector&&(this.gmi_args.no_selection||(this.selector.setSelection(null),this.selector.unhook()),delete this.selector)},emGetSelectionParams:function(){return{allow_multiple:"rectangle",drag_rect_ruler:this._drag_rect,ignore_clicks:this.gmiUp("Gruser").gmi_args.group||1,global_mouse_cancel:!0,selectable_area:null}},emMakeEditable:function(e){GMI.query(e,"GalleryArrowMenu")[0]||GMI.create("GalleryArrowMenu",{stream_proxy:this,has_remove_menu:this.gmi_args.has_remove_menu,selection_proxy:this.selector,browse_view_mode:this.gmi_args.browse_view_mode,mode:((this.gmiUp("Gruser")||this).gmi_args.group,"modern")}).addToStreamItem(e)},_drag_rect:function(e,t){var i;return i=Ruler.document.node(e,t),Browser.isKHTML?(i.y2+=210,i.h=210):Browser.isIE&&document.documentMode>7&&(i.y-=210,i.h=210),i},domDrawItem:function(e,t){var i;return i=this.base(e,t),this.edit_mode&&t&&t[2]&&1==t[2].nodeType&&this.emMakeEditable(t[2]),i},commsAskForTargetsEnh:function(e,t,i){var s,r=this._contentInterest(i,e);return!1!==r&&(r?(this.contents.length?s=this.selector.getAllSelectableRects(this,!0,t.length>1?null:t[0]):(s=[Ruler.document.node(this.gmi_node)],s[0].index=0,s[0].node=this.gmi_node,s[0].owner=this),s):[])},commsRecvDrop:function(e,t,s){var r;if(this!=e)for(i=0;i!=t.length;i++){if(!((r=e.dataIndexOf(t[i]))>=0))throw alert("Unable to move items due to missing index."),new Error("Missing index");e.emSplice(r,1,[],[this.gmi_args.set_typeid,this.gmi_args.set_id],s.index+this.gs_offset||0,!1)}else try{this!=e&&(this.tmp_from_stream=e),this.emSplice(s.index+this.gs_offset||0,0,t)}finally{this.tmp_from_stream=null}},commsNonInputEvent:function(){},commsDragHover:function(e,t,i,s){if(!window.da_minish_lub||!window.da_minish_lub.out){if(!GMI.query("EditableResourceStream",{match:{browse_mode:1}}).length){var r=$(t.node),o=r.hasClass("tt-fh"),n=t.offset_mark?"r":"l",a=r.children(".tt-w").first();if(o){var m=a.find(".offset-mark-"+n);i?0==m.length&&$("<div></div>").addClass("offset-mark-"+n).appendTo(a):m.remove()}else i?a.addClass("drag-hover-"+n):a.removeClass("drag-hover-l drag-hover-r")}}},_contentInterest:function(e,t){if(!this.gmi_args.gruser_id)return 0;if(!this.edit_mode&&"gmi-EditableResourceTV"!=this.gmi_node.id)return 0;if(!(this.gmi_args.behavior||{}).edit_folder)return 0;for(i=0;i!=e.length;i++)if(1!=Number(e[i][0])){if(window.EditableFolderStream&&t instanceof EditableFolderStream)return 0;if(21!=Number(this.gmi_args.set_typeid))return 0;if("group"==this.gmi_args.gruser_type)return 0}return 1}}),window.EditableResourceTV=EditableResourceStream.extend({commsAskForTargetsEnh:function(e,t,i){var s;return this._contentInterest(i,e)?(s=Ruler.document.node(this.gmi_node.parentNode.parentNode),s.node=this.gmi_node,s.owner=this,s.index=0,[s]):[]},commsRecvDrop:function(e,t,i){try{this.tmp_from_stream=e,this.emSplice(i.index+this.gs_offset||0,0,t)}finally{this.tmp_from_stream=null}},commsDragHover:function(e,t,i,s){var r=this.gmi_node.parentNode.parentNode.parentNode;i?r.className+=" selected":r.className=r.className.replace(/\s*\bselected\b/g,"")},emReceiver:),window.EditableResourceFolderLink=EditableResourceTV.extend({domDrawItem:function(){},dataSplice:function(){},domFindVisible:function(){}}),window.EditableResourceCustomIcon=EditableResourceTV.extend({commsAskForTargetsEnh:function(e,t,i){var s;return this._contentInterest(i,e)?(s=Ruler.document.node($("img",this.gmi_node).get(0)),s.node=this.gmi_node,s.owner=this,s.index=0,[s]):[]},domDrawItem:function(){},dataSplice:function(){},domFindVisible:function(){}}),window.EditableResourceStack=ResourceStack.extend(EditableResourceStream_proto),window.GPageButton=EditableResourceStream.extend({domDrawItem:function(){},dataSplice:function(){},domFindVisible:function(){},domReadMeta:function(){this.gs_offset=Number(this.gmi_args.offset),this.gs_count_per_page=1,this.gs_fetch_size=0,this.gs_fetch_bank=0},commsAskForTargetsEnh:function(e,t,i){var s;return i[0]&&1==Number(i[0][0])?(s=Ruler.document.node(this.gmi_node),s.node=this.gmi_node,s.owner=this,s.index=0,[s]):[]},commsRecvDrop:function(e,t,i){mod=0,e.emSplice(i.index+this.gs_offset+mod,0,t),e.domDrawRange(e.gs_offset,e.gs_count_per_page)},commsDragHover:function(e,t,i,s,r){var o,n,a=this.gmi_node;for(i?a.className+=" nav-drag-hover":a.className=a.className.replace(/\s*\bnav.drag.hover\b/g,""),o=0;n=r[o];o++)Station.run(n.node,"opacity",{from:Station.read(n.node,"opacity")||1,to:i?.25:1,time:150,f:Interpolators.sineCurve})}}),window.DWait&&DWait.run("jms/lib/gstream/folders/editable_resource_stream.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js"],function(){/**
 * @license
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
!function(n,u){"$:nomunge";var e,t=n.jQuery||n.Cowboy||(n.Cowboy={});t.throttle=e=t.debounce=(window),window.DWait&&DWait.run("jms/lib/jquery/plugins/jquery.throttle-debounce.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js"],function(){!function(e,i){"use strict";var a="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(i){nction n(i,n){i.src!==a&&-1===e.inArray(i,c)&&(c.push(i),n?A.push(i):l.push(i),e.data(i,"imagesLoaded",{isBroken:n,src:i.src}),d&&s.notifyWith(e(i),[n,u,e(l),e(A)]),u.length===c.length&&(setTimeout(r),u.unbind(".imagesLoaded",t)))}var o=this,s=e.isFunction(e.Deferred)?e.Deferred():0,d=e.isFunction(s.notify),u=o.find("img").add(o.filter("img")),c=[],l=[],A=[];return e.isPlainObject(i)&&e.each(i,,u.length?u.bind("load.imagesLoaded error.imagesLoaded",t).each(function(i,r){var t=r.src,o=e.data(r,"imagesLoaded");return o&&o.src===t?void n(r,o.isBroken):r.complete&&void 0!==r.naturalWidth?void n(r,0===r.naturalWidth||0===r.naturalHeight):void((r.readyState||r.complete)&&(r.src=a,r.src=t))}):r(),s?s.promise(o):o}}(jQuery),window.DWait&&DWait.run("jms/lib/jquery/plugins/jquery.imagesloaded.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/pubsub.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js"],function(){!function(e){({updateTimer:null,active:!1,init:function(){PubSub.subscribe({eventname:"ImageLazyLoad.activate",subscriber:this,callback:this.activate}),PubSub.subscribe({eventname:"ImageLazyLoad.delayedUpdate",subscriber:this,callback:this.delayedUpdate}),PubSub.subscribe({eventname:"ImageLazyLoad.update",subscriber:this,callback:this.update})},activate:function(){this.active||(this.active=!0,e(window).on("load resize scroll",e.throttle(200,this.update.bind(this))),this.delayedUpdate())},delayedUpdate:update:function(){var a=e(window).width(),t=e(window).height();e(".image-lazy-load:visible").each(function(){var i=e(this),s=i[0].getBoundingClientRect();if(s.bottom>0&&s.top<t&&s.right>0&&s.left<a){i.removeClass("image-lazy-load");var u=i.data("src");i.hasClass("image-lazy-load-background")?(u||(u=i.data("background")),u&&i.css("background-image","url('"+u+"')").find("img").prop("src",u)):u&&i.attr("src",u)}})}}).init()}(jQuery),window.DWait&&DWait.run("jms/lib/image_lazy_load.js")});

DWait.ready(["jms/lib/station.js","jms/lib/ruler.js","jms/lib/browser.js","jms/lib/ddd.js","jms/lib/jquery/jquery.current.js"],function(){Surfer2={create:function(e,r){var t;return t=$("<div>",{class:"surfer2"}).appendTo("body"),t={node:t[0],o:r||DDD.p_down},Surfer2.update(t,e),t},update:function(e,r){var t,n,o,a;return a=Browser.isIE?2:0,o={},t=Ruler.document.pointer(r),n=e.o,o.x=t.x>n.x?n.x:t.x,o.x2=t.x>n.x?t.x:n.x,o.y=t.y>n.y?n.y:t.y,o.y2=t.y>n.y?t.y:n.y,Station.apply(e.node,"left",o.x),Station.apply(e.node,"top",o.y),Station.apply(e.node,"width",Math.max(o.x2-o.x,1)+a),Station.apply(e.node,"height",Math.max(o.y2-o.y,1)+a),o},clear:,window.DWait&&DWait.run("jms/lib/surfer2.js")});

DWait.ready(["jms/lib/site.js","jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/lib/glbl.js","jms/lib/sidebar.js","jms/lib/bind.js","jms/pages/writeranywhere/ui.js","jms/lib/writer/factory.js","jms/lib/pubsub.js","jms/lib/ddt.js","jms/lib/gmi.js"],function(){!function(e){window.WriterAnywhere=GMIBase.extend({writer:null,owner:null,ccwriter_scrolloffset:null,ccwriter_inited:0,ccwriter_expanded:0,ccwriter_expanded_first:0,ccwriter_wide:0,ccwriter_closing:0,default_options:{animate_time:200,sync_timeout:1e3,height_drop:118,sidespace:25,has_sidebar:!0,has_skinbar:!1,has_conversation:!1,passthrough_tab:!1,toolbar_initial_container:null,toolbar_file:!1,toolbar_edit:!1,toolbar_link:!0,toolbar_align:!0,toolbar_blockquote:!0,toolbar_headings:!1,drafts:!1,draft_handler:"DraftHandler",draft_title:function(){return"Draft"},image_actions:["Image","Full","Thumb","Link","Remove"],image_resize:!0,embedded_item_limit:!1,sidebar_premium_upsell:!0,sidebar_click_callback:on_switch_editing_mode:function(){},on_save_content:function(){},on_load_content:function(){},call_on_save_if_empty:!1,placeholder_if_focused:!1,enable_underlay_placeholder:!1,remember_editing_mode:!1,valid_tags:["br","hr","strong","small","b","code","sub","sup","tt","acronym","a","abbr","strike","em","i","s","u","ins","span","div","blockquote","p","bcode","ul","li","ol","da:embed","da:deviation","da:thumb","da:bigthumb","da:emoticon","da:drawing","img","font","h1","h2","h3","h4","h5","h6"]},gmiConstructor:gmiDestructor:function(){this.ccwriter_inited&&!this.ccwriter_closing&&(ddt.log("writer","WriterAnywhere gmiDestructor"),PubSub.publish("WriterAnywhere.shutdown"),PubSub.publish("WriterSidebar.stop_stash"),WriterFactory.destroy(this.$.find("textarea")),this.owner&&this.owner.detach(!0,!0))},setOwner:function(t){this.owner=t,this.owner.active=!0,this.options=e.extend({},this.default_options,this.owner.options)},load:function(){this.owner.before_load.apply(this);var t=e(".commentwriter-toolbar"),i=e(".commentwriter-sidebar-inner");this.$writer_ui=t.add(i),this.$writer_ui.hide();var r=this.$.find("textarea")[0].style.height||0;this.$.find("textarea").show().wrap('<div class="ccwriter-content"></div>'),this.$.siblings(".commentwriter-underlay").remove(),this.writer=WriterFactory.toggle(this.$.find("textarea"),{storage:this.options.drafts?"DefaultStorage":"NoSaveStorage",draft_handler:this.options.draft_handler,draft_title:this.options.draft_title,draft_metadata:this.options.draft_metadata,sync_timeout:this.options.sync_timeout,content_id:WriterAnywhereUI.last_draft_id,imagecontrol_options:{attach_point:".ccwriter-content",allowed_image_actions:this.options.image_actions,prevent_resize:!this.options.image_resize},valid_tags:this.options.valid_tags,valid_attrs:this.options.valid_attrs,toolbars:[{toolbar_name:"writersub",toolbar_node:e(this.options.toolbar_initial_container||"<div>")[0],toolbar_button_class:"subToolbarButton",toolbar_menu_class:"subToolbarMenu",toolbar_popup_class:"stashwriter-subtoolbar-menu stashwriter-subtoolbar-menu",toolbar_order:["bold","italic","underline","separator","link","blockquote","ul","ol","separator","alignl","alignc","alignr"]}],allow_html_mode:!0,passthrough_tab:this.options.passthrough_tab,block_sidescroll:this.options.block_sidescroll,on_switch_editing_mode:function(){if(this.options.remember_editing_mode)try{var e="writeranywhere-editing-mode-"+this.owner.type;console.log("storage",e),this.writer.inHtmlMode()?localStorage.setItem(e,1):localStorage.removeItem(e)}catch(e){}this.options.on_switch_editing_mode.apply(this)}.bind(this),on_save_content:this.options.on_save_content.bind(this),on_load_content:this.options.on_load_content.bind(this),call_on_save_if_empty:this.options.call_on_save_if_empty,placeholder_if_focused:this.options.placeholder_if_focused,autocomplete_priority:this.options.autocomplete_priority},{separate_ident:!0}),this.writer.$node[0].style.paddingBottom="",r&&(this.writer.$node[0].style.minHeight=r),this.writer.insert_thumbs=!0;try{localStorage.getItem("writeranywhere-editing-mode-"+this.owner.type)&&this.writer.switchToHtmlMode()}catch(e){}var s=!1;this.options.initial_sidebar_on_expand||(s=this.options.initial_sidebar_selection?this.options.initial_sidebar_selection:this.options.has_conversation?"conversation":"stash");var o=this,n=[window.deviantART.deviant&&window.deviantART.deviant.loggedIn?"gallery":"",window.deviantART.deviant&&window.deviantART.deviant.loggedIn?"faves":"","search",this.options.has_conversation?"conversation":"",window.deviantART.deviant&&window.deviantART.deviant.loggedIn?"stash":"","art","emotes"];WriterAnywhereUI.sidebar?(WriterAnywhereUI.sidebar.click_callback=this.options.sidebar_click_callback.bind(this),WriterAnywhereUI.sidebar.options.premium_upsell=this.options.sidebar_premium_upsell,WriterAnywhereUI.sidebar.reinit_modes(n,s),PubSub.unsubscribe([{eventname:"WriterEmbed.loaded",subscriber:WriterAnywhereUI},{eventname:"WriterSidebar.activate_tab",subscriber:WriterAnywhereUI},{eventname:"Writer.sync",subscriber:WriterAnywhereUI}])):WriterAnywhereUI.sidebar=new WriterSidebar(e(".commentwriter-sidebar-inner"),this.options.sidebar_click_callback.bind(this),{initial_selection:s,upload_thumb:!0,height_drop:this.options.height_drop,sections:n,premium_upsell:this.options.sidebar_premium_upsell}),PubSub.subscribe([{eventname:"WriterEmbed.loading",subscriber:WriterAnywhereUI,callback:this.disable_sidebar_if_necessary.bind(o)},{eventname:"WriterSidebar.activate_tab",subscriber:WriterAnywhereUI,callback:this.disable_sidebar_if_necessary.bind(o)},{eventname:"Writer.sync",subscriber:WriterAnywhereUI,callback:this.disable_sidebar_if_necessary.bind(o)}]),this.sidebar=WriterAnywhereUI.sidebar,this.owner.after_load.apply(this)},hook:function(){if(this.ccwriter_closed=0,this.ccwriter_initing=1,"deleted"!=this.gmi_lifecycle){if(!this.writer)return void DWait.ready(["cssms/lib/writer.css","cssms/lib/writer-subtoolbar.css","jms/lib/writer/factory.js","jms/lib/sidebar.js"],function(){"deleted"==this.gmi_lifecycle||this.ccwriter_closed||(this.load(),this.hook())}.bind(this));this.writer.$node.focus(function(){this.$writer_ui[0].className+=" open",Glbl("Site.is_stash")&&(Glbl("StashStream.navigation_keyboard_disabled",!0),Glbl("StashStream.minibrowse_keyboard_disabled",!0))}.bind(this)),this.writer.$node.blur(function(t){Glbl("Site.is_stash")&&(Glbl.del("StashStream.navigation_keyboard_disabled"),Glbl.del("StashStream.minibrowse_keyboard_disabled")),this.writer.sync(),setTimeout(function(){!this.sidebar_clicked&&this.sidebar&&e(this.$writer_ui[0]).removeClass("open")}.bind(this),100)}.bind(this)),this.$.addClass("ccwriter-wrapper").find("textarea").removeClass("writeranywhere"),this.sidebar.$.css({top:0}).hide(),this.sidebar.on_hide(),this.ccwriter_inited=1,PubSub.subscribe([{eventname:"WriterAnywhere.expand",subscriber:this,callback:this.expandWriterUI},{eventname:"WriterAnywhere.collapse",subscriber:this,callback:this.collapseWriterUI},{eventname:"WriterAnywhere.shutdown",subscriber:this,callback:this.closeWriterUI,empty_queue_if_first_subscriber:!0},{eventname:"Location.changed",subscriber:this,callback:this.closeWriterUI,empty_queue_if_first_subscriber:!0},{eventname:"Location.set",subscriber:this,callback:this.closeWriterUI,empty_queue_if_first_subscriber:!0}]),this.owner.after_hook.apply(this),this.owner.activating=!1,this.owner.active=!0,this.ccwriter_initing=0,PubSub.publish("WriterAnywhere.hooked",this)}},closeWriterUI:function(t){t=t||null,this.ccwriter_closing=1;var i=e.Deferred();if(this.ccwriter_initing)PubSub.subscribe([{eventname:"WriterAnywhere.hooked",subscriber:this,callback:function(){PubSub.unsubscribe([{eventname:"WriterAnywhere.hooked",subscriber:this}]),i.resolve()}}]);else if(!this.ccwriter_inited)return i.resolve(),i;if(i.done(function(){this.ccwriter_inited&&this.ccwriter_closing&&(PubSub.unsubscribe([{eventname:"WriterAnywhere.expand",subscriber:this},{eventname:"WriterAnywhere.collapse",subscriber:this},{eventname:"WriterAnywhere.shutdown",subscriber:this},{eventname:"Location.changed",subscriber:this},{eventname:"Location.set",subscriber:this},{eventname:"WriterEmbed.loading",subscriber:WriterAnywhereUI},{eventname:"WriterSidebar.activate_tab",subscriber:WriterAnywhereUI},{eventname:"Writer.sync",subscriber:WriterAnywhereUI}]),this.ccwriter_inited=0,this.ccwriter_closing=0,this.ccwriter_closed=1,WriterAnywhereUI.sidebar.click_callback=function(){})}.bind(this)),this.writer.sync(),this.owner.empty=this.writer&&!this.writer.$textarea.val().length,this.ccwriter_inited)if("string"==typeof t){var r=this.owner._get_bodycontent_selector.apply(this);this.owner.before_shutdown.apply(this),WriterAnywhereUI.recordScrollPosition(r),e.each(this.writer.toolbars,function(e,t){t.destroy()});var s=this.owner._get_underlay_source.call(this);this.options.enable_underlay_placeholder&&this.writer.$textarea.attr("placeholder")&&!s&&(s=this.writer.$textarea.attr("placeholder")),this.writer.destroy(),this.writer=null;var o=this.$.find("textarea");o.unwrap().unwrap().addClass("writeranywhere").removeClass("writer").hide().after(e('<div class="writeranywhere commentwriter-underlay'+(this.owner.options.expand_immediately?" expandplz":"")+(0===s.length?" empty":"")+'">').data("type",this.owner._type).html(s)),e(".commentwriter-toolbar-inner").empty(),e("body").hasClass("ccwriter-subframe")&&(e(".commentwriter-interface").hide(),e("body").removeClass("stickhelper ccwriter-subframe ccwriter-journal"),e(window).off("resize.writeranywhere"),e(r).css("min-height",""),e(r+" > *, #output:visible > *").css("margin-right",""),e(r+", #output:visible").css("right","")),this.owner.after_shutdown.apply(this,[o]),WriterAnywhereUI.scroll(r),this.sidebar.on_hide(),i.resolve()}else this.collapseWriterUI(function(){var t=this.writer.$node.html();this.options.enable_underlay_placeholder&&this.writer.$textarea.attr("placeholder")&&!t&&this.owner.empty&&(t=this.writer.$textarea.attr("placeholder")),this.writer.destroy(),this.writer=null,this.$.find("textarea").unwrap().unwrap().addClass("writeranywhere").removeClass("writer").hide().after(e('<div class="writeranywhere commentwriter-underlay'+(this.owner.options.expand_immediately?" expandplz":"")+(this.owner.empty?" empty":"")+'">').data("type",this.owner._type).html(t)),i.resolve()}.bind(this),!0);else i.resolve();return i},expandWriterUI:function(){if(!this.ccwriter_expanded){this.ccwriter_wide=this.$.offset().left<326&&e(window).width()-this.$.offset().left-this.$.width()<326,this.owner.before_expand.apply(this),this.ccwriter_expanded_first||(this.ccwriter_expanded_first=1,this.options.initial_sidebar_on_expand&&(this.sidebar.options.initial_selection=this.options.initial_sidebar_on_expand,this.sidebar.modes[this.options.initial_sidebar_on_expand].display())),this.sidebar.on_show(),this.sidebar.active&&"stash"==this.sidebar.active.type_name()&&(this.sidebar.active=null,PubSub.publish("WriterSidebar.start_stash",!0));var t,i,r=this.owner._get_bodycontent_selector.apply(this);WriterAnywhereUI.recordScrollPosition(r),t=this.$.offset().top,e(".ohm-stickhelper:visible").length&&e("body").addClass("stickhelper"),e("body").removeClass("ccwriter-collapsed").addClass("ccwriter-subframe"),e(window).off("resize.writeranywhere").on("resize.writeranywhere",e.throttle(50,function(){this.owner._expanded_resize.apply(this)}.bind(this))),WriterAnywhereUI.scroll(r,!0).done(function(){var r=this.owner._get_bodycontent_selector.apply(this),s=e(e("#output > "+r).length?r:r+", #output:visible");i=s.scrollTop()+this.$.offset().top,Math.abs(i-t)>100&&s.scrollTop(i-t+s.scrollTop()),e(".commentwriter-interface").show(),e("table#commentwriter-topmenu").removeAttr("style"),e(this.$writer_ui[0]).show().height(0).animate({height:46},this.options.animate_time,.find("table").show(),this.options.has_sidebar?DWait.ready(["cssms/pages/stash/stash.override.thumbs.css","cssms/pages/stash/stash.header.css"],function(){e(this.$writer_ui[1]).parent().show().width(0).animate({width:300},this.options.animate_time).children().show()}.bind(this)):(e(this.$writer_ui[1]).parent().hide(),e("body").addClass("ccwriter-toolbar-only")),e.each(this.writer.toolbars,function(e,t){t.destroy()}),this.writer.createToolbars(null,[{toolbar_name:"writertop",toolbar_node:e(".commentwriter-toolbar-inner")[0],toolbar_button_class:"headerButton",toolbar_menu_class:"headerMenu gmbutton2",toolbar_order:["separator","undo","redo",this.options.toolbar_file?"file":"",this.options.toolbar_edit?"edit":"","separator"]},{toolbar_name:"writersub",toolbar_node:e(".commentwriter-toolbar-inner")[0],toolbar_button_class:"subToolbarButton",toolbar_menu_class:"subToolbarMenu",toolbar_popup_class:"stashwriter-subtoolbar-menu stashwriter-subtoolbar-menu",toolbar_order:["bold","italic","underline",this.options.toolbar_headings?"headings":"","separator","ul","ol"].concat(this.options.toolbar_blockquote?["blockquote"]:[],this.options.toolbar_align?["separator","alignl","alignc","alignr"]:[],this.options.toolbar_link?["separator","link"]:[])}]),e.each(this.writer.toolbars,function(e,t){t.show(),t.rebind()}),e(this.$writer_ui[0]).find(".commentwriter-cancel, .commentwriter-submit, .commentwriter-preview").off("click.writeranywhere"),e(this.$writer_ui[0]).find(".oh-stashmain").hover(function(){e(this).addClass("mmhover")},,this.owner.after_expand.apply(this),PubSub.publish("WriterSidebar.start_stash"),this.$.addClass("expanded"),e(window).trigger("resize.writeranywhere"),this.ccwriter_expanded=1,WriterAnywhereUI.expanded=!0}.bind(this))}},collapseWriterUI:function(t){var i,r,s=this.owner._get_bodycontent_selector.apply(this),o=e(s),n=e("#output:visible"),a=o.add(n),l=a.children(),d=e("#output > "+s).length?o:a;this.owner.before_collapse.apply(this),PubSub.publish("WriterSidebar.stop_stash"),i=d.scrollTop()+this.$.offset().top,WriterAnywhereUI.recordScrollPosition(s,!0),this.options.has_sidebar&&e(".commentwriter-sidebar").animate({width:0},this.options.animate_time),l.animate({"margin-right":0},this.options.animate_time),a.scrollLeft()?a.animate({right:0,scrollLeft:0},this.options.animate_time):a.animate({right:0},this.options.animate_time),this.sidebar&&this.sidebar.on_hide(),e(".commentwriter-toolbar").animate({height:0},this.options.animate_time,function(){this.ccwriter_inited&&(this.writer.$node.off("focus.writeranywhere"),e("body").removeClass("ccwriter-subframe ccwriter-journal ccwriter-toolbar-only").addClass("ccwriter-collapsed"),e(window).off("resize.writeranywhere"),o.css("min-height",""),l.css("margin-right",""),a.css("right",""),WriterAnywhereUI.scroll(s),e("body").removeClass("stickhelper"),this.ccwriter_wide=0,e.each(this.writer.toolbars,,this.writer.createToolbars(null),e.each(this.writer.toolbars,,e("#modalspace .commentwriter-interface").detach().appendTo("body"),e(".commentwriter-interface").hide(),r=this.$.offset().top,Math.abs(r-i)>100&&e(window).scrollTop(r-i+e(window).scrollTop()),this.$.removeClass("expanded"),this.ccwriter_expanded=0,WriterAnywhereUI.expanded=!1,PubSub.publish("WriterAnywhere.collapsed"),t&&"function"==typeof t&&t.call())}.bind(this)),this.owner.after_collapse.apply(this),e('<input style="position:fixed; left: 0; top: 0">').appendTo("body").focus().remove()},_sidebar_should_be_disabled:function(){return this.options.embedded_item_limit?this.writer?this.writer.$node.find('.writer-embed[data-embed-type!="emoticon"], .writer-embed-loader[data-embed-type!="emoticon"]').length<this.options.embedded_item_limit?(ddt.log("writer","embed limit not reached"),!1):"emotes"!=this.sidebar.active.name||(ddt.log("writer","we're on emotes"),!1):(ddt.log("writer","no writer active"),!1):(ddt.log("writer","no embedded_item_limit"),!1)},disable_sidebar_if_necessary:function(){this.sidebar&&(this._sidebar_should_be_disabled()?(ddt.log("writer","sidebar should be disabled"),0===this.sidebar.active.$main.find(".writer-sidebar-limit-overlay").length&&this.sidebar.active.show_overlay("limit",e("<div>The maximum of <b>"+this.options.embedded_item_limit+" thumbnails</b> for this comment has already been reached.</div>"))):(ddt.log("writer","sidebar should NOT be disabled"),this.sidebar.$.find(".writer-sidebar-limit-overlay").remove()))},_preview_window:null,_preview_timeout:null,_preview_window_name:"daWriterPreview",open_preview:function(e,t){var i=e||this;PubSub.subscribe([{eventname:"Writer.sync",subscriber:i,callback:function(e,r){if(i.writer.storage.id()){PubSub.unsubscribe({eventname:"Writer.sync",subscriber:i});var s=document.location.protocol+"//sta.sh",o=s+"/writer/preview/"+(i.writer.storage.id()||"empty");i._open_preview_window(o),t&&window.addEventListener("message",function(e){var r=JSON.parse(e.data);r.target&&"create_preview"==r.target&&i._preview_window.postMessage(JSON.stringify({target:"skin_preview",css:t.css}),"*")}),i._preview_window.focus()}else window.setTimeout(3e3)}}]),i.writer.draft_handler.force_save()},_open_preview_window:function(e){if(e=e||"",!this._preview_window||this._preview_window.closed?this._preview_window=popup(e,this._preview_window_name,600,null,!0):e&&this._preview_window.location.replace(e),!this._preview_window)return alert("Preview window has been blocked. Please allow for Sta.sh to open a popup window."),!1;try{e||(this._preview_window.document.body.innerHTML='<style>body {background: whiteSmoke; font: 27px "Trebuchet MS", Arial, sans-serif;text-align: center; padding-top: 1em;color: #939499;padding: 0; margin: 0;}</style>')}catch(e){console.log(e)}return this._preview_window.focus(),!0},_inject_frame:function(e){return this._preview_window&&(this._preview_window.document.body.innerHTML+='<iframe frameborder="0" height="100%" id="preview_frame" src="'+e+'" width="100%">Loading...</iframe>'),!0}})}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/core.js")});

DWait.ready(["jms/lib/site.js","jms/lib/pubsub.js","jms/lib/gmi.js","jms/lib/jquery/jquery.current.js","jms/lib/ddt.js"],function(){!function(s){window.WriterAnywhereUI={sidebar:null,skinbar:null,last_draft_id:null,scroll_offset:null,expanded:!1,skinbar_fudge:8,scroll:function(i,e){var t=i,r=this,l=s.Deferred();if(this.scroll_offset){var o=this.scroll_offset.left,n=this.scroll_offset.top;if(e){var a=s(s("#output > "+t).length?t:t+", #output:visible");a.scrollLeft(o),setTimeout(function(){a.scrollTop(r.scroll_offset.top),window.scrollTo(0,0),l.resolve()},0)}else window.scrollTo(o,n),l.resolve()}else ddt.log("writer","UI scroll requested without a place to scroll to"),l.resolve();return l},recordScrollPosition:function(i,e){this.scroll_offset={};var t=i,r=s(s("#output > "+t).length?t:t+", #output:visible");r.length&&(r.scrollTop()||e)?this.scroll_offset.top=r.scrollTop():this.scroll_offset.top=s(window).scrollTop(),r.length&&(r.scrollLeft()||e)?this.scroll_offset.left=r.scrollLeft():this.scroll_offset.left=s(window).scrollLeft()},openSkinbar:function(i){var e=this;this.sidebar.on_hide();var t=this.sidebar.$.find(".types-main").height();this.sidebar.$.addClass("sidebar-collapsed").find(".types-main").animate({height:0},i,,s(".commentwriter-skinbar-inner .current-skin").hide(),this.skinbar.$.show().find(".types-main").css({height:0}).animate({height:t-this.skinbar_fudge},i)},closeSkinbar:function(i){var e=this,t=this.skinbar.$.find(".types-main").height();this.sidebar.$.removeClass("sidebar-collapsed").find(".types-main").animate({height:t+this.skinbar_fudge},200),this.skinbar.applySkin(),this.skinbar.$.find(".types-main").animate({height:0},200,function(){e.skinbar.$.hide(),s(".commentwriter-skinbar-inner .current-skin").show(),e.sidebar.modes[i].display(),e.sidebar.on_show()})}}}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/ui.js")});

DWait.ready(["jms/pages/writeranywhere/core.js","jms/pages/writeranywhere/ui.js","jms/lib/pubsub.js","jms/lib/writer/writer.js","jms/lib/jquery/jquery.current.js","jms/lib/browser.js","jms/lib/glbl.js","jms/lib/bind.js","jms/lib/ddt.js","jms/lib/Base.js"],function(){!function(e){var r=Base.extend({types:{},current:null,storage:{},get:function(e,r,t,i){if(r.length&&(i||this.enabled(r))){var s=this._id(r);return!e&&s&&this.storage[s]?(this.attach(r,t),this.storage[s]):this.types[e]?(this.storage[s]||(this.storage[s]=new this.types[e],this.storage[s]._type=e),this.attach(r,t),this.storage[s]):void ddt.log("writer","Tried to initialize WriterAnywhere with invalid type",e)}},getInto:function(r,t,i){var s=e.Deferred();return t.length&&Function.prototype.bind?((this[i]?this[i].detach(!0):e.Deferred().resolve()).done(function(){this[i]=WriterAnywhereFactory.get(r,t,!0),this[i]?(t.addClass("writeranywhere"),s.resolve()):s.reject()}.bind(this)),s):s.reject()},register:function(e,r,t){t.type=e,this.types[e]=r?this.types[r].extend(t):t},enabled:function(r){return e(r).data("always-writer")||!(Glbl("Site.is_mobile")||!(Browser.isChrome||Browser.isFirefox||Browser.isSafari||Browser.isOpera||Browser.isIpad||Browser.isIE&&!Browser.isIE8)||e(r).data("disable-writer")||e(r).find("textarea").data("disable-writer")||window.disable_writer_anywhere||jQuery.fn.jquery!=e().jquery||!jQuery.expr[":"].gmi||!e.expr[":"].gmi)},remove:function(r){var t;t=this.current&&this.current._id()==this._id(r)?this.current.detach(!0):e.Deferred().resolve(),t.done(function(){r[0].getAttribute("ident")&&Writer.getActive().id==r[0].getAttribute("ident")+"-writer"&&Writer.deactivateAll();var e=this._id(r);delete this.storage[e]}.bind(this))},attach:function(r,t){t=t||!1;var i,s=this._id(r);if(this.current&&this.current.ccwriter&&!this.current.ccwriter.ccwriter_closed){if(this.current._id()==s)return;i=this.current.detach(!0)}else i=e.Deferred().resolve();i.done(function(){this.storage[s].attach(r),t&&this.storage[s].activate()}.bind(this))},_id:function(e){if(e[0].getAttribute("ccwident"))return e[0].getAttribute("ccwident");var r="writeranywhere"+Math.round(1e10*Math.random());return e[0].setAttribute("ccwident",r),r}});window.WriterAnywhereFactory=new r,PubSub.subscribe([{eventname:"gWebPage.update",subscriber:WriterAnywhereUI,callback:function(e,r){if((!r.called_from||"Deck.categoryHelpPreview"!=r.called_from&&"Dapi.mergeRequestData"!=r.called_from)&&(WriterAnywhereFactory.current&&WriterAnywhereFactory.current.detach(!0),"undefined"!=typeof da_minish_lub&&da_minish_lub&&da_minish_lub.unpause(),this.sidebar)){var t=this.sidebar.options.initial_selection||"art";this.sidebar.modes[t]&&this.sidebar.modes[t].display()}}}]);var t=function(r){var t,i=e(r.target),s=i;if(!i.closest(".commentwriter-interface").length)if("click"==r.type?t="div.writer, textarea.writeranywhere, a.showMedia, div.commentwriter-underlay":"focusin"==r.type&&(t="div.writer, textarea.writeranywhere"),i.is(t)||i.closest(t).length){var n=null;if(i.is("textarea.writeranywhere"))n=i;else if(i.is("div.writer"))"focusin"!=r.type&&i.is(":focus")||(n=i.siblings("textarea[ccwident]"));else if(i.is("div.commentwriter-underlay"))n=i.siblings("textarea[ccwident]");else if(i.is("a.showMedia")){do{i=i.parent()}while(!i.find("textarea[ccwident]").length);n=i.find("textarea[ccwident]")}else ddt.log("writer","WriterAnywhere trigger ran into an impossible click");if(n){if(!WriterAnywhereFactory.enabled(n.get(0)))return void(/comment$/.test(n.data("type"))?n.closest(":gmi(TalkPostWrapper)").gmiWake():PubSub.publish("WriterAnywhere.activation_aborted",n));var a=e.Deferred(),c=n.attr("ccwident");c&&WriterAnywhereFactory.current&&WriterAnywhereFactory.current._id()==c?a.resolve():(PubSub.subscribe([{eventname:"WriterAnywhere.hooked",subscriber:this,callback:function(){PubSub.unsubscribe([{eventname:"WriterAnywhere.hooked",subscriber:this}]),a.resolve()}}]),WriterAnywhereFactory.get(n.data("type"),n,!0)),a.done(function(){var e=WriterAnywhereFactory.get(n.data("type"),n,!0);if(e){var t=e.options.ui;"click"==t.expand_on&&s.is(t.selector)&&(r.preventDefault(),e.ccwriter.writer.remember_selection(),WriterAnywhereUI.expanded&&s.is("a.hideMedia")?PubSub.publish("WriterAnywhere.collapse"):PubSub.publish("WriterAnywhere.expand"),e.ccwriter.writer.restore_selection())}})}}else if(WriterAnywhereFactory.current){var o,d,u;o=WriterAnywhereFactory.current,u=!1,o.ccwriter&&o.ccwriter.writer&&(u=o.ccwriter.writer.getContent()),d=o.options.ui,WriterAnywhereUI.expanded?"click_out"==d.collapse_on?PubSub.publish("WriterAnywhere.collapse"):"click_out"!=d.shutdown_on||u||PubSub.publish("WriterAnywhere.collapse"):"click_out"!=d.shutdown_on||u||PubSub.publish("WriterAnywhere.shutdown")}};e(document).on("click.underwriter",t).on("focus.underwriter","div.writer, textarea.writeranywhere",t),PubSub.publish("QUnit.WriterAnywhereFactory.loaded")}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/factory.js")});

DWait.ready(["jms/pages/writeranywhere/core.js","jms/lib/jquery/jquery.current.js","jms/lib/glbl.js","jms/lib/pubsub.js","jms/lib/ddt.js","jms/lib/bind.js","jms/lib/Base.js","jms/pages/writeranywhere/factory.js"],function(){!function(e){WriterAnywhereFactory.register("base",null,Base.extend({ccwriter:null,$node:null,active:!1,activating:!1,options:{},_id:function(){return this.$node[0].getAttribute("ccwident")||""},attach:function(e){this.active||this.activating||(this.$node=e,this._attach_media_button_if_desired(this.$node),WriterAnywhereFactory.current=this)},activate:function(){if(this.active||this.activating)ddt.log("writer","WriterAnywhere already active in this instance");else{this.activating=!0;var t;t=WriterAnywhereFactory.current&&WriterAnywhereFactory.current._id()!=this._id()?WriterAnywhereFactory.current.detach(!0):e.Deferred().resolve(),t.done(function(){this.$node.parents(":gmi(WriterAnywhere)").length||this.$node.wrap(e("<div>",{"data-gmiclass":"WriterAnywhere"})).gmiWake(),this.ccwriter=this.$node.parent().gmi1(),this.ccwriter.setOwner(this),this.ccwriter.hook()}.bind(this))}},detach:function(t){if(t=t||!1,this.ccwriter){var i=e.Deferred(),r=e.Deferred();return this.activating?PubSub.subscribe([{eventname:"WriterAnywhere.hooked",subscriber:this,callback:function(){PubSub.unsubscribe([{eventname:"WriterAnywhere.hooked",subscriber:this}]),r.resolve()}}]):this.active?r.resolve():r.reject(),r.done(function(){this.ccwriter&&this.ccwriter.writer?this.ccwriter.closeWriterUI(t?"Shut Down Everything":null).done(function(){i.resolve()}):i.resolve()}.bind(this)).fail(,i.done(function(){PubSub.publish("WriterSidebar.stop_stash"),this._postcollapse_unpause_lub(),this.ccwriter=null,this.active=!1,WriterAnywhereFactory.current=null}.bind(this)),i}return e.Deferred().resolve()},_attach_media_button_if_desired:function(e){var t='<a class="showMedia" href="#showMedia">Add Media</a>',i='<div class="drawPlz"><div class="topbar hh">'+t+"</div></div>",r=e,s=r.parent().parent(),n=this.options.has_media_button||!1;(Glbl("Site.is_stash")||Glbl("Site.is_mobile"))&&(n=!1),r.hasClass("butan")||(r[0].className+=" butan",n&&(s.hasClass("cctextarea")||s.children("td.f").length?s.children("td.f").length?(s=s.closest("table.f"),s.find(".drawPlz").length?s.find(".topbar").prepend(t):s.find("td.f").append(i)):s.find(".drawPlz").length?s.find(".topbar").prepend(t):s.append(i):r.parent().append(i)))},before_load:function(){},after_load:function(){},after_hook:before_expand:function(){"undefined"!=typeof da_minish_lub&&da_minish_lub&&da_minish_lub.pause(),e(".commentwriter-skinbar-inner").hide();var t=this.owner._get_bodycontent_selector.apply(this);this.$.offset().left+this.$.width()>e(t+", #output:visible").width()-326&&this.ccwriter_wide&&e(t+" > *, #output:visible > *").css("margin-right",this.options.sidespace-this.$.offset().left),e(t+" + #depths").css("display","")},after_expand:function(){var t=this.owner._get_bodycontent_selector.apply(this);if(this.$.offset().left+this.$.width()>e(t+", #output:visible").width()&&(e(t+", #output:visible").animate({scrollLeft:this.$.offset().left+this.$.width()-e(t+", #output:visible").width()},this.options.animate_time),this.ccwriter_wide&&e(t+", #output:visible").scrollTop(this.$.offset().top-46+e(t+", #output:visible").scrollTop())),e(this.$writer_ui[0]).find(".commentwriter-preview, .commentwriter-submit").show(),e(this.$writer_ui[0]).find(".commentwriter-submit em").text("Submit"),e(this.$writer_ui[0]).find(".commentwriter-cancel").on("click.writeranywhere",function(){return this.writer.remember_selection(),PubSub.publish("WriterAnywhere.collapse"),this.writer.restore_selection(),!1}.bind(this)),this.$.siblings(".drawPlz").find(".showMedia").addClass("hideMedia").text("Hide Media"),Glbl("Site.is_mobile")){e(e("#output > "+t).length?t:t+", #output:visible").css("right",0),e(".commentwriter-sidebar").hide()}},before_collapse:function(){},after_collapse:function(){this.$.siblings(".drawPlz").find(".showMedia").removeClass("hideMedia").text("Add Media"),this.owner._postcollapse_unpause_lub.apply(this)},before_shutdown:function(){},after_shutdown:function(){var t=this.owner._get_bodycontent_selector.apply(this);e("body").removeClass("ccwriter-subframe stickhelper"),e(window).off("resize.writeranywhere"),e(t).css("min-height",""),e(".commentwriter-interface").hide()},_expanded_resize:function(){var t={width:e(window).width(),height:e(window).height()},i=t.height-46-32-(e("body").hasClass("stickhelper")?25:0),r=this.owner._get_bodycontent_selector.apply(this);e(r).css("min-height",i),e(".commentwriter-sidebar").css("height",t.height-46-20),e(".commentwriter-toolbar-outer").css("width",t.width-218-e(".commentwriter-actions").outerWidth(!0))},_postcollapse_unpause_lub:function(){"undefined"!=typeof da_minish_lub&&da_minish_lub&&da_minish_lub.unpause()},_get_bodycontent_selector:function(){return".dev-page-container:visible"},_get_underlay_source:))}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/types/base.js")});

DWait.ready(["jms/pages/ccommentthread.js","jms/pages/ccomment.js","jms/pages/writeranywhere/types/base.js","jms/pages/writeranywhere/core.js","jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/lib/glbl.js","jms/lib/spinpreset.js","jms/lib/ddt.js","jms/pages/writeranywhere/ui.js","jms/lib/writer/embed.js","jms/lib/pubsub.js","jms/lib/browser.js","jms/lib/bind.js","jms/pages/writeranywhere/factory.js"],function(){!function(t){WriterAnywhereFactory.register("comment","base",{options:{ui:{selector:"div.drawPlz a.showMedia",expand_on:"click",collapse_on:"click"},has_conversation:!0,has_media_button:!0,toolbar_align:!1,initial_sidebar_on_expand:"emotes",passthrough_tab:!0,block_sidescroll:!0,sidespace:100,image_actions:["Draw","Thumb","Link","Remove"],image_resize:!1,animate_time:150,sync_timeout:200,sidebar_premium_upsell:!1,embedded_item_limit:5,on_switch_editing_mode:function(){this.ccwriter_toplevel&&(this.cctalkpost.owner.writer_focused=this.writer.$node.is(":visible"),this.cctalkpost.owner.refreshTextareaState())},valid_tags:["br","hr","strong","b","code","sub","sup","small","tt","acronym","a","abbr","strike","em","i","s","u","ins","span","blockquote","p","bcode","ul","ol","li","div","font","da:thumb","da:bigthumb","da:emoticon","da:drawing"],valid_attrs:["height","href","name","title","width","target"],enable_underlay_placeholder:!0},before_load:function(){this.$.closest(".feed-action").length&&(this.owner.options.ui.shutdown_on="click_out"),this.base.apply(this),this.ccwriter=this.$.closest(":gmi(CCommentThread), :gmi(TalkPostWrapper), .ccomment-post").length,this.ccwriter_toplevel=this.$.closest(":gmi(TalkPostWrapper)").length;var e=this.options.autocomplete_priority=[];if(this.ccwriter_toplevel)this.cctalkpost=this.owner.$node.closest(":gmi(TalkPostWrapper)").gmi1().talkpost;else{this.cctalkpost=this.owner.$node.closest(".talk-post").data("TalkPost");var i=this.$.closest("div.nest").prev(".ccomment-activereply").find(".cc-name .username-with-symbol .username").text();i!=window.deviantART.deviant.username&&e.push(i)}if(1==this.cctalkpost.comment.typeid||61==this.cctalkpost.comment.typeid){var s=t(".dev-view-about .dev-title-container h1 .username-with-symbol .username").text();s!=window.deviantART.deviant.username&&e.push(s)}this.owner.adjust_limits.apply(this)},adjust_limits:function(){18==this.cctalkpost.comment.typeid&&(this.options.embedded_item_limit=200),this.cctalkpost.comment.allowdrawings||(this.options.valid_tags=t.grep(this.options.valid_tags,)},after_hook:function(){var e=this.$.closest(":gmi(TalkPostWrapper)").gmi1();e&&(e.refreshTextareaState(),e.gmi_node.className+=" ccexpanded",e.talkpost.commentwriter=this.owner),this.writer.$node.on("keydown.ccwriter",function(e){if(!this.writer.autocomplete||!this.writer.autocomplete.isShown()){if(9==e.which&&!(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)){e.preventDefault();var i=this.writer.$textarea.attr("tabindex");return t("[tabindex="+ ++i+"]",this.$.closest(":gmi(TalkPostWrapper), .ccomment-post, .talk-post")).focus(),!1}return 13==e.which&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.writer.syncer.sync(),this.$.closest(":gmi(TalkPostWrapper), .ccomment-post, .talk-post").find("span.post").click(),!1):void 0}}.bind(this)),Browser.isIE?(this.$.css("min-height",148),this.writer.$node.css("min-height",146),!this.owner.active&&this.owner.activating&&this.owner._resize_writer.apply(this),setTimeout(function(){this.owner._scroll_down_talkpost.apply(this),this.writer.$node.focus(),PubSub.publish("CommentWriter.opened")}.bind(this),0),this.$.parent().parent().find(".drawPlz").show()):(this.$.find("textarea").removeClass("ccwriter-raisin"),this.$.css("height",48).animate({height:148},{duration:150,done:function(){this.ccwriter_inited&&(this.$.css({height:"","min-height":148}),this.writer.$node.css("min-height",146),this.owner._resize_writer.apply(this),setTimeout(function(){this.owner._scroll_down_talkpost.apply(this),PubSub.publish("CommentWriter.opened")}.bind(this),0))}.bind(this)}),this.$.parent().parent().find(".drawPlz").hide().fadeIn(300)),t(window).on("resize.ccwriter",t.throttle(50,this.owner._resize_writer.bind(this))),this.writer.insert_thumbs=!0,this.writer.insert_thumb_format="200H",this.drawplz_button=this.$.closest(".ccomment-form, .ccomment-post").find(".showDrawPlz").off("click.writeranywhere").on("click.writeranywhere",this.owner._draw_click.bind(this)),this.ccwriter_toplevel?this.cctalkpost.owner.$.find(".inputs").show():t(this.cctalkpost.node).find(".inputs").show(),this.writer.$node.focus()},before_expand:function(){if(this.base.apply(this),t(".feed-container").length){var e=this.owner._get_bodycontent_selector.apply(this);t(e+" > *, #output:visible > *").css("margin-right","auto")}},after_expand:function(){this.owner._resize_writer.apply(this),this.base.apply(this),this.cctalkpost.showCancel(),t(this.$writer_ui[0]).find(".commentwriter-cancel").show().on("click.writeranywhere",function(){return this.cctalkpost.confirmCancel(),!1}.bind(this)),t(this.$writer_ui[0]).find(".commentwriter-submit").show().on("click.writeranywhere",function(){return PubSub.publish("WriterAnywhere.collapse"),this.cctalkpost.confirmPost(),!1}.bind(this)).find("em").text("Submit Comment"),t(this.$writer_ui[0]).find(".commentwriter-preview").show().on("click.writeranywhere",bind(this)),t(this.cctalkpost.node).find(".drawPlz .showMedia").addClass("hideMedia").text("Hide Media");var e=t(":gmi(ResViewContainer), :gmi(DeviationPageView)");if(e.length){var i=this.owner._get_bodycontent_selector.apply(this);if("full"==e.gmi1()._current_mode){var s=t(i).scrollTop(),r=this.$.offset().top;e.gmi1().change_to_mode("normal");var o=this.$.offset().top;!s&&WriterAnywhereUI.scroll_offset.top?WriterAnywhereUI.scroll_offset.top+=o-r:t(i).scrollTop(s+(o-r))}}},before_collapse:function(){if(Browser.isSafari&&!Browser.isPad){var e=t(".dev-page-container:visible");this.collapsing_scroll_position=e.scrollTop(),e.css("position","static"),e.parent().scrollTop(this.collapsing_scroll_position)}},after_collapse:function(){this.base.apply(this),PubSub.subscribe([{eventname:"WriterAnywhere.collapsed",subscriber:this,callback:function(){PubSub.unsubscribe([{eventname:"WriterAnywhere.collapsed",subscriber:this}]),this.owner._resize_writer.apply(this),Browser.isSafari&&!Browser.isPad&&(t(".dev-page-container:visible").css("position",""),t("body").scrollTop(this.collapsing_scroll_position),this.collapsing_scroll_position=null,t(window).trigger("resize"))}}]),t(this.cctalkpost.node).find(".drawPlz .showMedia").removeClass("hideMedia").text("Add Media")},before_shutdown:after_shutdown:function(){if(t.contains(document.documentElement,this.cctalkpost.node)&&("normal"!=this.cctalkpost.current_mode&&this.cctalkpost.goMode("normal",!1),t(this.cctalkpost.node).find(".drawPlz .showMedia").removeClass("hideMedia").text("Add Media"),!this.owner.$node.find("textarea").val()))if(this.ccwriter_toplevel||this.owner.$node.closest(".feed-action").length)this.cctalkpost.owner.gmi_args&&"TalkPostWrapper"==this.cctalkpost.owner.gmi_args.gmiclass&&this.cctalkpost.owner.$&&(this.cctalkpost.owner.textarea_focused=0,this.cctalkpost.owner.writer_focused=0,this.cctalkpost.owner.refreshTextareaState(),this.cctalkpost.owner.$.is(":visible")&&this.cctalkpost.owner.$.find(".inputs").hide()),this.cctalkpost.confirmExit();else if(this.cctalkpost.node){var e=t(this.cctalkpost.node);e.is(":visible")&&e.find(".inputs, .drawPlz").hide()}},_scroll_down_talkpost:function(){var e,i,s=this.ccwriter_expanded?".dev-page-container:visible":document;i=this.ccwriter_toplevel?this.$.closest(":gmi(TalkPostWrapper)"):this.$.closest(".talk-post-reply"),e=i.offset().top+(this.ccwriter_expanded?i.position().top:0)+i.outerHeight()-t(window).height(),t(s).scrollTop()<e&&t(s).scrollTop(e)},_resize_writer:function(){if(!this.writer)return void ddt.log("writer","_resize_writer not cleaned up",this);var t=14;this.ccwriter_toplevel||(t=82),this.writer.$node.width(this.$.closest(".ccomment-form, .ccomment-post, .talk-post").width()-t)},_draw_click:function(e){e.preventDefault();var i=this.writer,s=this.drawplz_button;if(i&&!s.is(".loading")){s.addClass("loading");var r=new Spinner(t.extend({},SpinnerPresets.green,{left:"-22px"}));r.spin(s[0]);var o,n,a,c=this;i.frame("https://www.deviantart.com/muro/iframe?width=1350&height=1020&background=clear",function(e,l){var h="remove";switch(e.action){case"error":return s.removeClass("loading"),r.stop(),void(l.hidden&&l.act("show"));case"cancel":return"remove";case"got_id":return void(n=e.id&&parseInt(e.id,36));case"done":a=e.img||a,c.cctalkpost.drawplz_saving++,h="hide";break;case"save":n=e.privateid||e.id||n,a=e.img||a,setTimeout(2e3);break;case"ready":return setTimeout(1e3),"show";default:return}if(n&&a&&!o){var d=t("<img>",{src:a,class:"writer-embed writer-deviation-image writer-deviation-redraw","data-embed-id":n,"data-embed-type":"drawing","data-embed-format":"image","data-embed-naturalwidth":1350,"data-embed-naturalheight":1020});i.insert([d,"<br><br>"]),WriterEmbed.runLoaders(i.$node),o=!0}return h})}}})}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/types/comment.js")});

DWait.ready(["jms/pages/writeranywhere/types/comment.js","jms/pages/writeranywhere/core.js","jms/lib/jquery/jquery.current.js","jms/pages/writeranywhere/factory.js"],function(){!function(e){WriterAnywhereFactory.register("stashcomment","comment",{options:{ui:{selector:"div.commentwriter-underlay, div.writer",expand_on:"click",collapse_on:""},has_conversation:!0,has_media_button:!1,toolbar_align:!0,initial_sidebar_on_expand:"conversation",passthrough_tab:!0,block_sidescroll:!0,sidespace:100,image_actions:["Draw","Image","Full","Thumb","Link","Remove"],image_resize:!0,animate_time:150,sync_timeout:200,embedded_item_limit:!1,sidebar_premium_upsell:!1,valid_tags:["br","hr","strong","b","code","sub","sup","small","tt","acronym","a","abbr","strike","em","i","s","u","ins","span","blockquote","p","bcode","ul","ol","li","div","da:deviation","da:thumb","da:bigthumb","da:emoticon","da:drawing"],expand_immediately:!0},after_load:function(){this.base.apply(this),this.writer.insert_thumbs=!1,this.writer.insert_thumb_format=null},after_expand:function(){this.base.apply(this),e(this.$writer_ui[0]).find(".commentwriter-cancel em").text("Close")},adjust_limits:after_collapse:function(){PubSub.subscribe([{eventname:"WriterAnywhere.collapsed",subscriber:this,callback:function(){PubSub.unsubscribe([{eventname:"WriterAnywhere.collapsed",subscriber:this}]),PubSub.publish("StashStream.activate_current_view")}}])}})}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/types/stashcomment.js")});

DWait.ready(["jms/pages/writeranywhere/types/comment.js","jms/pages/writeranywhere/core.js","jms/lib/jquery/jquery.current.js","jms/pages/writeranywhere/factory.js"],function(){!function(e){WriterAnywhereFactory.register("mccomment","comment",{before_load:function(){this.base.apply(this),this.options.has_conversation=!1,this.options.sidespace=40,this.ccwriter=0,this.ccwriter_toplevel=0}})}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/types/mccomment.js")});

DWait.ready(["jms/pages/writeranywhere/types/base.js","jms/pages/writeranywhere/core.js","jms/lib/jquery/jquery.current.js","jms/pages/writeranywhere/factory.js"],function(){!function(e){WriterAnywhereFactory.register("peek","base",{options:{ui:{selector:"div.drawPlz a.showMedia",expand_on:"click",collapse_on:"click_out"},has_media_button:!0,image_actions:["Thumb","Full","Remove"],image_resize:!1,sync_timeout:200,initial_sidebar_on_expand:"emotes",valid_tags:["br","hr","strong","b","code","sub","sup","small","tt","acronym","a","abbr","strike","em","i","s","u","ins","span","blockquote","p","bcode","ul","ol","li","div","da:deviation","da:thumb","da:bigthumb","da:emoticon","da:drawing","da:embed"]},after_load:function(){this.writer.insert_thumbs=!1,this.writer.insert_thumb_format="200H",e(".ccwriter-content .writer").css({minHeight:""})},after_hook:function(){var e=this.writer.$node.siblings("textarea");this.$.parent().parent().find(".drawPlz").hide().fadeIn(300,,window.requestAnimationFrame(function(){this.writer.$node.focus(),PubSub.publish("PeekWriter.activate",e.data("id"))}.bind(this))},before_expand:function(){this.base.apply(this);var t=this.owner._get_bodycontent_selector.apply(this);e(t+" > *, #output:visible > *").css("margin-right","auto")},after_expand:function(){this.base.apply(this),e(this.$writer_ui[0]).find(".commentwriter-preview, .commentwriter-submit").hide(),e(".commentwriter-toolbar,.commentwriter-sidebar").css({zIndex:300}),e(".commentwriter-toolbar,.commentwriter-sidebar").click(},after_shutdown:function(e){this.base.apply(this),e.siblings(".drawPlz").remove(),PubSub.publish("PeekWriter.shutdown",e.data("id"))}})}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/types/peek.js")});

DWait.ready(["jms/pages/writeranywhere/types/base.js","jms/pages/writeranywhere/core.js","jms/lib/jquery/jquery.current.js","jms/pages/writeranywhere/factory.js"],function(){!function(t){WriterAnywhereFactory.register("postbox","base",{options:{ui:{selector:"div.drawPlz a.showMedia",expand_on:"click",collapse_on:"click"},has_media_button:!0,image_actions:["Thumb","Full","Remove"],image_resize:!1,sync_timeout:20,initial_sidebar_on_expand:"emotes",toolbar_initial_container:".postbox-toolbar",call_on_save_if_empty:!0,placeholder_if_focused:!0,sidebar_click_callback:function(t,e){var i=this.$.closest("form.postbox-form");switch(i.find(".postbox-current-type").attr("rel")){case"journal":this.writer.insert_thumb(t);break;case"poll":var o=t.attr("collect_rid").split(":"),s=null;"emote"==o[0]?s=t.attr("title"):"emote"==o[2]&&(s=":thumb"+o[1]+":");var r=i.find(".postbox-footer-poll input:focus");r.length&&WriterUtils.insertIntoTextareaAtCursor(r[0],s)}},enable_underlay_placeholder:!0,on_save_content:function(){this.writer&&(PubSub.publish("Postbox.sync",this.writer.getContent().replace(/&amp;([^\s;]+?);/gi,"&$1;")),this.owner.empty=!this.writer.getContent().length,this.writer.options.sync_timeout=this.owner.empty?20:200,this.writer.$node.toggleClass("empty",this.owner.empty))},valid_tags:["br","hr","strong","b","code","sub","sup","small","tt","acronym","a","abbr","strike","em","i","s","u","ins","span","blockquote","p","bcode","ul","ol","li","div","da:deviation","da:thumb","da:bigthumb","da:emoticon","da:drawing","da:embed"]},before_load:after_load:function(){this.writer.insert_thumbs=!1,this.writer.insert_thumb_format="200H",t(".postbox-toolbar").detach().appendTo(this.$.parent())},after_hook:function(){var t=this.$.closest(".postbox-entry");t.removeClass("postbox-entry-collapsed").addClass("postbox-entry-expanded"),t.siblings(".postbox-usericon").show(),this.$.css("height",48).animate({height:148},{duration:150,done:function(){this.$.css({height:"","min-height":148}),this.writer.$node.css("min-height",146)}.bind(this)}),this.$.parent().parent().find(".drawPlz").hide().fadeIn(300),PubSub.publish("Postbox.init",this)},before_expand:function(){this.base.apply(this);var e=this.owner._get_bodycontent_selector.apply(this);t(e+" > *, #output:visible > *").css("margin-right","auto")},after_expand:function(){this.base.apply(this),t(this.$writer_ui[0]).find(".commentwriter-preview, .commentwriter-submit").hide()},before_shutdown:function(){var t=this.$.closest(".postbox-entry");t.removeClass("postbox-entry-expanded"),this.writer.getContent().length?t.siblings(".postbox-usericon").hide():t.addClass("postbox-entry-collapsed"),this.$.siblings(".drawPlz").find(".showMedia").removeClass("hideMedia").text("Add Media").end().hide()},after_shutdown:function(){t(".postbox-toolbar",this.owner.$node.parent()).remove(),PubSub.publish("Postbox.shutdown")},_get_underlay_source:)}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/types/postbox.js")});

DWait.ready(["jms/pages/writeranywhere/types/base.js","jms/pages/writeranywhere/core.js","jms/lib/jquery/jquery.current.js","jms/pages/writeranywhere/factory.js"],function(){!function(e){WriterAnywhereFactory.register("blockcomment","base",{key:null,options:{ui:{selector:"div.drawPlz a.showMedia"},has_media_button:!0,sync_timeout:20,image_actions:["Draw","Thumb","Link","Remove"],image_resize:!1,initial_sidebar_on_expand:"emotes",call_on_save_if_empty:!0,on_save_content:function(){this.writer&&this.key&&PubSub.publish("BlockCommentBox.sync",{writerKey:this.key,commentBody:this.writer.getContent().replace(/&amp;([^\s;]+?);/gi,"&$1;")})},valid_tags:["br","hr","strong","b","code","sub","sup","small","tt","acronym","a","abbr","strike","em","i","s","u","ins","span","blockquote","p","bcode","ul","ol","li","div","font","da:thumb","da:bigthumb","da:emoticon","da:drawing"],valid_attrs:["height","href","name","title","width","target"]},after_hook:function(){this.key=this.writer.id,PubSub.publish("BlockCommentBox.init",{writerKey:this.key,writerNode:this.writer.$node[0],textareaNode:this.writer.$textarea[0],addMediaNode:this.$.siblings(".drawPlz").find(".showMedia")[0]})},after_expand:function(){this.base.apply(this),e(this.$writer_ui[0]).find(".commentwriter-preview, .commentwriter-submit").hide(),PubSub.publish("BlockCommentBox.sidebarOpened",this.key)},after_collapse:function(){this.base.apply(this),PubSub.publish("BlockCommentBox.sidebarClosed",this.key)},after_shutdown:function(){this.base.apply(this),PubSub.publish("BlockCommentBox.shutdown",this.key)}})}(jQuery),window.DWait&&DWait.run("jms/pages/writeranywhere/types/blockcomment.js")});

DWait.ready(["jms/lib/ddt.js","jms/lib/jquery/jquery.current.js"],function(){!function(){function e(){var e={};if($.each(i,function(t,i){new Date-i.ts<36e5&&(e[t]=i)}),i=e,window.sessionStorage)try{sessionStorage.setItem("ImageCache",JSON.stringify(i))}catch(e){ddt.log("ImageCache","Ran out of space, have to wait until some existing items expire")}}function t(e){var t=-1;if(!e.match(/th..\.deviantart\./))return{deviationid:t,size:"unknown"};var i=e.match(/-d([0-9a-zA-Z]+)/);if(i&&i[1]&&(t=parseInt(i[1],36)),e.match(/th..\.deviantart\./)){if(e.match(/fs..\/150\//))return{deviationid:t,size:"150"};if(e.match(/fs..\/300W\//i))return{deviationid:t,size:"300W"}}return{deviationid:t,size:"unknown"}}var i={};if(window.sessionStorage){var a=sessionStorage.getItem("ImageCache");null!==a&&(i=JSON.parse(a),ddt.log("ImageCache","Reading cache from sessionStorage",i),e())}setInterval(e,6e4),window.ImageCache={set:function(t,a){i[t]={ts:+new Date},$.each(a,,e(),ddt.log("ImageCache","Setting entry for deviationid "+t,a,i)},get:function(e){if(!e)return e;var a=t(e);if(ddt.log("ImageCache","Extracted information for "+e,a),i[a.deviationid]&&i[a.deviationid][a.size]){var n=i[a.deviationid][a.size];return ddt.log("ImageCache","Found an entry in the ImageCache for "+e),n}return ddt.log("ImageCache","Did not find any entry in the ImageCache for "+e,i),e}}}(),window.DWait&&DWait.run("jms/lib/imagecache.js")});

!function(t){function e(e){var o={ESSENTIAL:"essential",FUNCTIONAL:"functional",MARKETING:"marketing",ANALYTICS:"analytics"};t.compliantLocalStorageKeys={CONSOLE_FAVOURITE:"console_favourite",CONSOLE_RECENT:"console_recent",CONSOLE_DAPI_RECENT:"console_dapi_recent"};var a={};if(a[compliantLocalStorageKeys.CONSOLE_FAVOURITE]=o.ANALYTICS,a[compliantLocalStorageKeys.CONSOLE_RECENT]=o.ANALYTICS,a[compliantLocalStorageKeys.CONSOLE_DAPI_RECENT]=o.ANALYTICS,!a[e])return ddt.log("compliantlocalstorage","allowing access due to key config not found: "+e),!0;var r=t.deviantART.pageData.privacy_settings;if(!r||!r.required)return ddt.log("compliantlocalstorage","allowing access due privacy not required"),!0;var n=r.accepted&&r.types[a[e]]||!1;return ddt.log("compliantlocalstorage","access allowed for key "+e+"? "+n+" / privacy settings: "+JSON.stringify(r)),n}t.safeLocalGet=function(t,o,a){var r=o;try{if(!e(t))return;if("string"!=typeof(r=localStorage.getItem(t)))return r=o;a&&"function"==typeof a&&(func=a,r=func(r))}catch(t){return r=o}return r},t.safeLocalSet=function(t,o){try{if(!e(t))return;localStorage.removeItem(t),localStorage.setItem(t,o)}catch(t){console.log("Error setting local storage",t)}}}(window),window.DWait&&DWait.run("jms/lib/localStorage.js");
if(window.DWait){DWait.count()}