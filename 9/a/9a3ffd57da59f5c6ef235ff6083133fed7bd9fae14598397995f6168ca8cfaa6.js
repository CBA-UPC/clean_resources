"use strict";(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[1558],{19799:function(t,e,n){var r=n(1469),i=n.n(r),a={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.avatarSrc?n("div",{class:["kso-avatar",{"avatar-marginRight":t.imgMarginRight,"avatar-imgCenter":t.imgCenter}],on:{click:},[n("img",{style:t.imgStyle,attrs:{src:t.avatarSrc}})]):n("div",t._g({staticClass:"k-avatar"},t.$listeners),t._l(t.column,(function(e,r){return n("div",{key:r,staticClass:"k-avatar-col"},t._l(e,(function(t,e){return n("div",{key:r+"-"+e,staticClass:"k-avatar-col__img",style:{backgroundImage:"url("+t+")"}})})),0)})),0)},staticRenderFns:[],name:"KAvatar",props:{src:{type:[String,Array]},avatarSrc:String,size:{type:String,default:"28"},customStyle:{type:Object,default:,imgMarginRight:{type:Boolean,default:!0},imgCenter:{type:Boolean,default:!1}},data:function(){return{imgStyle:Object.assign({width:this.size+"px",height:this.size+"px"},this.customStyle)}},computed:{column:function(){var t=i()(this.src)?this.src:[this.src],e=t.length<=2?1:2,n=[t.slice(0,e)],r=t.slice(e,2*e);return r.length&&n.unshift(r),n}},install:function(t){t.component(a.name,a)}};e.Z=a},20425:function(t,e,n){n.r(e),n.d(e,{InviteApproveComp:function(){return N},createInstance:function(){return F}});var r=n(18487),i=n(56451),a=n(37311),o=n(2406),s=n.n(o),c=n(95272),p=n(147),u=n.n(p),d=n(43800),l=n(55382),v=n.n(l),m=n(80589),f=n(45821),g=n(47189),h=n(28152),y=n.n(h),_=n(22941),k=n(49200),w=n(85476),b=n(96133),x=n(8004),C=n(19731),I=n(423),S=n(16569),P=n.n(S),A=n(19799),L=function(t){return t.then(().catch(()},O={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-company-admin-invite-setting"},[n("div",{staticClass:"setting-item"},[n("span",{staticClass:"title"},[t._v(t._s(t.t("txt11")))]),t._v(" "),n("KdSwitch",{nativeOn:{"!click":,model:{value:t.inviteCollage,callback:function(e){t.inviteCollage=e},expression:"inviteCollage"}})],1)])},staticRenderFns:[],components:{KdSwitch:y()},props:{companyId:{type:Number,required:!0}},data:function(){return{inviteCollage:!1}},beforeMount:function(){this.getInviteCollageSetting()},methods:{onEvents:function(){},toggle:function(){var t=this;return(0,a.Z)(s().mark((function e(){var n,r,a,o,c,p,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.operating){e.next=2;break}return e.abrupt("return");case 2:return t.operating=!0,n=!t.inviteCollage,e.next=6,L((0,g.I8r)(t.companyId,"member_invite_switch",n));case 6:if(r=e.sent,a=(0,i.Z)(r,1),o=a[0],t.operating=!1,!o){e.next=21;break}c=(o||{}).response,p=(c||{}).data,u=(p||{}).code,e.t0=u,e.next=40300001===e.t0?17:19;break;case 17:return v().error((0,f.t)("logic.CompanyMemberInviteSetting.txt2")),e.abrupt("return");case 19:return v().error(o),e.abrupt("return");case 21:t.$emit("report",n?"switchinvite_on":"switchinvite_off"),t.getInviteCollageSetting();case 23:case"end":return e.stop()}}),e)})))()},getInviteCollageSetting:function(){var t=this;return(0,a.Z)(s().mark((function e(){var n,r,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L((0,g.fbQ)(t.companyId,"member_invite_switch",{patch_default:!0}));case 2:if(n=e.sent,r=(0,i.Z)(n,2),a=r[0],o=r[1],!a){e.next=9;break}return v().error(a),e.abrupt("return");case 9:t.inviteCollage=o;case 10:case"end":return e.stop()}}),e)})))()},t:function(t){return(0,f.t)("logic.CompanyAdminInviteApprove.invite."+t)}}};r R=(0,w.l0)(g.bGp),$=function(t){return R(t).then(()},D=function(){var t=(0,a.Z)(s().mark((function t(e){var n,r,i,a,o,c,p=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=p.length>1&&void 0!==p[1]?p[1]:{},t.next=3,$(e);case 3:return r=t.sent,t.next=6,(0,g.nei)(e,{params:Z({dept_id:r},n)});case 6:return i=t.sent,a=i.invitelink,o=i.invite_content,c="".concat(a,"\n").concat(o),t.abrupt("return",{link:c});case 11:case"end":return t.stop()}}),t)})));return (),j=function(){var t=(0,a.Z)(s().mark((function t(e,n,r){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,g.B3M)({comp_id:e,user_id:n,permissions:[r]});case 2:return i=t.sent,t.abrupt("return",!!i&&!!i.is_has);case 4:case"end":return t.stop()}}),t)})));return (),q={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-company-admin-invite"},[n("div",{staticClass:"k-company-admin-invite-header"},[n("div",{staticClass:"title"},[t._v(t._s(t.t("txt2")))]),t._v(" "),t.showSettingList?n("div",{staticClass:"more-setting",attrs:{tabindex:"1"}},[n("Setup"),t._v(" "),n("span",[t._v(t._s(t.t("txt10")))]),t._v(" "),n("SettingList",{staticClass:"list",attrs:{companyId:t.companyId},on:{report:t.report,toggleInviteStatus:t.toggleInviteStatus}})],1):t._e()]),t._v(" "),n("div",{staticClass:"main-container"},[n("div",{staticClass:"k-company-admin-invite-copy"},[n("div",{staticClass:"k-company-admin-invite-copy__link",attrs:{title:t.link}},[t._v(t._s(t.link))]),t._v(" "),n("div",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.link,expression:"link"}],staticClass:"k-company-admin-invite-copy__btn",on:{success:t.copySuccess,error:t.onCopyError}},[t._v("\n        "+t._s(t.t("txt4"))+"\n      ")])]),t._v(" "),t.link?n("div",{staticClass:"k-company-admin-invite-copy__code"},[n("KIcon",{attrs:{type:"qr-code"}}),t._v(" "),n("div",{staticClass:"k-company-admin-invite-copy__code--popup"},[n("p",[t._v(t._s(t.t("txt3")))]),t._v(" "),n("vue-qrcode",{attrs:{value:t.link,options:{width:150}}})],1)],1):t._e()])])},staticRenderFns:[],name:"CompanyAdminInvite",components:{VueQrcode:u(),KIcon:m.default,Setup:_.Z,SettingList:O},directives:{clipboard:d.B},props:{link:{default:"",type:String},companyId:{type:Number,required:!0},userId:{type:Number,required:!0}},data:beforeMount:function(){var t,e,n=this;(t=this.companyId,e=this.userId,j(t,e,"contact.settings")).then(().catch((function(){}))},methods:{t:function(t){return(0,f.t)("logic.CompanyAdminInviteApprove.invite."+t)},onCopyError:function(){v().error(this.t("txt8"))},copySuccess:function(){this.$emit("report","copy"),v().success(this.t("txt9"))},report:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.$emit.apply(this,["report"].concat(e))},toggleInviteStatus:},K={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-company-admin-approve-list-item"},[n("KAvatar",{attrs:{alt:"avatar",src:t.data.avatar,size:"30"}}),t._v(" "),n("div",{staticClass:"message"},[n("div",{staticClass:"name"},[t._v(t._s(t.data.user_name))]),t._v(" "),n("div",{staticClass:"desc"},[n("span",[t._v(t._s(t.data.phone))]),t._v(" "),n("span",[t._v(t._s(t.data.email))])])]),t._v(" "),n("div",{staticClass:"actions"},[0===t.actionType?n("span",[t._v(t._s(t.actionText))]):n("div",[n("KdButton",{attrs:{size:"small",type:"light",danger:""},on:{click:function(e){return t.onHandle(!1,t.data.id)}}},[t._v("\n        "+t._s(t.t("txt4"))+"\n      ")]),t._v(" "),n("KdButton",{attrs:{size:"small",type:"light",highlight:""},on:{click:function(e){return t.onHandle(!0,t.data.id)}}},[t._v("\n        "+t._s(t.t("txt3"))+"\n      ")])],1)])],1)},staticRenderFns:[],components:{KdButton:P(),KAvatar:A.Z},props:{data:{type:Object,required:!0}},computed:{actionType:actionText:function(){switch(this.data.status){case"agree":case"targeted_agree":return this.t("txt1");case"refuse":case"targeted_refuse":return this.t("txt2");case"phone":return this.t("txt5");case"email":return this.t("txt6");case"free_approve":return this.t("txt7");default:return""}}},methods:{t:function(t){return(0,f.t)("logic.CompanyAdminInviteApprove.approve."+t)},onHandle:},T={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.approveList.length?n("div",{staticClass:"k-company-admin-approve"},[n("div",{staticClass:"approve-header"},[t._v("\n    "+t._s(t.t("txt12"))+"\n  ")]),t._v(" "),n("div",{staticClass:"approve-list"},[n("KScroll",{attrs:{loading:t.loading,canLoad:t.canLoad,onLoad:t.fetchApproveList}},t._l(t.approveList,(),1)],1)]):t._e()},staticRenderFns:[],name:"CompanyAdminApprove",components:{KScroll:b.Z,ListItem:K},props:{companyId:{type:Number,required:!0},source:{type:String},isPaided:{type:Boolean}},data:function(){return{approveList:[],pagination:{count:20,page:1},loading:!1,canLoad:!0}},created:methods:{onEvent:function(){},fetchApproveList:function(){var t=this;return(0,a.Z)(s().mark((function e(){var n,r,a,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,L((0,g.mVW)(t.companyId,t.pagination.page,t.pagination.count,t.source));case 3:if(n=e.sent,r=(0,i.Z)(n,2),a=r[0],o=r[1],t.loading=!1,!a){e.next=10;break}return e.abrupt("return");case 10:if(o.applies&&0!==o.applies.length){e.next=13;break}return t.canLoad=!1,e.abrupt("return");case 13:c=o.applies,t.approveList=t.approveList.concat(c),t.pagination.page++;case 16:case"end":return e.stop()}}),e)})))()},handleApply:function(t,e){var n=this;return(0,a.Z)(s().mark((function r(){var a,o,c,p,u,d,l;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a="pcOffice"===n.source,o=n.companyId,c={approve_type:"function",approve_source:a?"wps_pc":"docs_web",scene:"company_page"},r.next=6,L((0,g.oBD)(o,{result:t?"agree":"refuse",apply_ids:[e],source:JSON.stringify(c)}));case 6:if(p=r.sent,u=(0,i.Z)(p,1),!(d=u[0])){r.next=12;break}return d.response.data&&40010015===d.response.data.code?(0,x.E)("showDialogMsg",{closed:!0,title:n.t("txt8"),type:"error",policyKey:"approval_member_blocked_pop_up_text",okText:n.t("txt9"),content:n.isPaided?n.t("txt10"):n.t("txt11"),onOk:function(){window.open("".concat(I.UX,"/buy?utm_source=").concat((0,C.x_)(window),"&utm_medium=company&utm_buysource=limited_number&comp_id=").concat(o))}}):(0,w.x2)(d),r.abrupt("return");case 12:n.$emit("report",t?"allow":"refuse"),l=n.approveList.findIndex((),n.$set(n.approveList[l],"status",t?"agree":"refuse");case 15:case"end":return r.stop()}}),r)})))()},t:},M="free",N={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-admin-func-invite-approve"},[t.loading?n("KLoading"):[t.link?n("div",{staticClass:"invite-container"},[n("Invite",{attrs:{companyId:t.companyId,userId:t.userId,link:t.link},on:{report:t.report}})],1):t._e(),t._v(" "),t.showApprove?n("div",{staticClass:"approve-container"},[n("Approve",{attrs:{isPaided:t.isPaided,source:t.source,companyId:t.companyId},on:{report:t.report}})],1):t._e()]],2)},staticRenderFns:[],name:"KCompanyInviteApprove",components:{KLoading:c.Z,Invite:q,Approve:T},props:{onDwEvent:{type:Function,default:required:!1},onLoadError:{type:Function},companyId:{required:!0,type:Number},getLinkReqQuery:{type:Object,default:null},userId:{type:Number,required:!0},source:{type:String,default:"docsWeb",require:!0}},data:computed:{showApprove:linkReqData:function(){return{source:{invite_info:{scene:"compmainpage",invite_source:this.isPC?"PCoffice":"docsWeb"}}}},isPC:isPaided:,methods:{getApprovePermissionService:function(){var t=this;return(0,a.Z)(s().mark((function e(){var n,r,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L((0,g.B3M)({comp_id:t.companyId,user_id:t.userId,permissions:["inv.approval.member.view"]}));case 2:if(n=e.sent,r=(0,i.Z)(n,2),a=r[0],o=r[1],!a){e.next=8;break}return e.abrupt("return");case 8:t.hasApprovePermission=o.is_has;case 9:case"end":return e.stop()}}),e)})))()},getInviteLink:function(){var t=this;return(0,a.Z)(s().mark((function e(){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D(t.companyId,t.getLinkReqQuery||t.linkReqData);case 3:n=e.sent,r=n.link,t.link=r,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),null!==e.t0&&void 0!==e.t0&&null!==(i=e.t0.response)&&void 0!==i&&null!==(i=i.data)&&void 0!==i&&i.msg&&v().error(null===e.t0||void 0===e.t0||null===(a=e.t0.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.msg),t.$emit("close");case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},getCompanyPaidType:function(){var t=this;return(0,a.Z)(s().mark((function e(){var n,r,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L((0,g.tV5)(t.companyId));case 2:if(n=e.sent,r=(0,i.Z)(n,2),a=r[0],o=r[1],!a){e.next=9;break}return t.compPaidType=M,e.abrupt("return");case 9:t.compPaidType=o.result;case 10:case"end":return e.stop()}}),e)})))()},initInvite:function(){return this.getInviteLink()},initApprove:init:function(){var t=this;return(0,a.Z)(s().mark((function e(){var n,r,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,t.getCompanyPaidType(),n=[t.initInvite(),t.initApprove()],e.next=5,L(Promise.all(n));case 5:r=e.sent,a=(0,i.Z)(r,1),o=a[0],t.loading=!1,o&&(t.$emit("onLoadError",o),t.onLoadError&&t.onLoadError(o));case 10:case"end":return e.stop()}}),e)})))()},customDialogClose:function(t){this.report("close"),t()},report:,created:install:,B={},F=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.title,n=void 0===e?(0,f.t)("logic.CompanyAdminInviteApprove.dialog.title"):e,i=t.width,a=void 0===i?"640px":i,o=t.closeOnClickModal,s=void 0!==o&&o,c=(0,r.Z)({entry:N,pages:[{title:n,className:"k-dialog-page-company-invite-approve",width:a,body:N,footer:null,closeOnClickModal:s,useNewLayout:!0,customClose:!0}]});return c.dw=B,c},U=F();e.default=U},8004:function(t,e,n){n.d(e,{$:function(){return i},E:);var r=n(423),i={SHOW_SPACE_LIMIT:"showSpaceLimit",RENDER_UPGRADE_PRIVILEGE:"renderUpgradePrivilege",RENDER_MSG_SENT_POPUP:"renderMsgSentPopup",SHOW_PLUS_BUY:"showPlusBuy"},a=function(t,e,n){var r=Array.isArray(e)?e:[e];return o().then((function(){return window&&window.epPlatform&&window.epPlatform[t].apply(window.epPlatform,r)})).catch(()},o=function(){return new Promise((function(t,e){if(window.epPlatform)return t();var n=new XMLHttpRequest;if(n.open("GET","".concat(r.UX,"/fab/sris/epplatform_sri.json"),!1),n.send(null),n.status>=200&&n.status<400){var i=JSON.parse(n.responseText),a=document.createElement("script");a.src="".concat(r.UX,"/fab/sdk/v1/epplatform"),a.integrity=i.epplatform,a.crossOrigin="anonymous",a.onload=t,a.onerror=e,document.head.appendChild(a)}}))}}}]);
