var ApcInitiator=[function(t,e){t.exports=react_and_react_dom.React},function(t,e){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,e,r){var n=r(13),o=r(42),i=r(22),a=Object.defineProperty;e.f=r(3)?Object.defineProperty:function(t,e,r){if(n(t),e=i(e,!0),n(r),o)try{return a(t,e,r)}catch(u){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},function(t,e,r){t.exports=!r(14)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(t,e){var r={}.hasOwnProperty;t.exports=function(t,e){return r.call(t,e)}},function(t,e,r){var n=r(2),o=r(15);t.exports=r(3)?function(t,e,r){return n.f(t,e,o(1,r))}:function(t,e,r){return t[e]=r,t}},function(t,e,r){var n=r(27)("wks"),o=r(19),i=r(1).Symbol,a="function"==typeof i;(t.exports=function(t){return n[t]||(n[t]=a&&i[t]||(a?i:o)("Symbol."+t))}).store=n},function(t,e){var r=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=r)},function(t,e){t.exports=function(t){return"object"===typeof t?null!==t:"function"===typeof t}},function(t,e,r){var n=r(16);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e,r){"use strict";var n=r(100);r(41)(e,"__esModule",{value:!0}),e.default=void 0;var o=n(r(101)),i="undefined"===typeof window?{}:window.device,a={};"undefined"!==typeof window&&(window.device=a);var u="undefined"===typeof window?"REACTSSR":window.navigator.userAgent.toLowerCase(),s=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","pov_tv","hbbtv","ce-html"];macos=function(){return c("mac")},a.ios=a.iphone=function(){return!a.windows()&&c("iphone")},a.ipod=function(){return c("ipod")},a.ipad=function(){return c("ipad")},a.android=a.androidPhone=function(){return a.android()&&c("mobile")},a.androidTablet=function(){return a.android()&&!c("mobile")},a.blackberry=a.blackberryPhone=a.blackberryTablet=function(){return a.blackberry()&&c("tablet")},a.windows=function(){return c("windows")},a.windowsPhone=function(){return a.windows()&&c("phone")},a.windowsTablet=a.fxos=a.fxosPhone=function(){return a.fxos()&&c("mobile")},a.fxosTablet=a.meego=a.cordova=function(){return"undefined"!==typeof window&&!(!window.cordova||"file:"!==location.protocol)},a.nodeWebkit=function(){return"undefined"!==typeof window&&"object"===(0,o.default)(window.process)},a.mobile=a.tablet=a.desktop=a.television=a.portrait=function(){return"undefined"!==typeof window&&window.innerHeight/window.innerWidth>1},a.landscape=function(){return"undefined"!==typeof window&&window.innerHeight/window.innerWidth<1},a.noConflict=function(){return"undefined"!==typeof window&&(window.device=i),this},a.type=f(["mobile","tablet","desktop"]),a.os=f(["ios","iphone","ipad","ipod","android","blackberry","windows","fxos","meego","television"]);var l=a;e.default=l},function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var r=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+n).toString(36))}},function(t,e){t.exports=!0},function(t,e,r){var n=r(9);t.exports=function(t,e){if(!n(t))return t;var r,o;if(e&&"function"==typeof(r=t.toString)&&!n(o=r.call(t)))return o;if("function"==typeof(r=t.valueOf)&&!n(o=r.call(t)))return o;if(!e&&"function"==typeof(r=t.toString)&&!n(o=r.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e,r){var n=r(8),o=r(1),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:n.version,mode:r(20)?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e,r){e.f=r(6)},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var r=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:r)(t)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getVisitorId=function(){var t=document.cookie.split(";"),e=!0,r=!1,n=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){for(var a=o.value;" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf("visitor")){var u=a.indexOf("=")+2,s=a.length-1;return a.substring(u,s)}}}catch(c){r=!0,n=c}finally{try{e||null==i.return||i.return()}finally{if(r)throw n}}return""},e.getBeaconServerUrl=function(t){if("production"===t)return"https://beacon.shutterfly.com/log";return"https://beacon.".concat(t,".shutterfly.com/log")}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=function(t){return Math.random().toString(16).slice(-4)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}},function(t,e,r){t.exports=r(72)},function(t,e,r){t.exports=!r(3)&&!r(14)((function(){return 7!=Object.defineProperty(r(43)("div"),"a",{get:function(){return 7}}).a}))},function(t,e,r){var n=r(9),o=r(1).document,i=n(o)&&n(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,e){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,r){var n=r(49),o=Math.min;t.exports=function(t){return t>0?o(n(t),9007199254740991):0}},function(t,e,r){t.exports=r(5)},function(t,e){e.f=Object.getOwnPropertySymbols},function(t){t.exports=JSON.parse('{"filters":[],"widgets":{"apc-pip-1":{"testGroups":{"-1":{"activate":true,"config":{"abTest":{"enabled":true,"testGroup":-1},"containerId":"apc-pip-1","content":{"badges":{},"fallback":{"flow":"product_information_page","maxProducts":12,"minProducts":6,"name":"trending_products","subtitle":{"show":false},"title":{"show":true}},"recipes":[{"flow":"product_information_page","maxProducts":12,"minProducts":6,"name":"next_best_action","subtitle":{"show":false},"title":{"show":true}}]},"features":["avoidDuplications","scrollbar"],"layout":"carousel","style":{"headerAlignment":"left","mobileHeaderAlignment":"left","titleTheme":"pip"},"supportedBrand":"shutterfly"},"rbpIndex":0,"type":"recWidget"}}},"apc-pip-2":{"testGroups":{"-1":{"activate":true,"config":{"abTest":{"enabled":true,"testGroup":-1},"containerId":"apc-pip-2","content":{"badges":{},"fallback":{"flow":"product_information_page","maxProducts":12,"minProducts":6,"name":"best_seller","subtitle":{"show":false},"title":{"show":true}},"recipes":[{"flow":"product_information_page","maxProducts":12,"minProducts":6,"name":"same_category","subtitle":{"show":false},"title":{"show":true,"text":"Category Best Sellers"}}]},"features":["avoidDuplications","scrollbar"],"layout":"carousel","style":{"headerAlignment":"left","mobileHeaderAlignment":"left","titleTheme":"pip"},"supportedBrand":"shutterfly"},"rbpIndex":1,"type":"recWidget"}}}}}')},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(t){var e=t.name,r=t.additionalLogData,i=t.globalLogData,a=t.batch,u=t.env,s=t.enableNRD,c=void 0!==s&&s,f=t.batchSize,l=void 0===f?10:f,d=t.batchInterval,p=void 0===d?15e3:d;return c?(0,n.default)(e,i,l,p):(0,o.default)(e,r,a,u)}(t)};var n=i(r(68)),o=i(r(97));function i(t){return t&&t.__esModule?t:{default:t}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=var n=l(r(38)),o=l(r(69)),i=r(39),a=l(r(40)),u=l(r(70)),s=l(r(94)),c=l(r(95)),f=r(96);function l(t){return t&&t.__esModule?t:{default:t}}function d(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),n.forEach((function(e){p(t,e,r[e])}))}return t}function p(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function v(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=function(){function t(e,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.batchSize=n,this.batchInterval=o,this.fetch=s.default,this.bowser=this.initiateBowser(),this.globalLogData=function(t,e,r){var n={};try{n={os:r.getOSName(),osVersion:r.getOSVersion(),browser:r.getBrowserName(),browserVersion:r.getBrowserVersion(),device:r.getPlatformType(),engineName:r.getEngineName()};var o=(0,f.getURLPath)();o&&(n.urlPath=o)}catch(s){n={}}var u={appName:t,serviceLogVersion:"v2",brandId:"SFLY",visitorId:(0,i.getVisitorId)(),sessionId:(0,a.default)(),appContext:d({},n)};return(0,c.default)({},u,e||{})}(e,r,this.bowser),(0,u.default)(this)}var e,r,l;return e=t,(r=[{key:"asyncMetric",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new o.default(this,t,e)}},{key:"debug",value:function(t){this.buildLog("DEBUG",t,!0)}},{key:"info",value:function(t){this.buildLog("INFO",t,!0)}},{key:"warn",value:function(t){this.buildLog("WARN",t,!0)}},{key:"error",value:,{key:"metric",value:function(t){t=d({appContext:{success:!0}},t),this.buildLog("METRIC",t)}},{key:"buildLog",value:function(t,e,r){e.hasOwnProperty("appContext")||(e.appContext={}),t&&(e.appContext.metric=t),void 0!=r&&(e.appContext.success=r),e=d({startMillis:Date.now(),endMillis:Date.now()},(0,c.default)({},this.globalLogData,e)),(0,u.default)(this).add(e)}},{key:"dispatchLogs",value:,{key:"initiateBowser",value:function(){if("undefined"===typeof window)return{};try{var t=window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"";return n.default.getParser(t)}catch(e){return{}}}}])&&v(e.prototype,r),l&&v(e,l),t}()},function(t,e,r){"use strict";function n(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),n.forEach((function(e){o(t,e,r[e])}))}return t}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}unction a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i(this,t),this.logger=e,this.eventId=r,this.startTime=Date.now(),this.logToSignalFX=n}var e,r,u;return e=t,(r=[{key:"success",value:function(t){t.hasOwnProperty("appContext")||(t.appContext={}),t.appContext.success=!0,this.createLog(t)}},{key:"failure",value:function(t){t.hasOwnProperty("appContext")||(t.appContext={}),t.appContext.success=!1,this.createLog(t)}},{key:"createLog",value:function(t){this.endTime=Date.now(),t=n({},t,{startMillis:this.startTime,endMillis:this.endTime,eventId:this.eventId}),this.logToSignalFX&&(this.perfSummary=n(o({},this.eventId,[this.endTime-this.startTime]),t.perfSummary),t=n({},t,{perfSummary:this.perfSummary})),this.logger.metric(t)}}])&&a(e.prototype,r),u&&a(e,u),t}();e.default=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.deleteInstance=var n=r(71),o=r(39);unction a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=null,s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.logStack=[],this.logger=e,this.env=(0,n.getCurrentEnv)(),setInterval(this.requestNRD,this.logger.batchInterval)}var e,r,s;return e=t,(r=[{key:"add",value:function(t){u.logStack.push(t),u.logStack.length>=u.logger.batchSize&&this.requestNRD()}},{key:"deleteLogs",value:,{key:"requestNRD",value:function(){if(u.logStack&&u.logStack.length>0){var t=(0,o.getBeaconServerUrl)(u.env),e=i(u.logStack);u.logger.fetch(t,e),u.deleteLogs()}}}])&&a(e.prototype,r),s&&a(e,s),t}()},function(t,e,r){"use strict";r(41)(e,"__esModule",{value:!0}),e.getEnvByHost=i,e.getCurrentEnv=u,e.getBaseHostname=s,e.getHostname=e.getCDNHostname=function(){var t=u();if("dev"===t||"dev1"===t)return"www.".concat(t,".shutterfly.com");if("beta1"===t||"stage1"===t){var e=t.substr(0,t.length-1);return"cdn-".concat(e,".staticsfly.com")}var r="production"===t?"":"-".concat(t);return"cdn".concat(r,".staticsfly.com")},e.getEnvPrefix=function(){var t=u();if("production"===t)return"";return"".concat(t,".")},r(76),r(93);var n={dev:1,beta:1,kappa:1,stage:1,stage1:1,kappa1:1},o=null;function i(t){if(!t)return"production";if(t))return"dev";var e=function(t){if(0===t.indexOf("localhost"))return"dev";var e=t.split(".");if(e.length>1)for(var r=1,n=e.length;r<n;r++)if(e[r].toLowerCase().match(/^(shutterfly|tinyprints)$/))return e[r-1].toLowerCase();return null}(t);return"local"===e||"int"===e?"dev":e&&n[e]?e:"production"}function a(){return function(){try{if("undefined"!==typeof window)return!0}catch(t){return!1}}()?i(window.location.host):)}unction s(){var t=u();return"production"===t?"shutterfly.com":"".concat(t,".shutterfly.com")}},function(t,e,r){var n=r(75);t.exports=function(t,e,r){if(n(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}}},function(t,e,r){var n=r(49),o=r(50);t.exports=function(t){return function(e,r){var i,a,u=String(o(e)),s=n(r),c=u.length;return s<0||s>=c?t?"":void 0:(i=u.charCodeAt(s))<55296||i>56319||s+1===c||(a=u.charCodeAt(s+1))<56320||a>57343?t?u.charAt(s):i:t?u.slice(s,s+2):a-56320+(i-55296<<10)+65536}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("undefined"===typeof window)return{catch:function(){}};if("function"===typeof window.fetch)return function(t,e){fetch(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((function(t){})).catch((function(e){return console.error("Unable to log message: ".concat(t,", received ").concat(e))}))}(t,e);var r=function(t){},n=new XMLHttpRequest;return n.open("POST",t,!0),n.send(e),n.onload=function(){},n.addEventListener("error",(function(t){return r(t)})),{catch:function(t){return r=t}}}},function(t,e,r){"use strict";function n(t){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return r.reduce((function(e,r){if("object"!==n(r))throw new Error("merge only works on objects");for(var o in r)if("object"!==n(r[o])||"object"!==n(e[o])||Array.isArray(r[o]))if(Array.isArray(e[o])||Array.isArray(r[o])){var i=(e[o]?e[o]:[]).concat(r[o]?r[o]:[]);e[o]=i}else e[o]=r[o];else e[o]=t(e[o],r[o]);return e}),{})}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getURLPath=,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return new d(t,e,r,n||v())};var n=u(r(38)),o=u(r(40)),i=u(r(98)),a=u(r(99));unction s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),n.forEach((function(e){c(t,e,r[e])}))}return t}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=(0,o.default)(),d=function(){function t(e,r,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fetch=a.fetch,this.composed=void 0,this.batchSize=o.size,this.batchUnit=o.unit||"log",this.composed=this.batchSize?(0,i.default)(r):void 0,this.name=e,this.additionalLogData=r,this.performanceApi=a.performance,this.beaconApi=a.beacon,this.bowser=n.default.getParser(a.userAgent),this.additionalLogData.logSession||(this.additionalLogData.logSession=l),this.commonFields={os:this.bowser.getOSName(),osVersion:this.bowser.getOSVersion(),browser:this.bowser.getBrowserName(),browserVersion:this.bowser.getBrowserVersion(),device:this.bowser.getPlatformType(),engineName:this.bowser.getEngineName()},this.resource=this.additionalLogData.resource||"/application/log.gif"}var e,r,o;return e=t,(r=[{key:"debug",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._log("DEBUG",!0,t,e,Date.now())}},{key:"info",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._log("INFO",!0,t,e,Date.now())}},{key:"warn",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._log("WARN",!0,t,e,Date.now())}},{key:"error",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._log("ERROR",!1,t,e,Date.now())}},{key:"metric",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._log("METRIC",!0,t,s({},r,{duration:e}),Date.now())}},{key:"asyncMetric",value:function(t,e){return new a.default(this,t,e,this.performanceApi)}},{key:"pause",value:function(){if(this.composed)return null;this.composed=(0,i.default)(this.additionalLogData)}},{key:"resume",value:function(){if(this.composed){var t=this.composed.serialize();this.composed=void 0;var e={name:this.name,level:"BATCH",payload:t};this._logData(e),this.batchSize&&this.pause()}}},{key:"_log",value:function(t,e,r,n,o){var i=s({},{name:this.name,level:t,message:r,success:e,msg:r,timestamp:o},this.commonFields,this.additionalLogData,n);if(i=this._cleanupData(i),this.composed)return this.composed.add(r,i),void(this.batchSize&&this.composed.size()>=this.batchSize&&this.resume());this._logData(i)}},{key:"_logData",value:function(t){var e=Object.keys(t).map((function(e){var r=t[e];return!r&&0!==r||"string"!==typeof r&&"number"!==typeof r&&"boolean"!==typeof r?"":"".concat(e,"=").concat(encodeURIComponent(r))}));this._request(e.join("&"))}},{key:"_cleanupData",value:function(t){var e={};for(var r in t)if(t.hasOwnProperty(r)){var n=t[r],o="function"===typeof n?n():n;null!=o&&(e[r]="".concat(o).substring(0,1e3))}return e}},{key:"_request",value:function(t){var e="".concat(this.resource,"?").concat(t);this.beaconApi?this.beaconApi.sendBeacon(e):this.fetch(e).catch(()}}])&&f(e.prototype,r),o&&f(e,o),t}();function p(t){if("undefined"===typeof window)return Promise.reject("Not available during SSR");if("function"===typeof window.fetch)return window.fetch(t);var e=r=new XMLHttpRequest;return r.addEventListener("error",(),r.open("GET",t),r.send(),{catch:}var v=function(){try{var t=p,e="undefined"!==typeof window&&(window.navigator&&"function"===typeof window.navigator.sendBeacon),r="undefined"===typeof window?"REACTSSR":window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"";return{performance:"undefined"===typeof window?function(){return 0}:window.performance,beacon:e?window.navigator:void 0,fetch:t,userAgent:r}}catch(n){return{}}}},function(t,e,r){"use strict";unction o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{_logs:[],_logCache:{},_pairsFound:{},_requiredUnique:{timestamp:!0,time:!0,clientStartTime:!0,duration:!0,success:!0},size:add:function(t,e){var r=Object.keys(e).sort(),n={},o="",i=!0,a=!1,u=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var f=s.value,l="".concat(f).concat(e[f]),d=!0===this._requiredUnique[f];o+=l,d||void 0===this._pairsFound[l]?d||(this._pairsFound[l]={key:f,value:e[f],count:1}):this._pairsFound[l].count+=1,(d||this._pairsFound[l].count<2)&&(n[f]=e[f])}}catch(v){a=!0,u=v}finally{try{i||null==c.return||c.return()}finally{if(a)throw u}}var p="".concat(t).concat(o);!0!==this._logCache[p]&&(this._logCache[p]=!0,this._logs.push({message:t,data:n,sortedKeys:r}))},serialize:function(){var e=this._dedupeCommonFields(),r=n({},e.common,t);return r.logList=e.logs,JSON.stringify(r)},_dedupeCommonFields:function(){var e=[],r={},n=!0,o=!1,i=void 0;try{for(var a,u=this._logs[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){var s=a.value,c={message:s.message,msg:s.message},f=!0,l=!1,d=void 0;try{for(var p,v=s.sortedKeys[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var h=p.value,g=this._pairsFound["".concat(h).concat(s.data[h])];(void 0===g||g.count<2)&&t[h]!==s.data[h]?c[h]=s.data[h]:g&&g.count>1&&void 0===r[h]&&(r[h]=g.value)}}catch(y){l=!0,d=y}finally{try{f||null==v.return||v.return()}finally{if(l)throw d}}e.push(c)}}catch(y){o=!0,i=y}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return{common:r,logs:e}}}}},function(t,e,r){"use strict";function n(t){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=0,a=function(){function t(e,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.logger=e,this.message=r,this.url=n,this.perf=void 0,this._isCompletePerformance(o)&&(this.perf=o),this.startTime=Date.now();var a=i++;this.startMark="".concat("SFJS","-").concat(this.message,"-").concat(a,"-start"),this.endMark="".concat("SFJS","-").concat(this.message,"-").concat(a,"-end"),this.resolved=!1,this.perf&&this.perf.mark(this.startMark)}var e,r,a;return e=t,(r=[{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.resolved)return!1;var e=this._duration();return t.clientStartTime=this.startTime,this.url&&(t.url=this.url),this.logger.metric(this.message,e,t),this._clearMarks(),!0}},{key:"success",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.success=!0,this.log(t),this.resolved=!0}},{key:"failure",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.success=!1,this.log(t),this.resolved=!0}},{key:"_duration",value:function(){var t=Date.now()-this.startTime;if(!this.perf)return t;if(this.perf.mark(this.endMark),this.perf.measure(this.message,this.startMark,this.endMark),this.perf.getEntriesByName(this.message).count<=0)return t;var e=this.perf.getEntriesByName(this.message)[0];return parseInt(e.duration,10)}},{key:"_clearMarks",value:function(){this.perf&&void 0!==this.perf.clearMarks&&void 0!==this.perf.clearMeasures&&(this.perf.clearMarks(this.startMark),this.perf.clearMarks(this.endMark),this.perf.clearMeasures(this.message))}},{key:"_isCompletePerformance",value:function(t){return!(!t||"object"!=n(t))&&"function"==typeof t.mark&&"function"==typeof t.measure&&"function"==typeof t.getEntriesByName}}])&&o(e.prototype,r),a&&o(e,a),t}();e.default=a},function(t,e,r){r(30)("asyncIterator")},function(t,e,r){"use strict";r(e);var i=r(0),a=r.n(i),u=r(63);={FETCH_WEB_WORKER:function(t){return t?"https://widgets.photoccino.com/apcWorker/".concat(t,"/apcWorker.js"):"blob:https://".concat(window.location.hostname,"/")+window.apcWorkerGuid},RBP_SERVICE_URL:function(t,e,r){return"production"===r?"https://rbp.sfly-mktg.com/rec?date=".concat(t,"&page=").concat(e,"&src=worker"):"https://h924ubrd32.execute-api.us-east-1.amazonaws.com/dev/rec?date=".concat(t,"&page=").concat(e,"&env=").concat(r,"&src=worker")}},v={SMALL_WIDTH:768,MEDIUM_WIDTH:992,LARGE_WIDTH:1200},h={SUBSCRIBE_INITIATOR:"subscribeInitiator",GET_WIDGET_DATA:"getWidgetData",CANCEL_INITIATOR_SUBSCRIBTION:"cancelInitiatorSubscription",CHECK_INTERVAL:"checkInterval"},g={SUB_INIT_ACK:"subInitAck",WIDGET_RENDER:"widgetRender",ERROR:"error",SUCCESS:"success",FALLBACK_RENDER:"fallbackRender"},y={REC_WIDGET:"recWidget",STYLE_TILE:"styleTile"},b={NEXT_BEST_ACTION:"next_best_action",SAME_CATEGORY:"same_category",ALSO_BOUGHT:"also_bought",ALSO_BOUGHT_AND_MORE:"also_bought_and_more"},m={PIXEL_DATA:"pixel_data",CATEGORY_CODE:"category_code",PRODUCT_CODE:"product_code",SKU_CODE:"sku_code",SFLY_SKU:"sfly_sku",PROVIDER:"provider"},w={INIT_SPLUNK:{NAME:"apc-initiator",BATCH_INTERVAL:500},EVENTS:{INIT:"initialization",WORKER_TIMEOUT:"worker-timeout",WIDGET_SEARCH:"widget-search",GET_APC_CONF_ERROR:"get-apc-conf-error",CRASH:"crash",WORKER_TIMEOUT_RESPONSE_TIME:"worker-timeout-response-time",RBP_REQUEST:"rbp-request"}},S=r(64),_=r(65);unction E(){var t=window.location.href;return t.indexOf("local")>-1?{workEnv:"local",targetEnv:"internal"===t.split(".")[1]?"prod":t.split(".")[1]}:t.indexOf("beta")>-1?{workEnv:"beta",targetEnv:"beta"}:t.indexOf("stage")>-1?{workEnv:"stage",targetEnv:"stage"}:t.indexOf("kappa")>-1?{workEnv:"kappa",targetEnv:"kappa"}:{workEnv:"prod",targetEnv:"prod"}}function M(t){return t&&t.startsWith("/")&&(t=t.substring(1)),t&&t.endsWith("/")&&(t=t.slice(0,-1)),t||""}function x(t){var e;return""===M(t)&&((e={}).pageName="home page",e.pageType="home"),e}function P(){var t,e,r=M(null===(t=window.SFLY_DTL.page)||void 0===t||null===(e=t.pageInfo)||void 0===e?void 0:e.pageName),n=M(window.location.pathname),o=M(window.location.hash.replace("#","")),i=new Set([r,n,o]),a=Array.from(i),u="";a.forEach((function(t){""!==t&&(u=""===u?t:u+"/"+t)}));var s=x(u);return s&&(u=s.pageName),encodeURI(u)}function k(t,e){return void 0!==e?e.querySelector(t):"undefined"===typeof document?null:document.querySelector(t)}function A(t,e){t.getAttribute("loading-process")?window.setTimeout((,100,t):e()}function T(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main";return new Promise((function(r,n){var o=k('meta[app="'.concat(t,'"][fragment-name="').concat(e,'"]'),document);if(o)if(o.getAttribute("loading-process"))A(o,r);else if(o.getAttribute("loaded"))r();else{var i,a,u;o.setAttribute("loading-process","true");var s=o.getAttribute("html")||"";o.setAttribute("loaded","true"),o.removeAttribute("html");var c=null===(i=document)||void 0===i?void 0:i.createRange();c.setStart(null===(a=document)||void 0===a?void 0:a.body,0);var f=c.createContextualFragment(s),l=[].slice.call(f.querySelectorAll("script")).map((function(t){return new Promise((function(e,r){t.addEventListener("load",(),t.addEventListener("error",r)}))}));null===(u=document)||void 0===u||u.body.appendChild(f),Promise.all(l).then((function(){r()})).catch(n).finally(()}else n("can't lazy load fragment, tag not found for ".concat(t," ").concat(e))}))}var R=function(t,e){t.forEach((function(t){var r={},n=t.metadata;t.recipeId&&("fallback"===t.recipeId.toLowerCase().trim()&&e.testGroupData.config.content.fallback?(r=d(d({},e.testGroupData.config.content.fallback.metadata),n),e.testGroupData.config.content.fallback.metadata=r):(r=d(d({},e.testGroupData.config.content.recipes[t.recipeId].metadata),n),e.testGroupData.config.content.recipes[t.recipeId].metadata=r))}))},I=function(){var t=c(O().mark((function t(e,r){var n,o,i;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&R(r,e),window.ApcRecWidget){t.next=4;break}return t.next=4,T("apc-rec-widget");case 4:(n=window.ApcRecWidget)&&(o=d(d({},e.testGroupData.config.content),e.filters&&e.filters.length>0&&{filters:e.filters}),i=d(d({},e.testGroupData.config),{},{content:o}),n.run({activate:!0,containerId:e.containerId,config:i}));case 6:case"end":return t.stop()}}),t)})));return (),L=function(){var t=c(O().mark((function t(e){var r;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(window.ApcStyleTile){t.next=3;break}return t.next=3,T("apc-style-tile");case 3:(r=window.ApcStyleTile)&&r.run(e.testGroupData.config);case 5:case"end":return t.stop()}}),t)})));return (),j=function(t,e,r){var n=[];return r&&r===m.PROVIDER&&n.push({type:m.PROVIDER}),void 0!==e&&(n.push({type:m.CATEGORY_CODE,recipeId:e}),n.push({type:m.PRODUCT_CODE,recipeId:e}),n.push({type:m.SKU_CODE,recipeId:e}),n.push({type:m.SFLY_SKU,recipeId:e}),t&&t===b.NEXT_BEST_ACTION&&n.push({type:m.PIXEL_DATA,recipeId:e})),n};function F(t,e,r){var n,o=!1;if(t&&t.testGroupData.config.containerId===t.containerId)switch(n=t.testGroupData.type){case y.REC_WIDGET:o=!0,function(t,e,r){if(r){var n=[];t.testGroupData.config.content.recipes.forEach((function(t,e){n=n.concat(j(t.name,e.toString()))})),t.testGroupData.config.content.fallback&&(n=n.concat(j(t.testGroupData.config.content.fallback.name,"fallback"))),n.length>0?r(n,e,t):e(t)}else e(t)}(t,I,r);break;case y.STYLE_TILE:o=!0,L(t)}e.info({eventId:w.EVENTS.WIDGET_SEARCH,appContext:d({widgetFound:o},o&&{widgetType:n})})}function N(t){var e,r=d({},window.SFLY_DTL);if(t){var n=t.find(();n&&(r.page.productDetails||(r.page.productDetails={}),r.page.productDetails.marketplaceProvider=n.metadata.provider)}var o=x(null===(e=r.page.pageInfo)||void 0===e?void 0:e.pageName);return o&&(r.page.pageInfo.pageName=o.pageName,r.page.pageInfo.pageType=o.pageType),delete r.session,r}function C(t,e){var r=N(e),n={messageType:h.GET_WIDGET_DATA,containerId:t.containerId,rbpServiceURL:t.rbpServiceURL,userSegment:t.userSegment,SFLY_DTL:r};t.apcWorker.port.postMessage(n)}function B(){var t=E(),e=P(),r=function(t){var e="",r=new Date;if("prod"===t.targetEnv){var n=r.toLocaleDateString("en-US"),o=r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).split(":")[0];e="".concat(n,"_").concat(o).replace(/\//g,"_")}else e=r.getTime().toString();return e}(t),n="prod"===t.targetEnv?"production":t.targetEnv;return p.RBP_SERVICE_URL(r,e,n)}function D(){var t,e=localStorage.getItem("sfly_segments");return e?null===(t=JSON.parse(e))||void 0===t?void 0:t.segment:void 0}var G=function(){var t,e=window.SFLY_DTL.page.pageInfo.pageType;if(e)switch(e=e.toLowerCase()){case"product detail pages":t=S;break;case"thumbnail pages":t=_}return t},W=function(t,e,r,n,o){var i,a=function(t,e,r){var n;if(t&&t[e]&&t[e].testGroups){var o,i,a,u,s,c,f,l,d,p,v=t[e].testGroups[r];if(null===(o=v)||void 0===o?void 0:o.activate)(-1===r||(null===(l=v.config)||void 0===l||null===(d=l.abTest)||void 0===d?void 0:d.enabled))&&(n=v);if(!n&&-1!==r)(null===(p=v=t[e].testGroups[-1])||void 0===p?void 0:p.activate)&&(n=v);-1===(null===(i=n)||void 0===i||null===(a=i.config)||void 0===a||null===(u=a.abTest)||void 0===u?void 0:u.testGroup)&&(null===(s=n)||void 0===s||null===(c=s.config)||void 0===c||null===(f=c.abTest)||void 0===f?void 0:f.enabled)&&(n.config.abTest.enabled=!1)}return n}(t.widgets,e,r);a&&(i={testGroupData:a,containerId:e,filters:t.filters}),F(i,n,o)};var U=function(){var t=c(O().mark((function t(e,r,n){var o,i,a,u,s,c,f,l,p,v;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=e.asyncMetric(w.EVENTS.RBP_REQUEST),t.next=3,fetch(r,{method:"GET"});case 3:if((s=t.sent).ok){t.next=10;break}a=!1,c="An error has occured: ".concat(s.status),u.failure({appContext:{errorMessage:c,errorStatus:s.status,requestUrl:r,testGroup:n}}),t.next=18;break;case 10:return a=!0,t.next=13,s.json();case 13:p=t.sent,o=null===(f=p.body)||void 0===f?void 0:f.widgets,i=null===(l=p.body)||void 0===l?void 0:l.filters,o&&Object.keys(o).forEach((function(t){v||(v={}),v[t]={},v[t].testGroups=[],Object.keys(o[t].testGroups).forEach(()})),u.success({appContext:{responseBody:d(d({},v),{},{includeWidgets:Boolean(v)}),testGroup:n}});case 18:return t.abrupt("return",{successfulResponse:a,widgets:o,filters:i});case 19:case"end":return t.stop()}}),t)})));return (),V=r(66),z=r.n(V),H=function(t,e){var r,n={appContext:{pageName:e,containerId:t,pageCategory:(null===(r=window.SFLY_DTL.page.pageDetails)||void 0===r?void 0:r.productCategory)||""}};return Object(i.useRef)(z()({name:w.INIT_SPLUNK.NAME,enableNRD:!0,globalLogData:n,batchInterval:w.INIT_SPLUNK.BATCH_INTERVAL})).current},q=function(t,e){var r=t.splunkLogger,n=t.containerId,o=t.localStorageObj,i=t.getMetadata,a=N(e),u=B(),s=D(),c="".concat(u,"&sflyDtl=").concat(encodeURIComponent(JSON.stringify(a))).concat(s?"&userSegmnet=".concat(s):"");U(r,c,o.testGroup).then((function(t){var e=t.successfulResponse?t:G();e&&W(e,n,o.testGroup,r,i)})).catch((function(t){r.error({eventId:w.EVENTS.GET_APC_CONF_ERROR,appContext:{errorMessage:t.message,requestUrl:c,testGroup:o.testGroup}});var e=G();e&&W(e,n,o.testGroup,r,i)}))},K=function(t){var e=t.splunkLogger,r=t.containerId,n=t.localStorageObj,o=t.getMetadata;e.info({eventId:w.EVENTS.INIT,appContext:{workerSupport:!1}});var i={splunkLogger:e,containerId:r,localStorageObj:n,getMetadata:o};o?o(j(void 0,void 0,m.PROVIDER),q,i):q(i)};function Y(t){var e=t.apcWorker,r=t.containerId,n=t.getMetadata,o=P(),u=H(r,o),s=Object(i.useRef)(!1),c=Object(i.useRef)(!1),f=Object(i.useRef)(!1);return Object(i.useEffect)((function(){var t=localStorage.getItem(r),o={testGroup:-1};if(t){var i=(o=JSON.parse(t)).expiryDate;Date.now()>=i&&(localStorage.removeItem(r),o.testGroup=-1)}if(!f.current)if(f.current=!0,e){e.port.onmessage||(e.port.onmessage=function(t){!function(t,e,r,n,o,i,a){var u=t.data;switch(u.type){case g.SUB_INIT_ACK:var s=(new Date).getTime()-u.sendTime.getTime();if(o.current)r.info({eventId:w.EVENTS.WORKER_TIMEOUT_RESPONSE_TIME,appContext:{workerResponseTime:s}});else{console.log("Initiator ".concat(u.containerId," subscription in apcWorker was acknowledged")),n.current=!0,r.info({eventId:w.EVENTS.INIT,appContext:{workerSupport:!0,workerResponseTime:s}});var c=B(),f=D(),l={containerId:u.containerId,rbpServiceURL:c,apcWorker:e,userSegment:f};if(a)a(j(void 0,void 0,m.PROVIDER),C,l);else C(l)}break;case g.WIDGET_RENDER:F(u.testGroupData?u:void 0,r,a);break;case g.ERROR:r.error({eventId:"rbp"===u.reason?w.EVENTS.RBP_REQUEST:w.EVENTS.GET_APC_CONF_ERROR,appContext:{errorMessage:u.errorMessage,errorStatus:u.errorStatus,requestUrl:u.requestUrl,testGroup:i}}),e.port.postMessage({messageType:h.CHECK_INTERVAL});break;case g.SUCCESS:r.info({eventId:w.EVENTS.RBP_REQUEST,appContext:{responseBody:u.responseBody,testGroup:i},startMillis:u.startMillis,endMillis:u.endMillis}),e.port.postMessage({messageType:h.CHECK_INTERVAL});break;case g.FALLBACK_RENDER:var d=G();d&&W(d,u.containerId,i,r,a)}}(t,e,u,s,c,o.testGroup,n)},e.onerror=;var a={messageType:h.SUBSCRIBE_INITIATOR,containerId:r,testGroup:o.testGroup,sendTime:new Date};e.port.postMessage(a),setTimeout((function(){if(!s.current){c.current=!0;var t={messageType:h.CANCEL_INITIATOR_SUBSCRIBTION,containerId:r};e.port.postMessage(t),K({splunkLogger:u,containerId:r,localStorageObj:o,getMetadata:n}),u.error({eventId:w.EVENTS.WORKER_TIMEOUT})}}),2e3,K,u,r,o,n)}else K({splunkLogger:u,containerId:r,localStorageObj:o,getMetadata:n})}),[e,r,u,n]),a.a.createElement(a.a.Fragment,null)}=r(12),rt=r.n(et);var nt=function(){var t=o(Object(i.useState)(window.innerWidth<v.SMALL_WIDTH?"mobile":window.innerWidth<v.LARGE_WIDTH?"tablet":""),2),e=t[0],r=t[1],n=o(Object(i.useState)(window.innerWidth<window.innerHeight?"portrait":"landscape"),2),a=n[0],u=n[1],s=Object(i.useCallback)((function(){var t=rt.a.mobile()?"mobile":rt.a.tablet()?"tablet":"",e=rt.a.portrait()?"portrait":rt.a.landscape()?"landscape":"";r(t),u(e)}),[]);return function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window,n=Object(i.useRef)();Object(i.useEffect)((,[e]),Object(i.useEffect)((function(){var e=r&&r.addEventListener,o=n.current&&"function"===typeof n.current;if(e&&o){var i=return r.addEventListener(t,i),}),[t,r])}("resize",Object(i.useCallback)((function(){var t=window.innerWidth,e=window.innerHeight;if(t&&e){var n=v.SMALL_WIDTH,o=v.LARGE_WIDTH,i=t<e?"portrait":"landscape";r(t<n?"mobile":t<o?"tablet":""),u(i)}}),[])),Object(i.useEffect)((,[s]),{type:e,orientation:a,platform:"mobile"===e||"tablet"===e?"mweb":"web"}};function ot(t){var e=t.containerId,r=t.children,n=P(),o=H(e,n),i=nt();return a.a.createElement(it,{splunkLogger:o,device:i,children:r})}var it=function(t){!u,t);var e,r,n,o,i=(e=u,;eturn r=u,o=[{key:"getDerivedStateFromError",value:],(n=[{key:"componentDidCatch",value:function(t,e){var r=this.props.splunkLogger,n=this.props.device;r.error({eventId:w.EVENTS.CRASH,appContext:d({error:t,errorInfo:e},"mweb"===n.platform&&{deviceOrientation:n.orientation})})}},{key:"render",value:function(){return this.state.hasError?"Error":a.a.createElement(a.a.Fragment,null,this.props.children)}}])&&Q(r.prototype,n),o&&Q(r,o),u}(i.Component);r.d(e,"run",(function(){return at})),r.d(e,"Starter",();var at=function(t){var e=(null===t||void 0===t?void 0:t.domElement)||(null===t||void 0===t?void 0:t.containerId)&&document.getElementById(t.containerId);if(e){var r=null===new URLSearchParams(window.location.href).get("disableWorker")&&"undefined"!==typeof SharedWorker?function(){var t=E(),e=p.FETCH_WEB_WORKER(t.targetEnv),r=new URL(e);if(null!=r&&r.origin!==window.location.origin)if(window.apcWorkerGuid)e=p.FETCH_WEB_WORKER();else{var n=(e=URL.createObjectURL(new Blob(["importScripts('".concat(r.href,"')")],{type:"application/javascript"}))).lastIndexOf("/")+1;window.apcWorkerGuid=e.slice(n)}return new SharedWorker(e)}():void 0;Object(u.render)(a.a.createElement(ot,{containerId:t.containerId},a.a.createElement(Y,{apcWorker:r,containerId:t.containerId,getMetadata:t.getMetadata})),e)}else console.error("Initiator ".concat(t.containerId," wasn't loaded due to missing DOM element to consume it"))},ut=function(t){var e=t.containerId,r=t.getMetadata,n=o(Object(i.useState)(!1),2),u=n[0],s=n[1],c=Object(i.useRef)(a.a.createElement(a.a.Fragment,null));return Object(i.useEffect)((function(){u?at({containerId:e,getMetadata:r}):(c.current=a.a.createElement("div",{id:e,"data-test-id":e}),s(!0))}),[e,u,r]),c.current}}]);
//# sourceMappingURL=ApcInitiator.b7991aeb3b.js.map