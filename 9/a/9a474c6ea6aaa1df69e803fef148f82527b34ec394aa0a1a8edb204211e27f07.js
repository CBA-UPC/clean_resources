!function(e){e.Jcrop=function(t,n){on u(e,t,n){if(P=a(q),pt.setCursor("move"===e?e:e+"-resize"),"move"===e)return pt.activateHandlers(l(t),b,n);var o=lt.getFixed(),r=h(e),i=lt.getCorner(h(r));lt.setPressed(lt.getCorner(r)),lt.setCurrent(i),pt.activateHandlers(d(e,o),b,n)}function d(e,t){return function(n){if(J.aspectRatio)switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}else switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}lt.setCurrent(n),ft.update()}}function l(e){var t=e;return gt.watchKeys(),unction f(e){return function(t){return J.disabled?!1:"move"!==e||J.allowMove?(P=a(q),ot=!0,u(e,s(t)),t.stopPropagation(),t.preventDefault(),!1):!1}}nction b(){var e=lt.getFixed();e.w>J.minSelect[0]&&e.h>J.minSelect[1]?(ft.enableHandles(),ft.done()):ft.release(),pt.setCursor(J.allowSelect?"crosshair":"default")}tion x(e,t){ar o=e[0]/tt,r=e[1]/nt,i=e[2]/tt,a=e[3]/nt;if(!rt){var s=lt.flipCoords(o,r,i,a),c=lt.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=J.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],b=0,w=J.swingSpeed;o=d[0],r=d[1],i=d[2],a=d[3],ft.animMode(!0);var v=function(){return function(){b+=(100-b)/w,d[0]=Math.round(o+b/100*h),d[1]=Math.round(r+b/100*f),d[2]=Math.round(i+b/100*p),d[3]=Math.round(a+b/100*g),b>=99.8&&(b=100),100>b?(S(d),n()):(ft.done(),ft.animMode(!1),"function"==typeof t&&t.call(bt))}}();n()}}nction k(){return g(lt.getFixed())}function z(){return lt.getFixed()}tion H(){G.remove(),E.show(),E.css("visibility","visible"),e(t).removeData("Jcrop")}function D(e,t){ft.release(),O();var n=new Image;n.onload=n.src=e}unction B(e){J.allowResize?e?ft.enableOnly():ft.enableHandles():ft.disableHandles(),pt.setCursor(J.allowSelect?"crosshair":"default"),ft.setCursor(J.allowMove?"move":"default"),J.hasOwnProperty("trueSize")&&(tt=J.trueSize[0]/L,nt=J.trueSize[1]/X),J.hasOwnProperty("setSelect")&&(C(J.setSelect),ft.done(),delete J.setSelect),ht.refresh(),J.bgColor!=ct&&(I(J.shade?ht.getShades():G,J.shade?J.shadeColor||J.bgColor:J.bgColor),ct=J.bgColor),ut!=J.bgOpacity&&(ut=J.bgOpacity,J.shade?ht.refresh():ft.setBgOpacity(ut)),Z=J.maxSize[0]||0,$=J.maxSize[1]||0,_=J.minSize[0]||0,et=J.minSize[1]||0,J.hasOwnProperty("outerImage")&&(q.attr("src",J.outerImage),delete J.outerImage),ft.refresh()}var P,J=e.extend({},e.Jcrop.defaults),A=navigator.userAgent.toLowerCase(),R=/msie/.test(A),T=/msie [1-6]\./.test(A);"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof n&&(n={}),c(n);var K={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},E=e(t),W=!0;if("IMG"==t.tagName){if(0!=E[0].width&&0!=E[0].height)E.width(E[0].width),E.height(E[0].height);else{var Y=new Image;Y.src=E[0].src,E.width(Y.width),E.height(Y.height)}var q=E.clone().removeAttr("id").css(K).show();q.width(E.width()),q.height(E.height()),E.after(q).hide()}else q=E.css(K).show(),W=!1,null===J.shade&&(J.shade=!0);p(q,J.boxWidth,J.boxHeight);var L=q.width(),X=q.height(),G=e("<div />").width(L).height(X).addClass(r("holder")).css({position:"relative",backgroundColor:J.bgColor}).insertAfter(E).append(q);J.addClass&&G.addClass(J.addClass);var N=e("<div />"),V=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),Q=e("<div />").width("100%").height("100%").css("zIndex",320),U=e("<div />").css({position:"absolute",zIndex:600}).dblclick(.insertBefore(q).append(V,Q);W&&(N=e("<img />").attr("src",q.attr("src")).css(K).width(L).height(X),V.append(N)),T&&U.css({overflowY:"hidden"});var Z,$,_,et,tt,nt,ot,rt,it,at=J.boundary,st=y().width(L+2*at).height(X+2*at).css({position:"absolute",top:o(-at),left:o(-at),zIndex:290}).mousedown(w),ct=J.bgColor,ut=J.bgOpacity;P=a(q);var dt=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var r=n[e];r="on"+r;var i=r in o;i||(o.setAttribute(r,"return;"),i="function"==typeof o[r]),t[n[e]]=i}return t.touchstart&&t.touchend&&t.touchmove}catch(a){return!1}}eturn{createDragger:function(e){return function(t){return J.disabled?!1:"move"!==e||J.allowMove?(P=a(q),ot=!0,u(e,s(dt.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1):!1}},newSelection:cfilter:isSupported:e,support:t()}}(),lt=function(){function e(e){e=a(e),p=h=e[0],g=f=e[1]}function t(e){e=a(e),d=e[0]-p,l=e[1]-g,p=e[0],g=e[1]}unction o(e){var t=e[0],n=e[1];0>h+t&&(t-=t+h),0>f+n&&(n-=n+f),g+n>X&&(n+=X-(g+n)),p+t>L&&(t+=L-(p+t)),h+=t,p+=t,f+=n,g+=n}unction i(){if(!J.aspectRatio)return c();var e,t,n,o,r=J.aspectRatio,i=J.minSize[0]/tt,a=J.maxSize[0]/tt,d=J.maxSize[1]/nt,l=p-h,b=g-f,w=Math.abs(l),v=Math.abs(b),y=w/v;return 0===a&&(a=10*L),0===d&&(d=10*X),r>y?(t=g,n=v*r,e=0>l?h-n:n+h,0>e?(e=0,o=Math.abs((e-h)/r),t=0>b?f-o:o+f):e>L&&(e=L,o=Math.abs((e-h)/r),t=0>b?f-o:o+f)):(e=p,o=w/r,t=0>b?f-o:f+o,0>t?(t=0,n=Math.abs((t-f)*r),e=0>l?h-n:n+h):t>X&&(t=X,n=Math.abs(t-f)*r,e=0>l?h-n:n+h)),e>h?(i>e-h?e=h+i:e-h>a&&(e=h+a),t=t>f?f+(e-h)/r:f-(e-h)/r):h>e&&(i>h-e?e=h-i:h-e>a&&(e=h-a),t=t>f?f+(h-e)/r:f-(h-e)/r),0>e?(h-=e,e=0):e>L&&(h-=e-L,e=L),0>t?(f-=t,t=0):t>X&&(f-=t-X,t=X),u(s(h,f,e,t))}unction s(e,t,n,o){var r=e,i=n,a=t,s=o;return e>n&&(r=n,i=e),t>o&&(a=o,s=t),[r,a,i,s]}function c(){var e,t=p-h,n=g-f;return Z&&Math.abs(t)>Z&&(p=t>0?h+Z:h-Z),$&&Math.abs(n)>$&&(g=n>0?f+$:f-$),et/nt&&Math.abs(n)<et/nt&&(g=n>0?f+et/nt:f-et/nt),_/tt&&Math.abs(t)<_/tt&&(p=t>0?h+_/tt:h-_/tt),0>h&&(p-=h,h-=h),0>f&&(g-=f,f-=f),0>p&&(h-=p,p-=p),0>g&&(f-=g,g-=g),p>L&&(e=p-L,h-=e,p-=e),g>X&&(e=g-X,f-=e,g-=e),h>L&&(e=h-X,g-=e,f-=e),f>X&&(e=f-X,g-=e,f-=e),u(s(h,f,p,g))}ar d,l,h=0,f=0,p=0,g=0;return{flipCoords:s,setPressed:e,setCurrent:t,getOffset:n,moveOffset:o,getCorner:r,getFixed:i}}(),ht=function(){function t(e,t){p.left.css({height:o(t)}),p.right.css({height:o(t)})}n d(){J.shade?a():c(),ft.isAwake()&&u(J.bgOpacity)}ar h=!1,f=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),p={top:i(),left:i().height(X),right:i().height(X),bottom:i()};return{update:n,updateRaw:r,getShades:l,setBgColor:s,enable:a,disable:c,resize:t,refresh:d,opacity:u}}(),ft=function(){tion s(e){var t;for(t=0;t<e.length;t++)H[e[t]]=a(e[t])}function c(e){var n,o;for(o=0;o<e.length;o++){switch(e[o]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}j[e[o]]=t(n)}}function u(e){var t;for(t=0;t<e.length;t++)F[e[t]]=i(e[t])}function d(e,t){J.shade||N.css({top:o(-t),left:o(-e)}),U.css({top:o(t),left:o(e)})}ction b(e){var t=lt.getFixed();l(t.w,t.h),d(t.x,t.y),J.shade&&ht.updateRaw(t),M||v(),e?J.onSelect.call(bt,g(t)):J.onChange.call(bt,g(t))}unction v(){U.show(),J.shade?ht.opacity(ut):w(ut,!0),M=!0}function m(){S(),U.hide(),J.shade?ht.opacity(1):w(1),M=!1,J.onRelease.call(bt)},O=370,j={},F={},H={},D=!1;J.dragEdges&&e.isArray(J.createDragbars)&&s(J.createDragbars),e.isArray(J.createHandles)&&u(J.createHandles),J.drawBorders&&e.isArray(J.createBorders)&&c(J.createBorders),e(document).bind("touchstart.jcrop-ios",;var I=y().mousedown(f("move")).css({cursor:"move",position:"absolute",zIndex:360});return dt.support&&I.bind("touchstart.jcrop",dt.createDragger("move")),V.append(I),S(),{updateVisible:p,update:b,release:m,refresh:h,isAwake:function(){return M},setCursor:enableHandles:C,enableOnly:showHandles:x,disableHandles:S,animMode:k,setBgOpacity:w,done:z}}(),pt=function(){function t(t){st.css({zIndex:450}),t?e(document).bind("touchmove.jcrop",a).bind("touchend.jcrop",c):h&&e(document).bind("mousemove.jcrop",o).bind("mouseup.jcrop",r)}ction i(e,n,o){return ot=!0,d=e,l=n,t(o),!1} d=function(){},l=function(){},h=J.trackDocument;return h||st.mousemove(o).mouseup(r).mouseout(r),q.before(st),{activateHandlers:i,setCursor:u}}(),gt=function(){i=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),a=e("<div />").css({position:"absolute",overflow:"hidden"}).append(i);return J.keySupport&&(i.keydown(r).blur(n),T||!J.fixedSupport?(i.css({position:"absolute",left:"-20px"}),a.append(i).insertBefore(q)):i.insertBefore(q)),{watchKeys:t}}();dt.support&&st.bind("touchstart.jcrop",dt.newSelection),Q.hide(),B(!0);var bt={setImage:D,animateTo:x,setSelect:C,setOptions:M,tellSelect:k,tellScaled:z,setClass:m,disable:O,enable:j,cancel:F,release:ft.release,destroy:H,focus:gt.watchKeys,getBounds:getWidgetSize:function(){return[L,X]},getScaleFactor:getOptions:ui:{holder:G,selection:U}};return R&&G.bind("selectstart",,E.data("Jcrop",bt),bt},e.fn.Jcrop=e.Jcrop.Loader=function(t,n,o){ar i=e(t),a=i[0];i.bind("load.jcloader",r).bind("error.jcloader",function(){i.unbind(".jcloader"),e.isFunction(o)&&o.call(a)}),a.complete&&e.isFunction(n)&&(i.unbind(".jcloader"),n.call(a))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:}(jQuery);