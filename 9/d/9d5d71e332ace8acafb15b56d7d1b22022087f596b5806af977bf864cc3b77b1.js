(function(c,ns){var v=c[ns]=c[ns]||{};v["widgets/sidebar/default"]={css:["widgets--sidebar--default"]},v["widgets/siderail/default"]={css:["widgets--siderail--default"]},v["widgets/siderail/h-letter"]={css:["widgets--siderail--h-letter"]},v["widgets/siderail/h-square"]={css:["widgets--siderail--h-square"]},v["widgets/snippet/default"]={css:["widgets--snippet--default"]},v["widgets/snippet/blocks"]={css:["widgets--snippet--blocks"]},v["widgets/snippet/blocks2"]={css:["widgets--snippet--blocks2"]},v["widgets/snippet/float"]={css:["widgets--snippet--float"]},v["widgets/snippet/flex"]={css:["widgets--snippet--flex"]},v["widgets/snippet/flex2"]={css:["widgets--snippet--flex2"]},v["widgets/snippet/compact"]={css:["widgets--snippet--compact"]},v["widgets/snippet-mobile/default"]={css:["widgets--snippet-mobile--default"]},v["widgets/snippet-mobile/blocks"]={css:["widgets--snippet-mobile--blocks"]},v["widgets/snippet-mobile/blocks2"]={css:["widgets--snippet-mobile--blocks2"]},v["widgets/snippet-mobile/float"]={css:["widgets--snippet-mobile--float"]},v["widgets/storyline/button"]={css:["widgets--storyline--button"]},v["widgets/storyline/split-button"]={css:["widgets--storyline--split-button"]},v["widgets/storyline/transparent"]={css:["widgets--storyline--transparent"]},v["widgets/storyline/colossus"]={css:["widgets--storyline--colossus"]},v["widgets/personalization/button"]={css:["widgets--personalization--button"]},v["widgets/personalization/split-button"]={css:["widgets--personalization--split-button"]},v["widgets/personalization/transparent"]={css:["widgets--personalization--transparent"]},v["widgets/personalization/colossus"]={css:["widgets--personalization--colossus"]},v["widgets/channel/button"]={css:["widgets--channel--button"]},v["widgets/channel/split-button"]={css:["widgets--channel--split-button"]},v["widgets/channel/transparent"]={css:["widgets--channel--transparent"]},v["widgets/channel/colossus"]={css:["widgets--channel--colossus"]},v["widgets/channel-form/form"]={css:["widgets--channel-form--form"]},v["widgets/home-personalized/default"]={css:["widgets--home-personalized--default"]},v["widgets/home-personalized/blocks"]={css:["widgets--home-personalized--blocks"]},v["widgets/home-personalized/blocks2"]={css:["widgets--home-personalized--blocks2"]},v["widgets/home-personalized/float"]={css:["widgets--home-personalized--float"]},v["widgets/author-followup/button"]={css:["widgets--author-followup--button"]},v["widgets/author-followup/split-button"]={css:["widgets--author-followup--split-button"]},v["widgets/author-followup/transparent"]={css:["widgets--author-followup--transparent"]},v["widgets/author-followup/colossus"]={css:["widgets--author-followup--colossus"]},v["widgets/author-followup/form"]={css:["widgets--author-followup--form"]}})(Contextly,"assets"),function(){"use strict";function find(selector,context){return void 0===context&&(context=doc),isDocument(context)||isElement(context)?classRe.test(selector)?context.getElementsByClassName(selector.slice(1)):tagRe.test(selector)?context.getElementsByTagName(selector):context.querySelectorAll(selector):[]}nction each(arr,callback){for(var i=0,l=arr.length;l>i&&callback.call(arr[i],i,arr[i])!==!1;i++);}function extend(target){for(var objs=[],_i=1;arguments.length>_i;_i++)objs[_i-1]=arguments[_i];for(var args=arguments,length=args.length,i=2>length?0:1;length>i;i++)for(var key in args[i])target[key]=args[i][key];return target}unction pluck(arr,prop,deep){for(var plucked=[],i=0,l=arr.length;l>i;i++)for(var val_1=arr[i][prop];null!=val_1&&(plucked.push(val_1),deep);)val_1=val_1[prop];return plucked}nction isDocument(x){return!!x&&9===x.nodeType}unction isFunction(x){return"function"==typeof x}unction isPlainObject(x){return!x||"object"!=typeof x||x.nodeType||this.isWindow(x)?!1:!0}unction getCompareFunction(comparator){return isString(comparator)?isFunction(comparator)?comparator:isCash(comparator)?function(i,ele){return comparator.is(ele)}:function filtered(collection,comparator){return comparator&&collection.length?collection.filter(comparator):collection}unction attr(attr,value){if(attr){if(isString(attr)){if(2>arguments.length){if(!this[0])return;var value_1=this[0].getAttribute(attr);return null===value_1?void 0:value_1}return void 0===value?this:null===value?this.removeAttr(attr):this.each(}for(var key in attr)this.attr(key,attr[key]);return this}}tion getPrefixedProp(prop,isVariable){if(void 0===isVariable&&(isVariable=isCSSVariable(prop)),isVariable)return prop;if(!prefixedProps[prop]){var propCC=camelCase(prop),propUC=""+propCC.charAt(0).toUpperCase()+propCC.slice(1),props=(propCC+" "+vendorsPrefixes.join(propUC+" ")+propUC).split(" ");each(props,function(i,p){return p in style?(prefixedProps[prop]=p,!1):void 0})}return prefixedProps[prop]}unction css(prop,value){if(isString(prop)){var isVariable_1=isCSSVariable(prop);return prop=getPrefixedProp(prop,isVariable_1),2>arguments.length?this[0]&&computeStyle(this[0],prop,isVariable_1):prop?(value=getSuffixedValue(prop,value,isVariable_1),this.each():this}for(var key in prop)this.css(key,prop[key]);return this}function getData(ele,key){var value=ele.dataset?ele.dataset[key]||ele.dataset[camelCase(key)]:ele.getAttribute("data-"+key);try{return JSON.parse(value)}catch(_a){}return value}function setData(ele,key,value){try{value=JSON.stringify(value)}catch(_a){}ele.dataset?ele.dataset[camelCase(key)]=value:ele.setAttribute("data-"+key,value)}function data(name,value){var _this=this;if(!name){if(!this[0])return;var datas_1={};return each(this[0].attributes,,datas_1}if(isString(name))return void 0===value?this[0]&&getData(this[0],name):this.each(;for(var key in name)this.data(key,name[key]);return this}unction getDefaultDisplay(tagName){if(defaultDisplay[tagName])return defaultDisplay[tagName];var ele=window.document.createElement(tagName);window.document.body.appendChild(ele);var display=computeStyle(ele,"display");return window.document.body.removeChild(ele),defaultDisplay[tagName]="none"!==display?display:"block"}tion addEvent(ele,name,namespaces,selector,callback){callback.guid=callback.guid||cash.guid++;var eventCache=getEventsCache(ele);eventCache[name]=eventCache[name]||[],eventCache[name].push([namespaces,selector,callback]),ele.addEventListener(name,callback)}unction removeEvent(ele,name,namespaces,selector,callback){var cache=getEventsCache(ele);if(name)cache[name]&&(cache[name]=cache[name].filter(function(_a){var ns=_a[0],sel=_a[1],cb=_a[2];return callback&&cb.guid!==callback.guid||!hasNamespaces(ns,namespaces)||selector&&selector!==sel?!0:(ele.removeEventListener(name,cb),void 0)}));else{for(name in cache)removeEvent(ele,name,namespaces,selector,callback);delete ele[eventsNamespace]}}function on(eventFullName,selector,callback,_one){var _this=this;if(!isString(eventFullName)){for(var key in eventFullName)this.on(key,selector,eventFullName[key]);return this}return isFunction(selector)&&(callback=selector,selector=""),each(getSplitValues(eventFullName),function(i,eventFullName){var _a=parseEventName(getEventNameBubbling(eventFullName)),name=_a[0],namespaces=_a[1];_this.each(function(i,ele){var finalCallback=function finalCallback(event){if(!event.namespace||hasNamespaces(namespaces,event.namespace.split(eventsNamespacesSeparator))){var thisArg=ele;if(selector){for(var target=event.target;!matches(target,selector);){if(target===ele)return;if(target=target.parentNode,!target)return}thisArg=target,event.__delegate=!0}event.__delegate&&Object.defineProperty(event,"currentTarget",{configurable:!0,get:);var returnValue;event.data?(cash.isArray(event.data)||(event.data=[event.data]),event.data.unshift([event]),returnValue=callback.apply(thisArg,event.data)):returnValue=callback.call(thisArg,event,event.data),_one&&removeEvent(ele,name,namespaces,selector,finalCallback),returnValue===!1&&(event.preventDefault(),event.stopPropagation())}};finalCallback.guid=callback.guid=callback.guid||cash.guid++,addEvent(ele,name,namespaces,selector,finalCallback)})}),this}function one(eventFullName,selector,callback){return this.on(eventFullName,selector,callback,!0)}unction queryEncode(prop,value){return"&"+encodeURIComponent(prop)+"="+encodeURIComponent(value).replace(queryEncodeSpaceRe,"+")}function val(value){return void 0===value?this[0]&&getValue(this[0]):this.each(function(i,ele){if("SELECT"===ele.tagName){var eleValue_1=isArray(value)?value:null===value?[]:[value];each(ele.options,}else ele.value=null===value?"":value})}function initContainers(){if(!containers){var table=document.createElement("table"),tr=document.createElement("tr");containers={"*":div,tr:document.createElement("tbody"),td:tr,th:tr,thead:table,tbody:table,tfoot:table}}}function parseHTML(html){if(initContainers(),!isString(html))return[];if(singleTagRe.test(html))return[window.document.createElement(RegExp.$1)];var fragment=fragmentRe.test(html)&&RegExp.$1,container=containers[fragment]||containers["*"];return container.innerHTML=html,cash(container.childNodes).detach().get()}function html(html){return void 0===html?this[0]&&this[0].innerHTML:this.each(function(i,ele){ele.innerHTML=html})}function text(text){return void 0===text?this[0]?this[0].textContent:"":this.each(function(i,ele){ele.textContent=text})}function evalScripts(node){var collection=cash(node);collection.filter("script").add(collection.find("script")).each(function(i,ele){!ele.src&&scriptTypeRe.test(ele.type)&&ele.ownerDocument.documentElement.contains(ele)&&eval(ele.textContent.replace(HTMLCDATARe,""))})}function insertElement(anchor,child,prepend,prependTarget){prepend?anchor.insertBefore(child,prependTarget):(1===anchor.nodeType||11===anchor.nodeType||9===anchor.nodeType)&&anchor.appendChild(child),evalScripts(child)}nction buildParams(prefix,obj,add){var name,rbracket=/\[\]$/;if(cash.isArray(obj))cash.each(obj,function(i,v){rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v?i:"")+"]",v,add)});else if("object"==typeof obj)for(name in obj)buildParams(prefix+"["+name+"]",obj[name],add);else add(prefix,obj)}var doc=document,win=window,div=doc.createElement("div"),_a=Array.prototype,filter=_a.filter,indexOf=_a.indexOf,map=_a.map,push=_a.push,reverse=_a.reverse,slice=_a.slice,some=_a.some,splice=_a.splice,idRe=/^#[\w-]*$/,classRe=/^\.[\w-]*$/,htmlRe=/<.+>/,tagRe=/^\w+$/,Cash=function(){function Cash(selector,context){if(void 0===context&&(context=doc),selector){if(isCash(selector))return selector;var eles=selector;if(isString(selector)){var ctx=isCash(context)?context[0]:context;if(idRe.test(selector)&&"function"!=typeof ctx.getElementById&&(ctx=window.document),eles=idRe.test(selector)?ctx.getElementById(selector.slice(1)):htmlRe.test(selector)?parseHTML(selector):find(selector,ctx),!eles)return}else if(isFunction(selector))return this.ready(selector);(eles.nodeType||eles===win)&&(eles=[eles]),this.length=eles.length;for(var i=0,l=this.length;l>i;i++)this[i]=eles[i]}}return Cash.prototype.init=Cash}(),cash=Cash.prototype.init;cash.fn=cash.prototype=Cash.prototype,Cash.prototype.length=0,Cash.prototype.splice=splice,"function"==typeof Symbol&&(Cash.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator]),Cash.prototype.get=Cash.prototype.eq=Cash.prototype.first=function(){return this.eq(0)},Cash.prototype.last=Cash.prototype.map=Cash.prototype.slice=var dashAlphaRe=/-([a-z])/g;cash.camelCase=camelCase,cash.each=each,Cash.prototype.each=Cash.prototype.removeProp=Cash.prototype.extend=cash.extend=extend,cash.guid=1,cash.matches=matches;var isArray=Array.isArray;cash.isWindow=isWindow,cash.isFunction=isFunction,cash.isString=isString,cash.isNumeric=isNumeric,cash.isArray=isArray,cash.isPlainObject=isPlainObject,Cash.prototype.prop=Cash.prototype.filter=function(comparator){if(!comparator)return cash();var compare=getCompareFunction(comparator);return cash(filter.call(this,)};var splitValuesRe=/\S+/g;Cash.prototype.hasClass=function(cls){return cls&&some.call(this,function(ele){return ele.classList.contains(cls)})},Cash.prototype.removeAttr=function(attr){var attrs=getSplitValues(attr);return attrs.length?this.each(:this},Cash.prototype.attr=attr,Cash.prototype.toggleClass=function(cls,force){var classes=getSplitValues(cls),isForce=void 0!==force;return classes.length?this.each(:this},Cash.prototype.addClass=function(cls){return this.toggleClass(cls,!0)},Cash.prototype.removeClass=cash.unique=unique,Cash.prototype.add=var cssVariableRe=/^--/,prefixedProps={},style=div.style,vendorsPrefixes=["webkit","moz","ms","o"];cash.prefixedProp=getPrefixedProp;var numericProps={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};Cash.prototype.css=css;var dataAttributeRe=/^data-(.+)/;Cash.prototype.data=data,each(["Width","Height"],function(i,prop){Cash.prototype["inner"+prop]=function(){return this[0]?isWindow(this[0])?win["inner"+prop]:this[0]["client"+prop]:void 0}}),each(["width","height"],function(index,prop){Cash.prototype[prop]=function(value){if(!this[0])return void 0===value?void 0:this;if(!arguments.length)return isWindow(this[0])?this[0][camelCase("inner-"+prop)]:9===this[0].nodeType?(doc=this[0].documentElement,Math.max(this[0].body[camelCase("scroll-"+prop)],doc[camelCase("scroll-"+prop)],this[0].body[camelCase("offset-"+prop)],doc[camelCase("offset-"+prop)],doc[camelCase("client-"+prop)])):this[0].getBoundingClientRect()[prop]-getExtraSpace(this[0],!index);var valueNumber=parseInt(value,10);return this.each(}}),each(["Width","Height"],function(index,prop){Cash.prototype["outer"+prop]=function(includeMargins){return this[0]?isWindow(this[0])?win["outer"+prop]:this[0]["offset"+prop]+(includeMargins?computeStyleInt(this[0],"margin"+(index?"Top":"Left"))+computeStyleInt(this[0],"margin"+(index?"Bottom":"Right")):0):void 0}});var defaultDisplay={};Cash.prototype.toggle=function(force){return this.each(function(i,ele){var show=void 0!==force?force:isHidden(ele);show?(ele.style.display="",isHidden(ele)&&(ele.style.display=getDefaultDisplay(ele.tagName))):ele.style.display="none"})},Cash.prototype.hide=function(){return this.toggle(!1)},Cash.prototype.show=var eventsNamespace="__cashEvents",eventsNamespacesSeparator=".",eventsFocus={focus:"focusin",blur:"focusout"},eventsHover={mouseenter:"mouseover",mouseleave:"mouseout"},eventsMouseRe=/^(?:mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;Cash.prototype.off=function(eventFullName,selector,callback){var _this=this;return void 0===eventFullName?this.each(:(isFunction(selector)&&(callback=selector,selector=""),each(getSplitValues(eventFullName),function(i,eventFullName){var _a=parseEventName(getEventNameBubbling(eventFullName)),name=_a[0],namespaces=_a[1];_this.each(})),this},Cash.prototype.on=on,Cash.prototype.one=one,Cash.prototype.ready=function(callback){var finalCallback=function finalCallback(){return callback(cash)};return"loading"!==doc.readyState?setTimeout(finalCallback):doc.addEventListener("DOMContentLoaded",finalCallback),this},Cash.prototype.trigger=function(eventFullName,data){var evt;if(isString(eventFullName)){var _a=parseEventName(eventFullName),name_1=_a[0],namespaces=_a[1],type=eventsMouseRe.test(name_1)?"MouseEvents":"HTMLEvents";evt=doc.createEvent(type),evt.initEvent(name_1,!0,!0),evt.namespace=namespaces.join(eventsNamespacesSeparator)}else evt=eventFullName;evt.data=data;var isEventFocus=evt.type in eventsFocus;return this.each(};var queryEncodeSpaceRe=/%20/g,skippableRe=/file|reset|submit|button|image/i,checkableRe=/radio|checkbox/i;Cash.prototype.serialize=function(){var query="";return this.each(function(i,ele){each(ele.elements||[ele],function(i,ele){if(!(ele.disabled||!ele.name||"FIELDSET"===ele.tagName||skippableRe.test(ele.type)||checkableRe.test(ele.type)&&!ele.checked)){var value=getValue(ele);if(void 0!==value){var values=isArray(value)?value:[value];each(values,}}})}),query.substr(1)},Cash.prototype.val=val,Cash.prototype.clone=Cash.prototype.detach=var fragmentRe=/^\s*<(\w+)[^>]*>/,singleTagRe=/^\s*<(\w+)\s*\/?>(?:<\/\1>)?\s*$/,containers;cash.parseHTML=parseHTML,Cash.prototype.empty=Cash.prototype.html=html,Cash.prototype.remove=Cash.prototype.text=text,Cash.prototype.unwrap=function(){return this.parent().each(,this};var docEle=doc.documentElement;Cash.prototype.offset=function(){var ele=this[0];if(ele){var rect=ele.getBoundingClientRect();return{top:rect.top+win.pageYOffset-docEle.clientTop,left:rect.left+win.pageXOffset-docEle.clientLeft}}},Cash.prototype.offsetParent=Cash.prototype.position=Cash.prototype.children=function(comparator){var result=[];return this.each(,filtered(cash(unique(result)),comparator)},Cash.prototype.contents=function(){var result=[];return this.each(function(i,ele){push.apply(result,"IFRAME"===ele.tagName?[ele.contentDocument]:ele.childNodes)}),cash(unique(result))},Cash.prototype.find=function(selector){for(var result=[],i=0,l=this.length;l>i;i++){var found=find(selector,this[i]);found.length&&push.apply(result,found)}return cash(unique(result))};var scriptTypeRe=/^$|^module$|\/(?:java|ecma)script/i,HTMLCDATARe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;Cash.prototype.append=Cash.prototype.appendTo=Cash.prototype.insertAfter=Cash.prototype.after=Cash.prototype.insertBefore=Cash.prototype.before=Cash.prototype.prepend=Cash.prototype.prependTo=function(selector){return insertContent(cash(selector),reverse.apply(this.slice()),!0),this},Cash.prototype.replaceWith=Cash.prototype.replaceAll=Cash.prototype.wrapAll=function(selector){if(this[0]){var structure=cash(selector);this.first().before(structure);for(var wrapper=structure[0];wrapper.children.length;)wrapper=wrapper.firstElementChild;this.appendTo(wrapper)}return this},Cash.prototype.wrap=Cash.prototype.wrapInner=Cash.prototype.has=function(selector){var comparator=isString(selector)?return this.filter(comparator)},Cash.prototype.is=function(comparator){if(!comparator||!this[0])return!1;var compare=getCompareFunction(comparator),check=!1;return this.each(,check},Cash.prototype.next=function(comparator,_all){return filtered(cash(unique(pluck(this,"nextElementSibling",_all))),comparator)},Cash.prototype.nextAll=function(comparator){return this.next(comparator,!0)},Cash.prototype.not=function(comparator){if(!comparator||!this[0])return this;var compare=getCompareFunction(comparator);return this.filter(},Cash.prototype.parent=Cash.prototype.index=Cash.prototype.closest=function(comparator){if(!comparator||!this[0])return cash();var filtered=this.filter(comparator);return filtered.length?filtered:this.parent().closest(comparator)},Cash.prototype.parents=Cash.prototype.prev=Cash.prototype.prevAll=Cash.prototype.siblings=function(comparator){var result=[];return this.each(function(i,ele){push.apply(result,cash(ele).parent().children(function(ci,child){return child!==ele}))}),filtered(cash(unique(result)),comparator)},Cash.prototype.siblings=function(comparator){var result=[];return this.each(function(i,ele){push.apply(result,cash(ele).parent().children()}),filtered(cash(unique(result)),comparator)},Cash.prototype.isVisible=function(){var results=[];return this.is(function(idx,elem){(elem.offsetWidth>0||elem.offsetHeight>0)&&results.push(elem)}),results};var localDataStorage={};Cash.prototype.setLocalData=Cash.prototype.getLocalData=var ajaxOpts={success:noop,error:noop,complete:noop,type:"GET",async:!0},uid=Date.now();cash.guid=cash.ajax=function(url,options){if(1===arguments.length&&(options=url,url=options.url),!url)return!1;options=cash.extend({},ajaxOpts,options);var request,queryData,callbackName;if("jsonp"===options.dataType||"script"===options.dataType){request=window.document.createElement("script"),callbackName=cash.guid(),options.data.callback=callbackName,window[callbackName]=request.onload=request.onerror=function(e){e&&"error"===e.type&&options.error.call(this,request),options.complete.call(options.context?options.context:this,request),request.remove()},queryData="?";for(var key in options.data)queryData+=encodeURIComponent(key)+"="+encodeURIComponent(options.data[key])+"&";request.src=url+queryData,document.head.appendChild(request)}else request=new XMLHttpRequest,request.open(options.type,url,options.async),request.setRequestHeader("X-Requested-With","XMLHttpRequest"),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.onload=request.onerror=function(){var text=request.statusText;if(request.status>=200&&400>request.status){var response=request.responseText;"json"===options.dataType&&(response=JSON.parse(response)),options.success.call(options.context?options.context:this,response,text,request)}else options.error.call(options.context?options.context:this,request,text);options.complete.call(options.context?options.context:this,request,text)},options.data&&(queryData=cash.isString(options.data)?options.data:cash.param(options.data)),request.send(queryData);return request},cash.param=function(a){var prefix,r20=/%20/g,s=[],add=if(cash.isArray(a)||!cash.isPlainObject(a))cash.each(a,;else for(prefix in a)buildParams(prefix,a[prefix],add);return s.join("&").replace(r20,"+")},Contextly=Contextly||{},Contextly.DOM=cash,window.ContextlyDOM=Contextly.DOM}(),Contextly.ProxyEach=Contextly.createClass({extend:Contextly.Proxy,each:function(collection,func){return Contextly.Utils.each(collection,this.proxy(func,!0,!0))},eachElement:function(elements,func){return this.each(elements,}}),Contextly.Browser=Contextly.createClass({statics:{construct:function(){this.features={svg:},hasFeature:hasSvg:function(){return this.hasFeature("svg")},isMobile:getReferrer:function(){return document.referrer}}}),function(){Contextly.client=Contextly.client||{},Contextly.client.Base=Contextly.createClass({call:Contextly.abstractMethod()})}(),function(){Contextly.client.Session=Contextly.createClass({hasId:getId:function(){return this.id},setId:function(id){this.id=id}})}(),function(){Contextly.client.BaseRest=Contextly.createClass({extend:[Contextly.client.Base,Contextly.Proxy],construct:function(session,metadataProvider){this.session=session,this.metadataProvider=metadataProvider},getDestroyableProperties:getCommonParams:function(){var s=Contextly.Settings,m=this.metadataProvider,params={version:s.getKitVersion(),admin:s.isAdmin(),site_path:m.getAppId(),page_id:m.getPageId(),type:m.getPostType(),type_term:m.getPageTypeTerm(),c_date:m.getPostCreatedDate(),m_date:m.getPostModifiedDate(),c_count:m.getPostCategoriesCount(),t_count:m.getPostTagsCount(),url:m.getPageUrl(),current_url:document.location.href,referrer:Contextly.Browser.getReferrer(),mobile:Contextly.Browser.isMobile()};this.session.hasId()&&(params.guid=this.session.getId());var clientInfo=s.getClientInfo();return null!=clientInfo&&null!=clientInfo.client&&(params.client=clientInfo.client,null!=clientInfo.version&&(params.client+=":"+clientInfo.version)),params},getApiSession:function(){return this.session},call:function(apiName,apiMethod,params,callback){var url=this.getApiUrl()+apiName+"/"+apiMethod+"/";params=Contextly.Utils.merge(this.getCommonParams(),params);var request=new Contextly.CorsRequest({url:url,method:"POST",params:Contextly.DOM.param(params),success:this.proxy(function(response){if(null!=callback&&response)try{response=JSON.parse(response),callback(response)}catch(e){Contextly.Utils.logError("Unable to parse/handle API response",response,e)}},!1,!0)});request.send()},getApiUrl:Contextly.abstractMethod()})}(),function(){Contextly.client.Rest=Contextly.createClass({extend:Contextly.client.BaseRest,getApiUrl:function(){return Contextly.Settings.getAPIServerUrl()}}),Contextly.client.Rest.errors={FORBIDDEN:403,SUSPENDED:408}}(),function(){Contextly.client.MainServer=Contextly.createClass({extend:Contextly.client.Base,call:function(url){var request=new Contextly.CorsRequest({url:url.replace("http://","https://"),method:"POST",success:function(){}});request.send()}})}(),function(){Contextly.client.Experience=Contextly.createClass({extend:Contextly.client.BaseRest,getApiUrl:getCommonParams:function(){var params=Contextly.client.BaseRest.fn.getCommonParams.apply(this,arguments);return params=Contextly.Utils.merge({cookie_id:Contextly.Visitor.getId()},params)}})}(),function(){Contextly.EventsLogger=Contextly.createClass({construct:function(experienceClient){this.experienceClient=experienceClient},getDestroyableProperties:logEvent:function(name,params){this.sendEvent(Contextly.EventsLogger.eventTypes.LOG,name,params)},emailEvent:function(name,message,params){params=params||{},params.event_page=window.location.href,null!=message&&(params.event_message=JSON.stringify(message)),this.sendEvent(Contextly.EventsLogger.eventTypes.EMAIL,name,params)},tweetEvent:sendEvent:function(type,name,params){params=Contextly.Utils.merge({event_type:type,event_name:name,referrer:Contextly.Browser.getReferrer(),mobile:Contextly.Browser.isMobile()},params),this.experienceClient.call("events","put",params)}}),Contextly.EventsLogger.eventTypes={EMAIL:"email",LOG:"log",TWEET:"tweet"}}(),function($){Contextly.overlay=Contextly.overlay||{},Contextly.overlay.Base=Contextly.createClass({extend:[Contextly.ProxyEach.prototype,Contextly.Transmitter.prototype],statics:{init:function(){if(!this.initialized){this.initialized=!0;var map={window:window,document:window.document,html:"html",body:"body"};for(var key in map)this[key]=$(map[key]);this.animating=0}},ns:function(eventType){return eventType+".contextlyOverlay"},open:function(element,options){this.init(),this.animating||this.startOpening(element,options)},startOpening:function(element,options){this.setOptions(options),this.lockBodyScroll(),this.renderOverlay(),this.renderDialog(element),this.refreshDialogSizes(),this.broadcast(Contextly.overlay.broadcastTypes.BEFORE_OPEN),this.animateOpening()},renderOverlay:function(){return this.overlay?(this.overlay.show(),void 0):(this.overlay=$('<div class="ctx-overlay" />').appendTo("body"),!0)},renderDialog:Contextly.abstractMethod(),getAnimatedElements:function(markAsAnimating){var elements=this.overlay.add(this.dialog);return markAsAnimating&&(this.animating=elements.length),elements},animateOpening:function(){var self=this;this.getAnimatedElements(!0).each(function(){$(this).show(),self.onOpeningAnimationComplete()})},onAnimationComplete:function(){return this.animating--,0>this.animating&&(this.animating=0),!this.animating},onOpeningAnimationComplete:function(){this.onAnimationComplete()&&this.completeOpening()},completeOpening:function(){this.bindHandlers(),this.broadcast(Contextly.overlay.broadcastTypes.AFTER_OPEN)},bindHandlers:function(){this.window.on(this.ns("resize"),this.proxy(this.onWindowResize)),this.options.closeOnEsc&&this.window.on(this.ns("keyup"),this.proxy(this.onKeyUp,!1,!0)),this.options.closeOnOverlayClick&&this.overlay.on(this.ns("click"),this.proxy(this.close))},close:function(){this.animating||Contextly.Utils.isFunction(this.options.onClose)&&this.options.onClose()===!1||this.startClosing()},startClosing:function(){this.broadcast(Contextly.overlay.broadcastTypes.BEFORE_CLOSE),this.unbindHandlers(),this.animateClosing()},unbindHandlers:function(){this.window.off(this.ns("resize")).off(this.ns("keypress")),this.overlay.off(this.ns("click"))},animateClosing:function(){var self=this;this.getAnimatedElements(!0).each(},onClosingAnimationComplete:completeClosing:function(){this.destroyDialog(),this.destroyOverlay(),this.unlockBodyScroll(),this.broadcast(Contextly.overlay.broadcastTypes.AFTER_CLOSE)},destroyDialog:Contextly.abstractMethod(),destroyOverlay:onKeyUp:onWindowResize:setOptions:function(options){if(options){for(var sizes=["width","height"],i=0;sizes.length>i;i++){var size=sizes[i],type=typeof options[size];"undefined"===type||"number"!==type&&"string"!==type||(options[size]={value:options[size],min:0,max:0})}this.options=options.extend?$.extend(this.options,options):$.extend(this.getDefaultOptions(),options)}else this.options=this.getDefaultOptions()},getDefaultOptions:function(){return{spacing:40,duration:200,width:{value:"auto",min:0,max:0},height:{value:"auto",min:0,max:0},closeOnEsc:!0,closeOnOverlayClick:!0,extend:!1,onClose:null,dataKey:"contextlyOverlay"}},broadcast:function(type){return Contextly.Transmitter.prototype.broadcast.call(this,type,this)},setDialogDimension:setDialogPosition:function(coordinate,windowSize,dialogSize){var dialogPosition=Math.floor((windowSize-dialogSize)/2);this.dialog.css(coordinate,dialogPosition)},refreshDialogSize:function(dimension,coordinate,options){var dialogSize,windowSize=this.window[dimension]();switch(options.value){case"window":dialogSize=windowSize-2*this.options.spacing,dialogSize=this.applyDialogSizeLimits(dialogSize,options),this.setDialogDimension(dimension,dialogSize),this.setDialogPosition(coordinate,windowSize,dialogSize);break;case"auto":var map={width:"outerWidth",height:"outerHeight"},dimensionFunc=map[dimension];dialogSize=this.dialog[dimensionFunc](),this.setDialogPosition(coordinate,windowSize,dialogSize);break;default:"number"!=typeof options.value&&Contextly.Utils.logError("Unsupported overlay "+dimension+" value: "+options.value),dialogSize=options.value,this.setDialogDimension(dimension,dialogSize),this.setDialogPosition(coordinate,windowSize,dialogSize)}},refreshDialogSizes:function(){var dimensions={width:"left",height:"top"};for(var dimension in dimensions){var coordinate=dimensions[dimension],sideOptions=this.options[dimension];this.refreshDialogSize(dimension,coordinate,sideOptions)}},applyDialogSizeLimits:function(value,limits){return limits.min&&limits.min>value?value=limits.min:limits.max&&value>limits.max&&(value=limits.max),value},lockBodyScroll:function(){var doc=document.documentElement,data={scroll:{top:(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),left:(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0)},style:this.body.attr("style")},css={position:"fixed",top:-data.scroll.top,left:-data.scroll.left,width:"100%"};this.document.height()>this.window.height()&&(css["overflow-y"]="scroll"),this.body.data(this.options.dataKey,data).css(css)},unlockBodyScroll:function(){var data=this.body.data(this.options.dataKey);data&&(this.body.attr("style",data.style||" "),window.scrollTo(data.scroll.left,data.scroll.top))},displayFooterText:function(){var $footer_text=this.dialog.find(".ctx-popup-footer-text");$footer_text.length&&(this.options.settings.popup_footer?$footer_text.html(this.options.settings.popup_footer):$footer_text.remove())},appendSubscriptionControls:function(){var settings=this.options.settings;if(settings.subscription_controls&&settings.subscription_controls.length){var $controls_container=this.dialog.find(".ctx-subscription-controls-row"),self=this;this.each(settings.subscription_controls,}},appendControlRow:function($container,params){params.type&&"checkbox"==params.type&&$container.append(this.createCheckboxRow($container,params))},createCheckboxRow:function($container,params){var control_id="ctx-"+params.name+"-control",$control=$("<input>").attr("id",control_id).attr("type","checkbox").attr("name",params.name);params.checked&&$control.attr("checked","checked");var $control_label=$("<label>").attr("for",control_id).html(params.label),$new_row=$("<div>").addClass("ctx-input-row");return $new_row.append($control).append($control_label),$new_row}}}),Contextly.overlay.broadcastTypes={BEFORE_OPEN:"contextlyOverlayBeforeOpen",AFTER_OPEN:"contextlyOverlayAfterOpen",BEFORE_CLOSE:"contextlyOverlayBeforeClose",AFTER_CLOSE:"contextlyOverlayAfterClose"}}(Contextly.DOM),function($){Contextly.overlay.Dynamic=Contextly.createClass({extend:Contextly.overlay.Base,statics:{getDialogHtml:Contextly.abstractMethod(),renderDialog:function(data){if(this.dialog)this.dialog.show();else{var html=this.getDialogHtml();this.dialog=$(html).appendTo("body")}this.renderContent(data)},destroyDialog:renderContent:Contextly.abstractMethod(),destroyContent:Contextly.abstractMethod()}})}(Contextly.DOM),Contextly.color=Contextly.color||{},Contextly.color.RGB=Contextly.createClass({construct:function(){if(1===arguments.length){var matches,input=arguments[0];(matches=input.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/))?(this.red=parseInt(matches[1],16),this.green=parseInt(matches[2],16),this.blue=parseInt(matches[3],16)):(matches=input.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/))?(this.red=parseInt(matches[1]+matches[1],16),this.green=parseInt(matches[2]+matches[2],16),this.blue=parseInt(matches[3]+matches[3],16)):Contextly.Utils.error("Unable to parse color "+input)}else 3===arguments.length?(this.red=arguments[0],this.green=arguments[1],this.blue=arguments[2]):Contextly.Utils.error("Wrong number of arguments passed to the RGB color constructor.")},toHSV:function(){var red=this.red/255,green=this.green/255,blue=this.blue/255,min=Math.min(red,green,blue),max=Math.max(red,green,blue),value=max,delta=max-min;if(0==delta)return new Contextly.color.HSV(0,0,100*value);var hue,saturation=0;return 0==max?(saturation=0,hue=-1,new Contextly.color.HSV(hue,saturation,value)):(saturation=delta/max,hue=red==max?(green-blue)/delta:green==max?2+(blue-red)/delta:4+(red-green)/delta,hue*=60,0>hue&&(hue+=360),new Contextly.color.HSV(hue,100*saturation,100*value))},toString:function(){for(var output="#",pad="00",colors=[this.red,this.green,this.blue],i=0;colors.length>i;i++){var color=Math.round(colors[i]);color=color.toString(16),color=pad.substr(0,pad.length-color.length)+color,output+=color}return output}}),Contextly.color.HSV=Contextly.createClass({construct:brightness:function(updates){var v=this.v,min=updates.min||0,max=updates.max||100;return updates.delta!==void 0&&(v=Math.max(Math.min(v+updates.delta,max),min)),new Contextly.color.HSV(this.h,this.s,v)},toRGB:function(){var R,G,B,h=this.h/360,s=this.s/100,v=this.v/100;if(0==s)R=255*v,G=255*v,B=255*v;else{var var_h=6*h;6==var_h&&(var_h=0);var var_r,var_g,var_b,var_i=Math.floor(var_h),var_1=v*(1-s),var_2=v*(1-s*(var_h-var_i)),var_3=v*(1-s*(1-(var_h-var_i)));0==var_i?(var_r=v,var_g=var_3,var_b=var_1):1==var_i?(var_r=var_2,var_g=v,var_b=var_1):2==var_i?(var_r=var_1,var_g=v,var_b=var_3):3==var_i?(var_r=var_1,var_g=var_2,var_b=v):4==var_i?(var_r=var_3,var_g=var_1,var_b=v):(var_r=v,var_g=var_1,var_b=var_2),R=255*var_r,G=255*var_g,B=255*var_b}return new Contextly.color.RGB(R,G,B)}}),function($){Contextly.FontManager=Contextly.createClass({extend:[Contextly.ProxyEach.prototype,Contextly.Transmitter.prototype],statics:{construct:function(){this.left=0,this.fonts={},this.callbacks=[],this.fallbackWidths={},this.scheduled=[]},getContainerStyle:function(fonts){var style="position: absolute !important; white-space: nowrap !important; font-size: 128px !important; width: auto !important; top: -9999px !important; left: 0 !important;";if(fonts&&fonts.length){for(var cssFonts=[],i=0;fonts.length>i;i++)cssFonts.push('"'+fonts[i].replace(/[^a-z0-9\-\_\ ]/gi,"")+'"');style+=" font-family: "+cssFonts.join(",")+" !important"}else style+=" display: none !important";return style},getContainer:function(){return this.container===void 0&&(this.container=$("<div/>").attr("style",this.getContainerStyle()).text(Array(40).join("wmkgil")).appendTo("body")),this.container},getFontWidth:function(font,fallback){var fonts=[font];fallback&&fonts.push(fallback);var container=this.getContainer().attr("style",this.getContainerStyle(fonts)),width=container.width();return container.attr("style",this.getContainerStyle()),width},getFallbackFonts:fontExists:function(font){for(var fallbacks=this.getFallbackFonts(),i=0;fallbacks.length>i;i++){var fallback=fallbacks[i];if(this.fallbackWidths[fallback]===void 0&&(this.fallbackWidths[fallback]=this.getFontWidth(fallback)),this.getFontWidth(font,fallback)!==this.fallbackWidths[fallback])return!0}return!1},onFontFailed:function(font){this.left--,this.fonts[font]=this.fontStates.FAILED,this.broadcast(this.broadcastTypes.FONT_FAILED,font),this.onLoadingComplete()},onFontLoaded:function(font){this.left--,this.fonts[font]=this.fontStates.LOADED,this.broadcast(this.broadcastTypes.FONT_LOADED,font),this.onLoadingComplete()},onLoadingComplete:function(){this.left>0||(this.each(this.callbacks,function(item){var fonts=item.fonts,callback=item.callback,states={};this.each(fonts,;try{callback(states)}catch(e){Contextly.Utils.logError("FontLoader callback failed.",item,e)}}),this.broadcast(this.broadcastTypes.LOADED))},scheduleLoading:function(s){var isScheduled=!!this.scheduled.length;if(this.scheduled.push(s),!isScheduled)if(window.WebFont)setTimeout(this.proxy(this.loadScheduled),0);else if(window.WebFontConfig){if(window.WebFontConfig.events===!1)return Contexyly.Utils.logError("Unable to load fonts required for the Contextly module because events are disabled on the WebFontConfig."),void 0;var originalCallback=window.WebFontConfig.loading,ourCallback=this.proxy(this.loadScheduled);window.WebFontConfig.loading=function(){return setTimeout(ourCallback,0),originalCallback?originalCallback.apply(this,arguments):void 0}}else Contexyly.Utils.logError("Unable to load fonts required for the Contextly module because of missing WebFontLoader.")},loadScheduled:function(){for(;this.scheduled.length;){var s=this.scheduled.shift();this.startLoading(s)}},startLoading:function(s){0==this.left&&this.broadcast(this.broadcastTypes.LOADING),this.left+=s.fonts.length;for(var i=0;s.fonts.length>i;i++){var font=s.fonts[i];this.fonts[font]=this.fontStates.LOADING,this.broadcast(this.broadcastTypes.FONT_LOADING,font)}var config={classes:!1,fontactive:this.proxy(this.onFontLoaded,!1,!0),fontinactive:this.proxy(this.onFontFailed,!1,!0)};config[s.provider]=$.extend({},s.options,{families:s.fonts}),WebFont.load(config)},load:function(specs){var s=$.extend({provider:"google",fonts:[],callback:null,options:{}},specs);"function"==typeof s.callback&&this.callbacks.push({fonts:s.fonts,callback:s.callback});for(var load=[],i=0;s.fonts.length>i;i++){var font=s.fonts[i];void 0===this.fonts[font]&&(this.fontExists(font)?this.fonts[font]=this.fontStates.EXISTS:load.push(font))}load.length?(s.fonts=load,this.scheduleLoading(s)):this.onLoadingComplete()}}}),Contextly.FontManager.fontStates={LOADING:"loading",LOADED:"loaded",EXISTS:"exists",FAILED:"failed"},Contextly.FontManager.broadcastTypes={LOADING:"contextlyFontsLoading",LOADED:"contextlyFontsLoaded",FONT_LOADING:"contextlyFontLoading",FONT_LOADED:"contextlyFontLoaded",FONT_FAILED:"contextlyFontFailed"}}(Contextly.DOM),Contextly.Cookie=Contextly.createClass({statics:{encode:function(s){return encodeURIComponent(s)},decode:stringifyCookieValue:parseCookieValue:function(s){var pluses=/\+/g;0===s.indexOf('"')&&(s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{s=decodeURIComponent(s.replace(pluses," "))}catch(e){return}try{return JSON.parse(s)}catch(e){}},read:get:function(key){for(var result=key?void 0:{},cookies=document.cookie?document.cookie.split("; "):[],i=0,l=cookies.length;l>i;i++){var parts=cookies[i].split("="),name=this.decode(parts.shift()),cookie=parts.join("=");if(key&&key===name){result=this.read(cookie);break}key||void 0===(cookie=this.read(cookie))||(result[name]=cookie)}return result},set:function(key,value,options){if(void 0!==value&&"function"!=typeof value){if(options=Contextly.DOM.extend({},options),"number"==typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[this.encode(key),"=",this.stringifyCookieValue(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}}}}),Contextly.Visitor=Contextly.createClass({statics:{getCookieName:function(){return"contextly"},initIds:function(response){response&&response.cookie_id&&!this.getId()&&this.setId(response.cookie_id)},setId:function(cookie_id){Contextly.Cookie.set(this.getCookieName(),{id:cookie_id},{expires:365,path:"/"})},getId:function(){var cookie=Contextly.Cookie.get(this.getCookieName());return cookie&&cookie.id&&"null"!=cookie.id?cookie.id:null}}}),function($){Contextly.Receiver=Contextly.createClass({receive:function(type,callback){Contextly.Utils.isFunction(this.ns)&&(type=this.ns(type)),$(window).on(type,callback)},ignore:function(type,callback){Contextly.Utils.isFunction(this.ns)&&(type=this.ns(type)),$(window).off(type,callback)}})}(Contextly.DOM),function(){Contextly.metadataParser=Contextly.metadataParser||{},Contextly.metadataFormats=Contextly.metadataFormats||[],Contextly.metadataParser.Base=Contextly.createClass({dataExists:Contextly.abstractMethod(),getData:Contextly.abstractMethod(),getCount:function(key){var data=this.getData(key);return Contextly.Utils.isArray(data)&&data.length?data.length:0}})}(),function(){Contextly.metadataParser.BaseSingleTag=Contextly.createClass({extend:Contextly.metadataParser.Base,findSource:Contextly.abstractMethod(),parseSource:Contextly.abstractMethod(),getSource:function(){return this.source===void 0&&(this.source=this.findSource()),this.source},dataExists:getData:function(key){return this.data===void 0&&(this.data=this.parseSource()),this.data[key]},parseJson:function(text,fallback){if(text)try{return JSON.parse(text)}catch(e){Contextly.Utils.logError("Unable to parse metadata",e)}return fallback}})}(),function(){Contextly.metadataParser.BaseMultiTag=Contextly.createClass({extend:Contextly.metadataParser.Base,getTags:Contextly.abstractMethod(),getTagValue:Contextly.abstractMethod(),construct:dataExists:function(){for(var req=["url","title"],i=0;req.length>i;i++)if(this.getData(req[i])===void 0)return!1;return!0},getSourceValue:function(sourceKey){var tags=this.getTags(sourceKey);if(tags&&tags.length){if(tags&&1==tags.length)return this.getTagValue(sourceKey,tags[0]);for(var result=[],i=0;tags.length>i;i++){var tagValue=this.getTagValue(sourceKey,tags[i]);null!=tagValue&&result.push(tagValue)}return result.length?result:void 0}},getValue:function(key){if(this.propertiesMap[key])for(var i=0;this.propertiesMap[key].length>i;i++){var src=this.propertiesMap[key][i],candidate=this.getSourceValue(src);if(candidate=this.convert(src,candidate),null!=candidate)return candidate}},getData:function(key){if(!this.parsed[key]){this.parsed[key]=!0;var value=this.getValue(key);null!=value&&(this.data[key]=value)}return this.data[key]}})}(),function(){Contextly.metadataParser.ForeignHelper=Contextly.createClass({construct:getConverters:function(){return{}},getPropertiesMap:function(){return{}},map:function(key,raw,fallback){if(this.propertiesMap[key]!==void 0)for(var i=0;this.propertiesMap[key].length>i;i++){var src=this.propertiesMap[key][i],value=this.convert(src,raw[src]);if(value!==void 0)return value}return fallback},mapAll:function(raw,fallback){var data={};for(var key in this.propertiesMap){var value=this.map(key,raw,fallback);value!==void 0&&(data[key]=value)}return data},convert:function(key,value){return null!=value?null==this.converters[key]?value:this.converters[key](value):void 0},convertToArray:convertToCommaSeparated:function(value){return Contextly.Utils.isArray(value)?value.length?value.join(", "):void 0:value},convertDateIso8601:function(value){var parts=value.match(/^([\d\-]+)(?:T([\d:]+))?/);if(parts){var parsedDate=parts[1].match(/^(\d+)\-(\d+)\-(\d+)$/)||parts[1].match(/^(\d{4})(\d{2})(\d{2})$/);if(parsedDate){var result=parsedDate[1]+"-"+parsedDate[2]+"-"+parsedDate[3],parsedTime=[];parts[2]&&(parsedTime=parts[2].match(/^(\d{2})(?::(\d{2}))?(?::(\d{2}))?$/)||parts[2].match(/^(\d{2})(\d{2})?(\d{2})?$/)||[]);var defaultTime=[null,"12","00","00"];return result+=" "+(parsedTime[1]||defaultTime[1])+":"+(parsedTime[2]||defaultTime[2])+":"+(parsedTime[3]||defaultTime[3])}}},convertSplitByComma:function(value){return Contextly.Utils.isArray(value)?value.length?value:void 0:value.split(/\s*,\s*/)},convertUrlToAbsolute:function(value){if(value){var a=document.createElement("a");return a.href=value,a=a.cloneNode(!1),a.href}}})}(),function(){Contextly.metadataParser.Default=Contextly.createClass({extend:Contextly.metadataParser.BaseSingleTag,findSource:function(){var meta=document.querySelectorAll('meta[name="contextly-page"][content]')[0];return meta?meta.getAttribute("content"):void 0},parseSource:function(){return this.parseJson(this.getSource(),{})}})}(),function(){Contextly.metadataParser.DublinCore=Contextly.createClass({extend:[Contextly.metadataParser.BaseMultiTag,Contextly.metadataParser.ForeignHelper],getPropertiesMap:getConverters:getTags:function(sourceKey){return document.querySelectorAll('meta[name="'+sourceKey+'"][content]')},getTagValue:function(sourceKey,tag){return tag?tag.getAttribute("content"):void 0}}),Contextly.metadataFormats.push(Contextly.metadataParser.DublinCore)}(),function(){Contextly.metadataParser.JsonLd=Contextly.createClass({extend:[Contextly.metadataParser.BaseSingleTag,Contextly.metadataParser.ForeignHelper],getConverters:getPropertiesMap:function(){return{post_id:["articleId"],title:["headline","description"],author_name:["creator","founder"],image:["thumbnailUrl"],pub_date:["dateCreated"],categories:["articleSection"],tags:["keywords"],url:["url"]}},findSource:function(){for(var result=null,ldJsonItems=document.querySelectorAll('script[type="application/ld+json"]'),i=0,len=ldJsonItems.length;len>i;i++){var text=ldJsonItems[i].innerHTML;try{var raw=JSON.parse(text);if((null!=raw.headline||null!=raw.description)&&null!=raw.url)return result=raw,!1}catch(e){Contextly.Utils.error("Unable to parse JSON LD element.")}}return result},parseSource:),Contextly.metadataFormats.unshift(Contextly.metadataParser.JsonLd)}(),function(){Contextly.metadataParser.OpenGraph=Contextly.createClass({extend:[Contextly.metadataParser.BaseMultiTag,Contextly.metadataParser.ForeignHelper],getPropertiesMap:function(){return{title:["og:title"],image:["og:image"],mod_date:["article:modified_time"],pub_date:["article:published_time"],tags:["article:tag"],categories:["article:section"],url:["og:url"]}},getConverters:getTags:getTagValue:function(sourceKey,tag){return tag?tag.getAttribute("content"):void 0}}),Contextly.metadataFormats.push(Contextly.metadataParser.OpenGraph)}(),function(){Contextly.metadataParser.ParselyPage=Contextly.createClass({extend:[Contextly.metadataParser.BaseSingleTag,Contextly.metadataParser.ForeignHelper],getPropertiesMap:function(){return{post_id:["post_id"],type:["type"],title:["title"],image:["image_url"],tags:["tags"],url:["link"],author_name:["authors"],categories:["section"],pub_date:["pub_date"]}},getConverters:findSource:function(){var meta=document.querySelectorAll('meta[name="parsely-page"][content]')[0];return meta?meta.getAttribute("content"):void 0},parseSource:function(){var source=this.getSource(),raw=this.parseJson(source,{});return this.mapAll(raw)}}),Contextly.metadataFormats.unshift(Contextly.metadataParser.ParselyPage)}(),function(){Contextly.metadataParser.ParselyTags=Contextly.createClass({extend:[Contextly.metadataParser.BaseMultiTag,Contextly.metadataParser.ForeignHelper],getPropertiesMap:function(){return{post_id:["post-id"],type:["type"],title:["title"],author_name:["author"],image:["image-url"],pub_date:["pub-date"],categories:["section"],tags:["tags"],url:["link"]}},getConverters:function(){return{"pub-date":this.convertDateIso8601,section:this.convertToArray,tags:this.convertSplitByComma,"image-url":this.convertUrlToAbsolute,link:this.convertUrlToAbsolute}},getTags:getTagValue:function(sourceKey,tag){return tag?tag.getAttribute("content"):void 0}}),Contextly.metadataFormats.unshift(Contextly.metadataParser.ParselyTags)}(),Contextly.metadataProvider=Contextly.metadataProvider||{},Contextly.metadataProvider.Base=Contextly.createClass({getPostDataForKey:Contextly.abstractMethod(),getPostDataForKeyCount:Contextly.abstractMethod(),getAppId:function(){return Contextly.overrides.appId||this.getPostDataForKey("app_id")},getPageId:function(){return this.getPostDataForKey("post_id")},getPostModifiedDate:function(){return this.getPostDataForKey("mod_date")},getPostCreatedDate:function(){return this.getPostDataForKey("pub_date")},getAuthorId:function(){return this.getPostDataForKey("author_id")},getPageUrl:function(){return this.getPostDataForKey("url")},getPostType:function(){return this.getPostDataForKey("type")},getPageTypeTerm:function(){return this.getPostDataForKey("type_term")},getPostCategories:function(){return this.getPostDataForKey("categories")},getPostTags:function(){return this.getPostDataForKey("tags")},getPostCategoriesCount:function(){return this.getPostDataForKeyCount("categories")},getPostTagsCount:hasRequired:),Contextly.metadataProvider.Custom=Contextly.createClass({extend:Contextly.metadataProvider.Base,construct:function(metadata){this.metadata=Contextly.Utils.merge({tags:[],categories:[]},metadata)},getPostDataForKey:getPostDataForKeyCount:),Contextly.metadataProvider.Parsed=Contextly.createClass({extend:Contextly.metadataProvider.Base,getMetadataParser:function(){if(this.metadataParser===void 0&&(this.metadataParser=new Contextly.metadataParser.Default,!this.metadataParser.dataExists()))for(var formats=this.getSupportedMetadataFormats(),i=0;formats.length>i;i++){var candidate=new formats[i];if(candidate.dataExists()){this.metadataParser=candidate;break}}return this.metadataParser},getSupportedMetadataFormats:getPostDataForKey:function(key){return this.getMetadataParser().getData(key)},getPostDataForKeyCount:),function(){Contextly.client.DirectAPI=Contextly.createClass({getModules:function(params,callback){var session=new Contextly.client.Session,metaProvider=new Contextly.metadataProvider.Parsed,dataProvider=new Contextly.client.Experience(session,metaProvider);dataProvider.call("pagewidgets","get",params,function(response){if(Contextly.Visitor.initIds(response),null!=callback&&response)try{callback(response)}catch(e){Contextly.Utils.logError("Unable to parse/handle Direct API response",response,e)}})}})}(),Contextly.widget=Contextly.widget||{},Contextly.widget.types={SNIPPET:"snippet",SNIPPET_MOBILE:"main-mobile",SIDEBAR:"sidebar",AUTO_SIDEBAR:"auto-sidebar",STORYLINE_SUBSCRIBE:"storyline-subscribe",SIDERAIL:"side-rail",PERSONALIZATION_SUBSCRIBE:"personalization-subscribe",CHANNEL_SUBSCRIBE:"channel-subscribe",CHANNEL_SUBSCRIBE_FORM:"channel-subscribe-form",HOME_PERSONALIZED:"home-personalized",AUTHOR_FOLLOWUP_BUTTON_SUBSCRIBE:"author-followup-button",AUTHOR_FOLLOWUP_FORM_SUBSCRIBE:"author-followup-form",AUTHOR_FOLLOWUP:"author-followup"},Contextly.widget.styles={TEXT:"default",TABS:"tabs",BLOCKS:"blocks",BLOCKS2:"blocks2",FLOAT:"float",FLEX:"flex",FLEX2:"flex2",COMPACT:"compact",CINEMA:"cinema"},Contextly.widget.sideRailStyles={DEFAULT:"default",H_SQUARE:"h-square",H_LETTER:"h-letter"},Contextly.widget.sidebar={DEFAULT:"default",CINEMA:"cinema"},Contextly.widget.personalizedStyles={TEXT:"default",BLOCKS:"blocks",BLOCKS2:"blocks2",FLOAT:"float"},Contextly.widget.linkTypes={PREVIOUS:"previous",RECENT:"recent",WEB:"web",INTERESTING:"interesting",CUSTOM:"custom",PROMO:"sticky"},Contextly.widget.recommendationTypes={VIDEO:10,PRODUCT:9,COOKIE:8,EVERGREEN:7,OPTIMIZATION:6},Contextly.widget.broadcastTypes={DISPLAYED:"contextlyWidgetDisplayed",REMOVED:"contextlyWidgetRemoved",IN_VIEWPORT:"contextlyWidgetInViewport",LAYOUT_CHANGED:"contextlyWidgetLayoutChanged"},Contextly.widget.eventNames={MODULE_VIEW:"module_view",CAROUSEL_NAVIGATION:"carousel_navigation"},Contextly.widget.index=0,Contextly.widget.Factory=Contextly.createClass({construct:getContainerClass:function(type){switch(type){case Contextly.widget.types.SIDEBAR:return Contextly.widget.SidebarContainers;case Contextly.widget.types.AUTO_SIDEBAR:return Contextly.widget.AutoSidebarContainers;case Contextly.widget.types.STORYLINE_SUBSCRIBE:return Contextly.widget.StoryLineSubscribeContainers;case Contextly.widget.types.PERSONALIZATION_SUBSCRIBE:return Contextly.widget.PersonalizationSubscribeContainers;case Contextly.widget.types.CHANNEL_SUBSCRIBE:case Contextly.widget.types.CHANNEL_SUBSCRIBE_FORM:return Contextly.widget.ChannelSubscribeContainers;case Contextly.widget.types.SIDERAIL:return Contextly.widget.SiderailContainers;case Contextly.widget.types.HOME_PERSONALIZED:return Contextly.widget.HomePersonalizedContainers;case Contextly.widget.types.SNIPPET_MOBILE:return Contextly.widget.SnippetMobileContainers;case Contextly.widget.types.AUTHOR_FOLLOWUP_BUTTON_SUBSCRIBE:case Contextly.widget.types.AUTHOR_FOLLOWUP_FORM_SUBSCRIBE:case Contextly.widget.types.AUTHOR_FOLLOWUP:return Contextly.widget.AuthorFollowUpSubscribeContainers;default:return Contextly.widget.SnippetContainers}},getContainer:function(type,data){var containerClass=this.getContainerClass(type);return containerClass?new containerClass(this.$context,data):null},getWidgetClass:function(type,theme){switch(type){case Contextly.widget.types.SIDEBAR:switch(theme){case Contextly.widget.sidebar.CINEMA:return Contextly.widget.SidebarCinema;default:return Contextly.widget.Sidebar}case Contextly.widget.types.AUTO_SIDEBAR:switch(theme){case Contextly.widget.sidebar.CINEMA:return Contextly.widget.AutoSidebarCinema;default:return Contextly.widget.AutoSidebar}case Contextly.widget.types.STORYLINE_SUBSCRIBE:return Contextly.widget.StoryLineSubscribe;case Contextly.widget.types.PERSONALIZATION_SUBSCRIBE:return Contextly.widget.PersonalizationSubscribe;case Contextly.widget.types.CHANNEL_SUBSCRIBE:return Contextly.widget.ChannelSubscribe;case Contextly.widget.types.CHANNEL_SUBSCRIBE_FORM:return Contextly.widget.ChannelSubscribeForm;case Contextly.widget.types.SIDERAIL:switch(theme){case Contextly.widget.sideRailStyles.H_SQUARE:return Contextly.widget.SiderailHSquare;case Contextly.widget.sideRailStyles.H_LETTER:return Contextly.widget.SiderailHLetter;default:return Contextly.widget.Siderail}case Contextly.widget.types.HOME_PERSONALIZED:switch(theme){case Contextly.widget.personalizedStyles.BLOCKS:return Contextly.widget.HomePersonalizedBlocks;case Contextly.widget.personalizedStyles.BLOCKS2:return Contextly.widget.HomePersonalizedBlocks2;case Contextly.widget.personalizedStyles.FLOAT:return Contextly.widget.HomePersonalizedFloat}return Contextly.widget.HomePersonalizedDefault;case Contextly.widget.types.SNIPPET_MOBILE:switch(theme){case Contextly.widget.styles.TEXT:return Contextly.widget.TextMobileSnippet;case Contextly.widget.styles.BLOCKS:return Contextly.widget.BlocksMobileSnippet;case Contextly.widget.styles.BLOCKS2:return Contextly.widget.Blocks2MobileSnippet;case Contextly.widget.styles.FLOAT:return Contextly.widget.FloatMobileSnippet;case Contextly.widget.styles.FLEX:return Contextly.widget.FlexSnippet;case Contextly.widget.styles.COMPACT:return Contextly.widget.CompactSnippet;case Contextly.widget.styles.CINEMA:return Contextly.widget.CinemaSnippet;case Contextly.widget.styles.FLEX2:return Contextly.widget.Flex2Snippet}case Contextly.widget.types.AUTHOR_FOLLOWUP_BUTTON_SUBSCRIBE:return Contextly.widget.AuthorFollowUpButtonSubscribe;case Contextly.widget.types.AUTHOR_FOLLOWUP_FORM_SUBSCRIBE:return Contextly.widget.AuthorFollowUpFormSubscribe;default:switch(theme){case Contextly.widget.styles.TEXT:return Contextly.widget.TextSnippet;case Contextly.widget.styles.TABS:case Contextly.widget.styles.BLOCKS:return Contextly.widget.BlocksSnippet;case Contextly.widget.styles.BLOCKS2:return Contextly.widget.Blocks2Snippet;case Contextly.widget.styles.FLOAT:return Contextly.widget.FloatSnippet;case Contextly.widget.styles.FLEX:return Contextly.widget.FlexSnippet;case Contextly.widget.styles.FLEX2:return Contextly.widget.Flex2Snippet;case Contextly.widget.styles.CINEMA:return Contextly.widget.CinemaSnippet}}},getWidget:function(params){var required={data:!0,container:!0,eventsLogger:!0,experienceClient:!0,mainServerClient:!0};for(var key in required)null==params[key]&&Contextly.Utils.error("Required parameter "+key+" not found.");var data=params.data,widgetTheme=data.settings.display_type||data.settings.theme,widgetClass=this.getWidgetClass(data.type,widgetTheme,data);return widgetClass?new widgetClass(params):null}}),function($){Contextly.widget.AutoPlacement=Contextly.createClass({isAutoPlacementEnabled:function(){if(!this.hasData())return!1;var data=this.getData();return data.settings.auto_placement&&data.settings.auto_placement_enabled},hasBeenAutoPlaced:function(){return!!this.autoPlaced},getAutoPlacementDefaults:getAutoPlacementSettings:function(){return $.extend(this.getAutoPlacementDefaults(),this.getData().settings.auto_placement)},findArticleContainer:function(s){var sel={article:".ctx-article",hint:".ctx-article-root",custom:s.article},$context=this.getContext();if($context.is(sel.article))return $context;if(sel.custom){if($context.is(sel.custom))return $context;if($candidate=$context.find(sel.custom).first(),$candidate.length)return $candidate}var $candidate=$context.find(sel.article).first();if($candidate.length)return $candidate;var $hint=$context.find(sel.hint).first();return $hint.length?$hint.parent():null},autoPlaceElements:function(){this.autoPlaced=!0;var s=this.getAutoPlacementSettings(),sel={stop:s.stop,paragraph:s.paragraph||"p"},$article=this.findArticleContainer(s);if(!$article||!$article.length||$article.is(sel.stop))return null;sel.paragraph=sel.paragraph.replace(">"," ");var $paragraphs=$article.children(sel.paragraph).filter(function(){return!!Contextly.Utils.trim($(this).text())});if(!$paragraphs.length||$paragraphs.length<s.threshold)return null;var $target,index;if("start"===s.from?(index=Math.min($paragraphs.length-1,s.index-1),$target=$paragraphs.eq(index)):(index=Math.max($paragraphs.length-s.index,0),$target=$paragraphs.eq(index)),!$target.length)return null;var $container=$("<div />").attr({"class":this.getTypeClass()});return"before"===s.place?$target.before($container):$target.after($container),$container}})}(Contextly.DOM),function($){Contextly.widget.BaseContainers=Contextly.createClass({construct:getElements:findElements:function(){return $("."+this.getClass(),this.$context)},getTypeClass:Contextly.abstractMethod(),getClass:hasData:function(){return!!this.data},getData:function(){return this.hasData()||Contextly.Utils.error("Widget data is not set on the container."),this.data},getContext:getWidgetPackageName:function(){},getStylistPackageName:function(){},getThemePackageName:function(){}}),Contextly.widget.SnippetContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-module-container"},getThemePackageName:function(){}}),Contextly.widget.SnippetMobileContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-module-container"},getThemePackageName:function(){}}),Contextly.widget.SidebarContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-sidebar-container"},getClass:function(){return this.data&&null!=this.data.id?"ctx-sidebar-container--"+this.data.id:this.getTypeClass()},getThemePackageName:function(){},getElements:function(){var $elements=Contextly.widget.BaseContainers.fn.getElements.apply(this,arguments);if(!$elements.length&&this.data&&null!=this.data.id){var $old_style_sidebar=$("#contextly-"+this.data.id);$old_style_sidebar.length&&$old_style_sidebar.hasClass("ctx-sidebar-container")&&($elements=this.elements=$old_style_sidebar)}return $elements}}),Contextly.widget.AutoSidebarContainers=Contextly.createClass({extend:[Contextly.widget.BaseContainers,Contextly.widget.AutoPlacement],construct:function(){return this.autoPlaced=!1,Contextly.widget.BaseContainers.apply(this,arguments)},getTypeClass:function(){return"ctx-autosidebar-container"},getClass:function(){return this.data&&null!=this.data.id?"ctx-autosidebar-container--"+this.data.id:this.getTypeClass()},getThemePackageName:function(){},getElements:function(){var $elements=Contextly.widget.BaseContainers.fn.getElements.apply(this,arguments);if(!$elements.length&&this.isAutoPlacementEnabled()&&!this.hasBeenAutoPlaced()){var $autoplaced=this.autoPlaceElements();$autoplaced&&$autoplaced.length&&($elements=this.elements=$autoplaced)}return $elements},getAutoPlacementDefaults:function(){var defs=Contextly.widget.AutoPlacement.fn.getAutoPlacementDefaults.apply(this,arguments);return defs.stop=".ctx-no-autosidebar",defs}}),Contextly.widget.StoryLineSubscribeContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-subscribe-container"},getThemePackageName:function(){}}),Contextly.widget.PersonalizationSubscribeContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-personalization-container"},getThemePackageName:function(){}}),Contextly.widget.ChannelSubscribeContainers=Contextly.createClass({extend:[Contextly.widget.BaseContainers,Contextly.widget.AutoPlacement],getTypeClass:function(){return"ctx-channel-container"},getThemePackageName:function(){},getElements:function(){var $elements=Contextly.widget.BaseContainers.fn.getElements.apply(this,arguments);if(!$elements.length&&this.isAutoPlacementEnabled()&&!this.hasBeenAutoPlaced()){var $autoplaced=this.autoPlaceElements();$autoplaced&&$autoplaced.length&&($elements=this.elements=$autoplaced)}return $elements},getAutoPlacementDefaults:function(){var defs=Contextly.widget.AutoPlacement.fn.getAutoPlacementDefaults.apply(this,arguments);return defs.stop=".ctx-no-channel-subscribe",defs}}),Contextly.widget.AuthorFollowUpSubscribeContainers=Contextly.createClass({extend:[Contextly.widget.BaseContainers,Contextly.widget.AutoPlacement],getTypeClass:function(){return"ctx-author-container"},getThemePackageName:function(){},getElements:function(){var $elements=Contextly.widget.BaseContainers.fn.getElements.apply(this,arguments);if(!$elements.length&&this.isAutoPlacementEnabled()&&!this.hasBeenAutoPlaced()){var $autoplaced=this.autoPlaceElements();$autoplaced&&$autoplaced.length&&($elements=this.elements=$autoplaced)}return $elements},getAutoPlacementDefaults:function(){var defs=Contextly.widget.AutoPlacement.fn.getAutoPlacementDefaults.apply(this,arguments);return defs.stop=".ctx-no-author-followup-subscribe",defs}}),Contextly.widget.SiderailContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-siderail-container"},getThemePackageName:function(){}}),Contextly.widget.SocialContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-social-container"},getThemePackageName:function(){return"widgets/social/carousel"}}),Contextly.widget.HomePersonalizedContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-home-personalized-container"},getThemePackageName:)}(Contextly.DOM),function($){Contextly.widget.ViewWatcher=Contextly.createClass({extend:[Contextly.ProxyEach.prototype],statics:{construct:function(){this.widgets={},this.pollTimer=null,this.$window=$(window)},start:function(){this.isActive()||(this.pollTimer=setInterval(this.proxy(this.checkWidgetsVisibility),300))},stop:isActive:watch:function(widget){Contextly.Utils.isEmptyObject(this.widgets)&&this.start();var index=widget.getWidgetIndex();this.widgets[index]=widget},unwatch:function(widget){var index=widget.getWidgetIndex();delete this.widgets[index],Contextly.Utils.isEmptyObject(this.widgets)&&this.stop()},isWatched:function(widget){var index=widget.getWidgetIndex();return this.widgets[index]!==void 0},getViewport:function(){var doc=document.documentElement,viewport={top:(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),left:(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0)};return viewport.right=viewport.left+this.$window.width(),viewport.bottom=viewport.top+this.$window.height(),viewport},isElementInsideViewport:function(el,viewport){var bounds=el.offset();bounds.right=bounds.left+el.outerWidth(),bounds.bottom=bounds.top+el.outerHeight();var isOutsideViewport=viewport.right<bounds.left||viewport.left>bounds.right||viewport.bottom<bounds.top||viewport.top>bounds.bottom;return!isOutsideViewport},checkWidgetsVisibility:function(){this.each(this.widgets,function(widget){var viewport=this.getViewport(),elements=widget.getWidgetElements();this.eachElement(elements,function(element,index){var targetElement=widget.getViewWatcherElement(index,element);return this.isElementInsideViewport(targetElement,viewport)?(widget.onWidgetInViewport(),!1):void 0})})}}}),Contextly.widget.ViewHandler=Contextly.createClass({findViewWatcherElement:Contextly.abstractMethod(),getViewWatcherElement:function(index,widgetElement){return this.widget_view_element=this.widget_view_element||[],null==this.widget_view_element[index]&&(this.widget_view_element[index]=this.findViewWatcherElement(widgetElement)),this.widget_view_element[index]},attachWidgetViewHandler:function(){return this.widget_view_happened||Contextly.widget.ViewWatcher.isWatched(this)?(Contextly.Utils.logError("Widget view handler attempted to bind after the widget view event has been recorded or polling is in progress."),void 0):(Contextly.widget.ViewWatcher.watch(this),void 0)},onWidgetInViewport:function(){if(Contextly.widget.ViewWatcher.unwatch(this),!this.widget_view_happened){this.widget_view_happened=!0;var apiSession=this.experienceClient.getApiSession();apiSession.hasId()&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:apiSession.getId(),event_success:!0}),this.broadcast(Contextly.widget.broadcastTypes.IN_VIEWPORT)}},destroyReferences:function(){Contextly.widget.ViewWatcher.isWatched(this)&&Contextly.widget.ViewWatcher.unwatch(this)}})}(Contextly.DOM),function($){Contextly.widget.ResponsiveWatcher=Contextly.createClass({extend:Contextly.ProxyEach.prototype,statics:{construct:function(){this.lastWidth=0,this.resizeTimer=null,this.pollingTimer=null,this.pollingsLeft={},this.binded=!1,this.widgets={},this.$window=$(window)},add:function(widget){var index=widget.getWidgetIndex();null==this.widgets[index]&&(this.widgets[index]=widget,this.pollingsLeft[index]=3,this.bind(),this.startPolling(),this.updateWidgetLayouts([widget]))},remove:function(widget){var index=widget.getWidgetIndex();null!=this.widgets[index]&&(delete this.widgets[index],null!=this.pollingsLeft[index]&&delete this.pollingsLeft[index],this.unbind())},ns:bind:function(){this.binded||this.$window.on(this.ns("resize"),this.proxy(this.onResizeStart)).on(this.ns("load"),this.proxy(this.onWindowLoad))},unbind:function(){this.binded&&Contextly.Utils.isEmptyObject(this.widgets)&&(this.clearResizeTimer(),this.$window.off(this.ns("resize")).off(this.ns("load")))},clearResizeTimer:onResizeStart:function(){this.clearResizeTimer(),this.resizeTimer=setTimeout(this.proxy(this.onResizeComplete),300)},onResizeComplete:function(){this.resizeTimer=null;var currentWidth=this.$window.width();currentWidth!=this.lastWidth&&this.updateWidgetLayouts()},startPolling:function(){null!=this.pollingTimer||Contextly.Utils.isEmptyObject(this.pollingsLeft)||(this.pollingTimer=setTimeout(this.proxy(this.onPolling),800))},onPolling:function(){var widgets={},pollingsLeft={};this.each(this.pollingsLeft,function(left,index){widgets[index]=this.widgets[index],left>1&&(pollingsLeft[index]=left-1)}),this.pollingsLeft=pollingsLeft,Contextly.Utils.isEmptyObject(widgets)||this.updateWidgetLayouts(widgets),this.pollingTimer=null,this.startPolling()},onWindowLoad:updateWidgetLayouts:function(widgets){widgets=widgets||this.widgets,this.each(widgets,}}}),Contextly.widget.ResponsiveLayout=Contextly.createClass({destroyReferences:getLayoutModes:setUpResponsiveLayout:function(){Contextly.Utils.isEmptyObject(this.getLayoutModes())||Contextly.widget.ResponsiveWatcher.add(this)},sizeMatchesThresholds:function(size,thresholds){return size>=thresholds[0]&&(!thresholds[1]||thresholds[1]>size)},checkLayoutThresholds:function(){var modes=this.getLayoutModes(),elements=this.getWidgetElements();this.eachElement(elements,function(element){var width=element.width();this.each(modes,function(thresholds,name){return this.sizeMatchesThresholds(width,thresholds)?(this.setLayoutMode(element,name),!1):void 0})})},buildLayoutClass:setLayoutMode:function(element,mode){var key="ctxLayoutMode",lastMode=element.data(key);if(mode!==lastMode){var firstTime=null==lastMode;firstTime||element.removeClass(this.buildLayoutClass(lastMode)),element.data(key,mode),element.addClass(this.buildLayoutClass(mode)),firstTime||this.broadcast(Contextly.widget.broadcastTypes.LAYOUT_CHANGED,mode)}}})}(Contextly.DOM),function(){Contextly.widget.PageEvents=Contextly.createClass({statics:{trackLink:function(widget_type,link_type,link_url,link_title,ga_tracker_name){if(widget_type&&link_type&&link_url&&link_title){var category="Contextly",action="";action=widget_type===Contextly.widget.types.SIDEBAR||widget_type===Contextly.widget.types.AUTO_SIDEBAR?"Sidebar_":widget_type===Contextly.widget.types.SIDERAIL?"Siderail_":widget_type===Contextly.widget.types.HOME_PERSONALIZED?"HomePersonalized_":"Module_",action+=link_type==Contextly.widget.linkTypes.WEB?"External_":link_type==Contextly.widget.linkTypes.PREVIOUS||link_type==Contextly.widget.linkTypes.RECENT?"Related_":link_type==Contextly.widget.linkTypes.PROMO?"Promo_":link_type.charAt(0).toUpperCase()+link_type.slice(1)+"_";var page_type="Post",url_parts=link_url.split("?"),url_params=url_parts[1].split(":");if(url_params.length>=3){var algorithm_id=url_params[3];algorithm_id==Contextly.widget.recommendationTypes.PRODUCT?page_type="Product":algorithm_id==Contextly.widget.recommendationTypes.VIDEO&&(page_type="Video")}action+=page_type;var label_limit=30,label=link_title;label.length>label_limit&&(label=label.substr(0,label_limit));try{if(window.ga!==void 0&&Contextly.Utils.isFunction(ga)){var default_tracker_name="send";ga_tracker_name&&(default_tracker_name=ga_tracker_name+"."+default_tracker_name),ga(default_tracker_name,"event",category,action,label)}else window._gaq!==void 0?_gaq.push(["_trackEvent",category,action,label]):window.pageTracker!==void 0&&pageTracker._trackEvent(category,action,label)}catch(e){Contextly.Utils.logError("Unable to track link click",e)}}},custom:function(type,name,params){var page_idx=Contextly.widget.Controller.lastInstanceId;page_idx&&Contextly.widget.Controller.posts[page_idx]&&Contextly.widget.Controller.posts[page_idx].eventsLogger.sendEvent(type,name,params)}}})}(Contextly.DOM),function($){Contextly.widget.Post=Contextly.createClass({extend:[Contextly.ProxyEach,Contextly.Transmitter],construct:function(options){this.options=Contextly.Utils.merge({context:document,metadata:null,data:null,update:null,guid:null,customRestClient:null,customExperienceClient:null},options),this.queue=[this.init,this.loadData,this.convertData,this.setApiSessionId,this.buildContainers,[this.loadPackages,this.loadFonts],this.buildWidgets,this.displayWidgets,this.scheduleUpdate,this.loadIntegrations],this.load()},load:function(){if(this.queue.length&&!this.gate){var actions=this.queue.shift();Contextly.Utils.isArray(actions)||(actions=[actions]),this.gate=new Contextly.CallbacksGate,this.each(actions,,this.isDestroyed()||(this.gate.appendResult(this.proxy(this.onStageComplete)),this.gate.unseal())}},onStageComplete:init:function(){if(this.$context=$(this.options.context),this.factory=new Contextly.widget.Factory(this.$context),this.metadataProvider=null!=this.options.metadata?new Contextly.metadataProvider.Custom(this.options.metadata):new Contextly.metadataProvider.Parsed,!this.metadataProvider.hasRequired())return Contextly.Utils.logError("Required metadata properties not found in context:",this.$context),this.destroy(),void 0;this.apiSession=new Contextly.client.Session,this.restClient=this.options.customRestClient?this.options.customRestClient:new Contextly.client.Rest(this.apiSession,this.metadataProvider),this.experienceClient=this.options.customExperienceClient?this.options.customExperienceClient:new Contextly.client.Experience(this.apiSession,this.metadataProvider),this.mainServerClient=new Contextly.client.MainServer,this.eventsLogger=new Contextly.EventsLogger(this.experienceClient);var keys={data:!0,update:!0,guid:!0};for(var key in keys)null!=this.options[key]&&(this[key]=this.options[key])},getDestroyableProperties:destroyReferences:function(){this.queue=[],this.widgets&&(this.each(this.widgets,function(widget){widget.removeCssCode(),widget.destroy()}),delete this.widgets),Contextly.ProxyEach.fn.destroyReferences.apply(this,arguments),this.broadcast(Contextly.widget.Post.broadcastTypes.DESTROYED,this.$context),delete this.$context},getWidgetLoadingFlags:function(){var result={},types=Contextly.widget.types,map={load_snippet:types.SNIPPET,load_side_rail:types.SIDERAIL,load_sidebar:types.SIDEBAR,load_auto_sidebar:types.AUTO_SIDEBAR,load_storyline_subscribe:types.STORYLINE_SUBSCRIBE,load_personalization_subscribe:types.PERSONALIZATION_SUBSCRIBE,load_channel_subscribe:types.CHANNEL_SUBSCRIBE,load_author:types.AUTHOR_FOLLOWUP,load_home_personalized:types.HOME_PERSONALIZED},fallbacks={load_auto_sidebar:"auto",load_channel_subscribe:"auto"};for(var flag in map){var type=map[flag],value=!!this.factory.getContainer(type).getElements().length;value||null==fallbacks[flag]||(value=fallbacks[flag]),result[flag]=value}return result},loadData:function(){if(null==this.data){this.broadcast(Contextly.widget.Post.broadcastTypes.LOADING,this.$context);var reason=this.gate.addReason(),params=this.getWidgetLoadingFlags();this.restClient.call("pagewidgets","get",params,this.proxy(!1,!0))}},onDataLoadingComplete:function(response){response&&response.success&&response.entry?this.onDataLoadingSuccess(response):this.onDataLoadingError(response)},onDataLoadingSuccess:function(response){this.broadcast(Contextly.widget.Post.broadcastTypes.LOADED,this.$context,response),Contextly.Visitor.initIds(response),this.data=response.entry,null==this.update&&null!=response.entry.update&&(this.update=response.entry.update),null==this.guid&&null!=response.guid&&(this.guid=response.guid),null==this.integrations&&null!=response.entry.integrations&&(this.integrations=response.entry.integrations)},onDataLoadingError:function(response){this.broadcast(Contextly.widget.Post.broadcastTypes.FAILED,this.$context,response),this.destroy()},convertData:function(){var result=[];this.each(this.data,function(collection){Contextly.Utils.isArray(collection)&&collection.length&&this.each(collection,}),this.data=result},setApiSessionId:function(){this.apiSession.hasId()||this.apiSession.setId(this.guid)},buildContainers:function(){this.containers=[],this.each(this.data,function(data){var container=this.factory.getContainer(data.type,data);container&&this.containers.push(container)})},loadPackages:function(){this.each(this.containers,function(container){var widgetPackages={stylist:container.getStylistPackageName(),theme:container.getThemePackageName(),widget:container.getWidgetPackageName()};for(var key in widgetPackages){var name=widgetPackages[key];null!=name&&Contextly.loader.PackageManager.load(name,this.gate)}})},loadFonts:function(){this.each(this.containers,function(container){var data=container.getData(),fonts=data.settings.external_fonts;fonts&&Contextly.FontManager.load({fonts:fonts,callback:this.gate.addReason()})})},buildWidgets:function(){this.widgets=[];var commonParams={eventsLogger:this.eventsLogger,experienceClient:this.experienceClient,mainServerClient:this.mainServerClient};this.each(this.containers,function(container){var params=Contextly.Utils.merge({data:container.getData(),container:container},commonParams);this.widgets.push(this.factory.getWidget(params))})},displayWidgets:function(){this.each(this.widgets,,this.broadcast(Contextly.widget.Post.broadcastTypes.DISPLAYED,this.$context,this.widgets)},scheduleUpdate:function(){if(this.update){var gate=new Contextly.CallbacksGate;gate.appendResult(this.proxy();var broadcastType=Contextly.widget.Post.broadcastTypes.POST_UPDATE;this.broadcast(broadcastType,this.$context,this.metadataProvider,gate),gate.unseal()}},loadIntegrations:function(){if(this.integrations){var integrationFactory=new Contextly.integration.Factory(this.$context);this.each(this.integrations,function(params,type){var integrationClass=integrationFactory.getIntegration(type,params,this.gate);integrationClass&&integrationClass.add()})}}}),Contextly.widget.Post.broadcastTypes={LOADING:"contextlyWidgetsLoading",LOADED:"contextlyWidgetsLoaded",FAILED:"contextlyWidgetsFailed",DISPLAYED:"contextlyWidgetsDisplayed",DESTROYED:"contextlyWidgetsDestroyed",POST_UPDATE:"contextlyPostUpdate"}}(Contextly.DOM),function($){Contextly.widget.Controller=Contextly.createClass({extend:Contextly.ProxyEach.prototype,statics:{construct:command:function(command,specs){var allowed={add:!0,remove:!0};!command in allowed&&Contextly.Utils.error("Unknown widgets command "+command),Contextly.Utils.isArray(specs)||(specs=[specs]),this.each(specs,function(options){options=Contextly.Utils.merge({context:document},options),this[command](options)})},add:function(options){var $context=$(options.context);if($context.length){null!=$context[0].ctxInstanceId&&this.remove(options);var iid=$context[0].ctxInstanceId=++this.lastInstanceId;this.posts[iid]=new Contextly.widget.Post(options)}},remove:function(options){var $context=$(options.context);if($context.length){var iid=$context[0].ctxInstanceId;null!=iid&&null!=this.posts[iid]&&(this.posts[iid].destroy(),delete this.posts[iid])}}}})}(Contextly.DOM),Contextly.widget.CssCustomBuilder=Contextly.createClass({statics:{buildCSSRule:function(entry,selectors,property,value){if(!value)return"";Contextly.Utils.isArray(selectors)||(selectors=[selectors]);for(var result="",i=0;selectors.length>i;i++)i&&(result+=", "),result+=entry+" "+selectors[i];return result+=" {"+property+": "+value+"}"},buildCSSRuleDark:function(entry,selectors,property,value){var cssRule=this.buildCSSRule(entry,selectors,property,value);return cssRule?"@media (prefers-color-scheme: dark) {"+cssRule+"}":cssRule}}}),Contextly.widget.TextCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-text .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=[".ctx-content-text .ctx-link",".ctx-content-text .ctx-link a"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=[".ctx-content-text .ctx-sections-container",".ctx-content-text .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector=".ctx-content-text",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.BlocksCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-block .ctx-links-header p";if(css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=".ctx-content-block .ctx-link-title",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=[".ctx-content-block .ctx-sections-container",".ctx-content-block .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector=".ctx-content-block",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),selector=".ctx-content-block .ctx-link-title",css.overlay_color){result+=this.buildCSSRule(entry,selector,"background",css.overlay_color);try{var color=new Contextly.color.RGB(css.overlay_color),rgba="rgba("+color.red+","+color.green+","+color.blue+",0.85)";result+=this.buildCSSRule(entry,selector,"background",rgba)}catch(e){Contextly.Utils.logError("Unable to parse the overlay color "+css.overlay_color)}}if(css.overlay_color_dark&&css.dark_theme_support){result+=this.buildCSSRuleDark(entry,selector,"background",css.overlay_color_dark);try{var color=new Contextly.color.RGB(css.overlay_color_dark),rgba="rgba("+color.red+","+color.green+","+color.blue+",0.85)";result+=this.buildCSSRuleDark(entry,selector,"background",rgba)}catch(e){Contextly.Utils.logError("Unable to parse the overlay color "+css.overlay_color_dark)}}return result}}}),Contextly.widget.Blocks2CssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-block2 .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=".ctx-content-block2 .ctx-link-title p",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=[".ctx-content-block2 .ctx-sections-container",".ctx-content-block2 .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector=".ctx-content-block2",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.FloatCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-float .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=[".ctx-content-float .ctx-link",".ctx-content-float .ctx-link-title p"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector[1],"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector[1],"color",css.links_color_dark)),selector=[".ctx-content-float .ctx-sections-container",".ctx-content-float .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector=".ctx-content-float",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.FlexCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-flex .ctx-section-title";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=[".ctx-content-flex .ctx-content-post-title",".ctx-content-flex .ctx-content-post-title a"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector[1],"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector[1],"color",css.links_color_dark)),selector=[".ctx-content-flex .ctx-section-title"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-bottom",".25px solid "+css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-bottom",".25px solid "+css.border_color_dark)),selector=".ctx-content-flex",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.Flex2CssCustomBuilder=Contextly.createClass({extend:Contextly.widget.FlexCssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-flex2 .ctx-section-title";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=[".ctx-content-flex2 .ctx-content-post-title",".ctx-content-flex2 .ctx-content-post-title a"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector[1],"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector[1],"color",css.links_color_dark)),selector=[".ctx-content-flex2 .ctx-section-title:first-of-type"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-top",".25px solid "+css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-top",".25px solid "+css.border_color_dark)),selector=".ctx-content-flex2",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.CinemaCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-cinema .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=[".ctx-content-cinema .ctx-link-title .title a"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=[".ctx-content-cinema .ctx-link-title .ctx-meta"],css.metadata_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.metadata_font_family)),css.metadata_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.metadata_font_size)),css.metadata_color&&(result+=this.buildCSSRule(entry,selector,"color",css.metadata_color)),css.metadata_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.metadata_color_dark)),selector=[".ctx-content-cinema .ctx-sections-container",".ctx-content-cinema .ctx-section:first-child"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector=".ctx-content-cinema",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.CompactCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-compact .ctx-section-title";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=[".ctx-content-compact .ctx-story-title",".ctx-content-compact .ctx-story-title"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector[1],"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector[1],"color",css.links_color_dark)),selector=[".ctx-content-compact .ctx-section-title"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-bottom",".25px solid "+css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-bottom",".25px solid "+css.border_color_dark)),selector=".ctx-content-compact",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.TextMobileCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-mobile-text .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=[".ctx-content-mobile-text .ctx-link",".ctx-content-mobile-text .ctx-link a"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=[".ctx-content-mobile-text .ctx-sections-container",".ctx-content-mobile-text .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector=".ctx-content-mobile-text",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.BlocksMobileCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-mobile-block .ctx-links-header p";if(css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=".ctx-content-mobile-block .ctx-link-title",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=[".ctx-content-mobile-block .ctx-sections-container",".ctx-content-mobile-block .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector=".ctx-content-mobile-block",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),selector=".ctx-content-mobile-block .ctx-link-title",css.overlay_color){result+=this.buildCSSRule(entry,selector,"background",css.overlay_color);try{var color=new Contextly.color.RGB(css.overlay_color),rgba="rgba("+color.red+","+color.green+","+color.blue+",0.85)";result+=this.buildCSSRule(entry,selector,"background",rgba)}catch(e){Contextly.Utils.logError("Unable to parse the overlay color "+css.overlay_color)}}if(css.overlay_color_dark&&css.dark_theme_support){result+=this.buildCSSRuleDark(entry,selector,"background",css.overlay_color_dark);try{var color=new Contextly.color.RGB(css.overlay_color_dark),rgba="rgba("+color.red+","+color.green+","+color.blue+",0.85)";result+=this.buildCSSRuleDark(entry,selector,"background",rgba)}catch(e){Contextly.Utils.logError("Unable to parse the overlay color "+css.overlay_color_dark)}}return result}}}),Contextly.widget.Blocks2MobileCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-mobile-block2 .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=".ctx-content-mobile-block2 .ctx-link-title p",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=[".ctx-content-mobile-block2 .ctx-sections-container",".ctx-content-mobile-block2 .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector=".ctx-content-mobile-block2",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.FloatMobileCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-mobile-float .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=[".ctx-content-mobile-float .ctx-link",".ctx-content-mobile-float .ctx-link-title p"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector[1],"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector[1],"color",css.links_color_dark)),selector=[".ctx-content-mobile-float .ctx-sections-container",".ctx-content-mobile-float .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector=".ctx-content-mobile-float",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.SidebarCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-sidebar .ctx-sb-title p";if(css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=".ctx-content-sidebar .ctx-sb-description p",css.description_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.description_font_family)),css.description_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.description_font_size)),css.description_color&&(result+=this.buildCSSRule(entry,selector,"color",css.description_color)),css.description_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.description_color_dark)),selector=[".ctx-content-sidebar .ctx-sb-link",".ctx-content-sidebar .ctx-sb-text p"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),selector=".ctx-content-sidebar .ctx-sb-text a",css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=[".ctx-content-sidebar .ctx-link-title p"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=[".ctx-content-sidebar",".ctx-content-sidebar .ctx-sb-title",".ctx-content-sidebar .ctx-sb-description",".ctx-content-sidebar .ctx-sb-content"],css.line_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.line_color)),css.line_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.line_color_dark)),selector=".ctx-content-sidebar .ctx-sb-img",settings.display_thumbnails&&settings.images_type){var matches=settings.images_type.match(/^(?:letter|square)(\d+)/i);matches[1]&&(result+=this.buildCSSRule(entry,selector,"max-width",matches[1]+"px"))}return selector=".ctx-content-sidebar",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.SiderailCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-sr-title p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=".ctx-link",css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),selector=".ctx-link-title p",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector="",css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.StorylineSubscribeCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",container=entry.container,widget=entry.widget,isTransparent="transparent"==settings.theme,isButton="button"==settings.theme,isSplitButton="split-button"==settings.theme,isColossus="colossus"==settings.theme;if(settings.css.alignment!==void 0&&(result+=this.buildCSSRule(container,"","text-align",settings.css.alignment)),settings.css.font_family!==void 0&&(result+=this.buildCSSRule(widget,"","font-family",settings.css.font_family)),settings.css.font_size!==void 0&&(result+=this.buildCSSRule(widget,"","font-size",settings.css.font_size)),settings.css.text_transform!==void 0&&(result+=this.buildCSSRule(widget,"","text-transform",settings.css.text_transform)),settings.css.text_color!==void 0&&(isTransparent||isButton||isColossus?result+=this.buildCSSRule(widget,"","color",settings.css.text_color):isSplitButton&&(result+=this.buildCSSRule(widget,".ctx-subscribe-label","color",settings.css.text_color))),settings.css.border_radius!==void 0&&(result+=this.buildCSSRule(widget,"","border-radius",settings.css.border_radius),isSplitButton&&(result+=this.buildCSSRule(widget,".ctx-subscribe-logo","border-top-left-radius",settings.css.border_radius),result+=this.buildCSSRule(widget,".ctx-subscribe-logo","border-bottom-left-radius",settings.css.border_radius),result+=this.buildCSSRule(widget,".ctx-subscribe-label","border-top-right-radius",settings.css.border_radius),result+=this.buildCSSRule(widget,".ctx-subscribe-label","border-bottom-right-radius",settings.css.border_radius))),settings.css.background_color!==void 0)if(isTransparent)result+=this.buildCSSRule(widget,"","background-color",settings.css.background_color);else{var colors=this.generateBackgroundColors(settings.css.background_color);isButton||isColossus?(result+=this.buildCSSRule(widget,"","background-color",colors.normal),result+=this.buildCSSRule(widget,"","border-color",colors.border),result+=this.buildCSSRule(widget+":hover","","background-color",colors.hover)):isSplitButton&&(result+=this.buildCSSRule(widget,".ctx-subscribe-label","background-color",colors.normal),result+=this.buildCSSRule(widget,".ctx-subscribe-label","border-color",colors.border),result+=this.buildCSSRule(widget+":hover",".ctx-subscribe-label","background-color",colors.hover))}if(isTransparent&&settings.css.shadow_color!==void 0&&(result+=this.buildCSSRule(widget+":hover","","color",settings.css.shadow_color),result+=this.buildCSSRule(widget+":hover","","box-shadow","0 0 3px "+settings.css.shadow_color)),isSplitButton&&(settings.css.logo_color!==void 0&&(result+=this.buildCSSRule(widget,".ctx-subscribe-logo","color",settings.css.logo_color)),settings.css.logo_background_color!==void 0)){var logoColors=this.generateBackgroundColors(settings.css.logo_background_color);result+=this.buildCSSRule(widget,".ctx-subscribe-logo","background-color",logoColors.normal),result+=this.buildCSSRule(widget,".ctx-subscribe-logo","border-color",logoColors.border),result+=this.buildCSSRule(widget+":hover",".ctx-subscribe-logo","background-color",logoColors.hover)}return settings.css.custom_code&&(result+=settings.css.custom_code),result},generateBackgroundColors:function(original){try{var hsv=new Contextly.color.RGB(original).toHSV(),hover=""+hsv.brightness({delta:-10}).toRGB(),border=""+hsv.brightness({delta:-20,max:70}).toRGB();return{normal:original,hover:hover,border:border}}catch(e){return Contextly.Utils.logError("Unable to get darker color for mouse over effect and border from ",original,e),{normal:original,hover:original,border:original}}}}}),Contextly.widget.ChannelFormSubscribeCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",container=entry.container;entry.widget;var css=settings.css||{},selector=".ctx-channel-form-container .ctx-title-row";return css.title_font_family&&(result+=this.buildCSSRule(container,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(container,selector,"font-size",css.title_font_size)),css.title_font_color&&(result+=this.buildCSSRule(container,selector,"color",css.title_font_color)),css.title_font_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(container,selector,"color",css.title_font_color_dark)),selector=".ctx-channel-form-container .ctx-description-row",css.description_font_family&&(result+=this.buildCSSRule(container,selector,"font-family",css.description_font_family)),css.description_font_size&&(result+=this.buildCSSRule(container,selector,"font-size",css.description_font_size)),css.description_font_color&&(result+=this.buildCSSRule(container,selector,"color",css.description_font_color)),css.description_font_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(container,selector,"color",css.description_font_color_dark)),selector=".ctx-channel-form-container",css.background_color&&(result+=this.buildCSSRule(container,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(container,selector,"background-color",css.background_color_dark)),css.line_color&&(result+=this.buildCSSRule(container,selector,"border-color",css.line_color)),css.line_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(container,selector,"border-color",css.line_color_dark)),settings.css.custom_code&&(result+=settings.css.custom_code),result},generateBackgroundColors:function(original){try{var hsv=new Contextly.color.RGB(original).toHSV(),hover=""+hsv.brightness({delta:-10}).toRGB(),border=""+hsv.brightness({delta:-20,max:70}).toRGB();return{normal:original,hover:hover,border:border}}catch(e){return Contextly.Utils.logError("Unable to get darker color for mouse over effect and border from ",original,e),{normal:original,hover:original,border:original}}}}}),Contextly.widget.SocialCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-title p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),selector="",css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),selector=".ctx-slick-arrow:before",css.arrow_foreground_color&&(result+=this.buildCSSRule(entry,selector,"color",css.arrow_foreground_color)),css.arrow_background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.arrow_background_color)),selector=".ctx-tweet.ctx-icon-hourglass:before",css.arrow_foreground_color&&(result+=this.buildCSSRule(entry,selector,"color",css.arrow_foreground_color)),result}}}),Contextly.widget.PersonalizedDefaultCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings,widgetClass){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector="."+widgetClass+" .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=["."+widgetClass+" .ctx-link","."+widgetClass+" .ctx-link a"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=["."+widgetClass+" .ctx-sections-container","."+widgetClass+" .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector="."+widgetClass,css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.PersonalizedBlocksCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings,widgetClass){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector="."+widgetClass+" .ctx-links-header p";if(css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector="."+widgetClass+" .ctx-link-title",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=["."+widgetClass+" .ctx-sections-container","."+widgetClass+" .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector="."+widgetClass,css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),selector="."+widgetClass+" .ctx-link-title",css.overlay_color){result+=this.buildCSSRule(entry,selector,"background",css.overlay_color);try{var color=new Contextly.color.RGB(css.overlay_color),rgba="rgba("+color.red+","+color.green+","+color.blue+",0.85)";result+=this.buildCSSRule(entry,selector,"background",rgba)}catch(e){Contextly.Utils.logError("Unable to parse the overlay color "+css.overlay_color)}}if(css.overlay_color_dark&&css.dark_theme_support){result+=this.buildCSSRuleDark(entry,selector,"background",css.overlay_color_dark);try{var color=new Contextly.color.RGB(css.overlay_color_dark),rgba="rgba("+color.red+","+color.green+","+color.blue+",0.85)";result+=this.buildCSSRuleDark(entry,selector,"background",rgba)}catch(e){Contextly.Utils.logError("Unable to parse the overlay color "+css.overlay_color_dark)}}return result}}}),Contextly.widget.PersonalizedBlocks2CssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings,widgetClass){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector="."+widgetClass+" .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector="."+widgetClass+" .ctx-link-title p",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.links_color_dark)),selector=["."+widgetClass+" .ctx-sections-container","."+widgetClass+" .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector="."+widgetClass,css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.PersonalizedFloatCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings,widgetClass){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector="."+widgetClass+" .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),css.title_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"color",css.title_color_dark)),selector=["."+widgetClass+" .ctx-link","."+widgetClass+" .ctx-link-title p"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector[1],"color",css.links_color)),css.links_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector[1],"color",css.links_color_dark)),selector=["."+widgetClass+" .ctx-sections-container","."+widgetClass+" .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.border_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"border-color",css.border_color_dark)),selector="."+widgetClass,css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(entry,selector,"background-color",css.background_color_dark)),result}}}),Contextly.widget.AuthorFollowUpButtonCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.StorylineSubscribeCssCustomBuilder}),Contextly.widget.AuthorFollowUpFormCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.ChannelFormSubscribeCssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",container=entry.container;entry.widget;var css=settings.css||{},selector=".ctx-author-followup-form-container .ctx-title-row";return css.title_font_family&&(result+=this.buildCSSRule(container,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(container,selector,"font-size",css.title_font_size)),css.title_font_color&&(result+=this.buildCSSRule(container,selector,"color",css.title_font_color)),css.title_font_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(container,selector,"color",css.title_font_color_dark)),selector=".ctx-author-followup-form-container .ctx-description-row",css.description_font_family&&(result+=this.buildCSSRule(container,selector,"font-family",css.description_font_family)),css.description_font_size&&(result+=this.buildCSSRule(container,selector,"font-size",css.description_font_size)),css.description_font_color&&(result+=this.buildCSSRule(container,selector,"color",css.description_font_color)),css.description_font_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(container,selector,"color",css.description_font_color_dark)),selector=".ctx-author-followup-form-container",css.background_color&&(result+=this.buildCSSRule(container,selector,"background-color",css.background_color)),css.background_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(container,selector,"background-color",css.background_color_dark)),css.line_color&&(result+=this.buildCSSRule(container,selector,"border-color",css.line_color)),css.line_color_dark&&css.dark_theme_support&&(result+=this.buildCSSRuleDark(container,selector,"border-color",css.line_color_dark)),settings.css.custom_code&&(result+=settings.css.custom_code),result}}}),function($){Contextly.overlay.ChannelSubscribe=Contextly.createClass({extend:Contextly.overlay.Base,statics:{open:function(options){Contextly.overlay.Base.open.call(this,null,options)},startOpening:function(){this.openingGate&&this.openingGate.destroy(),this.openingGate=new Contextly.CallbacksGate,this.openingReasons={animation:this.openingGate.addReason(),request:this.openingGate.addReason()},Contextly.overlay.Base.startOpening.apply(this,arguments),this.registerButtonClick(),this.openingGate.appendResult(this.proxy(this.unlockSubscriptionUI)),this.openingGate.appendResult(this.proxy(this.focusEmailInput)),this.openingGate.unseal()},completeOpening:function(){Contextly.overlay.Base.completeOpening.apply(this,arguments),this.openingReasons.animation()},startClosing:function(){this.openingGate.destroy(),Contextly.overlay.Base.startClosing.apply(this,arguments)},renderOverlay:function(){var init=Contextly.overlay.Base.renderOverlay.apply(this,arguments);init&&this.overlay.addClass("ctx-channel-overlay")},isNewsletterInputEnabled:renderDialog:function(){var isNewsletterEnabled=this.isNewsletterInputEnabled();if(this.dialog)this.dialog.show(),this.getMessage().hide(),this.getEmailInput().val(""),this.getInputRows().show();else{var classes=["ctx-channel-dialog","ctx-overlay-dialog"];Contextly.Browser.hasSvg()||classes.push("ctx-no-svg");var content='<div class="'+Contextly.Utils.escape(classes.join(" "))+'">'+'<div class="ctx-header">'+'<a href="javascript:" class="ctx-dialog-close">X</a>'+'<span class="ctx-header-title"></span>'+"</div>"+'<div class="ctx-body">'+'<div class="ctx-message-row"></div>'+'<div class="ctx-email-row ctx-input-row">'+'<input type="email" class="ctx-email" placeholder="Email address" />'+"</div>"+'<div class="ctx-newsletter-row ctx-input-row">'+'<input class="ctx-newsletter" type="checkbox" id="ctx-storyline-subscribe-newsletter" checked="checked">'+" "+'<label class="ctx-newsletter-label" for="ctx-storyline-subscribe-newsletter">'+"</label>"+"</div>"+'<div class="ctx-subscription-controls-row">'+"</div>"+'<div class="ctx-follow-row ctx-input-row">'+'<button class="ctx-follow">'+'<div class="ctx-follow-label">'+"Follow the Channel"+"</div>"+'<div class="ctx-icon ctx-icon-hourglass"></div>'+"</button>"+"</div>"+'<div class="ctx-terms-row">'+"Don't worry. We <b>don't</b> spam, and <b>never</b> sell or rent addresses."+"</div>"+'<div class="ctx-popup-footer-text"></div>'+"</div>"+'<div class="ctx-footer ctx-clearfix">'+'<a class="ctx-logo-link" target="_blank" href="http://contextly.com">Powered by</a>'+"</div>"+"</div>";this.dialog=$(content).appendTo("body"),this.appendSubscriptionControls(),this.displayFooterText()}this.getHeaderTitle().text("Follow the "+this.options.site_name+" "+this.options.channel_name+" Channel"),isNewsletterEnabled?(this.getNewsletterLabel().text(this.options.subscribe_newsletter_title),this.getNewsletterRow().show(),this.getNewsletterCheckbox()[0].checked=!0):this.getNewsletterRow().hide(),this.disableTransitions(),this.lockSubscriptionUI(),this.postponeTransitions()},disableTransitions:postponeTransitions:function(){setTimeout(this.proxy(,0)},bindHandlers:function(){Contextly.overlay.Base.bindHandlers.apply(this,arguments),this.getCloseLink().on(this.ns("click"),this.proxy(this.close)),this.getSubmit().on(this.ns("click"),this.proxy(this.onSubmit,!1,!0)),this.getEmailInput().on(this.ns("keypress"),this.proxy(this.onEmailInputKeyPress,!1,!0))},unbindHandlers:function(){Contextly.overlay.Base.unbindHandlers.apply(this,arguments),this.getCloseLink().off(this.ns("click")),this.getSubmit().off(this.ns("click")),this.getEmailInput().off(this.ns("keypress"))},destroyDialog:function(){this.dialog.hide()},onEmailInputKeyPress:onSubmit:function(e){e.preventDefault();var params={channel:this.options.channel},email=Contextly.Utils.trim(this.getEmailInput().val());return email&&Contextly.Utils.isEmailValid(email)?(params.email=email,this.subscribeToChannel(params),void 0):(this.errorMessage("Please enter a valid email address."),void 0)},registerButtonClick:function(){var params={auto_subscribe:!0,channel:this.options.channel},callback=this.proxy(this.onButtonClickRegistered,!1,!0);this.options.experienceClient.call("channels","button-click",params,callback)},onButtonClickRegistered:function(response){response.success&&response.confirmed?this.successMessage("We added the "+this.options.channel_name+" Channel to your FollowUp list."):this.openingReasons.request()},subscribeToChannel:function(params){params=params||{},this.isNewsletterInputEnabled()&&(params.subscribe_newsletter=this.getNewsletterCheckbox().is(":checked")?1:0);var custom_subscr_params=this.getCustomSubscriptionParams();params=$.extend(params,custom_subscr_params),this.lockSubscriptionUI(),this.hideMessage();var callback=this.proxy(this.onSubscribeComplete,!1,!0);this.options.experienceClient.call("channels","subscribe",params,callback)},onSubscribeComplete:function(response){if(response&&response.success)response.confirmed?this.successMessage("We added the "+this.options.channel_name+" Channel to your FollowUp list."):this.successMessage("Almost done! Check your email.");else{var message="Something went wrong.";response&&response.error&&(message=response.error),this.errorMessage(message),this.unlockSubscriptionUI(),this.focusEmailInput()}},lockSubscriptionUI:function(){this.getInputs().attr("disabled","disabled"),this.getInputRows().addClass("ctx-progress"),this.getSubmit().attr("disabled","disabled").not(".ctx-progress").addClass("ctx-progress")},unlockSubscriptionUI:function(){this.getInputs().removeAttr("disabled"),this.getInputRows().removeClass("ctx-progress"),this.getSubmit().removeAttr("disabled").removeClass("ctx-progress")},focusEmailInput:getHeaderTitle:function(){return this.dialog.find(".ctx-header-title")},getMessage:function(){return this.dialog.find(".ctx-message-row")},getEmailInput:function(){return this.dialog.find(".ctx-email")},getNewsletterCheckbox:function(){return this.dialog.find(".ctx-newsletter")},getNewsletterLabel:function(){return this.dialog.find(".ctx-newsletter-label")},getNewsletterRow:function(){return this.dialog.find(".ctx-newsletter-row")},getSubmit:function(){return this.dialog.find(".ctx-follow")},getInputRows:function(){return this.dialog.find(".ctx-input-row")},getInputs:function(){var inputs=this.getEmailInput();return this.isNewsletterInputEnabled()&&(inputs=inputs.add(this.getNewsletterCheckbox())),inputs},getCloseLink:showMessage:function(text,className){var message=this.getMessage();this.options.duration;var fadeIn=this.proxy(function(){message.removeClass("ctx-success ctx-error ctx-info").addClass(className).text(text)});message.show(),fadeIn(),this.refreshDialogSizes()},hideMessage:function(){var message=this.getMessage();message.hide()},errorMessage:function(message){this.showMessage(message,"ctx-error")},successMessage:function(message){this.getInputRows().hide(),this.showMessage(message,"ctx-success"),setTimeout(this.proxy(this.close),3e3)},getCustomSubscriptionParams:function(){this.options.settings;var params={};return this.dialog.find(".ctx-subscription-controls-row input").each(function(idx,input){var $input=$(input);"checkbox"==$input.attr("type")&&(params[$input.attr("name")]=$input.is(":checked")?1:0)}),params},subscribeToChannelSocial:function(event){event.data.provider&&"contextly-social-login"==event.data.provider&&this.subscribeToChannel({channel:this.options.channel,email:event.data.email,source:event.data.source,confirm_immediately:!0})}}})}(Contextly.DOM),function($){Contextly.overlay.Branding=Contextly.createClass({extend:Contextly.overlay.Base,statics:{open:function(options){Contextly.overlay.Base.open.call(this,null,options)},renderOverlay:function(){var init=Contextly.overlay.Base.renderOverlay.apply(this,arguments);init&&this.overlay.addClass("ctx-brd-overlay")},renderDialog:function(){if(this.dialog)this.dialog.show();else{var classes=["ctx-overlay-dialog"];Contextly.Browser.hasSvg()||classes.push("ctx-no-svg");var content='<div id="ctx-branding-content" class="'+Contextly.Utils.escape(classes.join(" "))+'">';content+='<div id="ctx-brd-modal">',content+='<div id="ctx-brd-logo"></div>',content+='<div id="ctx-brd-text-head"></div>',content+='<div id="ctx-brd-text"><p>Contextly recommends interesting and related stories using a unique combination of algorithms and editorial choices.<br><br>Publishers or advertisers who would like to learn more about Contextly can contact us&nbsp;<a href="http://contextly.com/sign-up/publishers/" target="_blank">here</a>.<br><br>We respect <a href="http://contextly.com/privacy/" target="_blank">readers&#8217; privacy </a>.&nbsp;</p></div>',content+="</div>",content+='<a href="javascript:" id="ctx-brd-close">X</a>',content+="</div>",this.dialog=$(content).appendTo("body")}},destroyDialog:function(){this.dialog.hide()},bindHandlers:function(){Contextly.overlay.Base.bindHandlers.apply(this,arguments),$("#ctx-brd-close",window.document).on(this.ns("click"),this.proxy(this.close))},unbindHandlers:function(){Contextly.overlay.Base.unbindHandlers.apply(this,arguments),$("#ctx-brd-close",window.document).off(this.ns("click"))}}})}(Contextly.DOM),function($){Contextly.overlay.Video=Contextly.createClass({extend:Contextly.overlay.Dynamic,statics:{renderOverlay:function(){var init=Contextly.overlay.Base.renderOverlay.apply(this,arguments);init&&this.overlay.addClass("ctx-video-overlay")},getDialogHtml:function(){return'<div class="ctx-overlay-dialog ctx-video-modal"><div class="ctx-video"></div><div class="ctx-loading"></div><p class="ctx-video-title"></p><a href="#" class="ctx-video-close">&#215;</a><div class="ctx-social"></div></div>'},getFacebookLikeHtml:function(videoUrl){var url="//www.facebook.com/plugins/like.php?href="+encodeURIComponent(videoUrl)+"&width=100&layout=button&action=like&show_faces=true&share=true&height=20&locale=en_US";return'<iframe src="'+Contextly.Utils.escape(url)+'" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:100px; height:20px;" allowTransparency="true"></iframe>'},getTweetButtonHtml:function(videoId,videoTitle){var videoUrl="https://www.youtube.com/watch?v="+encodeURIComponent(videoId),buttonUrl="//platform.twitter.com/widgets/tweet_button.html?text="+encodeURIComponent(videoTitle)+"&url="+encodeURIComponent(videoUrl);return"<iframe allowtransparency='true' frameborder='0' scrolling='no' src='"+Contextly.Utils.escape(buttonUrl)+"' style='width:98px; height:20px;'></iframe>"},renderContent:function(data){var videoId=Contextly.Utils.parseUrlQueryParameter("v",data.videoUrl),videoSrc="//www.youtube.com/embed/"+videoId+"?rel=1&autoplay=1";this.content=this.content||{},this.content.title=this.content.title||this.dialog.find(".ctx-video-title"),this.content.title.text(data.videoTitle);var videoHtml='<iframe src="'+Contextly.Utils.escape(videoSrc)+'" frameborder="no" class="ctx-video-frame"></iframe>';this.content.video=$(videoHtml).appendTo(this.dialog.find(".ctx-video"));var socialHtml=this.getFacebookLikeHtml(data.videoUrl)+this.getTweetButtonHtml(videoId,data.videoTitle);this.content.social=$(socialHtml).appendTo(this.dialog.find(".ctx-social"))},destroyContent:function(){this.content.title.empty(),this.content.video.remove(),this.content.social.remove(),delete this.content.video,delete this.content.social},bindHandlers:function(){Contextly.overlay.Dynamic.bindHandlers.apply(this,arguments),this.dialog.find(".ctx-video-close").on(this.ns("click"),this.proxy(this.close))},unbindHandlers:function(){Contextly.overlay.Dynamic.unbindHandlers.apply(this,arguments),this.dialog.find(".ctx-video-close").off(this.ns("click"))}}})}(Contextly.DOM),function($){Contextly.overlay.AuthorFollowUpSubscribe=Contextly.createClass({extend:Contextly.overlay.ChannelSubscribe,statics:{open:function(options){Contextly.overlay.Base.open.call(this,null,options)},renderOverlay:function(){var init=Contextly.overlay.Base.renderOverlay.apply(this,arguments);init&&this.overlay.addClass("ctx-author-followup-overlay")},renderDialog:function(){if(this.dialog)this.dialog.show(),this.getMessage().hide(),this.getEmailInput().val(""),this.getInputRows().show();else{var classes=["ctx-author-followup-dialog","ctx-overlay-dialog"];Contextly.Browser.hasSvg()||classes.push("ctx-no-svg");var content='<div class="'+Contextly.Utils.escape(classes.join(" "))+'">'+'<div class="ctx-header">'+'<a href="javascript:" class="ctx-dialog-close">X</a>'+'<span class="ctx-header-title"></span>'+"</div>"+'<div class="ctx-body">'+'<div class="ctx-message-row"></div>'+'<div class="ctx-email-row ctx-input-row">'+'<input type="email" class="ctx-email" placeholder="Email address" />'+"</div>"+'<div class="ctx-newsletter-row ctx-input-row">'+'<input class="ctx-newsletter" type="checkbox" id="ctx-storyline-subscribe-newsletter" checked="checked">'+" "+'<label class="ctx-newsletter-label" for="ctx-storyline-subscribe-newsletter">'+"</label>"+"</div>"+'<div class="ctx-subscription-controls-row">'+"</div>"+'<div class="ctx-follow-row ctx-input-row">'+'<button class="ctx-follow">'+'<div class="ctx-follow-label">'+"Follow Author"+"</div>"+'<div class="ctx-icon ctx-icon-hourglass"></div>'+"</button>"+"</div>"+'<div class="ctx-terms-row">'+"Don't worry. We <b>don't</b> spam, and <b>never</b> sell or rent addresses."+"</div>"+'<div class="ctx-popup-footer-text"></div>'+"</div>"+'<div class="ctx-footer ctx-clearfix">'+'<a class="ctx-logo-link" target="_blank" href="http://contextly.com">Powered by</a>'+"</div>"+"</div>";this.dialog=$(content).appendTo("body"),this.appendSubscriptionControls(),this.displayFooterText()}this.getHeaderTitle().text("Follow the "+this.options.author_name),this.getNewsletterRow().hide(),this.disableTransitions(),this.lockSubscriptionUI(),this.postponeTransitions()},onSubmit:function(e){e.preventDefault();var params={author_name:this.options.author_name},email=Contextly.Utils.trim(this.getEmailInput().val());return email&&Contextly.Utils.isEmailValid(email)?(params.email=email,this.subscribeToAuthor(params),void 0):(this.errorMessage("Please enter a valid email address."),void 0)},registerButtonClick:function(){var params={auto_subscribe:!0,author_name:this.options.author_name},callback=this.proxy(this.onButtonClickRegistered,!1,!0);this.options.experienceClient.call("author-followup","button-click",params,callback)},onButtonClickRegistered:function(response){response.success&&response.confirmed?this.successMessage("We added the "+this.options.author_name+" to your FollowUp list."):this.openingReasons.request()},subscribeToAuthor:function(params){params=params||{};var custom_subscr_params=this.getCustomSubscriptionParams();params=$.extend(params,custom_subscr_params),this.lockSubscriptionUI(),this.hideMessage();var callback=this.proxy(this.onSubscribeComplete,!1,!0);this.options.experienceClient.call("author-followup","subscribe",params,callback)},onSubscribeComplete:function(response){if(response&&response.success)response.confirmed?this.successMessage("We added the "+this.options.author_name+" to your FollowUp list."):this.successMessage("Almost done! Check your email.");else{var message="Something went wrong.";response&&response.error&&(message=response.error),this.errorMessage(message),this.unlockSubscriptionUI(),this.focusEmailInput()}}}})}(Contextly.DOM),function($){Contextly.widget.Base=Contextly.createClass({extend:[Contextly.ProxyEach,Contextly.Transmitter],construct:function(params){this.widget=params.data,this.containers=params.container,this.eventsLogger=params.eventsLogger,this.experienceClient=params.experienceClient,this.mainServerClient=params.mainServerClient,this.widget_elements=null,this.widget_index=++Contextly.widget.index},getDestroyableProperties:destroyReferences:getWidget:function(){return this.widget},getWidgetType:function(){return this.widget_type},getSettings:function(){return this.getWidget().settings},getWidgetIndex:function(){return this.widget_index},markWithWidgetIndex:function(elements){$(elements).data("ctxWidgetIndex",this.getWidgetIndex())},getWidgetStyleClass:function(){return"default-widget"},getWidgetElements:function(){return null===this.widget_elements&&(this.widget_elements=this.getWidgetContainers().find("."+this.getWidgetStyleClass())),this.widget_elements},getWidgetContainers:getEventsNamespace:function(){return"contextlyWidget"+this.getWidgetIndex()},nsEvent:function(type){var ns="."+this.getEventsNamespace();return type=type?type.split(/\s+/).join(ns+" "):"",type+=ns},getWidgetHTML:Contextly.abstractMethod(),displayHTML:function(html){this.getWidgetContainers().html(html)},appendHTML:display:function(){var widget_html=this.getWidgetHTML();this.displayHTML(widget_html),this.attachHandlers(),this.broadcastWidgetDisplayed()},remove:function(){this.getWidgetContainers().empty(),this.broadcast(Contextly.widget.broadcastTypes.REMOVED)},attachHandlers:function(){var handlers=this.getHandlers.apply(this,arguments);for(var name in handlers)this[name].call(this)},getHandlers:function(){return{}},broadcast:function(type){var args=[type,this.containers.getContext(),this.widget_type];arguments.length>1&&Array.prototype.push.apply(args,Array.prototype.slice.call(arguments,1)),Contextly.Transmitter.fn.broadcast.apply(this,args)},broadcastWidgetDisplayed:getCssCodeKey:loadCssCode:function(){var key=this.getCssCodeKey(),generator=this.proxy(this.getCustomCssCode);Contextly.loader.CssManager.loadCode(key,generator)},removeCssCode:function(){Contextly.loader.CssManager.removeCode(this.getCssCodeKey())},getCustomCssCode:function(){},escape:function(text){return Contextly.Utils.escape(text)},renderAttributes:function(attributes){var res="";for(var key in attributes)res+=" "+key+'="'+Contextly.Utils.escape(attributes[key])+'"';return res},logEvent:alterLoggedEventParams:)}(Contextly.DOM),function($){Contextly.widget.BaseLinksList=Contextly.createClass({extend:[Contextly.widget.Base,Contextly.widget.ResponsiveLayout],destroyReferences:function(){this.getWidgetElements().find("a[rel='ctx-video-dataurl']").off("click"),this.getWidgetContainers().find(".ctx-branding-link").off("click"),Contextly.widget.ResponsiveLayout.fn.destroyReferences.apply(this,arguments),Contextly.widget.Base.fn.destroyReferences.apply(this,arguments)},construct:function(){Contextly.widget.Base.apply(this,arguments),this.widget_view_happened=!1},getScreenWidth:function(){return $(window).width()},hasWidgetData:getLinksLimit:function(){return 0},isDisplaySection:function(section){var display_section=-1!=Contextly.Utils.inArray(section,this.widget.settings.display_sections),have_to_display=this.widget.links&&this.widget.links[section]&&this.widget.links[section].length>0;return display_section&&have_to_display},display:function(){var widgetHasData=this.hasWidgetData();if(widgetHasData){var widget_html=this.getWidgetHTML();this.displayHTML(widget_html)}else this.getWidgetContainers().empty();this.attachHandlers(widgetHasData),this.broadcastWidgetDisplayed()},getHandlers:function(widgetHasData){var handlers=Contextly.widget.Base.prototype.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.setUpResponsiveLayout=!0),handlers},onVideoLinkClick:function(target,e){e.preventDefault();var link=$(target),data={videoUrl:link.attr("href"),videoTitle:link.attr("title")};Contextly.overlay.Video.open(data);var contextly_url=link.attr("contextly-url");this.mainServerClient.call(contextly_url)},attachLinksPopups:function(){this.getWidgetElements().find("a[rel='ctx-video-dataurl']").on("click",this.proxy(this.onVideoLinkClick,!0,!0))},getImageDimension:getImageDimensionFor:function(image_type){image_type=image_type.replace("square","").replace("letter","");var dimensions=image_type.split("x"),w=0,h=0;return 2==dimensions.length&&(w=parseInt(dimensions[0]),h=parseInt(dimensions[1])),{width:w,height:h}},getImagesHeight:function(){var image_dimension=this.getImageDimension();return image_dimension.height},getImagesWidth:getWidgetLinks:function(){return this.getWidget()&&this.getWidget().links?this.getWidget().links:null},getModuleType:function(){return this.getSettings().display_type},getWidgetSectionLinks:getLinkThumbnailUrl:function(link){return link.thumbnail_url?link.thumbnail_url:null},getImageHtml:function(link,className){return className=className!==void 0?className:"ctx-nodefs","<img "+(link.thumbnail_alt?" alt='"+this.escape(link.thumbnail_alt)+"' ":"")+" src='"+this.escape(link.thumbnail_url)+"' class='"+this.escape(className)+"'"+" width='"+this.getImagesWidth()+"'"+" height='"+this.getImagesHeight()+"'"+" loading='lazy' />"},getLinkIconHTML:escape:getEventTrackingHtml:function(link){var onmousedown="";link.video||(onmousedown+="this.href="+JSON.stringify(link.url)+";");var settings=this.getSettings();return settings&&settings.utm_enable&&(onmousedown+=this.getTrackLinkJS(link)),""===onmousedown?"":' onmousedown="'+this.escape(onmousedown)+'"'},getLinkATag:function(link,content){var attributes=this.renderAttributes({href:link.native_url,title:Contextly.Utils.htmlToText(link.title),"class":"ctx-clearfix ctx-nodefs"})+this.getEventTrackingHtml(link);return"<a"+attributes+">"+content+"</a>"},getVideoLinkATag:function(link,content){var attributes=this.renderAttributes({rel:"ctx-video-dataurl","class":"ctx-clearfix ctx-nodefs",href:link.native_url,title:Contextly.Utils.htmlToText(link.title),"contextly-url":link.url})+this.getEventTrackingHtml(link);return"<a"+attributes+">"+content+"</a>"},getTweetLinkATag:function(link,content){var attributes=this.renderAttributes({rel:"ctx-tweet-dataurl","class":"ctx-clearfix ctx-nodefs",href:link.native_url,title:Contextly.Utils.htmlToText(link.title),"contextly-url":link.url})+this.getEventTrackingHtml(link);return"<a"+attributes+">"+content+"</a>"},getTrackLinkJS:function(link){var widget_type=JSON.stringify(this.getWidgetType()),link_type=JSON.stringify(link.type),link_url=JSON.stringify(link.url),link_title=JSON.stringify(link.title),ga_tracker_name=null;return this.getSettings().ga_name&&(ga_tracker_name=JSON.stringify(this.getSettings().ga_name)),"Contextly.widget.PageEvents.trackLink("+widget_type+","+link_type+","+link_url+","+link_title+","+ga_tracker_name+");"},getLinkHTML:function(link,index){return link.video?this.getLinkHTMLVideo(link,index):link.tweet?this.getLinkHTMLTweet(link,index):this.getLinkHTMLNormal(link,index)},getInnerLinkHTML:function(link){return link.title},getLinkHTMLVideo:function(link,index){return"<div class='ctx-link ctx-"+this.escape(index)+"'>"+this.getVideoLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getLinkHTMLTweet:function(link,index){return"<div class='ctx-link ctx-"+this.escape(index)+"'>"+this.getTweetLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getLinkHTMLNormal:function(link,index){return"<div class='ctx-link ctx-"+this.escape(index)+"'>"+"<div class='ctx-link-title'>"+this.getLinkATag(link,this.getInnerLinkHTML(link))+"</div>"+"</div>"},isDisplayContextlyLogo:function(){var settingsOverride=Contextly.Settings.isBrandingDisplayed(),settingsCss=!0;return this.getSettings().css&&Object.prototype.hasOwnProperty.call(this.getSettings().css,"show_contextly_logo")&&(settingsCss=this.getSettings().css.show_contextly_logo),settingsOverride&&settingsCss},getBrandingButtonHtml:function(){if(!this.isDisplayContextlyLogo())return"";var classes=["ctx-branding","ctx-clearfix"];Contextly.Browser.hasSvg()||classes.push("ctx-no-svg");var div="<div class='"+this.escape(classes.join(" "))+"'>";return div+="<a href='https://contextly.com' class='ctx-branding-link ctx-nodefs'>Powered by</a>",div+="</div>"},attachBrandingHandlers:function(){this.isDisplayContextlyLogo()&&this.getWidgetContainers().find(".ctx-branding-link").on("click",this.proxy(!1,!0))}})}(Contextly.DOM),function(){Contextly.widget.BaseFlatLinksList=Contextly.createClass({extend:Contextly.widget.BaseLinksList,getLinksHTML:function(){var html="";if(this.hasWidgetData())for(var limit=this.getLinksLimit(),links=this.widget.links,i=0;links.length>i&&!(limit&&i>=limit);i++){var link=links[i];link&&link.id&&link.title&&(html+=this.getLinkHTML(link,i+1))}return html},hasWidgetData:)}(),function($){Contextly.widget.TextSnippet=Contextly.createClass({extend:[Contextly.widget.BaseLinksList,Contextly.widget.ViewHandler],construct:function(){Contextly.widget.BaseLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.SNIPPET},destroyReferences:function(){Contextly.widget.ViewHandler.fn.destroyReferences.apply(this,arguments),Contextly.widget.BaseLinksList.fn.destroyReferences.apply(this,arguments)},getWidgetStyleClass:function(){return"ctx-content-text"},getWidgetClasses:function(){var classes=["ctx-module","ctx-nodefs",this.getWidgetStyleClass()];return Contextly.Browser.hasSvg()||classes.push("ctx-no-svg"),classes},getWidgetHTML:function(){var i,section_name,div="",sections=[];for(i=0;this.widget.settings.display_sections.length>i;i++)section_name=this.widget.settings.display_sections[i],this.isDisplaySection(section_name)&&sections.push(section_name);for(div+="<div class='"+this.escape(this.getWidgetClasses().join(" "))+"'>",div+="<div class='ctx-sections-container ctx-clearfix'>",i=0;sections.length>i;i++){section_name=sections[i];var section_key=section_name+"_subhead",section_header=this.widget.settings[section_key],section_classes=["ctx-section","ctx-section-"+section_name];0===i%2?i+1===sections.length?section_classes.push("ctx-wide"):section_classes.push("ctx-odd"):section_classes.push("ctx-even"),div+="<div class='"+this.escape(section_classes.join(" "))+"'>",section_header&&(div+="<div class='ctx-links-header'><p class='ctx-nodefs'>"+this.escape(section_header)+"</p></div>"),div+="<div class='ctx-links-content'>"+this.getLinksHTMLOfType(section_name)+"</div>",div+="</div>"}return div+="</div>",div+="</div>",div+=this.getBrandingButtonHtml()},hasWidgetData:function(){if(this.widget.links){var links=this.widget.links;for(var prop in links)if(links.hasOwnProperty(prop)&&links[prop].length)return!0}return!1},getLinksHTMLOfType:function(type){var html="",widget=this.widget;if(widget.links&&widget.links[type]){var placeCounter=0;for(var link_idx in widget.links[type]){var link=widget.links[type][link_idx];link.id&&link.title&&(html+=this.getLinkHTML(link,++placeCounter))}}return html},getInnerLinkHTML:function(link){var icon=this.getLinkIconHTML(link);return""===icon&&(icon='<span class="ctx-icon ctx-bullet"></span>'),icon+link.title},getHandlers:function(widgetHasData){var handlers=Contextly.widget.BaseLinksList.fn.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.attachLinksPopups=!0,handlers.attachBrandingHandlers=!0,Contextly.Settings.isAdmin()||(handlers.attachWidgetViewHandler=!0)),handlers},getCustomCssCode:function(){return Contextly.widget.TextCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},buildLayoutClass:function(mode){return"ctx-module-"+mode},getLayoutModes:function(){return{mobile:[0,450],"default":[450]}},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-section .ctx-link").first()},broadcastWidgetDisplayed:function(){Contextly.widget.BaseLinksList.fn.broadcastWidgetDisplayed.apply(this,arguments);var apiSession=this.experienceClient.getApiSession();apiSession.hasId()&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:apiSession.getId(),event_success:!1,event_payload:{visible:$(".ctx-section").first().find(".ctx-link").isVisible().length}})},display:function(){if(this.widget&&this.widget.settings&&this.widget.settings.personalized_enabled){var callback=this.proxy(this.onPersonalizedModuleReceived,!1,!0);this.experienceClient.call("personalization","recommendations",{widget_type:this.widget_type},callback)}else Contextly.widget.BaseLinksList.fn.display.apply(this,arguments)},onPersonalizedModuleReceived:function(response){response.success&&response.entry&&(this.widget.links=response.entry.links||[],Contextly.widget.BaseLinksList.fn.display.apply(this,arguments))}})}(Contextly.DOM),function(){Contextly.widget.BaseBlocksSnippet=Contextly.createClass({extend:[Contextly.widget.TextSnippet],destroyReferences:function(){Contextly.widget.TextSnippet.fn.destroyReferences.apply(this,arguments)},getLinksLimit:getLinksHTMLOfType:function(type){var html="",widget=this.widget;if(widget.links&&widget.links[type]){var placeCounter=0,links_limit=this.getLinksLimit();for(var link_idx in widget.links[type]){var link=widget.links[type][link_idx];if(placeCounter++,placeCounter>links_limit)break;link.id&&link.title&&(html+=this.getLinkHTML(link,placeCounter))}}return html},getWidgetHTML:function(){var div="";div+="<div class='"+this.escape(this.getWidgetClasses().join(" "))+"'>";var sections=this.widget.settings.display_sections;div+="<div class='ctx-sections-container ctx-nomar'>";for(var i=0;sections.length>i;i++){var section_name=sections[i];if(this.isDisplaySection(section_name)){var section_key=section_name+"_subhead",section_header=this.widget.settings[section_key],section_classes=["ctx-section","ctx-clearfix","ctx-section-"+section_name];div+="<div class='"+this.escape(section_classes.join(" "))+"'>",section_header&&(div+="<div class='ctx-links-header'><p class='ctx-nodefs'>"+this.escape(section_header)+"</p></div>"),div+="<div class='ctx-links-content ctx-nodefs ctx-clearfix'>",div+=this.getLinksHTMLOfType(section_name),div+="</div></div>"}}return div+="</div>",div+=this.getBrandingButtonHtml(),div+="</div>"},getLinkHTMLVideo:function(link,linkCounter){return"<div class='ctx-link ctx-"+this.escape(linkCounter)+"'>"+this.getVideoLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getLinkHTMLTweet:function(link,linkCounter){return"<div class='ctx-link ctx-"+this.escape(linkCounter)+"' data-tweet-id='"+this.escape(link.tweet)+"'>"+this.getTweetLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getLinkHTMLNormal:function(link,linkCounter){return"<div class='ctx-link ctx-"+this.escape(linkCounter)+"'>"+this.getLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getLinkMetadataHTML:function(link){var items=[];for(var idx in link.metadata){var item=link.metadata[idx];items.push("<span class='"+this.escape(item.type)+"'>"+this.escape(item.text)+"</span>")}var separatorHtml='<span class="ctx-meta-separator">&bull;</span>',innerHtml=items.join(separatorHtml);return"<div class='ctx-meta'>"+innerHtml+"</div>"}})}(),function($){Contextly.widget.BlocksSnippet=Contextly.createClass({extend:Contextly.widget.BaseBlocksSnippet,destroyReferences:function(){this.getWidgetElements().find(".ctx-link").off("mouseenter").off("mouseleave"),Contextly.widget.BaseBlocksSnippet.fn.destroyReferences.apply(this,arguments)},getHandlers:function(widgetHasData){var handlers=Contextly.widget.BaseBlocksSnippet.fn.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.attachLinksHover=!0),handlers},attachLinksHover:function(){this.getWidgetElements().find(".ctx-link").on("mouseenter",this.proxy(this.onLinkMouseEnter,!0,!0)).on("mouseleave",this.proxy(this.onLinkMouseLeave,!0,!0))},onLinkMouseEnter:function(element){var link=$(element),p=link.find(".ctx-link-title p"),startHeight=p.height();link.addClass("ctx-expanded");var endHeight=p.height();return startHeight>=endHeight?(link.removeClass("ctx-expanded"),void 0):(p.css("height",endHeight),void 0)},onLinkMouseLeave:function(element){var link=$(element),p=link.find(".ctx-link-title p");if(link.is(".ctx-expanded")){var startHeight=p.height();link.removeClass("ctx-expanded"),p.height(),link.addClass("ctx-expanded"),p.css("height",startHeight)}},getInnerLinkHTML:function(link){var inner_html="<div class='ctx-link-title'><p class='ctx-nodefs'>"+this.getLinkIconHTML(link)+" "+link.title+"</p>"+"</div>";return this.getLinkThumbnailUrl(link)&&(inner_html+="<div class='ctx-link-image'>"+this.getImageHtml(link)+"</div>"),inner_html},getWidgetStyleClass:function(){return"ctx-content-block"},getCustomCssCode:function(){return Contextly.widget.BlocksCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},getLayoutModes:function(){return{mobile:[0,200],tablet:[200,450],"default":[450,650],sec5:[650,790],sec6:[790]}}})}(Contextly.DOM),function(){Contextly.widget.Blocks2Snippet=Contextly.createClass({extend:Contextly.widget.BaseBlocksSnippet,getWidgetStyleClass:function(){return"ctx-content-block2"},getInnerLinkHTML:function(link){var inner_html="";return this.getLinkThumbnailUrl(link)&&(inner_html+="<div class='ctx-link-image'>"+this.getImageHtml(link)+"</div>"),inner_html+="<div class='ctx-link-title'><p class='ctx-nodefs'>"+this.getLinkIconHTML(link)+" "+link.title+"</p></div>"},getCustomCssCode:function(){return Contextly.widget.Blocks2CssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},getLayoutModes:function(){return{mobile:[0,400],"default":[400,650],sec5:[650,790],sec6:[790]}}})}(),function(){Contextly.widget.FloatSnippet=Contextly.createClass({extend:Contextly.widget.BaseBlocksSnippet,getWidgetStyleClass:function(){return"ctx-content-float"},getLinksLimit:getInnerLinkHTML:function(link){var inner_html="";return this.getLinkThumbnailUrl(link)&&(inner_html+="<div class='ctx-link-image'>"+this.getImageHtml(link)+"</div>"),inner_html+="<div class='ctx-link-title'><p class='ctx-nodefs'>"+this.getLinkIconHTML(link)+" "+link.title+"</p></div>"},getCustomCssCode:function(){return Contextly.widget.FloatCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},getLayoutModes:function(){return"letter600x315"==this.getSettings().images_type?{mobile:[0,240],medium:[240,400],normal:[400]}:{mobile:[0,240],medium:[240,400],normal:[400,700],wide:[700]}}})}(),function(){Contextly.widget.TextMobileSnippet=Contextly.createClass({extend:[Contextly.widget.TextSnippet],construct:function(){Contextly.widget.TextSnippet.apply(this,arguments),this.widget_type=Contextly.widget.types.SNIPPET_MOBILE},getWidgetStyleClass:function(){return"ctx-content-mobile-text"},getCustomCssCode:function(){return Contextly.widget.TextMobileCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())}})}(Contextly.DOM),function(){Contextly.widget.BlocksMobileSnippet=Contextly.createClass({extend:Contextly.widget.BlocksSnippet,construct:function(){Contextly.widget.BlocksSnippet.apply(this,arguments),this.widget_type=Contextly.widget.types.SNIPPET_MOBILE},getWidgetStyleClass:function(){return"ctx-content-mobile-block"},getCustomCssCode:function(){return Contextly.widget.BlocksMobileCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())}})}(Contextly.DOM),function(){Contextly.widget.Blocks2MobileSnippet=Contextly.createClass({extend:Contextly.widget.Blocks2Snippet,construct:function(){Contextly.widget.Blocks2Snippet.apply(this,arguments),this.widget_type=Contextly.widget.types.SNIPPET_MOBILE},getWidgetStyleClass:function(){return"ctx-content-mobile-block2"},getCustomCssCode:function(){return Contextly.widget.Blocks2MobileCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())}})}(),function(){Contextly.widget.FloatMobileSnippet=Contextly.createClass({extend:Contextly.widget.FloatSnippet,construct:function(){Contextly.widget.FloatSnippet.apply(this,arguments),this.widget_type=Contextly.widget.types.SNIPPET_MOBILE},getWidgetStyleClass:function(){return"ctx-content-mobile-float"},getCustomCssCode:function(){return Contextly.widget.FloatMobileCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())}})}(),function(){Contextly.widget.Sidebar=Contextly.createClass({extend:[Contextly.widget.BaseFlatLinksList,Contextly.Receiver,Contextly.widget.ViewHandler],construct:function(){Contextly.widget.BaseFlatLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.SIDEBAR},getWidgetStyleClass:function(){return"ctx-content-sidebar"},getWidgetHTML:function(){var html="",title=this.widget.name;title&&(html+="<div class='ctx-sb-title'><p>"+this.escape(title)+"</p></div>");var description=this.widget.description;description&&(html+="<div class='ctx-sb-description'><p>"+this.escape(description)+"</p></div>"),html+="<div class='ctx-sb-content'>"+this.getLinksHTML()+"</div>";var classes=["ctx-sidebar",this.getWidgetStyleClass(),"ctx-sidebar-"+this.widget.layout,"ctx-clearfix"];return"<div class='"+this.escape(classes.join(" "))+"'>"+html+"</div>"},getLinkATag:function(link,content){var attributes=this.renderAttributes({href:link.native_url,title:Contextly.Utils.htmlToText(link.title),"class":"ctx-clearfix ctx-nodefs ctx-no-images"})+this.getEventTrackingHtml(link);return"<a"+attributes+">"+content+"</a>"},getLinkHTML:function(link){var html="";if(link.thumbnail_url){var image_href,image_html=this.getImageHtml(link);image_href=link.video?this.getVideoLinkATag(link,image_html):this.getLinkATag(link,image_html),html+="<div class='ctx-sb-img'>"+image_href+"</div>"}var linkContent=link.title;link.thumbnail_url||(linkContent='<span class="ctx-icon ctx-bullet"></span>'+linkContent),this.widget.settings.display_link_dates&&link.publish_date&&(linkContent+="<br /><span class='ctx-pub-date'>"+this.textualDateDiffHTML(link.publish_date)+"</span>");var a;a=link.video?this.getVideoLinkATag(link,linkContent):this.getLinkATag(link,linkContent);var classes=["ctx-sb-text"];return link.thumbnail_url||classes.push("ctx-sb-no-thumbnail"),html+="<div class='"+this.escape(classes.join(" "))+"'><p>"+a+"</p></div>",html="<div class='ctx-sb-link'><div class='ctx-sb-fotmater ctx-clearfix'>"+html+"</div></div>"},textualDateDiffHTML:function(date){if(date&&date.length>4){var ending,t=date.split(/[- :]/),js_date=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]),timestamp=js_date.getTime()/1e3,difference=(new Date).getTime()/1e3-timestamp,periods=Array("sec","min","hour","day","week","month","year","decade"),lengths=Array("60","60","24","7","4.35","12","10");if(!(difference>0))return"right now";ending="ago";for(var j=0;difference>=lengths[j];j++)difference/=lengths[j];return difference=Math.round(difference),1!=difference&&(periods[j]+="s"),difference+"&nbsp;"+periods[j]+"&nbsp;"+ending}},getCustomCssCode:function(){return Contextly.widget.SidebarCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},setUpResponsiveLayout:function(){if("wide"===this.widget.layout){var elements=this.getWidgetElements();this.eachElement(elements,function(element){this.setLayoutMode(element,"mobile")})}else Contextly.widget.BaseFlatLinksList.prototype.setUpResponsiveLayout.apply(this,arguments)},getLayoutModes:function(){return{mobile:[0,400],"default":[400]}},checkLayoutThresholds:function(){var elements=this.getWidgetElements();if(540>=this.getScreenWidth())this.eachElement(elements,function(element){this.setLayoutMode(element,"mobile")});else{var modes=this.getLayoutModes();this.eachElement(elements,function(element){var width=element.parent().width();this.each(modes,function(thresholds,name){return this.sizeMatchesThresholds(width,thresholds)?(this.setLayoutMode(element,name),!1):void 0})})}},buildLayoutClass:function(mode){return"ctx-sidebar-"+mode},broadcastWidgetDisplayed:function(){if(Contextly.widget.Base.fn.broadcastWidgetDisplayed.apply(this,arguments),this.containers.getElements()&&this.containers.getElements().length&&this.widget.links){var apiSession=this.experienceClient.getApiSession();apiSession.hasId()&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:apiSession.getId(),event_success:!1})}},getHandlers:function(){var handlers=Contextly.widget.BaseFlatLinksList.prototype.getHandlers.apply(this,arguments);return handlers.attachWidgetViewHandler=!0,handlers},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-sb-link").first()}})}(Contextly.DOM),function(){Contextly.widget.SidebarCinema=Contextly.createClass({extend:Contextly.widget.Sidebar,getWidgetStyleClass:function(){return"ctx-content-sidebar"},buildLayoutClass:function(mode){return"ctx-module-"+mode},getWidgetHTML:function(){var html="",title=this.widget.name;title&&(html+="<div class='ctx-sb-title'><p>"+this.escape(title)+"</p></div>");var description=this.widget.description;description&&(html+="<div class='ctx-sb-description'><p>"+this.escape(description)+"</p></div>"),html+="<div class='ctx-sb-content'>"+this.getLinksHTML()+"</div>";var classes=["ctx-sidebar",this.getWidgetStyleClass(),"ctx-sidebar-"+this.widget.layout,"ctx-sidebar-cinema","ctx-clearfix"];return"<div class='"+this.escape(classes.join(" "))+"'>"+html+"</div>"},getLinkHTML:getInnerLinkHTML:function(link){var inner_html="";return this.getLinkThumbnailUrl(link)&&(inner_html+="<div class='ctx-link-image'>"+this.getImageHtml(link)+"</div>"),inner_html+="<div class='ctx-link-title'><p class='ctx-nodefs'>"+this.getLinkIconHTML(link)+" "+link.title+"</p></div>"},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-link").first()},setUpResponsiveLayout:getLayoutModes:function(){return"letter600x315"===this.getSettings().images_type?{mobile:[0,240],medium:[240,400],normal:[400]}:3==this.getSettings().links_limit||3==this.widget.links.length?{mobile:[0,240],medium:[240,400],normal:[400]}:{mobile:[0,240],medium:[240,400],normal:[400,700],wide:[700]}}})}(),function(){Contextly.widget.AutoSidebar=Contextly.createClass({extend:Contextly.widget.Sidebar,construct:function(){Contextly.widget.BaseLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.AUTO_SIDEBAR,this.widget.id||(this.widget.name=this.widget.settings.default_name,this.widget.description=this.widget.settings.default_description,this.widget.layout=this.widget.settings.default_layout)},getCustomCssCode:function(){return Contextly.widget.SidebarCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},display:function(){return this.getWidgetContainers().length?Contextly.widget.Sidebar.fn.display.apply(this,arguments):void 0}})}(),function(){Contextly.widget.AutoSidebarCinema=Contextly.createClass({extend:Contextly.widget.SidebarCinema,construct:function(){Contextly.widget.SidebarCinema.apply(this,arguments),this.widget_type=Contextly.widget.types.AUTO_SIDEBAR,this.widget.id||(this.widget.name=this.widget.settings.default_name,this.widget.description=this.widget.settings.default_description,this.widget.layout=this.widget.settings.default_layout)}})}(),function(){Contextly.widget.Siderail=Contextly.createClass({extend:[Contextly.widget.BaseFlatLinksList,Contextly.Receiver,Contextly.widget.ViewHandler],construct:function(){Contextly.widget.BaseFlatLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.SIDERAIL},getWidgetStyleClass:function(){return"ctx-siderail-"+this.getSettings().theme},getWidgetHTML:function(){var html="",s=this.getSettings();s.title&&(html+="<div class='ctx-sr-title'><p>"+this.escape(s.title)+"</p></div>"),html+="<div class='ctx-sr-content'>"+this.getLinksHTML()+"</div>";var classes=["ctx-siderail",this.getWidgetStyleClass()];return"<div class='"+this.escape(classes.join(" "))+"'>"+html+"</div>"},getLinkATag:function(link,content){var attributes=this.renderAttributes({href:link.native_url,title:Contextly.Utils.htmlToText(link.title),"class":"ctx-clearfix ctx-nodefs"})+this.getEventTrackingHtml(link);return"<a"+attributes+">"+content+"</a>"},getLinkHTML:function(link,index){var link_content="";link.thumbnail_url&&(link_content="<div class='ctx-link-image'>"+this.getImageHtml(link)+"</div>");var title=link.title,icon=this.getLinkIconHTML(link);icon&&(title=icon+" "+title),link_content+="<div class='ctx-link-title'><p class='ctx-nodefs'>"+title+"</p></div>";var a;a=link.video?this.getVideoLinkATag(link,link_content):this.getLinkATag(link,link_content);var classes=["ctx-link","ctx-"+index];return link.thumbnail_url||classes.push("ctx-no-thumbnail"),"<div class='"+this.escape(classes.join(" "))+"'>"+a+"</div>"},getHandlers:function(widgetHasData){var handlers=Contextly.widget.BaseFlatLinksList.prototype.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.attachLinksPopups=!0,handlers.attachWidgetViewHandler=!0),handlers},getCustomCssCode:function(){return Contextly.widget.SiderailCssCustomBuilder.buildCSS("."+this.getWidgetStyleClass(),this.getSettings())},broadcastWidgetDisplayed:function(){if(Contextly.widget.Base.fn.broadcastWidgetDisplayed.apply(this,arguments),this.containers.getElements()&&this.containers.getElements().length&&this.widget.links){var apiSession=this.experienceClient.getApiSession();apiSession.hasId()&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:apiSession.getId(),event_success:!1})}},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-link").first()}})}(Contextly.DOM),function(){Contextly.widget.SiderailHSquare=Contextly.createClass({extend:Contextly.widget.Siderail,getLinksLimit:function(){return 6},buildLayoutClass:function(mode){return"ctx-siderail-"+mode},getHandlers:function(widgetHasData){var handlers=Contextly.widget.Siderail.prototype.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.setUpResponsiveLayout=!0),handlers},getLayoutModes:function(){return{sec1:[0,236],sec2:[236,414],sec3:[414,592],sec4:[592,740],sec5:[740,888],sec6:[888]}}})}(),function(){Contextly.widget.SiderailHLetter=Contextly.createClass({extend:Contextly.widget.SiderailHSquare,getLayoutModes:function(){return{sec1:[0,296],sec2:[296,489],sec3:[489,712],sec4:[712,990],sec5:[990,1188],sec6:[1188]}}})}(),function(){Contextly.widget.StoryLineSubscribe=Contextly.createClass({extend:[Contextly.widget.Base,Contextly.widget.ViewHandler],construct:function(){Contextly.widget.Base.apply(this,arguments),this.widget_type=Contextly.widget.types.STORYLINE_SUBSCRIBE},destroyReferences:function(){this.getWidgetContainers().find(".ctx-subscribe-link").unbind("click"),Contextly.widget.Base.fn.destroyReferences.apply(this,arguments)},getWidgetLogoHTML:function(){var s=this.getSettings(),iconClasses=["ctx-subscribe-logo"];return"single-color"===s.css.logo?iconClasses.push("ctx-icon","ctx-icon-logo"):iconClasses.push("ctx-image-logo"),'<i class="'+this.escape(iconClasses.join(" "))+'"></i>'},getWidgetLabelHTML:function(){return'<span class="ctx-subscribe-label">'+this.escape(this.getSettings().title)+"</span>"},getWidgetHTML:function(){var s=this.getSettings(),linkClasses=["ctx-subscribe-link",this.getWidgetStyleClass()];return linkClasses.push("ctx-height-"+(s.css.height||"middle")),s.css.button_shadow&&linkClasses.push("ctx-box-shadow"),s.css.text_shadow&&linkClasses.push("ctx-text-shadow"),Contextly.Browser.hasSvg()||linkClasses.push("ctx-no-svg"),'<a href="javascript:" class="'+this.escape(linkClasses.join(" "))+'">'+'<span class="ctx-subscribe-row">'+this.getWidgetLogoHTML()+this.getWidgetLabelHTML()+"</span>"+"</a>"},attachStoryLineButtonHandler:function(){this.getWidgetContainers().find(".ctx-subscribe-link").bind("click",this.proxy(this.displayStoryLinePopup,!1,!0))},displayStoryLinePopup:function(e){e.preventDefault(),Contextly.overlay.StoryLineSubscribe.open({subscribe_newsletter:this.widget.settings.subscribe_newsletter,subscribe_newsletter_title:this.widget.settings.subscribe_newsletter_title,experienceClient:this.experienceClient,settings:this.widget.settings})},getCustomCssCode:function(){var entry={container:"."+this.containers.getTypeClass(),widget:"."+this.containers.getTypeClass()+" .ctx-subscribe-link."+this.getWidgetStyleClass()};return Contextly.widget.StorylineSubscribeCssCustomBuilder.buildCSS(entry,this.getSettings())},getWidgetStyleClass:function(){var theme=this.getSettings().theme||"transparent";return"ctx-theme-"+theme},suppressTransitions:function(){var selector,containers=this.getWidgetContainers();selector="split-button"===this.getSettings().theme?".ctx-subscribe-label, .ctx-subscribe-logo":".ctx-subscribe-link";var suppressed=containers.find(selector).addClass("ctx-no-transitions");setTimeout(function(){suppressed.removeClass("ctx-no-transitions")},1)},display:function(){var widget_html=this.getWidgetHTML();this.displayHTML(widget_html),this.suppressTransitions(),this.attachHandlers(),this.broadcastWidgetDisplayed()},getHandlers:function(){var handlers=Contextly.widget.Base.prototype.getHandlers.apply(this,arguments);return handlers.attachStoryLineButtonHandler=!0,handlers.attachWidgetViewHandler=!0,handlers},broadcastWidgetDisplayed:function(){Contextly.widget.Base.fn.broadcastWidgetDisplayed.apply(this,arguments);var apiSession=this.experienceClient.getApiSession();apiSession.hasId()&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:apiSession.getId(),event_success:!1})},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-subscribe-row")}})}(),function(){Contextly.widget.PersonalizationSubscribe=Contextly.createClass({extend:[Contextly.widget.Base,Contextly.Receiver,Contextly.widget.ViewHandler],construct:function(){Contextly.widget.Base.apply(this,arguments),this.widget_type=Contextly.widget.types.PERSONALIZATION_SUBSCRIBE},destroyReferences:function(){this.getWidgetContainers().find(".ctx-personalization-link").unbind("click"),Contextly.widget.Base.fn.destroyReferences.apply(this,arguments),Contextly.widget.ViewHandler.fn.destroyReferences.apply(this,arguments)},getWidgetLogoHTML:function(){var s=this.getSettings(),iconClasses=["ctx-subscribe-logo"];return"single-color"===s.css.logo?iconClasses.push("ctx-icon","ctx-icon-logo"):iconClasses.push("ctx-image-logo"),'<i class="'+this.escape(iconClasses.join(" "))+'"></i>'},getWidgetLabelHTML:function(){var title="",linksCount=this.getWidget().links.length;return title=linksCount?this.getSettings().title+" ("+linksCount+")":this.getSettings().title_empty,'<span class="ctx-subscribe-label">'+this.escape(title)+"</span>"},getWidgetHTML:function(){var s=this.getSettings(),linkClasses=["ctx-personalization-link","ctx-story-button",this.getWidgetStyleClass()];return linkClasses.push("ctx-height-"+(s.css.height||"middle")),s.css.button_shadow&&linkClasses.push("ctx-box-shadow"),s.css.text_shadow&&linkClasses.push("ctx-text-shadow"),Contextly.Browser.hasSvg()||linkClasses.push("ctx-no-svg"),'<a href="javascript:" class="'+this.escape(linkClasses.join(" "))+'">'+'<span class="ctx-subscribe-row">'+this.getWidgetLogoHTML()+this.getWidgetLabelHTML()+"</span>"+"</a>"},attachPersonalizationButtonHandler:function(){this.getWidgetContainers().find(".ctx-personalization-link").bind("click",this.proxy(this.displayPersonalizationPopup,!1,!0))},displayPersonalizationPopup:function(e){e.preventDefault();var data=this.getWidget();Contextly.overlay.PersonalizationSubscribe.open({links:data.links,subscription:data.settings.subscription,subscribed:data.subscribed,confirmed:data.confirmed,experienceClient:this.experienceClient})},getCustomCssCode:function(){var entry={container:"."+this.containers.getTypeClass(),widget:"."+this.containers.getTypeClass()+" .ctx-personalization-link."+this.getWidgetStyleClass()};return Contextly.widget.StorylineSubscribeCssCustomBuilder.buildCSS(entry,this.getSettings())},getWidgetStyleClass:function(){var theme=this.getSettings().theme||"transparent";return"ctx-theme-"+theme},suppressTransitions:function(){var selector,containers=this.getWidgetContainers();selector="split-button"===this.getSettings().theme?".ctx-subscribe-label, .ctx-subscribe-logo":".ctx-personalization-link";var suppressed=containers.find(selector).addClass("ctx-no-transitions");setTimeout(function(){suppressed.removeClass("ctx-no-transitions")},1)},display:function(){var callback=this.proxy(this.onRecommendationsReceived,!1,!0);this.experienceClient.call("personalization","button",{},callback)},onRecommendationsReceived:function(response){if(response.success&&response.entry&&(this.widget.links=response.entry.stories||[],this.widget.links.length||this.getSettings().subscription)){this.widget.subscribed=response.entry.subscribed||!1,this.widget.confirmed=response.entry.confirmed||!1,this.displayButton();var broadcastType=Contextly.widget.PersonalizationSubscribe.broadcastTypes.STATUS;this.receive(broadcastType,this.proxy(this.onPersonalizationStatusChange,!1,!0))}},displayButton:function(){var widget_html=this.getWidgetHTML();this.appendSpace(),this.appendHTML(widget_html),this.appendSpace(),this.suppressTransitions(),this.attachHandlers(),this.broadcastWidgetDisplayed()},appendSpace:function(){var textNode=document.createTextNode(" ");this.getWidgetContainers().append(textNode)},onPersonalizationStatusChange:function(e,status){var keys={subscribed:!0,confirmed:!0};for(var key in keys)this.widget[key]=status[key]},getHandlers:function(){var handlers=Contextly.widget.Base.prototype.getHandlers.apply(this,arguments);return handlers.attachPersonalizationButtonHandler=!0,handlers.attachWidgetViewHandler=!0,handlers},broadcastWidgetDisplayed:function(){Contextly.widget.Base.fn.broadcastWidgetDisplayed.apply(this,arguments);var apiSession=this.experienceClient.getApiSession();apiSession.hasId()&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:apiSession.getId(),event_success:!1})},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-subscribe-row")}}),Contextly.widget.PersonalizationSubscribe.broadcastTypes={STATUS:"contextlyPersonalizationStatus"}}(),function(){Contextly.widget.ChannelSubscribe=Contextly.createClass({extend:[Contextly.widget.Base,Contextly.Receiver,Contextly.widget.ViewHandler],construct:function(){Contextly.widget.Base.apply(this,arguments),this.widget_type=Contextly.widget.types.CHANNEL_SUBSCRIBE},destroyReferences:function(){this.detachChannelButtonHandler(),this.detachChannelStatusUpdateHandler(),Contextly.widget.Base.fn.destroyReferences.apply(this,arguments)},getWidgetLogoHTML:function(){var s=this.getSettings(),iconClasses=["ctx-subscribe-logo"];return"single-color"===s.css.logo?iconClasses.push("ctx-icon","ctx-icon-logo"):iconClasses.push("ctx-image-logo"),'<i class="'+this.escape(iconClasses.join(" "))+'"></i>'},getWidgetLabelHTML:function(){var data=this.getWidget(),title=(this.getSettings().title+"").replace("%channel%",data.channel_name).replace("%site%",data.site_name);return'<span class="ctx-subscribe-label">'+this.escape(title)+"</span>"},getWidgetHTML:function(){var s=this.getSettings(),linkClasses=["ctx-channel-link","ctx-story-button",this.getWidgetStyleClass()];return linkClasses.push("ctx-height-"+(s.css.height||"middle")),s.css.button_shadow&&linkClasses.push("ctx-box-shadow"),s.css.text_shadow&&linkClasses.push("ctx-text-shadow"),Contextly.Browser.hasSvg()||linkClasses.push("ctx-no-svg"),'<a href="javascript:" class="'+this.escape(linkClasses.join(" "))+'">'+'<span class="ctx-subscribe-row">'+this.getWidgetLogoHTML()+this.getWidgetLabelHTML()+"</span>"+"</a>"},attachChannelButtonHandler:function(){this.getWidgetContainers().find(".ctx-channel-link").on("click",this.proxy(this.displayChannelPopup,!1,!0))},detachChannelButtonHandler:function(){this.getWidgetContainers().find(".ctx-channel-link").off("click")},attachChannelStatusUpdateHandler:function(){var broadcastType=Contextly.widget.ChannelSubscribe.broadcastTypes.STATUS;this.receive(broadcastType,this.proxy(this.onChannelStatusChange,!1,!0))},detachChannelStatusUpdateHandler:function(){var broadcastType=Contextly.widget.ChannelSubscribe.broadcastTypes.STATUS;this.ignore(broadcastType,this.onChannelStatusChange)},displayChannelPopup:function(e){e.preventDefault();var data=this.getWidget();Contextly.overlay.ChannelSubscribe.open({channel:data.channel,channel_name:data.channel_name,site_name:data.site_name,subscribe_newsletter:data.settings.subscribe_newsletter,subscribe_newsletter_title:data.settings.subscribe_newsletter_title,subscribed:data.subscribed,confirmed:data.confirmed,experienceClient:this.experienceClient,settings:this.widget.settings})},getCustomCssCode:function(){var entry={container:"."+this.containers.getTypeClass(),widget:"."+this.containers.getTypeClass()+" .ctx-channel-link."+this.getWidgetStyleClass()};return Contextly.widget.StorylineSubscribeCssCustomBuilder.buildCSS(entry,this.getSettings())},getWidgetStyleClass:function(){var theme=this.getSettings().theme||"transparent";return"ctx-theme-"+theme},suppressTransitions:function(){var selector,containers=this.getWidgetContainers();selector="split-button"===this.getSettings().theme?".ctx-subscribe-label, .ctx-subscribe-logo":".ctx-channel-link";var suppressed=containers.find(selector).addClass("ctx-no-transitions");setTimeout(function(){suppressed.removeClass("ctx-no-transitions")},1)},display:function(){var widget_html=this.getWidgetHTML();this.appendSpace(),this.appendHTML(widget_html),this.appendSpace(),this.suppressTransitions(),this.attachHandlers(),this.broadcastWidgetDisplayed()},appendSpace:function(){var textNode=document.createTextNode(" ");this.getWidgetContainers().append(textNode)},onChannelStatusChange:function(e,status){if(status.channel&&this.getWidget().channel==status.channel){var keys={subscribed:!0,confirmed:!0};for(var key in keys)this.widget[key]=status[key]}},getHandlers:function(){var handlers=Contextly.widget.Base.prototype.getHandlers.apply(this,arguments);return handlers.attachChannelButtonHandler=!0,handlers.attachChannelStatusUpdateHandler=!0,handlers.attachWidgetViewHandler=!0,handlers},broadcastWidgetDisplayed:function(){Contextly.widget.Base.fn.broadcastWidgetDisplayed.apply(this,arguments);var apiSession=this.experienceClient.getApiSession();apiSession.hasId()&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:apiSession.getId(),event_success:!1})},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-subscribe-row")}}),Contextly.widget.ChannelSubscribe.broadcastTypes={STATUS:"contextlyChannelStatus"}}(),function($){Contextly.widget.ChannelSubscribeForm=Contextly.createClass({extend:[Contextly.widget.Base,Contextly.Receiver,Contextly.widget.ViewHandler,Contextly.widget.ResponsiveLayout],construct:function(){Contextly.widget.Base.apply(this,arguments),this.widget_type=Contextly.widget.types.CHANNEL_SUBSCRIBE_FORM,this.form=$("."+this.containers.getTypeClass())},destroyReferences:function(){this.detachChannelButtonHandler(),this.detachChannelStatusUpdateHandler(),Contextly.widget.Base.fn.destroyReferences.apply(this,arguments),Contextly.widget.ResponsiveLayout.fn.destroyReferences.apply(this,arguments)},getWidgetLabelHTML:function(){return'<span class="ctx-subscribe-label">Follow the Channel</span>'},buildLayoutClass:function(mode){return"ctx-layout-"+mode},getWidgetHTML:function(){this.getSettings();var classes=["ctx-channel-form-container",this.buildLayoutClass(this.widget.settings.layout),"ctx-clearfix"],linkClasses=["ctx-channel-link"],data=this.getWidget(),title=(this.getSettings().title+"").replace("%channel%",data.channel_name).replace("%site%",data.site_name),description=this.getSettings().description;return"<div class='"+this.escape(classes.join(" "))+"'>"+'<div class="ctx-title-row">'+this.escape(title)+"</div>"+'<div class="ctx-description-row">'+this.escape(description)+"</div>"+'<div class="ctx-message-row"></div>'+'<div class="ctx-email-row ctx-input-row">'+'<input type="email" class="ctx-email" placeholder="Email address" />'+'<input type="submit" class="'+this.escape(linkClasses.join(" "))+'" value="Sign up" />'+"</div>"+"</div>"},attachChannelButtonHandler:function(){this.getWidgetContainers().find(".ctx-channel-link").on("click",this.proxy(this.subscribeToChannelHandler,!1,!0))},subscribeToChannelHandler:function(){var data=this.getWidget(),params={channel:data.channel},email=Contextly.Utils.trim(this.getEmailInput().val());return email&&Contextly.Utils.isEmailValid(email)?(params.email=email,this.subscribeToChannel(params),void 0):(this.errorMessage("Please enter a valid email address."),void 0)},subscribeToChannel:function(params){params=params||{},this.lockSubscriptionUI(),this.hideMessage();var callback=this.proxy(this.onSubscribeComplete,!1,!0);this.experienceClient.call("channels","subscribe",params,callback)},onSubscribeComplete:function(response){var data=this.getWidget();if(response&&response.success)response.confirmed?this.successMessage("We added the "+data.channel_name+" Channel to your FollowUp list."):this.successMessage("Almost done! Check your email.");else{var message="Something went wrong.";response&&response.error&&(message=response.error),this.errorMessage(message),this.unlockSubscriptionUI(),this.focusEmailInput()}},detachChannelButtonHandler:function(){this.getWidgetContainers().find(".ctx-channel-link").off("click")},attachChannelStatusUpdateHandler:function(){var broadcastType=Contextly.widget.ChannelSubscribe.broadcastTypes.STATUS;this.receive(broadcastType,this.proxy(this.onChannelStatusChange,!1,!0))},detachChannelStatusUpdateHandler:function(){var broadcastType=Contextly.widget.ChannelSubscribe.broadcastTypes.STATUS;this.ignore(broadcastType,this.onChannelStatusChange)},getMessage:function(){return this.getWidgetContainers().find(".ctx-message-row")},getEmailInput:function(){return this.getWidgetContainers().find(".ctx-email")},hideMessage:showMessage:function(text,className){var message=this.getMessage(),fadeIn=this.proxy(function(){message.removeClass("ctx-success ctx-error ctx-info").addClass(className).text(text)});message.show(),fadeIn()},errorMessage:function(message){this.showMessage(message,"ctx-error")},successMessage:function(message){this.getInputRows().hide(),this.showMessage(message,"ctx-success")},getInputs:getInputRows:function(){return this.getWidgetContainers().find(".ctx-input-row")},getSubmit:function(){return this.getWidgetContainers().find(".ctx-channel-link")},lockSubscriptionUI:function(){this.getInputs().attr("disabled","disabled"),this.getInputRows().addClass("ctx-progress"),this.getSubmit().attr("disabled","disabled").not(".ctx-progress").addClass("ctx-progress")},unlockSubscriptionUI:function(){this.getInputs().removeAttr("disabled"),this.getInputRows().removeClass("ctx-progress"),this.getSubmit().removeAttr("disabled").removeClass("ctx-progress")},getCustomCssCode:function(){var entry={container:"."+this.containers.getTypeClass(),widget:"."+this.containers.getTypeClass()+" ."+this.getWidgetStyleClass()};return Contextly.widget.ChannelFormSubscribeCssCustomBuilder.buildCSS(entry,this.getSettings())},display:function(){var widget_html=this.getWidgetHTML();this.appendSpace(),this.appendHTML(widget_html),this.appendSpace(),this.attachHandlers(),this.broadcastWidgetDisplayed()},appendSpace:function(){var textNode=document.createTextNode(" ");this.getWidgetContainers().append(textNode)},onChannelStatusChange:function(e,status){if(status.channel&&this.getWidget().channel==status.channel){var keys={subscribed:!0,confirmed:!0};for(var key in keys)this.widget[key]=status[key]}},getHandlers:function(){var handlers=Contextly.widget.Base.prototype.getHandlers.apply(this,arguments);return handlers.attachChannelButtonHandler=!0,handlers.attachChannelStatusUpdateHandler=!0,handlers.attachWidgetViewHandler=!0,handlers.setUpResponsiveLayout=!0,handlers},broadcastWidgetDisplayed:function(){Contextly.widget.Base.fn.broadcastWidgetDisplayed.apply(this,arguments);var apiSession=this.experienceClient.getApiSession();apiSession.hasId()&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:apiSession.getId(),event_success:!1})},findViewWatcherElement:getWidgetStyleClass:function(){return"ctx-channel-form-container"},getScreenWidth:getLayoutModes:function(){return{mobile:[0,400],"default":[400]}},checkLayoutThresholds:function(){var elements=this.getWidgetElements();if(540>=this.getScreenWidth())this.eachElement(elements,;else{var modes=this.getLayoutModes();this.eachElement(elements,function(element){var width=element.parent().width();this.each(modes,function(thresholds,name){return this.sizeMatchesThresholds(width,thresholds)?(this.setLayoutMode(element,name),!1):void 0})})}}}),Contextly.widget.ChannelSubscribe.broadcastTypes={STATUS:"contextlyChannelStatus"}}(Contextly.DOM),function(){Contextly.widget.PersonalizedDefault=Contextly.createClass({extend:Contextly.widget.TextSnippet,construct:function(){Contextly.widget.TextSnippet.apply(this,arguments)},getWidgetClasses:function(){var classes=["ctx-personalized",this.getWidgetStyleClass()];return Contextly.Browser.hasSvg()||classes.push("ctx-no-svg"),classes},getCustomCssCode:function(){return Contextly.widget.PersonalizedDefaultCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings(),this.getWidgetStyleClass())},display:function(){var callback=this.proxy(this.onRecommendationsReceived,!1,!0);this.experienceClient.call("personalization","recommendations",{widget_type:this.widget_type},callback)},onRecommendationsReceived:function(response){response.success&&response.entry&&(this.widget.links=response.entry.links||[],Contextly.widget.TextSnippet.fn.display.apply(this,arguments))}})}(),function(){Contextly.widget.PersonalizedBlocks=Contextly.createClass({extend:Contextly.widget.BlocksSnippet,construct:function(){Contextly.widget.BlocksSnippet.apply(this,arguments)},getWidgetClasses:function(){var classes=["ctx-personalized",this.getWidgetStyleClass()];return Contextly.Browser.hasSvg()||classes.push("ctx-no-svg"),classes},getCustomCssCode:function(){return Contextly.widget.PersonalizedBlocksCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings(),this.getWidgetStyleClass())},display:function(){var callback=this.proxy(this.onRecommendationsReceived,!1,!0);this.experienceClient.call("personalization","recommendations",{widget_type:this.widget_type},callback)},onRecommendationsReceived:function(response){response.success&&response.entry&&(this.widget.links=response.entry.links||[],Contextly.widget.TextSnippet.fn.display.apply(this,arguments))}})}(),function(){Contextly.widget.PersonalizedBlocks2=Contextly.createClass({extend:Contextly.widget.Blocks2Snippet,construct:function(){Contextly.widget.Blocks2Snippet.apply(this,arguments)},getWidgetClasses:function(){var classes=["ctx-personalized",this.getWidgetStyleClass()];return Contextly.Browser.hasSvg()||classes.push("ctx-no-svg"),classes},getCustomCssCode:function(){return Contextly.widget.PersonalizedBlocks2CssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings(),this.getWidgetStyleClass())},display:function(){var callback=this.proxy(this.onRecommendationsReceived,!1,!0);this.experienceClient.call("personalization","recommendations",{widget_type:this.widget_type},callback)},onRecommendationsReceived:function(response){response.success&&response.entry&&(this.widget.links=response.entry.links||[],Contextly.widget.TextSnippet.fn.display.apply(this,arguments))}})}(),function(){Contextly.widget.PersonalizedFloat=Contextly.createClass({extend:Contextly.widget.FloatSnippet,construct:getWidgetClasses:function(){var classes=["ctx-personalized",this.getWidgetStyleClass()];return Contextly.Browser.hasSvg()||classes.push("ctx-no-svg"),classes},getCustomCssCode:function(){return Contextly.widget.PersonalizedFloatCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings(),this.getWidgetStyleClass())},display:function(){var callback=this.proxy(this.onRecommendationsReceived,!1,!0);this.experienceClient.call("personalization","recommendations",{widget_type:this.widget_type},callback)},onRecommendationsReceived:function(response){response.success&&response.entry&&(this.widget.links=response.entry.links||[],Contextly.widget.TextSnippet.fn.display.apply(this,arguments))}})}(),function(){Contextly.widget.HomePersonalizedDefault=Contextly.createClass({extend:Contextly.widget.PersonalizedDefault,construct:function(){Contextly.widget.PersonalizedDefault.apply(this,arguments),this.widget_type=Contextly.widget.types.HOME_PERSONALIZED},getWidgetStyleClass:function(){return"ctx-home-personalized-text"}})}(),function(){Contextly.widget.HomePersonalizedBlocks=Contextly.createClass({extend:Contextly.widget.PersonalizedBlocks,construct:function(){Contextly.widget.PersonalizedBlocks.apply(this,arguments),this.widget_type=Contextly.widget.types.HOME_PERSONALIZED},getWidgetStyleClass:function(){return"ctx-home-personalized-blocks"}})}(),function(){Contextly.widget.HomePersonalizedBlocks2=Contextly.createClass({extend:Contextly.widget.PersonalizedBlocks2,construct:function(){Contextly.widget.PersonalizedBlocks2.apply(this,arguments),this.widget_type=Contextly.widget.types.HOME_PERSONALIZED},getWidgetStyleClass:function(){return"ctx-home-personalized-blocks2"}})}(),function(){Contextly.widget.HomePersonalizedFloat=Contextly.createClass({extend:Contextly.widget.PersonalizedFloat,construct:function(){Contextly.widget.PersonalizedFloat.apply(this,arguments),this.widget_type=Contextly.widget.types.HOME_PERSONALIZED},getWidgetStyleClass:function(){return"ctx-home-personalized-float"}})}(),function(){Contextly.widget.AuthorFollowUpButtonSubscribe=Contextly.createClass({extend:[Contextly.widget.ChannelSubscribe],construct:function(){Contextly.widget.Base.apply(this,arguments),this.widget_type=Contextly.widget.types.AUTHOR_FOLLOWUP_BUTTON_SUBSCRIBE},getWidgetHTML:function(){var s=this.getSettings(),linkClasses=["ctx-author-followup-link","ctx-story-button",this.getWidgetStyleClass()];return linkClasses.push("ctx-height-"+(s.css.height||"middle")),s.css.button_shadow&&linkClasses.push("ctx-box-shadow"),s.css.text_shadow&&linkClasses.push("ctx-text-shadow"),Contextly.Browser.hasSvg()||linkClasses.push("ctx-no-svg"),'<a href="javascript:" class="'+this.escape(linkClasses.join(" "))+'">'+'<span class="ctx-subscribe-row">'+this.getWidgetLogoHTML()+this.getWidgetLabelHTML()+"</span>"+"</a>"},getWidgetLabelHTML:function(){var data=this.getWidget(),title=(this.getSettings().title+"").replace("%author%",data.author_name).replace("%site%",data.site_name);return'<span class="ctx-subscribe-label">'+this.escape(title)+"</span>"},attachChannelButtonHandler:function(){this.getWidgetContainers().find(".ctx-author-followup-link").on("click",this.proxy(this.displayAuthorFollowUpPopup,!1,!0))},detachChannelButtonHandler:displayAuthorFollowUpPopup:function(e){e.preventDefault();var data=this.getWidget();Contextly.overlay.AuthorFollowUpSubscribe.open({author_name:data.author_name,site_name:data.site_name,subscribe_newsletter:data.settings.subscribe_newsletter,subscribe_newsletter_title:data.settings.subscribe_newsletter_title,subscribed:data.subscribed,confirmed:data.confirmed,experienceClient:this.experienceClient,settings:this.widget.settings})},getCustomCssCode:function(){var entry={container:"."+this.containers.getTypeClass(),widget:"."+this.containers.getTypeClass()+" .ctx-author-followup-link."+this.getWidgetStyleClass()};return Contextly.widget.AuthorFollowUpButtonCssCustomBuilder.buildCSS(entry,this.getSettings())},suppressTransitions:function(){var selector,containers=this.getWidgetContainers();selector="split-button"===this.getSettings().theme?".ctx-subscribe-label, .ctx-subscribe-logo":".ctx-author-followup-link";var suppressed=containers.find(selector).addClass("ctx-no-transitions");setTimeout(1)}}),Contextly.widget.AuthorFollowUpButtonSubscribe.broadcastTypes={STATUS:"contextlyAuthorFollowUpStatus"}}(),function(){Contextly.widget.AuthorFollowUpFormSubscribe=Contextly.createClass({extend:[Contextly.widget.ChannelSubscribeForm],construct:function(){Contextly.widget.ChannelSubscribeForm.apply(this,arguments),this.widget_type=Contextly.widget.types.AUTHOR_FOLLOWUP_FORM_SUBSCRIBE},getWidgetStyleClass:function(){return"ctx-author-followup-form-container"},attachChannelButtonHandler:function(){this.getWidgetContainers().find(".ctx-author-followup-link").on("click",this.proxy(this.subscribeToAuthorHandler,!1,!0))},getWidgetHTML:function(){this.getSettings();var classes=["ctx-author-followup-form-container",this.buildLayoutClass(this.widget.settings.layout),"ctx-clearfix"],linkClasses=["ctx-author-followup-link"],data=this.getWidget(),title=(this.getSettings().title+"").replace("%author%",data.author_name).replace("%site%",data.site_name),description=(this.getSettings().description+"").replace("%author%",data.author_name).replace("%site%",data.site_name);return"<div class='"+this.escape(classes.join(" "))+"'>"+'<div class="ctx-title-row">'+this.escape(title)+"</div>"+'<div class="ctx-description-row">'+this.escape(description)+"</div>"+'<div class="ctx-message-row"></div>'+'<div class="ctx-email-row ctx-input-row">'+'<input type="email" class="ctx-email" placeholder="Email address" />'+'<input type="submit" class="'+this.escape(linkClasses.join(" "))+'" value="Sign up" />'+"</div>"+"</div>"},subscribeToAuthorHandler:function(){var data=this.getWidget(),params={author_name:data.author_name},email=Contextly.Utils.trim(this.getEmailInput().val());return email&&Contextly.Utils.isEmailValid(email)?(params.email=email,this.subscribeToAuthor(params),void 0):(this.errorMessage("Please enter a valid email address."),void 0)},subscribeToAuthor:function(params){params=params||{},this.lockSubscriptionUI(),this.hideMessage();var callback=this.proxy(this.onSubscribeComplete,!1,!0);this.experienceClient.call("author-followup","subscribe",params,callback)},onSubscribeComplete:function(response){var data=this.getWidget();if(response&&response.success)response.confirmed?this.successMessage("We added the "+data.author_name+" to your FollowUp list."):this.successMessage("Almost done! Check your email.");else{var message="Something went wrong.";response&&response.error&&(message=response.error),this.errorMessage(message),this.unlockSubscriptionUI(),this.focusEmailInput()}},getCustomCssCode:function(){var entry={container:"."+this.containers.getTypeClass(),widget:"."+this.containers.getTypeClass()+" .ctx-author-followup-link."+this.getWidgetStyleClass()};return Contextly.widget.AuthorFollowUpFormCssCustomBuilder.buildCSS(entry,this.getSettings())},getSubmit:),Contextly.widget.AuthorFollowUpFormSubscribe.broadcastTypes={STATUS:"contextlyAuthorFollowUpStatus"}}(Contextly.DOM),function($){Contextly.widget.FlexSnippet=Contextly.createClass({extend:[Contextly.widget.BaseLinksList,Contextly.widget.ViewHandler],construct:function(){Contextly.widget.BaseLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.SNIPPET},destroyReferences:function(){Contextly.widget.ViewHandler.fn.destroyReferences.apply(this,arguments),Contextly.widget.BaseLinksList.fn.destroyReferences.apply(this,arguments)},getWidgetStyleClass:function(){return"ctx-content-flex"},getWidgetClasses:function(){var classes=["ctx-module",this.getWidgetStyleClass()];return classes},getWidgetHTML:function(){var i,section_name,div="",sections=[];for(i=0;this.widget.settings.display_sections.length>i;i++)section_name=this.widget.settings.display_sections[i],this.isDisplaySection(section_name)&&sections.push(section_name);for(div+="<div class='"+this.escape(this.getWidgetClasses().join(" "))+"'>",i=0;sections.length>i;i++){section_name=sections[i];var section_key=section_name+"_subhead",section_header=this.widget.settings[section_key];section_header&&(div+="<div class='ctx-section-title'>"+this.escape(section_header)+"</div>"),div+=this.getLinksHTMLOfType(section_name)}return div+="</div>",div+=this.getBrandingButtonHtml()},hasWidgetData:function(){if(this.widget.links){var links=this.widget.links;for(var prop in links)if(links.hasOwnProperty(prop)&&links[prop].length)return!0}return!1},getLinksHTMLOfType:function(type){var html="",widget=this.widget;if(widget.links&&widget.links[type]){var placeCounter=0;for(var link_idx in widget.links[type]){var link=widget.links[type][link_idx];link.id&&link.title&&(html+=this.getLinkHTML(link,++placeCounter))}}return html},getLinkATag:function(link,content,additional_class){var classes=["nav-current"];additional_class&&classes.push(additional_class);var attributes=this.renderAttributes({href:link.native_url,title:Contextly.Utils.htmlToText(link.title),"class":classes.join(" ")})+this.getEventTrackingHtml(link);return"<a"+attributes+">"+content+"</a>"},getLinkHTML:function(link){var thumbnail_html="";if(this.getLinkThumbnailUrl(link)){var image_html=this.getImageHtml(link,"ctx-content-post-card-img");thumbnail_html=this.getLinkATag(link,image_html,"ctx-content-post-card-media")}return"<div class='ctx-content-post-card'>"+thumbnail_html+"<div class='ctx-content-post-content'>"+"<div class='ctx-content-post-title'>"+this.getLinkATag(link,this.getInnerLinkHTML(link))+"</div>"+"<div class='ctx-content-post-exc'>"+(link.content?link.content:"")+"</div>"+"<div class='ctx-content-post-footer'>"+"<div class='ctx-content-post-date'>"+(link.publish_date_formatted?link.publish_date_formatted:"")+"</div>"+"</div>"+"</div>"+"</div>"},getInnerLinkHTML:getHandlers:function(widgetHasData){var handlers=Contextly.widget.BaseLinksList.fn.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.attachLinksPopups=!0,handlers.attachBrandingHandlers=!0,Contextly.Settings.isAdmin()||(handlers.attachWidgetViewHandler=!0)),handlers},getCustomCssCode:function(){return Contextly.widget.FlexCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},buildLayoutClass:function(mode){return"ctx-module-"+mode},getLayoutModes:function(){return{mobile:[0,450],"default":[450]}},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-content-post-title").first()},broadcastWidgetDisplayed:function(){Contextly.widget.BaseLinksList.fn.broadcastWidgetDisplayed.apply(this,arguments);var apiSession=this.experienceClient.getApiSession();apiSession.hasId()&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:apiSession.getId(),event_success:!1,event_payload:{visible:$(".ctx-section").first().find(".ctx-link").isVisible().length}})}})}(Contextly.DOM),function(){Contextly.widget.Flex2Snippet=Contextly.createClass({extend:[Contextly.widget.FlexSnippet],getWidgetStyleClass:function(){return"ctx-content-flex2"},getCustomCssCode:function(){return Contextly.widget.Flex2CssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())}})}(Contextly.DOM),function(){Contextly.widget.CompactSnippet=Contextly.createClass({extend:[Contextly.widget.FlexSnippet],construct:function(){Contextly.widget.BaseLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.SNIPPET},destroyReferences:getWidgetStyleClass:function(){return"ctx-content-compact"},getLinkHTML:function(link){var thumbnailHtml="";this.getLinkThumbnailUrl(link)&&(thumbnailHtml="<div class='ctx-story-media'>"+this.getImageHtml(link)+"</div>");var linkContent=thumbnailHtml+"<div class='ctx-story-content'>"+"<div class='ctx-story-title'>"+this.getInnerLinkHTML(link)+"<div class='ctx-story-info'>"+"<time class='ctx-story-date'>"+(link.publish_date_formatted?link.publish_date_formatted:"")+"</time>"+"</div>"+"</div>"+"</div>";return this.getLinkATag(link,linkContent,"ctx-story")},findViewWatcherElement:getCustomCssCode:function(){return Contextly.widget.CompactCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())}})}(Contextly.DOM),function(){Contextly.widget.CinemaSnippet=Contextly.createClass({extend:Contextly.widget.FloatSnippet,getWidgetStyleClass:getInnerLinkHTML:getInnerThumbnailHTML:function(link){var image_html="";if(this.getLinkThumbnailUrl(link)){var image=this.getImageHtml(link);image_html="<div class='ctx-link-image'>"+this.getLinkATag(link,image)+"</div>"}return image_html},getLinkHTMLNormal:function(link,linkCounter){var html="<div class='ctx-link ctx-"+this.escape(linkCounter)+"'>";return this.getLinkThumbnailUrl(link)&&(html+=this.getInnerThumbnailHTML(link)),html+="<div class='ctx-link-title'><p class='ctx-nodefs title'>"+this.getLinkATag(link,link.title)+"</p>",link.metadata&&(html+=this.getLinkMetadataHTML(link)),html+="</div></div>"},getCustomCssCode:function(){return Contextly.widget.CinemaCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},getLayoutModes:function(){return"letter600x315"==this.getSettings().images_type?{mobile:[0,240],medium:[240,400],normal:[400]}:{mobile:[0,240],medium:[240,400],normal:[400,700],wide:[700]}}})}();