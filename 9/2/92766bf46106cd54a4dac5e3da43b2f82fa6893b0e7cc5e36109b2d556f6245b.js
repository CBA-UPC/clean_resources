import{domAppend as m,forceRepaintSVG as u,addParams as p,resolve,fetchJson as l,browser as t}from"../base/croco.js";import{getLocalData as v,mediaQuery as o}from"../base/config.js";import{sendEvent as D}from"../base/event-tracker.js";export const DISPLAY_MODE_WINDOW="w";export const DISPLAY_MODE_IFRAME="i";let hasListener=false;export function getDevice(){let device="mobile";if(!o.mobileOnly.matches){device=o.desktopOnly.matches?"desktop":"tablet"}return device}export sync function I(){let t=await v("customerVoice.questionnaireUrl");const o=document.querySelectorAll(".js-customer-voice-data");for(let i of o){const{customerVoiceParamKey:l,customerVoiceParamValue:m}=i.dataset;if(l&&m){t=p(t,{[l]:m},true)}}t=p(t,{device:getDevice()},true);return t}export function listenFeedbackFulfilled(i){if(!hasListener){window.addEventListener("message",async event=>{if(event.origin===window.location.origin&&resolve("data.event",event)==="FEEDBACK_COMPLETE"){D("autoTrack_EventDY");const t=document.querySelector(".js-customer-voice-tab");t&&t.remove();if(i&&i.close){const o=event.data.timer||15;setTimeout(o*1e3)}}},{once:true});hasListener=true}}async function O(i){if(i){const{openPopin:t}=await import("../base/popin-refit.js");const{popin:o}=t({instanceId:"popin-customer-voice-form",options:{noContentScroll:true,noPadding:true},loadContents:async()=>{const t=await I();const formData=t&&await l(t);const{tplCustomerVoiceForm:o}=await import("../templates/customer-voice.tpl.js");return{contents:o(formData?{...formData,customerVoiceUrl:i}:{customerVoiceUrl:i})}}});listenFeedbackFulfilled(o)}}export async function displayFeedBackTab(url){const t=await v("customerVoice.tabData");if(t&&t.title&&t.logo){const{render:o}=await import("../../framework/vendors/lit-html/lit-html.js");const{tplCustomerVoiceTab:i}=await import("../templates/customer-voice.tpl.js");const l=document.createElement("div");o(i(t),l);l.addEventListener("click",;m(l,document.body);u(l)}}