![function(e,t,a){"use strict";function r(e,t,a,r,n,o,s){try{var i=e[o](s),c=i.value}catch(e){return void a(e)}i.done?t(c):Promise.resolve(c).then(r,n)}function n(e){return function(){var t=this,a=arguments;return new Promise((function(n,o){var s=e.apply(t,a);function i(e){r(s,n,o,i,c,"next",e)}function c(e){r(s,n,o,i,c,"throw",e)}i(void 0)}))}}unction s(){return(s=n((function*(e){var t=new TextEncoder("utf-8").encode(e),a=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(a)).map(().join("")}))).apply(this,arguments)}r(t);var u="https://udr.uol.com.br",l={sync:()=>c((function*(){yield l.syncUOLID(),yield Promise.all([l.syncTailTarget(),l.sendUOLIDToTailTarget(),l.syncXandrDMP(),l.syncPiano()])}))(),get:e=>c((function*(){return yield fetch(e,{credentials:"include"})}))(),hasTMhasCXsyncUOLID(){var e=this;return c((function*(){var t=(yield e.getLocalData())||{};e.persist(t),e.refreshSyncData(t)}))()},refreshSyncData(e){var t=this;return c((function*(){var a=t.isFolhaEnvironment()?"?xsrc=folha":"",r=yield t.get("".concat(u+a)),n=yield r.json();Object.assign(e,n),t.persist(e)}))()},isFolhaEnvironment:setPPIDtoTicker(e){try{window.tickerAdManager=window.tickerAdManager||{},window.tickerAdManager.model=window.tickerAdManager.model||{},window.tickerAdManager.model.data=window.tickerAdManager.model.data||{},window.tickerAdManager.model.data.datalake=window.tickerAdManager.model.data.datalake||{},window.tickerAdManager.model.data.datalake.ppid=e.ppid,console.log("PPID configurado")}catch(e){console.log("Não foi possível configurar PPID.")}},refreshClusterLocalStorage(e){var t=this;return c((function*(){var{data:a}=e,r=a["clusters-conteudo"]&&a["clusters-conteudo"].cluster||"-1",n=JSON.parse(localStorage.getItem("UDR.DATA"))||{data:{}};n.data["clusters-conteudo"]?n.data["clusters-conteudo"].cluster=r:Object.assign(n.data,{"clusters-conteudo":{cluster:r}}),t.persistLocal(JSON.stringify(n))}))()},syncPiano(){var e=this;return c((function*(){if(yield new Promis)),e.hasCX()){var t=yield e.get("".concat(u,"/?scopes=base-assinantes,user-preferences,corporate,inscriptions,base-assinantes-pd-host-bol-user,clusters-conteudo")),a=yield t.json();e.refreshClusterLocalStorage(a);var r=e.formatPianoProfile(a);if(r.length){console.log("piano profile",r);var n="https://api.cxense.com/profile/user/external/update?callback={{callback}}&persisted="+encodeURIComponent("d221a64af0b728fa6a6c3d8a81c50c89340769c7")+"&json="+encodeURIComponent(JSON.stringify({id:a.uolid,type:"tfh",profile:r}));cX.getCookie("T_PIANO")||(cX.jsonpRequest(n,(function(e){e.hasOwnProperty("httpStatus")&&200==e.httpStatus?(console.log("piano result: "),console.log(e)):console.log("No or bad http status")})),cX.setCookie("T_PIANO","t",30/1440))}}}))()},formatPianoProfile(e){var{data:t}=e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,r=[],n=t["user-preferences"],o=t["base-assinantes"],s=t.corporate,i=t.inscriptions,c=t["base-assinantes-pd-host-bol-user"],u=t["clusters-conteudo"];if(o){r.push({group:"tfh-assinante-ponto-venda",item:o.ponto_venda}),r.push({group:"tfh-assinante-status",item:o.status_assinante}),r.push({group:"tfh-assinante-estacao",item:o.estacao}),r.push({group:"tfh-assinante-produto",item:o.produto});var l=new Date(o.dt_venda);if(r.push({group:"tfh-assinante-num-dias-venda",item:parseInt((a-l)/864e5)}),o.dt_cancelamento){var d=new Date(o.dt_cancelamento);r.push({group:"tfh-assinante-num-dias-cancel",item:parseInt((a-d)/864e5)})}}if(n){if(n.newsletter_assinaturas&&n.newsletter_assinaturas.length)for(var p of n.newsletter_assinaturas)r.push({group:"tfh-newsletter-assinaturas",item:p});if(n.preferencias&&Object.keys(n.preferencias).length&&(n.preferencias["bloco-customizado-esporte"]&&r.push({group:"tfh-preferencias-time",item:n.preferencias["bloco-customizado-esporte"]}),n.preferencias["bloco-customizado-mulher"]&&r.push({group:"tfh-preferencias-signo",item:n.preferencias["bloco-customizado-mulher"]})),n.app_navegacao&&Object.keys(n.app_navegacao).length)for(var[g,f]of Object.entries(n.app_navegacao))r.push({group:"tfh-app-navegacao",item:g});if(n.canais_whatsapp&&Object.keys(n.canais_whatsapp).length)for(var h of Object.keys(n.canais_whatsapp))r.push({group:"tfh-canais-whatsapp",item:h})}return o||!s||i&&i.activeProducts&&i.activeProducts.includes(32)||r.push({group:"tfh-assinante-status",item:"Cadastrado"}),c&&c.flg_user_emad_elegivel&&r.push({group:"tfh-flg-user-emad-elegivel",item:c.flg_user_emad_elegivel}),u&&u.flg_upsell_able_heavy_user&&r.push({group:"tfh-flg-upsell-able-heavy-user",item:u.flg_upsell_able_heavy_user}),r},persist(e){var t=JSON.stringify(e);this.setTargeting(e),this.persistDataLayer({UOLID:e.uolid,ppid:e.ppid}),this.persistLocal(t),this.hasTM()&&this.persistRemote(t),this.setPPIDtoTicker(e)},setTargeting(e){var{uolid:t}=e;try{googletag.pubads().setTargeting("UOLID",t)}catch(e){}},persistLoc},getLocalData(){var e=this;return c((function*(){var t=localStorage.getItem("UDR.DATA");return t||e.hasTM()&&(t=yield e.getRemoteStorageData())?JSON.parse(t):null}))()},persistRemo},persistOnRemoteStorage:(e,t)=>new Promise(a=>{try{UOLPD.TagManager.Commons.RemoteStorage().set(e,})}catch(e){console.error(e),a()}}),getFromRemoteStorage:e=>new Promise(t=>{try{UOLPD.TagManager.Commons.RemoteStorage().get(})}catch(e){console.error(e),t(null)}}),getRemoteStorageDa},getDataLayer(){var e=this;return c((function*(){var t=localStorage.getItem("uolDataLayer");return t&&"null"!==t&&"undefined"!==t||!e.hasTM()||(t=yield e.getFromRemoteStorage("uolDataLayer")),t&&"null"!==t&&"undefined"!==t?JSON.parse(t):{}}))()},getWindowDataLayer:()=>(window.UOLPD=window.UOLPD||{},window.UOLPD.dataLayer=window.UOLPD.dataLayer||{},window.UOLPD.dataLayer),persistDataLayer(e){var t=this;return c((function*(){var a=t.getWindowDataLayer();Object.assign(a,e);var r=yield t.getDataLayer();Object.assign(r,e),localStorage.setItem("uolDataLayer",JSON.stringify(r)),t.hasTM()&&t.persistOnRemoteStorage("uolDataLayer",JSON.stringify(r))}))()},syncTailTarget(){var e=this;return c((function*(){var t=yield e.getDataLayer(),a=t&&t.TailtargetTrack;if(a){var r="";for(var n in a)r+="".concat(n,":").concat(a[n],";");var o="".concat(u,"/store?scope=").concat("tt","&data=").concat(r);(yield e.isNewSync(o,"tt"))&&((new Image).src=o,yield e.saveSyncHash(o,"tt"))}}))()},getXandrUid:()=>c((function*(){try{var e=yield fetch("https://ib.adnxs.com/getuidj",{credentials:"include"});return(yield e.json()).uid}catch(e){return console.log("Ops! ocorreu um erro ao obter o XandrUID"),"0"}}))(),syncXandrDMP(){var e=this;return c((function*(){var t=yield e.getXandrUid();"0"!=t&&/^(0x)?[0-9A-Fa-f]+$/.test(t)&&((new Image).src="".concat(u,"/store?scope=xandr&sid=").concat(t))}))()},saveSyncHash(e,t){var a=this;return c((function*(){var r=yield a.getLocalData(),{syncHashMap:n={}}=r,s=yield o(e);n[t]=s,r.syncHashMap=n,yield a.persist(r)}))()},isNewSync(e,t){var a=this;return c((function*(){var r=yield a.getLocalData(),{syncHashMap:n={}}=r,s=yield o(e);return n[t]!=s}))()},sendUOLIDToTailTarget(){var e=this;return c((function*(){var t=yield e.getLocalData(),a="https://m.t.tailtarget.com/sync/TT-10162-1/"+(yield o(t.uolid));document.createElement("img").setAttribute("src",a)}))()},syncWeather(){var e=this;return c((function*(){try{var t=yield e.getLocalData(),a=yield fetch("https://dynad-list.dynad.net/v3/weather?uolid=".concat(t.uolid)),r=yield a.json();e.persistDataLayer({weather:r.main});var n=JSON.parse(localStorage.getItem("UDR.DATA"));Object.assign(n,{weather:r.main}),e.persistLocal(JSON.stringify(n))}catch(e){console.log("Falha ao obter os dados de clima")}}))()}};l.sync()}]);
