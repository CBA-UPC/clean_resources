// vcc: 1707513390



// js_build_core: vendor/js/eventemitter2.js
;!function(undefined) { var isArray = Array.isArray ? Array.isArray :  var defaultMaxListeners = 10; function init() { this._events = {}; if (this._conf) { configure.call(this, this._conf); } } function configure(conf) { if (conf) { this._conf = conf; conf.delimiter && (this.delimiter = conf.delimiter); this._maxListeners = conf.maxListeners !== undefined ? conf.maxListeners : defaultMaxListeners; conf.wildcard && (this.wildcard = conf.wildcard); conf.newListener && (this._newListener = conf.newListener); conf.removeListener && (this._removeListener = conf.removeListener); conf.verboseMemoryLeak && (this.verboseMemoryLeak = conf.verboseMemoryLeak); if (this.wildcard) { this.listenerTree = {}; } } else { this._maxListeners = defaultMaxListeners; } } function logPossibleMemoryLeak(count, eventName) { var errorMsg = '(node) warning: possible EventEmitter memory ' + 'leak detected. ' + count + ' listeners added. ' + 'Use emitter.setMaxListeners() to increase limit.'; if(this.verboseMemoryLeak){ errorMsg += ' Event name: ' + eventName + '.'; }
 if(typeof process !== 'undefined' && process.emitWarning){ var e = new Error(errorMsg); e.name = 'MaxListenersExceededWarning'; e.emitter = this; e.count = count; process.emitWarning(e); } else { console.error(errorMsg); if (console.trace){ console.trace(); } } } function EventEmitter(conf) { this._events = {}; this._newListener = false; this._removeListener = false; this.verboseMemoryLeak = false; configure.call(this, conf); } EventEmitter.EventEmitter2 = EventEmitter; function searchListenerTree(handlers, type, tree, i) { if (!tree) { return []; } var listeners=[], leaf, len, branch, xTree, xxTree, isolatedBranch, endReached, typeLength = type.length, currentType = type[i], nextType = type[i+1]; if (i === typeLength && tree._listeners) { if (typeof tree._listeners === 'function') { handlers && handlers.push(tree._listeners); return [tree]; } else { for (leaf = 0, len = tree._listeners.length; leaf < len; leaf++) { handlers && handlers.push(tree._listeners[leaf]); } return [tree]; } }
 if ((currentType === '*' || currentType === '**') || tree[currentType]) { if (currentType === '*') { for (branch in tree) { if (branch !== '_listeners' && tree.hasOwnProperty(branch)) { listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+1)); } } return listeners; } else if(currentType === '**') { endReached = (i+1 === typeLength || (i+2 === typeLength && nextType === '*')); if(endReached && tree._listeners) { listeners = listeners.concat(searchListenerTree(handlers, type, tree, typeLength)); } for (branch in tree) { if (branch !== '_listeners' && tree.hasOwnProperty(branch)) { if(branch === '*' || branch === '**') { if(tree[branch]._listeners && !endReached) { listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], typeLength)); } listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i)); } else if(branch === nextType) { listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+2)); } else { listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i)); } } } return listeners; } listeners = listeners.concat(searchListenerTree(handlers, type, tree[currentType], i+1)); } xTree = tree['*']; if (xTree) { searchListenerTree(handlers, type, xTree, i+1); } xxTree = tree['**'];
 if(xxTree) { if(i < typeLength) { if(xxTree._listeners) { searchListenerTree(handlers, type, xxTree, typeLength); } for(branch in xxTree) { if(branch !== '_listeners' && xxTree.hasOwnProperty(branch)) { if(branch === nextType) { searchListenerTree(handlers, type, xxTree[branch], i+2); } else if(branch === currentType) { searchListenerTree(handlers, type, xxTree[branch], i+1); } else { isolatedBranch = {}; isolatedBranch[branch] = xxTree[branch]; searchListenerTree(handlers, type, { '**': isolatedBranch }, i+1); } } } } else if(xxTree._listeners) { searchListenerTree(handlers, type, xxTree, typeLength); } else if(xxTree['*'] && xxTree['*']._listeners) { searchListenerTree(handlers, type, xxTree['*'], typeLength); } } return listeners; } function growListenerTree(type, listener) { type = typeof type === 'string' ? type.split(this.delimiter) : type.slice(); for(var i = 0, len = type.length; i+1 < len; i++) { if(type[i] === '**' && type[i+1] === '**') { return; } } var tree = this.listenerTree; var name = type.shift(); while (name !== undefined) {
 if (!tree[name]) { tree[name] = {}; } tree = tree[name]; if (type.length === 0) { if (!tree._listeners) { tree._listeners = listener; } else { if (typeof tree._listeners === 'function') { tree._listeners = [tree._listeners]; } tree._listeners.push(listener); if ( !tree._listeners.warned && this._maxListeners > 0 && tree._listeners.length > this._maxListeners ) { tree._listeners.warned = true; logPossibleMemoryLeak.call(this, tree._listeners.length, name); } } return true; } name = type.shift(); } return true; } EventEmitter.prototype.delimiter = '.'; EventEmitter.prototype.setMaxListeners = function(n) { if (n !== undefined) { this._maxListeners = n; if (!this._conf) this._conf = {}; this._conf.maxListeners = n; } };
 EventEmitter.prototype.event = ''; EventEmitter.prototype.once = function(event, fn) { return this._once(event, fn, false); }; EventEmitter.prototype.prependOnceListener = function(event, fn) { return this._once(event, fn, true); }; EventEmitter.prototype._once = function(event, fn, prepend) { this._many(event, 1, fn, prepend); return this; }; EventEmitter.prototype.many = function(event, ttl, fn) { return this._many(event, ttl, fn, false); }; EventEmitter.prototype.prependMany =  EventEmitter.prototype._many = function(event, ttl, fn, prepend) { var self = this; if (typeof fn !== 'function') { throw new Error('many only accepts instances of Function'); } function listener() { if (--ttl === 0) { self.off(event, listener); } return fn.apply(this, arguments); } listener._origin = fn; this._on(event, listener, prepend); return self; }; EventEmitter.prototype.emit = function() { this._events || init.call(this); var type = arguments[0];
 if (type === 'newListener' && !this._newListener) { if (!this._events.newListener) { return false; } } var al = arguments.length; var args,l,i,j; var handler; if (this._all && this._all.length) { handler = this._all.slice(); if (al > 3) { args = new Array(al); for (j = 0; j < al; j++) args[j] = arguments[j]; } for (i = 0, l = handler.length; i < l; i++) { this.event = type; switch (al) { case 1: handler[i].call(this, type); break; case 2: handler[i].call(this, type, arguments[1]); break; case 3: handler[i].call(this, type, arguments[1], arguments[2]); break; default: handler[i].apply(this, args); } } } if (this.wildcard) { handler = []; var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice(); searchListenerTree.call(this, handler, ns, this.listenerTree, 0); } else { handler = this._events[type]; if (typeof handler === 'function') { this.event = type; switch (al) { case 1: handler.call(this); break; case 2: handler.call(this, arguments[1]);
 break; case 3: handler.call(this, arguments[1], arguments[2]); break; default: args = new Array(al - 1); for (j = 1; j < al; j++) args[j - 1] = arguments[j]; handler.apply(this, args); } return true; } else if (handler) { handler = handler.slice(); } } if (handler && handler.length) { if (al > 3) { args = new Array(al - 1); for (j = 1; j < al; j++) args[j - 1] = arguments[j]; } for (i = 0, l = handler.length; i < l; i++) { this.event = type; switch (al) { case 1: handler[i].call(this); break; case 2: handler[i].call(this, arguments[1]); break; case 3: handler[i].call(this, arguments[1], arguments[2]); break; default: handler[i].apply(this, args); } } return true; } else if (!this._all && type === 'error') { if (arguments[1] instanceof Error) { throw arguments[1]; } else { throw new Error("Uncaught, unspecified 'error' event."); } return false; } return !!this._all; };
 EventEmitter.prototype.emitAsync = function() { this._events || init.call(this); var type = arguments[0]; if (type === 'newListener' && !this._newListener) { if (!this._events.newListener) { return Promise.resolve([false]); } } var promises= []; var al = arguments.length; var args,l,i,j; var handler; if (this._all) { if (al > 3) { args = new Array(al); for (j = 1; j < al; j++) args[j] = arguments[j]; } for (i = 0, l = this._all.length; i < l; i++) { this.event = type; switch (al) { case 1: promises.push(this._all[i].call(this, type)); break; case 2: promises.push(this._all[i].call(this, type, arguments[1])); break; case 3: promises.push(this._all[i].call(this, type, arguments[1], arguments[2])); break; default: promises.push(this._all[i].apply(this, args)); } } } if (this.wildcard) { handler = []; var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice(); searchListenerTree.call(this, handler, ns, this.listenerTree, 0); } else { handler = this._events[type]; } if (typeof handler === 'function') { this.event = type;
 switch (al) { case 1: promises.push(handler.call(this)); break; case 2: promises.push(handler.call(this, arguments[1])); break; case 3: promises.push(handler.call(this, arguments[1], arguments[2])); break; default: args = new Array(al - 1); for (j = 1; j < al; j++) args[j - 1] = arguments[j]; promises.push(handler.apply(this, args)); } } else if (handler && handler.length) { handler = handler.slice(); if (al > 3) { args = new Array(al - 1); for (j = 1; j < al; j++) args[j - 1] = arguments[j]; } for (i = 0, l = handler.length; i < l; i++) { this.event = type; switch (al) { case 1: promises.push(handler[i].call(this)); break; case 2: promises.push(handler[i].call(this, arguments[1])); break; case 3: promises.push(handler[i].call(this, arguments[1], arguments[2])); break; default: promises.push(handler[i].apply(this, args)); } } } else if (!this._all && type === 'error') { if (arguments[1] instanceof Error) { return Promise.reject(arguments[1]); } else { return Promise.reject("Uncaught, unspecified 'error' event."); } } return Promise.all(promises); }; EventEmitter.prototype.on = function(type, listener) { return this._on(type, listener, false);
 }; EventEmitter.prototype.prependListener =  EventEmitter.prototype.onAny = function(fn) { return this._onAny(fn, false); }; EventEmitter.prototype.prependAny = function(fn) { return this._onAny(fn, true); }; EventEmitter.prototype.addListener = EventEmitter.prototype.on; EventEmitter.prototype._onAny = function(fn, prepend){ if (typeof fn !== 'function') { throw new Error('onAny only accepts instances of Function'); } if (!this._all) { this._all = []; } if(prepend){ this._all.unshift(fn); }else{ this._all.push(fn); } return this; }; EventEmitter.prototype._on = function(type, listener, prepend) { if (typeof type === 'function') { this._onAny(type, listener); return this; } if (typeof listener !== 'function') { throw new Error('on only accepts instances of Function'); } this._events || init.call(this); if (this._newListener) this.emit('newListener', type, listener); if (this.wildcard) {
 growListenerTree.call(this, type, listener); return this; } if (!this._events[type]) { this._events[type] = listener; } else { if (typeof this._events[type] === 'function') { this._events[type] = [this._events[type]]; } if(prepend){ this._events[type].unshift(listener); }else{ this._events[type].push(listener); } if ( !this._events[type].warned && this._maxListeners > 0 && this._events[type].length > this._maxListeners ) { this._events[type].warned = true; logPossibleMemoryLeak.call(this, this._events[type].length, type); } } return this; }; EventEmitter.prototype.off = function(type, listener) { if (typeof listener !== 'function') { throw new Error('removeListener only takes instances of Function'); } var handlers,leafs=[]; if(this.wildcard) { var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice(); leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0); } else { if (!this._events[type]) return this; handlers = this._events[type]; leafs.push({_listeners:handlers}); }
 for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) { var leaf = leafs[iLeaf]; handlers = leaf._listeners; if (isArray(handlers)) { var position = -1; for (var i = 0, length = handlers.length; i < length; i++) { if (handlers[i] === listener || (handlers[i].listener && handlers[i].listener === listener) || (handlers[i]._origin && handlers[i]._origin === listener)) { position = i; break; } } if (position < 0) { continue; } if(this.wildcard) { leaf._listeners.splice(position, 1); } else { this._events[type].splice(position, 1); } if (handlers.length === 0) { if(this.wildcard) { delete leaf._listeners; } else { delete this._events[type]; } } if (this._removeListener) this.emit("removeListener", type, listener); return this; } else if (handlers === listener || (handlers.listener && handlers.listener === listener) || (handlers._origin && handlers._origin === listener)) { if(this.wildcard) { delete leaf._listeners; } else { delete this._events[type]; }
 if (this._removeListener) this.emit("removeListener", type, listener); } } function recursivelyGarbageCollect(root) { if (root === undefined) { return; } var keys = Object.keys(root); for (var i in keys) { var key = keys[i]; var obj = root[key]; if ((obj instanceof Function) || (typeof obj !== "object") || (obj === null)) continue; if (Object.keys(obj).length > 0) { recursivelyGarbageCollect(root[key]); } if (Object.keys(obj).length === 0) { delete root[key]; } } } recursivelyGarbageCollect(this.listenerTree); return this; }; EventEmitter.prototype.offAny = function(fn) { var i = 0, l = 0, fns; if (fn && this._all && this._all.length > 0) { fns = this._all; for(i = 0, l = fns.length; i < l; i++) { if(fn === fns[i]) { fns.splice(i, 1); if (this._removeListener) this.emit("removeListenerAny", fn); return this; } } } else { fns = this._all; if (this._removeListener) { for(i = 0, l = fns.length; i < l; i++) this.emit("removeListenerAny", fns[i]); } this._all = []; } return this; };
 EventEmitter.prototype.removeListener = EventEmitter.prototype.off; EventEmitter.prototype.removeAllListeners = function(type) { if (type === undefined) { !this._events || init.call(this); return this; } if (this.wildcard) { var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice(); var leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0); for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) { var leaf = leafs[iLeaf]; leaf._listeners = null; } } else if (this._events) { this._events[type] = null; } return this; }; EventEmitter.prototype.listeners = function(type) { if (this.wildcard) { var handlers = []; var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice(); searchListenerTree.call(this, handlers, ns, this.listenerTree, 0); return handlers; } this._events || init.call(this); if (!this._events[type]) this._events[type] = []; if (!isArray(this._events[type])) { this._events[type] = [this._events[type]]; } return this._events[type]; }; EventEmitter.prototype.eventNames = function(){ return Object.keys(this._events); }; EventEmitter.prototype.listenerCount =  EventEmitter.prototype.listenersAny = function() {
 if(this._all) { return this._all; } else { return []; } }; if (typeof define === 'function' && define.amd) { define(function() { return EventEmitter; }); } else if (typeof exports === 'object') { module.exports = EventEmitter; } else { window.EventEmitter2 = EventEmitter; }}();

// js_build_core: vendor/js/jquery.min.js
/*! jQuery v1.12.4 | (c) jQuery Foundation | jquery.org/license */
!"undefined"!=typeof window?window:this,;


// js_build_core: vendor/js/jquery.colorbox-1.5.14.min.js
/*!
	Colorbox 1.5.14
	license: MIT
	http://www.jacklmoore.com/colorbox
*/
((jQuery,document,window);


// js_build_core: vendor/js/jquery-ui.min.js
/*! jQuery UI - v1.12.1 - 2016-09-14
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-1-7.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

((;

// js_build_core: vendor/js/jquery.ui.touch-punch.min.js
/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011–2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */}(jQuery);

// js_build_core: vendor/js/ResizeObserver.min.js})(this,function(){"use strict";var MapShi}();var isBrowser=typeof window!=="undefined"&&typeof document!=="undefined"&&window.document===document;var global$}();var requestAnimationFrame$}();var trailingTimeout=}var REFRESH_DELAY=20;var transitionKeys=["top","right","bottom","left","width","height","size","weight"];var mutationObserverSupported=typeof MutationObserver!=="undefined";var ResizeObserverControlle}();var defineConfigurabl};var getWindowO};var emptyRect=createRectInit(0,0,0,0 isSVGGraphicsElemen}(r ResizeObservatio}();var ResizeObserverEntr}();var ResizeObserverSP}();var observers=typeof WeakMap!=="undefined"?new WeakMap:new MapShim;var ResizeObserve}();["observe","unobserve","disconnect"].forEac});var inde}();return index});

// js_build_core: vendor/js/morphdom-umd.min.js})(this,function(){"use strict";function morphAttrs(fromNode,toNode){var attrs=toNode.attributes;var i;var attr;var attrName;var attrNamespaceURI;var attrValue;var fromValue;for(i=attrs.length-1;i>=0;--i){attr=attrs[i];attrName=attr.name;attrNamespaceURI=attr.namespaceURI;attrValue=attr.value;if(attrNamespaceURI){attrName=attr.localName||attrName;fromValue=fromNode.getAttributeNS(attrNamespaceURI,attrName);if(fromValue!==attrValue){fromNode.setAttributeNS(attrNamespaceURI,attrName,attrValue)}}else{fromValue=fromNode.getAttribute(attrName);if(fromValue!==attrValue){fromNode.setAttribute(attrName,attrValue)}}}attrs=fromNode.attributes;for(i=attrs.length-1;i>=0;--i){attr=attrs[i];if(attr.specified!==false){attrName=attr.name;attrNamespaceURI=attr.namespaceURI;if(attrNamespaceURI){attrName=attr.localName||attrName;if(!toNode.hasAttributeNS(attrNamespaceURI,attrName)){fromNode.removeAttributeNS(attrNamespaceURI,attrName)}}else{if(!toNode.hasAttribute(attrName)){fromNode.removeAttribute(attrName)}}}}}var range;var NS_XHTML="http://www.w3.org/1999/xhtml";var doc=typeof document==="undefined"?undefined:document;function toElement(str){if(!range&&doc.createRange){range=doc.createRange();range.selectNode(doc.body)}var fragment;if(range&&range.createContextualFragment){fragment=range.createContextualFragment(str)}else{fragment=doc.createElement("body");fragment.innerHTML=str}return fragment.childNodes[0]}function compareNodeNames(fromEl,toEl){var fromNodeName=fromEl.nodeName;var toNodeName=toEl.nodeName;if(fromNodeName===toNodeName){return true}if(toEl.actualize&&fromNodeName.charCodeAt(0)<91&&toNodeName.charCodeAt(0)>90){return fromNodeName===toNodeName.toUpperCase()}else{return false}function moveChildren(fromEl,toEl){var curChild=fromEl.firstChild;while(curChild){var nextChild=curChild.nextSibling;toEl.appendChild(curChild);curChild=nextChild}return toEl}function syncBooleanAttrProp(fromEl,toEl,name){if(fromEl[name]!==toEl[name]){fromEl[name]=toEl[name];if(fromEl[name]){fromEl.setAttribute(name,"")}else{fromEl.removeAttribute(name)}}}var specialElHandlers={OPTION:function(fromEl,toEl){var parentNode=fromEl.parentNode;if(parentNode){var parentName=parentNode.nodeName.toUpperCase();if(parentName==="OPTGROUP"){parentNode=parentNode.parentNode;parentName=parentNode&&parentNode.nodeName.toUpperCase()}if(parentName==="SELECT"&&!parentNode.hasAttribute("multiple")){if(fromEl.hasAttribute("selected")&&!toEl.selected){fromEl.setAttribute("selected","selected");fromEl.removeAttribute("selected")}parentNode.selectedIndex=-1}}syncBooleanAttrProp(fromEl,toEl,"selected")},INPUT:function(fromEl,toEl){syncBooleanAttrProp(fromEl,toEl,"checked");syncBooleanAttrProp(fromEl,toEl,"disabled");if(fromEl.value!==toEl.value){fromEl.value=toEl.value}if(!toEl.hasAttribute("value")){fromEl.removeAttribute("value")}},TEXTAREA:function(fromEl,toEl){var newValue=toEl.value;if(fromEl.value!==newValue){fromEl.value=newValue}var firstChild=fromEl.firstChild;if(firstChild){var oldValue=firstChild.nodeValue;if(oldValue==newValue||!newValue&&oldValue==fromEl.placeholder){return}firstChild.nodeValue=newValue}},SELECT:function(fromEl,toEl){if(!toEl.hasAttribute("multiple")){var selectedIndex=-1;var i=0;var curChild=fromEl.firstChild;var optgroup;var nodeName;while(curChild){nodeName=curChild.nodeName&&curChild.nodeName.toUpperCase();if(nodeName==="OPTGROUP"){optgroup=curChild;curChild=optgroup.firstChild}else{if(nodeName==="OPTION"){if(curChild.hasAttribute("selected")){selectedIndex=i;break}i++}curChild=curChild.nextSibling;if(!curChild&&optgroup){curChild=optgroup.nextSibling;optgroup=null}}}fromEl.selectedIndex=selectedIndex}}};var ELEMENT_NODE=1;var DOCUMENT_FRAGMENT_NODE=11;var TEXT_NODE=3;var COMMENT_NODE=8;function noop()}function morphdomFactory(morphAttrs){return function morphdom(fromNode,toNode,options){if(!options){options={}}if(typeof toNode==="string"){if(fromNode.nodeName==="#document"||fromNode.nodeName==="HTML"){var toNodeHtml=toNode;toNode=doc.createElement("html");toNode.innerHTML=toNodeHtml}else{toNode=toElement(toNode)}}var getNodeKey=options.getNodeKey||defaultGetNodeKey;var onBeforeNodeAdded=options.onBeforeNodeAdded||noop;var onNodeAdded=options.onNodeAdded||noop;var onBeforeElUpdated=options.onBeforeElUpdated||noop;var onElUpdated=options.onElUpdated||noop;var onBeforeNodeDiscarded=options.onBeforeNodeDiscarded||noop;var onNodeDiscarded=options.onNodeDiscarded||noop;var onBeforeElChildrenUpdated=options.onBeforeElChildrenUpdated||noop;var childrenOnly=options.childrenOnly===true;var fromNodesLookup={};var keyedRemovalList;function addKeyedRemoval(key){if(keyedRemovalList){keyedRemovalList.push(key)}else{keyedRemovalList=[key]}}function walkDiscardedChildNodes(node,skipKeyedNodes){if(node.nodeType===ELEMENT_NODE){var curChild=node.firstChild;while(curChild){var key=undefined;if(skipKeyedNodes&&(key=getNodeKey(curChild))){addKeyedRemoval(key)}else{onNodeDiscarded(curChild);if(curChild.firstChild){walkDiscardedChildNodes(curChild,skipKeyedNodes)}}curChild=curChild.nextSibling}}}function removeNode(node,parentNode,skipKeyedNodes){if(onBeforeNodeDiscarded(node)===false){return}if(parentNode){parentNode.removeChild(node)}onNodeDiscarded(node);walkDiscardedChildNodes(node,skipKeyedNodes)}function indexTree(node){if(node.nodeType===ELEMENT_NODE||node.nodeType===DOCUMENT_FRAGMENT_NODE){var curChild=node.firstChild;while(curChild){var key=getNodeKey(curChild);if(key){fromNodesLookup[key]=curChild}indexTree(curChild);curChild=curChild.nextSibling}}}indexTree(fromNode);function handleNodeAdded(el){onNodeAdded(el);var curChild=el.firstChild;while(curChild){var nextSibling=curChild.nextSibling;var key=getNodeKey(curChild);if(key){var unmatchedFromEl=fromNodesLookup[key];if(unmatchedFromEl&&compareNodeNames(curChild,unmatchedFromEl)){curChild.parentNode.replaceChild(unmatchedFromEl,curChild);morphEl(unmatchedFromEl,curChild)}}handleNodeAdded(curChild);curChild=nextSibling}}function cleanupFromEl(fromEl,curFromNodeChild,curFromNodeKey){while(curFromNodeChild){var fromNextSibling=curFromNodeChild.nextSibling;if(curFromNodeKey=getNodeKey(curFromNodeChild)){addKeyedRemoval(curFromNodeKey)}else{removeNode(curFromNodeChild,fromEl,true)}curFromNodeChild=fromNextSibling}}function morphEl(fromEl,toEl,childrenOnly){var toElKey=getNodeKey(toEl);if(toElKey){delete fromNodesLookup[toElKey]}if(toNode.isSameNode&&toNode.isSameNode(fromNode)){return}if(!childrenOnly){if(onBeforeElUpdated(fromEl,toEl)===false){return}morphAttrs(fromEl,toEl);onElUpdated(fromEl);if(onBeforeElChildrenUpdated(fromEl,toEl)===false){return}}if(fromEl.nodeName!=="TEXTAREA"){morphChildren(fromEl,toEl)}else{specialElHandlers.TEXTAREA(fromEl,toEl)}}function morphChildren(fromEl,toEl){var curToNodeChild=toEl.firstChild;var curFromNodeChild=fromEl.firstChild;var curToNodeKey;var curFromNodeKey;var fromNextSibling;var toNextSibling;var matchingFromEl;outer:while(curToNodeChild){toNextSibling=curToNodeChild.nextSibling;curToNodeKey=getNodeKey(curToNodeChild);while(curFromNodeChild){fromNextSibling=curFromNodeChild.nextSibling;if(curToNodeChild.isSameNode&&curToNodeChild.isSameNode(curFromNodeChild)){curToNodeChild=toNextSibling;curFromNodeChild=fromNextSibling;continue outer}curFromNodeKey=getNodeKey(curFromNodeChild);var curFromNodeType=curFromNodeChild.nodeType;var isCompatible=undefined;if(curFromNodeType===curToNodeChild.nodeType){if(curFromNodeType===ELEMENT_NODE){if(curToNodeKey){if(curToNodeKey!==curFromNodeKey){if(matchingFromEl=fromNodesLookup[curToNodeKey]){if(fromNextSibling===matchingFromEl){isCompatible=false}else{fromEl.insertBefore(matchingFromEl,curFromNodeChild);if(curFromNodeKey){addKeyedRemoval(curFromNodeKey)}else{removeNode(curFromNodeChild,fromEl,true)}curFromNodeChild=matchingFromEl}}else{isCompatible=false}}}else if(curFromNodeKey){isCompatible=false}isCompatible=isCompatible!==false&&compareNodeNames(curFromNodeChild,curToNodeChild);if(isCompatible){morphEl(curFromNodeChild,curToNodeChild)}}else if(curFromNodeType===TEXT_NODE||curFromNodeType==COMMENT_NODE){isCompatible=true;if(curFromNodeChild.nodeValue!==curToNodeChild.nodeValue){curFromNodeChild.nodeValue=curToNodeChild.nodeValue}}}if(isCompatible){curToNodeChild=toNextSibling;curFromNodeChild=fromNextSibling;continue outer}if(curFromNodeKey){addKeyedRemoval(curFromNodeKey)}else{removeNode(curFromNodeChild,fromEl,true)}curFromNodeChild=fromNextSibling}if(curToNodeKey&&(matchingFromEl=fromNodesLookup[curToNodeKey])&&compareNodeNames(matchingFromEl,curToNodeChild)){fromEl.appendChild(matchingFromEl);morphEl(matchingFromEl,curToNodeChild)}else{var onBeforeNodeAddedResult=onBeforeNodeAdded(curToNodeChild);if(onBeforeNodeAddedResult!==false){if(onBeforeNodeAddedResult){curToNodeChild=onBeforeNodeAddedResult}if(curToNodeChild.actualize){curToNodeChild=curToNodeChild.actualize(fromEl.ownerDocument||doc)}fromEl.appendChild(curToNodeChild);handleNodeAdded(curToNodeChild)}}curToNodeChild=toNextSibling;curFromNodeChild=fromNextSibling}cleanupFromEl(fromEl,curFromNodeChild,curFromNodeKey);var specialElHandler=specialElHandlers[fromEl.nodeName];if(specialElHandler){specialElHandler(fromEl,toEl)}}var morphedNode=fromNode;var morphedNodeType=morphedNode.nodeType;var toNodeType=toNode.nodeType;if(!childrenOnly){if(morphedNodeType===ELEMENT_NODE){if(toNodeType===ELEMENT_NODE){if(!compareNodeNames(fromNode,toNode)){onNodeDiscarded(fromNode);morphedNode=moveChildren(fromNode,createElementNS(toNode.nodeName,toNode.namespaceURI))}}else{morphedNode=toNode}}else if(morphedNodeType===TEXT_NODE||morphedNodeType===COMMENT_NODE){if(toNodeType===morphedNodeType){if(morphedNode.nodeValue!==toNode.nodeValue){morphedNode.nodeValue=toNode.nodeValue}return morphedNode}else{morphedNode=toNode}}}if(morphedNode===toNode){onNodeDiscarded(fromNode)}else{morphEl(morphedNode,toNode,childrenOnly);if(keyedRemovalList){for(var i=0,len=keyedRemovalList.length;i<len;i++){var elToRemove=fromNodesLookup[keyedRemovalList[i]];if(elToRemove){removeNode(elToRemove,elToRemove.parentNode,false)}}}}if(!childrenOnly&&morphedNode!==fromNode&&fromNode.parentNode){if(morphedNode.actualize){morphedNode=morphedNode.actualize(fromNode.ownerDocument||doc)}fromNode.parentNode.replaceChild(morphedNode,fromNode)}return morphedNode}}var morphdom=morphdomFactory(morphAttrs);return morphdom});

// js_build_core: vendor/js/intersection-observer.min.js})(window,document);

// js_build_core: js/FCS.js
if (typeof FCS === 'undefined') FCS = {}; FCS.CLIENT_VERSION_REQUIRED = 20060925; FCS.MODEL_VERSION_REQUIRED = 220170401; FCS.MODEL_VERSION_MODELWEB = 320110101; FCS.SERVER_VERSION = 20071218; FCS.SERVER_VERSION_REQUIRED = 20071218; FCS.FCS_TRACECACHE_FMT = "/var/tmp/fcs-tracecache-%d-%s.dat"; FCS.FCS_STATEDUMP_FMT = "/var/tmp/fcs-statedump-%c-%d.dat"; FCS.FCS_PROFILE_FMT = "/var/tmp/fcs-profile-%d.dat"; FCS.PLATFORM_NONE = 0; FCS.PLATFORM_MFC = 1; FCS.PLATFORM_CAMYOU = 2; FCS.PLATFORM_CAMMUNITY = 2; FCS.USER_ID_START = 100; FCS.WORKER_ID_START = 50000000; FCS.SESSION_ID_START = 75000000; FCS.CHANNEL_ID_START = 100000000; FCS.SESSCHAN_ID_START = 200000000; FCS.CAMCHAN_ID_START = 400000000; FCS.WREQUEST_ID_START = 500000000; FCS.CLUB_ID_START = 0; FCS.CLUBGROUP_ID_START = 2000000000; FCS.USER_ID_END = 50000000; FCS.WORKER_ID_END = 75000000; FCS.SESSION_ID_END = 950000000; FCS.CHANNEL_ID_END = 400000000; FCS.SESSCHAN_ID_END = 300000000; FCS.CAMCHAN_ID_END = 500000000; FCS.WREQUEST_ID_END = 600000000; FCS.CLUB_ID_END = 2000000000; FCS.MYWEBCAM_EVERYONE = 0; FCS.MYWEBCAM_ONLYUSERS = 1; FCS.MYWEBCAM_ONLYFRIENDS = 2; FCS.MYWEBCAM_ONLYMODELS = 3; FCS.MYWEBCAM_FRIENDSANDMODELS = 4; FCS.MYWEBCAM_WHITELIST = 5; FCS.MYWEBCAM_FRIEND_ID = 100; FCS.FVT_ACL_ALL = 3968; FCS.FCPROTOCOL_MAGIC = 0x8722aab2; FCS.FCPROTOCOL_MAGIC_NETORDER = 0xb2aa2287; FCS.FCWPROT_MAGIC = 0x6288ccdd; FCS.FCTYPE_NULL = 0; FCS.FCTYPE_LOGIN = 1; FCS.FCTYPE_ADDFRIEND = 2; FCS.FCTYPE_PMESG = 3; FCS.FCTYPE_STATUS = 4; FCS.FCTYPE_DETAILS = 5;
 FCS.FCTYPE_TOKENINC = 6; FCS.FCTYPE_ADDIGNORE = 7; FCS.FCTYPE_PRIVACY = 8; FCS.FCTYPE_ADDFRIENDREQ = 9; FCS.FCTYPE_USERNAMELOOKUP = 10; FCS.FCTYPE_ZBAN = 11; FCS.FCTYPE_BROADCASTNEWS = 12; FCS.FCTYPE_ANNOUNCE = 13; FCS.FCTYPE_MANAGELIST = 14; FCS.FCTYPE_INBOX = 15; FCS.FCTYPE_GWCONNECT = 16; FCS.FCTYPE_RELOADSETTINGS = 17; FCS.FCTYPE_HIDEUSERS = 18; FCS.FCTYPE_RULEVIOLATION = 19; FCS.FCTYPE_SESSIONSTATE = 20; FCS.FCTYPE_REQUESTPVT = 21; FCS.FCTYPE_ACCEPTPVT = 22; FCS.FCTYPE_REJECTPVT = 23; FCS.FCTYPE_ENDSESSION = 24; FCS.FCTYPE_TXPROFILE = 25; FCS.FCTYPE_STARTVOYEUR = 26; FCS.FCTYPE_SERVERREFRESH = 27; FCS.FCTYPE_SETTING = 28; FCS.FCTYPE_BWSTATS = 29; FCS.FCTYPE_TKX = 30; FCS.FCTYPE_SETTEXTOPT = 31; FCS.FCTYPE_SERVERCONFIG = 32; FCS.FCTYPE_MODELGROUP = 33; FCS.FCTYPE_REQUESTGRP = 34; FCS.FCTYPE_STATUSGRP = 35; FCS.FCTYPE_GROUPCHAT = 36; FCS.FCTYPE_CLOSEGRP = 37; FCS.FCTYPE_UCR = 38; FCS.FCTYPE_MYUCR = 39; FCS.FCTYPE_SLAVECON = 40; FCS.FCTYPE_SLAVECMD = 41; FCS.FCTYPE_SLAVEFRIEND = 42; FCS.FCTYPE_SLAVEVSHARE = 43; FCS.FCTYPE_ROOMDATA = 44; FCS.FCTYPE_NEWSITEM = 45; FCS.FCTYPE_GUESTCOUNT = 46; FCS.FCTYPE_PRELOGINQ = 47; FCS.FCTYPE_MODELGROUPSZ = 48; FCS.FCTYPE_ROOMHELPER = 49; FCS.FCTYPE_CMESG = 50; FCS.FCTYPE_JOINCHAN = 51; FCS.FCTYPE_CREATECHAN = 52; FCS.FCTYPE_INVITECHAN = 53; FCS.FCTYPE_RPC = 54; FCS.FCTYPE_QUIETCHAN = 55;
 FCS.FCTYPE_BANCHAN = 56; FCS.FCTYPE_PREVIEWCHAN = 57; FCS.FCTYPE_SHUTDOWN = 58; FCS.FCTYPE_LISTBANS = 59; FCS.FCTYPE_UNBAN = 60; FCS.FCTYPE_SETWELCOME = 61; FCS.FCTYPE_CHANOP = 62; FCS.FCTYPE_LISTCHAN = 63; FCS.FCTYPE_TAGS = 64; FCS.FCTYPE_SETPCODE = 65; FCS.FCTYPE_SETMINTIP = 66; FCS.FCTYPE_UEOPT = 67; FCS.FCTYPE_HDVIDEO = 68; FCS.FCTYPE_METRICS = 69; FCS.FCTYPE_OFFERCAM = 70; FCS.FCTYPE_REQUESTCAM = 71; FCS.FCTYPE_MYWEBCAM = 72; FCS.FCTYPE_MYCAMSTATE = 73; FCS.FCTYPE_PMHISTORY = 74; FCS.FCTYPE_CHATFLASH = 75; FCS.FCTYPE_TRUEPVT = 76; FCS.FCTYPE_BOOKMARKS = 77; FCS.FCTYPE_EVENT = 78; FCS.FCTYPE_STATEDUMP = 79; FCS.FCTYPE_RECOMMEND = 80; FCS.FCTYPE_EXTDATA = 81; FCS.FCTYPE_NOTIFY = 84; FCS.FCTYPE_PUBLISH = 85; FCS.FCTYPE_XREQUEST = 86; FCS.FCTYPE_XRESPONSE = 87; FCS.FCTYPE_EDGECON = 88; FCS.FCTYPE_XMESG = 89; FCS.FCTYPE_CLUBSHOW = 90; FCS.FCTYPE_CLUBCMD = 91; FCS.FCTYPE_AGENT = 92; FCS.FCTYPE_RESERVED_93 = 93; FCS.FCTYPE_RESERVED_94 = 94; FCS.FCTYPE_ZGWINVALID = 95; FCS.FCTYPE_CONNECTING = 96; FCS.FCTYPE_CONNECTED = 97; FCS.FCTYPE_DISCONNECTED = 98; FCS.FCTYPE_LOGOUT = 99; FCS.FCTYPE_XRPC = 1000; FCS.FCRESPONSE_SUCCESS = 0; FCS.FCRESPONSE_ERROR = 1; FCS.FCRESPONSE_NOTICE = 2; FCS.FCRESPONSE_SUSPEND = 3; FCS.FCRESPONSE_SHUTOFF = 4; FCS.FCRESPONSE_WARNING = 5; FCS.FCRESPONSE_QUEUED = 6;
 FCS.FCRESPONSE_NO_RESULTS = 7; FCS.FCRESPONSE_CACHED = 8; FCS.FCRESPONSE_JSON = 9; FCS.FCRESPONSE_INVALIDUSER = 10; FCS.FCRESPONSE_NOACCESS = 11; FCS.FCRESPONSE_NOSPACE = 12; FCS.FCRESPONSE_INVALIDREQ = 13; FCS.FCRESPONSE_INVALIDARG = 14; FCS.FCRESPONSE_NOTFOUND = 15; FCS.FCRESPONSE_INSUFFICIENT = 16; FCS.FCRESPONSE_EXPIRED = 17; FCS.FCRESPONSE_BINARY = 18; FCS.FCRESPONSE_UNKNOWN = 255; FCS.FCCHAN_ERR_NOCHANNEL = 2; FCS.FCCHAN_ERR_NOTMEMBER = 3; FCS.FCCHAN_ERR_GUESTMUTE = 4; FCS.FCCHAN_ERR_GROUPMUTE = 5; FCS.FCCHAN_ERR_NOTALLOWED = 6; FCS.FCGROUP_NONE = 0; FCS.FCGROUP_EXPIRED = 1; FCS.FCGROUP_BUSY = 2; FCS.FCGROUP_EMPTY = 3; FCS.FCGROUP_DECLINED = 4; FCS.FCGROUP_UNAVAILABLE = 5; FCS.FCGROUP_SESSION = 9; FCS.FCACCEPT_NOBODY = 0; FCS.FCACCEPT_FRIENDS = 1; FCS.FCACCEPT_ALL = 2; FCS.FCACCEPT_V2_NONE = 8; FCS.FCACCEPT_V2_FRIENDS = 16; FCS.FCACCEPT_V2_MODELS = 32; FCS.FCACCEPT_V2_PREMIUMS = 64; FCS.FCACCEPT_V2_BASICS = 128; FCS.FCACCEPT_V2_BOOKMARKS = 256; FCS.FCACCEPT_V2_TOPFRIENDS = 512; FCS.FCACCEPT_V2_CLUBMEMBERS = 1024; FCS.FCNOSESS_NONE = 0; FCS.FCNOSESS_PVT = 1; FCS.FCNOSESS_GRP = 2; FCS.FCNOSESS_TRUEPVT = 4; FCS.FCNOSESS_TOKEN_MIN = 8; FCS.FCNOSESS_PLATFORM = 16; FCS.FCNOSESS_VIDEOSERVER = 32; FCS.FCNOSESS_INVALID_STATE = 64; FCS.FCNOSESS_MODEL_SETTINGS = 128; FCS.FCNOSESS_CLIENT_ERROR = 256; FCS.FCMODEL_NONE = 0; FCS.FCMODEL_NOGROUP = 1; FCS.FCMODEL_FEATURE1 = 2; FCS.FCMODEL_FEATURE2 = 4;
 FCS.FCMODEL_FEATURE3 = 8; FCS.FCMODEL_FEATURE4 = 16; FCS.FCMODEL_FEATURE5 = 32; FCS.FCUCR_VM_LOUNGE = 0; FCS.FCUCR_VM_MYWEBCAM = 1; FCS.FCUCR_CREATOR = 0; FCS.FCUCR_FRIENDS = 1; FCS.FCUCR_MODELS = 2; FCS.FCUCR_PREMIUMS = 4; FCS.FCUCR_BASICS = 8; FCS.FCUCR_ALL = 15; FCS.FCUPDATE_NONE = 0; FCS.FCUPDATE_MISSMFC = 1; FCS.FCUPDATE_NEWTIP = 2; FCS.FCUPDATE_REGION_SAFE = 3; FCS.FCUPDATE_CAMSCORE = 4; FCS.FCUPDATE_ROOMFILTER = 5; FCS.FCUPDATE_CLUBMEMBERSHIP = 6; FCS.FCUPDATE_CLUB = 7; FCS.FCUPDATE_CLUBCACHE = 8; FCS.FCUPDATE_SHAREDATA = 9; FCS.FCBAN_NONE = 0; FCS.FCBAN_TEMP = 1; FCS.FCBAN_60DAY = 2; FCS.FCBAN_LIFE = 3; FCS.FCCHAN_EVENT_NONE = 0; FCS.FCCHAN_EVENT_CLEARCHAT = 1; FCS.FCCHAN_EVENT_MUTE = 2; FCS.FCCHAN_EVENT_TOPIC = 3; FCS.FCCHAN_EVENT_COUNTDOWN = 4; FCS.FCCHAN_EVENT_KICK = 5; FCS.FCCHAN_EVENT_WHITEBOARD_ON = 6; FCS.FCCHAN_EVENT_WHITEBOARD_OFF = 7; FCS.FCCHAN_EVENT_RESERVED_008 = 8; FCS.FCCHAN_EVENT_RESERVED_009 = 9; FCS.FCCHAN_EVENT_RESERVED_010 = 10; FCS.FCCHAN_EVENT_RESERVED_011 = 11; FCS.FCCHAN_EVENT_RESERVED_012 = 12; FCS.FCCHAN_EVENT_RESERVED_013 = 13; FCS.FCCHAN_EVENT_RESERVED_014 = 14; FCS.FCCHAN_EVENT_RESERVED_015 = 15; FCS.FCCHAN_EVENT_RESERVED_016 = 16; FCS.FCCHAN_EVENT_RESERVED_017 = 17; FCS.FCCHAN_EVENT_RESERVED_018 = 18; FCS.FCCHAN_EVENT_RESERVED_019 = 19; FCS.FCNEWSOPT_NONE = 0; FCS.FCNEWSOPT_IN_CHAN = 1; FCS.FCNEWSOPT_IN_PM = 2; FCS.FCNEWSOPT_AUTOFRIENDS_OFF = 4; FCS.FCNEWSOPT_IN_CHAN_NOPVT = 8;
 FCS.FCNEWSOPT_IN_CHAN_NOGRP = 16; FCS.FCL_NULL = 0; FCS.FCL_FRIENDS = 1; FCS.FCL_IGNORES = 2; FCS.FCL_BOOKMARKS = 3; FCS.FCL_HIDDEN = 4; FCS.FCL_HPFRIENDS = 5; FCS.FCL_TOPFRIENDS = 6; FCS.FCL_NEWS_SUBS = 7; FCS.FCL_NEWS_HIDDEN = 8; FCS.FCL_MYWEBCAM_ALLOW = 9; FCS.FCL_MYWEBCAM_DENY = 10; FCS.FCL_BLOCKS_STATES = 11; FCS.FCL_BLOCKS_COUNTRIES = 12; FCS.FCL_ROOMFILTERS = 13; FCS.FCL_BANS = 14; FCS.FCL_MUTES = 15; FCS.FCL_UEOPTS = 16; FCS.FCL_RESERVED_17 = 17; FCS.FCL_RESERVED_18 = 18; FCS.FCL_RESERVED_19 = 19; FCS.FCL_TAGS = 20; FCS.FCL_CAMS = 21; FCS.FCL_ROOMMATES = 22; FCS.FCL_SOCIALDATA = 23; FCS.FCL_SHARE_CLUBS = 24; FCS.FCL_SHARE_CLUBMEMBERSHIPS = 25; FCS.FCL_SHARE_CLUBSHOWS = 26; FCS.FCL_SHARE_BADGES = 27; FCS.FCL_SESSIONS = 28; FCS.FCL_CHANNELS = 29; FCS.FCL_RESERVED_30 = 30; FCS.MAX_FCL = 31; FCS.EVSESSION_NONE = 0; FCS.EVSESSION_PRIVATE = 1; FCS.EVSESSION_VOYEUR = 2; FCS.EVSESSION_GROUP = 3; FCS.EVSESSION_FEATURE = 4; FCS.EVSESSION_AWAYPVT = 5; FCS.EVSESSION_CLUB = 6; FCS.EVSESSION_TIP = 10; FCS.EVSESSION_PUBLIC = 100; FCS.EVSESSION_AWAY = 101; FCS.EVSESSION_START = 102; FCS.EVSESSION_UPDATE = 103; FCS.EVSESSION_STOP = 104; FCS.EVSESSION_SPECIAL = 1000; FCS.FCVIDEO_TX_IDLE = 0; FCS.FCVIDEO_TX_RESET = 1; FCS.FCVIDEO_TX_AWAY = 2;
 FCS.FCVIDEO_TX_CONFIRMING = 11; FCS.FCVIDEO_TX_PVT = 12; FCS.FCVIDEO_TX_GRP = 13; FCS.FCVIDEO_TX_CLUB = 14; FCS.FCVIDEO_TX_KILLMODEL = 15; FCS.FCVIDEO_C2C_ON = 20; FCS.FCVIDEO_C2C_OFF = 21; FCS.FCVIDEO_RX_IDLE = 90; FCS.FCVIDEO_RX_PVT = 91; FCS.FCVIDEO_RX_VOY = 92; FCS.FCVIDEO_RX_GRP = 93; FCS.FCVIDEO_RX_CLUB = 94; FCS.FCVIDEO_NULL = 126; FCS.FCVIDEO_OFFLINE = 127; FCS.FCACT_CHAN_TIP = 1006; FCS.FCACT_CHAN_BAN = 1011; FCS.FCACT_CHAN_UNBAN = 1012; FCS.FCACT_CHAN_JOIN = 1051; FCS.FCACT_CHAN_PART = 1052; FCS.FCACT_CHAN_TOPIC = 1061; FCS.FCACT_CHAN_WHITEBOARD_ON = 1101; FCS.FCACT_CHAN_WHITEBOARD_OFF = 1102; FCS.FCACT_LOGIN = 8001; FCS.FCACT_LOGOUT = 8002; FCS.FCACT_CHECKIN = 8003; FCS.FCACT_REFRESH = 8004; FCS.FVT_NONE = 0; FCS.FVT_PUBLIC = 1; FCS.FVT_PRIVATE = 2; FCS.FVT_GROUP = 4; FCS.FVT_MYWEBCAM = 8; FCS.FVT_CLUB = 16; FCS.FVT_VOYEUR = 32; FCS.FVT_RESERVED_64 = 64; FCS.FVT_ACL_GUEST = 128; FCS.FVT_ACL_BASIC = 256; FCS.FVT_ACL_PREMIUM = 512; FCS.FVT_ACL_MODEL = 1024; FCS.FVT_ACL_ADMIN = 2048; FCS.FVT_ALLOW_PUBLISH = 4096; FCS.FVT_ALLOW_VIEW = 8192; FCS.FVT_ALLOW_PREVIEW = 16384; FCS.FVT_ALLOW_MANAGE = 32768; FCS.FVT_ALLOW_TRANSCODE = 65536; FCS.FVT_ALLOW_MONITOR_STREAMS = 131072; FCS.FVT_ALLOW_MONITOR_CLIENTS = 262144; FCS.FVT_OBS_RTMP = 524288; FCS.FVT_OBS_WEBRTC_V1 = 1048576; FCS.FVT_OBS_WEBRTC_V2 = 2097152; FCS.FVT_MWEB_RTMP = 4194304;
 FCS.FVT_MWEB_WEBRTC = 8388608; FCS.FVT_MWEB_RES1 = 16777216; FCS.FVT_OBS_CUSTOM = 33554432; FCS.VST_FMS = 0; FCS.VST_WOWZA = 1; FCS.VST_WOWZA_RELAY = 2; FCS.VST_WOWZA_CAM2CAM = 3; FCS.VST_WOWZA_OBSRTC_V1 = 6; FCS.VST_WOWZA_OBSRTC_V2 = 7; FCS.VST_WOWZA_OBS = 8; FCS.VST_NGINX = 10; FCS.VST_NULL = 255; FCS.OBSMON_NULL = 0; FCS.OBSMON_APPROVING = 10; FCS.OBSMON_UNAPPROVED = 11; FCS.OBSMON_READY = 12; FCS.OBSMON_ACTIVE = 20; FCS.OBSMON_TIMEOUT = 30; FCS.OBSMON_INACTIVE = 31; FCS.OBSMON_CLOSED = 32; FCS.FCRPC_NONE = 0; FCS.FCRPC_UPDATEFRIEND = 1; FCS.FCRPC_UPDATEIGNORE = 2; FCS.FCRPC_RESLOADED = 3; FCS.FCRPC_W_READY = 4; FCS.FCRPC_W_OFFLINEQUERY = 5; FCS.FCRPC_W_FRIENDLIST = 6; FCS.FCRPC_W_IGNORELIST = 7; FCS.FCRPC_W_EXT_REQUEST = 8; FCS.FCRPC_W_EXT_RESPONSE = 9; FCS.FCRPC_FCSVAR = 10; FCS.FCRPC_RELAY_HOOK = 11; FCS.FCRPC_RELAY_FILTER = 12; FCS.FCRPC_W_REGISTER = 13; FCS.FCRPC_W_SUBSCRIBE = 14; FCS.FCRPC_W_PROXYMSG = 15; FCS.FCW_STATE_INIT = 0; FCS.FCW_STATE_READY = 1; FCS.FCW_STATE_WORKING = 2; FCS.FCW_STATE_WAITING = 3; FCS.FCW_STATE_INVALID = 4; FCS.FCPORT_MASTER_EDGE = 4000; FCS.FCPORT_MASTER_AUTH = 4001; FCS.FCPORT_MASTER_WORKER = 4003; FCS.FCPORT_AUTH_DATAGRAM = 4002; FCS.FCPORT_EDGE_WORKER = 4004; FCS.FCPORT_EDGE_POLICY = 843; FCS.FCPORT_EDGE_AJAX = 8080; FCS.FCPORT_EDGE_CLIENT1 = 5001; FCS.FCPORT_EDGE_CLIENT2 = 8550;
 FCS.FCPORT_EDGE_CLIENT3 = 8100; FCS.FCPORT_EDGE_WEBSOCKGW = 8101; FCS.FCPORT_EDGE_LIBWEBSOCK = 8080; FCS.FCPORT_WORKER_BASE = 9000; FCS.FCAPP_NONE = 0; FCS.FCAPP_MASTER = 1; FCS.FCAPP_CHAT = 2; FCS.FCAPP_WORKER = 3; FCS.FCAPP_AUTH = 4; FCS.FCAPP_LOADTEST = 5; FCS.FCAPP_TRANSCODER = 6; FCS.FCAPP_CLIENT = 7; FCS.FCAPP_FLUX_CLIENT = 32; FCS.FCAPP_FLUX_SERVICE = 33; FCS.FCAPP_FLUX_BROKER = 34; FCS.FCAPP_WWW = 100; FCS.FCAPP_PROFILES = 101; FCS.FCAPP_MOBILE = 102; FCS.FCAPP_IMG = 103; FCS.FCAPP_API = 104; FCS.FCAPP_ADMIN = 105; FCS.FCAPP_ARCHIVE = 204; FCS.FCAPP_DATABASE = 205; FCS.FCAPP_FMS = 500; FCS.FCAPP_WOWZA = 501; FCS.FCAPP_WOWZA_RELAY = 502; FCS.FCAPP_WOWZA_CAM2CAM = 503; FCS.FCAPP_WOWZA_OBSRTC_V1 = 506; FCS.FCAPP_WOWZA_OBSRTC_V2 = 507; FCS.FCAPP_WOWZA_OBS = 508; FCS.FCAPP_WOWZA_OBSEXT = 509; FCS.FCAPP_NGINX = 510; FCS.FCAPP_NGX_INGEST = 512; FCS.FCAPP_FMS_SHARED = 801; FCS.FCAPP_CAM2CAM = 802; FCS.FCAPP_FMS_ORIGIN = 803; FCS.FCAPP_FMS_EDGE = 804; FCS.FCAPP_OAUTH_IDENTITY = 901; FCS.FCAPP_OAUTH_CLIENT = 902; FCS.FCAPP_API_GATEWAY = 951; FCS.ROOMFILTER_EMPTY = 0; FCS.ROOMFILTER_LOG = 1; FCS.ROOMFILTER_DROP = 2; FCS.ROOMFILTER_WARN = 4; FCS.ROOMFILTER_REGEX = 8; FCS.ROOMFILTER_SPECIAL = 16; FCS.ROOMFILTER_FROMHELPER = 32; FCS.ROOMFILTER_EXACT_WORD = 64; FCS.ROOMFILTER_RESERVED_7 = 128; FCS.ROOMFILTER_RESERVED_8 = 256;
 FCS.ROOMFILTER_RESERVED_9 = 512; FCS.ROOMFILTER_IS_GUEST = 1024; FCS.ROOMFILTER_IS_BASIC = 2048; FCS.ROOMFILTER_IS_PREMIUM = 4096; FCS.ROOMFILTER_IS_MODEL = 8192; FCS.ROOMFILTER_IN_PUBLIC = 16384; FCS.ROOMFILTER_IN_SESSION = 32768; FCS.ROOMFILTER_RESERVED_16 = 65536; FCS.ROOMFILTER_RESERVED_17 = 131072; FCS.ROOMFILTER_RESERVED_18 = 262144; FCS.ROOMFILTER_RESERVED_19 = 524288; FCS.ROOMFILTER_RESERVED_20 = 1048576; FCS.FCLEVEL_INVALID = -1; FCS.FCLEVEL_GUEST = 0; FCS.FCLEVEL_BASIC = 1; FCS.FCLEVEL_PREMIUM = 2; FCS.FCLEVEL_MODEL = 4; FCS.FCLEVEL_ADMIN = 5; FCS.FCCHAN_NOOPT = 0; FCS.FCCHAN_JOIN = 1; FCS.FCCHAN_PART = 2; FCS.FCCHAN_OLDMSG = 4; FCS.FCCHAN_HISTORY = 8; FCS.FCCHAN_LIST = 16; FCS.FCCHAN_WELCOME = 32; FCS.FCCHAN_BATCHPART = 64; FCS.FCCHAN_EXT_USERNAME = 128; FCS.FCCHAN_EXT_USERDATA = 256; FCS.FCCHAN_NO_CHANGES = 512; FCS.FCCHAN_APPEND = 1024; FCS.FCCHAN_REPLACE = 2048; FCS.FCCHAN_UPDATE = 4096; FCS.FCCHAN_QUERY = 8192; FCS.FCCHAN_EXPIRE = 16384; FCS.FCCHAN_NOTIFY = 32768; FCS.FCCHAN_APPLY = 65536; FCS.FCCHAN_IMPORT = 131072; FCS.FCCHAN_BATCH = 262144; FCS.FCCHAN_TRUNCATE = 524288; FCS.FCOPT_NONE = 0; FCS.FCOPT_BOLD = 1; FCS.FCOPT_ITALICS = 2; FCS.FCOPT_REMOTEPVT = 4; FCS.FCOPT_TRUEPVT = 8; FCS.FCOPT_CAM2CAM = 16; FCS.FCOPT_RGNBLOCK = 32; FCS.FCOPT_TOKENAPPROX = 64; FCS.FCOPT_TOKENHIDE = 128; FCS.FCOPT_RPAPPROX = 256; FCS.FCOPT_RPHIDE = 512;
 FCS.FCOPT_HDVIDEO = 1024; FCS.FCOPT_MODELSW = 2048; FCS.FCOPT_GUESTMUTE = 4096; FCS.FCOPT_BASICMUTE = 8192; FCS.FCOPT_SMALLCAPS = 16384; FCS.FCOPT_XMPP = 32768; FCS.FCOPT_WHITEBOARD1 = 65536; FCS.FCOPT_WHITEBOARD2 = 131072; FCS.FCOPT_ATTACHED = 262144; FCS.FCOPT_WEBRTCV1 = 524288; FCS.FCOPT_OBSRTCV1 = 1048576; FCS.FCOPT_OBSRTCV2 = 2097152; FCS.FCOPT_SIDEKICK = 4194304; FCS.FCOPT_SPLITCAM = 8388608; FCS.FCOPT_AGENT = 16777216; FCS.FCOPT_OBSCUSTOM = 33554432; FCS.FCUOPT_EMPTY = 0; FCS.FCUOPT_PLATFORM_MFC = 1; FCS.FCUOPT_PLATFORM_CAMYOU = 2; FCS.FCUOPT_PLATFORM_OFFLINE = 4; FCS.FCUOPT_PLATFORM_XSDEFAULT = 8; FCS.FCUOPT_RESERVED_05 = 16; FCS.FCUOPT_RESERVED_06 = 32; FCS.FCUOPT_RESERVED_07 = 64; FCS.FCUOPT_LOG_XMESG = 128; FCS.FCUOPT_RESERVED_09 = 256; FCS.FCUOPT_RESERVED_10 = 512; FCS.FCUOPT_RESERVED_11 = 1024; FCS.FCUOPT_RESERVED_12 = 2048; FCS.FCUOPT_RESERVED_13 = 4096; FCS.FCUOPT_RESERVED_14 = 8192; FCS.FCUOPT_RESERVED_15 = 16384; FCS.FCUOPT_RESERVED_16 = 32768; FCS.FCUOPT_FLAG_ACCT = 65536; FCS.FCUOPT_FLAG_HDVIDEO = 131072; FCS.FCUOPT_FLAG_MODELSW = 262144; FCS.FCUOPT_FLAG_XMPP = 524288; FCS.FCUOPT_FLAG_WHITEBOARD1 = 1048576; FCS.FCUOPT_FLAG_WHITEBOARD2 = 2097152; FCS.FCUOPT_FLAG_ATTACHED = 4194304; FCS.FCUOPT_FLAG_WEBRTCV1 = 8388608; FCS.FCUOPT_FLAG_NG_EDGE = 16777216; FCS.FCUOPT_FLAG_NG_ADDR_ORIGIN = 33554432; FCS.FCUOPT_FLAG_OBSRTCV1 = 67108864; FCS.FCUOPT_FLAG_OBSRTCV2 = 134217728; FCS.FCUOPT_FLAG_SIDEKICK = 268435456; FCS.FCUOPT_FLAG_SPLITCAM = 536870912; FCS.FCUOPT_FLAG_LWSCHAT = 1099511627776; FCS.FCUSER_TESTCAM1 = 469518; FCS.FCUSER_TESTCAM2 = 469516;
 FCS.FCUSER_TESTCAM3 = 469517; FCS.FCUSER_MFCNEWS = 481462; FCS.FCUSER_CAMNEWS = 481464; FCS.FCUSER_MFCSHARE = 1535156; FCS.FCUSER_CAMSHARE = 1535157; FCS.FCUSER_LOUNGE = 486121; FCS.FCUSER_LOUNGE1K = 486123; FCS.FCUSER_LOUNGE10K = 486124; FCS.FCUSER_CAM_LOUNGE = 486128; FCS.FCSTREAM_MAGIC = 0xBEAD9827; FCS.FCSBAN_NONE = 0; FCS.FCSBAN_USER = 1; FCS.FCSBAN_IP = 2; FCS.FCS_SUBSCRIBE = 1; FCS.FCS_SYNC = 2; FCS.FCS_SESSION = 10; FCS.FCS_BAN = 11; FCS.FCS_MODEL = 12; FCS.FCS_EVENT = 13; FCS.FCS_EVENT2 = 14; FCS.FCS_EXTDATA = 15; FCS.FCS_GWCONNECT = 16; FCS.FCS_MUTE = 18; FCS.FCS_AUTHREQ = 100; FCS.FCS_BANREQ = 101; FCS.FCS_EVENTREQ = 102; FCS.FCS_EVENTRESP = 103; FCS.FCS_SENDEVENT = 104; FCS.FCS_SENDEVENT2 = 105; FCS.TKOPT_NONE = 0; FCS.TKOPT_START = 1; FCS.TKOPT_STOP = 2; FCS.TKOPT_OPEN = 4; FCS.TKOPT_PVT = 8; FCS.TKOPT_VOY = 16; FCS.TKOPT_GRP = 32; FCS.TKOPT_CLUB = 64; FCS.TKOPT_TIP = 256; FCS.TKOPT_TIP_HIDDEN_AMT = 512; FCS.TKOPT_TIP_OFFLINE = 1024; FCS.TKOPT_TIP_MSG = 2048; FCS.TKOPT_TIP_ANON = 4096; FCS.TKOPT_TIP_PUBLIC = 8192; FCS.TKOPT_TIP_FROMROOM = 16384; FCS.TKOPT_TIP_PUBLICMSG = 32768; FCS.TKOPT_TIP_HISTORY = 65536; FCS.TKOPT_TIP_SILENT = 131072; FCS.TKOPT_TIP_NOCOUNT = 262144; FCS.TKOPT_HDVIDEO = 1048576; FCS.TKOPT_TIP_OFFLINE_USER = 2097152;
 FCS.TKOPT_TIP_OFFLINE_MODEL = 4194304; FCS.TKOPT_TIP_PURCHASE = 8388608; FCS.TKOPT_TIP_PURCHASE_CLUB = 16777216; FCS.TKOPT_TIP_PURCHASE_GOAL = 33554432; FCS.TKOPT_TIP_PURCHASE_NOTIFY = 67108864; FCS.TKOPT_TIP_PURCHASE_LINK = 134217728; FCS.TKOPT_TIP_PURCHASE_ALBUM = 268435456; FCS.TKOPT_TIP_PURCHASE_COLLECTION = 536870912; FCS.TKOPT_TIP_PURCHASE_STOREITEM = 1073741824; FCS.TKOPT_TIP_PURCHASE_OTHER = 2147483648; FCS.V1_FLV = 0; FCS.V1_F4V = 1; FCS.V2_NONE = 2; FCS.V2_FLV = 4; FCS.V2_F4V = 8; FCS.V2_MP4X = 16; FCS.V2_MP4W = 32; FCS.FCWOPT_NONE = 0; FCS.FCWOPT_ADD = 1; FCS.FCWOPT_REMOVE = 2; FCS.FCWOPT_LIST = 4; FCS.FCWOPT_NO_RECEIPT = 128; FCS.FCWOPT_REDIS_JSON = 256; FCS.FCWOPT_USERID = 1024; FCS.FCWOPT_USERDATA = 2048; FCS.FCWOPT_USERNAME = 4096; FCS.FCWOPT_C_USERNAME = 32768; FCS.FCWOPT_C_MONTHSLOGIN = 65536; FCS.FCWOPT_C_LEVEL = 131072; FCS.FCWOPT_C_VSTATE = 262144; FCS.FCWOPT_C_CHATTEXT = 524288; FCS.FCWOPT_C_PROFILE = 1048576; FCS.FCWOPT_C_AVATAR = 2097152; FCS.FCWOPT_C_RANK = 4194304; FCS.FCWOPT_C_SDATE = 8388608; FCS.EVUP_NONE = 0; FCS.EVUP_DIFF = 1; FCS.EVUP_FULL = 2; FCS.FCQ_NULL = 0; FCS.FCQ_SESSIONS = 1; FCS.FCQ_USERS = 2; FCS.FCQ_SETTINGS = 3; FCS.FCQ_IDX = 4; FCS.FCQ_CHANNEL = 5; FCS.FCQ_PM = 6; FCS.FCQ_ACTLOG = 7; FCS.FCQ_GENERAL = 8; FCS.FCQ_MODELUSAGE = 9; FCS.FCQ_LASTLOGIN = 10; FCS.FCQ_LASTCHAT = 11;
 FCS.FCQ_RESERVED_12 = 12; FCS.FCQ_RESERVED_13 = 13; FCS.FCQ_RESERVED_14 = 14; FCS.FCQ_RESERVED_15 = 15; FCS.FCQ_MAX_SZ = 16;FCS.MapConst = function(keyType, val, defaultName) { for ( var property in this ) { if ( this.hasOwnProperty(property) && property.indexOf(keyType) === 0 && this[property] == val ) return property; } return defaultName ? (keyType + "_unknown_" + val) : false;};

// js_build_core: MfcJs/MfcEvents/FcMsg.j}FcMsg.prototype.init = function(hObj ){ this.type = 0; this.from = 0; this.to = 0; this.arg1 = 0; this.arg2 = 0; this.data = null; if(typeof hObj === 'string') { this.deserialize(); } if ( typeof hObj === 'object') { if (hObj.hasOwnProperty('type')) this.type = parseInt(hObj.type ); if (hObj.hasOwnProperty('from')) this.from = parseInt(hObj.from ); if (hObj.hasOwnProperty('to')) this.to = parseInt(hObj.to ); if (hObj.hasOwnProperty('arg1')) this.arg1 = parseInt(hObj.arg1 ); if (hObj.hasOwnProperty('arg2')) this.arg2 = parseInt(hObj.arg2 ); if (hObj.hasOwnProperty('data')) this.data = hObj.data; if(this.data ) { this.obj = this.unpackJSON(this.data ); } }};FcMsg.prototype.unpackJSON = function(str ){ if(this.debug ) { console.log('DEBUG: ' + str); } if(typeof(str) != 'string' ) { if(this.debug ) { console.log('NOT A STRING: ' + str); } return null; } if(str.substr(0,3) == '%7B' && str.substr(str.length - 3) == '%7D' ) {
 if(this.debug ) { console.log('UNPACKED JSON: ' + str); } if(g_hQS && g_hQS.sanitize_fcw ) { str = str.replace(/%[89A-F][0-9A-F]/g,''); str = str.replace(/%(?![0-9A-Fa-f]{2})/g,''); } str = decodeURIComponent(str); } var json; if(str.charAt(0) != '{' || str.charAt(str.length - 1 ) != '}' ) { if(this.debug ) { console.log('NOT JSON: (' + str.charAt(0) + ' || ' + str.charAt(str.length - 1 ) + ') ' + str); } return null; } if(str.charAt(1) == '%' ) { str = decodeURIComponent(str); if(this.debug ) { console.log('DECODED JSON: ' + str); } } var json; try { json = JSON.parse(str ); } catch(e) { console.log(e); console.log(str); } return json;};FcMsg.prototype.build };FcMsg.prototype.serialize = function(){ return JSON.stringify(this.build() ); };FcMsg.prototype.deserialize = function(str){ var retVal = false; var json; try { json = JSON.parse(str ); if ( typeof json === 'object' && json.hasOwnProperty("type") && json.hasOwnProperty("from") && json.hasOwnProperty("to") && json.hasOwnProperty("arg1") && json.hasOwnProperty("arg2") ) { this.type = json.type; this.from = json.from; this.to = json.to; this.arg1 = json.arg1; this.arg2 = json.arg2; if (json.hasOwnProperty("data")) { this.data = json.data; this.obj = this.unpackJSON(this.data ); } else { this.data = null; this.obj = null; } retVal = true; } else console.log("[FCMSG] invalid obj deserialized: " + str); } catch(e) { console.log("[FCMSG] deserialize error in JSON.parse"); console.log(e); console.log(str);
 } return retVal;};

// js_build_core: MfcJs/MfcEvents/MfcEvents.js
var MfcEvents = EventEmitter2;MfcEvents.prototype.isIE_Edge = navigator.userAgent.indexOf('Edge/') > -1;MfcEvents.prototype.eventContexts = {};MfcEvents.prototype.__on = MfcEvents.prototype.on;MfcEvents.prototype.on = function(events, listener, context ){ if(! Array.isArray(events ) ) { events = [ events ]; } for(var a=0; a < events.length; a++ ) { var event = events[a]; if(context ) { if(! Array.isArray(context) ) { context = [ context ]; } var arrayBranch = this.eventContexts; for(var b=0; b < context.length; b++ ) { if(! arrayBranch[ context[b] ] ) { arrayBranch[ context[b] ] = []; } arrayBranch = arrayBranch[ context[b] ]; if(b == context.length - 1 ) { if(! arrayBranch.__events ) { arrayBranch.__events = []; } arrayBranch.__events.push([event,listener]); } } } } this.__on(event, listener );};MfcEvents.prototype.offByContext = function(context ){ if(! Array.isArray(context) ) { context = [ context ]; } var deleteAllChildren = function(arrayBranch ) { if(arrayBranch.__events )
 { for(var b=0; b < arrayBranch.__events.length; b++ ) { self.off(arrayBranch.__events[b][0], arrayBranch.__events[b][1] ); } delete arrayBranch.__events; } for(var nK in arrayBranch ) { deleteAllChildren(arrayBranch[nK] ); } }; var self = this; var arrayBranch = this.eventContexts; for(var a=0; a < context.length; a++ ) { arrayBranch = arrayBranch[ context[a] ] || []; if(a == context.length - 1 ) { deleteAllChildren(arrayBranch ); } }};MfcEvents.prototype.onRx = function(){ arguments[0] = 'RX.' + arguments[0]; if(this.isIE_Edge ) try { this.on.apply(this, arguments ); } catch(e) { console.log(e); } else this.on.apply(this, arguments );};MfcEvents.prototype.onTx = function(){ arguments[0] = 'TX.' + arguments[0]; this.on.apply(this, arguments );};MfcEvents.prototype.offRx = function(){ arguments[0] = 'RX.' + arguments[0]; this.off.apply(this, arguments );
};MfcEvents.prototype.offTx = function(){ arguments[0] = 'TX.' + arguments[0]; this.off.apply(this, arguments );};MfcEvents.prototype.emitRx = function(){ arguments[0] = 'RX.' + arguments[0]; if(this.isIE_Edge ) try { this.emit.apply(this, arguments ); } catch(e) { } else this.emit.apply(this, arguments );};MfcEvents.prototype.emitTx = function(){ arguments[0] = 'TX.' + arguments[0]; this.emit.apply(this, arguments );};

// js_build_core: MfcJs/MfcClientRes/MfcClientRes.js
function MfcClientRes(){ this.Lounges = { 486121: { username: 'Lounge' }, 486123: { username: 'Lounge1000' }, 486124: { username: 'Lounge10000' }, 486128: { username: 'Lounge' } };};MfcClientRes.apiUrl = '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1");try{ var p; if(( p = opener ) || ( p = top ) ) { var apiSubdomain; if(p.location.search.match(/api_subdomain=([^.]+)/) ) apiSubdomain = RegExp.$1; else if(p.location.href.match(/dev-/) ) apiSubdomain = window.location.host.split('.')[0]; if(apiSubdomain ) { MfcClientRes.apiUrl = '//' + apiSubdomain + '.' + ( document.domain.replace(/.*\.(\w+\.\w+)$/,"$1") ); if(apiSubdomain.match(/dev-/) ) { MfcClientRes.apiUrl += '/api'; } } }}catch(e) { console.log(e); }

// js_build_core: MfcJs/MfcChatLogs/MfcChatLogs.js
function MfcChatLogs(config ){ config = config || {}; if(! config.video_div_id ) { config.video_div_id = 'mediaplayer'; } this.callback = config.callback || null; this.apiUrl = ( config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ) + '/'; this.config = config; this.getToken();};MfcChatLogs.prototype.getLogs = function(options ){ return this.getChatLogs(options);};MfcChatLogs.prototype.getChatLogs = function(options ){ var reqObj = new XMLHttpRequest(); var requestString = this.apiUrl + 'chatLogs/'; if(options.channel_id || options.to_id ) { requestString += 'getChatLogs'; }
 else { requestString += 'getIndex'; } requestString += '?'; if(URLSearchParams ) { var urlParams = new URLSearchParams(window.location.search); urlParams.forEach(function(value, key) { if(! options[key] ) { options[key]=value; } }); } for(var sK in options ) { if(sK == 'callback' ) { continue; } requestString += sK + '=' + escape(options[sK] ) + '&'; } reqObj.open("get",requestString); var self = this; reqObj.withCredentials = true; reqObj.onreadystatechange = function() { if(reqObj.readyState != 4 ) { return; } if(options.callback ) options.callback(JSON.parse(reqObj.responseText ) ); }; reqObj.send(null);};MfcChatLogs.prototype.preparedVideoJSHtml = function(){ var el; ( el = document.getElementById(this.config.video_div_id ) ) && ( el.innerHTML = "<div id='mediaplayer_loading_container'>Loading Video <div id='mediaplayer_loading_progressbar'><div id='mediaplayer_loading_progressbar_fill'></div></div></div><video id='mediaplayer_video' class='video-js vjs-big-play-centered our-hide-big-play'></video>" );};MfcChatLogs.prototype.LoadVideoJS = function(video_info ){ if(! video_info ) { console.log('Missing video_info'); return; } var V1_FLV = ( 0 ); var V1_F4V = ( 1 << 0 ); var V2_NONE = ( 1 << 1 ); var V2_FLV = ( 1 << 2 ); var V2_F4V = ( 1 << 3 ); var V2_MP4X = ( 1 << 4 ); var V2_MP4W = ( 1 << 5 ); var aMatches = video_info.video_url.match(/\.(\w{3})$/); var sFormat = aMatches[1]; var size = this.config.video_config.getVideoSize_func ? this.config.video_config.getVideoSize_func() : { 'width': 320, 'height': 240 };
 var isPlaying = false; var isBuffering = false; var hasError = false; var aSources = []; if(this.bUseFallbackArchive ) { var aMatches; if(aMatches = video_info.fallback_archive.match(/\.(\w{3})$/) ) { var sFallbackFormat = aMatches[1]; aSources.push({ src: video_info.fallback_archive, label: sFallbackFormat + ' fallback', type: this.extToType(sFallbackFormat) }); } } else { aSources.push({ src: video_info.video_url, label: sFormat, type: this.extToType(sFormat) }); } this.unloadVideoJS(); this.preparedVideoJSHtml(); var fFallback = function() { if(video_info.archive_format & V2_MP4X && ! this.bUseFallbackArchive ) { this.bUseFallbackArchive = true; aMatches = video_info.fallback_archive.match(/\.(\w{3})$/); var sFallbackFormat = aMatches[1]; g_oReportBack.Send('VideoJSPlayer MP4 Fallback' , ( "fallback to " + sFallbackFormat + " , file: " + video_info.video_url ) ); this.LoadVideoJS(); } }; var oLoadingContainerEl = document.getElementById('mediaplayer_loading_container'); var oProgressFillEl = document.getElementById('mediaplayer_loading_progressbar_fill'); var aTechOrder = ['html5', 'flash']; if(aSources[0] && aSources[0].type && aSources[0].type == 'video/flv' ) {
 aTechOrder = ['flash', 'html5']; } window._onDhtmlWindowClose = function(){ if(! this.bUseLegacyPlayer ) { this.unloadVideoJS(); } }; this.vidPlayer = videojs('mediaplayer_video', { techOrder: aTechOrder, sources: aSources, controls: true, autoplay: true, preload: 'auto', height: size.height, width: size.width, bigPlayButton: true, playsinline: true, textTrackSettings: false, errorDisplay: true, notSupportedMessage: 'Unable to load this video. Please enable Flash and try again or click on the "View in Old Archive Player" link above.', flash: { swf: '/vendor/swf/video-js.swf?nc=25' } }); this.vidPlayer.on('error', function() { if(this.isVidPlayerFlash() ) { removeClass(document.getElementById('mediaplayer_video'), 'vjs-seeking'); } oLoadingContainerEl.style.display = 'none'; fFallback(); }); this.vidPlayer.on('canplay'}); var self = this; this.vidPlayer.on('ready', function() { oLoadingContainerEl.style.width = self.vidPlayer.width() + 'px'; oProgressFillEl.style.width = '1.5%'; if ( self.isVidPlayerFlash() ) { oLoadingContainerEl.style.display = 'block'; } self.vidPlayer.tech_.on('downloading', function(e,stats) { if(stats[1] > 0 ) {
 var nPercent = (stats[0] / stats[1]) * 100; if(nPercent > 1.5 ){ oProgressFillEl.style.width = nPercent + '%'; } } }); removeClass(document.getElementById('mediaplayer_video'), 'our-hide-big-play'); });};MfcChatLogs.prototype.isVidPlayerFlash = function() { return String(this.vidPlayer.techName_).toLowerCase() === 'flash';};MfcChatLogs.prototype.extToType = function(ext){ ext = String(ext).toLowerCase(); if(ext == 'flv' ) return 'video/flv'; if(ext == 'f4v' || ext == 'mp4' ) return 'video/mp4'; return '';};MfcChatLogs.prototype.unloadVideoJS = function(){ if(this.vidPlayer && typeof(this.vidPlayer.dispose) === 'function' ) { this.vidPlayer.dispose(); this.vidPlayer = void 0; }};MfcChatLogs.prototype.unpackTagMessage = function(message ){ var matches, obj; if(message.substring(0,5) != '<span' && message.substring(0,7) != '{"data"' ) { return; } if(message.indexOf('{"data"') === 0
 ) { var json={}; try { json = JSON.parse(message ); } catch(e) { console.log(e,message); } if(json.from ) { json.from = JSON.parse(json.from); } obj = json.data; if(json.data ) { if(json.data.image && json.data.image.match(/\w*:?\/\/[\w\-]+\.myfreecams\.com\//)
 ) { obj.message = "<img class=inline_chat_image src=" + json.data.image + ">"; } if(json.data.url && json.data.url.match(/\w*:?\/\/[\w\-]+\.myfreecams\.com\//)
 ) { obj.message = "<a target=_blank href=" + json.data.url + ">" + obj.message + "</a>"; } } } else if(message.indexOf('RoomHelperCmd') > -1 ) { obj = {}; } else if(( matches = message.match(/^<span data-...TopicChan=(\d+) class=(\w+)>(.*?)<\/span>/ ) ) ) { var channel = matches[1]; var className = matches[2]; var topic = matches[3]; obj = { 'class': className, 'channel': channel, 'message': topic }; } else if(( matches = message.match(/^<span data-TipCountdown="?(\w+=*)"? class=(\w*)><\/span>/ ) )
 ) { var base64enc = matches[1]; var className = matches[2]; var base64dec = atob(base64enc); var json = {}; try { json = JSON.parse(base64dec); } catch(e) { console.log(e,base64dec); } var message = `Tip Countdown: ${json.sofar} tokens out of ${json.total}`; obj = { 'class': className, 'message': decodeURIComponent(message ) }; } else if(( matches = message.match(/^<span data-(Mfc[X]?Tip)Id=(\d+) class=(Mfc[X]?Tip)>(.*?)<\/span>$/) ) || ( matches = message.match(/^<span data-(MfcXTip)Id=(\d+) data-(MfcXTip)="(.*?)" class=(?:Mfc|Cam)XTip><\/span>$/) ) ) { var className = matches[1]; var tipId = matches[2]; var jsonString = matches[4]; var json = { u:[], m:[] }; try { json = JSON.parse(jsonString); } catch(e) { console.log(e,jsonString); } if(typeof(json.tokens ) != 'undefined' ) { var message = json.u[2] + ' has tipped ' + json.m[2]; if(json.tokens > 0 ) { message += ' ' + json.tokens + ' token' + ( json.tokens>1?'s':''); } if(json.msg ) { message += ": '" + json.msg + "'"; } obj = { 'class': className, 'channel': json.ch, 'flags': json.flags, 'tokens': json.tokens, 'sessiontype': json.sesstype, 'stamp': json.stamp, 'tipper': { 'user_id': json.u[1], 'username': json.u[2] }, 'tipped': { 'user_id': json.u[1], 'username': json.u[2] }, 'message': message }; } } return obj;};
MfcChatLogs.prototype.getToken = function(){ var reqObj = new XMLHttpRequest(); var self = this; reqObj.open("GET",this.apiUrl + 'token' ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { if(reqObj.readyState != 4 ) { return; } var res={}; try { res = JSON.parse(reqObj.responseText ); } catch(e) { console.log(e); } if(res && res.result ) { self.token = res.result.token; } }; reqObj.send();};MfcChatLogs.prototype.setOption = function(options ){ reqObj = new XMLHttpRequest(); var requestString = this.apiUrl + 'chatLogs/setOption'; if(URLSearchParams ) { var urlParams = new URLSearchParams(window.location.search); urlParams.forEac}); } options.token = this.token; reqObj.open("POST",requestString); reqObj.setRequestHeader("Content-type","application/json"); reqObj.withCredentials = true; var self = this; reqObj.onreadystatechange = function() { if(reqObj.readyState != 4 ) { return; } if(options.callback ) options.callback(JSON.parse(reqObj.responseText ) ); }; reqObj.send(JSON.stringify(options ) );};

// js_build_core: MfcJs/MfcChatCommands/MfcChatCommands.js
function MfcChatCommands(hOpts ){ hOpts = hOpts || {};
 var sCommand, aOptions, aArguments; this.command_map = {}; this.config = { history_retainer: {} }; for(var sK in hOpts ) { this.config[sK] = hOpts[sK]; } var self = this; var hDefaultCommandMap = { 'help': { description: "Get a list of available commands", handler: function(aArgs ) { return self.CmdHelp(aArgs ); }, shorthand: "?" } }; for(var sCommandName in hDefaultCommandMap ) { var oDefaultCommand = hDefaultCommandMap[ sCommandName ]; if(! this.config.command_map[ sCommandName ] ) this.config.command_map[ sCommandName ] = {}; for(var sProperty in oDefaultCommand ) { if(! this.config.command_map[ sCommandName ][ sProperty ] ) this.config.command_map[ sCommandName ][ sProperty ] = oDefaultCommand[ sProperty ]; } }};MfcChatCommands.prototype.RecallPreviousCommands = function(sDirection ){ if(! this.config.history_retainer ) { this.Log("RecallPreviousCommands called, but a history_retainer data object has not been configured."); return { 'success': false }; } var oRetainer = this.config.history_retainer; if(! oRetainer.current_pos ) { oRetainer.current_pos = 0; } if(! oRetainer.commands ) { oRetainer.commands = []; } var sInputString = this.GetStringInput();
 var dateTime = new Date(); if(sDirection == 'last_command' ) { var nLastCommand_TimeSinceLastPress = dateTime.getTime() - ( this.nLastCommand_LastPressStamp || 0 ); this.nLastCommand_LastPressStamp = dateTime.getTime(); if(sDirection == 'last_command' && typeof(sInputString ) == 'string' && sInputString.match(/\S/) && ( nLastCommand_TimeSinceLastPress < 2000 || this.GetCaretPosition() != sInputString.length ) ) { return { 'success': false }; } } if(( sDirection == 'newer' && oRetainer.current_pos == oRetainer.commands.length ) || ( sDirection == 'older' && oRetainer.current_pos == 0 ) ) { this.MoveCursorToEndOfInput(); var self = this; setTimeout(function() { self.MoveCursorToEndOfInput(); }, 0 ); return { 'success': false }; } if(oRetainer.current_pos == oRetainer.commands.length ) oRetainer.original_input = sInputString; if(( sDirection == 'newer' && oRetainer.current_pos == oRetainer.commands.length ) || ( ( sDirection == 'last_command' || sDirection == 'older' ) && oRetainer.current_pos == 0 ) ) { this.MoveCursorToEndOfInput(); var self = this; setTimeout(function() { self.MoveCursorToEndOfInput(); }, 0 ); return { 'success': false }; } if(sDirection == 'last_command' && oRetainer.commands.length > 0 ) { oRetainer.current_pos = oRetainer.commands.length - 1; } else if(sDirection == 'older' && oRetainer.current_pos > 0 ) { oRetainer.current_pos--;
 } else if(sDirection == 'newer' && oRetainer.current_pos < oRetainer.commands.length ) { oRetainer.current_pos++; } if(oRetainer.current_pos == oRetainer.commands.length ) { this.SetStringInput(oRetainer.original_input || '' ); } else if(sDirection == 'last_command' && oRetainer.commands.length > 0 ) { oRetainer.overwrite_mode = true; var sRetainInput; if(sRetainInput = oRetainer.retain_user_input ) { this.SetStringInput(sRetainInput ); } else { var oCommand = oRetainer.commands[ oRetainer.current_pos ]; var sCleanCommand = oCommand.args[0]; if(oCommand.options ) for(var sOpt in oCommand.options ) sCleanCommand += ( ' -' + sOpt ); var nRetainX; if(nRetainX = this.config.command_map[ oCommand.command ].clean_command_retain_x_args ) { for(var a=1; a<oCommand.args.length; a++ ) { sCleanCommand += ' ' + oCommand.args[a]; if(a >= nRetainX ) { break; } } } this.SetStringInput(( sCleanCommand + ' ' ) || '' ); } } else if(oRetainer.current_pos == ( oRetainer.commands.length - 1 ) && oRetainer.retain_user_input && oRetainer.overwrite_mode ) { this.SetStringInput(oRetainer.retain_user_input ); }
 else { this.SetStringInput(oRetainer.commands[ oRetainer.current_pos ].input || '' ); } if(this.config.text_input ) { this.MoveCursorToEndOfInput(); var self = this; setTimeout(function() { self.MoveCursorToEndOfInput(); }, 0 ); } return { 'success': true };};MfcChatCommands.prototype.RecallPreviousCommands_Listen = function(){ var oRetainer = this.config.history_retainer; if(! oRetainer.overwrite_mode ) { return; } if(! oRetainer.current_pos ) { oRetainer.current_pos = 0; } if(! oRetainer.commands ) { oRetainer.commands = []; } if(! oRetainer.user_input ) { oRetainer.user_input = ''; } var sInputString = this.GetStringInput(); var oCommand = oRetainer.commands[ oRetainer.current_pos ]; if(oRetainer.current_pos == ( oRetainer.commands.length - 1 ) && oCommand && oCommand.input != sInputString ) { oRetainer.retain_user_input = sInputString; }};MfcChatCommands.prototype.GetCaretPosition = function(){ if(this.config.get_string_input_caret_position ) return this.config.get_string_input_caret_position(); else if(this.config.text_input && this.config.text_input.selectionStart ) return this.config.text_input.selectionStart; else this.Log("GetCaretPosition called but no DOM input or 'get_string_input_handler' has been specified.");};MfcChatCommands.prototype.GetStringInput = function(){
 if(this.config.get_string_input_handler ) return this.config.get_string_input_handler(); else if(this.config.text_input ) return this.config.text_input.value; else this.Log("SetStringInput called but no DOM input or 'get_string_input_handler' has been specified.");};MfcChatCommands.prototype.SetStringInput = function(sString ){ if ( ! sString ) { sString = ''; } if (typeof(sString) != "string" ) { sString = sString + ''; } if(this.config.text_input ) this.config.text_input.value = sString; if(this.config.set_string_input_handler ) this.config.set_string_input_handler(sString );};MfcChatCommands.prototype.MoveCursorToEndOfInput = function(){ if(! this.config.text_input ) { return; } this.config.text_input.focus(); var sContentRetainer = this.config.text_input.value; this.config.text_input.value = ''; this.config.text_input.value = sContentRetainer;};MfcChatCommands.prototype.CmdHelp = function(aArgs, hOptions ){ hOptions = hOptions || {}; var sOutput = ""; if(! hOptions.show_only ) { sOutput = "<div class=MfcChatCommands_help_title>Chat Commands:</div>"; } var aSortedCommands = []; var hHelpConfig = this.config.help_config || {}; if(hHelpConfig.help_order ) { for(var a=0; a < hHelpConfig.help_order.length; a++ ) {
 var bHasContents = 0; for(var b=0; b < hHelpConfig.help_order[a].length; b++ ) { var sCommand = hHelpConfig.help_order[a][b]; if(! this.config.command_map[ sCommand ] ) continue; aSortedCommands.push(sCommand ); bHasContents = 1; } if(bHasContents ) aSortedCommands.push('**BREAK**'); } } else { for(var sCommand in this.config.command_map ) { aSortedCommands.push(sCommand ); } aSortedCommands.sort(); aSortedCommands.push('command_not_found'); } for(var n=0; n<aSortedCommands.length; n++ ) { sCommand = aSortedCommands[n]; if(hOptions.show_only && hOptions.show_only.indexOf && hOptions.show_only.indexOf(sCommand ) == -1 ) { continue; } if(sCommand == '**BREAK**' ) { sOutput += "<div class=MfcChatCommands_help_command_break></div>\n"; } else if(sCommand == 'command_not_found' && this.config.command_not_found && this.config.command_not_found.definition ) { sOutput += this.CmdHelp_Item('/' + this.config.command_not_found.definition, this.config.command_not_found ); } else if(this.config.command_map[ sCommand ] && this.config.command_map[ sCommand ].description ) { sOutput += "<br/>" + this.CmdHelp_Item('/' + sCommand, this.config.command_map[ sCommand ] ); } }
 if(! hOptions.show_only ) { var sAddendum='<br/>'; if(hHelpConfig.up_down_arrows ) sAddendum += this.CmdHelp_Item('Up/down arrows', { description: 'Cycle through previous command(s).' } ); if(hHelpConfig.right_arrow ) sAddendum += this.CmdHelp_Item('Right arrow', { description: 'Show last command without any additional options.' } ); if(hHelpConfig.double_click_recall ) { sAddendum += this.CmdHelp_Item('Double-click with mouse', { description: 'Enter last command.' } ); } if(sAddendum ) sOutput += sAddendum + "<br>"; if(hHelpConfig.more_info_a_tag ) { sOutput += " <div class=MfcChatCommands_help_wiki_link> " + hHelpConfig.more_info_a_tag + "Click here for instructions and examples using chat commands</a>. </div> "; } } var oResponse = {}; if(hHelpConfig.overtake_help_output ) { hHelpConfig.overtake_help_output(sOutput ); oResponse.success = true; } else { oResponse.message = sOutput; oResponse.success = true; } return oResponse;};MfcChatCommands.prototype.CmdHelp_Item = function(sCommand, hCommandConfig ){ if(! sCommand ) { return ''; } var sOutput = " <div class=MfcChatCommands_help_command_container> <div class=MfcChatCommands_help_command_name_description>\
 <b>" + sCommand + "</b>"; if(hCommandConfig.shorthand ) { sOutput += " or <b>/" + hCommandConfig.shorthand + "</b>"; } sOutput += ": " + ( hCommandConfig.description || '' ) + "</div>"; if(hCommandConfig.usage ) sOutput += " <div class=MfcChatCommands_help_command_usage><b>Usage:</b> " + hCommandConfig.usage + "</div>\n"; if(hCommandConfig.options ) { sOutput += "\<div class=MfcChatCommands_help_command_options_title><b>Options:</b></div>\n"; for(var sOption in hCommandConfig.options ) sOutput += "<div class=MfcChatCommands_help_command_option><b>-" + sOption + ":</b> " + hCommandConfig.options[ sOption ] + "</div>\n"; } if(hCommandConfig.example ) sOutput += " <div class=MfcChatCommands_help_command_usage><b>Usage Example:</b> " + hCommandConfig.example + "</div>\n"; sOutput += "</div>\n"; return sOutput;};MfcChatCommands.prototype.Log = function(sLog ){ if(! this.config.debug ) { return; } if(this.config.log_output && typeof(this.config.log_output) == 'function' ) this.config.log_output(sLog ); else if(window.console && window.console.log ) window.console.log(sLog );};MfcChatCommands.prototype.StorePreviousCommands = function(sInput, sCommand, aArguments, hOptions ){ var oRetainer; if(! ( oRetainer = this.config.history_retainer ) ) { return; } if(! oRetainer.commands ) { oRetainer.commands = []; } if(! oRetainer.clean_commands ) { oRetainer.clean_commands = []; } if(oRetainer.commands.length == 0 || ( oRetainer.commands.length && sInput != oRetainer.commands[ oRetainer.commands.length - 1 ]
 ) ) { oRetainer.commands.push({ input: sInput, command: sCommand, args: aArguments, options: hOptions }); } oRetainer.current_pos = oRetainer.commands.length;};MfcChatCommands.prototype.Parse = function(sInput ){ if (typeof(sInput) != "string" || sInput.charAt(0) != '/') return null; this.config.history_retainer.retain_user_input = ''; this.config.history_retainer.overwrite_mode = false; this.oCommand = {}; this.sCommand = ''; this.hOptions = {}; this.aArguments = []; this.ParseChatString(sInput ); this.LogCommand(); var oResponse = this.Validate(); if(this.config.pre_command_handler ) { this.config.pre_command_handler(this.aArguments, this.hOptions, oResponse ); } if(oResponse.success ) { oResponse = this.ExecuteCommand(); } if(this.config.post_command_handler ) { this.config.post_command_handler(this.aArguments, this.hOptions, oResponse ); } this.LogResponse(oResponse ); if(! oResponse.success && oResponse.message ) oResponse.message = "Error: " + oResponse.message; return oResponse;};MfcChatCommands.prototype.LogCommand = function()
{ if(! this.config.debug ) { return; } var sOptions=''; for(var sOption in this.hOptions ) { sOptions += sOption + ","; } sOptions = sOptions.substring(0, sOptions.length-1 ); this.Log("Command: " + this.sCommand + "\n" + "Options: " + sOptions + "\n" + "Arguments: " + this.aArguments.join(' ') + "\n" );};MfcChatCommands.prototype.LogResponse = function(oResponse ){ if(! this.config.debug ) { return; } var sResponse=''; for(var sK in oResponse ) sResponse += sK + ": " + oResponse[sK] + "\n"; this.Log("oResponse:\n" + sResponse );};MfcChatCommands.prototype.ParseChatString = function(sInput ){ sInput = sInput.replace(/\s+/g,' '); aInput = sInput.split(' '); this.sCommand = aInput[0].substr(1).toLowerCase(); this.sCommand = this.sCommand.replace(/[^\w\?]/g,''); this.aArguments = aInput; var bCommandFound = true; if(! ( this.oCommand = this.config.command_map[this.sCommand] ) ) { bCommandFound = false; for(var sFormalCommand in this.config.command_map ) { if(this.config.command_map[ sFormalCommand ].shorthand == this.sCommand ) { this.sCommand = sFormalCommand; this.oCommand = this.config.command_map[this.sCommand]; bCommandFound = true;
 break; } } } if(! this.oCommand && this.config.command_not_found && this.config.command_not_found.handler ) { if(this.config.command_not_found.qualifier ) { var oQualifier = new RegExp(this.config.command_not_found.qualifier ); if(sInput.match(oQualifier ) ) this.oCommand = this.config.command_not_found; } else { this.oCommand = this.config.command_not_found; } } this.hOptions = {}; var nOptionTrim = 0; var aBadOptions = []; for(var nArgCx=1; nArgCx < this.aArguments.length; nArgCx++ ) { var aMatches = this.aArguments[nArgCx].match(/\-(\w+)/); if(aMatches && typeof(aMatches) == 'object' && aMatches.length ) { nOptionTrim++; var aValidOptions=[]; var bBadOption = false; var aOptionValPairs = aMatches[1].match(/(\w\d*)/g); for(var n=0; n< aOptionValPairs.length; n++ ) { var aParts = aOptionValPairs[n].match(/(\w)(\d*)/); var cOption = aParts[1].toLowerCase(); var nValue = aParts[2] !== "" ? aParts[2] : true; if(this.oCommand && this.oCommand.pass_bad_options
 && ( ! this.oCommand.options || ! this.oCommand.options[ cOption ]) ) { bBadOption = true; if(aMatches[1].length > 1 ) { aValidOptions = []; break; } } else { aValidOptions.push([ cOption, nValue ] ); } } for(var n=0; n < aValidOptions.length; n++ ) { this.hOptions[ aValidOptions[n][0] ] = aValidOptions[n][1]; } if(this.oCommand && this.oCommand.pass_bad_options && bBadOption ) { aBadOptions.push(this.aArguments[nArgCx] ); } } else { break; } } this.aArguments.splice(1, nOptionTrim ); for(var n = aBadOptions.length-1; n >= 0; n-- ) { this.aArguments.splice(1, 0, aBadOptions[n] ); } if(bCommandFound ) { this.StorePreviousCommands(sInput, this.sCommand, this.aArguments, this.hOptions ); }};MfcChatCommands.prototype.Validate = function(){ if(! this.oCommand ) { return { "success": false, "message": "There are no commands that match \"" + this.sCommand + "\". Type <b>/help</b> for a full list of commands." }; }
 if(this.oCommand && ! this.oCommand.handler ) { return { "success": false, "message": "/\"" + this.sCommand + "\" is not available in this client. Type <b>/help</b> for a full list of commands." }; } for(var cOption in this.hOptions ) { if(! this.oCommand.options || ! this.oCommand.options[ cOption ] ) { return { "success": false, "message": "The command you have entered has no option \"-" + cOption + "\". Type /help for more information." }; }; } if(this.oCommand.arguments ) { for(var n=0; n < this.oCommand.arguments.length; n++ ) { var oRE = new RegExp(this.oCommand.arguments[n][0] ); if(this.aArguments[n+1] == undefined ) this.aArguments[n+1] = ''; if(! this.aArguments[n+1].toString().match(oRE ) ) { var sMessage = "Argument " + (n+1) + " of the /" + this.sCommand + " command must " + this.oCommand.arguments[n][1] + ". "; if(this.oCommand.usage ) { sMessage += " Usage: " + this.oCommand.usage; } else { sMessage += " Type <b>/help</b> for more information."; } return { "success": false, "message": sMessage }; } } } return { success: true };};MfcChatCommands.prototype.ExecuteCommand = function(){ var oResponse = this.oCommand.handler(this.aArguments, this.hOptions ) || { success: true }; return oResponse;};
MfcChatCommands.prototype.removeHandler = function(handlerName ){ if(! this.config.command_map[ handlerName ] ) return { "success": false, "message": "Command '" + handlerName + "' not found." }; delete this.config.command_map[ handlerName ]; return { "success": true };};MfcChatCommands.prototype.addHandler = function(handlerName, handlerConfig ){ if(typeof(handlerName ) != 'string' ) return { "success": false, "message": "addHandler requires argument 1 to be a string." }; if(typeof(handlerConfig ) != 'object' ) return { "success": false, "message": "addHandler requires argument 2 to be an object." }; this.config.command_map[ handlerName ] = handlerConfig; return { "success": true };};

// js_build_core: MfcJs/MfcChatCommandHandlers/MfcChatCommandHandlers.js
function MfcChatCommandHandlers(options ){ options = options || {}; MfcChatCommandHandlers.instanceCounter++; MfcChatCommandHandlers.instances[ MfcChatCommandHandlers.instanceCounter ] = this; var _mfcChatCommands = options.mfcChatCommands || {}; var _callback_message_func = options.callback_message_func || function() { console.log(arguments); }; var _get_token_func = options.get_token_func || function() { console.log('missing token func'); }; var _get_purchase_link_func = options.get_purchase_link_func || null; var _get_target_user_id = options.get_target_user_id || function(){ return 0; }; var _current_platform = options.current_platform || {}; var _current_user = options.current_user || {}; var _get_purchase_link_func = options.get_purchase_link_func || function() { console.log(arguments); }; var _is_tipping_available = options.is_tipping_available || function(){ return true; }; var _username_lookup_func = options.username_lookup_func || function() { return 'not configured' }; var _self = this; this.multiTipTimers = []; this.tip = function(aArgs, hOptions, nModelId ) { hOptions = hOptions || {}; if(! nModelId ) { nModelId = _get_target_user_id(); } var nTipAmount = aArgs[1]; var self = this; var sErr; if(_is_tipping_available && ! _is_tipping_available() ) { sErr = "The <b>/tip</b> command cannot be used here."; } else if(! aArgs || ! aArgs[1] ) { if(_mfcChatCommands ) return _mfcChatCommands.CmdHelp(null,{ show_only: ['tip'] }); else sErr = "Type /help for tip command options.";
 } else if(_current_user.access_level() < 2 ) { sErr = "This /tip command is only available to Premium Members. Please buy tokens one time to become a premium member forever."; } else if(! ( parseInt(aArgs[1]) > 0 ) ) { sErr = "Please specify the number of tokens you wish to tip."; } if(sErr ) { _callback_message_func({ "success": false, "message": sErr }); return; } if(nTipAmount > 1000 && ! hOptions.bypass_warning ) { this.pending_tip_arguments = [ aArgs, hOptions, nModelId ]; _callback_message_func({ "success": true, "message": "Type /y or " + "<a href=# onClick=\" MfcChatCommandHandlers.instances[" + MfcChatCommandHandlers.instanceCounter + "].tip_yes(); return false; \">click here</a> to confirm your tip for " + nTipAmount + " tokens." }); return; } self.tipMessage_success = "You have tipped " + nTipAmount + " token" + (nTipAmount>1?'s':'') + '.'; if(typeof(hOptions['x']) != 'undefined' || typeof(hOptions['d']) != 'undefined' ) { var nTips = parseInt(hOptions['x']) || 1; var nDelay = parseInt(hOptions['d']) || 1; var sErr; if(this.multiTipTimers.length ) sErr = "An existing automated tip is running. Type /tipstop if you want to end the automated tipping early. " + "Disconnecting or reloading your browser will stop the automatic tipping."; else if(nTips > 60 ) sErr = " The maximum number of automated tips is 60. "; else if(nDelay > 300 ) sErr = " The maximum delay value is 300 seconds. "; else if(nTipAmount < 5 ) sErr = " Automated tips must be at least five tokens or greater."; else if(nDelay < 1 ) sErr = "The tips must be at least one second apart."; else if(nTips > 100 ) sErr = "Automatic tipping must be kept below 100 tips."; if(sErr ) { _callback_message_func({ "success": false, "message": sErr }); return; }
 this.multiTipTimers = []; var nModel = _get_target_user_id(); var nDelayParts = nDelay * 1000; for(var x=0; x<nTips; x++ ) { delete hOptions['x']; delete hOptions['d']; (function(x) { var autoTip = function(){ var sMsg = "Automated tip " + (x+1) + " of " + nTips + ". "; self.tipMessage_success += sMsg; self.tip(aArgs, hOptions, nModelId ); if((x+1) == nTips ) { console.log('Tip timers completed'); self.multiTipTimers = []; } }; self.multiTipTimers.push(setTimeout(function() { autoTip(); }, nDelayParts ) ); })(x); nDelayParts += nDelay * 1000; } var sMsg=''; if(nTips > 1 ) { sMsg = "Now sending " + nTips + " tips, " + nTipAmount + " token" + (nTipAmount>1?'s':'') + " each, spaced " + nDelay + " second" + (nDelay>1?'s':'') + " apart. Type /tipstop to end auto tipping early. Disconnecting or reloading your browser will stop the automatic tipping." } else { sMsg = "A tip for " + nTipAmount + " token" + (nTipAmount>1?'s':'') + "  will be sent in " + nDelay + " second" + (nDelay>1?'s':'') + ". Type /tipstop to cancel the delayed tip. Disconnecting or reloading your browser will cancel the delayed tip." } _callback_message_func({ "success": true, "message": sMsg }); return; } var hTipConfig = {
 broadcaster_id: nModelId, tip_value: nTipAmount || '', anonymous: hOptions['a'] ? 1 : 0, public: hOptions['p'] ? 0 : 1, public_comment: hOptions['m'] ? 0 : 1, silent: hOptions['s'] ? 1 : 0, hide_amount: hOptions['h'] ? 1 : 0, comment: aArgs.slice(2).join(' ') }; var mfcTip = new MfcTip({ token: _current_user.token(), usersession: _current_user.session_id(), access_level: _current_user.access_level(), callback: function(hRes ) { self.tip_callback_message(hRes ); }, chat_command: 1 }); var oResponse = mfcTip.Request(hTipConfig ); if(oResponse && oResponse.success == false ) { this.tipstop(); } _callback_message_func(oResponse ); return; }; this.tip_callback_message = function(hRes ) { hRes = hRes || {}; delete this.pending_tip_arguments; var bSuccess; var sMsg = ''; var oResponse = {}; if(hRes.errmsg ) { oResponse.success = false; oResponse.message = hRes.errmsg; } else if(! hRes.err ) { oResponse.success = true; oResponse.message = this.tipMessage_success; }
 _callback_message_func(oResponse ); }; this.tip_yes = function(hRes ) { if(! this.pending_tip_arguments ) { return; } var hTipConfig = this.pending_tip_arguments; if(typeof(this.pending_tip_arguments[1] == 'object' ) ) { this.pending_tip_arguments[1].bypass_warning = 1; } this.tip.apply(this, this.pending_tip_arguments ); }; this.tipstop = function(hRes ) { if(this.multiTipTimers.length == 0 ) return { "success": true, "message": "No automated tips are currently running." }; for(var a=0; a < this.multiTipTimers.length; a++ ) { clearTimeout(this.multiTipTimers[a]); } this.multiTipTimers = []; return { "success": true, "message": "Automatic tipping has been stopped." }; }; this.tostorage = function(aArgs, hOptions ) { return this.shiftTokenStorage(aArgs[1] ); }; this.fromstorage = function(aArgs, hOptions ) { return this.shiftTokenStorage(0 - aArgs[1] ); }; this.shiftTokenStorage = function(nShift ) { var sUrl = ( ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ) + '/account/shiftTokenStorage'; var sData = JSON.stringify({ 'request_id': Math.random(), 'token': _current_user.token(),
 'shift': nShift }); var oReq = createRequestObject(); oReq.open('POST', sUrl ); oReq.setRequestHeader("Content-type","application/json"); oReq.withCredentials = true; oReq.onreadystatechange = function() { var objectLoaded = false; if ( oReq.readyState != 4 ) { return; } var oRes = JSON.parse(oReq.responseText); if(typeof(oRes ) != 'object' || ( oRes.errmsg && oRes.errmsg.err ) ) { _callback_message_func({ "success": false, "message": ( oRes.errmsg && oRes.errmsg.message ) || "There was a problem with Token Storage. Please contact support, or try again later." }); } else { _callback_message_func({ "success": 1, "message": ( oRes.result && oRes.result.message ) }); } }; oReq.send(sData ); }; this.tipfor = function(aArgs, hOptions ) { if(! aArgs[1] || aArgs[1].match(/\W/) ) { return { "success": false, "message": "Enter a username as the second argument: /tipfor [username]" }; } var aNewArgs = [ '/tip' ], hNewOptions={}; for(var a=2; a<aArgs.length; a++ ) { if(aArgs[a].match(/\-(\w+)/) ) {
 var aOpts = RegExp.$1.split(''); for(var b=0; b < aOpts.length; b++ ) { hNewOptions[ aOpts[b] ] = true; } } else { aNewArgs.push(aArgs[a] ); } } MfcChatCommandHandlers.tipfor_aArgs = aNewArgs; MfcChatCommandHandlers.tipfor_hOptions = hNewOptions; var self = this; _username_lookup_func(aArgs[1], function() { self.tipfor_callback.apply(self,arguments) } ); }; this.tipfor_callback = function(nErrCode, sUsername, hUser, hContext ) { if(! hUser || ! hUser.user_id ) { _callback_message_func({ "success": false, "message": "The username you have entered was not found, please check the spelling." }); return; } if(hUser.access_level != 4 ) { _callback_message_func({ "success": false, "message": "The username you specified is on a non-" + _current_platform.performer + " member of " + _current_platform.name + ". Only " + _current_platform.performer + "s may receive tips." }); return; } var oResponse = this.tip(MfcChatCommandHandlers.tipfor_aArgs, MfcChatCommandHandlers.tipfor_hOptions, hUser.user_id ); if(oResponse && oResponse.success == false ) _callback_message_func(oResponse ); return oResponse; }; this.sharetip_url = '//share.' + _current_platform.domain + '/api/v1/chat_commands/sharetip'; this.sharetip = function(aArgs, hOptions, nModelId ) { if(! nModelId ) { nModelId = _get_target_user_id(); } var nAmount = parseInt(aArgs[1] );
 if(! nAmount ) { _callback_message_func({ "success": false, "message": "You must specify a positive tip amount." }); return; } var sTarget = aArgs[2]; if(! sTarget ) { _callback_message_func({ "success": false, "message": "You must specify a target." }); return; } var sMessage = aArgs.splice(3).join(' ') || ''; var sUrl = this.sharetip_url; var sData = JSON.stringify({ 'token': _current_user.token(), 'user_id': _current_user.user_id(), 'model_id': nModelId, 'options': hOptions, 'amount': nAmount, 'target': sTarget, 'message': sMessage }); var oReq = createRequestObject(); oReq.open('POST', sUrl); oReq.setRequestHeader("Content-type","application/json"); oReq.withCredentials = true; oReq.onreadystatechange = function() { var objectLoaded = false; if ( oReq.readyState != 4 ) { return; } var oRes = JSON.parse(oReq.responseText); if(typeof(oRes ) != 'object' ) { _callback_message_func({ "success": false, "message": "There was a problem conducting the Share purchase. Please contact support, or try again later." }); } else { _callback_message_func({ "success": ( oRes.code == 'ok' ), "message": oRes.message }); }
 }; oReq.send(sData ); }; this.quickbuy = function(aArgs, hOptions, nModelId ) { var nTokenVolume = aArgs[1]; var mfcPurchase = new MfcPurchase(); var result; if(nTokenVolume ) { if(MfcChatCommandHandlers.setQuickbuyLock ) { _callback_message_func({ "success": false, "message": "Please wait a few more moments before using another QuickBuy request." }); return; } result = mfcPurchase.getQualifyPurchase({ chat_command_purchase: 1, volume: nTokenVolume, volume_type: 'token', callback: function() { _self.quickbuy_qualify_purchase_callback.apply(this,arguments); } }); } else { result = mfcPurchase.getPurchaseInfo({ chat_command_purchase: 1, callback: function() { _self.quickbuy_purchase_info_callback.apply(this,arguments); } }); } }; this.quickbuy_purchase_info_callback = function(response ) { var sErrorMessage; if(typeof(response ) != 'object' ) sErrorMessage = '10001'; else if(response.err ) sErrorMessage = response.description || response.err; else if(response.purchase_limits && response.purchase_limits.err ) sErrorMessage = ( response.purchase_limits.description || response.purchase_limits.err ); else if(! response.available_quickbuy_processors || response.available_quickbuy_processors.length == 0 ) sErrorMessage = "There are no purchase processors available at the moment. Please contact support for assistance."; if(response.code == 'no_prev_purchase' || response.code == 'no_processor' )
 { sErrorMessage = "In order to purchase with QuickBuy, you must first complete a regular purchase."; if(typeof(_get_purchase_link_func)=='function' ) { sErrorMessage += " " + _get_purchase_link_func() + "Click here to view available token packages</a>."; } } if(sErrorMessage ) { _callback_message_func({ "success": false, "message": sErrorMessage }); return; } var aAvailableVolumes = []; var sInfo=''; var aAvailableVolumes=[]; var aFoundProcs=[]; for(var nProdId in response.products ) { var hProd = response.products[ nProdId ]; aAvailableVolumes.push('<b>'+ hProd.volume + '</b> for <b>$' + hProd.amount + '</b>'); for(var b=0; b < hProd.available_processors.length; b++ ) { aFoundProcs.push(hProd.available_processors[b] ); } } var nPriorityProcessor=''; for(var a=0; a < response.processor_priority.length; a++ ) { if(aFoundProcs.indexOf(response.processor_priority[a] ) > -1 && response.available_quickbuy_processors.indexOf(response.processor_priority[a] ) > -1 ) { nPriorityProcessor = response.processor_priority[a]; break; } } if(aAvailableVolumes.length ) { sInfo += "You can purchase tokens with the /quickbuy chat command by typing /quickbuy [token volume] .<br>Available token volumes:<br> " + aAvailableVolumes.join('<br>') + "<br>  This transaction would be handled through " + response.processors[nPriorityProcessor]['name'] + ", and a confirmation email would be sent to you. "; } else { sInfo += "You can purchase tokens with the /quickbuy chat command by typing /quickbuy [token volume] .<br> You must first have purchased tokens through a payment processor in order to enable the QuickBuy feature. "; }
 _callback_message_func({ "success": true, "message": sInfo }); }; this.quickbuy_qualify_purchase_callback = function(response ) { var sErrorMessage; if(typeof(response ) != 'object' ) sErrorMessage = '10001'; else if(response.err ) sErrorMessage = response.description || response.code || response.err; else if(! response.success ) sErrorMessage = "QuckBuy via chat command is not available at the moment."; else if(response.err ) sErrorMessage = response.description || response.err; else if(! response.product ) sErrorMessage = "A product was not returned."; else if(! response.processor ) sErrorMessage = "A processor was not returned."; if(response.code == "invalid_price_point" ) { sErrorMessage += " Type /quickbuy to see a list of available token packages. "; } else if(response.code == 'no_prev_purchase' || response.code == 'no_processor' ) { sErrorMessage = "In order to purchase with QuickBuy, you must first complete a regular purchase."; if(typeof(_get_purchase_link_func)=='function' ) { sErrorMessage += " " + _get_purchase_link_func() + "Click here to view available token packages</a>."; } } if(sErrorMessage ) { _callback_message_func({ "success": false, "message": sErrorMessage }); return; } var sMessage = "Processing QuickBuy transaction for " + ( response.product && response.product.name ) + " through " + ( response.processor && response.processor.name ) + "..."; _callback_message_func({ "success": true, "message": sMessage }); MfcChatCommandHandlers.setQuickbuyLock = true; setTimeout(function(){ MfcChatCommandHandlers.setQuickbuyLock = false; }, 30000 ); var mfcPurchase = new MfcPurchase({ token: _get_token_func() }); result = mfcPurchase.postQuickbuy({ chat_command_purchase: 1,
 product_id: response.product.id, callback: function() { _self.quickbuy_purchase_quickbuy_callback.apply(this,arguments); } }); }; this.quickbuy_purchase_quickbuy_callback = function(response ) { var nError; if(! response || typeof(response ) != 'object' ) { _callback_message_func({ "success": false, "message": 'QuickBuy is not available (error #20001). Please contact support for assistance.' }); } MfcChatCommandHandlers.setQuickbuyLock = false; if(response.success ) { sMessage = "You have purchased " + response.product.description + " for $" + response.product.amount; if(response.processor && response.processor.name ) sMessage += " through " + response.processor.name; sMessage += ". "; if(response.purchase_result && response.purchase_result.purchase_id ) sMessage += "Your transaction reference number is #<b>" + response.purchase_result.purchase_id + "</b>. "; sMessage += "Your token balance has now been updated. Thank you! "; _callback_message_func({ "success": true, "message": sMessage }); } else { var sMessage = "We were unable to carry out the purchase for the following reason: "; if(response.brief || response.description ) { if(response.brief ) { sMessage += response.brief + ". "; } if(response.description ) { sMessage += response.description; } } else { sMessage += "Error #" + ( response.err || -99 ); }
 if(typeof(_get_purchase_link_func)=='function' ) { sMessage += " " + _get_purchase_link_func() + "Click here to view all purchase options</a>."; } _callback_message_func({ "success": false, "message": sMessage }); } };};MfcChatCommandHandlers.setQuickbuyLock = false;MfcChatCommandHandlers.instanceCounter = 0;MfcChatCommandHandlers.instances = {};

// js_build_core: MfcJs/MfcHash/MfcHash.js
function MfcHash(){};MfcHash.prototype.aCrc32Tab = new Array(0x00000000,0x77073096,0xEE0E612C,0x990951BA,0x076DC419,0x706AF48F,0xE963A535,0x9E6495A3,0x0EDB8832,0x79DCB8A4,0xE0D5E91E,0x97D2D988,0x09B64C2B,0x7EB17CBD,0xE7B82D07,0x90BF1D91,0x1DB71064,0x6AB020F2,0xF3B97148,0x84BE41DE,0x1ADAD47D,0x6DDDE4EB,0xF4D4B551,0x83D385C7,0x136C9856,0x646BA8C0,0xFD62F97A,0x8A65C9EC,0x14015C4F,0x63066CD9,0xFA0F3D63,0x8D080DF5,0x3B6E20C8,0x4C69105E,0xD56041E4,0xA2677172,0x3C03E4D1,0x4B04D447,0xD20D85FD,0xA50AB56B,0x35B5A8FA,0x42B2986C,0xDBBBC9D6,0xACBCF940,0x32D86CE3,0x45DF5C75,0xDCD60DCF,0xABD13D59,0x26D930AC,0x51DE003A,0xC8D75180,0xBFD06116,0x21B4F4B5,0x56B3C423,0xCFBA9599,0xB8BDA50F,0x2802B89E,0x5F058808,0xC60CD9B2,0xB10BE924,0x2F6F7C87,0x58684C11,0xC1611DAB,0xB6662D3D,0x76DC4190,0x01DB7106,0x98D220BC,0xEFD5102A,0x71B18589,0x06B6B51F,0x9FBFE4A5,0xE8B8D433,0x7807C9A2,0x0F00F934,0x9609A88E,0xE10E9818,0x7F6A0DBB,0x086D3D2D,0x91646C97,0xE6635C01,0x6B6B51F4,0x1C6C6162,0x856530D8,0xF262004E,0x6C0695ED,0x1B01A57B,0x8208F4C1,0xF50FC457,0x65B0D9C6,0x12B7E950,0x8BBEB8EA,0xFCB9887C,0x62DD1DDF,0x15DA2D49,0x8CD37CF3,0xFBD44C65,0x4DB26158,0x3AB551CE,0xA3BC0074,0xD4BB30E2,0x4ADFA541,0x3DD895D7,0xA4D1C46D,0xD3D6F4FB,0x4369E96A,0x346ED9FC,0xAD678846,0xDA60B8D0,0x44042D73,0x33031DE5,0xAA0A4C5F,0xDD0D7CC9,0x5005713C,0x270241AA,0xBE0B1010,0xC90C2086,0x5768B525,0x206F85B3,0xB966D409,0xCE61E49F,0x5EDEF90E,0x29D9C998,0xB0D09822,0xC7D7A8B4,0x59B33D17,0x2EB40D81,0xB7BD5C3B,0xC0BA6CAD,0xEDB88320,0x9ABFB3B6,0x03B6E20C,0x74B1D29A,0xEAD54739,0x9DD277AF,0x04DB2615,0x73DC1683,0xE3630B12,0x94643B84,0x0D6D6A3E,0x7A6A5AA8,0xE40ECF0B,0x9309FF9D,0x0A00AE27,0x7D079EB1,0xF00F9344,0x8708A3D2,0x1E01F268,0x6906C2FE,0xF762575D,0x806567CB,0x196C3671,0x6E6B06E7,0xFED41B76,0x89D32BE0,0x10DA7A5A,0x67DD4ACC,0xF9B9DF6F,0x8EBEEFF9,0x17B7BE43,0x60B08ED5,0xD6D6A3E8,0xA1D1937E,0x38D8C2C4,0x4FDFF252,0xD1BB67F1,0xA6BC5767,0x3FB506DD,0x48B2364B,0xD80D2BDA,0xAF0A1B4C,0x36034AF6,0x41047A60,0xDF60EFC3,0xA867DF55,0x316E8EEF,0x4669BE79,0xCB61B38C,0xBC66831A,0x256FD2A0,0x5268E236,0xCC0C7795,0xBB0B4703,0x220216B9,0x5505262F,0xC5BA3BBE,0xB2BD0B28,0x2BB45A92,0x5CB36A04,0xC2D7FFA7,0xB5D0CF31,0x2CD99E8B,0x5BDEAE1D,0x9B64C2B0,0xEC63F226,0x756AA39C,0x026D930A,0x9C0906A9,0xEB0E363F,0x72076785,0x05005713,0x95BF4A82,0xE2B87A14,0x7BB12BAE,0x0CB61B38,0x92D28E9B,0xE5D5BE0D,0x7CDCEFB7,0x0BDBDF21,0x86D3D2D4,0xF1D4E242,0x68DDB3F8,0x1FDA836E,0x81BE16CD,0xF6B9265B,0x6FB077E1,0x18B74777,0x88085AE6,0xFF0F6A70,0x66063BCA,0x11010B5C,0x8F659EFF,0xF862AE69,0x616BFFD3,0x166CCF45,0xA00AE278,0xD70DD2EE,0x4E048354,0x3903B3C2,0xA7672661,0xD06016F7,0x4969474D,0x3E6E77DB,0xAED16A4A,0xD9D65ADC,0x40DF0B66,0x37D83BF0,0xA9BCAE53,0xDEBB9EC5,0x47B2CF7F,0x30B5FFE9,0xBDBDF21C,0xCABAC28A,0x53B39330,0x24B4A3A6,0xBAD03605,0xCDD70693,0x54DE5729,0x23D967BF,0xB3667A2E,0xC4614AB8,0x5D681B02,0x2A6F2B94,0xB40BBE37,0xC30C8EA1,0x5A05DF1B,0x2D02EF8D);MfcHash.prototype.crc32 = function(str){ var n; var len=str.length; var crc; crc=0xFFFFFFFF; for ( var n=0; n<len; n++) { crc=MfcHash.prototype.crc32_add(crc,str.charCodeAt(n)); } return crc^0xFFFFFFFF;};MfcHash.prototype.crc32_add = function(crc,c){ return MfcHash.prototype.aCrc32Tab[(crc^c)&0xFF]^((crc>>8)&0xFFFFFF);};

// js_build_core: MfcJs/MfcImageHost/MfcImageHost.js
function MfcImageHost(hOptions ){ if ( ! hOptions ) hOptions = {}; this.hOptions = { nModulusValue: 12, sDomain: 'camcdn.com', sHost: 'camcdn.com', oMfcHash: new MfcHash() }; this._MergeInOptions(hOptions );}MfcImageHost.defaultImgUrl = 'https://img.camcdn.com/';MfcImageHost.prototype._MergeInOptions = function(hOptions ){ for (var option in hOptions) { this.hOptions[option] = hOptions[option]; }};MfcImageHost.prototype.hostUrl = function(imageIdentifier ){ var sUrl=''; if(typeof(g_hPlatform) == 'object' && g_hPlatform.image_url ) { sUrl = g_hPlatform.image_url; } else if(this.hOptions && this.hOptions.sDomain ) { sUrl = 'https://img.' + this.hOptions.sDomain; } else if(MfcImageHost.defaultImgUrl ) { sUrl = MfcImageHost.defaultImgUrl; } return sUrl;};MfcImageHost.prototype.avatarPrefix = function(sDomain ){ var sDomain = sDomain || ( this.hOptions && this.hOptions.sDomain ) || MfcImageHost.prototype.hostUrl(); return MfcImageHost.prototype.hostUrl().indexOf('mfcimg.com') > -1 ? 'avatar' : 'cam_avatar';};MfcImageHost.prototype.domainPrefix = function(nImageIdentifier )
{ var aChars = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z']; return aChars[ nImageIdentifier % this.hOptions.nModulusValue ];};MfcImageHost.prototype.imageIdentifierToInt = function(imageIdentifier ){ if ( typeof(imageIdentifier) === 'number' ) return Math.abs(imageIdentifier); if ( typeof(imageIdentifier) !== 'string' ) return 0; return this.hOptions.oMfcHash.crc32(imageIdentifier) >>> 0;};MfcImageHost.prototype.avatarHost };MfcImageHost.prototype.avatarUrl = function(nUserId, nSize ){ nUserId = parseInt(nUserId ); nSize = parseInt(nSize ) || 90; return MfcImageHost.prototype.hostUrl() + "photos2/" + nUserId.toString().substring(0,3) + "/" + nUserId + '/' + ( MfcImageHost.prototype.avatarPrefix() ) + '.' + nSize + 'x' + nSize + '.jpg';};

// js_build_core: MfcJs/MfcRecommend/MfcRecommend.js
function MfcRecommend(config){ config = config || {}; var _callback = config.callback || null; var _apiUrl = ( config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ) + '/recommend'; var _debug=0; var _cacheTTL = 30000; var reqObj; if(window.navigator.appName.indexOf('Internet Explorer') > -1) reqObj = new ActiveXObject('Microsoft.XMLHTTP'); else reqObj = new XMLHttpRequest(); this.expireCache = function() { for(var queryString in MfcRecommend.cache ) { if ( _debug ) console.log("Cache age: " + ( Date.now() - MfcRecommend.cache[ queryString ].cacheDate ) + ", cache TTL: " + _cacheTTL ); if(MfcRecommend.cache[ queryString ].cacheDate && ( Date.now() - MfcRecommend.cache[ queryString ].cacheDate ) > _cacheTTL ) { if(_debug ) console.log('DELETING DEAD CACHE FOR ' + queryString ); delete MfcRecommend.cache[ queryString ]; } } }; this.getRecommendations = function(options) { options = options || {}; options['version2'] = 1; this.expireCache(); var queryString = ''; for(var sK in options ) { if(sK == 'callback' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&';
 } if(_callback && MfcRecommend.cache[ queryString ] ) { if(_debug && MfcRecommend.cache[ queryString ].cacheDate ) console.log('CACHE AGE FOR ' + queryString + ': ' + ( Date.now() - MfcRecommend.cache[ queryString ].cacheDate ) ); if(MfcRecommend.cache[ queryString ].delayedCallbacks ) { if(_debug ) console.log('QUEUEING CALLBACK FOR ' + queryString ); MfcRecommend.cache[ queryString ].delayedCallbacks.push(_callback ); } else { if(_debug ) console.log('CACHED CALLBACK FOR ' + queryString ); _callback(MfcRecommend.cache[ queryString ].data ); } return; } else { if(_debug ) console.log('NO CACHE FOR ' + queryString ); MfcRecommend.cache[ queryString ] = { delayedCallbacks: [] }; } try { if(_debug ) console.log('FRESH CALL FOR ' + queryString ); var self = this; reqObj.open("GET",_apiUrl + '?' + queryString ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.getRecommendations_Response(options, queryString ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(); } catch(e) { console.log(e); } }; this.getRecommendations_Response = function(options, queryString ) { if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText ); if(_debug ) console.log('FRESH CACHEABLE CALLBACK FOR ' + queryString ); MfcRecommend.cache[ queryString ] = MfcRecommend.cache[ queryString ] || {}; MfcRecommend.cache[ queryString ].data = res; MfcRecommend.cache[ queryString ].cacheDate = Date.now();
 if(MfcRecommend.cache[ queryString ].delayedCallbacks.length > 0 ) { while(MfcRecommend.cache[ queryString ].delayedCallbacks.length > 0 ) { if(_debug ) console.log('QUEUED CALLBACK FOR ' + queryString ); MfcRecommend.cache[ queryString ].delayedCallbacks.shift()( res ); } } delete MfcRecommend.cache[ queryString ].delayedCallbacks; if(_callback ) { _callback(res ); } }; this.getModelConfig = function(options) { var queryString = ''; for(var sK in options ) { if(sK == 'callback' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&'; } try { if(_debug ) console.log(_apiUrl + '/getModelConfig?' + queryString ); var self = this; reqObj.open("GET",_apiUrl + '/getModelConfig?' + queryString ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.getModelConfig_Response(options ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(); } catch(e) { console.log(e); } }; this.getModelConfig_Response = function(options ) { if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); if(_callback ) _callback(JSON.parse(reqObj.responseText ) ); };}MfcRecommend.cache={};

// js_build_core: MfcJs/MfcSocialMedia/MfcSocialMedia.js
function MfcSocialMedia(config){ config = config || {}; var _callback = config.callback || null; var _apiUrl = ( config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ) + '/social_media'; var _services = config.services ? config.services : [ { 'name': 'twitter', 'key': 'twitter_username', 'href': 'https://twitter.com/%%USERNAME%%' }, { 'name': 'instagram', 'key': 'instagram_username', 'href': 'https://www.instagram.com/%%USERNAME%%/' } ]; var _debug=0; var _cacheTTL = 600 * 1000; var reqObj; if(window.navigator.appName.indexOf('Internet Explorer') > -1) reqObj = new ActiveXObject('Microsoft.XMLHTTP'); else reqObj = new XMLHttpRequest(); this.processResults = function(res ) { var parsed = {}; if ( ! res || ! res.result ) return parsed; for(var i = 0; i < _services.length; i++) { var username; if(! (username = res.result[ _services[i].key ]) ) { continue; } parsed[_services[i].name ] = {
 'name': _services[i].name, 'key': _services[i].key, 'url': _services[i].href.replace(/%%USERNAME%%/g, encodeURI(username)), 'raw_username': username, 'username': username.replace(/</g, "&lt;").replace(/>/g, "&gt;") } } if ( res.result['mfc_share'] && res.result['mfc_share']['user_id']) { var _mfc_share_data = res.result['mfc_share']; parsed['mfc_share'] = { 'album_count' : _mfc_share_data['album_count'], 'album_last_created' : _mfc_share_data['album_last_created_at'] }; } if(_debug ) { console.log(parsed); } return parsed; }; this.expireCache = function() { for(var cacheKey in MfcSocialMedia.cache ) { if ( _debug ) console.log("Cache age: " + ( Date.now() - MfcSocialMedia.cache[ cacheKey ].cacheDate ) + ", cache TTL: " + _cacheTTL ); if(MfcSocialMedia.cache[ cacheKey ].cacheDate && ( Date.now() - MfcSocialMedia.cache[ cacheKey ].cacheDate ) > _cacheTTL ) { if(_debug ) console.log('DELETING DEAD CACHE FOR ' + cacheKey ); delete MfcSocialMedia.cache[ cacheKey ]; } } }; this.getSocialMedia = function(options) { options = options || {}; var url = _apiUrl + '/' + options.user_id; this.expireCache(); if(! options.user_id ) { if(_debug ) console.log('CALLED WITH INVALID options.user_id: ' + options.user_id ); return; } var queryString = ''; for(var sK in options )
 { if(sK == 'callback' || sK == 'user_id' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&'; } var cacheKey = options.user_id + '?' + queryString; if(_callback && MfcSocialMedia.cache[ cacheKey ] ) { if(_debug && MfcSocialMedia.cache[ cacheKey ].cacheDate ) console.log('CACHE AGE FOR ' + cacheKey + ': ' + ( Date.now() - MfcSocialMedia.cache[ cacheKey ].cacheDate ) ); if(MfcSocialMedia.cache[ cacheKey ].delayedCallbacks ) { if(_debug ) console.log('QUEUEING CALLBACK FOR ' + cacheKey ); MfcSocialMedia.cache[ cacheKey ].delayedCallbacks.push(_callback ); } else { if(_debug ) console.log('CACHED CALLBACK FOR ' + cacheKey ); _callback(MfcSocialMedia.cache[ cacheKey ].data ); } return; } else { if(_debug ) console.log('NO CACHE FOR ' + cacheKey ); MfcSocialMedia.cache[ cacheKey ] = { delayedCallbacks: [] }; } try { if(_debug ) console.log('FRESH CALL FOR ' + cacheKey ); var self = this; reqObj.open("GET", url + '?' + queryString + '&no_cache=' + Math.random() ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.getSocialMedia_Response(options, cacheKey ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(); } catch(e) { console.log(e); } }; this.getSocialMedia_Response = function(options, cacheKey ) { if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText );
 var parsedResults = this.processResults(res); if(_debug ) console.log('FRESH CACHEABLE CALLBACK FOR ' + cacheKey ); MfcSocialMedia.cache[ cacheKey ] = MfcSocialMedia.cache[ cacheKey ] || {}; MfcSocialMedia.cache[ cacheKey ].data = parsedResults; MfcSocialMedia.cache[ cacheKey ].cacheDate = Date.now(); if(MfcSocialMedia.cache[ cacheKey ].delayedCallbacks.length > 0 ) { while(MfcSocialMedia.cache[ cacheKey ].delayedCallbacks.length > 0 ) { if(_debug ) console.log('QUEUED CALLBACK FOR ' + cacheKey ); MfcSocialMedia.cache[ cacheKey ].delayedCallbacks.shift()( parsedResults ); } } delete MfcSocialMedia.cache[ cacheKey ].delayedCallbacks; if(_callback ) { _callback(parsedResults ); } };}MfcSocialMedia.cache={};

// js_build_core: MfcJs/AutoSuggest/AutoSuggest.js
function AutoSuggest(params ){ params = params || {}; var lastInputString=''; this.throttle = false; var _user_object_key_map = { 'nm': 'nm', 'lv': 'lv', 'uid': 'uid' }; if(params.user_object_key_map )
 for(var key in params.user_object_key_map ) _user_object_key_map[ key ] = params.user_object_key_map[ key ]; this.suggest = function(inputString ) { inputString = inputString || ''; if(typeof(params.users_collection_function) == 'function' ) params.users_collection = params.users_collection_function(); if(typeof(params.users_collection) != 'object' ) { return; } var maxDepth = 4; var suggestion_set = []; if(inputString.length > 0 ) { var lcMatchString = inputString.toLowerCase(); var keys = []; var nmKey = _user_object_key_map['nm']; var uidKey = _user_object_key_map['uid']; var sliceLength = maxDepth + lcMatchString.length - 1; for(var userId in params.users_collection ) { var user = params.users_collection[ userId ]; if ( ! user[ nmKey ] ) continue; var nm = user[ nmKey ].toLowerCase(); var depth = nm.indexOf(lcMatchString); if ( depth >= 0 && depth <= maxDepth ) keys.push({ sortKey: depth + ':' + nm, uid: user[ uidKey ] }); } keys.sor}); var maxLength = ( params.return_limit && params.return_limit < keys.length ) ? params.return_limit : keys.length; for(var a=0; a < maxLength; a++ ) {
 var key = keys[a]; suggestion_set.push(params.users_collection[ key.uid ] ); } } return suggestion_set; }; this.load_suggestion_dropdown = function(inputString ) { if(typeof(params.throttle_time) == 'number' ) { if(this.throttle ) { _inputString = inputString; clearTimeout(this.followup_call ); var self = this; this.followup_call = setTimeout(function() { self.throttle = false; self.load_suggestion_dropdown(inputString ); } , params.throttle_time ); return; } this.throttle = true; clearTimeout(this.followup_call ); var self = this; this.followup_call = setTimeout(function() { self.throttle = false; } , params.throttle_time ); } if(params.no_change_no_suggest && lastInputString == inputString ) { return; } lastInputString = inputString; if(typeof(params.get_matching_users_function) == 'function' ) { var inputObj = { input: inputString }; if(params.return_limit ) { inputObj.return_limit = params.return_limit; } suggestions = params.get_matching_users_function(inputObj ); } else { suggestions = this.suggest(inputString ) || []; }
 if(suggestions.length == 0 ) { this.close_suggestion_dropdown_execute(); return; } var mfcImg = new MfcImageHost(); var innerContainer = document.createElement('div'); innerContainer.className = 'AutoSuggest_inner_container'; for(var a=0; a < suggestions.length; a++ ) { var user = suggestions[a]; var suggestionHtml = document.createElement('div'); suggestionHtml.className = 'AutoSuggest_suggestion'; var username = user[ _user_object_key_map['nm'] ]; var regExp = new RegExp('(' + inputString.replace(/\W/,'') + ')', 'i' ); suggestionHtml.innerHTML = username.replace(regExp, "<b>$1</b>" ); if(user['after_username'] ) { suggestionHtml.innerHTML += user['after_username']; } if(typeof(params.suggestion_click_callback ) == 'function' ) { var self = this; suggestionHtml.onclick = function(thisUser ) { retur}; }(user); } var avatarUrl = mfcImg.avatarUrl(user[ _user_object_key_map['uid'] ], 20, 20 ); var avatar = document.createElement('img'); avatar.className = 'AutoSuggest_suggestion_avatar'; avatar.src = avatarUrl; suggestionHtml.appendChild(avatar ); if(params.add_class_function ) suggestionHtml.className += params.add_class_function(user ); innerContainer.appendChild(suggestionHtml ); } var container = document.createElement('div');
 container.className = 'AutoSuggest_container'; container.id = 'AutoSuggest_container'; container.appendChild(innerContainer ); var trimDiv = document.createElement('div'); trimDiv.className = 'AutoSuggest_trim'; container.appendChild(trimDiv ); var existingContainer = document.getElementById('AutoSuggest_container'); if(params.output_div ) { if(existingContainer ) params.output_div.replaceChild(container, existingContainer ); else params.output_div.appendChild(container ); } }; this.close_suggestion_dropdown = function() { clearTimeout(this.followup_call ); setTimeout(this.close_suggestion_dropdown_execute, 250 ); }; this.close_suggestion_dropdown_execute = function() { var outputDiv = document.getElementsByClassName('AutoSuggest_container'); if(outputDiv[0] ) outputDiv[0].parentNode.removeChild(outputDiv[0] ); };}

// js_build_core: MfcJs/OAPopup/OAPopup.js
 function OAPopup(options ){ options = options || {}; this.isOpen = false; this.sitename = options.sitename || ( g_hPlatform && g_hPlatform.name ); this.leave_site_url = options.leave_site_url || 'https://www.google.com'; var _popupHTML = " <div style=\"display: none;\"> <div id=\"oapopup\"> <div class=\"oapopup-body\">\
 <p> " + this.sitename + " is an age-restricted adult platform.<br> You must be at least 18 years old to enter<br> and agree to this website's <a href=\"https://wiki.myfreecams.com/wiki/Terms_and_Conditions\" target=\"_blank\" style=\"color:black;text-decoration:none;\">terms of service</a>. </p> </div> <div class=\"oapopup-footer\"> <div class=\"oapopup-buttons\"> <a href=\"#\" class=\"btn enter\" id=\"enter_mobile\">I Agree - Click Here to Enter<span class=\"button_site\">&nbsp;Mobile Site</span></a> <a href=\"#\" class=\"btn enter\" id=\"enter_desktop\">I Agree - <span class=\"button_desktop_extra\">Click Here to </span>Enter<span class=\"button_site\">&nbsp;Desktop Site</span></a> <a href=\"" + this.leave_site_url + "\" class=\"btn\" id=\"leave_site\" target=\"_top\">Leave</a> </div> </div> <div class=\"oapopup-landing_legal_text\"></div> </div> </div> "; if(options.html ) { _popupHTML = options.html; } this.open = function() { if($('#oapopup').length == 0 ) { $('body').append(_popupHTML ); } if(options.landing_legal_text ) { $('.oapopup-landing_legal_text').css('display','block'); $('.oapopup-landing_legal_text').append(options.landing_legal_text.replace(/\n/g,'<br><br>') ); } $('#cboxOverlay').on('click'}); var self = this; $('#oapopup a.btn.enter').on('click', function(e) { e.preventDefault(); if ( e.currentTarget.id === 'enter_mobile' ) { var hashMatch = top.location.hash.match(/#(.*)/); top.location = "http://m." + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") + "/" + ( hashMatch ? ( 'models/' + hashMatch[1] ) : '' ); return; } self.close();
 }); var mobileOAPopup = ( typeof(options.isMobile ) == 'function' && options.isMobile() ); var colorboxOptions = { fixed: false, reposition: false, overlayClose: false, trapFocus: true, escKey: false, closeButton: false, inline: true, href: "#oapopup", maxWidth: options.maxWidth ? options.maxWidth : (mobileOAPopup ? "80%" : "60%"), fadeOut: 0, open: true }; if ( mobileOAPopup ) { $('#oapopup').addClass('mobile'); $('#leave_site').text("Leave " + this.sitename ); colorboxOptions.onComplete }; } else { $('#oapopup').addClass('desktop'); } if ( typeof(options.isLegacyIE ) == 'function' && options.isLegacyIE() ) { colorboxOptions.onComplete = function() { var $colorbox = $('#colorbox'); var w = $colorbox.width(); var h = $colorbox.height(); var newTop = parseInt(($(document).height() - h) / 2, 10 ); var newLeft = parseInt(($(document).width() - w) / 2, 10 ); if ( newTop < 0 ) { newTop = 0; } if ( newLeft < 0 ) { newLeft = 0; } $colorbox.css({top: newTop + 'px', left: newLeft + 'px'}); }; } $.colorbox(colorboxOptions); this.isOpen = true; }; this.close }; if(options.open ) { this.open(); }}

// js_build_core: MfcJs/MfcCountdownModelUI/MfcCountdownModelUI.js
function MfcCountdownModelUI(params ){ var _params = params || {}; _params.templates = params.templates || {}; _params.countdown = params.countdown || {}; var self = this; var _hCountdown = {}; var _hPreviousState = {}; var _sMessage = ''; var _bMessageTimer = false;
 var _hInputChange = {}; var _bEditable = false; var _nMaxFormWidth = 750; if(_params.countdown ) for(var sK in _params.countdown ) { _hCountdown[sK] = _params.countdown[sK]; } this.set_params }; _params.templates.new_counter = _params.templates.new_counter || " <div class=\"countdownUI_container\"> <div class=\"countdownUI_heading start\">Start a Tip Countdown</div> <div class=\"countdownUI_message\">&nbsp;</div> <div class=\"countdownUI_form_container\"> <table cellpadding=0 cellspacing=0> <tr> <td> <b style='font-size:14px;'>Total Tokens in Countdown: </b> </td> <td> <input type=text class=\"countdownUI_total_input\"> </td> </tr> <tr> <td colspan=2> <div style=\"padding:4px;\"> </div> </td> </tr> <tr> <td style='font-size:12px;'>Existing Countdown? <a href=# class=\"countdownUI_enable_remain_input\">Set Tokens Remaining</a> &nbsp; &nbsp;</td> <td> <input type=text class=\"countdownUI_remain_input\"> </td> </tr> </table> <br> </div> <div style=\"padding:4px;\"> </div> <input type=button class=\"countdownUI_initiate\" value=\"Start Countdown\"><br/> <br/> <span style='font-size:13px;'>After clicking Start, you will need to add a code to the topic to share the countdown with the room.<br/> <br/> Please see the <a href=# class=\"infolink countdownUI_wiki_a_tag\">Countdown Wiki</a> for more details.</span> </div> ";
 _params.templates.edit_counter = _params.templates.edit_counter || " <div class=\"countdownUI_container\"> <div class=\"countdownUI_heading edit_counter\">Tip Countdown In Progress</div> <div class=\"countdownUI_message\">&nbsp;</div> <div class=\"countdownUI_form_container\"> <div class=\"countdownUI_display_container\"> <div class=\"countdownUI_total_display_container\"> </div> </div> <div class=\"countdownUI_control_container\"> <table cellpadding=0 cellspacing=0 style=\"width:95%;max-width:" + _nMaxFormWidth + "px;\"> <tr> <td nowrap>Countdown from &nbsp; </td> <td nowrap><input type=text class=\"countdownUI_total_input\"> &nbsp; </td> <td width=100%><input type=button class=\"countdownUI_total_update\" value=\"Change Total\"></td> </tr> <tr> <td nowrap>Remaining tokens &nbsp; </td> <td nowrap><input type=text class=\"countdownUI_remain_input\"> &nbsp; </td> <td><input type=button class=\"countdownUI_remain_update\" value=\"Change Remaining\"></td> </tr> <tr class=\"countdownUI_adjust_container\"> <td nowrap><label for=\"value\">Adjust tokens earned </label> &nbsp; </td> <td colspan=2> <select name=\"countdownUI_sofar_sign\" class=\"countdownUI_sofar_sign\"> <option value=\"add\">Add (tip)</option> <option value=\"subtract\">Subtract (undo)</option> </select> <input type=text class=\"countdownUI_sofar_adjust\"> tokens. <input type=button class=\"countdownUI_sofar_update\" value=\"Submit\"> </td> </tr> </table> </div> </div> <input type=button class=\"countdownUI_terminate\" value=\"End Countdown\"> <input type=button class=\"countdownUI_edit_countdown\" value=\"Modify Countdown\"> <input type=button class=\"countdownUI_close_form\" value=\"Close Window\"> <br/><br/> <span style=\"font-size:14px;\">Enter the codes above into the room topic to share the countdown.<br/> For example, \"@remain until show\" will show up as \"100 until show\".</span> </div> "; this.update = function(hUpdateVars ) { this.update_data_object(hUpdateVars ); };
 this.getCountdownVal = function(sKey ) { return _hCountdown[ sKey ]; }; this.send_update = function(hUpdateVars ) { if(_params.send_to_server ) { for(var sK in _hCountdown ) if(hUpdateVars[sK] == undefined ) hUpdateVars[ sK ] = _hCountdown[ sK ]; _params.send_to_server(hUpdateVars ); } }; this.update_data_object = function(hUpdateVars ) { for(var sK in _hCountdown ) _hPreviousState[ sK ] = _hCountdown[ sK ]; for(var sK in hUpdateVars ) if(sK != 'sofar_adjust' ) _hCountdown[ sK ] = hUpdateVars[ sK ]; if(_hCountdown.countdown === false ) { delete _hCountdown.total; delete _hCountdown.sofar; } this.data_object_change(); }; this.initiate = function() { _bMessageTimer = false; var hFormVars = this.serialize_form(); if(hFormVars === false ) { return; } if(typeof(hFormVars) != 'object' ) { return; } hFormVars.countdown = true;
 this.send_update(hFormVars ); }; this.terminate }; this.close_form = function() { if(typeof(_params.close_form) == 'function' ) _params.close_form(); }; this.set_message = function(sMessage, sType ) { var nodes = this.get_nodes(this.container ); if(! nodes.message ) { return; } sType = sType || 'message'; sType = sType.replace(/\W/g,''); if(sType == 'progress' && _bMessageTimer ) { return; } nodes.message.innerHTML = "<div class=" + sType + ">" + sMessage + "</div>"; if(sType != 'progress' ) { _bMessageTimer = true; setTimeou}, 5000 ); } }; this.data_object_change = function() { if(this.bFormOpen ) { if(_hPreviousState.countdown != _hCountdown.countdown ) this.open(); else this.refresh_form(); } }; this.open = function() { var self = this;
 if(this.container && this.container.parentNode ) this.container.parentNode.removeChild(this.container ); var oCountdownForm = _params.countdown_form_node; var sHtml; if(_hCountdown.countdown == true ) sHtml = _params.templates.edit_counter; else sHtml = _params.templates.new_counter; for(var sKey in _hCountdown ) { if(typeof(_hCountdown[sKey] ) != 'string' ) { continue; } var regex = new RegExp("{{" + sKey + "}}"); sHtml = sHtml.replace(regex,_hCountdown[sKey]); } this.container = document.createElement('div'); this.container.innerHTML = sHtml.replace(/^\s+/,''); var nodes = this.get_nodes(this.container ); if(nodes.total_input && typeof(_hCountdown.total)=='number' ) { nodes.total_input.value = parseInt(_hCountdown.total ); } if(nodes.total_input ) { nodes.total_input.onchange = function() { self.input_change('total'); }; nodes.total_input.onkeyup = function(e) { self.strip_non_numbers(e); self.set_remain_input(e); if(e.keyCode == 13 ) { if(_hCountdown.countdown ) self.update_from_form('total'); else self.initiate(); } }; } if(nodes.total_update ) { nodes.total_update.onclick = function() { self.update_from_form('total'); }; } if(nodes.remain_input ) { if(! _hCountdown.countdown ) { nodes.remain_input.style.visibility = 'hidden';
 if(_hCountdown.sofar && _hCountdown.total ) nodes.remain_input.value = _hCountdown.total - _hCountdown.sofar; else if(_hCountdown.total ) nodes.remain_input.value = _hCountdown.total; } nodes.remain_input.onchange = function() { self.input_change('remain'); }; nodes.remain_input.onkeyup = function(e) { self.strip_non_numbers(e); if(e.keyCode == 13 ) { self.update_from_form('remain') } } } if(nodes.wiki_a_tag ) { if(_params.wiki_a_tag ) { nodes.wiki_a_tag.parentNode.replaceChild(_params.wiki_a_tag, nodes.wiki_a_tag ); } else { nodes.wiki_a_tag.setAttribute('target', '_blank'); nodes.wiki_a_tag.setAttribute('href', 'http://wiki.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") + '/wiki/Countdowns'); nodes.wiki_a_tag.innerHTML = "Countdown Wiki"; } } if(nodes.remain_update ) { if(! _hCountdown.countdown ) { nodes.remain_update.style.visibility = 'hidden'; } nodes.remain_update.onclick = function() { self.update_from_form('remain'); }; } if(nodes.sofar_update ) { nodes.sofar_update.onclick = function() { self.update_from_form('remain','adjust'); }; } if(nodes.sofar_adjust ) { nodes.sofar_adjust.onkeyup = function(e) { if(e.keyCode == 13 ) { self.update_from_form('remain','adjust'); } }; } if(nodes.edit_countdown ) { nodes.edit_countdown.onclick = function() { self.toggle_edit_controls(); return false; }; } if(nodes.enable_remain_input ) { nodes.enable_remain_input.onclick = function() { self.enable_remain_input(); return false; }; } nodes.message.innerHTML = "&nbsp;"; if(nodes.terminate ) { nodes.terminate.onclick = function() { self.terminate(); }; } if(nodes.initiate ) { nodes.initiate.onclick = function() { self.initiate(); }; } if(nodes.close_form ) { nodes.close_form.onclick = function() { self.close_form(); }; }
 if(nodes.total_input && typeof(_hCountdown.total)=='number' ) { nodes.total_input.value = parseInt(_hCountdown.total ); } if(! oCountdownForm ) { this.set_message("open() requires 'countdown_form_node' node to specify where the form will be output"); } oCountdownForm.appendChild(this.container ); if(! this.bFormOpen && nodes.total_input ) { nodes.total_input.focus(); } this.bFormOpen = true; this.refresh_form(); }; this.strip_non_numbers = function(e) { if(e.target.value.match(/[^-\d]/) ) e.target.value = e.target.value.replace(/[^-\d]/,''); }; this.close = function() { if(this.container && this.container.parentNode ) this.container.parentNode.removeChild(this.container ); this.bFormOpen = false; }; this.set_remain_input = function(e) { var nodes = this.get_nodes(this.container ); if(nodes.remain_input.style.visibility == 'hidden' ) { nodes.remain_input.value = e.target.value; } }; this.enable_remain_input = function() { var nodes = this.get_nodes(this.container ); if(nodes.remain_input ) { nodes.remain_input.style.visibility = 'visible'; nodes.remain_input.setSelectionRange(0, nodes.remain_input.value.length); nodes.remain_input.focus(); } this.remove_enable_remain_input_link(); }; this.remove_enable_remain_input_link = function() { var nodes = this.get_nodes(this.container );
 var oEl; if(oEl = nodes.enable_remain_input ) { var oNewEl = document.createElement('span'); oNewEl.innerHTML = oEl.innerHTML; oEl.parentNode.replaceChild(oNewEl,oEl); } }; this.input_change }; this.toggle_edit_controls = function(sField ) { _bEditable = _bEditable ? false : true; this.refresh_form(); }; this.update_from_form = function(sField, sAction ) { var hFormVars = this.serialize_form(); if(hFormVars === false ) { return; } var hChangeVars = {}; if(typeof(hFormVars) != 'object' ) { return; } var nodes = this.get_nodes(this.container ); if(sField == 'remain' ) { var nRemainAdjust; var nRemain; if(sAction == 'adjust' && hFormVars.sofar_adjust ) { hChangeVars.sofar = _hCountdown.sofar + hFormVars.sofar_adjust; var bErr=false; if(hChangeVars.sofar < 0 ) { this.set_message("The number of tokens needed cannot exceed the countdown total."); bErr=true; } else if(hChangeVars.sofar > _hCountdown.total ) { this.set_message("The amount earned so far cannot exceed the tokens remaining."); bErr=true; } else if(isNaN(hFormVars.sofar_adjust) ) { this.set_message("Token adjustment value must be a number."); bErr=true; } if(bErr ) { if(nodes.sofar_adjust )
 { nodes.sofar_adjust.setSelectionRange(0, nodes.sofar_adjust.value.length); nodes.sofar_adjust.focus(); } return; } } else if(nodes['remain_input'] ) { nRemain = nodes['remain_input'].value; if(nRemain < 0 ) { this.set_message("The tokens 'remaining' value cannot be a negative number."); return; } else if(nRemain > _hCountdown.total ) { this.set_message("The tokens 'remaining' value cannot exceed the total number of tokens."); return; } hChangeVars.sofar = ( hFormVars.total - nRemain ); } if(hChangeVars.sofar < 0 ) { this.set_message("The remaining value cannot exceed the total tokens value."); return; } } else if(sField == 'total' || sField == 'sofar' ) { hChangeVars[ sField ] = hFormVars[ sField ]; } _bMessageTimer = false; _hInputChange[ sField ] = false; this.send_update(hChangeVars ); }; this.refresh_form = function() { var nodes = this.get_nodes(this.container ); if(_bEditable )
 { if(nodes.display_container ) { nodes.display_container.style.display='none'; } if(nodes.control_container ) { nodes.control_container.style.display='block'; } if(nodes.edit_countdown ) { nodes.edit_countdown.value='Hide Options'; } } else { if(nodes.control_container ) { nodes.control_container.style.display='none'; } if(nodes.display_container ) { nodes.display_container.style.display='block'; } if(nodes.edit_countdown ) { nodes.edit_countdown.value='Modify Countdown'; } } if(nodes.total_input && typeof(_hCountdown.total)=='number' && nodes.total_input != document.activeElement ) { nodes.total_input.value = parseInt(_hCountdown.total ); } if(nodes.total_display ) { nodes.total_display.innerHTML = parseInt(_hCountdown.total ) } if(typeof(_hCountdown.total)=='number' && typeof(_hCountdown.sofar)=='number' ) { if(nodes.remain_input && nodes.remain_input != document.activeElement && _hCountdown.countdown ) nodes.remain_input.value = parseInt(_hCountdown.total - _hCountdown.sofar ); } if(_hCountdown.countdown && typeof(_hCountdown.total) == 'number' && typeof(_hCountdown.sofar) == 'number' ) { this.set_message("<b>" + parseInt(_hCountdown.total - _hCountdown.sofar ) + "</b> tokens remaining in the countdown. (<b>@remain</b>)<br/><b>" + _hCountdown.sofar + "</b> tokens earned so far. (<b>@sofar</b>)<br/><b>" + _hCountdown.total + "</b> tokens total in the countdown. (<b>@total</b>)", 'progress'); } }; this.get_nodes = function(oContainer ) { var classes = [ 'edit_countdown', 'display_container', 'control_container', 'total_display', 'total_input', 'total_update',
 'remain_input', 'remain_adjust_input', 'remain_update', 'sofar_adjust', 'sofar_update', 'sofar_sign', 'initiate', 'terminate', 'close_form', 'message', 'wiki_a_tag', 'enable_remain_input' ]; var nodes = {}; for(var n=0;n<classes.length; n++ ) { var oEl; if(oEl = oContainer.getElementsByClassName('countdownUI_' + classes[n]) ) { nodes[ classes[n] ] = oEl[0]; } } return nodes; }; this.serialize_form = function() { var aErrors=[]; var nodes = this.get_nodes(this.container ); var hFormVars = { sofar: 0 }; var nTotal; if(nodes.total_input ) { nTotal = parseInt(nodes.total_input.value ); } var nWorkingTotal = nTotal > -1 ? nTotal : _hCountdown.total; var nRemain; if(nodes.remain_input ) { nRemain = parseInt(nodes.remain_input.value ); } if(nodes.total_input ) { var bError = false; if(isNaN(nTotal) ) { aErrors.push("The total tokens must be a positive number."); bError = true; } if(nTotal < 0 ) { aErrors.push("The total tokens value cannot be a negative number."); bError = true; }
 if(nTotal < nRemain ) { aErrors.push("The total tokens value cannot be less than the remaining value."); bError = true; } if(bError ) { if(typeof(_hCountdown.total) == 'number' ) nodes.total_input.value = _hCountdown.total; nodes.total_input.setSelectionRange(0, nodes.total_input.value.length); nodes.total_input.focus(); } else { hFormVars.total = nTotal; } } if(nodes.sofar_adjust ) { var nSofarAdjust = parseInt(nodes.sofar_adjust.value ); hFormVars.sofar_adjust = nodes.sofar_sign.value=='add' ? nSofarAdjust : 0 - nSofarAdjust; } if(nodes.remain_input ) { if(nodes.remain_input.style.visibility == 'hidden' ) { hFormVars.sofar = typeof(_hCountdown.sofar ) == 'number' ? _hCountdown.sofar : 0; } else { var bError = false; if(isNaN(nRemain) ) { aErrors.push("Tokens remaining must be a number."); bError = true; } if(nRemain < 0 ) { aErrors.push("Tokens remaining value cannot be a negative number."); bError = true; } if(nRemain > nWorkingTotal ) { aErrors.push("Tokens remaining value cannot exceed the total."); bError = true; } if(bError ) { if(typeof(_hCountdown.total) == 'number' && typeof(_hCountdown.sofar) == 'number' ) nodes.remain_input.value = _hCountdown.total - _hCountdown.sofar; nodes.remain_input.setSelectionRange(0, nodes.remain_input.value.length); nodes.remain_input.focus(); } else { hFormVars.sofar = nWorkingTotal - nRemain;
 } } } if(aErrors.length > 0 ) { this.set_message(aErrors.join(' ') ); return false; } return hFormVars; };}

// js_build_core: MfcJs/MfcBoolSearch/MfcBoolSearch.js
function MfcBoolSearch(){};MfcBoolSearch.prototype.parseQueryString = function(sQuery ){ var sRawQuery = sQuery; sQuery = MfcBoolSearch.prototype.normalizeQueryString(sQuery ); sQuery = MfcBoolSearch.prototype.specialMixedOperatorBehavior(sQuery ); var aNests = MfcBoolSearch.prototype.getNests(sQuery ); var oStructure = MfcBoolSearch.prototype.parseNest(aNests, aNests[0] ); var aWords = MfcBoolSearch.prototype.getWords(sRawQuery ); return { raw: sRawQuery, structure: oStructure, words: aWords };};MfcBoolSearch.prototype.getNests = function(sQuery ){ var aNests = {}; var nNestLevel=0; var aNestStart=[]; var nNestId=0; for(var a=0, len=sQuery.length; a < len; a++ ) { var c = sQuery.charAt(a); if(c == '(' ) { nNestLevel++; aNestStart[nNestLevel] = a; } if(c == ')' ) { nNestId++;
 aNests[ nNestId ] = sQuery.substring(aNestStart[nNestLevel]+1, a ); sQuery = MfcBoolSearch.prototype.splice(sQuery, aNestStart[nNestLevel], ( a - aNestStart[nNestLevel] )+1, ( '~' + nNestId + '~' ) ); a = aNestStart[nNestLevel]; nNestLevel--; } } aNests[0] = sQuery; return aNests;};MfcBoolSearch.prototype.getWords = function(sRawQuery ){ var sCleanString = ' ' + sRawQuery.toLowerCase() + ' '; sCleanString = sCleanString.replace(/[\(\)]/g,''); sCleanString = sCleanString.replace(/ (and|or|not) /g,'~'); var aWords = sCleanString.split('~'); for(var n=0; n<aWords.length; n++ ) { aWords[n] = aWords[n].replace(/\s+$/g,''); aWords[n] = aWords[n].replace(/^\s+/g,''); if(aWords[n]=='and' || aWords[n]=='and' || aWords[n]=='not' ) { aWords.splice(n,1); n--; } } return aWords;};MfcBoolSearch.prototype.normalizeQueryString = function(sQuery ){ sQuery = sQuery.toLowerCase(); sQuery = sQuery.replace(/\s+/g,' '); sQuery = sQuery.replace(/\s+$/,''); sQuery = sQuery.replace(/^\s+/,''); sQuery = sQuery.replace(/(\S+)([\(\)])/,"$1 $2"); sQuery = sQuery.replace(/([\(\)])(\S+)/,"$1 $2"); var aOpenParens = sQuery.match(/\(/g); var aCloseParens = sQuery.match(/\)/g); if(aOpenParens && aCloseParens && aOpenParens.length != aCloseParens.length
 ) { sQuery = sQuery.replace(/[\(\)]/,''); } return sQuery;};MfcBoolSearch.prototype.specialMixedOperatorBehavior = function(sQuery ){ if(sQuery.indexOf('(') == -1 && sQuery.indexOf(' and ') > -1 && sQuery.indexOf(' or ') > -1 ) { sQuery = sQuery.replace(/ and /g,' or ') } return sQuery;};MfcBoolSearch.prototype.autoNest = function(sQuery ){ sQuery = sQuery.replace(/\|/g,''); var sNest = sQuery; sNest = sNest.replace(/ or /g,' O '); sNest = sNest.replace(/ and /g,' A '); sNest = sNest.replace(/ not /g,' N '); var aMatches; var nBailOut = 0; while(( aMatches = sNest.match(/[^\(\)]+/) ) && aMatches && aMatches[0].indexOf('A') > -1 && aMatches[0].indexOf('O') > -1 && nBailOut++ < 100 ) { sNest = sNest.replace(/([^ON]+A[^ON]+)/g," ($1) "); } sNest = sNest.replace(/ O /g,' or '); sNest = sNest.replace(/ A /g,' and '); sNest = sNest.replace(/ N /g,' not ');
 return sNest;};MfcBoolSearch.prototype.parseNest = function(aNests, sQuery ){ var aFirstOp = sQuery.match(/ (and|or) /); sQuery = ( aFirstOp ? aFirstOp[1] : 'and' ) + ' ' + sQuery + ' '; sQuery = sQuery.replace(/ (and|or|not) /g,' |$1 '); var aMatches = sQuery.match(/(and|or|not) ([^\|]+)/g); var oSets = {}; for(var a=0;a<aMatches.length;a++ ) { var aOpSet; if(aOpSet = aMatches[a].match(/^(and|or|not) (.*)\s+$/) ) { if(! oSets[aOpSet[1]] ) { oSets[aOpSet[1]] = []; } var aNestId; if(aNestId = aOpSet[2].match(/~(\d+)~/) ) { oSets[aOpSet[1]].push(MfcBoolSearch.prototype.parseNest(aNests, aNests[ aNestId[1] ] ) ); } else { aOpSet[2] = aOpSet[2].replace(/\s+$/,''); aOpSet[2] = aOpSet[2].replace(/^\s+/,''); oSets[aOpSet[1]].push(aOpSet[2] ); } } } return oSets;};MfcBoolSearch.prototype.splice };MfcBoolSearch.prototype.isMatch = function(sHaystack, oQueryObj ){ if(! oQueryObj || ! oQueryObj.structure ) { return; } return MfcBoolSearch.prototype.isMatch_fromStructure(sHaystack, oQueryObj.structure );
};MfcBoolSearch.prototype.isMatch_fromStructure = function(sHaystack, hStructure ){ if(hStructure.not ) { for(var a=0; a < hStructure.not.length; a++ ) { if(typeof(hStructure.not[a] ) == 'object' ) { if(MfcBoolSearch.prototype.isMatch_fromStructure(sHaystack , hStructure.not[a] ) ) { return false; } } else { if(sHaystack.indexOf(hStructure.not[a] ) > -1 ) { return false; } } } } if(hStructure.or ) { for(var a=0; a < hStructure.or.length; a++ ) { if(typeof(hStructure.or[a] ) == 'object' ) { if(MfcBoolSearch.prototype.isMatch_fromStructure(sHaystack , hStructure.or[a] ) ) { return true; } } else { if(sHaystack.indexOf(hStructure.or[a] ) > -1 ) { return true; } } } } if(hStructure.and ) { var nAndCount=0; for(var a=0; a < hStructure.and.length; a++ ) { var bResult; if(typeof(hStructure.and[a] ) == 'object' ) { bResult = MfcBoolSearch.prototype.isMatch_fromStructure(sHaystack , hStructure.and[a] ); } else { bResult = ( sHaystack.indexOf(hStructure.and[a] ) > -1 ); }
 if(bResult ) { nAndCount++; } } if(nAndCount == hStructure.and.length ) { return true; } } return false;};

// js_build_core: MfcJs/MfcSessionManager/MfcSessionManager.js
function MfcSessionManager(hOptions ){ if ( ! hOptions ) hOptions = {}; this.hOptions = { fGetUserSessions: function(nUserId ) { return undefined; } }; this.sessionTmpl = { sessionid: 0, state: FCS.FCVIDEO_OFFLINE, model_sw: 0, hdvideo: 0, videoserver: 0 }; this.vKeys = Object.keys(this.sessionTmpl ); for (var option in hOptions) this.hOptions[option] = hOptions[option];}MfcSessionManager.prototype.isSessionKey = function(sKey )
{ return this.sessionTmpl.hasOwnProperty(sKey);};MfcSessionManager.prototype.copySessionInfo = function(hMap ){ var hNewSession = {}; for (var n = 0; n < this.vKeys.length; n++) { if (hMap.hasOwnProperty(this.vKeys[n]) && hMap[this.vKeys[n]] !== undefined) hNewSession[ this.vKeys[n] ] = hMap[ this.vKeys[n] ]; } return hNewSession;};MfcSessionManager.prototype.processSession = function(nUserId, hSessionInfo, historical ){ if ( ! this._isValidSessionObj(hSessionInfo) ) return false; var hSessions = this.hOptions.fGetUserSessions(nUserId ); if ( typeof(hSessions) !== 'object' ) return false; var nSessionId = hSessionInfo.sessionid; if ( ! hSessions[ nSessionId ] && hSessionInfo.state != FCS.FCVIDEO_OFFLINE ) { hSessions[ nSessionId ] = { }; for (var n = 0; n < this.vKeys.length; n++) hSessions[ nSessionId ][ this.vKeys[n] ] = hSessionInfo[ this.vKeys[n] ]; } else if ( hSessions[ nSessionId ] ) { if ( hSessionInfo.state != FCS.FCVIDEO_OFFLINE) { for (var n = 0; n < this.vKeys.length; n++) { if ( !historical || !hSessions[ nSessionId ].hasOwnProperty(this.vKeys[n]) ) { if (hSessionInfo.hasOwnProperty(this.vKeys[n])) hSessions[ nSessionId ][ this.vKeys[n] ] = hSessionInfo[ this.vKeys[n] ]; }
 } } else delete hSessions[ nSessionId ]; } return true;};MfcSessionManager.prototype.determineBestSession = function(nUserId ){ var hSessions = this.hOptions.fGetUserSessions(nUserId ); if ( typeof(hSessions) !== 'object' ) return false; var nSessionIdToUse = 0; var nStateToUse = FCS.FCVIDEO_OFFLINE; var bFoundModelSw = false; for ( var nSessionId in hSessions ) { var nState = hSessions[nSessionId].state; if ( nState == FCS.FCVIDEO_OFFLINE ) continue; var bUseThis = false; if ( hSessions[nSessionId].model_sw ) { if ( bFoundModelSw ) { bUseThis = (nState < nStateToUse); } else { bFoundModelSw = true; bUseThis = true; } } else if ( ! bFoundModelSw && nSessionId > nSessionIdToUse ) {
 bUseThis = true; } if ( bUseThis ) { nSessionIdToUse = nSessionId; nStateToUse = nState; } } var hNewSession = {}; for (var n = 0; n < this.vKeys.length; n++) { if (hSessions.hasOwnProperty(nSessionIdToUse) && hSessions[nSessionIdToUse][this.vKeys[n]] !== undefined) { hNewSession[ this.vKeys[n] ] = hSessions[nSessionIdToUse][ this.vKeys[n] ]; } } if (!hNewSession.hasOwnProperty('sessionid')) { hNewSession['sessionid'] = this.sessionTmpl['sessionid']; } if (!hNewSession.hasOwnProperty('state')) { hNewSession['state'] = this.sessionTmpl['state']; } return hNewSession;};MfcSessionManager.prototype._isValidSessionObj = function(hSessionInfo ){ if ( typeof(hSessionInfo) !== 'object' || hSessionInfo.sessionid === undefined || hSessionInfo.state === undefined ) return false; return true;};

// js_build_core: MfcJs/MfcClientInfo/MfcClientInfo.js
function MfcClientInfo(){};MfcClientInfo.prototype.GetClientUID = function(){ var uid; if(typeof(Storage) !== 'undefined' ) { try{ uid = localStorage.uid; } catch(e) {} if(! uid ) { uid = parseInt(Math.random() * 99999999999999 ); try{ localStorage.uid = uid; } catch(e) {} } } return uid;};MfcClientInfo.prototype.PluginTest = function(){ var aMatchPatterns = new Array('Adobe Acrobat', 'AdobeAAMDetect', 'Google Update', 'Identity Protection Technology', 'Microsoft Office', 'Silverlight Plug-In', 'Shockwave Flash', 'VLC Web Plugin', 'Windows Live' );
 var message = ''; var aPlugins = navigator.plugins; var aCommonPlugins = new Array(); for(var b=0; b<aMatchPatterns.length; b++) { for(var a=0; a<aPlugins.length; a++) { if(aPlugins[a].name.indexOf(aMatchPatterns[b] ) > -1 ) { aCommonPlugins.push(aPlugins[a].name.replace(/[^\w\s]/,'') ); break; } } } return aCommonPlugins;};MfcClientInfo.prototype.GetDPI = function(sMode ){ sMode == sMode || 'actual'; this.oDPIDiv = document.createElement('div'); this.oDPIDiv.id = 'dpi_test'; this.oDPIDiv.style.position = 'absolute'; this.oDPIDiv.style.whiteSpace = 'nowrap'; if(sMode == 'entropic' ) { this.oDPIDiv.style.top = '3.141593in'; this.oDPIDiv.style.left = '0px'; this.oDPIDiv.style.fontSize = '20.33333pt'; this.oDPIDiv.innerHTML = '!@#$%^&*()<99>®©¢<80>abcdefghijklmnopqrstuvwxyz'; } else if(sMode == 'actual' ) { this.oDPIDiv.style.top = '1in'; this.oDPIDiv.style.left = '1in'; } this.oBody = document.getElementsByTagName('body')[0]; this.oBody.appendChild(this.oDPIDiv); var sResult; if(sMode == 'entropic' ) { var nTop = document.getElementById('dpi_test').offsetTop; var nHeight = document.getElementById('dpi_test').offsetHeight; var nWidth = document.getElementById('dpi_test').offsetWidth;
 sResult = nTop.toString() + nHeight.toString() + nWidth.toString(); } else if(sMode == 'actual' ) { sResult = document.getElementById('dpi_test').offsetTop; } this.oDPIDiv.style.display='none'; this.oDPIDiv.parentNode.removeChild(this.oDPIDiv ); return sResult;};MfcClientInfo.prototype.FontTest = function(){ var sOS; if(navigator.userAgent.match(/Linux /) ) { sOS = 'linux'; } else if(navigator.userAgent.match(/Macintosh /) ) { sOS = 'mac'; } else if(navigator.userAgent.match(/Windows /) ) { sOS = 'win'; } if(! MfcClientInfo.hFonts[ sOS ] ) { return []; } this.oTestDiv = document.createElement('div'); this.oTestDiv.style.cssText = 'visibility: hidden; position: absolute; display: block !important'; document.body.insertBefore(this.oTestDiv, document.body.firstChild); var aInstalledFonts = new Array(); for(var nK=0; nK < MfcClientInfo.hFonts[ sOS ].length; nK++ ) { if(this.FontSupported(MfcClientInfo.hFonts[ sOS ][nK] ) ) aInstalledFonts.push(MfcClientInfo.hFonts[ sOS ][nK] ); } document.body.removeChild(this.oTestDiv ); return aInstalledFonts;};MfcClientInfo.prototype.FontSupported = function(sName ){ this.oTestDiv.innerHTML = ' <b style="display:inline !important; width:auto !important; font:normal 10px/1 \'' + sName + '\',sans-serif !important">ii</b> <b style="display:inline !important; width:auto !important; font:normal 10px/1 \'' + sName + '\',monospace !important">ii</b> '; var aTestPair = this.oTestDiv.getElementsByTagName('b');
 return (aTestPair[0].offsetWidth === aTestPair[1].offsetWidth);};MfcClientInfo.hFonts = { linux: [ 'aakar', 'AR PL UMing CN', 'Cantarell', 'Clean', 'ClearlyU', 'Cursor', 'East Syriac Adiabene', 'GentiumAlt', 'Gentium Basic', 'LKLUG', 'LMRomanSlant10', 'Luxi Mono', 'Luxi Serif', 'MarVoSym', 'MgOpen Modata', 'Monospace', 'Padauk', 'Samyak Malayalam', 'Samyak Oriya', 'serif-italic', 'STIXGeneral', 'STIXVariants', 'Suruma', 'TeXGyreHeros', 'Tibetan Machine Uni', 'Ume UI Gothic O5', 'UnGraphic', 'UnPilgi', 'Utopia', 'VL Gothic' ], mac: [ 'Academy Engraved LET', 'Adobe Caslon Pro', 'Adobe Caslon Pro Italic', 'Adobe Hebrew Italic', 'Adobe Naskh Medium', 'Arno Pro', 'Avenir Roman', 'Bangla MN', 'Bank Gothic', 'Bank Gothic Medium', 'Bauhaus 93', 'Birch Std',
 'Blackmoor LET', 'BlairMdITC TT Medium', 'Braggadocio', 'Capitals', 'Chalkduster', 'Chaparral Pro', 'Chaparral Pro Italic', 'Chaparral Pro Light Italic', 'Cracked', 'Damascus', 'Desdemona', 'Eccentric Std', 'Eurostile', 'GB18030 Bitmap', 'Giddyup Std', 'Handwriting - Dakota', 'Hobo Std', 'Jazz LET', 'Kannada MN', 'Kefa Regular', 'Kokonor Regular', 'Kozuka Mincho Pr6N R', 'Kozuka Mincho Pro R', 'Letter Gothic Std', 'Letter Gothic Std Slanted', 'Lithos Pro', 'Lithos Pro Black', 'Malayalam MN', 'Marion Regular', 'Mesquite Std Medium', 'Minion Pro', 'Minion Pro Medium Italic', 'Minion Pro SmBd', 'Myanmar Sangam MN', 'Myriad Pro Cond', 'Myriad Pro Italic', 'Myriad Web Pro', 'Myriad Web Pro Italic', 'Noteworthy Light', 'Nueva Std', 'Nueva Std Cond', 'Nueva Std Italic', 'Orator Std', 'Orator Std Slanted', 'Oriya Sangam MN', 'Party LET', 'PilGi Regular', 'Poplar Std Black', 'PortagoITC TT', 'Princetown LET',
 'PT Sans Italic', 'Rosewood Std', 'Rosewood Std Regular', 'Santa Fe LET', 'SchoolHouse Printed A', 'Sinhala MN', 'Snell Roundhand', 'Snell Roundhand Black', 'STIXGeneral', 'STIXGeneral Italic', 'STIXGeneral-Regular', 'Stone Sans ITC TT-Semi', 'Stone Sans Sem ITC TT Semi', 'Synchro LET', 'Tamil MN', 'Tekton Pro', 'Telugu Sangam MN', 'Trajan Pro', 'Yuppy TC Regular' ], win: [ 'Academy Engraved LET', 'AcadEref', 'Adobe Gothic Std B', 'Adobe Ming Std L', 'Adobe Naskh Medium', 'Airstream', 'Alba', 'Aldhabi', 'Alfredo', 'Alien Encounters', 'Allegro BT', 'Almonte Snow', 'Amethyst', 'AMGDT', 'Amienne', 'AR CHRISTY', 'Arimo', 'Arno Pro', 'Arnprior', 'Autumn', 'AvantGarde Bk BT', 'AVGmdBU', 'Baby Kruffy', 'Balthazar', 'BankGothic Lt BT', 'BankGothic Md BT', 'Bastion', 'Bauhaus 93', 'Baveuse',
 'Benguiat Bk BT', 'BernhardFashion BT', 'BernhardMod BT', 'Berylium', 'Biondi', 'Birch Std', 'Blackletter686 BT', 'Blackoak Std', 'BN Jinx', 'BN Machine', 'Brandish', 'Bremen Bd BT', 'Brussels', 'Burnstown Dam', 'Buxton Sketch', 'Calligraph421 BT', 'Calligraphic', 'CALVIN', 'Candles', 'Candy Round BTN', 'Carbon Block', 'Cataneo BT', 'CatholicSchoolGirls Intl BB', 'Catriel', 'Chaparral Pro', 'Chaparral Pro Light', 'Charlemagne Std', 'Chick', 'Chinyen', 'chs_boot', 'cht_boot', 'CityBlueprint', 'Clarendon', 'Colbert', 'CommercialPi BT', 'CommonBullets', 'Complex', 'CountryBlueprint', 'Credit Valley', 'Dayton', 'Digifit', 'DINPro-Black', 'DINPro-Regular', 'Distant Galaxy', 'DomCasual BT', 'Dutch801 Rm BT', 'Dutch801 XBd BT', 'Earwig Factory', 'Eccentric Std', 'ELEGANCE',
 'Embassy BT', 'Emmett', 'English157 BT', 'Enliven', 'Ethnocentric', 'Euphorigenic S', 'EuroRoman', 'Euro Sign', 'Eurostile', 'Exotc350 Bd BT', 'Fat', 'Freehand521 BT', 'Freehand575 BT', 'Freehand591 BT', 'Freshbot', 'Frosty', 'Gadugi', 'GDT', 'Gentium Basic', 'GENUINE', 'Geotype TT', 'Giddyup Std', 'GothicG', 'Grad', 'Guitar Pro 5', 'Hand Me Down S BRK', 'Hanzel Extended', 'Heavy Heap', 'HGHangle', 'HGMinchoL', 'Hobo Std', 'HolidayPi BT', 'HP PSG', 'Humanst521 BT', 'Humanst521 XBd BT', 'Hurry Up', 'Huxtable', 'Impress BT', 'Induction', 'ISOCP', 'Jenkins v2.0', 'John Handy LET', 'jpn_boot', 'Kabel Bk BT', 'Kabel Ult BT', 'Kozuka Gothic Pr6N B', 'Kozuka Gothic Pro H', 'Kredit', 'La Bamba LET', 'LCD',
 'Letter Gothic Std', 'LetterOMatic', 'Ligurino', 'Linux Biolinum G', 'Lithos Pro Regular', 'Mael', 'Martina', 'Mekanik LET', 'Mesquite Std', 'Milano LET', 'Minion Pro', 'Minion Pro SmBd', 'Minya Nouvelle', 'MisterEarl BT', 'Monospac821 BT', 'Mufferaw', 'Myanmar Text', 'Myriad Condensed Web', 'Myriad Hebrew', 'Myriad Pro', 'Myriad Web', 'Myriad Web Pro', 'Myriad Web Pro Condensed', 'Nasalization', 'Neon Lights', 'Nirmala UI', 'November', 'Nueva Std', 'Orator Std', 'ParkAvenue BT', 'Parry Hotter', 'PenultimateLight', 'Poplar Std', 'Porkys', 'Pupcat', 'Pussycat', 'QuickType II', 'QuickType Mono', 'QuigleyWiggly', 'QuiverItal', 'RomanD', 'Rosewood Std Regular', 'Ruach LET', 'Russel Write TT', 'SansSerif', 'Scruff LET', 'SF Movie Poster', 'Simplex', 'SketchFlow Print', 'Smudger LET',
 'Sneakerhead BTN Shadow', 'Snowdrift', 'Souvenir Lt BT', 'Square721 BT', 'Staccato222 BT', 'Stereofidelic', 'Swis721 Blk BT', 'Swis721 BlkEx BT', 'Swis721 BT', 'Swis721 Cn BT', 'Swis721 Ex BT', 'Swis721 Hv BT', 'Swis721 LtCn BT', 'Swis721 LtEx BT', 'Swiss911 XCm BT', 'SWMacro', 'SWTOR Trajan', 'Syastro', 'Tandelle', 'Teen', 'Teen Light', 'Tekton Pro', 'Tele-Marines', 'Terminator Two', 'Ti73pc', 'Toledo', 'Trajan Pro', 'TtsNote', 'Txt', 'TypoUpright BT', 'UniversalMath1 BT', 'Urdu Typesetting', 'VAGRounded BT', 'Velvenda Cooler', 'Victorian LET', 'Vineta BT', 'Virtual DJ', 'Waker', 'Weltron Urban', 'Westwood LET', 'Wickenden Cafe NDP', 'Woodcut', 'WP CyrillicA', 'WP Greek Helve', 'WP MathExtendedB', 'X-Files', 'Zurich Ex BT', 'ZWAdobeF' ]};


// js_build_core: MfcJs/RequireAccountDetailChange/RequireAccountDetailChange.js
function RequireAccountDetailChange(_config ){ _config = _config || {}; var _reasonReq = {}; var _validateReq = {}; var _submitReq = {}; var _changeReasons = {}; var _changeReasonRequested; var _apiUrl = ( MfcClientRes && MfcClientRes.apiUrl ) || '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1"); var _criteriaSatisfied = {}; var _isModel; if(_config.getAccessLevel ) { _isModel = _config.getAccessLevel() == 4; } if(_config.requiredChangeBitmask ) { _config.getAccessLevel() == 4; } var _placeForm_options={}; this.placeForm = function() { if(! _changeReasonRequested ) { this.getRequiredChange_GetReason(); return; } if(_changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ] ) { _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ] = "You must select a new username before continuing for the following reason: <b>" + _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ] + "</b>"; } else { _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ] = " Due to the Terms and Conditions of this website, you must select a new username before continuing..."; } if(document.cookie.match(/username=([^;]+);/) ) _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ] = "Your current username is <b>" + RegExp.$1 + "</b>." + _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ]; if(_changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.password ] ) { _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.password ] = "You must select a new password before continuing for the following reason: <b>" + _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.password ] + "</b>"; } else { _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.password ] = "You must select a new password before continuing...";
 } var form=''; var submitLabel; var detailCount=0; if(_config.requiredChangeBitmask & RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ) { detailCount++; submitLabel = "Update Username"; form += " " + _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ] + "<br><br> New Username: <input type=text name=requireAccountModification_username_input id=requireAccountModification_username_input ><br><br> <div id=desired_username_status style='padding:10px;margin-top:10x;'>&nbsp;</div> <br><br> "; } if(_config.requiredChangeBitmask & RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.password ) { detailCount++; submitLabel = "Update Password"; form += " " + _changeReasons[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.password ] + "<br><br> <table cellspacing=0 cellpadding=0> <tr> <td style='padding-bottom:15px;' nowrap> Password:&nbsp; </td> <td> <input type=password name=requireAccountModification_password_input id=requireAccountModification_password_input > </td> </tr> <tr> <td nowrap> Confirm Password:&nbsp; </td> <td> <input type=password name=requireAccountModification_confirm_password_input id=requireAccountModification_confirm_password_input > </td> </tr> </table> <br><br> <div id=desired_password_status style='padding:10px;'>&nbsp;</div> <br><br> "; } if(detailCount > 1 ) { submitLabel = "Update Account Details"; } var html = "\
 <form id=requireAccountModification_form > <table > <tr> <td valign=center> " + form + " </td> </tr> <tr> <td valign=center> <input type=submit id=requireAccountModification_submit value=\"" + submitLabel + "\" > </td> </tr> </table> </form> "; if(_config.formEl ) { _config.formEl.innerHTML = html; } var self = this; var el; if(_config.requiredChangeBitmask & RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ) { if(el = document.getElementById('requireAccountModification_username_input') ) el.onkeyup = function() { self.requireAccountModification_Validate('username'); }; } if(_config.requiredChangeBitmask & RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.password ) { if(el = document.getElementById('requireAccountModification_password_input') ) el.onkeyup = function() { self.requireAccountModification_Validate('password'); }; if(el = document.getElementById('requireAccountModification_confirm_password_input') ) el.onkeyup = function() { self.requireAccountModification_Validate('password'); }; } if(el = document.getElementById('requireAccountModification_form') ) el.onsubme; }; _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.username ] = false; _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.password ] = false; }; this.getRequiredChange_GetReason = function() { var url = _apiUrl + "/account/getRequiredChangeReasons"; var self = this; _reasonReq = this.createRequestObject(); _reasonReq.open('get', url); _reasonReq.onreadystatechange = function() { self.requireAccountModification_GetReason_Response(); };
 _reasonReq.send(null); _changeReasonRequested = true; }; this.requireAccountModification_GetReason_Response = function() { if ( _reasonReq.readyState !== 4 ) return; responseObj = JSON.parse(_reasonReq.responseText ); if(responseObj.result ) { _changeReasons = responseObj.result; } else if(responseObj.err && responseObj.errmsg ) { if(_config.formEl ) { _config.formEl.innerHTML = responseObj.errmsg.errors; } else { alert(responseObj.errmsg.errors); } return; } this.placeForm(); }; this.requireAccountModification_Validate = function(type ) { if(type == 'username' ) { var el = document.getElementById('requireAccountModification_username_input'); if(el.value.match(/\W/) ) { el.value = el.value.replace(/\W/,''); } if(_config.getAccesLevel && _config.getAccesLevel() == 4 && event && event.keyCode >= 65 && event.keyCode <= 90 ) { el.value = el.value.charAt(0).tupperCase() + el.value.slice(1); } if(el.value.length < 4 ) { _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] ] = false; this.enableDisableSubmit(); return; }
 } if(type == 'password' ) { var desiredValue = this.getDesiredValue(type ); if(! desiredValue ) { return; } var confirmPassword = document.getElementById('requireAccountModification_confirm_password_input'); if(confirmPassword && confirmPassword.value && confirmPassword.value.length > 3 && desiredValue.length == confirmPassword.value.length ) { _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] ] = true; } else { _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] ] = false; } this.enableDisableSubmit(); return; } var self = this; clearTimeout(this.requireAccountModification_Validate_Timer ); this.requireAccountModification_Validate_Timer = setTimeout(function() { self.requireAccountModification_Validate_Delay(type ) }, 300 ); }; this.requireAccountModification_Validate_Delay = function(type ) { _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] ] = false; var status = document.getElementById('desired_' + type + '_status'); if(status ) { status.innerHTML = '&nbsp;'; status.style.backgroundColor = ''; } var desiredValue = this.getDesiredValue(type ); if(! desiredValue ) { return; } var url = _apiUrl + "/account/validate/" + type + "?desired_" + type + "=" + desiredValue; var self = this; _validateReq = this.createRequestObject(); _validateReq.open('get', url); _validateReq.onreadystatechange = ( function(type ) { return function() { self.requireAccountModification_Validate_Response(type); }
 })(type); _validateReq.send(null); }; this.requireAccountModification_Validate_Response = function(type ) { if ( _validateReq.readyState !== 4 ) return; var response = JSON.parse(_validateReq.responseText ); if(typeof(response) == 'object' && response.errmsg && response.errmsg.errors ) { for(var errType in response.errmsg.errors ) { this.errorResponse(type, response.errmsg.errors[ errType ] ); } } else { if(type == 'password' ) { var confirmPassword = document.getElementById('requireAccountModification_confirm_password_input'); if(confirmPassword && ! confirmPassword.value ) { return; } } var status = document.getElementById('desired_' + type + '_status'); if(status ) { status.style.color = 'green'; status.style.backgroundColor = '#CCFFCC'; if(type == 'username' ) { if(response && response.result ) status.innerHTML = response.result['desired_' + type ] + ' is available!'; else status.innerHTML = 'This username is available!'; } else { status.innerHTML = type + ' accepted!'; } _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] ] = true; } else {
 _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] ] = false; } this.enableDisableSubmit(); } }; this.requireAccountModification_Submit = function() { document.getElementById('requireAccountModification_submit').disabled = true; if(_config.requiredChangeBitmask & RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT.password ) { var desiredPassword = this.getDesiredValue('password'); var confirmPassword = document.getElementById('requireAccountModification_confirm_password_input'); if(confirmPassword && confirmPassword.value && desiredPassword != confirmPassword.value ) { this.errorResponse('password', " Your password and confirm password do not match. " ); return; } if(confirmPassword && confirmPassword.value && confirmPassword.value.length < 6 ) { this.errorResponse('password', " Your password is too short. " ); return; } } var queryString=''; for(var type in RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT ) if(_config.requiredChangeBitmask & RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] ) queryString += "desired_" + type + "=" + this.getDesiredValue(type) + "&"; var url = _apiUrl + "/account/change?" + queryString; var self = this; _submitReq[type] = this.createRequestObject(); _submitReq[type].open('get', url); _submitReq[type].onreadystatechange}
 })(type); _submitReq[type].send(null); return false; }; this.requireAccountModification_Submit_Response = function(type ) { if ( _submitReq[type].readyState !== 4 ) { return; } var response = JSON.parse(_submitReq[type].responseText ); if(typeof(response) == 'object' ) { if(response.errmsg && response.errmsg.errors ) { for(var type in RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT ) { if(response.errmsg.errors[type] ) this.errorResponse(type, response.errmsg.errors[ type ] ); } } else if(response.result ) { for(var type in RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT ) { var message; if(type == 'password' ) { message = 'Password changed!'; } else if(response.result.desired_username && type == 'username' ) { message = 'Username changed!'; } var status; if(message && ( status = document.getElementById('desired_' + type + '_status') ) ) { status.style.color = 'green'; status.style.backgroundColor = '#CCFFCC'; status.innerHTML = message; } } if(_config.onSuccesFn ) { _config.onSuccesFn(response.result ); } } } };
 this.errorResponse = function(type, response ) { var status = document.getElementById('desired_' + type + '_status'); if(status ) { status.style.color = 'red'; status.style.backgroundColor = '#FFFF88'; if(typeof(response ) == 'string' ) status.innerHTML = response; else if(typeof(response ) == 'object' ) status.innerHTML = response.join('<br>'); } _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] ] = false; this.enableDisableSubmit(); }; this.getDesiredValue = function(type ) { var desiredValue = document.getElementById('requireAccountModification_' + type + '_input').value; if(! desiredValue ) { return ''; } return desiredValue; }; this.enableDisableSubmit = function(type ) { var allCriteriaMet = true; for(var type in RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT ) { if(_config.requiredChangeBitmask & RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] && ! _criteriaSatisfied[ RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT[ type ] ] ) { allCriteriaMet = false; break; } } var _submitButton = document.getElementById('requireAccountModification_submit'); if(_submitButton ) { _submitButton.disabled = ! allCriteriaMet; } }; this.createRequestObject = function() { var XHR; if(window.navigator.appName.indexOf('Internet Explorer') > -1)
 XHR = new ActiveXObject('Microsoft.XMLHTTP'); else XHR = new XMLHttpRequest(); XHR.withCredentials = true; return XHR; };};RequireAccountDetailChange.REQUIRE_ACCT_MOD_BIT = { username: 1, password: 2};

// js_build_core: MfcJs/MfcSidebar/MfcSidebar.js
function MfcSidebar(hOptions) { this.hOptions = hOptions || {}; this.bInitialized = false; this.bShowingCustomization = false; this.initialize();}MfcSidebar.prototype.initialize = function() { if ( this.bInitialized ) return; this.bInitialized = true; this._findMainElements(); this._panels = []; this._panelsById = {}; this._panelsByName = {}; var self = this; $.each(this.hOptions.aPan); }); var nDisplayOrder = 0; $.each(this.hOptions.aDefaultOrder, function() { var oPanel = self._panelsByName[this]; if ( typeof(oPanel) === 'object' && oPanel ) oPanel.setDefaultOrder(++nDisplayOrder ); }); this.movePanelsToOrder();
};MfcSidebar.prototype.toggleCustomizeScreen = function() { if ( this.bShowingCustomization ) { this.bShowingCustomization = false; if ( this.hOptions.bHideSidebarOnCustomization ) this.$sidebar.show(); this.togglePanelSorter(false); this.$customizeContainer.removeClass('active'); this.fireEvent('fHideCustomization'); } else { this.bShowingCustomization = true; this.togglePanelSorter(true); this.$customizeContainer.addClass('active'); if ( this.hOptions.bHideSidebarOnCustomization ) this.$sidebar.hide(); this.fireEvent('fShowCustomization'); } this.updateCustomizeLink();};MfcSidebar.prototype.enablePanelByName = function(sName) { var oPanel = this.getPanelByName(sName); if ( typeof(oPanel) !== 'object' ) return; oPanel.setEnabled(true); this.updateLastVisible(); if ( this.bShowingCustomization ) { this.togglePanelSorter(false); this.togglePanelSorter(true); }};MfcSidebar.prototype.disablePanelByName = function(sName) {
 var oPanel = this.getPanelByName(sName); if ( typeof(oPanel) !== 'object' ) return; oPanel.setEnabled(false); this.updateLastVisible(); if ( this.bShowingCustomization ) { this.togglePanelSorter(false); this.togglePanelSorter(true); }};MfcSidebar.prototype.getPanelDefaultConfig = function() { var aDisplayed = []; var aHidden = []; var aPanels = []; $.each(this._panels, function() { aPanels.push({ nId: this.getId(), nDefaultOrder: this.getDefaultOrder(), bDisplayed: this.getDefaultDisplayed() }); }); aPanels.sort(function(x,y) { if ( x.nDefaultOrder < y.nDefaultOrder ) return -1; else if ( x.nDefaultOrder > y.nDefaultOrder ) return 1; return 0; }); $.each(aPanels, function() { if ( this.bDisplayed ) { aDisplayed.push(this.nId); } else { aHidden.push(this.nId); } }); var aConfig = []; aConfig = aConfig.concat(aDisplayed); if ( aHidden.length ) aConfig = aConfig.concat(['h'], aHidden);
 return aConfig;};MfcSidebar.prototype.getPanelConfig = function() { var aDisplayed = []; var aHidden = []; $.each(this._panels, function() { if ( this.getDisplayed() ) { aDisplayed.push(this.getId()); } else { aHidden.push(this.getId()); } }); var aConfig = []; aConfig = aConfig.concat(aDisplayed); if ( aHidden.length ) aConfig = aConfig.concat(['h'], aHidden); return aConfig;};MfcSidebar.prototype.setPanelConfig = function(sPanelConfig) { if ( typeof(sPanelConfig) !== 'string' || ! sPanelConfig ) return; var bSetDisplayedTo = true; var nNewOrder = 0; var self = this; $.each(sPanelConfig.split(','), function() { if ( this == 'd' ) { bSetDisplayedTo = true; return; } else if ( this == 'h' ) { bSetDisplayedTo = false; return; } var oPanel = self.getPanelById(this); if ( typeof(oPanel) !== 'object' ) return; nNewOrder++;
 oPanel.setOrder(nNewOrder); oPanel.setDisplayed(bSetDisplayedTo); }); this.movePanelsToOrder();};MfcSidebar.prototype.fireEvent = function(sEvent) { if ( typeof(this.hOptions.hEvents) !== 'object' || typeof(this.hOptions.hEvents[sEvent]) !== 'function' ) return; this.hOptions.hEvents[sEvent].apply(null, Array.prototype.slice.call(arguments, 1));};MfcSidebar.prototype.updateCustomizeLink = function() { var el = this.$toggleCustomizationLink; if ( this.bShowingCustomization ) { el.data('mfc-default', el.html() ); el.html(el.data('mfc-on') ); } else { el.html(el.data('mfc-default') ); }};MfcSidebar.prototype.savePanelOrder = function() { var aNewOrder = []; var nNewOrder = 0; var bSetDisplayedTo; var self = this; var aDisplayFunctions = []; var fProcess = function() { nNewOrder++; var nId = this.split('_x_', 1).toString()|0; var oPanel = self.getPanelById(nId); if ( typeof(oPanel) !== 'object' ) return; var bDisplay = bSetDisplayedTo; aDisplayFunctions.push(function() { oPanel.setDisplayed(bDisplay); }); oPanel.setOrder(nNewOrder); };
 bSetDisplayedTo = true; $.each(this.$panelSortableDisplayedList.sortable('toArray'), fProcess); bSetDisplayedTo = false; $.each(this.$panelSortableHiddenList.sortable('toArray'), fProcess); this.movePanelsToOrder(); $.each(aDisplayFuncti); }); this.fireEvent('fSavePanelOrder');};MfcSidebar.prototype.sortPanels = function(hOptions) { hOptions = hOptions || {}; this._panels.sort(function(oX,oY) { var nX, nY; if (hOptions.bByDefault) { nX = oX.getDefaultOrder(); nY = oY.getDefaultOrder(); } else { nX = oX.getOrder(); nY = oY.getOrder(); } if (nX < nY) { return -1; } else if (nX > nY) { return 1; } return 0; });};MfcSidebar.prototype.togglePanelSorter = function(bStatus) { if ( bStatus ) { this.$panelSortableDisplayedList.find('li').remove(); this.$panelSortableHiddenList.find('li').remove(); var self = this; $.each(this._panels, function(nIndex, oPanel) { if ( ! oPanel.getEnabled() ) return;
 var $li = $('<li/>').attr('id', oPanel.getId() + '_x_mfcSidebarPanelSortOrderTmpId'); $li.append($('<div/>', {'class': 'reorder_background'}) ); $title = $('<div/>', {'class': 'reorder_title'}).text(oPanel.getTitle() ); $li.append($title); var sStyle = oPanel.getTitleStyle(); if ( sStyle ) $title.attr('style', sStyle); if ( oPanel.getDisplayed() ){ self.$panelSortableDisplayedList.append($li.prop('outerHTML') ); } else { self.$panelSortableHiddenList.append($li.prop('outerHTML') ); } }); var $displayedEmpty = this.$panelSortableDisplayedList.parent().find('.sidebar_panel_order_ul_empty'); this.$panelSortableDisplayedList.data('mfcOnSortUpdate', function() { if ( self.$panelSortableDisplayedList.find('li').length ) { $displayedEmpty.hide(); } else { $displayedEmpty.show(); } }); this.$panelSortableDisplayedList.data('mfcOnSortUpdate')(); var $hiddenEmpty = this.$panelSortableHiddenList.parent().find('.sidebar_panel_order_ul_empty'); this.$panelSortableHiddenList.data('mfcOnSortUpdate', function() { if ( self.$panelSortableHiddenList.find('li').length ) { $hiddenEmpty.hide(); } else { $hiddenEmpty.show(); } }); this.$panelSortableHiddenList.data('mfcOnSortUpdate')(); var defaultSortableOptions = { 'distance': 0, 'cursor': 'move', 'axis': 'y', 'containment': this.hOptions.hSelectors.sPanelSortableListContainment, 'placeholder': 'ui-sortable-handle sortable_placeholder', 'forcePlaceholderSize': true, 'connectWith': '.sidebar_panel_order_ul', 'create': function(e, ui){
 var $el = $(this); setTim); }, 0); }, 'start': function(e, ui){ self._sortingSaved = false; ui.item.addClass('sidebar_panel_li_dragging'); ui.placeholder.height(ui.item.height()); ui.placeholder.width(ui.item.width()); }, 'st); }, 'update': function() { $(this).data('mfcOnSortUpdate')(); if ( ! self._sortingSaved ) { self.savePanelOrder(); self._sortingSaved = true; } var $el = $(this); var nHeight = $el.height(); if ( parseInt($el.css('min-height'), 10) < nHeight ) $el.css('min-height', nHeight); } }; this.$panelSortableDisplayedList.sortable(defaultSortableOptions).disableSelection(); this.$panelSortableHiddenList.sortable(defaultSortableOptions).disableSelection(); } else { this.$panelSortableDisplayedList.sortable('destroy').css('min-height', ''); this.$panelSortableHiddenList.sortable('destroy').css('min-height', ''); }};MfcSidebar.prototype.resetToDefaults = function() { $.each(this._panels, function() { this.setDisplayed(this.getDefaultDisplayed() ); }); this.movePanelsToOrder({ hSortOptions: { bByDefault: true } }); this.togglePanelSorter(false);
 this.togglePanelSorter(true); this.fireEvent('fSavePanelOrder'); this.fireEvent('fResetToDefaults'); var $done = $('<span class=sidebar_reset_done>Done</span>'); this.$resetToDefaultsLink.replaceWith($done); var self = this; setTim); }, 3000);};MfcSidebar.prototype.getPanelTitle = function(oRow) { var sTitle, $row = $(oRow); if ( typeof(this.hOptions.fGetPanelTitle) === 'function' ) sTitle = this.hOptions.fGetPanelTitle($row); if ( typeof(sTitle) === 'string' && sTitle.length > 1 ) return $.trim(sTitle); return 'N/A';};MfcSidebar.prototype.movePanelsToOrder = function(hOptions) { hOptions = hOptions || {}; this.sortPanels(hOptions.hSortOptions ); var lastVisiblePanel; var self = this; $.each(this._panels, function() { this.$el.removeClass('lastVisiblePanel'); self.$sidebar.append(this.$el ); if ( this.$el.hasClass('sidebarPanelDisplayed') ) { lastVisiblePanel = this.$el; } }); if ( typeof(lastVisiblePanel) !== 'undefined' ) lastVisiblePanel.addClass('lastVisiblePanel');};MfcSidebar.prototype.updateLastVisib');};MfcSidebar.prototype.addPanel = function(oPanel, hOptions) { hOptions = hOptions || {}; if ( typeof(oPanel) !== 'object' ) return; oPanel.initialize(); this._panels.push(oPanel); this._panelsById[ 'id' + oPanel.getId() ] = oPanel; this._panelsByName[ oPanel.getName() ] = oPanel;};MfcSidebar.prototype.getPanelBy]; };MfcSidebar.prototype.getPanelByNa ];};MfcSidebar.prototype._findMainElements = function() { this.$sidebar = $( this.hOptions.hSelectors.sSidebar ); this.$customizeContainer = $( this.hOptions.hSelectors.sCustomization ); this.$panelSortableDisplayedList = $( this.hOptions.hSelectors.sPanelSortableDisplayedList ); this.$panelSortableHiddenList = $( this.hOptions.hSelectors.sPanelSortableHiddenList ); this.$toggleCustomizationLink = $( this.hOptions.hSelectors.sToggleCustomizationLink ); this.$resetToDefaultsLink = $( this.hOptions.hSelectors.sResetToDefaultsLink );};

// js_build_core: MfcJs/MfcSidebarPanel/MfcSidebarPanel.js
function MfcSidebarPanel(hOptions) { this.hOptions = hOptions || {}; this.bInitialized = false; this.bShowingCustomization = false;}MfcSidebarPanel.prototype.getId = function() { return this.hOptions.nId;};
MfcSidebarPanel.prototype.getName = function() { return this.hOptions.sName;};MfcSidebarPanel.prototype.getTitle = function() { if ( typeof(this.hOptions.fGetPanelTitle) === 'function' ) return this.hOptions.fGetPanelTitle.call(this); return 'Panel #' + this.getId();};MfcSidebarPanel.prototype.setEnabled = function(bEnabled) { this._enabled = bEnabled ? true : false; this.toggleDisplay();};MfcSidebarPanel.prototype.getEnabled = function() { return this._enabled;};MfcSidebarPanel.prototype.toggleDisplay = function() { if ( this.getEnabled() && this.getDisplayed() ) { this.$el.show().removeClass('sidebarPanelHidden').addClass('sidebarPanelDisplayed'); } else { this.$el.hide().removeClass('sidebarPanelDisplayed').addClass('sidebarPanelHidden'); } if ( typeof(this._prevDisplayed) === 'boolean' && this._prevDisplayed !== this._displayed ) this.fireEvent('fDisplayedChange', this._displayed); this._prevDisplayed = this.getDisplayed();};MfcSidebarPanel.prototype.setDisplayed = function(bDisplayed) { this._displayed = bDisplayed ? true : false; this.toggleDisplay();};MfcSidebarPanel.prototype.getTitleClass = function() { return this.hOptions.sTitleClass;};MfcSidebarPanel.prototype.getTitleStyle = function() { return this.hOptions.sTitleStyle;};MfcSidebarPanel.prototype.getOptional = function() { return this._optional;};
MfcSidebarPanel.prototype.setOptionse;};MfcSidebarPanel.prototype.getDisplayed = function() { return this._displayed;};MfcSidebarPanel.prototype.setOrder = function(nOrder) { this._order = nOrder|0;};MfcSidebarPanel.prototype.getOrder = function() { if ( typeof(this._order) === 'number' ) return this._order; return this.getDefaultOrder();};MfcSidebarPanel.prototype.setDefaultOrder = function(nDefaultOrder) { if ( typeof(nDefaultOrder) === 'number' ) this._defaultOrder = nDefaultOrder;};MfcSidebarPanel.prototype.getDefaultOrder = function() { if ( typeof(this._defaultOrder) === 'number' ) return this._defaultOrder; if ( typeof(this.hOptions.nDefaultOrder) === 'number' ) return this.hOptions.nDefaultOrder; return 0;};MfcSidebarPanel.prototype.getDefaultDisplayed = function() { return this._defaultDisplayed;};MfcSidebarPanel.prototype.initialize = function() { if ( this.bInitialized ) return; this.bInitialized = true; if ( this.hOptions.sCloneSelector ) { var $source = $(this.hOptions.sCloneSelector); this.$el = $(this.hOptions.sCloneSelector).clone().prop('id', this.hOptions.sSelector);
 this.$el.css('display','block'); this.$el.addClass(this.hOptions.sName ); var self = this; this.$el.find('[id]').each(function() { var $el = $(this); $el.prop('id', $el.prop('id') + '_' + self.getId()); }); var listGrips = this.$el.find('[name=extras_list_grip]'); if(listGrips[0] ) { listGrip = $(listGrips[0]); listGrip.attr('id', this.hOptions.sName + '_grip'); listGrip.attr('name', this.hOptions.sName + '_grip'); listGrip.css('display','block'); } $source.after(this.$el); var listMinmax = this.$el.find('[name=menu_extras_minimize]'); if(listMinmax[0] ) { listMinmax = $(listMinmax[0]); listMinmax.attr('id', this.hOptions.sName + '_minimize'); listMinmax.attr('name', this.hOptions.sName + '_minimize'); var self = this; listMinmax.c); } ); this.minimize(typeof(Storage) !== 'undefined' && localStorage[ this.hOptions.sName + '_minimize' ] ); } this.fireEvent('fCloneCompleted', this.$el); } this._findMainElements(); this.setEnabled(this.hOptions.bEnabled ); this.setDisplayed(this.hOptions.bDisplayed ); this.setOptional(this.hOptions.bOptional ); this._defaultDisplayed = this.getDisplayed(); this.$el.data('mfcPanelId', this.getId());};MfcSidebarPanel.prototype.minimize = function(bState ) { var $control = $('#' + this.hOptions.sName + '_minimize' );
 if(! $control[0] ) { console.log("Can't find " + '#' + this.hOptions.sName + '_minimize'); return; } if(typeof(bState ) != 'undefined' ) { this.minimized = bState; if(typeof(Storage) !== 'undefined' ) { if(this.minimized ) localStorage[ this.hOptions.sName + '_minimize' ] = this.minimized; else delete localStorage[ this.hOptions.sName + '_minimize' ]; } } $control.attr('src', $control.attr('src').replace(/(minimize|maximize)/, this.minimized ? 'maximize' : 'minimize' ) ); var $content = $('#menu_extras_' + this.getId()); $content.css('display', this.minimized ? 'none':'block' ); var $grip = $('#' + this.hOptions.sName + '_grip'); $grip.css('display', this.minimized ? 'none':'block' ); var $content = $('#menu_extras_selector_' + this.getId()); $content.css('display', this.minimized ? 'none':'block' );};MfcSidebarPanel.prototype.fireEvent = function(sEvent) { if ( typeof(this.hOptions.hEvents) !== 'object' || typeof(this.hOptions.hEvents[sEvent]) !== 'function' ) return; this.hOptions.hEvents[sEvent].apply(null, Array.prototype.slice.call(arguments, 1));};MfcSidebarPanel.prototype._findMainElements = function() { this.$el = this.$el || $( this.hOptions.sSelector );};

// js_build_core: MfcJs/MfcTrendingRooms/MfcTrendingRooms.js
function MfcTrendingRooms(){ var _apiUrl = ( MfcClientRes && MfcClientRes.apiUrl ) || "//api-edge." + document.domain.replace(/.*?(\w+\.\w+)$/,"$1"); var _lookback = 60; var _getCounts_callback; var _debug=0; var _cacheTTL = 30000; this.expireCache = function() { for(var queryString in MfcTrendingRooms.cache ) { if(MfcTrendingRooms.cache[ queryString ].cacheDate && ( Date.now() - MfcTrendingRooms.cache[ queryString ].cacheDate ) > _cacheTTL ) { if(_debug ) console.log('DELETING DEAD CACHE FOR ' + queryString ); delete MfcTrendingRooms.cache[ queryString ]; } } }; this.getCounts = function(options ) { options = options || {}; this.expireCache(); if(options.callback ) _getCounts_callback = options.callback; if(options.cacheTTL ) _cacheTTL = options.cacheTTL; var queryString = ''; for(var sK in options ) { if(sK == 'callback' || sK == 'cacheTTL' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&'; } if(_getCounts_callback && MfcTrendingRooms.cache[ queryString ] ) { if(_debug && MfcTrendingRooms.cache[ queryString ].cacheDate ) console.log('CACHE AGE FOR ' + queryString + ': ' + ( Date.now() - MfcTrendingRooms.cache[ queryString ].cacheDate ) ); if(MfcTrendingRooms.cache[ queryString ].delayedCallbacks ) { if(_debug ) console.log('QUEUEING CALLBACK FOR ' + queryString ); MfcTrendingRooms.cache[ queryString ].delayedCallbacks.push(_getCounts_callback );
 } else { if(_debug ) console.log('CACHED CALLBACK FOR ' + queryString ); _getCounts_callback(MfcTrendingRooms.cache[ queryString ].data ); } return; } else { if(_debug ) console.log('NO CACHE FOR ' + queryString ); MfcTrendingRooms.cache[ queryString ] = { delayedCallbacks: [] }; } _lookback = options.lookback ? options.lookback : _lookback; var self = this; _submitReq = this.createRequestObject(); _submitReq.open('get', _apiUrl + "/trendingRooms?lookback=" + _lookback ); _submitReq.onreadystatechange = function() { self.getCounts_response(options, queryString ) }; _submitReq.send(null); return false; }; this.getCounts_response = function(options, queryString ) { if ( _submitReq.readyState !== 4 ) { return; } var response = JSON.parse(_submitReq.responseText ); if(response.result.order ) { for(var a=0; a < response.result.order.length; a++ ) { response.result.data[ response.result.order[a] ].rank = a; } } if(_debug ) console.log('FRESH CACHEABLE CALLBACK FOR ' + queryString ); MfcTrendingRooms.cache[ queryString ] = MfcTrendingRooms.cache[ queryString ] || {}; MfcTrendingRooms.cache[ queryString ].data = response.result; MfcTrendingRooms.cache[ queryString ].cacheDate = Date.now(); if(MfcTrendingRooms.cache[ queryString ].delayedCallbacks.length > 0 ) { while(MfcTrendingRooms.cache[ queryString ].delayedCallbacks.length > 0 ) { if(_debug ) console.log('QUEUED CALLBACK FOR ' + queryString );
 MfcTrendingRooms.cache[ queryString ].delayedCallbacks.shift()( response.result ); } } delete MfcTrendingRooms.cache[ queryString ].delayedCallbacks; if(response && response.result && _getCounts_callback ) return _getCounts_callback(response.result ); }; this.createRequestObject = function() { var XHR; if(window.navigator.appName.indexOf('Internet Explorer') > -1) { XHR = new ActiveXObject('Microsoft.XMLHTTP'); } else { XHR = new XMLHttpRequest(); XHR.withCredentials = true; } return XHR; };}MfcTrendingRooms.cache={};

// js_build_core: MfcJs/MfcCustomAlerts/MfcCustomAlerts.js
function MfcCustomAlerts(config ){ config = config || {}; var _callback = config.callback || null; var _apiUrl = config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ); var _debug=0; this.token = config.token; this.customAlerts = {}; this.getReqObj = function() { var reqObj; if(window.navigator.appName.indexOf('Internet Explorer') > -1) reqObj = new ActiveXObject('Microsoft.XMLHTTP'); else reqObj = new XMLHttpRequest(); return reqObj; }; var tokenReq = this.getReqObj(); this.get_token = function() { var self = this; tokenReq.open("GET",_apiUrl + '/token' ); tokenReq.withCredentials = true; tokenReq.onreadystatechange = function() { self.get_token_callback(); }; tokenReq.send(); }; this.get_token_callback = function() { if(tokenReq.readyState != 4 ) { return; } var res={}; try { res = JSON.parse(tokenReq.responseText ); } catch(e) { console.log(e); } if(res && res.result ) { this.token = res.result.token; } }; this.get_token(); var getReq = this.getReqObj(); this.get = function()
 { var qs = Math.random(); var self = this; getReq.open("GET",_apiUrl + '/customAlerts?' + qs ); getReq.withCredentials = true; getReq.onreadystatechange = function() { self.get_callback(); }; getReq.send(); }; this.get_callback = function() { if(getReq.readyState != 4 ) { return; } var res={}; try { res = JSON.parse(getReq.responseText ); } catch(e) { console.log(e); } if(res && res.result ) { this.customAlertsList = []; this.customAlerts = {}; for(var a=0; a< res.result.length; a++ ) { this.customAlertsList.push(res.result[a] ); this.customAlerts[ res.result[a].id ] = res.result[a]; } if(config.get_callback ) { config.get_callback(res.result ); } } else if(res && res.err == 0 ) { if(config.get_callback ) { config.get_callback([] ); } } }; var putReq = this.getReqObj(); this.put = function(data ) { this.put_data = data; data.token = this.token; var qs = []; for (var i in data) if (data.hasOwnProperty(i)) qs.push(encodeURIComponent(i) + "=" + encodeURIComponent(data[i])); var self = this; putReq.open("PUT",_apiUrl + '/customAlerts/' + data.id ); putReq.withCredentials = true; putReq.onreadystatechange = function() { self.put_callback(); };
 putReq.setRequestHeader("Content-type","application/x-www-form-urlencoded"); putReq.send(qs.join('&') ); }; this.put_callback = function() { if(putReq.readyState != 4 ) { return; } var res={}; try { res = JSON.parse(putReq.responseText ); } catch(e) { console.log(e); } if(res && res.err == 0 ) { for(var k in this.put_data ) this.customAlerts[ this.put_data.id ][ k ] = this.put_data[ k ]; if(config.put_callback ) { config.put_callback(res.result ); } } }; var postReq = this.getReqObj(); this.post = function(data ) { this.post_data = data; data.token = this.token; var qs = []; for (var i in data) if (data.hasOwnProperty(i)) qs.push(encodeURIComponent(i) + "=" + encodeURIComponent(data[i])); var self = this; postReq.open("POST",_apiUrl + '/customAlerts' ); postReq.withCredentials = true; postReq.onreadystatechange = function() { self.post_callback(); }; postReq.setRequestHeader("Content-type","application/x-www-form-urlencoded"); postReq.send(qs.join('&') ); }; this.post_callback = function() { if(postReq.readyState != 4 ) { return; } var res={}; try { res = JSON.parse(postReq.responseText ); } catch(e) { console.log(e); } if(res && res.err == 0 && res.result ) { this.customAlerts[ res.result ] = {};
 for(var k in this.post_data ) this.customAlerts[ res.result ][ k ] = this.post_data[ k ]; if(config.post_callback ) { config.post_callback(res.result ); } } }; var deleteReq = this.getReqObj(); this.delete_alert = function(id ) { data = {}; data.id = id; data.token = this.token; var qs = []; for (var i in data) if (data.hasOwnProperty(i)) qs.push(encodeURIComponent(i) + "=" + encodeURIComponent(data[i])); var self = this; deleteReq.open("DELETE",_apiUrl + '/customAlerts/' + data.id ); deleteReq.withCredentials = true; deleteReq.onreadystatechange = function() { self.delete_callback(); }; deleteReq.setRequestHeader("Content-type","application/x-www-form-urlencoded"); deleteReq.send(qs.join('&') ); }; this.delete_callback = function() { if(deleteReq.readyState != 4 ) { return; } var res={}; try { res = JSON.parse(deleteReq.responseText ); } catch(e) { console.log(e); } if(res && res.result ) { for(var a = 0; a < this.customAlertsList.length; a++ ) if(this.customAlertsList[a].id == res.result ) this.customAlertsList[a].deleted = true; if(this.customAlerts[ res.result ] ) this.customAlerts[ res.result ].deleted = true; if(config.delete_callback ) { config.delete_callback(res.result ); } } };
 var supplementalReq = this.getReqObj(); this.get_supplemental = function() { var qs = Math.random(); var self = this; supplementalReq.open("GET",_apiUrl + '/customAlerts/supplemental?' + qs ); supplementalReq.withCredentials = true; supplementalReq.onreadystatechange = function() { self.get_supplemental_callback(); }; supplementalReq.send(); }; this.get_supplemental_callback = function() { if(supplementalReq.readyState != 4 ) { return; } var res={}; try { res = JSON.parse(supplementalReq.responseText ); } catch(e) { console.log(e); } if(config.get_supplemental_callback && res && res.result ) { config.get_supplemental_callback(res.result ); } }; var onlineMatchesReq = this.getReqObj(); this.get_onlineMatches = function(data ) { data = data || {}; var qs = []; for (var i in data) if (data.hasOwnProperty(i)) qs.push(encodeURIComponent(i) + "=" + encodeURIComponent(data[i])); var self = this; onlineMatchesReq.open("GET",_apiUrl + '/customAlerts/onlineMatches/' + ( data.id || '' ) + ( qs.length ? ( '?' + qs.join('&') ) : '' ) ); onlineMatchesReq.withCredentials = true; onlineMatchesReq.onreadystatechange = function() { self.get_onlineMatches_callback(); }; onlineMatchesReq.send(); }; this.get_onlineMatches_callback = function() { if(onlineMatchesReq.readyState != 4 ) { return; } var res={}; try { res = JSON.parse(onlineMatchesReq.responseText ); } catch(e) { console.log(e); } if(config.get_onlineMatches_callback && res && res.result ) { config.get_onlineMatches_callback(res.result ); } }; this.get_customAlee; };};
MfcCustomAlerts.optionBits = { 1: 'New Model', 2: 'Keywords', 4: 'Models You May Like', 8: 'Room Count', 16: 'Cam Score Rating', 32: 'Miss MFC Rank', 64: 'Specific Region(s)', 128: 'Notifications', 256: 'Exclusion Keywords'};MfcCustomAlerts.notificationBits = { 1: 'Email', 2: 'MFC Mail', 4: 'Online Notification'};MfcCustomAlerts.continentBits = { 1: 'Africa', 2: 'Asia/Pacific Islands', 4: 'Australia', 8: 'Central/South America', 16: 'Europe/Russia', 32: 'North America', 64: 'United Kingdom', 128: 'Unknown Region'};MfcCustomAlerts.continentProperNames = { 'AF': 'Africa', 'AS': 'Asia/Pacific Islands', 'AU': 'Australia', 'CA': 'Central/South America', 'SA': 'Central/South America', 'EU': 'Europe/Russia', 'NA': 'North America', 'UK': 'United Kingdom', '??': 'an unknown region'};

// js_build_core: MfcJs/MfcDomChallenge/MfcDomChallenge.js
function MfcDomChallenge(options ) { 'use strict'; options = options || {}; this.document = options.document ? options.document : document;
 this.window = options.window ? options.window : window; this.site = ''; if ( typeof options.site === 'string' && options.site.match(/^\w+$/) ) this.site = options.site; this.pid = 0; options.pid = options.pid|0; if ( options.pid > 0 ) this.pid = options.pid; this.callback = typeof options.callback === 'function' ? options.callback : function(){}; this.api_url = ( options.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( ( window.location.protocol === 'https:' ? 'https:' : 'http:') + '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ) + '/dc';  this.ERROR_SUCCESSFUL = 0;  this.ERROR_FETCH_FAILED = 1;  this.ERROR_ANSWER_TIMEOUT = 2; this.start();}MfcDomChallenge.prototype.start = function() { 'use strict'; this.responseObj = { 'err': this.ERROR_FETCH_FAILED, 'start': (new Date()).getTime() }; var url = this.api_url + '?nc=' + Math.random(); if ( this.site ) url += '&site=' + this.site; var that = this; this.request({ url: url, method: 'get', callback: function(statusCode, responseText) { if ( statusCode !== 200 ) { return that.sendResponse(); }
 var response; try { response = JSON.parse(responseText); response = response['result']; } catch (e) {} if ( typeof response !== 'object' || response == null || ! response['data'] ) { return that.sendResponse(); } that.create(response); response = null; } });};MfcDomChallenge.prototype.sendResponse = function(options ) { 'use strict'; this.responseObj['stop'] = (new Date()).getTime(); if ( typeof options === 'object' && options !== null ) { for ( var attr in options ) { if ( options.hasOwnProperty(attr) ) this.responseObj[attr] = options[attr]; } } this.callback(this.responseObj); this.cleanUp();};MfcDomChallenge.prototype.create = function(options ) { 'use strict'; this.iframeEl = this.document.createElement('iframe'); this.iframeEl.width = 1; this.iframeEl.height = 1; this.iframeEl.frameBorder = 0; this.iframeEl.scrolling = "no"; this.iframeEl.style.cssText = "border:0;width:1px;height:1px;visibility:hidden;position:fixed !important;position:absolute;bottom:1px;right:1px;"; this.iframeEl.src= "javascript:'<script>window.onload=function(){document.write(\\'<script>document.domain=\\\"" + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") + "\\\";document.write(parent.bxpvh5cv98r5tszs());<\\\\/script>\\');document.close();};<\/script>'"; var that = this; this.window['bxpvh5cv98r5tszs]; };
 this.window['dqb68njl7r8wz5f2'] = function(a) { clearTimeout(that.timeout); that.sendResponse({ 'err': that.ERROR_SUCCESSFUL, 'a': a, 'time': options['time'], 'key': options['key'], 'cid': options['cid'], 'pid': that.pid, 'site': that.site }); options = null; }; this.timeout = setTimeout(function(){ that.responseObj['err'] = that.ERROR_ANSWER_TIMEOUT; that.cleanUp(); that.sendResponse(); }, 10000); if(this.document.body ) this.document.body.appendChild(this.iframeEl);};MfcDomChallenge.prototype.cleanUp = function() { if ( this.iframeEl ) { try { this.iframeEl.parentNode.removeChild(this.iframeEl); } catch (e) { } this.iframeEl = null; } try { this.window['dqb68njl7r8wz5f2'] = null; delete this.window['dqb68njl7r8wz5f2']; } catch (e) { this.window['dqb68njl7r8wz5f2'] = null; } try { this.window['bxpvh5cv98r5tszs'] = null; delete this.window['bxpvh5cv98r5tszs']; } catch (e) { this.window['bxpvh5cv98r5tszs'] = null; }
};MfcDomChallenge.prototype.request = function(options ) { if ('XDomainRequest' in window && window.XDomainRequest !== null) { var xdr = new XDomainRequest(); var url = options.url; if ( options.data ) { url += '?' + options.data; } xdr.open(options.method, url ); xdr.onlo); }; xdr.onprogress = function() {}; xdr.ontimeout = function() { options.callback(0, ''); }; xdr.onerr); }; xdr.timeout = 15000; setTimeout(function() { xdr.send(); }, 0); return; } var reqObject; if ( window.XMLHttpRequest ) { reqObject = new XMLHttpRequest(); } else { reqObject = new ActiveXObject("Microsoft.XMLHTTP"); } reqObject.open(options.method, options.url ); try{ reqObject.withCredentials = true; } catch (e) {}; 
 reqObject.onreadystatechange = function() { if ( reqObject.readyState !== 4 ) { return; } options.callback(reqObject.status, reqObject.responseText); }; if ( options.method === 'post' ) { reqObject.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); } reqObject.send(options.data || '');};

// js_build_core: MfcJs/MfcActivityLog/MfcActivityLog.js
function MfcActivityLog(options ){ options = options || {}; var _apiUrl = ( MfcClientRes && MfcClientRes.apiUrl ) || "//api-edge." + document.domain.replace(/.*?(\w+\.\w+)$/,"$1"); var _debug=0; var _getRoomLog_callback = options.getRoomLog_callback || function(){}; var _getTippedModels_callback = options.getTippedModels_callback || function(){}; var _getReq; var _clearHistory_callback = options.clearHistory_callback || function(){}; var _clearHistory; this.getTippedModels = function(options ) { options = options || {}; var qs = Object.keys(options).map(function(key) { return key + '=' + options[key]; }).join('&'); var self = this; _getReq = this.createRequestObject(); _getReq.open('get', _apiUrl + "/activityLog/tippedModels?" + qs ); _getReq.onreadystatechange = function() { self.getTippedModels_response(options ) }; _getReq.send(null); return false; }; this.getTippedModels_response = function(options ) { if ( _getReq.readyState !== 4 ) { return; } var response = JSON.parse(_getReq.responseText ); if(response && response.result && _getTippedModels_callback ) return _getTippedModels_callback(response.result ); }; this.getRoomLog = function(options ) { options = options || {}; var qs = Object.keys(options).map(function(key) { return key + '=' + options[key]; }).join('&'); var self = this; _getReq = this.createRequestObject(); _getReq.open('get', _apiUrl + "/activityLog/roomLog?" + qs ); _getReq.onreadystatechange = function() { self.getRoomLog_response(options ) }; _getReq.send(null);
 return false; }; this.getRoomLog_response = function(options ) { if ( _getReq.readyState !== 4 ) { return; } var response = JSON.parse(_getReq.responseText ); if(response && response.result && _getRoomLog_callback ) return _getRoomLog_callback(response.result ); }; this.clearHistory = function(options ) { options = options || {}; var qs = Object.keys(options)]; }).join('&'); var self = this; _deleteReq = this.createRequestObject(); _deleteReq.open('delete', _apiUrl + "/activityLog" ); _deleteReq.onreadystatechange = function() { self.clearHistory_response(options ) }; _deleteReq.send(null); return false; }; this.clearHistory_response = function(options ) { if ( _deleteReq.readyState !== 4 ) { return; } var response = JSON.parse(_deleteReq.responseText ); if(response && response.result && _clearHistory_callback ) return _clearHistory_callback(response.result ); }; this.createRequestObject = function() { var XHR; if(window.navigator.appName.indexOf('Internet Explorer') > -1) { XHR = new ActiveXObject('Microsoft.XMLHTTP'); } else { XHR = new XMLHttpRequest(); XHR.withCredentials = true;
 } return XHR; };}MfcTrendingRooms.cache={};

// js_build_core: MfcJs/MfcCustomFonts/MfcCustomFonts.js
if(! FCS ){ FCS = { FCOPT_BOLD: 1, FCOPT_ITALICS: 2, FCOPT_SMALLCAPS: 16384 };}function MfcCustomFonts(){};MfcCustomFonts.fontStyles = {};MfcCustomFonts.fontStyles[ FCS.FCOPT_BOLD || 1 ] = { description: "Bold", css: "font-weight:bold;" };MfcCustomFonts.fontStyles[ FCS.FCOPT_ITALICS || 2 ] = { description: "Italic", css: "font-style:italic;" };MfcCustomFonts.fontStyles[ FCS.FCOPT_SMALLCAPS || 16384 ] = { description: "Small Caps", css: "font-variant: small-caps;" };MfcCustomFonts.prototype.fonts = { 0: { name: 'Arial', retired: 0 }, 2: { name: 'Comic Sans MS', retired: 0 }, 3: { name: 'Courier New', retired: 0 }, 4: { name: 'Georgia', retired: 0 }, 5: { name: 'Lucida Console, Monaco', retired: 0 }, 6: { name: 'Lucida Sans Unicode', retired: 0 }, 7: { name: 'MS Sans Serif', retired: 0 }, 8: { name: 'Palatino Linotype, Book Antiqua', retired: 0 }, 9: { name: 'Tahoma, Geneva', retired: 0 }, 10: { name: 'Times New Roman', retired: 0 }, 11: { name: 'Helvetica', retired: 0 }, 12: { name: 'Verdana', retired: 0 }, 13: { name: 'Arial Narrow', retired: 0 }, 15: { name: 'Book Antiqua', retired: 1 }, 16: { name: 'Bookman Old Style', retired: 1 }, 17: { name: 'Bradley Hand ITC', retired: 1 }, 18: { name: 'Century Gothic', retired: 0 }, 19: { name: 'Copperplate Gothic Bold', no_bold:1, retired: 0 }, 20: { name: 'Copperplate, Copperplate Gothic Light', retired: 0 }, 21: { name: 'Engravers MT', retired: 1 }, 22: { name: 'Eras Demi ITC', retired: 1 }, 23: { name: 'Eras Light ITC', retired: 1 }, 24: { name: 'Estrangelo Edessa', retired: 1 }, 25: { name: 'Eurostile', retired: 1 }, 26: { name: 'Felix Titling', retired: 1 }, 27: { name: 'Fixedsys', retired: 1 },
 28: { name: 'Franklin Gothic Book', retired: 1 }, 29: { name: 'Franklin Gothic Demi', no_bold:1, retired: 1 }, 30: { name: 'Franklin Gothic Demi Cond', retired: 1 }, 31: { name: 'Franklin Gothic Medium', retired: 1 }, 32: { name: 'Franklin Gothic Medium Cond', retired: 1 }, 33: { name: 'Garamond', retired: 0 }, 35: { name: 'Kristen ITC', retired: 1 }, 36: { name: 'Latha, Mangal', retired: 1 }, 37: { name: 'Lucida Sans', retired: 1 }, 38: { name: 'Lucida Sans Unicode,Lucida Grande', retired: 1 }, 39: { name: 'Maiandra GD', retired: 1 }, 41: { name: 'Microsoft Sans Serif', retired: 0 }, 42: { name: 'Monospace', retired: 0 }, 43: { name: 'Monotype Corsiva', no_bold:1, retired: 1 }, 44: { name: 'MS Reference Sans Serif', retired: 1 }, 45: { name: 'MS Serif,New York', retired: 0 }, 46: { name: 'MV Boli', retired: 0 }, 47: { name: 'OCR A Extended', retired: 1 }, 48: { name: 'Papyrus', retired: 0 }, 49: { name: 'Perpetua', retired: 1 }, 50: { name: 'Raavi', retired: 1 }, 51: { name: 'Rockwell', retired: 1 }, 52: { name: 'Sans-serif', retired: 0 }, 53: { name: 'Serif', retired: 1 }, 54: { name: 'Shruti', retired: 1 }, 55: { name: 'Sydnie', retired: 1 }, 56: { name: 'Sylfaen', retired: 1 }, 57: { name: 'System', retired: 1 }, 58: { name: 'Tempus Sans ITC', retired: 1 }, 60: { name: 'Times', retired: 1 }, 61: { name: 'Trebuchet MS', retired: 0 }, 62: { name: 'Baskerville', retired: 0 }, 63: { name: 'Gabriola', retired: 0 }, 64: { name: 'Segoe Script', retired: 0 }, 65: { name: 'Consolas, Menlo', retired: 0 }, 66: { name: 'Calibri', retired: 0 }, 67: { name: 'Candara', retired: 0 }, 68: { name: 'Brush Script MT', retired: 0 }, 69: { name: 'Cambria', retired: 0 }, 70: { name: 'Corbel', retired: 0 }};MfcCustomFonts.prototype.get_font_color = function(mixed ){ var color; if(typeof(mixed) == 'string' ) color = mixed; else if(mixed['chat_text_color'] ) color = mixed['chat_text_color'];
 else if(mixed.u && mixed.u.chat_color ) color = mixed.u.chat_color; var sTmp=''; if(typeof(color) == 'string' ) { sTmp = color.replace(/[^0-9a-fA-F]/g,""); } return sTmp;};MfcCustomFonts.prototype.lighten_hex = function(sHexColor, fDegree ){ if(typeof(sHexColor) != 'string' || ! sHexColor.match(/(\w\w)(\w\w)(\w\w)/) ) { return ''; } if(! fDegree ) fDegree = 0.95; var RGB = { R: parseInt(RegExp.$1,16), G: parseInt(RegExp.$2,16), B: parseInt(RegExp.$3,16) }; for(var sK in RGB ) { if(fDegree < 0 ) { RGB[sK] = parseInt(RGB[sK] - ( RGB[sK] * Math.abs(fDegree) ) ); } else { RGB[sK] = parseInt(RGB[sK] + ( ( 255 - RGB[sK] ) * fDegree ) ); } if(RGB[sK] > 255 ) { RGB[sK] = 255; } if(RGB[sK] < 0 ) { RGB[sK] = 0; } } return '#' + ("00" + RGB.R.toString(16)).slice(-2) + ("00" + RGB.G.toString(16)).slice(-2) + ("00" + RGB.B.toString(16)).slice(-2);};MfcCustomFonts.prototype.get_font_family = function(mixed ){ if(typeof(mixed ) == 'object' ) { if(typeof(mixed['chat_text_font'] ) != 'undefined' && MfcCustomFonts.prototype.fonts[ mixed['chat_text_font'] ] ) return MfcCustomFonts.prototype.fonts[ mixed['chat_text_font'] ].name; else if(mixed.u && typeof(mixed.u['chat_font'] ) != 'undefined' ) return MfcCustomFonts.prototype.fonts[ mixed.u['chat_font'] ].name; }
 else if(MfcCustomFonts.prototype.fonts[ mixed ] ) { return MfcCustomFonts.prototype.fonts[ mixed ].name; }};MfcCustomFonts.prototype.get_font_weight = function(mixed ){ if(typeof(mixed ) == 'object' ) { if(typeof(mixed['chat_opts'] ) != 'undefined' ) return mixed['chat_opts'] & FCS.FCOPT_BOLD ? 'bold' : 'normal'; else if(mixed.u && typeof(mixed.u['chat_opt'] ) != 'undefined' ) return mixed.u['chat_opt'] & FCS.FCOPT_BOLD ? 'bold' : 'normal'; } else { return mixed & FCS.FCOPT_ITALICS ? 'bold' : 'normal'; }};MfcCustomFonts.prototype.get_font_style = function(mixed ){ if(typeof(mixed ) == 'object' ) { if(typeof(mixed['chat_opts'] ) != 'undefined' ) return mixed['chat_opts'] & FCS.FCOPT_ITALICS ? 'italic' : ''; else if(mixed.u && typeof(mixed.u['chat_opt'] ) != 'undefined' ) return mixed.u['chat_opt'] & FCS.FCOPT_ITALICS ? 'italic' : ''; } else { return mixed & FCS.FCOPT_ITALICS ? 'italic' : ''; }};MfcCustomFonts.prototype.get_font_variant = function(mixed ){ if(typeof(mixed ) == 'object' ) { if(typeof(mixed['chat_opts'] ) != 'undefined' ) return mixed['chat_opts'] & FCS.FCOPT_SMALLCAPS ? 'small-caps' : ''; else if(mixed.u && typeof(mixed.u['chat_opt'] ) != 'undefined' ) return mixed.u['chat_opt'] & FCS.FCOPT_SMALLCAPS ? 'small-caps' : ''; } else { return mixed & FCS.FCOPT_SMALLCAPS ? 'small-caps' : ''; }};MfcCustomFonts.prototype.get_style = function(hUser ){ if(! hUser || ( typeof(hUser['access_level'] ) != 'undefined' && hUser['access_level'] < 2 ) || ( typeof(hUser['lv'] ) != 'undefined' && hUser['lv'] < 2 ) ) { return ''; } var aStyle = new Array(); var sTmp; if(sTmp = MfcCustomFonts.prototype.get_font_family(hUser ) ) aStyle.push("font-family:" + sTmp + ";"); if(sTmp = MfcCustomFonts.prototype.get_font_color(hUser ) ) { aStyle.push("color:#" + sTmp + ";"); } if(sTmp = MfcCustomFonts.prototype.get_font_weight(hUser ) ) aStyle.push("font-weight:" + sTmp + ";"); if(sTmp = MfcCustomFonts.prototype.get_font_style(hUser ) ) aStyle.push("font-style:" + sTmp + ";"); if(sTmp = MfcCustomFonts.prototype.get_font_variant(hUser ) ) aStyle.push("font-variant:" + sTmp + ";"); return aStyle.join('');};

// js_build_core: MfcJs/ParseEmoteInput/ParseEmoteInput.js
try { document.domain = document.domain.replace(/.*?(\w+\.\w+)$/,"$1"); } catch(e) {}function ParseEmoteInput(options ){ ParseEmoteInput.counter = parseInt(ParseEmoteInput.counter ) + 1; this.counter = ParseEmoteInput.counter; ParseEmoteInput.register[ ParseEmoteInput.counter ] = this; this.apiUrl = ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ); this.inlineEmotePreview_req = null; this.oReq = this.createRequestObject();
 this.Reset(); this.nImageRateLimit = 0; this.oImageRateLimit_Timer = null; this.image_url = options && options.image_url || ( g_hPlatform && g_hPlatform.image_url ) || ( 'https://img.mf'+'cimg.com' ); }ParseEmoteInput.register = {};ParseEmoteInput.counter = 0;ParseEmoteInput.prototype.createRequestObject = function(){ var xhr; if(window.navigator.appName.indexOf('Internet Explorer') > -1) { xhr = new ActiveXObject('Microsoft.XMLHTTP'); } else { xhr = new XMLHttpRequest(); xhr.withCredentials = true; } return xhr;};ParseEmoteInput.prototype.Reset = function(){ this.sParsedString = ''; this.sPost = ''; this.aMsg1 = []; this.aMsg2 = []; this.bDone = false; this.callbackFunc = null;};ParseEmoteInput.prototype.Process = function(sInp, fpCallback){ var nFound = 0; this.Reset(); this.callbackFunc = fpCallback; sInp = sInp.replace(/#~[^~]*~#/g,''); sInp = sInp.replace(/"/g,'&quot;'); this.DecodeInput(sInp); for (var nCx = 0; nCx < this.aMsg1.length; nCx++)
 { if(typeof(this.aMsg1[nCx]['val']) == 'string' ) this.aMsg1[nCx]['val'] = this.aMsg1[nCx]['val'].replace("reverse_smilyface","(:"); if (typeof(this.aMsg1[nCx]) == 'object') { this.sPost += "a" + nCx + "=" + encodeURIComponent(this.aMsg1[nCx]['val']) + "&"; var oStandardEmote; if ( ( ( oStandardEmote = this.m_hEmoticonMap[':'+this.aMsg1[nCx]['val'].toLowerCase()]) != null || ( oStandardEmote = this.m_hEmoticonMap[this.aMsg1[nCx]['val'].toLowerCase()]) != null ) && nFound == 0 ) { var sUrl = this.image_url + "files/images/emoticons/" + oStandardEmote['id'] + ".gif"; var obj = {}; obj['txt'] = this.aMsg1[nCx]['val']; obj['url'] = sUrl; obj['code'] = "#~e," + oStandardEmote['id'] + "," + this.aMsg1[nCx]['val'] + "," + oStandardEmote['width'] + "," + oStandardEmote['height'] + "~#"; this.aMsg2.push(obj); this.sParsedString += obj['code']; } else if(this.aMsg1[nCx]['val'].match(/^\w+\.\w{3}$/) ) { var obj = {}; obj['txt'] = this.aMsg1[nCx]['val']; obj['code'] = "#~c," + this.aMsg1[nCx]['val'] + ",www~#"; this.aMsg2.push(obj); this.sParsedString += obj['code']; } else { nFound++; } } else { this.sPost += "t" + nCx + "=" + encodeURIComponent(this.aMsg1[nCx]) + "&"; if (nFound == 0) { this.sParsedString += this.aMsg1[nCx];
 this.aMsg2.push(this.aMsg1[nCx]); } } } if (nFound == 0) { this.bDone = true; if (this.callbackFunc) this.callbackFunc(this.sParsedString, this.aMsg2); } else { this.aMsg2 = []; this.AjaxSend(); } return this.bDone;};ParseEmoteInput.prototype.DecodeInput = function(sVal){ var sBefore = '', sMatch = '', sAfter = ''; sVal = sVal.replace("(:",":reverse_smilyface"); if(! sVal.match(/http[s]?:/) ) { var aEmoteColonExceptions = [ ";)", "8D", "=o/", "8)", "=;", "=]" ]; for(var n=0;n<aEmoteColonExceptions.length;n++ ) sVal = sVal.replace(aEmoteColonExceptions[n], ":" + aEmoteColonExceptions[n]); } var re = []; if ( re = sVal.match(/^(.*?)(http[s]?:\/\/\S+)(.*)$/) ) { sBefore = re[1]; sMatch = re[2]; sAfter = re[3]; } else { sBefore = sVal; }
 this.SplitInput(sBefore); if(sMatch.match(/\.(gif|jpeg|jpg|png)$/i) || sMatch.match(/\.(gif|jpeg|jpg|png)\?\S*$/i) ) { this.aMsg1.push({'val': sMatch}); } else if ( sMatch ) { this.aMsg1.push(sMatch ); } if (sAfter) this.SplitInput(sAfter);};ParseEmoteInput.prototype.SplitInput = function(sVal){ var nPos = 0, nIdx, nLen = sVal.length; var sTmp; while (nPos < nLen) { sTmp = sVal.substring(nPos); if ( ! sTmp.match(/:[\.\w\-\);\(=\?\*]/) ) { this.aMsg1.push(sTmp); nPos = nLen; } else { nIdx = sTmp.indexOf(':'); if (nIdx > 0) this.aMsg1.push(sTmp.substring(0, nIdx)); var nTmpPos = nIdx + 1, nTmpLen = sTmp.length; while (nTmpPos < nTmpLen) {
 var ch = sTmp.charAt(nTmpPos); if (ch == ' ' || ch == '\t' || ch == '\n' || ch == '\r' || ch == ':') break; nTmpPos++; } var nCodeLen = nTmpPos - nIdx; if (nCodeLen > 0) { var sCode = sTmp.substring(nIdx+1, nTmpPos); if (/\D/.test(sCode) == false && (nIdx > 0 && /\D/.test(sTmp.charAt(nIdx - 1)) == false)) this.aMsg1.push(":" + sCode); else this.aMsg1.push({'val': sCode}); } nPos += nIdx + nCodeLen; } }};ParseEmoteInput.prototype.setUrl = function(url){ this.sUrl = url;};ParseEmoteInput.prototype.getUrl = function(sPost ){ sPost = sPost || ''; if (this.sUrl) { return this.sUrl; } var sRequest = ''; if (document.location.protocol == 'file:' || sPost.indexOf('http') > -1 ) { sRequest = "/php/ParseChatStream.php"; } else { sRequest = this.apiUrl + "/parseEmote"; } return sRequest;};ParseEmoteInput.prototype.AjaxSend = function(){
 var sRequest = this.getUrl(this.sPost ) + '?' + this.sPost + '&' + Math.random(); this.oReq.open("get",sRequest); var self = this; this.oReq.onreadystatechange = function() { self.AjaxResponse(); }; this.oReq.send(null);};ParseEmoteInput.prototype.Reset_ImageRateLimit = function(){ this.nImageRateLimit = 0;};ParseEmoteInput.prototype.AjaxResponse = function(){ if (this.oReq.readyState != 4) return; var self = this; this.oImageRateLimit_Timer = setTimeout(function() { self.Reset_ImageRateLimit() }, 60000 ); this.aMsg2 = []; this.sParsedString = ''; try { this.aMsg2 = JSON.parse(this.oReq.responseText); if(this.aMsg2.result ) { this.aMsg2 = this.aMsg2.result; } } catch(e) { this.aMsg2[0] = { err: 1, txt: "error_invalid_image", code: "#~e,1000,error_invalid_image~#" }; } if (this.aMsg2) { for ( var n=0; n < this.aMsg2.length; n++ ) { if (typeof(this.aMsg2[n]) == 'object') { this.nImageRateLimit++; if(this.nImageRateLimit > 9 ) { this.aMsg2[n]['code'] = "#~e,1000,too_many_images_posted_in_a_short_period_of_time~#";
 } else if ( this.aMsg2[n]['err'] ) { if (this.aMsg2[n]['txt'].indexOf("error_") == -1) { this.aMsg2[n]['code'] = this.aMsg2[n]['txt']; } else { this.aMsg2[n]['code'] = "#~e,1000," + this.aMsg2[n]['txt'] + "~#"; } }  this.sParsedString += this.aMsg2[n]['code'] || ''; } else { this.sParsedString += this.aMsg2[n]; } } } else { } this.bDone = true; if (this.callbackFunc) this.callbackFunc(this.sParsedString, this.aMsg2);};ParseEmoteInput.prototype.m_hEmoticonMap = { "(:": { "id":9, "width":18, "height":18 }, "8)": { "id":12, "width":18, "height":18 }, "8d": { "id":5, "width":18, "height":18 }, ":(": { "id":26, "width":18, "height":18 }, ":)": { "id":1, "width":18, "height":18 }, ":*": { "id":64, "width":18, "height":18 }, ":-$": { "id":37, "width":18, "height":18 }, ":-)": { "id":1, "width":18, "height":18 }, ":-*": { "id":64, "width":18, "height":18 },
 ":-d": { "id":6, "width":18, "height":18 }, ":08": { "id":67, "width":20, "height":21 }, ":1": { "id":69, "width":20, "height":20 }, ":1eye": { "id":68, "width":20, "height":24 }, ":2": { "id":70, "width":20, "height":22 }, ":34": { "id":71, "width":30, "height":26 }, ":48": { "id":72, "width":20, "height":21 }, ":49": { "id":73, "width":20, "height":21 }, ":59": { "id":74, "width":28, "height":26 }, ":838261": { "id":75, "width":19, "height":19 }, ":?": { "id":46, "width":18, "height":18 }, ":ablow": { "id":76, "width":30, "height":25 }, ":admin": { "id":77, "width":30, "height":22 }, ":afro": { "id":79, "width":33, "height":31 }, ":afro2": { "id":78, "width":27, "height":27 }, ":agasi": { "id":80, "width":27, "height":22 }, ":aggressive": { "id":81, "width":36, "height":27 }, ":ala": { "id":82, "width":20, "height":22 }, ":alien": { "id":45, "width":18, "height":18 }, ":alien2": { "id":83, "width":26, "height":22 }, ":alucard": { "id":85, "width":38, "height":24 }, ":angel": { "id":86, "width":42, "height":23 }, ":angel_hypocrite": { "id":87, "width":20, "height":25 }, ":angel_innocent": { "id":88, "width":18, "height":22 }, ":angel_not": { "id":89, "width":18, "height":24 }, ":angrier": { "id":90, "width":18, "height":18 }, ":angry": { "id":92, "width":20, "height":20 }, ":angry2": { "id":91, "width":18, "height":18 }, ":angst": { "id":93, "width":16, "height":16 }, ":animals_bunny1": { "id":95, "width":18, "height":24 }, ":animals_bunny2": { "id":96, "width":18, "height":29 }, ":animal_rooster": { "id":94, "width":18, "height":23 }, ":appl": { "id":97, "width":35, "height":31 }, ":arabia": { "id":98, "width":21, "height":28 }, ":argue3": { "id":99, "width":43, "height":18 }, ":arrow": { "id":48, "width":18, "height":18 }, ":arrow_1": { "id":100, "width":20, "height":20 }, ":arrow_2": { "id":101, "width":20, "height":20 }, ":arrow_3": { "id":102, "width":20, "height":20 }, ":arrow_4": { "id":103, "width":20, "height":20 }, ":arrow_5": { "id":104, "width":20, "height":20 }, ":arrow_6": { "id":105, "width":20, "height":20 }, ":badair": { "id":106, "width":48, "height":19 }, ":bag": { "id":107, "width":22, "height":23 }, ":balloon": { "id":108, "width":18, "height":32 }, ":bash": { "id":109, "width":41, "height":28 }, ":basketball": { "id":110, "width":31, "height":20 }, ":batman": { "id":111, "width":20, "height":27 }, ":bb": { "id":112, "width":32, "height":20 }, ":beaver": { "id":41, "width":18, "height":18 },
 ":bee": { "id":113, "width":40, "height":33 }, ":beer": { "id":52, "width":18, "height":18 }, ":biggrin": { "id":115, "width":20, "height":20 }, ":biggrin2": { "id":114, "width":20, "height":20 }, ":biggrinthumb": { "id":116, "width":40, "height":20 }, ":bigsmile": { "id":117, "width":20, "height":20 }, ":bird": { "id":59, "width":18, "height":18 }, ":bleh": { "id":118, "width":18, "height":18 }, ":blink": { "id":31, "width":20, "height":20 }, ":blink2": { "id":119, "width":20, "height":20 }, ":blue_bandana": { "id":120, "width":23, "height":19 }, ":blush": { "id":123, "width":18, "height":18 }, ":blush-anim-cl": { "id":122, "width":20, "height":20 }, ":blush2": { "id":121, "width":20, "height":20 }, ":blushing": { "id":125, "width":18, "height":18 }, ":blushing2": { "id":124, "width":18, "height":18 }, ":boat": { "id":126, "width":26, "height":33 }, ":bomb": { "id":127, "width":23, "height":18 }, ":book": { "id":128, "width":35, "height":20 }, ":bored": { "id":130, "width":15, "height":15 }, ":bored2": { "id":129, "width":20, "height":20 }, ":borg": { "id":131, "width":18, "height":18 }, ":bot": { "id":132, "width":18, "height":18 }, ":boxed": { "id":134, "width":18, "height":18 }, ":boxed2": { "id":133, "width":18, "height":18 }, ":brokeheart": { "id":63, "width":18, "height":18 }, ":busted_blue": { "id":136, "width":18, "height":24 }, ":busted_cop": { "id":137, "width":20, "height":28 }, ":busted_red": { "id":138, "width":18, "height":24 }, ":bye": { "id":142, "width":15, "height":15 }, ":bye2": { "id":140, "width":20, "height":20 }, ":canadian": { "id":143, "width":23, "height":22 }, ":captain": { "id":144, "width":20, "height":25 }, ":cat": { "id":62, "width":18, "height":18 }, ":censored": { "id":146, "width":34, "height":18 }, ":censored2": { "id":145, "width":48, "height":18 }, ":chef": { "id":147, "width":23, "height":28 }, ":chefsp": { "id":148, "width":21, "height":29 }, ":chih": { "id":149, "width":15, "height":15 }, ":chinese": { "id":150, "width":26, "height":20 }, ":chipmunk": { "id":41, "width":18, "height":18 }, ":chris": { "id":151, "width":20, "height":18 }, ":cig": { "id":53, "width":18, "height":18 }, ":cigarette": { "id":53, "width":18, "height":18 }, ":clap_1": { "id":152, "width":31, "height":25 }, ":closedeyes": { "id":154, "width":20, "height":20 }, ":closedeyes2": { "id":153, "width":20, "height":20 }, ":cloud9": { "id":155, "width":25, "height":26 }, ":clover": { "id":156, "width":19, "height":20 }, ":clown": { "id":158, "width":20, "height":20 },
 ":clown2": { "id":157, "width":28, "height":18 }, ":coffee": { "id":54, "width":18, "height":18 }, ":coke": { "id":55, "width":18, "height":18 }, ":cold": { "id":160, "width":26, "height":32 }, ":cold2": { "id":159, "width":25, "height":32 }, ":confused": { "id":162, "width":16, "height":21 }, ":confused_1": { "id":161, "width":18, "height":25 }, ":confuzzled": { "id":163, "width":20, "height":20 }, ":console": { "id":164, "width":46, "height":20 }, ":construction": { "id":165, "width":47, "height":23 }, ":cool": { "id":169, "width":20, "height":20 }, ":cool1": { "id":166, "width":18, "height":18 }, ":cool2": { "id":167, "width":20, "height":20 }, ":cool3": { "id":168, "width":18, "height":18 }, ":coolsmoker": { "id":13, "width":18, "height":18 }, ":cowboy": { "id":170, "width":27, "height":26 }, ":cranky": { "id":171, "width":22, "height":22 }, ":crash": { "id":172, "width":34, "height":28 }, ":cray": { "id":173, "width":31, "height":22 }, ":crazy": { "id":174, "width":20, "height":20 }, ":cry": { "id":26, "width":18, "height":18 }, ":cryin_smilie": { "id":177, "width":20, "height":20 }, ":cryss": { "id":178, "width":24, "height":20 }, ":cry_1": { "id":175, "width":40, "height":18 }, ":cuckoo": { "id":29, "width":26, "height":18 }, ":cupidarrow": { "id":179, "width":31, "height":19 }, ":curlers": { "id":180, "width":26, "height":22 }, ":d": { "id":6, "width":18, "height":18 }, ":dance": { "id":181, "width":32, "height":32 }, ":darthvader": { "id":182, "width":25, "height":26 }, ":death": { "id":183, "width":38, "height":24 }, ":detective": { "id":185, "width":23, "height":25 }, ":detective2": { "id":184, "width":22, "height":22 }, ":devil": { "id":188, "width":18, "height":23 }, ":devil_1": { "id":186, "width":22, "height":25 }, ":devil_2": { "id":187, "width":25, "height":23 }, ":director": { "id":189, "width":41, "height":22 }, ":dirol": { "id":190, "width":21, "height":21 }, ":disguise": { "id":192, "width":18, "height":22 }, ":disguise2": { "id":191, "width":18, "height":18 }, ":disgust": { "id":194, "width":20, "height":20 }, ":disgust1": { "id":193, "width":20, "height":21 }, ":doc": { "id":195, "width":15, "height":23 }, ":dont": { "id":197, "width":28, "height":27 }, ":dontgetit": { "id":196, "width":20, "height":20 }, ":dork": { "id":35, "width":20, "height":20 }, ":doublef": { "id":198, "width":37, "height":15 }, ":dribble": { "id":200, "width":28, "height":28 }, ":drinks_nologo": { "id":201, "width":45, "height":25 }, ":drinks_pepsi": { "id":202, "width":45, "height":25 },
 ":drool": { "id":203, "width":18, "height":25 }, ":dry": { "id":204, "width":20, "height":20 }, ":dr_evil": { "id":199, "width":30, "height":23 }, ":dulya": { "id":205, "width":18, "height":18 }, ":dunno": { "id":206, "width":38, "height":18 }, ":durak": { "id":207, "width":47, "height":20 }, ":eat": { "id":208, "width":47, "height":20 }, ":ee": { "id":209, "width":20, "height":21 }, ":eek": { "id":210, "width":26, "height":24 }, ":eek_yello": { "id":211, "width":20, "height":20 }, ":egg": { "id":212, "width":24, "height":24 }, ":egypt": { "id":213, "width":31, "height":28 }, ":eh": { "id":214, "width":20, "height":20 }, ":elvis": { "id":215, "width":18, "height":22 }, ":embarrassed": { "id":14, "width":18, "height":18 }, ":erm": { "id":24, "width":18, "height":18 }, ":ermm": { "id":216, "width":18, "height":18 }, ":essen": { "id":217, "width":31, "height":26 }, ":euro": { "id":218, "width":28, "height":29 }, ":evil": { "id":222, "width":20, "height":20 }, ":evilguy": { "id":223, "width":18, "height":18 }, ":evil_1": { "id":219, "width":20, "height":20 }, ":evil_3": { "id":220, "width":18, "height":26 }, ":evil_4": { "id":221, "width":20, "height":18 }, ":excl": { "id":225, "width":20, "height":20 }, ":exclamation": { "id":224, "width":20, "height":20 }, ":eye_red": { "id":226, "width":18, "height":18 }, ":fart": { "id":227, "width":18, "height":29 }, ":fartnew": { "id":229, "width":18, "height":29 }, ":fartnew2": { "id":228, "width":46, "height":29 }, ":fear": { "id":232, "width":25, "height":25 }, ":fear2": { "id":231, "width":20, "height":21 }, ":fear_1": { "id":230, "width":18, "height":18 }, ":figa": { "id":233, "width":20, "height":20 }, ":fingal": { "id":234, "width":22, "height":15 }, ":fireman": { "id":236, "width":25, "height":25 }, ":fireman_1": { "id":235, "width":25, "height":25 }, ":flag_austria": { "id":237, "width":45, "height":25 }, ":flag_french": { "id":238, "width":45, "height":25 }, ":flag_germany": { "id":239, "width":45, "height":25 }, ":flag_schweiz": { "id":240, "width":45, "height":25 }, ":flipoff": { "id":59, "width":18, "height":18 }, ":flower": { "id":65, "width":18, "height":18 }, ":flowers": { "id":587, "width":28, "height":18 }, ":flush": { "id":242, "width":24, "height":26 }, ":football": { "id":243, "width":23, "height":28 }, ":footinmouth": { "id":244, "width":21, "height":19 }, ":foyer": { "id":245, "width":19, "height":19 }, ":fredy": { "id":246, "width":34, "height":27 }, ":frown": { "id":247, "width":16, "height":16 },
 ":fruits_apple": { "id":248, "width":18, "height":29 }, ":fruits_cherry": { "id":249, "width":18, "height":19 }, ":fruits_orange": { "id":250, "width":18, "height":18 }, ":frusty": { "id":251, "width":30, "height":17 }, ":fullmop": { "id":252, "width":20, "height":19 }, ":funny": { "id":8, "width":18, "height":18 }, ":furious": { "id":253, "width":18, "height":18 }, ":fuyou_1": { "id":254, "width":25, "height":20 }, ":fuyou_2": { "id":255, "width":25, "height":20 }, ":fyou": { "id":256, "width":25, "height":20 }, ":g": { "id":260, "width":25, "height":23 }, ":geek": { "id":35, "width":20, "height":20 }, ":gent": { "id":258, "width":15, "height":21 }, ":george": { "id":259, "width":18, "height":18 }, ":ghost1": { "id":261, "width":18, "height":21 }, ":ghost2": { "id":262, "width":18, "height":21 }, ":ghostface": { "id":263, "width":20, "height":28 }, ":gigi": { "id":264, "width":15, "height":15 }, ":glare": { "id":265, "width":20, "height":20 }, ":good": { "id":266, "width":26, "height":23 }, ":goss": { "id":267, "width":40, "height":20 }, ":greedy": { "id":268, "width":18, "height":18 }, ":grin": { "id":6, "width":18, "height":18 }, ":gulp": { "id":271, "width":25, "height":17 }, ":gun2": { "id":272, "width":38, "height":18 }, ":gun_guns": { "id":273, "width":48, "height":22 }, ":gun_rifle": { "id":274, "width":49, "height":23 }, ":ha": { "id":325, "width":18, "height":18 }, ":hammer": { "id":276, "width":30, "height":26 }, ":hammer_1": { "id":275, "width":40, "height":21 }, ":happy": { "id":278, "width":20, "height":20 }, ":happybirth": { "id":277, "width":40, "height":28 }, ":harhar": { "id":279, "width":34, "height":26 }, ":hat": { "id":280, "width":26, "height":21 }, ":hb": { "id":281, "width":28, "height":29 }, ":heart": { "id":282, "width":19, "height":19 }, ":hehe": { "id":283, "width":20, "height":20 }, ":hello": { "id":285, "width":18, "height":18 }, ":helpsmilie": { "id":284, "width":35, "height":25 }, ":hi": { "id":285, "width":31, "height":28 }, ":hippi": { "id":286, "width":40, "height":28 }, ":hit": { "id":287, "width":43, "height":22 }, ":hitler": { "id":288, "width":20, "height":20 }, ":hmm": { "id":289, "width":18, "height":18 }, ":holloween": { "id":290, "width":18, "height":18 }, ":horns": { "id":291, "width":33, "height":25 }, ":horny": { "id":27, "width":20, "height":20 }, ":hug": { "id":292, "width":47, "height":18 }, ":huh": { "id":293, "width":20, "height":20 }, ":ibdrool": { "id":294, "width":18, "height":29 },
 ":icecream": { "id":295, "width":22, "height":25 }, ":icon6": { "id":296, "width":19, "height":19 }, ":idea": { "id":298, "width":20, "height":20 }, ":idea_1": { "id":297, "width":22, "height":26 }, ":idiot": { "id":299, "width":20, "height":20 }, ":image": { "id":588, "width":32, "height":32 }, ":info": { "id":300, "width":31, "height":31 }, ":inlove": { "id":43, "width":18, "height":18 }, ":in_love": { "id":301, "width":20, "height":25 }, ":ispug": { "id":302, "width":25, "height":22 }, ":jc": { "id":303, "width":18, "height":18 }, ":jerk": { "id":304, "width":25, "height":20 }, ":jester": { "id":305, "width":33, "height":25 }, ":jockey": { "id":306, "width":20, "height":21 }, ":jumpy": { "id":307, "width":28, "height":28 }, ":kamikaze": { "id":308, "width":24, "height":20 }, ":kar": { "id":309, "width":40, "height":28 }, ":kenshin2": { "id":310, "width":27, "height":26 }, ":kicher": { "id":311, "width":15, "height":15 }, ":kid": { "id":312, "width":20, "height":20 }, ":king": { "id":313, "width":25, "height":27 }, ":kiss": { "id":64, "width":18, "height":18 }, ":kiss1": { "id":314, "width":18, "height":18 }, ":kisss": { "id":315, "width":36, "height":24 }, ":kosoy": { "id":316, "width":15, "height":15 }, ":krider": { "id":317, "width":20, "height":20 }, ":krilin": { "id":318, "width":20, "height":21 }, ":kuss": { "id":319, "width":37, "height":18 }, ":kwasny": { "id":320, "width":18, "height":18 }, ":lac": { "id":321, "width":24, "height":24 }, ":lady": { "id":322, "width":19, "height":25 }, ":lamer": { "id":323, "width":49, "height":24 }, ":laugh": { "id":325, "width":18, "height":18 }, ":laugh_1": { "id":324, "width":20, "height":20 }, ":licklips": { "id":326, "width":25, "height":25 }, ":lips": { "id":327, "width":23, "height":15 }, ":lmao1": { "id":328, "width":16, "height":16 }, ":lock": { "id":329, "width":32, "height":23 }, ":lol": { "id":325, "width":18, "height":18 }, ":lol1": { "id":331, "width":16, "height":16 }, ":lol_1": { "id":330, "width":20, "height":20 }, ":lookaround": { "id":333, "width":20, "height":20 }, ":lu": { "id":334, "width":40, "height":24 }, ":mad": { "id":336, "width":20, "height":20 }, ":mad_2": { "id":335, "width":22, "height":28 }, ":mail1": { "id":337, "width":18, "height":24 }, ":mail2": { "id":338, "width":44, "height":33 }, ":man": { "id":339, "width":19, "height":20 }, ":marinheiro": { "id":340, "width":25, "height":25 }, ":matrix2": { "id":341, "width":18, "height":18 },
 ":megalol": { "id":342, "width":20, "height":20 }, ":mellow": { "id":343, "width":20, "height":20 }, ":mobile": { "id":344, "width":31, "height":24 }, ":mog": { "id":345, "width":33, "height":33 }, ":moptop": { "id":346, "width":20, "height":19 }, ":mug": { "id":52, "width":18, "height":18 }, ":mushy": { "id":348, "width":20, "height":20 }, ":music": { "id":351, "width":22, "height":23 }, ":music_blues": { "id":349, "width":24, "height":25 }, ":music_dj": { "id":350, "width":28, "height":28 }, ":music_walkman": { "id":352, "width":26, "height":24 }, ":music_whistling": { "id":354, "width":35, "height":20 }, ":music_whistling_1": { "id":353, "width":19, "height":18 }, ":nerd": { "id":35, "width":20, "height":20 }, ":new": { "id":360, "width":30, "height":26 }, ":newconfus": { "id":359, "width":18, "height":26 }, ":ninja": { "id":361, "width":20, "height":20 }, ":no": { "id":364, "width":20, "height":20 }, ":noexpression": { "id":363, "width":18, "height":18 }, ":noimageemot": { "id":365, "width":38, "height":18 }, ":nono": { "id":366, "width":23, "height":25 }, ":nosweat": { "id":367, "width":19, "height":18 }, ":notify": { "id":368, "width":20, "height":27 }, ":notworthy": { "id":369, "width":33, "height":25 }, ":novicok": { "id":370, "width":31, "height":31 }, ":no_1": { "id":362, "width":20, "height":20 }, ":nuke": { "id":371, "width":20, "height":20 }, ":o)": { "id":4, "width":18, "height":18 }, ":ohmy": { "id":372, "width":20, "height":20 }, ":ohplease": { "id":10, "width":20, "height":20 }, ":omg": { "id":33, "width":18, "height":18 }, ":online2long": { "id":373, "width":18, "height":18 }, ":osama": { "id":374, "width":18, "height":25 }, ":p": { "id":11, "width":18, "height":18 }, ":paperbag1": { "id":375, "width":20, "height":19 }, ":paperbag3": { "id":376, "width":20, "height":19 }, ":pardon": { "id":377, "width":36, "height":26 }, ":partytime": { "id":378, "width":49, "height":31 }, ":peace": { "id":379, "width":25, "height":21 }, ":pepsi": { "id":56, "width":18, "height":18 }, ":phone": { "id":381, "width":41, "height":28 }, ":phone_1": { "id":380, "width":20, "height":18 }, ":photo": { "id":382, "width":27, "height":21 }, ":pig": { "id":383, "width":18, "height":21 }, ":pilot": { "id":384, "width":35, "height":24 }, ":pimp": { "id":385, "width":22, "height":25 }, ":pinch": { "id":386, "width":18, "height":18 }, ":pipe1": { "id":387, "width":32, "height":20 }, ":pirate": { "id":40, "width":18, "height":18 }, ":pirate2": { "id":388, "width":25, "height":25 },
 ":pissed": { "id":22, "width":20, "height":20 }, ":plane": { "id":390, "width":47, "height":28 }, ":play_ball": { "id":391, "width":46, "height":20 }, ":pleasantry": { "id":392, "width":36, "height":26 }, ":point": { "id":48, "width":18, "height":18 }, ":police": { "id":393, "width":20, "height":22 }, ":poo": { "id":61, "width":18, "height":18 }, ":poop": { "id":61, "width":18, "height":18 }, ":pop": { "id":55, "width":18, "height":18 }, ":potty": { "id":394, "width":24, "height":26 }, ":pray": { "id":395, "width":27, "height":22 }, ":prop": { "id":396, "width":20, "height":25 }, ":puke": { "id":397, "width":20, "height":25 }, ":punch": { "id":398, "width":18, "height":18 }, ":pussy": { "id":62, "width":18, "height":18 }, ":question": { "id":400, "width":19, "height":19 }, ":question1": { "id":399, "width":20, "height":20 }, ":ranting_w": { "id":401, "width":28, "height":24 }, ":rasta": { "id":402, "width":30, "height":27 }, ":redface": { "id":404, "width":16, "height":16 }, ":red_bandana": { "id":403, "width":23, "height":19 }, ":red_indian": { "id":405, "width":24, "height":29 }, ":renske": { "id":406, "width":18, "height":18 }, ":respect": { "id":407, "width":44, "height":22 }, ":respekt": { "id":408, "width":43, "height":18 }, ":retard": { "id":29, "width":26, "height":18 }, ":rev": { "id":409, "width":40, "height":25 }, ":rinoa": { "id":410, "width":45, "height":33 }, ":rip": { "id":411, "width":20, "height":20 }, ":rofl": { "id":412, "width":46, "height":18 }, ":rolleyes": { "id":10, "width":20, "height":20 }, ":rose": { "id":65, "width":18, "height":18 }, ":rotate": { "id":414, "width":15, "height":15 }, ":row": { "id":415, "width":36, "height":15 }, ":rupor": { "id":416, "width":38, "height":18 }, ":sad": { "id":26, "width":18, "height":18 }, ":sadbye": { "id":3, "width":26, "height":18 }, ":saddam": { "id":420, "width":18, "height":25 }, ":sad_1": { "id":417, "width":20, "height":20 }, ":sad_2": { "id":418, "width":43, "height":27 }, ":sad_3": { "id":419, "width":18, "height":18 }, ":samurai": { "id":44, "width":18, "height":18 }, ":santa": { "id":423, "width":20, "height":22 }, ":santa_1": { "id":422, "width":24, "height":27 }, ":schmoll": { "id":424, "width":20, "height":20 }, ":schnauz": { "id":425, "width":20, "height":20 }, ":scooter": { "id":426, "width":40, "height":33 }, ":search": { "id":427, "width":38, "height":25 }, ":shifty": { "id":428, "width":20, "height":20 }, ":shit": { "id":429, "width":16, "height":16 },
 ":shock": { "id":33, "width":18, "height":18 }, ":shocked": { "id":432, "width":18, "height":18 }, ":shocking": { "id":434, "width":18, "height":18 }, ":shock_1": { "id":430, "width":18, "height":19 }, ":shok": { "id":435, "width":20, "height":20 }, ":showoff": { "id":436, "width":40, "height":21 }, ":shrug": { "id":437, "width":32, "height":20 }, ":shuriken": { "id":438, "width":37, "height":24 }, ":shutup": { "id":439, "width":20, "height":20 }, ":sick": { "id":441, "width":20, "height":20 }, ":sick_1": { "id":440, "width":18, "height":18 }, ":slap": { "id":442, "width":49, "height":23 }, ":sleep": { "id":444, "width":20, "height":20 }, ":sleepy": { "id":47, "width":20, "height":20 }, ":sleep_1": { "id":443, "width":38, "height":23 }, ":sly": { "id":446, "width":20, "height":20 }, ":smartass": { "id":447, "width":25, "height":22 }, ":smile": { "id":453, "width":20, "height":20 }, ":smilewink": { "id":454, "width":22, "height":22 }, ":smile_1": { "id":452, "width":18, "height":18 }, ":smilie": { "id":458, "width":25, "height":25 }, ":smilie1": { "id":455, "width":18, "height":18 }, ":smilie3": { "id":456, "width":18, "height":18 }, ":smilie4": { "id":457, "width":18, "height":18 }, ":smilie_osx": { "id":459, "width":17, "height":18 }, ":smilie_palm": { "id":460, "width":12, "height":18 }, ":smilie_tux": { "id":461, "width":15, "height":18 }, ":smilie_xp": { "id":462, "width":18, "height":16 }, ":smoke": { "id":465, "width":46, "height":20 }, ":smoker": { "id":13, "width":18, "height":18 }, ":smoke_1": { "id":464, "width":21, "height":20 }, ":smoking": { "id":13, "width":18, "height":18 }, ":smurf": { "id":466, "width":20, "height":24 }, ":sm_clap": { "id":448, "width":40, "height":27 }, ":sm_crazy": { "id":449, "width":20, "height":27 }, ":sm_fool": { "id":450, "width":29, "height":23 }, ":sm_haha": { "id":451, "width":28, "height":20 }, ":sm_lol": { "id":463, "width":28, "height":23 }, ":sm_victory": { "id":467, "width":28, "height":23 }, ":sm_yahoo": { "id":468, "width":42, "height":27 }, ":sneaktongue": { "id":469, "width":20, "height":20 }, ":sneaky": { "id":470, "width":20, "height":20 }, ":snorkel": { "id":471, "width":18, "height":25 }, ":sombrero2": { "id":472, "width":30, "height":25 }, ":sorry": { "id":473, "width":24, "height":22 }, ":spidy": { "id":474, "width":18, "height":18 }, ":sp_ike": { "id":475, "width":22, "height":22 }, ":sq_yellow_angry": { "id":476, "width":18, "height":18 }, ":sq_yellow_arg": { "id":477, "width":18, "height":18 }, ":sq_yellow_biggrin": { "id":478, "width":18, "height":18 },
 ":sq_yellow_blink": { "id":479, "width":18, "height":18 }, ":sq_yellow_blush": { "id":480, "width":18, "height":18 }, ":sq_yellow_closedeyes": { "id":481, "width":18, "height":18 }, ":sq_yellow_cool": { "id":482, "width":18, "height":18 }, ":sq_yellow_cry": { "id":483, "width":18, "height":18 }, ":sq_yellow_dry": { "id":484, "width":18, "height":18 }, ":sq_yellow_glare": { "id":485, "width":18, "height":18 }, ":sq_yellow_goodmood": { "id":486, "width":18, "height":18 }, ":sq_yellow_happy": { "id":487, "width":18, "height":18 }, ":sq_yellow_huh": { "id":488, "width":18, "height":18 }, ":sq_yellow_laugh": { "id":489, "width":18, "height":18 }, ":sq_yellow_mellow": { "id":490, "width":18, "height":18 }, ":sq_yellow_notti": { "id":491, "width":18, "height":18 }, ":sq_yellow_ohmy": { "id":492, "width":18, "height":18 }, ":sq_yellow_playful": { "id":493, "width":18, "height":18 }, ":sq_yellow_sad": { "id":494, "width":18, "height":18 }, ":sq_yellow_sick": { "id":495, "width":18, "height":18 }, ":sq_yellow_smile": { "id":496, "width":18, "height":18 }, ":sq_yellow_specky": { "id":497, "width":18, "height":18 }, ":sq_yellow_surprise": { "id":498, "width":18, "height":18 }, ":sq_yellow_tongue": { "id":499, "width":18, "height":18 }, ":sq_yellow_unhappy": { "id":500, "width":18, "height":18 }, ":sq_yellow_unsure": { "id":501, "width":18, "height":18 }, ":sq_yellow_wink": { "id":502, "width":18, "height":18 }, ":strongsad": { "id":503, "width":18, "height":18 }, ":suck": { "id":504, "width":18, "height":18 }, ":sumo": { "id":505, "width":30, "height":27 }, ":sun_smiley": { "id":506, "width":31, "height":31 }, ":super": { "id":507, "width":26, "height":28 }, ":superlol": { "id":508, "width":15, "height":15 }, ":surrender": { "id":509, "width":28, "height":20 }, ":suspect": { "id":510, "width":20, "height":20 }, ":sweatdrop": { "id":511, "width":18, "height":18 }, ":td": { "id":51, "width":18, "height":18 }, ":teehee": { "id":512, "width":18, "height":18 }, ":throb": { "id":513, "width":16, "height":14 }, ":thumb": { "id":515, "width":24, "height":17 }, ":thumbdown": { "id":514, "width":29, "height":20 }, ":thumbs-up": { "id":516, "width":30, "height":18 }, ":thumbsdown": { "id":51, "width":18, "height":18 }, ":thumbsup": { "id":518, "width":38, "height":20 }, ":thumbup": { "id":517, "width":25, "height":18 }, ":thumb_yello": { "id":519, "width":27, "height":20 }, ":tired": { "id":47, "width":20, "height":20 }, ":tongue": { "id":523, "width":20, "height":20 }, ":tongue1": { "id":520, "width":18, "height":18 }, ":tongue2": { "id":521, "width":18, "height":18 }, ":tongue5": { "id":522, "width":20, "height":20 }, ":tongue_ss": { "id":524, "width":20, "height":20 }, ":tooth": { "id":525, "width":30, "height":20 },
 ":tounge": { "id":11, "width":18, "height":18 }, ":toxic": { "id":58, "width":18, "height":18 }, ":trumpet": { "id":526, "width":35, "height":18 }, ":tu": { "id":50, "width":18, "height":18 }, ":turned": { "id":527, "width":18, "height":18 }, ":tv": { "id":60, "width":18, "height":18 }, ":um": { "id":24, "width":18, "height":18 }, ":umnik": { "id":528, "width":25, "height":19 }, ":unknw": { "id":529, "width":33, "height":26 }, ":unlock": { "id":530, "width":32, "height":23 }, ":unsure": { "id":531, "width":20, "height":20 }, ":up": { "id":532, "width":15, "height":15 }, ":v": { "id":535, "width":25, "height":23 }, ":vertag": { "id":533, "width":25, "height":26 }, ":verysad": { "id":534, "width":20, "height":20 }, ":w00t": { "id":538, "width":20, "height":21 }, ":w00t1": { "id":536, "width":28, "height":28 }, ":w00t2": { "id":537, "width":28, "height":28 }, ":wacko": { "id":539, "width":20, "height":20 }, ":wallbash": { "id":540, "width":30, "height":23 }, ":wassat": { "id":541, "width":18, "height":18 }, ":watsup": { "id":542, "width":20, "height":21 }, ":wave": { "id":139, "width":26, "height":18 }, ":weep": { "id":543, "width":21, "height":15 }, ":weight_lift": { "id":545, "width":35, "height":21 }, ":weight_lift2": { "id":544, "width":32, "height":18 }, ":whatsthat": { "id":546, "width":20, "height":18 }, ":wheelchair": { "id":547, "width":29, "height":31 }, ":whistle": { "id":28, "width":28, "height":18 }, ":whistlesmile": { "id":548, "width":24, "height":24 }, ":whistling": { "id":28, "width":28, "height":18 }, ":wiggle": { "id":549, "width":32, "height":27 }, ":wince": { "id":30, "width":18, "height":18 }, ":wink": { "id":556, "width":20, "height":20 }, ":wink_1": { "id":550, "width":18, "height":18 }, ":wink_2": { "id":551, "width":18, "height":18 }, ":wink_3": { "id":552, "width":20, "height":20 }, ":wink_5": { "id":553, "width":18, "height":18 }, ":wink_6": { "id":554, "width":18, "height":18 }, ":wink_7": { "id":555, "width":20, "height":20 }, ":wolfwood": { "id":557, "width":31, "height":31 }, ":wolverine": { "id":559, "width":20, "height":20 }, ":wolverine2": { "id":558, "width":26, "height":26 }, ":wounded1": { "id":560, "width":18, "height":18 }, ":wounded2": { "id":561, "width":18, "height":18 }, ":wow": { "id":5, "width":18, "height":18 }, ":wub": { "id":563, "width":22, "height":29 }, ":wub2": { "id":562, "width":22, "height":29 }, ":x": { "id":42, "width":18, "height":18 }, ":xmas": { "id":564, "width":21, "height":23 },
 ":yak": { "id":565, "width":20, "height":20 }, ":yaright": { "id":10, "width":20, "height":20 }, ":yawn": { "id":566, "width":18, "height":18 }, ":yeahright": { "id":567, "width":20, "height":20 }, ":yel": { "id":568, "width":40, "height":24 }, ":yes": { "id":569, "width":20, "height":20 }, ":yikes": { "id":570, "width":32, "height":33 }, ":yinyang": { "id":571, "width":20, "height":20 }, ":ymca": { "id":572, "width":18, "height":18 }, ":yucky": { "id":573, "width":20, "height":20 }, ":yuk1": { "id":574, "width":20, "height":20 }, ":zip": { "id":575, "width":28, "height":28 }, ":zippy": { "id":576, "width":18, "height":18 }, ":zoo_cat": { "id":577, "width":29, "height":25 }, ":zoo_donatello": { "id":578, "width":32, "height":31 }, ":zoo_fox": { "id":583, "width":22, "height":21 }, ":zoo_fox4": { "id":582, "width":22, "height":21 }, ":zoo_fox_1": { "id":579, "width":22, "height":21 }, ":zoo_fox_2": { "id":580, "width":22, "height":21 }, ":zoo_fox_3": { "id":581, "width":22, "height":21 }, ":zoo_homestar": { "id":584, "width":25, "height":24 }, ":zoo_taz": { "id":585, "width":32, "height":32 }, ":zorro": { "id":586, "width":26, "height":22 }, ":_)": { "id":6, "width":18, "height":18 }, ":_d": { "id":6, "width":18, "height":18 }, ":|": { "id":18, "width":18, "height":18 }, ";)": { "id":2, "width":18, "height":18 }, "=;": { "id":27, "width":20, "height":20 }, "=o/": { "id":10, "width":20, "height":20 }, "=]": { "id":34, "width":18, "height":18 }, ":-D": { "id":6, "width":18, "height":18 }, ":D": { "id":6, "width":18, "height":18 }, "8D": { "id":5, "width":18, "height":18 }, ":G": { "id":260, "width":25, "height":23 }, ":_D": { "id":6, "width":18, "height":18 }, ":P": { "id":11, "width":18, "height":18 }};ParseEmoteInput.prototype.inlineEmotePreview = function(hOptions ){ hOptions = hOptions || this.inlineEmotePreview_hOptions || {}; this.inlineEmotePreview_hOptions = hOptions; if(hOptions.callback ) { this.inlineEmotePreview_client_callback = hOptions.callback; } if(hOptions.input ) { this.oTextInput = hOptions.input; } var sText = hOptions.input.value; if(sText && sText.match(/:(\S+)$/) ) { if(! this.inlineEmotePreview_timerPermit ) { var self = this; if(this.inlineEmotePreview_timer ) { clearTimeout(this.inlineEmotePreview_timer); } this.inlineEmotePreview_timer = setTim); }, 700 ); if(this.inlineEmotePreview_timer2 ) { clearTimeout(this.inlineEmotePreview_timer2); } this.inlineEmotePreview_timer2 = setTimeout(function(){ self.inlineEmotePreview_timerPermit = false; }, 5000 ); return; } var hImage; if(hImage = ParseEmoteInput.prototype.m_hEmoticonMap[ ':' + RegExp.$1 ] ) { hImage.url = this.image_url + "files/images/emoticons/" + hImage.id + ".gif"; hImage.shortcut = RegExp.$1; if(this.inlineEmotePreview_client_callback ) { this.inlineEmotePreview_client_callback(hImage ); } } else if(sText.match(/:(\w+)$/) && hOptions.access_level > 1 ) { var url = this.apiUrl + "/user_chat_images/" + RegExp.$1 + "?return_partials=1"; var self = this; this.abortInlineEmotePreviewLookup(); this.inlineEmotePreview_req = new XMLHttpRequest(); this.inlineEmotePreview_req.open('get', url); this.inlineEmotePreview_req.onreadystatechange = function() { self.inlineEmotePreview_callback(); }; this.inlineEmotePreview_req.send(null); } } else if(this.inlineEmotePreview_client_callback ) { this.inlineEmotePreview_timerPermit = false; this.inlineEmotePreview_client_callback(); }};ParseEmoteInput.prototype.abortInlineEmotePreviewLookup = function(){
 if ( this.inlineEmotePreview_req && typeof(this.inlineEmotePreview_req.abort) === 'function' ) { this.inlineEmotePreview_req.onreadystatechange = null; this.inlineEmotePreview_req.abort(); }};ParseEmoteInput.prototype.inlineEmotePreview_callback = function(){ if ( this.inlineEmotePreview_req.readyState !== 4 ) { return; } var oRes = JSON.parse(this.inlineEmotePreview_req.responseText ); if(! oRes || ! oRes['result'] ) { return; } var hImage = oRes['result']; if(hImage['hex_crc32'] || hImage['partials'] ) { if(hImage['hex_crc32'] ) { hImage.url = this.image_url + 'chat_images/u/' + hImage['hex_crc32'].substring(0,2) + '/' + hImage['hex_crc32'] + '.' + hImage['format']; } if(this.inlineEmotePreview_client_callback ) { this.inlineEmotePreview_client_callback(hImage ); } } else if(this.inlineEmotePreview_client_callback ) { this.inlineEmotePreview_client_callback(); }};ParseEmoteInput.prototype.inlineEmotePreview_close = function(oImgData ){ window.halt_global_keyDown = false; this.abortInlineEmotePreviewLookup(); if(this.oTextInput ) { this.oTextInput.removeEventListener('keydown',this.keyHandler_bound); } if(this.oPreviewDiv && this.oPreviewDiv.parentNode ) { this.oPreviewDiv.parentNode.removeChild(this.oPreviewDiv ); }};ParseEmoteInput.prototype.inlineEmotePreview_select = function(sShortcut, sExisting, hOpts )
{ hOpts = hOpts || {}; if(! sExisting ) { oMatch = this.oTextInput.value.match(/:(\w+)\W*$/); sExisting = oMatch[1]; } this.oTextInput.value = this.oTextInput.value.replace(sExisting, sShortcut ) + ( hOpts.no_space ? '' : ' ' ); this.oTextInput.focus(); this.inlineEmotePreview_close(); this.inlineEmotePreview();};ParseEmoteInput.prototype.keyHandler = function(e, caller ){ window.halt_global_keyDown = true; if(e.which == 9 ) { e.preventDefault(); this.inlineEmotePreview_select(this.inlineEmotePreview_selectedShortcut ); } else if(e.which == 13 && this.inlineEmotePreview_arrowKeyWasPressed ) { e.preventDefault(); this.inlineEmotePreview_select(this.inlineEmotePreview_selectedShortcut ); } else if(e.which == 27 ) { this.inlineEmotePreview_close(); } else if(e.which == 39 ) { e.preventDefault(); this.inlineEmotePreview_select(this.inlineEmotePreview_selectedShortcut, null, { 'no_space': true }); } else if(e.which == 38 ) { e.preventDefault(); this.inlineEmotePreview_selected = this.inlineEmotePreview_selected > 0 ? this.inlineEmotePreview_selected-1 : 0; this.inlineEmotePreview_setSelected(this.inlineEmotePreview_selected ); this.inlineEmotePreview_arrowKeyWasPressed = true;
 } else if(e.which == 40 ) { e.preventDefault(); this.inlineEmotePreview_selected = this.inlineEmotePreview_selected < ( this.inlineEmotePreview_listLength - 1 ) ? this.inlineEmotePreview_selected+1 : ( this.inlineEmotePreview_listLength - 1 ); this.inlineEmotePreview_setSelected(this.inlineEmotePreview_selected ); this.inlineEmotePreview_arrowKeyWasPressed = true; } else { this.inlineEmotePreview_close(); }};ParseEmoteInput.prototype.inlineEmotePreview_setSelected = function(selected ){ var els = document.getElementsByClassName('inlineEmotePreview_item'); this.inlineEmotePreview_selectedShortcut = this.inlineEmotePreview_list[ selected ]; for(var a=0; a < els.length; a++ ) { if(a == selected ) els[a].classList.add('selected'); else els[a].classList.remove('selected'); } this.oPreviewDiv.scrollTop = els[ selected ].offsetTop - ( this.oPreviewDiv.offsetHeight / 2 ) + 20;};ParseEmoteInput.prototype.inlineEmotePreview_renderPreviewImage = function(oImgData ){ var oPreviewDiv = this.oPreviewDiv; if(this.inlineEmotePreview_inputString == this.oTextInput.value ) { return; } this.inlineEmotePreview_inputString = this.oTextInput.value; if(! oImgData || ( ! oImgData.url && ! oImgData.partials ) ) { this.inlineEmotePreview_close(); return; } this.inlineEmotePreview_list = []; this.inlineEmotePreview_selected = 0;
 this.inlineEmotePreview_arrowKeyWasPressed = false; var self = this; if(! this.keyHandler_bound ) { this.keyHandler_bound = function(e) { self.keyHandler(e); }; } this.oTextInput.removeEventListener('keydown',this.keyHandler_bound); this.oTextInput.addEventListener('keydown',this.keyHandler_bound); this.oImgData = oImgData; if(! oPreviewDiv ) { oPreviewDiv = document.createElement('div'); this.oPreviewDiv = oPreviewDiv; } var previews = []; if(oImgData.url ) { this.inlineEmotePreview_list.push(oImgData.shortcut ); previews.push("<div class=\"inlineEmotePreview_item primary\"><img src=" + oImgData.url + " > :" + oImgData.shortcut + "</div>"); } if(oImgData.partials ) { for(var a=0; a < oImgData.partials.length; a++ ) { var hPartial = oImgData.partials[a]; this.inlineEmotePreview_list.push(hPartial.shortcut ); var url = this.image_url + 'chat_images/u/' + hPartial['hex_crc32'].substring(0,2) + '/' + hPartial['hex_crc32'] + '.' + hPartial['format']; previews.push("<div class=\"inlineEmotePreview_item partial\"" + "onClick=\" ParseEmoteInput.register["+this.counter+"].inlineEmotePreview_select('" + hPartial.shortcut + "','" + ( oImgData.shortcut || '' ) + "'); \">" + "<img src=" + url + " >" + "<div style=\"display:inline-block;\">" + ":" + hPartial.shortcut + "</div>" + "</div>" ); } } if(this.inlineEmotePreview_list[0] ) { this.inlineEmotePreview_selectedShortcut = this.inlineEmotePreview_list[0]; } var html = "<div>" + previews.join('') + "</div>"; this.inlineEmotePreview_listLength = this.inlineEmotePreview_list.length;
 oPreviewDiv.className = 'inlineEmotePreview_div'; oPreviewDiv.style.position = 'absolute'; oPreviewDiv.innerHTML = html; this.oTextInput.parentNode.appendChild(oPreviewDiv ); this.inlineEmotePreview_setSelected(0);};

// js_build_core: MfcJs/ParseEmoteOutput/ParseEmoteOutput.js
try { document.domain = document.domain.replace(/.*?(\w+\.\w+)$/,"$1"); } catch(e) {} function ParseEmoteOutput(){};ParseEmoteOutput.prototype.Parse = function(sMessage, hParams ){ hParams = hParams || {}; var image_url = hParams && hParams.image_url || ( typeof(g_hPlatform)=='object' && g_hPlatform.image_url ) || ( 'https://img.mf'+'cimg.com/' ); var nParseLimit = 0; var bBasicEmotesOnly = hParams['basic_emotes_only'] ? true : false; if(typeof(hParams['access_level'] ) == 'undefined' ) hParams['access_level'] = 2; var bAllowUserImages = true; if (typeof(hParams['allow_user_images']) != 'undefined' && hParams['allow_user_images'] == 0) bAllowUserImages = false;
 var bUseSmartImgTags = false; if (typeof(hParams['use_smart_image_tags']) != 'undefined' ) bUseSmartImgTags = hParams['use_smart_image_tags'] ? true : false; oImgRegExPattern = /#~(e|c|u|ue),(\w+)(\.?)(jpeg|jpg|gif|png)?,([\w\-\:\);\(\]\=\$\?\*]{0,48}),?(\d*),?(\d*)~#/; oImgRegExPattern = /#~(c),(\w+)(\.)(\w{3})~#/; var aRegExPatterns = [ /#~(e|c|u|ue),(\w+)(\.?)(jpeg|jpg|gif|png)?,([\w\-\:\);\(\]\=\$\?\*]{0,48}),?(\d*),?(\d*)~#/, /#~(c),(\w+)(\.)(\w{3})~#/ ]; var aData = ['']; var nCx = 1; for(var a=0; a<aRegExPatterns.length; a++ ) { var oImgRegExPattern = aRegExPatterns[a]; var re = []; while(( re = sMessage.match(oImgRegExPattern ) ) && nParseLimit < 10 ) { var sType = re[1] || ''; var sFileCode = re[2] || ''; var sDot = re[3] || ''; var sFileExtension = re[4] || ''; var sShortcut = re[5] || ''; var nWidth = re[6] || ''; var nHeight = re[7] || ''; var nOriginalSize = { width: nWidth, height: nHeight }; var sImg = sFileCode + sDot + sFileExtension; var sMediumImg = sFileCode + sDot + '200x.' + sFileExtension; var sSmallImg = sFileCode + sDot + 'x50.' + sFileExtension; var sTypeDir = sType; var bError=false; if(( nWidth > 0 && ! ( nHeight > 0 ) ) || ( nHeight > 0 && ! ( nWidth > 0 ) ) ) { nWidth = null; nHeight = null; } if(sType == 'e' ) { sImg += '.gif'; }
 else if(sType == 'ue' ) { sTypeDir = 'u'; } var sImgPath = ''; sImgPath = image_url + "chat_images/" + sTypeDir + "/"; if(sType != 'e' ) { sImgPath += sImg.substring(0,2) + "/"; } var sSrc = ''; var sExtra = ''; var sTitle = sType != 'c' ? ( ':' + sShortcut ) : ''; var bDownSize = false; if ( bAllowUserImages == false || ( bBasicEmotesOnly && sType != 'e' ) ) { sSrc = image_url + "chat_images/e/588.gif"; sExtra = " data-src=\"" + sImgPath + sSmallImg + "\" " + " data-large-img=\"" + sImgPath + sImg + "\" " + " class=\"chat_image_placeholder\" "; nWidth = null; nHeight = null; } else if ( sType == 'e' || ( sType == 'ue' && hParams['access_level'] > 0 ) ) { sSrc = sImgPath + sImg; if(nWidth > 1024 || nHeight > 1024 ) { bDownSize = true; } } else if(hParams['access_level'] > 1 || hParams['offline'] || hParams['access_level'] == -1 ) { sSrc = sImgPath + sSmallImg; bDownSize = true; } else { sMessage = sMessage.replace(oImgRegExPattern,"<i"+"mg src=\"" + image_url + "chat_images/e/1000.gif\" title='premium image'>"); sTitle = 'premium image'; } var sOnClickCode; if(sType == 'e' ) { sOnClickCode = ''; } else if(hParams['onclick_code'] ) { sOnClickCode = hParams['onclick_code']; sOnClickCode = sOnClickCode.replace(/%image%/, sImgPath + sImg );
 sOnClickCode = sOnClickCode.replace(/%shortcut%/, sTitle ); } else { sOnClickCode = " ParseEmoteOutput.prototype.Popup('" + sImgPath + sImg + "'); "; } if(( sType == 'e' || sType == 'ue' ) && ( nWidth > 100 || nHeight > 100 ) ) { bDownSize = true; } if(bDownSize && ( nWidth || nHeight ) ) { var size = this.determineThumbnailSize('x50',nWidth,nHeight); nWidth = size['width']; nHeight = size['height']; } if(nWidth == 1 && nHeight == 1 ) { nHeight = false; nWidth = false; } var nThumbnailSize = { width: nWidth, height: nHeight }; if(hParams.output_type == 'array' ) { aData.push({ src: sSrc, thumbnail_src: { small: sSmallImg, medium: sMediumImg }, size: nOriginalSize, thumbnail_size: nThumbnailSize, shortcut: sShortcut, type: sType }); sMessage = sMessage.replace(oImgRegExPattern,":" + nCx + ":"); } else { sMessage = sMessage.replace(oImgRegExPattern, "<" + ( bUseSmartImgTags ? 'smart':'' ) + "i"+"mg src=\"" + sSrc + "\" "
 + ( nWidth ? " width=" + nWidth : '' ) + ( nHeight ? " height=" + nHeight : '' ) + ( hParams['onload_code'] ? " style='margin-top:30px;' onLoad=\"this.style.marginTop='0px';" + hParams['onload_code'] + "\"" : '' ) + ( sOnClickCode ? " onClick=\"" + sOnClickCode + "\"" : '' ) + ( sTitle ? " title='" + sTitle.replace(/'/,'') + "'" : '' ) + sExtra + " onMouseover=\"if(this.height >= 50 ){ this.style.cursor='pointer'; }\">" ); } nParseLimit++; nCx++; } } if(hParams.output_type == 'array' ) { aData[0] = sMessage; return aData; } else { return sMessage; }};ParseEmoteOutput.prototype.ProcessCard = function(sMessage ){ var aMatches; var hParams = {}; var hTpl = {}; if(aMatches = sMessage.match(/(https:\/\/[\w\.]+\/[^\s"']*?).MFCjson=([^\s"']+)/) ) { hParams = JSON.parse(decodeURIComponent(aMatches[2] ) ) || {}; hParams.url = aMatches[1]; } if(hParams.url && ( aMatches = sMessage.match(/(https:\/\/share\.myfreecams\.com\/)(\w+)(\/\w+)/) ) ) { hParams.url = aMatches[1] + aMatches[2] + aMatches[3]; hParams.type = aMatches[2]; hTpl = this.MfcShare_CardTpl(hParams ); sMessage = sMessage.replace(/(https:\/\/share\.myfreecams\.com\/[^\?]+)\?([-a-zA-Z0-9@:%_\+.~#?&//=]+)/g,'$1');
 } else if(hParams.url )
 { aDomain = hParams.url.match(/(\w+\.\w{2,3})\//);
 hParams.domain = aDomain[1]; hTpl = this.CardTpl(hParams ); sMessage = sMessage.replace(/(https:\/\/[\w\.]+\/[^\s"']*?).MFC=1&[-a-zA-Z0-9@:%_\+.~#?&//=]+/g,'$1');
 } if(hTpl.html && typeof(hTpl.params) == 'object' ) { for(var key in hTpl.params ) { if(typeof(hTpl.params[key] ) != 'string' && typeof(hTpl.params[key] ) != 'number' ) { continue; } var regex = new RegExp("{{" + key + "}}",'g'); hTpl.html = hTpl.html.replace(regex,hTpl.params[key]); } hTpl.html = hTpl.html.replace(/{{\s*\w+\s*}}/g,''); } return sMessage + ( hTpl.html || '' );};ParseEmoteOutput.prototype.CardTpl = function(hParams ){ var hTpl={}; hTpl.params = hParams; hTpl.html = " <div class=TwitterCard_inChat> <table border=0> <tr> <td class=TwitterCard_inChat_img_td> <a href=\"{{url}}\" target=_blank> <img onError=\"this.style.display='none';\" class=TwitterCard_inChat_img src=\"{{image}}\"> </a> </td> <td class=TwitterCard_inChat_content> <a href=\"{{url}}\" target=_blank> <span class=TwitterCard_inChat_title> {{title}} </span> </a> <a class=TwitterCard_inChat_domain href=\"{{url}}\"> {{domain}} </a> </td> </tr> </table> </div> "; return hTpl;};ParseEmoteOutput.prototype.MfcShare_CardTpl = function(hParams )
{ hParams = hParams || {}; hParams.title = hParams.ti; hParams.token_amount = hParams.to; hParams.username = hParams.un; hParams.user_id = hParams.ui; hParams.mfcshare = 1; var ShareTypeMap = { 'a': 'Album', 's': 'Item', 'c': 'Collection', 'g': 'Goal', 'm': 'Club' }; var url_domain = document.domain.replace(/.*?(\w+\.\w+)$/,"$1"); hParams.user_name = hParams.user_name && hParams.user_name.replace(/[^\w]/g,''); hParams.user_name_url = hParams.user_name && "https://share." + url_domain + "/" + hParams.user_name.replace(/[^\w]/g,''); hParams.type = ShareTypeMap[hParams.type] || ''; hParams.title = hParams.title && hParams.title.replace(/[<]/g,'') || ''; hParams.image = hParams.image && hParams.image.replace(/"/g,'').replace(/\?.*/,'') || ''; if(hParams.token_amount ) { hParams.token_amount = ' / ' + hParams.token_amount.replace(/[<]/g,'') + ' Tokens'; } var image_url = hParams && hParams.image_url || ( g_hPlatform && g_hPlatform.image_url ) || ( 'https://img.mf'+'cimg.com' ); hParams.logo = image_url + "files/images/misc/MFCShare.svg"; var hTpl={}; hTpl.params = hParams; hTpl.html = " <div class=MFCShare_inChat> <table border=0> <tr> <td class=> <a href=\"{{url}}\" target=_blank> <img onError=\"this.style.display='none';\" class=MFCShare_inChat_img src=\"{{image}}\"> </a> </td> <td class=MFCShare_inChat_content> <a href=\"{{user_name_url}}\" target=_blank> <div class=MFCShare_inChat_user_name> {{user_name}} on </div> </a> <a href=\"{{url}}\" target=_blank> <span class=MFCShare_inChat_type> {{type}} </span> </a>\
 <a href=\"{{url}}\" target=_blank> <span class=MFCShare_inChat_title> {{title}} </span> </a> <a href=\"{{url}}\" target=_blank> <span class=MFCShare_inChat_token_amount> {{token_amount}} </span> </a> <a href=https://share." + url_domain + "/> <img class=MFCShare_inChat_logo onError=\"this.style.display='none';\" src=\"{{logo}}\" target=_blank> </a> </td> </tr> </table> </div> "; return hTpl;};ParseEmoteOutput.prototype.ParseQueryString = function(queryString ){ if(typeof(queryString) != 'string' ) { return queryString; } var query = {}; var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&'); for (var i = 0; i < pairs.length; i++) { var pair = pairs[i].split('='); try { query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || ''); } catch(e) { console.log(e ); } } return query;};ParseEmoteOutput.prototype.Popup = function(sImgUrl ){ var oWin = window.open('blank.html', '_blank', 'status=0,toolbar=0,height=10,width=10' ); oWin.document.write(" <ht"+"ml> <bo"+"dy style=margin:0px;> <im"+"g src=" + sImgUrl + " onLoad=\" window.resizeTo(this.width,this.height+25); \" onClick=\" window.close(); \" > </bo"+"dy> </ht"+"ml> ");};ParseEmoteOutput.prototype.image_sizes = [
 { 'width': 0,'height': 0,'file': '' }, { 'width': 500, 'height': 50,'file': 'x50' }, { 'width': 300, 'height': 0,'file': '200x' }, { 'width': 0,'height': 120, 'file': 'x120' } ];ParseEmoteOutput.prototype.determineThumbnailSize = function(thumbnail_code, image_width, image_height ){ var rules; for(var a=0; a < ParseEmoteOutput.prototype.image_sizes.length; a++ ) { var prof = ParseEmoteOutput.prototype.image_sizes[a]; if(prof['file'] == thumbnail_code ) { rules = prof; } } if(! rules ) { return { 'width': image_width, 'height': image_height }; } if ( rules['height'] && image_height > rules['height'] ) { var changeRatio = rules['height'] / image_height; image_height = rules['height']; image_width = Math.ceil(changeRatio * image_width ); } if ( rules['width'] && image_width > rules['width'] ) { var changeRatio = rules['width'] / image_width; image_width = rules['width']; image_height = Math.ceil(changeRatio * image_height ); } if(! image_width ) { image_width = 1; } if(! image_height ) { image_height = 1; } return { 'width': image_width, 'height': image_height };};

// js_build_core: MfcJs/MfcSocialMedia/MfcSocialMedia.js
function MfcSocialMedia(config){ config = config || {}; var _callback = config.callback || null; var _apiUrl = ( config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ) + '/social_media'; var _services = config.services ? config.services : [ { 'name': 'twitter', 'key': 'twitter_username', 'href': 'https://twitter.com/%%USERNAME%%' }, { 'name': 'instagram', 'key': 'instagram_username', 'href': 'https://www.instagram.com/%%USERNAME%%/' } ]; var _debug=0; var _cacheTTL = 600 * 1000; var reqObj; if(window.navigator.appName.indexOf('Internet Explorer') > -1) reqObj = new ActiveXObject('Microsoft.XMLHTTP'); else reqObj = new XMLHttpRequest(); this.processResults = function(res ) { var parsed = {}; if ( ! res || ! res.result ) return parsed; for(var i = 0; i < _services.length; i++) { var username; if(! (username = res.result[ _services[i].key ]) ) { continue; } parsed[_services[i].name ] = {
 'name': _services[i].name, 'key': _services[i].key, 'url': _services[i].href.replace(/%%USERNAME%%/g, encodeURI(username)), 'raw_username': username, 'username': username.replace(/</g, "&lt;").replace(/>/g, "&gt;") } } if ( res.result['mfc_share'] && res.result['mfc_share']['user_id']) { var _mfc_share_data = res.result['mfc_share']; parsed['mfc_share'] = { 'album_count' : _mfc_share_data['album_count'], 'album_last_created' : _mfc_share_data['album_last_created_at'] }; } if(_debug ) { console.log(parsed); } return parsed; }; this.expireCache = function() { for(var cacheKey in MfcSocialMedia.cache ) { if ( _debug ) console.log("Cache age: " + ( Date.now() - MfcSocialMedia.cache[ cacheKey ].cacheDate ) + ", cache TTL: " + _cacheTTL ); if(MfcSocialMedia.cache[ cacheKey ].cacheDate && ( Date.now() - MfcSocialMedia.cache[ cacheKey ].cacheDate ) > _cacheTTL ) { if(_debug ) console.log('DELETING DEAD CACHE FOR ' + cacheKey ); delete MfcSocialMedia.cache[ cacheKey ]; } } }; this.getSocialMedia = function(options) { options = options || {}; var url = _apiUrl + '/' + options.user_id; this.expireCache(); if(! options.user_id ) { if(_debug ) console.log('CALLED WITH INVALID options.user_id: ' + options.user_id ); return; } var queryString = ''; for(var sK in options )
 { if(sK == 'callback' || sK == 'user_id' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&'; } var cacheKey = options.user_id + '?' + queryString; if(_callback && MfcSocialMedia.cache[ cacheKey ] ) { if(_debug && MfcSocialMedia.cache[ cacheKey ].cacheDate ) console.log('CACHE AGE FOR ' + cacheKey + ': ' + ( Date.now() - MfcSocialMedia.cache[ cacheKey ].cacheDate ) ); if(MfcSocialMedia.cache[ cacheKey ].delayedCallbacks ) { if(_debug ) console.log('QUEUEING CALLBACK FOR ' + cacheKey ); MfcSocialMedia.cache[ cacheKey ].delayedCallbacks.push(_callback ); } else { if(_debug ) console.log('CACHED CALLBACK FOR ' + cacheKey ); _callback(MfcSocialMedia.cache[ cacheKey ].data ); } return; } else { if(_debug ) console.log('NO CACHE FOR ' + cacheKey ); MfcSocialMedia.cache[ cacheKey ] = { delayedCallbacks: [] }; } try { if(_debug ) console.log('FRESH CALL FOR ' + cacheKey ); var self = this; reqObj.open("GET", url + '?' + queryString + '&no_cache=' + Math.random() ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.getSocialMedia_Response(options, cacheKey ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(); } catch(e) { console.log(e); } }; this.getSocialMedia_Response = function(options, cacheKey ) { if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText );
 var parsedResults = this.processResults(res); if(_debug ) console.log('FRESH CACHEABLE CALLBACK FOR ' + cacheKey ); MfcSocialMedia.cache[ cacheKey ] = MfcSocialMedia.cache[ cacheKey ] || {}; MfcSocialMedia.cache[ cacheKey ].data = parsedResults; MfcSocialMedia.cache[ cacheKey ].cacheDate = Date.now(); if(MfcSocialMedia.cache[ cacheKey ].delayedCallbacks.length > 0 ) { while(MfcSocialMedia.cache[ cacheKey ].delayedCallbacks.length > 0 ) { if(_debug ) console.log('QUEUED CALLBACK FOR ' + cacheKey ); MfcSocialMedia.cache[ cacheKey ].delayedCallbacks.shift()( parsedResults ); } } delete MfcSocialMedia.cache[ cacheKey ].delayedCallbacks; if(_callback ) { _callback(parsedResults ); } };}MfcSocialMedia.cache={};

// js_build_core: MfcJs/PmesgPrivacy/PmesgPrivacy.js
function PmesgPrivacy(hOptions ) { 'use strict'; this._polyfills(); this._hOptions = { bDebug: false, hFcsNamespace: (window ? window : {}), sPerformers: "Models", aOrder: ["friends", "topfriends", "models", "premiums", "basics", "bookmarks"] }; this._mergeOptions(hOptions || {}); if ( !this._isValidFcsNamespace() ) { return this._error("Invalid FCS namespace passed in"); } this._setAccessLevelSettings(); if ( !this._validateFcsVars() ) { return this._error("Invalid FCS namespace passed in - unable to find all FCACCEPT_V2 vars");
 } this._hFlags = this._processRawFlags(); if ( !this._createFlags() ) { return this._error("Unable to create or find flag HTML elements"); } var nValue = ( this._isNumeric(this._hOptions.nValue) ? this._hOptions.nValue : this._nDefaultServerValue ); this.setValue(nValue);}PmesgPrivacy.prototype.getValue = function() { 'use strict'; if ( this._nValue === this._nDefaultSelectableValue ) { return this._nDefaultServerValue; } return this._nValue;};PmesgPrivacy.prototype.setValue = function(nValue ) { 'use strict'; if ( this._isValidValue(nValue) ) { this._nValue = nValue; } else { var nDefault = this._nDefaultServerValue; this._log("Setting to default value " + nDefault); this._nValue = nDefault; } for ( var sName in this._hFlags ) { var hFlag = this._hFlags[ sName ]; var nFlagValue = hFlag.value; hFlag.state = "off"; if ( this._nValue & nFlagValue ) { if ( !hFlag.bSelectable || !hFlag.bShow ) { this._disableFlag(nFlagValue); continue; }
 hFlag.state = "on"; if ( this._isArray(hFlag.aForceSelect) ) { for (var i = 0; i < hFlag.aForceSelect.length; i++) { var hForcedFlag = this._hFlags[ hFlag.aForceSelect[i] ]; if ( !hForcedFlag.bShow ) { continue; } hForcedFlag.forced = true; } } } } this._updateFlagElements();};PmesgPrivacy.prototype.resetToDefault = function() { 'use strict'; this.setValue(this._nDefaultServerValue);};PmesgPrivacy.prototype.toggleValue = function(sName) { 'use strict'; var hFlag = this._hFlags[sName]; if ( !this._isObj(hFlag) ) { this._log("Unable to find '" + sName + "'"); return; } if ( !hFlag.bShow || !hFlag.bSelectable ) { this._log("'" + sName + "' is not displayed or not selectable"); return; } if ( hFlag.el.disabled ) { this._log("'" + sName + "' is disabled"); return; } var bEnabled = hFlag.el.checked ? true : false; var nBefore = this._nValue; if ( bEnabled ) { this._disableFlag(this._hFlags["none"].value);
 this._enableFlag(hFlag.value); hFlag.state = "on"; } else { this._disableFlag(hFlag.value); hFlag.state = "off"; } if ( this._isArray(hFlag.aForceSelect) ) { for ( var i = 0; i < hFlag.aForceSelect.length; i++ ) { var hForcedFlag = this._hFlags[ hFlag.aForceSelect[i] ]; if ( !hForcedFlag.bShow ) { continue; } if ( bEnabled ) { hForcedFlag.forced = true; } else { hForcedFlag.forced = false; } this._updateFlagElement(hForcedFlag ); } } if ( this._nValue === 0 ) { this._nValue = this._hFlags["none"].value; } this._updatePreview(); this._log("Toggled '" + hFlag.name + "' (" + hFlag.value + ") " + (bEnabled ? "on" : "off" )+ " - Before: " + nBefore + " After: " + this._nValue + " Server Value: " + this.getValue()); this._save();};PmesgPrivacy.prototype._updatePreview = function() { 'use strict'; if ( !this._isObj(this._hOptions.oPreviewEl) ) { return; } this._setOrder(); var aPreviewLabels = []; for ( var i = 0; i < this._aOrder.length; i++ ) { var sName = this._aOrder[i]; var hFlag = this._hFlags[ sName ]; if (
 hFlag.bShow && hFlag.bSelectable && hFlag.state === "on" && !hFlag.forced ) { aPreviewLabels.push(hFlag.sLabel); } } if ( aPreviewLabels.length === 0 ) { aPreviewLabels.push(this._hFlags["none"].sLabel); } this._hOptions.oPreviewEl.innerHTML = aPreviewLabels.join(", ");};PmesgPrivacy.prototype._setOrder = function() { 'use strict'; if ( this._isArray(this._aOrder) ) { return; } this._aOrder = []; var hSeen = {}; var fProcess = function(aNames) { if ( !this._isArray(aNames) ) { return; } for (var i = 0; i < aNames.length; i++) { var sName = aNames[i]; if ( this._isObj(this._hFlags[sName]) ) { if ( !hSeen[sName] ) { hSeen[sName] = true; this._aOrder.push(sName); } } } }.bind(this); fProcess(this._hOptions.aOrder); fProcess(this._hFlags.keys);};PmesgPrivacy.prototype._rawFlags = function() { 'use strict';  return { "none": { sFcs: "FCACCEPT_V2_NONE", sLabel: "No one", bShow: false, bIsDefault: false, bSelectable: false }, "friends": { sFcs: "FCACCEPT_V2_FRIENDS", sLabel: "Friends", bShow: true, bIsDefault: true, bSelectable: true, aForceSelect: ["topfriends"] }, "models": { sFcs: "FCACCEPT_V2_MODELS", sLabel: (function(){ return this._hOptions.sPerformers; }.bind(this))(), bShow: true, bIsDefault: true, bSelectable: true, aForceSelect: ["bookmarks"] }, "premiums": { sFcs: "FCACCEPT_V2_PREMIUMS", sLabel: "Premium Members", bShow: true, bIsDefault: true, bSelectable: true }, "topfriends": { sFcs: "FCACCEPT_V2_TOPFRIENDS", sLabel: "TopFriends", bShow: { model: true,
 user: false }, bIsDefault: false, bSelectable: true }, "basics": { sFcs: "FCACCEPT_V2_BASICS", sLabel: "Basic Members", bShow: true, bIsDefault: false, bSelectable: { model: false, user: true } }, "bookmarks": { sFcs: "FCACCEPT_V2_BOOKMARKS", sLabs; }.bind(this))(), bShow: { model: false, user: true }, bIsDefault: false, bSelectable: true } }};PmesgPrivacy.prototype._save = function() { 'use strict'; if ( this._isFunc(this._hOptions.fSave) ) { this._hOptions.fSave(this.getValue() ); } else { this._error("No 'fSave' function passed in, unable to save values!"); }};PmesgPrivacy.prototype._generateId = function(sId ) { 'use strict'; var sFinalId = ""; if ( typeof(this._hOptions.sIdPrefix) === "string" ) { sFinalId += this._hOptions.sIdPrefix; } sFinalId += sId; if ( typeof(this._hOptions.sIdSuffix) === "string" ) { sFinalId += this._hOptions.sIdSuffix; }
 return sFinalId;};PmesgPrivacy.prototype._createFlags = function() { 'use strict'; this._setOrder(); for ( var i = 0; i < this._aOrder.length; i++ ) { var sName = this._aOrder[i]; var hFlag = this._hFlags[ sName ]; if ( !hFlag.bShow ) { continue; } var sId = this._renderFlagElement(hFlag); hFlag.el = document.getElementById(sId); if ( !hFlag.el || hFlag.el.type !== "checkbox" ) { this._error("Unable to find a checkbox element with the id '" + sId + "'"); return false; } this._attachOnClick(hFlag); } return true;};PmesgPrivacy.prototype._updateFlagElements = function() { 'use strict'; this._setOrder(); for ( var i = 0; i < this._aOrder.length; i++ ) { var sName = this._aOrder[i]; var hFlag = this._hFlags[ sName ]; this._updateFlagElement(hFlag); } this._updatePreview();};PmesgPrivacy.prototype._updateFlagElement = function(hFlag) { 'use strict'; if ( !this._isObj(hFlag.el) ) { return; }
 if ( ! hFlag.bSelectable ) { this._toggleChecked(hFlag, false); this._toggleDisabled(hFlag, true); } else if ( hFlag.forced ) { this._toggleChecked(hFlag, true); this._toggleDisabled(hFlag, true); } else if ( hFlag.state === "on" ) { this._toggleChecked(hFlag, true); this._toggleDisabled(hFlag, false); } else if ( hFlag.state === "off" ) { this._toggleChecked(hFlag, false); this._toggleDisabled(hFlag, false); }};PmesgPrivacy.prototype._toggleDisabled = function(hFlag, bStatus ) { 'use strict'; hFlag.el.disabled = bStatus; if ( this._isFunc(this._hOptions.fToggleDisabled) ) { return this._hOptions.fToggleDisabled({ sName: hFlag.name, sId: hFlag.id }, bStatus); }};PmesgPrivacy.prototype._toggleChecked = function(hFlag, bStatus ) { 'use strict'; hFlag.el.checked = bStatus; if ( this._isFunc(this._hOptions.fToggleChecked) ) { return this._hOptions.fToggleChecked({ sName: hFlag.name, sId: hFlag.id }, bStatus); }};PmesgPrivacy.prototype._attachOnClick = function(hFlag ) { 'use strict'; var fToggle = this.toggleValue.bind(this, hFlag.name); if ( this._isObj(hFlag.el.attachEvent) ) { return hFlag.el.attachEvent('onclick', fToggle); } else { return hFlag.el.addEventListener('click', fToggle, false); }};PmesgPrivacy.prototype._renderFlagElement = function(hFlag ) { 'use strict'; var sName = hFlag.name;
 var sId = this._generateId(hFlag.name); if ( this._isFunc(this._hOptions.fCreateFlagEl) ) { this._hOptions.fCreateFlagEl({ sId: sId, sName: sName }); } else { var oInputContainer = document.createElement("div"); oInputContainer.id = sId + "_option"; oInputContainer.className = "pmesg_option"; var oCheckboxEl = document.createElement("input"); oCheckboxEl.id = sId; oCheckboxEl.className = "pmesg_checkbox"; oCheckboxEl.type = "checkbox"; oCheckboxEl.name = "name"; oCheckboxEl.value = "value"; var oLabelEl = document.createElement("label"); oLabelEl.id = sId + "_label"; oLabelEl.className = "pmesg_label"; oLabelEl.htmlFor = sId; oLabelEl.appendChild(document.createTextNode(hFlag.sLabel)); oInputContainer.appendChild(oCheckboxEl); oInputContainer.appendChild(oLabelEl); this._hOptions.oContainerEl.appendChild(oInputContainer); } return sId;};PmesgPrivacy.prototype._processRawFlags = function() { 'use strict'; var hFlags = this._rawFlags(); this._nDefaultServerValue = 0; this._nDefaultSelectableValue = 0; for ( var sName in hFlags ) { var hFlag = hFlags[sName]; hFlag.name = sName; hFlag.value = this._hFcs[ hFlag.sFcs ]; var fSet = function(data) { if ( !this._isObj(data ) ) {
 return data; } if ( this._bModelMode ) { return data.model; } else { return data.user; } }.bind(this); hFlag.bShow = fSet(hFlag.bShow); hFlag.bIsDefault = fSet(hFlag.bIsDefault); hFlag.bSelectable = fSet(hFlag.bSelectable); if ( hFlag.bIsDefault ) { this._nDefaultServerValue |= hFlag.value; } if ( hFlag.bIsDefault && hFlag.bShow && hFlag.bSelectable ) { this._nDefaultSelectableValue |= hFlag.value; } } this._log("Selectable Default: " + this._nDefaultSelectableValue + " Server Default: " + this._nDefaultServerValue); return hFlags;};PmesgPrivacy.prototype._enableFlag = function(nValue) { 'use strict'; this._nValue |= nValue;};PmesgPrivacy.prototype._disableFlag = function(nValue) { 'use strict'; if ( this._nValue & nValue ) { this._nValue ^= nValue; }};PmesgPrivacy.prototype._isValidValue = function(nValue ) { 'use strict'; if ( !this._isNumeric(nValue) || nValue < 0 ) { this._log("Value is not numeric or is a negative"); return false; } if ( nValue == 0 ) { nValue = this._hFlags["none"].value; } if ( this._hFlags["none"].value == nValue ) {
 this._log("Value is set to '" + this._hFlags["none"].name + "'"); return true; } var hSet = {}; var aFcs = []; var hMissing = {}; var nRemainder = nValue; for ( var sName in this._hFlags ) { var hFlag = this._hFlags[sName]; if ( !hFlag.bShow ) { continue; } var nFlagValue = hFlag.value; if ( nRemainder & nFlagValue ) { aFcs.push(hFlag.sFcs); hSet[ hFlag.sFcs ] = true; nRemainder ^= nFlagValue; } } if ( nRemainder != 0 ) { this._log("Value is invalid, found bits '" + aFcs.join(",") + "' but still has unknown bits " + nRemainder + " set"); return false; } if ( aFcs.length === 0 ) { this._log("Value is invalid, no bits found."); return false; } this._log("Values set: " + aFcs.join(",")); return true;};PmesgPrivacy.prototype._setAccessLevelSettings = function() { 'use strict'; this._bModelMode = ( this._hOptions.nAccessLevel == this._hFcs["FCLEVEL_MODEL"] );};PmesgPrivacy.prototype._isValidFcsNamespace = function() { 'use strict'; if ( !this._isObj(this._hOptions.hFcsNamespace) ) { this._log("'hFcsNamespace' is not a valid object"); return false; }
 if ( !this._isNumeric(this._hOptions.hFcsNamespace["FCLEVEL_MODEL"]) ) { this._log("Unable to find 'FCLEVEL_MODEL' in 'hFcsNamespace' or set value was not numeric"); return false; } this._hFcs = this._hOptions.hFcsNamespace; return true; };PmesgPrivacy.prototype._validateFcsVars = function() { 'use strict'; var hFlags = this._rawFlags(); for ( var sName in hFlags ) { var hFlag = hFlags[ sName ]; if ( !this._isNumeric(this._hFcs[ hFlag.sFcs ] ) ) { this._log("Unable to find '" + hFlag.sFcs + "' in 'hFcsNamespace' or set value was not numeric"); return false; } } return true;};PmesgPrivacy.prototype._error = function(sMsg) { 'use strict'; sMsg = "ERROR: " + sMsg; this._log(sMsg); if ( this._isFunc(this._hOptions.fError) ) { return this._hOptions.fError(sMsg); } if ( window && this._isFunc(window.alert) ) { window.alert(sMsg); }};PmesgPrivacy.prototype._log = function(sMsg) { 'use strict'; if ( !this._hOptions.bDebug ) { return; } sMsg = "PmesgPrivacy: " + sMsg; if ( this._isFunc(this._hOptions.fLog) ) { return this._hOptions.fLog(sMsg);
 } if ( window && window.console && this._isFunc(window.console.log) ) { return window.console.log(sMsg); }};PmesgPrivacy.prototype._isFunc = function(a) { 'use strict'; return (a && typeof(a) === "function");};PmesgPrivacy.prototype._isObj = function(a) { 'use strict'; return (a && typeof(a) === "object" && a != null);};PmesgPrivacy.prototype._isArray = function(a) { 'use strict'; return (a && Array.isArray(a));};PmesgPrivacy.prototype._isNumeric = function(a) { 'use strict'; return (!isNaN(parseFloat(a) ) && isFinite(a));};PmesgPrivacy.prototype._mergeOptions = function(hOptions ) { 'use strict'; for (var option in hOptions) { this._hOptions[option] = hOptions[option]; }};PmesgPrivacy.prototype._polyfills = function() { if (!Array.prototype.indexOf) { Array.prototype.indexOf = function(searchElement, fromIndex) { var k; if (this == null) { throw new TypeError('"this" is null or not defined'); } var o = Object(this); var len = o.length >>> 0; if (len === 0) { return -1; } var n = fromIndex | 0;
 if (n >= len) { return -1; } k = Math.max(n >= 0 ? n : len - Math.abs(n), 0); while (k < len) { if (k in o && o[k] === searchElement) { return k; } k++; } return -1; }; } if (!Array.isArray) { Array.isArr'; }; } if (!Object.keys) { Object.keys = (function() { 'use strict'; var hasOwnProperty = Object.prototype.hasOwnProperty, hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'), dontEnums = [ 'toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor' ], dontEnumsLength = dontEnums.length; return function(obj) { if (typeof obj !== 'function' && (typeof obj !== 'object' || obj === null)) { throw new TypeError('Object.keys called on non-object'); } var result = [], prop, i; for (prop in obj) { if (hasOwnProperty.call(obj, prop)) { result.push(prop);
 } } if (hasDontEnumBug) { for (i = 0; i < dontEnumsLength; i++) { if (hasOwnProperty.call(obj, dontEnums[i])) { result.push(dontEnums[i]); } } } return result; }; }()); } if (!Function.prototype.bind) { Function.prototype.bid; }; }};

// js_build_core: MfcJs/MfcAdminTools/MfcAdminTools.js
function MfcAdminTools(config){ config = config || {}; var _callback = config.callback || null; var _apiUrl = ( config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ) + '/adminTools'; var _debug = false; var reqObj; if(window.navigator.appName.indexOf('Internet Explorer') > -1) reqObj = new ActiveXObject('Microsoft.XMLHTTP'); else reqObj = new XMLHttpRequest(); this.getData = function(options) { options = options || {}; var queryString = ''; for(var sK in options ) { if(sK == 'callback' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&'; } var self = this; reqObj.open("GET",_apiUrl + '?' + queryString + '&no_cache=' + Math.random() ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.getData_Response(options, queryString ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(); }; this.getData_Response = function(options, queryString ) { if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText ); if(_callback ) { _callback(res ); }
 }; this.postData = function(options) { var data=''; for(var sK in options ) { if(sK == 'callback' ) { continue; } data += sK + '=' + escape(options[sK] ) + '&'; } var self = this; reqObj.open("POST",_apiUrl); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.postData_response(options ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(data ); }; this.postData_response = function(options ) { if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText ); if(_callback ) { _callback(res ); } };}MfcAdminTools.cache={};

// js_build_core: MfcJs/VideoPlayer/videojs.min.js
/**
 * @license
 * Video.js 7.7.5 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/master/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/master/LICENSE>
nt)}(this,function(h,d){"use strict";h=h&&h.hasOwnProperty("default")?h.default:h,d=d&&d.hasOwnProperty("default")?d.default:d;var p="7.7.5",c=)}}};v},i}("VIDEOJS"),v=f.createLorts}vars=t}),n=Object.prototype.toStrie)&&3===e.nodevar U,q=T("querySelector"),X=T("querySelectorAll"),$=Object.freeze({isReal:m,isEl:_,isInFrame:b,createEl:k,textContent:C,prependTo:E,hasClass:w,addClass:S,removeClass:x,toggleClass:P,setAttributes:j,getAttributes:A,getAttribute:I,setAttribute:M,removeAttribute:L,blockTextSelection:N,unblockTextSelection:D,getBoundingClientRect:O,findPosition:R,getPointerPosition:B,isTextNode:F,emptyEl:H,normalizeContent:V,appendContent:W,insertContent:z,isSingleLeftClick:K,$:q,$$:X}),Y=J)}m()&&("complete"===d.readyState?J():h.addEventListener("load"=t}var te,ne=3;function ie(){return ne++}h.WeakMap|},e}());var re,se=h.WeakMap?new WeakMap:nee}va re},ue=["touchstart","touchmonction me(){}var _e,be=Object.freeze({fixEvent:le,on:he,off:de,trigger:pe,one:fe,any:ve});me.prototype.allowedEvents_={},me.prototype.addEventListener=me.prototype.on=function(e,t){var n=this.addEventListener;this.addEventListener=function(){},he(this,e,t),this.addEventListener=n},me.prototype.removeEventListener=me.prototype,t)},me.prototype.one=function(e,t){var n=this.addEventListener;this.addEventListener=function(){},fe(this,e,t),this.addEventListener=n},me.prototyper=n},me.prototype.dispatchEvent=me.prototype.tri,e)},me.prototype.queueTria]})},Peu)}},one:function(){for(var r=this,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=we(this,t),s=i.isTargetingSelf,o=i.target,a=i.type,l=i.listener;if(s)Se(o,"one",a,l);else{var c=function e(){r.off(o,a,e);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];l.apply(null,n)};c.guid=l.guid,Se(o,"one",a,c)}}c)}}))}},tri,),e}var Ae={state:{},setS)),e}function Me(e){return"string"!=typeof e?e:e.replace(/./,function(e){return e.toLowerCase,n}var De=functiy()}var e=c.prototype;return e.disll}},e.isDispd_)},e.player=function(){return this.player_},e.optns_},e.el=function(){return this.el_},e.createEl=function(e,t,n){return k(e,t,n)},e.loca),l},e.contentEl=function(){return this.contentEl_||this.el_},e.id=function(){return this.id_},e.name=function(){return this.name_},e.children=function(){return this.children_},e.getChildById=function(e){return this.childIndex_[e]},e.getC[e]},e.addCn i},e.removeC)}}},e.initChil})}},e.buildCSSClass=function(){return""},e.re))},e.triggerR,1)},e.$=function(e,t){return q(e,t||this.contentEl())},())},e.hasClass=function(e){return w(this.el_,e)},e.addClass=function(e){S(this.el_,e)},e.removeClass=function(e){x(this.el_,e)},e.toggleClass=function(e,t){P(this.el_,e,t)},e.show=function(){this.removeClass("vjs-hidden")},e.hide=function(){this.addClass("vjs-hidden")},e.lockShowing=function(){this.addClass("vjs-lock-showing")},e.unlockShowing=function(){this.removeClass("vjs-lock-showing")},e.getAttri,e)},e.setAttri,t)},e.removeAttribute=function(e){L(this.el_,e)},e.width=function(e,t){return this.dimension("width",e,t)},e.he,t)},e.dimens(t)},e.dimen10)},e.currentDimenn t},e.currentDimens")}},e.currentWidth=function(){return this.currentDimension("width")},e.currentHeight=function(){return this.currentDimension("height")},e.focus=function(){this.el_.focus()},e.blur=function(){this.el_.blur()},e.handleKeye))},e.handleKeyPress=function(e){this.handleKeyDown(e)},e.emitTapEv)})},e.enableTouchActie)}},e.setTim),n},e.clearTimeout=function(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),h.clearTimeout(e)),e},e.setInte),n},e.clearInte),e},e.requestAnimationF60)},e.cancelAnimationF(e)},e.clearTimersOnDisp}))},c.registerCompo]=t},c.getCompo[e]},c}();De.prototype.supportsRaf_="function"==typeof h.requestAnimationFrame&&"function"==typeof h.cancelAnimationFrame,De.registerComponent("Component",De);var Oe=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var Re,Be,Fe,H_=t},We=h.navigator&&h.navigator.userAgent||"",ze=/AppleWebKit\/([\d.]+)/i.exec(We),Ke=ze?parseFloat(ze.pop()):null,Ue=/iPod/i.test(We),qe=(Re=We.match(/OS (\d+)_/i))&&Re[1]?Re[1]:null,Xe=/Android/i.test(Weull}(),Ye=Xe&&$e<5&&Ke<537,Ge=/Firefox/i.test(We),Qe=/Edge/i.test(We),Je=!Qe&&(/Chrome/i.test(We)||/CriOS/i.test(We)),Ze=(Be=We.match(/(Chrome|CriOS)\/(\d+)/))&&Be[2]?parseFloat(Be[2]):null,et=(Fe=/MSIE\s(\d+)\.\d/.exec(We),!(He=Fe&&parseFloat(Fe[1]))&&/Trident\/7.0/i.test(We)&&/rv:11.0/.test(We)&&(He=11),He),tt=/Safari/i.test(We)&&!Je&&!Xe&&!Qe,nt=/Windows/i.test(We),it=m()&&("ontouchstart"in h||h.navigator.maxTouchPoints||h.DocumentTouch&&h.document instanceof h.DocumentTouch),rt=/iPad/i.test(We)||tt&&it&&!/iPhone/i.test(We),st=/iPhone/i.test(We)&&!rt,ot=st||rt||Ue,at=(tt||ot)&&!Je,lt=Object.freeze({IS_IPOD:Ue,IOS_VERSION:qe,IS_ANDROID:Xe,ANDROID_VERSION:$e,IS_NATIVE_ANDROID:Ye,IS_FIREFOX:Ge,IS_EDGE:Qe,IS_CHROME:Je,CHROME_VERSION:Ze,IE_VERSION:et,IS_SAFARI:tt,IS_WINDOWS:nt,TOUCH_ENABLED:it,IS_IPAD:rt,IS_IPHONE:st,IS_IOS:ot,IS_ANY_SAFARI:}for(var pt,ft={prefixed:!0},vt=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],gt=vt[0],yt=0;yt<vt.length;yt++)if(vt[yt][1]in d){pt=vt[yt];break}if(pt){for(var mt=0;mt<pt.length;mt++)ft[gt[mt]]=pt[mt];ft.prefixed=pt[0]!==g"")}_t.prototype.code=0,_t.prototype.message="",_t.prototype.status=null,_t.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],_t.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var bt=0;bt<_t.errorTypes.length;bt++)_t[_t.errorTypes[bt]]=bt,_t.prototype[_t.errorTypes[bt]]=bt;va)}vat))s()},s)r[a]=s[a]}),Pt=(xt.code,xt.codes,xt.aliases,xt.names,xt.title,"vjs-modalable")})},e}(De);jt.prototype.options_={pauseOnOpen:!0,temporary:!0},De.registerComponent("ModalDialogreturn t},e}(me);for(var It in At.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack"},At.prototype.allowedEvents_)At.prototype["on"+It]=null;function Mt(e,t){for(var n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n]+te_=nulle_=nullhange_));brereturn t},t}(),zt={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},Kt={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},Ut={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},qt={disabled:"disabled",hidden:"hidden",showing:"n Ve(e,s),e}(me),$t=Object.freeze({parseUrl:Nt,getAbsoluteURL:Dt,getFileExtension:Ot,isCrossOrdow.prompt)}
/**
   * @license
   * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
   * Copyright (c) 2014 David Björklund
   * Available under the MIT license
   * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
   */,Gt=Object.prototype.to[r[n],i]}),rh||null),l}tn.XMLHttpRequest=h.XMLHttpRequest||function(){},tn.XDomainRequest="withCredentials"in new tn.XMLHttpRequest?tn.XMLHttpRequest:h.X;n++)t(e[n])}(["get","put","post","patch","hease(),nn(t)}}),:rn(n);break}}},e}(Xt);on.prototype.allowedEvents_={cuechange:"cuechrn Ve(ern Ve(ern Ve(e,r),e}(me);cn.prototype.allowedEvents_={load:"load"},cn.NONE=0,cn.LOADING=1,cn.LOADED=2,cn.ERROR=3;var un={audio:{ListClass:Bt,TrackClass:an,capitalName:"Audio"},video:{ListClass:Ft,TrackClass:ln,capitalName:"Video"},text:{ListClass:Ht,TrackClass:on,capitalName:"Text"}};Object.key=e+"Tracks_"});var hn={remoteText:{ListClass:Ht,TrackClass:on,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:Vt,TrackClass:cn,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},dn=r({},un,hn);hn.names=Object.keys(hn),un.names=Object.keys(un),dn.names=[].concat(hn.names).concat(un.names);var pn=Oype=e,new fn};fn)}(t,e)}((vn.prototype=pn(Error.prototype)).constructor=vn).Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},yn.pvalu.val thi(e,t);brseInt(t,set(e,t),!0)}};var bn=d.createElement("textarea"),Tn={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},kn={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},Cn={v:"title",lang:"lang"},Ec=h}return l}var Sn=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114n!0}return!1}fValues(a))}function Mn(){}Pn.prototypyle[n]=e[n])},Pn.prototyp 0===e?0:e+t},(jn.prototype=pn(Pn.prototype)).constructor=jn,An.ps.bottom-=t}},An.protobottom>e.top},An.prototypn!0;return!1},An.proght<=e.right},An.prototype.overlapom>e.bottom}},An.prototype.inters*this.width)},An.prototype.toCS:this.width}},An.getSimp:e.width||n}},Mn.ponent(e))}}},Mn.converwn(e,t):null};MisplayStateegionList=[]}).prototype={reporsinger}returflush(),this}};var Ln=Mn,Nn={"":1,lr:1,rl:1},Dn={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"ltate=void 0}Rn.prototypew,this.text)};var Bn=Rn,Fn=||(a=t)ue||t.shim()});Wn.WebVTT,Wn.VTTCue,Wn.VTT):void 0)},n}(De);dn.rivateName]}}),zn.prototype.featuresVolumeControl=!0,zn.prototype.featuresMuteControl=!0,zn.prototype.featuresFullscreenResize=!1,zn.prototype.featuresPlaybackRate=!1,zn.prototype.featuresProgressEvents=!1,zn.prototype.featuresSourceset=!1,zn.prototype.featuresTimeupdateEvents=!1,zn.prototype.featuresNativeTextTracks=!1,zn.withSdler_=null)}},De.registerComponent("Tech",zn),zn.registerTech("Tech",zn),zn.defaultTechOrder_=[];var Kn={(e,n,a,o),a}var Yn={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1},Gn={setCurrentTime:1,setMuted:1,setVolume:1},Qn={plase()]||""}var ti={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",oga:"audio/ogg",m3u8:"application/x-mpegURL",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:=t)}rern Ve(e,c),e}(De);De.registerComponent("MediaLoadel(this,e)},e}(De);De.registerComponent("ClickableComponen.pause())},e}(ri);De.registerComponent("PosterImage",si);var oi="#222",ai={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace,(e){rtate(o)}}},e}(De);De.registerComponent("TextTrackDisplahild(n),i},e}(De);De.registerComponent("LoadingSpinnel(this,e)},e}(ri);De.registerComponent("Buttoeused_=!0},e}(di);pi.prototype.controlText_="Play Video",De.registerComponent("BigPlayButtol(this,e)},e}(di);De.registerComponent("CloseButtoleSeeked)},e}(di);vi.prototype.controlText_="Play",De.registerComponent("Pl<10?"0"+nt=e),ynction(e){},e}(De);_i.prototype.labelText_="Time",_i.prototype.controlText_="Time",De.registerComponent("TimeDisplxtNode_(t)},t}(_i);bi.prototype.labelText_="Current Time",bi.prototype.controlText_="Current Time",De.registerComponent("CurrentTimeDisplxtNode_(t)},e}(_i);Ti.prototype.labelText_="Duration",Ti.prototype.controlText_="Duration",De.registerComponent("DurationDispldden":!0})},t}(De);De.registerComponent("TimeDividtNode_(t))},e}(_i);Ci.prototype.labelText_="Remaining Time",Ci.prototype.controlText_="Remaining Time",De.registerComponent("RemainingTimeDisplthis.hide()},e}(De);De.registerComponent("LiveDisp.call(this)},e}(di);wi.prototype.controlText_="Seek to live, currently playing live",De.registerComponent("isNaN(orizontal")},e}(De);De.registerComponetoFixe=t.length})},e}(De);De.registerComponent("LoadProgresse),a&&a()})},e}(De);De.registerComponent("TimeToolime(e,t,i)}},e}(De);Ii.prototype.options_={children:[]},ot||Xe||Ii.prototype.options_.children.push("timeTooltip"),De.registerComponent("PlayProgressth*t+"px"})},e}(De);Mi.prototype.options_={children:["timeTooltip"]},De.registerComponent("MouseTimeDisplay",Mi);vartHandlers_(),n}Ve(e,s);var t=e.prototype;return t.seleVisibility_)},t.tothis.update())},t.is.update,30))},t.dInterval=nuogress Barogress())}),r},t..currentTime(_.duration(),e},t..call(this,e))},t.urrentTime(t)}},t.enable=function(){s.prototype.enable.call(this);var e=this.getChild("mouseTimeDisplay");e&&e.sh");e&&e.hide()},this.update_()rrentTime()rrentTime()-5)},t.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},n.call(this,e)},e}(xi);Li.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},ot||Xe||Li.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),De.registerComponent("SeekdleMouseUp)},e}(De);Ni.prototype.options_={children:["seekBar"]},De.registerComponent("ProgressContInPicture()},e}(di);Di.prototype.controlText_="Picture-in-Picture",De.registerComponent("PictureInPictureTogullscreen()},e}(di);Oi.prototype.controlText_="Fullscreen",De.registerComponent("FullscreenToggle",Oi);var Ri=function(e){function t(){return e.apply(this,arguments)||this}return Ve(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})},t}(De);De.registerComponent("VolumeLeolume_(t)})},e}(xi);Bi.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},Bi.prototype.playerEvent="volumechange",De.registerComponent("VolumeouseMove(e)},e}(De);Fi.prototype.options_={children:["volumeBar"]},De.registerComponent("VolumeConttrolText(e)},e}(di);Hi.prototype.controlText_="Mute",De.registerComponent("MuteTogeMouseOut()},e}(De);Vi.prototype.options_={children:["muteToggle","volumeControl"]},De.registerComponent("VolumePal_.focus())},e}(De);De.registerComponent("Mn_.enable()},e}(De);De.registerComponent("MenuButturn Ve(e,s),e}(zi);De.registerComponent("TrackButton",Ki);var Ui=["Tab","Esc","Up","Down","Riected_=!1))},e}(ri);De.registerComponent("MenuI.call(this)},e}(qi);De.registerComponent("TextTrackMenuInabled:!1})},e}(Xi);De.registerComponent("OffTextTrackMenuI)}}return e},e}(Ki);De.registerComponent("TextTrackBut<t.endTime)},e}(qi);De.registerComponent("ChaptersTrackMenuIs)}return e},e}(Yi);Qi.prototype.kind_="chapters",Qi.prototype.controlText_="Chapters",De.registerComponent("ChaptersBut.call(this)},e}(Yi);Ji.prototype.kind_="descriptions",Ji.prototype.controlText_="Descriptions",De.registerComponent("DescriptionsBut.call(this)},e}(Yi);Zi.prototype.kind_="subtitles",Zi.prototype.controlText_="Subtitles",De.registerComponent("SubtitlesButgs").open()},e}(Xi);De.registerComponent("CaptionSettingsMenuIall(this,e)},e}(Yi);tr.prototype.kind_="captions",tr.prototype.controlText_="Captions",De.registerComponent("CaptionsButML:i},t),n)},e}(Xi);De.registerComponent("SubsCapsMenuI(this,e,nr)},e}(Yi);ir.prototype.kinds_=["captions","subtitles"],ir.prototype.controlText_="Subtitles",De.registerComponent("SubsCapsButck.enabled)},e}(qi);De.registerComponent("AudioTrackMenuI))}return e},e}(Ki);sr.prototype.controlText_="Audio Track",De.registerComponent("AudioTrackBut=this.rate)},e}(qi);or.prototype.contentElType="button",De.registerComponent("PlaybackRateMenuIRate()+"x")},e}(zi);ar.prototype.controlText_="Playback Rate",De.registerComponent("PlaybackRateMenuButSSClass()})},t}(De);De.registerComponent("SparHTML=" ",e},e}(lr);De.registerComponent("CustomControlSp,dir:"ltr"})},t}(De);ur.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in d&&ur.prototype.options_.children.splice(ur.prototype.options_.children.length-1,0,"pictureInPictureToggle"),De.registerComponent("Contro.message):""},e}(jt);hr.prototype.options_=r({},jt.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),De.registerComponent("ErrorDisplay",hr);var dr="vjs-text-track-settings",pr=["#000","Black"],fr=["#00F","Blue"],vr=["#0FF","Cyan"],gr=["#0F0","Green"],yr=["#F0F","Magenta"],mr=["#F00","Red"],_r=["#FFF","White"],br=["#FF0","Yellow"],Tr=["1","Opaque"],kr=["0.5","Semi-Transparent"],Cr=["0","Transparent"],Er={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[pr,_r,mr,gr,fr,br,yr,vr]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[Tr,kr,Cr]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[_r,pr,mr,gr,fr,br,yr,vr]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],?null:Number(e)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[Tr,kr]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",optie"!==e)return e}Er.windowColor.options=Er.backgroundColon&&n.focus()},e}(jt);De.registerComponent("TextTrackSette.call(this)},e}(De);De.registerComponent("ResizeManager",xr);vabilityChange),n}Ve(e,r);var t=e.prototype;return t.handletartTrackinge!==1/0&&t<=e-n},t.trackLive_=function(){this.pastSeekEnd_=this.pastSeekEnd_;var e=this.player_.seekable();if(e&&e.length){var t=this.seekableEnd();t!==this.lastSeekEnd_&&(this.lastSeekEnd_&&(this.seekableIncrementList_=this.seekableIncrementList_.slice(-11),this.seekableIncrementList_.push(Math.abs(t-this.lastSeekEnd_)),3<this.seekableIncrementList_.length&&(this.se(n[t-1]+n[t])/2}(this.seekableIncrementList_))),this.pastSeekEnd_=0,this.lastSeekEnd_=t,this.trigger("seekableendchange")),this.pastSeekEnd()>1.5*this.seekableIncrement_?this.pastSeekEnd_=0:this.pastSeekEnd_=this.pastSeekEnd()+.03,this.isBehind_()!==this.behindLiveEdge()&&(this.behindLiveEdge_=this.isBehind_(),this.trigger("liveedgechange"))}},t.hand.stopTracking()}leTimeupdate)seekToLivimeupdate=null)&&this.reset_(t.length-1]:1/0}h?t.sort()[0]seekableStart()},t.isLive=function(){return this.isTrackingehindLiveEdge()},ts.seekableEnd()},t.pastSeekEnd=function(){return this.pastSeekEnd_},t.behindLiveEdge=function(){return this.behindLiveEdgackingInterval_},player_.play())},t.dispose=function(){this.stopTracking(),r.prototype.dispose.call(this)},e}(De);De.registerComponent("erty(t,n,s)}var Nr,Dr=Object.defineProperty({},e(!0,this.innerHTML}}),Or=Object.defineProperthisthis,"src",e),e}}riggerReady(),n}Ve(a,u);var e=a.prototype;pose.call(this)},e.setupSotion(){Mr(this)},e.restoreMetadataTracksInr("change",r)})},ecksForType_(i)}},e.overrideNativeAudioTracks=function(e){this.overrideNative_("Audio",e)},e.overrideNive_("Video",e)},e.proxyNatioadstart",n)})}},e.prksForType_([s]=o)}return e},eer(e)},this)})}},. (Video.js_.duration||NaN},e.width=function(){return this.el_.offsetWidth},e.height=function(){return this.el_.offsetHeight},e.proxyWllscreen",t)})}},e.suturn!0}return!1},eterFullScreen()},xitFullScreen()},e.requestPictureInPicture=function(){return this.el_.requestPictureIn;this.setSrc(e)},e.reset=function(){a.resetMediaElement(this.el.el_.currentSrl_.controls=!!eall(this,e,t,n)},e.creat(t.src=e.src),t},e.adppendChild(n),n},e.removmoveChild(t[n])},e.getVideigationStart),e},a}(zn);pendChild(t),e}}ID.canPlayType).canPlayType(e)},layType(e.type)},Rr.ch(e){return!1}},ch(e){return!1}},Rr.canConch(e){return!1}},Rr.canOvturn!1}return!0},Rr.supportsturn at||ot&&Je},Rr.supportsNativeVideoTracks=function(){return!(!Rr.TEST_VID||!Rr.TEST_VID.videoTracks)},Rr.supportsNID.audioTracks)},Rr.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresVolumeControl","canControlVolume"],["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTrn Rr[n]()},!0)}),Rr.prototype.movingMediaElementInDOM=!ot,Rr.prototype.featuresFullscreenResize=!0,Rr.prototype.featuresProgressEvents=!0,Rr.prototype.featuresTimeupdateEvents=!0,Rr..call(this,e)})},Rr.unnPlayType=Nr),e},Rr.patchCanPlayType(),Rr.dis}catch(e){}}()}},Rr.r}catch(e){}}()}},["muted","defaultMuted","autoplay","controls","loop","playsasAttribute(e)}}),["muted","defaultMuted","autoplay","loop","playsveAttribute(t)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","played","networkState","readyState","videoWidth","videorn this.el_[e]}}),["volume","src","poster","preload","playbackRate","defaultPlayba{this.el_[t]=e}}),["pause","load" this.el_[e]()}}),zn.withSourceHandlers(Rr),Rr.nativeSourceHandler={},Rr.nativeSourceHanch(e){return""}},Rr.nativeSourceHandlero/"+n)}return""},Rr.nativeSourceHandt.setSrc(e.src)},Rr.nativeSourceHandler.dispose=function(){},Rr.registerSourceHandler(Rr.nativeSourceHandler),zn.registerTech("Html5",Rr);var Br=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],Fr={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},Hr=["tiny","xsmall","small","medium","large","xlarge","huge"],"vjs-layout-"+t});var Wr={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0_.responsive),i}Ve(c,u);var e=c.prototype;pose.call(tge_),this.el_=t},e.width=function(e){return this.dimension("width",e)},e.height=function(e){return this.dimension("height"dateStylpdateStass("vjs-fill"pdateStyleEl_()},&(a.height=o,this.tag=nullterFrom\n"),this.tech_},e.addTechCohandleTechTap_)},e.removeTechCochDoubleClick_)},e.rationChange_()},e.handhis.autoplay())},eautoplay:t})})}},e.updis.cache_.src=t},e.hande:"sourceset"-has-started"))},etrigger("play")},e.handlr("ratechange")},e.hameupdate",e))})},e.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},e.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},e.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},e.hagger("seeking")},e.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},e.hander("firstplay")},e.rigger("pause")},e.rigger("ended")},e.handleTect_("duration"))},e.):this.pause())},e.handletFullscreen()))},s.userActive())},e.handlis.userActive()},e.handtUserActivity()},e.handleTechTouchEnd_=function(e){e.preventDefault()},e.handleStageClick_=function(){this.reportUserActivity()},e.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},e.documentFsFullscreen(i)}},e.handleTechFt.isFullscreen)},e.togglePicturre-in-picture")},e.handleTechEnterPictureInPicture_=function(e){this.isInPictureInPicture(!0)},e.handleTechLeavePictureInPicture_=function(e){this.isInPictureInPicture(!1)},e.);this.error(e)},e.hanr("textdata",n)},e.getCache=function(){return this.cachees:[],volumeow f(e),e}};throw }):this.ayCallbacks_(i)},e.runPlaynction(e){e()})},e.rction(e){e(t)})},e.pause=function(){this.techCall_("phGet_("paayed")||ht(0vjs-scrubbing"e_.currentTrationchange"))}s.currentTime()},e.rema.currentTim||(e=ht(0,0)),e},ehis.duration()rn t<n&&(),isNaN(_("setMuted",e)aultMuted")||!e_.lastVolume=e},e.suullScreen")||!1lscreenClass_()},e.rterFullWindow()},xitFullWindow()},eterFullWindow")},e.fuitFullWindow())},xitFullWindow")},e.isInctureInPicture_},e.requesttureInPicture")},e.exittureInPicture()}dleHotkeys(e))}}k.call(this,e)ech.')}return""):t(s,dMessaggSrc_=!1})),!1)},e.load=function(){this.techCall_(e.doReset_(("playerreset")},e.resetVolumeBar_()},e.rupdateContent()},e.rechRateChange_()},e.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},che_.sources||t}che_.source||{}},e.currentSrc=function(){return this.currentSource()&&this.currentSource().src||"urce().type||""},e.preload=function(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("prelosetAutoplay",t("playsechGet_("posterchange"))},e.handleTosterchangesListeners_()))},e.usitomcontrrigger("error")},e.reserActivity_=userinactive")}},e.listen!1)},e))}},250)laybackRate",e)},e.deflaybackRatis.isAudio_=!!eextTrack(e,t,n)},e.adeTextTrack(e,t)},e.removoteTextTrack(t)},e.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},e.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||ideoHeight().toLowerCashis.langus[n]=i}return i)}),i.open(),i},e.updateCuoint_=i;break}}},e.removeCu.removeClass(es.breakpointst_()),e):void 0},e.currentBreakpoint=function(){return this.breakpoint_},e.currenreakpoint_]|,this.ready(t.poster)}]),t},(A(u))}return t},e.fder"in e.style)},c}(De);.privateName])}}),zr.players={};var Kr=h.navigator;zr.prototype.options_={techOrder:zn.defaultTechOrder_,html5:{},flash:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:Kr&&(Kr.languages&&Kr.languages[0]||Kr.userLanguage||Kr.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1},["ended","seeking","seekable","networkState","readis.techGet_(his.trigger(e)}}),De.registerComponent("Player",zr);function Ur(e){return es.hntHas,t)}n.exports=i}),null,arguments)}i.exports=r}),Jr="plugin",Zr="activePl.VERSION||""},n}();ts.getPlugin=qr,ts.BASE_PLUGIN_NAME=Jr,ts.registerPlugin(Jr,ts),zr.proto0===this[Zr][e]},zr.pro){retur0}}return e(i)}),i}if(rs.ho)),rs.hooks_[e]},rs.hook=function(e,t){rs.hooks(e,arguments)}})splice(n,1),!0)},!0!==h.VIDEOJS_NO_DYNAMIC_STYLE&&m()){var ss=q(".vjs-styles-defaults");if(!ss){ss=Z("vjs-styles-defaults");var os=q("head");os&&os.insertBefore(ss,os.firstChild),ee(ss,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid {\n        padding-top: 56.25%\n      }\n    ")}}return Q(1,rs),rs.VERSION=p,rs.options=zr.prototype.options_,rs.getPlayers=function(){return zr.playereturn o||n[a]}},filter(Boolean)},rs.players=zr.players,rs.getComponent=De.getComponent,rs.rnt.call(De,e,t)},rs.getTech=zn.getTech,rs.registerTech=zn.reg],Kn[e].push(t)},Object.defineProperty(rs,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(rs.middleware,"TERMINATOR",{value:qn,writeable:!1,enumerable:!0}),rs.browser=lt,rs.TOUCH_ENAB=i[r]);return n},rs.mergeOptions=Ne,rs.bind=ge,rs.registerPlugin=ts.registerPlugin,rs.deregisterPlugin=ts.deregistersterPlugin(e,t)},rs.getPlugins=ts.getPlugins,rs.getPlugin=ts.getPlugin,rs.getPluginVersion=ts.getPluginVersions.languages[e]},rs.log=f,rs.createLogger=v,rs.createTimeRange=rs.createTimeRanges=ht,rs.formatTime=mi,rs.setFormatTime=function(e){yi=e},rsunction(){yi=gi},rs.parseUrl=Nt,rs.isCrossOrigin=Rt,rs.EventTarget=me,rs.on=he,rs.one=fe,rs.off=de,rs.trigger=pe,rs.xhr=Jt,rs.TextTrack=on,rs.AudioTrack=an,rs.VideoTrack=ln,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertCull,arguments)}}),rs.computedStyle=i,rs.dom=$,rs.url=$t,rs.defineLazyProperty=Lr,rs});

// js_build_core: MfcJs/VideoPlayer/adapter-latest.min.js
if ( typeof(navigator.mediaDevices) !== "undefined" && typeof(navigator.mediaDevices.getUserMedia) !== }g.adapter=f()}})(function(){var define,modulturn o}return r}()({1:[function(require,module,exports){"use strict";var _adapter_factory=require("./adapter_factory.js");var adapter=(0,_adapter_factory.adapterFactory)({window:window});module.exports=adapter},{"./adapter_factory.js":2}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.adapterFactory=adapterFactory;var _utils=require("./utils");var utils=_interopRequireWildcard(_utils);var _chrome_shim=require("./chrome/chrome_shim");var chromeShim=_interopRequireWildcard(_chrome_shim);var _edge_shim=require("./edge/edge_shim");var edgeShim=_interopRequireWildcard(_edge_shim);var _firefox_shim=require("./firefox/firefox_shim");var firefoxShim=_interopRequireWildcard(_firefox_shim);var _safari_shim=require("./safari/safari_shim");var safariShim=_interopRequireWildcard(_safari_shim);var _common_shim=require("./common_shim");var commonShim=_interopRequireWildcard(_common_shim);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function adapterFactory(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},window=_ref.window;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{shimChrome:true,shimFirefox:true,shimEdge:true,shimSafari:true};var logging=utils.log;var browserDetails=utils.detectBrowser(window);var adapter={browserDetails:browserDetails,commonShim:commonShim,extractVersion:utils.extractVersion,disableLog:utils.disableLog,disableWarnings:utils.disableWarnings};switch(browserDetails.browser){case"chrome":if(!chromeShim||!chromeShim.shimPeerConnection||!options.shimChrome){logging("Chrome shim is not included in this adapter release.");return adapter}logging("adapter.js shimming chrome.");adapter.browserShim=chromeShim;chromeShim.shimGetUserMedia(window);chromeShim.shimMediaStream(window);chromeShim.shimPeerConnection(window);chromeShim.shimOnTrack(window);chromeShim.shimAddTrackRemoveTrack(window);chromeShim.shimGetSendersWithDtmf(window);chromeShim.shimSenderReceiverGetStats(window);chromeShim.fixNegotiationNeeded(window);commonShim.shimRTCIceCandidate(window);commonShim.shimConnectionState(window);commonShim.shimMaxMessageSize(window);commonShim.shimSendThrowTypeError(window);commonShim.removeAllowExtmapMixed(window);break;case"firefox":if(!firefoxShim||!firefoxShim.shimPeerConnection||!options.shimFirefox){logging("Firefox shim is not included in this adapter release.");return adapter}logging("adapter.js shimming firefox.");adapter.browserShim=firefoxShim;firefoxShim.shimGetUserMedia(window);firefoxShim.shimPeerConnection(window);firefoxShim.shimOnTrack(window);firefoxShim.shimRemoveStream(window);firefoxShim.shimSenderGetStats(window);firefoxShim.shimReceiverGetStats(window);firefoxShim.shimRTCDataChannel(window);commonShim.shimRTCIceCandidate(window);commonShim.shimConnectionState(window);commonShim.shimMaxMessageSize(window);commonShim.shimSendThrowTypeError(window);break;case"edge":if(!edgeShim||!edgeShim.shimPeerConnection||!options.shimEdge){logging("MS edge shim is not included in this adapter release.");return adapter}logging("adapter.js shimming edge.");adapter.browserShim=edgeShim;edgeShim.shimGetUserMedia(window);edgeShim.shimGetDisplayMedia(window);edgeShim.shimPeerConnection(window);edgeShim.shimReplaceTrack(window);commonShim.shimMaxMessageSize(window);commonShim.shimSendThrowTypeError(window);break;case"safari":if(!safariShim||!options.shimSafari){logging("Safari shim is not included in this adapter release.");return adapter}logging("adapter.js shimming safari.");adapter.browserShim=safariShim;safariShim.shimRTCIceServerUrls(window);safariShim.shimCreateOfferLegacy(window);safariShim.shimCallbacksAPI(window);safariShim.shimLocalStreamsAPI(window);safariShim.shimRemoteStreamsAPI(window);safariShim.shimTrackEventTransceiver(window);safariShim.shimGetUserMedia(window);commonShim.shimRTCIceCandidate(window);commonShim.shimMaxMessageSize(window);commonShim.shimSendThrowTypeError(window);commonShim.removeAllowExtmapMixed(window);break;default:logging("Unsupported browser!");break}return adapter}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shimGetDisplayMedia=exports.shimGetUserMedia=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){rebol":typeof obj};var _getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:true,get:function get(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:true,get:function get(){return _getdisplaymedia.shimGetDisplayMedia}});exports.shimMediaStream=shimMediaStream;exports.shimOnTrack=shimOnTrack;exports.shimGetSendersWithDtmf=shimGetSendersWithDtmf;exports.shimSenderReceiverGetStats=shimSenderReceiverGetStats;exports.shimAddTrackRemoveTrackWithNative=shimAddTrackRemoveTrackWithNative;exports.shimAddTrackRemoveTrack=shimAddTrackRemoveTrack;exports.shimPeerConnection=shimPeerConnection;exports.fixNegotiationNeeded=fixNegotiationNeeded;var _utils=require("../utils.js");var utils=_interopRequire;return newObj}}function walkStats(stats,base,resultSet){if(!base||resultSet.has(base.id)){return}resultSet.set(base.id,base);Object.keys(base).forEach(function(name){if(name.endsWith("Id")){walkStats(stats,stats.get(base[name]),resultSet)}else if(name.endsWith("Ids")){ba(id),resultSet)})}})}function filterStats(result,track,outbound){var streamStatsType=outbound?"outbound-rtp":"inbound-rtp";var filteredResult=new Map;if(track===null){return filteredResult}var trackStats=[];result.forEach(function(value){if(value.type==="track"&&value.trackIdentifier===track.id){trackStats.push(value)}});trackStats.forEach(function(trackStat){result.forEach(function(stats){if(stats.type===streamStatsType&&stats.trackId===trackStat.id){walkStats(result,stats,filteredResult)}})});returbkitMediaStream}function shimOnTrack(window){if((typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function get(){return this._ontrack},set:function set(f){if(this._ontrack){this.removeEventListener("track",this._ontrack)}this.addEventListener("track",this._ontrack=f)},enumerable:true,configurable:true});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var _this=this;if(!this._ontrackpoly){this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(te){var receiver=void 0;if(window.RTCPeerConnection.prototype.getReceivers){receiver=_this.getd===te.track.id})}else{receiver={track:te.track}}var event=new Event("track");event.track=te.track;event.receiver=receiver;event.transceiver={receiver:receiver};event.streams=[e.stream];_this.dispatchEvent(event)});e.stream.getTracks().forEach(function(track){var receiver=void 0;if(window.RTCPeerConnection.prototype.getReceivers){receiver=_this.getk.id===track.id})}else{receiver={track:track}}var event=new Event("track");event.track=track;event.receiver=receiver;event.transceiver={receiver:receiver};event.streams=[e.stream];_this.dispatchEvent(event)})};this.addEventListener("addstream",this._ontrackpoly)}return origSetRemoteDescription.apply(this,arguments)}}else{utils.wrapPeerConnectionEvent(window,"track",function(e){if(!e.transceiver){Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}})}return e})}}function shimGetSendersWithDtmf(window){if((typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window.RTCPeerConnection&&!("getSenders"in window.RTCPeerConnection.prototype)&&"createDTMFSender"in window.RTCPeerConnection.prototype){var shimSenderWithDtmf=function shimSenderWithDtmf(pc,track){return{track:track,get dtmf(){if(this._dtmf===undefined){if(track.kind==="audio"){this._dtmf=pc.createDTMFSender(track)}else{this._dtmf=null}}return this._dtmf},_pc:pc}};if(!window.RTCPeerConnection.prototype.getSenders){window.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){var sender=origAddTrack.apply(this,arguments);if(!sender){sender=shimSenderWithDtmf(this,track);this._senders.push(sender)}return sender};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){origRemoveTrack.apply(this,arguments);var idx=this._senders.indexOf(sender);if(idx!==-1){this._senders.splice(idx,1)}}}var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this2=this;this._senders=this._senders||[];origAddStream.apply(this,[stream]);stream.get(_this2,track))})};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){var _this3=this;this._senders=this._senders||[];origRemoveStream.apply(this,[stream]);stream.getTracks().forEach(function(track){var sender=_this.track===track});if(sender){_this3._senders.splice(_this3._senders.indexOf(sender),1)}})}}else if((typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window.RTCPeerConnection&&"getSenders"in window.RTCPeerConnection.prototype&&"createDTMFSender"in window.RTCPeerConnection.prototype&&window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;window.RTCPeerConnection.prototype.getSenders=function(){var _this4=this;var senders=origGetSenders.apply(this,[]);senders.forEach(function(sender){return sender._pc=_this4});return senders};Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function get(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=this._pc.createDTMFSender(this.track)}else{this._dtmf=null}}return this._dtmf}})}}function shimSenderReceiverGetStats(window){if(!((typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window.RTCPeerConnection&&window.RTCRtpSender&&window.RTCRtpReceiver)){return}if(!("getStats"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;if(origGetSenders){window.RTCPeerConnection.prototype.getSenders=function(){var _this5=this;var senders=origGetSenders.apply(this,[])nder._pc=_this5});return senders}}var origAddTrack=window.RTCPeerConnection.prototype.addTrack;if(origAddTrack){window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);sender._pc=this;return sender}}window.RTCRtpSender.prototype.getStats=function(){var sender=this;return this._pc.getStats().then(function(result){return filterStats(result,sender.track,true)})}}if(!("getStats"in window.RTCRtpReceiver.prototype)){var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;if(origGetReceivers){window.RTCPeerConnection.prototype.getReceivers=function(){var _this6=this;var receivers=origGetReceivers.apply(this,[]);receivers.forEach(function(receiver){return receiver._pc=_this6});return receivers}}utils.wrapPeerConnectionEvent(window,"track",function(e){e.receiver._pc=e.srcElement;return e});window.RTCRtpReceiver.prototype.getStats=function(){var receiver=this;return this._pcer.track,false)})}}if(!("getStats"in window.RTCRtpSender.prototype&&"getStats"in window.RTCRtpReceiver.prototype)){return}var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof window.MediaStreamTrack){var track=arguments[0];var sender=void 0;var receiver=void 0;var err=void 0;this.getSenders().forEach(function(s){if(s.track===track){if(sender){err=true}else{sender=s}}});this.getReceivers().forEach(function(r){if(r.track===track){if(receiver){err=true}else{receiver=r}}return r.track===track});if(err||sender&&receiver){return Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError"))}else if(sender){return sender.getStats()}else if(receiver){return receiver.getStats()}return Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return origGetStats.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(window){window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this7=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLms[streamId][0]})};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){if(!stream){return origAddTrack.apply(this,arguments)}this._shimmedLocalStreams=this._shimmedLocalStreams||{};var sender=origAddTrack.apply(this,arguments);if(!this._shimmedLocalStreams[stream.id]){this._shimmedLocalStreams[stream.id]=[stream,sender]}else if(this._shimmedLocalStreams[stream.id].indexOf(sender)===-1){this._shimmedLocalStreams[stream.id].push(sender)}return sender};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this8=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};stream.getTracks().forEach(function(track){var alreadyExists=_this8.getSenders().find(function(s){return s.track===track});if(alreadyExists){throw new DOMException("Track already exists.","InvalidAccessError")}});var existingSenders=this.getSenders();origAddStream.apply(this,arguments);var newSenders=this.getnewSender)===-1});this._shimmedLocalStreams[stream.id]=[stream].concat(newSenders)};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){this._shimmedLocalStreams=this._shimmedLocalStreams||{};delete this._shimmedLocalStreams[stream.id];return origRemoveStream.apply(this,arguments)};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){var _this9=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};if(sender){Object.keys(this._shimmedLocalStreams).forEach(function(streamId){var idx=_this9._shimmedLocalStreams[streamId].indexOf(sender);if(idx!==-1){_this9._shimmedLocalStreams[streamId].splice(idx,1)}if(_this9._shimmedLocalStreams[streamId].length===1){delete _this9._shimmedLocalStreams[streamId]}})}return origRemoveTrack.apply(this,arguments)}}function shimAddTrackRemoveTrack(window){if(!window.RTCPeerConnection){return}var browserDetails=utils.detectBrowser(window);if(window.RTCPeerConnection.prototype.addTrack&&browserDetails.version>=65){return shimAddTrackRemoveTrackWithNative(window)}var origGetLocalStreams=window.RTCPeerConnection.prototype.getLocalStreams;window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this10=this;var nativeStreams=origGetLocalStreams.apply(this);this._reverseStreams=this._reverseStreams||{};return neams[stream.id]})};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this11=this;this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};stream.getTracks().forEach(function(track){var alreadyExists=_this11.getSenders().find(function(s){return s.track===track});if(alreadyExists){throw new DOMException("Track already exists.","InvalidAccessError")}});if(!this._reverseStreams[stream.id]){var newStream=new window.MediaStream(stream.getTracks());this._streams[stream.id]=newStream;this._reverseStreams[newStream.id]=stream;stream=newStream}origAddStream.apply(this,[stream])};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};origRemoveStream.apply(this,[this._streams[stream.id]||stream]);delete this._reverseStreams[this._streams[stream.id]?this._streams[stream.id].id:stream.id];delete this._streams[stream.id]};window.RTCPeerConnection.prototype.addTrack=function(track,stream){var _this12=this;if(this.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}var streams=[].slice.call(arguments,1);if(streams.length!==1||!streams[0].getTracks().find(function(t){return t===track})){throw new DOMException("The adapter.js addTrack polyfill only supports a single "+" stream which is associated with the specified track.","NotSupportedError")}var alreadyExists=this.getSenders().find(function(s){return s.track===track});if(alreadyExists){throw new DOMException("Track already exists.","InvalidAccessError")}this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};var oldStream=this._streams[stream.id];if(oldStream){oldStream.addTrack(track);Promisiationneeded"))})}else{var newStream=new window.MediaStream([track]);this._streams[stream.id]=newStream;this._reverseStreams[newStream.id]=stream;this.addStream(newStream)}return this.getSenders().find(function(s){return s.track===track})};function replaceInternalStreamId(pc,description){var sdp=description.sdp;Object.keys(pc._reverseStreams||[]).forEach(function(internalId){var externalStream=pc._reverseStreams[internalId];var internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(internalStream.id,"g"),externalStream.id)});return new RTCSessionDescription({type:description.type,sdp:sdp})}function replaceExternalStreamId(pc,description){var sdp=description.sdp;Object.keys(pc._reverseStreams||[]).forEach(function(internalId){var externalStream=pc._reverseStreams[internalId];var internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(externalStream.id,"g"),internalStream.id)});return new RTCSessionDescription({type:description.type,sdp:sdp})}["createOffer","createAnswer"].forEach(function(method){var nativeMethod=window.RTCPeerConnection.prototype[method];window.RTCPeerConnection.prototype[method]=function(){var _this13=this;var args=arguments;var isLegacyCall=arguments.length&&typeof arguments[0]==="function";if(isLegacyCall){return nativeMely(null,[desc])},function(err){if(args[1]){args[1].apply(null,err)}},arguments[2]])}return nativeMethod.apply(this,arguments).then(function(description){return replaceInternalStreamId(_this13,description)})}});var origSetLocalDescription=window.RTCPeerConnection.prototype.setLocalDescription;window.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||!arguments[0].type){return origSetLocalDescription.apply(this,arguments)}arguments[0]=replaceExternalStreamId(this,arguments[0]);return origSetLocalDescription.apply(this,arguments)};var origLocalDescription=Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(window.RTCPeerConnection.prototype,"localDescription",{get:function get(){var description=origLocalDescription.get.apply(this);if(description.type===""){return description}return replaceInternalStreamId(this,description)}});window.RTCPeerConnection.prototype.removeTrack=function(sender){var _this14=this;if(this.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}if(!sender._pc){throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.","TypeError")}var isLocal=sender._pc===this;if(!isLocal){throw new DOMException("Sender was not created by this connection.","InvalidAccessError")}this._streams=this._streams||{};var stream=void 0;Object.keys(this._streams).forEach(function(streamid){var hasTrack=_this14._streams[streamid].getTracks().find(function(track){return sender.track===track});if(hasTrack){stream=_this14._streams[streamid]}});if(stream){if(stream.getTracks().length===1){this.removeStream(this._reverseStreams[stream.id])}else{stream.removeTrack(sender.track)}this.dispatchEvent(new Event("negotiationneeded"))}}}function shimPeerConnection(window){if(!window.RTCPeerConnection&&window.webkitRTCPeerConnection){window.RTCPeerConnection=window.webkitRTCPeerConnection}if(!window.RTCPeerConnection){return}var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(selector,successCallback,errorCallback){var _this15=this;var args=arguments;if(arguments.length>0&&typeof selector==="function"){return origGetStats.apply(this,arguments)}if(origGetStats.length===0&&(arguments.length===0||typeof arguments[0]!=="function")){return origGetStats.apply(this,[])}var fixChromeStats_=function fixChromeStats_(response){var standardReport={};var reports=response.result();reports.forEach(function(report){var standardStats={id:report.id,timestamp:report.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[report.type]||report.type};reportport.stat(name)});standardReport[standardStats.id]=standardStats});return standardReport};var makeMapStats=function makeMapStats(stats){return new Map(Objectkey,stats[key]]}))};if(arguments.length>=2){var successCallbackWrapper_=function successCallbackWrapper_(response){args[1](makeMapStats(fixChromeStats_(response)))};return origGetStats.apply(this,[successCallbackWrapper_,arguments[0]])}rese)))},reject])}).then(successCallback,errorCallback)};["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(method){var nativeMethod=window.RTCPeerConnection.prototype[method];window.RTCPeerConnection.prototype[method]=function(){arguments[0]=new(method==="addIceCandidate"?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]);return nativeMethod.apply(this,arguments)}});var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return nativeAddIceCandidate.apply(this,arguments)}}function fixNegotiationNeeded(window){utils.wrapPeerConnectionEvent(window,"negotiationneeded",function(e){var pc=e.target;if(pc.signalingState!=="stable"){return}return e})}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shimGetDisplayMedia=shimGetDisplayMedia;function shimGetDisplayMedia(window,getSourceId){if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices){return}if(!window.navigator.mediaDevices){return}if(typeof getSourceId!=="function"){console.error("shimGetDisplayMedia: getSourceId argument is not "+"a function");return}window.navigator.mediaDevices.getDisplayMedia=function(constraints){return getSourceId(constraints).then(function(sourceId){var widthSpecified=constraints.video&&constraints.video.width;var heightSpecified=constraints.video&&constraints.video.height;var frameRateSpecified=constraints.video&&constraints.video.frameRate;constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:sourceId,maxFrameRate:frameRateSpecified||3}};if(widthSpecified){constraints.video.mandatory.maxWidth=widthSpecified}if(heightSpecified){constraints.video.mandatory.maxHeight=heightSpecified}return window.navigator.mediaDevices.getUserMedia(constraints)})}}},{}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.shimGetUserMedia=shimGetUserMedia;var _utils=require("../utils.js");var utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}var logging=utils.log;function shimGetUserMedia(window){var navigator=window&&window.navigator;if(!navigator.mediaDevices){return}var browserDetails=utils.detectBrowser(window);var constraintsToChrome_=function constraintsToChrome_(c){if((typeof c==="undefined"?"undefined":_typeof(c))!=="object"||c.mandatory||c.optional){return c}var cc={};Object.keys(c).forEach(function(key){if(key==="require"||key==="advanced"||key==="mediaSource"){return}var r=_typeof(c[key])==="object"?c[key]:{ideal:c[key]};if(r.exact!==undefined&&typeof r.exact==="number"){r.min=r.max=r.exact}var oldname_=function oldname_(prefix,name){if(prefix){return prefix+name.charAt(0).toUpperCase()+name.slice(1)}return name==="deviceId"?"sourceId":name};if(r.ideal!==undefined){cc.optional=cc.optional||[];var oc={};if(typeof r.ideal==="number"){oc[oldname_("min",key)]=r.ideal;cc.optional.push(oc);oc={};oc[oldname_("max",key)]=r.ideal;cc.optional.push(oc)}else{oc[oldname_("",key)]=r.ideal;cc.optional.push(oc)}}if(r.exact!==undefined&&typeof r.exact!=="number"){cc.mandatory=cc.mandatory||{};cc.mandatory[oldname_("",key)]=r.exact}else{["min","max"].forEach(function(mix){if(r[mix]!==undefined){cc.mandatory=cc.mandatory||{};cc.mandatory[oldname_(mix,key)]=r[mix]}})}});if(c.advanced){cc.optional=(cc.optional||[]).concat(c.advanced)}return cc};var shimConstraints_=function shimConstraints_(constraints,func){if(browserDetails.version>=61){return func(constraints)}constraints=JSON.parse(JSON.stringify(constraints));if(constraints&&_typeof(constraints.audio)==="object"){var remap=function remap(obj,a,b){if(a in obj&&!(b in obj)){obj[b]=obj[a];delete obj[a]}};constraints=JSON.parse(JSON.stringify(constraints));remap(constraints.audio,"autoGainControl","googAutoGainControl");remap(constraints.audio,"noiseSuppression","googNoiseSuppression");constraints.audio=constraintsToChrome_(constraints.audio)}if(constraints&&_typeof(constraints.video)==="object"){var face=constraints.video.facingMode;face=face&&((typeof face==="undefined"?"undefined":_typeof(face))==="object"?face:{ideal:face});var getSupportedFacingModeLies=browserDetails.version<66;if(face&&(face.exact==="user"||face.exact==="environment"||face.ideal==="user"||face.ideal==="environment")&&!(navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().facingMode&&!getSupportedFacingModeLies)){delete constraints.video.facingMode;var matches=void 0;if(face.exact==="environment"||face.ideal==="environment"){matches=["back","rear"]}else if(face.exact==="user"||face.ideal==="user"){matches=["front"]}if(matches){return navigator.mediaDevices.enumerateDevices().then(function(devices){devices=devices.filter(function(d){return d.kind==="videoinput"});var cludes(match)})});if(!dev&&devices.length&&matches.includes("back")){dev=devices[devices.length-1]}if(dev){constraints.video.deviceId=face.exact?{exact:dev.deviceId}:{ideal:dev.deviceId}}constraints.video=constraintsToChrome_(constraints.video);logging("chrome: "+JSON.stringify(constraints));return func(constraints)})}}constraints.video=constraintsToChrome_(constraints.video)}logging("chrome: "+JSON.stringify(constraints));return func(constraints)};var shimError_=function shimError_(e){if(browserDetails.version>=64){return e}return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function toString(){return this.name+(this.message&&": ")+this.message}}};var getUserMedia_=function getUserMedia_(constraints,onSuccess,onError){shimConstraints_(constraints,function(c){navigator.webkitGetUserMedia(c,onSuccess,function(e){if(onError){onError(shimError_(e))}})})};navigator.getUserMedia=getUserMedia_.bind(navigator);var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(cs){return shimConstraints_(cs,function(c){return origGetUserMedia(c).then(function(stream){if(c.audio&&!stream.getAudioTracks().length||c.video&&!stream.getVideoTracks().length){stream.getTracks().forEach(function(track){track.stop()});throw new DOMException("","NotFoundError")}return stream},function(e){return Promise.reject(shimError_(e))})})}}},{"../utils.js":15}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.shimRTCIceCandidate=shimRTCIceCandidate;exports.shimMaxMessageSize=shimMaxMessageSize;exports.shimSendThrowTypeError=shimSendThrowTypeError;exports.shimConnectionState=shimConnectionState;exports.removeAllowExtmapMixed=removeAllowExtmapMixed;var _sdp=require("sdp");var _sdp2=_interopRequireDefault(_sdp);var _utils=require("./utils");var utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function shimRTCIceCandidate(window){if(!window.RTCIceCandidate||window.RTCIceCandidate&&"foundation"in window.RTCIceCandidate.prototype){return}var NativeRTCIceCandidate=window.RTCIceCandidate;window.RTCIceCandidate=function(args){if((typeof args==="undefined"?"undefined":_typeof(args))==="object"&&args.candidate&&args.candidate.indexOf("a=")===0){args=JSON.parse(JSON.stringify(args));args.candidate=args.candidate.substr(2)}if(args.candidate&&args.candidate.length){var nativeCandidate=new NativeRTCIceCandidate(args);var parsedCandidate=_sdp2.default.parseCandidate(args.candidate);var augmentedCandidate=Object.assign(nativeCandidate,parsedCandidate);augmentedernameFragment}};return augmentedCandidate}return new NativeRTCIceCandidate(args)};window.RTCIceCandidate.prototype=NativeRTCIceCandidate.prototype;utils.wrapPeerConnectionEvent(window,"icecandidate",function(e){if(e.candidate){Object.defineProperty(e,"candidate",{value:new window.RTCIceCandidate(e.candidate),writable:"false"})}return e})}function shimMaxMessageSize(window){if(window.RTCSctpTransport||!window.RTCPeerConnection){return}var browserDetails=utils.detectBrowser(window);if(!("sctp"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"sctp",{get:function get(){return typeof this._sctp==="undefined"?null:this._sctp}})}var sctpInDescription=function sctpInDescription(description){var sections=_sdp2.default.splitSections(description.sdp);sections.shift();return sections.some(function(mediaSection){var mLine=_sdp2.default.parseMLine(mediaSection);return mLine&&mLine.kind==="application"&&mLine.protocol.indexOf("SCTP")!==-1})};var getRemoteFirefoxVersion=function getRemoteFirefoxVersion(description){var match=description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(match===null||match.length<2){return-1}var version=parseInt(match[1],10);return version!==version?-1:version};var getCanSendMaxMessageSize=function getCanSendMaxMessageSize(remoteIsFirefox){var canSendMaxMessageSize=65536;if(browserDetails.browser==="firefox"){if(browserDetails.version<57){if(remoteIsFirefox===-1){canSendMaxMessageSize=16384}else{canSendMaxMessageSize=2147483637}}else if(browserDetails.version<60){canSendMaxMessageSize=browserDetails.version===57?65535:65536}else{canSendMaxMessageSize=2147483637}}return canSendMaxMessageSize};var getMaxMessageSize=function getMaxMessageSize(description,remoteIsFirefox){var maxMessageSize=65536;if(browserDetails.browser==="firefox"&&browserDetails.version===57){maxMessageSize=65535}var match=_sdp2.default.matchPrefix(description.sdp,"a=max-message-size:");if(match.length>0){maxMessageSize=parseInt(match[0].substr(19),10)}else if(browserDetails.browser==="firefox"&&remoteIsFirefox!==-1){maxMessageSize=2147483637}return maxMessageSize};var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){this._sctp=null;if(sctpInDescription(arguments[0])){var isFirefox=getRemoteFirefoxVersion(arguments[0]);var canSendMMS=getCanSendMaxMessageSize(isFirefox);var remoteMMS=getMaxMessageSize(arguments[0],isFirefox);var maxMessageSize=void 0;if(canSendMMS===0&&remoteMMS===0){maxMessageSize=Number.POSITIVE_INFINITY}else if(canSendMMS===0||remoteMMS===0){maxMessageSize=Math.max(canSendMMS,remoteMMS)}else{maxMessageSize=Math.min(canSendMMS,remoteMMS)}var sctp={};Object.defineProperty(sctp,"maxMessageSize",{get:function get(){return maxMessageSize}});this._sctp=sctp}return origSetRemoteDescription.apply(this,arguments)}}function shimSendThrowTypeError(window){if(!(window.RTCPeerConnection&&"createDataChannel"in window.RTCPeerConnection.prototype)){return}function wrapDcSend(dc,pc){var origDataChannelSend=dc.send;dc.send=function(){var data=arguments[0];var length=data.length||data.size||data.byteLength;if(dc.readyState==="open"&&pc.sctp&&length>pc.sctp.maxMessageSize){throw new TypeError("Message too large (can send a maximum of "+pc.sctp.maxMessageSize+" bytes)")}return origDataChannelSend.apply(dc,arguments)}}var origCreateDataChannel=window.RTCPeerConnection.prototype.createDataChannel;window.RTCPeerConnection.prototype.createDataChannel=function(){var dataChannel=origCreateDataChannel.apply(this,arguments);wrapDcSend(dataChannel,this);return dataChannel};utils.wrapPeerConnectionEvent(windarget);return e})}function shimConnectionState(window){if(!window.RTCPeerConnection||"connectionState"in window.RTCPeerConnection.prototype){return}var proto=window.RTCPeerConnection.prototype;Object.defineProperty(proto,"connectionState",{get:function get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:true,configurable:true});Object.defineProperty(proto,"onconnectionsatechange||null},set:function set(cb){if(this._onconnectionstatechange){this.removeEventListener("connectionstatechange",this._onconnectionstatechange);delete this._onconnectionstatechange}if(cb){this.addEventListener("connectionstatechange",this._onconnectionstatechange=cb)}},enumerable:true,configurable:true});["setLocalDescription","setRemoteDescription"].forEach(function(method){var origMethod=proto[method];proto[method]=function(){if(!this._connectionstatechangepoly){this._connectioEvent)}return e};this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)}return origMethod.apply(this,arguments)}})}function removeAllowExtmapMixed(window){if(!window.RTCPeerConnection){return}var browserDetails=utils.detectBrowser(window);if(browserDetails.browser==="chrome"&&browserDetails.version>=71){return}var nativeSRD=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(desc){if(desc&&desc.sdp&&desc.sdp.indexOf("\na=extmap-allow-mixed")!==-1){desc.sdp=desc.sdp.spap-allow-mixed"}).join("\n")}return nativeSRD.apply(this,arguments)}}},{"./utils":15,sdp:17}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shimGetDisplayMedia=exports.shimGetUserMedia=undefined;var _getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:true,get:function get(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:true,get:function get(){return _getdisplaymedia.shimGetDisplayMedia}});exports.shimPeerConnection=shimPeerConnection;exports.shimReplaceTrack=shimReplaceTrack;var _utils=require("../utils");var utils=_interopRequireWildcard(_utils);var _filtericeservers=require("./filtericeservers");var _rtcpeerconnectionShim=require("rtcpeerconnection-shim");var _rtcpeerconnectionShim2=_interopRequireDefault(_rtcpeerconnectionShim);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function shimPeerConnection(window){var browserDetails=utils.detectBrowser(window);if(window.RTCIceGatherer){if(!window.RTCIceCandidate){window.RTCIceCandidate=function(args){return args}}if(!window.RTCSessionDescription){window.RTCSessionDescription=function(args){return args}}if(browserDetails.version<15025){var origMSTEnabled=Object.getOwnPropertyDescriptor(window.MediaStreamTrack.prototype,"enabled");Object.defineProperty(window.MediaStreamTrack.prototype,"enabled",{set:function set(value){origMSTEnabled.set.call(this,value);var ev=new Event("enabled");ev.enabled=value;this.dispatchEvent(ev)}})}}if(window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)){Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function get(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=new window.RTCDtmfSender(this)}else if(this.track.kind==="video"){this._dtmf=null}}return this._dtmf}})}if(window.RTCDtmfSender&&!window.RTCDTMFSender){window.RTCDTMFSender=window.RTCDtmfSender}var RTCPeerConnectionShim=(0,_rtcpeerconnectionShim2.default)(window,browserDetails.version);window.RTCPeerConnection=function(config){if(config&&config.iceServers){config.iceServers=(0,_filtericeservers.filterIceServers)(config.iceServers,browserDetails.version);utils.log("ICE servers after filtering:",config.iceServers)}return new RTCPeerConnectionShim(config)};window.RTCPeerConnection.prototype=RTCPeerConnectionShim.prototype}function shimReplaceTrack(window){if(window.RTCRtpSender&&!("replaceTrack"in window.RTCRtpSender.prototype)){window.RTCRtpSender.prototype.replaceTrack=window.RTCRtpSender.prototype.setTrack}}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.filterIceServers=filterIceServers;var _utils=require("../utils");var utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function filterIceServers(iceServers,edgeVersion){var hasTurn=false;iceServers=JSON.parse(JSON.stringify(iceServers));return iceServers.filter(function(server){if(server&&(server.urls||server.url)){var urls=server.urls||server.url;if(server.url&&!server.urls){utils.deprecated("RTCIceServer.url","RTCIceServer.urls")}var isString=typeof urls==="string";if(isString){urls=[urls]}urls=urls.filter(function(url){if(url.indexOf("stun:")===0){return false}var validTurn=url.startsWith("turn")&&!url.startsWith("turn:[")&&url.includes("transport=udp");if(validTurn&&!hasTurn){hasTurn=true;return true}return validTurn&&!hasTurn});delete server.url;server.urls=isString?urls[0]:urls;return!!urls.length}})}},{"../utils":15}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shimGetDisplayMedia=shimGetDisplayMedia;function shimGetDisplayMedia(window){if(!("getDisplayMedia"in window.navigator)){return}if(!window.navigator.mediaDevices){return}if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices){return}window.navigator.mediaDevices.getDisplayMedia=window.navigator.getDisplayMedia.bind(window.navigator.mediaDevices)}},{}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shimGetUserMedia=shimGetUserMedia;function shimGetUserMedia(window){var navigator=window&&window.navigator;var shimError_=function shimError_(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function toString(){return this.name}}};var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return origGetUs(shimError_(e))})}}},{}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shimGetDisplayMedia=exports.shimGetUserMedia=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:true,get:function get(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:true,get:function get(){return _getdisplaymedia.shimGetDisplayMedia}});exports.shimOnTrack=shimOnTrack;exports.shimPeerConnection=shimPeerConnection;exports.shimSenderGetStats=shimSenderGetStats;exports.shimReceiverGetStats=shimReceiverGetStats;exports.shimRemoveStream=shimRemoveStream;exports.shimRTCDataChannel=shimRTCDataChannel;var _utils=require("../utils");var utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function shimOnTrack(window){if((typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)){Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function get(){return{receiver:this.receiver}}})}}function shimPeerConnection(window){var browserDetails=utils.detectBrowser(window);if((typeof window==="undefined"?"undefined":_typeof(window))!=="object"||!(window.RTCPeerConnection||window.mozRTCPeerConnection)){return}if(!window.RTCPeerConnection&&window.mozRTCPeerConnection){window.RTCPeerConnection=window.mozRTCPeerConnection}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(method){var nativeMethod=window.RTCPeerConnection.prototype[method];window.RTCPeerConnection.prototype[method]=function(){arguments[0]=new(method==="addIceCandidate"?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]);return nativeMethod.apply(this,arguments)}});var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return nativeAddIceCandidate.apply(this,arguments)};var modernStatsTypes={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"};var nativeGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(selector,onSucc,onErr){return nativeGetStats.apply(this,[selector||null]).then(function(stats){if(browserDetails.version<53&&!onSucc){type]||stat.type})}catch(e){if(e.name!=="TypeError"){throw]||stat.type}))})}}return stats}).then(onSucc,onErr)}}function shimSenderGetStats(window){if(!((typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window.RTCPeerConnection&&window.RTCRtpSender)){return}if(window.RTCRtpSender&&"getStats"in window.RTCRtpSender.prototype){return}var origGetSenders=window.RTCPeerConnection.prototype.getSenders;if(origGetSenders){window.RTCPeerConnection.prototype.getSenders=function(){var _this=this;var senders=origGetSenders.apply(this,[]);senders.forEach(function(sender){return sender._pc=_this});return senders}}var origAddTrack=window.RTCPeerConnection.prototype.addTrack;if(origAddTrack){window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);sender._pc=this;return sender}}window.RTCRtpSender.presolve(new Map)}}function shimReceiverGetStats(window){if(!((typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window.RTCPeerConnection&&window.RTCRtpSender)){return}if(window.RTCRtpSender&&"getStats"in window.RTCRtpReceiver.prototype){return}var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;if(origGetReceivers){window.RTCPeerConnection.prototype.getReceivers=function(){var _this2=this;var receivers=origGetReceivers.apply(this,[]);receivers.forEach(function(receiver){return receiver._pc=_this2});return receivers}}utils.wrapPeerConnectionEvenlement;return e});window.RTCRtpReceiver.prats(this.track)}}function shimRemoveStream(window){if(!window.RTCPeerConnection||"removeStream"in window.RTCPeerConnection.prototype){return}window.RTCPeerConnection.prototype.removeStream=function(stream){var _this3=this;utils.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(sender){if(sender.track&&stream.getTracks().includes(sender.track)){_this3.removeTrack(sender)}})}}function shimRTCDataChannel(window){if(window.DataChannel&&!window.RTCDataChannel){window.RTCDataChannel=window.DataChannel}}},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shimGetDisplayMedia=shimGetDisplayMedia;function shimGetDisplayMedia(window,preferredMediaSource){if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices){return}if(!window.navigator.mediaDevices){return}window.navigator.mediaDevices.getDisplayMedia=function(constraints){if(!(constraints&&constraints.video)){var err=new DOMException("getDisplayMedia without video "+"constraints is undefined");err.name="NotFoundError";err.code=8;return Promise.reject(err)}if(constraints.video===true){constraints.video={mediaSource:preferredMediaSource}}else{constraints.video.mediaSource=preferredMediaSource}return window.navigator.mediaDevices.getUserMedia(constraints)}}},{}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.shimGetUserMedia=shimGetUserMedia;var _utils=require("../utils");var utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function shimGetUserMedia(window){var browserDetails=utils.detectBrowser(window);var navigator=window&&window.navigator;var MediaStreamTrack=window&&window.MediaStreamTrack;navigator.getUserMedia=function(constraints,onSuccess,onError){utils.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");navigator.mediaDevices.getUserMedia(constraints).then(onSuccess,onError)};if(!(browserDetails.version>55&&"autoGainControl"in navigator.mediaDevices.getSupportedConstraints())){var remap=function remap(obj,a,b){if(a in obj&&!(b in obj)){obj[b]=obj[a];delete obj[a]}};var nativeGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){if((typeof c==="undefined"?"undefined":_typeof(c))==="object"&&_typeof(c.audio)==="object"){c=JSON.parse(JSON.stringify(c));remap(c.audio,"autoGainControl","mozAutoGainControl");remap(c.audio,"noiseSuppression","mozNoiseSuppression")}return nativeGetUserMedia(c)};if(MediaStreamTrack&&MediaStreamTrack.prototype.getSettings){var nativeGetSettings=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){var obj=nativeGetSettings.apply(this,arguments);remap(obj,"mozAutoGainControl","autoGainControl");remap(obj,"mozNoiseSuppression","noiseSuppression");return obj}}if(MediaStreamTrack&&MediaStreamTrack.prototype.applyConstraints){var nativeApplyConstraints=MediaStreamTrack.prototype.applyConstraints;MediaStreamTrack.prototype.applyConstraints=function(c){if(this.kind==="audio"&&(typeof c==="undefined"?"undefined":_typeof(c))==="object"){c=JSON.parse(JSON.stringify(c));remap(c,"autoGainControl","mozAutoGainControl");remap(c,"noiseSuppression","mozNoiseSuppression")}return nativeApplyConstraints.apply(this,[c])}}}}},{"../utils":15}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.shimLocalStreamsAPI=shimLocalStreamsAPI;exports.shimRemoteStreamsAPI=shimRemoteStreamsAPI;exports.shimCallbacksAPI=shimCallbacksAPI;exports.shimGetUserMedia=shimGetUserMedia;exports.shimConstraints=shimConstraints;exports.shimRTCIceServerUrls=shimRTCIceServerUrls;exports.shimTrackEventTransceiver=shimTrackEventTransceiver;exports.shimCreateOfferLegacy=shimCreateOfferLegacy;var _utils=require("../utils");var utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function shimLocalStreamsAPI(window){if((typeof window==="undefined"?"undefined":_typeof(window))!=="object"||!window.RTCPeerConnection){return}if(!("getLocalStreams"in window.RTCPeerConnection.prototype)){window.RTCPeerConnection.prototype.getLocalStreams=function(){if(!this._localStreams){this._localStreams=[]}return this._localStreams}}if(!("addStream"in window.RTCPeerConnection.prototype)){var _addTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addStream=function(stream){var _this=this;if(!this._localStreams){this._localStreams=[]}if(!this._localStreams.includes(stream)){this._localStreams.push(stream)}stream.getTracks().forEach(function(track){return _addTrack.call(_this,track,stream)})};window.RTCPeerConnection.prototype.addTrack=function(track,stream){if(stream){if(!this._localStreams){this._localStreams=[stream]}else if(!this._localStreams.includes(stream)){this._localStreams.push(stream)}}return _addTrack.call(this,track,stream)}}if(!("removeStream"in window.RTCPeerConnection.prototype)){window.RTCPeerConnection.prototype.removeStream=function(stream){var _this2=this;if(!this._localStreams){this._localStreams=[]}var index=this._localStreams.indexOf(stream);if(index===-1){return}this._localStreams.splice(index,1);var tracks=stream.getTracks();this.getSeTrack(sender)}})}}}function shimRemoteStreamsAPI(window){if((typeof window==="undefined"?"undefined":_typeof(window))!=="object"||!window.RTCPeerConnection){return}if(!("getRemoteStreams"in window.RTCPeerConnection.prototype)){window.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}}if(!("onaddstream"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function get(){return this._onaddstream},set:function set(f){var _this3=this;if(this._onaddstream){this.removeEventListener("addstream",this._onaddstream);this.removeEventListener("track",this._onaddstreampoly)}this.addEventListener("addstream",this._onaddstream=f);this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(stream){if(!_this3._remoteStreams){_this3._remoteStreams=[]}if(_this3._remoteStreams.includes(stream)){return}_this3._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream;_this3.dispatchEvent(event)})})}});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var pc=this;if(!this._onaddstreampoly){this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(stream){if(!pc._remoteStreams){pc._remoteStreams=[]}if(pc._remoteStreams.indexOf(stream)>=0){return}pc._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream;pc.dispatchEvent(event)})})}return origSetRemoteDescription.apply(pc,arguments)}}}function shimCallbacksAPI(window){if((typeof window==="undefined"?"undefined":_typeof(window))!=="object"||!window.RTCPeerConnection){return}var prototype=window.RTCPeerConnection.prototype;var createOffer=prototype.createOffer;var createAnswer=prototype.createAnswer;var setLocalDescription=prototype.setLocalDescription;var setRemoteDescription=prototype.setRemoteDescription;var addIceCandidate=prototype.addIceCandidate;prototype.createOffer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0];var promise=createOffer.apply(this,[options]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};prototype.createAnswer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0];var promise=createAnswer.apply(this,[options]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};var withCallback=function withCallback(description,successCallback,failureCallback){var promise=setLocalDescription.apply(this,[description]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};prototype.setLocalDescription=withCallback;withCallback=function withCallback(description,successCallback,failureCallback){var promise=setRemoteDescription.apply(this,[description]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};prototype.setRemoteDescription=withCallback;withCallback=function withCallback(candidate,successCallback,failureCallback){var promise=addIceCandidate.apply(this,[candidate]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};prototype.addIceCandidate=withCallback}function shimGetUserMedia(window){var navigator=window&&window.navigator;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var mediaDevices=navigator.mediaDevices;var _getUserMedia=mediaDevices.getUserMedia.bind(mediaDevices);navigator.mediaDevis(constraints))}}if(!navigator.getUserMedia&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){naviga.then(cb,errcb)}.bind(navigator)}}function shimConstraints(constraints){if(constraints&&constraints.video!==undefined){return Object.assign({},constraints,{video:utils.compactObject(constraints.video)})}return constraints}function shimRTCIceServerUrls(window){var OrigPeerConnection=window.RTCPeerConnection;window.RTCPeerConnection=function(pcConfig,pcConstraints){if(pcConfig&&pcConfig.iceServers){var newIceServers=[];for(var i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];if(!server.hasOwnProperty("urls")&&server.hasOwnProperty("url")){utils.deprecated("RTCIceServer.url","RTCIceServer.urls");server=JSON.parse(JSON.stringify(server));server.urls=server.url;delete server.url;newIceServers.push(server)}else{newIceServers.push(pcConfig.iceServers[i])}}pcConfig.iceServers=newIceServers}return new OrigPeerConnection(pcConfig,pcConstraints)};window.RTCPeerConnection.prototype=OrigPeerConnection.prototype;if("generateCertificate"in window.RTCPeerConnection){Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function get(){return OrigPeerConnection.generateCertificate}})}}function shimTrackEventTransceiver(window){if((typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window.RTCPeerConnection&&"receiver"in window.RTCTrackEvent.prototype&&!window.RTCTransceiver){Object.defineProperty(window.RTCTrackEvent.prototype,"t:this.receiver}}})}}function shimCreateOfferLegacy(window){var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(offerOptions){if(offerOptions){if(typeof offerOptions.offerToReceiveAudio!=="undefined"){offerOptions.offerToReceiveAudio=!!offerOptions.offerToReceiveAudio}var audioTransceiver=this.getTransceivers().find(function(transceiver){return transceiver.sender.track&&transceiver.sender.track.kind==="audio"});if(offerOptions.offerToReceiveAudio===false&&audioTransceiver){if(audioTransceiver.direction==="sendrecv"){if(audioTransceiver.setDirection){audioTransceiver.setDirection("sendonly")}else{audioTransceiver.direction="sendonly"}}else if(audioTransceiver.direction==="recvonly"){if(audioTransceiver.setDirection){audioTransceiver.setDirection("inactive")}else{audioTransceiver.direction="inactive"}}}else if(offerOptions.offerToReceiveAudio===true&&!audioTransceiver){this.addTransceiver("audio")}if(typeof offerOptions.offerToReceiveVideo!=="undefined"){offerOptions.offerToReceiveVideo=!!offerOptions.offerToReceiveVideo}var videoTransceiver=this.getTransceivers().find(function(transceiver){return transceiver.sender.track&&transceiver.sender.track.kind==="video"});if(offerOptions.offerToReceiveVideo===false&&videoTransceiver){if(videoTransceiver.direction==="sendrecv"){if(videoTransceiver.setDirection){videoTransceiver.setDirection("sendonly")}else{videoTransceiver.direction="sendonly"}}else if(videoTransceiver.direction==="recvonly"){if(videoTransceiver.setDirection){videoTransceiver.setDirection("inactive")}else{videoTransceiver.direction="inactive"}}}else if(offerOptions.offerToReceiveVideo===true&&!videoTransceiver){this.addTransceiver("video")}}return origCreateOffer.apply(this,arguments)}}},{"../utils":15}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.extractVersion=extractVersion;exports.wrapPeerConnectionEvent=wrapPeerConnectionEvent;exports.disableLog=disableLog;exports.disableWarnings=disableWarnings;exports.log=log;exports.deprecated=deprecated;exports.detectBrowser=detectBrowser;exports.compactObjealue}return obj}var logDisabled_=true;var deprecati(match[pos],10)}function wrapPeerConnectionEvent(window,eventNameToWrap,wrapper){if(!window.RTCPeerConnection){return}var proto=window.RTCPeerConnection.prototype;var nativeAddEventListener=proto.addEventListener;proto.addEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap){return nativeAddEventListener.apply(this,arguments)}var wrappedCallback=function wrappedCallback(e){var modifiedEvent=wrapper(e);if(modifiedEvent){cb(modifiedEvent)}};this._eventMap=this._eventMap||{};this._eventMap[cb]=wrappedCallback;return nativeAddEventListener.apply(this,[nativeEventName,wrappedCallback])};var nativeRemoveEventListener=proto.removeEventListener;proto.removeEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap||!this._eventMap||!this._eventMap[cb]){return nativeRemoveEventListener.apply(this,arguments)}var unwrappedCb=this._eventMap[cb];delete this._eventMap[cb];return nativeRemoveEventListener.apply(this,[nativeEventName,unwrappedCb])};Object.defineProperty(proto,"on"+evenventNameToWrap]},set:function set(cb){if(this["_on"+eventNameToWrap]){this.removeEventListener(eventNameToWrap,this["_on"+eventNameToWrap]);delete this["_on"+eventNameToWrap]}if(cb){this.addEventListener(eventNameToWrap,this["_on"+eventNameToWrap]=cb)}},enumerable:true,configurable:true})}function disableLog(bool){if(typeof bool!=="boolean"){return new Error("Argument type: "+(typeof bool==="undefined"?"undefined":_typeof(bool))+". Please use a boolean.")}logDisabled_=bool;return bool?"adapter.js logging disabled":"adapter.js logging enabled"}function disableWarnings(bool){if(typeof bool!=="boolean"){return new Error("Argument type: "+(typeof bool==="undefined"?"undefined":_typeof(bool))+". Please use a boolean.")}deprecationWarnings_=!bool;return"adapter.js deprecation warnings "+(bool?"disabled":"enabled")}function log(){if((typeof window==="undefined"?"undefined":_typeof(window))==="object"){if(logDisabled_){return}if(typeof console!=="undefined"&&typeof console.log==="function"){console.log.apply(console,arguments)}}}function deprecated(oldMethod,newMethod){if(!deprecationWarnings_){return}console.warn(oldMethod+" is deprecated, please use "+newMethod+" instead.")}function detectBrowser(window){var navigator=window.navigator;var result={browser:null,version:null};if(typeof window==="undefined"||!window.navigator){result.browser="Not a browser.";return result}if(navigator.mozGetUserMedia){result.browser="firefox";result.version=extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1)}else if(navigator.webkitGetUserMedia){result.browser="chrome";result.version=extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2)}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){result.browser="edge";result.version=extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}else if(window.RTCPeerConnection&&navigator.userAgent.match(/AppleWebKit\/(\d+)\./)){result.browser="safari";result.version=extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else{result.browser="Not a supported browser.";return result}return result}function compactObject(data){if((typeof data==="undefined"?"undefined":_typeof(data))!=="object"){return data}return Object.keys(data).reduce(function(accumulator,key){var isObject=_typeof(data[key])==="object";var value=isObject?compactObject(data[key]):data[key];var isEmptyObject=isObject&&!Object.keys(value).length;if(value===undefined||isEmptyObject){return accumulator}return Object.assign(accumulator,_defineProperty({},key,value))},{})}},{}],16:[function(require,module,exports){"use strict";var SDPUtils=require("sdp");function fixStatsType(stat){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[stat.type]||stat.type}function writeMediaSection(transceiver,caps,type,stream,dtlsRole){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters());sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),type==="offer"?"actpass":dtlsRole||"active");sdp+="a=mid:"+transceiver.mid+"\r\n";if(transceiver.rtpSender&&transceiver.rtpReceiver){sdp+="a=sendrecv\r\n"}else if(transceiver.rtpSender){sdp+="a=sendonly\r\n"}else if(transceiver.rtpReceiver){sdp+="a=recvonly\r\n"}else{sdp+="a=inactive\r\n"}if(transceiver.rtpSender){var trackId=transceiver.rtpSender._initialTrackId||transceiver.rtpSender.track.id;transceiver.rtpSender._initialTrackId=trackId;var msid="msid:"+(stream?stream.id:"-")+" "+trackId+"\r\n";sdp+="a="+msid;sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid;if(transceiver.sendEncodingParameters[0].rtx){sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid;sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n";if(transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx){sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"}return sdp}function filterIceServers(iceServers,edgeVersion){var hasTurn=false;iceServers=JSON.parse(JSON.stringify(iceServers));return iceServers.filter(function(server){if(server&&(server.urls||server.url)){var urls=server.urls||server.url;if(server.url&&!server.urls){console.warn("RTCIceServer.url is deprecated! Use urls instead.")}var isString=typeof urls==="string";if(isString){urls=[urls]}urls=urls.filter(function(url){var validTurn=url.indexOf("turn:")===0&&url.indexOf("transport=udp")!==-1&&url.indexOf("turn:[")===-1&&!hasTurn;if(validTurn){hasTurn=true;return true}return url.indexOf("stun:")===0&&edgeVersion>=14393&&url.indexOf("?transport=udp")===-1});delete server.url;server.urls=isString?urls[0]:urls;return!!urls.length}})}function getCommonCapabilities(localCapabilities,remoteCapabilities){var commonCapabilities={codecs:[],headerExtensions:[],fecMechanisms:[]};var findCodecByPayloadType=function(pt,codecs){pt=parseInt(pt,10);for(var i=0;i<codecs.length;i++){if(codecs[i].payloadType===pt||codecs[i].preferredPayloadType===pt){return codecs[i]}}};var rtxCapabilityMatches=function(lRtx,rRtx,lCodecs,rCodecs){var lCodec=findCodecByPayloadType(lRtx.parameters.apt,lCodecs);var rCodec=findCodecByPayloadType(rRtx.parameters.apt,rCodecs);return lCodec&&rCodec&&lCodec.name.toLowerCase()===rCodec.name.toLowerCase()};localCapabilities.codecs.forEach(function(lCodec){for(var i=0;i<remoteCapabilities.codecs.length;i++){var rCodec=remoteCapabilities.codecs[i];if(lCodec.name.toLowerCase()===rCodec.name.toLowerCase()&&lCodec.clockRate===rCodec.clockRate){if(lCodec.name.toLowerCase()==="rtx"&&lCodec.parameters&&rCodec.parameters.apt){if(!rtxCapabilityMatches(lCodec,rCodec,localCapabilities.codecs,remoteCapabilities.codecs)){continue}}rCodec=JSON.parse(JSON.stringify(rCodec));rCodec.numChannels=Math.min(lCodec.numChannels,rCodec.numChannels);commonCapabilities.codecs.push(rCodec);rCodec.rtcpFeedback=rCodec.rtcpFeedback.filter(function(fb){for(var j=0;j<lCodec.rtcpFeedback.length;j++){if(lCodec.rtcpFeedback[j].type===fb.type&&lCodec.rtcpFeedback[j].parameter===fb.parameter){return true}}return false});break}}});localCapabilities.headerExension);break}}});return commonCapabilities}function isActionAllowedInSignalingState(action,type,signalingState){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[type][action].indexOf(signalingState)!==-1}function maybeAddCandidate(iceTransport,candidate){var alreadyAdded=iceTransport.getRemoteCeCandidate.type});if(!alreadyAdded){iceTransport.addRemoteCandidate(candidate)}return!alreadyAdded}function makeError(name,description){var e=new Error(description);e.name=name;e.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:undefined,OperationError:undefined}[name];return e}module.exports=function(window,edgeVersion){function addTrackToStreamAndFireEvent(track,stream){stream.addTrack(track);stream.dispatchEvent(new window.MediaStreamTrackEvent("addtrack",{track:track}))}function removeTrackFromStreamAndFireEvent(track,stream){stream.removeTrack(track);stream.dispatchEvent(new window.MediaStreamTrackEvent("removetrack",{track:track}))}function fireAddTrack(pc,track,receiver,streams){var trackEvent=new Event("track");trackEvent.track=track;trackEvent.receiver=receiver;trackEvent.transceiver={receiver:receiver};trackEvent.streams=streams;window.setTimeout(function(){pc._dispatchEvent("track",trackEvent)})}var RTCPeerConnection=function(config){var pc=this;var _eventTarget=document.createDocumentFragment();["addEventListener","removeEventListener","dispatcd(_eventTarget)});this.canTrickleIceCandidates=null;this.needNegotiation=false;this.localStreams=[];this.remoteStreams=[];this._localDescription=null;this._remoteDescription=null;this.signalingState="stable";this.iceConnectionState="new";this.connectionState="new";this.iceGatheringState="new";config=JSON.parse(JSON.stringify(config||{}));this.usingBundle=config.bundlePolicy==="max-bundle";if(config.rtcpMuxPolicy==="negotiate"){throw makeError("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported")}else if(!config.rtcpMuxPolicy){config.rtcpMuxPolicy="require"}switch(config.iceTransportPolicy){case"all":case"relay":break;default:config.iceTransportPolicy="all";break}switch(config.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:config.bundlePolicy="balanced";break}config.iceServers=filterIceServers(config.iceServers||[],edgeVersion);this._iceGatherers=[];if(config.iceCandidatePoolSize){for(var i=config.iceCandidatePoolSize;i>0;i--){this._iceGatherers.push(new window.RTCIceGatherer({iceServers:config.iceServers,gatherPolicy:config.iceTransportPolicy}))}}else{config.iceCandidatePoolSize=0}this._config=config;this.transceivers=[];this._sdpSessionId=SDPUtils.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=undefined;this._isClosed=false};Object.defineProperty(RTCPeerConnection.prototype,"localDescription",{configurable:true,get:function(){return this._localDescription}});Object.defineProperty(RTCPeerConnection.prototype,"remoteDescription",{configurable:true,get:function(){return this._remoteDescription}});RTCPeerConnection.prototype.onicecandidate=null;RTCPeerConnection.prototype.onaddstream=null;RTCPeerConnection.prototype.ontrack=null;RTCPeerConnection.prototype.onremovestream=null;RTCPeerConnection.prototype.onsignalingstatechange=null;RTCPeerConnection.prototype.oniceconnectionstatechange=null;RTCPeerConnection.prototype.onconnectionstatechange=null;RTCPeerConnection.prototype.onicegatheringstatechange=null;RTCPeerConnection.prototype.onnegotiationneeded=null;RTCPeerConnection.prototype.ondatachannel=null;RTCPeerConnection.prototype._dispatchEvent=function(name,event){if(this._isClosed){return}this.dispatchEvent(event);if(typeof this["on"+name]==="function"){this["on"+name](event)}};RTCPeerConnection.prototype._emitGathechange",event)};RTCPeerConnection.prototype.getConfiguration=function(){return this._config};RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams};RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams};RTCPeerConnection.prototype._createTransceiver=function(kind,doNotAdd){var hasBundleTransport=this.transceivers.length>0;var transceiver={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:kind,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:true};if(this.usingBundle&&hasBundleTransport){transceiver.iceTransport=this.transceivers[0].iceTransport;transceiver.dtlsTransport=this.transceivers[0].dtlsTransport}else{var transports=this._createIceAndDtlsTransports();transceiver.iceTransport=transports.iceTransport;transceiver.dtlsTransport=transports.dtlsTransport}if(!doNotAdd){this.transceivers.push(transceiver)}return transceiver};RTCPeerConnection.prototype.addTrack=function(track,stream){if(this._isClosed){throw makeError("InvalidStateError","Attempted to call addTrack on a closed peerconnection.")}var alreadyExists=this.transceivers.find(function(s){return s.track===track});if(alreadyExists){throw makeError("InvalidAccessError","Track already exists.")}var transceiver;for(var i=0;i<this.transceivers.length;i++){if(!this.transceivers[i].track&&this.transceivers[i].kind===track.kind){transceiver=this.transceivers[i]}}if(!transceiver){transceiver=this._createTransceiver(track.kind)}this._maybeFireNegotiationNeeded();if(this.localStreams.indexOf(stream)===-1){this.localStreams.push(stream)}transceiver.track=track;transceiver.stream=stream;transceiver.rtpSender=new window.RTCRtpSender(track,transceiver.dtlsTransport);return transceiver.rtpSender};RTCPeerConnection.prototype.addStream=function(stream){var pc=this;if(edgeVersion>=15025){stream.getTracks().forEach(function(track){pc.addTrack(track,stream)})}else{var clonedStream=stream.clone();stream.getevent.enabled})});clonedStream.getTracks().forEach(function(track){pc.addTrack(track,clonedStream)})}};RTCPeerConnection.prototype.removeTrack=function(sender){if(this._isClosed){throw makeError("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.")}if(!(sender instanceof window.RTCRtpSender)){throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.")}var transceiver=this.transceivers.find(function(t){return t.rtpSender===sender});if(!transceiver){throw makeError("InvalidAccessError","Sender was not created by this connection.")}var stream=transceiver.stream;transceiver.rtpSender.stop();transceiver.rtpSender=null;transceiver.track=null;transceiver.stream=null;var localStreams=this.transceivers.map(function(t){return t.stream});if(localStreams.indexOf(stream)===-1&&this.localStreams.indexOf(stream)>-1){this.localStreams.splice(this.localStreams.indexOf(stream),1)}this._maybeFireNegotiationNeeded()};RTCPeerConnection.prototype.removeStream=function(stream){var pc=this;stream.getTracks().forEach(function(track){var sender=pc.getSenders().find(function(s){return s.track===track});if(sender){pc.removeTrack(sender)}})};RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(transceiver){return!!transceiver.rtpSender}).map(function(transceiver){return transceiver.rtpSender})};RTCPeerConnection.prototr.rtpReceiver})};RTCPeerConnection.prototype._createIceGatherer=function(sdpMLineIndex,usingBundle){var pc=this;if(usingBundle&&sdpMLineIndex>0){return this.transceivers[0].iceGatherer}else if(this._iceGatherers.length){return this._iceGatherers.shift()}var iceGatherer=new window.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(iceGatherer,"state",{value:"new",writable:true});this.transceivers[sdpMLineIndex].bufferedCandidateEvents=[];this.transceivers[sdpMLineIndex].bufferCandidates=function(event){var end=!event.candidate||Object.keys(event.candidate).length===0;iceGatherer.state=end?"completed":"gathering";if(pc.transceivers[sdpMLineIndex].bufferedCandidateEvents!==null){pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event)}};iceGatherer.addEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates);return iceGatherer};RTCPeerConnection.prototype._gather=function(mid,sdpMLineIndex){var pc=this;var iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;if(iceGatherer.onlocalcandidate){return}var bufferedCandidateEvents=this.transceivers[sdpMLineIndex].bufferedCandidateEvents;this.transceivers[sdpMLineIndex].bufferedCandidateEvents=null;iceGatherer.removeEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates);iceGatherer.onlocalcandidate=function(evt){if(pc.usingBundle&&sdpMLineIndex>0){return}var event=new Event("icecandidate");event.candidate={sdpMid:mid,sdpMLineIndex:sdpMLineIndex};var cand=evt.candidate;var end=!cand||Object.keys(cand).length===0;if(end){if(iceGatherer.state==="new"||iceGatherer.state==="gathering"){iceGatherer.state="completed"}}else{if(iceGatherer.state==="new"){iceGatherer.state="gathering"}cand.component=1;cand.ufrag=iceGatherer.getLocalParameters().usernameFragment;var serializedCandidate=SDPUtils.writeCandidate(cand);event.candidate=Object.assign(event.candidate,SDPUtils.parseCandidate(serializedCandidate));event.candidate.candidate=serializedCandidate;event.ernameFragment}}}var sections=SDPUtils.getMediaSections(pc._localDescription.sdp);if(!end){sections[event.candidate.sdpMLineIndex]+="a="+event.candidate.candidate+"\r\n"}else{sections[event.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n"}pc._localDescription.sdp=SDPUtils.getDescription(pc._localDescription.sdp)+sections.join("");var complete=pc.tre==="completed"});if(pc.iceGatheringState!=="gathering"){pc.iceGatheringState="gathering";pc._emitGatheringStateChange()}if(!end){pc._dispatchEvent("icecandidate",event)}if(complete){pc._dispatchEvent("icecandidate",new Event("icecandidate"));pc.iceGatheringState="complete";pc._emitGatheringStateChange()}};wlcandidate(e)})},0)};RTCPeerConnection.prototype._createIceAndDtlsTransports=function(){var pc=this;var iceTransport=new window.RTCIceTransport(null);iceTransport.nnectionState()};var dtlsTransport=new window.RTCDtlsTransport(iceTransport);dtlsTransport.ondtlsstatechange=function(){pc._updateConnectionState()};dtlsTransport.onerror=function(){Object.defineProperty(dtlsTransport,"state",{value:"failed",writable:true});pc._updateConnectionState()};return{iceTransport:iceTransport,dtlsTransport:dtlsTransport}};RTCPeerConnection.prototype._disposeIceAndDtlsTransports=function(sdpMLineIndex){var iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;if(iceGatherer){delete iceGatherer.onlocalcandidate;delete this.transceivers[sdpMLineIndex].iceGatherer}var iceTransport=this.transceivers[sdpMLineIndex].iceTransport;if(iceTransport){delete iceTransport.onicestatechange;delete this.transceivers[sdpMLineIndex].iceTransport}var dtlsTransport=this.transceivers[sdpMLineIndex].dtlsTransport;if(dtlsTransport){delete dtlsTransport.ondtlsstatechange;delete dtlsTransport.onerror;delete this.transceivers[sdpMLineIndex].dtlsTransport}};RTCPeerConnection.prototype._transceive=function(transceiver,send,recv){var params=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);if(send&&transceiver.rtpSender){params.encodings=transceiver.sendEncodingParameters;params.rtcp={cname:SDPUtils.localCName,compound:transceiver.rtcpParameters.compound};if(transceiver.recvEncodingParameters.length){params.rtcp.ssrc=transceiver.recvEncodingParameters[0].ssrc}transceiver.rtpSender.send(params)}if(recv&&transceiver.rtpReceiver&&params.codecs.length>0){if(transceiver.kind==="video"&&transceiver.recvEncodingParameters&&edgeVersion<15019){transceiver.recvEncodingParameters.forEach(function(p){delete p.rtx})}if(transceiver.recvEncodingParameters.length){params.encodings=transceiver.recvEncodingParameters}else{params.encodings=[{}]}params.rtcp={compound:transceiver.rtcpParameters.compound};if(transceiver.rtcpParameters.cname){params.rtcp.cname=transceiver.rtcpParameters.cname}if(transceiver.sendEncodingParameters.length){params.rtcp.ssrc=transceiver.sendEncodingParameters[0].ssrc}transceiver.rtpReceiver.receive(params)}};RTCPeerConnection.prototype.setLocalDescription=function(description){var pc=this;if(["offer","answer"].indexOf(description.type)===-1){return Promise.reject(makeError("TypeError",'Unsupported type "'+description.type+'"'))}if(!isActionAllowedInSignalingState("setLocalDescription",description.type,pc.signalingState)||pc._isClosed){return Promise.reject(makeError("InvalidStateError","Can not set local "+description.type+" in state "+pc.signalingState))}var sections;var sessionpart;if(description.type==="offer"){sections=SDPUtils.splitSections(description.sdp);sessionpart=sections.shift();pabilities=caps});pc.tran,sdpMLineIndex)})}else if(description.type==="answer"){sections=SDPUtils.splitSections(pc._remoteDescription.sdp);sessionpart=sections.shift();var isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0;sections.forEach(function(mediaSection,sdpMLineIndex){var transceiver=pc.transceivers[sdpMLineIndex];var iceGatherer=transceiver.iceGatherer;var iceTransport=transceiver.iceTransport;var dtlsTransport=transceiver.dtlsTransport;var localCapabilities=transceiver.localCapabilities;var remoteCapabilities=transceiver.remoteCapabilities;var rejected=SDPUtils.isRejected(mediaSection)&&SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length===0;if(!rejected&&!transceiver.rejected){var remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart);var remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart);if(isIceLite){remoteDtlsParameters.role="server"}if(!pc.usingBundle||sdpMLineIndex===0){pc._gather(transceiver.mid,sdpMLineIndex);if(iceTransport.state==="new"){iceTransport.start(iceGatherer,remoteIceParameters,isIceLite?"controlling":"controlled")}if(dtlsTransport.state==="new"){dtlsTransport.start(remoteDtlsParameters)}}var params=getCommonCapabilities(localCapabilities,remoteCapabilities);pc._transceive(transceiver,params.codecs.length>0,false)}})}pc._localDescription={type:description.type,sdp:description.sdp};if(description.type==="offer"){pc._updateSignalingState("have-local-offer")}else{pc._updateSignalingState("stable")}return Promise.resolve()};RTCPeerConnection.prototype.setRemoteDescription=function(description){var pc=this;if(["offer","answer"].indexOf(description.type)===-1){return Promise.reject(makeError("TypeError",'Unsupported type "'+description.type+'"'))}if(!isActionAllowedInSignalingState("setRemoteDescription",description.type,pc.signalingState)||pc._isClosed){return Promise.reject(makeError("InvalidStateError","Can not set remote "+description.type+" in state "+pc.signalingState))}var streams={};pc.remotream.id]=stream});var receiverList=[];var sections=SDPUtils.splitSections(description.sdp);var sessionpart=sections.shift();var isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0;var usingBundle=SDPUtils.matchPrefix(sessionpart,"a=group:BUNDLE ").length>0;pc.usingBundle=usingBundle;var iceOptions=SDPUtils.matchPrefix(sessionpart,"a=ice-options:")[0];if(iceOptions){pc.canTrickleIceCandidates=iceOptions.substr(14).split(" ").indexOf("trickle")>=0}else{pc.canTrickleIceCandidates=false}sections.forEach(function(mediaSection,sdpMLineIndex){var lines=SDPUtils.splitLines(mediaSection);var kind=SDPUtils.getKind(mediaSection);var rejected=SDPUtils.isRejected(mediaSection)&&SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length===0;var protocol=lines[0].substr(2).split(" ")[2];var direction=SDPUtils.getDirection(mediaSection,sessionpart);var remoteMsid=SDPUtils.parseMsid(mediaSection);var mid=SDPUtils.getMid(mediaSection)||SDPUtils.generateIdentifier();if(rejected||kind==="application"&&(protocol==="DTLS/SCTP"||protocol==="UDP/DTLS/SCTP")){pc.transceivers[sdpMLineIndex]={mid:mid,kind:kind,protocol:protocol,rejected:true};return}if(!rejected&&pc.transceivers[sdpMLineIndex]&&pc.transceivers[sdpMLineIndex].rejected){pc.transceivers[sdpMLineIndex]=pc._createTransceiver(kind,true)}var transceiver;var iceGatherer;var iceTransport;var dtlsTransport;var rtpReceiver;var sendEncodingParameters;var recvEncodingParameters;var localCapabilities;var track;var remoteCapabilities=SDPUtils.parseRtpParameters(mediaSection);var remoteIceParameters;var remoteDtlsParameters;if(!rejected){remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart);remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart);remoteDtlsParameters.role="client"}recvEncodingParameters=SDPUtils.parseRtpEncodingParameters(mediaSection);var rtcpParameters=SDPUtils.parseRtcpParameters(mediaSection);var isComplete=SDPUtils.matchPrefix(mediaSection,"a=end-of-candidates",sessionpart).length>0;var cands=SDPUtils.matchPrefix(mediaSection,"a=candidate:").map(function(cand){return SDPUtils.parseCandidate(cand)}).filter(function(cand){return cand.component===1});if((description.type==="offer"||description.type==="answer")&&!rejected&&usingBundle&&sdpMLineIndex>0&&pc.transceivers[sdpMLineIndex]){pc._disposeIceAndDtlsTransports(sdpMLineIndex);pc.transceivers[sdpMLineIndex].iceGatherer=pc.transceivers[0].iceGatherer;pc.transceivers[sdpMLineIndex].iceTransport=pc.transceivers[0].iceTransport;pc.transceivers[sdpMLineIndex].dtlsTransport=pc.transceivers[0].dtlsTransport;if(pc.transceivers[sdpMLineIndex].rtpSender){pc.transceivers[sdpMLineIndex].rtpSender.setTransport(pc.transceivers[0].dtlsTransport)}if(pc.transceivers[sdpMLineIndex].rtpReceiver){pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(pc.transceivers[0].dtlsTransport)}}if(description.type==="offer"&&!rejected){transceiver=pc.transceivers[sdpMLineIndex]||pc._createTransceiver(kind);transceiver.mid=mid;if(!transceiver.iceGatherer){transceiver.iceGatherer=pc._createIceGatherer(sdpMLineIndex,usingBundle)}if(cands.length&&transceiver.iceTransport.state==="new"){if(isComplete&&(!usingBundle||sdpMLineIndex===0)){transceiver.iceTransport.setRemoteCandidates(cands)}else{cands.forEach(function(candidate){maybeAddCandidate(transceiver.iceTransport,candidate)})}}localCapabilities=window.RTCRtpReceiver.getCapabilities(kind);if(edgeVersion<15019){localCapabilities.codecs=localCapabilities.codecs.filter(function(codec){return codec.name!=="rtx"})}sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:(2*sdpMLineIndex+2)*1001}];var isNewTrack=false;if(direction==="sendrecv"||direction==="sendonly"){isNewTrack=!transceiver.rtpReceiver;rtpReceiver=transceiver.rtpReceiver||new window.RTCRtpReceiver(transceiver.dtlsTransport,kind);if(isNewTrack){var stream;track=rtpReceiver.track;if(remoteMsid&&remoteMsid.stream==="-"){}else if(remoteMsid){if(!streams[remoteMsid.stream]){streams[remoteMsid.stream]=new window.MediaStream;Object.defineProperty(streams[remoteMsid.stream],"id",{get:function(){return remoteMsid.stream}})}Object.defineProperty(track,"id",{get:function(){return remoteMsid.track}});stream=streams[remoteMsid.stream]}else{if(!streams.default){streams.default=new window.MediaStream}stream=streams.default}if(stream){addTrackToStreamAndFireEvent(track,stream);transceiver.associatedRemoteMediaStreams.push(stream)}receiverList.push([track,rtpReceiver,stream])}}else if(transceiver.rtpReceiver&&transceiver.rtpReceiver.track){transceiver.associatedRemoteMediaStreams.forEach(function(s){var nativeTrack=s.ceiver.track.id});if(nativeTrack){removeTrackFromStreamAndFireEvent(nativeTrack,s)}});transceiver.associatedRemoteMediaStreams=[]}transceiver.localCapabilities=localCapabilities;transceiver.remoteCapabilities=remoteCapabilities;transceiver.rtpReceiver=rtpReceiver;transceiver.rtcpParameters=rtcpParameters;transceiver.sendEncodingParameters=sendEncodingParameters;transceiver.recvEncodingParameters=recvEncodingParameters;pc._transceive(pc.transceivers[sdpMLineIndex],false,isNewTrack)}else if(description.type==="answer"&&!rejected){transceiver=pc.transceivers[sdpMLineIndex];iceGatherer=transceiver.iceGatherer;iceTransport=transceiver.iceTransport;dtlsTransport=transceiver.dtlsTransport;rtpReceiver=transceiver.rtpReceiver;sendEncodingParameters=transceiver.sendEncodingParameters;localCapabilities=transceiver.localCapabilities;pc.transceivers[sdpMLineIndex].recvEncodingParameters=recvEncodingParameters;pc.transceivers[sdpMLineIndex].remoteCapabilities=remoteCapabilities;pc.transceivers[sdpMLineIndex].rtcpParameters=rtcpParameters;if(cands.length&&iceTransport.state==="new"){if((isIceLite||isComplete)&&(!usingBundle||sdpMLineIndex===0)){iceTransport.setRemoteCandidates(cands)}elport,candidate)})}}if(!usingBundle||sdpMLineIndex===0){if(iceTransport.state==="new"){iceTransport.start(iceGatherer,remoteIceParameters,"controlling")}if(dtlsTransport.state==="new"){dtlsTransport.start(remoteDtlsParameters)}}var commonCapabilities=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);var hasRtx=commonCapabilities.codecs.filter(function(c){return c.name.toLowerCase()==="rtx"}).length;if(!hasRtx&&transceiver.sendEncodingParameters[0].rtx){delete transceiver.sendEncodingParameters[0].rtx}pc._transceive(transceiver,direction==="sendrecv"||direction==="recvonly",direction==="sendrecv"||direction==="sendonly");if(rtpReceiver&&(direction==="sendrecv"||direction==="sendonly")){track=rtpReceiver.track;if(remoteMsid){if(!streams[remoteMsid.stream]){streams[remoteMsid.stream]=new window.MediaStream}addTrackToStreamAndFireEvent(track,streams[remoteMsid.stream]);receiverList.push([track,rtpReceiver,streams[remoteMsid.stream]])}else{if(!streams.default){streams.default=new window.MediaStream}addTrackToStreamAndFireEvent(track,streams.default);receiverList.push([track,rtpReceiver,streams.default])}}else{delete transceiver.rtpReceiver}}});if(pc._dtlsRole===undefined){pc._dtlsRole=description.type==="offer"?"active":"passive"}pc._remoteDescription={type:description.type,sdp:description.sdp};if(description.type==="offer"){pc._updateSignalingState("have-remote-offer")}else{pc._updateSignalingState("stable")}Object.keys(streams).forEach(function(sid){var stream=streams[sid];if(stream.getTracks().length){if(pc.remoteStreams.indexOf(stream)===-1){pc.remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream;window.setTimeout(function(){pc._dispatchEvent("addstream",event)})}receiverList.forEach(function(item){var track=item[0];var receiver=item[1];if(stream.id!==item[2].id){return}fireAddTrack(pc,track,receiver,[stream])})}});receiverList.forEach(function(item){if(item[2]){return}fireAddTrack(pc,item[0],item[1],[])});window.setTimeout(function(){if(!(pc&&pc.transceivers)){return}pc.transceivers.forEach(function(transceiver){if(transceiver.iceTransport&&transceiver.iceTransport.state==="new"&&transceiver.iceTransport.getRemoteCandidates().length>0){console.warn("Timeout for addRemoteCandidate. Consider sending "+"an end-of-candidates notification");transceiver.iceTransport.addRemoteCandidate({})}})},4e3);return Promise.resolve()};RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(transceiver){if(transceiver.iceTransport){transceiver.iceTransport.stop()}if(transceiver.dtlsTransport){transceiver.dtlsTransport.stop()}if(transceiver.rtpSender){transceiver.rtpSender.stop()}if(transceiver.rtpReceiver){transceiver.rtpReceiver.stop()}});this._isClosed=true;this._updateSignalingState("closed")};RTCPeerConnection.prototype._updaechange",event)};RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var pc=this;if(this.signalingState!=="stable"||this.needNegotiation===true){return}this.needNegotiation=true;window.setTimeout(function(){if(pc.needNegotiation){pc.needNegotiation=false;var event=new Event("negotiationneeded");pc._dispatchEvent("negotiationneeded",event)}},0)};RTCPeerConnection.prototype._updateIceConnectionState=function(){var newState;var states={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(transceiver){if(transceiver.iceTransport&&!transceiver.rejected){states[transceiver.iceTransport.state]++}});newState="new";if(states.failed>0){newState="failed"}else if(states.checking>0){newState="checking"}else if(states.disconnected>0){newState="disconnected"}else if(states.new>0){newState="new"}else if(states.connected>0){newState="connected"}else if(states.completed>0){newState="completed"}if(newState!==this.iceConnectionState){this.iceConnectionState=newState;var event=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",event)}};RTCPeerConnection.prototype._updateConnectionState=function(){var newState;var states={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(transceiver){if(transceiver.iceTransport&&transceiver.dtlsTransport&&!transceiver.rejected){states[transceiver.iceTransport.state]++;states[transceiver.dtlsTransport.state]++}});states.connected+=states.completed;newState="new";if(states.failed>0){newState="failed"}else if(states.connecting>0){newState="connecting"}else if(states.disconnected>0){newState="disconnected"}else if(states.new>0){newState="new"}else if(states.connected>0){newState="connected"}if(newState!==this.connectionState){this.connectionState=newState;var event=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",event)}};RTCPeerConnection.prototype.createOffer=function(){var pc=this;if(pc._isClosed){return Promise.reject(makeError("InvalidStateError","Can not call createOffer after close"))}var numAudioTracks=pc.transceivers.filter(function(t){return t.kind==="audio"}).length;var numVideoTracks=pc.tra.kind==="video"}).length;var offerOptions=arguments[0];if(offerOptions){if(offerOptions.mandatory||offerOptions.optional){throw new TypeError("Legacy mandatory/optional constraints not supported.")}if(offerOptions.offerToReceiveAudio!==undefined){if(offerOptions.offerToReceiveAudio===true){numAudioTracks=1}else if(offerOptions.offerToReceiveAudio===false){numAudioTracks=0}else{numAudioTracks=offerOptions.offerToReceiveAudio}}if(offerOptions.offerToReceiveVideo!==undefined){if(offerOptions.offerToReceiveVideo===true){numVideoTracks=1}else if(offerOptions.offerToReceiveVideo===false){numVideoTracks=0}else{numVideoTracks=offerOptions.offerToReceiveVideo}}}pc.transceivers.forEach(function(transceiver){if(transceiver.kind==="audio"){numAudioTracks--;if(numAudioTracks<0){transceiver.wantReceive=false}}else if(transceiver.kind==="video"){numVideoTracks--;if(numVideoTracks<0){transceiver.wantReceive=false}}});while(numAudioTracks>0||numVideoTracks>0){if(numAudioTracks>0){pc._createTransceiver("audio");numAudioTracks--}if(numVideoTracks>0){pc._createTransceiver("video");numVideoTracks--}}var sdp=SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,pc._sdpSessionVersion++);pc.transceivers.forEach(function(transceiver,sdpMLineIndex){var track=transceiver.track;var kind=transceiver.kind;var mid=transceiver.mid||SDPUtils.generateIdentifier();transceiver.mid=mid;if(!transceiver.iceGatherer){transceiver.iceGatherer=pc._createIceGatherer(sdpMLineIndex,pc.usingBundle)}var localCapabilities=window.RTCRtpSender.getCapabilities(kind);if(edgeVersion<15019){localCapabilities.codecs=localCapabilitiec.name!=="rtx"})}localCapabilities.codecs.forEach(function(codec){if(codec.name==="H264"&&codec.parameters["level-asymmetry-allowed"]===undefined){codec.parameters["level-asymmetry-allowed"]="1"}if(transceiver.remoteCapabilities&&transceiver.remoteCapabilities.codecs){transceiver.remoteCapabilities.codecs.forEach(function(remoteCodec){if(codec.name.toLowerCase()===remoteCodec.name.toLowerCase()&&codec.clockRate===remoteCodec.clockRate){codec.preferredPayloadType=remoteCodec.payloadType}})}});localCapabilities.headerExtensions.forEach(function(hdrExt){var remoteExtensions=transceiver.remoteCapabilities&&transceiver.remoteCapabilities.headerExtensions||[];remoteExtensions.forEach(function(rHdrExt){if(hdrExt.uri===rHdrExt.uri){hdrExt.id=rHdrExt.id}})});var sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:(2*sdpMLineIndex+1)*1001}];if(track){if(edgeVersion>=15019&&kind==="video"&&!sendEncodingParameters[0].rtx){sendEncodingParameters[0].rtx={ssrc:sendEncodingParameters[0].ssrc+1}}}if(transceiver.wantReceive){transceiver.rtpReceiver=new window.RTCRtpReceiver(transceiver.dtlsTransport,kind)}transceiver.localCapabilities=localCapabilities;transceiver.sendEncodingParameters=sendEncodingParameters});if(pc._config.bundlePolicy!=="max-compat"){sdp+="a=group:BUNDLE "+pc.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"}sdp+="a=ice-options:trickle\r\n";pc.transceivers.forEach(function(transceiver,sdpMLineIndex){sdp+=writeMediaSection(transceiver,transceiver.localCapabilities,"offer",transceiver.stream,pc._dtlsRole);sdp+="a=rtcp-rsize\r\n";if(transceiver.iceGatherer&&pc.iceGatheringState!=="new"&&(sdpMLineIndex===0||!pc.usingBundle)){transceiver.iceGatherer.getLocalCandidates().forEach(function(cand){cand.component=1;sdp+="a="+SDPUtils.writeCandidate(cand)+"\r\n"});if(transceiver.iceGatherer.state==="completed"){sdp+="a=end-of-candidates\r\n"}}});var desc=new window.RTCSessionDescription({type:"offer",sdp:sdp});return Promise.resolve(desc)};RTCPeerConnection.prototype.createAnswer=function(){var pc=this;if(pc._isClosed){return Promise.reject(makeError("InvalidStateError","Can not call createAnswer after close"))}if(!(pc.signalingState==="have-remote-offer"||pc.signalingState==="have-local-pranswer")){return Promise.reject(makeError("InvalidStateError","Can not call createAnswer in signalingState "+pc.signalingState))}var sdp=SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,pc._sdpSessionVersion++);if(pc.usingBundle){sdp+="a=group:BUNDLE "+pc.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"}sdp+="a=ice-options:trickle\r\n";var mediaSectionsInOffer=SDPUtils.getMediaSections(pc._remoteDescription.sdp).length;pc.transceivers.forEach(function(transceiver,sdpMLineIndex){if(sdpMLineIndex+1>mediaSectionsInOffer){return}if(transceiver.rejected){if(transceiver.kind==="application"){if(transceiver.protocol==="DTLS/SCTP"){sdp+="m=application 0 DTLS/SCTP 5000\r\n"}else{sdp+="m=application 0 "+transceiver.protocol+" webrtc-datachannel\r\n"}}else if(transceiver.kind==="audio"){sdp+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\n"+"a=rtpmap:0 PCMU/8000\r\n"}else if(transceiver.kind==="video"){sdp+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\n"+"a=rtpmap:120 VP8/90000\r\n"}sdp+="c=IN IP4 0.0.0.0\r\n"+"a=inactive\r\n"+"a=mid:"+transceiver.mid+"\r\n";return}if(transceiver.stream){var localTrack;if(transceiver.kind==="audio"){localTrack=transceiver.stream.getAudioTracks()[0]}else if(transceiver.kind==="video"){localTrack=transceiver.stream.getVideoTracks()[0]}if(localTrack){if(edgeVersion>=15019&&transceiver.kind==="video"&&!transceiver.sendEncodingParameters[0].rtx){transceiver.sendEncodingParameters[0].rtx={ssrc:transceiver.sendEncodingParameters[0].ssrc+1}}}}var commonCapabilities=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);var hasRtx=commonCapabilitirCase()==="rtx"}).length;if(!hasRtx&&transceiver.sendEncodingParameters[0].rtx){delete transceiver.sendEncodingParameters[0].rtx}sdp+=writeMediaSection(transceiver,commonCapabilities,"answer",transceiver.stream,pc._dtlsRole);if(transceiver.rtcpParameters&&transceiver.rtcpParameters.reducedSize){sdp+="a=rtcp-rsize\r\n"}});var desc=new window.RTCSessionDescription({type:"answer",sdp:sdp});return Promise.resolve(desc)};RTCPeerConnection.prototype.addIceCandidate=function(candidate){var pc=this;var sections;if(candidate&&!(candidate.sdpMLineIndex!==undefined||candidate.sdpMid)){return Promise.reject(new TypeError("sdpMLineIndex or sdpMid required"))}return new Promise(function(resolve,reject){if(!pc._remoteDescription){return reject(makeError("InvalidStateError","Can not add ICE candidate without a remote description"))}else if(!candidate||candidate.candidate===""){for(var j=0;j<pc.transceivers.length;j++){if(pc.transceivers[j].rejected){continue}pc.transceivers[j].iceTransport.addRemoteCandidate({});sections=SDPUtils.getMediaSections(pc._remoteDescription.sdp);sections[j]+="a=end-of-candidates\r\n";pc._remoteDescription.sdp=SDPUtils.getDescription(pc._remoteDescription.sdp)+sections.join("");if(pc.usingBundle){break}}}else{var sdpMLineIndex=candidate.sdpMLineIndex;if(candidate.sdpMid){for(var i=0;i<pc.transceivers.length;i++){if(pc.transceivers[i].mid===candidate.sdpMid){sdpMLineIndex=i;break}}}var transceiver=pc.transceivers[sdpMLineIndex];if(transceiver){if(transceiver.rejected){return resolve()}var cand=Object.keys(candidate.candidate).length>0?SDPUtils.parseCandidate(candidate.candidate):{};if(cand.protocol==="tcp"&&(cand.port===0||cand.port===9)){return resolve()}if(cand.component&&cand.component!==1){return resolve()}if(sdpMLineIndex===0||sdpMLineIndex>0&&transceiver.iceTransport!==pc.transceivers[0].iceTransport){if(!maybeAddCandidate(transceiver.iceTransport,cand)){return reject(makeError("OperationError","Can not add ICE candidate"))}}var candidateString=candidate.candidate.trim();if(candidateString.indexOf("a=")===0){candidateString=candidateString.substr(2)}sections=SDPUtils.getMediaSections(pc._remoteDescription.sdp);sections[sdpMLineIndex]+="a="+(cand.type?candidateString:"end-of-candidates")+"\r\n";pc._remoteDescription.sdp=SDPUtils.getDescription(pc._remoteDescription.sdp)+sections.join("")}else{return reject(makeError("OperationError","Can not add ICE candidate"))}}resolve()})};RTCPeerConnection.prototype.getStats=function(selector){if(selector&&selector instanceof window.MediaStreamTrack){var senderOrReceiver=null;this.transceivers.forEach(function(transceiver){if(transceiver.rtpSender&&transceiver.rtpSender.track===selector){senderOrReceiver=transceiver.rtpSender}else if(transceiver.rtpReceiver&&transceiver.rtpReceiver.track===selector){senderOrReceiver=transceiver.rtpReceiver}});if(!senderOrReceiver){throw makeError("InvalidAccessError","Invalid selector.")}return senderOrReceiver.getStats()}var promises=[];this.transceivers.forEach(function(transceiver){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(method){if(transceiver[method]){promises.push(transceiver[method].getStats())}})});return Promise.all(promises).then(function(allStats){var results=new Map;stat.id,stat)})});return results})};var ortcObjects=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];ortcObjects.forEach(function(ortcObjectName){var obj=window[ortcObjectName];if(obj&&obj.prototype&&obj.prototype.getStats){var nativeGetstats=obj.prototype.getStats;obj.prototype.getStats=function(){return nativeGetstats.apply(this).then(function(nativeStats){var mapStats=new Map;Object.keys(nativeStats).forEach(function(id){nativeStats[id].type=fixStatsType(nativeStats[id]);mapStats.set(id,nativeStats[id])});return mapStats})}}});var methods=["createOffer","createAnswer"];methods.forEach(function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;if(typeof args[0]==="function"||typeof args[1]==="function"){return nativeMethod.apply(this,[arguments[2]]).then(function(description){if(typeof args[0]==="function"){args[0].apply(null,[description])}},function(error){if(typeof args[1]==="function"){args[1].apply(null,[error])}})}return nativeMethod.apply(this,arguments)}});methods=["setLocalDescription","setRemoteDescription","addIceCandidate"];methods.forEach(function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;if(typeof args[1]==="function"||typeof args[2]==="function"){return nativeMethod.apply(this,arguments).then(function(){if(typeof args[1]==="function"){args[1].apply(null)}},function(error){if(typeof args[2]==="function"){args[2].apply(null,[error])}})}return nativeMethod.apply(this,arguments)}});["getStats"].forEach(function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;if(typeof args[1]==="function"){return nativeMethod.apply(this,arguments).then(function(){if(typeof args[1]==="function"){args[1].apply(null)}})}return nativeMethod.apply(this,arguments)}});return RTCPeerConnection}},{sdp:17}],17:[function(require,module,exports){"use strict";var SDPUtils={};SDPUtils.ge6).substr(2,10)};SDPUtils.localCName=SDPUtils.generateIdentifier();SDPn line.trim()})};SDPUtils.splitSections=function(blob){var parts=blob.split("\nm=");).trim()+"\r\n"})};SDPUtilns&&sections[0]};SDPUtils.getMediaSections=function(blob){var sections=SDPUtils.splitSections(blob);sections.shift();return sections};SDPUtils.matchPrefix=function(blob,prefix){return SDPUtils.splitLixOf(prefix)===0})};SDPUtils.parseCandidate=function(line){var parts;if(line.indexOf("a=candidate:")===0){parts=line.substring(12).split(" ")}else{parts=line.substring(10).split(" ")}var candidate={foundation:parts[0],component:parseInt(parts[1],10),protocol:parts[2].toLowerCase(),priority:parseInt(parts[3],10),ip:parts[4],address:parts[4],port:parseInt(parts[5],10),type:parts[7]};for(var i=8;i<parts.length;i+=2){switch(parts[i]){case"raddr":candidate.relatedAddress=parts[i+1];break;case"rport":candidate.relatedPort=parseInt(parts[i+1],10);break;case"tcptype":candidate.tcpType=parts[i+1];break;case"ufrag":candidate.ufrag=parts[i+1];candidate.usernameFragment=parts[i+1];break;default:candidate[parts[i]]=parts[i+1];break}}return candidate};SDPUtils.writeCandidate=function(candidate){var sdp=[];sdp.push(candidate.foundation);sdp.push(candidate.component);sdp.push(candidate.protocol.toUpperCase());sdp.push(candidate.priority);sdp.push(candidate.address||candidate.ip);sdp.push(candidate.port);var type=candidate.type;sdp.push("typ");sdp.push(type);if(type!=="host"&&candidate.relatedAddress&&candidate.relatedPort){sdp.push("raddr");sdp.push(candidate.relatedAddress);sdp.push("rport");sdp.push(candidate.relatedPort)}if(candidate.tcpType&&candidate.protocol.toLowerCase()==="tcp"){sdp.push("tcptype");sdp.push(candidate.tcpType)}if(candidate.usernameFragment||candidate.ufrag){sdp.push("ufrag");sdp.push(candidate.usernameFragment||candidate.ufrag)}return"candidate:"+sdp.join(" ")};SDPUtils(14).split(" ")};SDPUtils.parseRtpMap=function(line){var parts=line.substr(9).split(" ");var parsed={payloadType:parseInt(parts.shift(),10)};parts=parts[0].split("/");parsed.name=parts[0];parsed.clockRate=parseInt(parts[1],10);parsed.channels=parts.length===3?parseInt(parts[2],10):1;parsed.numChannels=parsed.channels;return parsed};SDPUtils.writeRtpMap=function(codec){var pt=codec.payloadType;if(codec.preferredPayloadType!==undefined){pt=codec.preferredPayloadType}var channels=codec.channels||codec.numChannels||1;return"a=rtpmap:"+pt+" "+codec.name+"/"+codec.clockRate+(channels!==1?"/"+channels:"")+"\r\n"};SDPU",uri:parts[1]}};SDPUtils.writeExtmap=function(headerExtension){return"a=extmap:"+(headerExtension.id||headerExtension.preferredId)+(headerExtension.direction&&headerExtension.direction!=="sendrecv"?"/"+headerExtension.direction:"")+" "+headerExtension.uri+"\r\n"};SDPUtils.parseFmtp=function(line){var parsed={};var kv;var parts=line.substr(line.indexOf(" ")+1).split(";");for(var j=0;j<parts.length;j++){kv=parts[j].trim().split("=");parsed[kv[0].trim()]=kv[1]}return parsed};SDPUtils.writeFmtp=function(codec){var line="";var pt=codec.payloadType;if(codec.preferredPayloadType!==undefined){pt=codec.preferredPayloadType}if(codec.parameters&&Object.keys(codec.parameters).length){var params=[];Object.keys(codec.parameters).forEach(function(param){if(codec.parameters[param]){params.push(param+"="+codec.parameters[param])}else{params.push(param)}});line+="a=fmtp:"+pt+" "+params.join(";")+"\r\n"}return line};SDPUarts.join(" ")}};SDPUtils.writeRtcpFb=function(codec){var lines="";var pt=codec.payloadType;if(codec.preferredPayloadType!==undefined){pt=codec.preferredPayloadType}if(codec.rtcpFeedback&&codec.rtcpFeedback.length){codec.rtcpeter:"")+"\r\n"})}return lines};SDPUtils.parseSsrcMedia=function(line){var sp=line.indexOf(" ");var parts={ssrc:parseInt(line.substr(7,sp-7),10)};var colon=line.indexOf(":",sp);if(colon>-1){parts.attribute=line.substr(sp+1,colon-sp-1);parts.value=line.substr(colon+1)}else{parts.attribute=line.substr(sp+1)}return parts};SDPUtilInt(ssrc,10)})}};SDPUtils.getMid=function(mediaSection){var mid=SDPUtils.matchPrefix(mediaSection,"a=mid:")[0];if(mid){return mid.substr(6)}};SDPUtils.value:parts[1]}};SDPUtils.gseFingerprint)}};SDPUtils.writeDtlsParameters=function(params,setupType){var sdp="a=setup:"+setupType+"\r\n";params.fingfp.value+"\r\n"});return sdp};SDPUtils.getIceParameters=function(mediaSection,sessionpart){var lines=SDPUtils.splitLines(mediaSection);lines=lines.concat(SDPUtils.splitLines(sessionpart));var iceParameters={usernameFragment:lines.filter(function(line){return line.indexOf("a=ice-ufrag:")===0})[0].substr(12),passw=ice-pwd:")===0})[0].substr(10)};return iceParameters};SDPUtils.writeIceParameters=function(params){return"a=ice-ufrag:"+params.usernameFragment+"\r\n"+"a=ice-pwd:"+params.password+"\r\n"};SDPUtils.parseRtpParameters=function(mediaSection){var description={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]};var lines=SDPUtils.splitLines(mediaSection);var mline=lines[0].split(" ");for(var i=3;i<mline.length;i++){var pt=mline[i];var rtpmapline=SDPUtils.matchPrefix(mediaSection,"a=rtpmap:"+pt+" ")[0];if(rtpmapline){var codec=SDPUtils.parseRtpMap(rtpmapline);var fmtps=SDPUtils.matchPrefix(mediaSection,"a=fmtp:"+pt+" ");codec.parameters=fmtps.length?SDPUtils.parseFmtp(fmtps[0]):{};codec.rtcpFeedback=SDPUtils.matchPrefix(mediaSection,"a=rtcp-fb:"+pt+" ").map(SDPUtils.parseRtcpFb);description.codecs.push(codec);switch(codec.name.toUpperCase()){case"RED":case"ULPFEC":description.fecMechanisms.push(codec.name.toUpperCase());break;default:break}}}SDPUtils.matchPrefix(mediaSection,"a=eseExtmap(line))});return description};SDPUtils.writeRtpDescription=function(kind,caps){var sdp="";sdp+="m="+kind+" ";sdp+=caps.codecs.length>0?"9":"0";sdp+=" UDP/TLS/RTP/SAVPF ";sdp+=caps.codecs.map(function(codec){if(codec.preferredPayloadType!==undefined){return codec.preferredPayloadType}return codec.payloadType}).join(" ")+"\r\n";sdp+="c=IN IP4 0.0.0.0\r\n";sdp+="a=rtcp:9 IN IP4 0.0.0.0\r\n";caps.codecs.forEach(function(codec){sdp+=SDPUtils.writeRtpMap(codec);sdp+=SDPUtils.writeFmtp(codec);sdp+=SDPUtils.writeRtcpFb(codec)});var maxptime=0;capcodec.maxptime}});if(maxptime>0){sdp+="a=maxptime:"+maxptime+"\r\n"}sdp+="a=rtcp-mux\r\n";if(caps.headerExtensions){caps.headerExtmap(extension)})}return sdp};SDPUtils.parseRtpEncodingParameters=function(mediaSection){var encodingParameters=[];var description=SDPUtils.parseRtpParameters(mediaSection);var hasRed=description.fecMechanisms.indexOf("RED")!==-1;var hasUlpfec=description.fecMechanisms.indexOf("ULPFEC")!==-1;var ssrcs=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(parts){return parts.attribute==="cname"});var primarySsrc=ssrcs.length>0&&ssrcs[0].ssrc;var secondarySsrc;var flows=SDPUtils.matchPrefix(mediaSection,"a=ssrc-group:FID").map(function(line){var parts=line.substr(17).split(" ");rseInt(part,10)})});if(flows.length>0&&flows[0].length>1&&flows[0][0]===primarySsrc){secondarySsrc=flows[0][1]}description.codecs.forEach(function(codec){if(codec.name.toUpperCase()==="RTX"&&codec.parameters.apt){var encParam={ssrc:primarySsrc,codecPayloadType:parseInt(codec.parameters.apt,10)};if(primarySsrc&&secondarySsrc){encParam.rtx={ssrc:secondarySsrc}}encodingParameters.push(encParam);if(hasRed){encParam=JSON.parse(JSON.stringify(encParam));encParam.fec={ssrc:primarySsrc,mechanism:hasUlpfec?"red+ulpfec":"red"};encodingParameters.push(encParam)}}});if(encodingParameters.length===0&&primarySsrc){encodingParameters.push({ssrc:primarySsrc})}var bandwidth=SDPUtils.matchPrefix(mediaSection,"b=");if(bandwidth.length){if(bandwidth[0].indexOf("b=TIAS:")===0){bandwidth=parseInt(bandwidth[0].substr(7),10)}else if(bandwidth[0].indexOf("b=AS:")===0){bandwidth=parseInt(bandwidth[0].substr(5),10)*1e3*.95-50*40*8}else{bandwidth=undefined}encodingParameters.forEach(function(params){params.maxBitrate=bandwidth})}return encodingParameters};SDPUtils.parseRtcpParameters=function(mediaSection){var rtcpParameters={};var remoteSsrc=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(obj){return obj.attribute==="cname"})[0];if(remoteSsrc){rtcpParameters.cname=remoteSsrc.value;rtcpParameters.ssrc=remoteSsrc.ssrc}var rsize=SDPUtils.matchPrefix(mediaSection,"a=rtcp-rsize");rtcpParameters.reducedSize=rsize.length>0;rtcpParameters.compound=rsize.length===0;var mux=SDPUtils.matchPrefix(mediaSection,"a=rtcp-mux");rtcpParameters.mux=mux.length>0;return rtcpParameters};SDPUtils.parseMsid=function(mediaSection){var parts;var spec=SDPUtils.matchPrefix(mediaSection,"a=msid:");if(spec.length===1){parts=spec[0].substr(7).split(" ");return{stream:parts[0],track:parts[1]}}var planB=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(msidParts){return msidParts.attribute==="msid"});if(planB.length>0){parts=planB[0].value.split(" ");return{stream:parts[0],track:parts[1]}}};SDPUtils.g().substr(2,21)};SDPUtils.writeSessionBoilerplate=function(sessId,sessVer,sessUser){var sessionId;var version=sessVer!==undefined?sessVer:2;if(sessId){sessionId=sessId}else{sessionId=SDPUtils.generateSessionId()}var user=sessUser||"thisisadapterortc";return"v=0\r\n"+"o="+user+" "+sessionId+" "+version+" IN IP4 127.0.0.1\r\n"+"s=-\r\n"+"t=0 0\r\n"};SDPUtils.writeMediaSection=function(transceiver,caps,type,stream){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters());sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),type==="offer"?"actpass":"active");sdp+="a=mid:"+transceiver.mid+"\r\n";if(transceiver.direction){sdp+="a="+transceiver.direction+"\r\n"}else if(transceiver.rtpSender&&transceiver.rtpReceiver){sdp+="a=sendrecv\r\n"}else if(transceiver.rtpSender){sdp+="a=sendonly\r\n"}else if(transceiver.rtpReceiver){sdp+="a=recvonly\r\n"}else{sdp+="a=inactive\r\n"}if(transceiver.rtpSender){var msid="msid:"+stream.id+" "+transceiver.rtpSender.track.id+"\r\n";sdp+="a="+msid;sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid;if(transceiver.sendEncodingParameters[0].rtx){sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid;sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n";if(transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx){sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"}return sdp};SDPUtils.getDirection=function(mediaSection,sessionpart){var lines=SDPUtils.splitLines(mediaSection);for(var i=0;i<lines.length;i++){switch(lines[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return lines[i].substr(2);default:}}if(sessionpart){return SDPUtils.getDirection(sessionpart)}return"sendrecv"};SDPUtils.getKind=function(mediaSection){var lines=SDPUtils.splitLines(mediaSection);var mline=lines[0].split(" ");return mline[0].substr(2)};SDPUtils.isRejected=function(mediaSection){return mediaSection.split(" ",2)[1]==="0"};SDPUtils.parseMLine=function(mediaSection){var lines=SDPUtils.splitLines(mediaSection);var parts=lines[0].substr(2).split(" ");return{kind:parts[0],port:parseInt(parts[1],10),protocol:parts[2],fmt:parts.slice(3).join(" ")}};SDPUtils.parseOLine=function(mediaSection){var line=SDPUtils.matchPrefix(mediaSection,"o=")[0];var parts=line.substr(2).split(" ");return{username:parts[0],sessionId:parts[1],sessionVersion:parseInt(parts[2],10),netType:parts[3],addressType:parts[4],address:parts[5]}};SDPUtils.isValidSDP=function(blob){if(typeof blob!=="string"||blob.length===0){return false}var lines=SDPUtils.splitLines(blob);for(var i=0;i<lines.length;i++){if(lines[i].length<2||lines[i].charAt(1)!=="="){return false}}return true};if(typeof module==="object"){module.exports=SDPUtils}},{}]},{},[1])(1)});} else { if ( typeof(define) === "function" && define.amd ) { define('adapter-latest', function(){ return {} }); }}

// js_build_core: MfcJs/VideoPlayer/hls.min.js
!function t(e){var r,i;r=this,i=functio:t}vart}},t.exports=s}(m);var p=m.exports,y= tufferR="otheOWN="unknown",t}({}),S=function(){},R={trace:S,debug:S,log:S,warn:S,inf{A=R}}else A=R}var D=A,_=/^(\d+)x(\d+)$/,I=/(.+?)=(".*?"]="SCTEis.c,first:0,end:0}},P="audio",O="video",is._}retudiovihis.endSN}}]),ce.call(t,e,r))}var V,W=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<1212su7,+1stare+[0datt.t:t.,Mader("u),e+=i}return e},st=Math.pow(2,32)-1,ot=[].push,lt={video:1,audiodiaSource}var kt={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,ws="'+t+'"'))&&r}var It=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,wt=/#EXT-X-MEDIA:(.*)/g,xt=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ct=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Ft=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.sourcr=i.push(t)}var Kt="manifest",Vt="level",Wt="audioTrack",Yt="subtitleTrack",jt="main",qt="audi)||(ra,=a&&(t.mode=a)}var te="org.id3",ee="com.apple.quicktime.HLS",re="https://aomedlf.TexSIgetTimth;v+rrentTime}}]),t}(),le=["NONE","TYPE-0","TYPE-1",null],ue="",de=skip),e.href},t}(),ce=function(){function t(t){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.previousDetails=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audion(t){return t})).join(",").replace(/\.[^.,]+/g,"")}return t.protos.push(t.attrs)},n(t,[{key:e,this.bitrate)}},rs[this._urlId]}},{keyTHWAY-ID"]||"."}his._urlId]||""}},{key:"urlId",get:function(){return ,this._urlId=e)}},{key:"audioGroupId",get:function(){var t;return null==(t=this.audioGroupIds)?void 0:t[this.urlId]}},{key:"0:t[thise||0)-i>t}var Ie,we=3e5,xe=0,Ce=2,Fe=5,Pr[t.urlId]=i},t}":"),this.hls=t}var e=t.prototype;=this.warn=nu),this.timer.loadPlayliis.clearTimer()?u:void 0,ue)}}formance.now())},e.sht.details.live)},e.shouLoadPlaylist(t)},e.playlistLoaded=function(t,e,r){var i=this,a=e.details,n=e.stats,s=self.performance.now(),o=n.loading.first?Math.max(0,s-n.loading.first):0;if(a.advancedDateTime=Date.now()-o,a.live||null!=r&&r.live){if(a.reloaded(r),r&&this.log("live playlist "+t+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED")),r&&a.fragments.length>0){if(!this.hls.config.lowLatencyMode&&!a.partList){var l,u,d=null==(l=this.hls.levels)?void 0:l[t];d&&(d.previousDetails?(null==(u=d.previousDetails)?void 0:u.length)>3&&d.previousDetails.shift():d.previousDetails=[],d.previousDetails.push(r));for(var h=a.startSN,f=a.endSN,c=Math.ceil(1.5*a.fragments.length),g=0,v=h,m=r.fragments.length-1;m>=0;m--){var p=r.fragments[m];if(p&&(1==v-(y(null==p?void 0:p.sn)?p.sn:0)&&p.sn<f&&void 0!==p.startPTS&&(g++,v=p.sn,a.totalduration+=p.duration,a.fragments.unshift(p)),g===c))break}g&&(a.startSN=a.fragments[0].sn,a.averagetargetduration=a.totalduration/a.fragments.length)}me(r,a)}if(!this.canLoad||!a.live)return;var T,E=void 0,L=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var S=this.hls.config.lowLatencyMode,R=a.lastPartSn,A=a.endSN,b=a.lastPartIndex,k=R===A;-1!==b?(E=k?A+1:R,L=k?S?0:b:b+1):E=A+1;var D=a.age,_=D+a.ageHeader,I=Math.min(_-a.partTarget,1.5*a.targetduration);if(I>0){if(r&&I>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+I+" with playlist age: "+a.age),I=0;else{var w=Math.floor(I/a.targetduration);E+=w,void 0!==L&&(L+=Math.round(I%a.targetduration/a.partTarget)),this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+D.toFixed(2)+"s goal: "+I+" skip sn "+w+" to part "+L)}a.tuneInGoal=I}if(T=this.getDeliveryDirectives(a,e.deliveryDirectives,E,L),S||!k)return void this.loadPlaylist(T)}else a.canBlockReload&&(T=this.getDeliveryDirectives(a,e.deliveryDirectives,E,L));var x=this.hls.mainForwardBufferInfo,C=xn Math.round(r)}(a,1e3*(a.edge-C));a.updated&&s>this.requestScheduled+F&&(this.requestScheduled=n.loading.start),void 0!==E&&a.canBlockReload?this.requestScheduled=n.loading.first+F-(1e3*a.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+F<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=F);var P=this.requestScheduled-s;P=Math.max(0,P),this.log("reload live playlist "+t+" in "+Math.round(P)+" ms"),this.timer=self.setTimeout((function(){return i.loadPlaylist(T)}),P)}else this.clearTimer()},e.getDe),new fe(r,i,ved=!0}roLev]||0,e[r]++}))}var Ke="NOT_LOADED",Ve="APPENDING",We="PARs.urlId+"_"+t.sn}var Xe=M,ed=!0,return l(e,t)&a.de=function(){},t}(),rr={length:0,start:function(){return 0},end:functionered".de.aesI,"decurn xgEnab3)+"]";return e},gr="STOPPED",vr="IDLE",mr="KEY_LOADING",pr="FRAG_LOADING",yr="FRAG_LOADING_WAITING_RETRY",Tr="WAITING_TRACK",Er="PARSING",Lr="PARSED",Sr="ENDED",Rr="ERROR",Ar="WAITING_INIT_PTS",br="W+"->:[],d=func4&t[e+5])>>>5}function Pr(t,e){return e+1<t,miing)return i},e}(Ir),Gr=/\/=function(){},t}(),Kr=null,Vr=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Wr=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Yr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,1a)is.re))))return}}nk".frameI,90,90,94])}},t}(),di=Matyt(t,1e3,1/9e4,e)}hi.types=void 0,hi.HDLR_TYPES=void 0,hi.STTS=void 0,hi.STSC=void 0,hi.STCO=void 0,hi.STSZ=void 0,hi.VMHD=void 0,hi.SMHD=void 0,hi.STSD=void 0,hi.FTYP=void 0,hi.DINF=void 0;var ciud,{samplflaisNyi1e":"mp4a.40.5"}try{Ti=self.performance.now.bind(self.performance)}catch(t){D.debug("Unable to use Performance API on this environment"),Ti="undefined"!=typeof self&&self.Date.now}var Ai=[{demux:Hr,remux:Si},{demux:ei,remux:vi},{demux:Ur,remux:vi},{demux:s.conanceofIniSegmentChange=n},r=o,t.exports=o}(wi);var ush",data:r}):Pi(t,u,l)}}))}(self);var Oi=bt()||tionxCompfatalStartLois.es=functoLevdataLength=0},t}(erListeners(),a}l(e,t);var r=e.prototype;return r.onHchingTrack=null},r._registerListeners=function(){var t=this.hls;t.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(T.MANIFEST_LOADING,this.onManifestLoading,this),t.on(T.LEVEL_LOADED,this.onLevelLoaded,this),t.on(T.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(T.ERROR,this.onError,this),t.on(T.BUFFER_RESET,this.onBufferReset,this),t.on(T.BUFFER_CREATED,this.onBufferCreated,this),t.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(T.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(T.FRAG_BUFFERED,this.onFragBuffered,this)},r._unrgBuffered,this)},r&&this.ticke=t,this.his.onTickEnd()},r.clea,this.state=vr)},r.rtate.call(th=t.currentTimrFlushed=!0}}}}},r.geBufferLength):r},r.hing.call(this)},r.onAurn new ce(t)}))},r.onAudgr),this.tick()},r.oitingVideoCC=-1}oadedData=null)},r.onAudioTrackLoaded=function(t,e){var r;if(null!=this.mainDetails){var i=this.levels,a=e.details,n=e.id;if(i){this.log("Track "+n+" loaded ["+a.startSN+","+a.endSN+"]"+(a.lastPartSn?"[part-"+a.lastPartSn+"-"+a.lastPartIndex+"]":"")+",duration:"+a.totalduration);var s=i[n],o=0;if(a.live||null!=(r=s.details)&&r.live){var l=this.mainDetails;if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed||!l)return;!s.details&&a.hasProgramDateTime&&l.hasProgramDateTime?(function(t,e){if(t.hasProgramDateTime&&e.hasProgramDateTime){var r=t.fragments,i=e.fragments;if(r.length&&i.length){var a=i[Math.round(i.length/2)-1],n=nr(r,a.cc)||r[Math.round(r.length/2)-1],s=a.programDateTime,o=n.programDateTime;null!==s&&null!==o&&or((o-s)/1e3-(n.start-a.start),t)}}}(a,l),o=a.fragments[0].start):o=this.alignPlaylists(a,s.details)}s.details=a,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(s.details,o),this.state!==Tr||this.waitForCdnTuneIn(a)||(this.state=vr),this.tick()}else this.warn("Audio tracks were reset while loading level "+n)}else this.cachedTrackLoadedData=e},r._handleFragt be buffered")},r._handleFragte.call(this,e)}adedmetadata=!1},ro.buffer||null)},edmetadataWorkerError(r)}},rthis.state=vr))},r._handlessingContext(n)},r._b)}this.tick()}}ckerIfNeeded(e)},r.comITCHED,i({oTrack(queues[t][0]},t}(),ji=bt(),qi=/([ha]vc.)(liste}retudFrameCount)},t}(),$i=/^age:\s*ader(t):null},t}(),Ji=/(\d+)-jeequestreturn l(e,t),e}(c(Error)),ia={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},aa=i(i({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Zi,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Hi,bufferController:zi,capLevelController:Xi,errorController:Ne,fpsController:Qi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:null,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:ia},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:ia},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:H,enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:Vi,audioTrackController:Wi,emeController:void 0,cmcdController:void 0,contentSteeringConFetchtConfig=e}}]),t}();return oa.defaultConfig=void 0,oa},"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(r="undefined"!=typeof globalThis?globalThis:r||self).Hls=i()}(!1);
//# sourceMappingURL=hls.light.min.js.map


// js_build_core: MfcJs/VideoPlayer/VideoPlayer.js
(function (root, VideoPlayerWrapper) { 'use strict'; if ( typeof(define) === "function" && define.amd ) { define(["videojs", "Hls"], function(videojs, Hls) { if ( typeof(root.videojs) === "undefined" ) root.videojs = videojs; if ( typeof(root.Hls) === "undefined" ) root.Hls = Hls; return (root.VideoPlayer = VideoPlayerWrapper()); }); } else if ( typeof(module) === "object" && module.exports ) { module.exports = (root.VideoPlayer = VideoPlayerWrapper()); } else { root.VideoPlayer = VideoPlayerWrapper(); }}(this, function() { 'use strict'; var VideoPlayer = (function(dom, videojs, win) { function VideoPlayer(options ) { options = Object.assign({ urlFormat: 'wowza' }, options || {}); if (VideoPlayer.prototype.PLATFORM['p1']._fcs_set_ === undefined) { Object.assign(VideoPlayer.prototype.PLATFORM['p1'], { publicRoomStart: FCS.CHANNEL_ID_START, publicRoomEnd: FCS.SESSCHAN_ID_START, privateRoomStart: FCS.SESSCHAN_ID_START, groupRoomStart: FCS.SESSCHAN_ID_START, clubRoomStart: FCS.SESSCHAN_ID_START, _fcs_set_: true }); } this['isJsVideo'] = true;
 this.defaultTechOrder = { model: { 'wowza': { sidekick: ['llhls', 'hls', 'llnative', 'webrtc'], webrtc: ['llhls', 'hls', 'llnative', 'webrtc'], default: ['llhls', 'hls', 'llnative', 'webrtc'] }, 'tokenShow': { 'wowza': { default: ['llhls', 'hls', 'llnative', 'webrtc'] } } }, c2c: { 'wowza': { default: ['webrtc'] } } }; this.supportedTechs = { 'hls': null, 'llhls': null, 'llnative': null, 'webrtc': null, 'transcodedWebrtc': null }; this.techOrder = []; this.previous = {}; this.platformId = options['platformId']; this.platform = this.PLATFORM[ 'p'+this.platformId ]; this.phase = 'z'; this.mode = 'DOWNLOAD'; this.c2c = false; this.allowFullscreen = true; this.allowControls = true; this.privateSession = 0; this.groupSession = 0; this.clubSession = 0; this.modelFlags = 0; this.autoplayMutedOverlay = true; this.restartCount = 0; this.exitFullscreenTime = 0; this.placardShowing = false; this.mobileInactivityTimeout = 2000; this.desktopInactivityTimeout = 700; this.ckxauth = ''; this.customUrl = ''; this.defaultVolume = 0.5;
 this.cacheModelVolume = true; this.capLevelToPlayerSize = false; this.serverMode = 0; this.useBlurredLivesnaps = false; this.livesnapBg = false; this.livesnapBgEl = null; this.livesnapRefreshTime = 5000; this.VIDEO_NOT_SUPPORTED = -999999; if ( ! this.platformId || typeof(this.platform) !== 'object' ) throw 'Invalid platformId'; if ( this._isMobileTouchDevice() ) { this.inactivityTimeout = this.mobileInactivityTimeout; } else { this.inactivityTimeout = this.desktopInactivityTimeout; } this.setOptions(options); if ( options['render'] ) this.render(); } VideoPlayer.prototype.VERSION = '1.97.22'; VideoPlayer.prototype.WEBRTC_CODECS = { 'H264': { name: 'H264', regexps: { sdpFmtpLine: new RegExp('profile-level-id=42e[0-9a-f]{3}', 'gmi'), offerSdp: new RegExp('profile-level-id=42e[0-9a-f]{3}', 'gmi') }, supported: undefined } }; VideoPlayer.prototype.SUPPORTS_VOLUME_CHANGE = undefined; VideoPlayer.prototype.REPORTBACK = false; VideoPlayer.prototype.REPORTBACK_EXTRA = undefined; VideoPlayer.prototype.SETTINGS_VER = '1'; VideoPlayer.prototype.BROWSER = {}; VideoPlayer.prototype.HASPLAYED = {}; VideoPlayer.prototype.FAILEDTECH = {}; VideoPlayer.prototype._volumeCache = {}; VideoPlayer.prototype._serverLookupCache = {}; VideoPlayer.prototype.URLFORMAT = { 'wowza': { hls: {
 protocol: 'https://', port: '', app: '/NxServer/', c2c_app: '/NxServer/', prefix: 'ngrp:', suffix: '.f4v_mobile/playlist.m3u8', overrides: { safarihls: { name: 'Safari HLS', enabled: true, func: function() { return ( this._isBroadcasterOnWebRTC() && ! this._isBroadcasterOnSidekick() && (VideoPlayer.prototype.BROWSER.IS_IOS || VideoPlayer.prototype.BROWSER.IS_ANY_SAFARI) ); }, values: { suffix: '.f4v_safarihls/playlist.m3u8' } } } }, llhls: { protocol: 'https://', port: '', app: '/NxServer/', c2c_app: '/NxServer/', prefix: 'ngrp:', suffix: '.f4v_cmaf/playlist_sfm4s.m3u8', overrides: { safarillhls: { name: 'Safari LLHLS', enabled: false, func: function() { return ( this._isBroadcasterOnWebRTC() && ! this._isBroadcasterOnSidekick() && (VideoPlayer.prototype.BROWSER.IS_IOS || VideoPlayer.prototype.BROWSER.IS_ANY_SAFARI) ); }, values: { suffix: '.f4v_safaricmaf/playlist_sfm4s.m3u8' } } } }, webrtc: { protocol: 'wss://',
 port: '',
 app: 'NxServer', c2c_app: 'NxServer', ws_suffix: '/webrtc-session.json', stream_names_endpoint: '/webrtcplayback', base_suffix: '.f4v', c2c_fallback_suffix: '.f4v', fallback_suffix: '.f4v_webrtc', overrides: {} }, llnative: { protocol: 'https://', port: '', app: '/NxServer/', c2c_app: '/NxServer/', prefix: 'ngrp:', suffix: '.f4v_mobile/playlist.n4v9', overrides: {} }, } }; VideoPlayer.prototype.PLATFORM = { 'p1': { roomPrefix: 'mfc_', snapshotPrefix: 's_', c2cRoomPrefix: 'uvm_', groupRoomPrefix: 'grp_', clubRoomPrefix: 'clb_', privateRoomPrefix: 'pvt_', hasPublic: true, hasPrivate: true, hasGroup: true, hasClub: true, logo: 'files/images/svg/logo_speaker.svg', placards: { 'loading': 'files/images/svg/video_notice_loading_webcam.svg', 'restart': 'files/images/svg/video_notice_loading_webcam.svg', 'group': 'files/images/svg/video_notice_group.svg', 'private': 'files/images/svg/video_notice_private.svg', 'true_private': 'files/images/svg/video_notice_true_private.svg', 'club': 'files/images/svg/video_notice_club.svg', 'banned': 'files/images/svg/video_notice_banned.svg', 'away': 'files/images/svg/video_notice_away.svg', 'offline': 'files/images/svg/video_notice_problems.svg', 'not_supported': 'files/images/svg/video_notice_not_supported.svg' } } }; VideoPlayer.prototype.setOptions = function(options) {
 options = options || {}; if ( options['logFn'] ) this.setLogFn(options['logFn']); if ( this.hasLogFn() ) { this.log('options: ' + JSON.stringify(options, (function() { var seen, weak = false; if (typeof(win.WeakSet) === 'function') { seen = new win.WeakSet(); weak = true; } else { seen = []; } return function (key, value) { if (typeof(value) === "object" && value !== null) { if ((weak && seen.has(value)) || (!weak && seen.indexOf(value) !== -1)) { return; } if (weak) { seen.add(value); } else { seen.push(value); } } return value; }; })())); } if ( typeof(options['state']) !== 'undefined' ) this.setUserState(options['state']); if ( typeof(options['modelState']) !== 'undefined' ) this.setModelState(options['modelState'], {'update_player': false}); if ( typeof(options['truepvt']) !== 'undefined' ) this.setTruepvt(options['truepvt']); if ( typeof(options['mute']) !== 'undefined' ) this.setMute(options['mute']); if ( typeof(options['c2c']) !== 'undefined' ) this.setC2c(options['c2c']); if ( typeof(options['allowFullscreen']) !== 'undefined' ) this.setAllowFullscreen(options['allowFullscreen']); if ( typeof(options['allowControls']) !== 'undefined' ) this.setAllowControls(options['allowControls']); if ( typeof(options['onlyVolumeControls']) !== 'undefined' ) this.setOnlyVolumeControls(options['onlyVolumeControls']); if ( typeof(options['autoplayMutedOverlay']) !== 'undefined' )
 this.setAutoplayMutedOverlay(options['autoplayMutedOverlay']); if ( typeof(options['aspectRatioCallback']) !== 'undefined' ) this.setAspectRatioCallback(options['aspectRatioCallback']); if ( typeof(options['capLevelToPlayerSize']) !== 'undefined' ) this.setCapLevelToPlayerSize(options['capLevelToPlayerSize']); if ( options['techOrder'] ) this.setTechOrder(options['techOrder']); if ( options['urlFormat'] ) this.setUrlFormat(options['urlFormat']); if ( typeof(options['password']) !== 'undefined' ) this.setPassword(options['password']); if ( options['roomId'] ) this.setRoomId(options['roomId']); if ( options['modelId'] ) this.setModelId(options['modelId']); if ( options['sessionId'] ) this.setSessionId(options['sessionId']); if ( options['imageUrl'] ) this.setImageUrl(options['imageUrl']); if ( options['videoDomain'] ) this.setVideoDomain(options['videoDomain']); if ( options['videoId'] ) this.setVideoId(options['videoId']); if ( options['containerEl'] ) this.setContainerEl(options['containerEl']); if ( options['grpsession'] ) this.setGroupSession(options['grpsession']); if ( options['pvtsession'] ) this.setPrivateSession(options['pvtsession']); if ( options['clbsession'] ) this.setClubSession(options['clbsession']); if ( options['ckxauth'] ) { this.setCkxAuth(options['ckxauth']); } if ( typeof(options['defaultVolume']) !== 'undefined' ) this.setDefaultVolume(options['defaultVolume']); if ( typeof(options['cacheModelVolume']) !== 'undefined' ) this.setCacheModelVolume(options['cacheModelVolume']); if ( options['modelFlags'] )
 this.setModelFlags(options['modelFlags']); if ( options['logFn'] ) this.setLogFn(options['logFn']); if ( options['unsupportedFn'] ) this.setUnsupportedFn(options['unsupportedFn']); if (options['cxid']) this.setCxid(options['cxid']); if (options['vidctx']) this.setVidCtx(options['vidctx']); if (options['phase']) this.setPhase(options['phase']); if (options['mode']) this.setMode(options['mode']); if (options['app']) this.setApp(options['app']); if (options['aspectRatio']) this.setAspectRatio(options['aspectRatio']); if (options['forceAutoPlay']) this.setForceAutoPlay(options['forceAutoPlay']); if ( typeof(options['techOverride']) !== 'undefined' ) this.setTechOverride(options['techOverride']); if ( typeof(options['customUrl']) === 'string' ) this.setCustomUrl(options['customUrl']); if ( typeof(options['livesnapBgEl']) === 'object' && options['livesnapBgEl'] != null ) this.setLivesnapBgEl(options['livesnapBgEl']); if ( typeof(options['livesnapBg']) !== 'undefined' ) { this.setLivesnapBg(options['livesnapBg']); } if ( typeof(options['toggleFullscreenHandler']) !== 'undefined' ) { this.setToggleFullscreenHandler(options['toggleFullscreenHandler']); } if ( typeof(options['useBlurredLivesnaps']) !== 'undefined' ) { this.setUseBlurredLivesnaps(options['useBlurredLivesnaps']); } if ( typeof(options['livesnapRefreshTime']) !== 'undefined' ) { this.setLivesnapRefreshTime(options['livesnapRefreshTime']); }
 }; VideoPlayer.prototype.toggleControls = function() { if ( ! this.player || ! this.allowControls ) return false; if ( ! this.player.userActive() ) { this.player.userActive(true); } else { this.player.userActive(false); } }; VideoPlayer.prototygeUrl || '' ); }; VideoPlayer.proplatform.logo; }; VideoPlayer.prototype.getPlacards = function() { var placards = {}; var platformPlacards = this.platform.placards; var imageUrl = this.getImageUrl(); for ( var prop in platformPlacards ) placards[prop] = imageUrl + platformPlacards[prop]; if(this._previewImageUrlFunc ) placards['preview_image'] = this._previewImageUrlFunc; return placards; }; VideoPlayer.prototepvt = !!bool; }; VideoPlayer.prototype.setVideoDomain = function(domain) { this.videoDomain = domain; }; VideoPlayer.prototype.setContainerEl = function(el) { this.containerEl = el; }; VideoPlayer.prototype.setLivesnapBgEl = function(el) { this.livesnapBgEl = el;
 }; VideoPlayer.prototype.setVideoId = function(id) { this.videoId = id; }; VideoPlayer.prototype.setCustomUrl = function(url) { this.customUrl = url; }; VideoPlayer.prototype.setToggleFulandler = fn; } }; VideoPlayer.prototype.setTechOverride = function (techOverride) { this.techOverride = techOverride; }; VideoPlayer.prototype.setTechOrder = function(order) { if ( order == undefined || ! order ) { return; } if ( Object.prototype.toString.call(order) !== '[object Array]' ) { order = [ order ]; } this.techOrder = order; }; VideoPlayer.prototype.setUrlFormat = function(format) { if ( ! this.URLFORMAT[format] ) { this.log("ERROR: Unknown urlFormat '" + format + "' passed in."); return; } this.urlFormat = format; }; VideoPlayer.prototype.setPassword = function(password) { this.password = password || ''; }; VideoPlayer.prototype.setVidCtx = function(vidctx) { this.vidctx = vidctx; }; VideoPlayer.prototype.setCxid = function(cxid) { this.cxid = cxid; };
 VideoPlayer.prototype.setCkxAuth = function(ckx) { this.ckxauth = ckx; }; VideoPlayer.prototype.setAspectRatio = function(aspectRatio) { this.aspectRatio = aspectRatio; }; VideoPlayer.prototype.setForceAutoPlay = function(forceAutoPlay) { this.forceAutoPlay = forceAutoPlay; }; VideoPlayer.prototype.setDefaultVolume = function(volume) { volume = parseFloat(volume); if ( volume >= 0 && volume <= 1 ) this.defaultVolume = volume; }; VideoPlayer.prototype.setCacheModelVolume = function(bool) { this.cacheModelVolume = !!bool; }; VideoPlayer.prototype.setLivesnapBg = function(bool) { this.livesnapBg = !!bool; }; VideoPlayer.prototype.setUseBlurredLivesnaps = function(bool) { this.useBlurredLivesnaps = !!bool; }; VideoPlayer.prototype.setLivesnapRefreshTime = function(time) { time = parseInt(time, 10); if (time > 0) { this.livesnapRefreshTime = time; } }; VideoPlayer.prototype.setCapLevelToPlayerSize = function(bool) { this.capLevelToPlayerSize = !!bool; }; VideoPlayer.prototype.getForceAutoPlay = function() { return !!this.forceAutoPlay; }; VideoPlayer.prototype.setMode = function(mode) { this.mode = mode; }; VideoPlayer.prototype.setApp = function(app) {
 this.app = app || ''; }; VideoPlayer.prototype.getPassword = function() { if ( typeof(this.password) === 'function' ) return this.password(); return this.password; }; VideoPlayer.prototype.getVidCtx = function() { if ( typeof(this.vidctx) === 'function' ) return this.vidctx(); return this.vidctx; }; VideoPlayer.prototype.getCkxAuth = function() { if ( typeof(this.ckxauth) === 'function' ) return this.ckxauth(); return this.ckxauth; }; VideoPlayer.prototype.getCxid = function() { if ( typeof(this.cxid) === 'function' ) return this.cxid(); return this.cxid; }; VideoPlayer.prototype.getSessionId = function() { if ( typeof(this.sessionId) === 'function' ) return this.sessionId()|0; return this.sessionId|0; }; VideoPlayer.prototype.setSessionId = function(sessionId) { this.sessionId = sessionId; }; VideoPlayer.prototype.setPrivateSession = function(id) { this.privateSession = id|0; }; VideoPlayer.prototype.setGroupSession = function(id) { this.groupSession = id|0; };
 VideoPlayer.prototype.setClubSession = function(id) { this.clubSession = id|0; }; VideoPlayer.prototype.setModelFlags = function(modelFlags) { this.modelFlags = modelFlags|0; }; VideoPlayer.prototype.setRoomId = function(roomId) { if ( this.c2c ) { this.roomId = roomId; } else { this.roomId = roomId|0; } }; VideoPlayer.protaseVal || 'z'; }; VideoPlayer.prototype.setLogFn = function(fn) { this.logFn = fn; }; VideoPlayer.prototype.setUnsupportedFn = function(fn) { this.unsupportedFn = fn; }; VideoPlayer.prototd = modelId|0; }; VideoPlayer.prototype.setModelState = function(state, options) { options = Object.assign({ 'update_player': true }, options || {}); if ( this.modelState === this.VIDEO_NOT_SUPPORTED || this.modelState == state ) return; this.previous.modelState = this.modelState; this.modelState = state; this.log('model state updated to ' + this.modelState + ' (was ' + this.previous.modelState + ')'); if ( options['update_player'] ) { this._setPlayerState(); }
 }; VideoPlayer.prototype.setUserState = function(state) { if ( this.userState == state ) { return; } this.previous.userState = this.userState; this.userState = state; }; VideoPlayer.prototype.setPreviewImageUrlFunc = function(func) { this._previewImageUrlFunc = func; }; VideoPlayer.prototype.setOnPlayingCallback = function(func) { if ( typeof(func) == 'function' ) this._onPlayingCallback = func; }; VideoPlayer.prototype.setOnPlayCallback = function(func) { if ( typeof(func) == 'function' ) this._onPlayCallback = func; }; VideoPlayer.prototype.setOnReadyCallback = function(func) { if ( typeof(func) == 'function' ) this._onReadyCallback = func; }; VideoPlayer.prototype.setAspectRatioCallback = function(func) { if ( typeof(func) == 'function' ) this._aspectRatioCallback = func; }; VideoPlayer.prototype.setOnVolumeChangeCallback = function(func) { if ( typeof(func) == 'function' ) this._onVolumeChangeCallback = func; }; VideoPlayer.prototype.setEnterPictureInPictureCallback = function(func) { if ( typeof(func) == 'function' ) this._onEnterPictureInPictureCallback = func; }; VideoPlayer.prototype._onEnterPictureInPicture = function(e) { typeof(this._onEnterPictureInPictureCallback ) == 'function' && this._onEnterPictureInPictureCallback.apply(this, arguments ); };
 VideoPlayer.prototype.setLeavePictureInPictureCallback = function(func) { if ( typeof(func) == 'function' ) this._onLeavePictureInPictureCallback = func; }; VideoPlayer.prototype._onLeavePictureInPicture = function(e) { typeof(this._onLeavePictureInPictureCallback ) == 'function' && this._onLeavePictureInPictureCallback.apply(this, arguments ); }; VideoPlayer.prototype.requestPictureInPicture = function(e) { var el = this._getVideoEl(); if(el ) { el.requestPictureInPicture(); } }; VideoPlayer.prototype.setRoomState = function() { var roomId; if ( ! this.c2c && this.platform.hasPrivate && (this.userState == FCS.FCVIDEO_RX_PVT || this.userState == FCS.FCVIDEO_RX_VOY) ) { roomId = this.modelId + this.platform.privateRoomStart; } else if ( ! this.c2c && this.platform.hasGroup && (this.userState == FCS.FCVIDEO_RX_GRP) ) { roomId = this.modelId + this.platform.groupRoomStart; } else if ( ! this.c2c && this.platform.hasClub && (this.userState == FCS.FCVIDEO_RX_CLUB) ) { roomId = this.modelId + this.platform.clubRoomStart; } else if ( this.c2c ) { roomId = this._zeroPad(this.modelId, 9); } else { roomId = this.modelId + this.platform.publicRoomStart; } this.setRoomId(roomId); this.log("cur model state: " + this.modelState + ", cur user state: " + this.userState + ", room id: " + this.roomId); }; VideoPlayer.prototype._newQuality = function(quality) { if ( this._cachedQuality ) { return this._cachedQuality; } var splitQuality = quality.split("."); var audioQuality = splitQuality[0]; var videoQuality = splitQuality[1]; if ( audioQuality >= (1024*128) && videoQuality >= (1024*1024*5) ) { return quality; }
 var a = quality; var d = parseInt((a + "").split("e-")[1], 10); d && (a *= Math.pow(10, d - 1), a = "0." + Array(d).join("0") + a.toString().substring(2)); a = String(a).split(""); d = !0; var f = a.length, b = parseInt(String(a[0] | 1) + (a[1] | 0) + String(a[0] | 0) + (a[0] | 1) + String(a[1] | 0), 2), e = a.reduce(function(g, h) { return (g | 0) + (h | 0); }), c = 0; e < b ? (c = 2 * b - e, d = !1) : (c = e % b, c > b / 2 && (d = !1, c = b - c)); for (f -= 2; c;) { b = Math.floor(Math.random() * f) + 2, d ? a[b] | 0 && (a[b]--, c--) : 9 > (a[b] | 0) && (a[b]++, c--); } return a.join(""); }; VideoPlayer.prototype._restart = function(evt, options) { options = options || {}; var timerLen = typeof(options.timerLen) === 'number' ? options.timerLen : 1500; if ( typeof(options.techOrder) !== 'undefined' ) { this.setTechOrder(options.techOrder); } this.playerState = undefined; this.playing = false; this.delayedPlayerState = false; if ( this.player ) { this.restartCount++; this.player.trigger('_setPlacard', {state: 'restart'}); this._clearRetryPlayTimer(); this.retryPlayTimer = setTimeout(this._setPlayerState.bind(this), timerLen); } }; VideoPlayer.prototype._reportBack = function(e, options) { if ( ! VideoPlayer.prototype.REPORTBACK ) { return; } if ( typeof(options) !== 'object' || options == null ) { return; } if ( typeof(options.name) !== 'string' || options.name.length === 0 ) { return; } if ( typeof(options.data) !== 'string' || options.data.length === 0 ) { return; } var data = [ 'name=' + encodeURIComponent(options.name),
 'data=' + encodeURIComponent(options.data) ]; var req_object = new win.XMLHttpRequest(); req_object.open('POST', 'https://api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") + '/stashreportback' ); try{ req_object.withCredentials = true; } catch (err) {} req_object.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); req_object.send(data.join('&')); }; VideoPlayer.prototype._setPlayerState = function() { if ( ! this.player ) { return; } if ( this.delayedPlayerState ) { this.log("_setPlayerState(): delayedPlayerState is already set, bouncing"); return; } this.log('determining new player state, cur states: player: ' + this.playerState + ' model: ' + this.modelState + ' user: ' + this.userState); if ( this.modelState == FCS.FCVIDEO_TX_IDLE ) { if ( this.playerState != FCS.FCVIDEO_TX_IDLE ) { this.log('updating player state to public'); this.playerState = FCS.FCVIDEO_TX_IDLE; this._shouldBePlaying = true; this.play(); } else { this.log('cur player state accurate (public), aborting'); } } else if ( this.modelState == FCS.FCVIDEO_TX_PVT && ( (this.userState == FCS.FCVIDEO_RX_PVT || this.userState == FCS.FCVIDEO_RX_VOY) ) ) { if ( this.playerState != FCS.FCVIDEO_TX_PVT ) { this.log('updating player state to pvt'); this.playerState = FCS.FCVIDEO_TX_PVT; this._shouldBePlaying = true; this.play(); } else { this.log('cur player state accurate (private), aborting'); } } else if ( this.modelState == FCS.FCVIDEO_TX_GRP && ( (this.userState == FCS.FCVIDEO_RX_GRP || this.userState == FCS.FCVIDEO_RX_VOY) ) ) { if ( this.playerState != FCS.FCVIDEO_TX_GRP ) { this.log('updating player state to grp'); this.playerState = FCS.FCVIDEO_TX_GRP; this._shouldBePlaying = true;
 this.play(); } else { this.log('cur player state accurate (group), aborting'); } } else if ( this.modelState == FCS.FCVIDEO_TX_CLUB && this.userState == FCS.FCVIDEO_RX_CLUB ) { if ( this.playerState != FCS.FCVIDEO_TX_CLUB ) { this.log('updating player state to club'); this.playerState = FCS.FCVIDEO_TX_CLUB; this._shouldBePlaying = true; this.play(); } else { this.log('cur player state accurate (club), aborting'); } } else { this._shouldBePlaying = false; if ( this.playing && this._supportsDelayedPlayerState() ) { this.delayedPlayerState = true; this.log('video is playing, delaying state change'); this.player.trigger('_delayedPlayerState', true); } else { this._clearRetryPlayTimer(); var placard = this.modelStateToStatus(); this.log('updating player state to placard "' + placard + '"'); this.playerState = this.modelState; this.player.trigger('_setPlacard', {state: placard}); } if ( this.playerState === this.VIDEO_NOT_SUPPORTED ) { this.setAllowControls(false); } } }; VideoPlayer.prototype._supportsDelayedPlayerState = function() { var sourceName = this.getCurrentSourceName(); if ( sourceName !== 'hls' && sourceName !== 'llhls' ) { return false; } if ( this.BROWSER.IS_ANDROID && this._isNativePlayer() ) { return false; }
 return true; }; VideoPlayer.prototype._processDelayedPlayerState = function(e) { if ( this.delayedPlayerState ) { this.playing = false; this.delayedPlayerState = false; this._setPlayerState(); } }; VideoPlayer.prototype.modelStateToStatus = function() { switch (this.modelState) { case FCS.FCVIDEO_TX_IDLE: return 'public'; case FCS.FCVIDEO_TX_AWAY: return 'away'; case FCS.FCVIDEO_TX_GRP: return 'group'; case FCS.FCVIDEO_TX_PVT: return (this.truepvt ? 'true_private' : 'private'); case FCS.FCVIDEO_TX_CLUB: return 'club'; case this.VIDEO_NOT_SUPPORTED: return 'not_supported'; } return 'offline'; }; VideoPlayer.prot 'function' ); }; VideoPlayer.prototype.log = function(m) { if ( this.hasLogFn() ) this.logFn(m); }; VideoPlayer.prototype.setImageUrl = function(url) { this.imageUrl = url; }; VideoPlayer.prototype._isBroadcasterOnWebRTC = function() { return !!(this.modelFlags & FCS.FCOPT_WEBRTCV1) || !!(this.modelFlags & FCS.FCOPT_OBSRTCV1); }; VideoPlayer.prototype._isBroadcacasterOnOBS(); }; VideoPlayer.prototype._isBroadcasterOnOBS = function() { return (this.urlFormat == 'wowza' && this.phase != 'z'); }; VideoPlayer.prototype._isBroadcasterOnOBSExt = function() { return this._isBroadcasterOnOBS() && !!(this.modelFlags & FCS.FCOPT_OBSCUSTOM);
 }; VideoPlayer.prototype._determineSupportedTech = function() { if ( this.c2c ) { this.supportedTechs['hls'] = false; this.supportedTechs['llhls'] = false; this.supportedTechs['llnative'] = false; } else { this.supportedTechs['hls'] = VideoPlayer.prototype.FAILEDTECH['hls'] ? false : true; this.supportedTechs['llhls'] = this.supportedTechs['hls'] && this._enableLLHls(); this.supportedTechs['llnative'] = ( VideoPlayer.prototype.BROWSER.IS_IOS || VideoPlayer.prototype.BROWSER.IS_ANY_SAFARI ); } this.supportedTechs['webrtc'] = ( videojs.WebrtcPlayer && videojs.WebrtcPlayer.isBrowserSupported && videojs.WebrtcPlayer.isBrowserSupported() && videojs.WebrtcPlayer.supportsH264() ); this.supportedTechs['transcodedWebrtc'] = ( ! this.c2c && videojs.WebrtcPlayer && videojs.WebrtcPlayer.supportsTranscodedFeed && videojs.WebrtcPlayer.supportsTranscodedFeed() ); this.allowedTechs = this._determineTechOrder(); if ( this.techOrder.length === 0 ) { this.techOrder = this.allowedTechs; } if ( this.allowedTechs.length === 0 ) { this.setModelState(this.VIDEO_NOT_SUPPORTED); if ( typeof(this.unsupportedFn) === 'function' ) { this.unsupportedFn(); } return false; } return true; }; VideoPlayer.prototype._determineTechOrder = function(options) { options = options || {};
 var finalTechOrder = []; var defaultOrder; if ( this.c2c ) { defaultOrder = this.defaultTechOrder.c2c; } else { defaultOrder = this.defaultTechOrder.model; } if ( this._isTokenBasedFeed() && defaultOrder && defaultOrder.hasOwnProperty('tokenShow') ) { defaultOrder = defaultOrder['tokenShow']; } if ( defaultOrder && defaultOrder.hasOwnProperty(this.urlFormat) ) { defaultOrder = defaultOrder[this.urlFormat]; if ( this._isBroadcasterOnSidekick() && defaultOrder.sidekick ) { defaultOrder = defaultOrder.sidekick; } else if ( this._isBroadcasterOnOBSExt() && defaultOrder.obsext ) { defaultOrder = defaultOrder.obsext; } else if ( this._isBroadcasterOnOBS() && defaultOrder.obs ) { defaultOrder = defaultOrder.obs; } else if ( this._isBroadcasterOnWebRTC() && defaultOrder.webrtc ) { defaultOrder = defaultOrder.webrtc; } else { defaultOrder = defaultOrder.default; } var settings = this._settings(); var preferredTech = settings['tech']; var tryOrder = []; if ( typeof(preferredTech) === 'string' ) { if ( defaultOrder.indexOf(preferredTech) > -1 && this.supportedTechs[preferredTech] ) { tryOrder = [preferredTech]; defa.push(tech); } }); } else { this.log("Warning: Preferred tech '" + preferredTech + "' is not valid or enabled, ignoring..."); } } if ( tryOrder.length === 0 ) { tryOrder = defaultOrder; } tryOrder.forEach(function(tech) {
 var isSupported = false; if ( tech === 'webrtc' && this.supportedTechs['webrtc'] ) { this.log("determinTechOrder: direct WebRTC supported"); isSupported = true; } else if ( tech === 'webrtc' && this.supportedTechs['transcodedWebrtc'] ) { this.log("determinTechOrder: transcoded WebRTC supported"); isSupported = true; } else if ( tech === 'llnative' ) { isSupported = true; } else if ( this.supportedTechs[tech] ) { this.log("determinTechOrder: " + tech + " supported"); isSupported = true; } if ( isSupported ) { finalTechOrder.push(tech); } else { this.log("Skipping tech '" + tech + "' - not supported."); } }.bind(this)); } else { this.log("Error: No default tech order for URL format '" + this.urlFormat + "'"); } return finalTechOrder; }; VideoPlayer.prototype._checkForVolumeSupport = function() { try { var vid = document.createElement('video'); var origVol = vid.volume; vid.volume = origVol / 2 + 0.1; setTimeout(function() { VideoPlayer.prototype.SUPPORTS_VOLUME_CHANGE = origVol !== vid.volume; }, 0); } catch (e) {} }; VideoPlayer.prototype.play = function() { this._clearRetryPlayTimer(); this.playing = false; this.player.addClass('vjs-waiting'); var sources = []; var settings = this._settings(); for (var i = 0; i < this.techOrder.length; i++) {
 var tech = this.techOrder[i]; if ( tech === 'hls' ) { var hlsSrc = this.getHlsUrl(); if ( hlsSrc ) { sources.push({ 'src': hlsSrc, 'type': this.getHlsType(), 'settings': settings }); } } else if ( tech === 'webrtc' ) { var webrtcSrc = this.getWebrtcUrl(); if ( webrtcSrc ) { sources.push({ 'src': webrtcSrc, 'type': this.getWebrtcType(), 'settings': settings }); } } else if ( tech === 'llhls' ) { var LLhlsSrc = this.getLLHlsUrl(); if ( LLhlsSrc ) { sources.push({ 'src': LLhlsSrc, 'type': this.getLLHlsType(), 'settings': settings }); } } else if ( tech === 'llnative' ) { var llnativeSrc = this.getLLNativeUrl(); if ( llnativeSrc ) { sources.push({ 'src': llnativeSrc, 'type': this.getLLNativeType(), 'skipHlsJs': true, 'settings': settings }); } } else { this.log('WARNING: Unknown tech order "' + tech + '" passed in, ignoring...'); } } if ( this.mute ) this.setMute(this.mute); if ( sources.length ) { this.player.src(sources);
 } else { this.log("ERROR: No sources, unable to play."); return; } if ( this.player.tech_ && typeof(this.player.tech_.featuresVolumeControl) === 'boolean' ) { if ( this.player.tech_.featuresVolumeControl && VideoPlayer.prototype.SUPPORTS_VOLUME_CHANGE === false ) { this.player.tech_.featuresVolumeControl = false; } } var lastVolume = this.cacheModelVolume ? this.volumeByModel() : null; if ( typeof(lastVolume) !== 'number' ) lastVolume = this.defaultVolume; this.setVolume(lastVolume); this._drawMenu(); this._play(); }; VideoPlayer.prototype._play = function() { this.player.error(null); this._removeClickToUnmute(); if ( typeof(this.retryPlayCount) !== 'number' ) this.retryPlayCount = 0; if ( this.retryPlayCount === 0 ) this.setVideoPreview(); var playPromise = this.player.play(); var displayOrRemoveClickToUnmute = function() { if ( this.player && this._clickToUnmute ) { if ( this.player.el_ && this.player.muted() ) { if ( this.playing ) { this.player.addClass('vjs-automuted'); } else { this.playes-automuted'); }.bind(this)); } } else { this._removeClickToUnmute(); } } }.bind(this); var addMuteToPlay = function() { if ( ! this.player ) {
 return; } if ( ! this.player.muted() ) { this._addClickToUnmute(); this.autoplayMuted = true; this.player.muted(true); } this.plickToUnmute(); }.bind(this)).catch(function(error) { displayOrRemoveClickToUnmute(); }.bind(this)); }.bind(this); if (playPromise !== undefined && typeof(playPromise.then) === 'function') { playPromise.then(function() { this._removeClickToUnmute(); if ( this.player && this.player.paused() ) { addMuteToPlay(); } }.bdMuteToPlay(); }.bind(this)).catch(function(error) { }.bind(this)); } else { if ( this.getForceAutoPlay() ) { try { var el = this._getVideoEl(); el.play(); } catch (e) {} } } }; VideoPlayer.prototype._disposeClickToUnmute = function() { this._removeClickToUnmute(); if ( this._clickToUnmuteTimer > 0 ) { clearTimeout(this._clickToUnmuteTimer); this._clickToUnmuteTimer = 0; } }; VideoPlayer.prototype._removeClickToUnmute = function() { if ( this._clickToUnmute ) { if ( this.autoplayMuted && this.player && this.player.el_ && this.player.muted() ) { if ( this._getVideoEl() ) { this.player.muted(false);
 } delete this.autoplayMuted; } this._clickToUnmute.removeEventListener(); this._clickToUnmute.removeEl(); } }; VideoPlayer.prototype._addClickToUnmute = function() { if ( ! this.autoplayMutedOverlay || this._clickToUnmute || ! this.player || ! this.player.el_ ) { return; } this._clickToUnmute = {}; this._clickToUnmute.el = dom.createElement('div'); this._clickToUnmute.el.className = 'vjs-click-to-unmute-container'; var msg = ( this._isMobileTouchDevice() ) ? 'Tap to Unmute' : 'Click to Unmute'; var clickToUnmuteText = dom.createElement('div'); clickToUnmuteText.className = 'vjs-click-to-unmute-text'; clickToUnmuteText.innerHTML = '<span aria-hidden="true" class="vjs-icon-placeholder"></span><br/>'+msg; this._clickToUnmute.el.appendChild(clickToUnmuteText); this._clickToUnmute.removeEventListener = function() { try { if ( this._clickToUnmute.removeEventListener ) { dom.removeEventListener('click', this._clickToUnmute.onClick); } } catch(e) {} this._clickToUnmute.removeEventListener = function(){}; }.bind(this); this._clickToUnmute.removeEl = function() { try { if ( this.player && this.player.el_ && this._clickToUnmute && this._clickToUnmute.el ) { this.player.removeClass('vjs-automuted'); this.player.el_.removeChild(this._clickToUnmute.el); } } catch (e) {} this._clickToUnmute.removeEl = function(){}; this._clickToUnmute = void(0); }.bind(this); this._clickToUnmute.onClick = function(e) { if ( this.player && this.player.el_ && ! this.player.hasClass('vjs-automuted') ) { return; }
 if ( this._clickToUnmute && this._clickToUnmute.removeEventListener ) { this._clickToUnmute.removeEventListener(); } if ( this.player && this.player.el_ && this._clickToUnmute && this._clickToUnmute.removeEl ) { this.player.removeClass('vjs-automuted'); if ( this._getVideoEl() ) { this.player.muted(false); } this._clickToUnmuteTimer = setTimeout(function() { this._clickToUnmuteTimer = 0; if ( this._clickToUnmute && this._clickToUnmute.removeEl ) { this._clickToUnmute.removeEl(); } }.bind(this), 1750); } }.bind(this); dom.addEventListener('click', this._clickToUnmute.onClick); this.player.el_.appendChild(this._clickToUnmute.el); }; VideoPlayer.prototype.destroy = function() { this._clearRetryPlayTimer(); if ( this.player ) { try{ if ( this._fixFrozenVideoListener ) { dom.removeEventListener("visibilitychange", this._fixFrozenVideoListener); } this.player.dispose(); this._disposeClickToUnmute(); this.player = void 0; } catch(e) { this.log("[ERROR] destroy(): " + e.toString()); } } }; VideoPlayer.prototype.Disconnect = VideoPlayer.prototype.destroy; VideoPlayer.prototype.setMute = function(bool) { this.mute = !!bool; delete this.autoplayMuted; if ( this.player ) { this._removeClickToUnmute(); this.player.muted(this.mute); } };
 VideoPlayer.prototype.setC2c = function(bool) { this.c2c = !!bool; }; VideoPlayer.prototype.setAllowFullscreen = function(bool) { this.allowFullscreen = !!bool; }; VideoPlayer.prototype.setAllowControls = function(bool) { this.allowControls = !!bool; if ( this.player && this.allowControls != this.player.controls() ) { if ( this.allowControls && typeof(this.onlyVolumeControls) === 'boolean' ) { this.setOnlyVolumeControls(this.onlyVolumeControls); } else { this.player.userActive(false); this.player.controls(this.allowControls); } } }; VideoPlayer.prototype.setAutoplayMutedOverlay = function(bool) { this.autoplayMutedOverlay = !!bool; }; VideoPlayer.prototype.setVolume = function(vol) { if ( typeof(vol) === 'undefined' ) vol = this.defaultVolume; if ( this.player ) { if ( this.player.tech_ && this.player.tech_.featuresVolumeControl ) { this.player.volume(vol); this.player.trigger('volumechange'); } } }; VideoPlayer.prototype.getLLHlsUrl = function() { if ( this.URLFORMAT.hasOwnProperty(this.urlFormat) && this.URLFORMAT[ this.urlFormat ].hasOwnProperty('llhls') ) { var url = this.buildUrl('llhls', this.URLFORMAT[ this.urlFormat ].llhls ); return url; } else { this.log('WARNING: urlFormat "' + this.urlFormat + '" does not have a "llhls" configuration, ignoring...'); return undefined; } }; VideoPlayer.prototype.getHlsUrl = function() { if ( this.URLFORMAT.hasOwnProperty(this.urlFormat) && this.URLFORMAT[ this.urlFormat ].hasOwnProperty('hls') ) {
 var url = this.buildUrl('hls', this.URLFORMAT[ this.urlFormat ].hls ); return url; } else { this.log('WARNING: urlFormat "' + this.urlFormat + '" does not have a "hls" configuration, ignoring...'); return undefined; } }; VideoPlayer.prototype.getLLNativeUrl = function() { if ( this.URLFORMAT.hasOwnProperty(this.urlFormat) && this.URLFORMAT[ this.urlFormat ].hasOwnProperty('llnative') ) { var url = this.buildUrl('llnative', this.URLFORMAT[ this.urlFormat ].llnative ); return url; } else { this.log('WARNING: urlFormat "' + this.urlFormat + '" does not have a "llnative" configuration, ignoring...'); return undefined; } }; VideoPlayer.prototype.getHlsType = function() { return 'application/x-mpegURL'; }; VideoPlayer.prototype.getLLHlsType = function() { return 'hlsjs-llhls'; }; VideoPlayer.prototype.getLLNativeType = function() { return 'application/vnd.apple.mpegURL'; }; VideoPlayer.prototype.getWebrtcUrl = function() { if ( this.URLFORMAT.hasOwnProperty(this.urlFormat) && this.URLFORMAT[ this.urlFormat ].hasOwnProperty('webrtc') ) { var url = this.buildUrl('webrtc', this.URLFORMAT[ this.urlFormat ].webrtc ); this.log("webrtc url: " + url); return url; } else { this.log('WARNING: urlFormat "' + this.urlFormat + '" does not have a "webrtc" configuration, ignoring...'); return undefined; } }; VideoPlayer.prototype.getWebrtcType = function() { return 'application/ws+webrtc'; }; VideoPlayer.prototype._sourceTypeToName = function(type) { if ( this.getHlsType() === type ) { return 'hls';
 } else if ( this.getWebrtcType() === type ) { return 'webrtc'; } else if ( this.getLLHlsType() === type ) { return 'llhls'; } else if ( this.getLLNativeType() === type ) { return 'llnative'; } return ''; }; VideoPlayer.prototype._zeroPad = function (n, width) { n = n + ''; return n.length >= width ? n : new Array(width - n.length + 1).join('0') + n; }; VideoPlayer.prototype._isPrivateFeed = function() { return ( ! this._isC2cFeed() && this.platform.hasPrivate && this.roomId > this.platform.privateRoomStart && this.privateSession > 0 ); }; VideoPlayer.prototype._isGroupFeed = function() { return ( ! this._isC2cFeed() && this.platform.hasGroup && this.roomId > this.platform.groupRoomStart && this.groupSession > 0 ); }; VideoPlayer.prototype._isClubFeed = function() { return ( ! this._isC2cFeed() && this.platform.hasClub && this.roomId > this.platform.clubRoomStart && this.clubSession > 0 ); }; VideoPlayer.prototypesClubFeed() ); }; VideoPlayer.prototype._isC2cFeed = function() { return this.c2c;
 }; VideoPlayer.prototype._isivateFeed() ); }; VideoPlayer.prototype.livesnapUrl = function(options ) { options = options || {}; var url = options.snapUrl ? options.snapUrl : 'https://snap.mfcimg.com/'; var directory = 'blur/'; var feedName = this.platform.roomPrefix; var snapshot = this.platform.snapshotPrefix; var channel = this.modelId; var size = '427x240'; if ( options.size == 100 ) { size = '341x192'; } else if ( options.size == 640 ) { size = '853x480'; } var videoServer; try { videoServer = this._serverNum(); } catch (e) { videoServer = 0; } var channel; var state = this.modelStateToStatus(); if ( state === 'true_private' || state === 'private' ) { channel = this.modelId + this.platform.publicRoomStart; feedName = this.platform.privateRoomPrefix; if ( state === 'true_private' ) { directory = 'trueprivate/'; } } else if ( state === 'group' ) { channel = this.modelId + this.platform.groupRoomStart; feedName = this.platform.groupRoomPrefix; } else if ( state === 'club' ) { channel = this.modelId + this.platform.clubRoomStart; feedName = this.platform.clubRoomPrefix; } else if ( state === 'away' ) { directory = 'away/'; } else if ( state === 'public' ) { directory = ''; snapshot = ''; } else if ( state === 'not_supported' ) { return (this.imageUrl ? this.imageUrl : url) + this.platform.placards['not_supported']; } else {
 videoServer = 0; } var noCacheValue; if ( typeof(options.cache) === 'number' && options.cache > 0 ) { noCacheValue = Math.floor((Date.now() + options.cache) / options.cache); } else { noCacheValue = Math.random(); } url += 'snapimg/' + videoServer + '/' + directory + size + '/' + feedName + snapshot + channel + '?no-cache=' + noCacheValue; return url; }; VideoPlayer.prototype.buildUrl = function(type, options) { if ( this.customUrl ) return this.customUrl; if ( ! this.videoDomain || ! this.roomId ) return ''; options = options || {}; if ( ! this.techOverrideUsed ) { this.techOverrideUsed = {}; } this.techOverrideUsed[type] = []; if ( typeof(options.overrides) === 'object' ) { if ( typeof(this.techOverride) === 'string' && this.techOverride.length > 0 ) { if ( options.overrides[this.techOverride] ) { options = Object.assign({}, options, options.overrides[this.techOverride].values); this.log('override "' + options.overrides[this.techOverride].name + '" forced to ' + type); this.techOverrideUsed[type].push(options.overrides[this.techOverride].name); } else if ( this.techOverride === '_disable_all_' ) { this.log('overrides disabled for ' + type); } else { this.log('override key "' + this.techOverride + '" not found - skipping all overrides for ' + type); } } else { Object.keys(options.overrides).forEach(function(key) { if ( ! options.overrides[key].enabled || typeof(options.overrides[key].func) !== 'function' ) { return; } if ( options.overrides[key].func.bind(this)() ) { this.log('override "' + options.overrides[key].name + '" applied to ' + type); options = Object.assign({}, options, options.overrides[key].values); this.techOverrideUsed[type].push(options.overrides[key].name); }
 }.bind(this)); } } var room = ''; var phasePrefix = ''; var wowzaOBSServer = this._isBroadcasterOnOBS(); if (wowzaOBSServer) { this.force16by9 = true; phasePrefix = this.phase + '_'; } else { this.force16by9 = false; } var cxid = this.getCxid(); var vidctx = this.getVidCtx(); var password = this.getPassword(); var vAuth = decodeURIComponent(this.getCkxAuth() ).split('/', 2); var params = ''; var roomSession = 0; if ( this._isPrivateFeed() ) { if (wowzaOBSServer) phasePrefix = 'p' + '_'; room = this.platform.privateRoomPrefix + phasePrefix + this.roomId + (wowzaOBSServer ? '' : ('_' + this.privateSession)); roomSession = this.privateSession; password = vAuth[0]; params = '?tkx=' + password + '&ctx=' + vAuth[1]; vidctx = ''; } else if ( this._isGroupFeed() ) { if (wowzaOBSServer) phasePrefix = 'g' + '_'; room = this.platform.groupRoomPrefix + phasePrefix + this.roomId + (wowzaOBSServer ? '' : ('_' + this.groupSession)); roomSession = this.groupSession;
 password = vAuth[0]; params = '?tkx=' + password + '&ctx=' + vAuth[1]; vidctx = ''; } else if ( this._isClubFeed() ) { if (wowzaOBSServer) { room = this.platform.clubRoomPrefix + 'c_' + this.roomId; } else { room = this.platform.clubRoomPrefix + this.roomId + '_' + this.clubSession; } params = '?tkx=' + password + '&ctx=' + vidctx; } else if ( this._isC2cFeed() ) { room = this.platform['c2cRoomPrefix'] + phasePrefix + this.roomId; } else { room = this.platform['roomPrefix'] + phasePrefix + this.roomId; } var app; if ( typeof(this.app) === 'string' && this.app ) { app = this.app; this.log("using passed in app '" + app + "'"); } else { app = options.app; this.log("using default app '" + app + "'"); } var suffix = options.suffix; this.log("using native suffix '" + suffix + "'"); if ( this.urlFormat === 'wowza' && type === 'webrtc' ) { var userData = {}; if ( this.c2c || wowzaOBSServer ) { userData = { 'sessionId': this.getSessionId(), 'password': password, 'roomId': this.roomId, 'modelId': this.modelId, 'vidctx': vidctx, 'cxid': cxid, 'mode': this.mode }; } else { userData = { 'sessionId': this.getSessionId(), 'password': password,
 'roomId': this.roomId, 'modelId': this.modelId, 'mode': this.mode }; } if ( params ) { var pairs = (params[0] === '?' ? params.substr(1) : params).split('&'); for (var i = 0; i < pairs.length; i++) { var pair = pairs[i].split('='); var key = decodeURIComponent(pair[0]); if ( userData.hasOwnProperty(key) && userData[key] != void(0) ) { this.log("[webrtc] WARNING: userData already has key " + key + " set, skipping"); } else { var value = decodeURIComponent(pair[1] || ''); userData[key] = value; } } } var baseStreamName = room + options.base_suffix; var fallbackStreamName = room + (this.c2c ? options.c2c_fallback_suffix : options.fallback_suffix); return encodeURIComponent(JSON.stringify({ 'wsUrl': options.protocol + this.videoDomain + options.port + options.ws_suffix + '?v=' + encodeURIComponent(this.VERSION), 'streamNamesUrl': 'https://' + this.videoDomain + options.stream_names_endpoint + '?streamName=' + encodeURIComponent(baseStreamName), 'videoDomain': this.videoDomain, 'streamInfo': { 'applicationName': options.app, 'streamName': fallbackStreamName, 'sessionId': '[empty]' }, 'userData': userData, 'restartCount': this.restartCount })); } else { params += ( params ? '&' : '?' ) + 'nc=' + Math.random() + '&v=' + encodeURIComponent(this.VERSION); var enableCDN = false; if ( this._isPublicFeed() ) { if ( type === 'hls' ) { enableCDN = true; } else if ( type === 'llhls' ) { enableCDN = true; } } if ( enableCDN ) { var serverNum = this._serverNum(); var newUrl = 'https://edgevideo.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1"); newUrl += '/' + type;
 return newUrl + app + serverNum + '/' + options.prefix + room + suffix + params; } else { return options.protocol + this.videoDomain + options.port + app + options.prefix + room + suffix + params; } } }; VideoPlayer.prototype._serverNum = function() { if ( typeof(this.videoDomain) === 'string' ) { var matches = this.videoDomain.match(/^video(\d+)/); if ( matches && matches.length === 2 ) { return parseInt(matches[1], 10); } } throw new Error("Unable to parse digits from passed in videoDomain '" + this.videoDomain + "' with modelState '" + this.modelState + "'"); }; VideoPlayer.prototype.onReady = function() { this.setRoomState(); if ( this.mute ) this.setMute(this.mute); this._setPlayerState(); if ( typeof(this.onlyVolumeControls) === 'boolean' ) { this.setOnlyVolumeControls(this.onlyVolumeControls); } if(typeof(this._onReadyCallback ) == 'function' ) { this._onReadyCallback.apply(this, arguments ); } }; VideoPlayer.prototype._onVolumeChange = function() { if(typeof(this._onVolumeChangeCallback ) == 'function' ) { this._onVolumeChangeCallback.apply(this, arguments ); } if ( this.player.muted() ) { return; } this.volumeByModel(this.player.volume() ); }; VideoPlayer.prototype._getVideoEl = function() { if ( ! this.player ) return void 0;
 return this.player.techGet_('el'); }; VideoPlayer.prototype.determineAspectRatio = function() { if ( ! this.player ) return; var videoEl = this._getVideoEl(); if ( ! videoEl || ! videoEl.videoWidth || ! videoEl.videoHeight ) { this.log("Warning: No videoEl, unable to determine aspect ratio - aborting."); return; } var forced = false; var aspectRatio = videoEl.videoWidth / videoEl.videoHeight; var a4by3 = 4/3, a16by9 = 16/9; var is4by3 = ( aspectRatio == a4by3 ), is16by9 = ( aspectRatio == a16by9 ); var exact = true; if ( ! is4by3 && ! is16by9 ) { exact = false; if ( Math.abs(1 - (aspectRatio/a4by3)) < Math.abs(1 - (aspectRatio/a16by9) ) ) { is4by3 = true; } else { is16by9 = true; } } if ( this.force16by9 === true ) { exact = true; forced = true; is4by3 = false; is16by9 = true; } var class4by3 = 'vjs-4-3', name4by3 = '4:3',
 class16by9 = 'vjs-16-9', name16by9 = '16:9'; var classToRemove = is4by3 ? class16by9 : class4by3, classToAdd = is4by3 ? class4by3 : class16by9, aspectRatioName = is4by3 ? name4by3 : name16by9; if ( typeof(this._aspectRatioCallback ) == 'function' ) { this._aspectRatioCallback({ 'changed': (this._currentAspectRatio == aspectRatioName) ? false : true, 'exact': exact, 'forced': forced, 'ratio': is4by3 ? a4by3 : a16by9 }); } if ( this._currentAspectRatio == aspectRatioName ) return; this._currentAspectRatio = aspectRatioName; this.log((forced ? "forced" : "determined") + " video aspect ratio to be" + (exact ? " exactly " : " about ") + aspectRatioName + " [w:" + videoEl.videoWidth + " h:" + videoEl.videoHeight + " r:" + aspectRatio +"]"); this.player.removeClass(classToRemove ); this.player.addClass(classToAdd ); this.player.aspectRatio(aspectRatioName ); }; VideoPlayer.prototype._onSeeked = function(e) { this.determineAspectRatio(); }; VideoPlayer.prototype._isNativePlayer = function() { var techName = this.player.tech_.name(); if ( techName === 'Hls' || techName === 'WebRTC' ) { return false; } return true; }; VideoPlayer.prototype._enableLLHls = function() { return ( this._supportsMediaSource() && typeof(Hls) === 'function' && typeof(Hls.DefaultConfig) === 'object' && (typeof(Hls.DefaultConfig.llhls) === 'boolean' || typeof(Hls.DefaultConfig.lowLatencyMode) === 'boolean')
 ); }; VideoPlayer.prototype._supportsMediaSource = function () { if (!win.MediaSource) { return false; } if (!win.MediaSource.isTypeSupported) { return false; } return true; }; VideoPlayer.prototype._isMobileTouchDevice = function() { if ( this.BROWSER.TOUCH_ENABLED && (this.BROWSER.IS_ANY_SAFARI || this.BROWSER.IS_IOS || this.BROWSER.IS_ANDROID) ) { return true; } return false; }; VideoPlayer.prototype._settings = function(options) { options = options || {}; var key = '_vpsettings'; var settings; try { settings = localStorage.getItem(key); } catch (err) {} if ( typeof(settings) === 'string' && settings.charAt(0) === '{' ) { try { settings = JSON.parse(settings); } catch (err) {} if ( settings['v'] !== VideoPlayer.prototype.SETTINGS_VER ) { settings = null; } } if ( typeof(settings) !== 'object' || settings == null ) { settings = { 'v': VideoPlayer.prototype.SETTINGS_VER }; } if ( typeof(options.set) === 'object' ) { Object.keys(optiions.set[key]; }); try { localStorage.setItem(key, JSON.stringify(settings)); } catch (err) {} } return settings; }; VideoPlayer.prototype._onPlaying = function(e) { this.retryPlayCount = 0;
 this.restartCount = 0; var sourceName = this.getCurrentSourceName(); this.player.addClass('allow-big-play-button'); if ( ! this.playing ) { this.playing = true; if ( sourceName ) { VideoPlayer.prototype.HASPLAYED[sourceName] = true; this.log("successfully playing the " + sourceName + " url"); } } if ( this._isNativePlayer() && (sourceName === 'hls' || sourceName === 'llhls' || sourceName === 'llnative') ) { var _qualities = []; _qualities.push({ id: -1, group:'qualities', label: 'Auto', selected: true, clickable: true }); if ( this.player && this.player.trigger ) { this.player.trigger('_drawMenu', { fromTech: sourceName, videoQualities: _qualities, videoQualityCallback: function(id) { return false; } }); } } this._clearRetryPlayTimer(); this.determineAspectRatio(); if(typeof(this._onPlayingCallback ) == 'function' ) this._onPlayingCallback.apply(this, arguments ); }; VideoPlayer.prototype._onPlay = function(e) { if(typeof(this._onPlayCallback ) == 'function' ) { this._onPlayCallback.apply(this, arguments ); } };
 VideoPlayer.prototype._onError = function(e,f) { if ( ! this._isNativePlayer() ) { return; } var sourceName = this.getCurrentSourceName(); if ( sourceName !== 'hls' && sourceName !== 'llnative' ) { return; } this.retryPlayCount++; var error = this.player.error(); this.player.error(null); var notSupported = !!( typeof(error) === 'object' && error != null && typeof(error.code) === 'number' && typeof(error.MEDIA_ERR_SRC_NOT_SUPPORTED) === 'number' && error.code === error.MEDIA_ERR_SRC_NOT_SUPPORTED ); var hasPlayed = !!( typeof(VideoPlayer.prototype.HASPLAYED[sourceName]) === 'boolean' && VideoPlayer.prototype.HASPLAYED[sourceName] === true ); var timerLen = 1000; if ( hasPlayed || ((sourceName === 'hls' || sourceName === 'llnative') && this.BROWSER.IS_ANY_SAFARI) || this.retryPlayCount < 20 ) { this.player.addClass('vjs-waiting'); this.log("onError: retry play count is " + this.retryPlayCount + ", trying again in " + timerLen + "ms"); this._clearRetryPlayTimer(); this.retryPlayTimer = setTimeout(this.play.bind(this), timerLen); return; } if ( notSupported ) { this.log("onError: retry play count is " + this.retryPlayCount + " and video error is MEDIA_ERR_SRC_NOT_SUPPORTED, halting"); if ( typeof(this.unsupportedFn) === 'function' ) { this.unsupportedFn(); }
 return; } }; VideoPlayer.prototype._onStalled = function(e) { if ( this.playing || ! this._isNativePlayer() ) { return; } var sourceName = this.getCurrentSourceName(); if ( sourceName !== 'hls' ) { return; } var timerLen = 750; this.log("native loading stalled, retrying in " + timerLen + "ms...."); this._clearRetryPlayTimer(); this.retryPlayTimer = setTimeout(this.play.bind(this), timerLen); }; VideoPlayer.prototype._onDblClick = function(fromGlobal, e) { if ( fromGlobal && this.player.controls() ) { return; } var activeEl = e.relatedTarget || e.toElement || dom.activeElement; var playerEl = this.player.el(); if ( this.player.paused() ) { if ( this.player.isFullscreen() ) { try { this.player.exitFullscreen(); } catch (err) {} } } else { if ( activeEl == playerEl || activeEl == playerEl.querySelector('.vjs-tech') ) { if ( this.player.isFullscreen() ) { try { this.player.exitFullscreen(); } catch (err) {} } else if ( this.allowFullscreen ) { this.player.requestFullscreen();
 } } } return false; }; VideoPlayer.prototype._clearRetryPlayTimer = function() { if ( typeof(this.retryPlayTimer) === 'number' && this.retryPlayTimer > 0 ) { clearTimeout(this.retryPlayTimer); this.retryPlayTimer = 0; } }; VideoPlayer.prototype.toggleFullscreenIcon = function(onOrOff) { if ( ! this.player ) { return; } if ( this.player.controlBar && this.player.controlBar.FullscreenToggle && this.player.controlBar.FullscreenToggle.controlText ) { this.player.controlBar.FullscreenToggle.controlText(onOrOff ? 'Non-Fullscreen' : 'Fullscreen'); } }; VideoPlayer.prototype.changeId = function(newId) { if ( ! this.player || ! this.player.id_ ) { return; } var currentId = this.player.id_; this.setVideoId(newId); this.player.id_ = newId; if ( this.player.el_ ) { this.player.el_.id = this.player.id_; } videojs.players[newId] = videojs.players[currentId]; delete videojs.players[currentId]; }; VideoPlayer.prototype.getCurrentSource = function() { var result = { 'type': '(no type)', 'src': '(no source)', 'isNative': false, 'overrides': '' };
 if ( this.player && this.player.tech_ ) { var type = this.getCurrentSourceName(); if ( type ) { result['type'] = type; } if ( this.player.tech_.currentSource_ && this.player.tech_.currentSource_.src ) { result['src'] = this.player.tech_.currentSource_.src; if ( result['type'] === 'webrtc' ) { result['src'] = JSON.parse(decodeURIComponent(result['src'])); result['src'] = result['src']['wsUrl']; } } else if ( this._isNativePlayer() && typeof(this.player.tech_.currentSrc) === 'function' && this.player.tech_.currentSrc() ) { result['src'] = this.player.tech_.currentSrc(); result['isNative'] = true; } if ( this.techOverrideUsed && this.techOverrideUsed[result['type']] && this.techOverrideUsed[result['type']].length ) { result['overrides'] = this.techOverrideUsed[result['type']].join(', '); } } return result; }; VideoPlayer.prototype.getCurrentSourceName = function() { var sourceName = ''; if ( this.player ) { var currentSource = this.player.currentSource(); sourceName = this._sourceTypeToName(currentSource.type); } return sourceName; }; VideoPlayer.prototype.volumeByModel = function(vol) { if ( vol == undefined ) { if ( typeof(this._volumeCache[ this.modelId ]) !== 'undefined' ) { return this._volumeCache[ this.modelId ]; } return void 0; } if ( vol == this.defaultVolume ) { delete this._volumeCache[ this.modelId ]; return void 0; }
 if ( this.placardShowing ) { return void 0; } this.log("saving vol level " + vol + " to cache for modelId " + this.modelId); this._volumeCache[ this.modelId ] = vol; return vol; }; VideoPlayer.prototype.updateCurrentPlacard = function(options) { options = options || {}; if ( ! this.player ) { return false; } var placard = this.modelStateToStatus(); if ( ['public', 'not_supported'].indexOf(placard) > -1 ) { return false; } this.player.trigger('_setPlacardUrl', {state: placard, url: options.url}); if ( this.placardShowing ) { this.player.trigger('_setPlacard', {state: placard}); } return true; }; VideoPlayer.prototype._playUntilEmpty = function(e) { if ( this.playing ) { this.playing = false; } if ( ! this.player ) { return; } if ( this.delayedPlayerState ) { this._processDelayedPlayerState(); return; } if ( e && e.type === 'ended' ) { this.play();
 } }; VideoPlayer.prototype._drawMenuEvent = function(evt, options) { return this._drawMenu(options); }; VideoPlayer.prototype._drawMenu = function(options) { options = options || {}; var selectedTech; var videoQualities = []; var videoQualityCallback; selectedTech = options.fromTech; var numOfQualitiesPassed = 0; if ( options.videoQualities ) { videoQualities = options.videoQualities; numOfQualitiesPassed = videoQualities.length; } videoQualityCallback = options.videoQualityCallback; if ( ! selectedTech ) { selectedTech = this.techOrder[0]; } v return 'N/A'; }; var techs = [ { name: 'webrtc', group: 'playtypes', enabled: (this.allowedTechs.indexOf('webrtc') > -1 && (this.supportedTechs['webrtc'] || this.supportedTechs['transcodedWebrtc'])), label: techToLabel('webrtc') }, { name: 'llnative', group: 'playtypes', enabled: (this.allowedTechs.indexOf('llnative') > -1 && this.supportedTechs['llnative']), label: techToLabel('llnative') }, { name: 'llhls',
 group: 'playtypes', enabled: ( this._enableLLHls() && this.allowedTechs.indexOf('llhls') > -1 && this.supportedTechs['llhls']), label: techToLabel('llhls') }, { name: 'hls', group: 'playtypes', enabled: (this.allowedTechs.indexOf('hls') > -1 && this.supportedTechs['hls']), label: techToLabel('hls') } ]; var enabledTechs = 0; techs.forEach(function(tech) { if ( tech.enabled ) { videoQualities.unshift({ id: tech.name, group:tech.group, label: tech.label, selected: ( selectedTech == tech.name ) ? true : false, clickable: tech.enabled ? true : false }); } }); if ( ! this.c2c ) { var broadcastType; if ( this._isBroadcasterOnSidekick() ) { broadcastType = 'Sidekick'; } else if ( this._isBroadcasterOnWebRTC() ) { broadcastType = 'WebRTC'; } else if ( this._isBroadcasterOnOBSExt() ) { broadcastType = 'OBS Ext'; } else if ( this._isBroadcasterOnOBS() ) { broadcastType = 'OBS'; } videoQualities.unshift({ id: 'broadcasttype', group: 'blurb', label: '<div class="you"><b>Stream Type:</b><i>Stream Quality:</i></div>', selected: false, clickable: false }); var modelState = this.modelStateToStatus(); videoQualities.push({ id: 'empty',
 group: 'empty', label: this.placardShowing ? 'No streams available' : 'Loading {label}&hellip;', selected: false, clickable: false, extraClasses: this.placardShowing ? ['vp-empty'] : ['vp-empty','vp-loading'] }); var broadcastLabel = ''; if ( modelState == 'away' || modelState == 'offline' ) { broadcastLabel = '<div class="streaming">Model is currently ' + modelState + '</div>'; } else if ( broadcastType ) { broadcastLabel = '<div class="streaming">Model broadcasting with ' + broadcastType + '</div>'; } if ( broadcastLabel ) { videoQualities.push({ id: 'broadcasttype', group: 'blurb', label: broadcastLabel, selected: false, clickable: false }); } } if ( this.player && this.player.trigger ) { this.player.trigger('tech_loadedqualitydata', { 'mouseLeaveTimeout': 2500, 'qualityData': { 'video': videoQualities }, 'qualitySwitchCallback': function(id) { this.player.trigger('_resetInactivityTimeout'); if ( id === 'webrtc' || id === 'hls' || id === 'llhls' || id === 'llnative' ) { this._settings({set: {'tech': id, 'selected': undefined}}); if ( this._shouldBePlaying ) { setTimeout(function(){ if ( this.player && this.player.trigger ) { this.player.trigger('_restart', { timerLen: 1, techOrder: [id] }); } }.bind(this), 0); } return true; } else if ( String(id).match(/^-?\d+$/) && typeof(videoQualityCallback) === 'function' ) { return videoQualityCallback(id); } else { return false;
 } }.bind(this) }); } }; VideoPlayer.prototype._placardShowing = function(evt, showing) { var prevPlacardShowing = this.placardShowing; this.placardShowing = showing; if ( prevPlacardShowing != showing ) { if ( ! showing && typeof(this.onlyVolumeControls) === 'boolean' ) { this.setOnlyVolumeControls(this.onlyVolumeControls); } if ( showing ) { this._disposeClickToUnmute(); } } if ( showing ) { this._drawMenu(); } }; VideoPlayer.prototype.setOnlyVolumeControls = function(bool) { this.onlyVolumeControls = !!bool; if ( ! this.player || ! this.allowControls ) { return; } if ( this.onlyVolumeControls ) { if ( typeof(this._origInactivityTimeout) !== 'number' ) { this._origInactivityTimeout = this.inactivityTimeout; } this.inactivityTimeout = 0; this._resetInactivityTimeout(); this.player._our_disableTechTap_ = true; this.player.addClass('vjs-volume-controls-only'); this.player.userActive(false); this.player.userActive(true); } else { if ( typeof(this._origInactivityTimeout) === 'number' ) { this.inactivityTimeout = this._origInactivityTimeout; delete this._origInactivityTimeout; } this._resetInactivityTimeout(); delete this.player._our_disableTechTap_; this.player.userActive(false);
 this.player.removeClass('vjs-volume-controls-only'); } this.player.controls(this.allowControls); }; VideoPlayer.prototype._resetInactivityTimeout = function() { if ( this.player && this.player.options ) { this.player.options({"inactivityTimeout": this.inactivityTimeout}); } }; VideoPlayer.prototype._patchVideoJS = function() { try { videojs.getComponent("PosterImage").prototype.handleClick = function(){}; } catch (e) { console.warn("WARNING: unable to disable PosterImage.handleClick()"); } try { videojs.getComponent("Player").prototype.handleTechClick_ = function(){}; } catch (e) { console.warn("WARNING: unable to disable Player.handleTechClick_()"); } try { if ( typeof(videojs.getComponent("Player").prototype._ORIG_handleTechTap_) !== 'function' ) { videojs.getComponent("Player").prototype._ORIG_handleTechTap_ = videojs.getComponent("Player").prototype.handleTechTap_; videojs.getComponent("Player").prototype.eTechTap_(); } }; } } catch (e) { console.warn("WARNING: unable to disable Player.handleTechTap_()"); } try { if ( typeof(videojs.getComponent("Player").prototype._ORIG_dispose) !== 'function' ) { videojs.getComponent("Player").prototype._ORIG_dispose = videojs.getComponent("Player").prototype.dispose; videojs.getComponent("Player").proRIG_dispose(); } } } catch (e) { console.warn("WARNING: unable to modify Player.dispose()"); } try { if ( typeof(videojs.getComponent("Player").prototype._ORIG_requestFullscreen) !== 'function' ) { videojs.getComponent("Player").prototype._ORIG_requestFullscreen = videojs.getComponent("Player").prototype.requestFullscreen; } } catch (e) { console.warn("WARNING: unable to modify Player.requestFullscreen()"); } try { if ( typeof(videojs.getComponent("Player").prototype._ORIG_listenForUserActivity_) !== 'function' ) {
 videojs.getComponent("Player").prototype._ORIG_listenForUserActivity_ = videojs.getComponent("Player").prototype.listenForUserActivity_; videojs.getComponent("Player").prototype.listenFoActivity_(); } } } } catch (e) { console.warn("WARNING: unable to modify Player.listenForUserActivity_()"); } try { if ( typeof(videojs.getComponent("Player").prototype._ORIG_selectSource) !== 'function' ) { videojs.getComponent("Player").prototype._ORIG_selectSource = videojs.getComponent("Player").prototype.selectSource; } } catch (e) { console.warn("WARNING: unable to modify Player.selectSource()"); } try { videojs.getComponent("Player").prototype.resetVolumeBar_ = function(){}; } catch (e) { console.warn("WARNING: unable to disable Player.resetVolumeBar_()"); } try { if ( typeof(videojs.getComponent("Player").prototype._ORIG_src_) !== 'function' ) { videojs.getComponent("Player").prototype._ORIG_src_ = videojs.getComponent("Player").prototype.src; } } catch (e) { console.warn("WARNING: unable to patch Player.src()"); } try { if ( typeof(videojs.getComponent("Player").prototype._ORIG_doReset_) !== 'function' ) { videojs.getComponent("Player").prototype._ORIG_doReset_ = videojs.getComponent("Player").prototype.doReset_; videojs.getComponent("Player").prototype.doReset_ = function() { this._INITIATING_RESET = true; var r = this._ORIG_doReset_(); this._INITIATING_RESET = false; return r; }; } } catch (e) { console.warn("WARNING: unable to patch Player.doReset_()"); } try { videojs.getComponent("Player").prototype.poster = function(src){ if (src === undefined) { return this.poster_; } if (!src) { if (this._INITIATING_RESET) { return; } src = '';
 } if (src === this.poster_) { return; } this.poster_ = src; this.trigger('posterchange'); }; } catch (e) { console.warn("WARNING: unable to patch Player.poster()"); } }; VideoPlayer.prototype._fixFrozenVideo = function(e) { var sourceName = this.getCurrentSourceName(); if ( ! dom.hidden && this.player && sourceName === 'webrtc' || sourceName === 'llnative' ) { var videoEl = this._getVideoEl(); if ( videoEl && videoEl.srcObject ) { var frame = 0; var step = function() { try { if ( ! videoEl ) { return; } frame++; if ( frame === 1 ) { videoEl.style.display = 'inline-table'; } else if ( frame === 2 ) { var height = videoEl.offsetHeight; } else if ( frame > 2 ) { videoEl.style.display = ''; return; } return win.requestAnimationFrame(step); } catch (err) { console.error("error in _fixFrozenVideo", err); } }; win.requestAnimationFrame(step); } } }; VideoPlayer.prototype._iosOnPaused = function() { if (Date.now() - this.exitFullscreenTime < 1000) { this.exitFullscreenTime = 0; this._play(); }
 }; VideoPlayer.prototype._onFullscreenChange = function() { if (this.player && !this.player.isFullscreen()) { this.exitFullscreenTime = Date.now(); if (this.player.paused()) { setTimeout(this._play.bind(this), 0); } } }; VideoPlayer.prototype._llNativeScrubFix = function(event) { var sourceName = this.getCurrentSourceName(); if ( sourceName !== 'llnative' || ! this.player ) { return; } var el = this._getVideoEl(); if ( ! el || dom.hidden ) { return; } var reloadSrc = false; if ( event.type === 'seeked' ) { if ( this.player.isFullscreen() ) { reloadSrc = true; } } else if ( ! dom.hidden ) { if ( el.duration - el.currentTime >= 4 ) { reloadSrc = true; } } if ( reloadSrc && el.src ) { el.src = el.src; } }; VideoPlayer.prototype.setVideoPreview = function() { if ( this.livesnapBg && (this.livesnapBgEl || (this.player && this.player.el_)) ) { var el = this.livesnapBgEl ? this.livesnapBgEl : this.player.el_; var url; if ( this._isPublicFeed() ) { url = "url('" + this.livesnapUrl({size: 640, cache: 5000}) + "')"; } else {
 url = ""; } if ( this._lastVideoPreviewUrl !== url ) { el.style.backgroundImage = url; } this._lastVideoPreviewUrl = url; } }; VideoPlayer.prototype.render = function(options) { options = Object.assign({ 'append': true }, options || {}); if ( this.livesnapBgEl ) { this.setVideoPreview(); } this.destroy(); var videoEl = dom.createElement('video'); if ( this.videoId ) videoEl.id = this.videoId; this._currentAspectRatio = this.aspectRatio || '16:9'; var aspectRatioClass = ( this._currentAspectRatio == '16:9' ? 'vjs-16-9' : 'vjs-4-3' ); videoEl.className = 'video-js vjs-default-skin ' + aspectRatioClass + ' vjs-fluid vjs-big-play-centered'; videoEl.className += ' vjs-p' + this.platformId; if ( this.allowControls ) { videoEl.className += ' vjs-allow-controls'; } if ( ! options['append'] ) { while (this.containerEl.hasChildNodes()) this.containerEl.removeChild(this.containerEl.lastChild); } if ( this.containerEl.className.indexOf('videoplayerjs') === -1 ) { this.containerEl.className += ' videoplayerjs'; if ( this.livesnapBg && ! this.livesnapBgEl && this.containerEl.className.indexOf('vjslivesnapbg') === -1 ) { this.containerEl.className += ' vjslivesnapbg'; } } this.containerEl.appendChild(videoEl );
 var debugEl = dom.createElement('div'); debugEl.className = 'videoplayerjs-debug'; this.debugEl = debugEl; this.containerEl.appendChild(debugEl ); this._patchVideoJS(); var controlBarChildren = [ 'VolumePanel' ]; if ( this.allowFullscreen ) { controlBarChildren.push('FullscreenToggle'); } var plugins = { "placards": { imgs: this.getPlacards(), isPlaying: function() { return !!this.playing; }.bind(this), setPlaying: function(bool) { this.playing = bool; }.bind(this), useLivesnapUrl: this.useBlurredLivesnaps, livesnapRefresh: this.livesnapRefreshTiapUrl(options) }.bind(thissPublicFeed(); }.bind(this) }, "airPlay": { addButtonToControlBar: true, } }; var videojsComponent = videojs.getComponent('Component'); var backgroundComponent = videojs.extend(videojsComponent, { constructor: function(player, options) { videojsComponent.call(this, player, options); this.el_ = this.createEl('div', { className: 'vjs-background', tabIndex: -1 }); } }); videojs.registerComponent('background', backgroundComponent); var dynamicPlacardChild = videojs.extend(videojsComponent, { constructor: function(player, options) { videojsComponent.call(this, player, options); this.num_ = options.numnload(this.num_); this.el_ = this.createEl('img', { className: 'vjs-poster-child vjs-poster-img' + this.num_,
 tabIndex: -1 }); this.el_.addEventListener('load', this.onload_); }, dispose: function() { this.el_.removeEventListener('load', this.onload_); videojsComponent.prototype.dispose.call(this); }, loadSrc: function(src) { this.el_.src = src; } }); videojs.registerComponent('dynamicPlacardChild', dynamicPlacardChild); var dynamicPlacard = videojs.extend(videojsComponent, { constructor: function(player, options) { videojsComponent.call(this, player, options); this.el_ = this.createEl('div', { className: 'vjs-poster', tabIndex: -1 }); this._displayingNum = 0; this.childComp1_ = this.addChild('dynamicPlacardChild', {num: 1, onload: (n) => this.imageLoaded(n) }); this.childComp2_ = this.addChild('dynamicPlacardChild', s.imageLoaded(n) }); this.inactive(); this=> this.update(); player.on('posterchange', this.posterChangse.call(this); }, update: function(event) { var url = this.player().poster(); if (!url) { return this.inactive(); } this._isActive = true; if (this._displayingNum !== 1) { this.childComp1_.loadSrc(url); } else { this.childComp2_.loadSrc(url); } }, displayNum: function(num) { this._displayingNum = num; if (num === 1) { this.removeClass('vjs-display-poster-img2');
 } else { this.addClass('vjs-display-poster-img2'); } this.show(); this.player().trigger('placardLoaded'); }, inactive: function() { this.hide(); this._isActive = false; this.childComp1_.loadSrc(''); this.childComp2_.loadSrc('');layNum(num); } } }); videojs.registerComponent('dynamicPlacard', dynamicPlacard); this.player = videojs(videoEl, { "autoplay": true, "controls": (this.allowControls ? true : false), "playsinline": true, "nativeControlsForTouch": false, "inactivityTimeout": this.inactivityTimeout, "bigPlayButton": true, "loadingSpinner": true, "textTrackSettings": false, "aspectRatio": this._currentAspectRatio, "techOrder": ['html5'], "resizeManager": false, "liveTracker": false, "children": ['mediaLoader', 'dynamicPlacard', 'background', 'bigPlayButton', 'controlBar', 'errorDisplay', 'resizeManager'], "Html5": { "mfc": { "debugEl": this.debugEl, "settings": this._settings() }, "hlsjsConfig": { "lowLatencyMode" : false, "capLevelToPlayerSize" : this.capLevelToPlayerSize, "abrBandWidthUpFactor" : 0.95, "abrEwmaDefaultEstimate" : 7e6, "testBandwidth" : false, "debug" : false, "backBufferLength" : 15, "maxMaxBufferLength" : 15, "maxBufferHole" : 2,
 "liveSyncDuration" : 4, "liveMaxLatencyDuration" : 9, "playlistLoadPolicy": { "default": { "maxTimeToFirstByteMs": 10000, "maxLoadTimeMs": 60000, "timeoutRetry": { "maxNumRetry": 60, "retryDelayMs": 750, "maxRetryDelayMs": 1500 }, "errorRetry": { "maxNumRetry": 60, "retryDelayMs": 750, "maxRetryDelayMs": 1500 } } }, "fragLoadPolicy": { "default": { "maxTimeToFirstByteMs": 30000, "maxLoadTimeMs": 120000, "timeoutRetry": { "maxNumRetry": Infinity, "retryDelayMs": 500, "maxRetryDelayMs": 1500 }, "errorRetry": { "maxNumRetry": Infinity, "retryDelayMs": 500, "maxRetryDelayMs": 1500 } } } }, "llhlsjsConfig": { "lowLatencyMode" : true, "capLevelToPlayerSize" : this.capLevelToPlayerSize, "abrBandWidthUpFactor" : 0.95, "abrEwmaDefaultEstimate" : 7e6, "testBandwidth" : false, "debug" : false, "manifestLoadingTimeOut" : 30000, "manifestLoadingMaxRetry" : 60, "backBufferLength" : 10, "maxMaxBufferLength" : 10, "maxBufferHole" : 2, "liveSyncDuration" : 2, "liveMaxLatencyDuration" : 7.5, "maxLiveSyncPlaybackRate" : VideoPlayer.prototype.BROWSER.IS_ANY_SAFARI ? 1 : 1.15
 } }, "controlBar": { "children": controlBarChildren }, "userActions": { "doubleClick": this._onDblClick.bind(this, false), "hotkeys": false }, "plugins": plugins }); if ( ! this.livesnapBgEl ) { this.setVideoPreview(); } this.player.requestFullscreen = () => { if ( typeof(this.toggleFullscreenHandler) === 'function' ) { this.toggleFullscreenHandler(); return; } this.player._ORIG_requestFullscreen(); }; this.player.selectSource = (sources) => { var result = this.player._ORIG_selectSource(sources); if ( ! result ) { var type = this._sourceTypeToName(sources[0].type); VideoPlayer.prototype.FAILEDTECH[type] = true; this._determineSupportedTech(); } return result; }; this.player.src = (source) => { if (Array.isArray(source)) { source.forEach((sourceObj) => { for (var prop in sourceObj) { if (sourceObj.hasOwnProperty(prop) && typeof(sourceObj[prop]) === 'string') { sourceObj[prop] = sourceObj[prop].replace(/([&\?]..=)(\d+\.\d+)/, (match, param, quality) => { return param + this._newQuality(quality); }); } } }); } return this.player._ORIG_src_(source); }; this.player.userActive(false);
 this.player.qualityPickerPlugin(); this.player.ready(this.onReady.bind(this)); this.player.on('_log', function(event,msg) {this.log(msg);}.bind(this)); this.player.on('volumechange', this._onVolumeChange.bind(this)); this.player.on('playing', this._onPlaying.bind(this)); this.player.on('dblclick', this._onDblClick.bind(this, true)); this.player.on('error', this._onError.bind(this)); this.player.on('stalled', this._onStalled.bind(this)); this.player.on('enterpictureinpicture', this._onEnterPictureInPicture.bind(this)); this.player.on('leavepictureinpicture', this._onLeavePictureInPicture.bind(this)); if ( this.BROWSER.IS_IOS ) { this.player.on('fullscreenchange', this._onFullscreenChange.bind(this)); this.player.on('pause', this._iosOnPaused.bind(this)); } this.player.on('seeked', this._onSeeked.bind(this)); this.player.on(['stalled', 'waiting', 'emptied', 'ended'], this._playUntilEmpty.bind(this)); this.player.on('_reportBack', this._reportBack.bind(this)); this.player.on('_restart', this._restart.bind(this)); this.player.on('_drawMenu', this._drawMenuEvent.bind(this)); this.playerettings(data); }.bind(this)); this.player.on('_placardShowing', this._placardShowing.bind(this)); this.player.on('_resetInactivityTimeout', this._resetInactivityTimeout.bind(this)); if ( this.BROWSER.IS_ANY_SAFARI ) { if ( this._fixFrozenVideoListener ) { dom.removeEventListener("visibilitychange", this._fixFrozenVideoListener); }
 this._fixFrozenVideoListener = this._fixFrozenVideo.bind(this); dom.addEventListener("visibilitychange", this._fixFrozenVideoListener, false); } if ( this.BROWSER.IS_IOS || this.BROWSER.IS_ANY_SAFARI ) { this.player.on(['seeked', 'durationchange'], this._llNativeScrubFix.bind(this)); this.player.on('_placardShowing', function(evt, showing) { if ( showing ) { delete this._llNativeCache; } }.bind(this)); } if ( ! this._determineSupportedTech() ) { return; } this._drawMenu(); }; (function() { VideoPlayer.prototype.BROWSER.USER_AGENT = win.navigator && win.navigator.userAgent || ''; var webkitVersionMap = (/AppleWebKit\/([\d.]+)/i).exec(VideoPlayer.prototype.BROWSER.USER_AGENT); var appleWebkitVersion = webkitVersionMap ? parseFloat(webkitVersionMap.pop()) : null; VideoPlayer.prototype.BROWSER.IS_IPAD = (/iPad/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT); VideoPlayer.prototype.BROWSER.IS_IPHONE = (/iPhone/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT) && !VideoPlayer.prototype.BROWSER.IS_IPAD; VideoPlayer.prototype.BROWSER.IS_IPOD = (/iPod/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT); VideoPlayer.prototype.BROWSER.IS_IOS = VideoPlayer.prototype.BROWSER.IS_IPHONE || VideoPlayer.prototype.BROWSER.IS_IPAD || VideoPlayer.prototype.BROWSER.IS_IPOD; VideoPlayer.prototype.BROWSER.IOS_VERSION = (function() { var match = VideoPlayer.prototype.BROWSER.USER_AGENT.match(/OS (\d+)_/i); if (match && match[1]) { return match[1]; } return null; }.bind(this)()); VideoPlayer.prototype.BROWSER.IS_ANDROID = (/Android/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT); VideoPlayer.prototype.BROWSER.ANDROID_VERSION = (function() { var match = VideoPlayer.prototype.BROWSER.USER_AGENT.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i); if (!match) { return null;
 } var major = match[1] && parseFloat(match[1]); var minor = match[2] && parseFloat(match[2]); if (major && minor) { return parseFloat(match[1] + '.' + match[2]); } else if (major) { return major; } return null; }.bind(this)()); VideoPlayer.prototype.BROWSER.IS_NATIVE_ANDROID = VideoPlayer.prototype.BROWSER.IS_ANDROID && VideoPlayer.prototype.BROWSER.ANDROID_VERSION < 5 && appleWebkitVersion < 537; VideoPlayer.prototype.BROWSER.IS_FIREFOX = (/Firefox/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT); VideoPlayer.prototype.BROWSER.IS_EDGE = (/Edge/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT); VideoPlayer.prototype.BROWSER.IS_OPERA = (/OPR\//i).test(VideoPlayer.prototype.BROWSER.USER_AGENT);
 VideoPlayer.prototype.BROWSER.IS_CHROME = !VideoPlayer.prototype.BROWSER.IS_EDGE && ((/Chrome/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT) || (/CriOS/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT)); VideoPlayer.prototype.BROWSER.CHROME_VERSION = (function() { var match = VideoPlayer.prototype.BROWSER.USER_AGENT.match(/(Chrome|CriOS)\/(\d+)/); if (match && match[2]) { return parseFloat(match[2]); } return null; }.bind(this)()); VideoPlayer.prototype.BROWSER.IE_VERSION = (function() { var result = (/MSIE\s(\d+)\.\d/).exec(VideoPlayer.prototype.BROWSER.USER_AGENT); var version = result && parseFloat(result[1]); if (!version && (/Trident\/7.0/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT) && (/rv:11.0/).test(VideoPlayer.prototype.BROWSER.USER_AGENT)) { version = 11.0; } return version; }.bind(this)()); VideoPlayer.prototype.BROWSER.IS_MOBILE = (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT); VideoPlayer.prototype.BROWSER.IS_DESKTOP = !VideoPlayer.prototype.BROWSER.IS_MOBILE; VideoPlayer.prototype.BROWSER.IS_SAFARI = (/Safari/i).test(VideoPlayer.prototype.BROWSER.USER_AGENT) && !VideoPlayer.prototype.BROWSER.IS_CHROME && !VideoPlayer.prototype.BROWSER.IS_ANDROID && !VideoPlayer.prototype.BROWSER.IS_EDGE; VideoPlayer.prototype.BROWSER.IS_ANY_SAFARI = (VideoPlayer.prototype.BROWSER.IS_SAFARI || VideoPlayer.prototype.BROWSER.IS_IOS) && !VideoPlayer.prototype.BROWSER.IS_CHROME;
 VideoPlayer.prototype.BROWSER.TOUCH_ENABLED = (dom === win.document) && ('ontouchstart' in win || win.navigator.maxTouchPoints || win.DocumentTouch && win.document instanceof win.DocumentTouch); })(); VideoPlayer.overridesList = function() { var overridesByKey = {}; Object.keys(VideoPlayer.prototype.URLFORMAT).forEach(function(serverType) { Object.keys(VideoPlayer.prototype.URLFORMAT[serverType]).forEach(function(techType) { var tech = VideoPlayer.prototype.URLFORMAT[serverType][techType]; if ( typeof(tech.overrides) === 'object' ) { Object.keys(tech.overrides).forEach(function(overrideKey) { if ( overridesByKey[overrideKey] ) { overridesByKey[overrideKey].techs.push(techType); } else { overridesByKey[overrideKey] = { key: overrideKey, name: tech.overrides[overrideKey].name, techs: [techType] }; } }); } }); }); var overrides = []; Object.keys(overridesByKey[key]); }); return overrides; }; return VideoPlayer; })(document, videojs, window);  (function(videojs){ var Plugin = videojs.getPlugin('plugin'); var placardsPlugin = videojs.extend(Plugin, { constructor: function(player, options) { Plugin.call(this, player, options); this.pluginOptions = options; this.loadingTimer = 0;
 this.reloadImageTimer = 0; this.clearPlacardCache(); this.on(this.player, 'loadstart', this.showLoading); this.on(this.player, 'waiting', this.showLoading); this.on(this.player, 'loadedmetadata', this.loadedmetadata); this.on(this.player, '_setPlacard', this.setPlacardEvent); this.on(this.player, '_setPlacardUrl', this.setPlacardUrlEvent); this.on(this.player, 'playing', this.playingEvent); this.on(this.player, 'canplay', this.playingEvent); this.showLoading(); }, loadedmetadata: function() { this.removePlacard(); }, dispose: function() { this._clearReloadImageTimer(); this._clearLoadingTimer(); }, cl'', url: '' }; }, removePlacard: function() { this._clearReloadImageTimer(); if ( this.player ) { this.player.poster(''); this.player.removeClass('vjs-poster-showing'); this.player.trigger('_placardShowing', false); } }, _clearLoadingTimer: function() { if ( this.loadingTimer > 0 ) { clearTimeout(this.loadingTimer); this.loadingTimer = 0; } }, _clearReloadImageTimer: function() { if ( this.reloadImageTimer > 0 ) {
 clearTimeout(this.reloadImageTimer); this.reloadImageTimer = 0; } movePlacard(); }, showLoading: function() { if ( typeof(this.pluginOptions.isPlaying) === 'function' && this.pluginOptions.isPlaying() ) { this._clearLoadingTimer(); this.loadingTimer = setTimeout(this.show.bind(this, 'loading'), 3000); this.removePlacard(); return; } return this.show('loading'); }, s.show(state); }, setPlacardUrlEvent: function(event, options) { if (typeof(options.url) === 'string' && options.url) { this.placardCache.state = options.state; this.placardCache.url = options.url; } else { this.clearPlacardCache(); } }, show: function(options) { if (typeof(options) === 'string') { options = {state: options}; } this._clearReloadImageTimer(); this._clearLoadingTimer(); if ( ! this.player ) { return; } var useLiveSnapUrl = this.pluginOptions.useLivesnapUrl && this.pluginOptions.isPublicFeed();
 var state = options.state; var image = this.pluginOptions.imgs[state]; if (this.placardCache.state === state && this.placardCache.url) { image = this.placardCache.url; } else if ( useLiveSnapUrl ) { image = this.pluginOptions.livesnapUrl({size: 640}); } if ( state === 'loading' ) { this.player.addClass('vjs-has-started'); this.player.listenForUserActivity_(); return this.player.poster(image); } if ( useLiveSnapUrl && [ 'private', 'group', 'club' ].indexOf(state) > -1 ) { this.reloadImageTishow(options); }.bind(this), this.pluginOptions.livesnapRefresh); } if ( state === 'error' ) { state = 'loading'; } if ( state !== 'loading' && typeof(this.pluginOptions.setPlaying) === 'function' ) { this.pluginOptions.setPlaying(false); } if ( this.pluginOptions.imgs[state] ) { if ( state !== 'restart' ) { this.player.trigger('_placardShowing', true); } this.player.pause(); this.player.trigger('_resetInactivityTimeout'); this.player.reset(); this.player.poster(image); this.player.currentTime(0); this.player.removeClass('vjs-automuted'); this.player.removeClass('vjs-playing'); this.player.removeClass('vjs-seeking'); this.player.removeClass('vjs-paused'); this.player.removeClass('vjs-waiting'); this.player.addClass('vjs-has-started'); this.player.addClass('vjs-poster-showing'); this.player.listenForUserActivity_(); } }
 }); videojs.registerPlugin('placards', placardsPlugin); })(videojs);  (function(videojs, Hls, window) { if ( ! Hls ) { return; } var preferHlsJs = !!(VideoPlayer.prototype.BROWSER.IS_ANDROID && VideoPlayer.prototype.BROWSER.ANDROID_VERSION < 6); function Html5HlsJS(source, tech) { tech.name_ = 'Hls'; var options = tech.options_; var el = tech.el(); var _levels = []; var _qualities = []; var _player = videojs(tech.options_.playerId); var _loadLevel = null; var _forcedLevel = -1; var _retryCount = 0; var _llhls = ( source.type === VideoPlayer.prototype.getLLHlsType() ) ? true : false; var _isAutoLevelEnabled = true; var hlsOptions = _llhls ? options['llhlsjsConfig'] : options['hlsjsConfig']; var _settings = ( typeof(source.settings) !== 'undefined' ) ? source.settings : options['mfc']['settings']; var useSettings = !hlsOptions['capLevelToPlayerSize']; var _preferredBitrate = 0; var _lastBw = 0; if ( useSettings ) { _preferredBitrate = parseInt(_settings['selected'], 10); _lastBw = parseInt(_settings['bw'], 10); } if ( _lastBw > 0 ) {
 hlsOptions['abrEwmaDefaultEstimate'] = _lastBw; hlsOptions['abrEwmaMinTotalBytesMultiplier'] = 1; } var hls = this.hls = new Hls(hlsOptions); var debugEl = options['mfc']['debugEl']; var delayedPlayerState = false; _player.on('_delarState = bool; }); var saveSettings = function(data) { if ( useSettings && _player && _player.trigger ) { _player.trigger('_settings', {set: data}); } }; var updateURLParameter = function(url, param, paramVal) { var newAdditionalURL = ""; var tempArray = url.split("?"); var baseURL = tempArray[0]; var additionalURL = tempArray[1]; var temp = ""; if (additionalURL) { tempArray = additionalURL.split("&"); for (var i=0; i<tempArray.length; i++) { if(tempArray[i].split('=')[0] != param) { newAdditionalURL += temp + tempArray[i]; temp = "&"; } } } var rows_txt = temp + "" + param + "=" + paramVal; return baseURL + "?" + newAdditionalURL + rows_txt; }; var updateLevelInfo = function(forced) { if (_loadLevel === hls.loadLevel && !forced) { return; } _isAutoLevelEnabled = hls.autoLevelEnabled; _loadLevel = hls.loadLevel; _qualities = []; var autoSpeed = ''; for (var i = _levels.length - 1; i >= 0; i--) {
 var t = _levels[i]; var selected; if ( _forcedLevel > -1 ) { selected = (i === _forcedLevel); } else { selected = (i === _loadLevel); } var label = ''; if ( t.hasOwnProperty('name') && typeof(t['name']) === 'string' && t['name'].length > 0 ) { label += t['name']; if ( label.match(/^\s*(\d+p?) (\S+) (\d+)\.?\d*fps\s*$/i) ) { label = RegExp.$1 + RegExp.$3 + ' ' + RegExp.$2; } } else { if ( t.hasOwnProperty('height') && t['height'] > 0 ) { label += t['height'] + 'p '; } label += (t['bitrate'] / 1000).toFixed(0) + "kbps"; } _qualities.push({ id: i + 1, group: 'qualities', label: label, selected: ( _isAutoLevelEnabled ? false : selected ), clickable: true, isplaying: ( _isAutoLevelEnabled ? selected : false ) }); if ( _isAutoLevelEnabled && selected ) { autoSpeed = label.split(' ')[0]; } } if ( _qualities.length > 1 ) { _qualities.unshift({ id: -1, group:'qualities', label: 'Auto', selected: _isAutoLevelEnabled, clickable: true }); } else if ( _qualities.length === 1 ) {
 _qualities[0].selected = true; } if ( _player && _player.trigger ) { _player.trigger('_drawMenu', { fromTech: ( _llhls ) ? 'llhls' : 'hls', videoQualities: _qualities, videoQualityCallback: function(id) { var level = null; if ( id === -1 ) { level = id; _preferredBitrate = 0; } else if ( id > 0 ) { id -= 1; if ( _levels[id] ) { level = id; if ( id === 0 ) { _preferredBitrate = 1; } else if ( id === (_levels.length - 1) ) { _preferredBitrate = 2; } else { _preferredBitrate = _levels[id]['bitrate']; } } } saveSettings({'selected': _preferredBitrate}); if ( level !== null && level !== -2 ) { _forcedLevel = level; hls.nextLevel = level; updateLevelInfo(true); } } }); } };  function errorHandlerFactory() { var _recoverDecodingErrorDate = null; var _recoverAudioCodecErrorDate = null; return function() { var now = Date.now(); if (!_recoverDecodingErrorDate || (now - _recoverDecodingErrorDate) > 2000) { _recoverDecodingErrorDate = now;
 if (isOldHlsFn()) { hls.recoverMediaError(); } else { hls.stopLoad(); hls.startLoad(); } } else if (!_recoverAudioCodecErrorDate || (now - _recoverAudioCodecErrorDate) > 2000) { _recoverAudioCodecErrorDate = now; hls.swapAudioCodec(); hls.recoverMediaError(); } else { console.error('Error loading media: File could not be played'); } }; } var hlsjsErrorHandler = errorHandlerFactory(); var videoTagErrorHandler = errorHandlerFactory(); el.addEventListener('error', function(e) { var mediaError = e.currentTarget.error; if (mediaError.code === mediaError.MEDIA_ERR_DECODE) { videoTagErrorHandler(); } else { console.error('Error loading media: File could not be played'); } });  this.dispose = function() { this._clearRetryPlayTimer(); this._clearDebugTimer(); this.updateDebugDisplay(false); hls.destroy(); }; this.isDebugEnabled = function() { try { return !!window.localStorage.getItem('_vpdebug'); } catch (err) { return false; } };
 this.updateDebugDisplay = function(onOrOff) { if ( debugEl ) { debugEl.style.display = onOrOff ? 'block' : 'none'; } }; this.updateDebug = function() { this._clearDebugTimer(); var timerLen = 200; if ( this.isDebugEnabled() && debugEl && this.hls ) { var pdt = ''; if ( this.hls.streamController && this.hls.streamController.fragCurrent ) { var fragCurrent = this.hls.streamController.fragCurrent; if ( typeof(fragCurrent.start) === 'number' && typeof(fragCurrent.programDateTime) === 'number' ) { var currentPdt = fragCurrent.programDateTime + (el.currentTime - fragCurrent.start) * 1000; var pdtLatency = (Date.now() - currentPdt) / 1000; pdt += 'PDT: ' + new Date(currentPdt).toISOString(); if (pdtLatency > 0) { pdt += '<br>PDT Latency: ' + pdtLatency.toFixed(2) + 's ago'; } } } var totalBufferAvail = 0; var buffLen = 0; var hasGaps = false; try { var bufferLen = el.buffered.length; hasGaps = !!(bufferLen > 1); totalBufferAvail = (bufferLen > 0) ? el.buffered.end(bufferLen - 1) - el.currentTime : 0; } catch (err) { } debugEl.innerHTML = '<small>VP v' + VideoPlayer.prototype.VERSION + ' &bullet; Hls.js v' + Hls.version + '</small><hr>' + ("Bandwidth Est: " + (this.hls.bandwidthEstimate/(1024*1024)).toFixed(2) + "mbps<br>") + ("Max Latency: " + this.hls.maxLatency.toFixed(2) + "<br>") + ("Target Latency: " + (Number.isFinite(this.hls.targetLatency) ? this.hls.targetLatency.toFixed(2) : "0") + "<br>") + ("Latency: " + this.hls.latency.toFixed(2) + "s<br>") + ("Drift: " + this.hls.latencyController.drift.toFixed(2) + "<br>") + ("Avail Buffer: " + totalBufferAvail.toFixed(2) + "s" + (hasGaps ? " [GAP]" : "") + "<br>") + ("Stall Count: " + this.hls.latencyController.stallCount + "<br>") + ("Edge Stall: " + this.hls.latencyController.edgeStalled.toFixed(2) + "<br>") + ("Playback rate: " + el.playbackRate.toFixed(2) + "<br>") + (pdt ? pdt + '<br>' : ''); this.updateDebugDisplay(true); } else { timerLen = 1000; this.updateDebugDisplay(false); } this.debugTimer = setTimeout(this.updateDebug.bind(this), timerLen); }; this._clearDebugTimer = function() { if ( this.debugTimer > 0 ) { clearTimeout(this.debugTimer); this.debugTimer = 0; } }; this._clearRetryPlayTimer = function() { if ( this.retryTimer > 0 ) {
 clearTimeout(this.retryTimer); this.retryTimer = 0; } };  this.duration = function() { return Infinity; }; if ( this.isDebugEnabled() ) { hls.on(Hls.Events.LEVEL_LOADED, function(event, data) { var last = {}; data.details.fragments.forEach((f) => { if ( last.programDateTime ) { var pdtDiff = Date.parse(f.rawProgramDateTime) - Date.parse(last.rawProgramDateTime); var durDiff = Math.abs(pdtDiff - (last.duration * 1000)); if ( pdtDiff < 0 || durDiff > 5 ) { console.log('PDT ERROR IN CHUNKLIST URL: ' + f.baseurl + '\n PREV SN: ' + last.sn + ' PDT: ' + last.rawProgramDateTime + ' DUR: ' + last.duration + '\n CUR SN: ' + f.sn + ' PDT: ' + f.rawProgramDateTime + '\n DIFF: ' + durDiff.toFixed(1) + 'ms'); } } last.rawProgramDateTime = f.rawProgramDateTime; last.programDateTime = f.programDateTime; last.duration = f.duration; last.sn = f.sn; }); }); } hls.on(Hls.EventsteLevelInfo(); }); var fragLoadCount = 0; var fragBandwidths = []; var numOfSamples = 8; hls.on(Hls.Events.FRAG_LOADED, function(event, data) { updateLevelInfo(); var currentBw = hls.bandwidthEstimate; if ( currentBw < 1 ) { return; } var len = fragBandwidths.length; if ( len < numOfSamples ) { fragBandwidths.push(currentBw); } else { fragBandwidths.shift();
 fragBandwidths.push(currentBw); var avg = Math.round(fragB((a, b) => a + b) / len); if ( ++fragLoadCount % numOfSamples === 0 ) { saveSettings({'bw': avg}); } } }); hls.on(Hls.Events.MANIFEST_PARSED, function(event, data) { _retryCount = 0; _levels = data.levels; _levels.sort(function(a,b) {return (a['bitrate'] > b['bitrate']) ? 1 : ((b['bitrate'] > a['bitrate']) ? -1 : 0); });evelIndex = i; }); if ( _preferredBitrate > 0 ) { var level = 0; if ( _preferredBitrate === 1 ) { level = 0; } else if ( _preferredBitrate === 2 ) { level = _levels.length - 1; } else { var closest = _levels.reduce(function(prev, curr) { return (Math.abs(curr['bitrate'] - _preferredBitrate) < Math.abs(prev['bitrate'] - _preferredBitrate) ? curr : prev); }); level = closest._levelIndex; } hls.nextLevel = level; } else if ( _lastBw > 0 ) { var adjustedBw = _lastBw * hls.config.abrBandWidthFactor; var level = 0; for (var i = _levels.length - 1; i >= 0; i--) { if ( adjustedBw >= _levels[i]['bitrate'] ) { level = i; break; } } hls.nextAutoLevel = hls.startLevel = level; } updateLevelInfo(true); }); == '1.1.1-m2'; }; var reloadManifestFn = function() { this._clearRetryPlayTimer();
 if ( delayedPlayerState ) { return; } if ( _retryCount < 30 ) { _retryCount++; try { hls.stopLoad(); } catch (err) {} this.retryTimer = setTimeout(function(){ try { hls.stopLoad(); } catch (err) {} hls.trigger(Hls.Events.MANIFEST_LOADING, { url: source.src }); }, 1500); } else { hlsjsErrorHandler(); this.retryTi: 'offline'}); }, 0); } }.bind(this); hls.on(Hls.Events.ERROR, function(event, data) { if (data.fatal) { switch (data.type) { case Hls.ErrorTypes.NETWORK_ERROR: reloadManifestFn(); break; case Hls.ErrorTypes.MEDIA_ERROR: hlsjsErrorHandler(); break; default: console.error('Error loading media: File could not be played'); break; } } else { if (data.type === Hls.ErrorTypes.NETWORK_ERROR && data.response && (data.response.code === 403 || data.response.code === 404)) { if (isOldHlsFn()) { reloadManifestFn(); } } } }.bind(this)); Object.keys(Hlsme, data); }); });
 if (!tech.featuresNativeTextTracks) { Object.defineProperty(el, 'textTracks', { value: tech.textTracks, writable: false }); eh, arguments); }; }  hls.attachMedia(el); hls.loadSource(source.src); this.updateDebug(); } var hlsTypeRE = /^application\/(x-mpegURL|vnd\.apple\.mpegURL)$/i; var hlsExtRE = /\.m3u8/i; var HlsSourceHandler = { HlsJs: true, canHandleSource: function(source) { if (source.skipHlsJs) { return ''; } else if (hlsTypeRE.test(source.type)) { return 'probably'; } else if (hlsExtRE.test(source.src)) { return 'maybe'; } else { return ''; } source, tech); }
 return ''; } }; if (Hls.isSupported()) { var html5Tech = videojs.getTech && videojs.getTech('Html5'); html5Tech = html5Tech || (videojs.getComponent && videojs.getComponent('Html5')); if (html5Tech) { var indexPosition = preferHlsJs ? 0 : undefined; html5Tech.registerSourceHandler(HlsSourceHandler, indexPosition); } } })(videojs, window.Hls, window);  (function(videojs, root) { function WebrtcPlayer (source, tech) { tech.name_ = 'WebRTC'; var _video = tech.el(); var _player = videojs(tech.options_.playerId); var _ws, _peer, wsUrl, streamNamesUrl, streamInfo, userData, sdpOffer, localDesc, addedIceCandidates; var videoDomain; var repeaterRetryCount = 0; var restartCount; var sdpRetryCount; var repeaterTimer; var disposing = false; var streamNames = []; var fetchStreamNamesPromise; var streamName; var requestId = "subscriber-" + Math.floor(65536 * Math.random()).toString(16) + Math.floor(65536 * Math.random()).toString(16) + Math.floor(65536 * Math.random()).toString(16); this.wsPingInterval = 0; this.serverMode = 0; this.AUTH_NEED = 0; this.AUTH_SENT = 1; this.AUTH_GOOD = 2;
 this.AUTH_BAD = 3; if ( ! source.src ) { return; } var parsedSrc; try { parsedSrc = root.JSON.parse(root.decodeURIComponent(source.src)); } catch (e) { console.error("unable to parse source:", source.src); return; } if ( ! parsedSrc.wsUrl ) { console.error("missing wsUrl in", parsedSrc); return; } wsUrl = parsedSrc.wsUrl; if ( ! parsedSrc.streamInfo ) { console.error("missing streamInfo in", parsedSrc); return; } streamInfo = parsedSrc.streamInfo; if ( ! parsedSrc.userData ) { console.error("missing userData in", parsedSrc); return; } userData = parsedSrc.userData; if ( ! parsedSrc.streamNamesUrl ) { console.error("missing streamNamesUrl in", parsedSrc); return; } videoDomain = parsedSrc.videoDomain; streamNamesUrl = parsedSrc.streamNamesUrl; restartCount = ( parsedSrc.restartCount ? parsedSrc.restartCount : 0 ); if ( _player ) { _player.one('playing', function() {
 var playingIndex = 0; var label = 'Auto'; if (streamNames.length) { if ( typeof(streamNames[playingIndex]['title']) === 'string' && streamNames[playingIndex]['title'].length > 0 ) { label = streamNames[playingIndex]['title']; if ( typeof(streamNames[playingIndex]['bw']) !== 'undefined' ) { var bw = parseInt(streamNames[playingIndex]['bw'], 10); if ( bw >= 1000 ) { label += ' ' + ( bw >= 1000000 ? (bw / 1000000).toFixed(1) + 'mbps' : (bw / 1000).toFixed(0) + 'kbps' ); } } } } var _qualities = []; _qualities.push({ id: 1, group:'qualities', label: label, selected: true, clickable: true }); if ( _player && _player.trigger && ! disposing ) { _player.trigger('_drawMenu', { fromTech: 'webrtc', videoQualities: _qualities, video return false; } }); } }.bind(this)); } this._fetchStreamNames = function() { return new root.Promise(function(resolve, reject) { if (this.serverMode === 1 && this.c2c) { return resolve(); } try { _video.dispatchEvent(new Event('waiting')); } catch (err) {} var attempt = 0;
 var sendRequestFn = function() { attempt++; if ( attempt >= 15 ) { return reject(); } var req_object = new root.XMLHttpRequest(); req_object.open('GET', streamNamesUrl ); req_object.onreadystatechange = function() { if ( req_object.readyState === 4 ) { var jsonResponse; try { jsonResponse = JSON.parse(req_object.responseText); } catch(err) {} if ( typeof(jsonResponse) === 'object' && jsonResponse != null && jsonResponse.hasOwnProperty('streams') ) { if ( jsonResponse['streams']['available'] === 'true' || jsonResponse['streams']['available'] === true ) { streamNames = jsonResponse['streams']['streamList']; return resolve(); } else { this._clearRepeaterTimer(); repeaterTimer = root.setTimeout(sendRequestFn.bind(this), 1000); } } else { resolve(); } } }.bind(this); req_object.send(); }.bind(this); sendRequestFn(); }.bind(this)); }; this._resetVars = function() { this.closeWs(); this.closePeer(); this._clearRepeaterTimer(); repeaterRetryCount = 0; sdpRetryCount = 0; localDesc = undefined; sdpOffer = undefined; addedIceCandidates = undefined; disposing = false; };
 this._reportBack = function(reportData) { if ( ! _player ) { return; } var data = { 'version': VideoPlayer.prototype.VERSION, 'wsUrl': wsUrl, 'userData': {}, 'streamInfo': streamInfo, 'restartCount': restartCount }; var extraType = typeof(VideoPlayer.prototype.REPORTBACK_EXTRA); if ( (extraType === 'string' && extraType.length > 0) || (extraType === 'object' && extraType != null) ) { data['extra'] = VideoPlayer.prototype.REPORTBACK_EXTRA; } var k; for (k in userData) { if (userData.hasOwnProperty(k) && k !== 'password') { data['userData'][k] = userData[k]; } } for (k in reportData) { if (reportData.hasOwnProperty(k)) { data[k] = reportData[k]; } } _player.trigger("_reportBack", { name: 'videoplayerjsWebrtc', data: JSON.stringify(data) }); }; this._fetchServerType = function () { return new root.Promise(function (resolve, reject) { if (typeof (VideoPlayer.prototype._serverLookupCache[videoDomain]) === 'number') { this.serverMode = VideoPlayer.prototype._serverLookupCache[videoDomain]; return resolve(); } var req_object = new XMLHttpRequest(); req_object.open('GET', 'https://' + videoDomain + '/servertype'); req_object.onreadystatechange = function () { if (req_object.readyState === 4) { this.serverMode = VideoPlayer.prototype._serverLookupCache[videoDomain] = parseInt(req_object.responseText, 10) | 0;
 return resolve(); } }.bind(this); req_object.send(); }.bind(this)); }; this.initialize = function() { var webrtcConfig = tech.options_.webrtcConfig || {}; this._resetVars(); this._fetchServerType().then(function() { if ( this.serverMode === 1 && this.c2c ) { streamName = streamInfo['streamName']; wsUrl = 'wss://' + videoDomain + '/' + streamInfo.applicationName + '/?id=' + streamName;
 Object.keys(userData).forEach(function (key) { wsUrl += '&' + key + '=' + encodeURIComponent(userData[key]); }); } if (!disposing) { fetchStreamNamesPromise = this._fetchStreamNames(); if ( this.serverMode === 1 && ! this.c2c ) { fetchStreamNamesPromise.then(function() { if (streamNames.length) { streamInfo['streamName'] = streamNames[0]['streamName']; } streamName = streamInfo['streamName']; wsUrl = 'wss://' + videoDomain + '/' + streamInfo.applicationName + '/webrtc-playback.json?id=' + streamName;
 Object.keys(userData[key]); }); this.openWs(); }.bind(this)); } else { this.openWs(); } } }.bind(this)); }; this.log = function(msg) { if ( _player ) _player.trigger('_log', '[webrtc]: ' + msg); }; this.openWs = function() {
 if ( _ws ) { this.closeWs(); } if (disposing) { return; } this._authStatus = this.AUTH_NEED; _ws = new root.WebSocket(wsUrl); _ws.binaryType = 'arraybuffer'; if (this.serverMode === 1) { _ws.onopen = this.wsNewOnOpen; _ws.onmessage = this.wsNewOnMessage; } else { _ws.onopen = this.wsOnOpen; _ws.onmessage = this.wsOnMessage; } _ws.onclose = this.wsOnClose; _ws.onerror = this.wsOnError; }; this.sendGetOffer = function() { repeaterRetryCount++; this.wsSend(root.JSON.stringify({ 'direction': 'play', 'command': 'getOffer', 'streamInfo': streamInfo, 'userData': userData })); }; this.sendResponse = function(desc) { this.wsSend(root.JSON.stringify({ 'direction': 'play', 'command': 'sendResponse', 'streamInfo': streamInfo, 'sdp': desc, 'userData': userData })); }.bind(this); this.stopWsPing = function() { if (this.wsPingInterval > 0) { root.clearInterval(this.wsPingInterval); this.wsPingInterval = 0; }
 }; this.wsSend = function(msg) { if ( _ws && _ws.readyState === root.WebSocket.OPEN && !disposing ) { _ws.send(msg); } }; this.wsSendAuth = function() { return new root.Promise(function(resolve, reject) { this._onAuthenticateResponse = function(result) { this._onAuthenticateResponse = null; if ( result['status'] === 200 && result['value'] && typeof(result['value']['userID']) === 'number' ) { this.log("OK Auth - response: " + JSON.stringify(result)); this.userId = result['value']['userID']|0; this._authStatus = this.AUTH_GOOD; return resolve(); } else { this.log("Invalid Auth - response: " + JSON.stringify(result)); this._authStatus = this.AUTH_BAD; return reject("Invalid auth"); } }.bind(this); var authString = root.JSON.stringify({ 'command': 'auth', 'streamInfo': streamInfo, 'userData': userData }); this.log("Sending auth string: " + authString); this.wsSend(authString); this._authStatus = this.AUTH_SENT; }.bind(this)); }; this.wsNewOnOpen = function() { this.wsPingInterval = root.setInterval(function() { this.wsSend(JSON.stringify({'ping':true})); }.bind(this), 10000); }.bind(this); this.wsOnOpen = function() { fetchStreamNamesPromise.then(function() { if (disposing) {
 return; } if (streamNames.length) { streamInfo['streamName'] = streamNames[0]['streamName']; } this.wsSendAuth().then(function(){ if (disposing) { return; } _peer = new root.RTCPeerConnection({'iceServers': []}); _peer.ontrack = this.peerOnTrack; _peer.oniceconnectionstatechange = this.iceConnectionStateChange; this.sendGetOffer(); }.bse('offline'); }.bind(this)); }.bind(this)).catch(function() { console.error("can't fetch streamnames"); this._reportBack({"error_msg": "missing_streamnames", "error_data": "unable to fetch streamnames"}); this.setStateAndDispose('offline'); }.bind(this)); }.bind(this); this.wsNewOnMessage = function(evt) { var msg = root.JSON.parse(evt.data); if ( typeof(msg.isAvailable) === 'boolean' ) { if ( msg.isAvailable ) { this.wsSend(JSON.stringify({"requestOffer": streamName, "requestId": requestId, "datachannel": false})); } else { this.log('INFO: stream not ready'); this.restart(); } } else if ( msg.data ) { if ( msg.data.type === 'status' ) { if ( msg.data.code === 'NetConnection.Connect.Success' ) { return this.wsSend(JSON.stringify({'isAvailable': streamName})); } else if ( msg.data.code === 'NetConnection.ICE.TrickleCompleted' ) { return this.wsSend(JSON.stringify({"subscribe": streamName, "requestId": requestId})); } } else if ( msg.data.sdp ) { if ( msg.data.sdp.type ) { _peer = new root.RTCPeerConnection({'iceServers': []}); _peer.ontrack = this.peerOnTrack; _peer.oniceconnectionstatechange = this.iceConnectionStateChange; var sessionDescrption = new root.RTCSessionDescription(msg.data.sdp); _peer.setRemoteDescription(sessionDescrption).then(function() {
 _peer.createAnswer() .then(function(desc) { _peer.setLocalDescription(desc).then(function() { this.wsSend(JSON.stringify({"handleAnswer": streamName, "requestId": requestId, "data": { "sdp": desc } })); }.bind(this)).catch(this.peerErrorHandler); }.bind(this)); }.bind(this)); } } else if ( msg.data.type === 'candidate' ) { if ( msg.data.candidate.candidate.length ) { var foundProto = msg.data.candidate['candidate'].match(/\s(TCP|UDP)\s/i); if ( foundProto ) { var proto = foundProto[1].toUpperCase(); if ( proto === 'UDP' && !VideoPlayer.prototype.BROWSER.IS_ANDROID && (VideoPlayer.prototype.BROWSER.IS_CHROME || VideoPlayer.prototype.BROWSER.IS_ANY_SAFARI) ) { return; } } _peer.addIceCandidate(new root.RTCIceCandidate(msg.data.candidate)); } else { _peer.addIceCandidate(null); this.wsSend(JSON.stringify({"handleCandidate": streamName, "requestId": requestId, "data": msg.data})); } } } }.bind(this); this.wsOnMessage = function(evt) { var msg = root.JSON.parse(evt.data); var msgStatus = msg['status']|0; var msgCommand = msg['command']; if ( this._authStatus === this.AUTH_SENT ) { if ( msgCommand === 'auth' ) { if ( typeof(this._onAuthenticateResponse) !== 'function' ) { this.log('ERROR: no handler for auth response: ' + evt.data); return this.setStateAndDispose('offline'); } return this._onAuthenticateResponse(msg); } this.log('ERROR: invalid auth response received: ' + evt.data); this._reportBack({"error_msg": "invalid_auth", "error_data": evt.data});
 return this.setStateAndDispose('offline'); } if ( msgStatus === 502 || msgStatus === 514 || msgStatus === 504 ) { if (repeaterRetryCount < 20) { var timerLength; if ( repeaterRetryCount <= 6 ) { timerLength = this.getRandomInt(500, 900); } else if ( repeaterRetryCount <= 12 ) { timerLength = this.getRandomInt(900, 1300); } else { timerLength = this.getRandomInt(1300, 2000); } this.log('INFO: stream not ready (received a ' + msgStatus + '), attempted ' + repeaterRetryCount + ' times - trying again in ' + timerLength + 'ms'); this._clearRepeaterTimer(); repeaterTimer = root.setTimeout(this.sendGetOffer.bind(this), timerLength); } else { this.log('ERROR: received too many ' + msgStatus + ' responses (stream not ready) - giving up.'); this._reportBack({"error_msg": "stream_not_ready", "error_data": "received " + msgStatus + " on " + repeaterRetryCount + " attempt"}); return this.setStateAndDispose('offline'); } } else if ( msgStatus !== 200) { this.log('ERROR: received a unhandled non-200 response:' + evt.data); this._reportBack({"error_msg": "non_200", "error_data": "received " + msgStatus + " response with data " + evt.data }); return this.setStateAndDispose('offline'); } else { var streamInfoResponse = msg['streamInfo']; if (streamInfoResponse !== undefined) { streamInfo['sessionId'] = streamInfoResponse.sessionId; } var sdpData = msg['sdp']; if (sdpData !== undefined && sdpData['type'] === 'offer') { if ( repeaterRetryCount > 1 ) { this.log("sdp offer received after " + repeaterRetryCount + " attempts"); } repeaterRetryCount = 0; var hasVideo = /^m=video\s/gm.test(sdpData['sdp']); var hasAudio = /^m=audio\s/gm.test(sdpData['sdp']); if ( ! hasVideo || ! hasAudio ) { if (sdpRetryCount < 10) { sdpRetryCount++; var sdpTimerLength; if ( sdpRetryCount <= 5 ) { sdpTimerLength = this.getRandomInt(250, 450);
 } else if ( sdpRetryCount <= 9 ) { sdpTimerLength = this.getRandomInt(450, 750); } else { sdpTimerLength = this.getRandomInt(750, 1200); } this.log('INFO: SDP offer did not have ' + (hasVideo ? 'audio' : 'video') + ', attempted ' + sdpRetryCount + ' times - trying again in ' + sdpTimerLength + 'ms'); this._clearRepeaterTimer(); repeaterTimer = root.setTimeout(this.sendGetOffer.bind(this), sdpTimerLength); return; } else { this.log('ERROR: SDP offers never had both video and audio - retries over, playing feed as is.'); } } sdpRetryCount = 0; var badProfileReg = /(profile-level-id=(?:(?!42e01f)[a-f0-9]{6}))/ig; if ( sdpData['sdp'].match(badProfileReg) ) { var goodProfile = 'profile-level-id=42e01f'; this.log("applying sdp profile-level-id workaround, received: " + RegExp.$1 + " updating to: " + goodProfile); sdpData['sdp'] = sdpData['sdp'].replace(badProfileReg, goodProfile); } sdpOffer = sdpData['sdp']; var sessionDescrption = new root.RTCSessionDescription(sdpData); _peer.setRemoteDescription(sessionDescrption).then(function() { _peer.createAnswer() .then(this.peerGotDesn answer", e); }.bind(this)); }.bind(this)).catch(this.peerErrorHandler); } var iceCandidates = msg['iceCandidates']; if (iceCandidates !== undefined) { for(var index in iceCandidates) { var iceCandidate = iceCandidates[index]; if ( typeof(iceCandidate['candidate']) === 'string' ) { var foundProto = iceCandidate['candidate'].match(/\s(TCP|UDP)\s/); if ( foundProto ) { var proto = foundProto[1]; if ( proto === 'UDP' && !VideoPlayer.prototype.BROWSER.IS_ANDROID && (VideoPlayer.prototype.BROWSER.IS_CHROME || VideoPlayer.prototype.BROWSER.IS_ANY_SAFARI) ) {
 continue; } } } if (typeof(addedIceCandidates) !== 'object') { addedIceCandidates = []; } addedIceCandidates.push(iceCandidate['candidate']); _peer.addIceCandidate(new root.RTCIceCandidate(iceCandidate)); } _peer.addIceCandidate(null); } } if (msgCommand === 'sendResponse') { this.closeWs(); } }.bind(this); this.wsOnClose = function(evt) { this.stopWsPing(); this.log("websocket was closed unexpectedly, restarting player"); return this.restart(); }.bind(this); this.wsOnError = function(evt) { var errString = evt.toString(); if ( errString === "[object Event]" ) { errString = "unknown error"; } errString += " [Auth Status: " + this._authStatus + "]"; this.log("WS ERROR: " + errString); return this.setStateAndDispose('offline'); }.bind(this); this._clearRepeaterTimer = function() { if ( repeaterTimer > 0 ) { root.clearTimeout(repeaterTimer); repeaterTimer = 0; } }; this.closeWs = function() { this._clearRepeaterTimer(); this.stopWsPing();
 if ( _ws ) { _ws.onopen = function(){}; _ws.onmessage = function(){}; _ws.onerror = function(){}; _ws.onclose = function(){}; _ws.close(); _ws = void 0; } }; this.peerGotDescription = function(desc) { localDesc = desc['sdp']; _peer.setLocalDescription(desc).then(this.sendResponse(desc)).catch(this.peerErrorHandler); }.bind(this); this.iceConnectionStateChange = function() { if (!_peer) { return; } if (disposing) { this.log("webrtc disposing, ignoring iceConnectionState change to: " + _peer.iceConnectionState); return; } if ( _peer.iceConnectionState === 'disconnected' || _peer.iceConnectionState === 'failed' ) { var report = {"error_msg": "ice_connection_state", "error_data": _peer.iceConnectionState}; if ( _peer.iceConnectionState === 'failed' && addedIceCandidates ) { report['iceCandidates'] = addedIceCandidates; } this.log("peer iceConnectionState changed to: " + _peer.iceConnectionState); return this.restart(); } }.bind(this); thvt.streams[0]; }.bind(this); this.peerErrorHandler = function(e) { root.console.error("PEER ERROR", e); this.log("PEER ERROR: " + e.toString()); var report = {"error_msg": "peer_error", "error_data": e.toString()}; if (sdpOffer) { report['sdpOffer'] = sdpOffer; }
 if (localDesc) { report['sdpLocalDesc'] = localDesc; } return this.setStateAndDispose('offline'); }.bind(this); this.closePeer = function() { if ( _peer ) { _peer.close(); _peer = void 0; } }; this.duration = function() { return Infinity; }; this.restart = function() { this.dispose(); if ( _player ) { var timerLen; if ( restartCount <= 1 ) { timerLen = this.getRandomInt(400, 800); } else if ( restartCount <= 4 ) { timerLen = this.getRandomInt(1000, 2000); } else if ( restartCount <= 10 ) { timerLen = this.getRandomInt(2000, 3500); } else { return this.setStateAndDispose('offline'); } this.log("Restart player in " + timerLen + "ms"); _player.trigger('_restart', {timerLen: timerLen}); } else { this.setStateAndDispose('offline'); } }; this.setStateAndDispose = function(state) { if ( _player ) { _player.trigger('_setPlacard', {state: state}); } this.dispose(); }; this.dispose = function() { disposing = true; this.closeWs(); this.closePeer();
 if ( _video && _video.srcObject ) { _video.srcObject = null; } }; thin + 1)) + min; }; this.initialize(); } WebrtcPlayer.checkCount = 0; WebrtcPlayer.maxCheckCount = 4; WebrtcPlayer.checkCodecSupport = function(codecs) { return new root.Promise(function(resolve, reject) { WebrtcPlayer.checkCount++; var logMsg = ''; var supportedFn = function(isSupported, codecSettings) { codecSettings.supported = isSupported; if ( ! codecSettings.supported && codecSettings.name === 'H264' && logMsg.length > 0 && WebrtcPlayer.checkCount === WebrtcPlayer.maxCheckCount ) { try { var prev = VideoPlayer.prototype.REPORTBACK; VideoPlayer.prototype.REPORTBACK = true; VideoPlayer.prototype._reportBack({}, { name: 'videoplayerjsWebrtc', data: JSON.stringify({'version': VideoPlayer.prototype.VERSION, 'error_msg': 'webrtc_missing_codec', 'error_data': logMsg }) }); VideoPlayer.prototype.REPORTBACK = prev; } catch (err) {} } }; var promises = []; Object.keys(codecs).forEach(function(key) { var codecSettings = codecs[key]; try { if ( (VideoPlayer.prototype.BROWSER.IS_IOS || VideoPlayer.prototype.BROWSER.IS_ANY_SAFARI) ) { if ( codecSettings.name === 'H264' ) { return supportedFn(true, codecSettings ); } else if ( codecSettings.name === 'VP8' ) { return supportedFn((root.navigator && typeof(root.navigator.share) === 'function'), codecSettings ); } else { console.log("WebrtcPlayer.checkCodecSupport Error: Unhandled codecSettings.name '" + codecSettings.name + "' in iOS workaround");
 return; } } if ( typeof(root.RTCPeerConnection) === 'function' ) { promises.push(new root.Promise(function(sdpResolve, sdpReject) { var rtcpc = new root.RTCPeerConnection(); rtcpc.createOffer({offerToReceiveVive(offe sdpResolve(); }); }).then(function(offerSdp) { if ( typeof(offerSdp) === 'string' ) { logMsg = offerSdp; return supportedFn(!!codecSettings.regexps.offerSdp.test(offerSdp), codecSettings); } else { return supportedFn(false, codecSettiodecSettings); }) ); return; } return supportedFn(false, codecSettings); } catch(err) { console.log("WebrtcPlayer.checkCodecSupport Error:", err); return supportedFn(false, codecSettings); }
 }); if ( promises.length ) { Promise.all(promises).then(resolve); } else { return resolve(); } }); }; WebrtcPlayer.isBrowserSupported = function() { if ( VideoPlayer.prototype.BROWSER.IS_EDGE ) { return false; } if ( VideoPlayer.prototype.BROWSER.IS_OPERA ) { return false; } return !!( typeof(root.Promise) === 'function' && typeof(root.WebSocket) === 'function' && typeof(root.RTCPeerConnection) === 'function' && typeof(root.RTCSessionDescription) === 'function' && typeof(root.RTCIceCandidate) === 'function' && ( WebrtcPlayer.supportsH264() ) ); }; WebrtcPlayer.supportsH264 = function() { return !!VideoPlayer.prototype.WEBRTC_CODECS['H264'].supported; }; WebrtcPlayer.supportsTranscodedFeed = function() { return false; }; videojs.WebrtcPlayer = WebrtcPlayer; var registerSourceHandler = function() { if (WebrtcPlayer.isBrowserSupported()) { videojs.getTech('Html5').registerSourceHandler({ WebRTC: true, canHandleSource: function (source) { var webrtcRE = /^application\/ws\+webrtc$/i; if (webrtcRE.test(source.type)) { return 'probably'; } return '';
 }, handleSource: function (source, tech) { if ( tech.webrtcProvider ) tech.webrtcProvider.dispose(); tech.webrtcProvider = new WebrtcPlayer(source, tech); return tech.webrtcProvider; } }, 0); } }; if ( typeof(root.Promise) === 'function' ) { var executeCheckCodecSupport = function() { WebrtcPlayer.checkCodecSupport(VideoPlayer.prototype.WEBRTC_CODECS).then(function() { if ( WebrtcPlayer.isBrowserSupported() ) { registerSourceHandler(); } else if ( WebrtcPlayer.checkCount < WebrtcPlayer.maxCheckCount ) { setTimeout(executeCheckCodecSupport, 250); } }); }; executeCheckCodecSupport(); } })(videojs, window); VideoPlayer.prototype._checkForVolumeSupport(); return VideoPlayer;}));

// js_build_core: MfcJs/VideoPlayer/VideoPlayerPlugins.js
(function (root, VideoPlayerPluginsWrapper) { 'use strict'; if ( typeof(define) === "function" && define.amd ) { define(["videojs"], function(videojs) { if ( typeof(root.videojs) === "undefined" ) root.videojs = videojs; return (root.VideoPlayerPlugins = VideoPlayerPluginsWrapper()); }); } else if ( typeof(module) === "object" && module.exports ) { module.exports = (root.VideoPlayerPlugins = VideoPlayerPluginsWrapper()); } else { root.VideoPlayerPlugins = VideoPlayerPluginsWrapper(); }}(this, function() { 'use strict'; ;"function"!=typeof Object.assign&&Object.defineProperty(Object=a[c])}return e},writable:!0,confo.p="",o(o.s=0)}([function(e,t,o){"use strict";var n,i="function"==typeof Symbol&&"symbol"==typeofymbol":typeof e},r=o(1),s=(n=r)&&n.__esModule?n:{default:n};(videojs.registerPlugin||videojs.plugin)("qualityPickerPlugin",function(){var e,t=this,o="VideoPickerButton";t.on("tech_loadedqualitydata",function(n,r){var a=r.qualityData,u=r.qualitySwitchCallback,l=r.mouseLeaveTimeout;if(e)return function(t,n){e&&e.menu&&(e.options_.qualitySwitchCallback=n,e.menu.options_={name:o,qualityList:t.video,qualitySwitchCallback:n,trackType:"video"})}(a,u),void function(t){if(e&&e.menu){for(var o={},n=0;n<t.video.length;n++){var i=t.video[n];if("empty"!==i.group){var r=e.menu.getChildById(i.id);o[String(i.id)]=!0,r?(i.hide&&r.hide(),r.el().innerHTML='<span class="vjs-menu-item-text">'+i.label+"</span>",i.addClasses&&r.addClasses(i.addClasses),r.clickable=!!i.clickable,r.setOptions(e.menu,i),i.hide||r.show(),i.selected?(r.selected(!0),r.removeClass("is-playing"),"playtypes"===i.group&&e.setSelectedPlayType(i)):(r.selected(!1),i.isplaying?r.addClass("is-playing"):r.removeClass("is-playing"))):e.addQuality(i,n)}else e.setEmptyMessage(i)}var s=[];e.menu.children().forEach(function(e){o[String(e.id_)]||s.puseQualityByEl(t)}),e.displayEmptyMessage(),e.updateBoxCountClass()}}(a);if("object"===(void 0===a?"undefined":i(a))&&a.video&&a.video.length>0){(e=new s.default(t,{name:o,qualityList:a.video,qualitySwitchCallback:u,trackType:"video"})).setMouseLeaveTimeout(l);var c=t.controlBar.getChild("fullscreenToggle");c&&t.controlBar.removeChild(c),t.controlBar.addChild(e),c&&t.controlBar.addChild(c)}}),t.on("tech_unloadedqualitydata",function(){e&&(e.dispose(),t.controlBar.removeChild(e),e=void 0)})})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},i=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),r=function e(t,o,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,o);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,o,n)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(n):void 0},s=ue?e:{default:e}}var l=videojs.getComponent("MenuButton"),c=function(e){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));return n.mouseLeaveTimeout=0,n.mouseLeaveTimer=0,n.menuButton_.off("mouseenter"),n.on(n.menuButton_,"mouseenter",n.handleMouseEnter),n.on(n.menu,"mouseenter",n.handleMouseEnter),n.on(e,"userinactive",n.superHandleMouseLeave),n.on(e,"userinactive",n.hideMenuOnInactive),n.addClass("vjs-settings-menu"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l),i(t,[{key:"setMouseLeaveTimeout",value:function(e){Number.isFinite(e)&&e>=0&&(this.mouseLeaveTimeout=e)}},{key:"handleMouseEnter",value:function(e){this.clearMouseLeaveTimer(),this.addClass("vjs-hover"),this.menu.show()}},{key:"clearMouseLeaveTimer",value:function(){this.mouseLeaveTimer>0&&(this.clearTimeout(this.mouseLeaveTimer),this.mouseLeaveTimer=0)}},{key:"hideMenuOunpressButton()}},{key:"superHandleMouseLeave",value:function(e){this.clearMouseLeaveTimer(),r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"handleMouseLeave",this).call(this,e)}},{key:"handleMouseLeave",value:function(e){var t=this;this.clearMouseLeaveTimer(),this.mouseLeaveTimerleMouseLeave(e)},this.mouseLeaveTimeout)}},{key:"createMenu",value:function(){this.qualityMenu=new s.default(this.player,this.options_),this.resetOrder();for(var e=0;e<this.options_.qualityList.length;e++){var t=this.options_.qualityList[e];"empty"!==t.group?this.addQuality(t,e):this.setEmptyMessage(t)}return this.displayEmptyMessage(),this.updateBoxCountClass(),this.qualityMenu}},{key:"setSelecteectedPlayType=e}},{key:"setEmpoup="qualities"}},{key:"displayEmptyMessage",value:function(){this.ensureOrderIsSet();var e=n({},this._m_emptyQuality);this._m_emptyQuality&&0===this._m_order_sub&&(this._m_selectedPlayType&&this._m_selectedPlayType.label&&(e.label=e.label.replace("{label}",this._m_selectedPlayType.label)),this.addQuality(e,2))}},{key:"addQuality",value:function(e,t){var o;(this.ensureOrderIsSet(),e.addClasses=[],e.extraClasses)&&(o=e.addClassn Array.from(e)}(e.extraClasses));e.selected||e.clickable||e.addClasses.push("not-clickable"),"qualities"===e.group?(this._m_order_sub++,e.addClasses.push("qsubq","qsubq_"+this._m_order_sub)):"playtypes"===e.group?(this._m_order++,e.addClasses.push("qq","qq_"+this._m_order)):e.group&&e.addClasses.push(e.group),!e.selected&&e.isplaying&&e.addClasses.push("is-playing");var i=this.options_,r=i.qualitySwitchCallback,s=i.trackType,u=n({qualitySwitchCallback:r,trackType:s},e,{selectable:!0}),l=new a.default(this.player,u);u.addClasses&&l.addClasses(u.addClasses),e.hide?l.hide():l.show(),this.qualityMenu.addItem(l,t)}},{key:"removeQualityByEl",value:function(e){this.ensureOrderIsSet(),e.hasClass("qsubq")?this._m_order_sub=Math.max(0,this._m_order_sub-1):e.hasClass("qq")&&(this._m_order=Math.max(0,this._m_order-1)),this.menu.removeChild(e)}},{key:"updateBoxCountClass",value:function(){this.ensureOrderIsSet();var e="box_"+this._m_order+"-"+this._m_order_sub;this._boxCountClass!==e&&(this._boxCountClass&&this.removeClass(this._boxCountClass),this._boxCountClass=e,this.addClass(this._boxCountClass));var t="box_height_"+Math.max(this._m_order,this._m_order_sub);this._boxHeightClass!==t&&(this._boxHeightClass&&this.removeClass(this._boxHeightClass),this._boxHeightClass=t,this.addClass(this._boxHeightClass))}},{key:"ensureOrderIsSet",value:function(){"number"!=typeof this._m_order&&this.resetOrder()}},{key:"r._m_order_sub=0}},{key:"buildCSSClass",value:function(){return"vjs-icon-cog vjs-icon-placeholder "+r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"buildCSSClass",this).call(this)}}]),t}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();var i=videojs.getComponent("Menu"),r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),n(t,[{kue:function(e){}},{key:"addItem",value:function(e,t){this.addChild(e,{},t)}}]),t}();t.default=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var =oo),n&&e(t,n),t}}();var r=videojs.getComponent("MenuItemhis,ar:e.__proto__=t)}(t,r),i(t,[{key:"handleClick",value:function(){if(!this.options_.clickable)return!1;if("playtypes"===this.options_.group&&!this.isSelected_){var e=[],o=this.parentComponent_;o.children().forEach(function(t){"playtypes"===t.options_.group?(t.options_.selected=!1,t.selected(!1)):"qualities"===t.options_.group&&e.puseQualityByEl(e)}),o.parentComponent_.setSelectedPlayType({label:this.options_.label}),o.parentComponent_.displa.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"handleClick",this).call(this),this.options_.qualitySwitchCallback(this.options_.id,this.options_.trackType)}},{key:"addClasses",value:function(e){var t=this;void 0===this.classesAdded&&(this.classesAdded=[]),e.forEach(function(e){return t.addClass(e)}),this.clan!e.inclu.removeClass(e)}),this.classesAdded=e}},{key:"setOptions",value:function(e,t){var o=e.options_,i=o.qualitySwitchCallback,r=o.trackType;this.options_=n({qualitySwitchCallback:i,trackType:r},t,{selectable:!0})}}]),t}();tturn e}return t}()({1:[function(t,i,r){"use strict";var n,e=t("../lib/hasAirPlayAPISupport");n={constructor:function(){this.constructor.super_.apply(this,arguments),e()||this.hide(),this.controlText("Start AirPlay"),this._reactToAirPlayAvailableEvents(buildCSSClasPlayRequested")},dispose:function(){this.trigger("disposing"),this.constructor.super_.prototype.dispos"video, audio")},_reactToAirPlayAvailableEvents:function(){var t=this._getMediaEl(),i=this;show():i.hide()};t.addEventListener("webkitplaybacktargetavailabilitychanged",r),thilitychanged",rrPlayButton",i)}},{"../lib/hasAirPlayAPISupport":4}],2:[function(t,iairPlayButton")}function e(t,i){var r=n(t);i.addButtonToControlBar&&!r&&t.controlBar.addChild("airPlayButton",i)}function o(t){var i=t.el().querySelector("video, audio");i&&i.webkitShowPlaybackTargetPicker&&i.webkitShowPlaybao.bind(null,t))}function u(t,i){t.controlBar&&l()&&(a(t),e(t,i))}var l=t("./lib/hasAirPlayAPISupport");i.exports=function(t){t.registerPlugin("airPlay",function(t){var i=Object.assign({addButtonToControlBar:!0},t||{});this.ready(u.bind(this,this,i))})}},{"./lib/hasAirPlayAPISupport":4}],3:[function(t,i,r){"use strict";var n=t("./components/AirPlayButton"),e=t("./enableAirPlay");i.exports=function(t){t=t||window.videojs,n(t),e(t)}},{"./components/AirPlayButton":1,"./enablilabili;t("./index")()},{"./index":3}]},{},[5]);}));

// js_build_core: MfcJs/VideoPublisher/VideoPublisher.js
var VideoPublisher = (function (win, nav, dom) { 'use str= function () {};  function VideoPublisher(options) {
  this.AUTH_NEED = 0;  this.AUTH_SENT = 1;  this.AUTH_GOOD = 2;  this.AUTH_BAD = 3;  this.MIN_GAIN_VALUE = 0;  this.MAX_GAIN_VALUE = 300;  this.DEFAULT_GAIN_VALUE = 100; this._authStatus = this.AUTH_NEED; this._publishAttempts = 0; this._publishTimer = 0; this._reconnectTimer = 0; this.platformId = options.platformId | 0; this.platform = this.PLATFORM['p' + this.platformId]; this.videoDevices = []; this.audioDevices = []; this.container = options.container; this.host = options.host; this.imageUrl = options.imageUrl; this.sessionId = options.sessionId | 0; this.roomId = options.roomId | 0; this.modelId = options.modelId | 0; this.password = options.password; this.camscore = options.camscore; this.streamName = options.streamName; this.audioBitrate = options.audioBitrate; this.videoBitrate = options.videoBitrate; this.videoFrameRate = options.videoFrameRate; this.c2c = !!(options.c2c || false); this.mode = (typeof (options.mode) === 'string' && options.mode.length > 0 ? options.mode.toUpperCase() : 'BROADCAST');
 this.virtualCamPreviewMode = !!(this.mode === 'VIRTUAL_CAM_PREVIEW' || false); this.disableReconnect = !!(options.disableReconnect || this.virtualCamPreviewMode || false); this.disableAuth = !!(options.disableAuth || this.virtualCamPreviewMode || false); this.connectingMsgExtra = options.connectingMsgExtra; this.serverMode = 0; this.videoCodecPreferences = [{ name: 'H264', videoChoice: '42e01f', regexp: new RegExp('profile-level-id=42e01f', 'gmi'), supported: undefined }, { name: 'VP8', videoChoice: 'VP8', regexp: new RegExp('^a=rtpmap:[^\n]+? VP8', 'gmi'), supported: undefined } ]; this.canvasPlugin = options.canvasPlugin; if (typeof (this.canvasPlugin) === 'object' && this.canvasPlugin != null && typeof (this.canvasPlugin.registerVideoPublisher) === 'function') { this.canvasPlugin.registerVideoPublisher(this); } else { this.canvasPlugin = void(0); } this.wsConnectionOnly = (this.mode === 'MESSAGING'); if (this.c2c) { this.vidctx = options.vidctx; } this.fcs = options.fcs; this.events = options.events || {};  this.userData = {}; if (this.c2c) { this.roomId = this._zeroPad(this.roomId, 9); this.userData = { 'password': this.password,
 'sessionId': this.sessionId, 'roomId': this.roomId, 'modelId': this.modelId, 'vidctx': this.vidctx, 'mode': this.mode }; } else { this.userData = { 'password': this.password, 'sessionId': this.sessionId, 'roomId': this.roomId, 'modelId': this.modelId, 'camscore': this.camscore, 'mode': this.mode }; } this.pvtSession = (!this.c2c && this.platform.hasPrivate) ? (options.pvtSession | 0) : 0; this.grpSession = (!this.c2c && this.platform.hasGroup) ? (options.grpSession | 0) : 0; this.clbSession = (!this.c2c && this.platform.hasClub) ? (options.clbSession | 0) : 0; this.disconnecting = false; this.previewMode = !!(this.virtualCamPreviewMode || false); this.logFn = options.logFn; if (options.constraints !== null && typeof (options.constraints) === 'object') { this.constraints = options.constraints; } else { this.constraints = { 'video': {}, 'audio': {} }; } this.preferredVideoDeviceLabel = options.preferredVideoDeviceLabel || this._localStorageGetItem('videopublisher_preferred_videodevice_label'); this.preferredAudioDeviceLabel = options.preferredAudioDeviceLabel || this._localStorageGetItem('videopublisher_preferred_audiodevice_label'); this.preferredVideoDeviceLabelFound = false; this.preferredAudioDeviceLabelFound = false; if (this._localStorageHasItem('videopublisher_preferred_audio_gain')) { this.preferredAudioGain = this._normalizeGain(parseInt(this._localStorageGetItem('videopublisher_preferred_audio_gain'), 10)); } else { this.preferredAudioGain = this.DEFAULT_GAIN_VALUE; }
 this.micVolumeTimerLen = 500; this.wsPingInterval = 0; this._reconnectAttempts = 0;  this.selectedVideoDeviceId = null;  this.selectedAudioDeviceId = null;  this.state = this.fcs.FCVIDEO_RX_IDLE;  this.statsTimers = {};  this.allowedIceCandidateProtocols = { 'UDP': true, 'TCP': true };  this.browserDetails = VideoPublisher._browserInfo(); this.stream = null; if (this.browserDetails.browser === 'chrome' || this.browserDetails.browser === 'safari') { this.allowedIceCandidateProtocols['UDP'] = false; } 
  this.audioData = {}; this._hasRendered = false; this._iceConnectionFailed = 0; this._pendingSettingsWindow = false; this._reconnecting = false; this._settingsWindowRdy = false;  this.videoEl = null;  this.containerEl = options.containerEl;  this.statusElContainer = null;  this.settingsElContainer = null;  this.statusMessageEl = null;  this.videoSelectEl = null;  this.audioSelectEl = null;  this.settingsCloseEl = null;  this.audioGainContainerEl = null;  this.audioMeterContainerEl = null;  this.noGainEl = null;  this.gainRangeEl = null;  this.gainValueEl = null;  this.audioVolumeEl = null;  this._onAuthenticateResponse = null; this.videoWidth = 0; this.videoHeight = 0; this.wowzaSessionId = 0; this.userId = 0; this._log("VideoPublisher v" + this.version + " loaded"); } VideoPublisher.prototype.version = '0.92.18';
 VideoPublisher.prototype._serverLookupCache = {};  VideoPublisher.isBrowserSupported = function () { var browserDetails = VideoPublisher._browserInfo(); if (browserDetails.browser === 'edge') { return false; } return !!(typeof (Promise) === 'function' && typeof (nav.mediaDevices) === 'object' && typeof (nav.mediaDevices.getUserMedia) === 'function' && typeof (RTCPeerConnection) === 'function' && typeof (RTCSessionDescription) === 'function' && typeof (RTCIceCandidate) === 'function' && typeof (WebSocket) === 'function' ); };  VideoPublisher.prototype.connect = function () { if (!VideoPublisher.isBrowserSupported()) { this._browserNotSupported(); return false; } this.previewMode = false; this._iceConnectionFailed = 0;
 if (!this._reconnecting) { this.disconnect(); } this._keepCurrentState = false; this.disconnecting = false; var _this = this; if (this._reconnecting) {  return this._fetchServerType() .then(this._initializeWs.bind(this)) .then(this._authenticateWs.bind(this)) .then(this._initializePeer.bind(this)) .then(function () { if (_this.disconnecting) { _this._destroyStream(_this.stream); } else { _this._fireEvent('connected', { connected: true, wowza_session_id: _this.wowzaSessionId | 0 }); } }) .catch(function (err) { if (_this.disconnecting) { _this._destroyStream(_this.stream); } else { _this._disconnect(String(err)); throw err; } }); } else {  return this._renderAndInitializeStream() .then(this._renderSettingsWindow.bind(this)) .then(this._fetchServerType.bind(this)) .then(this._initializeWs.bind(this)) .then(this._authenticateWs.bind(this)) .then(this._initializePeer.bind(this)) .then(function () { if (_this.disconnecting) { _this._destroyStream(_this.stream);
 } else { if (!_this.wsConnectionOnly) { _this._fireEvent('devices', { 'video': _this.videoDevices, 'audio': _this.audioDevices }); } _this._fireEvent('connected', { connected: true, wowza_session_id: _this.wowzaSessionId | 0 }); } }) .catch(function (err) { if (_this.disconnecting) { _this._destroyStream(_this.stream); } else { _this._disconnect(String(err)); throw err; } }); } };  VideoPublisher.pro.disconnect(); };  VideoPublisher.prototype.disconnect = function () { this.disconnecting = true; this._clearReconnectTimer(); if (!this._changingRooms) { if (this._keepCurrentState) { this.logFn("INFO disconnect: skipping setState(FCVIDEO_RX_IDLE) since keep current state was set"); } else { try { this._setState(this.fcs.FCVIDEO_RX_IDLE); } catch (e) {
 console.error("ERROR disconnect _setState:", e); } } } try { this._detachStream(this.stream); } catch (e) { console.error("ERROR disconnect _detachStream:", e); } try { this._closePeer(); } catch (e) { console.error("ERROR disconnect _closePeer:", e); } try { this._closeWs(); } catch (e) { console.error("ERROR disconnect _closeWs:", e); } try { this._detachStreamLocally(); } catch (e) { console.error("ERROR disconnect _detachStreamLocally:", e); } try { this._destroyStream(this.stream); } catch (e) { console.error("ERROR disconnect _destroyStream:", e); } try { this._stopStatsTimers(); } catch (e) { console.error("ERROR disconnect _stopStatsTimers:", e); } try { this._toggleSettingsWindow(false); } catch (e) { console.error("ERROR disconnect _toggleSettingsWindow:", e); } try { this._setPoster('offline'); } catch (e) {
 console.error("ERROR disconnect _setPoster:", e); } this._settingsWindowRdy = false; try { if (this.canvasPlugin && typeof (this.canvasPlugin.disconnect) === 'function') { this.canvasPlugin.disconnect(); } } catch (e) { console.error("ERROR disconnect canvasPlugin.disconnect:", e); } try { if (this.containerEl && this._hasRendered) { this._removeChildren(this.containerEl); if (this.virtualCamPreviewMode) { this.containerEl.style.zIndex = '-1000'; } this.containerEl = null; this._hasRendered = false; } } catch (e) { console.error("ERROR disconnect _removeChildren:", e); } try { if (this.videoEl) { this.videoEl.oncontextmenu = null; this.videoEl = null; } if (this.videoSelectEl) { this.videoSelectEl.onchange = null; this.videoSelectEl = null; } if (this.audioSelectEl) { this.audioSelectEl.onchange = null; this.audioSelectEl = null; } if (this.gainRangeEl) { this.gainRangeEl.oninput = null; this.gainRangeEl = null; } if (this.settingsCloseEl) { this.settingsCloseEl.onclick = null; this.settingsCloseEl = null; } } catch (e) { console.error("ERROR disconnect removing el handlers:", e); }
 };  VideoPublisher.prototype.preview = function (safeMode) { if (!VideoPublisher.isBrowserSupported()) { this._browserNotSupported(); return false; } this.disconnect(); this.disconnecting = false; this.previewMode = true; var _this = this; if (safeMode) { return this._render() .then(function () { if (_this.disconnecting) { _this._destroyStream(_this.stream); } _this._pendingSettingsWindow = true; return _this._renderSettingsWindow(); }); } else { return this._renderAndInitializeStream() .then(function () { if (_this.disconnecting) { _this._destroyStream(_this.stream); } else { _this._attachStreamLocally(_this.stream); _this._startStatsTimers(); _this._fireEvent('devices', { 'video': _this.videoDevices, 'audio': _this.audioDevices
 }); _this._fireEvent('streamtracks', _this._getStreamTracksInfo()); _this._renderSettingsWindow(); } }); } };  VideoPublisher.prototype.setAway = function (on) { if (!this.stream || this.c2c) { return false; } if (on && this.state !== this.fcs.FCVIDEO_TX_AWAY) { this._clearReconnectTimer(); this._setState(this.fcs.FCVIDEO_TX_AWAY); this._defaultRoom(); this._closePeer(); if (this.serverMode === 1) { this._closeWs(); } this._setPoster('away'); this._detachStreamLocally(); return true; } else if (!on && this.state === this.fcs.FCVIDEO_TX_AWAY) { this._clearReconnectTimer(); if (this.serverMode === 1) { this._keepCurrentState = true; this.connect(); } else { this._initializePeer(); } return true; } return false; };  VideoPublisher.prototype.toggleSettingsWindow = function (force) { var _this = this; this._render() .then(function () { var videoTracks = []; if (_this.stream && typeof (_this.stream.getVideoTracks) === 'function') { videoTracks = _this.stream.getVideoTracks(); } if (Array.isArray(videoTracks) && videoTracks.length > 0) { var videoTrackSettings = videoTracks[0].getSettings(); if (videoTrackSettings && videoTrackSettings.deviceId && _this.selectedVideoDeviceId !== videoTrackSettings.deviceId) { _this._log("fixing selectedVideoDeviceId, was: " + _this.selectedVideoDeviceId + " now: " + videoTrackSettings.deviceId); _this.selectedVideoDeviceId = videoTrackSettings.deviceId; _this.videoSelectEl.value = _this.selectedVideoDeviceId; } } var audioTracks = []; if (_this.audioData && _this.audioData.actualAudioTracks) { audioTracks = _this.audioData.actualAudioTracks; } else if (_this.stream && typeof (_this.stream.getAudioTracks) === 'function') { audioTracks = _this.stream.getAudioTracks(); } if (Array.isArray(audioTracks) && audioTracks.length > 0) { var audioTrackSettings = audioTracks[0].getSettings(); if (audioTrackSettings && audioTrackSettings.deviceId && _this.selectedAudioDeviceId !== audioTrackSettings.deviceId) { _this._log("fixing selectedAudioDeviceId, was: " + _this.selectedAudioDeviceId + " now: " + audioTrackSettings.deviceId); _this.selectedAudioDeviceId = audioTrackSettings.deviceId; _this.audioSelectEl.value = _this.selectedAudioDeviceId; } } }) .then(this._toggleSettingsWindow.bind(this, force)); };  VideoPublisher.prototype.containerResized = function (width, height) { if (this.canvasPlugin && typeof (this.canvasPlugin.containerResized) === 'function') { this.canvasPlugin.containerResized(width, height); } };  VideoPublisher.prototype.changeRoom = function (roomId, sessionType, sessionId) { var _this = this; return new Promise(function (resolve, reject) { if (_this.c2c) { return reject('c2c not allowed to change rooms'); } roomId = roomId | 0; var pvtSession = 0; var grpSession = 0; var clbSession = 0; if (_this.platform.hasPrivate && sessionType === _this.fcs.FCVIDEO_TX_PVT && sessionId > 0) { pvtSession = sessionId | 0; } else if (_this.platform.hasGroup && sessionType === _this.fcs.FCVIDEO_TX_GRP && sessionId > 0) { grpSession = sessionId | 0; } else if (_this.platform.hasClub && sessionType === _this.fcs.FCVIDEO_TX_CLUB && sessionId > 0) { clbSession = sessionId | 0; } if (_this.roomId === roomId && _this.pvtSession === pvtSession && _this.grpSession === grpSession && _this.clbSession === clbSession) { return resolve(); } _this.roomId = roomId; _this.pvtSession = pvtSession; _this.grpSession = grpSession; _this.clbSession = clbSession; if (_this.serverMode === 1) { _this._changingRooms = true;
 _thiurn resolve(); }).catch(function (err) { _this._changingRooms = false; _this._defaultRoom(); return reject(); }); } else { _this._closePeer(); return _this._initializePeer() .then(resolve) .catch(function (err) { _this._disconnect(String(err)); return reject(err); }); } }); };  VideoPublisher.prototype.adjustEventMiclevel = function (timerLen) { this.micVolumeTimerLen = timerLen | 0; if (this.micVolumeTimerLen < 50 || this.micVolumeTimerLen > 500) { this.micVolumeTimerLen = 500; } if (this.statsTimers.micVolume > 0) { win.clearInterval(this.statsTimers.micVolume); this.statsTimers.micVolume = 0; } this.statsTimers.micVolume = win.setInterval(this._fireMicVolumeEvent.bind(this), this.micVolumeTimerLen); };  VideoPublisher.prototype.changeBitrates = function (videoBitrate, audioBitrate) { var _this = this; return new Promise(function (resolve, reject) {
 if (!_this.peerConnection) { return reject("Not connected or ready to change bitrates"); } var swap = []; if (videoBitrate > 0 && _this.videoBitrate !== videoBitrate) { swap.push(['video', videoBitrate]); _this.videoBitrate = videoBitrate; } if (audioBitrate > 0 && _this.audioBitrate !== audioBitrate) { if (!swap.length) { return reject("Must also change the videoBitrate when changing audioBitrate"); } swap.push(['audio', audioBitrate]); _this.audioBitrate = audioBitrate; } if (!swap.length) { return resolve(); } var changeBitrate = function (sdp, type, newBitrate) { return sdp.replace(new RegExp('(^m=' + type + ' (?:(?!^m=)[\\s\\S])+^b=CT:)\\d+', 'gm'), '$1' + newBitrate) .replace(new RegExp('(^m=' + type + ' (?:(?!^m=)[\\s\\S])+^b=AS:)\\d+', 'gm'), '$1' + newBitrate) .replace(new RegExp('(^m=' + type + ' (?:(?!^m=)[\\s\\S])+^b=TIAS:)\\d+', 'gm'), '$1' + newBitrate * 1000) .replace(new RegExp('(^m=' + type + ' (?:(?!^m=)[\\s\\S])+\\bx-google-min-bitrate=)\\d+', 'gm'), '$1' + newBitrate) .replace(new RegExp('(^m=' + type + ' (?:(?!^m=)[\\s\\S])+\\bx-google-max-bitrate=)\\d+', 'gm'), '$1' + newBitrate); }; _this.peerConnection.createOffer() .then(function (offer) { offer.sdp = enhanceSDP(this.serverMode, offer.sdp, { audioBitrate: _this.audioBitrate, videoBitrate: _this.videoBitrate, videoFrameRate: _this.videoFrameRate });  return _this.peerConnection.setLocalDescription(offer);
 }) .then(function () { var newRemoteDescrptionRaw = Object.assign({}, _this.remoteDescriptionRa bitrates[1]); }); _this.peerConnection.setRemoteDescription(new RTCSessionDescription(newRemoteDescDescrptionRaw; }).catch(reject); }) .then(resolve) .catch(reject); }); };  VideoPublisher.prototype._clearReconnectTimer = function () { if (this._reconnectTimer > 0) { win.clearTimeout(this._reconnectTimer); this._reconnectTimer = 0; } };  VideoPublisher.prototype._reconnect = function (options) { options = options || {}; var force = !!options.force; var statusMsg = options.statusMsg ? options.statusMsg : "Disconnected - Automatically reconnecting in a couple seconds&hellip;"; this._clearReconnectTimer(); var callDisconnect = false; if (this.disableReconnect) { callDisconnect = true; this._log("Not reconnecting; Reconnect feature disabled."); } else if (!this.wsConnectionOnly && !force) { if (this._reconnecting) { callDisconnect = true;
 this._log("Not reconnecting; Previous reconnect failed."); } else if (!this.c2c && !this._isPublic()) { callDisconnect = true; this._log("Not reconnecting; not in a public room."); } else if (this.state !== this.fcs.FCVIDEO_TX_IDLE) { callDisconnect = true; this._log("Not reconnecting; state is not FCVIDEO_TX_IDLE"); } } if (callDisconnect) { return this._disconnect("Disconnected from video server"); } console.error('Attempting to reconnect...'); this._toggleStatusMessage(true, statusMsg, { loading_heart: true }); try { this._detachStream(this.stream); } catch (e) { console.error("ERROR _reconnect _detachStream:", e); } try { this._closePeer(); } catch (e) { console.error("ERROR _reconnect _closePeer:", e); } try { this._closeWs(); } catch (e) { console.error("ERROR _reconnect _closeWs:", e); } try { this._detachStreamLocally(); } catch (e) { console.error("ERROR _reconnect _detachStreamLocally:", e); } try { this._stopStatsTimers(); } catch (e) { console.error("ERROR _reconnect _stopStatsTimers:", e); }
 var _this = this; this._reconnectTimer his.connect(); }, 2000); };  VideoPublisher.prototype._disconnect = function (msg) { this._toggleStatusMessage(false, '', {}); this._fireEvent('error', msg || 'unknown error'); if (this.wsConnectionOnly) { this._reconnect(); } else { this.disconnect(); this._fireEvent('connected', { connected: false }); } };  VideoPublisher.prototype._browserNotSupported = function () { var msg = "Sorry, this browser or device does not support broadcasting with WebRTC."; var _this = thissconnect(msg); }, 1); };  VideoPublisher.prototype._fireEvent = function (evt, arg) { if (typeof (this.events[evt]) === 'function') { return this.events[evt](arg); }
 return undefined; };  VideoPublisher.prototype._renderSettingsWindow = function () { this._settingsWindowRdy = true; if (this._pendingSettingsWindow) { this._pendingSettingsWindow = false; this.toggleSettingsWindow(true); } };  VideoPublisher.prototype._toggleStatusMessage = function (on, msg, options) { if (!this.statusElContainer) { return false; } if (on === false) { this.statusElContainer.style.display = 'none'; this.statusMessageEl['innerHTML'] = ''; } else { var _msg = ''; if (options.loading_heart) { _msg += '<div class="videopublisher_loading_heart"><div></div></div><div>'; } _msg += msg; if (options.loading_heart) { _msg += '</div>'; } this.statusMessageEl['innerHTML'] = _msg; this.statusElContainer.style.display = 'block'; } return true;
 };  VideoPublisher.prototype._checkGainSupport = function () { if (this.virtualCamPreviewMode) { return false; } if (!this._hasRendered) { return false; } if (this.disconnecting) { return false; } if (!this.audioData || !this.audioData.gainNode) { this._setGain(this.DEFAULT_GAIN_VALUE); this.audioGainContainerEl.style.display = 'none'; this.noGainEl.style.display = 'block'; } else { this.audioGainContainerEl.style.display = 'block'; this.noGainEl.style.display = 'none'; } return true; };  VideoPublisher.prototype._isSettingsWindowDisplayed = function () { return !!(this.settingsElContainer && this.settingsElContainer.style.display === 'flex'); };  VideoPublisher.prototype._toggleSettingsWindow = function (force) { if (!this.settingsElContainer) { return false;
 } if (force === false || this._isSettingsWindowDisplayed()) { this.settingsElContainer.style.display = 'none'; if (this.audioMeterTimer > 0) { win.clearInterval(this.audioMeterTimer); this.audioMeterTimer = 0; } } else if (force === true || !this._isSettingsWindowDisplayed()) { if (!this._settingsWindowRdy) { this._pendingSettingsWindow = true; return true; } this._checkGainSupport(); this.settingsElContainer.style.display = 'flex'; if (this.virtualCamPreviewMode) { return true; } this.gainRangeHeight = parseInt(getComputedStyle(this.audioMeterContainerEl).getPropertyValue('height'), 10); var _this = this; this.audioMeterTimer = win.setInterval(function () { var sample = _this.gainRangeHeight; if (_this.audioData && _this.audioData.volumes) { sample -= Math.min(sample, Math.max(0, (sample * (_this.audioData.volumes.instant / 100)))); } _this.audioVolumeEl.style.height = sample + 'px'; }, 75); } return true; };  VideoPublisher.prototype._isLocalSt) === 'object' };  VideoPublisher.prototype._localStorageHasItem = function (key) { if (this._isLocalStorageSupported()) { try { return win.localStorage.hasOwnProperty(key); } catch (e) {} } return false; };  VideoPublisher.prototype._localStorageGetItem = function (key) { if (this._isLocalStorageSupported()) { try { return win.localStorage.getItem(key); } catch (e) {} } return null; };  VideoPublisher.prototype._localStorageSetItem = function (key, value) { if (this._isLocalStorageSupported()) { try { win.localStorage.setItem(key, value); } catch (e) {} } };  VideoPublisher.prototype._defaultRoom = function () { if (this.c2c || this._changingRooms) { return;
 } this.roomId = this._publicRoomId(); this.pvtSession = 0; this.grpSession = 0; this.clbSession = 0; };  VideoPublisher.prototype._setStreamInfo = function () { if (!this.streamInfo) { this.streamInfo = { 'applicationName': this._applicationName(), 'streamName': '', 'sessionId': '[empty]' }; } var streamSuffix = '.f4v'; var newStreamName = ''; if (typeof (this.streamName) === 'string' && this.streamName.length) { newStreamName = this.streamName; } else if (this._isPrivate()) { newStreamName = 'pvt_' + this.roomId + '_' + this.pvtSession + streamSuffix; } else if (this._isGroup()) { newStreamName = 'grp_' + this.roomId + '_' + this.grpSession + streamSuffix; } else if (this._isClub()) { newStreamName = 'clb_' + this.roomId + '_' + this.clbSession + streamSuffix; } else if (this._isPublic() || this.c2c) { newStreamName = this._roomPrefix() + this.roomId + streamSuffix; } else { var msg = "Unable to determine streamName - roomId: " + this.roomId + " pvtSession: " + this.pvtSession + " grpSession: " + this.grpSession; this._log(msg); throw msg; } this._log("old streamName: '" + this.streamInfo['streamName'] + "', new: '" + newStreamName + "'"); this.PUBLISH_NAME = this.streamInfo['streamName'] = newStreamName; };  VideoPublisher.prototype._isPublic = function () {
 return ( this.pvtSession === 0 && this.grpSession === 0 && this.clbSession === 0 && this.roomId === this._publicRoomId() ); };  VideoPublisher.prototype._isPrivate = function () { return ( !this.c2c && this.platform.hasPrivate && this.pvtSession > 0 && this.roomId > this.fcs.SESSCHAN_ID_START ); };  VideoPublisher.prototype._isGroup = function () { return ( !this.c2c && this.platform.hasGroup && this.grpSession > 0 && this.roomId > this.fcs.SESSCHAN_ID_START ); };  VideoPublisher.prototype._isClub = function () { return ( !this.c2c && this.platform.hasClub && this.clbSession > 0 && this.roomId > this.fcs.SESSCHAN_ID_START ); };
  VideoPublisher.prototype._setState = function (state) { if (!this._reconnecting && this.state === state) { return true; } this._log('updating state to: ' + state); this.state = state; this._wsSend(JSON.stringify({ 'command': 'updateState', 'state': this.state })); this._fireEvent('broadcasting', { state: this.state }); return true; };  VideoPublisher.prototype._c2cStartBroadcast = function () { this._wsSend(JSON.stringify({ 'command': 'startBroadcast', 'roomID': this.roomId })); };  VideoPublisher.prototype._getDevices = function () { return nav.mediaDevices.enumerateDevices() .then(this._gotDevices.bind(this)) .catch(this._getDevicesError.bind(this)); };  VideoPublisher.prototype._getDevicesError = function (err) { console.error('Unable to get devices:', err); alert(dom.domain + " must have access to your camera and microphone in order to broadcast your video"); this._disconnect('Unable to get devices: ' + err.toString()); };  VideoPublisher.prototype._gotDevices = function (devices) { this.videoDevices = []; this.audioDevices = []; var partialMatchFoundVideo = -1; var partialMatchFoundAudio = -1; for (var i = 0; i !== devices.length; ++i) { var deviceInfo = devices[i]; var id = deviceInfo.deviceId; var label = deviceInfo.label; if (deviceInfo.kind === 'audioinput') { if (!this.selectedAudioDeviceId && label && this.preferredAudioDeviceLabel) { if (this.preferredAudioDeviceLabel === label) { this.selectedAudioDeviceId = id; this.preferredAudioDeviceLabelFound = true; } else if (label.toLowerCase().includes(this.preferredAudioDeviceLabel.toLowerCase())) { partialMatchFoundAudio = i; this.preferredAudioDeviceLabelFound = true; } } this.audioDevices.push({ id: id, label: label || 'mic ' + (this.audioDevices.length + 1) }); } else if (deviceInfo.kind === 'videoinput') { if (!this.selectedVideoDeviceId && label && this.preferredVideoDeviceLabel) { if (this.preferredVideoDeviceLabel === label) { this.selectedVideoDeviceId = id; this.preferredVideoDeviceLabelFound = true;
 } else if (label.toLowerCase().includes(this.preferredVideoDeviceLabel.toLowerCase())) { partialMatchFoundVideo = i; this.preferredVideoDeviceLabelFound = true; } } this.videoDevices.push({ id: id, label: label || 'camera ' + (this.videoDevices.length + 1) }); } } if (!this.selectedAudioDeviceId && this.audioDevices.length) { if (partialMatchFoundAudio > -1) { this.selectedAudioDeviceId = devices[partialMatchFoundAudio].deviceId; } else { this.selectedAudioDeviceId = this.audioDevices[0].id; this.preferredAudioDeviceLabelFound = false; } } if (!this.selectedVideoDeviceId && this.videoDevices.length) { if (partialMatchFoundVideo > -1) { this.selectedVideoDeviceId = devices[partialMatchFoundVideo].deviceId; } else { this.selectedVideoDeviceId = this.videoDevices[0].id; this.preferredVideoDeviceLabelFound = false; } } this._renderSelects(); return true; };  VideoPublisher.prototype._deviceChange = function () { this.selectedVideoDeviceId = this.videoSelectEl[this.videoSelectEl.selectedIndex].getAttribute('value'); this.preferredVideoDeviceLabel = this.videoSelectEl[this.videoSelectEl.selectedIndex].label; this._localStorageSetItem('videopublisher_preferred_videodevice_label', this.preferredVideoDeviceLabel); if (!this.virtualCamPreviewMode) {
 this.selectedAudioDeviceId = this.audioSelectEl[this.audioSelectEl.selectedIndex].getAttribute('value'); this.preferredAudioDeviceLabel = this.audioSelectEl[this.audioSelectEl.selectedIndex].label; this._localStorageSetItem('videopublisher_preferred_audiodevice_label', this.preferredAudioDeviceLabel); } return this._updateStream(); };  VideoPublisher.prototype._updateStream = function () { var wasStreamAttached = !!this._streamAttached; this._setPoster('loading'); var _this = this; return this._destroyStream(this.stream) .then(this._initializeStream.bind(this)) .then(function (stream) { _this._detachStreamLocally(); _this._attachStreamLocally(stream); if (wasStreamAttached) { _this._replaceStream(stream); } return stream; }) .then(function (stream) { _this._setStream(stream); }) .then(function () { var streamTracksInfo = _this._getStreamTracksInfo(); _this._fireEvent('streamtracks', streamTracksInfo); if (wasStreamAttached) { _this._serverLog(JSON.stringify({ 'streamTracksInfo': streamTracksInfo })); } }); };  VideoPublisher.prototype._gainChange = function () { this._setGain(parseInt(this.gainRangeEl.value, 10)); };  VideoPublisher.prototype._normalizeGain = function (value) { value = value | 0; if (value < this.MIN_GAIN_VALUE || value > this.MAX_GAIN_VALUE) { return this.DEFAULT_GAIN_VALUE; } else { return value; } };  VideoPublisher.prototype._setGain = function (value) { if (this.virtualCamPreviewMode) { return; } value = this._normalizeGain(value); this.gainValueEl.innerHTML = value + '%'; if (this.preferredAudioGain !== value) { this.preferredAudioGain = value; this._localStorageSetItem('videopublisher_preferred_audio_gain', String(value)); } if (this.audioData && typeof (this.audioData.gainNode) !== 'undefined') { this.audioData.gainNode.gain.value = Math.round((this.preferredAudioGain / 100) * 1e2) / 1e2; } };  VideoPublisher.prototype._setStream = function (stream) { if (this.wsConnectionOnly) { return null; } this.stream = stream; return this.stream; };  VideoPublisher.prototype._replaceStream = function (stream) { if (!this.peerConnection || !stream) { return false; } if (this.canvasPlugin && typeof (this.canvasPlugin._replaceStream) === 'function') { stream = this.canvasPlugin._replaceStream(stream); } var _this = this; stream.getTracks().forEach(function (track) { var sender = _this.peerConnection.getSenders().find(function (s) { return s['track']['kind'] == track['kind']; }); sender.replaceTrack(track); }); return true; };  VideoPublisher.prototype._attachStream = function (stream) { if (!this.peerConnection || !stream) { return false; } if (this.canvasPlugin && typeof (this.canvasPlugin._attachStream) === 'function') { stream = this.canvasPlugin._attachStream(stream);
 } var _this = this; stream.getAudioTracks().forEach(function (track) { _this.peerConnection.addTrack(track, stream); }); stream.getVideorack, stream); }); this._streamAttached = stream; return true; };  VideoPublisher.prototype._detachStream = function (stream) { if (!this.peerConnection || !stream) { return false; } var _this = this; stream.getTracks().forEach(function (track) { _this.peerConnection.removeTrack(_this.peerConnection.gck'] == track; })); }); this._streamAttached = null; return true; };  VideoPublisher.prototype._attachStreamLocally = function (stream) { if (!this.videoEl || !stream) {
 return false; } this.videoEl['srcObject'] = stream; this._setPoster(''); this._streamAttachedLocally = stream; if (this.canvasPlugin && typeof (this.canvasPlugin._attachStreamLocally) === 'function') { var _this = this; this.videoEl.oncanplaythrough = function () { _this.canvasPlugin._attachStreamLocally(stream); _this.videoEl.oncanplaythrough = null; }; } return true; };  VideoPublisher.prototype._detachStreamLocally = function () { if (!this.videoEl) { return false; } if (this.canvasPlugin && typeof (this.canvasPlugin._detachStreamLocally) === 'function') { this.canvasPlugin._detachStreamLocally(); } this.videoEl['srcObject'] = null; this._streamAttachedLocally = null; return true; };  VideoPublisher.prototype._destroyStream = function (stream) { var _this = this;
 return new Promise(function (resolve, reject) { if (!stream) { return resolve(false); } var stopStream = function () { stream.getTracks().forEach(function (track) { track.stop(); }); if (_this.stream !== null && _this.stream == stream) { _this.stream = null; } if (_this.canvasPlugin && typeof (_this.canvasPlugin._destroyStream) === 'function') { _this.canvasPlugin._destroyStream(); } return resolve(true); }; _this._closeAudioContext(stream) .then(stopStream) .catch(stopStream); }); };  VideoPublisher.prototype._initializeStream = function () { var _this = this; return new Promise(function (resolve, reject) { if (_this.wsConnectionOnly) { return resolve(null); } var abortIfDisconnecting = function (stream) { if (_this.disconnecting) { if (stream) { _this._destroyStream(stream); } return reject("disconnect in progress"); } };
 abortIfDisconnecting(null); if (typeof (_this.constraints['video']) === 'object') { if (_this.selectedVideoDeviceId) { _this.constraints['video']['deviceId'] = { 'exact': _this.selectedVideoDeviceId }; } else { delete _this.constraints['video']['deviceId']; } } if (_this.virtualCamPreviewMode) { _this.constraints['audio'] = false; } else { if (typeof (_this.constraints['audio']) === 'object') { if (_this.selectedAudioDeviceId) { _this.constraints['audio']['deviceId'] = { 'exact': _this.selectedAudioDeviceId }; } else { delete _this.constraints['audio']['deviceId']; } } } _this._log("getUserMedia constraints: " + JSON.stringify(_this.constraints)); return nav.mediaDevices.getUserMedia(_this.constraints) .then(function (stream) { abortIfDisconnecting(stream); var videoTracks = stream.getVideoTracks(); if (Array.isArray(videoTracks) && videoTracks.length > 0) { var settings = videoTracks[0]['getSettings'](); if (settings['width'] > 0) { _this.videoWidth = settings['width']; } if (settings['height'] > 0) { _this.videoHeight = settings['height']; } } return text(stream);
 }) .then(function (stream) { abortIfDisconnecting(stream); _this._checkGainSupport(); return stream; }) .then(function (stream) { abortIfDisconnecting(stream); _this._checkAspectRatio(); return solve(stream); }) .catch(_this._handleUserMediaError.bind(_this)); }); };  VideoPublisher.prototype._checkAspectRatio = function () { if (this.disconnecting) { return; } if (this.videoHeight > 0 && this.videoWidth > 0) { var aspectRatio = this.videoWidth / this.videoHeight; if (Math.abs(aspectRatio - this.constraints['video']['aspectRatio']) >= 0.1) { var _this = this; setTimeout(function () { _this._fireEvent('resolutionwarning', 'The camera selected has returned video with the resolution of ' + _this.videoWidth + 'x' + _this.videoHeight + '.<br><br>For optimal video quality, please check your camera or camera application settings and change the output resolution to ' + _this.constraints['video']['width'] + 'x' + _this.constraints['video']['height'] + '.'); }, 1); } } };  VideoPublisher.prototype._closeAudioContext = function (stream) { var _this = this; return new Promise(function (resolve, reject) { if (!_this.audioData || !_this.audioData.audioContext || !stream) { return resolve();
 } if (_this.audioData.connectedStream == stream) { _this.audioData} catch (e) {} }); _this.audioData.audioContext.close() .then(function () { if (_this.audioData.actualAudioTracks) { _this.audioData.actualAudioTracks.forEach(function (track) { track.stop(); }); _this.audioData.actualAudioTracks = void(0); } _this.audioData = {}; return resolve(); }) .catch(function (err) { return resolve(); }); } else { resolve(); } }); };  VideoPublisher.prototype._attachAudioContext = function (stream) { var _this = this; return new Promise(function (resolve, reject) { _this._closeAudioContext(_this.stream ? _this.stream : stream) .then(function () { if (!stream || _this.disconnecting) { return; } var audioTracks = stream.getAudioTracks();
 if (!Array.isArray(audioTracks) || audioTracks.length === 0) { return; } var BrowserAudioContext = win['AudioContext'] || win['webkitAudioContext']; if (typeof (BrowserAudioContext) !== 'function') { _this._log("No AudioContext on this browser, unable to monitor microphone volume level or adjust gain"); return; } _this.audioData = { audioContext: new BrowserAudioContext(), actualAudioTracks: audioTracks, volumes: { instant: 0, slow: 0, slowValues: new Array(10).fill(0) }, onClose: [] }; var mediaStreamSource = _this.audioData.audioContext.createMediaStreamSource(stream);  var latestConnecter = mediaStreamSource;  var audioDestination = mediaStreamSource.context.destination; if (typeof (_this.audioData.audioContext.createMediaStreamDestination) === 'function' && typeof (_this.audioData.audioContext.createGain) === 'function') {  _this.audioData.gainNode = _this.audioData.audioContext.createGain(); var newAudioDestination = _this.audioData.audioContext.createMediaStreamDestination(); var newStream = newAudioDestination.stream; audioDestination = newAudioDestination; latestConnecter.connect(_this.audioData.gainNode); _this.audioData.onClose.unshift(function () { mediaStreamSource.disconnect(_this.audioData.gainNode); }); latestConnecter = _this.audioData.gainNode; latestConnecter.connect(audioDestination); _this.audioData.onClose.unshift(function () { _this.audioData.gainNode.disconnect(audioDestination); });
 _this._setGain(_this.preferredAudioGain); var videoTracks = stream.getVideoTracks(); if (Array.isArray(videoTracks) && videoTracks.length > 0) { newStream.addTrack(videoTracks[0]); } stream = newStream; _this.audioData.connectedStream = stream; } _this.audioData.audioAnalyser = _this.audioData.audioContext.createAnalyser(); _this.audioData.audioAnalyser.fftSize = 2048; latestConnecter.connect(_this.audioData.audioAnalyser); _this.audioData.onClose.unshift(function () { latestConnecter.disconnect(_this.audioData.audioAnalyser); }); if (typeof (_this.audioData.audioContext.createOscillator) === 'function') { _this.audioData.oscillatorGainNode = _this.audioData.audioContext.createGain(); _this.audioData.oscillatorGainNode.gain.value = 0.0001; _this.audioData.oscillatorGainNode.connect(audioDestination); _this.audioData.onClose.unshift(function () { _this.audioData.oscillatorGainNode.disconnect(audioDestination); }); _this.audioData.oscillator = _this.audioData.audioContext.createOscillator(); _this.audioData.oscillator.type = 'sine'; _this.audioData.oscillator.frequency.value = 5; _this.audioData.oscillator.start(); _this.audioData.oscillator.connect(_this.audioData.oscillatorGainNode); _this.audioData.onClose.unshift(function () { _this.audioData.oscillator.stop(); _this.audioData.oscillator.disconnect(_this.audioData.oscillatorGainNode); }); } _this.audioData.scriptProcessor = _this.audioData.audioContext.createScriptProcessor(2048, 1, 1); var audioData = new Uint8Array(_this.audioData.audioAnalyser.frequencyBinCount); _this.audioData.scriptProcessor.onaudioprocess = function (event) { if (!_this.audioData || !_this.audioData.audioAnalyser) { return; } _this.audioData.audioAnalyser.getByteTimeDomainData(audioData); var max = Math.max.apply(Math, audioData); _this.audioData.volumes.instant = Math.abs(Math.floor((1 - max / 128) * 100));
 _this.audioData.volumes.slowValues.shift(); _this.audioData.volumes.slowValues.push(_this.audioData.volumes.instant); _this.audioData.volumes.slow = Math.max.apply(Math, _this.audioData.volumes.slowValues); }; _this.audioDatarocess = null; }); latestConnecter.connect(_this.audioData.scriptProcessor); _this.audioDataiptProcessor); }); _this.audioData.scriptProcessor.connect(audioDestination); _this.audioDataoDestination); }); }) .then(function () { resolve(stream); }); }); };  VideoPublisher.prototype._handleUserMediaError = function (err) { var fireDisconnect = this.previewMode ? false : true; console.error('Unable to get user media:', err.name, err); if (err.name === 'NotAllowedError') { alert(dom.domain + " must have access to your camera and microphone in order to broadcast your video"); fireDisconnect = true; } else if (err.name === 'NotFoundError') { alert("No webcams found, check your webcam is on and working."); } else if (err.name === 'OverconstrainedError') { if (this.c2c) { alert("Your browser or webcam is unable to support required resolution for broadcasting your webcam."); } else { alert("Your browser or webcam is unable to support the selected \"Camera Resolution\" in your \"Options\". Please select a different resolution and try again."); }
 } else if (err.name === 'NotReadableError' || err.name === 'AbortError') { alert("There was a problem trying to access your webcam or microphone. Please make sure it is not in use by another application and try again."); } if (fireDisconnect) { this._disconnect('Unable to get user media: ' + err.name + ': ' + err); } else if (!this._isSettingsWindowDisplayed() && (this.selectedVideoDeviceId || this.selectedAudioDeviceId)) { this.selectedVideoDeviceId = null; this.selectedAudioDeviceId = null; if (this.previewMode) { return this.preview(true); } else { return this.connect(); } } };  VideoPublisher.prototype._renderSelects = function () { if (!this._hasRendered || !this.videoDevices.length) { return false; } this._removeChildren(this.videoSelectEl); this._removeChildren(this.audioSelectEl); var option, i; for (i = 0; i < this.videoDevices.length; i++) { option = document.createElement('option'); option.value = this.videoDevices[i].id; option.text = this.videoDevices[i].label; if (this.selectedVideoDeviceId && this.selectedVideoDeviceId === this.videoDevices[i].id) { option.selected = true; } if (this.videoSelectEl) { this.videoSelectEl.appendChild(option); } else { break; } } for (i = 0; i < this.audioDevices.length; i++) { option = document.createElement('option'); option.value = this.audioDevices[i].id; option.text = this.audioDevices[i].label;
 if (this.selectedAudioDeviceId && this.selectedAudioDeviceId === this.audioDevices[i].id) { option.selected = true; } if (this.audioSelectEl) { this.audioSelectEl.appendChild(option); } else { break; } } };  VideoPublisher.prototype._removeChildren = function (el) { if (el && el.firstChild) { while (el.firstChild) { el.removeChild(el.firstChild); } } };  VideoPublisher.prototype._posterStateToUrl = function (state) { if (this.platform.placards[state]) { return this.imageUrl + '/' + this.platform.placards[state]; } else { return ''; } };  VideoPublisher.prototype._setPoster = function (state) { if (!this.videoEl) { return false; }
 if (state && this.c2c && this.platform.placards['c2c' + state]) { state = 'c2c' + state; } if (!state) { this.videoEl.removeAttribute('poster'); } else if (this.platform.placards[state]) { this.videoEl.setAttribute('poster', this._posterStateToUrl(state)); } if (this.canvasPlugin && typeof (this.canvasPlugin._setPoster) === 'function') { this.canvasPlugin._setPoster(state); } return true; };  VideoPublisher.prototype._renderAndInitializeStream = function () { var _this = this; return this._render() .then(this._setPoster.bind(this, 'loading')) .then(this._initializeStream.bind(this)) .then(function (stream) { _this._setStream(stream); }) .then(this._refreshDevices.bind(this)); };  VideoPublisher.prototype._refreshDevices = function () { var _this = this; var updateStreamIfPreferredFound = false; var previousVideoDeviceId = this.selectedVideoDeviceId; if (this.virtualCamPreviewMode && !this.preferredVideoDeviceLabelFound) { updateStreamIfPreferredFound = true; this.selectedVideoDeviceId = null; } return this._getDevices() .then(function () { if (!_this.disconnecting && updateStreamIfPreferredFound && _this.preferredVideoDeviceLabelFound && previousVideoDeviceId !== _this.selectedVideoDeviceId) {
 _this._updateStream(); } }); };  VideoPublisher.prototype._render = function () { var _this = this; return new Promise(function (resolve, reject) { if (_this._hasRendered) { return resolve(); } if (_this.wsConnectionOnly) { return resolve(); } if (!_this.containerEl) { _this.containerEl = (  (dom.getElementById(_this.container))); } if (!_this.containerEl) { throw "Unable to find container '" + _this.container + "'"; } _this.videoEl = (  (dom.createElement('video'))); _this.videoEl.setAttribute('class', 'videopublisher_video'); _this.videoEl['muted'] = true; _this.videoEl['autoplay'] = true; _this.videoEl.setAttribute('webkit-playsinline', ''); _this.videoEl.setAttribute('playsinline', ''); if (_this.virtualCamPreviewMode) { _this.containerEl.style.width = '100vw'; _this.containerEl.style.height = '100vh'; _this.containerEl.style.zIndex = 'auto'; } _this.videoWidth = _this.containerEl.offsetWidth; _this.videoHeight = _this.containerEl.offsetHeight; _this._removeChildren(_this.containerEl); _this.containerEl.appendChild(_this.videoEl);
 if (_this.canvasPlugin && typeof (_this.canvasPlugin._render) === 'function') { _this.canvasPlugin._render(); } var platClass = 'platform_' + _this.platformId; _this.statusElContainer = (  (dom.createElement('div'))); _this.statusElContainer.setAttribute('class', 'videopublisher_status_container ' + platClass); _this.statusElContainer['innerHTML'] = '<div class="videopublisher_status_message"></div>'; _this.containerEl.appendChild(_this.statusElContainer); _this.settingsElContainer = (  (dom.createElement('div'))); _this.settingsElContainer.setAttribute('class', 'videopublisher_settings_container ' + platClass); if (_this.virtualCamPreviewMode) { _this.settingsElContainer['innerHTML'] = '<div class="videopublisher_settings"><div class="videopublisher_label_row">Camera</div><span class="videopublisher_settings_close videopublisher_settings_close_x">&#10005;</span><div class="videopublisher_setting_row"><select class="videopublisher_select videopublisher_video_select"></select></div></div>'; } else { _this.settingsElContainer['innerHTML'] = '<div class="videopublisher_settings"><table><tbody><tr><td class="videopublisher_label_row">Camera</td></tr><tr><td class="videopublisher_setting_row"><select class="videopublisher_select videopublisher_video_select"></select></td></tr><tr><td class="videopublisher_label_row">Microphone</td></tr><tr><td class="videopublisher_setting_row"><select class="videopublisher_select videopublisher_audio_select"></select></td></tr><tr><td class="videopublisher_setting_row"><div class="videopublisher_flex"><div class="videopublisher_audio_volume_container"><div class="videopublisher_audio_meter_container"><div class="videopublisher_audio_meter"></div></div></div><div class="videopublisher_flex_grow">Record Volume: <span class="videopublisher_gain_value">' + String(_this.DEFAULT_GAIN_VALUE) + '%</span> <div class="videopublisher_gain_container"><div class="videopublisher_gain_background"></div><input class="videopublisher_gain_range" type="range" min="' + String(_this.MIN_GAIN_VALUE) + '" max="' + String(_this.MAX_GAIN_VALUE) + '" step="1" value="' + String(_this.DEFAULT_GAIN_VALUE) + '"></div><div class="videopublisher_no_gain" style="display:none;">Your device does not support adjusting the record volume.</div></div></div></td></tr></tbody><tfoot><tr><td align="right"><button class="videopublisher_settings_close">Close</button></tr></tfoot></table></div>'; } _this.containerEl.appendChild(_this.settingsElContainer); _this.statusMessageEl = (  (_this.containerEl.getElementsByClassName('videopublisher_status_message')[0])); _this.videoSelectEl = (  (_this.settingsElContainer.getElementsByClassName('videopublisher_video_select')[0])); if (!_this.virtualCamPreviewMode) { _this.audioSelectEl = (  (_this.settingsElContainer.getElementsByClassName('videopublisher_audio_select')[0])); _this.gainRangeEl = (  (_this.settingsElContainer.getElementsByClassName('videopublisher_gain_range')[0])); _this.gainValueEl = (  (_this.settingsElContainer.getElementsByClassName('videopublisher_gain_value')[0])); _this.audioVolumeEl = (  (_this.settingsElContainer.getElementsByClassName('videopublisher_audio_meter')[0])); _this.audioMeterContainerEl = (  (_this.settingsElContainer.getElementsByClassName('videopublisher_audio_meter_container')[0])); _this.audioGainContainerEl = (  (_this.settingsElContainer.getElementsByClassName('videopublisher_gain_container')[0])); _this.noGainEl = (  (_this.settingsElContainer.getElementsByClassName('videopublisher_no_gain')[0])); _this.gainRangeEl.value = String(_this.preferredAudioGain); _this._setGain(_this.preferredAudioGain); } _this.settingsCloseEl = (  (_this.settingsElContainer.getElementsByClassName('videopublisher_settings_close')[0])); _this.settingsC return false; }; _this.videoEl return false; }; _this.videoSelectEl.onchange = _this._deviceChange.bind(_this); if (!_this.virtualCamPreviewMode) { _this.audioSelectEl.onchange = _this._deviceChange.bind(_this); _this.gainRangeEl.oninput = _this._gainChange.bind(_this); } _this._hasRendered = true; _this._getDevices().then(resolve); }); };  VideoPublisher.prototype._log = function (msg) { if (typeof (this.logFn) === 'function') this.logFn(msg); };  VideoPublisher.prototype._serverLog = function (msg) {  }; 
 VideoPublisher.prototype._connectingMsg = function () { var _host = this.host.split(/\./)[0]; var msg = ""; if (this._reconnecting) { msg = "Reconnecting to " + _host + "&hellip;"; } else { msg = "Connecting to " + _host + "&hellip;"; } if (typeof (this.connectingMsgExtra) === "string" && this.connectingMsgExtra.length > 0) { msg += this.connectingMsgExtra; } if (this._iceConnectionFailed > 0) { msg += "<div><small>(attempt #" + (1 + this._iceConnectionFailed) + ")</small></div>"; } this._toggleStatusMessage(true, msg, { loading_heart: true }); };  VideoPublisher.prototype._initializeWs = function () { var _this = this; return new Promise(function (resolve, reject) { _this._closeWs(); if (_this.disconnecting) { return reject("disconnect in progress"); } _this._authStatus = _this.AUTH_NEED; var url = 'wss://' + _this.host + '/webrtc-session.json';
 if (_this.serverMode === 1) { if (_this.userId < 1 && _this.roomId > 0) { _this.userId = _this.roomId; while (_this.userId > _this.fcs.CHANNEL_ID_START) _this.userId -= _this.fcs.CHANNEL_ID_START; } _this._setStreamInfo(); if (_this.c2c) { url = 'wss://' + _this.host + '/NxServer/?id=' + _this.PUBLISH_NAME;
 _this.allowedIceCandidateProtocols['UDP'] = true;
 } else { url = 'wss://' + _this.host + '/NxServer/webrtc-session.json?id=' + _this.PUBLISH_NAME;
 } Object.keys(_this.userData || {}).forEach(function (key) { url += '&' + key + '=' + encodeURIComponent(_this.userData[key]); }.bind(_this)); } if (_this._reconnecting) { _this._log("reconnecting to " + url); } else { _this._log("connecting to " + url); } _this._connectingMsg(); _this.wsConnection = new WebSocket(url); _this.wsConnection.binaryType = 'arraybuffer'; _this.wsConnection.onopen = resolve; if (_this.serverMode === 1) { _this.wsConnection.onmessage = _this._wsNewOnMessage.bind(_this); } else { _this.wsConnection.onmessage = _this._wsOnMessage.bind(_this); } _this.wsConnection.onclose = _this._wsOnClose.bind(_this); _this.wsConnection.onerror = _this._wsOnError.bind(_this); }); };  VideoPublisher.prototype._fetchServerType = function () { var _this = this; return new Promise(function (resolve, reject) { if (_this.disconnecting) { return reject("disconnect in progress"); } if (typeof (_this._serverLookupCache[_this.host]) === 'number') { _this.serverMode = _this._serverLookupCache[_this.host]; return resolve(); } var req_object = new XMLHttpRequest();
 req_object.open('GET', 'https://' + _this.host + '/servertype'); req_object.onreadystatechange = function () { if (req_object.readyState === 4) { _this.serverMode = _this._serverLookupCache[_this.host] = parseInt(req_object.responseText, 10) | 0; if (_this.disconnecting) { return reject("disconnect in progress"); } return resolve(); } }; req_object.send(); }); };  VideoPublisher.prototype._authenticateWs = function () { var _this = this; return new Promise(function (resolve, reject) { if (_this.disableAuth || _this.serverMode === 1) { _this._log("Auth disabled, skipping..."); return resolve(); } _this._onAuthenticateResponse = function (result) { _this._onAuthenticateResponse = null; if (result['status'] === 200 && result['value'] && result['value']['userID'] > 0) { _this.userId = result['value']['userID'] | 0; _this._authStatus = _this.AUTH_GOOD; if (result['value']['wowzaSessionId'] > 0) { _this.wowzaSessionId = result['value']['wowzaSessionId'] | 0; _this._log("Wowza Session ID: " + _this.wowzaSessionId); } return resolve(); } else { _this._log("Invalid Auth - response: " + JSON.stringify(result)); _this._authStatus = _this.AUTH_BAD; return reject("Invalid auth"); } };
 var auth = { 'command': 'auth' }; if (!_this.wsConnectionOnly) { var streamTracksInfo = _this._getStreamTracksInfo(); _this._fireEvent('streamtracks', streamTracksInfo); auth['streamInfo'] = _this.streamInfo; auth['streamTracksInfo'] = streamTracksInfo; } if (!_this.disableAuth) { auth['userData'] = _this.userData; } _this._wsSend(JSON.stringify(auth)); _this._authStatus = _this.AUTH_SENT; }); };  VideoPublisher.prototype._initializePeer = function () { var _this = this; return new Promise(function (resolve, reject) { if (!_this._isWsOpen()) { return resolve(false); } if (_this.wsConnectionOnly) { return resolve(null); } if (_this.disconnecting) { return reject("disconnect in progress"); } _this._setPoster('loading'); _this._connectingMsg(); _this._closePeer(); _this.peerConnection = new RTCPeerConnection({ 'iceServers': []
 }, { 'optional': [{ 'googCpuOveruseDetection': false }] }); _this.peerConnection.oniceconnectionstatechange = _this._peerOnIceConnectionStateChange.bind(_this); _this._attachStream(_this.stream); return _this.peerConnection.createOffer() .then(_this._peerGotLocalDescription.bind(_this)) .then(_this._sendPublishCommand.bind(_this)) .then(resolve) .catch(function (err) { return reject(err); }); }); };  VideoPublisher.prototype._sendPublishCommand = function () { if (this._published || this.disconnecting) { return false; } if (this.wsConnectionOnly) { return false; } this._setStreamInfo(); this._publishAttempts++; var publishCmd = { 'direction': 'publish', 'command': 'sendOffer', 'streamInfo': this.streamInfo, 'sdp': this.peerDescription }; if (!this.disableAuth) { publishCmd['userData'] = this.userData; } if (this.serverMode === 1) { publishCmd = {
 "isAvailable": this.PUBLISH_NAME, "bundle": true }; } this._wsSend(JSON.stringify(publishCmd)); return true; };  VideoPublisher.prototype._fireMicVolumeEvent = function () { if (!this.audioData || !this.audioData.volumes) { return; } var level = (this.micVolumeTimerLen >= 500) ? this.audioData.volumes.slow : this.audioData.volumes.instant; this._fireEvent('miclevel', level); };  VideoPublisher.prototype._getStreamTracksInfo = function () { var tracks = {}; if (this.stream) { var _this = this; this.stream.getTracks().forEach(function (track) { var kind = track['kind']; tracks[kind] = { 'track': {}, 'settings': {}, 'constraints': {}, 'capabilities': {} }; if (kind === 'audio') { if (_this.audioData.actualAudioTracks && _this.audioData.gainNode) { track = _this.audioData.actualAudioTracks[0]; tracks[kind]['gain_supported'] = true; } else { tracks[kind]['gain_supported'] = false;
 } } for (var prop in track) { var type = typeof (track[prop]); if (type.match(/^(?:boolean|string|number|object)$/) && track[prop] != null && prop !== 'kind') { tracks[kind]['track'][prop] = track[prop]; } } if (typeof (track['getSettings']) === 'function') { tracks[kind]['settings'] = track['getSettings'](); } if (typeof (track['getConstraints']) === 'function') { tracks[kind]['constraints'] = track['getConstraints'](); } if (typeof (track['getCapabilities']) === 'function') { tracks[kind]['capabilities'] = track['getCapabilities'](); } }); } return tracks; };  VideoPublisher.prototype._collectStats = function (reset) { if (!this.peerConnection) { return; } var _this = this; if (reset) { this.stats = {}; this.stats.bw = { samples: []
 }; this.stats.fps = { samples: [] }; } var statsToFire = { 'kbps': undefined, 'target_kbps': undefined, 'current_round_trip_time': undefined, 'average_round_trip_time': undefined, 'fps': undefined, 'video_width': undefined, 'video_height': undefined }; var fireFn = function () { if (!reset) { if (typeof (statsToFire['kbps']) === 'number' && !isNaN(statsToFire['kbps'])) { _this._fireEvent('stats', statsToFire); } } }; if (!this.peerConnection.getStats) { fireFn(); return; } / arr.length; }; var maxSampleLen = 3; this.peerConnection.getStats() .then(function (result) {  var results = [];
 result.forEach(function (report) { results.push(report); }); var bwStatsReportState = ''; var bwStatsReport = results.find(function (report) { return ( report['type'] === 'candidate-pair' && report['nominated'] && report['writable'] && !report['isRemote'] ); }); if (bwStatsReport) { bwStatsReportState = bwStatsReport['state']; } else { bwStatsReport = results.find(function (report) { return ( report['type'] === 'outbound-rtp' && report['mediaType'] === 'video' && !report['isRemote'] ); }); if (bwStatsReport) { bwStatsReportState = 'succeeded'; } } if (typeof (bwStatsReportState) !== 'string') { bwStatsReportState = ''; } if (bwStatsReport && bwStatsReportState.match(/^(?:waiting|in-progress|succeeded)$/i)) { if (_this.stats.bw.currentTs) { _this.stats.bw.lastTs = _this.stats.bw.currentTs; _this.stats.bw.lastBytesSent = _this.stats.bw.currentBytesSent; } _this.stats.bw.currentTs = bwStatsReport['timestamp']; _this.stats.bw.currentBytesSent = bwStatsReport['bytesSent']; var tsDiff = _this.stats.bw.currentTs - _this.stats.bw.lastTs; if (tsDiff > 0) {
 _this.stats.bw.currentBitrate = 8 * (_this.stats.bw.currentBytesSent - _this.stats.bw.lastBytesSent) / tsDiff; _this.stats.bw.currentBitrate = Math.round(_this.stats.bw.currentBitrate); _this.stats.bw.samples.push(_this.stats.bw.currentBitrate); if (_this.stats.bw.samples.length > maxSampleLen) { _this.stats.bw.samples.shift(); } statsToFire['kbps'] = Math.round(averageFn(_this.stats.bw.samples)); } if (bwStatsReport['availableOutgoingBitrate']) { statsToFire['target_kbps'] = bwStatsReport['availableOutgoingBitrate'] / 1e3; } if (bwStatsReport['totalRoundTripTime'] && bwStatsReport['responsesReceived']) { statsToFire['average_round_trip_time'] = (bwStatsReport['totalRoundTripTime'] / bwStatsReport['responsesReceived']); statsToFire['average_round_trip_time'] = Math.round(statsToFire['average_round_trip_time'] * 1e3) / 1e3; } if (bwStatsReport['currentRoundTripTime']) { statsToFire['current_round_trip_time'] = bwStatsReport['currentRoundTripTime']; } } var fpsReport = results.find(function (report) { return ( report['type'] === 'outbound-rtp' && report['mediaType'] === 'video' ); }); if (fpsReport) { var fieldToUse; if (fpsReport['framesEncoded']) { fieldToUse = 'framesEncoded'; } else if (fpsReport['framerateMean']) { fieldToUse = 'framerateMean'; } if (fieldToUse) { if (_this.stats.fps.currentTs) { _this.stats.fps.lastTs = _this.stats.fps.currentTs; if (fieldToUse === 'framerateMean') { _this.stats.fps.lastFramesEncoded = 0; } else {
 _this.stats.fps.lastFramesEncoded = _this.stats.fps.currentFramesEncoded; } } _this.stats.fps.currentTs = fpsReport['timestamp']; _this.stats.fps.currentFramesEncoded = fpsReport[fieldToUse]; var fpsTsDiff = _this.stats.fps.currentTs - _this.stats.fps.lastTs; if (fpsTsDiff > 0) { _this.stats.fps.currentFps = 1e3 * (_this.stats.fps.currentFramesEncoded - _this.stats.fps.lastFramesEncoded) / fpsTsDiff; _this.stats.fps.currentFps = Math.round(_this.stats.fps.currentFps * 1e2) / 1e2; _this.stats.fps.samples.push(_this.stats.fps.currentFps); if (_this.stats.fps.samples.length > maxSampleLen) { _this.stats.fps.samples.shift(); } statsToFire['fps'] = Math.round(averageFn(_this.stats.fps.samples) * 1e2) / 1e2; } } } var vidSizeRepor=== 'video' ); }); if (vidSizeReport) { if (vidSizeReport['frameWidth']) { statsToFire['video_width'] = vidSizeReport['frameWidth']; } if (vidSizeReport['frameHeight']) { statsToFire['video_height'] = vidSizeReport['frameHeight']; } } }) .then(fireFn); };  VideoPublisher.prototype._startStatsTimers = function () { this._stopStatsTimers(); this.statsTimers.vidStats = win.setInterval(this._collectStats.bind(this), 1000); this.statsTimers.micVolume = win.setInterval(this._fireMicVolumeEvent.bind(this), this.micVolumeTimerLen); };  VideoPublisher.prototype._stopStatsTimers = function () { for (var timer in this.statsTimers) { if (this.statsTimers[timer] > 0) { win.clearInterval(this.statsTimers[timer]); this.statsTimers[timer] = 0; } } };  VideoPublisher.protobSocket.OPEN); };  VideoPublisher.prototype._wsSend = function (msg) { if (!this._isWsOpen()) { return false; } this._log("ws send:" + (typeof (msg) === 'object' ? JSON.stringify(msg) : msg)); return this.wsConnection.send(msg); };  VideoPublisher.prototype._closeWs = function () {
 if (this._publishTimer > 0) { win.clearTimeout(this._publishTimer); this._publishTimer = 0; } if (this.wsConnection) { this._stopWsPing(); this.wsConnection.onopen = noOp; this.wsConnection.onmessage = noOp; this.wsConnection.onclose = noOp; this.wsConnection.onerror = noOp; this.wsConnection.close(); this.wsConnection = null; this._defaultRoom(); } return true; };  VideoPublisher.prototype._stopWsPing = function () { if (this.wsPingInterval > 0) { win.clearInterval(this.wsPingInterval); this.wsPingInterval = 0; } };  VideoPublisher.prototype._closePeer = function () { if (this.peerConnection) { this.peerConnection.oniceconnectionstatechange = noOp; this.peerConnection.close(); this.peerConnection = null; } if (this._peerReconnectTimer > 0) { win.clearTimeout(this._peerReconnectTimer); this._peerReconnectTimer = 0; } this._stopStatsTimers();
 this._published = false; return true; };  VideoPublisher.prototype._wsNewOnMessage = function (e) { this._log('_wsNewOnMessage:' + e.data); var _this = this; var reconnectFn = function () { _this._reconnectAttempts++; if (_this._reconnectAttempts < 10 && !_this.disconnecting) { _this._reconnect({ force: true, statusMsg: "Stream already in use, reconnecting in a couple seconds&hellip;" }); } else { _this.disconnect(); } }; var msg = JSON.parse(e.data); if (msg['message']) { if (msg['message'] === 'STREAM_ALREADY_PUBLISHED') { reconnectFn(); } } else if (msg['data']) { if (msg['data']['type'] === 'error' && msg['data']['message'] === 'Offer rejected, stream already configured') { reconnectFn(); } else if (msg['data']['type'] === 'status') { if (msg['data']['code'] === 'NetConnection.Connect.Success') { } else if (msg['data']['code'] === 'NetStream.Publish.IsAvailable') { this._reconnectAttempts = 0;
 } else if (msg['data']['code'] === 'NetConnection.ICE.TrickleCompleted') { this._wsSend(JSON.stringify({ "publish": this.PUBLISH_NAME, "mode": "live", "keyFramerate": 1000 })); this.wsPingInterval = win.setInterval(() => { this._wsSend(JSON.stringify({ 'ping': true })); }, 10000); return; } } else if (typeof msg['isAvailable'] === 'boolean') { var desc = this.peerDescription; if (videoChoice === 'VP8') { desc.sdp = desc.sdp.replace(/H264/g, 'H265'); } if (msg['isAvailable'] === false) { this._wsSend(JSON.stringify({ "handleOffer": this.PUBLISH_NAME, "transport": this.c2c ? 'udp' : undefined, "datachannel": false, "keyFramerate": 1000, "data": { "sdp": desc } })); } } else if (msg['data']['sdp'] !== undefined && msg['data']['sdp']['type'] === 'answer') { this.remoteDescriptionRaw = msg['data']['sdp']; this._log("received sdp"); this.peerConnection.setRemoteDescription(new RTCSessionDescription(this.remoteDescriptionRaw)) .catch(this._peerError.bind(this)); } else if (msg['data']['type'] === 'candidate') { var iceCandidate = msg['data']['candidate']; if (typeof (iceCandidate['candidate']) === 'string') { if (iceCandidate['candidate'].length) { var connectionInfo; connectionInfo = iceCandidate['candidate'].match(/\s(TCP|UDP)\s\S+\s((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)[.]){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\s(\d+)\s/i); if (connectionInfo) { var proto = connectionInfo[1].toUpperCase(); var ip = connectionInfo[2];
 var port = parseInt(connectionInfo[3], 10); var conn = this._fireEvent('iceCandidateReceived', { proto: proto, ip: ip, port: port }); if (typeof (conn) === 'object' && conn !== null && typeof (conn.ip) === 'string' && typeof (conn.port) === 'number' && (conn.ip !== ip || conn.port !== port)) { this._log('Modifying ' + proto + ' iceCandidate - old: ' + ip + ':' + port + ' new: ' + conn.ip + ':' + conn.port); iceCandidate['candidate'] = iceCandidate['candidate'].replace(new RegExp('\\s' + ip.replace(/\./g, '\\.') + '\\s' + port), ' ' + conn.ip + ' ' + conn.port); } if (typeof (this.allowedIceCandidateProtocols[proto]) === 'boolean' && this.allowedIceCandidateProtocols[proto] === true) { this._log('Adding iceCandidate: ' + JSON.stringify(iceCandidate)); this.peerConnection.addIceCandidate(new RTCIceCandidate(iceCandidate)); } else { this._log('Ignoring iceCandidate: ' + JSON.stringify(iceCandidate)); } } else { this._log('Unable to determine protocol from iceCandidate: ' + JSON.stringify(iceCandidate)); } } else { this.peerConnection.addIceCandidate(null); this._wsSend(JSON.stringify({ "handleCandidate": this.PUBLISH_NAME, "data": { "candidate": { "type": "candidate", "candidate": "" } } })); } } else { this._log('Unknown iceCandidate packet: ' + iceCandidate); } } } else if (msg['isAvailable'] === true) { reconnectFn(); } };  VideoPublisher.prototype._wsOnMessage = function (e) { this._log('_wsOnMessage:' + e.data); var msg = JSON.parse(e.data); if (typeof (msg) !== 'object' || msg == null) { this._log('WARNING: _wsOnMessage did not receive a valid JSON string'); return; } var msgStatus = msg['status'] | 0; var msgCmd = msg['command']; if (msgStatus === 200 && msg['statusDescription'] === 'OK' && typeof (msg['message']) === 'string' && Object.keys(msg || {}).length === 3) { return; } if (msgCmd === 'jspassthrough' || msgCmd === 'message') { this._fireEvent(msgCmd, msg['value']); return; } if (this._authStatus === this.AUTH_SENT) { if (msgCmd === 'auth') { if (typeof (this._onAuthenticateResponse) !== 'function') { throw 'no handler for auth response: ' + e.data; } return this._onAuthenticateResponse(msg); } throw 'invalid auth response received: ' + e.data; } if (msgStatus === 503 && this._publishAttempts < 20) { var retryLength = (350 * (1 + (this._publishAttempts / 10))) | 0; this._log('Received a 503 ("' + msg['statusDescription'] + '") after publish attempt ' + this._publishAttempts + ', trying again in ' + retryLength + 'ms'); this._publishTimer = win.setTimeout(this._sendPublishCommand.bind(this), retryLength); } else if (msgStatus === 200) { if (msg['direction'] === 'publish') { this._published = true; this._publishAttempts = 0; if (msg['streamInfo'] && typeof (msg['streamInfo']['sessionId']) !== 'undefined') {
 this.streamInfo.sessionId = msg['streamInfo']['sessionId']; } } if (msg['sdp'] !== undefined) { this.remoteDescriptionRaw = msg['sdp']; this._log("received sdp"); this.peerConnection.setRemoteDescription(new RTCSessionDescription(this.remoteDescriptionRaw)) .catch(this._peerError.bind(this)); } if (msg['iceCandidates'] !== undefined) { for (var index in msg['iceCandidates']) { var iceCandidate = msg['iceCandidates'][index]; if (typeof (iceCandidate['candidate']) === 'string') { var connectionInfo = iceCandidate['candidate'].match(/\s(TCP|UDP)\s\S+\s((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)[.]){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\s(\d+)\s/); if (connectionInfo) { var proto = connectionInfo[1]; var ip = connectionInfo[2]; var port = parseInt(connectionInfo[3], 10); var conn = this._fireEvent('iceCandidateReceived', { proto: proto, ip: ip, port: port }); if (typeof (conn) === 'object' && conn !== null && typeof (conn.ip) === 'string' && typeof (conn.port) === 'number' && (conn.ip !== ip || conn.port !== port)) { this._log('Modifying ' + proto + ' iceCandidate - old: ' + ip + ':' + port + ' new: ' + conn.ip + ':' + conn.port); iceCandidate['candidate'] = iceCandidate['candidate'].replace(new RegExp('\\s' + ip.replace(/\./g, '\\.') + '\\s' + port), ' ' + conn.ip + ' ' + conn.port); } if (typeof (this.allowedIceCandidateProtocols[proto]) === 'boolean' && this.allowedIceCandidateProtocols[proto] === true) { this._log('Adding iceCandidate: ' + JSON.stringify(iceCandidate)); this.peerConnection.addIceCandidate(new RTCIceCandidate(iceCandidate)); } else { this._log('Ignoring iceCandidate: ' + JSON.stringify(iceCandidate)); } } else { this._log('Unable to determine protocol from iceCandidate: ' + JSON.stringify(iceCandidate)); } } else { this._log('Unknown iceCandidate packet: ' + iceCandidate); }
 } this.peerConnection.addIceCandidate(null); } } else { this._log("Disconnecting: Received a " + msgStatus + " with statusDescription: " + msg['statusDescription']); this._disconnect(msg['statusDescription']); } };  VideoPublisher.prototype._wsOnClose = function () { console.error('WS closed unexpectedly'); this._stopWsPing(); this._reconnect(); };  VideoPublisher.prototype._wsOnError = function (e) { console.error('WS ERROR:', e); this._stopWsPing(); this._disconnect('WS error: ' + e.toString()); };  VideoPublisher.prototype._peerGotLocalDescription = function (description) { this.peerDescription = description; var forceCodec = win.location.search.match(/vpcodec=(\w+)/); if (forceCodec) { videoChoice = forceCodec[1]; console.log("VideoPublisher: Forcing videoChoice to codec " + videoChoice); } else { var preferredChoice; this.videoCodecPreferences.forEach(function (codec) {
 if (preferredChoice === undefined) { if (codec.supported === undefined) { codec.supported = codec.regexp.test(this.peerDescription.sdp); } if (codec.supported === true) { preferredChoice = codec.videoChoice; } } }.bind(this)); if (preferredChoice === undefined) { throw new Error("Browser does not support any of the required codecs"); } else { videoChoice = preferredChoice; console.log("VideoPublisher: Setting videoChoice to codec " + videoChoice); } } this.peerDescription.sdp = enhanceSDP(this.serverMode, this.peerDescription.sdp, { audioBitrate: this.audioBitrate, videoBitrate: this.videoBitrate, videoFrameRate: this.videoFrameRate, videoWidth: this.videoWidth, videoHeight: this.videoHeight }); return this.peerConnection.setLocalDescription(this.peerDescription); };  VideoPublisher.prototype._peerOnIceConnectionStateChange = function () { if (!this.peerConnection) { return; } if (this.peerConnection.iceConnectionState === 'connected') { this._toggleStatusMessage(false, '', {}); this._iceConnectionFailed = 0; this._log("ice connected! attaching stream locally"); this._attachStreamLocally(this.stream); if (this._isPrivate()) { this._setState(this.fcs.FCVIDEO_TX_PVT); } else if (this._isGroup()) { this._setState(this.fcs.FCVIDEO_TX_GRP); } else if (this._isClub()) { this._setState(this.fcs.FCVIDEO_TX_CLUB);
 } else { this._setState(this.fcs.FCVIDEO_TX_IDLE); } if (this.c2c) { this._c2cStartBroadcast(); } this._collectStats(true); this._startStatsTimers(); this._reconnecting = false; } else if (this.peerConnection.iceConnectionState === 'disconnected') { console.error('Disconnected from video server'); this._reconnect(); } else if (this.peerConnection.iceConnectionState === 'failed') { this._iceConnectionFailed++; if (this._iceConnectionFailed > 4) { this._disconnect('Unable to connect to the video server'); return; } else { if (this._iceConnectionFailed === 1) { for (var proto in this.allowedIceCandidateProtocols) { if (this.allowedIceCandidateProtocols.hasOwnProperty(proto) && typeof (this.allowedIceCandidateProtocols[proto]) === 'boolean') { this.allowedIceCandidateProtocols[proto] = true; } } } var retryLength = (350 * (1 + (this._iceConnectionFailed / 10))) | 0; console.log("Unable to connect, retry #" + this._iceConnectionFailed + " in " + retryLength + "ms"); console.log(this.peerConnection); this._peerReconnectTimer = win.setTimeout(this._initializePeer.bind(this), retryLength); } } else { } };  VideoPublisher.prototype._peerError = function (e) { console.error('Peer ERROR:', e); this._disconnect('Peer ERROR: ' + e.toString());
 };  VideoPublisher.prototype._publicRoomId = function () { if (this.platformId == this.fcs.PLATFORM_CAMYOU) { return this.userId + this.fcs.CAMCHAN_ID_START; } else { return this.userId + this.fcs.CHANNEL_ID_START; } };  VideoPublisher._browserInfo = function () { if (typeof (win['adapter']) === 'object' && typeof (win['adapter'].browserDetails) === 'object' && typeof (win['adapter'].browserDetails.browser) === 'string') { return win['adapter'].browserDetails; } else { return { 'browser': '', 'version': 0 }; } };  VideoPublisher.prototype._applicationName = function () { if (this.c2c) { return this.platform.c2cApplicationName; } else { return this.platform.applicationName; } }; 
 VideoPublisher.prototype._roomPrefix = function () { if (this.c2c) { return this.platform.c2cRoomPrefix; } else { return this.platform.roomPrefix; } };  VideoPublisher.prototype._zeroPad = function (n, width) { n = n + ''; return n.length >= width ? n : new Array(width - n.length + 1).join('0') + n; }; VideoPublisher.prototype.PLATFORM = { 'p1': { hasPrivate: true, hasGroup: true, hasClub: true, roomPrefix: 'mfc_', c2cRoomPrefix: 'uvm_', applicationName: 'NxServer', c2cApplicationName: 'NxServer', placards: { 'loading': 'files/images/svg/video_notice_loading_webcam.svg', 'away': 'files/images/svg/video_notice_away.svg', 'offline': 'files/images/svg/video_notice_problems.svg', 'c2coffline': 'files/images/svg/video_notice_webcam_off.svg' } }, 'p2': { hasPrivate: false, hasGroup: false, hasClub: false, roomPrefix: 'cam_', c2cRoomPrefix: 'uvc_', applicationName: 'NxServer', c2cApplicationName: 'NxServer', placards: { 'loading': 'files/images/svg/cam/video_notice_loading_webcam.svg', 'away': 'files/images/svg/cam/video_notice_away.svg', 'offline': 'files/images/svg/cam/video_notice_problems.svg', 'c2coffline': 'files/images/svg/cam/video_notice_webcam_off.svg' }
 } };  function newEnhanceSDP(sdpStr, enhanceData) { var lineEnding = "\r\n", mediaNameEnd, sdpBeforeMedia, sdpAfterMedia; var frameSize = ''; var frameRate = ''; if (enhanceData.videoWidth !== undefined && enhanceData.videoHeight !== undefined) { frameSize = "a=framesize:" + enhanceData.videoWidth + "-" + enhanceData.videoHeight + lineEnding; } if (enhanceData.videoFrameRate !== undefined) { frameRate = "a=framerate:" + enhanceData.videoFrameRate + lineEnding; } var audioIndex = sdpStr.indexOf("m=audio"); if (audioIndex > -1) { mediaNameEnd = sdpStr.indexOf(lineEnding, audioIndex); sdpBeforeMedia = sdpStr.slice(0, mediaNameEnd); sdpAfterMedia = sdpStr.slice(mediaNameEnd + lineEnding.length, sdpStr.length); sdpStr = [sdpBeforeMedia, "b=AS:" + enhanceData.audioBitrate, sdpAfterMedia].join(lineEnding); } var videoIndex = sdpStr.indexOf("m=video"); if (videoIndex > -1) { mediaNameEnd = sdpStr.indexOf(lineEnding, videoIndex); sdpBeforeMedia = sdpStr.slice(0, mediaNameEnd); sdpAfterMedia = frameSize + frameRate + sdpStr.slice(mediaNameEnd + lineEnding.length, sdpStr.length); sdpStr = [sdpBeforeMedia, "b=AS:" + enhanceData.videoBitrate, sdpAfterMedia].join(lineEnding); } if (audioIndex === -1 && videoIndex === -1) { sdpStr = sdpStr.replace(/b=AS([^\r\n]+\r\n)/g, ""); sdpStr = sdpStr.replace(/a=mid:audio\r\n/g, "a=mid:audio\r\nb=AS:" + enhanceData.audioBitrate + lineEnding); sdpStr = sdpStr.replace(/a=mid:video\r\n/g, "a=mid:video\r\nb=AS:" + enhanceData.videoBitrate + lineEnding + frameSize + frameRate); } return sdpStr; }  var SDPOutput = {}; var videoChoice = '42e01f'; var audioChoice = 'opus'; var audioIndex = -1; var videoIndex = -1; var audioMLines; function addAudio(sdpStr, audioLine) { var sdpLines = sdpStr.split(/\r\n/); var sdpSection = 'header'; var hitMID = false; var sdpStrRet = ''; var done = false; for (var sdpIndex in sdpLines) { var sdpLine = sdpLines[sdpIndex]; if (sdpLine.length <= 0) continue; sdpStrRet += sdpLine; sdpStrRet += '\r\n'; if ('a=rtcp-mux'.localeCompare(sdpLine) == 0 && done == false) { sdpStrRet += audioLine; done = true; } } return sdpStrRet; } function addVideo(sdpStr, videoLine) { var sdpLines = sdpStr.split(/\r\n/); var sdpSection = 'header'; var hitMID = false; var sdpStrRet = ''; var done = false; var rtcpSize = false; var rtcpMux = false; var sdpIndex; var sdpLine; for (sdpIndex in sdpLines) { sdpLine = sdpLines[sdpIndex];
 if (sdpLine.length <= 0) continue; if (sdpLine.includes("a=rtcp-rsize")) { rtcpSize = true; } if (sdpLine.includes("a=rtcp-mux")) { rtcpMux = true; } } for (sdpIndex in sdpLines) { sdpLine = sdpLines[sdpIndex]; sdpStrRet += sdpLine; sdpStrRet += '\r\n'; if (('a=rtcp-rsize'.localeCompare(sdpLine) == 0) && done == false && rtcpSize == true) { sdpStrRet += videoLine; done = true; } if ('a=rtcp-mux'.localeCompare(sdpLine) == 0 && done == true && rtcpSize == false) { sdpStrRet += videoLine; done = true; } if ('a=rtcp-mux'.localeCompare(sdpLine) == 0 && done == false && rtcpSize == false) { done = true; } } return sdpStrRet; } function enhanceSDP(serverMode, sdpStr, enhanceData) { if (serverMode === 1) { return newEnhanceSDP(sdpStr, enhanceData); } SDPOutput = {}; var sdpLines = sdpStr.split(/\r\n/); var sdpSection = 'header'; var hitMID = false; var sdpStrRet = ''; var sdpIndex; var sdpLine;
 for (sdpIndex in sdpLines) { sdpLine = sdpLines[sdpIndex]; if (sdpLine.length <= 0) continue; var doneCheck = checkLine(sdpLine); if (!doneCheck) continue; sdpStrRet += sdpLine; sdpStrRet += '\r\n'; } sdpStrRet = addAudio(sdpStrRet, deliverCheckLine(audioChoice, "audio")); sdpStrRet = addVideo(sdpStrRet, deliverCheckLine(videoChoice, "video")); sdpStr = sdpStrRet; sdpLines = sdpStr.split(/\r\n/); sdpStrRet = ''; var audioReady = false; var videoReady = false; for (sdpIndex in sdpLines) { sdpLine = sdpLines[sdpIndex]; if (sdpLine.length <= 0) continue; if (sdpLine.indexOf("a=extmap:3") == 0) { continue; } if (sdpLine.indexOf("m=audio") == 0 && audioIndex != -1) { audioMLines = sdpLine.split(" "); sdpStrRet += audioMLines[0] + " " + audioMLines[1] + " " + audioMLines[2] + " " + audioIndex + "\r\n"; audioReady = true; if (serverMode === 1) { sdpStrRet += 'b=AS:' + (enhanceData.audioBitrate); sdpStrRet += "\r\n"; } continue; } if (sdpLine.indexOf("m=video") == 0 && videoIndex != -1) { audioMLines = sdpLine.split(" "); sdpStrRet += audioMLines[0] + " " + audioMLines[1] + " " + audioMLines[2] + " " + videoIndex + " 109\r\n"; videoReady = true;
 if (serverMode === 1) { sdpStrRet += "b=AS:" + (enhanceData.videoBitrate); sdpStrRet += "\r\n"; } continue; } if (sdpLine.indexOf("c=IN") == 0 && audioReady == true && serverMode === 0) { if (enhanceData.audioBitrate !== undefined) { sdpStrRet += sdpLine; sdpStrRet += '\r\nb=CT:' + (enhanceData.audioBitrate); sdpStrRet += '\r\nb=AS:' + (enhanceData.audioBitrate); sdpStrRet += '\r\nb=TIAS:' + (enhanceData.audioBitrate * 1000); sdpStrRet += "\r\n"; } audioReady = false; continue; } if (sdpLine.indexOf("c=IN") == 0 && videoReady == true && serverMode === 0) { if (enhanceData.videoBitrate !== undefined) { sdpStrRet += sdpLine; sdpStrRet += "\r\nb=CT:" + (enhanceData.videoBitrate); sdpStrRet += "\r\nb=AS:" + (enhanceData.videoBitrate); sdpStrRet += "\r\nb=TIAS:" + (enhanceData.videoBitrate * 1000); if (enhanceData.videoWidth !== undefined && enhanceData.videoHeight !== undefined) { sdpStrRet += "\r\na=framesize:" + enhanceData.videoWidth + "-" + enhanceData.videoHeight; } if (enhanceData.videoFrameRate !== undefined) { sdpStrRet += "\r\na=framerate:" + enhanceData.videoFrameRate; } sdpStrRet += "\r\n"; } videoReady = false; continue; } if (sdpLine.includes("a=fmtp:108 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42e01f")) { sdpStrRet += "a=fmtp:108 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\r\n"; sdpStrRet += "a=rtpmap:109 rtx/90000\r\na=fmtp:109 apt=108\r\n"; continue; } sdpStrRet += sdpLine; sdpStrRet += "\r\n"; } return sdpStrRet; }
 function deliverCheckLine(profile, type) { var outputString = ""; for (var line in SDPOutput) { var lineInUse = SDPOutput[line]; outputString += line; if (lineInUse.includes(profile)) { if (profile.includes("VP9") || profile.includes("VP8") || profile.includes("42e01f") || profile.includes("opus")) { var output = ""; var outputs = lineInUse.split(/\r\n/); for (var position in outputs) { var transport = outputs[position]; if (transport.indexOf("transport-cc") !== -1 || transport.indexOf("nack") !== -1) { continue; } output += transport; output += "\r\n"; } if (type.includes("audio")) { audioIndex = line; } if (type.includes("video")) { videoIndex = line; } return output; } if (type.includes("audio")) { audioIndex = line; } if (type.includes("video")) { videoIndex = line; } return lineInUse; } } return outputString; } function checkLine(line) { if (line.startsWith("a=rtpmap") || line.startsWith("a=rtcp-fb") || line.startsWith("a=fmtp")) { var res = line.split(":");
 if (res.length > 1) { var number = res[1].split(" "); if (!isNaN(number[0])) { if (!number[1].startsWith("http") && !number[1].startsWith("ur")) { var currentString = SDPOutput[number[0]]; if (!currentString) { currentString = ""; } currentString += line + "\r\n"; SDPOutput[number[0]] = currentString; return false; } } } } return true; } function getrtpMapID(line) { var findid = new RegExp('a=rtpmap:(\\d+) (\\w+)/(\\d+)'); var found = line.match(findid); return (found && found.length >= 3) ? found : null; } return VideoPublisher;})(window, window.navigator, document);

// js_build_core: MfcJs/MfcClientVideo/MfcClientVideo.js
function MfcClientVideo(options ){ options = options || {}; MfcClientVideo.instanceCounter++; this.instance = MfcClientVideo.instanceCounter; this.clientRes = new MfcClientRes();
 this.slowC2CRollout = function() { return true; }; var self=this; var defaults = { id: (Math.random()), mfc_user_agent: {}, platform: {}, video_map: {}, server_config: {}, player_type_override: '', player_type_override_JSTech: '', player_type_override_JSTech_override: '', bH5video_mobileOptIn: false, bDisableHlsAbr: false, private_session_id: 0, group_session_id: 0, club_session_id: 0, ckxauth: 'ctr-def', presentation_state: 0, bC2CWebrtcMode: true, videoPublisher_profile: { audioBitrate: 96, videoBitrate: 500, videoFrameRate: 30, constraints: { 'video': { 'aspectRatio': 16/9, 'width': 640, 'height':360, }, 'audio': { 'echoCancellation': false, 'channelCount': 2 } } }, fGetVersion_PLAYSTATION: function() { return g_UA.PLAYSTATION; }, fLog: null,//function(msg) { console.log(msg); },

 fIVIDEO_RX_IDLE; }, hfClientUser: { passcode: function() { return self.client_user.passcode || document.cookie.match(/passcode=([^;]+)/) && RegExp.$1; }, session_id: function() { return self.client_user && self.client_user.sessionid; }, user_id: function() { return self.client_user && self.client_user.user_id; }, }, hfBroadcaster: { platform_id: function() { return self.broadcaster && self.broadcaster.platform_id; }, user_id: function() { return self.broadcaster && self.broadcaster.user_id; }, username: function() { return self.broadcaster && self.broadcaster.username; }, access_level: function() { return self.broadcaster && self.broadcaster.access_level; }, state: function() { return self.broadcaster && self.broadcaster.state; }, hdvideo: function() { return self.broadcaster && self.broadcaster.hdvideo; }, webrtc_video: function() { if(self.bC2CWebrtcMode && self.hfBroadcaster.access_level() != FCS.FCLEVEL_MODEL && self['member_broadcast'] ) return true; else return self.broadcaster && self.broadcaster.webrtc_video; }, truepvt: function() { return self.broadcaster && self.broadcaster.truepvt; }, camserv: function() { return self.broadcaster && self.broadcaster.camserv;r.model_flags; }, phase: function() { if (self.broadcaster) if (self.broadcaster.hasOwnProperty('alt_phase')) return self.broadcaster.alt_phase; return self.broadcaster && self.broadcaster.phase; }, }, fBannedByUserId: function() {}, fGetClubshows: function() { return {}; }, fGetFcTkx: function() { return {}; }, fGetFcClubshows: function() { return {}; }, fGet: function() { return tr></table> "; }, fPublicChannel: function(nUserId) { return ((this.platform.code == 'cam' ? FCS.CAMCHAN_ID_START : FCS.CHANNEL_ID_START) + parseInt(nUserId)); }, fSessionChannel: function(xChan) { var nChan = parseInt(xChan), nVal = 0; if (nChan < FCS.CHANNEL_ID_START) nVal = FCS.SESSCHAN_ID_START; else if (nChan >= FCS.CHANNEL_ID_START && nChan < FCS.SESSCHAN_ID_START) nVal = FCS.CHANNEL_ID_START; else if (nChan >= FCS.SESSCHAN_ID_START && nChan < FCS.CAMCHAN_ID_START) nVal = 0; return nChan + nVal; }, fVideoPlayerJs_aspectRatioCallback: function(){}, fEnterPictureInPicture: function(){}, fLeavePictureInPicture: function(){}, fClick: null, fContextMenu: null }; this.placardUrls = {}; this.placardUrls['mfc'] = { on_camyou: "files/images/svg/on_camyou.svg", lounge: "files/images/misc/lounge_martini_16_9.png", unavailable: "files/images/svg/video_notice_preview_unavailable.svg", away: "files/images/svg/video_notice_away.svg", group: "files/images/svg/video_notice_group.svg", club: "files/images/svg/video_notice_club.svg", true_private: "files/images/svg/video_notice_true_private.svg", private: "files/images/svg/video_notice_private.svg", problems: "files/images/svg/video_notice_problems.svg" }; this.placardUrls['cam'] = { on_camyou: "files/styles/mfc/images/misc/clear.gif", lounge: "files/images/misc/lounge_coffee.png", unavailable: "files/images/svg/cam/video_notice_preview_unavailable.svg", away: "files/images/svg/cam/video_notice_away.svg", group: "files/images/svg/cam/video_notice_group.svg", club: "files/images/svg/cam/video_notice_away.svg",
 true_private: "files/images/svg/cam/video_notice_true_private.svg", private: "files/images/svg/cam/video_notice_private.svg", problems: "files/images/svg/cam/video_notice_problems.svg" }; this.construct = function(options ) { options = options || {}; this.doc = options.document || document; for(var k in defaults ) this[k] = ( typeof(options[k]) != 'undefined' ) ? options[k] : defaults[k]; }; this.Set = function(options ) { options = options || {}; for(var k in options ) if(typeof(options[k]) != 'undefined' ) this[k] = options[k]; }; this.Log = function() { if(this.fLog && typeof(this.fLog) == 'function' ) { if(typeof(arguments[0])=='string') arguments[0] = 'MfcClientVideo: ' + arguments[0]; this.fLog.apply(this,arguments); } }; this.IsVideoPlayerJsObj = function(obj) {
 return ( typeof(obj) === 'object' && obj != null && obj.isVideoPlayerJs === true ); }; this.BuildVideoProfile = function() { var result = {}; result.host_id = this.hfBroadcaster.camserv(); result.camserv = this.CamServ_Condition_Value(this.hfBroadcaster.camserv() ) || -1; result.prefix = (this.server_config['release'] === false ? "video" : "video"); result.name = result.prefix + result.camserv; result.hdvideo = ( this.hfBroadcaster.model_flags() & FCS.FCOPT_HDVIDEO ) ? 1 : 0; result.h5video = this.IsH5SupportedVideo(result.host_id ); result.obsVideo = this.IsObsVideo(result.host_id); result.obsVideoExt = this.IsObsVideo_ext(result.host_id); if(result.obsVideo ) { result.name = ( this.server_config.ngvideo_servers && this.server_config.ngvideo_servers[ String(result.host_id) ] ) || ''; result.prefix = 'video'; } result.ObsVideo_wz = this.IsObsVideo_wz(result.host_id); if(result.ObsVideo_wz ) { result.name = this.server_config.wzobs_servers[ String(result.host_id) ]; } result.obsVideo = result.obsVideo || result.ObsVideo_wz; if(this.bC2CWebrtcMode && this.hfBroadcaster.access_level() != FCS.FCLEVEL_MODEL ) { result.webrtc_video = 1; result.video_aspect_ratio = (16/9); } else { result.webrtc_video = ( (this.hfBroadcaster.model_flags() & FCS.FCOPT_WEBRTCV1) || (this.hfBroadcaster.model_flags() & FCS.FCOPT_OBSRTCV1) ) ? 1 : 0; result.video_aspect_ratio = ( this.IsObsVideo(result.host_id ) || result.webrtc_video || top.location.search.match(/force_wide_aspect/) ) ? (16/9) : (4/3); } result.phase = this.hfBroadcaster.phase() || ( this.IsObsVideo(result.host_id) && 'z' ) || 'z'; if(this.hfBroadcaster.webrtc_video() ) result.broadcast_type = 'webrtc_video'; else if(result.obsVideo )
 result.broadcast_type = (result.obsVideoExt ? 'OBS Ext' : 'OBS'); else result.broadcast_type = 'unknown'; if(this['member_broadcast'] ) result.recommended_player = 'videopublisher'; else result.recommended_player = 'videojs'; if(this.player_type_override ) { result.player_type = this.player_type_override.replace(/\W/g,''); } else { result.player_type = result.recommended_player; } if(result.player_type == 'videojs' ) { if ( this.player_type_override_JSTech ) { result.videojs_tech_order = [this.player_type_override_JSTech]; this.Log('BuildVideoProfile forcing videojs tech to be "' + this.player_type_override_JSTech.replace(/\W/g,'') + '"'); } } return result; }; this.PrepareVideo = function(options) { options = options || {}; this.videoProfile = this.BuildVideoProfile(); this.width = this.width || 320; this.height = this.height || 240; if ( this['private_session_id'] || this['group_session_id'] || this['club_session_id'] ) this['roomid'] = this.fSessionChannel(this.hfBroadcaster.user_id() ); else this['roomid'] = this['roomid'] || this.fPublicChannel(this.hfBroadcaster.user_id() ); this.previous_video_phase = this.videoProfile.phase || 'z'; this.previous_camserv = this.videoProfile.camserv; this.previous_host_id = this.videoProfile.host_id; delete this.player_html;
 if(this.hfBroadcaster.platform_id() && this.hfBroadcaster.access_level() == FCS.FCLEVEL_MODEL && this.hfBroadcaster.platform_id() != this.platform.id && this.fIsBroadcastState(this.hfBroadcaster.state() ) ) { this.player_html = this.HTML_onOtherPlatform(); } else if ( this.hfBroadcaster.access_level() == FCS.FCLEVEL_MODEL && this.videoProfile.camserv == -1 ) { this.player_html = this.fNoVideo("Video Unavailable, " + this.platform.performer + " may be offline."); } else if ( this.fBannedByUserId(this.hfBroadcaster.user_id() ) ) { this.player_html = this.HTML_Banned(); } else { if(this.videoProfile.player_type == 'videojs' ) { this.jsVideoConfig = this.Get_VideoPlayerJs_Config(); this.videoPlayer = new VideoPlayer(this.jsVideoConfig ); } else if(this.videoProfile.player_type == 'videopublisher' ) { this.jsVideoPublisherConfig = this.Get_VideoPublisherJS_Config(); this.videoPublisher = new VideoPublisher(this.jsVideoPublisherConfig ); } else if(this.videoProfile.player_type == 'livesnaps' ) { this.player_html = this.HTML_liveFrameSnap(); } else { this.Log('ERROR: PrepareVideo is unable to determine player_type!'); } } return true; }; this.RenderVideo = function() { this.MonitorVideoContainer({ reset: true }); if(! this.video_container ) { this.Log('RenderVideo called without this.video_container'); return; } if(this.player_html )
 { this.video_container.innerHTML = this.player_html; if(this.videoProfile.player_type == 'livesnaps' ) { this.LiveFrame_Init(); } } else if(this.videoProfile.player_type == 'videojs' ) { this.videoPlayer.render({append: false}); this.videoPlayer.setEnterPictureInPictureCallback((e) => { this.EnterPictureInPicture(e); } ); this.videoPlayer.setLeavePictureInPictureCallback((e) => { this.LeavePictureInPicture(e); } ); } else if(this.videoProfile.player_type == 'videopublisher' ) { this.videoPublisher.connect(); } else { this.Log('renderVideo() called without prepared video'); } this.video_container.addEventListener('click', this.onVideoContainerClickEvent); this.video_container.addEventListener('contextmenu', this.onVideoContainerContextMenuEvent); this.video_container_firstChild = this.video_container.firstChild; this.MonitorVideoContainer(); }; this.onVideoContainerClickEvent = (e) => { if(typeof(this.fClick ) === 'function' ) this.fClick(e); }; this.onVideoContainerContextMenuEvent = (e) => { if(typeof(this.fContextMenu ) === 'function' ) this.fContextMenu(e); }; deo(options ); };
 this.CamServ_Condition_Value = function(nCamServ ) { if (this.IsObsVideo_wz(nCamServ)) { var sHost = ( this.server_config.wzobs_servers && this.server_config.wzobs_servers[ String(nCamServ) ] ) || ''; nCamServ = sHost.replace(/^\D+/g, ''); } else if (this.IsObsVideo(nCamServ)) { var sHost = ( this.server_config.ngvideo_servers && this.server_config.ngvideo_servers[ String(nCamServ) ] ) || ''; nCamServ = sHost.replace(/^\D+/g, ''); } else if (this.IsH5Video(nCamServ)) { var sHost = ( this.server_config.h5video_servers && this.server_config.h5video_servers[ String(nCamServ) ] ) || ''; nCamServ = sHost.replace(/^\D+/g, ''); } else if(nCamServ > 500 ) { if ( nCamServ >= 3000 ) { nCamServ -= 1000; } else if ( nCamServ >= 1690 ) { nCamServ -= 700; } else { nCamServ -= 500; } } else if(this.video_map ) { if (!this.video_map[nCamServ] || this.video_map[nCamServ] == undefined) { nCamServ = -1; } else { nCamServ = this.video_map[nCamServ]; } } return nCamServ; }; this.IsH5SupportedVideo = function(nVideoHostId ) { return this.IsH5Video(nVideoHostId) || this.IsObsVideo(nVideoHostId); }; tnVideoHostId); }; this.IsH5Video = function(nVideoHostId ) { return ( this.server_config && this.server_config.h5video_servers && this.server_config.h5video_servers.hasOwnProperty(String(nVideoHostId) ) ); }; this.IsObsVideo_wz = function(nVideoHostId ) { return ( this.server_config && this.server_config.wzobs_servers && this.server_config.wzobs_servers.hasOwnProperty(String(nVideoHostId) ) ); }; this.IsObsVideo_ext = function(nVideoHostId ) { return ( this.server_config && this.server_config.wzext_servers && this.server_config.wzext_servers.hasOwnProperty(String(nVideoHostId) ) ); }; this.GetPlacardUrl = function(placard ) { if(this.MissingPlatform() ) { return; } if(this.placardUrls[ this.platform.code ] ) return this.platform.image_url + this.placardUrls[ this.platform.code ][ placard ]; else this.Log('Error, no placardUrls config for platform ' + this.platform.code ); }; this.SetDimensions = function(options ) { options = options || {}; var fRatio = this.videoProfile.video_aspect_ratio || 1.333; options.height = options.height || Math.ceil(options.width * ( 1 / fRatio ) ); options.width = options.width || Math.ceil(options.width * fRatio ); this.width = options.width; this.height = options.height; var oEl; if(oEl = this.GetLiveFrameSnap() ) { oEl.height = this.height;
 oEl.width = this.width; } else if(this.videoPlayer || this.videoPublisher ) { 1; } else { this.Log('SetDimensions failed to find a video object'); } }; this.GetPreferredReference = function() { return ( ( navigator.userAgent && navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./) && parseInt(RegExp.$2 ) >= 32 ) ? 'fvideo_ff' : 'fvideo' ) + this.hfBroadcaster.user_id(); }; this.GetRelativeUserState = function(nModelState ) { var nVideoState; if(nModelState == FCS.EVSESSION_PRIVATE ) nVideoState = FCS.FCVIDEO_RX_PVT; else if(this.hfBroadcaster.state() == FCS.FCVIDEO_TX_PVT && nModelState == FCS.EVSESSION_VOYEUR ) // =12 && =2
 nVideoState = FCS.FCVIDEO_RX_VOY; else if(nModelState == FCS.EVSESSION_GROUP ) nVideoState = FCS.FCVIDEO_RX_GRP; else if(nModelState == FCS.EVSESSION_CLUB ) nVideoState = FCS.FCVIDEO_RX_CLUB; else if(! nModelState ) nVideoState = FCS.FCVIDEO_RX_IDLE; //90
 else nVideoState = nModelState; return nVideoState; }; this.Get_VideoPublisherJS_Config = function(options) { if(! this['member_broadcast'] ) { this.Log('VideoPublisher only available for member broadcast'); return; } var nClientUserId = this.hfClientUser.user_id();
 if(! this.myWebcam_Publish || ! this.myWebcam_Publish.hVidToken ) { this.Log('this.myWebcam_Publish not provided'); return; } if(typeof(this.videoPublisher_profile) !== 'object' || this.videoPublisher_profile == null ) { this.Log('this.videoPublisher_profile was never set'); return; } if(! this.video_container.id ) this.instance.id = 'videopublisher_' + this.instance + '_' + nClientUserId + '_' + this.id; var _this = this; var config = Object.assign(this.videoPublisher_profile, { container: this.video_container.id, platformId: this.platform.id, host: this.myWebcam_Publish.hVidServ + "." + this.platform.domain, imageUrl: this.platform.image_url, sessionId: this.hfClientUser.session_id(), roomId: nClientUserId, password: this.myWebcam_Publish.hVidToken, vidctx: encodeURIComponent(JSON.stringify(this.myWebcam_Publish.hVidCtx)), c2c: true, modelId: nClientUserId, logFn: function(m) { _this.Log("VideoPublisher: " + m); }, fcs: FCS, events: { 'connected': function(status ){ _this.Log("VideoPublisher EVENT [connected] " + JSON.stringify(status)); }, 'devices': function(devices ){ _this.Log("VideoPublisher EVENT [devices] " + JSON.stringify(devices)); }, 'streamtracks': function(streamTracks ) { _this.Log("VideoPublisher EVENT [streamtracks] " + JSON.stringify(streamTracks)); }, 'broadcasting': function(status ){ _this.Log("VideoPublisher EVENT [broadcasting] " + JSON.stringify(status)); }, 'error': function(msg ){ _this.Log("VideoPublisher EVENT [error] " + msngify(stats)); }, 'miclevel': function(level ){ } } }); return config; }; this.Get_VideoPlayerJs_Config = function(options) { this.fcTkx = this.fGetFcTkx() || {}; this.passcode = this.hfClientUser.passcode(); this.Log('VideoPlayerJS_Init: Setting cxid to "' + this.fcTkx.cxid + '"'); if ( this.videoProfile.videojs_tech_order ) this.Log('VideoPlayerJS_Init: Tech order: "' + this.videoProfile.videojs_tech_order + '"'); var sAspectRatio = '4:3'; if ( this.videoProfile.video_aspect_ratio ) { sAspectRatio = ( this.videoProfile.video_aspect_ratio >= 1.5 ? '16:9' : '4:3' ); this.Log('VideoPlayerJS_Init: Using sAspectRatio ' + sAspectRatio); } var sApp = ''; if ( this.videoProfile.obsVideo && ( (typeof(this.bDisableHlsAbr) !== 'undefined' && this.bDisableHlsAbr) ) ) { sApp = '/x-dsh/'; } var useFcTkx = (this.videoProfile.ObsVideo_wz || this.videoProfile.obsVideo); var nState = this.GetRelativeUserState(this.presentation_state || FCS.EVSESSION_NONE ); //this.hfBroadcaster.state() );
 var _this = this; var sTkxPass = useFcTkx ? function() { var fcTkx = _this.fGetFcTkx() || {}; return fcTkx.tkx; } : ( this.passcode || ''); var sVidCtx = useFcTkx ? function() { var fcTkx = _this.fGetFcTkx() || {}; return encodeURIComponent(btoa(JSON.stringify(fcTkx.ctx))); } : ''; var sVidCxid = useFcTkx ? function() { var fcTkx = _this.fGetFcTkx() || {}; return fcTkx.cxid; } : 0; if(this['club_session_id'] ) {
 sTkxPass = this.fcTkx.tkx; } this.hClubshows = this.fGetClubshows() || {}; if(this.hasOwnProperty('club_session_id') && this['club_session_id'] > 0 ) { if(nState == FCS.FCVIDEO_RX_CLUB ) { if ( this.hClubshows.hasOwnProperty(this.hfBroadcaster.user_id() ) && this.hClubshows[ this.hfBroadcaster.user_id() ].hasOwnProperty('ckx_auth') ) { sTkxPass = encodeURIComponent(this.hClubshows[ this.hfBroadcaster.user_id() ].ckx_auth.tkx ); sVidCtx = encodeURIComponent(btoa(JSON.stringify(this.hClubshows[ this.hfBroadcaster.user_id() ].ckx_auth.ctx ) ) ); } else { this.Log('clientVideo ERR; state is _RX_CLUB, but no this.hClubshows['+this.hfBroadcaster.user_id()+']/' + 'this.hClubshows['+this.hfBroadcaster.user_id()+'].ckx_auth: ' + JSON.stringify(g_hClubshows )); } } else { this.Log('clientVideo ERR; club_session_id present but state['+nState+'] != _RX_CLUB['+FCS.FCVIDEO_RX_CLUB+'] !'); } } var sVideoDomain = ( this.videoProfile.obsVideo ? this.videoProfile.name : 'video' + this.videoProfile.camserv ) + '.' + this.platform.domain; var nRoomId = this['roomid']; var bC2c = false; var nModelState = this.hfBroadcaster.state(); var sMode = 'DOWNLOAD'; if(this.hfBroadcaster.access_level() != FCS.FCLEVEL_MODEL ) { nRoomId = parseInt(this.hfBroadcaster.user_id(), 10); sTkxPass = this.fcTkx.tkx; sVidCtx = encodeURIComponent(JSON.stringify(this.fcTkx.ctx)); nModelState = FCS.FCVIDEO_TX_IDLE; bC2c = true; sMode = 'CAM2CAM'; } VideoPlayer.prototype.REPORTBACK = true; VideoPlayer.prototype.REPORTBACK_EXTRA = { 'www_release': '1' };
 var obj = { isVideoPlayerJs: true, platformId: this.platform.id, imageUrl: this.platform.image_url, videoDomain: sVideoDomain, urlFormat: ((this.videoProfile.ObsVideo_wz || ! this.videoProfile.obsVideo ) ? 'wowza' : 'nginx' ), app: sApp, sessionId: this.hfClientUser.session_id(), roomId: nRoomId, password: sTkxPass, vidctx: sVidCtx, mode: sMode, cxid: sVidCxid, phase: this.videoProfile.phase, aspectRatio: sAspectRatio, modelId: this.hfBroadcaster.user_id(), mute: (this['mute'] ? true : false), state: nState, modelState: nModelState, truepvt: ( this.hfBroadcaster.truepvt() ? true : false), pvtsession: (this['private_session_id'] ? this['private_session_id'] : 0), grpsession: (this['group_session_id'] ? this['group_session_id'] : 0), clbsession: (this['club_session_id'] ? this['club_session_id'] : 0), ckxauth: this['ckxauth'], videoId: this.GetPreferredReference(), containerEl: this.video_container, livesnapBg: true, useBlurredLivesnaps: true, livesnapRefreshTime: 1000, c2c: bC2c, autoplayMutedOverlay: this.autoplayMutedOverlay, allowFullscreen: this.allowFullscreen, allowControls: this.allowControls, capLevelToPlayerSize: (typeof(this.capLevelToPlayerSize) !== 'undefined') ? this.capLevelToPlayerSize : false, modelFlags: this.hfBroadcaster.model_flags(), aspectRatioCallback: function(options) { if(self.fVideoPlayerJs_aspectRatioCallback ) self.fVideoPlayerJs_aspectRatioCallback.apply(this,argumeyerJS: ' + m); }
 }; if(this.videoProfile.videojs_tech_order ) obj.techOrder = this.videoProfile.videojs_tech_order; if ( this.player_type_override_JSTech_override ) obj.techOverride = this.player_type_override_JSTech_override; return obj; }; this.HTML_onOtherPlatform = function(options) { var sHtml=''; if(this.platform.id == PLAT_MFC ) { var sPlat = this.hfBroadcaster.platform_id() == PLAT_MFC ? 'mfc' : 'cam'; var sCam = 'cam'; var sIM = 'im'; var sPrefix = this.hfBroadcaster.platform_id() == PLAT_MFC ? "\u006d\u0066\u0063\u002e\u0069\u006d\u002f" : "\u0077\u0077\u0077\u002e\u0063\u0061\u006d\u006d\u0075\u006e\u0069\u0074\u0079\u002e\u0063\u006f\u006d\u002f\u0023"; sHtml = "<a href=\"//" + sPrefix + this.hfBroadcaster.username() + "\" target=_blank>" + "<img sr"+"c='" + this.platform.image_url + "files/images/svg/on_" + sPlat + ".svg' width=" + this['width'] + " height=" + this['height'] + "></a>"; } else { sHtml = "<img sr"+"c='" + this.platform.image_url + "files/images/svg/cam/video_notice_preview_unavailable.svg' width=" + this['width'] + " height=" + this['height'] + ">"; } return sHtml; }; this.HTML_Banned = function(options) { return "<img sr"+"c='" + this.platform.image_url + ( this.platform.id == PLAT_MFC ? "files/images/svg/video_notice_banned.svg" : "files/images/svg/cam/video_notice_banned.svg" ) + "' width='" + this['width'] + "' height='" + this['height'] + "'>"; }; this.MonitorVideoContainer = function(options ) { options = options || {}; if(options.reset ) {
 this.MonitorVideoContainer_wasPresented = false; clearTimeout(this.MonitorVideoContainer_timer ); } else if(this.MonitorVideoContainer_wasPresented && ! this.doc.body.contains(this.video_container_firstChild ) ) { this.Log('MonitorVideoContainer - video container for ' + this.hfBroadcaster.username() + ' removed from document, disconnecting...'); this.Disconnect(); } else { this.MonitorVideoContainer_wasPresented = this.doc.body.contains(this.video_container_firstChild ); clearTimeout(this.MonitorVideoContainer_timer ); this.MonitorVideoContainer_timer = setTimeout(function(){ self.MonitorVideoContainer(); }, 5000 ); } }; this.Disconnect = function(bBool ) { this.MonitorVideoContainer({reset: true}); if(this.video_container ) { this.video_container.removeEventListener('click', this.onVideoContainerClickEvent); this.video_container.removeEventListener('contextmenu', this.onVideoContainerContextMenuEvent); } if(this.videoProfile && this.videoProfile.player_type == 'videojs' && this.videoPlayer ) { try { this.videoPlayer.Disconnect(); this.Log('videoPlayer Disconnect()'); } catch(e) { this.Log(e); } } else if(this.videoProfile && this.videoProfile.player_type == 'videopublisher' && this.videoPublisher ) { try { this.videoPublisher.disconnect(); this.Log('videoPublisher disconnect()'); } catch(e) { this.Log(e); } } else if(this.videoProfile ) { this.Log('Disconnect found no video objects, player_type: ' + ( this.videoProfile && this.videoProfile.player_type ) );
 } }; this.MissingPlatform = function() { if(! this.platform ) { this.Log('Error, requires { platform: [platform configs] }'); this.Log(this); return true; } }; this.LiveSnapUrl = function(options ) //options = { size: [snap width] }
 { if(! this.hfBroadcaster.user_id() ) { var error_placard = '/files/images/svg/video_notice_problems.svg'; return error_placard; } if(this.clientRes.Lounges[ this.hfBroadcaster.user_id() ] ) { return this.GetPlacardUrl('lounge'); } return new VideoPlayer({ platformId: this.platform.id, modelId: this.hfBroadcaster.user_id(), videoDomain: ( 'video' + this.CamServ_Condition_Value(this.hfBroadcaster.camserv() ) ) + '.' + this.platform.domain, modelState: this.hfBroadcaster.state(), truepvt: ( this.hfBroadcaster.truepvt() ? true : false) }).livesnapUrl(options); }; this.EnsureHDVideoState = function(opts ) { if(this.hfBroadcaster.access_level() != FCS.FCLEVEL_MODEL ) { return; }  if(this.hfBroadcaster.hdvideo() != this.videoProfile.hdvideo ) { this.Log('EnsureHDVideoState, hdvideo mismatch: ' + this.hfBroadcaster.hdvideo() + ' != ' + this.videoProfile.hdvideo ); setTimeout(function() { self.LoadVideo(); }, 2000 ); } else if(this.hfBroadcaster.webrtc_video() != this.videoProfile.webrtc_video ) { this.Log('EnsureHDVideoState, webrtc_video mismatch: ' + this.hfBroadcaster.webrtc_video() + ' != ' + this.videoProfile.webrtc_video ); setTimeout(function() { self.LoadVideo(); }, 2000 ); } }; this.OnVideoPlayerUpdate = function(opts ) { opts = opts || {}; this.videoProfile = this.BuildVideoProfile(); var delegateVideoUpdates = ( typeof(this.videoPlayer ) == 'object' && this.videoPlayer != 'null' && this.videoPlayer.isJsVideo === true ); var reloadVideo = 0; if(this.videoProfile.host_id != this.previous_host_id ) { if(this.videoProfile.camserv > 0 ) { console.log('OnVideoPlayerUpdate/RELOAD: videoProfile: ', this.videoProfile, ' - prevHostId: ', this.previous_host_id); this.previous_camserv = this.videoProfile.camserv; this.previous_host_id = this.videoProfile.host_id; reloadVideo = 1; } } if ( this.videoProfile.hasOwnProperty('phase') ) { if ( this.videoProfile.phase != this.previous_video_phase ) { console.log('OnVideoPlayerUpdate/RELOAD: newPhase[' + this.videoProfile.phase + '] != previous_video_phase[' + this.previous_video_phase + '], videoProfile: ', this.videoProfile ); this.previous_video_phase = this.videoProfile.phase; reloadVideo = 2; } } else if (this.previous_video_phase != 'z') { console.log('OnVideoPlayerUpdate/RELOAD: no new phase, previous_video_phase[' + this.previous_video_phase + ']; videoProfile:', this.videoProfile ); this.previous_video_phase = 'z'; reloadVideo = 3; }
 var nChar = this.previous_video_phase.charCodeAt(0); if (nChar < ("a".charCodeAt(0)) || nChar > ("z".charCodeAt(0))) { console.log('OnVideoPlayerUpdate/RELOAD: invalid previous_video_phase of: ', this.previous_video_phase); this.previous_video_phase = 'z'; reloadVideo = 4; } if (reloadVideo) { delegateVideoUpdates = false; this.LoadVideo(); } if(delegateVideoUpdates ) { if(this.videoPlayer ) { this.videoPlayer.setModelState(this.hfBroadcaster.state() ); } else { this.Log('this.videoPlayer does not exist'); } } }; this.Mute = function(bBool ) { if(this.videoPlayer ) { this.mute = bBool; this.videoPlayer.setMute(bBool ); } else { this.Log('Mute failed to find a video object'); } };  this.HTML_liveFrameSnap = function(options) 
 { return "<img id=liveFrameSnap_" + this.hfBroadcaster.user_id() + "_" + this.instance + " width=" + this['width'] + " height=" + this['height'] + " title=\"" + this.instance + "\" src=\"" + this.LiveSnapUrl({'high_res': true }) + "\">"; }; this.GetLiveFrameSnap = function(options ) { return this.doc.getElementById('liveFrameSnap_' + this.hfBroadcaster.user_id() + '_' + this.instance ); }; this.LiveFrame_Init = function(hOptions ) { this.LiveFrame_Cycle(); }; this.LiveFrame_Cycle = function(newSnap ) { var currentSnap = this.GetLiveFrameSnap(); if(! currentSnap || ! currentSnap.offsetParent ) { return; } if(this.newSnap ) { if(currentSnap.width ) { this.newSnap.width = currentSnap.width; } if(currentSnap.height ) { this.newSnap.height = currentSnap.height; } currentSnap = currentSnap.parentNode.replaceChild(this.newSnap, currentSnap ); } curre(); }, 500 ); }; currentSnap.src = this.LiveSnapUrl({'high_res': true });// + "?liveFrameSnap_" + this.instance + "";
 this.newSnap = currentSnap.cloneNode(); }; this.EnterPictureInPicture = function() { typeof(this.fEnterPictureInPicture ) == 'function' && this.fEnterPictureInPicture.apply(this,arguments); }; this.LeavePiis,arguments); }; this.RequestPireInPicture(); }; this.construct(options );};MfcClientVideo.instanceCounter = 0;

// js_build_core: MfcJs/MfcChatCard/MfcChatCard.js
function MfcChatCard(conf ){ this.conf = conf || {}; this.apiUrl = ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ); this.oReq = new XMLHttpRequest(); this.oReq.withCredentials = true;}MfcChatCard.prototype.ProcessChatInput = function(sChatLine ){ if(typeof(sChatLine ) != 'string' ) { return; }
 var aMatches; if(! ( aMatches = sChatLine.match(/(https:\/\/)(share\.myfreecams\.com|mfcsha\.re)([\S]+)/i) ) ) return; aMatches[2] = aMatches[2].replace(/mfcsha\.re/i,'share.myfreecams.com'); var url = aMatches[1] +aMatches[2] + aMatches[3]; var reqUrl = this.apiUrl + "/chatcard/?url=" + encodeURIComponent(url ); var self = this; this.oReq = new XMLHttpRequest(); this.oReq.open('get', reqUrl); this.oReq.onreadystatechange = function() { self.ProcessChatInput_callback(); }; this.oReq.send(null); };MfcChatCard.prototype.ProcessChatInput_callback = function(sChatLine ){ if ( this.oReq.readyState !== 4 ) { return; } var oRes; try { oRes = JSON.parse(this.oReq.responseText ); } catch(e) { console.log(e); } if(! oRes || ! oRes.result ) { console.log(this.oReq.responseText ); return; } if(this.conf.callback_func && typeof(this.conf.callback_func) == 'function' ) this.conf.callback_func.apply(this,[ oRes.result ]);};MfcChatCard.prototype.ProcessCard = function(hCard ){ var hTpl = {}; var sCard; if(hCard.url && ( hCard.url.match(/(https:\/\/share\.myfreecams\.com\/)/i) || hCard.url.match(/(https:\/\/mfcsha\.re\/)(\w+)(\/\w+)/i) ) ) { if(window.NightMode && NightMode.enabled ) hCard.url += ( hCard.url.indexOf('?') > -1 ? '&' : '?' ) + 'color_scheme_dark=true';
 hTpl = this.MfcShare_CardTpl(hCard ); if(this.conf.share_tpl_func ){ hTpl = this.conf.share_tpl_func(hTpl); } } else if(hCard.url ) { hTpl = this.CardTpl(hCard ); } if(hTpl.html && typeof(hTpl.card) == 'object' ) { for(var key in hTpl.card ) { if(typeof(hTpl.card[key] ) != 'string' && typeof(hTpl.card[key] ) != 'number' ) { continue; } var regex = new RegExp("{{" + key + "}}",'g'); hTpl.html = hTpl.html.replace(regex,hTpl.card[key]); } sCard = hTpl.html.replace(/{{\s*\w+\s*}}/g,''); } return sCard;};MfcChatCard.prototype.CardTpl = function(hCard ){ var hTpl={}; hTpl.card = hCard; hTpl.html = " <div class=TwitterCard_inChat> <table border=0> <tr> <td class=TwitterCard_inChat_img_td> <a href=\"{{url}}\" target=_blank> <img onError=\"this.style.display='none';\" class=TwitterCard_inChat_img src=\"{{image}}\"> </a> </td> <td> <div class=TwitterCard_inChat_title> <a href=\"{{url}}\" target=_blank> <span class=TwitterCard_inChat_title> {{title}} </span> </a> </div> <div class=TwitterCard_inChat_description> <a href=\"{{url}}\" target=_blank> {{description}} </a> </div> <a class=TwitterCard_inChat_domain href=\"{{url}}\"> {{domain}} </a> </td> </tr> </table> </div> ";
 return hTpl;};MfcChatCard.prototype.MfcShare_CardTpl = function(hCard ){ hCard = hCard || {}; hCard.mfcshare = 1; hCard.url_domain = document.domain.replace(/.*?(\w+\.\w+)$/,"$1"); hCard.username = hCard.username && hCard.username.replace(/[^\w]/g,''); hCard.username_url = hCard.username && "https://share." + hCard.url_domain + "/" + hCard.username.replace(/[^\w]/g,''); hCard.title = hCard.title && hCard.title.replace(/[<]/g,'') || ''; hCard.description = hCard.description && hCard.description.replace(/[<]/g,'') || ''; hCard.image = hCard.image && hCard.image.replace(/"/g,'').replace(/\?.*/,'') || ''; var image_url = hCard && hCard.image_url || ( 'https://assets.mf'+'cimg.com/' ); hCard.logo = image_url + "/images/svg/MFC_Share.svg"; var sExtra=''; if(hCard.type ) { sExtra += "<span class=MFCShare_inChat_type>" + hCard.type + "</span>"; } if(hCard.token_amount ) { if(sExtra ) { sExtra += ', '; } sExtra += '<span class=MFCShare_inChat_token_amount>' + hCard.token_amount + ' tokens</span>'; } hCard.title = '<b>' + hCard.title + '</b>'; if(sExtra ) { hCard.title += " " + sExtra; } var hTpl={}; hTpl.card = hCard; if(typeof(this.conf.get_user_style_func ) == 'function' ) hTpl.card.username_style = this.conf.get_user_style_func(hCard.user_id ); else hTpl.card.username_style = ''; if(typeof(this.conf.get_formatted_username_func ) == 'function' ) hTpl.card.formatted_username = this.conf.get_formatted_username_func(hCard.user_id, hCard.username ); else hTpl.card.formatted_username = hCard.username; hTpl.html = " <div class=MFCShare_inChat>\
 <table border=0> <tr> <td class=> <a href=\"{{url}}\" target=_blank> <img onError=\"this.style.display='none';\" class=MFCShare_inChat_img src=\"{{image}}\" data-imgsrc=\"{{image}}\" onmouseenter=\" MfcChatCard.pop_image_hover(event);\" onmouseleave=\" MfcChatCard.pop_image_hover(event);\" > </a> </td> <td class=MFCShare_inChat_content> <a href=\"{{username_url}}\" target=_blank> <div class=MFCShare_inChat_username style=\"{{username_style}}\"> {{formatted_username}} </div> </a> <a href=\"{{url}}\" target=_blank> <span class=MFCShare_inChat_title> {{title}} </span> </a> <div class=MFCShare_inChat_logo> on <a href=\"{{url}}\" target=\"_blank\"><img onError=\"this.style.display='none';\" src=\"{{logo}}\"></a> </div> </td> </tr> </table> </div> "; return hTpl;};MfcChatCard.pop_image_hover = function(oEvent ){ if(! window.MfcDhtmlPopup ) { return; } if(oEvent.type == 'mouseleave' && this.MfcDhtmlPopup_pop_image_hover ) { this.MfcDhtmlPopup_pop_image_hover.close(); } else if(oEvent.type == 'mouseenter' ) { sH = `<img style="height:${oEvent.target.naturalHeight}px;width:${oEvent.target.naturalWidth}px;" src=${oEvent.target.dataset.imgsrc}>`; this.MfcDhtmlPopup_pop_image_hover = new MfcDhtmlPopup({}); this.MfcDhtmlPopup_pop_image_hover.open(sH,{ 'hover': true, 'hover_offset': 100 }); }};

// js_build_core: MfcJs/WebPushSubscriptions/WebPushSubscriptions.js
(function (root, WebPushSubscriptionsWrapper) { 'use strict'; if ( typeof(define) === "function" && define.amonsWrapper()); }); } else if ( typeof(module) === "object" && module.exports ) { module.exports = (root.WebPushSubscriptions = WebPushSubscriptionsWrapper()); } else { root.WebPushSubscriptions = WebPushSubscriptionsWrapper(); }}(this, function() { 'use strict'; var WebPushSubscriptions = (function(win, doc, nav) { function WebPushSubscriptions(options ) { var _options = options || {}; var _client = ( typeof(_options.client) === 'string' && _options.client ) ? _options.client : void(0); var _containerEl = ( typeof(_options.containerEl) === 'object' && _options.containerEl ) ? _options.containerEl : void(0); var _token = ( typeof(_options.token) === 'string' && _options.token ) ? _options.token : void(0); var _apiUrl = ( typeof(_options.apiUrl) === 'string' && _options.apiUrl ) ? _options.apiUrl : ( typeof(MfcClientRes) === 'function' && MfcClientRes.apiUrl ) || ( '//api-edge.' + doc.domain.replace(/.*?(\w+\.\w+)$/,"$1") ); var _imageUrl = ( typeof(_options.imageUrl) === 'string' && _options.imageUrl ) || ( typeof(g_hPlatform) === 'object' && g_hPlatform.image_url ) || ( 'https://img.mf'+'cimg.com/' ); var _requiresPWACb = ( typeof(_options.requiresPWA) === 'function' ) ? _options.requiresPWA : void(0); var _publicVapidkey; var _publicKey; var _browserSub; var _browserSubId;
 var _status = { noManage: false, subscriptions: [], browserStatus: 'disabled' }; this.init = function() { this._injectHtml(); if ( typeof(Promise) !== 'function' ) { _status.noManage = true; _status.browserStatus = 'not_supported'; this._renderLatestStatus(); return; } return new Promise(function(resolve, reject) { if ( ! _containerEl || ! _containerEl.nodeType || _containerEl.nodeType !== 1 ) { return reject("Invalid containerEl passed in; not an HTML element"); } this._toggleEventListeners(true); if ( ! WebPushSubscriptions.isSupported() ) { _status.browserStatus = 'not_supported'; Promise.all([this._getToken(), this._getSubscriptions()]) .then(function(results) { _token = results[0]; _status.subscriptions = results[1]; this._renderLatestStatus(); return resolve(_status); }.bind(this)) .catch(function() { _status.noManage = true; this._renderLatestStatus(); return resolve(_status); }.bind(this)); } else { Promise.all([this._getToken(), this._fetchPublicKey(), this._getSubscriptions()]) .then(function(results) { _token = results[0]; _publicKey = results[1]; _status.subscriptions = results[2]; _publicVapidkey = this.urlBase64ToUint8Array(_publicKey); }.bind(this))
 .then(this.getSubscriptionStatus.bind(this)) .then(this._determineBrowserStatus.bind(this)) .then(this._renderLatestStatus.bolve(_status); }); } }.bind(this)); }; this.getSubsriptions = function() { return _status.subscriptions; }; this.getSubscriptionStatus = function() { return new Promise(function(resolve, reject) { nav.serviceWoubscription(); }) .then(function(subscription) { if ( subscription ) { _browserSub = subscription; } else { _browserSub = void(0); } resolve(_browserSub); }); }.bind(this)); }; this.createSubscription = function() { return new Promise(function(resolve, reject) { if ( _browserSub ) { return resolve(_status); } nav.serviceWocVapidkey });
 }.bind(this)) .then(function(subscription) { _browserSub = subscription; return fetch(_apiUrl + '/wpn/subscription/new', { method: 'post', credentials: 'include', headers: { 'Content-type': 'application/json' }, body: JSON.stringify({ 'client': _client, 'token': _token, 'publicKey': _publicKey, 'subscription': subscription }) }); }.bind(this)) .then(function(response) { return response.json(); }) .then(function(body) { if ( body.err === 0 ) { var result = body.result; _browserSubId = result.id; _status.browserStatus = 'enabled'; _status.subscriptions.push({ 'id': result.id, 'label': '', 'user_agent': nav.userAgent, 'date_added': result.date_added, 'subscription': { 'endpoint': _browserSub.endpoint }, 'thisBrowser': true }); return resolve(_status); } if ( typeof(_browserSub) === 'object' ) { try { _browserSub.unsubscribe(); } catch (e) {} }
 return reject("There was a problem turning notifications on this browser at this time. Please try again in a few minutes."); }) .catch(function(error) { _status.browserStatus = 'disabled'; this._renderLatestStatus(); if ( error && error.toString().match(/manifest empty or missing/) ) { alert("Please upgrade your browser to the latest version in order to utilize this feature."); return; } _containerEl.querySelector('.howto_turn_on_notifications').classList.remove('hide'); var showHelp = ''; var userAgent = win.navigator && win.navigator.userAgent || ''; var isAndroid = (/Android/i).test(userAgent); var isFirefox = (/Firefox/i).test(userAgent); var isChrome = (/Chrome/i).test(userAgent); if ( isAndroid ) { if ( isFirefox ) { showHelp = '.firefox'; } else { showHelp = '.google_chrome_android'; } } else if ( isChrome ) { showHelp = '.google_chrome'; } else if ( isFirefox ) { showHelp = '.firefox'; } if ( showHelp ) _containerEl.querySelector(showHelp).classList.remove('hide'); }.bind(this)); }.bind(this)); }; this.deleteSubscription = function() { return new Promise(function(resolve, reject) { if ( ! _browserSubId ) { return resolve(_status); } this.deleteSubscriptionById(_browserSubId)
 .then(resolve); }.bind(this)); }; this.deleteSubscriptionById = function(subscriptionId) { return new Promise(function(resolve, reject) { fetch(_apiUrl + '/wpn/subscription/' + subscriptionId, { method: 'delete', credentials: 'include', headers: { 'Content-type': 'application/json' }, body: JSON.stringify({ 'token': _token }) }) .then(function(response) { var found = _status.subsubscriptionId; }); if ( found && found[0] ) { _status.subscriptions = _status.subsubscriptionId; }); if ( found[0].thisBrowser && _browserSub ) { _browserSub.unsubscribe(); _browserSub = void(0); _browserSubId = 0; _status.browserStatus = 'disabled'; } } return resolve(_status); }); }.bind(this)); }; this._getSubscriptions = function() { return new Promise(function(resolve, reject) { var url = _apiUrl + '/wpn/subscription?';
 url += 'client=' + encodeURIComponent(_client); fetch(url, { method: 'get', credentials: 'include' }) .then(function(response) { return response.json(); }) .then(function(body) { var result = body.result; if ( typeof(result) !== 'object' || result == null ) { result = []; } return resolve(result); }) .catch(function() { return reject('Unable to fetch subscriptions'); }); }.bind(this)); }; this._determineBrowserStatus = function() { if ( typeof(_browserSub) === 'object' && _browserSub != null ) { var found = _status.subscriptions.filter(function(sub) { if ( sub.hasOwnProperty('subscription') && sub['subscription'].hasOwnProperty('endpoint') ) { return sub['subscription']['endpoint'] === _browserSub['endpoint']; } return false; }); if ( found[0] ) { found[0].thisBrowser = true; _browserSubId = found[0].id; _status.browserStatus = 'enabled'; } else { _browserSub.unsubscribe(); _browserSub = void(0); _browserSubId = 0; _status.browserStatus = 'disabled'; } } };
 this._getToken = function() { return new Promise(function(resolve, reject) { if ( typeof(_token) === 'string' && _token ) return resolve(_token); fetch(_apiUrl + '/token', { method: 'get', credentials: 'include' }) .then(function(response) { return response.json(); }) .then(function(body) { var result = body.result; if ( typeof(result.token) === 'string' && result.token ) { return resolve(result.token); } return reject('Unable to fetch token'); }) .catch(function() { return reject('Unable to fetch token'); }); }.bind(this)); }; this._fetchPublicKey = function() { return new Promise(function(resolve, reject) { if ( typeof(_publicKey) === 'string' && _publicKey ) return resolve(_publicKey); fetch(_apiUrl + '/wpn/public_key', { method: 'get', credentials: 'isponse.json(); }) .then(function(body) { var result = body.result; if ( typeof(result) === 'string' && result ) { return resolve(result); }
 return reject('Unable to fetch public  public key'); }); }.bind(this)); }; this._clickEvent = function(e) { var target = e.target; var matchFn = function(selector) { var closest = target.closest(selector); return !!(closest && _containerEl.contains(closest)); }; var callFn; if ( matchFn('.remove_sub') ) { callFn = this._removeSubEvent.bind(this); } else if ( matchFn('#manage_browser_subs') ) { callFn = this._manageBrowserSubsEvent.bind(this); } else if ( matchFn('.webpush_enable_notifications') ) { callFn = this._enableNotificationsEvent.bind(this); } else if ( matchFn('.webpush_disable_notifications') ) { callFn = this._disableNotificationsEvent.bind(this); } if ( callFn ) { e.preventDefault(); callFn(e); } }; this._removeSubEvent = function(e) { var target = e.target.closest('.remove_sub'); var parent = target.parentNode; parent.innerHTML = 'removing...'; this.deleteSubscriptionById(target.dataset.subId) .then(this._renderLatestStatus.bind(this)); }; this._manageBroggle('hide'); };
 this._enableNotificationsEvent = function(e) { _containerEl.querySelector('.howto_turn_on_notifications').classList.add('hide'); this._setBrowserStatus('action', 'turning on notifications...'); this.createSubscription() .then(this._renderLatestStatus.bind(this)); }; this._renderLatestStatus = function() { this._setBrowserStatus(_status.browserStatus); this._renderSubscriptions(); }; th/g, '&quot;'); }; this._disableNotificationsEvent = function(e) { this._setBrowserStatus('action', 'stopping notifications...'); this.deleteSubscription() .then(this._renderLatestStatus.bind(this)); }; this._setBrowserStatus = function(status, msg) { var manage = _containerEl.querySelector('.webpush_browser_manage'); var notSupported = _containerEl.querySelector('.webpush_not_supported'); var action = _containerEl.querySelector('.webpush_this_browser_action'); var enabled = _containerEl.querySelector('.webpush_this_browser_enabled'); var disabled = _containerEl.querySelector('.webpush_this_browser_disabled'); notSupported.classList.add('hide'); action.classList.add('hide'); enabled.classList.add('hide'); disabled.classList.add('hide'); if ( status === 'not_supported' ) { if ( _requiresPWACb && this._requiresPWA() ) { _requiresPWACb(notSupported, _status); } else { notSupported.classList.remove('hide'); }
 if ( _status.noManage ) { manage.classList.add('hide'); } } else if ( status === 'action' ) { if ( msg ) { action.innerHTML = ''; action.appendChild(doc.createTextNode(msg)); } action.classList.remove('hide'); } else if ( status === 'enabled' ) { enabled.classList.remove('hide'); } else if ( status === 'disabled' ) { disabled.classList.remove('hide'); } this.currentStatus = status; }; this._toggleEventListeners = function(bool) { if ( ! _containerEl || ! _containerEl.closest ) { return; } bool = !!bool; if ( ! this._clickEventFn ) { this._clickEventFn = this._clickEvent.bind(this); } if ( bool ) { _containerEl.addEventListener('click', this._clickEventFn); } else { _containerEl.removeEventListener('click', this._clickEventFn); } }; this._renderSubscriptions = function() { var tableBody = _containerEl.querySelector('#browser_subscriptions tbody'); var newTbody = doc.createElement('tbody'); if ( Array.isArray(_status.subscriptions) ) { if ( _status.subscriptions.length > 0 ) { for (var i = 0; i < _status.subscriptions.length; i++) { var sub = _status.subscriptions[i]; var td;
 var tr = doc.createElement('tr'); tr.id = 'sub_' + sub.id; newTbody.appendChild(tr); td = doc.createElement('td'); td.classList.add('date_added'); td.appendChild(doc.createTextNode(sub.date_added)); tr.appendChild(td); td = doc.createElement('td'); td.classList.add('user_agent'); if ( sub.thisBrowser ) { var thisBrowser = doc.createElement('span'); thisBrowser.classList.add('this_browser'); thisBrowser.appendChild(doc.createTextNode('[this browser]')); td.appendChild(thisBrowser); } td.appendChild(doc.createTextNode(sub.user_agent)); tr.appendChild(td); td = doc.createElement('td'); td.classList.add('remove'); var removeSub = doc.createElement('a'); removeSub.href = '#'; removeSub.classList.add('remove_sub'); removeSub.dataset.subId = sub.id; var removeImg = doc.createElement('img'); removeImg.src = _imageUrl + 'files/images/svg/x.svg'; removeSub.appendChild(removeImg); td.appendChild(removeSub); tr.appendChild(td); newTbody.appendChild(tr); } } } else { $newTbody.append($('<tr>').append($('<td>', {rowspan: 3}).text("There was a problem, please try again in a few minutes.") ) ); } tableBody.parentNode.replaceChild(newTbody, tableBody); this._updateSubCount();
 if ( _status.subscriptions.length === 0 ) { _containerEl.querySelector('#browser_subscriptions').classList.add('hide'); } }; this._updateSubCount = function() { var l = _status.subscriptions.length; _containerEl.querySelector('#sub_count').innerHTML = l + ' browser' + (l !== 1 ? 's' : ''); if ( l < 1 ) { _containerEl.querySelector('#manage_browser_subs').classList.add('hide'); } else { _containerEl.querySelector('#manage_browser_subs').classList.remove('hide'); } }; this._injectHtml = function() { var html = " <div class=\"howto_turn_on_notifications hide\"> Your browser has blocked our request to enable notifications. Please check your browser settings and make sure you have notifications set to &quot;Allow&quot; for this website and try again. <a class=\"google_chrome blue hide\" href=\"https://support.google.com/chrome/answer/114662?visit_id=636707357896430487-3638612324&rd=1\" rel=\"noopener noreferrer\" target=\"_blank\">How to enable notifications in Google Chrome.</a> <a class=\"google_chrome_android blue hide\" href=\"https://support.google.com/chrome/answer/114662?visit_id=636707357896430487-3638612324&rd=1&co=GENIE.Platform%3DAndroid&oco=1\" rel=\"noopener noreferrer\" target=\"_blank\">How to enable notifications in Google Chrome on Android devices.</a> <a class=\"firefox blue hide\" href=\"https://support.mozilla.org/en-US/kb/push-notifications-firefox#w_upgraded-notifications\" rel=\"noopener noreferrer\" target=\"_blank\">How to enable notifications in Firefox.</a> </div> <div class=\"webpush_this_browser\"> <div class=\"webpush_not_supported hide\"> Unfortunately this browser or mobile device does not support web push notifications at this time. </div> <div class=\"webpush_this_browser_action\"> loading... </div> <div class=\"webpush_this_browser_enabled hide\"> <div class=\"webpush_this_browser_enabled_msg\">This browser will receive notifications!</div> <a href=\"#\" class=\"webpush_disable_notifications\">Stop sending notifications to this browser.</a> </div> <div class=\"webpush_this_browser_disabled hide\"> This browser has notifications turned off. <br> <a href=\"#\" class=\"button webpush_enable_notifications\">Turn Notifications On</a> </div> </div> <div class=\"webpush_browser_manage\"> You have a total of <span id=\"sub_count\">0 browsers</span> set to receive notifications. <a href=\"#\" id=\"manage_browser_subs\" class=\"hide\">Show</a> <table id=\"browser_subscriptions\" class=\"hide\"> <thead> <tr>\
 <th>Date Added</th> <th>User Agent</th> <th>Remove</th> </tr> </thead> <tbody> <tr> <td colspan=\"3\">Loading...</td> </tr> </tbody> <tfoot> </tfoot> </table> </div> "; _containerEl.innerHTML = html; }; this._requiresPWA = function() { return (typeof(nav.platform) === 'string' && nav.platform.match(/^(?:iPhone|iPad|Mac)/)) && (('ontouchstart' in win) && nav.maxTouchPoints > 0) && ('wakeLock' in nav); }; this.getBrowserStatus = function() { return _status.browserStatus; }; this.urlBasen outputArray; };
 } WebPushSubscriptions.isSupported = function() { var hasPush = !!( ('serviceWorker' in nav) && ('PushManager' in win) ); if ( ! hasPush ) { return false; } if ( typeof(nav.userAgent) === 'string' && nav.userAgent.match(/\sChrome.+\sIron\s/) ) { return false; } return true; }; return WebPushSubscriptions; })(window, document, navigator); return WebPushSubscriptions;}));

// js_build_core: MfcJs/MfcPurchase/MfcPurchase.js
function MfcPurchase(config){ config = config || {}; var _info_callback = config.info_callback || null; var _quickbuy_callback = config.quickbuy_callback || null; var _token = config.token; var _apiUrl = ( config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ); var _debug=0; var reqObj; if(window.navigator.appName.indexOf('Internet Explorer') > -1) reqObj = new ActiveXObject('Microsoft.XMLHTTP'); else reqObj = new XMLHttpRequest(); this.getPurchaseInfo = function(options) { options = options || {}; if(options.callback ) { _info_callback = options.callback; } var queryString = ''; for(var sK in options ) { if(sK == 'callback' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&'; } if(_debug ) console.log('CALL FOR ' + queryString ); var self = this; reqObj.open("GET",_apiUrl + '/purchase/info?' + queryString + '&no_cache=' + Math.random() ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.getPurchaseInfo_Response(options, queryString ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(); }; this.getPurchaseInfo_Response = function(options, queryString ) {
 if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText ); if(_debug ) console.log('CALLBACK FOR ' + queryString ); if(_info_callback ) { _info_callback(res ); } }; this.getQualifyPurchase = function(options) { if(options.callback ) { _info_callback = options.callback; } var queryString = ''; for(var sK in options ) { if(sK == 'callback' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&'; } if(_debug ) console.log('CALL FOR ' + queryString ); var self = this; reqObj.open("GET",_apiUrl + '/purchase/qualify_purchase?' + queryString + '&no_cache=' + Math.random() ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.getQualifyPurchase_Response(options, queryString ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(); }; this.getQualifyPurchase_Response = function(options, queryString ) { if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText ); if(_debug ) console.log('CALLBACK FOR ' + queryString ); if(_info_callback ) { _info_callback(res ); } }; this.postQuickbuy = function(options) { options = options || {}; if(options.callback ) { _quickbuy_callback = options.callback; }
 if(location.href.match('//m.') || location.href.match('//m-') ) { options.mobile_purchase = 1; } var data = ''; for(var sK in options ) { if(sK == 'callback' ) { continue; } data += sK + '=' + escape(options[sK] ) + '&'; } data += "&token=" + _token; if(_debug ) console.log('CALL FOR ' + data ); var self = this; reqObj.open("POST",_apiUrl + '/purchase/quickbuy' ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.postQuickbuy_Response(options, data ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(data ); }; this.postQuickbuy_Response = function(options, data ) { if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText ); if(_debug ) console.log('CALLBACK FOR ' + data ); if(_quickbuy_callback ) { _quickbuy_callback(res ); } };}

// js_build_core: MfcJs/MfcInChatPurchase/MfcInChatPurchase.js
function MfcInChatPurchase(options ){ options = options || {}; var _callback_message_func = options.callback_message_func || function() { console.log(arguments); }; var _get_user_tokens_remaining_func = options.get_user_tokens_remaining_func || function() { console.log('missing get_user_tokens_remaining_func func'); }; var _get_token_func = options.g token func'); }; var _get_purchase_link_func = options.get_purchase_link_func || null; var _self = this; this.selfId = ++MfcInChatPurchase.registerCx; MfcInChatPurchase.register[ this.selfId ] = _self; tthis.selfId ]; }; this.is,arguments); }; this.purchasePrompt = function() { var mfcPurchase = new MfcPurchase(); var result = mfcPurchase.getPurchaseInfo({ in_chat_purchalf,arguments); } }); }; this.quickbuy_purchase_info_callback = function(response ) { var sErrorMessage; if(typeof(response ) != 'object' ) sErrorMessage = 'response is not an object'; else if(response.err ) sErrorMessage = response.description || response.err; else if(response.purchase_limits && response.purchase_limits.err ) sErrorMessage = ( response.purchase_limits.description || response.purchase_limits.err ); else if(! response.available_quickbuy_processors || response.available_quickbuy_processors.length == 0 ) sErrorMessage = "no purchase processors available"; if(sErrorMessage ) { console.log('MfcInChatPurchase: ' + sErrorMessage );
 return; } if(response.disable_in_chat_quickbuy ) return; _self.products = response.products; var aAvailableVolumes = []; var sInfo=''; var aAvailableVolumes=[]; var aFoundProcs=[]; for(var nProdId in response.products ) { var hProd = response.products[ nProdId ]; aAvailableVolumes.push("<a href=# onClick=\" event.preventDefault(); MfcInChatPurchase.register[ " + this.selfId + " ].confirm_purchase({ product_id: " + hProd.id + "}); return false; \">" + '<b>'+ hProd.volume + '</b></a>' ); for(var b=0; b < hProd.available_processors.length; b++ ) { aFoundProcs.push(hProd.available_processors[b] ); } } var sTokenPurchaseOptions = aAvailableVolumes.join('|'); sTokenPurchaseOptions = sTokenPurchaseOptions.replace(/\|([^\|]*)$/," or $1"); sTokenPurchaseOptions = sTokenPurchaseOptions.replace(/\|/g,", "); var nPriorityProcessor=''; for(var a=0; a < response.processor_priority.length; a++ ) { if(aFoundProcs.indexOf(response.processor_priority[a] ) > -1 ) { nPriorityProcessor = response.processor_priority[a]; break; } } var sInfo=''; sInfo += "QuickBuy: " + sTokenPurchaseOptions + " tokens via <b>" + response.processors[nPriorityProcessor]['name'] + "</b>"; sInfo += "<div class=inChatPurchase_openMenu onClick=\" window.open('//www.' + document.domain + '/php/account.php?request=status&disable_in_chat_quickbuy=1#purchase_options'); \">x</div>"; _callback_message_func(sInfo ); }; this.confirm_purchase = function(options ) { var product = this.products && this.products[ options.product_id ];
 if(! product ) { _callback_message_func("Error #30001"); return; } var sHtml = " <a href=# onClick=\" event.preventDefault(); MfcInChatPurchase.register[ " + this.selfId + " ].initiate_purchase({ volume: " + product.volume + "}); return false; \">" + "Click to confirm your purchase of <b>" + product.volume + " tokens</b> for <b>$" + product.amount + "</b></a> "; _callback_message_func(sHtml ); }; this.initiate_purchase = function(options ) { options = options || {}; if(MfcInChatPurchase.setQuickbuyLock ) { _callback_message_func("Please wait a few more moments before using another QuickBuy request."); return; } var mfcPurchase = new MfcPurchase(); result = mfcPurchase.getQualifyPurchase({ in_chat_purchase: 1, volume: options.volume, volume_type: 'token', callback: function() { _self.quickbuy_qualify_purchase_callback.apply(this,arguments); } }); }; this.quickbuy_qualify_purchase_callback = function(response ) { var sErrorMessage; if(typeof(response ) != 'object' ) sErrorMessage = '10001'; else if(response.err ) sErrorMessage = response.description || response.code || response.err; else if(! response.success ) sErrorMessage = "QuckBuy via chat command is not available at the moment."; else if(response.err ) sErrorMessage = response.description || response.err; else if(! response.product ) sErrorMessage = "A product was not returned."; else if(! response.processor ) sErrorMessage = "A processor was not returned."; if(response.code == "invalid_price_point" ) {
 sErrorMessage += " Type /quickbuy to see a list of available token packages. "; } else if(response.code == 'no_prev_purchase' || response.code == 'no_processor' ) { sErrorMessage = " In order to purchase with QuickBuy, you must first complete a regular purchase."; if(typeof(_get_purchase_link_func)=='function' ) { sErrorMessage += " " + _get_purchase_link_func() + "Click here to view available token packages</a>."; } } if(sErrorMessage ) { _callback_message_func(sErrorMessage); return; } var sMessage = "Processing QuickBuy transaction for " + ( response.product && response.product.name ) + " through " + ( response.processor && response.processor.name ) + "..."; _callback_message_func(sMessage ); MfcInChatPurchase.setQuickbuyLock = true; setTimeout(function(){ MfcInChatPurchase.setQuickbuyLock = false; }, 30000 ); var mfcPurchase = new MfcPurchase({ token: _get_token_func() }); result = mfcPurchase.postQuickbuy({ in_chat_purchase: 1, product_id: response.produis,arguments); } }); }; this.quickbuy_purchase_quickbuy_callback = function(response ) { var nError; if(! response || typeof(response ) != 'object' ) { _callback_message_func('QuickBuy is not available (error #20001). Please contact support for assistance.'); } MfcInChatPurchase.setQuickbuyLock = false; if(response.success ) { sMessage = "You have purchased " + response.product.description + " for $" + response.product.amount; if(response.processor && response.processor.name ) sMessage += " through " + response.processor.name; sMessage += ". ";
 if(response.purchase_result && response.purchase_result.purchase_id ) sMessage += "Your transaction reference number is #<b>" + response.purchase_result.purchase_id + "</b>. "; sMessage += "Your token balance has now been updated. Thank you! "; _callback_message_func(sMessage ); } else { var sMessage = "We were unable to carry out the purchase for the following reason: "; if(response.brief || response.description ) { if(response.brief ) { sMessage += response.brief + ". "; } if(response.description ) { sMessage += response.description; } } else { sMessage += "Error #" + ( response.err || -99 ); } _callback_message_func(sMessage ); } };};MfcInChatPurchase.setQuickbuyLock = false;MfcInChatPurchase.registerCx = 0;MfcInChatPurchase.register = {};

// js_build_core: MfcJs/MfcInChatPromo/MfcInChatPromo.js
function MfcInChatPromo(_conf ){ _conf = _conf || {}; var _self = this; this.share_things = { 'album': { img_host: ( 'https://share-thumbs.' + g_hPlatform.domain ), abbrev: 'a' }, 'club': { img_host: ( 'https://share-media.' + g_hPlatform.domain ), abbrev: 'm' }, 'goal': { img_host: ( 'https://share-media.' + g_hPlatform.domain ), abbrev: 'g' } }; this.a_share = _conf.a_share || function(opts ) { var sPath = opts.path || opts.username || ''; if(window.NightMode && NightMode.enabled ) sPath += ( sPath.indexOf('?') > -1 ? '&' : '?' ) + 'color_scheme_dark=true'; return "<a href=\"//share." + _conf.platform.domain + "/" + sPath + "\" target=\"_blank\" rel=\"noopener\">"; }; this.a_social = _conf.a_social || function(opts ) { var sPath = opts.path || opts.username || ''; return "<a href=\"//social." + _conf.platform.domain + "/" + sPath + "\" target=\"_blank\" rel=\"noopener\">"; }; this.get_promo_html = function(conf ) { for(var k in conf ) { _conf[k] = conf[k]; } var aThings=[]; var sWBIcon=''; if(_conf.platform.id == PLAT_CAM ) { sWBIcon = " <img src=" + _conf.platform.image_url_cdn + "images/flat/stroke/svg/imac-1.svg>"; } if(_conf.has_whiteboard ) {
 aThings.push("an active " + _conf.a_whiteboard + "Whiteboard" + sWBIcon + "</a>"); } var sMsg = ''; if(_conf.platform.id == PLAT_MFC && _conf.share && _conf.share['things'] > 0 ) { var sLogoFile = typeof(t) === 'object' && t.NightMode_Top && t.NightMode_Top.enabled ? 'MFC_Share-gray.svg' : 'MFC_Share.svg'; sLogoFile = _conf.platform.image_url_cdn + "images/svg/" + sLogoFile; var sNew=''; for(var sK in _conf.share ) { if(_conf.share[ sK ] > 0 && ( sK == 'albums' || sK == 'clubs' || sK == 'collections' || sK == 'goals' || sK == 'polls' || sK == 'stores' ) ) { var thing = sK.replace(/s$/,''); var tm; if(this.share_things[ thing ] && ( tm = _conf.share['recent_'+thing+'_tm'] ) ) { var d1 = new Date(tm * 1000); var d2 = new Date(); var utc1 = Date.UTC(d1.getFullYear(), d1.getMonth(), d1.getDate()); var utc2 = Date.UTC(d2.getFullYear(), d2.getMonth(), d2.getDate()); var diffInHOurs = Math.ceil((utc2 - utc1) / ( 1000 * 60 * 60 )); diffInDays = Math.floor(diffInHOurs / 24 ); if(diffInDays <= 7 ) { var sImg = _conf.share['recent_'+thing+'_thumb'] ? decodeURIComponent(_conf.share['recent_'+thing+'_thumb'] ) : ''; var sSlug; if(_conf.share['recent_'+thing+'_slug'] ) { sSlug = _conf.share['recent_'+thing+'_slug']; } else if(sImg.match(/\/(\w{8})\//) ) { sSlug = RegExp.$1; }
 var sThingPath = ''; if(sSlug ) { sThingPath = this.share_things[ thing ].abbrev + '/' + sSlug; } sNew = "a new " + thing + " on " + this.a_share({ username: _conf.username, path: _conf.username })
 + "<img class=MfcInChatPromo_MFCShare_logo src=\"" + sLogoFile + "\" title=\"" + _conf.username + "'s MFC Share\"></a> \""; var sATag=''; if(sThingPath ) { sATag = this.a_share({ username: _conf.username, path: sThingPath }); } else { sATag = this.a_share({ username: _conf.username, path: _conf.username }); } sNew += sATag + decodeURIComponent(_conf.share['recent_'+thing+'_title'] ).replace(/</g,'&lt;') + "</a>\""; if(_conf.share['recent_'+thing+'_thumb'] ) { var sSrc = this.share_things[ thing ].img_host + '/' + decodeURIComponent(_conf.share['recent_'+thing+'_thumb'] ); sNew += sATag; sNew += "<img class=mfcshare_inchat_thumb style=\"height:40px;\" src=\"" + sSrc + "\" onerror=\"this.style.display='none';\" data-imgsrc=\"" + sSrc + "\" onmouseenter=\" MfcInChatPromo.pop_image_hover(event);\" onmouseleave=\" MfcInChatPromo.pop_image_hover(event);\" >"; sNew += "</a>"; } sNew += "</a>"; } } } } if(sNew ) { sMsg += sNew; } else { if(_conf.share['albums'] ) sMsg += this.a_share({ username: _conf.username, path: _conf.username }) + parseInt(_conf.share.albums) + " album" + ( _conf.share['albums'] > 1 ? 's':'' ) + "</a> on "; sMsg += this.a_share({ username: _conf.username, path: _conf.username }) + "<img class=MfcInChatPromo_MFCShare_logo src=\"" + sLogoFile + "\" title=\"" + _conf.username + "'s MFC Share\"  ></a>"; }
 aThings.push(sMsg); if(_conf.share['tipmenus'] ) { sMsg = "a "; if(_conf.a_tipmenu ) sMsg += _conf.a_tipmenu; else sMsg += this.a_share({ username: _conf.username, path: _conf.username }); sMsg += "Tip Menu</a> "; aThings.push(sMsg); } } var sMsg=''; if(_conf.platform.id == PLAT_MFC && _conf.social ) { var hSocial = _conf.social; if(( Date.now()/1000 ) - hSocial.tm_post < 172800 ) { aThings.push("new posts on " + this.a_social({ path: hSocial.uname }) + "MFC Social</a>"); } } var sMsg=''; if(aThings.length > 0 ) { sMsg = _conf.username + " has " + aThings.join('&nbsp;and&nbsp;'); if(aThings.length > 2 ) sMsg = sMsg.replace(/&nbsp;and&nbsp;/,', '); } return sMsg; };};MfcInChatPromo.pop_image_hover = function(oEvent, sAction ){ if(! window.MfcDhtmlPopup ) { return; } if(oEvent.type == 'mouseleave' && this.MfcDhtmlPopup_pop_image_hover )
 { this.MfcDhtmlPopup_pop_image_hover.close(); } else if(oEvent.type == 'mouseenter' ) { sH = `<img style="height:${oEvent.target.naturalHeight}px;width:${oEvent.target.naturalWidth}px;" src=${oEvent.target.dataset.imgsrc}>`; this.MfcDhtmlPopup_pop_image_hover = new MfcDhtmlPopup({}); this.MfcDhtmlPopup_pop_image_hover.open(sH,{ 'hover': true, 'hover_offset': 100 }); }};

// js_build_core: MfcJs/MfcTip/MfcTip.js
function MfcTip(hOptions ){ this.oReq = createRequestObject(); this.config = {}; this.apiUrl = ( hOptions.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ) + '/tip'; for(var sK in hOptions ) { this.config[sK] = hOptions[sK]; }};MfcTip.prototype.Request = function(hOptions ){ for(var sK in hOptions ) { this.config[sK] = hOptions[sK]; } this.config.anonymous = this.config.anonymous != undefined ? this.config.anonymous : 0;
 this.config.public = this.config.public != undefined ? this.config.public : 1; this.config.public_comment = this.config.public_comment != undefined ? this.config.public_comment : 1; this.config.silent = this.config.silent != undefined ? this.config.silent : 0; this.config.hide_amount = this.config.hide_amount != undefined ? this.config.hide_amount : 0; this.config.usersession = this.config.usersession != undefined ? this.config.usersession : 0; this.config.chat_command = this.config.chat_command ? this.config.chat_command : 0; if(! this.config.token ) { return { "success": false, "message": "token required." }; } if(this.config.access_level != 2 && this.config.access_level != 5 ) { return { "success": false, "message": "You must be a Premium Member in order to use this feature." }; } if(this.config.broadcaster_id ) { this.config.broadcaster_id = this.config.broadcaster_id.toString().replace(/\D/g,''); } if(! this.config.broadcaster_id ) { return { "success": false, "message": "broadcaster_id required." }; } if(! this.config.tip_value ) { return { "success": false, "message": "Tip amount required." }; } if(this.config.tip_value.match(/\D/) ) { return { "success": false, "message": "Tip amount must be a numeric value." }; } if(this.config.comment && this.config.anonymous && this.config.public_comment && this.config.public ) { return { "success": false, "message": " Anonymous tips may not have a public message. <a href='http://wiki." + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") + "/wiki/Chat_Commands' target=_blank>Click here for usage examples</a>. " }; } if(this.config.tip_value < 5 && typeof(this.config.comment) == 'string' && this.config.comment.match(/\S/) ) { return { "success": false, "message": "Your tip of " + this.config.tip_value + " tokens was not sent because it contained a message. Only tips of 5 tokens and higher may contain a message." }; } if(this.config.public != 1 ) { this.config.public_comment = 0; } var sRequest = this.apiUrl; var sData = '' + 'recipient_id=' + this.config.broadcaster_id + '&' + 'tip_amount=' + this.config.tip_value + '&' + 'anonymous=' + this.config.anonymous + '&'
 + 'comment=' + encodeURIComponent(this.config.comment) + '&' + 'public=' + this.config.public + '&' + 'public_comment=' + this.config.public_comment + '&' + 'silent=' + this.config.silent + '&' + 'hide_amount=' + this.config.hide_amount + '&' + 'token=' + this.config.token + '&' + 'chat_command=' + this.config.chat_command + '&' ; this.oReq.open("POST", sRequest ); this.oReq.withCredentials = true; this.oReq.setRequestHeader("Content-type", "application/x-www-form-urlencoded"); var self = this; this.oReq.onreadystatechange = function() { self.Response(); }; this.oReq.send(sData); return { "success": true };};MfcTip.prototype.Response = function(){ if(this.oReq.readyState != 4 ) { return; } var oResponse = JSON.parse(decodeURIComponent(this.oReq.responseText ) ); if(this.config.callback ) this.config.callback(oResponse); else return oResponse;};

// js_build_core: MfcJs/MfcLists/MfcLists.js
function MfcLists(config){ config = config || {}; var _get_callback = config.get_callback || null; var _manage_callback = config.manage_callback || null; var _token = config.token; var _apiUrl = ( config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ); var _debug=0; var reqObj; if(window.navigator.appName.indexOf('Internet Explorer') > -1) reqObj = new ActiveXObject('Microsoft.XMLHTTP'); else reqObj = new XMLHttpRequest(); this.getList = function(list,options) { options = options || {}; if(options.callback ) { _info_callback = options.callback; } var queryString = ''; for(var sK in options ) { if(sK == 'callback' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&'; } if(_debug ) console.log('CALL FOR ' + queryString ); var self = this; var args = arguments; reqObj.open("GET",_apiUrl + '/lists/' + list + '?' + queryString + '&no_cache=' + Math.random() ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.getList_Response(args, queryString ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(); }; this.getList_Response = function(args, queryString ) { if(reqObj.readyState != 4 ) { return; }
 if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText ); if(_debug ) console.log('CALLBACK FOR ' + queryString ); if(_get_callback ) { _get_callback(args, res ); } if(args[3].callback ) { args[3].callback(args, res ); } }; this.manageList = function(list, op, user_id, options ) { options = options || {}; if(options.callback ) { _quickbuy_callback = options.callback; } var data = ''; for(var sK in options ) { if(sK == 'callback' ) { continue; } data += sK + '=' + escape(options[sK] ) + '&'; } data += "&token=" + _token; if(_debug ) console.log('CALL FOR ' + data ); var self = this; var args = arguments; reqObj.open(op,_apiUrl + '/lists/' + list + '/' + user_id ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { self.manageList_Response(args, data ) }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(data ); }; this.manageList_Response = function(args, data ) { if(reqObj.readyState != 4 ) { return; } if(_debug ) console.log(reqObj.responseText ); var res = JSON.parse(reqObj.responseText ); if(_debug ) console.log('CALLBACK FOR ' + data ); if(_manage_callback ) { _manage_callback(args, res ); } if(args[3].callback ) { args[3].callback(args, res ); } };
}

// js_build_core: MfcJs/MfcToken/MfcToken.js
function MfcToken(config){ config = config || {}; var _apiUrl = ( config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ); var tokenReq = new XMLHttpRequest(); this.get = function(options) { options = options || {}; tokenReq.open("GET",_apiUrl + '/token' ); tokenReq.withCredentials = true; tokenReq.onreadystatechange = function() { if(tokenReq.readyState != 4 ) { return; } var res={}; try { res = JSON.parse(tokenReq.responseText ); } catch(e) { console.log(e); } if(res && res.result ) { this.token = res.result.token; } if(options.callback ) { options.callback(this.token,options); } return this.token; }; tokenReq.send(); };}

// js_build_core: MfcJs/MfcUserExtensions/MfcUserExtensions.js
function MfcUserExtensions(config){ config = config || {}; var _apiUrl = ( config.api_url || ( MfcClientRes && MfcClientRes.apiUrl ) || ( '//api-edge.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") ) ); var _debug=0; var _token = config.token; this.local = {}; this.getReqObj = function() { var reqObj; if(window.navigator.appName.indexOf('Internet Explorer') > -1) reqObj = new ActiveXObject('Microsoft.XMLHTTP'); else reqObj = new XMLHttpRequest(); return reqObj; }; this.get = function(name,options) { name = name || {};
 options = options || {}; if(typeof(name) == 'object' && isArray(name) ) { options.names = name; options.include_defaults = true; } else if(typeof(name) == 'object' ) { options = name; options.include_defaults = true; } else { options.name = name; } options.method = 'GET'; options.return_ue_sets = true; this.call(options); }; this.value = function(name) { return ( this.local[name] && ( typeof(this.local[name].value) != 'undefined' ) ) ? this.local[name].value : null; }; this.put = function(name,value,options) { options = options || {}; options.method = 'PUT'; options.name = name; options.value = value; this.call(options); }; this.del = function(name,options) { options = options || {}; options.method = 'DELETE'; options.name = name; options.value = null; this.call(options); }; this.call = function(options) { options = options || {};
 if(! options.method ) { console.log('MfcUserExtensions called without a method'); return; } if(! options.name && ! options.include_defaults && options.method != 'GET' ) { console.log('MfcUserExtensions called with ' + options.method + ' but without name',options); return; } if(options.method != 'GET' ) { if(typeof(options.before_update ) == 'function' ) { options.before_update(options ); } if(typeof(config.before_update ) == 'function' ) { config.before_update(options ); } } if(! _token && ! this.tokenRequested ) { var _mfcToken = new MfcToken(); var self = this; this.tokenRequested = true; _mfcToken.gcall(options); }}); return; } var reqObj = this.getReqObj(); if(options.success ) { _info_success = options.success; } var queryString = ''; options['token'] = _token; options['no_cache'] = Math.random(); for(var sK in options ) { if(sK == 'success' || sK == 'method' || sK == 'name' || sK == 'names' ) { continue; } queryString += sK + '=' + escape(options[sK] ) + '&'; } if(_debug ) console.log('CALL FOR ' + queryString ); var method = options.method || 'GET'; var path; if(options.include_defaults ) {
 path = ''; } else { if(options.names ) { path = '/' + options.names.join(','); } else { path = '/' + options.name; } } var self = this; reqObj.open(method, _apiUrl + '/ue' + path + ( method == 'GET' ? ( '?' + queryString ) : '') ); reqObj.withCredentials = true; reqObj.onreadystatechange = function() { if(reqObj.readyState != 4 ) { return; } var res = JSON.parse(reqObj.responseText ); if(res.err ) { if(options.method == 'PUT' && config.put_error ) { config.put_error(options,res); } else if(options.method == 'GET' && config.get_error ) { config.get_error(options,res); } else if(options.method == 'DELETE' && config.delete_error ) { config.delete_error(options,res); } if(config.error ) { config.error(options,res); } if(options.error ) { options.error(options,res); } else { console.log("An error occurred; " + ( res && res.errmsg ) + " for " + ( options.method ), options ); } } else { var fixed_res = res; if(options.method == 'PUT' ) { if ( !!_debug && fixed_res.result.ue != options.value ) { console.log('Error: passed in param does not match value returned:'+options.value+' :: '+fixed_res.result.ue); } if ( self.local && Object.keys(self.local).length != 0 && fixed_res.result.ue != -1 ) { if(typeof(self.local[ options.name ] ) == 'undefined' ) { self.local[ options.name ] = {}; } self.local[ options.name ]['value'] = options.value; }
 if(config.put_success ) { config.put_success(options,fixed_res); } } else if(options.method == 'GET' ) { fixed_res = res.result.ue; for(var k in res.result.ue ) { self.local[ k ] = res.result.ue[k]; } if(res.result.user ) { self.user = res.result.user; } if(config.get_success ) { config.get_success(options,fixed_res); } } else if(options.method == 'DELETE' ) { fixed_res = self.local[ options.name ] || {}; fixed_res[ options.name ]['name'] = options.name; fixed_res[ options.name ]['value'] = null; delete this.local[ options.name ]; if(config.delete_success ) { config.delete_success(options,fixed_res); } } if(config.success ) { config.success(options,fixed_res); } if(options.success ) { options.success(options,fixed_res); } if(options.method != 'GET' ) { if(typeof(options.after_update ) == 'function' ) { options.after_update(options, fixed_res ); } if(typeof(config.after_update ) == 'function' ) { config.after_update(options, fixed_res ); } } } }; reqObj.setRequestHeader("Content-type","application/x-www-form-urlencoded"); reqObj.send(method != 'GET' && queryString ); };};

// js_build_core: js/pathing.js
var g_Paths = { phpPathProxy: "/php/proxy.php", phpPathMobj: "/php/modelobject.php", phpPathLogin: "/php/login.php", phpPathSignup: "/php/signup.php", phpPathNewsFeed: "/php/news_feed.php", phpPathAccount: "/php/account.php", phpPathUserSettings: "/php/user_settings.php", phpPathUserNotepad: "/php/user_notepad.php", phpPathPublic: "/php/", phpPathFcwExtResp: "/php/FcwExtResp.php", jsPathZgwProxy: "/js/zgw_proxy.js", jsPathWsGw: "/js/wsgw.js", jsPathFlashsocketGlobal: "/js/flashsocket_global.js", htmlPathMainTpl: "/html/main_template.html", soundsPath: "/sounds/", flashPath: "/flash/", flashMfcChat: "/flash/MfcChat.swf", flashMfcChat4: "/flash/MfcChat4.swf", jsPathNews: "/js/news.js", jsPathServerconfig: "/_js/serverconfig.js", jsMfcBroadcasterDisplay: "/js/MfcBroadcasterDisplay.js", imgClear: "/images/clear.gif", imgPathPublic: "/images", imgSvgPathPublic: "/images", imgCsCrosshairs: "/images/crosshairs.png", imgCsH: "/images/h.png", imgCsPosition: "/images/position.png", imgCsSv: "/images/sv.png", htmlPublicViews: "/html/"};

// js_build_core: js/NightMode.js
var NightMode = { enabled: ( ( window.t && t.NightMode_Top && t.NightMode_Top.enabled ) || ( ( ! window.t || ! window.t.NightMode_Top ) && location.search.indexOf('night_mode=') > -1 ) ) ? true : false , simpleEnabled : ( location.search.indexOf('night_mode=2') > -1 ) ? true : false, sNumberSign: '', hStyleAlterations: { raw_css: { 0: " ::-webkit-scrollbar { background-color: #FFFFFF; width: 17px; } ::-webkit-scrollbar-track{ background-color: #DDDDDD; border-left:1px solid #DDDDDD; width:17px; } ::-webkit-scrollbar-thumb{ border:3px solid #DDDDDD; webkit-border-radius: 17px; border-radius: 17px; background: #FFFFFF; } ", 1: " ::-webkit-scrollbar { background-color: #151515; width: 17px; } ::-webkit-scrollbar-track{ background-color: #222222; border-left:1px solid #222; width:17px; } ::-webkit-scrollbar-thumb{ border:3px solid #222222; webkit-border-radius: 17px; border-radius: 17px; background: #224422; } " }, classes: { } }, hOriginalStyles: {}, hRegExpCache: {}, bUseRegExpCache: true};NightMode.cssText_cache = {};NightMode.Apply = function(bEnabled, o ){ if(! document ) { return false; } if(! window.t || ! t.g_hPlatform || t.g_hPlatform.id != window.PLAT_MFC ) { return; } if(window.isCrossSiteIframe ) { return false; } var options = o || {}; var outer_class = 'nightmode';  var aStyleSheets = document.styleSheets; if(! aStyleSheets ) { return false; }
 if(! aStyleSheets.length ) { return false; } if(typeof(bEnabled) == 'undefined' && window.t && t.NightMode_Top && t.NightMode_Top.enabled ) { bEnabled = t.NightMode_Top.enabled; } if(NightMode.enabled != bEnabled ) { document.body.classList.add('nightmode_transiti_transition'); },1000); } NightMode.enabled = bEnabled; if(bEnabled ) { document.body.classList.add(outer_class); } else { document.body.classList.remove(outer_class); } var nStyle = t && t.NightMode && t.NightMode.enabled ? 1 : 0; NightMode.nCurStyleSet = nStyle; if(! NightMode.nCurStyleSet ) { var oEl = document.getElementById('NightMode_style'); if(oEl ) { oEl.parentNode.removeChild(oEl);
 } if(document && document.body ) removeClass(document.body, outer_class); } else { if(document && document.body ) addClass(document.body, outer_class); } return true;};NightMode.ValidateHex = function(hexnum ){ if(typeof(hexnum) == 'undefined' || hexnum == '' ) { return; } if(typeof(hexnum) == 'number' ) { hexnum = hexnum.toString(); } if(hexnum.length == 3) hexnum = hexnum.charAt(0) + hexnum.charAt(0) + hexnum.charAt(1) + hexnum.charAt(1) + hexnum.charAt(2) + hexnum.charAt(2); if(hexnum.length != 6 && hexnum.charAt(0) != '#') { console.log("Hex color must be six hex numbers in length: " + hexnum ); return ''; } NightMode.sNumberSign=''; if(hexnum.charAt(0) == '#' ) { NightMode.sNumberSign = '#'; hexnum = hexnum.substr(1); }
 return hexnum;};NightMode.Lighten = function(hexnum ){ if(! ( hexnum = NightMode.ValidateHex(hexnum) ) ) { return ''; } hexnum.match(/(\w\w)(\w\w)(\w\w)/); var RGB = { R: parseInt(RegExp.$1,16), G: parseInt(RegExp.$2,16), B: parseInt(RegExp.$3,16) }; var sLighter = ''; for(var sColor in RGB ) { if(RGB[sColor] < 128 ) { RGB[sColor] = 128; } RGB[sColor] = RGB[sColor] + parseInt(( 1 - ( RGB[sColor] / 255 ) ) * RGB[sColor] ); if(RGB[sColor] < 16 ) sLighter += '0' + RGB[sColor].toString(16); else sLighter += RGB[sColor].toString(16); } return NightMode.sNumberSign + sLighter;};NightMode.HexInvert = function(hexnum ){ if(! ( hexnum = NightMode.ValidateHex(hexnum) ) ) { return ''; } hexnum = hexnum.toUpperCase(); var splitnum = hexnum.split(""); var resultnum = ""; var simplenum = ['F','E','D','C','B','A','9','8','7','6']; var complexnum = { A: '5', B: '4', C: '3', D: '2', E: '1', F: '0' }; for(var i=0; i<6; i++){ if(!isNaN(splitnum[i])) { resultnum += simplenum[splitnum[i]]; } else if(complexnum[splitnum[i]]){ resultnum += complexnum[splitnum[i]]; } else { resultnum += '0'; console.log("Hex colors must only include hex numbers 0-9, and A-F: " + hexnum ); } } 
 return NightMode.sNumberSign + resultnum;};NightMode.RGBtoHex = function(sRGB ){ if(typeof(sRGB) != 'string' ) { return ''; } var aMatches = sRGB.match(/(\d+)/g); if(! aMatches || ! aMatches[2] ) { return sRGB; } sHex = ''; for(var a=0; a<aMatches.length; a++ ) sHex += MfcStringUtilities.char_padding(parseInt(aMatches[a] ).toString(16), 2, 0 ); return '#' + sHex;};NightMode.Load = function(hOpts ){ hOpts = hOpts || {}; if(window.NightMode_loadComplete ) { return; } if(window.NightMode_runOnce && ! hOpts.followup ) { return; } window.NightMode_runOnce = true; if(window.t && window.t.NightMode && t.NightMode.enabled && document.body ) { window.NightMode_loadComplete = 1; clearTimeout(window.NightMode_runOnce_timer ); NightMode.Apply(NightMode.enabled ); if(NightMode.enabled ) { for(var a=0; a < document.forms.length; a++ ) { if(document.forms[a].action && document.forms[a].action.indexOf('night_mode=1') == -1 ) document.forms[a].action += ( document.forms[a].action.indexOf('?') == -1 ? '?':'&' ) + 'night_mode=1'; } var aTags = document.getElementsByTagName('a'); for (var a = 0; a < aTags.length; a++) { if(aTags[a].href && aTags[a].href && aTags[a].href.indexOf(document.domain) > -1 && aTags[a].href.indexOf('night_mode=1') == -1 ) aTags[a].href += ( aTags[a].href.indexOf('?') == -1 ? '?':'&' ) + 'night_mode=1'; } } }
 else { var nWaitTime = NightMode.loadCounter * 25; if(NightMode.loadCounter < 50 ) { clearTimeout(window.NightMode_runOnce_timer ); window.NightMode_runOnce_tiowup': true }) },nWaitTime); } NightMode.loadCounter++; }};NightMode.loadCounter=0;

// js_build_core: js/MfcUserNotepad.js
var MfcUserNotepad = {};MfcUserNotepad.generateEntryDate = function(){ var oDate = new Date(); var hMonths = ["","January","February","March","April","May","June","July","August","September","October","November","December"]; var sDateString = "[ " + hMonths[oDate.getMonth() + 1] + " " + oDate.getDate(); if(oDate.getDate() == 1 || oDate.getDate() == 21 || oDate.getDate() == 31 ) sDateString += 'st'; else if(oDate.getDate() == 2 || oDate.getDate() == 22 ) sDateString += 'nd'; else if(oDate.getDate() == 3 || oDate.getDate() == 23 ) sDateString += 'rd'; else sDateString += 'th'; if(oDate.getYear() < 200 ) { sDateString += " '" + MfcStringUtilities.char_padding(oDate.getYear() - 100 ,2,0) + " ]"; } else { sDateString += " '" + MfcStringUtilities.char_padding(oDate.getYear() - 2000 ,2,0) + " ]"; } return sDateString;};

// js_build_core: js/MfcUtilities.js
var t = t || {};var d = d || document;var URLEncoding = { encode: function(str, key ) { if(key != 'topic' && key != 'cmesg' && key != 'pmesg' ) { return str; } else { return encodeURIComponent(str); } }, decode: function(str, key ) { if(key != 'topic' && key != 'cmesg' && key != 'pmesg' ) { return str; } else { try { return decodeURIComponent(str); } catch(e) { console.log(e); console.log(str); } return str; } }
};function SetHTML(element, sContent, hOptions, temp ){ if(! SetHTML.hCache ) { SetHTML.hCache = {}; } hOptions = hOptions || {}; var oDocRef = hOptions.doc_ref || document; var oEl; if(typeof(element) == 'object' && element.id ) oEl = element; else oEl = GetEl(element, oDocRef ); for(var oDocument in SetHTML.hCache ) { if(! oDocument ) { delete SetHTML.hCache[ oDocument ]; } } if(oEl && hOptions.force ) { oEl.innerHTML = sContent; } else if(oEl ) { var bRefresh = true; if(sContent.length < 10000 ) { if(! SetHTML.hCache[ oDocRef ] ) { SetHTML.hCache[ oDocRef ] = {}; } if(SetHTML.hCache[ oDocRef ][ element ] != undefined && SetHTML.hCache[ oDocRef ][ element ] == sContent ) { bRefresh = false; } else { SetHTML.hCache[ oDocRef ][ element ] = sContent; } } else if(SetHTML.hCache[ oDocRef ] && SetHTML.hCache[ oDocRef ][ element ] != undefined ) { delete SetHTML.hCache[ oDocRef ][ element ]; }
 if(bRefresh ) { oEl.innerHTML = sContent; } }}function GetHTML(element, oDocRef ){ oDocRef = oDocRef || document; return GetEl(element, oDocRef ).innerHTML;}function GetElsByClass(sClassName, oDocRef) { oDocRef = oDocRef || document; var tmp; if (typeof sClassName === 'object' && typeof oDocRef === 'string') { tmp = oDocRef; oDocRef = sClassName; sClassName = tmp; } return oDocRef.getElementsByClassName(sClassName);}function GetEl(sElementId, oDocRef ){ oDocRef = oDocRef || document; var tmp; if(typeof(sElementId) == 'object' && typeof(oDocRef) == 'string' ) { tmp = oDocRef; oDocRef = sElementId; sElementId = tmp; } return oDocRef.getElementById(sElementId );}function IsBroadcastState(nState){ if(nState < FCS.FCVIDEO_RX_IDLE ) { return true; } return false;}function IsOnline(nState){
 return (parseInt(nState) != FCS.FCVIDEO_OFFLINE);}function IsSessionState(xState){ var nState = parseInt(xState); return ( nState == FCS.FCVIDEO_TX_PVT || nState == FCS.FCVIDEO_RX_PVT || nState == FCS.FCVIDEO_RX_VOY || nState == FCS.FCVIDEO_RX_GRP || nState == FCS.FCVIDEO_TX_GRP || nState == FCS.FCVIDEO_RX_CLUB || nState == FCS.FCVIDEO_TX_CLUB );}function _pid_assert(nExpectedPlatform, sMsg){ if (t && t.g_hPlatform && t.g_hPlatform.id != nExpectedPlatform) { Log('PLATFORM EXCEPTIarseInt(nUser);}function SessionChannel(xChan){ var nChan = parseInt(xChan); var nVal = 0; _pid_assert(PLAT_MFC, 'SessionChannel called from wrong platform'); if (nChan < FCS.CHANNEL_ID_START ) nVal = FCS.SESSCHAN_ID_START; else if ( nChan >= FCS.CHANNEL_ID_START && nChan < FCS.SESSCHAN_ID_START ) nVal = FCS.CHANNEL_ID_START; else if (nChan >= FCS.SESSCHAN_ID_START && nChan < FCS.CAMCHAN_ID_START) nVal = 0; return nChan + nVal;}function SessionToPublic(xChan)
{ var nChan = parseInt(xChan); if (nChan >= FCS.CHANNEL_ID_START && nChan < FCS.SESSCHAN_ID_START) return nChan; else if (nChan >= FCS.SESSCHAN_ID_START && nChan < FCS.CAMCHAN_ID_START) return nChan - FCS.CHANNEL_ID_START; else if (nChan < FCS.CHANNEL_ID_START) return nChan + FCS.CHANNEL_ID_START; return 0;}function ChannelModel(nChan){ var nModel = parseInt(nChan); while (nModel > FCS.CHANNEL_ID_START) nModel -= FCS.CHANNEL_ID_START; return nModel;}function getFlashObject(sFlashId,oD,oW){ if ( window.frames && window.frames.video_frame && window.frames.video_frame.GetVideo ) { return window.frames.video_frame.GetVideo(); } var oW = oW || window; var oD = oD || document; if (oW.document[sFlashId]) return oW.document[sFlashId]; if (navigator.appName.indexOf("Microsoft Internet")==-1) { if (oD.embeds && oD.embeds[sFlashId]) { return oD.embeds[sFlashId]; } } else
 { return oD.getElementById(sFlashId); }}function escapeHtml(unsafe){ if(typeof(unsafe) != 'string' ) { return unsafe; } return unsafe .replace(/&/g, "&amp;") .replace(/</g, "&lt;") .replace(/>/g, "&gt;") .replace(/"/g, "&quot;") .replace(/'/g, "&#039;");}function getAbsoluteOffset(sIdOrElement ){ var oElement; if(typeof(sIdOrElement ) == 'string' ) { oElement = GetEl(sIdOrElement ); } else { oElement = sIdOrElement; } if(! oElement ) { return; } var top = 0, left = 0; do { top += oElement.offsetTop || 0; left += oElement.offsetLeft || 0; oElement = oElement.offsetParent; } while(oElement); return { y: top, x: left };}function getRelativeOffset(childElement, parentElement){ let offsetX = 0; let offsetY = 0; while (childElement && childElement !== parentElement) { offsetX += childElement.offsetLeft; offsetY += childElement.offsetTop; childElement = childElement.offsetParent; } return { y: offsetY, x: offsetX };
}function createRequestObject(){ if(window.navigator.appName.indexOf('Internet Explorer') > -1) return new ActiveXObject('Microsoft.XMLHTTP'); else return new XMLHttpRequest();}function CallStack(){};CallStack.prototype.show = function(){ var f=showCallStack,result="Call stack:\n\n"; while((f=f.caller)!==null){ result += "F:" + f.toString().match(/^function (\w+)\(/)[1] + "\n"; result += "A:" + parseArguments(f.arguments) + "\n"; result += "\n"; } alert(result);};CallStack.prototype.parseArguments = function(a){ var result=[]; for(var i=0; i<a.length; i++){ if ('string' == typeof a[i]) result.push("\"" + a[i] + "\""); else result.push(a[i]); } return "(" + result.join(", ") + ")";};function CaretPosition(){};CaretPosition.prototype.get = function(oTextarea){ var CaretPos = 0; if (document.selection) {
 oTextarea.focus (); var Sel = document.selection.createRange (); Sel.moveStart ('character', -oTextarea.value.length); CaretPos = Sel.text.length; } else if (oTextarea.selectionStart || oTextarea.selectionStart == '0') CaretPos = oTextarea.selectionStart; return (CaretPos);};CaretPosition.prototype.set = function(oTextarea, nPos){ if(oTextarea.setSelectionRange) { oTextarea.focus(); oTextarea.setSelectionRange(nPos,nPos); } else if (oTextarea.createTextRange) { var range = oTextarea.createTextRange(); range.collapse(true); range.moveEnd('character', nPos); range.moveStart('character', nPos); range.select(); }};function acopy(iterable){ if (!iterable) return []; if (iterable.toArray) return iterable.toArray(); var length = iterable.length || 0, results = new Array(length); while (length--) results[length] = iterable[length]; return results;} function bind(){ if (arguments.length < 2) return null; var args = acopy(arguments), obj = args.shift(), func = args.shift(); return function() { return func.apply(obj, args); }turn a===nua======undefined); }, Function:function(a){ return(typeof(a)==='function')?a.constructor.toString().match(/Function/)!==null:false; }, String:function(a){ return(typeof(a)==='string')?true:(typeof(a)==='object')?a.constructor.toString().match(/string/i)!==null:false; }, Array:function(a){ return(typeof(a)==='object')?a.constructor.toString().match(/array/i)!==null||a.length!==undefined:false; }, Boolean:function(a){ return(typeof(a)==='boolean')?true:(typeof(a)==='object')?a.constructor.toString().match(/boolean/i)!==null:false; }, Date:function(a){ return(typeof(a)==='date')?true:(typeof(a)==='object')?a.constructor.toString().match(/date/i)!==null:false; }, HTML:function(a){ return(typeof(a)==='object')?a.constructor.toString().match(/html/i)!==null:false; }, Number:function(a){ return(typeof(a)==='number')?true:(typeof(a)==='object')?a.constructor.toString().match(/Number/)!==null:false; }, Object:function(a){ return(typeof(a)==='object')?a.constructor.toString().match(/object/i)!==null:false; }, RegExp:function(a){ return(typeof(a)==='function')?a.constructor.toString().match(/regexp/i)!==null:false; }}; var type={ of:function(a){ for(var i in is){ if(is[i](a)){ return i.toLowerCase(); } } }};var MfcStringUtilities = { _hTemplateCache: {}, _hTemplatePWSCache: {}, _rTemplateRegex: /\t+|\r+|\n+|\s\s+|\u2028|\u2029|\\|'|%\w+%/g, _rTemplatePWSRegex: /\\|'|\r|\n|\u2028|\u2029|%\w+%/g, _hTemplateEscapes: { "'": "'", '\\': '\\' }, _hTemplatePWSEscapes: { "'": "'", '\\': '\\', '\r': 'r', '\n': 'n', '\u2028': 'u2028', '\u2029': 'u2029' }, _fTemplateReplaceFn: function(match) { var sEscape = MfcStringUtilities._hTemplateEscapes[match]; if ( sEscape ) return '\\' + sEscape; if ( match.charAt(0) === '%' ) return "' + (obj['" + match.substring(1,match.length-1).toLowerCase() + "']||'') + '"; return ' '; }, _fTemplatePWSReplaceFn: function(match) { var sEscape = MfcStringUtilities._hTemplatePWSEscapes[match]; if ( sEscape ) return '\\' + sEscape; return "' + (obj." + match.substring(1,match.length-1).toLowerCase() + "||'') + '"; }};
MfcStringUtiliti str.join("&");};MfcStringUtilities.parse_template = function(sTemplate, hSwaps, hOptions ){ if(! sTemplate ) { return; } if(! hSwaps ) { hSwaps = {}; } if(! hOptions ) { hOptions = {}; } hOptions.preserve_white_space = hOptions.preserve_white_space ? 1 : 0; var hTemplateCache = hOptions.preserve_white_space ? MfcStringUtilities._hTemplatePWSCache : MfcStringUtilities._hTemplateCache; var fTemplate = hTemplateCache[ sTemplate ]; if ( ! fTemplate ) { var rRegex, fReplace; if(hOptions.preserve_white_space ) { rRegex = MfcStringUtilities._rTemplatePWSRegex; fReplace = MfcStringUtilities._fTemplatePWSReplaceFn; } else { rRegex = MfcStringUtilities._rTemplateRegex; fReplace = MfcStringUtilities._fTemplateReplaceFn; } fTemplate = hTemplateCache[ sTemplate ] = new Function('obj', "return '" + sTemplate.replace(rRegex, fReplace) + "';"); } return fTemplate(hSwaps);};MfcStringUtilities.query_string_append = function(sString, sKey, sValue ){ var sHash=''; if(sString.indexOf('#') > -1 ) { sHash = sString.substring(sString.indexOf('#'), sString.length ); sString = sString.substring(0, sString.indexOf('#') ); }
 var sJoint=''; if(sString.match(/\&$/) ) { 1; } else if(sString.match(/\?/) ) { sJoint = '&'; } else { sJoint = '?'; } return ( sString + sJoint + sKey + "=" + sValue + sHash );};MfcStringUtilities.parse_query_string = function(sQueryString ){ var hQS = new Array(); var aPairs = new Array(); if (aPairs = sQueryString.replace(/\?/g,"&").split("&")) { for (var i = 0; i < aPairs.length; i++) { var sKey = aPairs[i].split('=')[0]; var sVal = aPairs[i].split('=')[1]; if(typeof(sKey) == 'string' ) sKey = sKey.replace(/\W/g,''); if(typeof(sVal) == 'string' ) { sVal = decodeURIComponent(sVal).replace(/[<>"'`]/g,''); if(! isNaN(sVal) ) { sVal = parseFloat(sVal); }; } hQS[ sKey ] = isNaN(sVal) ? (sVal || '') : sVal; } } return hQS;};MfcStringUtilities.char_padding = function(sString,nWidth,cChar,sDirection){ if(typeof cChar == 'undefined' ) { cChar = ' '; } if(typeof(sString) == 'undefined') { return; } sString = sString.toString();
 var nDec = ''; var cSign = ''; if(sString.match(/^[\d\.\-]+$/) ) { if(sString.charAt(0) == '-') { sString = sString.substr(1,sString.length); cSign = '-'; } if(sString.indexOf('.') == -1) { sString += '.'; } nDec = sString.split('.')[1]; sString = sString.split('.')[0]; } while (sString.length < nWidth) { if(sDirection == 'right' ) { sString = sString + cChar; } else { sString = cChar + sString; } } if(sString.match(/\d/) ) { sString = cSign + sString; if(nDec ) { sString += '.' + nDec; } } return sString;};function MfcCrc32(){};MfcCrc32.prototype.aCrc32Tab = new Array(0x00000000,0x77073096,0xEE0E612C,0x990951BA,0x076DC419,0x706AF48F,0xE963A535,0x9E6495A3,0x0EDB8832,0x79DCB8A4,0xE0D5E91E,0x97D2D988,0x09B64C2B,0x7EB17CBD,0xE7B82D07,0x90BF1D91,0x1DB71064,0x6AB020F2,0xF3B97148,0x84BE41DE,0x1ADAD47D,0x6DDDE4EB,0xF4D4B551,0x83D385C7,0x136C9856,0x646BA8C0,0xFD62F97A,0x8A65C9EC,0x14015C4F,0x63066CD9,0xFA0F3D63,0x8D080DF5,0x3B6E20C8,0x4C69105E,0xD56041E4,0xA2677172,0x3C03E4D1,0x4B04D447,0xD20D85FD,0xA50AB56B,0x35B5A8FA,0x42B2986C,0xDBBBC9D6,0xACBCF940,0x32D86CE3,0x45DF5C75,0xDCD60DCF,0xABD13D59,0x26D930AC,0x51DE003A,0xC8D75180,0xBFD06116,0x21B4F4B5,0x56B3C423,0xCFBA9599,0xB8BDA50F,0x2802B89E,0x5F058808,0xC60CD9B2,0xB10BE924,0x2F6F7C87,0x58684C11,0xC1611DAB,0xB6662D3D,0x76DC4190,0x01DB7106,0x98D220BC,0xEFD5102A,0x71B18589,0x06B6B51F,0x9FBFE4A5,0xE8B8D433,0x7807C9A2,0x0F00F934,0x9609A88E,0xE10E9818,0x7F6A0DBB,0x086D3D2D,0x91646C97,0xE6635C01,0x6B6B51F4,0x1C6C6162,0x856530D8,0xF262004E,0x6C0695ED,0x1B01A57B,0x8208F4C1,0xF50FC457,0x65B0D9C6,0x12B7E950,0x8BBEB8EA,0xFCB9887C,0x62DD1DDF,0x15DA2D49,0x8CD37CF3,0xFBD44C65,0x4DB26158,0x3AB551CE,0xA3BC0074,0xD4BB30E2,0x4ADFA541,0x3DD895D7,0xA4D1C46D,0xD3D6F4FB,0x4369E96A,0x346ED9FC,0xAD678846,0xDA60B8D0,0x44042D73,0x33031DE5,0xAA0A4C5F,0xDD0D7CC9,0x5005713C,0x270241AA,0xBE0B1010,0xC90C2086,0x5768B525,0x206F85B3,0xB966D409,0xCE61E49F,0x5EDEF90E,0x29D9C998,0xB0D09822,0xC7D7A8B4,0x59B33D17,0x2EB40D81,0xB7BD5C3B,0xC0BA6CAD,0xEDB88320,0x9ABFB3B6,0x03B6E20C,0x74B1D29A,0xEAD54739,0x9DD277AF,0x04DB2615,0x73DC1683,0xE3630B12,0x94643B84,0x0D6D6A3E,0x7A6A5AA8,0xE40ECF0B,0x9309FF9D,0x0A00AE27,0x7D079EB1,0xF00F9344,0x8708A3D2,0x1E01F268,0x6906C2FE,0xF762575D,0x806567CB,0x196C3671,0x6E6B06E7,0xFED41B76,0x89D32BE0,0x10DA7A5A,0x67DD4ACC,0xF9B9DF6F,0x8EBEEFF9,0x17B7BE43,0x60B08ED5,0xD6D6A3E8,0xA1D1937E,0x38D8C2C4,0x4FDFF252,0xD1BB67F1,0xA6BC5767,0x3FB506DD,0x48B2364B,0xD80D2BDA,0xAF0A1B4C,0x36034AF6,0x41047A60,0xDF60EFC3,0xA867DF55,0x316E8EEF,0x4669BE79,0xCB61B38C,0xBC66831A,0x256FD2A0,0x5268E236,0xCC0C7795,0xBB0B4703,0x220216B9,0x5505262F,0xC5BA3BBE,0xB2BD0B28,0x2BB45A92,0x5CB36A04,0xC2D7FFA7,0xB5D0CF31,0x2CD99E8B,0x5BDEAE1D,0x9B64C2B0,0xEC63F226,0x756AA39C,0x026D930A,0x9C0906A9,0xEB0E363F,0x72076785,0x05005713,0x95BF4A82,0xE2B87A14,0x7BB12BAE,0x0CB61B38,0x92D28E9B,0xE5D5BE0D,0x7CDCEFB7,0x0BDBDF21,0x86D3D2D4,0xF1D4E242,0x68DDB3F8,0x1FDA836E,0x81BE16CD,0xF6B9265B,0x6FB077E1,0x18B74777,0x88085AE6,0xFF0F6A70,0x66063BCA,0x11010B5C,0x8F659EFF,0xF862AE69,0x616BFFD3,0x166CCF45,0xA00AE278,0xD70DD2EE,0x4E048354,0x3903B3C2,0xA7672661,0xD06016F7,0x4969474D,0x3E6E77DB,0xAED16A4A,0xD9D65ADC,0x40DF0B66,0x37D83BF0,0xA9BCAE53,0xDEBB9EC5,0x47B2CF7F,0x30B5FFE9,0xBDBDF21C,0xCABAC28A,0x53B39330,0x24B4A3A6,0xBAD03605,0xCDD70693,0x54DE5729,0x23D967BF,0xB3667A2E,0xC4614AB8,0x5D681B02,0x2A6F2B94,0xB40BBE37,0xC30C8EA1,0x5A05DF1B,0x2D02EF8D);
MfcCrc32.prototype.string = function(str){ var n; var len=str.length; var crc; crc=0xFFFFFFFF; for ( var n=0; n<len; n++) { crc=this.add(crc,str.charCodeAt(n)); } return crc^0xFFFFFFFF;};MfcCrc32.prototype.add = function(crc,c){ return this.aCrc32Tab[(crc^c)&0xFF]^((crc>>8)&0xFFFFFF);};function MfcTimer(fStartNow){ this.startTime = null; this.stopTime = null; this.elapsed = 0; if(fStartNow) { this.startTime = new Date(); }}MfcTimer.pe = new Date();};MfcTimer.prototype.Stop = function(nMax, sMsg){ this.stopTime = new Date(); this.elapsed = (this.stopTime - this.startTime); if (nMax <= this.elapsed) { if ( sMsg && Log ) { Log("[mprof " + this.elapsed + "ms] " + sMsg); }
 return true; } return false;};MfcTimer.proelapsed / 1000;};var iPhone_InputNoZoom = {};iPhone_InputNoZoom.MouseOver = function(){ if(iPhone_InputNoZoom.ThisIsNotiOSDevice() ) { return; } aMetaTags = top.document.getElementsByTagName("meta"); for(var n=0; n < aMetaTags.length; n++ ) if(aMetaTags[n].getAttribute("name") == "viewport") aMetaTags[n].setAttribute('content','user-scalable=0');};iPhone_InputNoZoom.MouseUp = function(){ if(iPhone_InputNoZoom.ThisIsNotiOSDevice() ) { return; } aMetaTags = top.document.getElementsByTagName("meta"); for(var n=0; n < aMetaTags.length; n++ ) if(aMetaTags[n].getAttribute("name") == "viewport") aMetaTags[n].setAttribute('content','user-scalable=1');};iPhone_InputNoZoom.ThisIsNotiOSDevice = function(){ if(! iPhone_InputNoZoom.UA ) { iPhone_InputNoZoom.UA = new MfcUserAgent(); } if(! iPhone_InputNoZoom.UA.iOS ) { return true; }};function CloneObject(obj) { var newObj = (obj instanceof Array) ? [] : {}; for ( var i in obj) { if (i == 'clone') continue; 
 if (obj[i] && typeof obj[i] == "object") { newObj[i] = CloneObject(obj[i]); } else { newObj[i] = obj[i] } }n dumped_text; }; function a_tag(hAttributes ){ var aHtml = new Array('<a '); for(var sK in hAttributes ) { aHtml.push(sK + "=\"" + hAttributes[sK].replace(/"/g,"'") + "\" "); } aHtml.push('>'); return aHtml.join('');
}function MfcUserAgent(){ if(! MfcUserAgent.bInitialized ) { MfcUserAgent.hUA = this.GetUserAgentInfo(); MfcUserAgent.bInitialized = true; } for(var sK in MfcUserAgent.hUA ) { this[sK] = MfcUserAgent.hUA[sK]; } if(g_ExternalCaller ) { this.oTop = window; } else { this.oTop = top; this.DeviceOrientation(); try { top.window.onorientationchange = this.DeviceOrientation; } catch(e) {} }}MfcUserAgent.prototype.isiPad = function(){ if(/iPad|iPhone|iPod/.test(navigator.platform) ) return true; else return navigator.maxTouchPoints && navigator.maxTouchPoints > 2 && /MacIntel/.test(navigator.platform);};MfcUserAgent.prototypePoints > 0 ) );};MfcUserAgent.prototype.GetUserAgentInfo = function(){ var aQueryStringMatch = []; var hUA = {}; try { if(g_ExternalCaller && ! this.top ) this.oTop = window; else if(! this.oTop ) this.oTop = top; if(this.oTop ) { aQueryStringMatch = this.oTop.location.search.match(/user_agent=([^&]+)/); hUA.FullWidth = screen.width == this.oTop.document.documentElement.clientWidth; hUA.FullHeight = ( Math.abs(screen.height - this.oTop.document.documentElement.clientHeight ) < 4 );
 } } catch(e){ } var sUserAgent = aQueryStringMatch && aQueryStringMatch[1] ? decodeURIComponent(aQueryStringMatch[1]) : navigator.userAgent; hUA.FlashAvailable = true; if ( sUserAgent.match(/Tablet;/) || this.isiPad() ) { hUA.tablet = true; } else if ( sUserAgent.match(/Mobile;/) ) { hUA.mobile = true; } else { hUA.desktop = true; } hUA.pluginsSupported = this.PluginsSupported(); hUA.webkit = sUserAgent.indexOf('AppleWebKit') > -1 ? true : false; if (sUserAgent.indexOf("Mozilla/5.0 (X11; Linux x86_64; rv:13.0) Gecko/20100101 Firefox/13.0.1") > -1) { hUA.tablet = true; hUA.mobile = true; hUA.FlashAvailable = true; } else if (sUserAgent.indexOf("PLAYSTATION") > -1) { sUserAgent.match(/PLAYSTATION (\d+) ([\d\.]+)/); hUA.PLAYSTATION = parseFloat(RegExp.$1 ); hUA.PLAYSTATION_versionNumber = parseFloat(RegExp.$2 ); } else if ( sUserAgent.match(/Silk\/([\.0-9]+)/) ) { hUA.Silk = RegExp.$1; hUA.FlashAvailable = false; hUA.Linux = true; hUA.tablet = true; hUA.mobile = true; } else if (sUserAgent.indexOf("(iPad;") > -1) {
 sUserAgent.match(/OS (\d)_(\d)/); hUA.iOS = parseFloat(RegExp.$1 + '.' + RegExp.$2 ); hUA.iPad = true; hUA.tablet = true; } else if (sUserAgent.indexOf("(iPhone;") > -1 || sUserAgent.indexOf("(iPod;") > -1) { sUserAgent.match(/OS (\d)_(\d)/); hUA.iOS = parseFloat(RegExp.$1 + '.' + RegExp.$2 ); hUA.iPhone = true; hUA.FlashAvailable = false; hUA.mobile = true; } else if ( sUserAgent.match(/Android ([0-9]{1,}[\.0-9]{0,})/) ) { hUA.Android = RegExp.$1; hUA.tablet = true; hUA.mobile = true; } else if ( sUserAgent.match(/(hpwOS|webOS)\/([\.\d]+)/) ) { hUA.WebOS = RegExp.$2; hUA.tablet = true; hUA.mobile = true; } else if ( sUserAgent.match(/Windows NT ([\.\d]+)/) ) { var hWindowsVersionMap = { '4.0': 'NT4.0', '5.0': '2000', '5.01': '2000SP1', '5.1': 'XP', '5.2': 'XP64', '6.0': 'Vista', '6.1': '7', '6.2': '8' }; hUA.Windows = hWindowsVersionMap[ RegExp.$1 ] || true; } else if ( sUserAgent.match(/\(Macintosh/) ) { hUA.Mac = true; } else if(sUserAgent.indexOf("(X11;") > -1 ) { hUA.X11 = true;
 hUA.Linux = true; } if (navigator.appName == "Microsoft Internet Explorer" || sUserAgent.indexOf("Edge/") > -1 || sUserAgent.indexOf("Trident/") > -1 ) { hUA.IE = 0; if(sUserAgent.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/) ) hUA.IE = parseFloat(RegExp.$1); else if(sUserAgent.match(/\Wrv[: ](\d+)/) ) hUA.IE = parseFloat(RegExp.$1); else if(sUserAgent.match(/Edge\/([0-9]{1,}[\.0-9]{0,})/) ) hUA.IE = parseFloat(RegExp.$1); if(hUA.IE >= 10 && hUA.desktop && hUA.Windows == 8 && hUA.FullWidth && hUA.FullHeight && ! hUA.pluginsSupported ) { hUA.IE_Desktop_Metro = true; } } else if (/Maxthon\/([\d\.]+)/.test(sUserAgent)) { hUA.Maxthon = new Number(RegExp.$1); hUA.no_native_popup_windows = true; } else if (/Chrome[\/\s](\d+\.\d+)/.test(sUserAgent)) { hUA.Chrome = new Number(RegExp.$1); } else if (/Firefox[\/\s](\d+\.\d+)/.test(sUserAgent)) { hUA.Firefox = new Number(RegExp.$1); } else if (sUserAgent.indexOf("Safari") > -1 && /Version\/(\d+)\.?([\d\.]*)/.test(sUserAgent) ) { var sMajor = RegExp.$1; var sRevision = RegExp.$2.replace(/\./g,''); hUA.Safari = parseFloat(sMajor + '.' + sRevision ); } else if (sUserAgent.indexOf("Opera") > -1) { sUserAgent.match(/Version\/([\d\.]+)/); hUA.Opera = parseFloat(RegExp.$1 ); }
 if (/\WAOL ([\d\.])+\W/.test(sUserAgent)) { hUA.AOL = new Number(RegExp.$1); } if (hUA.Android) { hUA.FlashAvailable = false; if (navigator.plugins != null && navigator.plugins.length > 0) if (navigator.plugins["Shockwave Flash"]) hUA.FlashAvailable = true; } else if (hUA.iOS) { hUA.FlashAvailable = false; } if(hUA.tablet || hUA.mobile ) { hUA.no_native_popup_windows = true; hUA.desktop = false; } else { hUA.desktop = true; } hUA.draggable = ( 'draggable' in document.createElement('span') ); return hUA;};MfcUserAgent.prototype.DeviceOrientation = function(){ var oWindow = this.oTop && this.oTop.window ? this.oTop.window : window; try { this.orientation = ( oWindow.orientation == 0 || oWindow.orientation == 180 ) ? 'vertical' : 'horizontal'; } catch(e){} return this.orientation;};MfcUserAgent.prototype.PluginsSupported = function()
{ this.errorName = ''; var bSupported = null; try { new ActiveXObject(""); } catch(e) { this.errorName = e.name; } try { bSupported = Boolean(new ActiveXObject("htmlfile") ); } catch(e) { bSupported = false; } bSupported = ! ( this.errorName != 'ReferenceError' && bSupported == false ); return bSupported;};MfcUserAgent.prototype.GetViewportDimensions = function(sMode ){ if(sMode == 'top' ) { return { width: this.oTop.window.innerWidth || this.oTop.document.documentElement.clientWidth || this.oTop.document.body.clientWidth, height: this.oTop.window.innerHeight || this.oTop.document.documentElement.clientHeight || this.oTop.document.body.clientHeight }; } else { return { width: window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth, height: window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight }; }};MfcUserAgent.prototype.GetDocumentDimensions = function(){ return { width: Math.max(Math.max(document.body.scrollWidth, document.documentElement.scrollWidth), Math.max(document.body.offsetWidth, document.documentElement.offsetWidth), Math.max(document.body.clientWidth, document.documentElement.clientWidth) ), height: Math.max(Math.max(document.body.scrollHeight, document.documentElement.scrollHeight), Math.max(document.body.offsetHeight, document.documentElement.offsetHeight), Math.max(document.body.clientHeight, document.documentElement.clientHeight) ) };};
function addEvent(sEvent, oElement, oFunction, bUseCapture ){ if (oElement.addEventListener) { oElement.addEventListener(sEvent,oFunction ,bUseCapture || false ); } else if (oElement.attachEvent) { oElement.attachEvent("on"+ sEvent, oFunction ); } else { oElement[ 'on' + sEvent ] = oFunction ; } } funceturn utftext; }; str = Utf8Encode(str); var table = "00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D"; if (typeof(crc) == "undefined") { crc = 0; } var x = 0; var y = 0; crc = crc ^ (-1); for(var i = 0, iTop = str.length; i < iTop; i++ ) { y = ( crc ^ str.charCodeAt(i ) ) & 0xFF;
 x = "0x" + table.substr(y * 9, 8 ); crc = ( crc >>> 8 ) ^ x; } return crc ^ (-1);};var FindDataTag = function(oHtml, sElementType, sDataTag ){ if(! oHtml || ! oHtml.getElementsByTagName ) { return false; } var aElements = oHtml.getElementsByTagName(sElementType ); for(var nE = 0, nElementsLength = aElements.length; nE < nElementsLength; nE++ ) { var oEl = aElements[nE]; if(! oEl || ! oEl.getAttribute ) { continue; } if(oEl.getAttribute(sDataTag ) != undefined ) { return oEl; } sArray(obj);}function isObject(obj){ return ((typeof obj === 'object' && obj !== null) || Object.prototype.toString.call(obj) === '[oys(obj).length;}function isObjectEmpty(obj){ for (var prop in obj)
 if (obj.hasOwnProperty(prop)) return false; return true;}if (!Object.keys) urn result; }; }());}function isEmptyObj(obj ){ if ( obj == null ) return true;
 for ( var sKey in obj ) if ( obj.hasOwnProperty(sKey) ) return false; return true;}function ProcessDynamicTopic(hUser, sTopic ){ if(typeof(hUser ) != 'object' || typeof(sTopic) != 'string' ) { return sTopic; } var aWords; if(t && t.GetUserIdByUsername && ( aWords = (" "+ sTopic.replace(/<wbr>/,'') +" ").match(/\W([A-Z\@]\w{4,})\W/g) ) ) { for(var a=0; a < aWords.length; a++ ) { var nUserId; aWords[a] = aWords[a].replace(/\W/g,''); if(( nUserId = t.GetUserIdByUsername(aWords[a] ) ) && hUser && hUser.user_id != nUserId ) { var sStyle = "text-decoration:underline;cursor:pointer;"; if(MfcCustomFonts && MfcCustomFonts.prototype.get_style && t && t.g_hUsers && t.g_hUsers[ nUserId ] ) { sStyle += MfcCustomFonts.prototype.get_style(t.g_hUsers[ nUserId ] ); } oRE = new RegExp(aWords[a], 'i' ); if(typeof(Player_popUserMenu_open ) != 'undefined' || typeof(popUserMenu ) != 'undefined' ) { sTopic = sTopic.replace(oRE, "<span class=user_style style=\"" + sStyle + "\" onClick=\" var e = arguments[0] || window.event; e.cancelBubble=true; ProcessDynamicTopic.openUserMenu("+nUserId+");\">" + aWords[a] + "</span>" ); } else if(t.A ) { sTopic = sTopic.replace(oRE, t.A('player',{ broadcaster_id: nUserId }) + aWords[a] + "</a>" ); } } } } return sTopic;};ProcessDynamicTopic.openUserMenu = function(nUserId )
{ if(typeof(Player_popUserMenu_open ) != 'undefined' ) Player_popUserMenu_open(nUserId); else if(typeof(popUserMenu ) == 'object' ) popUserMenu.open(nUserId);};function ConditionString(html, options ){ options = options || {}; if(typeof(html) != 'string' ) { return html; } html = ' ' + html + ' '; if(options.break_long_strings ) { html = html.replace(/(\S{20,})/g, function(str) { if(! str.match(/(#~|http|\/\/)/ ) ) { return str.replace(/(\S{20})/g,'$1<WBR>'); } else { return str; } }); } var sDomainString = "share\." + t.g_hPlatform.domain + "|MFCsha\.re"; if(options.link_affiliated_sites ) { var oRE = new RegExp("([^\">\\\\])(http[s]?://)(" + sDomainString + ")(/[^\" ]+)([^\"<\\\\])",'ig');
 html = html.replace(oRE, function() { return (RegExp.$1) + "<a href=\"" + ( RegExp.$2 + RegExp.$3 + RegExp.$4 ) + "\" target=\"_blank\">" + ( RegExp.$2 + RegExp.$3 + RegExp.$4 ) +"</a>" + ( RegExp.$5 ); }); } if(options.remove_html ) { html = html.replace(/>/g, "&gt;").replace(/</g, "&lt;"); } if(options.link_affiliated_sites ) { var oRE = new RegExp("&lt;a href=\"http[s]?://(" + sDomainString + ")/([^\"]+)\" target=\"_blank\"&gt;http[s]?://(" + sDomainString + ")/([\\S]*)&lt;/a&gt;",'ig');
 html = html.replace(oRE,"<a href=\"https://$1/$2\" target=\"_blank\">https://$3/$4</a>"); } html = html.replace(/&lt;WBR&gt;/g,"<WBR>");
 html = html.replace(/^\s+/g,''); html = html.replace(/\s+$/g,''); return html;}var SpecString_To_Object = function(string, kvchar, delimiter ){ delimiter = delimiter || ','; if(! kvchar && typeof(string)=='string' && string.indexOf('=')>-1 ) { kvchar = '='; } else if(! kvchar ) { kvchar = ':'; } var obj = {}; var params = string.split(delimiter); for(var a=0; a < params.length; a++ ) { keyval = params[a].split(kvchar ); if(! keyval[0] ) { continue; } if(typeof(keyval[1] ) != 'undefined' ) { if(keyval[1].match(/^[\-\d\.]+$/) ) obj[keyval[0]] = parseFloat(keyval[1] ); else obj[keyval[0]] = keyval[1]; } else { obj[keyval[0]] = true; } } return obj;};function parseQueryString(queryString){ var query = {}; var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&'); for (var i = 0; i < pairs.length; i++) { var pair = pairs[i].split('='); try { query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || ''); } catch(e) { console.log(e ); } } return query;
}function dragElement(element,dragEl,options){ options = options || {}; var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0, movementMask, didOnce = 0; var pressDownEl = dragEl || element; pressDownEl.addEventListener('mousedown',dragMouseDown,true); pressDownEl.addEventListener('touchstart',dragMouseDown,true); function dragMouseDown(e) { e = window.event; e.preventDefault(); pos3 = e.clientX; pos4 = e.clientY; if(! didOnce++ ) { document.addEventListener('mouseup',closeDragElement,true); document.addEventListener('touchend',closeDragElement,true); document.addEventListener('mousemove',elementDrag,true); document.addEventListener('touchmove',elementDrag,true); document.addEventListener('onselectstart',preventDefault,true); } movementMask = document.createElement('div'); movementMask.style.cssText = "position:absolute;top:0px;left:0px;height:100%;width:100%;background-color:gray;opacity:0;"; document.body.appendChild(movementMask); if(options.translucent_on_move ) { element.style.backgroundColor = '#008000'; element.style.borderRadius = '5px'; element.style.opacity = 0.8; var oChild = element.firstChild; if(oChild ) oChild.style.visibility ventDefault(); } function elementDrag(e) { e = e || window.event; e.preventDefault(); var tracker = ( e.touches && e.touches[0] ) || e; pos1 = pos3 - tracker.clientX; pos2 = pos4 - tracker.clientY; pos3 = tracker.clientX; pos4 = tracker.clientY; element.style.top = (element.offsetTop - pos2) + "px"; element.style.left = (element.offsetLeft - pos1) + "px"; } function closeDragElement() { document.removeEventListener('mousemove',elementDrag,true); document.removeEventListener('touchmove',elementDrag,true); document.removeEventListener('mouseup',closeDragElement,true); document.removeEventListener('touchend',closeDragElement,true); document.removeEventListener('onselectstart',elementDrag,true); movementMask.parentNode.removeChild(movementMask); if(options.translucent_on_move ) { element.style.backgroundColor = ''; element.style.borderRadius = ''; element.style.opacity = ''; var oChild = element.firstChild; if(oChild ) oChild.style.visibility = ''; } didOnce=0; }}function isInViewport(el){ var vWidth = window.innerWidth || document.documentElement.clientWidth; var vHeight = window.innerHeight || document.documentElement.clientHeight;
 if(! el ) { return false; } var rect = el.getBoundingClientRect(); if(! rect ) { return false; } if(! rect.x && ! rect.y && ! rect.width && ! rect.height ) { return false; } var elCenterX = rect.left + ( rect.width / 2 ); var elCenterY = rect.top + ( rect.height / 2 ); if ( elCenterX < 0 || elCenterX > vWidth || elCenterY < 0 || elCenterY > vHeight ) { return false; } return true;}function caller(){ var callStack = (new Error()).stack.split("\n"); callStack.shift(); callStack.shift(); return "\n" + callStack.join("\n");}
function FnRateLimit(sFnName,nDelay,oCallback,hOptions){ hOptions = hOptions || {}; var debug = !! hOptions.debug; if(debug ) { console.log(sFnName + ' status: ' + ( FnRateLimit.lockCount[sFnName] || 0 ),', delay time: ', nDelay); } if(FnRateLimit.followup[sFnName] ) { if(debug ) { console.log(sFnName + ' clear out followup flag'); } delete FnRateLimit.followup[sFnName]; FnRateLimit.lockCount[sFnName] = 0; return false; } else if(FnRateLimit.lockCount[sFnName] ) { if(debug ) { console.log(sFnName + ' call during lock', caller()); } FnRateLimit.lockCount[sFnName]++; return true; } else { FnRateLimit.lockCount[sFnName] = 1; clearTimeout(FnRateLimit.timer[sFnName]); FnRateLimit.timer[sFnName] = setTimeout(function() { if(FnRateLimit.lockCount[sFnName] > 1 ) { FnRateLimit.followup[sFnName] = 'followup'; if(debug ) { console.log(sFnName , ' followup call with ', FnRateLimit.lockCount[sFnName], ' waiting' ); } FnRateLimit.lockCount[sFnName] = 0; oCallback(); } FnRateLimit.lockCount[sFnName] = 0; if(debug ) { console.log(sFnName,' clear out lock'); } },nDelay); } return false;}
FnRateLimit.timer = {};FnRateLimit.lockCount = {};FnRateLimit.followup = {};function getSelectedText(){ if (typeof window.getSelection != "undefined") { return window.getSelection().toString(); } else if (typeof document.selection != "undefined" && document.selection.type == "Text") { return document.selection.createRange().text; } return '';}

// js_build_core: js/MfcConfig.js
try { document.domain = document.domain.replace(/.*?(\w+\.\w+)$/,"$1"); } catch(e) { console.log(e); }var sTop_ClearCode;if(! g_ExternalCaller ) { try { sTop_ClearCode = top.g_sClearCode; } catch(e) { }}var g_bRefactored = location.href.indexOf('files/') == -1 ? true : false;var w = window;var d = document;w.PLAT_MFC = 1;w.PLAT_CAM = 2;w.MODELORDER_NONE = 0;w.MODELORDER_PVT = 1;w.MODELORDER_TRUEPVT = 2;w.MODELORDER_GRP = 4;w.WEBCAM_SECURITY_EVERYONE = 0;w.WEBCAM_SECURITY_MODELS = 3;w.WEBCAM_SECURITY_FRIENDS = 2;w.WEBCAM_SECURITY_MODELS_FRIENDS = 4;w.WEBCAM_SECURITY_ALLOWED = 5;w.WEBCAM_SECURITY_FRIEND_ID = 100;w.MODEL_LIST_ICON_NEW_MODEL = 1;w.MODEL_LIST_ICON_RECOMMEND = 2;w.MODEL_LIST_ICON_POPULAR = 4;w.MODEL_LIST_ICON_RECENT = 8;w.MODEL_LIST_ICON_MISSMFC = 16;w.MODEL_LIST_ICON_TRENDING = 32;w.MODEL_LIST_ICON_CUSTOM_ALERTS = 64;w.LOUNGE_MASK_AUTO_CLICK = 1;w.LOUNGE_MASK_NO_CAMSNAPS = 2;w.LOUNGE_MASK_LOUNGE_MODE = 4;w.HIDE_MODEL_GROUPS_AWAY = 1;w.HIDE_MODEL_GROUPS_PRIVATE = 2;w.HIDE_MODEL_GROUPS_GROUP = 4;w.HIDE_MODEL_GROUPS_PUBLIC = 8;w.USEREXT_NUM = 0; w.USEREXT_STRING = 1; w.USEREXT_DATA = 2; w.USEREXT_STAMP = 3; 
w.WINDOW_MODE_DEFAULT = 0;w.WINDOW_MODE_DHTML = 1;w.WINDOW_MODE_BROWSER = 2;w.WINDOW_MODE_DEFAULT = 0;w.WINDOW_MODE_DESKTOP_DHTML = 1;w.WINDOW_MODE_MOBILE_DHTML = 2;w.MFC_NEWS_USER_ID = 481462;w.DISPLAY_PM_INLINE_WHISPER = 1;w.DISPLAY_PM_INLINE_ALL = 2;var g_hSessionTypeWords = { 1: 'private', 2: 'voyeur', 3: 'group_show', 6: 'club' };var g_hAutoNotesBits = { 'automatic_notes_chatroom': 1, 'automatic_notes_pm': 2};var g_hRegionConfig = { AF: { name: 'Africa', bit: 1 }, AS: { name: 'Asia/Pacific Islands', bit: 2 }, AU: { name: 'Australia', bit: 4 }, SA: { name: 'Central/South America', bit: 8 }, EU: { name: 'Europe/Russia', bit: 16 }, NA: { name: 'North America', bit: 32 }, UK: { name: 'United Kingdom', bit: 64 }, UN: { name: '<i>Unknown Region</i>', bit: 128 }};var g_hC = { 'dhtml_path': g_Paths.htmlPublicViews, 'site_path': '/files', 'api_url': '/api', 'master_path': ( '//files.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") + '/files' )};var g_hLoungeIds={};var g_clientRes = new MfcClientRes();if(typeof g_hPlatform === 'undefined' ) { g_hPlatform = {}; }try{ if(! g_hPlatform ) { if(t && t.g_hPlatform ) { g_hPlatform = t.g_hPlatform; } else if(top && top.g_hPlatform ) { g_hPlatform = top.g_hPlatform; } else if(opener && opener.g_hPlatform ) { g_hPlatform = opener.g_hPlatform; }
 } g_hC['site_path_images'] = ( ( ( g_hPlatform && g_hPlatform.image_url ) || 'https://img.camcdn.com/' ) + 'files'); g_hC['domain'] = ( ( g_hPlatform && g_hPlatform.domain ) || 'camyou.com' ); g_hC['site_name'] = ( ( g_hPlatform && g_hPlatform.name ) || '' ); var aLounges = []; if(g_hPlatform && g_hPlatform.id == PLAT_CAM ) { aLounges = [ 486128 ]; } else { aLounges = [ 486121, 486123, 486124 ]; } for(var a=0; a<aLounges.length; a++ ) if(g_clientRes.Lounges && g_clientRes.Lounges[ aLounges[a] ] ) g_hLoungeIds[ aLounges[a] ] = g_clientRes.Lounges[ aLounges[a] ]['username'];}catch(e) { console.log(e); }for ( var sK in g_hLoungeIds) { g_hLoungeIds[ g_hLoungeIds[sK] ] = sK; }var g_UA = new MfcUserAgent();var g_hResources = { change_model_group: { description: "View another group of " + g_hPlatform.performer + "s" }, test_page: { page: g_Paths.htmlPublicViews + "test_page.html", title: "Test Page", description: "Test Page" }, bookmark: { description: "Bookmark or Add-To-Favorites her room" }, cookies: { page: g_Paths.htmlPublicViews + "cookies.html", description: "How to delete your " + g_hC['site_name'] + ".com cookies" }, online_models_splash: { page: g_Paths.phpPathPublic + "online_models_splash.php", description: "Online " + g_hPlatform.Performer + "s" }, offline_models: { title: "Offline " + g_hPlatform.Performer + "s", page: g_Paths.phpPathPublic + "offline_models.php", description: "Offline " + g_hPlatform.Performer + "s" }, user_notepad: { title: "Notepad", new_window: { 'width': 820 }, page: g_Paths.htmlPublicViews + "notepad.html", description: "Notepad"
 }, manage_lists: { title: "Manage Lists", new_window: { 'width': 820 }, page: g_hC['dhtml_path'] + "manage_lists.html", description: "Manage Lists" }, manage_friends: { title: "Manage Friends", new_window: { 'width': 820 }, page: g_hC['dhtml_path'] + "manage_lists.html#friends", description: "Friends List" }, manage_friends2: { title: "Manage Friends", new_window: { 'width': 820 }, page: g_hC['dhtml_path'] + "manage_lists.html#friends", description: "Friends List" }, manage_ignores: { title: "Manage Ignored Users", new_window: { 'width': 820 }, page: g_hC['dhtml_path'] + "manage_lists.html", description: "Manage Ignored Users" }, manage_bookmarks: { title: "Manage Bookmarks", new_window: { 'width': 820 }, page: g_hC['dhtml_path'] + "manage_lists.html#bookmarks", description: "Bookmarked " + g_hPlatform.Performer + "s" }, manage_hidden_models: { title: "Manage Hidden " + g_hPlatform.Performer + "s", new_window: { 'width': 820 }, page: g_hC['dhtml_path'] + "manage_lists.html#hidden_models", description: "Manage Hidden " + g_hPlatform.Performer + "s" }, offline_friends: { title: "All Friends", new_window: { 'width': 820 }, page: g_hC['dhtml_path'] + "manage_lists.html#friends", description: "All Friends" }, token_transfer_wall: { title: "Token Transfer Wall", page: g_Paths.phpPathPublic + "token_transfer.php?request=token_transfer_wall" }, old_miss_mfc: { title: ( "Miss " + g_hC['site_name'] ), sm_icon: "crown.16x16.png",
 sprite_css: "sprite-icons sprite-crown16x16", new_window: { 'width': 900 }, page: g_Paths.phpPathPublic + "miss_mfc.php" + ( ( g_UA.tablet || g_UA.mobile ) ? '?display_mode=mobile' : '' ), description: "Miss " + g_hC['site_name'] + " Contest" }, miss_mfc: { title: ( "Miss " + g_hC['site_name'] ), sm_icon: "crown.16x16.png", sprite_css: "sprite-icons sprite-crown16x16", new_window: { 'width': 820 }, page: g_hC['dhtml_path'] + "miss_mfc.html", description: "Miss " + g_hC['site_name'] + " Contest" }, news_feed: { title: "News Feed", sm_icon: "newsfeed.16x16.png", sprite_css: "sprite-icons sprite-newsfeed16x16", new_window: { 'width': 800 }, page: g_Paths.htmlPublicViews + "news_feed.html", description: "News Feed" }, news_feed_popup: { title: "News Feed", sm_icon: "newsfeed.16x16.png", sprite_css: "sprite-icons sprite-newsfeed16x16", new_window: { 'width': 300 }, page: g_Paths.htmlPublicViews + "news_feed.html", description: "News Feed" }, online_miss_mfc: { title: "Online Miss " + g_hC['site_name'] + " Winners", sm_icon: "crown.16x16.png", sprite_css: "sprite-icons sprite-crown16x16", new_window: { 'width': 830 }, page: g_Paths.htmlPublicViews + "room_tracker.html?mode=miss_mfc", description: "Miss " + g_hC['site_name'] + " winners who are online now" }, top_rooms: { title: "Most Popular Rooms", sm_icon: "png/top_rooms.16x16.png", sprite_css: "sprite-icons sprite-top_rooms16x16", new_window: { 'width': 830 }, page: g_Paths.htmlPublicViews + "room_tracker.html?mode=popular_rooms", description: "Chat Rooms with the Most Viewers." }, trending_rooms: { title: "Trending Rooms", sm_icon: "/ico/chart.16x16.png", new_window: { 'width': 830 }, page: g_Paths.htmlPublicViews + "room_tracker.html?mode=trending_rooms",
 description: "Chat Rooms with the Most Viewers." }, activity_log: { title: "Trending Rooms", sm_icon: "/files/images/icons/svg/open_door_history.svg", new_window: { 'width': 830 }, page: g_Paths.htmlPublicViews + "activity_log.html", description: "Recently Visited Chat Rooms" }, user_created_rooms: { title: "Member Rooms", sm_icon: "ucr.16x16.png", sprite_css: "sprite-icons sprite-ucr16x16", new_window: { 'width': 600 }, page: g_Paths.htmlPublicViews + "user_created_rooms.html", description: "Join Member Chat Rooms or create your own." }, group_shows_board: { title: "Group Shows", sm_icon: "group_show_board.small.png", sprite_css: "sprite-icons sprite-group_show_boardsmall", page: g_Paths.htmlPublicViews + "group_shows_status.html", new_window: { 'width': 540 }, description: "View Current and Pending Group Shows." }, club_shows_board: { title: "Club Shows", sm_icon: "group_show_board.small.png", sprite_css: "sprite-icons sprite-group_show_boardsmall", page: g_Paths.htmlPublicViews + "room_tracker.html?mode=club_shows", description: "View currently active Club Shows." }, model_recommendations: { title: "" + g_hPlatform.Performer + "s You May Like", sm_icon: "png/model_recommendations.16x16.png", sprite_css: "sprite-icons sprite-model_recommendations16x16", overwrite_page: true, page: g_Paths.htmlPublicViews + "recommended_models.html", new_window: { 'width': 850 }, description: "Find other " + g_hPlatform.Performer + "s You May Like." }, model_explorer: { title: "" + g_hPlatform.Performer + " Explorer", sm_icon: "model_matrix-sm.png", sprite_css: "sprite-icons sprite-model_matrix-sm", page: g_Paths.htmlPublicViews + "model_explorer.html", new_window: { 'width': 950 }, description: "Explore Online " + g_hPlatform.Performer + "s by Interests." },
 model_tags: { title: "" + g_hPlatform.Performer + " Tags", sm_icon: "svg/topics.svg", sprite_css: "sprite-icons sprite-tag_model16x16", overwrite_page: true, page: g_Paths.htmlPublicViews + "tags_topics.html?mode=model_tags", new_window: { 'width': 950 }, description: "Search Online " + g_hPlatform.Performer + "s by Keyword Tags." }, model_topics: { title: "" + g_hPlatform.Performer + " Topics", sm_icon: "topic_tags_model.16x16.png", overwrite_page: true, page: g_Paths.htmlPublicViews + "tags_topics.html?mode=model_topics", new_window: { 'width': 950 }, description: "Search Online " + g_hPlatform.Performer + "s by Topic KeyWords." }, user_tags: { title: "Member Tags", sm_icon: "tag_user.16x16.png", sprite_css: "sprite-icons sprite-tag_user16x16", page: g_Paths.htmlPublicViews + "tags_topics.html?mode=user_tags", new_window: { 'width': 950 }, description: "Search Online Members by Keyword Tags." }, member_webcams: { title: "Member Webcams", sm_icon: "png/member_webcams.16x16.png", sprite_css: "sprite-icons sprite-member_webcams16x16", page: g_Paths.htmlPublicViews + "member_webcams.html", new_window: { 'width': 600 }, description: "View Webcams of other Members." }, transfer_tokens: { title: "Transfer Tokens", page: "/php/token_transfer.php?request=transfer_tokens", description: "Transfer tokens to another user account." }, group_shows: { title: "Group Shows", page: g_Paths.phpPathPublic + "group_shows.php", description: "View active and initiated group shows." }, user_chat_images: { title: "Chat Images", new_window: { 'width': 950 }, page: g_Paths.phpPathPublic + "user_chat_images.php", description: "Choose from and submit your own chat images." },
 bring_a_friend: { title: "Bring A Friend", page: g_Paths.phpPathPublic + "refer_a_friend.php", description: "You can get free tokens by bringing your friends to our site." }, custom_alerts: { title: "Custom Alerts", page: g_Paths.htmlPublicViews + "custom_alerts.html", new_window: { 'width': 930 }, description: "" }, members_feature: { title: "Member Feature", page: g_Paths.phpPathPublic + "signup.php?members_feature=1", description: "This is a free members feature, create a for a free acount to gain access." }, purchase_limit_info: { title: "Purchase Limit Info", page: g_Paths.phpPathPublic + "purchase_limit_info.php", description: "Click here to learn more about raising your purchase limits." }, private_gallery: { title: "Private Gallery", sm_icon: "png/exclusive_gallery.16x16.png", sprite_css: "sprite-icons sprite-exclusive_gallery16x16", new_window: { 'width': 930 }, page: g_Paths.htmlPublicViews + "private_gallery.html", description: "Private Gallery" }, close_pm_window: { description: "Close this Private Message window." }, pm_friend: { title: "%USERNAME% - Private Message", new_window: { 'menubar': 0,'resizable': 1,'scrollbars': 1,'titlebar': 0,'toolbar': 0,'status': 0 }, page: ( g_bRefactored && ! sTop_ClearCode ? '/_html/' : g_hC['dhtml_path'] ) + ( sTop_ClearCode && ! g_bRefactored ? 'pm.'+sTop_ClearCode+'.html' : 'pm.html' ) + "?broadcaster_id=0", description: "Send a Private Message to %USERNAME%." },
 pm_prompt: { description: "Click here to send a message to another user." }, old_chat_logs: { title: "Archives", sm_icon: "png/archive.16x16.png", sprite_css: "sprite-icons sprite-archive16x16", new_window: { 'width': 950 }, page: g_Paths.phpPathPublic + "chat_logs.php", description: ( t && g_hPlatform && g_hPlatform.id == PLAT_MFC ? "Archived Private Shows and Chat Logs." : "Chat Logs.") }, chat_logs: { title: "Archives", sm_icon: "png/archive.16x16.png", sprite_css: "sprite-icons sprite-archive16x16", new_window: { 'width': 950 }, page: g_Paths.htmlPublicViews + "chat_logs.html", description: ( t && g_hPlatform && g_hPlatform.id == PLAT_MFC ? "Archived Private Shows and Chat Logs." : "Chat Logs.") }, user_settings: { title: "Personal Options", sm_icon: "png/user_settings.16x16.png", sprite_css: "sprite-icons sprite-user_settings16x16", new_window: { 'width': 800,'menubar': 0,'resizable': 1,'scrollbars': 1,'titlebar': 0,'toolbar': 0,'status': 1 }, page: g_Paths.htmlPublicViews + "user_settings.html", description: "Additional Options for Chat and More." }, billing_support: { page: "https://wiki." + g_hC['domain'] + "/wiki/Billing_Help", target: '_blank', description: "Receive answers to questions regarding billing." }, logout: { description: "Logout of your account." }, create_profile: { title: "Create Profile", sm_icon: "png/my_profile.16x16.png", sprite_css: "sprite-icons sprite-my_profile16x16", page: "//profiles." + g_hC['domain'] + "/?action=process_login", new_window: { }, description: "Create your own profile." }, edit_profile: { title: "Edit Profile", page: "//profiles." + g_hC['domain'] + "/?action=process_login", new_window: { }, target: "_blank",
 description: "Edit your profile.", no_query_string: true }, my_profile: { title: "My Profile", sm_icon: "my_profile_small.gif", sprite_css: "sprite-icons sprite-my_profile_small", page: "//profiles." + g_hC['domain'] + "/%USERNAME%", new_window: { }, target: "_blank", description: "View your own profile.", no_query_string: true }, profiles: { title: "Profiles", page: "//profiles." + g_hC['domain'] + "/", new_window: { }, description: "Create your own profile and view the profiles of others.", target: '_blank' }, connection_mode: { page: g_Paths.htmlPublicViews + "connection_mode.html", description: "Choose a preferred connection method.", target: 'new_window' }, bio: { title: "Profiles", page: "//profiles." + g_hC['domain'] + "/%USERNAME%", new_window: { }, description: "View Profile of %USERNAME%", target: '_blank', no_query_string: true }, modelweb: { title: "Broadcast", sm_icon: "ico/webcam-32x32.gif", page: "//www." + g_hC['domain'] + "/modelweb", description: "Broadcast your webcam", target: '_blank' }, model_admin: { title: "Model Admin", sm_icon: "ico/logout-sm.gif", page: "//profiles." + g_hC['domain'] + "/_/model_start_page", target: '_blank', description: "Model account settings" }, broadcast: { title: "My Webcam", sm_icon: "png/broadcast.16x16.png",
 sprite_css: "sprite-icons sprite-broadcast16x16", page: g_Paths.htmlPublicViews + "broadcast.html", description: "Share your Webcam with " + g_hPlatform.Performer + "s and Members.", target: "new_window", new_window: { 'height': 450,'width': 560,'top': 20,'left': 20 } }, toggle_mute_guests: { description: "Ignore guests" }, toggle_mute_regs: { description: "Ignore basic users" }, toggle_video: { description: "Disable or enable video" }, toggle_size: { description: "Toggle the size of the video" }, toggle_away: { description: "Toggle your away status" }, mute: { description: "Toggle the audio on or off" }, toggle_header: { description: ( "Hide or reveal the top portion of " + g_hC['site_name'] ) }, toggle_menu: { description: "Toggle this menu" }, rate_a_private: { page: g_Paths.phpPathPublic + "account.php?request=rate_a_private", target: 'main' }, model_signup: { page: "/models/", description: "Become a " + g_hPlatform.performer + "", target: '_blank' }, 'terms': { title: "Terms", page: "https://wiki." + g_hC['domain'] + "/wiki/" + ( g_hPlatform.id==w.PLAT_CAM ? "Terms" : "Terms_and_Conditions" ), target: '_blank', description: "Terms & Conditions" }, '2257': { title: "2257", page: "https://wiki." + g_hC['domain'] + "/wiki/18_U.S.C._2257_Record_Keeping_Requirements_Compliance_Statement",
 target: '_blank', description: "2257 Compliance" }, privacy_policy: { page: "https://wiki." + g_hC['domain'] + "/wiki/Privacy_Policy", target: '_blank', description: "Privacy Policy" }, contact: { page: "https://wiki." + g_hC['domain'] + "/wiki/Contact_Support", target: '_blank', description: "Contact Us" }, contact_help: { page: "https://wiki." + g_hC['domain'] + "/wiki/Contact_Support", target: '_blank', description: "Contact Us" }, homepage: { title: "Homepage", page: ( g_bRefactored && ! sTop_ClearCode ? '/_html/' : g_hC['dhtml_path'] ) + ( sTop_ClearCode && ! g_bRefactored ? 'player.'+sTop_ClearCode+'.html' : 'player.html' ) + "?broadcaster_id=0", title: g_hC['site_name'], window_title: g_hC['site_name'] + " - The #1 adult webcam community! 24/7 Free webcams, featured live shows with sound!", description: "Return to the homepage, or type /homepage or /h in the chat input", target: 'main' }, toplist: { page: g_hC['dhtml_path'] + "toplist.html", description: "Top List" }, webcams: { title: "Webcams", page: g_hC['dhtml_path'] + "webcams.html", title: "Webcams", description: ( "The webcams of " + g_hC['site_name'] + ".com" ) }, help: { page: "https://wiki." + g_hC['domain'] + "/wiki/Technical_Help", target: '_blank', title: "Technical Assistance",
 description: "Receive technical assistance." }, faq: { page: "https://wiki." + g_hC['domain'] + "/wiki/Instructions_and_Features", target: '_blank', description: "Find answers to frequently asked questions." }, player: { page: ( g_bRefactored && ! sTop_ClearCode ? '/_html/' : g_hC['dhtml_path'] ) + ( sTop_ClearCode && ! g_bRefactored ? 'player.'+sTop_ClearCode+'.html' : 'player.html' ), title: "%USERNAME% - Chat Room", window_title: ( g_hC['site_name'] + " - Video Chat with %USERNAME%" ), new_window: { 'height': 520,'width': 1100 }, description: "", target: 'main' }, delete_account: { page: g_hC['dhtml_path'] + "delete_account.html?delete=1", title: "Delete Account" }, under_construction: { title: "Under Construction", page: g_hC['dhtml_path'] + "under_construction.html", title: "Under Construction", target: 'main' }, user_temp_banned: { page: g_hC['dhtml_path'] + "user_temp_banned.html", description: "A " + g_hPlatform.performer + " has banned you from the site temporarily", target: 'main' }, rule_violation: { page: g_hC['dhtml_path'] + "rule_violation.html", description: "Rule violation", target: 'main' }, user_banned: { page: g_hC['dhtml_path'] + "user_banned.html", description: "A " + g_hPlatform.performer + " has banned you from her room temporarily.", target: 'main' },
 server_connection_error: { page: g_hC['dhtml_path'] + "server_connection_error.html", description: "There was a problem connecting to the server.", target: 'main' }, java_failed: { page: g_hC['dhtml_path'] + "java_failed.html", description: "Java or Flash versions are out of date or not installed.", target: 'main' }, verified: { title: "Verification Complete", window_title: g_hC['site_name'] + " - The #1 adult webcam community! 24/7 Free webcams, featured live shows with sound!", page: g_hC['dhtml_path'] + "verified.html" }, account: { title: "My Account", sm_icon: "png/my_account.16x16.png", sprite_css: "sprite-icons sprite-my_account16x16", page: g_Paths.phpPathPublic + "account.php?request=status", description: "View Settings and Options for your account." }, login: { page: g_Paths.phpPathPublic + "login.php?request=login", description: "Login to your account.", target: 'main' }, forgot_password: { title: "Retrieve Password", page: g_Paths.phpPathPublic + "account.php?request=password", description: "Retrieve your username and password." }, unsubscribe: { page: g_Paths.phpPathPublic + "signup.php?request=unsubscribe", title: "Unsubscribe Confirmation", window_title: "Unsubscribe from " + g_hC['site_name'], description: " " }, purchase: { title: "Purchase Tokens", new_window: { 'height': 760,'width': 820 }, page: g_Paths.phpPathPublic + "purchase.php?request=tokens" + ( location.search.replace(/^\?/,'&') ),
 description: "Purchase tokens, or type /quickbuy or /qb into the chat input." }, mobile: { page: ( "https://M." + g_hC['site_name'] + ".com/" ), target: '_blank', title: ( "M." + g_hC['site_name'] + ".com" ), description: ( g_hC['site_name'] + " Mobile Website" ) }, app: { page: ( "https://app." + g_hC['site_name'] + ".com/" ), target: '_blank', title: ( "app." + g_hC['site_name'] + ".com" ), description: ( g_hC['site_name'] + " App" ) }, wiki: { page: "https://wiki." + g_hC['domain'] + "/", target: '_blank', title: ( g_hC['site_name'] + " Wiki" ), description: ( g_hC['site_name'] + " Wiki" ) }, tour: { page: "https://wiki." + g_hC['domain'] + "/wiki/Basic_Tour", target: '_blank', title: "Tour", description: ( "Tour " + g_hC['site_name'] ) }, premium_feature: { title: "Premium Feature", page: g_Paths.phpPathPublic + "account.php?request=premium_feature", title: "Premium Feature", description: "Premium Feature", target: 'new_window', new_window: { 'height': 600,'width': 700 }, }, register: { title: "Register for Free", page: (function(){ var apiSignup = -1; try { apiSignup = top.location.search.indexOf('api_signup'); } catch(e) { } return ( apiSignup > -1 ) ? 'signup.html' : ( g_Paths.phpPathPublic + "signup.php?request=register" ); })(), title: "Free Registration", description: "Register for your free account.",
 target: 'new_window', new_window: { 'height': 700,'width': 900 }, }, php_message: { title: "MFC Mail", sm_icon: "png/message.16x16.png", sprite_css: "sprite-icons sprite-message16x16", page: g_Paths.phpPathPublic + "message.php?style_override=www", new_window: { 'width': 860 }, description: ( g_hC['site_name']+ " Mail" ) }, message: { title: "MFC Mail", sm_icon: "png/message.16x16.png", sprite_css: "sprite-icons sprite-message16x16", page: g_Paths.htmlPublicViews + "user_message_client.html?style_override=www", new_window: { 'width': 900 }, description: ( g_hC['site_name']+ " Mail" ) }, bad_link: { page: "bad_link.html" }, messenger: { title: "Notifications", page: g_hC['dhtml_path'] + "notifications.html", new_window: { 'height': 680 }, description: "Model Notifications and Settings" }, 'private': { description: "Go private with %USERNAME% now!" }, voyeur: { description: "Spy on %USERNAME%'s show now!" }, tip: { title: "Tip", page: g_Paths.phpPathPublic + "tip.php?request=tip", new_window: { 'height': 475,'width': 485,'status': 0,'scrollbars': 1 }, center_window: 1, position: 'center', description: "Give Tokens to %USERNAME%" }, news: {
 page: "https://wiki." + g_hC['domain'] + "/wiki/News", sm_icon: "newsfeed.16x16.png", sprite_css: "sprite-icons sprite-newsfeed16x16", target: '_blank', title: "Recent News", description: "Recent news at " + g_hC['site_name'] + ".com" }, tx_remove_friend: { description: "Remove this person from your friends list" }, tx_add_friend: { description: "Add this person to your friends list" }, tx_toggle_to_friend: { description: "Change this " + g_hPlatform.performer + " to a friend" }, tx_toggle_to_bookmark: { description: "Change this " + g_hPlatform.performer + " to a bookmark" }, tx_remove_bookmark: { description: "Remove this person from your bookmarks" }, room_helper: { description: "You have the ability to execute room management commands on behalf of the " + g_hPlatform.performer + "" }, tx_add_bookmark: { description: "Add this person to your bookmarks" }, tx_add_ignore: { description: "Ignore this person. You can edit your ignore preferences in the Chat Options menu" }, tx_remove_ignore: { description: "Discontinue ignoring this user" }, highlight_chat: { description: "Highlight the chat of this user." }, whiteboard: { title: "Whiteboard", new_window: { 'menubar': 0,'resizable': 1,'scrollbars': 1,'titlebar': 0,'toolbar': 0,'status': 0 }, page: g_hC['dhtml_path'] + "whiteboard.html", new_window: { 'width': 800,'status': 0,'scrollbars': 1 }, description: "%USERNAME%'s Whiteboard" }, mfc_social: { title: "MFC Social", page: 'https://social.myfreecams.com/%PATH%', target: '_blank', description: "%USERNAME%'s MFC Social",
 no_query_string: true }, mfc_social_embed: { title: "MFC Social", page: 'https://social.myfreecams.com/%USERNAME%', description: "%USERNAME%'s MFC Social" }, mfc_share_base: { title: "MFC Share", page: 'https://share.myfreecams.com/%PATH%', target: '_blank', description: "MFC Share 🌴", no_query_string: true }, mfc_share: { title: "MFC Share", page: 'https://share.myfreecams.com/%PATH%', target: '_blank', description: "%USERNAME%'s MFC Share", no_query_string: true }, share_content: { title: "MFC Share", page: 'https://share.myfreecams.com/%TYPE%/%SLUG%', description: "%USERNAME%'s MFC Share" }, mfc_share_embed: { title: "MFC Share", page: 'https://share.myfreecams.com/embed/u/%USERNAME%', description: "%USERNAME%'s MFC Share" }, ios_app: { title: "iOS App", page: 'https://itunes.apple.com/us/app/camyou/id1276396758', new_window: { }, target: 'new_window', description: "Our iOS App" }, all_cams: { page: g_hC['dhtml_path'] + "all_cams.html", description: "All Cams" }};var g_ShareThings = { 'album': { img_host: ( 'https://share-thumbs.' + g_hPlatform.domain ), abbrev: 'a' }, 'club ': {
 img_host: ( 'https://share-media.' + g_hPlatform.domain ), abbrev: 'm' }, 'goal': { img_host: ( 'https://share-media.' + g_hPlatform.domain ), abbrev: 'g' }};

// js_build_core: js/MfcBrokenImageDetector.js
function MfcBrokenImageDetector(hOptions ){ if ( ! hOptions ) hOptions = {}; this.hOptions = { nProfileUserId: 0, nUserId: 0, sToken: '', sImgSelector: '', sImgParentSelector: '', sReportUrl: '//www.' + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") + '/php/MfcBrokenImageDetector.php', bDebug: false }; this._MergeInOptions(hOptions ); if ( this.hOptions.bDebug ) this._injectDebugConsole();}MfcBrokenImageDetector.prototype._MergeInOptions = function(hOptions ){ for (var option in hOptions) { this.hOptions[option] = hOptions[option]; }};
MfcBrokenImageDetector.prototype._injectDebugConsole = function(){ $('body').prepend('<div id="mfcImgValidatorDebug" style="position: fixed; top: 5px; left: 5px; color: yellow; background-color: #000; width: 600px; height: 100px; overflow: scroll; padding: 7px; font-size: 12px; font-family: Fixed, monospace; border: 2px #f00 dotted; z-index: 40000;"></div>'); this.debugConsole = $('#mfcImgValidatorDebug');};MfcBrokenImageDetector.prototype._debug = function(sMsg){ if ( ! this.hOptions.bDebug ) return; if (window.console && console.log) { console.log(sMsg); } this.debugConsole .html(this.debugConsole.html() + "<div>" + sMsg + "</div>") .scrollTop(this.debugConsole.height());};MfcBrokenImageDetector.prototype.checkImages = function(){ var self = this; $( this.hOptions.sImgSelector ).one('error', function() { $(this).data('mfc-failed', true); self._debug('IMG FAILED: ' + $(this).attr('src')); var parentEl = $(this).closest(self.hOptions.sImgParentSelector); if ( parentEl.length ) self.reportImage(parentEl.attr('id'), $(this).attr('src') ); }).each(function () { if (this.complete || this.readyState === 'completed') return; if ( ! $(this).data('mfc-failed') ){ var origSrc = $(this).attr('src'); $(this).attr('src', origSrc); } });};MfcBrokenImageDetector.prototype.reportImage = function(sIdentifier, sURL ){
 this._debug('parent id: ' + sIdentifier); var data = { token: this.hOptions.sToken, id: sIdentifier, url: sURL, profile_user: this.hOptions.nProfileUserId, user_id: this.hOptions.nUserId }; $.ajax({ cache: false, url: this.hOptions.sReportUrl, success:function(result) {}, data: data });};

// js_build_core: js/MfcChatImageControls.js
function MfcChatImageControls(hConstructorOptions ){ this.hParams = {}; this.hUA = new MfcUserAgent(); this.image_url = hConstructorOptions.image_url || ( t && t.g_hPlatform && t.g_hPlatform.image_url ) || 'https://img.camcdn.com/'; MfcChatImageControls.nInstanceId = typeof MfcChatImageControls.nInstanceId == 'number' ? MfcChatImageControls.nInstanceId + 1 : 0; this.nInstanceId = MfcChatImageControls.nInstanceId; MfcChatImageControls.hObjectRef = MfcChatImageControls.hObjectRef || {}; MfcChatImageControls.hObjectRef[ this.nInstanceId ] = this; if(hConstructorOptions ) {
 for(var sK in hConstructorOptions ) { this.hParams[sK] = hConstructorOptions[sK]; } } if(t && t.g_hWindows ) { for(var sWindowKey in t.g_hWindows ) if(t.g_hWindows[ sWindowKey ].window == window ) this.sCallingWindowName = t.g_hWindows[ sWindowKey ].name; } else { this.sCallingWindowName = window.name; } if(! this.hParams.user ) { this.hParams.user = 0; }}MfcChatImageControls.prototype.deregister = function(){ this.hParams = null; delete MfcChatImageControls.hObjectRef[ this.nInstanceId ];};MfcChatImageControls.prototype.place_controls = function(){ var sH; var sExtra = ''; if(this.hUA.mobile || this.hUA.tablet ) { sExtra = "style=\"padding-right:13px;\" "; } var sSmileyUrl, sImgUrl, sStyle; if(t && t.g_hPlatform && t.g_hPlatform.code == 'cam' ) { sSmileyUrl = this.image_url + "files/images/icons/emoticon_icon.png"; sImgUrl = this.image_url + "/images/flat/stroke/svg/photo-1.svg"; sStyle = "height:13px;"; } else { sSmileyUrl = this.image_url + "files/images/icons/emoticon_icon.png"; sImgUrl = this.image_url + "files/images/icons/pic_icon.gif"; } if(this.hParams.user.access_level < 2 )
 { sH = A('purchase') + " <img " + sExtra + " style=\"" + sStyle + "\" id=insert_image_button title=\"Insert an image into chat\" src=\"" + sImgUrl + "\"></a> <img " + sExtra + " onClick=\"MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].load_menu();\" style='cursor:pointer;' src=\"" + sSmileyUrl + "\" ></a> "; } else { sH = A('user_chat_images',{ text_input_id: this.hParams.text_input_id, is_textarea: this.hParams.is_textarea, calling_window_name: this.sCallingWindowName }) + " <img " + sExtra + " style=\"" + sStyle + "\" id=insert_image_button title=\"Insert an image into chat\" src=\"" + sImgUrl + "\"></a> <img " + sExtra + " onClick=\"MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].load_menu();\" style='cursor:pointer;' src=\"" + sSmileyUrl + "\" ></a> "; } if(this.hParams.control_container ) this.hParams.control_container.innerHTML = sH; else console.log('MfcChatImageControls missing control_container');};MfcChatImageControls.prototype.setCurrent = function(sMode ){ if(t && t.MfcChatImageControls ) t.MfcChatImageControls.current = sMode; else this.current = sMode;};MfcChatImageControls.prototype.getCurrent = function(sMode ){ if(t && t.MfcChatImageControls && t.MfcChatImageControls.current ) return t.MfcChatImageControls.current; else if ( this.current ) return this.current; else return 'standard_emoticons';};MfcChatImageControls.prototype.load_menu = function()
{ this.mfc_dhtml_popup = new MfcDhtmlPopup({ window: window }); if(! this.mfc_dhtml_popup.bIsOpen ) { this.mfc_dhtml_popup.open("<div style=\"width:565px;height:215px;text-align:right;\"> &nbsp; </div> "); } if(this.getCurrent() == 'personal_library' ) this.load_personal_library(); else this.load_standard_emoticon_menu();};MfcChatImageControls.prototype.load_standard_emoticon_menu = function(){ this.setCurrent('standard_emoticons'); var sHtml = this.draw_standard_emoticon_menu(); this.mfc_dhtml_popup.update(sHtml );};MfcChatImageControls.prototype.draw_standard_emoticon_menu = function(){ var aAllowedEmoticons = new Array(1,363,343,569,364,289,551,34,115,452,270,330,463,116,278,325,367,448,369,518,152,74,301,122,123,587,563,43,155,179,314,504,200,27,406,326,203,292,348,164,132,12,13,465,259,524,535,444,47,566,139,140,3,26,417,173,175,177,178,372,176,107,71,386,573,397,210,174,231,33,430,211,119,398,449,427,163,161,214,196,284,216,129,35,470,510,531,29,321,10,19,265,153,193,320,11,28,118,221,522,383,401,146,21,22,253,255,198,127,81,70,39,97,62,513,63,281,65,156,66,327,60,394,208,52,61,53); hAllowedEmoticons_Reverse = {}; for(var i=0; i < aAllowedEmoticons.length; i++ ) { hAllowedEmoticons_Reverse[aAllowedEmoticons[i]] = 1; } var aEmotes = new Array(); for(var sShortcut in ParseEmoteInput.prototype.m_hEmoticonMap ) { if(! hAllowedEmoticons_Reverse[ParseEmoteInput.prototype.m_hEmoticonMap[sShortcut].id] ) continue; aEmotes.push(" <div style=\"height:28px;padding:0px;margin:0px;vertical-align:middle;float:left;overflow-y:hidden;\"> <i"+"mg style='cursor:pointer;' onClick=\"MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].insert_emoticon('" + sShortcut + "'); return false;\" src=" + this.image_url + "files/images/emoticons/"+ParseEmoteInput.prototype.m_hEmoticonMap[sShortcut].id+".gif border=0 title='"+sShortcut+"' > </div>" ); }
 if ( ! this.hParams.user.access_level ) { return " <div style=\"clear:both;height:120px;text-align:right;\"> " + aEmotes.join('') + " <div style=\"float:right;\"> &nbsp; &nbsp;" + A('register') + "Click here</a> to become a member free and access hundreds of emoticons! &nbsp;&nbsp; &nbsp;<a href=\"javascript:MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].close_basic_menu('" + this.nInstanceId +"','');\"><b>Close</b></a>&nbsp;&nbsp;</div> </div> "; } else { aH = new Array(); aH.push(" <div style=\"width:560px;height:215px;text-align:right;\"> <div style=\"text-align:right;width:560px;height:200px;clear:both;border:0px dashed blue;\"> " + aEmotes.join('') + " </div> "); aH.push("<div style=\"clear:both;height:15px;vertical-align:bottom;text-align:right;border:0px dashed red;\">"); aH.push(this.controls_html() ); aH.push("</div>"); return aH.join(''); }};MfcChatImageControls.prototype.controls_html = function(){ var aH = []; if(this.hParams.user.access_level >= 2 ) { if(this.getCurrent() == 'personal_library' ) aH.push("<a href=# onClick=\"MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].load_standard_emoticon_menu();\"><b>Standard Emoticons</b></a> | "); else aH.push("<a href=# onClick=\"MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].load_personal_library();\">Personal Library</a> | "); } aH.push("<a href=\"#\" onClick=\" window.open('/emoticons/?instance_id=" + this.nInstanceId + "','more_emoticons'); return false; \">More Emoticons</a> | "); if(this.hParams.user.access_level >= 2 ) { aH.push(A('user_chat_images',{category:29, text_input_id:this.hParams.text_input_id, is_textarea:this.hParams.is_textarea, calling_window_name: this.sCallingWindowName }) ); } else if(this.hParams.user.access_level == 1 ) { aH.push(A('premium_feature',{style:'color:gray;'}) ); }
 else { aH.push(A('members_feature',{style:'color:gray;'}) ); } aH.push("User Submitted Emoticons</span></a> | "); if(this.hParams.user.access_level >= 2 ) { aH.push(A('user_chat_images',{ text_input_id:this.hParams.text_input_id, is_textarea:this.hParams.is_textarea, calling_window_name: this.sCallingWindowName }) + "<span onClick=\"MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].close_basic_menu('" + this.nInstanceId +"','');\">"); } else if(this.hParams.user.access_level == 1 ) { aH.push(A('premium_feature',{style:'color:gray;'}) ); } else { aH.push(A('members_feature',{style:'color:gray;'}) ); } aH.push("Emoticon Lookup</span></a> |  <a href=\"javascript:MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].close_basic_menu('" + this.nInstanceId +"','');\">Close</a></div> "); return aH.join('');};MfcChatImageControls.prototype.load_personal_library = function(){ MfcChatImageControls.PLReq = new XMLHttpRequest(); var qs = Math.random(); MfcChatImageControls.PLReq.open("GET","/php/user_chat_images.php?personal_library_json=1"); MfcChatImageControls.PLReq.withCredentials = true; MfcChatImageControls.PLReq.onreadystatechange = () => { this.load_personal_library_callback(); }; MfcChatImageControls.PLReq.send();};MfcChatImageControls.prototype.load_personal_library_callback = function(){ if ( MfcChatImageControls.PLReq.readyState !== 4 ) { return; } this.setCurrent('personal_library'); var aPL = JSON.parse(MfcChatImageControls.PLReq.responseText ); var aH = []; aH.push(" <div style=\"text-align:left;width:560px;height:20px;\"> " + A('user_chat_images',{category:'user_lib', text_input_id:this.hParams.text_input_id, is_textarea:this.hParams.is_textarea, calling_window_name: this.sCallingWindowName }) + " Manage Personal Library</a> </div> <div style=\"text-align:right;width:560px;height:170px;overflow-y:auto;border:0px dashed blue;margin-bottom:10px;\"> "); for(var a = 0; a < aPL.length; a++ )
 { aH.push("<i"+"mg src=" + aPL[a].thumb + " style=\"cursor:pointer;\" onClick=\"MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].insert_emoticon(':" + aPL[a].shortcut + "'); return false;\" title=':" + aPL[a].shortcut + "' >"); } if(aPL.length == 0 ) { aH.push(" <div style=\"color:gray;font-style:italic;padding:30px;text-align:center;\"> You currently do not have any images in your  " + A('user_chat_images',{category:'user_lib', text_input_id:this.hParams.text_input_id, is_textarea:this.hParams.is_textarea, calling_window_name: this.sCallingWindowName }) + "Personal Library</a>. <br><br> Browse the " + A('user_chat_images',{ text_input_id:this.hParams.text_input_id, is_textarea:this.hParams.is_textarea, calling_window_name: this.sCallingWindowName }) + "Image Categories</a> and click the link labled 'Add to My Library' to add that image to your Personal Library. <br><br> Return to <a href=# onClick=\"MfcChatImageControls.hObjectRef[ " + this.nInstanceId + " ].load_standard_emoticon_menu();\">Standard Emoticons</a>. </div> "); } aH.push(" </div> "); aH.push("<div style=\"clear:both;height:15px;vertical-align:bottom;text-align:right;border:0px dashed red;\">"); aH.push(this.controls_html() ); aH.push("</div>"); this.mfc_dhtml_popup.update(aH.join('') );};MfcChatImageControls.prototype.close_basic_menu = function(){ this.mfc_dhtml_popup.close(); document.getElementById(this.hParams.text_input_id).focus();};MfcChatImageControls.prototype.insert_emoticon = function(sEmoticon ){ this.mfc_dhtml_popup.close(); var oTextArea; if ( oTextArea = document.getElementById(this.hParams.text_input_id) ) MfcChatImageControls.typeInTextarea(oTextArea,sEmoticon + ' ');
 else console.log("InsertEmoticons found no this.hParams.text_input_id element");};MfcChatImageControls.typeInTextarea = function(el, newText) { var start = el.selectionStart; var end = el.selectionEnd; var text = el.value; var before = text.substring(0, start); var after = text.substring(end, text.length); el.value = (before + newText + after); el.selectionStart = el.selectionEnd = start + newText.length; el.focus();}

// js_build_core: js/MfcGraphics.js
var d = d || document; var g_hC = g_hC || {};var hGraphicsSettings = hGraphicsSettings || {};var g_hCache = g_hCache || {};var g_hDocumentReferences = g_hDocumentReferences || {};function MfcGraphics(hConstructorOptions ){ hConstructorOptions = hConstructorOptions || {}; this.image_url = hConstructorOptions.image_url || ( t && t.g_hPlatform && t.g_hPlatform.image_url ) || 'https://img.camcdn.com/'; this.hCache = {}; this.oSelf = this; var g_hC = g_hC || {}; this.hSettings = {}; for(var sK in g_hC ) { this.hSettings[sK] = g_hC[sK]; } if(hConstructorOptions ) { for(var sK in hConstructorOptions ) { this.hSettings[sK] = hConstructorOptions[sK]; } }}MfcGraphics.prototype.isStyleSheetFileLoaded = function(uri){ var ss = document.styleSheets; for ( var i = 0, len = ss.length; i < len; i++ ) { if ( typeof(ss[i].href) === 'string' && ss[i].href.match(uri) ) { return true; } } return false;};MfcGraphics.prototype.load_style = function(){ if(typeof(g_nVcc ) == 'undefined' ) { g_nVcc = 1; } var sStyle = 'mfc'; if(this.hSettings['no_style'] ) { return; } this.hSettings['site_path'] = ( window.g_sCdnHost || '' ); if(location.href.match(/\/mfc-/) ) { this.hSettings['img_path'] = "/files/styles/"+sStyle+"/"; } else { this.hSettings['img_path'] = this.image_url + "files/styles/"+sStyle+"/"; } this.hSettings['style_path'] = this.hSettings['site_path'] + "/css/"; var platformCode, matches;
 try { if(t && t.g_hPlatform && t.g_hPlatform.code ) { platformCode = t.g_hPlatform.code; } else if(top && top.g_hPlatform && top.g_hPlatform.code ) { platformCode = top.g_hPlatform.code; } else { platformCode = 'mfc'; } } catch(e) { console.log(e); } var cssFile = '/css/' + ( platformCode || 'mfc' ) + '_style.css'; if ( !this.isStyleSheetFileLoaded(cssFile) ) { var oCssNode = document.createElement('link'); oCssNode.type = 'text/css'; oCssNode.rel = 'stylesheet'; oCssNode.href = this.hSettings['site_path'] + cssFile + '?no_cache=' + g_nVcc; oCssNode.media = 'screen'; oCssNode.crossOrigin = 'anonymous'; document.getElementsByTagName("head")[0].appendChild(oCssNode); }};MfcGraphics.prototype.container_sprites = function(sContainer ){ var hContainerSettings = { container: { tl: "<div class='sprite-icons sprite-tl'></div>", tr: "<div class='sprite-icons sprite-tr'></div>", bl: "<div class='sprite-icons sprite-bl'></div>", br: "<div class='sprite-icons sprite-br'></div>" } }; return hContainerSettings[sContainer];};MfcGraphics.prototype.container = function(sOptions, sContent, hOptions ){ if(location.search.match(/nocontainers/) ) return; hOptions = hOptions || {}; for(var sK in this.hSettings ) { hOptions[sK] = this.hSettings[sK]; } var aOptions = sOptions.match(/\w+/g); for(var n=0; n < aOptions.length; n++ ) { hOptions[ aOptions[n] ] = true; }
 var hUA = new MfcUserAgent(); var sDimensions=""; var sCssDimensions=""; var sExtraContentStyle = hOptions['extra_content_style'] || ""; var sExtraContentClass = hOptions['extra_content_class'] || ""; var sContainer=''; if(hOptions['menu_container']) sContainer = 'menu_container'; else if(hOptions['input_container']) sContainer = 'input_container'; else if(hOptions['sub_content_container']) sContainer = 'sub_content_container'; else if(hOptions['alt_content_container']) sContainer = 'alt_content_container'; else if(hOptions['content_container']) sContainer = 'content_container'; else if(hOptions['popup_container']) sContainer = 'popup_container'; else sContainer = 'container'; var bIsFramed=0; try { if(( ! g_ExternalCaller && top.location.href != window.location.href ) || ( location.href.indexOf('style_override=profiles') > -1 ) || ( location.href.indexOf('style_override=embed') > -1 ) ) { bIsFramed = 1; } } catch(oError ) { console.log('MfcGraphics.prototype.container error'); console.log(oError ); bIsFramed = 1; } if(bIsFramed && sContainer == 'container' && ! hOptions['no_override'] && location.href.indexOf('/top') == -1 && location.href.indexOf('/player') == -1 && location.href.indexOf('/pm') == -1 && location.href.indexOf('chat_logs.php') == -1 && location.search.indexOf('dhtml_window') == -1 )
 { if(sContainer == 'menu_container' ) { sContainer = 'alt_content_container'; } else if(sContainer == 'input_container' ) { return; } hOptions['container_class_only'] = 1; document.body.style.margin = '0px'; document.body.classList.remove('outer_body'); document.body.classList.add('inner_body'); } else if(! opener && parent ) { var nEmbed = 0; try { if(! g_ExternalCaller && top.location.href.match(/^http[s]?:\/\/profiles.\w+.com/) && ( parent.location.href != location.href || parent.name == 'top_level' ) ) { nEmbed = 1; } } catch(oError) { nEmbed = 1; } try { if(nEmbed ) { hOptions['no_style'] = 1; if(sContainer == 'container') { sContainer = 'content_container'; } else if(sContainer == 'input_container') { return; } 
 sOptions += ' ' + sContainer; document.body.className = 'inner_body'; } } catch(oError) { } } if(hOptions['expanded'] ) { sCssDimensions=" height: 100%; width: 100%; "; sDimensions = " height=100% width=100% "; sExtraContentStyle += "font-size:13px;"; } else if(hOptions['contracted'] || hOptions['input_container'] ) { sDimensions = " "; sExtraContentStyle += "font-size:1px;"; } else { sDimensions = " width=100% "; sExtraContentStyle += "font-size:13px;"; } var sCacheKey = sOptions + sExtraContentStyle + sExtraContentClass; if(! sContent && this.hCache[sCacheKey] ) { return this.hCache[sCacheKey]; } var sTop='',sBottom='',sStyleDivs=''; if ( hOptions['container_class_only'] ) { if(sCssDimensions ) { sCssDimensions = " style=\" " + sCssDimensions + " \" "; } sTop = " <div data-container1 class=" + sContainer + sCssDimensions + "> <div class=" + sContainer + "_table_td> "; sBottom = " </div> </div> "; } else if ( hOptions['stylesheet'] || hOptions['no_style'] ) { sTop = "\
 <div data-container2 class=container_padding> <div class=container_transparency > <div class=container > "; sBottom = " </div> </div> </div> "; } else if(! hUA.IE || hUA.IE > 9 ) { sTop = " <table data-container3 cellpadding=0 cellspacing=0 " + sDimensions + " border=0>\n <td class='" + sContainer + "_wrapper'>\n <table class='" + sContainer + "_table' " + sDimensions + " cellpadding=0 cellspacing=0 border=0> <td class='" + sContainer + " " + sContainer + "_css3 " + sContainer + "_table_td " + sContainer + "_outer_content "+sExtraContentClass+"' valign=top style=\"" + sExtraContentStyle + "\"> "; sBottom = " </td> </table> </td> </table> "; } else { var hCorners = this.container_sprites(sContainer ); if(! hCorners ) { if(sContainer !== 'popup_container' ) { hCorners = { tl: "<i" + "mg class=" + sContainer + "_img_tl src=\"" + hOptions['img_path'] + "/images/" + sContainer + "/tl.gif\">", tr: "<i" + "mg class=" + sContainer + "_img_tr src=\"" + hOptions['img_path'] + "/images/" + sContainer + "/tr.gif\">", bl: "<i" + "mg class=" + sContainer + "_img_bl src=\"" + hOptions['img_path'] + "/images/" + sContainer + "/bl.gif\">", br: "<i" + "mg class=" + sContainer + "_img_br src=\"" + hOptions['img_path'] + "/images/" + sContainer + "/br.gif\">" }; } else { hCorners = {tl: '', tr: '', bl: '', br: ''}; } } sTop = "\n <table cellpadding=0 cellspacing=0 " + sDimensions + " border=0>\n\
 <td class='" + sContainer + "_wrapper'>\n <table class='" + sContainer + "_table' " + sDimensions + " cellpadding=0 cellspacing=0 border=0 width=100%>\n <tr>\n <td colspan=2 class='graphic " + sContainer + "_table_td " + sContainer + "_l' valign=top align=left style=\"background-image:url('" + hOptions['img_path'] + "/images/" + sContainer + "/t.gif'); \">" + hCorners.tl + "</td>\n <td rowspan=2 class='graphic " + sContainer + "_table_td graphic " + sContainer + "_t' valign=top align=right style=\"background:url('" + hOptions['img_path'] + "/images/" + sContainer + "/r.gif') repeat-y scroll top right;\">" + hCorners.tr + "</td>\n </tr>\n <tr>\n <td rowspan=2 class='graphic " + sContainer + "_table_td " + sContainer + "_l' valign=bottom align=left\n style=\"background:url('" + hOptions['img_path'] + "/images/" + sContainer + "/l.gif') repeat-y scroll bottom left;vertical-align:bottom;\">" + hCorners.bl + "</td>\n <td height=100% width=100% class='" + sContainer + " " + sContainer + "_table_td " + sContainer + "_outer_content "+sExtraContentClass+"' valign=top style=\"" + sExtraContentStyle + "\">"; sBottom = "</td>\n </tr>\n <tr>\n <td colspan=2 class='graphic " + sContainer + "_table_td " + sContainer + "_b' valign=bottom align=right\n style=\"background:url('" + hOptions['img_path'] + "/images/" + sContainer + "/b.gif') repeat-x scroll bottom right;\">" + hCorners.br + "</td>\n </tr>\n </table>\n </td>\n </table>\n "; } var sH = ""; if(hOptions['top'] ) { sH = sTop; } else if(hOptions['bottom'] ) { sH = sBottom; } else { sH = sTop + sContent + sBottom; } this.hCache[sOptions] = sH; return sH;};MfcGraphics.prototype.heading = function(sText,icon,hOptions){ hOptions = hOptions || {}; var sIconHtml = '';
 if(typeof(icon ) == 'object' ) { var platformCode = 'mfc'; if(t && t.g_hPlatform && t.g_hPlatform.code ) { platformCode = t.g_hPlatform.code; } else if(object[ t.g_hPlatform.code ] ) { platformCode = object[ t.g_hPlatform.code ]; } } if(t && t.g_hPlatform && t.g_hPlatform.code == 'cam' ) { icon=null; } if(icon ) { var sImgHost = hOptions.image_url || ( t && t.g_hPlatform && ( t.g_hPlatform.image_url_cdn || t.g_hPlatform.image_url ) ) || 'https://img.camcdn.com/'; var sImagePath = ''; if(icon.indexOf('ico/') > -1 ) { sImagePath = sImgHost + "/files/"; } else if(icon.indexOf('svg/') > -1 ) { sImagePath = "/files/images/icons/"; } else { sImagePath = sImgHost + "/files/images/icons/"; } sIconHtml = "<div class=icon>"; if(hOptions && hOptions['link'] ) { sIconHtml += hOptions['link']; } sIconHtml += "<i" + "mg class=heading_icon src=\"" + sImagePath + icon + "\" height=48 ></a></div>"; } sH = " <div class=heading> " + sIconHtml + " <div class='text" + ( sIconHtml ? ' style="margin-left:48px;" ' : '' ) + " heading_title'> " + sText + " </div> </div> "; return sH;};

// js_build_core: js/MfcHTML.js
function MfcPaging(sAction, sItemsPerPage, hOptions ){ this.sAction = sAction; this.sItemsPerPage = sItemsPerPage; this.hOptions = hOptions || {}; this.nTotalPages = 0; this.nPage = 1; if(typeof(MfcPaging.nInstanceId) == 'number' ) MfcPaging.nInstanceId++; else MfcPaging.nInstanceId = 1; this.nInstanceId = MfcPaging.nInstanceId; if(MfcPaging.hInstances == undefined ) MfcPaging.hInstances = {}; MfcPaging.hInstances[ this.nInstanceId ] = this;};MfcPaging.prototype.GetHTML_PrevNext = function(nTotalRecords ){ this.nTotalPages = Math.ceil(nTotalRecords / this.sItemsPerPage ); var sPagingHtml=''; if(this.nTotalPages < 2 ) { return ''; } if(this.nPage > 1 ) sPagingHtml += "<a href=\"javascript: MfcPaging.hInstances["+this.nInstanceId+"].nPage--;" + this.sAction + "; \">&lt; Prev</a> "; else sPagingHtml += "<span style=\"color:#CCC;\">&lt; Prev</span> "; sPagingHtml += " | "; 
 if(this.nPage < this.nTotalPages ) sPagingHtml += "<a href=\"javascript: MfcPaging.hInstances["+this.nInstanceId+"].nPage++;" + this.sAction + "; \">Next &gt;</a> "; else sPagingHtml += "<span style=\"color:#CCC;\">Next &gt;</span> "; return sPagingHtml; };MfcPaging.prototype.GetHTML = function(nTotalRecords ){ this.nTotalPages = Math.ceil(nTotalRecords / this.sItemsPerPage ); var sPagingHtml; if(this.nTotalPages < 1 ) { return ''; } if(this.hOptions.prefix_pattern ) { sPagingHtml = this.hOptions.prefix_pattern; sPagingHtml = sPagingHtml.replace(/CURRENT_PAGE/,this.nPage); sPagingHtml = sPagingHtml.replace(/TOTAL_PAGES/,this.nTotalPages); } else { sPagingHtml = 'Page ' + this.nPage + " of " + this.nTotalPages + ": &nbsp;"; } var sSpace = this.hOptions.compact ? '&nbsp;' : ''; if(this.nPage > this.nTotalPages ) { this.nPage = this.nTotalPages; } if(this.nTotalPages > 6 ) { if(this.nPage > 1 ) { sPagingHtml += " <a href=\"javascript: MfcPaging.hInstances["+this.nInstanceId+"].nPage=1;" + this.sAction + "; \">First</a>" + sSpace + " <a href=\"javascript: MfcPaging.hInstances["+this.nInstanceId+"].nPage--;" + this.sAction + "; \">&lt;</a> "; } else { sPagingHtml += "First&nbsp; &lt; "; } } var nNumericLinkCount = this.hOptions.numeric_link_count || 7; var nLowerBound = Math.floor(nNumericLinkCount/2);
 var nLookBack = this.nPage > ( this.nTotalPages - nLowerBound ) ? ( ( ( (nNumericLinkCount-1) - this.nTotalPages ) + this.nPage ) ) : nLowerBound; var nUpperBound = Math.ceil(nNumericLinkCount/2); var nLookAhead = this.nPage < nUpperBound ? ( ( nNumericLinkCount+1 ) - this.nPage ) : nUpperBound; for(var n = ( this.nPage - nLookBack ) ; n < ( this.nPage + nLookAhead ); n++ ) { if(n < 1 || n > this.nTotalPages ) { continue; } if(this.nPage == n ) { sPagingHtml += '<b>' + n + '</b>, '; } else { sPagingHtml += "<a href=\"javascript: MfcPaging.hInstances["+this.nInstanceId+"].nPage=" + n + "; " + this.sAction + " ;\">" + n + "</a>, "; } } sPagingHtml = sPagingHtml.substring(0,sPagingHtml.length - 2); if(this.nTotalPages > 7 ) { if(this.nPage != this.nTotalPages ) { sPagingHtml += " <a href=\"javascript: MfcPaging.hInstances["+this.nInstanceId+"].nPage++;" + this.sAction + "; \">&gt;</a>" + sSpace + " <a href=\"javascript: MfcPaging.hInstances["+this.nInstanceId+"].nPage=" + this.nTotalPages + ";" + this.sAction + "; \">Last</a> "; } else { sPagingHtml += " &gt;" + sSpace + " Last "; } } return sPagingHtml;};function MfcDhtmlPopup(hInstanceOptions ){
 if(typeof(hInstanceOptions) != 'object' ) { hInstanceOptions = {}; } MfcDhtmlPopup.clean_up_popups(); this.hInstanceOptions = hInstanceOptions; ++MfcDhtmlPopup.nInstanceCount; if (window.opener) { this.isPopup = true; } else if (window.top !== window.self) { this.isIframe = true; } this.sPopupInstanceName = hInstanceOptions.instance_name || ( 'popup' + ( MfcDhtmlPopup.nInstanceCount ) ); this.nInstanceCount = MfcDhtmlPopup.nInstanceCount; this.parentClass = hInstanceOptions.parentClass || ''; this.mfcGraphics = hInstanceOptions.mfcGraphics || new MfcGraphics(); this.fConvertToPersistentCallback = hInstanceOptions.convert_to_persistent_callback || function(){}; if(location.search.match(/calling_mode=independent|style_override=profiles|style=mobile/) ) { this.window = window; } else { this.window = hInstanceOptions.window || ( this.isIframe && window.top ) || window; } this.mfcMouseTracker = ( this.window.g_oMouseTracker ) || hInstanceOptions.mfcMouseTracker; this.persistent = hInstanceOptions.persistent; this.window.MfcDhtmlPopup.register[ this.sPopupInstanceName ] = this; this.nOpacityTimeout; this.hbNoCloseOnMouseout = {}; this.nPopupResizeCounter = 0; this.hOpts = ''; this.bIsOpen = false; this.UA = new MfcUserAgent(); this.fResizeCallback = hInstanceOptions.fResizeCallback; this.fCloseCallback = hInstanceOptions.fCloseCallback; this.instantiated = false;};MfcDhtmlPopup.nInstanceCount = 0;MfcDhtmlPopup.register = {};
MfcDhtmlPopup.get_popup = function(instanceName ){ if(MfcDhtmlPopup.register[ instanceName ] && MfcDhtmlPopup.register[ instanceName ].markForCleanup ) { return; } return MfcDhtmlPopup.register[ instanceName ];};MfcDhtmlPopup.clean_up_popups = function(){ for(var instanceName in MfcDhtmlPopup.register ) { if(! MfcDhtmlPopup.register[instanceName].persistent && MfcDhtmlPopup.register[instanceName].markForCleanup ) { if(MfcDhtmlPopup.register[instanceName].oMasterDiv ) { var win = MfcDhtmlPopup.register[instanceName].window; var el = win && win.document && win.document.getElementById(instanceName + '_master' ); if(el ) { if(MfcDhtmlPopup.register[instanceName].eventMouseDownFn ) { el.removeEventListener('mousedown', MfcDhtmlPopup.register[instanceName].eventMouseDownFn); } el.remove(); } } delete MfcDhtmlPopup.register[instanceName]; } }};MfcDhtmlPopup.prototype.dhtml_popop_html = function(){ if(! this.mfcGraphics ) { this.mfcGraphics = new MfcGraphics(); } var sHtml = "<div class=\"dhtml_popup " + this.parentClass + " \" id=" + this.sPopupInstanceName + " onContextMenu=\" return MfcDhtmlPopup.register['" + this.sPopupInstanceName + "'] && MfcDhtmlPopup.register['" + this.sPopupInstanceName + "'].check_for_context_lock(event,this); \" style='z-index:100;display:none;filter:progid:DXImageTransform.Microsoft.Shadow(color=#111111, Direction=155, Strength=12);border:0px dashed blue;' onMouseOut=\" if(MfcDhtmlPopup.register['" + this.sPopupInstanceName + "'] ) MfcDhtmlPopup.register['" + this.sPopupInstanceName + "'].popup_onmouseout(this,event); \" >" + this.mfcGraphics.container("top,popup_container,contracted",null,this.hInstanceOptions) + "<div id=" + this.sPopupInstanceName + "_content style='pointer-events: none;z-index:100;font-size:11px;margin:0px;border:0px dashed red;position: relative;" + '' + "'></div> " + this.mfcGraphics.container("bottom,popup_container,contracted")
 + "<div class=" + this.sPopupInstanceName + "_grip_move_top style=\"user-select: none;\"></div>" + "<div class=" + this.sPopupInstanceName + "_grip_move_bottom></div>" + "<div class=" + this.sPopupInstanceName + "_grip_move_left></div>" + "<div class=" + this.sPopupInstanceName + "_grip_move_right></div>" + "</div>"; this.oBody = this.window && this.window.document && this.window.document.getElementsByTagName('body')[0]; var sMasterDivId = this.sPopupInstanceName + '_master'; var oExisting; if(( oExisting = this.window.document.getElementById(sMasterDivId) ) && this.oBody && this.oBody.removeChild ) { this.oBody.removeChild(oExisting ); } this.oMasterDiv = this.window.document.createElement('div'); this.oMasterDiv.id = sMasterDivId; this.oMasterDiv.innerHTML = sHtml; this.eventMouseDownFn = (event) => { if(event.target.nodeName != 'A' && event.target.nodeName != 'IMG' && event.button == 0 ) { this.bring_to_front(); } }; this.oMasterDiv.addEventListener('mousedown', this.eventMouseDownFn); this.resetMasterDiv(); if(this.oBody && this.oBody.appendChild ) this.oBody.appendChild(this.oMasterDiv); this.instantiated = true;};MfcDhtmlPopup.prototype.resetMasterDiv = function(){ if(! this.oMasterDiv ) { return; } this.oMasterDiv.style.marginTop = ''; this.oMasterDiv.style.height = ''; this.oMasterDiv.style.overflow = '';
 this.oMasterDiv.style.position = 'absolute'; this.oMasterDiv.style.top = '0px'; this.oMasterDiv.style.left = '0px';};MfcDhtmlPopup.prototype.containsDOM = function(container, containee){ var isParent = false; do { if ((isParent = container == containee)) break; containee = containee.parentNode; } while (containee != null); return isParent;};MfcDhtmlPopuElementById(sId );};MfcDhtmlPopup.prototype.popup_onmouseout = function(oElement, oEvent ){ if(this.check_mouse_leave(oElement, oEvent ) && ! MfcDhtmlPopup.bCloseLock ) { this.close({ mouse_out: true, event: event }); }};MfcDhtmlPopup.prototype.check_mouse_leave = function(oElement, oEvent ){ var x = oEvent.clientX; var y = oEvent.clientY; var elementMouseIsOver = this.window.document.elementFromPoint(x, y); if(oElement.contains && oEvent.toElement ) { return ! oElement.contains(oEvent.toElement); } else if(oEvent.relatedTarget ) { return ! this.containsDOM(oElement, oEvent.relatedTarget); }};MfcDhtmlPopup.prototype.check_mouse_enter = function(oElement, oEvent ){ if ( oElement.contains && oEvent.fromElement ) { return ! oElement.contains(oEvent.fromElement); } else if (oEvent.relatedTarget) { return ! this.containsDOM(oElement, oEvent.relatedTarget); }};MfcDhtmlPopup.prototype.update = function(sHtml, hOptions ){ this.set_click_lock_timer(); hOptions = hOptions || {}; if(! this.bIsOpen ) return; var oEl_content = this.getEl(this.sPopupInstanceName + "_content"); if(oEl_content ) { { oEl_content.innerHTML = this.content_wrapper(sHtml ); } } if(hOptions.resize !== false ) { this.popup_resize('content_update'); } var oEl = this.getEl(this.sPopupInstanceName ); if(oEl && ! this.hOpts['enable_context_menu'] ) { oEl.oncontextmenu = function() { return false; }; }
};MfcDhtmlPopup.prototype.content_wrapper = function(sHtml ){ var dislay_controls = ''; var dislay_pin = ''; var font_size = ( this.UA.mobile || this.UA.tablet ) ? '17px' : '11px'; var buttons=''; var display_close_button = ''; if(this.sPopupInstanceName == 'MFCShare_DhtmlMenu' ) { display_close_button = 'width:50px;height:50px;opacity:0;cursor:pointer;'; } else if(( ! this.UA.isTouchDevice() && ! this.hOpts['no_close_on_mouseout'] ) || ( this.hOpts['no_close_button'] && this.sPopupInstanceName != 'MFCShare_DhtmlMenu' ) ) { display_close_button = 'display:none;'; } if(this.hOpts['option_to_pin'] ) { buttons += `<input type=button id="${this.sPopupInstanceName}_pin_button" value="Pin" style="font-size:${font_size};margin-left:5px;" onClick=" event.stopPropagation(); MfcDhtmlPopup.register['${this.sPopupInstanceName}'].pin_popup();">`; } buttons += `<input type=button id="${this.sPopupInstanceName}_close_button" value="Close" style="font-size:${font_size};margin-left:5px;${display_close_button}" onClick=" event.stopPropagation(); MfcDhtmlPopup.register['${this.sPopupInstanceName}'].close({'clicked_to_close':1, event:event});">`; if(this.UA.mobile || this.UA.tablet ) { sHtml = ` <div id="${this.sPopupInstanceName}_controls" style="text-align:right;padding-bottom:10px;white-space:nowrap;${dislay_controls}"> ${buttons} </div>` + sHtml; } else { sHtml += ` <div id="${this.sPopupInstanceName}_controls" style="position:absolute;top:-8px;right:-7px;font-size:11px;white-space:nowrap;${dislay_controls}"> ${buttons} </div>`; } sHtml += `
 <div id="${this.sPopupInstanceName}_content_foot" style="text-align:right;height:0px;"> <span id="${this.sPopupInstanceName}_content_foot_right" style="font-size:1px;border:0px solid red;">&nbsp;</span> </div>`; return sHtml;};MfcDhtmlPopup.prototype.pin_popup = function(){ this.popupPinned = ! this.popupPinned; var closeBtn = this.window.document.getElementById(this.sPopupInstanceName + "_close_button"); if(closeBtn ) closeBtn.style.display = 'block'; var pinBtn = this.window.document.getElementById(this.sPopupInstanceName + "_pin_button"); if(pinBtn ) pinBtn.style.display = 'none'; if(this.hOpts.on_pin_function ) { this.hOpts.on_pin_function(); }};MfcDhtmlPopup.prototype.convert_hover_to_persistent = function(){ var closeBtn = this.window.document.getElementById(this.sPopupInstanceName + "_close_button"); if(closeBtn ) closeBtn.style.display = 'block'; this.has_been_converted_to_persistent = 1; this.hbNoCloseOnMouseout[this.sPopupInstanceName] = 1; if(this.fConvertToPersistentCallback ) { this.fConvertToPersistentCallback(this); }};MfcDhtmlPopup.prototype.open = function(sHtml, mixedOptions ){ if(! this.instantiated ) { this.dhtml_popop_html(); } var hOpts={};
 if(typeof(mixedOptions ) == 'string' ) { hOpts = SpecString_To_Object(mixedOptions) || {}; } else { hOpts = mixedOptions || {}; } this.hOpts = this.hOpts || {}; for(var k in hOpts ) { this.hOpts[k] = hOpts[k]; } this.hOpts.event = hOpts.event || ( typeof(window.event) != 'undefined' && window.event ); if(this.hOpts.prevent_reopening ) { if(this.hOpts.opened_once ) { return; } this.hOpts.opened_once = true; } if(this.hOpts.persist_after_seconds ) { this.persist_after_seconds_timeout = setTimeout(() => { this.convert_hover_to_persistent(); }, 1000 * this.hOpts.persist_after_seconds ); } clearTimeout(this.nOpacityTimeout ); setTimeout(function() { MfcDhtmlPopup.bCloseLock = false; }, 100 ); MfcDhtmlPopup.bCloseLock = true; this.nPopupResizeCounter = 0; this.bIsOpen = 1; this.hbNoCloseOnMouseout[this.sPopupInstanceName] = this.hOpts['no_close_on_mouseout'] ? 1 : 0; var clickDragSides = { top: "top:-10px;left:0px;width:calc(100% - 100px);height:30px;", bottom: "bottom:-15px;left:0px;width:100%;height:30px;", left: "left:-10px;top:0px;width:30px;height:100%;", right: "right:-10px;top:40px;width:30px;height:calc(100% - 40px);" }; if(sHtml.match(/<iframe/) ) { this.hInstanceOptions.translucent_on_move = true; } if(! this.dragElement ) { for(var side in clickDragSides ) { this.dragElement = this.window.dragElement; 
 var oGrip = this.oMasterDiv.getElementsByClassName(this.sPopupInstanceName + "_grip_move_" + side )[0]; oGrip.style.cssText = "border:0px dashed orange;user-select: none;position:absolute;cursor:move;" + clickDragSides[side]; this.dragElement(this.oMasterDiv, oGrip, this.hInstanceOptions ); } } var oEl = this.getEl(this.sPopupInstanceName ); if(! oEl ) { return; } if(this.hOpts['outside_click_close'] ) { this.outside_click_close = (event) => { console.log(event, this.sPopupInstanceName); var el = event.target; var found; while(el.parentNode ) { if(found = ( el.getAttribute('id') == this.sPopupInstanceName + '_master' ) ) { break; } el = el.parentNode; } if(! found ) { this.close(); } }; document.body.addEventListener('mousedown', this.outside_click_close ); } oEl.style.display='block'; oEl.style.opacity = 1; if(this.hOpts['delay_sizing'] ) { oEl.style.visibility='hidden'; } var oEl_content = this.getEl(this.sPopupInstanceName + "_content"); if(oEl_content ) { oEl_content.innerHTML = this.content_wrapper(sHtml ); } this.popup_resize(); if(this.hOpts['delay_sizing'] ) { setTimeout(() => { this.popup_resize(); oEl.style.visibility='visible'; }, this.hOpts['delay_sizing'] || 0 ); } if(hOpts['container_class'] ) { this.oMasterDiv.classList.add(hOpts['container_class'] );
 } if(! this.hOpts['enable_context_menu'] ) { this.oMasterDiv.oncontextmenu = function() { return false; }; setTimeout(() => { this.oMasterDiv.oncontextmenu = function() { return true; }; },1000); } if(this.hOpts['hover'] && this.oMasterDiv.offsetHeight > window.innerHeight ) { var nDiff = this.oMasterDiv.offsetHeight - window.innerHeight; this.oMasterDiv.style.top = '0px'; this.oMasterDiv.style.marginTop = '-' + ( nDiff / 2 ) + 'px'; this.oMasterDiv.style.height = ( window.innerHeight + ( nDiff / 2 ) ) + 'px'; this.oMasterDiv.style.overflow = 'hidden'; } this.bring_to_front(); this.popup_reposition(); this.set_click_lock_timer();};MfcDhtmlPopup.prototype.set_click_lock_timer = function(event, el ){ var oEl_content = this.getEl(this.sPopupInstanceName + '_content') ; if(oEl_content ) oEl_content.style.pointerEvents = 'none'; this.context_lock = true;
 clearTimeout(this.clickLockTimer ); this.clickLockTimer = setTimeout(() => { this.context_lock = false; var oEl_content = this.getEl(this.sPopupInstanceName + '_content') ; if(oEl_content ) oEl_content.style.pointerEvents = 'auto'; }, 500 );};MfcDhtmlPopup.prototype.check_for_context_lock = function(event, el ){ if(this.context_lock ) { event.stopPropagation(); return false; }};MfcDhtmlPopup.prototype.get_highest_zIndex = function(e ){ var contextWindow = ( e && e.view ) || window; if(contextWindow.self !== window.top && ! this.iframe && this.iframe != -1 ) { contextHref = contextWindow.location.href.replace(/#.*/,''); var iframes = contextWindow.parent.document.getElementsByTagName('iframe'); var iframe; for (var i = 0; i < iframes.length; i++) { if(iframes[i].src == contextHref ) { this.iframe = iframes[i]; break; } } if(! this.iframe ) { this.iframe = -1; } } el = ( ( this.iframe != -1 ) && this.iframe ) || ( e && e.target ); if(! el ) { return; }
 var highest_zIndex = -1; while(el.parentNode ) { var zIndex = window.getComputedStyle(el).getPropertyValue('z-index'); if(zIndex != '' && zIndex > -1 && zIndex > highest_zIndex ) { highest_zIndex = zIndex; } el = el.parentNode; } var oDhtmlWindows = document.body.getElementsByClassName('MfcDhtmlWindow_container '); for(var n=0; n < oDhtmlWindows.length; n++ ) { var zIndex = window.getComputedStyle(oDhtmlWindows[n]).getPropertyValue('z-index'); if(zIndex != '' && zIndex > -1 && zIndex > highest_zIndex ) { highest_zIndex = zIndex; } } if(highest_zIndex > -1 ) { return highest_zIndex; }};MfcDhtmlPopup.prototype.bring_to_front = function(){ var win = this.window || window; win.g_nHighest_zIndex = win.g_nHighest_zIndex || 100; if(this.oMasterDiv.style.zIndex >= win.g_nHighest_zIndex ) { return; } win.g_nHighest_zIndex++; this.oMasterDiv.style.zIndex = win.g_nHighest_zIndex;};MfcDhtmlPopup.prototype.get_size_by_offset = function(){ var oEl_content_foot = this.getEl(this.sPopupInstanceName + '_content_foot') ; var oEl_content_foot_right = this.getEl(this.sPopupInstanceName + '_content_foot_right'); if(! oEl_content_foot || ! oEl_content_foot_right ) { return { width: '', height: '' }; }
 var nHeight = ( oEl_content_foot.offsetTop - this.getEl(this.sPopupInstanceName+'_content').offsetTop ); var nWidth = ( oEl_content_foot_right.offsetLeft - oEl_content_foot.offsetLeft ); return { width: nWidth, height: nHeight };};MfcDhtmlPopup.prototype.popup_resize = function(sMode ){ if(this.nPopupResizeCounter > 2 ) { return; } this.nPopupResizeCounter++; if(this.hOpts['width'] ) { this.sPopupWidth = this.hOpts['width']; } else { this.sPopupWidth = this.get_size_by_offset().width || 0; } if(this.hOpts['height'] ) { this.sPopupHeight = this.hOpts['height']; } else { this.sPopupHeight = this.get_size_by_offset().height || 0; } var oEl = this.getEl(this.sPopupInstanceName ); var oMasterEl = this.getEl(this.sPopupInstanceName + '_master' ); if(sMode != 'content_update' ) { this.popup_position(oMasterEl); }};MfcDhtmlPopup.prototype.popup_position = function(oEl ){ var nTopPos = null; if(this.hOpts['center'] ) { var hDimensions = this.UA.GetViewportDimensions(); nTopPos = parseInt(( hDimensions.height / 2 ) - ( this.sPopupHeight / 2 ) ); } else if(typeof(this.hOpts['top'] ) != 'undefined' ) { nTopPos = this.hOpts['top']; } else { var mfcMouse = ( this.hOpts.event && this.hOpts.event.view && this.hOpts.event.view.g_oMouseTracker ) || this.mfcMouseTracker; if(this.hOpts.event ) { mfcMouse.force_track_mouse(this.hOpts.event); } var absY = this.window == window ? mfcMouse.absY_local : mfcMouse.absY; var absX = this.window == window ? mfcMouse.absX_local : mfcMouse.absX; var dQuadY = this.window == window ? mfcMouse.dQuadY_local : mfcMouse.dQuadY; var nTopPos; if(t && t.g_hSelf && t.g_hSelf.single_page_website && absY > this.sPopupHeight ) { nTopPos = ( absY - Math.round(this.sPopupHeight / 2 ) ); } else { nTopPos = ( absY - Math.round(( this.sPopupHeight + 60 ) * ( dQuadY * 1.00 ) ) ); } if(nTopPos < 0 ) { nTopPos = 0; }
 if(( this.UA.tablet || this.UA.mobile ) && nTopPos > 200 && nTopPos < 10000 ) { nTopPos -= 200; } } if(nTopPos != null && ! isNaN(nTopPos) ) { oEl.style.top = nTopPos + 'px'; }};MfcDhtmlPopup.prototype.popup_reposition = function(){ var nLeftPos = null; var nRightPos = null; var mfcMouse = ( this.hOpts.event && this.hOpts.event.view && this.hOpts.event.view.g_oMouseTracker ) || this.mfcMouseTracker; if(this.hOpts.event ) { mfcMouse.force_track_mouse(this.hOpts.event); } dQuadX = ( this.window == window ) ? mfcMouse.dQuadX_local : mfcMouse.dQuadX; absX = ( this.window == window ) ? mfcMouse.absX_local : mfcMouse.absX; if(this.hOpts['center'] ) { var hDimensions = this.UA.GetViewportDimensions(); nLeftPos = parseInt(( hDimensions.width / 2 ) - ( this.sPopupWidth / 2 ) ); } else if(typeof(this.hOpts['right'] ) != 'undefined' ) { nRightPos = parseInt(this.hOpts['right'] ); } else if(typeof(this.hOpts['left'] ) != 'undefined' ) { nLeftPos = parseInt(this.hOpts['left'] ); } else if(this.hOpts['hover_offset'] || this.hOpts['hover_over_text'] || this.hOpts['hover'] ) { var nHoverOffset = this.hOpts['hover_offset'] || 90; if(dQuadX < .5 ) { nLeftPos = absX + nHoverOffset; } else { nLeftPos = ( absX - this.sPopupWidth - nHoverOffset ); } } else { nRight = ( typeof(this.hOpts['right']) != 'undefined' ) ? this.hOpts['right'] : 20; 
 nLeftPos = ( absX - Math.round(( this.sPopupWidth + 20 ) * dQuadX ) - nRight ); } var sMasterDivId = this.sPopupInstanceName + '_master'; if(nRightPos != null && ! isNaN(nRightPos) ) { var oEl = this.getEl(sMasterDivId ); oEl.style.left = ''; oEl.style.right = nRightPos + 'px'; } else if(nLeftPos != null && ! isNaN(nLeftPos) ) { var oEl = this.getEl(sMasterDivId ); oEl.style.right = ''; oEl.style.left = nLeftPos + 'px'; }};MfcDhtmlPopup.prototype.close = function(mixedArgs ){ var hArgs = {}; if(mixedArgs ) { if(typeof(mixedArgs ) == 'string' ) { hArgs = SpecString_To_Object(mixedArgs); } else if(typeof(mixedArgs ) == 'object' ) { hArgs = mixedArgs; } } oEvent = hArgs.event || event; if(( this.popupPinned || this.has_been_converted_to_persistent ) && oEvent && oEvent.type == 'mouseout' ) { return; } if(hArgs.mouse_out && oEvent && oEvent.buttons ) { return; } clearTimeout(this.persist_after_seconds_timeout ); var oPopupDiv = this.getEl(this.sPopupInstanceName); if(! oPopupDiv ) 
 { return; } else if(! oPopupDiv.style ) { return; } else if(oPopupDiv.style.display=='none' ) { return; } var oContent = this.getEl(this.sPopupInstanceName + '_content' ); if(this.hbNoCloseOnMouseout[this.sPopupInstanceName] && oEvent && ( oEvent.type == 'mouseout' || oEvent.type == 'mouseleave' || oEvent.type == 'auxclick' ) ) { return; } this.bIsOpen = 0; this.hbNoCloseOnMouseout[ this.sPopupInstanceName ] = 0; if(this.outside_click_close ) { document.body.removeEventListener('mousedown', this.outside_click_close ); } if(this.UA.tablet || hArgs.no_fade || this.hOpts.no_fade_on_close ) { var popup = this.window.MfcDhtmlPopup.register[ this.sPopupInstanceName ]; if(popup ) { popup.close_delayed(hArgs); } } else { oPopupDiv.style.opacity = 0; clearTimeout(this.nOpacityTimeout ); this.nOpacityTimeout = setTimeout(() => { this.close_delayed(hArgs);},50); } if(! this.persistent ) {
 this.markForCleanup = true; } if(this.fCloseCallback ) { this.fCloseCallback(this.sPopupInstanceName ); }};MfcDhtmlPopup.prototype.close_delayed = function(hOpts ){ this.resetMasterDiv(); var oEl = this.getEl(this.sPopupInstanceName); if(oEl ) { oEl.style.display='none'; oEl.style.height = ''; oEl.style.width = ''; } var oEl_content = this.getEl(this.sPopupInstanceName + "_content" ); if(oEl_content ) { oEl_content.innerHTML = ''; oEl_content.style.width = ''; oEl_content.style.height = ''; }};function AvatarUrl(nUserId, nSize ){ nSize = nSize || 90; var sUrl; var hUser = t && t.g_hUsers && t.g_hUsers[nUserId]; if(typeof(g_hPlatform) == 'object' && hUser ) { if(hUser.access_level == 4 && hUser.platform_id && hUser.platform_id != g_hPlatform.id ) { if(g_hPlatform.code == 'cam' ) sUrl = t.g_hPlatform.image_url + "images/flat/stroke/svg_green/user-1.svg"; else sUrl = t.g_hPlatform.image_url + "images/flat/stroke/svg/user-1.svg"; }
 else if(hUser.access_level == 4 && hUser.platform_id == PLAT_CAM && ! hUser.avatars ) sUrl = t.g_hPlatform.image_url + "images/flat/stroke/svg/user-1.svg"; } if(! sUrl ) { sUrl = MfcImageHost.prototype.avatarUrl(nUserId,nSize); } return sUrl;}function MfcModelListItemHTML(hUser, sTemplate, hLinks ){ var hSwaps = CloneObject(hUser); for(var sK in hLinks ) hSwaps[sK] = a_tag(hLinks[sK]); var aAvatarSizes = new Array(20,30,40,50,55,60,65,70,75,80,85,90,95,100,150,300); for(var nK in aAvatarSizes ) if(sTemplate.indexOf('avatar_' + aAvatarSizes[nK] ) > -1 ) hSwaps['avatar_' + aAvatarSizes[nK] ] = AvatarUrl(hUser['user_id'],aAvatarSizes[nK]); hSwaps['user_font_style'] = MfcCustomFonts.get_style(hUser); sTemplate = MfcStringUtilities.parse_template(sTemplate, hSwaps ); return MfcStringUtilities.parse_template(sTemplate, hSwaps );}function PossessiveApostrophe(sWord ){ if(typeof(sWord ) != 'string' ) { return sWord; } return ( sWord + ( sWord.charAt(sWord.length - 1 ) == "soLowerCase(); });}
function MobileDevice_CloseWindowOption(){ if(navigator.userAgent.indexOf("Android") == -1 && navigator.userAgent.indexOf("(iPad;") == -1 && navigator.userAgent.indexOf("(iPhone;") == -1 && navigator.userAgent.indexOf("(iPod;") == -1 ) { return; } if(location.href.match('/pm\.') ) { return; } var nFontSize = navigator.userAgent.match(/iPhone|iPod/) ? 25 : 15; document.write(" <div style=\"position:absolute;right:17px;top:13px;z-index:100;\" class=\"close_window\"> <input type=button value=\"Close\" style=\"font-size:" + nFontSize + "px;\" onClick=\"window.close();\"> </div> ");}function MfcQuickTip(hOpts ){ if(top && top.MfcQuickTip ) { window.MfcQuickTip = top.MfcQuickTip; } MfcQuickTip.nInstanceCount++; this.nInstanceId = MfcQuickTip.nInstanceCount; MfcQuickTip.register[this.nInstanceId] = this; this.public = 1; this.close_after_tip_timing = hOpts.close_after_tip || hOpts.tip_callback ? 'immediate' : 'delayed'; this.close_after_tip = 1;
 this.default_tip_amounts = '5,10,20,50,100,200'; this.fGetUser = hOpts.get_user || function(){}; var default_fTipCallback = ( hRes, nTipAmount ) => { var hUser = this.fGetUser(); if(hRes.errmsg ) { sMsg = hRes.errmsg; } else if(hRes.err != 0 ) { sMsg = "An error has occurred"; } else { sMsg = "You have tipped <span style=\"" + MfcCustomFonts.prototype.get_style(hUser ) + "\">" + hUser.username + "</span> " + nTipAmount + " tokens."; } var oTokenCx = document.body.getElementsByClassName('quick_tip_tokens')[0]; if(oTokenCx ) oTokenCx.innerHTML = t && t.g_hSelf.tokens; var oMsgDiv = document.body.getElementsByClassName('quick_tip_message')[0]; oMsgDiv.style.opacity = 1; oMsgDiv.style.visibility='visible'; oMsgDiv.innerHTML = sMsg; setTimeout(function(){ oTokenCx && ( oTokenCx.innerHTML = t && t.g_hSelf.tokens ); },1000); setTimeout(function(){ oMsgDiv.style.opacity = 0; oMsgDiv.style.visibility='hidden'; oTokenCx && ( oTokenCx.innerHTML = t && t.g_hSelf.tokens ); .popup.close(); } },3000); }; this.fTipCallback = hOpts.tip_callback || default_fTipCallback; this.fInsufTokensCallback = hOpts.insufpCallback(hRes ); };
 this.no_cleanup = hOpts.no_cleanup; this.cleanup();};MfcQuickTip.nInstanceCount = 0;MfcQuickTip.register = {};MfcQuickTip.prototype.a_tag = function(){ this.aTagCalled = true; return "<a href=# id=MfcQuickTip_a_tag_" + this.nInstanceId + " style=\"text-decoration:none;\" onClick=\"return MfcQuickTip.register['" + this.nInstanceId + "'].open();\" title=\"Quickly tip the performer, or type /tip into the chat input\">";};MfcQuickTip.prototype.cleanup = function(){ for(var n in MfcQuickTip.register ) { if(! MfcQuickTip.register[n].no_cleanup && MfcQuickTip.register[n].aTagCalled && ! document.getElementById('MfcQuickTip_a_tag_' + n ) ) { delete MfcQuickTip.register[ n ]; } }};MfcQuickTip.prototype.open = function(){ this.popup = new MfcDhtmlPopup({ window: ( top && top.window || window ), extra_content_class: 'video_controls' }); this.popup.open(this.getHtml(), { no_close_on_mouseout: true, provide_close_button: true } ); return false;};MfcQuickTip.prototype.getHtml = function(sMsg ){ var hUser = this.fGetUser(); var sQuickTipAmounts = t.g_hSelf.quick_tip_amounts || this.default_tip_amounts; this.aQuickTipAmounts = this.aQuickTipAmounts || sQuickTipAmounts.split(','); var hTokens = ( t && t.g_hSelf.tokens ) ? t.g_hSelf.tokens : 0; var sTipTokenMsg = ( hTokens > 0 ) ? '<div class=\"quick_tip_token_msg\">Send a tip to <span class=\"user_style quick_tip_to\" style="'+MfcCustomFonts.prototype.get_style(hUser )+'">'+hUser.username+'</span></div><div class=\"quick_tip_token_msg\">You have <b>'+hTokens+'</b> tokens</div>' : '<div class=\"quick_tip_token_msg fs12\">'+A("purchase",{class:'fwb'})+'Purchase tokens now</a> to send a tip to <span class=\"user_style quick_tip_to\" style="'+MfcCustomFonts.prototype.get_style(hUser )+'">'+hUser.username+'</span></div>'; if(sMsg ) { sMsg = `<span style='background-color:#FFFF0088;'>${sMsg}</span><br><br>`; } else { sMsg = ''; }
 sH = ` <span class=mini_popup_header>Quick Tip &#9889;</span> <div class=quick_tip> <div class=quick_tip_amounts> ${sMsg} ${sTipTokenMsg} <p class=buttons> `; if(this.previousTipValue ) { var disabled = ( t.g_hSelf.tokens < this.previousTipValue ) ? 'disabled' : ''; sH += `<button class="tip_again ${disabled}" onClick="MfcQuickTip.register[${this.nInstanceId}].sendTip(${this.previousTipValue});">Tip ${this.previousTipValue} again</button>`; } for(var a=0; a<this.aQuickTipAmounts.length; a++ ) { var disabled = ( t.g_hSelf.tokens < this.aQuickTipAmounts[a] ) ? 'disabled' : ''; sH += `<button title="Tip ${this.aQuickTipAmounts[a]} Tokens" class="tip_button ${disabled}" id=customizeAmounts_button${a} onClick="MfcQuickTip.register[${this.nInstanceId}].sendTip(${this.aQuickTipAmounts[a]});">${this.aQuickTipAmounts[a]}</button>`; sH += `<input style='display:none;' type=text class=tip_button id=customizeAmounts_input${a} value="${this.aQuickTipAmounts[a]}">`; } sH += ` <a class=\"quick_tip_custom_amt\" href=# id=customizeAmounts_edit onClick=" MfcQuickTip.register[${this.nInstanceId}].customizeAmounts_edit(); return false;">Customize Amounts</a> <a class=\"quick_tip_custom_amt\" href=# style='display:none;' id=customizeAmounts_save onClick=" MfcQuickTip.register[${this.nInstanceId}].customizeAmounts_save(); return false;">Save Custom Amounts</a> </p> </div> <div class=quick_tip_options> <p> <textarea id=quick_tip_comment placeholder='optional tip message'></textarea> </p> <p> <label for="qt_anon"><input id="qt_anon"type=checkbox ${this.anonymous?'checked':''} onClick="MfcQuickTip.register[${this.nInstanceId}].anonymous=this.checked?1:0;"> Anonymous Tip</label> <label for="qt_visible"><input id="qt_visible" type=checkbox ${this.public?'checked':''} onClick="MfcQuickTip.register[${this.nInstanceId}].public=this.checked?1:0;"> Visible to Chat Room</label> <label for="qt_hide_amt"><input id="qt_hide_amt" type=checkbox ${this.hide_amount?'checked':''} onClick="MfcQuickTip.register[${this.nInstanceId}].hide_amount=this.checked?1:0;"> Hide Amount</label> <label for="qt_close_after"><input id="qt_close_after" type=checkbox ${this.close_after_tip?'checked':''} onClick="MfcQuickTip.register[${this.nInstanceId}].close_after_tip=this.checked?1:0;"> Close after tip</label> </p> </div> </div> <div class=quick_tip_foot> Hint: Type <b>/tip</b> or <b>/t</b> in any chat or PM window to tip - <a href=http://wiki.myfreecams.com/wiki/Chat_Commands#.2Ftip target=_blank>more info</a>. </div> <div class=quick_tip_message style='visibility:hidden;'></div> `; return sH;};MfcQuickTip.prototype.sendTip = function(nTipAmount ){ this.previousTipValue = nTipAmount;
 var hUser = this.fGetUser(); var el; var hTipConfig = { broadcaster_id: hUser.user_id, tip_value: nTipAmount.toString() || '', anonymous: this.anonymous ? 1 : 0, public: this.public ? 1 : 0, public_comment: this.public ? 1 : 0, silent: 0, hide_amount: this.hide_amount ? 1 : 0, comment: ( ( ( el = GetEl('quick_tip_comment') ) && el.value ) || '' ) }; var mfcTip = new MfcTip({ token: t.g_hSelf.token, usersession: t.g_hSelf.sessionid, access_level: t.g_hSelf.access_level, chat_command: 2, callback: ( hRes ) => { if(hRes && hRes.err == 22 ) { this.fInsufTokensCallback(hRes, nTipAmount ); } else if(hRes.errmsg ) { this.popup.update(this.getHtml(hRes.errmsg ) ); } else if(this.close_after_tip && this.close_after_tip_timing == 'immediate' ) { this.popup.close(); } if(hRes ) { this.fTipCallback(hRes, nTipAmount ); } } }); var oResponse = mfcTip.Request(hTipConfig );};MfcQuickTip.prototype.customizeAmounts_edit = function(){ for(var a=0; a<this.aQuickTipAmounts.length; a++ ) { GetEl('customizeAmounts_button' + a ).style.display = 'none'; GetEl('customizeAmounts_input' + a ).style.display = ''; GetEl('customizeAmounts_input' + a ).onkeypress = (event) => { if(event.key == 'Enter' ) { this.customizeAmounts_save(); }
 }; } GetEl('customizeAmounts_edit').style.display='none'; GetEl('customizeAmounts_save').style.display='block';};MfcQuickTip.prototype.customizeAmounts_save = function(){ for(var a=0; a<this.aQuickTipAmounts.length; a++ ) { this.aQuickTipAmounts[a] = parseInt(GetEl('customizeAmounts_input' + a ).value ); } var sValList = this.aQuickTipAmounts.join(','); if(sValList == this.default_tip_amounts ) { sValList = ''; } t.UserExtensions.Write('quick_tip_amounts', sValList ); this.popup.update(this.getHtml() );};function DivSwapEffect(hConf ){ var child = GetEl(hConf.copy_class ); if(! child || ! hConf.container ) { return false; } if(DivSwapEffect.lockout[ hConf.copy_class ] ) { clearTimeout(DivSwapEffect.timers[ hConf.copy_class ] ); delete DivSwapEffect.lockout[ hConf.copy_class ]; return false; } child.style.transition = "opacity " + ( hConf.speed ) + 's ease-out'; var els = hConf.container.getElementsByClassName(hConf.copy_class ); if(! els.length ) { return false; } for(var a=0; a<els.length; a++ ) { els[a].classList.add(hConf.copy_class + '_remove'); } var clone_child = child.cloneNode(); clone_child.innerHTML = hConf.html;
 hConf.container.appendChild(clone_child); clone_child.style.opacity = 1; child.style.opacity = 0; DivSwapEffect.lockout[ hConf.copy_class ] = true; clearTimeout(DivSwapEffect.timers[ hConf.copy_class ] ); DivSwapEffect.timers[ hConf.copy_class ] = setTimeout(function(){ var els = hConf.container.getElementsByClassName(hConf.copy_class + '_remove'); for(var a=0; a<els.length; a++ ) { els[a].parentNode.removeChild(els[a]); delete DivSwapEffect.lockout[ hConf.copy_class ]; } }, ( hConf.speed * 1000 )); return true;}DivSwapEffect.timers = {};DivSwapEffect.lockout = {};PopImageHover = function(oEvent ) { if(oEvent.type == 'mouseleave' && PopImageHover.MfcDhtmlPopup_pop_image_hover ) { PopImageHover.MfcDhtmlPopup_pop_image_hover.close(); } else if(oEvent.type == 'mouseenter' ) { var sUrl = oEvent.target.dataset.src || oEvent.target.src; sH = `<img style="height:${oEvent.target.naturalHeight}px;width:${oEvent.target.naturalWidth}px;" src=${sUrl}>`; PopImageHover.MfcDhtmlPopup_pop_image_hover = new MfcDhtmlPopup({}); PopImageHover.MfcDhtmlPopup_pop_image_hover.open(sH,{ 'hover': true, 'hover_offset': 20 }); } }; 

// js_build_core: js/MfcJSON.js
if(!this.JSON){Jturn n<10?'0'+n:n;}if(typeof Date.prototype.toJSON!=='function'){DaUTCSeconds())+'Z';};String.prototype.toJSON=Number.prototype.toJSON=Boolern this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\p=mind;return v;}}if(typeof JSON.stringify!=='functitr('',{'':value});};}if(typeof JSON.parse!=='furor('JSON.parse');};}}());

// js_build_core: js/MfcLiveFrame.js
var LiveFrame = { nUserId: 0, rxImg: null, nTimerId: 0};LiveFrame.Download = function(nUserId, nErr, hOptions ){ LiveFrame.Download.hOptions = hOptions || {}; LiveFrame.nUserId = nUserId ? nUserId : LiveFrame.nUserId; clearTimeout(LiveFrame.nTimerId); var frameSnap = document.getElementById('liveFrameSnap'); if (!frameSnap) { if (nErr < 50) { clearTimeout(LiveFrame.nTimerId); LiveFrame.nTserId, nErr + 1); }, 1000); } return; } LiveFrame.rxImg = frameSnap.cloneNode(); LiveFrame.rxImg.src = t.LiveSnapUrl(LiveFrame.nUserId, 320); LiveFrame.rxImg.onload = LiveFrame.Render;};LiveFrame.Render = function(){ var frameSnap = document.getElementById('liveFrameSnap'); if (!frameSnap) return; frameSnap = frameSnap.parentNode.replaceChild(LiveFrame.rxImg, frameSnap ); clearTimeout(LiveFrame.nTimerId); LiveFrame.nTwnload.hOptions); }, LiveFrame.Download.hOptions.quick_refresh ? 1000 : 2000 );};

// js_build_core: js/MfcMouse.js
function MfcMouseTracker(){ this.hUA = new MfcUserAgent(); this.xPos; this.yPos; this.dQuadY; this.dQuadX; this.nTrackMouseThrottle = 0; this.test = Math.random(); this.independentCaller = window.isCrossSiteIframe; if(navigator.userAgent.indexOf("Android") > -1 || navigator.userAgent.indexOf("(iPad;") > -1 || navigator.userAgent.indexOf("(iPhone;") > -1 || navigator.userAgent.indexOf("(iPod;") > -1 ) { this.bIsMobileUA = 1; }};MfcMouseTracker.prototype.track_finger = function(e){ e.clientX = e.touches[0].clientX; e.clientY = e.touches[0].clientY; e.pageX = e.touches[0].pageX; e.pageY = e.touches[0].pageY; e.screenX = e.touches[0].screenX; e.screenY = e.touches[0].screenY; if(this.track_mouse ) this.track_mouse(e);};MfcMouseTracker.prototype.get_iframe = function(e){ if(this.independentCaller || e.view === window.top ) { return; } this.iframe = null; this.iframeIndex = null; if(this.iframe == -1 ) { return; }
 else if(this.iframe ) { return this.iframe; } var href = location.href.replace(/#.*/,''); var view = e.view || window; var iframes = view.parent.document.getElementsByTagName('iframe'); for (var i = 0; i < iframes.length; i++) { if(iframes[i].src == href ) { this.iframe = iframes[i]; this.iframeIndex = i; break; } } if(! this.iframe ) { this.iframe = -1; return; } return { el: this.iframe, index: this.iframeIndex };};MfcMouseTracker.prototype.force_track_mouse = function(e){ if(this.nTrackMouseThrottle ) { clearTimeout(this.nTrackMouseThrottle); this.nTrackMouseThrottle = 0; } this.track_mouse(e);};MfcMouseTracker.prototype.track_mouse = function(e){ e.stopPropagation(); if(! e ) { e = event; } var view = e.view || window; if(this.nTrackMouseThrottle ) { return; } else
 { this.nTrackMouseThrottle = setTimeout(() => { this.nTrackMouseThrottle = 0; }, 250 ); } this.clientX = e.clientX; this.clientY = e.clientY; this.pageX = e.pageX; this.pageY = e.pageY; if(e && e.clientX ) { this.screenX = e.screenX; this.screenY = e.screenY; this.xPos = this.pageX; this.yPos = this.pageY; this.absX = this.xPos; this.absY = this.yPos; this.absX_local = this.xPos; this.absY_local = this.yPos; } var iframeXY; var iframe = this.get_iframe(e); if(iframe && iframe.el ) { var iframeIndex = iframe.index; iframeXY = iframe.el.getBoundingClientRect(); this.absX = this.absX + iframeXY.x; this.absY = this.absY + iframeXY.y; var iframeWin; if(( iframeWin = view.top.frames[ iframe.index ] ) && iframeWin.document && iframeWin.document.body ) {
 this.absX -= iframeWin.document.body.scrollLeft || iframeWin.pageXOffset; this.absY -= iframeWin.document.body.scrollTop || iframeWin.pageYOffset; } } if(document && document.body ) { var scrollLeft = document.body.scrollLeft || window.pageXOffset; var scrollTop = document.body.scrollTop || window.pageYOffset; var width = iframe ? document.body.clientWidth : window.innerWidth; var height = iframe ? document.body.clientHeight : window.innerHeight; this.dQuadX_local = ( this.absX_local - scrollLeft ) / width; this.dQuadY_local = ( this.absY_local - scrollTop ) / height; } var topDoc = document; if(! this.independentCaller && view.self !== view.top ) { topDoc = view.top.document; } if(topDoc && topDoc.body ) { var scrollLeft = topDoc.body.scrollLeft;// || window.pageXOffset;
 var scrollTop = topDoc.body.scrollTop;// || window.pageYOffset;
 this.dQuadX = ( this.absX - scrollLeft ) / topDoc.body.clientWidth; this.dQuadY = ( this.absY - scrollTop ) / topDoc.body.clientHeight; } this.dScreenQuadX = this.screenX / screen.width; this.dScreenQuadY = this.screenY / screen.height; return;};function MfcMousePress(hNamedElements ){ this.hUA = new MfcUserAgent(); this.hNamedElements = hNamedElements; this.hPreviousHandlers = {}; this.sActiveElement = '';};MfcMousePress.prototype.AddNamedElement = function(hNamedElement ){ for(var sK in hNamedElement ) { this.hNamedElements[sK] = CloneObject(hNamedElement[sK] ); }};MfcMousePress.prototype.RemoveNamedElement = function(sElementName ){ delete this.hNamedElements[ sElementName ];};MfcMousePress.prototype.AttachEvents = function(){ for(var sElement in this.hNamedElements ) { if(this.hNamedElements[sElement].left_click ) { var oEl; if(oEl = document.getElementById(sElement ) ) { if(this.hNamedElements[sElement].left_click.onmousedown ) oEl.ontouchstart = this.hNamedElements[sElement].left_click.onmousedown; if(this.hNamedElements[sElement].left_click.onmousemove ) oEl.ontouchmove = this.hNamedElements[sElement].left_click.onmousemove; if(this.hNamedElements[sElement].left_click.onmouseup )
 oEl.ontouchend = this.hNamedElements[sElement].left_click.onmouseup; } } }};MfcMousePress.prototype.Down = function(e){ if(! e ) { var e = window.event; } var sButtonClick; if(e.which ) { if ( e.which == 1 ) { sButtonClick = 'left_click'; } else if ( e.which == 3 ) { sButtonClick = 'right_click'; } } else if ( e.button ) { if ( e.button == 1 ) { sButtonClick = 'left_click'; } else if ( e.button == 2 ) { sButtonClick = 'right_click'; } } if(! sButtonClick ) { return; } var oEvent = ( this.hUA.IE && event && event.clientX ) ? event : e; var oEFP; var sFoundName; if(oEFP = document.elementFromPoint(oEvent.clientX, oEvent.clientY ) ) { for(var nCounter=0; nCounter<15; nCounter++ ) { var sName, sId; if(oEFP && oEFP.getAttribute && ( ( sName = oEFP.getAttribute('name') ) || ( sId = oEFP.getAttribute('id') ) ) ) { var sInspectName = sName || sId; for(var sWantedName in this.hNamedElements ) { var oWantedNamePattern = new RegExp(sWantedName, "i" ); if(sInspectName.match(oWantedNamePattern ) ) { sFoundName = sInspectName; break; } } 
 } else if(oEFP.parentNode ) { oEFP = oEFP.parentNode; } else { break; } if ( sFoundName ) { break; } } } if(! sFoundName ) { return; } if(this.sActiveElement ) { this.Up(); } this.sActiveElement = sFoundName; if(this.hNamedElements[ sWantedName ][ sButtonClick ] ) { this.bypass_mouseout_failsafe = this.hNamedElements[ sWantedName ].bypass_mouseout_failsafe ? 1 : 0; if(this.hNamedElements[ sWantedName ][ sButtonClick ].onmousedown ) this.hNamedElements[ sWantedName ][ sButtonClick ].onmousedown(e,this.sActiveElement); var aHandledEvents = [ 'onselectstart', 'onmousemove' ]; for(var nK=0; nK<aHandledEvents.length; nK++ ) { if(this.hNamedElements[ sWantedName ][ sButtonClick ][aHandledEvents[nK]] ) { this.hPreviousHandlers[aHandledEvents[nK]] = document[aHandledEvents[nK]]; document[aHandledEvents[nK]] = this.hNamedElements[ sWantedName ][ sButtonClick ][aHandledEvents[nK]]; } } this.sButtonClick = sButtonClick; this.sEventClient = sWantedName; this.hPreviousHandlers.onmouseout = document.onmouseout; }};MfcMousePress.prototype.Up = function(e){ if(! this.sActiveElement ) { return; }
 this.sActiveElement = ''; if(this.hNamedElements[ this.sEventClient ] && this.hNamedElements[ this.sEventClient ][ this.sButtonClick ] && this.hNamedElements[ this.sEventClient ][ this.sButtonClick ].onmouseup ) { this.hNamedElements[ this.sEventClient ][ this.sButtonClick ].onmouseup(e); var self = this; setTimeout(function() { self.ReleaseSelection(); },500); } for(var sK in this.hPreviousHandlers ) { document[sK] = this.hPreviousHandlers[sK]; } document.onmouseout = this.hPreviousHandlers.onmouseout = document.onmouseout; this.sEventClient = null;};MfcMousePress.prototype.onMouseOut_FailSafe = function(e){ if(this.bypass_mouseout_failsafe ) { return; } e = e ? e : window.event; var from = e.relatedTarget || e.toElement; if ( this.sActiveElement && ( ! from || from.nodeName == "HTML" || from.nodeName == "IFRAME" ) ) { this.Up(); }};MfcMousePress.prototype.ReleaseSelection = function(e){ try { var selectObj = window.getSelection(); if(selectObj.toString().length > 0 ) { selectObj.collapseToStart(); } } catch(e) {};};function MfcClickDrag(hSets ){ this.hSets = hSets; this.hUA = new MfcUserAgent();
 this.hMouseOffset = null; this.hSubjectOffset = null; this.hSpecifiedDimension = {}; this.hAdjustmentResults = {};};MfcClickDrag.prototype.AddSet = function(hSet ){ for(var sK in hSet ) { this.hSets[sK] = CloneObject(hSet[sK] ); }};MfcClickDrag.prhSets[ sSetName ];};MfcClickDrag.prototype.OnMouseDown = function(sSetName ){ Log('MfcClickDrag OnMouseDown LAST ' + this.sActiveSet ); this.sActiveSet = sSetName; if(this.hUA.mobile || this.hUA.tablet ) { docpreventDefault(); }; } Log('MfcClickDrag OnMouseDown ' + this.sActiveSet );};MfcClickDrag.prototype.OnMouseMove = function(oEvent ){ if ( oEvent == null ) { oEvent = window.event; } else if ( oEvent.touches ) { oEvent = oEvent.touches[0]; } var hSet = this.hSets[ this.sActiveSet ]; if(! hSet ) { return; } if(this.bThrottler ) { return; } else if(hSet.throttle ) { this.bThrottler = true; clearTimeout(this.ThrottleTimer); var self = this; this.ThrottleTimer = setTimeout(function() { self.bThrottler = false; },hSet.throttle); }
 var oTarget = oEvent.target != null ? oEvent.target : oEvent.srcElement; if(! this.hMouseOffset ) { this.hMouseOffset = { X: oEvent.clientX, Y: oEvent.clientY }; } if(! this.hAdjustmentResults[ hSet.subject_id ] ) { this.hAdjustmentResults[ hSet.subject_id ] = {}; } for(var sAxis in hSet.hAdjustments ) { if(! this.hAdjustmentResults[hSet.subject_id][sAxis] ) { this.hAdjustmentResults[hSet.subject_id][sAxis] = {}; } for(var sParam in hSet.hAdjustments[sAxis] ) { nShift = oEvent[ 'client' + sAxis ] - this.hMouseOffset[sAxis]; Log('MfcClickDrag OnMouseMove ' + this.sActiveSet + ' ax:' + sAxis + ':' + sParam ); if(sParam == 'height' || sParam == 'width' || sParam == 'top' || sParam == 'left' ) { var oEl = document.getElementById(hSet.subject_id ); if(oEl ) { if(this.hAdjustmentResults[hSet.subject_id][sAxis][sParam] == undefined ) this.hAdjustmentResults[hSet.subject_id][sAxis][sParam] = {}; this.hAdjustmentResults[this.sActiveSet] = this.hAdjustmentResults[hSet.subject_id]; this.hAdjustmentResults[hSet.subject_id][sAxis][sParam].value = this.AdjustPx(sAxis, sParam, oEl, nShift, hSet, oEvent ); } else { console.log("Couldn't access resizable element: " + hSet.subject_id ); } } } }};MfcClickDrag.prototype.AdjustPx = function(sAxis, sParam, oEl, nShift, hSet, oEvent ){ if(! this.sActiveSet ) { return; } var hConditions = this.hSets[ this.sActiveSet ].hAdjustments[sAxis][sParam]; if(! this.hSubjectOffset ) { this.hSubjectOffset = {}; } if(! this.hSubjectOffset[ sParam ] ) {
 if(sParam == 'height' ) this.hSubjectOffset[ sParam ] = oEl.offsetHeight; else if(sParam == 'width' ) this.hSubjectOffset[ sParam ] = oEl.offsetWidth; else if(sParam == 'top' ) this.hSubjectOffset[ sParam ] = oEl.offsetTop; else if(sParam == 'left' ) this.hSubjectOffset[ sParam ] = oEl.offsetLeft; } var nNewSize; if(hSet.hAdjustments[sAxis][sParam].inverse ) { nNewSize = this.hSubjectOffset[ sParam ] - nShift; } else { nNewSize = this.hSubjectOffset[ sParam ] + nShift; } if(( sParam == 'height' || sParam == 'width' ) && ! ( nNewSize > -1 ) ) { return; } if(sParam == 'height' && this.hSets[ this.sActiveSet ].min_height && this.hSets[ this.sActiveSet ].min_height > nNewSize ) { nNewSize = this.hSets[ this.sActiveSet ].min_height; } else if(sParam == 'width' && this.hSets[ this.sActiveSet ].min_width && this.hSets[ this.sActiveSet ].min_width > nNewSize ) { nNewSize = this.hSets[ this.sActiveSet ].min_width; } if(sParam == 'height' && this.hSets[ this.sActiveSet ].max_when_scrollfree && oEl.scrollHeight < ( nNewSize - 10 ) ) { oEl.style[ sParam ] = oEl.scrollHeight + 'px'; } else { oEl.style[ sParam ] = nNewSize + 'px'; } if(! this.hSpecifiedDimension[ this.hSets[ this.sActiveSet ].subject_id ] ) this.hSpecifiedDimension[ this.hSets[ this.sActiveSet ].subject_id ] = {}; if(sParam == 'height' ) { if(( oEl.scrollHeight - oEl.offsetHeight > 10 ) || ! this.hSets[ this.sActiveSet ].max_when_scrollfree ) {
 this.hSpecifiedDimension[ this.hSets[ this.sActiveSet ].subject_id ][ sParam ] = nNewSize; this.hAdjustmentResults[this.sActiveSet][ sAxis ][ sParam ].maximum = false; } else { this.hSpecifiedDimension[ this.hSets[ this.sActiveSet ].subject_id ][ sParam ] = null; this.hAdjustmentResults[this.sActiveSet][ sAxis ][ sParam ].maximum = true; } } return nNewSize;};MfcClickDrag.prototype.OnMouseUp = function(){ Log('MfcClickDrag OnMouseUp ' + this.sActiveSet ); if(this.hSets[ this.sActiveSet ] && this.hSets[ this.sActiveSet ].onmouseup ) { this.hSets[ this.sActiveSet ].onmouseup(this.sActiveSet ); } if(this.hUA.mobile || this.hUA.tablet ) { document.ontouchmove = null; } this.hMouseOffset = null; this.hSubjectOffset = null; this.sActiveSet = '';};

// js_build_core: js/MfcPopUserMenu.js
function PopUserMenu(oTopRef, hConfig ){ if(! hConfig ) { hConfig = {}; } this.image_url = hConfig.image_url || ( t && t.g_hPlatform && t.g_hPlatform.image_url ) || 'https://img.camcdn.com/'; this.image_url_cdn = hConfig.image_url_cdn || ( t && t.g_hPlatform && t.g_hPlatform.image_url_cdn ) || 'https://img.camcdn.com/'; this.independentCaller = window.isCrossSiteIframe; this.g_hUsers = oTopRef.g_hUsers; this.hSelf = oTopRef.hSelf; this.FcTags = oTopRef.FcTags; this.LiveSnapUrl = oTopRef.LiveSnapUrl; this.HideModel = oTopRef.HideModel; this.A = oTopRef.A; this.Admin = oTopRef.Admin; this.openChatRoom = oTopRef.openChatRoom; this.RoomHelper_Top = oTopRef.RoomHelper_Top; ++PopUserMenu.nCounter; this.sInstanceId = window.name + PopUserMenu.nCounter; PopUserMenu.hObjectRef[ this.sInstanceId ] = this; this.window = window; if(! this.independentCaller && window.self !== window.top ) { this.window = window.top; if(this.window.PopUserMenu && this.window.PopUserMenu.hObjectRef ) { this.window.PopUserMenu.hObjectRef[ this.sInstanceId ] = this; } } var updateFunc = ( nUserId ) => { if(nUserId == this.nCurrentUserId ) { this.update(); } }; this.oDhtmlPopup = new MfcDhtmlPopup({ persistent: true, window: this.window, mfcMouseTracker: g_oMouseTracker, mfcGraphics: g, fCloseCallback: () => { if(hConfig.persist ) { return; } PopUserMenu.cleanup(); t.events.off('MfcPopUserMenu.update',updateFunc); } });
 for(var sK in hConfig ) { this[sK] = hConfig[sK]; } this.apiUrl = ( window.MfcClientRes && MfcClientRes.apiUrl ) || '//api.' + ( t && t.g_hPlatform && t.g_hPlatform.domain ); this.nCurrentUserId = 0; this.hUser = {}; this.hSelf = {}; this.hOptions = {}; if(window.t && t.events ) { t.events.on('MfcPopUserMenu.update',updateFunc); }};PopUserMenu.nCounter = 0;PopUserMenu.hObjectRef = {};PopUserMenu.cleanup = function(){ for(var sK in PopUserMenu.hObjectRef ) { if(! document.getElementById('popup' + sK + '_content' ) && ! document.getElementById('popup_LiveSnapImage_' + sK ) && ( PopUserMenu.hObjectRef[ sK ] && ! PopUserMenu.hObjectRef[ sK ].persist ) ) { delete PopUserMenu.hObjectRef[ sK ]; } }};PopUserMenu.prototype.right_click_open = function(){ var bRightClick; e = arguments[0]; if (!e) var e = window.event; if (e.which) bRightClick = (e.which == 3); else if (e.button) bRightClick = (e.button == 2); if(bRightClick )
 { this.open(arguments[1], arguments[2], arguments[3], arguments[4], e ); return true; } return false;};PopUserMenu.prototype.get_profile_friends = function(){ this.get_profile_friends_reqObj = createRequestObject(); this.get_profile_friends_reqObj.open("GET",this.apiUrl + '/lists/homepage_friends?ordered_columns=friend_id&owner_id=' + this.hUser.user_id ); this.get_profile_friends_reqObj.withCredentials = true; this.get_profile_friends_reqObj.onreadystatechange = () => { this.get_profile_friends_callback() }; this.get_profile_friends_reqObj.send();};PopUserMenu.prototype.get_profile_friends_callback = function(response ){ if(this.get_profile_friends_reqObj.readyState != 4 ) { return; } if(this.get_profile_friends_reqObj.responseText.charAt(0) != '{' ) { return; } var hRes = JSON.parse(this.get_profile_friends_reqObj.responseText ); if(! hRes.data || typeof(hRes.data) != 'object' ) { return; } var nFound = 0; var aRecommendationSet=[]; for(var a=0; a < hRes.data.length; a++ ) { var hUser = this.g_hUsers[ hRes.data[a] ]; if(! hUser ) { continue; } if(hUser.access_level != 4 ) { continue; } if(hUser.hidden ) { continue; } if(hUser.state != FCS.FCVIDEO_TX_IDLE ) { continue; } if(nFound++ >= 3 ) { break; } aRecommendationSet.push(hUser.user_id ); } if(aRecommendationSet.length > 0 )
 this.render_recommendations(aRecommendationSet);};PopUserMenu.prototype.get_socialmedia = function(){ var mfcSocialMedia = new MfcSocialMedia({ callback: (response) => { this.get_socialmedia_callback(response); } }); mfcSocialMedia.getSocialMedia({ user_id: this.nCurrentUserId } );};PopUserMenu.prototype.get_recommendations = function(){ if(! t || ! t.g_hUsers ) { return; } if(this.hOptions.short_menu ) { return; } var mfcRecommend = new MfcRecommend({ callback: (response) => { this.get_recommendations_callback(response); } }); mfcRecommend.getRecommendations({ model_id: this.nCurrentUserId } );};PopUserMenu.prototype.get_socialmedia_callback = function(response ){ if(! response ) { return; } this.hSocialMedia = response; this.render_socialmedia();};PopUserMenu.prototype.get_recommendations_callback = function(response ){ if(! response || ! response.result ) { return; } var set = response.result; var nFound=0; var aRecommendationSet=[]; for(var a=0; a < set.order.length; a++ ) { if(! this.g_hUsers[ set.order[a] ] ) { continue; } var hUser = this.g_hUsers[ set.order[a] ]; if(hUser.hidden ) { continue; } if(! IsBroadcastState(hUser.state ) ) { continue; } if(nFound++ >= 3 ) { break; } aRecommendationSet.push(hUser.user_id ); } if(aRecommendationSet.length > 0 )
 this.render_recommendations(aRecommendationSet);};PopUserMenu.prototype.render_socialmedia = function (){ var sHtml=''; if(! this.hSocialMedia ) { return; } if(! this.image_url_cdn ) { this.image_url_cdn = ( t && t.g_hPlatform && t.g_hPlatform.image_url_cdn ) || 'https://img.camcdn.com/'; } var aServices = [ { 'name': 'twitter', 'svg': this.image_url_cdn + 'files/images/svg/twitter.svg' }, { 'name': 'instagram', 'svg': this.image_url_cdn + 'files/images/svg/instagram.svg' } ]; for(var i = 0; i < aServices.length; i++) { var hService = this.hSocialMedia[ aServices[i].name ]; if ( ! hService ) { continue; } sHtml += " <span style='margin-right:6px;'> <a href=\"" + hService.url + "\" rel='noopener noreferrer' target='_blank'> <i"+"mg sr"+"c='" + aServices[i].svg + "' width=15 height=15 style='padding:1px;margin-right:3px;margin-bottom:-5px;background-color:#FFFFFF55;border-radius:5px;'>" + hService.username + "</a> </span> "; } var oEl; if(sHtml && (oEl = GetEl('social_media_' + this.hUser.user_id )) ) { oEl.innerHTML = sHtml; }};PopUserMenu.prototype.render_recommendations = function(aRecommendationSet ){ if(t && t.g_hPlatform && t.g_hPlatform.id != PLAT_MFC ) { return; }
 if(! aRecommendationSet && this.aRecommendationSet ) { aRecommendationSet = this.aRecommendationSet; } this.aRecommendationSet = aRecommendationSet; var sHtml=''; for(var a=0; a < aRecommendationSet.length; a++ ) { var hUser = this.g_hUsers[ aRecommendationSet[a] ]; var sStyle = this.hSelf.chat_text_ignore ? '' : MfcCustomFonts.prototype.get_style(hUser ); sHtml = sHtml + " <div style=\"float:left;padding-left:5px;width:45px;height:80px;overflow:hidden;text-align:left;\" id=recommendations_popup_" + hUser.user_id + "> <i"+"mg class=\"avatar_border user_menu_avatar cpo_listeners\" style=\"border:1px solid #DDD;border-radius:5px;\" height=40 width=40 " +  " data-cpouid='"+hUser.user_id+"' data-cpo_left_click='player' data-cpo_right_click='close' style=\" cursor:pointer; \" sr"+"c=" + AvatarUrl(hUser.user_id,50) + " > <div class='user_style username' style=\" cursor: pointer; font-size:6pt; " + sStyle + "\" id=recommendations_popup_" + hUser.user_id + "> " + A('player',{ broadcaster_id: hUser.user_id, style: "text-decoration:none;" }) + hUser.username + "</a></div> </div> ";
 } sHtml = "<div style=\"padding-bottom:5px;font-size:10px;\">" + ( this.hUser.access_level == 4 ? A('model_recommendations',{ view_single_model_id: this.hUser.user_id }) + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "s You May Like:</a>" : A('bio', { username: this.hUser.username } ) + "Favorite " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "s</a>:" ) + "</div>" + sHtml ; var oEl; if(oEl = GetEl('recommendations_list_' + this.hUser.user_id ) ) { oEl.innerHTML = sHtml; } var oEl; for(var a=0; a < aRecommendationSet.length; a++ ) { var hUser = this.g_hUsers[ aRecommendationSet[a] ]; if(oEl = GetEl('recommendations_popup_' + hUser.user_id ) ) { this.hOptions.replace = true; oEl.oncontextmenu = function() { return false }; ((hUser) => { oEl.onmousedown = () => { if(event.button == 2 ) this.open(hUser, this.hSelf, this.oDhtmlPopup, this.hOptions ); }; })(hUser); } }};PopUserMenu.prototype.open = function(){ this.UA = new MfcUserAgent(); var hUser; var hSelf; var oDhtmlPopup; var hOptions={}; var nUserId; if(! arguments[0] && this.hUser ) { nUserId = this.hUser.user_id;
 hSelf = t.g_hSelf; } else if(typeof(arguments[0] ) != 'object' ) { var nUserId = arguments[0]; hUser = t.g_hUsers[ nUserId ]; oDhtmlPopup = arguments[1]; hOptions = arguments[2]; } else { hUser = arguments[0]; hSelf = arguments[1]; oDhtmlPopup = arguments[2]; hOptions = arguments[3]; } hUser = this.hUser = hUser || this.hUser || t.g_hUsers[ nUserId ]; hSelf = t.g_hSelf; nUserId = this.hUser.user_id; if(hOptions ) { for(var k in hOptions ) { this.hOptions[k]=hOptions[k]; } } if(window.location.href.indexOf('pm.html') > -1 ) { this.hOptions.pm_window = 1; } if(window.innerHeight < 600 ) { this.hOptions.short_menu = 1; } this.nCurrentUserId = hUser && hUser.user_id; this.bWidescreen = ( this.hUser && this.hUser.access_level == 4 && this.hUser.video_aspect_ratio >= 1.5 ); this.nWidthModifier = ( this.bWidescreen ? 24 : 0 ); if(hOptions && hOptions.replace ) { this.oDhtmlPopup.update(this.draw_user_details(hUser, hSelf, this.hOptions ) , 'popup' ); } else { this.oDhtmlPopup.open(this.draw_user_details(hUser, hSelf, this.hOptions ), ( 'width:' + ( ( g_UA.tablet || g_UA.mobile ? 504 : 444 ) + this.nWidthModifier ) ) + ','
 + ( hOptions && hOptions.dhtmlPopup_options ? hOptions.dhtmlPopup_options : '' ) + ',delay_sizing' ); } if(this.hUser && this.hUser.access_level == 4 ) { if(t && t.g_hPlatform && t.g_hPlatform.id == PLAT_MFC ) { this.get_recommendations(); } this.get_socialmedia(); } else if(this.hUser && this.hUser.active && ( t && t.g_hPlatform && t.g_hPlatform.id == PLAT_MFC ) ) { this.get_profile_friends(); }};PopUserMenu.prototype.open_tags_in_popup = function(hUser, oDhtmlPopup ){ this.hUser = hUser; if(! this || ! this.hUser || ! this.hUser.aTags || ! this.hUser.aTags.length ) { return; } this.MfcDhtmlPopup_open_tags_in_popup = new MfcDhtmlPopup({ window: this.window, mfcMouseTracker: g_oMouseTracker, mfcGraphics: g }); this.MfcDhtmlPopup_open_tags_in_popup.open(this.get_all_tags() );};PopUserMenu.prototype.update = function(hUser ){ if(hUser ) { this.hUser = hUser; } if(this.oDhtmlPopup.bIsOpen ) { this.oDhtmlPopup.update(this.draw_user_details(this.hUser, this.hSelf, this.hOptions ) , 'popup' ); this.get_recommendations(); this.render_socialmedia();
 }};PopUserMenu.prototype.p? 'woman' : 'man';};PopUserMenu.prototype.people_icon_number = function(hUser ){ if ( hUser.username.match(/^..[abc1]/i) ) return 1; else if ( hUser.username.match(/^..[def2]/i) ) return 2; else if ( hUser.username.match(/^..[ghi3]/i) ) return 3; else if ( hUser.username.match(/^..[jkl4]/i) ) return 4; else if ( hUser.username.match(/^..[mno5]/i) ) return 5; else if ( hUser.username.match(/^..[pqr6]/i) ) return 6; else if ( hUser.username.match(/^..[stu7]/i) ) return 7; else if ( hUser.username.match(/^..[vwxy]/i) ) return 8; else if ( hUser.username.match(/^..[z890_]/i) ) return 9;};PopUserMenu.prototype.userid_to_user = function(nUserId ){ if(! t ) return 1; if(t && ! t.g_hUsers ) return 2; if(t && t.g_hUsers && ! t.g_hUsers[ nUserId ] ) return 3; if(t && t.g_hUsers && t.g_hUsers[ nUserId ] && ! t.g_hUsers[ nUserId ].username ) return 4; return t.g_hUsers[ nUserId ];};PopUserMenu.prototype.people_icon = function(hUser, hOptions ){ var hOptions = hOptions || {}; if(! this.image_url_cdn ) { this.image_url_cdn = hOptions.image_url_cdn || ( t && t.g_hPlatform && t.g_hPlatform.image_url_cdn ) || 'https://img.camcdn.com/'; } if ( typeof(hUser) !== "object" && typeof(hUser = this.userid_to_user(hUser)) !== "object" ) return this.image_url_cdn + 'files/images/misc/clear.gif?error=' + hUser; var nIcon = this.people_icon_number(hUser ); var sGender = this.people_icon_gender(hUser ); return this.image_url_cdn + 'files/images/icons/people/' + ( hOptions.small ? 'small_' : '' ) + sGender + '_' + nIcon + '.png';};PopUserMenu.prototype.people_icon_sprite_css = function(hUser ){
 if ( typeof(hUser) !== "object" && typeof(hUser = this.userid_to_user(hUser)) !== "object" ) return 'sprite-people-icon-error' + hUser; var nIcon = this.people_icon_number(hUser ); var sGender = this.people_icon_gender(hUser ); return 'sprite-icons sprite-small_' + sGender + '_' + nIcon;};PopUserMenu.prototype.draw_user_details = function(hUser, hSelf, hOptions ){ hOptions = hOptions || {}; if(! hUser ) return; if(! this.image_url ) { this.image_url = hOptions.image_url || ( t && t.g_hPlatform && t.g_hPlatform.image_url ) || 'https://img.camcdn.com/'; } if(! this.image_url_cdn ) { this.image_url_cdn = hOptions.image_url_cdn || ( t && t.g_hPlatform && t.g_hPlatform.image_url_cdn ) || 'https://img.camcdn.com/'; } this.hUser = hUser || this.hUser; this.hSelf = t.g_hSelf; var nPlatformId = ( t && t.g_hPlatform.id ) || 0; var nUserId = this.hUser.user_id; var hUserDetailKey={}; if(hOptions.short_menu ) { hUserDetailKey[PLAT_CAM] = {}; hUserDetailKey[PLAT_MFC] = {}; } else if(g_UA.tablet ) { hUserDetailKey[PLAT_CAM] = { 'region': 'images/flat/stroke/svg/home-3.svg', 'age': 'images/flat/stroke/svg/contacts-1.svg' }; hUserDetailKey[PLAT_MFC] = { 'region': 'Location', 'age': 'Age/Ethnicity' }; } else if(hUser.access_level < 4 ) { hUserDetailKey[PLAT_CAM] = { 'region': 'images/flat/stroke/svg/home-3.svg', 'occupation': 'images/flat/stroke/svg/building-1.svg', 'age': 'images/flat/stroke/svg/contacts-1.svg' };
 hUserDetailKey[PLAT_MFC] = { 'region': 'Location', 'occupation': 'Occupation', 'age': 'Age/Ethnicity', 'creation_date': 'Signed Up' }; } else { hUserDetailKey[PLAT_CAM] = { 'region': 'images/flat/stroke/svg/home-3.svg', 'occupation': 'images/flat/stroke/svg/building-1.svg', 'age': 'images/flat/stroke/svg/contacts-1.svg' }; hUserDetailKey[PLAT_MFC] = { 'region': 'Location', 'occupation': 'Occupation', 'age': 'Age/Ethnicity' }; } if(hOptions.menu == undefined ) { hOptions.menu = ( g_hLoungeIds[ this.hUser.user_id ] || hOptions.hover_bio ) ? 0 : 1; } var aShortMonths = new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"); var aDetails = new Array(); var nKeyColumnWidth = 90; sUsernameStyle = MfcCustomFonts.prototype.get_style(this.hUser ); if(hUser.access_level == 4 ) { } for(var sK in hUserDetailKey[nPlatformId] ) { if(sK != 'region' && ( ! hUser || ! this.hUser[sK] || this.hUser[sK] == -1 || this.hUser[sK] == 0 || this.hUser[sK] == 'No Answer' )
 || hOptions.short_menu ) { continue; } var sValue; if(sK == 'creation_date' ) { if (this.hUser[sK] == 0) { continue; } var oDate = new Date(); oDate.setTime(parseInt(this.hUser[sK]) * 1000 ); sValue = aShortMonths[oDate.getMonth()] + " '" + MfcStringUtilities.char_padding(oDate.getFullYear() - 2000,2,0); } else if(sK == 'lastlogin' ) { if (this.hUser[sK] == 0) { continue; } var oDate = new Date(); oDate.setTime(parseInt(this.hUser[sK]) * 1000 ); var sDate = oDate.getDate().toString(); if (sDate.match(/(11|12|13|4|5|6|7|8|9|0)$/) ) sDate += 'th'; else if (sDate.match(/3|23/) ) sDate += 'rd'; else if (sDate.match(/2$/) ) sDate += 'nd'; else if (sDate.match(/1$/) ) sDate += 'st'; sValue = "" + aShortMonths[oDate.getMonth()] + " " + sDate + " '" + MfcStringUtilities.char_padding(oDate.getFullYear() - 2000,2,0) ; } else if(sK == 'age' ) { sValue = ''; if(this.hUser['age'] ) { sValue += this.hUser['age']; if(this.hUser['ethnic'] ) { sValue += ', '; } } if(this.hUser['ethnic'] ) { sValue += this.hUser['ethnic']; } } else if(sK == 'region' ) {
 if(! this.hUser['country'] && ! this.hUser['city'] ) continue; sValue = ''; if(this.hUser['city'] ) { sValue += this.hUser['city']; if(this.hUser['country'] ) { sValue += ', '; } } if(this.hUser['country'] ) { sValue += this.hUser['country']; } } else { sValue = this.hUser[sK]; } if(sValue.length > 70 ) { if(hOptions.menu ) { sValue = sValue.substr(0,70) + "..." + A('bio',{ username: this.hUser.username }) + "More</a>"; } else { sValue = sValue.substr(0,70) + "..."; } } sValue = sValue.replace(/<[^>]*/g,''); if(nPlatformId == PLAT_CAM ) { aDetails.push(" <div style='font-size:10px;position:relative;padding-bottom:2px;height:18px;'> <div style='position:absolute;top:0px;left:0px;font-weight:bold;'><img src='" + this.image_url_cdn + hUserDetailKey[nPlatformId][sK] + "'></div> <div style='padding-left:25px;font-size:10px;indent:25px;'>" + sValue + "&nbsp;</div> </div> "); } else { aDetails.push(" <div style='font-size:10px;position:relative;padding-bottom:2px;'> <div style='position:absolute;top:0px;left:0px;width:" + nKeyColumnWidth + "px;font-weight:bold;'>" + hUserDetailKey[nPlatformId][sK] + ":</div> <div style='padding-left:" + nKeyColumnWidth + "px;font-size:10px;indent:" + nKeyColumnWidth + "px;'>" + sValue + "&nbsp;</div> </div> "); } } if ( ! this.hUser.active && nPlatformId == PLAT_MFC ) { aDetails.push(" <div style='font-size:10px;position:relative;padding-bottom:2px;padding-top:7px;color:#888;'> No Profile Data\
 </div> "); } if(this.hUser.aTags && t && nPlatformId == PLAT_MFC && ! hOptions.short_menu ) { var sTags=''; nCount = 0; for(var n=0; n<this.hUser.aTags.length; n++ ) { if(this.hUser.aTags[n].length > 18 ) { continue; } if(n > 8 ) { sTags += "[<a href=\"javascript:PopUserMenu.hObjectRef['" + this.sInstanceId + "'].all_tags_in_child();\"><b>view&nbsp;all</b></a>] ."; break; } if(t && t.FcTags && t.FcTags.hTagCounts && t.FcTags.hTagCounts[ this.hUser.aTags[n] ] > 1 ) { sTags += A('model_tags',{ selected_field: encodeURIComponent(this.hUser.aTags[n]) }) + this.hUser.aTags[n] + "</a>, "; } else { sTags += "<span style='text-decoration:underline;'>" + this.hUser.aTags[n] + "</span>, "; } } if(sTags ) { aDetails.push(" <div style='position:relative;font-size:10px;padding-top:0px;padding-bottom:10px;height:40px;'> <div style='position:absolute;top:0px;left:0px;width:" + nKeyColumnWidth + "px;font-weight:bold;'>Tags:</div> <div style='padding-left:" + nKeyColumnWidth + "px;font-size:10px;indent:" + nKeyColumnWidth + "px;'>" + sTags.substr(0,sTags.length - 2) + "&nbsp;</div> </div> "); } } var aHtml = new Array(); aHtml.push(" <table border=0 cellpadding=0 cellspacing=0> <tr> <td valign=top style=\"padding-right:8px;max-width:"+(240+this.nWidthModifier)+"px;\">\
 "); aHtml.push(" <div style=\"text-align:left;font-size:10px;padding-bottom:15px;white-space:nowrap;\"> <table width="+(235+this.nWidthModifier)+" cellpadding=0 cellspacing=3> <tr> <td style=\"font-size:10px;position:relative;\"> "); aHtml.push(" <div style=\"line-height:15px;\" >"); if ( ( this.hUser.active || this.hUser.state == FCS.FCVIDEO_OFFLINE ) && ! g_hLoungeIds[ this.hUser.user_id ] ) aHtml.push(A('bio',{ username: this.hUser.username }) + "Profile</a> Avatar<br>"); if(this.hUser && ( this.hUser.avatars > 0 || this.hUser.state == FCS.FCVIDEO_OFFLINE || this.hUser.access_level == 4 ) ) { aHtml.push(" <i"+"mg class=\"avatar_border user_menu_avatar cpo_listeners\" data-cpouid='"+nUserId+"' data-cpo_load_overlay=1 data-cpo_overlay_style=\"top:'19px', right:'68px'\" data-cpo_right_click=nothing data-cpo_left_click=nothing style='cursor:pointer;' height=90 width=90 onMouseUp=\"  PopUserMenu.hObjectRef['" + this.sInstanceId + "'].pop_image(event,{ src:AvatarUrl("+nUserId+",300), height:300, width:300,style_class:'avatar_border' });\" sr"+"c=" + AvatarUrl(nUserId,90) + " draggable=\"true\" ondragstart=\" t.nDragUserId=" + this.hUser.user_id + "; \"></td><td style=\"width:100%;font-size:10px;\">"); } else { aHtml.push("<div style='color:#999;text-align:center;padding-top:20px;height:90px;width:90px;font-size:15px;'>No<br>Avatar<br>Photo</div>"); } if(this.hUser.access_level == 4 && this.LiveSnapUrl ) { var oAnimatedLiveSnaps = new AnimatedLiveSnaps({ getSnapUrl: this.LiveSnapUrl }); var sLink=''; if(this.hUser.platform_id != nPlatformId && this.hUser.state == FCS.FCVIDEO_TX_IDLE ) { var sPrefix = this.hUser.platform_id == 1 ? "\u006d\u0066\u0063\u002e\u0069\u006d\u002f" : "\u0077\u0077\u0077\u002e\u0063\u0061\u006d\u006d\u0075\u006e\u0069\u0074\u0079\u002e\u0063\u006f\u006d\u002f\u0023"; sLink = "<a href=\"//" + sPrefix + this.hUser.username + "\" target=_blank>"; } var sAspectRatioClass = 'ar_4_3'; var nPopWidth = 320; if(this.bWidescreen ) { sAspectRatioClass = 'ar_16_9'; nPopWidth = 426; }
 aHtml.push(" <div style=\"cursor:pointer;line-height:15px;\"> " + A('player',{ broadcaster_id: nUserId }) + "Chat Room</a> Preview<br> <div style=\""+(this.bWidescreen ? "height:90px" : "width:120px;")+"\" class=\"" + sAspectRatioClass + "\"> " + sLink + "<i" + "mg class=\"livesnap_border ar_fixed_image livesnap\" " + oAnimatedLiveSnaps.mouseEventCode(nUserId,{ no_click: true, auto_update_livesnaps: true, timer: 100 }) + " onMouseDown=\"PopUserMenu.hObjectRef['" + this.sInstanceId + "'].popup_LiveSnapImage("+nUserId+",event);\" sr"+"c=" + this.LiveSnapUrl(nUserId,100) + "></a> </div> </div> "); } aHtml.push(" </td> </tr> </table> </div> "); var aLinks = new Array(); if ( hOptions.menu ) { if ( this.hUser.active && this.hUser.access_level >= 2 && ! hOptions.short_menu ) { aDetails.push(" <div style='font-size:10px;position:relative;margin-top:0px;height:40px; padding-bottom: 20px;'>\
 <div style='display:none;position:absolute;top:0px;left:0px;width:" + nKeyColumnWidth + "px;font-weight:bold;display:none;' id=MfcPopUserMenu_has_images_" + this.sInstanceId + ">New Images:</div> <div style='padding-left:" + nKeyColumnWidth + "px;indent:" + nKeyColumnWidth + "px;white-space:nowrap;height:35px;width:130px;overflow:hidden;''> "); for(var n=1; n<5; n++) { sSrc = this.image_url + "photos2/" + nUserId.toString().substr(0,3) + "/" + nUserId + "/" + ( nPlatformId == PLAT_CAM ? 'cam_' : '' ) + "pic" + n + ".300x.jpg"; aDetails.push(" <i"+"mg data-imgsrc=\"" + sSrc + "\" src=\"" + sSrc + "\" style=\"cursor:pointer;display:none;border-radius:3px;height:35px;\" onLoad=\"PopUserMenu.hObjectRef['" + this.sInstanceId + "'].has_images(event);\" onClick=\"PopUserMenu.hObjectRef['" + this.sInstanceId + "'].pop_image(event,{ no_close_on_mouseout: 1 });\" onmouseenter=\" PopUserMenu.hObjectRef['" + this.sInstanceId + "'].pop_image_hover(event);\" onmouseleave=\" PopUserMenu.hObjectRef['" + this.sInstanceId + "'].pop_image_hover(event);\" > "); } aDetails.push(" </div> </div> </div> "); } var aMfcLinks = new Array(); var aCamLinks = new Array(); var hLinks = {}; hLinks[ PLAT_MFC ] = {}; hLinks[ PLAT_CAM ] = {}; aLinks.push(" <div class=pop_user_menu_right style='font-size:" + ( g_UA.tablet || g_UA.mobile ? 13 : 11 ) + "px;position:relative;padding:14px 5px 0px 10px;white-space:nowrap;line-height:" + ( g_UA.tablet || g_UA.mobile ? 23 : 18 ) + "px;' > "); if(this.custom_menu ) { for(var sK in this.custom_menu ) { hLinks[ PLAT_MFC ]['custom_menu'] = "<a href=# onClick=\" PopUserMenu.hObjectRef['" + this.sInstanceId + "'].CustomFunction('" + sK + "'); return false;\">" + this.custom_menu[ sK ].title + "</a>"; hLinks[ PLAT_CAM ]['custom_menu'] = hLinks[ PLAT_MFC ]['custom_menu'];
 } hLinks[ PLAT_MFC ]['custom_menu'] += "<br><br>"; hLinks[ PLAT_CAM ]['custom_menu'] += "<br><br>"; } if ( this.hUser.access_level != 4 && hOptions.room_helper && nUserId != this.hSelf.user_id ) { aLinks.push("<div style='padding:3px;margin-bottom:10px;background-color:#FFB;'>Room Helper<br>"); var hArgs = { broadcaster_id: hOptions.broadcaster_id, user_id: this.hUser.user_id }; if(this.hUser.sessionid > 0 ) hArgs.sessionid = this.hUser.sessionid; else if(this.hUser.user_id ) hArgs.user_id = this.hUser.user_id; hArgs.script = " PopUserMenu.hObjectRef['" + this.sInstanceId + "'].close(); "; hArgs.ban = 1; aLinks.push(A('room_helper', hArgs ) + "Ban from Chat Room</a> <br>"); delete hArgs.ban; hArgs.ban = 1; hArgs.c = 1; aLinks.push(A('room_helper', hArgs ) + "Ban & Remove Chat</a> <br>"); delete hArgs.ban; hArgs.kick = 1; aLinks.push(A('room_helper', hArgs ) + "Kick from Chat Room</a> <br>"); delete hArgs.kick; if(this.hUser.muted ) { hArgs.unmute = 1; aLinks.push(A('room_helper', hArgs ) + "Unmute this user</a> <br>"); } else { hArgs.mute = 1; aLinks.push(A('room_helper', hArgs ) + "Mute this user</a> <br>"); } aLinks.push("</div>"); }
 if(IsBroadcastState(this.hUser.state ) ) { hLinks[ PLAT_CAM ]['player'] = ( A('player',{ broadcaster_id: nUserId }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/chat-3.svg'></a> " + A('player',{ broadcaster_id: nUserId }) + "Chat Room</a> " + A('player',{ broadcaster_id: nUserId, target: 'new_window' }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/switch-window-1.svg'></a>" ); hLinks[ PLAT_MFC ]['player'] = ( A('player',{ broadcaster_id: nUserId }) + "Chat Room</a> [" + A('player',{ broadcaster_id: nUserId, target: 'new_window' }) + "Popup</a>] " ); } if(t && t.name == 'top_level' && window.location.href.indexOf('pm.html') == -1 ) { if(IsBroadcastState(this.hUser.state ) ) { hLinks[ PLAT_MFC ]['pm_friend'] = (( this.hSelf.access_level >= -1 ? A('pm_friend',{ user_id: nUserId, load_video:1 }) : A('register',{ message: 'premium_feature' }) )+ "Private Message</a>" ) + ( " [" + ( this.hSelf.access_level >= -1 ? A('pm_friend',{ user_id: nUserId, load_video:0 }) : A('register',{ message: 'premium_feature' }) )+ "no cam</a>]<br> " ) + (' - ' + ( this.hSelf.access_level >= -1 ? A('pm_friend',{ user_id: nUserId, load_video:1, full_video:1 }) : A('register',{ message: 'premium_feature' }) )+ "Webcam Only</a> " ); } else { hLinks[ PLAT_MFC ]['pm_friend'] = (( this.hSelf.access_level >= -1 ? A('pm_friend',{ user_id: nUserId }) : A('register',{ message: 'premium_feature' }) )+ "Private Message</a> " ); } } if(IsBroadcastState(this.hUser.state ) && t && t.name == 'top_level' ) { if(( this.hSelf.access_level == 2 || this.hSelf.access_level == 5)
 && this.hUser.access_level == 4 ) { hLinks[ PLAT_MFC ]['lounge'] = ( A('player',{ broadcaster_id: g_hLoungeIds.Lounge, target: 'main', title: 'Go to the Lounge', lounge_model_id: nUserId }) + "View In Lounge</a>&nbsp;"); hLinks[ PLAT_MFC ]['lounge'] += ( A('player',{ broadcaster_id: g_hLoungeIds.Lounge, target: 'main', title: 'Go to the Lounge', lounge_model_id: nUserId, target: 'new_window' }) + "<img src=\"" + this.image_url_cdn + "files/images/icons/png/popup.12x12.png\" style=\"height:12px;width:12px;\"></a>"); hLinks[ PLAT_MFC ]['lounge'] += "&nbsp;"; if(t && this.g_hUsers ) { if(this.g_hUsers[ g_hLoungeIds.Lounge1000 ] ) { hLinks[ PLAT_MFC ]['lounge'] += ( A('player',{ broadcaster_id: g_hLoungeIds.Lounge1000, target: 'main', title: 'Go to the Lounge 1000', lounge_model_id: nUserId }) + "1K</a>&nbsp;"); hLinks[ PLAT_MFC ]['lounge'] += ( A('player',{ broadcaster_id: g_hLoungeIds.Lounge1000, target: 'main', title: 'Go to the Lounge', lounge_model_id: nUserId, target: 'new_window' }) + "<img src=\"" + this.image_url_cdn + "files/images/icons/png/popup.12x12.png\" style=\"height:12px;width:12px;\"></a>"); hLinks[ PLAT_MFC ]['lounge'] += "&nbsp;"; } if(this.g_hUsers[ g_hLoungeIds.Lounge10000 ] ) { hLinks[ PLAT_MFC ]['lounge'] += ( A('player',{ broadcaster_id: g_hLoungeIds.Lounge10000, target: 'main', title: 'Go to the Lounge 10000', lounge_model_id: nUserId }) + "10K</a>&nbsp;"); hLinks[ PLAT_MFC ]['lounge'] += ( A('player',{ broadcaster_id: g_hLoungeIds.Lounge10000, target: 'main', title: 'Go to the Lounge', lounge_model_id: nUserId, target: 'new_window' }) + "<img src=\"" + this.image_url_cdn + "files/images/icons/png/popup.12x12.png\" style=\"height:12px;width:12px;\"></a>"); } } } } if(! IsBroadcastState(this.hUser.state ) && t && t.name == 'top_level' ) { hLinks[ PLAT_CAM ]['player'] = ( A('player',{ broadcaster_id: nUserId }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/computer-1.svg'></a>" + A('player',{ broadcaster_id: nUserId }) + "Chat Room</a> " + A('player',{ broadcaster_id: nUserId, target: 'new_window' }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/switch-window-1.svg'></a>" ); hLinks[ PLAT_MFC ]['player'] = ( A('player',{ broadcaster_id: nUserId }) + "Chat Room</a>" ) + (' - ' + A('player',{ broadcaster_id: nUserId, target: 'new_window' }) + "Popup Chat Room</a> " ); } if(this.hSelf.access_level >= FCS.FCLEVEL_PREMIUM ) { hLinks[ PLAT_CAM ]['tip'] = ( A('tip',{ broadcaster_id: nUserId }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/gift-2.svg'> Tip</a> " ); menuQuickTip = new MfcQuickTip({ get_user: function() { return t.g_hUsers[ nUserId ]; } }); hLinks[ PLAT_MFC ]['tip'] = ( A('tip',{ broadcaster_id: nUserId }) + "Send A Tip</a> " + menuQuickTip.a_tag() + "<span class=\"pum_quicktip\">&#9889;</</a>"); } if(this.hSelf.access_level >= 2 ) { hLinks[ PLAT_CAM ]['message'] = ( A('message',{ user_id: nUserId }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/mail-2.svg'> Mail</a> " ); hLinks[ PLAT_MFC ]['message'] = ( A('message',{ user_id: nUserId, username: this.hUser.username }) + "Send MFC Mail</a> " );
 } else { hLinks[ PLAT_CAM ]['message'] = ( A('premium_feature',{style:'color:gray;'}) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/mail-2.svg'> Mail</a> " ); hLinks[ PLAT_MFC ]['message'] = ( A('premium_feature',{style:'color:gray;'}) + "Send MFC Mail</a>"); } if ( this.hUser.active ) { hLinks[ PLAT_CAM ]['bio'] = ( A('bio',{ username: this.hUser.username }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/user-1.svg'> Profile</a> "); hLinks[ PLAT_MFC ]['bio'] = ( A('bio',{ username: this.hUser.username }) + "View Full Profile</a> "); if(t && t.frames && t.frames['main'] && t.frames['main'].g_sPlayerMode && t.frames['main'].g_sPlayerMode == 'player' ) { hLinks[ PLAT_CAM ]['bio'] += ( "[<a href=\"javascript: t.frames['main'].ProfilePreview(" + nUserId + ");\">Preview</a>]"); hLinks[ PLAT_MFC ]['bio'] += ( "[<a href=\"javascript: t.frames['main'].ProfilePreview(" + nUserId + ");\">Preview</a>]"); } } if ( this.hSelf.access_level >= 2 ) { hLinks[ PLAT_CAM ]['chat_logs'] = ( A('chat_logs',{ lookup_id: nUserId, lookup_username: this.hUser.username }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/open-book-3.svg'> Chat Log</a>"); hLinks[ PLAT_MFC ]['chat_logs'] = ( A('chat_logs',{ lookup_id: nUserId, lookup_username: this.hUser.username }) + "Chat Log / Archives</a>"); } else { hLinks[ PLAT_CAM ]['chat_logs'] = ( A('members_feature',{style:'color:gray;'}) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/open-book-3.svg'> Chat Log</a>"); hLinks[ PLAT_MFC ]['chat_logs'] = ( A('members_feature',{style:'color:gray;'}) + "Chat Log / Archives</a>"); }if(t.g_hPlatform.id == PLAT_MFC ){ if(this.hUser.lastnews ) { var nNewsAge = Math.round((new Date()).getTime() / 1000) - this.hUser.lastnews; hLinks[ PLAT_CAM ]['news_feed'] = ( A('news_feed',{ user_id: nUserId }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/megaphone-1.svg'> News Feed</a>"); hLinks[ PLAT_MFC ]['news_feed'] = ( A('news_feed',{ user_id: nUserId }) + "View News Feed</a>"); if(nNewsAge < 129600 ) { hLinks[ PLAT_CAM ]['news_feed'] += ( " " + A('news_feed',{ user_id: nUserId }) + "<span style='background-color:#FFFF0044;'><b>New</b></span></a>"); hLinks[ PLAT_MFC ]['news_feed'] += ( " " + A('news_feed',{ user_id: nUserId }) + "<span style='background-color:#FFFF0044;'><b>New</b></span></a>"); } }} if ( this.hSelf.access_level == 0 ) {
 hLinks[ PLAT_CAM ]['user_notepad'] = ( A('members_feature',{style:'color:gray;'}) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/clipboard-2a.svg'> Notes</a> "); hLinks[ PLAT_MFC ]['user_notepad'] = ( A('members_feature',{style:'color:gray;'}) + "Add Notes</a> "); } else if ( this.hUser.notes ) { hLinks[ PLAT_CAM ]['user_notepad'] = ( A('user_notepad',{ load_user_id: nUserId, target:'new_window' }) + "<img src='" + this.image_url_cdn + "images/cam/png/note-2-xxl-orange.png' height=16> Notes"); hLinks[ PLAT_MFC ]['user_notepad'] = ( A('user_notepad',{ load_user_id: nUserId, target:'new_window' }) + "<span style=\"background-color:#FFFF0044;\">View Notes</span></a> "); } else { hLinks[ PLAT_CAM ]['user_notepad'] = ( A('user_notepad',{ load_user_id: nUserId, target:'new_window' }) + "<img src='" + this.image_url_cdn + "images/cam/png/note-2-xxl.png' height=16> Notes"); hLinks[ PLAT_MFC ]['user_notepad'] = ( A('user_notepad',{ load_user_id: nUserId, username: this.hUser.username, target:'new_window' }) + "Add Notes</a> "); } if(this.hUser.access_level == 4 ) { if ( this.hSelf.access_level >= 2 ) hLinks[ PLAT_MFC ]['messenger'] = ( A('messenger',{ username: this.hUser.username, target:'new_window' }) + "Add Online Notifications</a> "); else hLinks[ PLAT_MFC ]['messenger'] = ( A('members_feature',{style:'color:gray;'}) + "Add Online Notifications</a> "); } if ( this.hUser.friend ) { hLinks[ PLAT_CAM ]['friend'] = ( A('tx_remove_friend',{ remote_user_code: nUserId }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/user-1.svg'> Remove Friend</a> "); hLinks[ PLAT_MFC ]['friend'] = ("<img src='" + this.image_url_cdn + "images/svg/heart.svg' class=icon style='height:10px;width:10px;margin-right:4px;'>Remove Friend (" + A('tx_remove_friend',{ remote_user_code: nUserId }) + "x</a>) "); } else if ( this.hSelf.access_level >= 1 ) { hLinks[ PLAT_CAM ]['friend'] = ( A('tx_add_friend',{ remote_user_code: nUserId }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/add-user-1.svg'> Add Friend</a> "); hLinks[ PLAT_MFC ]['friend'] = ( "<a href=\"javascript: PopUserMenu.hObjectRef['" + this.sInstanceId + "'].lists('friends_lists','put'," + nUserId + "); \" class=\"pum_bookfriend\"><img src='" + this.image_url_cdn + "images/svg/heart.svg' class='icon'>Add Friend</a> "); } else { hLinks[ PLAT_CAM ]['friend'] = ( A('members_feature',{style:'color:gray;'}) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/add-user-1.svg'> Add Friend</a> "); hLinks[ PLAT_MFC ]['friend'] = ( A('members_feature',{style:'color:gray;'}) + "<img src='" + this.image_url_cdn + "images/svg/heart.svg' class=icon style='height:10px;width:10px;margin-right:4px;filter:invert(0.7);'>Add Friend</a> "); } if ( this.hUser.bookmarked ) { hLinks[ PLAT_CAM ]['bookmark'] = ( A('tx_remove_bookmark',{ remote_user_code: nUserId }) + "<img height=16 src='" + this.image_url_cdn + "images/flat/stroke/svg/bookmark-1.svg'> Remove Bookmark</a> "); hLinks[ PLAT_MFC ]['bookmark'] = ( "<img src='" + this.image_url_cdn + "images/svg/bookmark.svg' class=icon style='height:10px;width:10px;margin-right:4px;'>Remove Bookmark (<a href=\"javascript: PopUserMenu.hObjectRef['" + this.sInstanceId + "'].lists('bookmarks','delete'," + nUserId + "); \">x</a>) "); } else if ( this.hSelf.access_level >= 1 ) { hLinks[ PLAT_CAM ]['bookmark'] = ( A('tx_add_bookmark',{ remote_user_code: nUserId }) + "<img height=16 src='" + this.image_url_cdn + "images/flat/stroke/svg/bookmark-add.svg'> Add Bookmark</a> ");
 hLinks[ PLAT_MFC ]['bookmark'] = ( "<a href=\"javascript: PopUserMenu.hObjectRef['" + this.sInstanceId + "'].lists('bookmarks','put'," + nUserId + "); \" class=\"pum_bookfriend\"><img src='" + this.image_url_cdn + "images/svg/bookmark.svg' class='icon'>Bookmark " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "</a> "); } else { hLinks[ PLAT_CAM ]['bookmark'] = ( A('members_feature',{style:'color:gray;'}) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/bookmark-1.svg'> Add Bookmark</a> "); hLinks[ PLAT_MFC ]['bookmark'] = ( A('members_feature',{style:'color:gray;'}) + "<img src='" + this.image_url_cdn + "images/svg/bookmark.svg' class=icon style='height:10px;width:10px;filter:invert(0.7);margin-right:4px;'>Bookmark " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "</a> "); } if(this.hSelf.access_level && this.hSelf.access_level >= 1 && hUser && this.hUser.access_level == 4 ) { if (this.hUser.hidden) { hLinks[ PLAT_CAM ]['hide'] = ("<a href=\"javascript:t.HideModel(" + nUserId + ",{ unhide: 1 });\" ><img src='" + this.image_url_cdn + "images/flat/stroke/svg/x-3.svg'>Un-Hide " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "</a>"); hLinks[ PLAT_MFC ]['hide'] = ( "<a href=\"javascript: PopUserMenu.hObjectRef['" + this.sInstanceId + "'].lists('hidden_models','delete'," + nUserId + "); \">Un-Hide " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "</a> "); } else { hLinks[ PLAT_CAM ]['hide'] = ("<a href=\"javascript:t.HideModel(" + nUserId + ", {} );\"><img src='" + this.image_url_cdn + "images/flat/stroke/svg/x-3.svg'> Hide " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "</a>"); hLinks[ PLAT_MFC ]['hide'] = ( "<a href=\"javascript: PopUserMenu.hObjectRef['" + this.sInstanceId + "'].lists('hidden_models','put'," + nUserId + "); \">Hide " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "</a> "); } } else { hLinks[ PLAT_MFC ]['hide'] = ("Hide " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + " (" + A('members_feature',{style:'color:gray;'}) + "x</a>)"); } if(this.hUser.access_level ) { if(this.hSelf.access_level ) { if(this.hUser.ignored ) { hLinks[ PLAT_CAM ]['ignore'] = ( A('tx_remove_ignore',{ remote_user_code: nUserId }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/x-2.svg'> Stop Ignoring</a>" ); hLinks[ PLAT_MFC ]['ignore'] = ( "<a href=\"javascript: PopUserMenu.hObjectRef['" + this.sInstanceId + "'].lists('ignore_lists','delete'," + nUserId + "); \">Stop Ignoring " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "</a> "); } else { hLinks[ PLAT_CAM ]['ignore'] = ( A('tx_add_ignore',{ remote_user_code: nUserId }) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/x-2.svg'> Ignore User</a>" ); hLinks[ PLAT_MFC ]['ignore'] = ( "<a href=\"javascript: PopUserMenu.hObjectRef['" + this.sInstanceId + "'].lists('ignore_lists','put'," + nUserId + "); \">Ignore " + ( this.hUser.access_level == 4 ? 'Model' : 'User' ) + "</a> ");
 } } else { hLinks[ PLAT_CAM ]['ignore'] = ( A('members_feature',{style:'color:gray;'}) + "<img src='" + this.image_url_cdn + "images/flat/stroke/svg/x-2.svg'> Ignore User</a>" ); hLinks[ PLAT_MFC ]['ignore'] = ("Ignore User (" + ( A('members_feature',{style:'color:gray;'}) + "x</a>)") ); } } if ( this.hUser.access_level != 4 && this.hUser.access_level > 0 ) { if ( t && t.HighlightUserChat && t.HighlightUserChat.hUsers && t.HighlightUserChat.hUsers[nUserId] ) { hLinks[ PLAT_CAM ]['highlight_chat'] = ( A('highlight_chat',{ user_id: nUserId }) + "Un-Highlight Chat</a> "); hLinks[ PLAT_MFC ]['highlight_chat'] = ( A('highlight_chat',{ user_id: nUserId }) + "Un-Highlight Chat</a> "); } else { hLinks[ PLAT_CAM ]['highlight_chat'] = ( A('highlight_chat',{ user_id: nUserId }) + "Highlight Chat</a> "); hLinks[ PLAT_MFC ]['highlight_chat'] = ( A('highlight_chat',{ user_id: nUserId }) + "Highlight Chat</a> "); } } hLinks[ PLAT_MFC ]['report_user'] = "<a href=# onClick=\" PopUserMenu.hObjectRef['" + this.sInstanceId + "'].ReportUser(); return false;\">" + ( this.g_hUsers[nUserId] && this.g_hUsers[nUserId].user_reported ? "<span style='color:red;'>User Reported</span>" : "Report User" ) + "</a>"; hLinks[ PLAT_CAM ]['br'] = "<br>"; hLinks[ PLAT_MFC ]['br'] = "<br>"; var aOrder = []; if(this.hUser.access_level != 4 ) { aOrder = [ 'custom_menu', 'pm_friend', 'br', 'bio', 'message', 'previous_chat', 'chat_logs', 'news_feed', 'user_notepad', 'br', 'friend', 'highlight_chat', 'br', 'ignore', 'report_user' ]; }
 else if(nPlatformId == PLAT_CAM ) { aOrder = [ 'custom_menu', 'player', 'pm_friend', 'message', 'tip', 'tip_menu', 'bio', 'news_feed', 'previous_chat', 'chat_logs', 'user_notepad', 'messenger', 'lounge', 'friend', 'change_to_friend', 'bookmark', 'hide', 'ignore', 'report_user', 'highlight_chat' ]; } else { aOrder = [ 'custom_menu', 'player', 'pm_friend', ( hLinks[ PLAT_MFC ]['lounge'] ? 'br' : '' ), 'lounge', 'br', 'tip', 'tip_menu', 'message', 'br', 'bio', 'previous_chat', 'chat_logs', 'news_feed', 'user_notepad', 'messenger', 'br', 'friend', 'change_to_friend', 'bookmark', 'br', 'hide',
 'ignore', 'report_user', 'br', 'highlight_chat' ]; } for(var a=0; a < aOrder.length; a++ ) { if(! hLinks[ nPlatformId ][ aOrder[a] ] ) { continue; } aLinks.push("<div>" + hLinks[ nPlatformId ][ aOrder[a] ] + "</div>" ); } if(nPlatformId == PLAT_MFC && ! this.hOptions.short_menu ) { aLinks.push(" <br> <div style=\"height:100px;width:150px;\" id=recommendations_list_" + this.hUser.user_id + "><div> "); } aLinks.push(" </div> "); } var sScore_Miss_MFCRank=''; if(nPlatformId == PLAT_MFC ) { if(this.hUser.cam_score > 0 && ! this.hUser.hide_cam_score ) { sScore_Miss_MFCRank += '<b>CamScore:</b> <span style=color:red;>' + Math.round(this.hUser.cam_score) + '</span> &nbsp;'; } else if(this.hSelf.username && this.hSelf.username.match(/^adminleo$|^mfcuser$/i) ) { sScore_Miss_MFCRank += '<span style=background-color:red;color:white;><b>CamScore:</b> ' + Math.round(this.hUser.cam_score) + '</span> &nbsp;'; } } var sMfcShareHtml=''; if ( nPlatformId == PLAT_MFC && this.hUser && this.hUser.access_level == 4 && this.hUser['share'] && this.hUser['share']['things'] > 0 )
 { var bNew; var sLastUpdated=''; var aOrder = [ 'albums', 'clubs', 'goals', 'collections', 'stores', 'polls', 'tipmenus' ]; var aItems=[]; for(var a=0; a < aOrder.length; a++ ) { var sType = aOrder[a]; if(! hUser['share'][ sType ] || ( sType != 'albums' && sType != 'clubs' && sType != 'goals' && sType != 'collections' && sType != 'stores' && sType != 'polls' && sType != 'tipmenus' ) ) { continue; } if(hUser['share'][ sType ] > 10000000 ) { continue; } var thing = sType.replace(/s$/,''); var sTitle = ''; var diffInDays = -1; var sNew=''; var tm; if(tm = hUser['share']['recent_'+thing+'_tm'] ) { var d1 = new Date(tm * 1000); var d2 = new Date(); var utc1 = Date.UTC(d1.getFullYear(), d1.getMonth(), d1.getDate()); var utc2 = Date.UTC(d2.getFullYear(), d2.getMonth(), d2.getDate()); var diffInHOurs = Math.ceil((utc2 - utc1) / ( 1000 * 60 * 60 )); diffInDays = Math.floor(diffInHOurs / 24 ); if(diffInDays <= 3 ) { sNew = '<span class=user_menu_share_item_new>New</span>'; if(! sLastUpdated ) { sLastUpdated = "<div class=user_menu_share_new>*NEW*</div>"; } } if(hUser['share']['recent_'+thing+'_title'] ) {
 try { sTitle = decodeURIComponent(hUser['share']['recent_'+thing+'_title'] ) + " added "; } catch(e) { console.log(e); console.log(hUser['share']['recent_'+thing+'_title']); } if(diffInDays == 0 ) { sTitle += "today"; } else if(diffInDays == 1 ) { sTitle += diffInDays +" day ago"; } else if(diffInDays > 1 && diffInDays < 31 ) { sTitle += diffInDays +" days ago"; } else { sTitle += Math.ceil(diffInDays / 30 ) +" months ago"; } sTitle += '.'; } } var sLinkType = sType == 'stores' ? 'items' : sType; var sDisplayType = ( hUser['share'][ sType ] == 1 ? sLinkType.slice(0,-1) : sLinkType ); sDisplayType = sDisplayType.charAt(0).toUpperCase() + sDisplayType.slice(1); aItems.push("<div class=\"user_menu_share_item user_menu_share_item_" + sType + "\" title=\"" + escapeHtml(sTitle) + "\">"); if(( sType == 'polls' || sType == 'tipmenus' ) && this.hSelf.access_level > FCS.FCLEVEL_BASIC ) { aItems.push("<span  onClick=\" { t.MFCShare_DhtmlMenu({ user_id: " + this.hUser.user_id + ", thing_type: '" + sLinkType + "', window: window }); return false; } \" class=user_style style=\" cursor:pointer; " + MfcCustomFonts.prototype.get_style(this.hUser ) + "\">"); } else { aItems.push("<a href=\"https://share.myfreecams.com/" + this.hUser.username + "/" + sLinkType + t.ShareQueryString() + "\" target='_blank' class=user_style style=\"" + MfcCustomFonts.prototype.get_style(this.hUser ) + "\">"); } if(sType == 'tipmenus' ) { if(this.hSelf.access_level <= FCS.FCLEVEL_BASIC ) { continue; } aItems.push("Tip Menu</span>" + sNew + "</a></div>"); continue; } aItems.push(hUser['share'][ sType ] + "&nbsp;" + sDisplayType + "</span>" + sNew + "</a></div>"); } sMfcShareHtml = " <div style='padding-bottom:10px;' id=mfc_share_" + this.hUser.user_id + "> <div style=\"display:inline-block;font-size:10px;\"> <a href=\"https://share.myfreecams.com/" + this.hUser.username + t.ShareQueryString() + "\" target='_blank' style=\"" + MfcCustomFonts.prototype.get_style(this.hUser ) + "\"> <span class='user_style username' style='font-size:11px;font-weight:bold;" + sUsernameStyle + "'>" + this.hUser.username + "</span></a> on  <a href=\"https://share.myfreecams.com/" + this.hUser.username + t.ShareQueryString() + "\" target='_blank' ><img class=\"popUserMenuMFCShare logo-mfc_share\" style=\"width:80px;height:11px;margin-bottom:-2px;\" src=\"" + this.image_url_cdn + "files/images/misc/clear.gif\"></a> " + sLastUpdated + "<br> <div style=\"padding:6px 0px 0px 0px;width:230px;\"> " + aItems.join('') + "\
 </div> </div> </div> "; } if ( this.hUser.missmfc_rank ) sScore_Miss_MFCRank += A('miss_mfc') + "<b>Miss MFC</b></a>: #<span style=\"color:red;\">" + this.hUser.missmfc_rank + "</span>"; aHtml.push(" <div style=\"position:relative;\"> <div class='user_style username' style='font-size:22px;margin-bottom:12px;font-weight:bold;width: 100%;" + sUsernameStyle + "'> " + ( this.hUser.access_level == 4 ? A('player',{ broadcaster_id: nUserId, style:'text-decoration:none;' + sUsernameStyle }) : '' ) + " " + this.hUser.username + "</a> </div> </div> "); if(this.hUser.blurb && ! this.hOptions.short_menu ) { aHtml.push("<div class=user_style style='overflow-wrap:break-word;font-size:12px;padding-bottom:5px;font-style:italic;" + sUsernameStyle + "'>" + this.hUser.blurb + "</div>"); } if(this.hUser.access_level == 4 ) { if(typeof(this.hUser.topic ) == 'string' && hUser.topic && ( this.hUser.platform_id == 2 || this.hUser.platform_id == nPlatformId ) ) { aHtml.push("<div class=user_style style='" + ( nPlatformId == PLAT_CAM ? sUsernameStyle : '' ) + ";font-size:10px;padding-bottom:5px;'>"); var sTopic = ConditionString(hUser.topic, { remove_html: true, link_affiliated_sites: true, break_long_strings: true } ); aHtml.push("<span style='overflow-wrap: break-word;'><b>Room Topic:</b> " + ProcessDynamicTopic(this.hUser, sTopic ) + "</span><br>"); aHtml.push("</div>"); } var aStatusHtml=[]; if(this.hUser.whiteboard1 ) { if(window.WhiteboardNotice && WhiteboardNotice.clickLink ) { aStatusHtml.push(" [<a href=# onClick=\" WhiteboardNotice.clickLink({ dhtml_popup: true, user_id: " + nUserId + " }); return false; \">Whiteboard</a>] &nbsp;");
 } else { var hPopupOpts = { username: t.g_hUsers[nUserId].username, user_id: nUserId, channel: PublicChannel(nUserId), height: 900, width: 900, popup_title: ( PossessiveApostrophe(t.g_hUsers[nUserId].username) + " Whiteboard") }; aStatusHtml.push(" [" + t.A('whiteboard',hPopupOpts) + "Whiteboard</a>] &nbsp;"); } } if(this.hUser.room_count && nPlatformId == PLAT_MFC ) { aStatusHtml.push(A('player',{ broadcaster_id: nUserId }) + this.hUser.room_count + " in chat room</a>. "); } if(top.location.href.indexOf('//www.') == -1 ) { aStatusHtml.push("" + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + "ID: <span>" + nUserId + "</span><br>"); } if(nPlatformId == PLAT_MFC ) { var sMuting=''; if(! this.hUser.guests_muted ) { sMuting += "Guests"; } if(! this.hUser.basics_muted ) { if(sMuting ) { sMuting += "/"; } sMuting += "Basics"; } if(sMuting ) { sMuting += "&nbsp;Chat. "; } aStatusHtml.push(sMuting ); } if(sScore_Miss_MFCRank ) aStatusHtml.push("<span style=white-space:nowrap;>" + sScore_Miss_MFCRank + "</span>"); if(aStatusHtml ) { aHtml.push("<div style='font-size:10px;padding-bottom:25px;line-height: 22px;'>" + aStatusHtml.join('') + "</div>"); } if(sMfcShareHtml ) { aHtml.push(sMfcShareHtml ); } aHtml.push("<div style='font-size:10px;height:15px;white-space:nowrap;padding-bottom:10px;' id=social_media_" + this.hUser.user_id + "></div>");
 if(! this.hOptions.short_menu ) { aHtml.push("<br>"); } } aHtml.push(aDetails.join('') ); aHtml.push(" </td> <td valign=top class=PopUserMenu_menu_column > "); aHtml.push(aLinks.join('') ); aHtml.push(" </td> </tr> </table> "); return "<div style='padding:13px 6px 6px 10px;' class='PopUserMenu'>" + aHtml.join('') + "</div>";};PopUserMenu.prototype.lists = function(list, op, user_id, options ){ options = options || {}; if(t && t.name == 'top_level' ) { var hUser = t.g_hUsers[user_id] || {}; if(op == 'put' && ( list == 'ignore_lists' || list == 'hidden_models' ) && ( hUser.friend || hUser.bookmarked ) && ! options.confirmed ) { var sMessage = hUser.username + " is in your " + ( hUser.friend ? 'friends' : 'bookmarks' ) + " list, are you sure you wish to " + ( list == 'ignore_lists' ? 'ignore' : 'hide' ) + " them?"; DhtmlPrompt({ prompt_type: 'confirm', message: sMessage, callback: () => { options.confirmed = 1; this.lists(list, op, user_id, options ); }
 }); return; } if(list == 'friends_lists' ) t.TxAddRemove('friend', user_id, op == 'put' ? 'add' : 'remove' ); else if(list == 'bookmarks' ) op == 'put' ? t.Bookmarks.Add(user_id ) : t.Bookmarks.Delete(user_id ); else if(list == 'ignore_lists' ) t.TxAddRemove('ignore', user_id, op == 'put' ? 'add' : 'remove' ); else if(list == 'hidden_models' ) op == 'put' ? t.HideModel(user_id ) : t.HideModel(user_id, { unhide: true }); } else { var lists = new MfcLists({ token: this.token }); lists.manageList(list, op, user_id, { callback: this.lists_update_callback } ); var hListToProperty = { 'friends_lists': 'friend', 'bookmarks': 'bookmarked', 'ignore_lists': 'ignored', 'hidden_models': 'hidden' }; this.hUser[ hListToProperty[list] ] = op == 'put' ? true : false; this.update(); }};PopUserMenu.prototype.ReportUser = function(name ){ var sHtml = " <div id=ReportUser_content> Please state why you wish to report <b>" + this.hUser.username + "</b>:<br> <textarea id=ReportUser_textarea style=\"height:60px;width:360px;\" onKeyUp=\" document.getElementById('ReportUser_button').disabled = this.value.match(/\\w{4,}/) ? false : true; \" ></textarea><br> <div style=\"text-align:right;padding-top:5px;\"> <input type=button onClick=\" PopUserMenu.hObjectRef['" + this.sInstanceId + "'].ReportUser_Send(); return false;\" id=ReportUser_button value=\"Send Report\" style=\"font-size:11px;\" disabled=true> </div> </div> "; this.oDhtmlPopup_ReportUser = new MfcDhtmlPopup({ window: this.window, mfcMouseTracker: g_oMouseTracker,
 mfcGraphics: g }); this.oDhtmlPopup_ReportUser.open(sHtml, { no_close_on_mouseout: true, provide_close_button: true })};PopUserMenu.prototype.ReportUser_Send = function(name ){ var report = document.getElementById('ReportUser_textarea').value; var req = createRequestObject(); req.open("POST",this.apiUrl + '/reportUser' ); req.setRequestHeader("Content-type", "application/json"); req.withCredentials = true; req.onreadystatechange = () => { if(req.readyState != 4 ) { return; } document.getElementById('ReportUser_content').innerHTML = "<div style='padding: 20px 25px;'>Thank you for your report!</div>"; this.g_hUsers[ this.hUser.user_id ].user_reported = true; }; req.send(JSON.stringify({ 'reported_user_id': this.hUser.user_id, 'report_text': report } ) );};PopUserMenu.prototype.CustomFunction = function(name ){ var custom = this.custom_menu[name]; custom.func(this.hUser ); if(custom.close_on_click ) { this.close(); }};PopUserMenu.prototype.has_images = function(oEvent ){ if(oEvent && oEvent.target && oEvent.target.naturalWidth > 1 ) { oEvent.target.style.display=''; }};PopUserMenhtmlPopup.close();};PopUserMenu.prototype.popup_LiveSnapImage = function(nUserId, e ){ var nHeight = 420; var nWidth = Math.round(this.hUser.video_aspect_ratio * nHeight );
 var sAspectRatioClass = 'ar_4_3'; if(this.bWidescreen ) { sAspectRatioClass = 'ar_16_9'; } var oAnimatedLiveSnaps = new AnimatedLiveSnaps({ getSnapUrl: this.LiveSnapUrl, retain_video_on_mouseout: true, immediate_video: true }); var instance_name = 'popup_LiveSnapImage' + nUserId; this.oDhtmlPopup_LiveSnapImage = new MfcDhtmlPopup({ window: this.window, instance_name: instance_name, mfcMouseTracker: g_oMouseTracker, mfcGraphics: g }); var sQuickTip=''; if(this.hSelf.access_level >= FCS.FCLEVEL_PREMIUM ) { var menuQuickTip = new MfcQUsers[ nUserId ]; } }); sQuickTip = menuQuickTip.a_tag() + "&#9889;</a>"; } this.oDhtmlPopup_LiveSnapImage.open(" <div id=popup_LiveSnapImage_" + this.sInstanceId + " style=\"height:" + nHeight + "px;width:" + nWidth + "px;position: relative;\" onClick=\" if(event.button==0 ) PopUserMenu.hObjectRef['" + this.sInstanceId + "'].go_to_room(); \" onContextMenu=\" event.preventDefault(); PopUserMenu.hObjectRef['" + this.sInstanceId + "'].open(); \" ><i" + "mg class=\"livesnap_border ar_fixed_image livesnap\" " + oAnimatedLiveSnaps.mouseEventCode(nUserId,{ no_click: true, auto_update_livesnaps: true, timer: 10, size: 640 }) + " sr"+"c=" + this.LiveSnapUrl(nUserId,640) + "> </div> <div style=\"white-space:nowrap;width:250px;\"> <a href=# onClick=\"PopUserMenu.hObjectRef['" + this.sInstanceId + "'].go_to_room(); return false;\">Go to <b>" + this.hUser.username + "'s</b> Room &nbsp; " + sQuickTip + " </div> ",{ event: e, child: true, no_close_button: 1, option_to_pin: 1, on_pin_function: () => { this.close(); } });};PopUserMenu.prototype.go_to_room = function(hOptions ){ hOptions = hOptions || {}; hOptions.do_click = true; hOptions.broadcaster_id = this.hUser.user_id; A('player', hOptions ); this.oDhtmlPopup && this.oDhtmlPopup.close(); this.oDhtmlPopup_LiveSnapImage && this.oDhtmlPopup_LiveSnapImage.close({ click: true });};PopUserMenu.prototype.pop_image_hover = function(oEvent )
{ if(oEvent.type == 'mouseleave' && this.MfcDhtmlPopup_pop_image_hover ) { this.MfcDhtmlPopup_pop_image_hover.close(); } else if(oEvent.type == 'mouseenter' ) { sH = `<img style="height:${oEvent.target.naturalHeight}px;width:${oEvent.target.naturalWidth}px;" src=${oEvent.target.dataset.imgsrc}>`; this.MfcDhtmlPopup_pop_image_hover = new MfcDhtmlPopup({}); this.MfcDhtmlPopup_pop_image_hover.open(sH,{ 'hover': true, 'hover_offset': 100 }); } };PopUserMenu.prototype.pop_image = function(oEvent, hOptions ){ hOptions = hOptions || {}; hOptions.src = hOptions.src || ( oEvent && oEvent.target && oEvent.target.dataset.imgsrc ); if(! hOptions.width && oEvent.target.naturalWidth ) { hOptions.width = oEvent.target.naturalWidth; } if(! hOptions.height && oEvent.target.naturalHeight ) { hOptions.height = oEvent.target.naturalHeight; } this.MfcDhtmlPopup_pop_image = new MfcDhtmlPopup({ window: this.window }); var sPopupChildContent = ''; var PopUserMenu_pop_image_ID = Math.round(Math.random() * 1000000 ); sPopupChildContent += "<i"+"mg sr"+"c='" + hOptions.src + "'  style=\"border-radius:5px;\" onClick=\" PopUserMenu.hObjectRef['" + this.sInstanceId + "'].MfcDhtmlPopup_pop_image.close();\" "; if(hOptions.width ) sPopupChildContent += " width=" + hOptions.width + " "; if(hOptions.height ) sPopupChildContent += " height=" + hOptions.height + " "; if(hOptions.style_class ) sPopupChildContent += " class=" + hOptions.style_class + " "; if(hOptions.auto_refresh ) { sPopupChildContent += " id=preview_img_" + PopUserMenu_pop_image_ID + " onLoad=\" setTimeout(function() { var oEl = document.getElementById('preview_img_" + PopUserMenu_pop_image_ID + "'); if(oEl ) { oEl.src = oEl.src.replace(/=[\\d\\.]+$/,('='+Math.random())); } },200);\" "; } sPopupChildContent += ">";
 if(hOptions.go_to_room && t && t.A ) { sPopupChildContent += "<div style=white-space:nowrap;width:250px;>" + A('player',{ broadcaster_id: hOptions.go_to_room }) + "Go to <b>" + this.hUser.username + "'s</b> Room</div>"; } if(hOptions.container_height || hOptions.container_width ) { var sContainer = "<div style=\""; if(hOptions.container_height ) sContainer += "height:" + hOptions.container_height + "px;"; if(hOptions.container_width ) sContainer += "width:" + hOptions.container_width + "px;"; sContainer += "\">"; sPopupChildContent = sContainer + sPopupChildContent; sPopupChildContent += "</div>"; } this.MfcDhtmlPopup_pop_image.open(sPopupChildContent,hOptions);};PopUserMenu.prototype.get_all_tags = function(){ var sContent = ''; var aTags=[]; var nCount=0; for(var n=0; n<this.hUser.aTags.length; n++ ) { if(t && t.FcTags && t.FcTags.hTagCounts && t.FcTags.hTagCounts[ this.hUser.aTags[n] ] > 1 ) { nCount++; aTags.push(A('model_tags',{ selected_field: encodeURIComponent(this.hUser.aTags[n]) }) + this.hUser.aTags[n] + "</a>"); } else { aTags.push("<span style='text-decoration:underline;'>" + this.hUser.aTags[n] + "</span>"); } } sContent = " <div style=\"font-size:13px;width:200px;\"> <div style='font-weight:bold;font-size:15px;'>Tags for " + this.hUser.username + "</div> <div style='padding:10px;'>" + aTags.join(', ') + "</div>\
 </div> "; return sContent;};PopUserMenu.prototype.all_tags_in_child = function(){ this.oDhtmlPopup_all_tags_in_child = new MfcDhtmlPopup(); this.oDhtmlPopup_all_tags_in_child.open(this.get_all_tags() );};

// js_build_core: js/MfcProgressBar.js
function MfcProgressBar(hOptions ){ if(hOptions == undefined ) { hOptions = {}; } if(MfcProgressBar.nId == undefined ) MfcProgressBar.nId = 0; MfcProgressBar.nId++; this.nId = MfcProgressBar.nId; this.hConstructorOptions = {}; for(var sK in hOptions ) { this.hConstructorOptions[sK] = hOptions[sK]; } this.Initialize(hOptions );};MfcProgressBar.prototype.Initialize = function(hOptions ){ if(hOptions == undefined ) { hOptions = {}; } for(var sK in this.hConstructorOptions ) { if(hOptions[sK] == undefined ) { hOptions[sK] = this.hConstructorOptions[sK]; } } this.nTotalWidth = hOptions.width; this.nInitialValue = hOptions.initial_value; this.nFinalValue = hOptions.final_value; this.sOutputElement = hOptions.output_element; this.nSmoothingResolution = hOptions.smoothing_resolution || 20; this.nSmoothingTime = hOptions.smoothing_time || 20; this.nSmoothingTime = hOptions.smoothing_time || 20; this.completion_callback = hOptions.completion_callback || null; this.nTimeout = 0; this.nSmoothCounter = 1;
 this.nIncrementWidth = 0; this.nNewWidth = 0; this.sContainerStyle = hOptions.container_style; this.sContainerClass = hOptions.container_class; this.sBarStyle = hOptions.bar_style; this.sBarClass = hOptions.bar_class;};MfcProgressBar.prototype.DrawProgressBar = function(){ var sHtml = " <div style=\"width:" + this.nTotalWidth + "px;" + this.sContainerStyle + "\" class=\"" + this.sContainerClass + "\"> <div id=ProgressBarDiv" + this.nId + " class=\"" + this.sBarClass + "\"style=\"width:0px;" + this.sBarStyle + "\">&nbsp;</div> </div> "; if(this.sOutputElement ) { document.getElementById(this.sOutputElement).innerHTML = sHtml; } return sHtml;};MfcProgressBar.prototype.Update = function(nCurrentValue ){ if(this.nInitialValue == undefined ) { this.nInitialValue = 0; } if(this.nOldWidth == undefined ) { this.nOldWidth = ( this.nInitialValue / this.nFinalValue ) * this.nTotalWidth; } if(nCurrentValue <= 0 ) { this.nOldWidth = 0; this.AdvanceBar(0 ); return; } else { this.nNewWidth = ( nCurrentValue / this.nFinalValue ) * this.nTotalWidth; if(this.nNewWidth > this.nTotalWidth ) { clearTimeout(this.nTimeout ); this.nOldWidth = this.nTotalWidth; this.AdvanceBar(this.nTotalWidth ); return; } this.nIncrementWidth = ( this.nNewWidth - this.nOldWidth ) / this.nSmoothingResolution;
 this.nSmoothCounter = 1; this.nOldWidth = this.nNewWidth; this.IncrementWidth(); }};MfcProgressBar.prototype.IncrementWidth = function(){ var nIncrementedWidth = this.nNewWidth - ( ( this.nSmoothingResolution - this.nSmoothCounter ) * this.nIncrementWidth ); if(nIncrementedWidth > this.nTotalWidth ) { this.AdvanceBar(this.nTotalWidth ); if(this.completion_callback ) { this.completion_callback(); } return; } this.AdvanceBar(nIncrementedWidth ); if(this.nSmoothCounter <= this.nSmoothingResolution ) { clearTimeout(this.nTimeout ); this.nTimeout = setTimeout(this.Bind(this.IncrementWidth ), this.nSmoothingTime ); this.nSmoothCounter++; }};MfcProgressBar.prototype.AdvanceBar = function(nWidth ){ if(document.getElementById('ProgressBarDiv' + this.nId ) != undefined ) document.getElementById('ProgressBarDiv' + this.nId ).style.width = Math.round(nWidth ) + 'px';};MfcProgressBrguments ) ); } );};


// js_build_core: js/MfcQueue.js
function MfcQueue() { this.aCmdBuf = new Array(); this.nInterval = null; this.nSuspend = null; this.bStarted = false;}; MfcQueuf.push(sCommand); }; MfcQueue.prototype.Process = function() { while(this.bStarted && this.aCmdBuf.length > 0 ) { ParseLine(this.aCmdBuf.shift() ); } }; MfcQueue.prototype.Start = function() { this.Stop(); this.bStarted = true; this.nInterval = setInterval(() => { this.Process(); }, 100 ); }; MfcQue.bStarted = false;}; 

// js_build_core: ame = sReportName;}MfcReportBack.prototype.Send = function(sLabel, sMessage ){ this.oRequestObject.open("POST","/php/ReportBack.php"); this.oRequestObject.setRequestHeader("Content-type","application/x-www-form-urlencoded"); var data = '' + "report_name=" + encodeURIComponent(this.sReportName ) + "&" + "label=" + encodeURIComponent(sLabel || '' ) + "&" + "message=" + encodeURIComponent(sMessage || '' ) ; this.oRequestObject.send(data );};

// js_build_core: js/MfcDhtmlWindow.js
function MfcDhtmlWindow(hOptions ){ if(hOptions == undefined ) { hOptions = {}; } if(MfcDhtmlWindow.nId == undefined ) MfcDhtmlWindow.nId = 10; MfcDhtmlWindow.nId++; this.nId = MfcDhtmlWindow.nId; this.hOptions = hOptions; this.height = hOptions.height || 400; this.width = hOptions.width || 100; this.left = hOptions.left; this.top = hOptions.top; this.url = hOptions.url; this.maximize_iframe = hOptions.maximize_iframe; this.hUA = new MfcUserAgent(); this.mfcMouseTracker = hOptions.MfcMouseTracker; this.mfcClickDrag = hOptions.MfcClickDrag; this.mfcMousePress = hOptions.MfcMousePress; this.oCloseWindowHandler = hOptions.oCloseWindowHandler; this.use_plain_container = hOptions.use_plain_container; this.fOnResize = hOptions.f_on_resize || function(){}; this.nPadHeight = hOptions.pad_height || 43; this.nPadWidth = hOptions.pad_width || 20; this.sIconUrl = hOptions.icon_url; this.sIconSpriteCss = hOptions.icon_sprite_css; this.sTitle = hOptions.title;
 this.sContainingDivId = hOptions.containing_div_id; this.sSpecialClass = 'MfcDhtmlWindow_standard'; this.sHideClass = 'slide_out'; this.sRevealClass = 'slide_in'; if(this.sSpecialClass == 'MfcDhtmlWindow_mobile' ) { this.nPadHeight += 35; this.nPadWidth += 20; } if(this.use_plain_container ) { this.nPadWidth -= 6; } var hViewportDimension = this.hUA.GetViewportDimensions(); if(( this.height + 100 ) > hViewportDimension.height ) { this.height = ( hViewportDimension.height - 150 ); } this.Open();};MfcDhtmlWindow.zIndex = 100;MfcDhtmlWindow.prototype.Open = function(){ var sDebugBorder = 0; var sIcon=''; if(this.sIconUrl ) { sIcon = "<img src='" + this.sIconUrl + "'>"; } sHtml = " <div id='MfcDhtmlWindow_shield_" + this.nId + "' style=\"display:none;position:absolute;top:0px;left:0px;\"> &nbsp; </div> <div class='MfcDhtmlWindow_container MfcDhtmlWindow_container_shadow MfcDhtmlWindow_container_fadein " + this.sSpecialClass + "_container' id='MfcDhtmlWindow_container_" + this.nId + "' style='position:absolute;height:" + ( this.height + this.nPadHeight ) + "px;width:" + ( this.width + this.nPadWidth ) + ";' > <div id='MfcDhtmlWindow_table_container_" + this.nId + "'> <table class=MfcDhtmlWindow_table cellpadding=0 cellspacing=0 border=" + sDebugBorder + " id=MfcDhtmlWindow_table_" + this.nId + "> <tr> <td height=100%> <table height=100% width=100% cellpadding=0 cellspacing=0 border=" + sDebugBorder + "> <tr> <td class=MfcDhtmlWindow_grip rowspan=2 style='width: 6px;'> <div class='MfcDhtmlWindow_grip_top_left " + this.sSpecialClass + "_grip_top_left' id='MfcDhtmlWindow_grip_top_left_" + this.nId + "'>&nbsp;</div> <div class='MfcDhtmlWindow_grip_left " + this.sSpecialClass + "_grip_left' id='MfcDhtmlWindow_grip_left_" + this.nId + "'>&nbsp;</div> </td> <td class=MfcDhtmlWindow_grip_td id='MfcDhtmlWindow_grip_td_" + this.nId + "' style='height:33px;'> <div class='MfcDhtmlWindow_header " + this.sSpecialClass + "_header' id='MfcDhtmlWindow_header_" + this.nId + "'>&nbsp;</div>\
 <div class=MfcDhtmlWindow_grip> <div class='MfcDhtmlWindow_grip_top " + this.sSpecialClass + "_grip_top' id='MfcDhtmlWindow_grip_top_" + this.nId + "'>&nbsp;</div> </div> <div class='MfcDhtmlWindow_icon " + this.sSpecialClass + "_icon' id='MfcDhtmlWindow_icon_" + this.nId + "'> "; if(this.sIconSpriteCss ) sHtml += "<div class='" + this.sIconSpriteCss + "'></div>"; else sHtml += sIcon; sHtml += " </div> <div class='MfcDhtmlWindow_heading " + this.sSpecialClass + "_heading' id='MfcDhtmlWindow_heading_" + this.nId + "'> " + ( this.sTitle || '' ) + " </div> <div class='MfcDhtmlWindow_grip_move " + this.sSpecialClass + "_grip_move' id='MfcDhtmlWindow_grip_move_" + this.nId + "'>&nbsp;</div> <div class='MfcDhtmlWindow_controls " + this.sSpecialClass + "_controls'> <div id='MfcDhtmlWindow_minimize_" + this.nId + "' class='MfcDhtmlWindow_minimize " + this.sSpecialClass + "_minimize'>Minimize</div> <div id='MfcDhtmlWindow_popout_" + this.nId + "' class='MfcDhtmlWindow_popout " + this.sSpecialClass + "_popout'><img src='/images/svg/popout.svg' title='Change this in-browser popup to a normal popup window'></div> <div id='MfcDhtmlWindow_close_" + this.nId + "' class='MfcDhtmlWindow_close " + this.sSpecialClass + "_close'>&nbsp;</div> </div> </td> <td class=MfcDhtmlWindow_grip rowspan=2 style='width: 7px;'> <div class='MfcDhtmlWindow_grip_right " + this.sSpecialClass + "_grip_right' id='MfcDhtmlWindow_grip_right_" + this.nId + "'>&nbsp;</div> <div class='MfcDhtmlWindow_grip_top_right " + this.sSpecialClass + "_grip_top_right' id='MfcDhtmlWindow_grip_top_right_" + this.nId + "'>&nbsp;</div> </td> </tr> <tr> <td height=100%> <div class='MfcDhtmlWindow_" + ( this.use_plain_container ? 'plain_' : '' ) + "inner_container " + this.sSpecialClass + "_inner_container' id='MfcDhtmlWindow_inner_container_" + this.nId + "'> <iframe ALLOWTRANSPARENCY=\"true\" name=MfcDhtmlWindow_iframe_" + this.nId + " id='MfcDhtmlWindow_iframe_" + this.nId + "' style=\"opacity:0;\" src='" + this.url + "' frameborder=0 borderwidth=0 height=" + this.height + " width=" + this.width + " allow=\"camera; microphone\" ></iframe> </div> </td> </tr> </table> </td> </tr> <tr> <td> <table class=MfcDhtmlWindow_grip width=100% cellpadding=0 cellspacing=0 border=" + sDebugBorder + "> <tr> <td width=20> <div class='MfcDhtmlWindow_grip_bottom_left " + this.sSpecialClass + "_grip_bottom_left' id='MfcDhtmlWindow_grip_bottom_left_" + this.nId + "'>&nbsp;</td> <td style='height: 7px;'>\
 <div class='MfcDhtmlWindow_grip_bottom " + this.sSpecialClass + "_grip_bottom' id='MfcDhtmlWindow_grip_bottom_" + this.nId + "'>&nbsp;</div> </td> <td width=20> <div class='MfcDhtmlWindow_grip_bottom_right " + this.sSpecialClass + "_grip_bottom_right' id='MfcDhtmlWindow_grip_bottom_right_" + this.nId + "'>&nbsp;</div> </td> </table> </td> </tr> </table> </div> </div> "; this.oMasterDiv = document.createElement('div'); this.oMasterDiv.innerHTML = sHtml; this.oContainingDiv = document.getElementById(this.sContainingDivId ); this.oContainingDiv.appendChild(this.oMasterDiv); this.oContainerDiv = document.getElementById('MfcDhtmlWindow_container_' + this.nId ); this.oTableContainerDiv = document.getElementById('MfcDhtmlWindow_table_container_' + this.nId ); this.oTableDiv = document.getElementById('MfcDhtmlWindow_table_' + this.nId ); this.oInnerContainer = document.getElementById('MfcDhtmlWindow_inner_container_' + this.nId ); this.oIframe = document.getElementById('MfcDhtmlWindow_iframe_' + this.nId ); this.oGripTd = document.getElementById('MfcDhtmlWindow_grip_td_' + this.nId ); this.oHeader = document.getElementById('MfcDhtmlWindow_header_' + this.nId ); this.oClose = document.getElementById('MfcDhtmlWindow_close_' + this.nId ); this.oMinimize = document.getElementById('MfcDhtmlWindow_minimize_' + this.nId ); this.oPopout = document.getElementById('MfcDhtmlWindow_popout_' + this.nId ); this.minimized = false; this.oIframeHandle = window.frames['MfcDhtmlWindow_iframe_' + this.nId ]; this.oIframe.onload = () => { this.AttachToIframeDocument(); this.oIframe.style.opacity = 1; }; setTimeout(() => { this.oIframe.style.opacity = 1; this.oContainerDiv.classList.remove('MfcDhtmlWindow_container_fadein'); }, 2500 ); this.oClose.onclick = () => { this.Close(); }; this.oMinimize.onclick = () => { this.Minimize(); }; this.oPopout.onclick = () => { this.Popout(); };
 this.oTableDiv.style.width='100%'; this.oTableDiv.style.height='100%'; var sSetName = 'MfcDhtmlWindow_grip_move_' + this.nId; var hClickDragSet = {}; hClickDragSet[ sSetName ] = { subject_id: 'MfcDhtmlWindow_container_' + this.nId, hAdjustments: { Y: { top: { } }, X: { left: {} } } }; this.mfcClickDrag.AddSet(hClickDragSet ); var hMousePressElement = {}; hMousePressElement[ sSetName ] = { bypass_mouseout_failsafe: this.hUA.IE ? 0 : 1, left_click: { onmousedown: (e) => { this.OnMouseDown('move'); this.mfcClickDrag.OnMouseDown('MfcDhtmlWindow_grip_move_' + this.nId ); }, onmousemove: (e) => { e.preventDefault(); this.mfcClickDrag.OnMouseMove(e); }, onmouseup: (e) => { this.OnMouseUp(); this.mfcClickDrag.OnMouseUp(e); }, onselectstart: () => { return false; } } }; this.mfcMousePress.AddNamedElement(hMousePressElement ); var hSidesConfig = { bottom_right: { Y: { height: { } }, X: { width: {} } }, right: { X: { width: { } } }, left: { X: { width: { inverse:true }, left: {} } }, top: { Y: { height: { inverse:true }, top: {} } }, top_right: { Y: { height: { inverse:true }, top: {} }, X: { width: {} } }, top_left: { Y: { height: { inverse:true }, top: {} }, X: { width: { inverse:true } , left: { } } }, bottom_left: { Y: { height: { } }, X: { width: { inverse:true }, left: { } } }, bottom: { Y: { height: { } } } }; for(var sSide in hSidesConfig ) { var sSetName = 'MfcDhtmlWindow_grip_' + sSide + '_' + this.nId; var hClickDragSet = {}; hClickDragSet[ sSetName ] = { min_height: 200, min_width: 200, subject_id: 'MfcDhtmlWindow_container_' + this.nId,
 hAdjustments: CloneObject(hSidesConfig[sSide] ) }; this.mfcClickDrag.AddSet(hClickDragSet ); (( sSide ) => { var hMousePressElement = {}; hMousePressElement[ sSetName ] = { left_click: { onmousedown: (e) => { this.OnMouseDown(sSide ); this.mfcClickDrag.OnMouseDown('MfcDhtmlWindow_grip_' + sSide + '_' + this.nId ); }, onmousemove: (e) => { e.preventDefault(); this.mfcClickDrag.OnMouseMove(e); }, onmouseup: (e) => { this.OnMouseUp(); this.mfcClickDrag.OnMouseUp(e)> { return false; } } }; this.mfcMousePress.AddNamedElement(hMousePressElement ); })( sSide ); } if(this.hUA.mobile || this.hUA.tablet ) { this.oPopout.style.display = 'none'; } this.Position(); this.mfcMousePress.AttachEvents(); this.BringToFront(); setTimeout(this.BringToFront, 500 );};MfcDhtmlWindow.prototype.AttachToIframeDocument = function(){ this.oIframeHandle.onfocus = () => { this.BringToFront(); }; addEvent('touchstart',this.oIframeHandle, () => { this.BringToFront() }, true); if(this.maximize_iframe && ( this.hUA.mobile ) ) { setTimeout(() => { this.ResizeIframe(this ); } ,500); clearInterval(this.ResizeIframeInterval ); this.ResizeIframeInterval = setInterval(() => { this.ResizeIframe(this ); } ,1500); }};MfcDhtmlWindow.prototype.ResizeIframe = function(){ this.height = this.GetDocSize('Height', this.oIframeHandle.document );
 this.oIframe.height = this.height + 'px'; this.oContainerDiv.style.height = ( this.height + this.nPadHeight ) + 'px'; this.width = this.GetDocSize('Width', this.oIframeHandle.document ); this.oIframe.width = this.width + 'px'; this.oContainerDiv.style.width = ( this.width + this.nPadWidth ) + 'px';};MfcDhtmlWindow.prototype.GetDocSize = function(sAxis, oDocument ) { var oDocument = oDocument || document; return Math.max(Math.max(oDocument.body['scroll' + sAxis ], oDocument.documentElement['scroll' + sAxis ]), Math.max(oDocument.body['offset' + sAxis ], oDocument.documentElement['offset' + sAxis ]), Math.max(oDocument.body['client' + sAxis ], oDocument.documentElement['client' + sAxis ]) );};MfcDhtmlWindow.prototype.BringToFront = function(){ if(this.oContainerDiv && this.oContainerDiv.style ) { window.g_nHighest_zIndex = window.g_nHighest_zIndex || 100; if(this.oContainerDiv.style.zIndex >= window.g_nHighest_zIndex ) { return; } window.g_nHighest_zIndex++; this.oContainerDiv.style.zIndex = window.g_nHighest_zIndex; }};MfcDhtmlWindow.prototype.GetIframeReference = function(nValue ){ return window.frames['MfcDhtmlWindow_iframe_' + this.nId ];};MfcDhtmlWindow.prototype.SetOpacity = function(oSubject, nValue ){ var sNewOpacity = '' + ( nValue / 10 ); oSubject.style.opacity = sNewOpacity < 1 ? sNewOpacity : ''; oSubject.style.filter = 'alpha(opacity=' + nValue * 10 + ')';};MfcDhtmlWindow.prototype.OnMouseDown = function(sSide ){ this.sHighlightDiv = 'MfcDhtmlWindow_grip_' + sSide + '_' + this.nId; if(! ( t && t.g_hSelf && t.g_hSelf.single_page_website ) ) { this.oContainingDiv.style.overflow='hidden'; } var el; ( el = GetEl('layout_table') ) && ( this.oContainingDiv.style.height = el.offsetHeight + 'px' );
 this.oContainingDiv.style.overflow='hidden'; this.oContainerDiv.className='MfcDhtmlWindow_container ' + this.sSpecialClass + '_container'; var viewportHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; var viewportWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth; viewportHeight -= 10; viewportWidth -= 10; this.oInnerContainer.style.visibility = 'hidden'; this.oGripTd.style.visibility = 'hidden'; this.oHeader.style.visibility = 'hidden'; this.SetOpacity(this.oContainerDiv,7.5); this.BringToFront();};MfcDhtmlWindow.prototype.OnMouseUp = function(){ if(! this.oContainerDiv ) { return; } if(! ( t && t.g_hSelf && t.g_hSelf.single_page_website ) ) { this.oContainingDiv.style.overflow=''; }
 this.oContainerDiv.className='MfcDhtmlWindow_container MfcDhtmlWindow_container_shadow ' + this.sSpecialClass + '_container'; if(this.hUA.mobile ) { document.getElementById(this.sHighlightDiv).style.backgroundColor=''; document.ontouchmove = null; } this.oInnerContainer.style.visibility = 'visible'; this.oGripTd.style.visibility = 'visible'; this.oHeader.style.visibility = 'visible'; if(this.bDoubleClick ) { this.MaximizeWindow(); } else { this.bDoubleClbDoubleClick = 0; },500); this.MouseResize(); } this.SetOpacity(this.oContainerDiv,10); if(this.maximize_iframe && ( this.hUA.mobiizeIframe(this ); } ,500); } if(this.fOnResize ) { this.fOnResize(this.oIframeHandle); }};MfcDhtmlWindow.prototype.MouseResize = function(){ var oResult = this.mfcClickDrag.hAdjustmentResults[ 'MfcDhtmlWindow_container_' + this.nId ];
 if(oResult && oResult.Y && oResult.Y.height != undefined ) { this.height = oResult.Y.height.value; var nHeight = this.height - this.nPadHeight; this.oIframe.height = nHeight; try { this.oIframeHandle.document.body.style.height = nHeight; } catch(e){} } if(oResult && oResult.X && oResult.X.width != undefined ) { this.width = oResult.X.width.value; var nWidth = this.width - this.nPadWidth; this.oIframe.width = nWidth; try { this.oIframeHandle.document.body.style.width = nWidth; } catch(e){} } if(oResult && oResult.X && oResult.X.left != undefined ) { var viewportWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth; if(oResult.X.left.value > viewportWidth ) { this.oContainerDiv.style.left = ( viewportWidth - 100 ); } else if(oResult.X.left.value < 0 - this.width ) { this.oContainerDiv.style.left = ( 100 - this.oIframe.width ) }; } if(oResult && oResult.Y && oResult.Y.top != undefined && ! ( t && t.g_hSelf && t.g_hSelf.single_page_website ) ) { var viewportHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; if(oResult.Y.top.value > viewportHeight ) { this.oContainerDiv.style.top = ( viewportHeight - 100 ); } else if(oResult.Y.top.value < 0 ) { this.oContainerDiv.style.top = 0; }; }
};MfcDhtmlWindow.prototype.Close = function(){ clearInterval(this.ResizeIframeInterval ); this.executeIframeEvent('Close'); try { if(this.oIframeHandle && typeof(this.oIframeHandle.onunload) === 'function' ) { this.oIframeHandle.onunload(); this.oIframeHandle.onunload = function(){}; } if(this.oIframeHandle && typeof(this.oIframeHandle.document.onunload) === 'function' ) { this.oIframeHandle.document.onunload(); this.oIframeHandle.document.onunload = function(){}; } } catch(e) {} try { this.oMasterDiv.parentNode.removeChild(this.oMasterDiv ); } catch(e) {} if(this.oCloseWindowHandler ) { this.oCloseWindowHandler(); } this.closed = true;};MfcDhtmlWindow.pAnimation('away');};MfcDhtmlWindow.prototype.Popout = function(){ var opts = this.hOptions; if(this.oIframe.contentWindow.ChangePMPopupType ) { this.oIframe.contentWindow.ChangePMPopupType.toggle('native_window'); } else if(this.oIframe.contentWindow.ChangePlayerPopupType ) { this.oIframe.contentWindow.ChangePlayerPopupType.toggle('native_window'); } else { delete opts.force_dhtml_window; opts.force_native_window = true; opts.target = 'new_window';
 t.A_Click(event, { 'resource': this.hOptions.options.resource, 'target': 'new_window', window_params: opts } ); this.Close(); }};MfcDhtmlWindow.prototype.executeIframeEvent = function ( sEventName ){ var sFuncName = '_onDhtmlWindow' + sEventName; try { if(this.oIframeHandle && typeof(this.oIframeHandle[sFuncName]) === 'function' ) this.oIframeHandle[sFuncName](); } catch(e) {}};MfcDhtmlWindow.prototype.MinMaxAnimation = function(sDirection ){ var aBrowserVariants = ['Webkit','Ms','O','Moz']; { var oEl = this.oContainerDiv; if(sDirection == 'away' ) { this.executeIframeEvent('Minimize'); oEl.classList.add(this.sHideClass); oEl.classList.remove(this.sRevealClass); } else if(sDirection == 'towards' ) { this.executeIframeEvent('Restore');
 oEl.classList.remove(this.sHideClass); oEl.classList.add(this.sRevealClass); } }};MfcDhtmlWindow.prototype.Restore = function(){ this.BringToFront(); if(! this.oContainerDiv.classList.contains(this.sHideClass) ) { return; } this.MinMaxAnimation_Step = 0; this.MinMaxAnimation('towards'); this.minimized = false;};MfcDhtmlWindow.prototype.Position = function(){ var nRight = 0; var viewportWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth; var viewportHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; var nWidth = this.width; var nHeight = this.height; var nLeftPos = this.left != undefined && ! isNaN(this.left ) ? this.left : ( viewportWidth - nWidth ) / 2; if(this.top == undefined || isNaN(this.top ) ) { if(this.maximize_iframe ) { var sTop = (document.documentElement && document.documentElement.scrollTop) || document.body.scrollTop; this.top = ( sTop + this.mfcMouseTracker.clientY ) - Math.round(nHeight / 2 ); } else { this.top = ( viewportHeight - nHeight ) / 2; } if(t && t.g_hSelf && t.g_hSelf.single_page_website ) { this.top += document.body.scrollTop; } } var nTopPos = this.top; if(nTopPos < 0 ) { nTopPos = 0; } this.oContainerDiv.style.top = nTopPos + 'px';
 this.oContainerDiv.style.left = nLeftPos + 'px';};MfcDhtmlWindow.prototype.Size = function(){ this.oIframe.height = this.height + 'px'; this.oContainerDiv.style.height = ( this.height + this.nPadHeight ) + 'px'; this.oIframe.width = this.width + 'px'; this.oContainerDiv.style.width = ( this.width + this.nPadWidth ) + 'px';};MfcDhtmlWindow.prototype.MaximizeWindow = function(){ this.hPriorToMaximized ; if(this.hPriorToMaximized ) { this.top = this.hPriorToMaximized.top; this.left = this.hPriorToMaximized.left; this.height = this.hPriorToMaximized.height; this.width = this.hPriorToMaximized.width; delete this.hPriorToMaximized; this.oContainerDiv.style.top = this.top + 'px'; this.oContainerDiv.style.left = this.left + 'px'; this.Size(); return; } this.hPriorToMaximized = { top: this.top, left: this.left, height: this.height, width: this.width }; this.top = 10; this.left = 10; this.oContainerDiv.style.top = this.top + 'px'; this.oContainerDiv.style.left = this.left + 'px'; var viewportWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth; var viewportHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; this.width = viewportWidth - this.nPadWidth - 210; this.height = viewportHeight - this.nPadHeight - 25;
 this.Size();};

// js_build_core: js/MfcValidateEmail.js
function ValidateEmail(sEmail ){ hDomainList = new Array('10minutemail.com','2prong.com','4warding.com','6url.com','afrobacon.com','antispam24.de','bugmenot.com','bumpymail.com','bupkiss.net','centermail.com','centermail.net','choicemail1.com','deadspam.com','despam.it','despammed.com','discardmail.com','discardmail.de','disposeamail.com','dodgeit.com','dodgit.com','dontreg.com','dontsendmespam.de','dumpandjunk.com','dumpmail.de','e4ward.com','emaildienst.de','emailias.com','emailto.de','emailxfer.com','emz.net','enterto.com','fificorp.com','fificorp.net','front14.org','getonemail.com','ghosttexter.de','gishpuppy.com','golfilla.info','gorillaswithdirtyarmpits.com','greensloth.com','guerrillamail.com','guerrillamail.net','h8s.org','haltospam.com','hatespam.org','hidemail.de','iheartspam.org','instig8.com','ipoo.org','jetable.com','jetable.net','jetable.org','kasmail.com','killmail.com','killmail.net','klassmaster.net','link2mail.net','loftmail.com','lortemail.dk','mail2rss.org','mail333.com','mailblocks.com','maileater.com','mailexpire.com','mailfreeonline.com','mailmoat.com','mailnull.com','mailshell.com','mailsiphon.com','mailzilla.com','meinspamschutz.de','messagebeamer.de','mintemail.com','myspamless.com','mytrashmail.com','neomailbox.com','nervmich.net','nervtmich.net','netmails.com','netmails.net','netzidiot.de','nobulk.com','noclickemail.com','nospamfor.us','nurfuerspam.de','oneoffemail.com','oopi.org','outlawspam.com','pancakemail.com','poofy.org','pookmail.com','privacy.net','punkass.com','put2.net','regbypass.com','rejectmail.com','safersignup.de','senseless-entertainment.com','shortmail.net','sibmail.com','slaskpost.se','sneakemail.com','sofort-mail.de','spam.la','spamavert.com','spambob.com','spambob.net','spambob.org','spambox.us','spambox.info','spamcon.org','spamday.com','spamex.com','spamfree24.com','spamfree24.net','spamfree24.org','spamgourmet.com','spamhole.com','spamify.com','spaminator.de','spamslicer.com','spaml.com','spammotel.com','spamoff.de','spamtrail.com','tailflames.com','tempemail.net','tempinbox.com','temporarily.de','temporaryforward.com','temporaryforwarding.com','temporaryinbox.com','throwaway.de','trashmail.com','trashmail.net','trashmail.org','trashmail.de','trash-mail.de','twinmail.de','ubuntwo.com','venompen.com','wegwerfadresse.de','wh4f.org','willselfdestruct.com','woodyland.org','wuzup.net','wuzupmail.net','wwwnew.eu','mx0.wwwnew.eu','bodhi.lawlita.com','xemaps.com','xents.com','xmaily.com','yep.it','yopmail.com','zoemail.org','fakeinformation.com','fastacura.com','fastchevy.com','fastchrysler.com','fastkawasaki.com','fastmazda.com','fastmitsubishi.com','fastnissan.com','fastsubaru.com','fastsuzuki.com','fasttoyota.com','fastyamaha.com','fuckingduh.com','fux0ringduh.com','klassmaster.com','mailin8r.com','mailinator.com','mailinator.net','mailinater.com','mailinator2.com','sogetthis.com','675hosting.com','675hosting.net','675hosting.org','75hosting.com','75hosting.net','75hosting.org','ajaxapp.net','amiri.net','amiriindustries.com','emailmiser.com','etranquil.com','etranquil.net','etranquil.org','gowikibooks.com','gowikicampus.com','gowikicars.com','gowikifilms.com','gowikigames.com','gowikimusic.com','gowikinetwork.com','gowikitravel.com','gowikitv.com','iwi.net','myspaceinc.com','myspaceinc.net','myspaceinc.org','myspacepimpedup.com','ourklips.com','pimpedupmyspace.com','rklips.com','turual.com','upliftnow.com','uplipht.com','viditag.com','viewcastmedia.com','viewcastmedia.net','viewcastmedia.org','wetrainbayarea.com','wetrainbayarea.org','xagloo.com' ); sErr = ''; if (sEmail.indexOf("@") > 0) { var domain = sEmail.substr(sEmail.indexOf("@") + 1,500); for ( var sK in hDomainList) { if (hDomainList[sK] == domain) { sErr += "In accordance with our Terms and Conditions, we do not accept so-called disposable e-mail addresses for registration with our site. We offer a full explanation for our decision on our Frequently Asked Questions page. We never spam our members and your privacy is always our primary concern. We encourage you to join our site with your real e-mail address. Thanks!\n"; } } } var filter=/^([\w-\+]+(?:\.[\w-\+]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i; if (sEmail.length > 32) { sErr += "Your email must be 32 characters or less.\n"; } else if (filter.test(sEmail) == false) { sErr += "Invalid email address. Please enter your own personal valid e-mail address in the form of user@domain.com to continue.\n"; } else if (sEmail.indexOf("@domain.com") > -1) { sErr += "You need to enter your own personal email address.\n"; } else if (sEmail.substring(0,4) == "www.") { if (confirm("Are you sure the name " + sEmail + " is correct? It might be just " + sEmail.substring(4,999) + ". You should probably remove the WWW before proceeding, so please hit Cancel and re-enter the correct email.") != true) return true;
 } else if (sEmail.substr(sEmail.length - 3, 3) == ".co") { if (confirm("Are you sure the email should end in .co? If you meant .com, hit 'cancel' and fix before submitting.") != true) return true; } if(sErr ) { return sErr; } else { return 0; }}

// js_build_core: js/MfcChannelMembers.js
 
 function MfcChannelMembers(hConfig ){ "use strict"; hConfig = hConfig || {}; var _config = {}; var _nBatchJoin = null; var _bBatchJoin = false; var _nBatchTimer = null; var _nGuestCount = 0; var _nRoomCount = 0; var _UserCount_Throttle = null; var _nChannelOwnerId = 0; var _hSelf = {}; var _aInsertUserQueue = []; var _aTopTippers = []; var _bUseSet = !!(function(w){ try { return ( typeof(w.Set) === 'function' && typeof(w.Set.prototype) === 'object' && typeof(w.Set.prototype.forEach) === 'function' && typeof(w.Set.prototype.add) === 'function' && typeof(w.Set.prototype.delete) === 'function' && typeof(w.Set.prototype.clear) === 'function' ); } catch(e) { return false; } })(window); var _aJoinOrder; var _bJoinOrderLock = false; this._ResetJoinOrder = function() { if(_bUseSet ) { if ( _aJoinOrder && typeof(_aJoinOrder.clear) === 'function' ) { _aJoinOrder.clear(); } else { _aJoinOrder = new Set(); } } else { _aJoinOrder = []; } };
 this._ResetJoinOrder(); this.hPeople = {}; this.UserCount_RapidCalls = 0; this.InsertUser_RapidCalls = 0; this.InsertUser_BatchDetected = false; if(MfcChannelMembers.nObjectId == undefined ) MfcChannelMembers.nObjectId = 0; var _nObjectId = MfcChannelMembers.nObjectId++; var _aContainerNames = [ 'model', 'vmodel', 'admin', 'friends', 'top_tippers', 'premium', 'registered', 'named_guest', 'guest' ]; var _hAlphaOffset = { a: 0, b: 0.0684, c: 0.14250, d: 0.1965, e: 0.2562, f: 0.27909, g: 0.3112, h: 0.3455, i: 0.3853, j: 0.4069, k: 0.4748, l: 0.514, m: 0.5625, n: 0.6404, o: 0.66989, p: 0.68339, q: 0.72679, r: 0.73049, s: 0.77799, t: 0.87579, u: 0.92719, v: 0.93409, w: 0.94829, x: 0.968, y: 0.978, 
 z: 0.9898 }; this.UpdateConfig = function(hConfig ) { for(var obj in hConfig ) { _config[obj] = hConfig[obj]; } if(hConfig.channel_owner_id ) _nChannelOwnerId = hConfig.channel_owner_id; if(hConfig.self_id ) _hSelf = _config.user_lookup(hConfig.self_id ); if(! _config.set_html && ! hConfig.set_html )HTML = sContents; }; if(! _config.get_el_by_id && ! hConfig.get_el_by_id ) _config.get_el_by_id = document.getElementById; }; this.UpdateConfig(hConfig ); this.PlaceContainingDivs = function() { var sHtml = ''; for(var a=0; a<_aContainerNames.length; a++ ) sHtml += "<div class=people_contents_" + _aContainerNames[a] + " id=people_contents_" + _aContainerNames[a] + "_" + _nObjectId + "></div>\n"; _config.set_html(_config.people_contents_element_id, sHtml ); if(_config.debug ) { for(var a=0; a<_aContainerNames.length; a++ ) { var oListSection = _config.get_el_by_id("people_contents_" + _aContainerNames[a] + "_" + _nObjectId ); var oHeader = document.createElement('div'); oListSection.id.match(/people_contents_(.*)_\d/); oHeader.innerHTML = "<span style='font-size:10px;background-color:yellow;'>" + RegExp.$1 + "</span>"; oListSection.parentNode.insertBefore(oHeader,oListSection); oListSection.style.border = "1px dashed gray"; } } }; this.PlaceFriendsTippers = function() { var oLists = _config.get_el_by_id(_config.people_contents_element_id );
 var nFriends, nTippers; for(var a=0; a<oLists.children.length; a++ ) { var oSection = oLists.children[a]; if(oSection.id && oSection.id.indexOf('people_contents_friends') == 0 ) { nFriends = a; } if(oSection.id && oSection.id.indexOf('people_contents_top_tippers') == 0 ) { nTippers = a; } } if(nFriends != undefined && nTippers != undefined ) { if(_config.debug && _hSelf.room_list_tippers_first == 1 ) oLists.insertBefore(oLists.children[nTippers-1], oLists.children[nFriends-1] ); else if(_config.debug && nFriends > nTippers ) oLists.insertBefore(oLists.children[nFriends-1], oLists.children[nTippers-1] ); if(_hSelf.room_list_tippers_first == 1 ) oLists.insertBefore(oLists.children[nTippers], oLists.children[nFriends] ); else if(nFriends > nTippers ) oLists.insertBefore(oLists.children[nFriends], oLists.children[nTippers] ); } }; this.Signal_BatchJoin_Initiating = function() { this.debug('Signal_BatchJoin_Initiating'); _bBatchJoin = true; if(this.EnvironmentCheck() ) _config.get_el_by_id(_config.people_contents_element_id ).style.display = 'none'; if(_nBatchTimer ) clearTimeout(_nBatchTimer ); _nBatchTimer = setTimeout(() => { this.Signal_BatchJoin_Complete(); }, 5000 ); }; this.Signal_BatchJoin_Complete = function() { this.debug('Signal_BatchJoin_Complete'); _bBatchJoin = false; if(this.EnvironmentCheck() ) _config.get_el_by_id(_config.people_contents_element_id ).style.display = 'block'; this.UpdateUserCountDisplay('force'); }; this.EnvironmentCheck = function() {
 if(! _config.get_el_by_id(_config.people_contents_element_id ) ) { this.debug("EnvironmentCheck Failed, people_contents_element_id doesn't exist"); return false; } return true; }; this.processTipperBox = function(aTippers ) { if(typeof(aTippers) == 'object' ) { this.SetTopTippers(aTippers ); } for(var a=0, len = _aTopTippers.length; a < len; a++ ) { var nUserId = _aTopTippers[a]; if(this.hPeople[ nUserId ] ) { var hUser = _config.user_lookup(nUserId ); if(hUser ) { this.InsertUser_Execute(hUser, { type: 'top_tippers' } ); } } } }; var _hStatus; this.processHighTippers = function(hStatus ) { _hStatus = hStatus || _hStatus || {}; var hRoomOwner = _config.user_lookup(_nChannelOwnerId ); if(! hRoomOwner ) { return; } var aCycleUsers=[], hUser, nUserId, bRefresh = false; if(typeof(_hStatus.c_emoji ) != 'undefined' && hRoomOwner.c_emoji != _hStatus.c_emoji ) { hRoomOwner.c_emoji = _hStatus.c_emoji; bRefresh = true; } if(typeof(_hStatus.s_emoji ) != 'undefined' && hRoomOwner.s_emoji != _hStatus.s_emoji ) { hRoomOwner.s_emoji = _hStatus.s_emoji; bRefresh = true; }
 if(typeof(_hStatus.c_hightipper ) == 'object' ) { if(hRoomOwner.c_hightipper && hRoomOwner.c_hightipper.uid != _hStatus.c_hightipper.uid ) aCycleUsers.push(hRoomOwner.c_hightipper.uid ); hRoomOwner.c_hightipper = _hStatus.c_hightipper; aCycleUsers.push(hRoomOwner.c_hightipper.uid ); } if(typeof(_hStatus.s_hightipper ) == 'object' ) { if(hRoomOwner.s_hightipper && hRoomOwner.s_hightipper.uid != _hStatus.s_hightipper.uid ) aCycleUsers.push(hRoomOwner.s_hightipper.uid ); hRoomOwner.s_hightipper = _hStatus.s_hightipper; aCycleUsers.push(hRoomOwner.s_hightipper.uid ); } if(bRefresh ) { this.RefreshHTML(); } else if(aCycleUsers.length ) { for(var a=0; a < aCycleUsers.length; a++ ) { nUserId = aCycleUsers[a]; if(nUserId > 0 && (hUser = _config.user_lookup(nUserId )) ) { this.InsertUser_Execute(hUser, { type: 'top_tippers' } ); } } } }; this.Reset = function(hConfig ) { hConfig = hConfig || {}; this.debug('Reset'); this.UpdateConfig(hConfig ); this._ResetJoinOrder(); this.hPeople = {}; _nGuestCount = 0; _aTopTippers = [];
 var hUser = _config.user_lookup(_nChannelOwnerId ); _nRoomCount = 0; this.InsertUser_RapidCalls = 0; _config.set_html(_config.people_contents_element_id, '' ); this.UpdateUserCountDisplay('force'); _hStatus = {}; }; this.DrawUserEntry = function(hUser, sType ) { var sHtml=''; if(! sType ) { sType = this.GetUserType(hUser ); } if(hUser['access_level'] > 0 && hUser['active'] ) sHtml += _config.avatar_html(hUser ) || ''; sHtml += "<span "; if(_config.extra_tag_content && typeof(_config.extra_tag_content) == 'function' ) sHtml += _config.extra_tag_content(hUser); if(hUser['access_level'] > 0 && _config.member_html ) sHtml += " class='people_"+sType+"'>" + _config.member_html(hUser ) + "</span>"; else if(_config.guest_html ) sHtml += " class='people_"+sType+"'>" + _config.guest_html(hUser ) + "</span>"; else sHtml += " class='people_"+sType+"'>" + hUser.username + "</span>"; if(hUser['share_badges'] && hUser['share_badges'][_nChannelOwnerId] ) sHtml += _config.share_badges_html(hUser ) || ''; if(hUser['camserv'] && hUser['camserv'] > 0 && _config.webcam_icon_html ) sHtml += _config.webcam_icon_html(hUser ) || ''; if(hUser.notes && _config.notes_icon_html ) sHtml += _config.notes_icon_html(hUser ) || ''; if(this.isHighestTipper(hUser,'c') && _config.cumulative_highest_tipper_emoji_html ) sHtml += _config.cumulative_highest_tipper_emoji_html(hUser ) || ''; if(this.isHighestTipper(hUser,'s') && _config.single_highest_tipper_emoji_html ) sHtml += _config.single_highest_tipper_emoji_html(hUser ) || ''; return sHtml;
 }; this.isHighestTipper = function(hUser, sType ) { if(typeof(hUser) != 'object' ) { return false; } var hModel = _config.user_lookup(_nChannelOwnerId ); if(typeof(hModel) != 'object' ) { return false; } return hModel[sType+'_hightipper'] && hModel[sType+'_hightipper'].uid == hUser.user_id; }; th"_" + _nObjectId; }; this.InsertUser = function(hUser, hOptions ) { if(_bBatchJoin && hUser && hUser.access_level > 0 ) this.InsertUser_Execute(hUser, hOptions ); else this.InsertUser_Throttled(hUser, hOptions ); }; this.InsertUser_Throttled = function(hUser, hOptions ) { if(hUser ) _aInsertUserQueue.push([ hUser, hOptions ] ); if(FnRateLimit('MfcChannelMembers.InsertUhUser, hOptions); }) ) { return; } if(! hUser ) { this.debug('InsertUser Flush Queue'); } for(var a=0; a<_aInsertUserQueue.length; a++ ) this.InsertUser_Execute(_aInsertUserQueue[a][0], _aInsertUserQueue[a][1] ); _aInsertUserQueue = []; if(_bBatchJoin && this.InsertUser_BatchDetected ) { this.Signal_BatchJoin_Complete(); this.InsertUser_BatchDetected = false; } }; this.InsertUser_Execute = function(hUser, hOptions ) { hOptions = hOptions || {}; if(! hUser || ! hUser.user_id ) { return; } if(! _bJoinOrderLock ) { this._AddJoinOrder(hUser.user_id ); } if(hOptions.type == 'top_tippers' && _hSelf.room_list_tippers_first != 2 && ! _aTopTippers.indexOf(hUser.user_id ) > -1 ) { _aTopTippers.push(hUser.user_id ); } if(! this.hPeople[ hUser.user_id ] ) { this.hPeople[ hUser.user_id ] = {}; } this.hPeople[ hUser.user_id ].user = hUser; this.hPeople[ hUser.user_id ].options = hOptions; if(! this.EnvironmentCheck() ) { return; } var sType = this.GetUserType(hUser); var oListSection = _config.get_el_by_id('people_contents_' + sType + '_' + _nObjectId ); if(! oListSection ) { this.PlaceContainingDivs(); this.PlaceFriendsTippers(); oListSection = _config.get_el_by_id('people_contents_' + sType + '_' + _nObjectId );
 } if(! oListSection ) { return; } this.debug('InsertUser_Execute ' + hUser.username ); var oUserEntry; if(! ( oUserEntry = document.getElementById(this.GetUserEntryId(hUser.user_id) ) ) ) { _nRoomCount++; oUserEntry = document.createElement('div'); oUserEntry.id = this.GetUserEntryId(hUser.user_id); oUserEntry.className = "people init people_" + sType + " people_u" + hUser.user_id; oUserEntry.setAttribute('data-sort_key', hUser.username.toLowerCase()); oUserEntry.setAttribute('data-user_id', hUser.user_id); oUserEntry.innerHTML = this.DrawUserEntry(hUser, 'insert_person'); },0); } else { oUserEntry.className = "people insert_person people_" + sType + " people_u" + hUser.user_id; oUserEntry.innerHTML = this.DrawUserEntry(hUser, sType ); if(oListSection.contains(oUserEntry) ) { return; } } if(hOptions.prepend ) { if(oListSection.firstChild ) oListSection.insertBefore(oUserEntry, oListSection.firstChild ); else oListSection.appendChild(oUserEntry ); } else if(hOptions.append || ( sType == 'top_tippers' && _hSelf.room_list_tippers_first != 2 ) || ! _hSelf.room_list_alpha_sort ) { oListSection.appendChild(oUserEntry ); } else { var nPlaced = 0; var sUsernameLcase = hUser.username.toLowerCase();
 var nOffset = 0; if(_hAlphaOffset[ sUsernameLcase.charAt(0) ] ) nOffset = Math.floor(oListSection.children.length * _hAlphaOffset[ sUsernameLcase.charAt(0) ] ); var getSortKey = function(oListSection, a ) { if(oListSection.children && oListSection.children[a] ) return oListSection.children[a].getAttribute('data-sort_key'); else return null; }; if(oListSection.children.length == 0 ) { oListSection.appendChild(oUserEntry ); } else { var sKey = getSortKey(oListSection,nOffset); if(sUsernameLcase > sKey ) { for(var a=nOffset; a<=oListSection.children.length; a++ ) { if(a == oListSection.children.length ) { oListSection.appendChild(oUserEntry ); break; } sKey = getSortKey(oListSection,a); if(sKey && sKey > sUsernameLcase ) { oListSection.children[a].parentNode.insertBefore(oUserEntry,oListSection.children[a]); nPlaced = 1; break; } } } else { for(var a = nOffset+1; a>=-1; a-- ) { if(a == -1 ) {
 oListSection.insertBefore(oUserEntry, oListSection.firstChild ); break; } sKey = getSortKey(oListSection,a); if(sKey && sKey < sUsernameLcase ) { oListSection.children[a].parentNode.insertBefore(oUserEntry, oListSection.children[a].nextSibling ); nPlaced = 1; break; } } } } } this.UpdateUserCountDisplay(); this.HideRevealContainers(); }; this.HideRevealContainers = function(sMode ) { for(var a=0; a<_aContainerNames.length; a++ ) { var oListSection = _config.get_el_by_id("people_contents_" + _aContainerNames[a] + "_" + _nObjectId ); if(oListSection && oListSection.children ) oListSection.style.display = oListSection.children.length > 0 ? 'block' : 'none'; } }; this.UpdateUserCountDisplay = function(sMode ) { if(! _config.get_el_by_id(_config.people_count_element_id ) ) return; if(FnRateLimit('MfcChannelMembers.UpdateUserCountDisplay',1000, () => { this.UpdateUserCountDisplay(sMode); }) ) { return; } var sRoomCount = ''; if(_nRoomCount > 0 ) sRoomCount = ( _nRoomCount + ( _nGuestCount || 0 ) ); if(sRoomCount > 999 ) sRoomCount = "<span style=font-size:10px;>" + sRoomCount + "</span>"; if(typeof(sRoomCount ) == 'number' ) sRoomCount = sRoomCount.toString(); this.debug('UpdateUserCountDisplay: set room count to ' + sRoomCount );
 _config.set_html(_config.people_count_element_id, sRoomCount ); this.UpdateGuestCountDisplay(); }; this.RefreshHTML = function() { var hPeopleCopy = {}; for(var nUserId in this.hPeople ) { hPeopleCopy[ nUserId ] = this.hPeople[ nUserId ]; } this.hPeople = {}; _nRoomCount = 0; _config.set_html(_config.people_contents_element_id, '' ); this.UpdateUserCountDisplay('force'); _bJoinOrderLock = true; var fInsertUser = (nUserId) => { if(hPeopleCopy[ nUserId ] ) { this.InsertUser(hPeopleCopy[ nUserId ].user, hPeopleCopy[ nUserId ].options ); } }; if(_bUseSet ) { _aJoinOrder.forEach(fInsertUser); } else { for(var a=0,nLen=_aJoinOrder.length; a < nLen; a++ ) { fInsertUser(_aJoinOrder[a] ); } } _bJoinOrderLock = false; }; this.UpdateGuestCountDisplay = function() { if(! _config.get_el_by_id('people_contents_guest_' + _nObjectId ) ) return; if(_nGuestCount ) _config.set_html('people_contents_guest_' + _nObjectId, " <div class=channel_members_guest_count>(" + _nGuestCount + " Guests)</div>" ); else _config.set_html('people_contents_guest_' + _nObjectId , '' );
 }; this.RemoveUser = function(nUserId ) { if(! nUserId ) { return; } if(this.hPeople[ nUserId ] ) { delete this.hPeople[ nUserId ]; } _nRoomCount--; this._RemoveJoinOrder(nUserId ); var aoUsers = document.getElementsByClassName('people_u' + nUserId ); for(var n=0; n < aoUsers.length; n++ ) { var oUserEntry = aoUsers[n]; if(! oUserEntry ) { continue; } this.debug('RemoveUser ' + nUserId ); oUserEntry.classList.remove('insert_person'); oUserEntry.classList.add('remove_person'); } setTimeout(() => { var aoUsers = document.getElementsByClassName('people_u' + nUserId ); for(var n=0; n < aoUsers.length; n++ ) { if(oUserEntry && oUserEntry.parentNode ) oUserEntry.parentNode.removeChild(oUserEntry); } },300); this.UpdateUserCountDisplay(); }; this.GetUserType = function(hUser ) { var sType; switch(parseInt(hUser['access_level'] ) ) { case 5: sType = "admin"; break; case 4: sType = "model"; break; case 2: sType = "premium"; break; case 1: sType = "registered"; break; case 0: sType = "guest"; break; } 
 if(sType == 'guest' && hUser && hUser['username'] && ! hUser['username'].match(/Guest\d+/) ) { sType = 'named_guest'; } if(sType == "model" && _nChannelOwnerId != hUser.user_id ) sType = "vmodel"; if(hUser && _aTopTippers && hUser.user_id && ( _aTopTippers.indexOf && _aTopTippers.indexOf(parseInt(hUser.user_id ) ) > -1 ) && _hSelf.room_list_tippers_first != 2 ) { sType = "top_tippers"; } else if(hUser['friend'] && hUser['access_level'] != 4 ) { sType = 'friends'; } return sType; }; tppers = aTippers; }; this.SetGuestCount = function(nCount ) { this.debug('SetGuestCount: ' + nCount ); if(_bBatchJoin ) { this.Signal_BatchJoin_Complete(); } _nGuestCount = parseInt(nCount ); this.UpdateUserCountDisplay('force'); }; this.debug = function(sMsg ) { if(! _config.debug ) return;
 sMsg = 'MfcChannelMembers: ' + sMsg; if(_config.debug_output_handler ) { _config.debug_output_handler(sMsg ); } else if(window.console && console.log ) { console.log(sMsg ); } }; t.push(nUserId); } }; this._RemoveJoinOrder = function(nUserId ) { if(_bUseSet ) { _aJoinOrder.delete(nUserId); } else if(_aJoinOrder.indexOf ) { var nIndex = _aJoinOrder.indexOf(nUserId); if(nIndex !== -1 ) { _aJoinOrder.splice(nIndex, 1); } } };};

// js_build_core: js/Tags.js
function Tags(hSettings ){ this.sDisplayStyle = 'list'; this.sShowExtra = 'tags'; this.bHighCamScore = true; this.sWordSource = 'tags'; this.MatchingTags = 0; this.bStandAlone = 0; this.sTagSort = ''; this.aField = new Array(); this.aTags = new Array(); this.aTagValues = new Array(); this.nLimitPerPage = 50; this.oTagReq = null; this.oLogReq = null; this.oModelReq = null; this.nCurrentPage = 1; this.bMemberMode = 0; this.sSelectedField = ''; this.sStyleOverride = ''; this.sSearch = ''; this.hBoolSearch = null; this.nSearchTimer = null; this.fUpdatePresentation = function(){}; this.fLoadTagsDisplay = function(){}; this.fUnloadTagsDisplay = function(){}; this.hOptions= { selected_field: { val: '' }, sort: { val: '' } }; this.Set(hSettings ); this.bNightMode = location.search.indexOf('night_mode=1') > -1 || ( NightMode && NightMode.enabled ); if(! Tags.nRegisterId ) { Tags.nRegisterId = 0; } this.nRegisterId = Tags.nRegisterId++; Tags.aRegister[ this.nRegisterId ] = this;};Tags.aRegister = [];T= hSettings[sK]; }};Tags.prototype.SelectTag = function(sKey, sValue ){
 var oEl; if(this.sWordSource == 'topics' && ( oEl = GetEl('tags_content') ) ) { var nTarget = Tags.cumulativeOffset(oEl ).top - 100; var nIncrements = parseInt(( nTarget - document.body.scrollTop ) / 4 ); var nCurrTop = document.body.scrollTop; if(Math.abs(nTarget - nCurrTop ) > ( window.innerHeight * 0.8 ) ) { setTimeout(function() { window.scroll(0, nCurrTop + nIncrements ); } , 40 ); setTimeout(function() { window.scroll(0, nCurrTop + ( nIncrements * 2 ) ); } , 80 ); setTimeout(function() { window.scroll(0, nCurrTop + ( nIncrements * 3 ) ); } , 120 ); setTimeout(function() { window.scroll(0, nCurrTop + ( nIncrements * 4 ) ); } , 160 ); } } if(sKey == 'next' ) { sKey = 'selected_field'; for(var a=0; a < this.aField.length; a++ ) { if(this.sSelectedField == this.aField[a] && a != this.aField.length ) { sValue = this.aField[a+1]; break; } } } else if(sKey == 'previous' ) { sKey = 'selected_field'; for(var a=this.aField.length; a > 0; a-- ) { if(this.sSelectedField == this.aField[a] && a != 0 ) { sValue = this.aField[a-1]; break; } } } SetHTML('tags_content', "<span style='color:#aaaaaa;font-size:19px;'><b>Loading...</b></span>" ); this.Select(sKey, sValue ); this.LoadSelection();};Tags.cumulativeOffset = function(element)
{ var top = 0, left = 0; do { top += element.offsetTop || 0; left += element.offsetLeft || 0; element = element.offsetParent; } while(element); return { top: top, left: left };};Tags.prototype.Select = function(sKey, sValue ){ this.nCurrentPage = 1; if(sValue ) { this.hOptions[sKey]['val'] = sValue; } var sRetainBGColor; if(this.hOptions[sKey]['previous_val'] != this.hOptions[sKey]['val'] ) { var oEl = GetEl(sKey + '_' + this.hOptions[sKey]['previous_val'] ); if(oEl ) oEl.classList.remove('highlight_bg'); } var oEl = GetEl(sKey + '_' + this.hOptions[sKey]['val'] ); if(oEl ) { sRetainBGColor = oEl.style.backgroundColor; oEl.classList.add('highlight_bg'); if(oEl.offsetTop ); { var oContainer = GetEl('tags_scroll'); if(oContainer ) { var nNew = oEl.offsetTop - Math.round(oContainer.offsetHeight / 2 ); if(Math.abs(oContainer.scrollTop - nNew ) > 500 ) { oContainer.scrollTop = nNew; } } } } this.hOptions[sKey]['previous_val'] = this.hOptions[sKey]['val']; this.sRetainBGColor = sRetainBGColor;};Tags.prototype.LoadTags = function()
{ if(this.oTagReq == null ) { this.oTagReq = createRequestObject(); } var sQueryString = "?get_tags=1&tag_sort=" + this.sTagSort + "&word_source=" + this.sWordSource + "&display_style=" + this.sDisplayStyle + "&member_mode=" + this.bMemberMode + "&style_override=" + this.sStyleOverride + "&night_mode=" + ( this.bNightMode ? 1 : 0 ) + "&" + Math.random(); if(this.hBoolSearch ) sQueryString += '&json_search_spec=' + encodeURIComponent(JSON.stringify(this.hBoolSearch ) ); this.oTagReq.open("get","../php/model_tags.php" + sQueryString ); this.oTagReq.onreadystatechange = () => { this.LoadTagsResponse(); }; this.oTagReq.send(null);};Tags.prototype.LoadTagsResponse = function(){ if(this.oTagReq.readyState != 4) { return; } var hRes = JSON.parse(this.oTagReq.responseText); if(typeof hRes != 'object' ) { return; } this.aField = hRes.field; this.aTags = hRes.tags; this.aTagValues = hRes.tag_values; this.hHighCamScore = hRes.high_cam_score; this.hWordCount = hRes.word_count; clearTimeout(this.nSearchTimer); this.nSearchis.RefineTags(); },100);};Tags.prototype.LoadSelection = function(hOptions ){ hOptions = hOptions || {}; if(this.oModelReq == null ) { this.oModelReq = createRequestObject(); } var sQueryString = "?get_users=1&selected_field=" + this.hOptions.selected_field.val + "&display_style=" + this.sDisplayStyle + "&word_source=" + this.sWordSource + "&member_mode=" + this.bMemberMode + "&style_override=" + this.sStyleOverride + "&sort=" + this.hOptions.sort.val + "&page=" + this.nCurrentPage + "&stand_alone=" + this.bStandAlone + "&night_mode=" + ( this.bNightMode ? 1 : 0 )
 + "&" + Math.random(); if(this.sSearch && this.sWordSource == 'topics' ) sQueryString += '&search=' + this.sSearch; if(this.hBoolSearch ) sQueryString += '&json_search_spec=' + encodeURIComponent(JSON.stringify(this.hBoolSearch ) ); this.oModelReq.open("get","../php/model_tags.php" + sQueryString ); this.oModelReq.osponse(hOptions); }; this.oModelReq.send(null);};Tags.prototype.LoadSelectionResponse = function(hOptions ){ hOptions = hOptions || {}; if(this.oModelReq.readyState != 4) { return; } var hRes = JSON.parse(this.oModelReq.responseText); if(typeof hRes != 'object' ) { return; } this.hSelectionResponse = hRes; this.DrawSelection(hOptions ); setTimeout(() => { var el = GetEl('selected_field_' + this.hOptions.selected_field.val ); if(el ) { el.classList.add('highlight_bg'); } },10);};Tags.prototype.DrawSelection = function(hOptions ){ var aList = new Array(); var aListOrder = new Array(); var nRows; var sTagsContentLabel = ''; var hRes = this.hSelectionResponse; this.sSelectedField = hRes.selected_field; nRows = hRes.rows; aListOrder = hRes.list_order; aList = hRes.list; var aTagsContent = new Array(); for(var nK=0; nK < nRows; nK++ ) {
 if(! aListOrder[nK] ) continue; var nUserId = aListOrder[nK]; var hUser; if(aList[nUserId] && t && t.g_hUsers && ( hUser = t.g_hUsers[nUserId] ) ) { var sItem = aList[nUserId].replace(/LIVESNAP/,'img src=' + t.LiveSnapUrl(nUserId,100)); sItem = sItem.replace(/<!-- POPUP_PLAYER -->/,t.A('player',{ 'broadcaster_id':nUserId, 'target':'new_window' })); sItem = sItem.replace(/<!-- PM -->.*<!-- \/PM -->/, t.A("pm_friend",{ 'user_id': nUserId, 'username': hUser['username'], 'load_video': true })); if(this.sShowExtra == 'topics' ) { var sTopic = ''; if(hUser.topic ) { sTopic = hUser.topic.replace(/(\S){50,}/,"$1 "); sTopic = "<span style=\"" + MfcCustomFonts.prototype.get_style(hUser ) + "\">" + sTopic + "</span>"; } sItem = sItem.replace(/<!-- TOPICS -->/, sTopic ); } else { sItem = sItem.replace(/<!-- TAGS -->/, this.DrawTagField(hUser ) || '' ); } if(this.sStyleOverride == 'player' ) { if(hUser.state != FCS.FCVIDEO_TX_IDLE ) { continue; } sItem = sItem.replace(/POPUP_MENU_HANDLERS/, t.PopupPreview.getHandlerCode(nUserId) ); sItem = sItem.replace(/CAM_PREVIEW_HANDLER/," onMouseOver=MouseOverIcons.Over('tags" + nUserId + "'," + nUserId + "); onMouseOut=if(g_oDhtmlPopup.check_mouse_leave(this,event)){MouseOverIcons.Out(this);} "); sItem = sItem.replace(/<!-- CAM_PREVIEW_HTML -->/, MouseOverIcons.DrawElement(('tags' + nUserId), nUserId ) ); } if(hUser.aTags && this.sWordSource != 'topics' ) { sItem = sItem.replace(/<!-- ALL_TAGS -->/,"<a href='javascript:popUserMenu.open_tags_in_popup(t.g_hUsers[" + nUserId + "],g_oDhtmlPopup);'>View All Tags</a>"); } if(sItem.match(/MODEL_ICON_(\d+)/) ) { var oRE = new RegExp('MODEL_ICON_' + RegExp.$1); sSrc = popUserMenu.people_icon(RegExp.$1 ); sItem = sItem.replace(oRE, sSrc ? ('<img height=16 src=' + sSrc + '>') : '' ); } aTagsContent.push(sItem ); } else if(( ! t || ! t.g_hUsers ) || ( t && t.g_hUsers && t.g_hUsers.access_level != 4 ) ) { sItem = aList[nUserId].replace(/MODEL_ICON_\d+/,''); sItem = sItem.replace(/<!-- PM -->.*<!-- \/PM -->/, t.A("pm_friend",{ user_id: nUserId })); aTagsContent.push(sItem); } } if(this.sSelectedField && ! this.sSearch ) { if(this.sStyleOverride == 'player' ) { sTagsContentLabel = '<span style=font-size:17px;>Online ' + ( this.bMemberMode ? 'members' : 'models' ) + ( this.sWordSource == 'topics' ? ' with topics containing ' : ' tagged ' ) + '<span style="font-size:15px;font-weight:bold;">"' + this.sSelectedField + '"</span></span><br><br>'; } else { sTagsContentLabel = '<br><span style=padding:3px;font-size:17px; id=content_header>Online ' + ( this.bMemberMode ? 'members' : 'models' ) + ( this.sWordSource == 'topics' ? ' with topics containing ' : ' tagged ' ) + '<span style="font-size:20px;font-weight:bold;">"' + this.sSelectedField + '"</span>' + '</span><br><br>'; } if(aTagsContent.length == 0 ) { if(this.bMemberMode ) aTagsContent.push('<td style=color:#666666;><br><br>No online members found.</a></td>'); else aTagsContent.push('<td style=color:#666666;><br><br>This " + ( t && t.g_hPlatform && t.g_hPlatform.performer ) + " has logged off. Please re-load the " + ( t && t.g_hPlatform && t.g_hPlatform.Performer ) + " Tags page for an updated list of tags for online " + ( t && t.g_hPlatform && t.g_hPlatform.performer ) + ".<br><br><a href=# onClick=window.location.reload();>Reload</a></td>'); }
 } else if(this.sSearch ) { sTagsContentLabel = "<div></div>"; } if(this.sStyleOverride != 'player' ) { if(this.bMemberMode ) { aTagsContent.splice(0,0,"<table>"); } else { aTagsContent.splice(0,0," <table> <tr> <td style=color:grey;font-size:10px;> <span style=\"display: inline-block;width:108px;\">Avatar</span> <span style=\"\">Cam Preview</span> </td> <td></td> </tr> "); } aTagsContent.push("</table>"); } if(this.fUpdatePresentation ) { this.fUpdatePresentation({ sTagsContentLabel: sTagsContentLabel, aTagsContent: aTagsContent, aListOrder: aListOrder }); }};Tags.prototype.DrawTagField = function(hUser ){ var sContent = ''; if(! hUser.aTags ) { return ''; } var aTags=[]; var nCount=0; for(var n=0; n<hUser.aTags.length; n++ ) { if(t && t.FcTags && t.FcTags.hTagCounts && t.FcTags.hTagCounts[ hUser.aTags[n].toLowerCase() ] > 1 ) { nCount++; var sTag = hUser.aTags[n].toLowerCase(); aTags.push("<a href=\"javascript:Tags.aRegister["+ this.nRegisterId +"].SelectTag('selected_field','" + sTag + "');\">" + sTag + "</a>"); } else { aTags.push("<span style='text-decoration:underline;'>" + hUser.aTags[n].toLowerCase() + "</span>"); } } return aTags.join(', ');};Tags.prototype.LogSearch = function(){ if(this.sSearch.length < 2 ) return; location.href.match(/files\/\w+\/(\w+)/); if(this.oLogReq == null ) { this.oLogReq = createRequestObject(); } this.oLogReq.open("get","../php/model_tags.php?log_search=1&query=" + this.sSearch + "&" + Math.random() ); this.oLogReq.send(null);};Tags.prototype.RefineTags = function(sMode ){ var sTagsIndexLabel=''; if(this.sSearch ) sTagsIndexLabel = "Topic words containing \"" + this.sSearch.replace(/\W/,'') + "\":"; var sFirstTag=''; var aTagsIndex = new Array(); if(this.sSearch || this.hBoolSearch ) { SetHTML('clear_search',"<a href=# onClick=Tags.aRegister["+ this.nRegisterId +"].TagSearch('clear'); class=highlight_fgbg >Clear</a>"); var sFirstMatch; if(sMode == 'update' ) sFirstMatch = this.hOptions.selected_field.val; var aSearchTerms=[]; if(this.hBoolSearch && this.hBoolSearch.words ) {
 aSearchTerms = this.hBoolSearch.words; } else { aSearchTerms.push(this.sSearch.toLowerCase() ); } var hAntiDuplicate={}; for(var nK=0;nK<this.aTagValues.length;nK++) { for(var a=0; a < aSearchTerms.length; a++ ) { if(this.aTagValues && typeof(this.aTagValues[nK] ) == 'string' && this.aTagValues[nK].indexOf(aSearchTerms[a] ) > -1 ) { if(! sFirstMatch ) sFirstMatch = this.aTagValues[nK]; var sTmp = this.aTags[nK]; if(hAntiDuplicate[ sTmp ] ) { continue; } var oRegExp = new RegExp(">" + this.aTagValues[nK]); sTmp = sTmp.replace(oRegExp,">" + this.aTagValues[nK].replace(aSearchTerms[a],"<b>" + aSearchTerms[a] + "</b>") ); aTagsIndex.push(sTmp ); hAntiDuplicate[ sTmp ] = 1; } } this.MatchingTags = aTagsIndex.length; } if(aTagsIndex.length == 0 ) { SetHTML('tags_content',''); } else if(this.sWordSource == 'topics' ) { if(sMode == 'search' ) { this.LoadTags(); this.LoadSelection(); } } else { if(this.sStyleOverride == 'player' && typeof(this.fLoadTagsDisplay ) == 'function' )
 this.fLoadTagsDisplay(); this.SelectTag('selected_field',sFirstMatch); } } else if(this.sWordSource == 'topics' && this.bHighCamScore ) { for(var nK=0;nK<this.aTagValues.length;nK++) { var sTag = this.aTagValues[nK]; if(this.hHighCamScore[ sTag ] >= 3000 || this.hWordCount[ sTag ] > 1) { if(! sFirstTag ) { sFirstTag = sTag; } aTagsIndex.push(this.aTags[nK] ); } } } else if(this.sWordSource == 'topics' && ! this.bHighCamScore ) { for(var nK=0;nK<this.aTagValues.length;nK++) aTagsIndex.push(this.aTags[nK] ); } else { aTagsIndex = this.aTags; } if(! this.hOptions.selected_field.val ) this.SelectTag('selected_field', sFirstTag || this.aTagValues[0] ); if(this.fUpdatePresentation ) { this.fUpdatePresentation({ sTagsIndexLabel: sTagsIndexLabel, aTagsIndex: aTagsIndex }); } this.Select('selected_field',this.hOptions.selected_field.val); this.HighlightSelector();};Tags.prototype.HighlightSelector = function(sMode ){ if(this.sWordSource == 'topics' ) { var oEl_All = GetEl('all_words'); var oEl_Popular = GetEl('popular_words'); 
 if(oEl_All && oEl_Popular ) { oEl_All.classList.remove('highlight_fgbg'); oEl_Popular.classList.remove('highlight_fgbg'); if ( this.bHighCamScore ) { oEl_Popular.classList.add('highlight_fgbg'); } else { oEl_All.classList.add('highlight_fgbg'); } } }};Tags.prototype.TagSearch = function(search ){ var oEl = GetEl('tag_search'); if(search == 'clear' ) { oEl.value = ''; this.sSearch = ''; SetHTML('clear_search',''); } else if(oEl ) { this.sSearch = oEl.value; } else if(typeof(search ) == 'object' ) { this.hBoolSearch = search; this.sSearch = this.hBoolSearch.words.join(','); } else { this.sSearch = search; } clearTimeout(this.nSearchTimer); this.nSearcneTags('search'); } ,100);};Tags.prototype.DisplayMode = function(sDisplayStyle ){ if(sDisplayStyle ) { this.sDisplayStyle = sDisplayStyle; } var els = document.getElementsByClassName('display_style'); for(var a=0; a < els.length; a++ ) { els[a].classList.remove('highlight_fgbg'); } var oEl = GetEl('display_style_' + this.sDisplayStyle ); if(oEl ) { oEl.classList.add('highlight_fgbg'); } 
 this.LoadTags();};Tags.prototype.TagSort = function(sTagSort ){ this.sTagSort = sTagSort || 'cam_score'; aTypes = new Array('cam_score','tag','alphabetically','frequency'); for(var a=0;a<aTypes.length;a++) { var sSortType; var oEl = GetEl('sort_' + aTypes[a]); if(! oEl ) { continue; } if(aTypes[a] == this.sTagSort ) oEl.classList.add('highlight_fgbg'); else oEl.classList.remove('highlight_fgbg'); } this.LoadTags();};Tags.prototype.ShowExtra = function(sSource ){ this.sShowExtra = sSource; var oTags = GetEl('show_tags'); if(oTags ) { if ( sSource == 'tags' ) { oTags.classList.add('highlight_fgbg'); } else { oTags.classList.remove('highlight_fgbg'); } } var oTopics = GetEl('show_topics'); if(oTopics ) { if ( sSource == 'topics' ) { oTopics.classList.add('highlight_fgbg'); } else { oTopics.classList.remove('highlight_fgbg'); } } this.DrawSelection();};Tags.prototype.Load = function(){ for(var sK in this.hOptions ) { this.Select(sK ); }
 this.LoadTags(); if(! this.hOptions.selected_field.val && location.search.match(/selected_field=([%\w\s]+)/) ) { this.hOptions.selected_field.val = RegExp.$1; } if(this.bStandAlone == true ) { this.LoadSelection(); }};

// js_build_core: js/RoomHelpers.js
function RoomHelpers(params ){ this.ext = {}; this.ZBAN_enabled = 1; this.ext.mfcChatCommands = params.mfcChatCommands; this.ext.SendCommand = params.SendCommand; this.ext.GetPublicChannelId = params.GetPublicChannelId; this.ext.Display_EnableRoomHelper = params.Display_EnableRoomHelper; this.ext.Display_DisableRoomHelper = params.Display_DisableRoomHelper; this.ext.Display_ReceivedMessage = params.Display_ReceivedMessage; this.ext.HasHelperAuth = params.HasHelperAuth || function(){ return false; }; this.ext.GetUserByUsername = params.GetUserByUsername || function(){ return 0; }; this.ext.GetModelId = params.GetModelId || function(){ return 0; }; this.ext.GetMuteStatus = paration(){ return 0; }; this.ext.GetCountdownDataObj = params.Getion(){ return {}; };}RoomHelpers.p = params[ k ]; }
};RoomHelpers.prototype.UpdateExternals = function(){ Log('ROOMHELPER DBG: UpdateExternals called, this.ext.HasHelperAuth(): ' + this.ext.HasHelperAuth() ); if(this.ext.HasHelperAuth() ) { if(this.ext.Display_EnableRoomHelper ) { this.ext.Display_EnableRoomHelper(); } var self = this; if (this.ext.mfcChatCommands) { this.ext.mfcChatCommands.addHandler('topic', { handler: function(aArgs, hOptions ) { return self.Topic(aArgs, hOptions); }, description: RoomHelpers.HelpConfig['topic'].description, usage: RoomHelpers.HelpConfig['topic'].usage }); this.ext.mfcChatCommands.addHandler('ban', { handler: function(aArgs, hOptions ) { return self.Ban(aArgs, hOptions); }, options: { 'c': "Clear chat of user and ban them" }, description: RoomHelpers.HelpConfig['ban'].description, usage: RoomHelpers.HelpConfig['ban'].usage }); this.ext.mfcChatCommands.addHandler('unban', { handler: function(aArgs, hOptions ) { hOptions['unban']=true; return self.Ban(aArgs, hOptions); }, description: RoomHelpers.HelpConfig['unban'].description, usage: RoomHelpers.HelpConfig['unban'].usage }); this.ext.mfcChatCommands.addHandler('kick', { handler: function(aArgs, hOptions ) { hOptions['kick']=true; return self.Kick(aArgs, hOptions); }, description: RoomHelpers.HelpConfig['kick'].description, usage: RoomHelpers.HelpConfig['kick'].usage }); this.ext.mfcChatCommands.addHandler('mute', { handler: function(aArgs, hOptions ) { return self.Mute(aArgs, hOptions); }, options: { 'c': "Clear chat of user and ban them" }, description: RoomHelpers.HelpConfig['mute'].description, usage: RoomHelpers.HelpConfig['mute'].usage });
 this.ext.mfcChatCommands.addHandler('unmute', { handler: function(aArgs, hOptions ) { hOptions['unmute']=true; return self.muteUser(aArgs, hOptions); }, description: RoomHelpers.HelpConfig['unmute'].description, usage: RoomHelpers.HelpConfig['unmute'].usage }); this.ext.mfcChatCommands.addHandler('couaArgs, hOptions); }, shorthand: 'c', pass_bad_options: true, description: RoomHelpers.HelpConfig['countdown'].description, usage: RoomHelpers.HelpConfig['countdown'].usage }); } Log('ROOMHELPER DBG: UpdateExternals() authorized, set topic/ban/mute'); } else { if(this.ext.Display_DisableRoomHelper ) { this.ext.Display_DisableRoomHelper(); } if (this.ext.mfcChatCommands) { this.ext.mfcChatCommands.removeHandler('topic'); this.ext.mfcChatCommands.removeHandler('ban'); this.ext.mfcChatCommands.removeHandler('mute'); } Log('ROOMHELPER DBG: UpdateExternals() ! authorized, removed topic/ban/mute'); }};RoomHelpers.HelpConfig = { 'topic': { description: "Set topic for this room", usage: "/topic <i>new room topic</i>" }, 'ban': { description: "Ban a user from this room (they are not allowed to re-enter)", usage: "/ban <i>username</i>" }, 'unban': { description: "Unban a user from this room", usage: "/unban <i>username</i>" }, 'mute': { description: "Mute guests or basics in room.",
 usage: "/mute &lt;basic | guest&gt; &lt;on | off | show&gt;" }, 'unmute': { description: "Unmute a user from this room", usage: "/unmute <i>username</i>" }, 'countdown': { description: "Create, change or remove a Tip Countdown", usage: "/countdown &lt;total tokens | +add earned | -substract earned &gt;" }, 'kick': { description: "Kick a user from this room (they are allowed to re-enter)", usage: "/kick <i>username1</i> <i>username2</i> ..." }};RoomHelpers.prototype.HelpHTML = function(message ){ var aChatCommands = []; for(var sK in RoomHelpers.HelpConfig ) { aChatCommands.push(" <tr> <td class=command> <b>" + RoomHelpers.HelpConfig[sK].usage + "</b> </td> </tr> <tr> <td class=description> " + RoomHelpers.HelpConfig[sK].description + "</td> </tr> "); } var sHtml = " <div class=\"room_helper_container\"> Help the model manage her room with these additional privileges and commands:<br><br> <table class=\"room_helper_table\"> " + aChatCommands.join('') + " </table> <br> You can also ban guests or users by clicking their name in the chat stream and then clicking the Ban link on the popup context menu, and set a new topic by clicking on the topic label above chat.<br><br> Enter /help for a detailed list of chat commands. </div> "; return sHtml;};RoomHelpers.prototype.ReceivedCommand = function(oCommand ){
 if(typeof(oCommand) != 'object' ) { return; } if(oCommand._msg ) { this.ReceiveMessage(oCommand._msg ); } else if(oCommand.type == FCS.FCTYPE_SETWELCOME ) { 1; } else if(oCommand.type == FCS.FCTYPE_BANCHAN ) { 1; } else if(oCommand.type == FCS.FCTYPE_ZBAN ) { if(oCommand.op == 'ban' && oCommand.ban ) this.ReceiveMessage(oCommand.ban.username + ' has been banned from the chat room.' ); else if(oCommand.op == 'unban' ) this.ReceiveMessage(oCommand.username + ' has been unbanned from the chat room.' ); else if(oCommand.op == 'mute' ) this.ReceiveMessage(oCommand.mute.username + ' has been muted.' ); else if(oCommand.op == 'unmute' ) this.ReceiveMessage(oCommand.username + ' has been unmuted.' ); } else if(oCommand.type == FCS.FCTYPE_CHANOP ) { if(oCommand.op == 'kick' ) { var aUsernames=[]; if(oCommand._err && oCommand._msg ) { this.ReceiveMessage("Error: " + oCommand._msg ); } else if(oCommand.kicked && oCommand.kicked.length ) { for(var a=0; a < oCommand.kicked.length; a++ ) { aUsernames.push(oCommand.kicked[a].nm ); } this.ReceiveMessage(aUsernames.join(', ') + ' ' + ( 1 ? 'has' : 'have' ) + ' been kicked from the chat room.' ); } else { this.ReceiveMessage("No users have been kicked. Please check that the username(s) was spelled correctly, and that the user(s) is current in the chat room."); } } }
 else if(oCommand.type == FCS.FCTYPE_QUIETCHAN ) { var sUserType; var sState; if(oCommand.optmask == FCS.FCOPT_GUESTMUTE ) { sUserType = 'Guest'; sState = oCommand.optvalues & FCS.FCOPT_GUESTMUTE ? 'ON' : 'OFF'; } else if(oCommand.optmask == FCS.FCOPT_BASICMUTE ) { sUserType = 'Basic'; sState = oCommand.optvalues & FCS.FCOPT_BASICMUTE ? 'ON' : 'OFF'; } this.ReceiveMessage(sUserType + ' mute is now ' + sState + '.'); }};RoomHelpers.prototype.ReceiveMessage = function(message ){ Log('ROOMHELPER DBG: ReceiveMessage() called with ' + String(message)); if(this.ext.Display_ReceivedMessage ) { this.ext.Display_ReceivedMessage(message); }}; RoomHelpers.prototype.Topic = function(aArgs, hOptions ){ if ( ! this.ext.HasHelperAuth()) { return; } var sTopic = aArgs.slice(1).join(' '); Log('ROOMHELPER DBG: FCS.FCTYPE_SETWELCOME ' + sTopic ); this.ext.SendCommand(FCS.FCTYPE_SETWELCOME, this.ext.GetModelId() , { type: FCS.FCTYPE_SETWELCOME, topic: sTopic, model: this.ext.GetModelId() } );};RoomHelpers.prototype.Kick = function(aArgs, hOptions ){ if(! this.ext.HasHelperAuth() ) { return; } if(aArgs[1] == undefined || ( aArgs[1] && typeof(aArgs[1])=='string' && ! aArgs[1].match(/\w/) ) ) { return { "success": false, "message": "Enter the username(s) of the user you wish to ban. " }; } var hPayload = { model: this.ext.GetModelId(),
 type: FCS.FCTYPE_CHANOP, op: 'kick', chan: this.ext.GetPublicChannelId(), users: [] }; for(var n=1; n < aArgs.length; n++ ) { var sUsername = aArgs[n].toString().replace(/\W/g,''); var bIsGuest = sUsername.match(/guest\d+/i); var nSID=''; if(! nSID && bIsGuest ) { if(typeof(this.ext.GetUserByUsername ) == 'function' ) nSID = this.ext.GetUserByUsername(sUsername ).sessionid; else return; if(! nSID ) { return { "success": false, "message": sUsername + " not found. " }; } } if(nSID ) { hPayload.users.push(parseInt(nSID) ); } else { hPayload.users.push(sUsername ); } } this.ext.SendCommand(FCS.FCTYPE_CHANOP, this.ext.GetModelId(), hPayload );};RoomHelpers.prototype.Ban = function(aArgs, hOptions ){ hOptions = hOptions || {}; if(! this.ext.HasHelperAuth() ) { return; } if(aArgs[1] == undefined || ( aArgs[1] && typeof(aArgs[1])=='string' && ! aArgs[1].match(/\w/) ) ) { return { "success": false, "message": "Enter the username of the user you wish to ban. " }; }
 var hPayload = { model: this.ext.GetModelId() }; var nCommand; var sUsername = aArgs[1].toString().replace(/\W/g,''); var bIsGuest = sUsername.match(/guest\d+/i); nCommand = FCS.FCTYPE_ZBAN; hPayload.op = hOptions.unban ? "unban" : "ban"; hPayload.type = nCommand; if(hPayload.op == 'ban' && hOptions.c ) { hPayload.clearchat = 1; } if(! bIsGuest ) { hPayload.username = sUsername; } if(! hOptions.sid && bIsGuest ) { if(typeof(this.ext.GetUserByUsername ) == 'function' ) { hOptions.sid = this.ext.GetUserByUsername(sUsername ).sessionid; } else { return; } if(! hOptions.sid ) { return { "success": false, "message": sUsername + " not found. " }; } } if(hOptions.sid ) { hPayload.sid = parseInt(hOptions.sid); } hPayload.type = nCommand; this.ext.SendCommand(nCommand, this.ext.GetModelId(), hPayload );};RoomHelpers.prototype.muteUser = function(aArgs, hOptions ){ var sUsername = aArgs[1].toString().replace(/\W/g,''); var bIsGuest = sUsername.match(/guest\d+/i); var hPayload = { type: FCS.FCTYPE_ZBAN, model: this.ext.GetModelId() }; hPayload.op = hOptions.unmute ? "unmute" : "mute"; if(! bIsGuest ) { hPayload.username = sUsername; } if(hOptions.c ) { hPayload.clearchat = 1; } if(! hOptions.sid && bIsGuest ) { if(typeof(this.ext.GetUserByUsername ) == 'function' ) { hOptions.sid = this.ext.GetUserByUsername(sUsername ).sessionid; }
 else { return; } if(! hOptions.sid ) { return { "success": false, "message": sUsername + " not found. " }; } } if(hOptions.sid ) { hPayload.sid = parseInt(hOptions.sid); } hPayload.ztype = 'm'; this.ext.SendCommand(FCS.FCTYPE_ZBAN, this.ext.GetModelId(), hPayload );};RoomHelpers.prototype.Mute = function(aArgs, hOptions ){ if(! this.ext.HasHelperAuth() ) { return; } if(aArgs.length < 2 || aArgs.length > 3) { if(this.ext.Display_ReceivedMessage ) this.ext.Display_ReceivedMessage("Mute Error: Wrong number of arguments."); return; } if(aArgs[1] != "basic" && aArgs[1] != "guest" ) { this.muteUser(aArgs, hOptions ); return; } var hPayload = { "type": FCS.FCTYPE_QUIETCHAN, "model": this.ext.GetModelId() }; if(aArgs[1] == 'guest' ) hPayload.optmask |= FCS.FCOPT_GUESTMUTE; else if(aArgs[1] == 'basic' ) hPayload.optmask |= FCS.FCOPT_BASICMUTE; if(aArgs[2] == 'show' || ! aArgs[2] ) { var sMuted; if(this.ext.GetMuteStatus ) sMuted = this.ext.GetMuteStatus(aArgs[1] ) ? 'ON' : 'OFF'; if(this.ext.Display_ReceivedMessage && sMuted ) this.ext.Display_ReceivedMessage(aArgs[1] + " mute is currently " + sMuted + "." ); return;
 } else if ( aArgs[2] == 'on' ) { hPayload.optvalues = hPayload.optmask; } else if(aArgs[2] == 'off' ) { hPayload.optvalues = 0; } this.ext.SendCommand(FCS.FCTYPE_QUIETCHAN, this.ext.GetModelId(), hPayload );};RoomHelpers.prototype.Countdown = function(aArgs, hOptions ){ if(! this.ext.HasHelperAuth() ) { return; } var aError=[]; if(! aArgs[1] ) aError.push("Token acount required. Type /? for help." ); else if(! aArgs[1].match(/^[\+-]?\d+$/) && aArgs[1] != 'none' ) aError.push("'" + aArgs[1] + "' is not a valid countdown option." ); if(typeof(this.ext.GetCountdownDataObj ) == 'function' ) var hCountdownData = this.ext.GetCountdownDataObj(); else alert('RoomHelpers requires a GetCountdownDataObj function specification'); if(aArgs[1].match(/^[\+-]\d+$/) && ( ! hCountdownData || ! hCountdownData.countdown ) ) aError.push("No active countdown to adjust."); if(aArgs[2] && aArgs[2].match(/\S/) ) { if(! aArgs[2].match(/^\d+$/) ) aError.push("'" + aArgs[2] + "' is not a valid second countdown option." ); else aArgs[2] = parseInt(aArgs[2] ); } else { delete aArgs[2]; } if(aError.length > 0 ) { if(this.ext.Display_ReceivedMessage ) this.ext.Display_ReceivedMessage(aError.join(', ') ); return;
 } var hPayload = {}; for(var sK in hCountdownData ) { hPayload[ sK ] = hCountdownData[ sK ]; } if(hPayload.sofar == undefined ) { hPayload.sofar = 0; }; if(hPayload.countdown == undefined ) { hPayload.countdown = true; }; hPayload.type = FCS.FCTYPE_ROOMDATA; hPayload.model = this.ext.GetModelId(); if(aArgs[1].match(/^\d+$/) ) { hPayload.total = parseInt(aArgs[1] ); if(aArgs[2] ) hPayload.sofar = hPayload.total - parseInt(aArgs[2] ); } else if(aArgs[1] == 'none' ) { hPayload.countdown = false; } else if(aArgs[1].match(/-(\d+)/) ) { hPayload.sofar = hPayload.sofar - parseInt(RegExp.$1 ); } else if(aArgs[1].match(/\+(\d+)/) ) { hPayload.sofar = hPayload.sofar + parseInt(RegExp.$1 ); } var aError=[]; if(hPayload.sofar < 0 ) aError.push("You cannot add more then the total number of tokens to the count."); else if(hPayload.sofar > hPayload.total ) aError.push("The amount earned so far cannot exceed the tokens remaining."); if(aError.length > 0 ) { if(this.ext.Display_ReceivedMessage ) this.ext.Display_ReceivedMessage(aError.join(', ') );
 return; } this.ext.SendCommand(FCS.FCTYPE_ROOMDATA, this.ext.GetModelId(), hPayload );};

// js_build_core:on MfcClientUID(){};MfcClientUID.prototype.PluginTest = function(){ var aMatchPatterns = new Array('Adobe Acrobat', 'AdobeAAMDetect', 'Google Update', 'Identity Protection Technology', 'Microsoft Office', 'Silverlight Plug-In', 'Shockwave Flash', 'VLC Web Plugin', 'Windows Live' ); var message = ''; var aPlugins = navigator.plugins; var aCommonPlugins = new Array(); for(var b=0; b<aMatchPatterns.length; b++) { for(var a=0; a<aPlugins.length; a++) { if(aPlugins[a].name.indexOf(aMatchPatterns[b] ) > -1 ) { aCommonPlugins.push(aPlugins[a].name.replace(/[^\w\s]/,'') ); break; } } }
 return aCommonPlugins;};MfcClientUID.prototype.GetDPI = function(sMode ){ sMode == sMode || 'actual'; this.oDPIDiv = document.createElement('div'); this.oDPIDiv.id = 'dpi_test'; this.oDPIDiv.style.position = 'absolute'; this.oDPIDiv.style.whiteSpace = 'nowrap'; if(sMode == 'entropic' ) { this.oDPIDiv.style.top = '3.141593in'; this.oDPIDiv.style.left = '0px'; this.oDPIDiv.style.fontSize = '20.33333pt'; this.oDPIDiv.innerHTML = '!@#$%^&*()<99>®©¢<80>abcdefghijklmnopqrstuvwxyz'; } else if(sMode == 'actual' ) { this.oDPIDiv.style.top = '1in'; this.oDPIDiv.style.left = '1in'; } this.oBody = document.getElementsByTagName('body')[0]; this.oBody.appendChild(this.oDPIDiv); var sResult; if(sMode == 'entropic' ) { var nTop = document.getElementById('dpi_test').offsetTop; var nHeight = document.getElementById('dpi_test').offsetHeight; var nWidth = document.getElementById('dpi_test').offsetWidth; sResult = nTop.toString() + nHeight.toString() + nWidth.toString(); } else if(sMode == 'actual' ) { sResult = document.getElementById('dpi_test').offsetTop; } this.oDPIDiv.style.display='none'; this.oDPIDiv.parentNode.removeChild(this.oDPIDiv ); return sResult;};MfcClientUID.prototype.FontTest = function()
{ var sOS; if(navigator.userAgent.match(/Linux /) ) { sOS = 'linux'; } else if(navigator.userAgent.match(/Macintosh /) ) { sOS = 'mac'; } else if(navigator.userAgent.match(/Windows /) ) { sOS = 'win'; } if(! MfcClientUID.hFonts[ sOS ] ) { return []; } this.oTestDiv = document.createElement('div'); this.oTestDiv.style.cssText = 'visibility: hidden; position: absolute; display: block !important'; document.body.insertBefore(this.oTestDiv, document.body.firstChild); var aInstalledFonts = new Array(); for(var nK=0; nK < MfcClientUID.hFonts[ sOS ].length; nK++ ) { if(this.FontSupported(MfcClientUID.hFonts[ sOS ][nK] ) ) aInstalledFonts.push(MfcClientUID.hFonts[ sOS ][nK] ); } document.body.removeChild(this.oTestDiv ); return aInstalledFonts;};MfcClientUID.prototype.FontSupported = function(sName ){ this.oTestDiv.innerHTML = ' <b style="display:inline !important; width:auto !important; font:normal 10px/1 \'' + sName + '\',sans-serif !important">ii</b> <b style="display:inline !important; width:auto !important; font:normal 10px/1 \'' + sName + '\',monospace !important">ii</b> '; var aTestPair = this.oTestDiv.getElementsByTagName('b'); return (aTestPair[0].offsetWidth === aTestPair[1].offsetWidth);};MfcClientUID.hFonts = { linux: [ 'aakar', 'AR PL UMing CN', 'Cantarell', 'Clean', 'ClearlyU', 'Cursor', 'East Syriac Adiabene', 'GentiumAlt', 'Gentium Basic',
 'LKLUG', 'LMRomanSlant10', 'Luxi Mono', 'Luxi Serif', 'MarVoSym', 'MgOpen Modata', 'Monospace', 'Padauk', 'Samyak Malayalam', 'Samyak Oriya', 'serif-italic', 'STIXGeneral', 'STIXVariants', 'Suruma', 'TeXGyreHeros', 'Tibetan Machine Uni', 'Ume UI Gothic O5', 'UnGraphic', 'UnPilgi', 'Utopia', 'VL Gothic' ], mac: [ 'Academy Engraved LET', 'Adobe Caslon Pro', 'Adobe Caslon Pro Italic', 'Adobe Hebrew Italic', 'Adobe Naskh Medium', 'Arno Pro', 'Avenir Roman', 'Bangla MN', 'Bank Gothic', 'Bank Gothic Medium', 'Bauhaus 93', 'Birch Std', 'Blackmoor LET', 'BlairMdITC TT Medium', 'Braggadocio', 'Capitals', 'Chalkduster', 'Chaparral Pro', 'Chaparral Pro Italic', 'Chaparral Pro Light Italic', 'Cracked', 'Damascus', 'Desdemona', 'Eccentric Std', 'Eurostile', 'GB18030 Bitmap', 'Giddyup Std',
 'Handwriting - Dakota', 'Hobo Std', 'Jazz LET', 'Kannada MN', 'Kefa Regular', 'Kokonor Regular', 'Kozuka Mincho Pr6N R', 'Kozuka Mincho Pro R', 'Letter Gothic Std', 'Letter Gothic Std Slanted', 'Lithos Pro', 'Lithos Pro Black', 'Malayalam MN', 'Marion Regular', 'Mesquite Std Medium', 'Minion Pro', 'Minion Pro Medium Italic', 'Minion Pro SmBd', 'Myanmar Sangam MN', 'Myriad Pro Cond', 'Myriad Pro Italic', 'Myriad Web Pro', 'Myriad Web Pro Italic', 'Noteworthy Light', 'Nueva Std', 'Nueva Std Cond', 'Nueva Std Italic', 'Orator Std', 'Orator Std Slanted', 'Oriya Sangam MN', 'Party LET', 'PilGi Regular', 'Poplar Std Black', 'PortagoITC TT', 'Princetown LET', 'PT Sans Italic', 'Rosewood Std', 'Rosewood Std Regular', 'Santa Fe LET', 'SchoolHouse Printed A', 'Sinhala MN', 'Snell Roundhand', 'Snell Roundhand Black', 'STIXGeneral', 'STIXGeneral Italic', 'STIXGeneral-Regular', 'Stone Sans ITC TT-Semi', 'Stone Sans Sem ITC TT Semi', 'Synchro LET', 'Tamil MN',
 'Tekton Pro', 'Telugu Sangam MN', 'Trajan Pro', 'Yuppy TC Regular' ], win: [ 'Academy Engraved LET', 'AcadEref', 'Adobe Gothic Std B', 'Adobe Ming Std L', 'Adobe Naskh Medium', 'Airstream', 'Alba', 'Aldhabi', 'Alfredo', 'Alien Encounters', 'Allegro BT', 'Almonte Snow', 'Amethyst', 'AMGDT', 'Amienne', 'AR CHRISTY', 'Arimo', 'Arno Pro', 'Arnprior', 'Autumn', 'AvantGarde Bk BT', 'AVGmdBU', 'Baby Kruffy', 'Balthazar', 'BankGothic Lt BT', 'BankGothic Md BT', 'Bastion', 'Bauhaus 93', 'Baveuse', 'Benguiat Bk BT', 'BernhardFashion BT', 'BernhardMod BT', 'Berylium', 'Biondi', 'Birch Std', 'Blackletter686 BT', 'Blackoak Std', 'BN Jinx', 'BN Machine', 'Brandish', 'Bremen Bd BT', 'Brussels', 'Burnstown Dam', 'Buxton Sketch',
 'Calligraph421 BT', 'Calligraphic', 'CALVIN', 'Candles', 'Candy Round BTN', 'Carbon Block', 'Cataneo BT', 'CatholicSchoolGirls Intl BB', 'Catriel', 'Chaparral Pro', 'Chaparral Pro Light', 'Charlemagne Std', 'Chick', 'Chinyen', 'chs_boot', 'cht_boot', 'CityBlueprint', 'Clarendon', 'Colbert', 'CommercialPi BT', 'CommonBullets', 'Complex', 'CountryBlueprint', 'Credit Valley', 'Dayton', 'Digifit', 'DINPro-Black', 'DINPro-Regular', 'Distant Galaxy', 'DomCasual BT', 'Dutch801 Rm BT', 'Dutch801 XBd BT', 'Earwig Factory', 'Eccentric Std', 'ELEGANCE', 'Embassy BT', 'Emmett', 'English157 BT', 'Enliven', 'Ethnocentric', 'Euphorigenic S', 'EuroRoman', 'Euro Sign', 'Eurostile', 'Exotc350 Bd BT', 'Fat', 'Freehand521 BT', 'Freehand575 BT', 'Freehand591 BT', 'Freshbot',
 'Frosty', 'Gadugi', 'GDT', 'Gentium Basic', 'GENUINE', 'Geotype TT', 'Giddyup Std', 'GothicG', 'Grad', 'Guitar Pro 5', 'Hand Me Down S BRK', 'Hanzel Extended', 'Heavy Heap', 'HGHangle', 'HGMinchoL', 'Hobo Std', 'HolidayPi BT', 'HP PSG', 'Humanst521 BT', 'Humanst521 XBd BT', 'Hurry Up', 'Huxtable', 'Impress BT', 'Induction', 'ISOCP', 'Jenkins v2.0', 'John Handy LET', 'jpn_boot', 'Kabel Bk BT', 'Kabel Ult BT', 'Kozuka Gothic Pr6N B', 'Kozuka Gothic Pro H', 'Kredit', 'La Bamba LET', 'LCD', 'Letter Gothic Std', 'LetterOMatic', 'Ligurino', 'Linux Biolinum G', 'Lithos Pro Regular', 'Mael', 'Martina', 'Mekanik LET', 'Mesquite Std', 'Milano LET', 'Minion Pro', 'Minion Pro SmBd', 'Minya Nouvelle', 'MisterEarl BT', 'Monospac821 BT',
 'Mufferaw', 'Myanmar Text', 'Myriad Condensed Web', 'Myriad Hebrew', 'Myriad Pro', 'Myriad Web', 'Myriad Web Pro', 'Myriad Web Pro Condensed', 'Nasalization', 'Neon Lights', 'Nirmala UI', 'November', 'Nueva Std', 'Orator Std', 'ParkAvenue BT', 'Parry Hotter', 'PenultimateLight', 'Poplar Std', 'Porkys', 'Pupcat', 'Pussycat', 'QuickType II', 'QuickType Mono', 'QuigleyWiggly', 'QuiverItal', 'RomanD', 'Rosewood Std Regular', 'Ruach LET', 'Russel Write TT', 'SansSerif', 'Scruff LET', 'SF Movie Poster', 'Simplex', 'SketchFlow Print', 'Smudger LET', 'Sneakerhead BTN Shadow', 'Snowdrift', 'Souvenir Lt BT', 'Square721 BT', 'Staccato222 BT', 'Stereofidelic', 'Swis721 Blk BT', 'Swis721 BlkEx BT', 'Swis721 BT', 'Swis721 Cn BT', 'Swis721 Ex BT', 'Swis721 Hv BT', 'Swis721 LtCn BT', 'Swis721 LtEx BT', 'Swiss911 XCm BT',
 'SWMacro', 'SWTOR Trajan', 'Syastro', 'Tandelle', 'Teen', 'Teen Light', 'Tekton Pro', 'Tele-Marines', 'Terminator Two', 'Ti73pc', 'Toledo', 'Trajan Pro', 'TtsNote', 'Txt', 'TypoUpright BT', 'UniversalMath1 BT', 'Urdu Typesetting', 'VAGRounded BT', 'Velvenda Cooler', 'Victorian LET', 'Vineta BT', 'Virtual DJ', 'Waker', 'Weltron Urban', 'Westwood LET', 'Wickenden Cafe NDP', 'Woodcut', 'WP CyrillicA', 'WP Greek Helve', 'WP MathExtendedB', 'X-Files', 'Zurich Ex BT', 'ZWAdobeF' ]};

// js_build_core: js/AnimatedLiveSnaps.js
function AnimatedLiveSnaps(_config ){ _config = _config || {}; AnimatedLiveSnaps.monitorWindows(); this.selfId = AnimatedLiveSnaps.nId++; this.animateOnVisible_timers = {}; var hUA = new MfcUserAgent(); AnimatedLiveSnaps.sPlaceholderImg = 'data:image/gif;base64,R0lGODlhAQABAIABAP/' + '/' + '/wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=='; AnimatedLiveSnaps.hRegister[ this.selfId ] = this; _config.addClass = _config.addClass || addClass; _config.removeClass = _config.removeClass || removeClass; _config.mfcMouseTracker = _config.mfcMouseTracker || g_oMouseTracker; _config.users = _config.users || t && t.g_hUsers ? t.g_hUsers : {}; _config.bannedFrom = _config.bannedFrom || t && t.g_hBannedFrom ? t.g_hBannedFrom : {}; _config.self = _config.self || t && t.g_hSelf ? t.g_hSelf : {}; _config.getPlayerMode = _config.getPlayerMode || function() { return typeof(g_sPlayerMode) != 'undefined' ? g_sPlayerMode : 'homepage'; }; _config.onClickAction = _config.onClickAction || function(nUserId ) { if(TopLoadPlayer ) { TopLoadPlayer({broadcaster_id: nUserId }); } }; this.observing = new WeakSet(); this.intersecting = new WeakSet(); this.intersectionObserver = new IntersectionObserver((entries) => { entries.forEach((entry) => { if(entry.isIntersecting ) this.intersecting.add(entry.target); else this.intersecting.delete(entry.target); }); }, { root: null, rootMargin: "0px",
 threshold: 0.5, } ); this.log = function(msg) { if(window.t && window.t.Log ) { window.t.Log('AnimatedLiveSnaps: ' + msg); } }; this.mouseEventCode = function(nUserId, hOptions ) { 'use strict'; hOptions = hOptions || {}; if(hOptions.size ) { this.nSnapSize = hOptions.size; } var eventHtml = ""; { this.auto_update_livesnaps = hOptions.auto_update_livesnaps || 0; eventHtml += " onLoad=' {{{ if(AnimatedLiveSnaps.register(" + this.selfId + ") ) AnimatedLiveSnaps.register(" + this.selfId + ").animateOnVisible(this," + nUserId + "," + JSON.stringify(hOptions) + "); }}} ' "; } eventHtml += " data-als-options='" + JSON.stringify(hOptions).replace(/'/,"") + "' "; eventHtml += " onMouseEnter=' if(AnimatedLiveSnaps.register(" + this.selfId + ") ) AnimatedLiveSnaps.register(" + this.selfId + ").startAnimation(this," + nUserId + "); ' "; if(! hOptions.no_click && ! _config.no_click ) eventHtml += " onMouseUp=' if(event.button != 1) TopLoadPlayer({broadcaster_id:" + nUserId + "},event); ' "; return eventHtm return this.selfIdcondUnique(nUserId); }; this.rdUniques[ nUserId ]; }; this.clearAnimateOnVisibleTimer = function(nUserId)
 { if(this.animateOnVisible_timers[nUserId] > 0 ) { clearTimeout(this.animateOnVisible_timers[nUserId] ); delete this.animateOnVisible_timers[nUserId]; } }; this.newLivesnapAvailable = function(nUserId ) { if(typeof(_config.users[ nUserId ]) !== 'undefined' && typeof(_config.users[ nUserId ].state) !== 'undefined' && _config.users[ nUserId ].state != FCS.FCVIDEO_TX_IDLE ) { return false; } if(typeof(_config.bannedFrom) !== 'undefined' && _config.bannedFrom[ nUserId|0 ] ) { return false; } return true; }; this.animateOnVisible = function(oImg, nUserId ) { 'use strict'; var hOptions = JSON.parse(oImg.getAttribute('data-als-options') ) || {}; if(this.getCache(nUserId + '_onerror_lock') ) { return; } this.haltUserId(nUserId); if(! document.body.contains(oImg) ) { this.observing.delete(oImg.parentNode); this.intersecting.delete(oImg.parentNode); this.intersectionObserver.unobserve(oImg.parentNode); this.animateOnVisible_toggleListeners(oImg, false); this.deleteCache(nUserId); return; } if(! this.observing.has(oImg.parentNode) ) {
 this.observing.add(oImg.parentNode); this.intersectionObserver.observe(oImg.parentNode); } _config.self['auto_update_livesnaps_persec_'+ _config.getPlayerMode() ] = _config.self['auto_update_livesnaps_persec_'+ _config.getPlayerMode() ] || 50; if(this.intersecting.has(oImg.parentNode) && ! AnimatedLiveSnaps.lostFocus_pauseAnimations && ( oImg.src.indexOf('.svg') == -1 || this.newLivesnapAvailable(nUserId) ) && ( ( ! _config.self.pause_auto_update_livesnaps && _config.self.auto_update_livesnaps & ( _config.getPlayerMode() == 'player' ? 2 : 1 ) && ! this.animateOnVisible_perSecondRateLimit() ) || hOptions.timer ) ) { var timer = 50; if(typeof(hOptions.timer) != 'undefined' ) { timer = hOptions.timer; } AnimatedLiveSnaps.global_animateOnVisible_perSecondUniques[ nUserId ] = 1; var cx = Object.keys(AnimatedLiveSnaps.global_animateOnVisible_perSecondUniques).length; timer = parseInt(( cx / _config.self['auto_update_livesnaps_persec_'+ _config.getPlayerMode() ] ) * 1000 ); if(timer < 500 ) timer = 500; else if(timer > 5000 ) { timer = 5000; } this.animateOnVisible_timers[nUserId] = setTimeout(this.animateOnVisible_loadNewImage.bind(this, oImg, nUserId ), timer ); } else { this.animateOnVisible_timers[nUserId] = setTimeout(this.animateOnVisible.bind(this, oImg,nUserId ), 1000 ); } }; tplay-imgnum', nNum); };
 this.animateOnVisible_loadNewImage = function(oImg, nUserId ) { 'use strict'; if(! oImg.classList.contains('livesnap') ) { return; } if(this.videoIsPlaying && this.videoIsPlaying.user_id == nUserId ) { return; } var hOptions = JSON.parse(oImg.getAttribute('data-als-options') ) || {}; var nExistingCache = this.getCache(nUserId); if ( typeof(nExistingCache) === 'number' && (Date.now() - nExistingCache) <= 3000 ) { return; } if(this.getCache(nUserId + '_onerror_lock') ) { return; } this.clearAnimateOnVisibleTimer(nUserId); this.animateOnVisible_toggleListeners(oImg, false); var oParent = oImg.parentNode; var nCurImg = oParent.getAttribute('data-display-imgnum')|0; if(! nCurImg ) { oImg.setAttribute('data-selfid', this.getSelfId()); oImg.setAttribute('data-uid', nUserId); oImg.setAttribute('data-imgnum', 1); _config.addClass(oImg, 'livesnap1'); _config.addClass(oParent, 'livesnap_parent'); this.setDisplayImgNum(oParent, 1); nCurImg = 1; } var nNewImg = nCurImg == 1 ? 2 : 1; var oNewImg = oParent.getElementsByClassName('livesnap' + nNewImg); if(oNewImg && oNewImg[0] ) { oNewImg = oNewImg[0]; } else {
 var oNewImg = document.createElement('img'); if(hUA.IE >= 11 ) oNewImg.src = AnimatedLiveSnaps.sPlaceholderImg; var sOnLoad = oImg.getAttribute('onload'); if(sOnLoad && sOnLoad.indexOf('{{{') > -1 ) oImg.setAttribute('onload', sOnLoad.replace(/\s*\{\{\{.+?\}\}\}\s*/, '')); this.cloneImageAttribs(oImg, oNewImg); oNewImg.setAttribute('data-imgnum', nNewImg); _config.addClass(oNewImg, 'livesnap' + nNewImg); _config.removeClass(oNewImg, 'livesnap' + nCurImg); oParent.insertBefore(oNewImg, oImg ); } this.setCache(nUserId, Date.now()); this.animateOnVisible_toggleListeners(oNewImg, true); var url = _config.getSnapUrl(nUserId, hOptions.size ); oNewImg.src = url; }; this.animateOnVisible_toggleListeners = function(oImg, bOnOrOff) { 'use strict'; if(bOnOrOff && ! oImg.getAttribute('data-mfc-als') ) { oImg.addEventListener('load', this.animateOnVisible_onLoad, {once: true}); oImg.addEventListener('error', this.animateOnVisible_onError, {once: true}); oImg.setAttribute('data-mfc-als', 1); } else { oImg.removeEventListener('load', this.animateOnVisible_onLoad); oImg.removeEventListener('error', this.animateOnVisible_onError); oImg.removeAttribute('data-mfc-als'); } };
 this.animateOnVisible_onLoad = function() { 'use strict'; var oImg = this; var nUserId = oImg.getAttribute('data-uid')|0; var nSelfId = oImg.getAttribute('data-selfid')|0; var nCurImg = oImg.getAttribute('data-imgnum')|0; var self; if(self = AnimatedLiveSnaps.register(nSelfId) ) { self.animateOnVisible_toggleListeners(oImg, false); self.deleteCache(nUserId); var oParent = oImg.parentNode; if(oImg.naturalWidth > 1 && m(oParent, nCurImg); },150); } self.animateOnVisible(oImg, nUserId ); } }; this.animateOnVisible_onError = function() { 'use strict'; var oImg = this; var nUserId = oImg.getAttribute('data-uid')|0; var nSelfId = oImg.getAttribute('data-selfid')|0; var self = AnimatedLiveSnaps.register(nSelfId); self.animateOnVisible_toggleListeners(oImg, false); self.clearAnimateOnVisibleTimer(nUserId); self.setCache(nUserId + '_onerror_lock', true); self.animateOnVisible_timers[nUserId] = setTimeout(function(){ self.deleteCache(nUserId + '_onerror_lock'); self.animateOnVisible_loadNewImage(oImg, nUserId ); }, 2500 ); };
 this.cloneImageAttribs = function(src, dest) { var attributes = Array.prototype.slice.call(src.attributes); var len = attributes.length; var i = 0; while(i < len ) { var attrib = attributes[i]; i++; if(attrib.nodeName == 'src' ) { continue; } dest.setAttribute(attrib.nodeName, attrib.nodeValue); } }; this.animateOnVisible_perSecondRateLimit = function() { 'use strict'; if(! AnimatedLiveSnaps.global_animateOnVisible_perSecondRateLimit ) { AnimatedLiveSnaps.global_animateOnVisible_perSecondRateLimit = 1; clearTimeout(AnimatedLiveSnaps.animateOnVisible_perSecondRateLimit_timer); AnimatedLiveSnaps.animateOnVisible_perSecondRateLimit_timer = setTimeout(function() { AnimatedLiveSnaps.global_animateOnVisible_perSecondRateLimit = 0; }, 1000 ); return false; } else if(AnimatedLiveSnaps.global_animateOnVisible_perSecondRateLimit <= _config.self['auto_update_livesnaps_persec_'+ _config.getPlayerMode() ] ) { AnimatedLiveSnaps.global_animateOnVisible_perSecondRateLimit++; return false; } else if(AnimatedLiveSnaps.global_animateOnVisible_perSecondRateLimit > _config.self['auto_update_livesnaps_persec_'+ _config.getPlayerMode() ] ) { return true; } return false; }; this.elementInViewport = function(el ) { return isInViewport(el ); }; this.setCache = function(nKey, hValue ) { var nSelfId = this.getSelfId();
 if(! AnimatedLiveSnaps.hCacheById[ nSelfId ] ) { AnimatedLiveSnaps.hCacheById[ nSelfId ] = {}; } AnimatedLiveSnaps.hCacheById[ nSelfId ][ nKey ] = hValue; }; this.getCache = function(nKey ) { var nSelfId = this.getSelfId(); if(! AnimatedLiveSnaps.hCacheById[ nSelfId ] ) { return undefined; } return AnimatedLiveSnaps.hCacheById[ nSelfId ][ nKey ]; }; this.deleteCache = function(nKey ) { var nSelfId = this.getSelfId(); if(! AnimatedLiveSnaps.hCacheById[ nSelfId ] ) { return undefined; } var hValue = AnimatedLiveSnaps.hCacheById[ nSelfId ][ nKey ]; delete AnimatedLiveSnaps.hCacheById[ nSelfId ][ nKey ]; return hValue; }; this.startAnimation = function(oImg, nUserId, nSnapSize ) { this.nUserId = nUserId; this.haltUserId(nUserId); var hUser = t.g_hUsers[ nUserId ]; if(! hUser ||! hUser.user_id ) { return; } if(hUser.state == FCS.FCVIDEO_TX_PVT && hUser.truepvt ) { return; } if(! oImg || ! oImg.src || oImg.src.match(/\.svg|\.png/) ) { return; } oImg.src = _config.getSnapUrl(this.nUserId, nSnapSize || this.nSnapSize ); const loadEvent = (e) => { this.updateImageSrc(oImg, nSnapSize || this.nSnapSize ); }; const stopAnimation = (e) =>
 { this.stopAnimation(oImg); if(this.mouseoutEvent ) { this.mouseEventCode(e); } oImg.removeEventListener('load', loadEvent); oImg.removeEventListener('mouseout', stopAnimation); }; oImg.addEventListener('load', loadEvent, false ); oImg.addEventListener('mouseout', stopAnimation, {once: true} ); if(window.g_nBroadcasterId && window.g_nBroadcasterId == nUserId ) this.log('found matching g_nBroadcasterId for ' + nUserId + ', will not load video'); else this.prepareVideoReplacement_timer = setTimeout(() => { if(! document.body.contains(oImg) ) { return; } this.prepareVideoReplacement(oImg, nUserId, nSnapSize ); }, ( _config.immediate_video ? 0 : 700 ) ); }; this.updateByUserId = function(nUserId ) { if(! CamPreviewOverlay ) return; var entries = CamPreviewOverlay.userRegister(nUserId); if(! entries ) return; for(var a=0; a < entries.length; a++ ) { if(entries[a].icon && this.elementInViewport(entries[a].icon) ) { this.animateOnVisible_loadNewImage(entries[a].icon, nUserId ); } } }; this.updateImageSrc = function(oImg, nSnapSize ) { this.timer = setTimeout(() => { if(! this.elementInViewport(oImg ) ) { return; } if(! document.body.contains(oImg) ) { AnimatedLiveSnaps.deregister(this.selfId ); clearTimeout(this.timer); } else {
 oImg.src = _config.getSnapUrl(this.nUserId, nSnapSize || this.nSnapSize ); } },500); }; this.stopAnimation = function(oImg) { clearTimeout(this.prepareVideoReplacement_timer ); clearTimeout(this.timer ); if(oImg && oImg.removeEventListener ) { oImg.removeEventListener('load', this.loadEvent ); if(this.mouseoutEvent ) { oImg.removeEventListener('mouseout', this.mouseoutEvent ); } } this.restartAutoAnimation(oImg ); }; this.restartAutoAnimation = function(oImg) { var nUserId; if(oImg && oImg.getAttribute('data-als-options') && ( nUserId = oImg.getAttribute('data-uid') ) ) { var hOptions = JSON.parse(oImg.getAttribute('data-als-options') ) || {}; { this.animateOnVisible(oImg, nUserId ); } } }; this.loadPreview = function(event, nUserId ) { this.preview = new MfcDhtmlPopup({ mfcMouseTracker: _config.mfcMouseTracker }); var sExtraStyle = MfcCustomFonts.prototype.get_style(_config.users[nUserId] ); var sMode; this.preview.open("<span style=\"font-size:14px;" + sExtraStyle + "\"\><b>" + _config.users[nUserId].username + "</b></span><br>" + "<img class=tiny_livesnap_border id=AnimatedLiveSnaps_img_" + nUserId + " src=" + _config.getSnapUrl(this.nUserId,320) + " style=\"cursor:pointer;\" " + " >", 'height:260,width:320,child'
 ); setTimeout(() => { var el = document.getElementById('AnimatedLiveSnaps_img_' + nUserId ); this.startAnimation(el, nUserId, 320 ); el.onclick = function() { _config.onClickAction(nUserId); }; }, 0 ); }; this.prepareVideoReplacement = function(oSnapImg, nUserId, nSnapSize ) { var hUser = t.g_hUsers[ nUserId ]; var oVideo = document.createElement('div'); var oSnapImgStyles = document.defaultView.getComputedStyle(oSnapImg, ""); var cssText = oSnapImgStyles.cssText; oVideo.style.position = 'absolute'; oVideo.style.right = '0px'; oVideo.style.top = '0px'; oVideo.style.height = document.defaultView.getComputedStyle(oSnapImg, "").height; oVideo.style.width = document.defaultView.getComputedStyle(oSnapImg, "").width; const clientVideo = new MfcClientVideo(t.g_hVideoServerConfig ); clientVideo.Set({ client_user: t.g_hSelf, broadcaster: hUser, video_container: oVideo, player_type_override: 'videojs', presentation_state: FCS.EVSESSION_NONE, mute: true, allowFullscreen: false, allowControls: false, capLevelToPlayerSize: true }); if(clientVideo.hfBroadcaster.state() != FCS.FCVIDEO_TX_IDLE ) {
 return; } clientVideo.PrepareVideo(); this.b_switchToVideo = false; var callback = () => { if(! this.b_switchToVideo ) { this.switchToVideo(oSnapImg,oVideo) } this.b_switchToVideo = true; }; clientVideo.videoPlayer.setOnPlayCallback(() => { this.log('setOnPlayCallback'); callback(); } ); clientVideo.videoPlayelback'); callback(); } ); clientVideo.RenderVideo(); oSnapImg.parentNode.insertBefore(oVideo, oSnapImg.parentNode.firstElementChild); var oSpinner = oVideo.getElementsByClassName('vjs-loading-spinner'); if(oSpinner && oSpinner[0] ) { oSpinner[0].style.display = 'none'; } oVideo.clientVideo = clientVideo; oVideo.onclick = () => { if(TopLoadPlayer ) { TopLoadPlayer({broadcaster_id: nUserId }); } }; oVideo.oncontextmenu = () => { event.preventDefault(); if(popUserMenu ) { popUserMenu.right_click_open(event,nUserId); } }; oVideo.classList.add('livesnap_video'); const fShutdownVideo = () => { if(_config.retain_video_on_mouseout ) { return; } this.shutdownVideo(oSnapImg, oVideo ); if(oSnapImg.parentNode ) { oSnapImg.parentNode.removeEventListener('mouseout', fShutdownVideo ); } if(oVideo.parentNode ) { oVideo.parentNode.removeEventListener('mouseout', fShutdownVideo ); } }; if(! _config.retain_video_on_mouseout ) { if(oSnapImg.parentNode ) { oSnapImg.parentNode.addEventListener('mouseout', fShutdownVideo, {once: true} ); } if(oVideo.parentNode ) { oVideo.parentNode.addEventListener('mouseout', fShutdownVideo, {once: true} ); } } };
 this.switchToVideo = function(oSnapImg, oVideo ) { if(oVideo.offsetParent == null ) { this.log('video div is no longer in the dom, aborting. '); this.shutdownVideo(oSnapImg, oVideo ); return; } this.log('switchToVideo');  this.oVideoParent = oVideo.parentNode; aImgs = this.oVideoParent.getElementsByClassName('livesnap'); for(var a=0; a < aImgs.length; a++ ) { aImgs[a].classList.add('livesnap_smooth_video_trans'); aImgs[a].classList.add('temporary_transparency'); } oVideo.style.opacity = 1; setTimeout(() => { this.monitorVideo(oSnapImg,oVideo); }, 750 ); var nUserId = oSnapImg.getAttribute('data-uid')|0; this.videoIsPlaying = { user_id: nUserId }; };
 this.monitorVideo = function(oSnapImg, oVideo ) { this.log('monitorVideo'); if(! oVideo || oVideo.offsetParent == null || ! document.body.contains(oVideo ) ) { this.shutdownVideo(oSnapImg, oVideo ); } else { clearTimeout(this.nMonitorVideoTimer ); this.nMonitorVideoTimer = setTimeout(() => { this.monitorVideo(oSnapImg,oVideo); }, 1000 ); } }; this.shutdownVideo = function(oSnapImg, oVideo ) { clearTimeout(this.nMonitorVideoTimer ); this.log('shut down and remove video'); if(oSnapImg.parentNode ) { aImgs = oSnapImg.parentNode.getElementsByClassName('livesnap'); for(var a=0; a < aImgs.length; a++ ) { aImgs[a].classList.remove('temporary_transparency'); } } if(oVideo.parentNode ) { } setTimeout(() => { aImgs = oSnapImg.parentNode.getElementsByClassName('livesnap'); for(var a=0; a < aImgs.length; a++ ) { aImgs[a].classList.remove('livesnap_smooth_video_trans'); } if(oVideo && oVideo.clientVideo ) { oVideo.clientVideo.Disconnect(); delete oVideo.clientVideo; this.log('oVideo.clientVideo.Disconnect() '); } if(oVideo && oVideo.parentNode ) { oVideo.parentNode.removeChild(oVideo); oVideo.remove(); this.log('removed oVideo '); } this.videoIsPlaying = null; },500); };}AnimatedLiveSnaps.nId = 0;AnimatedLiveSnaps.hRegister = {};AnimatedLiveSnaps.register = function(nId ) { return AnimatedLiveSnaps.hRegister[ nId ]; };AnimatedLiveSnaps.deregister = function(nId ){ var oALS = AnimatedLiveSnaps.register(nId ); if ( ! oALS ) { return; } if(! oALS.oImg || ! document.body.contains(oALS.oImg) ) { delete AnimatedLiveSnaps.hRegister[ nId ]; }};AnimatedLiveSnaps.hCacheById = {};AnimatedLiveSnaps.global_animateOnVisible_perSecondUniques = {};
AnimatedLiveSnaps.monitorWindows = function(){ if(AnimatedLiveSnaps.monitorWindows_runOnce ) { return; } AnimatedLiveSnaps.monitorWindows_runOnce = 1; setInterval(function() { AnimatedLiveSnaps.lostFocus_pauseAnimations = false; for(var sWindowId in g_hWindows ) { if(sWindowId.indexOf('pm_') > -1 || parseInt(sWindowId ) > FCS.CHANNEL_ID_START ) { if(g_hWindows[sWindowId].window && g_hWindows[sWindowId].window.opener && g_hWindows[sWindowId].window.document && g_hWindows[sWindowId].window.document.hasFocus() && ( ( sWindowId.indexOf('pm_') > -1 && g_hWindows[sWindowId].pm_video ) || ( sWindowId.indexOf('pm_') == -1 ) ) ) { AnimatedLiveSnaps.lostFocus_pauseAnimations = true; } } } }, 2000 );}

// js_build_core: js/CamPreviewOverlay.js
function CamPreviewOverlay(config ){ this.config = config || {}; this.selfId = CamPreviewOverlay.nId++; this.hostingElements = []; this.image_url = this.config.image_url || ( t && t.g_hPlatform && t.g_hPlatform.image_url ) || 'https://img.camcdn.com/'; CamPreviewOverlay.hRegister[ this.selfId ] = this; if(! this.config.LiveSnapUrl && t && t.LiveSnapUrl ) { this.config.LiveSnapUrl = t.LiveSnapUrl; } this.animatedLiveSnaps = new AnimatedLiveSnaps({ getSnapUrl: this.config.LiveSnapUrl }); if(! this.config.users && t && t.g_hUsers ) { this.config.users = t.g_hUsers; } if(! this.config.mfcMouseTracker && g_oMouseTracker ) { this.config.mfcMouseTracker = g_oMouseTracker; } var nUserId = this.nUserId = this.config.userId; if(! CamPreviewOverlay.hUserRegister[nUserId] ) { CamPreviewOverlay.hUserRegister[nUserId] = []; } CamPreviewOverlay.hUserRegister[nUserId].push(this); if(! this.config.onClick && TopLoadPlayer ) {ster_id: nUserId }); }; } if(this.config.getPopupHtml ) { this.getPopupHtml = this.config.getPopupHtml; } else if(t && t.PopupPreview && t.PopupPreview.getHtml ) { this.getPopupHtml = function() { return t.PopupPreview.getHtml(nUserId,{ MfcDhtmlPopup_instance_name: ( this.previewPopup && this.previewPopup.sPopupInstanceName ), right_click_persist: 1, width: this.nPreviewWidth }); }; } this.selfDestructInterval = setInterval(() => { this.selfDestructOnDOMRemoval(); }, 1000 ); this.selfDestructOnDOMRemoval = function() { var nIsDead = 0; if(! this.hostingElements.length ) { nIsDead = 1; } for(var a=0; a < this.hostingElements.length; a++ ) {
 if(! document.body.contains(this.hostingElements[a]) ) { nIsDead = 2; } } if(nIsDead ) { CamPreviewOverlay.deregister(this.selfId ); clearInterval(this.selfDestructInterval ); return; } }; this.Elements.push(oEl ); }; this.renderOverlay = function(event, oImg ) { if(this.icon ) { return; } this._removeAllOverlays(); this.icon = document.createElement('img'); CamPreviewOverlay.aRenderedRegister.push(this); this.icon.src = this.image_url + 'files/images/misc/small_cam_prev_light.png'; this.icon.className = 'CamPreviewOverlay_icon'; this.icon.dataset.cpo = this.selfId; this.icon.dataset.cpouid = nUserId; var oP = this.getFirstBlockParent(oImg ); var originalPosition = oP.style.position; oP.style.position = 'relative'; this.icon.style.top = ( oImg.offsetTop + 4 ) + 'px'; this.icon.style.left = ( oImg.offsetLeft + oImg.offsetWidth - 22 ) + 'px'; if(this.config.overlayStyle ) for(var o in this.config.overlayStyle ) this.icon.style[ o ] = this.config.overlayStyle[ o ]; this.icon.onmouseenter = () => { this.loadPreview(); }; this.icon.onmouseleave = () => { this.unloadPreview(); }; thi) => { return false; }; this.icon.onmousedown = (e) => { e.preventDefault(); e.stopPropagation();
 this.mouseDownHandler(e); };s.mouseUpHandler(e); }; oP.appendChild(this.icon); this.hostClassName = event.target.className; }; this.getDisplayType = function(element) { var cStyle = element.currentStyle || window.getComputedStyle(element, ""); return cStyle.display; }; this.getFirstBlockParent = function(oImg ) { var element = oImg; do { element = element.parentNode; } while(this.getDisplayType(element ) == 'inline' ); return element; }; this._removeOverlay = function() { if(! this.icon ) { return; } this.unloadPreview(); if(this.icon.parentNode ) { this.icon.parentNode.removeChild(this.icon ); } delete this.icon; }; this._removeAllOverlays = function() { CamPreviewOverlay.aRens._removeOverlay(); }); CamPreviewOverlay.aRenderedRegister = []; }; this.removeOverlay = function(event, oImg ) { var el = document.elementFromPoint(event.clientX, event.clientY ); if(el && ['CamPreviewOverlay_icon',lassList.contains(cls)) ) { return; } this._removeOverlay(); CamPreviewOverlay.aRenderedRegister = CamPreviewOverlay.aRenderedRegister.filter((ins) => { ins.selfId == this.selfId }); CamPreviewOverlay.deregister(this.selfId );
 }; this.loadPreview = function(e) { { this.previewPopup = new MfcDhtmlPopup({ no_fade_on_close: true, convert_to_persistent_callback: t.PopupPreview.convert_to_persistent_callback }); } var sExtraStyle = MfcCustomFonts.prototype.get_style(this.config.users[nUserId] ); var sMode; if(this.getPopupHtml ) { html = this.getPopupHtml(nUserId); } else { html = "<span style=\"font-size:14px;" + sExtraStyle + "\"\><b>" + this.config.users[nUserId].username + "</b></span><br>" + "<img class=tiny_livesnap_border id=CamPreviewOverlay_" + this.selfId + " src=" + this.config.LiveSnapUrl(nUserId,320) + " style=\"cursor:pointer;width:" + ( this.nPreviewWidth || 530 ) + "px;min-height:320px;\" " + this.animatedLiveSnaps.mouseEventCode(nUserId, { size: 320 } ) + " >"; } this.previewPopup.open(html,'child,no_close_button,hover'); setTimeout(() => { this.animatedLiveSnaps.startAnimation(document.getElementById('CamPreviewOverlay_' + this.selfId), nUserId ); }, 0 ); var begin = new Date().getTime(); this.monitorSourceElement_interval = setInterval(() => { if(e && e.target && document.body && ! document.body.contains(e.target) ) { clearInterval(this.monitorSourceElement_interval ); this.unloadPreview(); } var now = new Date().getTime(); if(( now - begin ) > 10000 ) { clearInterval(this.monitorSourceElement_interval ); } },250); }; this.unloadPreview = function() { if(this.previewPopup && this.previewPopup.has_been_converted_to_persistent ) { return;
 } if(this.animatedLiveSnaps ) { this.animatedLiveSnaps.stopAnimation(); } if(this.previewPopup ) { this.previewPopup.close({ hover:1, no_fade:1 }); } CamPreviewOverlay.deregister(this.selfId ); }; this.mouseDownHandler = function(e ) { var startX = this.config.mfcMouseTracker.absX; var startY = this.config.mfcMouseTracker.absY; CamPreviewOverlay.pressTimer = setTimeout(() => { if(Math.abs(this.config.mfcMouseTracker.absX - startX) > 1 || Math.abs(this.config.mfcMouseTracker.absY - startY) > 1 ) { return; } if(this.previewPopup ) { this.previewPopup.convert_hover_to_persistent(); } this.cancel_mouse_click = true; },500); }; this.mouseUpHandler = function(e ) { var el = e.target; var $el = $(el); if(this.cancel_mouse_click ) { this.cancel_mouse_click = false; return; } clearTimeout(CamPreviewOverlay.pressTimer); var nUserId = $el.data('cpouid'); 
 if(e.which == 1 ) { if(this.sLeftClick == 'nothing' ) { 1; } else if(this.sLeftClick == 'player' ) { TopLoadPlayer({ broadcaster_id: nUserId }); } else if(this.sLeftClick == 'lounge' ) { var lounge = ( ( e.view && e.view.Lounge ) || Lounge ); if(lounge && lounge.VideoCycler ) lounge.VideoCycler.Cycle(nUserId ); } else { popUserMenu = new PopUserMenu(t); popUserMenu.open(nUserId ); } this.unloadPreview(); } if(e.which == 3 ) { e.preventDefault(); e.stopPropagation(); if(this.sRightClick == 'nothing' ) { 1; } else if(this.sRightClick == 'close' ) { this.unloadPreview(); } else { var popUserMenu = new PopUserMenu(t); popUserMenu.open(nUserId ); } } return; };}CamPreviewOverlay.nId = 1;CamPreviewOverlay.hRegister = {};
CamPreviewOverlay.hUserRegister = {};CamPreviewOverlay.aRenderedRegister = [];CamPreviewOverlay.userRegister = function(nUserId ) { return CamPreviewOverlay.hRegister[ nUserId ]; };CamPreay.hRegister[ nId ]; };CamPreviewOverlay.deregister = function(nId ){ var hCamPreview = CamPreviewOverlay.register(nId ); if(! hCamPreview ) { return; } if(hCamPreview.animatedLiveSnaps && hCamPreview.animatedLiveSnaps.selfId ) AnimatedLiveSnaps.deregister(hCamPreview.animatedLiveSnaps.selfId); var nUserId = hCamPreview.nUserId; if(nUserId && CamPreviewOverlay.hUserRegister[nUserId] ) { var remainingEntries = CamPreviewOverlay.hUserRegister[nUserId].filter((val) => { return val.selfId != nId; }); if(remainingEntries.length > 0 ) CamPreviewOverlay.hUserRegister[nUserId] = remainingEntries; else delete CamPreviewOverlay.hUserRegister[nUserId]; } hCamPreview.hostingElements = []; delete CamPreviewOverlay.hRegister[nId];};CamPreviewOverlay.markGroup = function(sGroup ) { 1; }; CamPreviewOverlay.denction(sGroup ) { 1; };CamPreviewOverlay.listenerConfigs = { default: function (optionlay.unloadPreview(); } }; }};$(document).on('mouseenter', '.cpo_listeners', function(e) { var el = e.currentTarget; var $el = $(el); var nSelfId = $el.data('cpo'); var oCpo = CamPreviewOverlay.register(nSelfId); if(! oCpo ) { var nUserId = parseInt($el.data('cpouid'), 10); var camPreviewOverlay = new CamPreviewOverlay({ userId: nUserId
 }); oCpo = CamPreviewOverlay.register(camPreviewOverlay.selfId); $el.data('cpo',oCpo.selfId); oCpo.associateHostElement(el); } oCpo.bLoadOverlay = !!$el.data('cpo_load_overlay'); oCpo.nPreviewWidth = $el.data('cpo_preview_width'); oCpo.sLeftClick = $el.data('cpo_left_click'); oCpo.sRightClick = $el.data('cpo_right_click'); if(oCpo.bLoadOverlay ) { oCpo.renderOverlay(e,el); } else { oCpo.loadPreview(e); }});$(document).on('mousedown', '.cpo_listeners', function(e) { e.stopPropagation(); var el = e.currentTarget; var $el = $(el); var nSelfId = $el.data('cpo'); var oCpo = CamPreviewOverlay.register(nSelfId); if(oCpo && oCpo.mouseDownHandler ) { return oCpo.mouseDownHandler(e); } return false;});$(document).on('contextmenu', '.cpo_listeners', function(e) { e.preventDefault();});$(document).on('mouseup', '.cpo_listeners', function(e) { var el = e.target; var $el = $(el); var nSelfId = $el.data('cpo'); var oCpo = CamPreviewOverlay.register(nSelfId); if(oCpo && oCpo.mouseUpHandler ) { return oCpo.mouseUpHandler(e); }});$(document).on('mousedown, mouseleave', '.cpo_listeners', function(e) { var el = e.currentTarget; var $el = $(el); var nSelfId = $el.data('cpo');
 var oCpo = CamPreviewOverlay.register(nSelfId); if(oCpo ) { if(oCpo.bLoadOverlay ) { oCpo.removeOverlay(e,el); } else if (e.type == "mouseleave") { oCpo.unloadPreview(); } }});

// js_build_core: js/MyWebcam_Publish.js
function MyWebcam_Publish(config){ config = config || {}; var _hPlatform = config.platform; var _hSelf = config.self_user; var _nSessionId = config.self_session_id; var _fLog = config.log_func || function(){}; var _fTxCmd = config.txcmd_func; var _fParseJSON = config.parse_json_func; var _fDone = config.done_func; createRequestObject = function() { if(window.navigator.appName.indexOf('Internet Explorer') > -1) return new ActiveXObject('Microsoft.XMLHTTP'); else return new XMLHttpRequest(); }; this.startPublishRequest = function() { startWebcamAttempts = 0; this.getMyWebcamServers(() => { if (this.hReqVidServ != '' && this.hReqVidServ != null) { var hPubReq = { "_reqid": _hSelf['user_id'] + 500000000, "vidserv": this.hReqVidServ, "room": parseInt(_hSelf['user_id']), }; _fLog('Sending hPubReq: ' + JSON.stringify(hPubReq)); this.waitingForPublishMsg = true; _fTxCmd(FCS.FCTYPE_PUBLISH, _nSessionId, 1, 0, 0, JSON.stringify(hPubReq)); } else _fLog('No videoserver found from modeldirector response.'); }); }; this.getMyWebcamServers = function(oCallback ) { try { var vidServ = localStorage.getItem('c2cVideoServer'); if ( typeof(vidServ) === 'string' && vidServ.match(/^video\d+$/i) ) { _fLog("using c2c videoserver '" + vidServ + "', found in localStorage.getItem('c2cVideoServer')"); this.hReqVidServ = vidServ; if(oCallback ) { oCallback(); } return;
 } } catch (err) {} try { var _oCallback = oCallback; var oReq = createRequestObject(); oReq.open("get", "/modeldirector/?userid=" + parseInt(_hSelf['user_id']) + "&c2c=1&nc=" + Math.random()); oReq.onreadystatechange = () => { if (oReq.readyState != 4) { return; } var serverConfig = null; if ((serverConfig = _fParseJSON(oReq.responseText))) if (serverConfig.hasOwnProperty("videoserver")) this.hReqVidServ = serverConfig.videoserver; if(_oCallback ) { _oCallback(); } }; oReq.send(null); } catch (oError) { _fLog('modeldirector MyWebcam ServerConfig ajax open caught exception: ' + oError.description ); } }; this.onPublishMsg = function(nErr, hData) { this.waitingForPublishMsg = false; var haveToken = false, sErr = '(unknown err)'; if (nErr == FCS.FCRESPONSE_SUCCESS) { if (hData.hasOwnProperty('vidserv')) { if (hData.hasOwnProperty('ctx')) { if (hData.hasOwnProperty('tkx')) { this.hVidServ = hData['vidserv']; this.hVidCtx = hData['ctx']; this.hVidToken = hData['tkx']; _fLog('FCS.FCTYPE_PUBLISH resp received token[' + this.hVidToken + '], serv[' + this.hVidServ + '], vidcontext[' + JSON.stringify(this.hVidCtx) + ']'); haveToken = true;
 } else sErr = 'FCS.FCTYPE_PUBLISH response missing "token" prop'; } else sErr = 'FCS.FCTYPE_PUBLISH response missing "vidctx" prop'; } else sErr = 'FCS.FCTYPE_PUBLISH response missing "vidsrv" prop'; } else sErr = 'FCS.FCTYPE_PUBLISH response err: ' + hData['_msg']; if (!haveToken) { if(hData && hData._err == FCS.FCRESPONSE_NOACCESS ) { alert("To broadcast as a " + _hPlatform.Performer + ", please visit this URL: \n\nhttps://www." + _hPlatform.domain + "/modelweb"); } else { _fLog('DBG: unexpected FCS.FCTYPE_PUBLISH response: ' + sErr + ', obj: ' + JSON.stringify(hData)); alert('DBG: unexpected FCS.FCTYPE_PUBLISH response: ' + sErr + ', obj: ' + JSON.stringify(hData)); } } if (typeof(_fDone) === 'function') _fDone(haveToken); };}

// js_build_core: js/ChatOverlay.js
var ChatOverlay = { bEnabled: false, bActive: false, bFirstRun: true, bFullscreen: false, bChatHidden: false, bCenterToBottom: true, bRecenterOnTopicRender: false, bNightMode:false, nChatHeightAdjustment: 31, nNewMessages: 0, nCurrentOpacity: 0.75, hCache: { hTimers: { nBlur: 0 }, hElements: {} }, events: {}, elements: {}};ChatOverlay.is_supported = function(){ 'use strict'; if(g_UA.mobile || g_UA.tablet ) return false; return true;};ChatOverlay.remove_listeners = function(){ 'use strict'; ChatOverlay.bActive = false; var $chatContainer = $(ChatOverlay.elements.chatContainer); if($chatContainer.data('mfc-listeners') ) { $(document).off('mouseup', ChatOverlay.onMouseUp); $chatContainer.off('mouseenter', ChatOverlay.onFocus); $chatContainer.off('mouseleave', ChatOverlay.onBlur); $('.exit_tab, .chat_exit_link').off('click', ChatOverlay.onExitClick); $chatContainer.off('dblclick', '.move_tab', ChatOverlay.moveTabDblClickEvent); $('.fullscreen_tab').off('click', ChatOverlay.onFullscreenClick); $('.hide_chat_tab, .chat_hide_link').off('click', ChatOverlay.onHideChatClick); $('.show_chat_tab, .chat_show_link').off('click', ChatOverlay.onShowChatClick); $('.chat_tabs .chat_tab').off('mouseenter', ChatOverlay.onTabMouseEnter); $('.chat_tabs .chat_tab').off('mouseleave', ChatOverlay.onTabMouseLeave);
 $('.chat_tab.opacity_tab input').off('change mousemove', ChatOverlay.onOpacitySliderChange); if ( ChatOverlay.fscreen ) ChatOverlay.fscreen.removeEventListener('fullscreenchange', ChatOverlay.onFullscreenChange); ChatOverlay.clear_onBlur_timer(); $chatContainer.data('mfc-listeners', false); } if($chatContainer.draggable('instance') ) $chatContainer.draggable('destroy'); if($chatContainer.resizable('instance') ) $chatContainer.resizable('destroy');};ChatOverlay.storeChatWidthHeight = function($chatContainer ){ 'use strict'; if(typeof($chatContainer) !== 'object' || typeof($chatContainer.width) !== 'function' ) return false; ChatOverlay.hCache.nWidth = $chatContainer.width(); ChatOverlay.hCache.nHeight = $chatContainer.height();};ChatOverlay.init = function(){ 'use strict'; if(! ChatOverlay.bFirstRun ) return; ChatOverlay.bFirstRun = false; try{ var val = localStorage.co_bgcolor_opacity; if ( ! isNaN(val) ) { ChatOverlay.nCurrentOpacity = val; } } catch(e) {} $('.chat_tab.opacity_tab input').val(ChatOverlay.nCurrentOpacity); ChatOverlay.initFullscreenObj();};ChatOverlay.onOpacitySliderChange = function(e) { var val = $(this).val();
 if ( val === ChatOverlay.nCurrentOpacity ) return; ChatOverlay.setOpacity(val);};ChatOverlay.setOpacity = function(val) { ChatOverlay.nCurrentOpacity = val; if ( ! ChatOverlay.hCache.hElements.oChatBorderBgColor ) ChatOverlay.hCache.hElements.oChatBorderBgColor = $('.chat_border_bgcolor'); if ( ChatOverlay.bNightMode ) { ChatOverlay.hCache.bgColor = ChatOverlay.hCache.hElements.oChatBorderBgColor.css('backgroundColor').replace(/(rgb[a]?)(\([^,]+,[^,]+,[^,]+[,]*\s*)([\d\.]*)(\))$/, function(x,a,b,c,d) { return 'rgba(0,0,0,'+val+')'; } ); } else { ChatOverlay.hCache.bgColor = ChatOverlay.hCache.hElements.oChatBorderBgColor.css('backgroundColor').replace(/(rgb[a]?)(\([^,]+,[^,]+,[^,]+[,]*\s*)([\d\.]*)(\))$/, function(x,a,b,c,d) { return 'rgba' + b + (a == 'rgba' ? val : (', '+val)) + String(d); } ); } ChatOverlay.hCache.hElements.oChatBorderBgColor.css('backgroundColor', ChatOverlay.hCache.bgColor); delete ChatOverlay.hCache.bgColor_halfAlpha; try{ localStorage.co_bgcolor_opacity = val; } catch(e) {}};ChatOverlay.onTabMouseEnter = function(e) { 'use strict'; if(ChatOverlay.hCache.bDragging ) return; $(e.currentTarget).addClass('hovering');};ChatOverlay.onTabMouseLeave = function(e) { 'use strict'; $(e.currentTarget).removeClass('hovering');};ChatOverlay.onBlur = function(hOptions){ 'use strict'; hOptions = hOptions || {}; ChatOverlay.clear_onBlur_timer(); if(ChatOverlay.hCache.bDragging || ChatOverlay.hCache.bResizing || ChatOverlay.hCache.bLockFocus ) return; if(ChatOverlay.hCache.bInFocus === false ) return; var fExecute = function(){
 ChatOverlay.hCache.bInFocus = false; ChatOverlay.hCache.hElements.$body.addClass('chat_overlay_mode_blur'); var $bgColor = $('.chat_border_bgcolor'); if($bgColor ) { if(! ChatOverlay.hCache.bgColor_halfAlpha ) ChatOverlay.hCache.bgColor_halfAlpha = $bgColor.css('backgroundColor').replace(/(rgb[a]?)(\([^,]+,[^,]+,[^,]+[,]*\s*)([\d\.]*)(\))$/, function(x,a,b,c,d) { return 'rgba' + b + ( c ? ( parseFloat(c) / 2 ) : ', 0.5') + d; } ); if(ChatOverlay.hCache.bgColor_halfAlpha ) { $bgColor.css('backgroundColor',ChatOverlay.hCache.bgColor_halfAlpha); } } }; if(hOptions.immediate ) fExecute(); else ChatOverlay.hCache.hTimers.nOnBlur = setTimeout(fExecute, 500);};ChatOverlay.clear_onBlur_timer = function(){ 'use strict'; if(ChatOverlay.hCache.hTimers.nOnBlur > 0 ) { clearTimeout(ChatOverlay.hCache.hTimers.nOnBlur); ChatOverlay.hCache.hTimers.nOnBlur = 0; }};ChatOverlay.onMouseUp = function(e){ 'use strict'; var $chatContainer = ChatOverlay.hCache.hElements.$chatContainer; if($chatContainer.is(e.target) || $chatContainer.has(e.target).length ) { ChatOverlay.hCache.bLockFocus = true; ChatOverlay.onFocus(); } else { ChatOverlay.hCache.bLockFocus = false; ChatOverlay.onBlur({ immediate: true }); }};ChatOverlay.onFocus = function(){ 'use strict';
 ChatOverlay.clear_onBlur_timer(); if(ChatOverlay.hCache.bInFocus === true ) return; ChatOverlay.hCache.bInFocus = true; ChatOverlay.hCache.hElements.$body.removeClass('chat_overlay_mode_blur'); if(ChatOverlay.hCache.bgColor ) $('.chat_border_bgcolor').css('backgroundColor',ChatOverlay.hCache.bgColor);};ChatOverlay.onFullscreenClick = function(e){ 'use strict'; if(e && typeof(e.stopPropagation) === 'function' ) { e.preventDefault(); e.stopPropagation(); } if ( ! ChatOverlay.fscreen ) return false; if ( ! ChatOverlay.fscreen.fullscreenElement ) { ChatOverlay.fscreen.requestFullscreen($(ChatOverlay.elements.fullscreen)[0] ); } else { ChatOverlay.exitFullscreen(); } return false;};ChatOverlay.setFullscreenImg = function(){ var onOrOff = ( ChatOverlay.fscreen && ChatOverlay.fscreen.fullscreenElement ) ? 'on' : 'off'; var img = $('.fullscreen_tab img'); img.prop('src', img.data(onOrOff));};ChatOverlay.exitFullscreen = function(){ 'use strict'; if ( ChatOverlay.fscreen && ChatOverlay.fscreen.fullscreenElement ) { var result = ChatOverlay.fscreen.exitFullscreen(); if ( result != null && typeof(result) === 'object' && typeof(result.then) === 'function' ) { result.then(ChatOverlay.onFullscreenExit); } else {
 ChatOverlay.onFullscreenExit(); } }};ChatOverlay.newMessages = function(numOfMessages){ 'use strict'; numOfMessages = parseInt(numOfMessages, 10); if ( isNaN(numOfMessages) ) numOfMessages = 0; if ( ! ChatOverlay.hCache.hElements.oNewMessages ) ChatOverlay.hCache.hElements.oNewMessages = $('.show_chat_tab_new_messages'); if(numOfMessages < 0 ) { if(ChatOverlay.nNewMessages ) { ChatOverlay.nNewMessages = 0; ChatOverlay.hCache.hElements.oNewMessages.text('').hide(); } } else if(ChatOverlay.bEnabled && ChatOverlay.bChatHidden ) { ChatOverlay.nNewMessages += numOfMessages; if(ChatOverlay.nNewMessages ) ChatOverlay.hCache.hElements.oNewMessages.text(ChatOverlay.nNewMessages).show(); }};ChatOverlay.onShowChatClick = function(e){ 'use strict'; if(e && typeof(e.stopPropagation) === 'function' ) { e.preventDefault(); e.stopPropagation(); } ChatOverlay.toggleHideChat(false); ChatOverlay.newMessages(-1);};ChatOverlay.onHideChatClick = function(e){ 'use strict'; if(e && typeof(e.stopPropagation) === 'function' ) { e.preventDefault();
 e.stopPropagation(); } ChatOverlay.toggleHideChat(true);};ChatOverlay.onExitClick = function(e){ 'use strict'; if(e && typeof(e.stopPropagation) === 'function' ) { e.preventDefault(); e.stopPropagation(); } ChatOverlay.toggle(false); return false;};ChatOverlay.centerToContainer = function() { if ( ! ChatOverlay.bEnabled || ! ChatOverlay.bCenterToBottom ) return; if ( ! ChatOverlay.hCache.hElements.oCenterToContainer ) ChatOverlay.hCache.hElements.oCenterToContainer = $(ChatOverlay.elements.centerToContainer); if ( ! ChatOverlay.hCache.hElements.oChatContainerOffsetParent ) ChatOverlay.hCache.hElements.oChatContainerOffsetParent = $(ChatOverlay.elements.chatContainerOffsetParent); if ( ! ChatOverlay.hCache.hElements.oShowChatTab ) ChatOverlay.hCache.hElements.oShowChatTab = $('.show_chat_tab'); var newCss = {top: ''}; var centerContainerParentOffset = ChatOverlay.hCache.hElements.oCenterToContainer.offset(); var chatContainerParentOffset = ChatOverlay.hCache.hElements.oChatContainerOffsetParent.offset(); var centerContainerBottom = centerContainerParentOffset.top + ChatOverlay.hCache.hElements.oCenterToContainer.outerHeight(true); var centerParentHeight = chatContainerParentOffset.top + ChatOverlay.hCache.hElements.oChatContainerOffsetParent.outerHeight(true); var padding = 0; var chatOverlayBorderPadding = 1; if ( ! ChatOverlay.hCache.hElements.chatContainerBorderPadding ) { var cssProps = ['borderLeftWidth', 'borderRightWidth', 'paddingLeft', 'paddingRight']; for (var i = cssProps.length - 1; i >= 0; i--) { chatOverlayBorderPadding += parseInt(ChatOverlay.hCache.hElements.$chatContainer.css(cssProps[i]), 10)|0; } ChatOverlay.hCache.hElements.chatContainerBorderPadding = chatOverlayBorderPadding; } else { chatOverlayBorderPadding = ChatOverlay.hCache.hElements.chatContainerBorderPadding;
 } var bottomPadding = ChatOverlay.bottomPadding || 30; newCss.bottom = ( (centerParentHeight - centerContainerBottom) + padding + bottomPadding ) + 'px'; newCss.left = ( (centerContainerParentOffset.left - chatContainerParentOffset.left) + padding ) + 'px'; newCss.width = ( ChatOverlay.hCache.hElements.oCenterToContainer.width() - ((padding*2) + chatOverlayBorderPadding) + 1 ) + 'px'; ChatOverlay.hCache.hElements.$chatContainer.css(newCss); delete newCss.width; newCss.bottom = ( parseInt(newCss.bottom, 10) + 10 ) + 'px'; newCss.left = ( parseInt(newCss.left, 10) + 2 ) + 'px'; ChatOverlay.hCache.hElements.oShowChatTab.css(newCss);};ChatOverlay.pixelsToPercentage = function() { if ( ! ChatOverlay.bEnabled || ChatOverlay.bCenterToBottom ) return; if ( ! ChatOverlay.hCache.hElements.oChatContainerOffsetParent ) ChatOverlay.hCache.hElements.oChatContainerOffsetParent = $(ChatOverlay.elements.chatContainerOffsetParent); var position = ChatOverlay.hCache.hElements.$chatContainer.position(); var offsetParent = ChatOverlay.hCache.hElements.oChatContainerOffsetParent; var left = Math.max(0.25, (position.left / offsetParent.width()) * 100); var top = Math.max(1, (position.top / offsetParent.height()) * 100); ChatOverlay.hCache.nLeft = left; ChatOverlay.hCache.nTop = top; ChatOverlay.hCache.hElements.$chatContainer.css({ 'bottom': '', 'left': left + '%', 'top': top + '%' });};ChatOverlay.toggleHideChat = function(bOnOrOff ){ 'use strict'; bOnOrOff = !!bOnOrOff; var $body = $('body'); if(bOnOrOff ) { $body.addClass('chat_hidden'); } else { $body.removeClass('chat_hidden'); }
 if(ChatOverlay.bChatHidden != bOnOrOff ) { ChatOverlay.bChatHidden = bOnOrOff; if ( typeof(ChatOverlay.events.toggleHideChat) === 'function' ) ChatOverlay.events.toggleHideChat(ChatOverlay.bChatHidden); }};ChatOverlay.toggle = function(bOnOrOff ){ 'use strict'; if(! this.is_supported() ) return false; this.init(); bOnOrOff = !!bOnOrOff; var $body = $('body'); var $bgColor = $('.chat_border_bgcolor'); var $chatContainer = $(ChatOverlay.elements.chatContainer); var $chatTd = $(ChatOverlay.elements.chatTd); ChatOverlay.bNightMode = $body.hasClass('nightmode'); $chatContainer.addClass('chat_overlay_chat_container'); $chatTd.addClass('chat_overlay_chat'); if(bOnOrOff ) { ChatOverlay.bActive = true; ChatOverlay.bCenterToBottom = true; $body.addClass('chat_overlay_mode'); if(! $chatContainer.data('mfc-listeners') ) { ChatOverlay.hCache.hElements = {}; ChatOverlay.hCache.hElements.$body = $body; ChatOverlay.hCache.hElements.$chatContainer = $chatContainer; $(document).on('mouseup', ChatOverlay.onMouseUp); $chatContainer.on('mouseenter', ChatOverlay.onFocus); $chatContainer.on('mouseleave', ChatOverlay.onBlur); $('.exit_tab, .chat_exit_link').on('click', ChatOverlay.onExitClick); $('.hide_chat_tab, .chat_hide_link').on('click', ChatOverlay.onHideChatClick); $('.show_chat_tab, .chat_show_link').on('click', ChatOverlay.onShowChatClick); $('.chat_tabs .chat_tab').on('mouseenter', ChatOverlay.onTabMouseEnter);
 $('.chat_tabs .chat_tab').on('mouseleave', ChatOverlay.onTabMouseLeave); $('.chat_tab.opacity_tab input').on('change mousemove', ChatOverlay.onOpacitySliderChange); if ( ChatOverlay.fscreen && ChatOverlay.fscreen.fullscreenEnabled ) { ChatOverlay.setFullscreenImg(); $('.fullscreen_tab').removeClass('hide').on('click', ChatOverlay.onFullscreenClick); ChatOverlay.fscreen.addEventListener('fullscreenchange', ChatOverlay.onFullscreenChange); } ChatOverlay.hCache.bLockFocus = false; setTimeout(function(){ ChatOverlay.onFocus(); }, 1); if ( ! isArray(ChatOverlay.elements.resizeSensors) ) { if ( ChatOverlay.elements.resizeSensors ) ChatOverlay.elements.resizeSensors = [ ChatOverlay.elements.resizeSensors ]; else ChatOverlay.elements.resizeSensors = []; } if ( ChatOverlay.elements.resizeSensors.length && typeof(ResizeObserver) === 'function' ) { ChatOverlay.hCache.resizeObserverTimer = 0; ChatOverlay.hCache.resizeObserver = new ResizeObserver(function(entries) { if ( ChatOverlay.hCache.resizeObserverTimer > 0 ) { clearTimeout(ChatOverlay.hCache.resizeObserverTimer); } ChatOverlay.hCache.resizeObsecenterToContainer(); }, 50); }); for (var i = 0; i < ChatOverlay.elements.resizeSensors.length; i++) { ChatOverlay.hCache.resizeObserver.observe($(ChatOverlay.elements.resizeSensors[i])[0]); } } $chatContainer.data('mfc-listeners', true); } ChatOverlay.setOpacity(ChatOverlay.nCurrentOpacity); if(! $chatContainer.draggable('instance') ) { var keepColor; var scrollAdjustment = 0;
 $chatContainer.draggable({ 'handle': '.move_tab', 'containment': ChatOverlay.elements.dragContainment, 'scroll': true, 'start': function(){ ChatOverlay.bCenterToBottom = false; scrollAdjustment = $body.scrollTop(); ChatOverlay.onFocus(); ChatOverlay.hCache.bDragging = true; $chatContainer.css('bottom', ''); if ( typeof(ChatOverlay.events.onMoveStart) === 'function' ) ChatOverlay.events.onMoveStart(); }, 'stop': function(e, ui) { ChatOverlay.storeChatWidthHeight($chatContainer); ChatOverlay.pixelsToPercentage(); ChatOverlay.hCache.bDragging = false; if ( typeof(ChatOverlay.events.onMoveStop) === 'function' ) ChatOverlay.events.on+= scrollAdjustment; } }); } if(! $chatContainer.resizable('instance') ) { $chatContainer.resizable({ 'helper': 'ui-resizable-helper', 'handles': 'all', 'minWidth': 400, 'minHeight': 150, 'start': function() { ChatOverlay.bCenterToBottom = false; ChatOverlay.onFocus(); ChatOverlay.hCache.bResizing = true; if ( typeof(ChatOverlay.events.onResize) === 'function' ) ChatOverlay.events.onResize(true); }, 'stop': function(e,ui) { ChatOverlay.storeChatWidthHeight($chatContainer); ChatOverlay.pixelsToPercentage(); ChatOverlay.hCache.bResizing = false; if ( typeof(ChatOverlay.events.onResize) === 'function' ) ChatOverlay.events.onResize(false); }
 }); } if ( ! ChatOverlay.bCenterToBottom ) { if ( typeof(ChatOverlay.hCache.nWidth) !== 'undefined' && typeof(ChatOverlay.hCache.nHeight) !== 'undefined' ) { $chatContainer.css({ 'width': ChatOverlay.hCache.nWidth + 'px', 'height': ChatOverlay.hCache.nHeight + 'px' }); } if ( typeof(ChatOverlay.hCache.nLeft) !== 'undefined' && typeof(ChatOverlay.hCache.nTop) !== 'undefined' ) { $chatContainer.css({ 'top': ChatOverlay.hCache.nTop + '%', 'left': ChatOverlay.hCache.nLeft + '%' }); } } $chatContainer.on('dblclick', '.move_tab', ChatOverlay.moveTabDblClickEvent); } else { if ( ChatOverlay.hCache.resizeObserverTimer > 0 ) { clearTimeout(ChatOverlay.hCache.resizeObserver); ChatOverlay.hCache.resizeObserverTimer = 0; } if ( ChatOverlay.hCache.resizeObserver ) { ChatOverlay.hCache.resizeObserver.disconnect(); ChatOverlay.hCache.resizeObserver = void(0); } ChatOverlay.toggleHideChat(false); ChatOverlay.exitFullscreen(); $body.removeClass('chat_overlay_mode'); $bgColor.css('backgroundColor', ''); $chatContainer.css({'width': '', 'height': '', 'top': '', 'bottom': '', 'left': ''}); this.remove_listeners();
 } if(ChatOverlay.bEnabled != bOnOrOff ) { ChatOverlay.bEnabled = bOnOrOff; if ( typeof(this.events.onToggle) === 'function' ) this.events.onToggle(bOnOrOff); this.resize_elements(true); if ( ChatOverlay.bcenterToContainer(); }, 50); } }};ChatOverlay.onFullscreenChange = function(){ 'use strict'; ChatOverlay.setFullscreenImg(); if ( ChatOverlay.fscreen && ChatOverlay.fscreen.fullscreenElement ) { ChatOverlay.bFullscreen = true; $('body').addClass('chat_overlay_mode_fullscreen'); if ( typeof(ChatOverlay.events.onFullscreenChange) === 'function' ) setTimeout(function(){ ChatOverlay.events.onFullscreenChange(ChatOverlay.bFullscreen); }, 1); } else { ChatOverlay.onFullscreenExit(); }};ChatOverlay.onFullscreenExit = function() { if ( ChatOverlay.bFullscreen ) { ChatOverlay.bFullscreen = false; $('body').removeClass('chat_overlay_mode_fullscreen'); if ( typeof(ChatOverlay.events.onFullscreenChange) === 'verlay.bFullscreen); }, 1); }};ChatOverlay.moveTabDblClickEvent = function(e){ e.preventDefault(); ChatOverlay.bCenterToBottom = true; ChatOverlay.hCache.hElements.$chatContainer.css('height', '');
 if ( typeof(ChatOverlay.events.onResize) === 'function' ) ChatOverlay.events.onResize(false); ChatOverlay.centerToContainer();};ChatOverlay.resize_elements = function(bForceRun){ bForceRun = !!bForceRun; if ( typeof(this.events.resizeElements) === 'function' ) this.events.resizeElements(bForceRun);};ChatOverlay.initFullscreenObj = function(){ if ( ChatOverlay.fscreen ) { return; } var key = { fullscreenEnabled: 0, fullscreenElement: 1, requestFullscreen: 2, exitFullscreen: 3, fullscreenchange: 4, fullscreenerror: 5 }; var webkit = ['webkitFullscreenEnabled', 'webkitFullscreenElement', 'webkitRequestFullscreen', 'webkitExitFullscreen', 'webkitfullscreenchange', 'webkitfullscreenerror']; var moz = ['mozFullScreenEnabled', 'mozFullScreenElement', 'mozRequestFullScreen', 'mozCancelFullScreen', 'mozfullscreenchange', 'mozfullscreenerror']; var ms = ['msFullscreenEnabled', 'msFullscreenElement', 'msRequestFullscreen', 'msExitFullscreen', 'MSFullscreenChange', 'MSFullscreenError']; var document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {}; var vendor = 'fullscreenEnabled' in document && Object.keys(key) || webkit[0] in document && webkit || moz[0] in document && moz || ms[0] in document && ms || []; var _default = { requestFullscreen: function requestFullscreen(element) { return element[vendor[key.requestFullscreen]](); }, requestFullscreenFunction: function requestFullscreenFunction(element) { return element[vendor[key.requestFullscreen]]en]].bind(document); }, addEventListener: function addEventListener(type, handler, options) { return document.addEventListener(vendor[key[type]], handler, options); }, removeEventListener: function removeEventListener(type, handler, options) { return document.removeEventListener(vendor[key[type]], handler, options); },ullscreenEnabled]]); }, set fullscreenEnabled(val) {}fullscreenElement]]; }, set fullscreenElement(val) {}, get onfullscreenchange() { return document["on".concat(vendor[key.fullscreenchange]).toLowerCase()]; }, set onfullscreenchange(handler) { return document["on".concat(vendor[key.fullscreenchange]).toLowerCase()] = handler; }, get onfullscreenerror() { return document["on".concat(vendor[key.fullscreenerror]).toLowerCase()]; }, set onfullscreenerror(handler) { return document["on".concat(vendor[key.fullscreenerror]).toLowerCase()] = handler; } }; ChatOverlay.fscreen = _default;};

// js_build_core: js/MfcDomPatcher.js
function MfcDomPatcher() {}MfcDomPatcher.prototype.patch = function(existingEl, newContent, options){ options = options || {}; var origNewContent = newContent; if ( typeof(newContent) === 'string' && this._domParserSupported() ) { var parsed = (new DOMParser()).parseFromString(newContent, "text/html"); if ( MfcDomPatcher.prototype._useImportNode ) { newContent = existingEl.ownerDocument.importNode(parsed.body, true); } else { newContent = parsed.body; } }
 var morphdomOptions alse; } return true; } }; if ( options.hasOwnProperty('childrenOnly') ) morphdomOptions.childrenOnly = !!options.childrenOnly; try { morphdom(existingEl, newContent, morphdomOptions); } catch (e) { if ( e.toString().match(/\bWrongDocumentError\b/i) && ! MfcDomPatcher.prototype._useImportNode ) { MfcDomPatcher.prototype._useImportNode = true; return this.patch(existingEl, origNewContent, options); } console.log("MfcDomPatcher error: " + e.toString()); return false; } return true;};MfcDomPatcher.prototype._domParserSupported = function(){ if ( MfcDomPatcher.prototype._domParserSupportedCache === undefined ) { try { if ((new DOMParser()).parseFromString("", "text/html")) { MfcDomPatcher.prototype._domParserSupportedCache = true; } } catch (ex) { MfcDomPatcher.prototype._domParserSupportedCache = false; } } return MfcDomPatcher.prototype._domParserSupportedCache;};
MfcDomPatcher.prototype._useImportNode = false;MfcDomPatcher.prototype._domParserSupportedCache = undefined;

// js_build_core: js/shared_functions.js
var g_hWindows = {};var g_UA = new MfcUserAgent();var g_oMouseTracker = new MfcMouseTracker();document.onmousemove = function(event) { g_oMouseTracker.track_mouse(event); };var isCrossSiteIframe = location.search.match(/calling_mode=independent|style_override=profiles|style=mobile/);var g_sWindowType = 'external_embed';if(! isCrossSiteIframe ){ if(window.opener ) { g_sWindowType = 'popup'; } else if(top.window != self.window ) { g_sWindowType = 'iframe'; } else { g_sWindowType = 'main'; }}if(g_UA.isTouchDevice() ){ document.addEventListener('touchstart', function(event) { g_oMouseTracker.track_finger(event); } );}else{}if(g_ExternalCaller ) PageDimensionsInHash();if(g_UA.IE < 9 ) ConsoleObjectStub();window.NightMode && NightMode.Load();
function ConsoleObjectStub() { var method; var noop = function () {}; var methods = [ 'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error', 'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log', 'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd', 'timeStamp', 'trace', 'warn' ]; var length = methods.length; var console = (window.console = window.console || {}); while (length--) { method = methods[length]; if (!console[method]) { console[method] = noop; } }}function PageDimensionsInHash(){ setTimeout(PageDimensionsInHash_Delayed, 500 ); setTimeout(PageDimensionsInHash_Delayed, 2501 ); setTimeout(PageDimensionsInHash_Delayed, 5500 );}function PageDimensionsInHash_Delayed(){ var nHeight = 1000; if(document.height ) { nHeight = document.height; } else if (document.body) { if(document.body.scrollHeight ) nHeight = scrollHeight = document.body.scrollHeight; if(document.body.offsetHeight )
 nHeight = offsetHeight = document.body.offsetHeight; if(scrollHeight && offsetHeight ) nHeight = Math.max(scrollHeight, offsetHeight); } window.location.replace('#' + 'height=' + nHeight );}function ApplyStyle(){ if(parent && parent.location != location && ! opener && document.body && document.body.className=='outer_body' && location.href.indexOf('/pm') == -1 && location.href.indexOf('chat_logs.php') == -1 && location.href.indexOf('user_settings.php') == -1 && location.href.indexOf('user_notepad.php') == -1 ) { document.body.className='inner_body'; return true; } return false;}function AssertTop(){ try { if(bPopup ) { var nCase = 0; if(g_UA.IE && ( ! t || ( t.name != 'top_level' ) ) ) nCase = 1;
 if(t && t.closed == true ) nCase = 2; if(g_bCloseWindow == true ) nCase = 3; if(nCase ) { window.close(); return; } if(( ! t || ( t && t.name != 'top_level' ) ) && opener && opener.t ) { t = opener.t; } if(! this._ourInstanceVer ) { this._ourInstanceVer = t._ourInstanceVer; } if(! this._ourInstanceVer || ( this._ourInstanceVer != t._ourInstanceVer) ) { window.close(); return; } } } catch(e) { window.close(); return; } setTimeout(AssertTop,1000);}var g_bBypassResizeWindow = 0;function ResizeWindow(){ if(g_bBypassResizeWindow ) { return; } try { if(! opener || navigator.appName.indexOf('Microsoft') == -1 || location.href.indexOf('account.php') > -1 || location.href.indexOf('admin') > -1 || history.length > 0
 ) { return; } if(document.readyState=='complete') { if(document.body.offsetHeight > document.body.scrollHeight) { window.resizeTo(document.body.offsetWidth,document.body.scrollHeight + 95); } else if(document.body.offsetHeight < t.oPopupHeight && document.body.scrollHeight > t.oPopupHeight) { window.resizeTo(document.body.offsetWidth,t.oPopupHeight); } } } catch(e) { };}function Navigation(){ return " <div class=footer_include style='clear:left;'> Visit <a href=/"+"/www." + document.domain.replace(/.*?(\w+\.\w+)$/,"$1") + "/><b>" + ( t && t.g_hPlatform && t.g_hPlatform.name ) + ".com</b></a> </div> ";}function CloseWindow(){ if(t && t.g_hSelf && ( ( ( t.g_hSelf.window_mode & WINDOW_MODE_MOBILE_DHTML ) && ( g_UA.tablet || g_UA.mobile || t.location.search.match(/dhtmlwindow/) ) ) || ( ( t.g_hSelf.window_mode & WINDOW_MODE_DESKTOP_DHTML ) && ( ! g_UA.tablet && ! g_UA.mobile ) ) ) ) { for(var sWindowKey in t.g_hWindows ) { if(t.g_hWindows[ sWindowKey ].window == window ) { t.g_hWindows[ sWindowKey ].close(); } } }
 else { window.close(); }}function RegisterWindow(hConfig ){ if(typeof(hConfig) != 'object' ) { console.log('RegisterWindow called without config' ); return; } var sWindowKey = hConfig.name.toString(); hConfig.initializing = 1; hConfig.window_id = Math.abs(MfcCrc32.prototype.string(sWindowKey )); if(hConfig.window ) { setTimeout(function() { try { hConfig.window.window_id = hConfig.window_id; if(hConfig.window.name != 'top_level' ) { hConfig.window.name = sWindowKey; } } catch(e) { console.log(e); } },500 ); } if(! t.g_hWindows ) { t.g_hWindows = {}; } delete t.g_hWindows[ sWindowKey ]; t.g_hWindows[ sWindowKey ] = {}; for(var k in hConfig ) t.g_hWindows[sWindowKey][k] = hConfig[k]; if(t.LoadWindowsList ) { t.LoadWindowsList(); }}RegisterWindow.renameWindow = function(oldName, newName, oWindow ){ var subjectWindow = t.g_hWindows[ oldName ]; if(! subjectWindow ) { return; }
 if(subjectWindow.window != oWindow ) { return; } delete t.g_hWindows[ oldName ]; t.g_hWindows[ newName ] = subjectWindow; oWindow.name = newName;};function TopLoadPlayer(hOpts, e ){ var _event = e || window.event; var bPlayerMiddleClick = ( !!_event && _event.which == 2 && hOpts.broadcaster_id ); if(_event && _event.button != 0 && ! bPlayerMiddleClick ) { return; } if(_event ) { _event.preventDefault(); } var hR = g_hResources['player']; if(( _event && _event.shiftKey ) || hOpts.new_window || hOpts.target == 'new_window' || bPlayerMiddleClick ) { A_Click(e,{ window_key: ( FCS.CHANNEL_ID_START + parseInt(hOpts.broadcaster_id ) ).toString(), page: hR['page'] + '?' + MfcStringUtilities.qs_from_obj(hOpts), window_params: hR['new_window'], target: 'new_window', resource: 'player' }); } else if(t.Load ) { t.player.Load('player',hOpts); } else if(window.player && player.LoadPlayer ) { player.LoadPlayer('player',hOpts); } else { console.log("TopLoadPlayer can't find player."); }}function A_Click(oEvent, hOpts ){ if(! hOpts && oEvent && oEvent.target ) { if(oEvent && oEvent.which != 1 && oEvent.which != 2 ) { return; } var el = oEvent.target; var data; while(el.parentNode ) { if(data = el.getAttribute('data-a_click') ) { break; } el = el.parentNode; } if(data ) { hOpts = JSON.parse(data ); } else {
 return; } } else if(! hOpts ) { console.log('A_Click called without options or tag data', hOpts ); return; } if(oEvent && oEvent.preventDefault ) { oEvent.preventDefault(); } if(oEvent && oEvent.button == 1 ) { hOpts.target = 'new_window'; } if(t && t.g_hSelf && t.g_hSelf['rule_violation'] == 1 ) return; var hResource = g_hResources[ hOpts.resource ] || ( t && t.g_hResources && t.g_hResources[ hOpts.resource ] ); if(! g_hResources[ hOpts.resource ] ) hOpts.page = hOpts.page || ( g_hResources[ hOpts.resource ] && g_hResources[ hOpts.resource ].page ); hOpts.window_params = hOpts.window_params || {}; if(t.g_hSelf && ! t.g_hSelf.access_level && ( hOpts.resource == 'login' || hOpts.resource == 'register' ) ) { hOpts.window_params.force_dhtml_window = 1; } if(! hResource['page'] ) { if(t && t.Load ) { hOpts.a_click_callback = true; t.Load(hOpts.resource, hOpts.window_params, oEvent ); } return; } else { var sQueryString = (typeof hOpts.page != 'undefined' && hOpts.page.split('?')[1] != 'undefined') ? hOpts.page.split('?')[1] : "";  hOpts.page = MfcStringUtilities.parse_template(hResource['page'], hOpts.window_params );
 if(! hResource['no_query_string'] ) { for (sKey in hOpts.window_params) { if(sKey && hOpts.window_params[sKey] && sKey != 'anchor' && sKey != 'title' && sKey != 'path' ) { sQueryString += sKey + "=" + encodeURIComponent(hOpts.window_params[sKey]) + "&"; } } var mobile_enable = ( !!hOpts.window_params.mobile_ready && window.location.href.indexOf("style=mobile") > -1 ) ? 'style=mobile' : ''; sQueryString = sQueryString.replace('mobile_ready=1',mobile_enable); if(sQueryString ) { hOpts.page += (( -1 < hOpts.page.indexOf("?")) ? '&' : '?') + sQueryString; } } } if(!!hOpts.window_params['anchor'] ) { hOpts.page += '#'+hOpts.window_params['anchor']; } if(! hOpts.target ) { if(hOpts.resource == 'player' && window.name != 'top_level' && window.name && window.LoadPlayer ) { window.LoadPlayer('player',{ 'broadcaster_id': hOpts.window_params.broadcaster_id }); return; } else if(hOpts.resource == 'player' || hOpts.resource == 'homepage' ) { hOpts.target = 'main'; } else { hOpts.target = 'new_window'; } } if(! hOpts.window_key && hOpts.resource ) { 
 if(hOpts.resource == 'player' ) { hOpts.window_key = PublicChannel(parseInt(hOpts.window_params.broadcaster_id || 0 ) ); } else if(hOpts.window_params && ( hOpts.window_params.user_id || hOpts.window_params.broadcaster_id ) ) { hOpts.window_key = hOpts.resource + parseInt(hOpts.window_params.user_id || hOpts.window_params.broadcaster_id ); } else { hOpts.window_key = hOpts.resource; } }
 if(hOpts.resource && typeof(hOpts.resource) == 'string' && ! hOpts.resource.match(/my_profile|bio|profiles/) ) { if(t && t.g_hPlatform && t.g_hPlatform.id != PLAT_MFC ) hOpts.page = MfcStringUtilities.query_string_append(hOpts.page, 'platform', t.g_hPlatform.id ); hOpts.page = MfcStringUtilities.query_string_append(hOpts.page, 'vcc', ( ( t && t.g_nVcc ) || Math.random() ) ); if(NightMode && NightMode.enabled ) { hOpts.window_params.night_mode = 1; hOpts.page = MfcStringUtilities.query_string_append(hOpts.page, 'night_mode', 1 ); } } var hResource = {}; if(g_hResources && hOpts.resource && g_hResources[hOpts.resource] ) { hResource = g_hResources[hOpts.resource]; } var aMatches = []; if(hResource.position == 'center' ) { var nHeight = hOpts.window_params.height || 0; var nWidth = hOpts.window_params.width || 0; if(nWidth && nHeight ) { hOpts.window_params.top = parseInt(window.innerHeight / 2 ) - parseInt(nHeight / 2 ); hOpts.window_params.left = parseInt(window.innerWidth / 2 ) - parseInt(nWidth / 2 ); if(hOpts.resource == 'tip' && hOpts.window_params.left < 500 ) { hOpts.window_params.left = 500; } } } else if(aMatches = t.location.search.match(/popup_(\w+)=\w+/g ) ) { for(var a=0; a<aMatches.length; a++ ) hOpts.window_params[ aMatches[a].replace(/popup_/,'') ] = 1; } var bUsingDHTMLWindows = false; if(t.g_hSelf && ( ( ( t.g_hSelf.window_mode & WINDOW_MODE_MOBILE_DHTML ) && ( g_UA.tablet || g_UA.mobile || t.location.search.match(/dhtmlwindow/) ) ) || ( ( t.g_hSelf.window_mode & WINDOW_MODE_DESKTOP_DHTML ) && ( ! g_UA.tablet && ! g_UA.mobile ) ) ) ) { bUsingDHTMLWindows = true; } if(t.g_hWindows[ hOpts.window_key ] && t.g_hWindows[ hOpts.window_key ].type == 'native_window' && ! hOpts.window_params.force_dhtml_window ) { bUsingDHTMLWindows = false; } else if(t.g_hWindows[ hOpts.window_key ] && t.g_hWindows[ hOpts.window_key ].type == 'dhtml_window' && ! hOpts.window_params.force_native_window ) { bUsingDHTMLWindows = true; } else if(hOpts.window_params.force_native_window ) { bUsingDHTMLWindows = false; } else if(hOpts.window_params.force_dhtml_window ) { bUsingDHTMLWindows = true; } else if(t.name == 'top_level' && ( hOpts.window_params.force_dhtml_window || window.fullScreen || ( window.innerWidth == screen.width && window.innerHeight == screen.height )
 ) ) { bUsingDHTMLWindows = true; } else if(bUsingDHTMLWindows && ( hOpts.page.match(/\/\/wiki\.\w+\.com/) || hOpts.page.match(/\/\/profiles\.\w+\.com/) ) ) { bUsingDHTMLWindows = false; } var bWindowExists = false; var bCloseExistingWindow = ''; var bOpenANewWindow = false; var bReturnMainToHomepage = false; if(t && t.g_hWindows && t.g_hWindows[ hOpts.window_key ] ) { bWindowExists = true; if(hOpts.target == 'same' ) { 1; } else if(hOpts.target == 'new_window' && t.g_hWindows[ hOpts.window_key ].type == 'main' ) { bReturnMainToHomepage = true; bOpenANewWindow = true; } else if(hOpts.target == 'main' && t.g_hWindows[ hOpts.window_key ].type != 'main' ) { bCloseExistingWindow = true; } else if(( t.g_hWindows[ hOpts.window_key ].type == 'dhtml_window' && ! bUsingDHTMLWindows ) || ( t.g_hWindows[ hOpts.window_key ].type == 'native_window' && bUsingDHTMLWindows ) ) { bCloseExistingWindow = true; bOpenANewWindow = true;
 } } if(bCloseExistingWindow ) { var illFatedWindow = t.g_hWindows[ hOpts.window_key ]; var closeFunc = () => { if(illFatedWindow.type == 'dhtml_window' ) illFatedWindow.close(); else if(illFatedWindow.type == 'native_window' ) illFatedWindow.window.close(); else console.log("bCloseExistingWindow illFatedWindow missing a window type"); };  if(hOpts.window_params.delay_window_closure ) setTimeout(closeFunc , 0 ); else closeFunc(); } if(bReturnMainToHomepage ) { t.Load('homepage', { a_click_callback: true }, window ); } if(hOpts.target == 'same' ) { window.location = hOpts.page; } else if(hOpts.target == 'main' ) { hOpts.window_params.a_click_callback = true; if(hOpts.resource == 'player' || hOpts.resource == 'homepage' ) { RegisterWindow({ window: window, type: 'main', name: hOpts.name || hOpts.resource }); t.Load(hOpts.resource, hOpts.window_params, window ); } else { t.Load(hOpts.resource, hOpts.window_params, top.window.frames['main'] );
 if(top.window.frames['main'] ) { RegisterWindow({ window: top.window.frames['main'], type: 'main', name: hOpts.name || hOpts.resource }); } else { console.log('content loaded to main iframe, but iframe doesnt exist'); } } } else if(t && t.g_hWindows && t.g_hWindows[ hOpts.window_key ] ) { if(hResource.overwrite_page ) { t.g_hWindows[ hOpts.window_key ].window.location = hOpts.page; } else if(! bCloseExistingWindow && ! bOpenANewWindow ) { if ( !!hOpts.page && hOpts.page.indexOf('#') > -1 ) { var sHash = hOpts.page.split('#')[1]; t.g_hWindows[ hOpts.window_key ].window.location.hash = '#'+sHash; } if(bUsingDHTMLWindows ) { t.g_hWindows[ hOpts.window_key ].restore(); } else { t.g_hWindows[ hOpts.window_key ].window.focus(); } } } else { bOpenANewWindow = true; } if(bOpenANewWindow ) { t.g_nPopupCount++;
 if(t.g_hSelf && t.g_hSelf.window_mode == undefined ) t.g_hSelf.window_mode = WINDOW_MODE_DEFAULT; if(hOpts.resource == 'pm_friend' ) { { var nHeight; var nWidth; if(hOpts.window_params['load_video'] ) { var fAspectRatio = ( hOpts.window_params.user_id && t && t.g_hUsers && t.g_hUsers[hOpts.window_params.user_id] && t.g_hUsers[hOpts.window_params.user_id].video_aspect_ratio ) || 1.7777; if(hOpts.window_params['full_video'] ) { nWidth = 685; nHeight = Math.ceil(nWidth * ( 1 / fAspectRatio ) ) + 70; //nHeight = 580;
 } else if(bUsingDHTMLWindows ) { nHeight = 400; nWidth = 970; } else { nHeight = 470; nWidth = Math.ceil(nHeight * fAspectRatio ) + 390; //nWidth = 960;
 } } else { nHeight = 470; nWidth = 643; } hOpts.window_params.width = nWidth; hOpts.window_params.height = nHeight; } } else { var nHeight = screen.height * 0.7; var hNewWindpowParams = { height: nHeight > 1000 ? 1000 : nHeight, width: 800, menubar: 0, resizable: 1, scrollbars: 1, titlebar: 0,
 toolbar: 0, status: 1 }; if(typeof(hResource['new_window'] ) == 'object' ) for(var sK in hResource['new_window'] ) hNewWindpowParams[ sK ] = hResource['new_window'][sK]; for(var sK in hNewWindpowParams ) hOpts.window_params[ sK ] = hOpts.window_params[ sK ] || hNewWindpowParams[ sK ]; } var hWindow = { name: hOpts.window_key }; if(bUsingDHTMLWindows ) { var oDW = t.DhtmlWindowManager.Open(hOpts ); hWindow.window = oDW.GetIframeReference(); hWindow.type = 'dhtml_wind); oDW.Restore(oDW); }; hWindow.close = function() { oDW.Close(oDW); }; if(t.LoadWindowsList ) { t.LoadWindowsList(); } } else { var sNewWindowParams = ''; for(var sK in hOpts.window_params ) { sNewWindowParams += sK + '=' + hOpts.window_params[sK] + ','; } for(var sK in hResource['new_window'] ) { sNewWindowParams += sK + '=' + hResource['new_window'][sK] + ','; } sNewWindowParams = sNewWindowParams.substring(0,sNewWindowParams.length-1); hWindow.type = 'native_window'; if(hOpts.resource == 'pm_friend' && ( ! opener || ! ( g_UA.Safari || g_UA.Chrome ) ) ) { hWindow.window = t.window.open(hOpts.page,'_blank',sNewWindowParams); } else { hWindow.window = window.open(hOpts.page,'_blank',sNewWindowParams); hWindow.popup_of_a_popup = !!opener; } if(NightMode && NightMode.enabled ) { hWindow.window.document.body.style.backgroundColor = '#000000'; } hWindow.restore = function() { hWindow.window.focus(); };
 } RegisterWindow(hWindow ); } return;}function A(){  var oDocWrite; var sResource; var hOpts; if (typeof(arguments[0] ) == 'object') { oDocWrite = arguments[0] || ''; sResource = String(arguments[1]) || ''; hOpts = arguments[2] || {}; } else { sResource = String(arguments[0]) || ''; hOpts = arguments[1] || {}; } if(! A.hCache ) { A.hCache = {}; A.nCacheTimer = setInterval(A.fCleanCache, 1000*60*15); } var sCacheKey = sResource; for(var k in hOpts ) { sCacheKey += k + ( hOpts[k] || '' ); } if ( ! oDocWrite && A.hCache && A.hCache[sCacheKey] && g_hResources[sResource] && ! g_hResources[sResource]['exclusive_window'] )
 { if(oDocWrite ) { oDocWrite.write(A.hCache[sCacheKey].v ); return; } else { return A.hCache[sCacheKey].v; } } if(! g_hResources[sResource] ) { if (sResource.match(/\?/)) sResource += '&'; var name = sResource; g_hResources[ name ] = hOpts || {}; g_hResources[ name ]['page'] = sResource; sResource = name; } var nLinkUserId; if(! hOpts.username && ( nLinkUserId = hOpts.user_id || hOpts.broadcaster_id ) && t && t.g_hUsers && t.g_hUsers[ nLinkUserId ] ) { hOpts.username = t.g_hUsers[ nLinkUserId ].username; } var sTitle = ''; if(! hOpts['no_title'] ) { if(hOpts['title'] ) sTitle = hOpts['title']; else if(g_hResources[sResource]['description'] && ! hOpts['no_title'] ) sTitle = MfcStringUtilities.parse_template(g_hResources[sResource]['description'], hOpts ); } var sAction=''; { var sWindowKey;
 if(sResource == 'player' ) { sWindowKey = PublicChannel(hOpts['broadcaster_id']); } else if(sResource == 'pm_friend' && hOpts['user_id'] ) { sWindowKey = sResource + hOpts['user_id']; } else if(g_hResources[sResource]['exclusive_window'] ) { sWindowKey = sResource + parseInt(Math.random() * 100000 ); } else if(hOpts['user_id'] || hOpts['broadcaster_id'] ) { sWindowKey = sResource + ( hOpts['user_id'] || hOpts['broadcaster_id'] ); } var A_Click_Options = { resource: sResource }; if(hOpts.title ) { delete hOpts.title; } if(hOpts.target ) { A_Click_Options.target = hOpts.target; } if(hOpts.window_key ) { A_Click_Options.window_key = hOpts.window_key; } if(Object.keys(hOpts ).length ) { A_Click_Options.window_params = hOpts; } if(hOpts.do_click ) { A_Click(event, A_Click_Options ); return; } else { sAction += " href=\"#!\" "; sAction += " data-a_click=\"" + A.escapeHtml(JSON.stringify(A_Click_Options ) ) + "\" ";
 } } var sLink = "<a " + sAction + " "; if(hOpts['supress_decoration']) { sLink += " style=\"text-decoration:none;\" "; } else if(hOpts['style'] ) { sLink += " style=\"" + hOpts['style'] + "\" "; } if(hOpts['class'] ) { sLink += " class=\"" + hOpts['class'] + "\" "; } if(sTitle ) { sLink += " title=\"" + sTitle + "\" "; } sLink += " >"; var nCurrentTime = (new Date()).getTime(); A.hCache[sCacheKey] = { v: sLink, l: nCurrentTime }; if(oDocWrite ) { oDocWrite.write(sLink); } else { return sLink; }};A.targetContext = function(event, el ){ var data; if(! el ) { el = event.target; while(el.parentNode ) { if(data = el.getAttribute('data-a_click') ) { break; } el = el.parentNode; } } if(! data ) { return; } event.preventDefault(); var hOpts = JSON.parse(data ); A.targetContext_opts = hOpts; A.targetContext_event = event; hOpts.targetContext = 1;
 var sH = ""; sH += "<div style=\"font-weight:bold;\" class=\"primary_heading_color\">" + MfcStringUtilities.parse_template(g_hResources[ hOpts.resource ].title, ( hOpts && hOpts.window_params ) ) + "</div>"; sH += "<div style=\"white-space:nowrap;margin:20px 20px 0px 0px;\">"; sH += "<a href=# onClick=\"A.targetContext_choice('new_window');\">Open in <b>new</b> window</a><br><br>\n\n"; if(hOpts.resource != 'pm_friend' ) { sH += "<a href=# onClick=\"A.targetContext_choice('main');\">Open in <b>main</b> window</a><br><br>\n\n"; } sH += "<a href=# onClick=\"A.targetContext_choice('dhtml_window');\">Open in <b>in-browser</b> window</a><br><br>\n\n"; if(window.name == 'top_level' && g_UA && g_UA.desktop ) { sH += "<input type=checkbox onClick=\" t.DhtmlWindowMode.Set(this.checked ? true : false ); \" " + ( g_hSelf.window_mode & w.WINDOW_MODE_DESKTOP_DHTML ? 'CHECKED' : '' ) + " ><b>In-browser</b> window as default"; } sH += "</div>"; var oDhtmlPopup = new MfcDhtmlPopup(); oDhtmlPopup.open(sH); return false;};A.targetContext_event = {};A.targetContext_opts = {};A.targetContext_choice = function(choice ){ var event = A.targetContext_event; var opts = A.targetContext_opts; opts.window_params = opts.window_params || {}; delete opts.window_params.target; delete opts.window_params.force_native_window; delete opts.window_params.force_dhtml_window; if(choice == 'new_window' ) { opts.target = 'new_window'; opts.window_params.force_native_window = 1; A_Click(event, opts ); } else if(choice == 'main' )
 { opts.target = 'main'; opts.window_params.target = 'main'; A_Click(event, opts ); } else if(choice == 'dhtml_window' ) { opts.target = 'new_window'; opts.window_params.force_dhtml_window = 1; A_Click(event, optlace(/'/g, "&#039;");};A.fCleanCache = function(){ var nExpTime = (new Date()).getTime() - (1000*60*15); for ( var sResourceKey in A.hCache ) { if ( A.hCache[sResourceKey].l < nExpTime ) { delete A.hCache[sResourceKey]; } }};document.addEventListener("click", A_Click );document.addEventListener("contextmenu", A.targetContext );document.addEventListener("auxclick", A_Click );function RemoveDisallowedChatContent(sMsg ){ if(typeof(sMsg ) != 'string' ) { return sMsg; } sMsg = sMsg.replace(/\S+manyvids.com\S+/gi,''); sMsg = sMsg.replace(/manyvids.com/gi,''); return sMsg;}function DisallowedChatContent(sMsg ){ if(typeof(sMsg ) == 'string'
 && sMsg.match(/manyvids\.com/i) ) { return true; }}function DhtmlPrompt(hOpts ){ hOpts = hOpts || {}; hOpts.popup_options = hOpts.popup_options || {}; hOpts.popup_options.center = 1; hOpts.popup_options.window = window; hOpts.popup_options.mfcMouseTracker = g_oMouseTracker; hOpts.popup_options.mfcGraphics = g; hOpts.popup_options.instance_name = 'DhtmlPrompt'; DhtmlPrompt.oDhtmlPopup = new MfcDhtmlPopup(hOpts.popup_options ); if(DhtmlPrompt.nIdCounter == undefined) { DhtmlPrompt.nIdCounter = 0; } if(hOpts.callback_args == undefined ) { hOpts.callback_args = new Array(); } var sControls = ''; if(! hOpts.force ) { sControls = "<br><input type=submit style=\"font-size:17px;padding:2px 15px;\" id=DhtmlPrompt_ok_" + DhtmlPrompt.nIdCounter + " value=\"" + ( hOpts.ok_label || 'OK' ) + "\">"; if(hOpts.prompt_type == 'confirm' ) { sControls += "&nbsp;&nbsp;"; sControls += "<input type=button style=\"font-size:17px;padding:2px 25px;\" id=DhtmlPrompt_cancel_" + DhtmlPrompt.nIdCounter + " value='" + ( hOpts.cancel_label || 'Cancel' ) + "'>"; } } var nFontSize = hOpts.message.length > 100 ? 15 : 17; var sAlign = hOpts.message.length > 100 ? 'left' : 'center'; var sHtml = " <form id=DhtmlPrompt_form_" + DhtmlPrompt.nIdCounter + "> <table width=" + ( hOpts.width || 450 ) + " cellspacing=10> <tr> <td align=" + sAlign + " style=\"font-size:" + nFontSize + "px;\"> " + hOpts.message + " </td> </tr> <tr> <td align=center style=\"\"> " + sControls + " </td>\
 </tr> </table> " + ( hOpts.footer || '' ) + " </form> "; hOpts.popup_options.no_close_on_mouseout = 1; hOpts.popup_options.no_close_button = 1; hOpts.popup_options.width = hOpts.width; DhtmlPrompt.oDhtmlPopup.open(sHtml, hOpts.popup_options ); var oEl = GetEl('DhtmlPrompt_ok_' + DhtmlPrompt.nIdCounter ); if(oEl ) { oEl.focus(); } DhtmlPrompt.bFormTimeLormTimeLock = false; }, 250 ); GetEl('DhtmlPrompt_form_' + DhtmlPrompt.nIdCounter ).onsubmit = function() { if(DhtmlPrompt.bFormTimeLock ) { return false; } DhtmlPrompt.oDhtmlPopup.close(); if(hOpts.callback ) { hOpts.callback.apply(this, hOpts.callback_args ); } return false; }; if(hOpts.prompt_type == 'confirm' ) { GetEl('DhtmlPrompt_cancel_' + DhtmlPrompt._to_close': true }); }; } DhtmlPrompt.nIdCounter++;};function WaitingForGlobal(globalName, func, args ){ if(typeof(window[ globalName ] ) == 'undefined' ) { clearTimeout(func.wait ); nc.apply(func,args); } ,500 ); return true; } return false;}$(document).on('aentTarget.onclick(e);});if ( parent == top && window.name != 'top_level' ){ (function(){ 'use strict'; if(window.isCrossSiteIframe ) { return; } var hidden, visibilityChange; if (typeof document.hidden !== "undefined") { hidden = "hidden"; visibilityChange = "visibilitychange"; } else if (typeof document.msHidden !== "undefined") { hidden = "msHidden"; visibilityChange = "msvisibilitychange"; } else if (typeof document.webkitHidden !== "undefined") { hidden = "webkitHidden"; visibilityChange = "webkitvisibilitychange"; } function toggleVitalTimers(bVisible) { if ( toggleVitalTimers.aIntervals.length ) { for (var i = toggleVitalTimers.aIntervals.length - 1; i >= 0; i--) { clearInterval(toggleVitalTimers.aIntervals[i]); } toggleVitalTimers.aIntervals = []; if ( ! bVisible ) return; } if ( parent.t.g_oCmdQ && typeof(parent.t.g_oCmdQ.Process) === 'function' ) { toggleVitalTimers.aIntervals.push(setInterval(function() { parent.t.g_oCmdQ.Process(); }, 100) ); } if ( parent.t.g_sConnectionMode === 'flash' ) { if ( typeof(parent.t.zgw_ProcessEvents) === 'function' ) {
 toggleVitalTimers.aIntervals.push(setInterval(function() { parent.t.zgw_ProcessEvents(); }, 100) ); } if ( typeof(parent.t.xmls_PingInterval) === 'function' ) { toggleVitalTimers.aIntervals.push(setInterval(function() { parent.t.xmls_PingInterval(); }, 1000) ); } } else if ( parent.t.g_sConnectionMode === 'websocket' ) { if ( parent.t.ws && typeof(parent.t.ws.ProcessInput) === 'function' ) { toggleVitalTimers.aIntet.ws.ProcessInput(); }, 150) ); } if ( typeof(parent.t.zgw_Ping) === 'function' ) { toggleVitalTimers.aInteparent.t.zgw_Ping(); }, 1000) ); } } } toggleVitalTimers.aIntervals = []; var waitForParentFn = function() { if ( parent && parent.t && typeof(parent.t.Log) === 'function' ) { if ( visibilityChange ) { document.addEventListw.document[hidden]); }); } toggleVitalTimers(true); } else { setTimeout(waitForParentFn, 250); } }; waitForParentFn(); })();}

// js_build_core: js/common_shortcuts.js
var g_hShortcuts={"lool":"0662c3ea.gif","loll":"ef3b5f83.gif","bighug":"74688417.gif","lmao3":"656211b6.gif","yesyes":"61bee55a.gif","kiss7":"f00991f0.gif","woohoo":"c579fb01.gif","haha":"0df9d6dd.gif","jhug":"5b0a4e39.gif","giggle":"10bfd57b.gif","kiss4":"2416cf5a.gif","hmmm":"7651e918.gif","lmao":"4e1ab128.gif","pbbt":"4cd8fb92.gif","wtf":"8b4a0e9c.gif","kiss2":"71f5387f.gif","handshake":"4378999a.gif","wave3":"a2932764.gif","ezekiel":"986b741d.jpg","jerking":"687d4e74.gif","lolz":"a4587c84.jpg","doh":"54afdd71.gif","hide":"33dab01b.gif","kiss5":"0f6732dd.gif","hya":"ef74b8c1.gif","hey":"2bb51eda.gif","eatnhole":"672ad909.gif","tulips":"76311567.gif","buddy":"614b056e.gif","eyepop":"2a67ee80.gif","pb50":"68c83d23.gif","wb3":"9e58306f.gif","giveflowers":"1f853ace.gif","clap":"8e4e7ffc.gif","sexy":"3844d773.gif","blowkiss":"d3b3a1ab.gif","ok":"bb655dd2.gif","lol":"aba1acd9.gif","yipee":"2c101669.gif","fkiss":"157582fd.gif","erection":"c31d8609.gif","cheers":"516cf858.gif","lovekiss":"78e6e889.gif","kissass":"0a0c8de8.gif","cheers7":"25a7eac3.gif","wave4":"fd0ddde9.gif","kiss13":"30f12f86.gif","eekk":"44f37c51.gif","run":"84d695ef.gif","wbb":"7a55e41a.gif","kiss4u":"7f3ea2f9.gif","luveyes":"2d957b42.gif","shootme":"3ceb98df.gif","wave6":"088d7b29.gif","hot":"9fe452cd.gif","beautiful":"fe75b5df.gif","whip":"5feb129e.gif","lol4":"e046353b.gif","offtobed":"76402b26.gif","boner":"1e1b603b.gif","groupshow":"b4b95c16.gif","cheerz":"a3400897.gif","think":"3108c464.gif","niceass":"d8c7c73d.gif","gm5":"d6b325b2.gif","muff":"1f5301f8.gif","ban":"37004e16.gif","kissss":"9ab07371.gif","flr":"346b92f9.gif","erection13":"487f8def.gif","hugs":"1c4a8dbb.gif","helloe":"54dfb801.gif","hi5":"589cc8c0.gif","sup":"46b81545.gif","halftip":"b526a4e9.jpg","ahole":"b38bd72d.gif","cumtits":"8fb77fda.gif","lol2":"fee113a9.gif","moon":"d256b260.gif","aanal":"87da2dd0.gif","lol5":"a590f095.gif","nolook":"e813e0f7.gif","nicol":"1012569c.gif","iagree":"f4ddbbdd.gif","lickyou":"7034059d.gif","boo":"e529443d.gif","wave5":"c06df459.gif","hottt":"6cbc7f7c.gif","danceb":"10312b45.gif","getout":"de4f412c.gif","tokens":"24dd51b5.gif","whew":"4f4583a1.gif","deal1":"8e8955ea.gif","finger":"588aebf2.gif","pussylick":"f75375e1.gif","stairing":"1242727f.gif","kiss6":"6d448678.gif","quickkiss":"59c5d4b0.gif","rose7":"1c5da57e.gif","thumbs":"cd41cf90.gif","tip1":"48d485ad.gif","dancedude":"4760d66e.gif","smstoned":"22243301.gif","lolmo":"0df9d6dd.gif","rave":"4d7dfcaa.gif","dance5":"c956ecc2.gif","later":"b0d1528a.gif","boobs":"ad2a4669.gif","nomodels":"1c3b71bb.gif","edance":"8af92dc1.gif","tits":"6729307c.gif","doggie1":"ebc6ad54.gif","heyy":"2f48d91c.gif","danceg":"81050e07.gif","cheers2":"fa3008c2.gif","chug":"cf31a287.gif","hugepenis":"a76674ff.gif","kis4":"9ba3d0f4.gif","please":"940809ab.gif","lmao4":"11ea9ba0.gif","heart0":"7c3ee86b.gif","perv":"67308c11.gif","bigjerk":"4f80b9e4.gif","tickle":"e9ce0745.gif","welcomeback":"bd278d0f.gif","smlol":"6782869b.gif","nerner":"887ca0f4.gif","sogay":"4f271a40.gif","headbanger":"825743fd.gif","licking":"aa401566.gif","hm3":"0ae03149.gif","hide4":"cd4680b6.gif","omgomgomg":"5b64e069.gif","spank":"fbee0ab0.jpg","wowwow":"71921fc5.gif","kissheart":"828b99d6.gif","snap":"c207e0a6.gif","flee":"62170ca3.gif","sigh":"552994d6.gif","huglove":"2bcf0383.gif","brb":"a2f191c9.gif","smiler":"93ce81ba.gif","uhuh":"a24f799c.gif","inlove1":"6aea6ef4.gif","roses24":"feaad445.gif","hairpull":"38408a46.gif","wave2":"a2932764.gif","camera":"6d4d06db.gif","sing1":"f9f5e96c.gif","noo":"2d65d00a.gif","dancing":"926b2994.gif","muttlaugh":"bb1cad4c.gif","imthinking":"31e030fe.gif","dream":"40a56b55.gif","buhbye":"6f422114.gif","laterz":"32ce43bb.gif","hardlaugh":"57d9822d.gif","smy":"94b173f2.gif","lickme":"85f5d3d4.gif","kissers101":"e05846e6.gif","erection2":"98e04aa2.gif","bigwow":"fc3d10a2.gif","bird4":"f65583d8.gif","lnip":"89590dd5.jpg","bloom":"462a9e49.gif","lips1":"9f54b127.gif","smooch":"cc835751.jpg","lezlick":"2fb59ebf.gif","drunky":"f458d271.gif","throb3d":"c5e27ea3.gif","ballkick":"55572d26.gif","funnyface":"71727846.gif","byebye":"715cd7d6.gif","hopa":"ac03c515.gif","asslicker":"f7a9894f.gif","staring":"96b2687c.gif","sadcrying":"9aad14b5.gif","coffee2":"705fb84b.gif","dance1":"b592c679.gif","cheersbro":"9cd09883.gif","spray":"66f248c0.gif","jumping":"42b7bd1d.gif","buttsex":"e0e86797.gif","mhug":"20e258c3.gif","stroke5":"5c0f6a8e.gif","tongue3":"612fb9f6.gif","bong":"94a3b97f.gif","dance2":"0b2f72de.gif","guitar":"c91a9f33.gif","kiss":"1b92a61f.gif","handkiss":"b763bb5f.gif","wink2":"cf938025.gif","peek":"3648fc34.gif","floorlaugh":"7f5746a3.gif","nasha":"48ee2f9c.gif","luvu":"d5a6d090.gif","wb1":"cee21c23.gif","iloveyou":"e715fe7f.gif","rosegrin":"f1a61582.gif","broke":"d1cb1cba.gif","welcome":"e1c78a39.gif","handkiss2":"0d3d67a7.gif","tip":"fb590126.gif","rant":"711e771e.gif","smoke1":"141d87e2.gif","hop":"3b865d14.gif","appl5":"64396f45.gif","felix":"c57c4e30.gif","gotcha":"7dcdd6a7.gif","nooo":"d6fc7ed7.gif","lol3":"90cdf55f.gif","grummy":"8b1d36c1.gif","sleeping":"6f2db275.gif","chaingun2":"a55a0c37.gif","hybb":"fe46c64c.gif","sssh":"41a27346.gif","blah":"88258096.gif","beatshit":"ae0e5d82.gif","bj2":"d60100c2.gif","kisser":"b91d6388.gif","perfecto":"8454b432.gif","peeping":"a76f3b68.gif","eatnthat":"20dbd335.gif","fatdan":"43458739.gif","byebyebye":"87d9a0e1.gif","inbed":"eee2ce55.gif","kisslove":"812ab46d.gif","think2":"8c67eb0e.gif","multiroses":"347ed41b.jpg","thud":"501b3e8b.gif","headbang":"c8cd4218.gif","dance3":"b15283f9.gif","zipit":"1c0679a3.gif","bac":"17a806e2.gif","hopa2":"63bf3557.gif","clap1":"17eca1b1.gif","ove":"a7042157.jpg","bgt":"64bcd28c.gif","rasp":"cce590a3.gif","kamasutra7":"3b716aac.gif","piss":"04674d2e.gif","gimmy5":"4c1184a5.gif","dancep":"c5522c2e.gif","roserose":"33ade8bb.gif","demon":"21a1ed48.gif","gottogo":"678e1036.gif","boot":"a6ca9fd5.gif","dee25":"bab98951.gif","cheer":"741c983e.gif","lickit":"3b08dc17.gif","mmmmm":"331ee19f.gif","angeldevil":"870df64d.gif","goat":"0032e944.jpg","lollegs":"1de2d5db.gif","bleh3":"2371ac9d.gif","jawdrop2":"1962fe25.gif","fmm":"be01d471.gif","pb2":"c1852d7b.gif","bowdown":"ccb56cc3.gif","singlerose":"5825401e.gif","mkiss":"5da654d7.gif","party":"b07a1ce9.gif","hehehe":"3d73c9b3.gif","mlooking":"98c93955.gif","gnight":"d147daff.gif","hug3":"7f45d492.gif","rain":"35504392.gif","wave1":"f6ac0acf.gif","wow1":"c72d27f3.gif","wang":"160065e6.gif","iloveyou101":"a98e77b0.gif","heartsmile":"22e5137e.gif","woohooo":"1e8a98d1.gif","hubba":"fcf2da4f.gif","hopa3":"5edf1ce7.gif","longtounge":"e0f45b1f.gif","luvu3":"7432cf67.gif","xhug":"723ac57f.gif","hahaha":"7725d9f6.gif","mjdance":"2813ec48.gif","kiss101":"71f5387f.gif","asskiss":"a5dc7ad2.gif","sheepfuck":"6fa7067f.gif","bug":"313f0578.gif","choco":"6c351d3a.gif","camera2":"8fd678ea.gif","spanking":"0035d61c.gif","barf":"fb033944.gif","cellphone":"059715c3.gif","nhug":"20e258c3.gif","yo5":"6a3c1d57.gif","lacp":"45c75857.gif","spankass":"16db8d8e.gif","picard":"12948d7c.jpg","wink1":"270ac67c.gif","nofriends":"b8d87482.gif","hornydevil":"485fb4c8.gif","dduck":"48659326.gif","yuppy":"d2d6f6e0.gif","whisper":"eba1d512.gif"};

// js_build_core: js/PluginDetect.js
 var PluginDetect={minIEver:5.5,getNum:function(A){if(!A){return null}var m=/[\d][\d\.\_,-]*/.exec(A);return m?m[0].replace(/[\.\_-]/g,","):null},hasMimeType:function(_3){var s,t,z,M=_3.constructor==String?[_3]:_3;for(z=0;z<M.length;z++){s=navigator.mimeTypes[M[z]];if(s&&s.enabledPlugin){t=s.enabledPlugin;if(t.name||t.description){return s}}}return null},findNavPlugin:function(N,_6){var _7=N.constructor==String?N:N.join(".*"),numS=_6===false?"":"\\d";var i,re=new RegExp(_7+".*"+numS+"|"+numS+".*"+_7,"i");var _9=navigator.plugins;for(i=0;i<_9.length;i++){if(re.test(_9[i].description)||re.test(_9[i].name)){return _9[i]}}return null},getAXO:function(_a){var _b,e;try{_b=new ActiveXObject(_a);return _b}catcfalse:(/\d/).test(A))},compareNums:function(_d,_e){if(!this.num(_d)||!this.num(_e)){return 0}var m1=_d.split(","),m2=_e.split(","),x,p=parseInt;for(x=0;x<Math.min(m1.length,m2.length);x++){if(p(m1[x],10)>p(m2[x],10)){return 1}if(p(m1[x],10)<p(m2[x],10)){return -1}}return 0},formatNum:function(num){if(!this.num(num)){return null}var n=num.replace(/[\.\_]/g,","),i;n=n.split(",").concat(["0","0","0","0"]);return n.slice(0,4).join(",")},initScript:function(){var $=this,IE;$.isIE=(false);$.IEver=-1;if($.isIE){var IE=(/msie\s*\d\.{0,1}\d*/i).exec(navigator.userAgent),progid,x;if(IE){$.IEver=parseFloat((/\d.{0,1}\d*/i).exec(IE[0]),10)}progid=["ShockwaveFlash.ShockwaveFlash","Msxml2.XMLHTTP","Microsoft.XMLDOM","Msxml2.DOMDocument","TDCCtl.TDCCtl","Shell.UIHelper","Scripting.Dictionary"];$.ActiveXEnabled=false;for(x=0;x<progid.length;x++){if($.getAXO(progid[x])){$.ActiveXEnabled=true;break}}};if($.ActiveXEnabled&&$.IEver>=$.minIEver){$.head=typeof document.getElementsByTagName!="undefined"?document.getElementsByTagName("head")[0]:null;var T=document.createElement("script");T.setAttribute("type","text/vbscript");var Y=["<!"+"--","function PluginDetect1(c)","on error resume next","PluginDetect1=false","dim head, r","set head=PluginDetect.head","set r=head.firstChild","if TypeName(r)=\"HTMLObjectElement\" then","r.setAttribute \"classid\", c","if not TypeName(r.getAttribute(\"object\")) = \"Nothing\" then","PluginDetect1=true","if r.getAttribute(\"readyState\")<4 then","r.clearAttributes()","head.removeChild(r)","end if","else r.clearAttributes()","head.removeChild(r)","end if","end if","r=\"Nothing\"","head=\"Nothing\"","end function","--"+">"];T.setAttribute("text",Y.join("\n"));if($.head.firstChild){$.head.insertBefore(T,$.head.firstChild)}else{$.head.appendChild(T)}$.vbscript=false;var e;$.head.insertBefore(document.createElement("object"),$.head.firstChild);try{if(PluginDetect1("")===false){$.vbscript=true}}catch(e){}}},init:function(_17){var $=this,IE,p;_17=_17.toLowerCase().replace(/\s/g,"");p=$.plugin=$[_17];if(!p){return -3}if(typeof p.minversion=="undefined"){p.minversion={}}if(typeof p.version=="undefined"){p.version=null}if(typeof p.installed=="undefined"){p.installed=null}$.garbage=false;if($.isIE&&!$.ActiveXEnabled){return -2}return 1},isMinVersion:function(_19,_1a){var $=PluginDetect,i=$.init(_19);if(i<0){return i}if(!$.num(_1a)){return -3}var p=$.plugin,m=p.minversion;_1a=$.formatNum(_1a);if(typeof m["a"+_1a]=="undefined"){if(p.installed==null&&p.getCodeBaseVersion&&$.IEver>=p.minIEver){var tmp,x;for(x in m){tmp=$.compareNums(_1a,x.substring(1,x.length));if(m[x]==1&&tmp<=0){return 1}if(m[x]==-1&&tmp>=0){return -1}}m["a"+_1a]=$.isActiveXObject(_1a)?1:-1}else{if(p.installed==null){p.getVersion()}if(p.installed==-1){m["a"+_1a]=-1}else{if(p.version==null){m["a"+_1a]=0}else{m["a"+_1a]=($.compareNums(p.version,_1a)>=0?1:-1)}}}}$.cleanup();return m["a"+_1a];return -3},getVersion:function(_1e){var $=PluginDetect,i=$.init(_1e);if(i<0){return null}var p=$.plugin;if(p.installed==null){p.getVersion()}$.cleanup();return p.versiodow.CollectGarbage()}},isActiveXObject:function(_22){var $=this,result,s="<object width=\"1\" height=\"1\" "+"style=\"display:none\" "+$.plugin.getCodeBaseVersion(_22)+">"+$.plugin.HTML+"</object>";$.head.insertBefore(document.createElement("object"),$.head.firstChild);$.head.firstChild.outerHTML=s;result=$.vbscript?PluginDetect1($.plugin.classID):$.detect($.plugin.classID);return result},detect:function(_24){var $=this,result;$.head.firstChild.setAttribute("classid",_24);result=$.head.firstChild.getAttribute("object")?true:false;if(!result||$.head.firstChild.getAttribute("readyState")<4){$.head.firstChild.clearAttributes();$.head.removeChild($.head.firstChild);$.garbage=true}return result},search:function(){var _26=[0,0,0,0];var $=this,x.isActiveXObject(_2a)};var _2b,upper,tmp;var _2c=false;for(x=0;x<A.length;x++){upper=A[x]*2;_26[x]=0;for(y=0;y<20;y++){if(upper==1&&x>0&&_2c){break}if(upper-_26[x]>1){tmp=Math.round((upper+_26[x])/2);if(t(x,tmp)){_26[x]=tmp;_2c=true}else{upper=tmp}}else{if(upper-_26[x]==1){upper--;if(!_2c&&t(x,upper)){_2c=true}break}else{if(!_2c&&t(x,upper)){_2c=true}break}}}if(!_2c){return null}}return _26[0]+","+_26[1]+","+_26[2]+","+_26[3]},dummy1:0};PluginDetect.initScript();PluginDetect.java={mimeType:"application/x-java-applet",classID:"clsid:8AD9C840-044E-11D1-B3E9-00805F499D93",JavaVersions:["1.7.0.15","1.6.0.15","1.5.0.14","1.4.2.13","1.3.1.18"],searchJava:function(M){if(!M){return null}var G,e,x3,x4;var AXO=ActiveXObject;var T=M.split("."),J="JavaPlugin."+T[0]+T[1],v=T[0]+"."+T[1]+".";for(x3=T[2];x3>=0;x3--){for(x4=T[3];x4>=0;x4--){G=x4<10?"0"+x4:x4;try{new AXO(J+x3+"_"+G);return v+x3+"_"+G}catch(e){}}if(J+x3=="JavaPlugin.131"){return null}try{new AXO(J+x3);return v+x3}catch(e){}}return null},minIEver:5.5,HTML:"<param name=\"code\" value=\"A14999.class\" />",getCodeBaseVersion:function(v){var r=this.getDigits(v),$=PluginDetect;if($.compareNums(v,"1,4,1,02")<0){v=r[0]+","+r[1]+","+r[2]+","+r[3]}else{if($.compareNums(v,"1,5,0,02")<0){v=r[0]+","+r[1]+","+r[2]+","+r[3]+"0"}else{v=Math.round((parseFloat(r[0]+"."+r[1],10)-1.5)*10+5)+","+r[2]+","+r[3]+"0"+",0"}}return "codebase=\"#version="+v+"\""},digits:[1,9,32,32],getDigits:function(n){/([\d]+)[,_\.]([\d]+)[,_\.]([\d]+)[,_\.]([\d]+)/.test(n);return [RegExp.$1,RegExp.$2,RegExp.$3,RegExp.$4]},hasRun:false,value:null,queryJavaHandler:function(){var $=PluginDetect.java,j=window.java,e;$.hasRun=true;try{if(typeof j.lang!="undefined"&&typeof j.lang.System!="undefined"){$.value=j.lang.System.getProperty("java.version")+" "}}catch(e){}},queryJava:function(){var $=PluginDetect,t=this,nua=navigator.userAgent,e;if(typeof window.java!="undefined"&&window.navigator.javaEnabled()){if(/gecko/i.test(nua)){if($.hasMimeType("application/x-java-vm")){try{var div=document.createElement("div"),evObj=document.createEvent("HTMLEvents");evObj.initEvent("focus",false,true);div.addEventListener("focus",t.queryJavaHandler,false);div.dispatchEvent(evObj)}catch(e){}if(!t.hasRun){t.queryJavaHandler()}}}else{if(/opera.9\.(0|1)/i.test(nua)&&/mac/i.test(nua)){return null}t.queryJavaHandler()}}return t.value},getVersion:function(){var _3a=null,$=PluginDetect;if(!$.isIE){var p1,p,mt;p=$.findNavPlugin(["Java","Plug-in"]);mt=$.hasMimeType(this.mimeType);if(p){p1=$.getNum(p.description)}if(p1&&mt&&navigator.javaEnabled()){_3a=p1}if(!_3a){p=this.queryJava();if(p){_3a=p}}this.installed=-1;if(_3a){this.installed=1}else{if(mt&&navigator.javaEnabled()){if(/macintosh/i.test(navigator.userAgent)&&/safari/i.test(navigator.userAgent)){this.installed=0}}}}else{var x,tmp=null;if($.IEver>=this.minIEver){_3a=$.search();this.installed=_3a?1:-1}else{for(x=0;x<this.JavaVersions.length;x++){tmp=this.searchJava(this.JavaVersions[x]);if(tmp){_3a=tmp;break}}this.installed=_3a?1:($.getAXO("JavaPlugin")?0:-1)}}this.version=$.formatNum($.getNum(_3a))}};

// js_build_core: js/flash_detect.js
var isIE = (navigator.appVersion.indexOf("MSIE") != -1) ? true : false;var isWin = (navigator.appVersion.toLowerCase().indexOf("win") != -1) ? true : false;var isOpera = (navigator.userAgent.indexOf("Opera"); } } return version;}function GetSwfVer(){ var flashVer = -1; if (navigator.plugins != null && navigator.plugins.length > 0) { if (navigator.plugins["Shockwave Flash 2.0"] || navigator.plugins["Shockwave Flash"]) { var swVer2 = navigator.plugins["Shockwave Flash 2.0"] ? " 2.0" : ""; var flashDescription = navigator.plugins["Shockwave Flash" + swVer2].description; var descArray = flashDescription.split(" "); var tempArrayMajor = descArray[2].split("."); var versionMajor = tempArrayMajor[0]; var versionMinor = tempArrayMajor[1]; if ( descArray[3] != "" ) { tempArrayMinor = descArray[3].split("r"); } else { tempArrayMinor = descArray[4].split("r"); } var versionRevision = tempArrayMinor[1] > 0 ? tempArrayMinor[1] : 0; var flashVer = versionMajor + "." + versionMinor + "." + versionRevision; } } else if (navigator.userAgent.toLowerCase().indexOf("webtv/2.6") != -1) flashVer = 4; else if (navigator.userAgent.toLowerCase().indexOf("webtv/2.5") != -1) flashVer = 3;
 else if (navigator.userAgent.toLowerCase().indexOf("webtv") != -1) flashVer = 2; else if ( isIE && isWin && !isOpera ) { flashVer = ControlVersion(); } return flashVer;}function DetectFlashVer(reqMajorVer, reqMinorVer, reqRevision){ versionStr = GetSwfVer(); if (versionStr == -1 ) { return false; } else if (versionStr != 0) { if(isIE && isWin && !isOpera) { tempArray = versionStr.split(" ") || []; // ["WIN", "2,0,0,11"]
 tempString = tempArray[1] || ""; // "2,0,0,11"
 versionArray = tempString.split(","); // ['2', '0', '0', '11']
 } else { versionArray = versionStr.split("."); } var versionMajor = versionArray[0]; var versionMinor = versionArray[1]; var versionRevision = versionArray[2]; if (versionMajor > parseFloat(reqMajorVer)) { return true; } else if (versionMajor == parseFloat(reqMajorVer)) { if (versionMinor > parseFloat(reqMinorVer)) return true; else if (versionMinor == parseFloat(reqMinorVer)) { if (versionRevision >= parseFloat(reqRevision)) return true; } } return false; }}

// js_build_coe(e):e=nt,nt.polyfill(),nt});


var g_mfccore_loaded = true;
