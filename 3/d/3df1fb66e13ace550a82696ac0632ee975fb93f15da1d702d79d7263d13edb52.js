"use strict";(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[2306],{32306:function(t,e,n){n.r(e),n.d(e,{default:);var i=n(18487),r=n(37311),o=n(31240),c=n(2406),a=n.n(c),s=n(47189),l=n(43800),u=n(55382),v=n.n(u),d=n(147),p=n.n(d),f=n(45821),_=n(19731),k=n(49200),y=function(t){v().closeAll(),v().error(t)},m=function(t){v().closeAll(),v().success({showClose:!0,message:t})},g=function(t){v().closeAll(),v().warning(t)},h=function(t){if(!t)return[];return(0,o.Z)(t.matchAll(/\$\{(.+?)\}/g)).map(()},I={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"InviteTask"},[i("div",{staticClass:"InviteTask-title"},[t._v("\n    "+t._s(t.title)+"\n  ")]),t._v(" "),t.headimg?i("div",{staticClass:"InviteTask-head"},[i("img",{attrs:{src:t.headimg,alt:""}})]):t._e(),t._v(" "),i("div",{staticClass:"InviteTask-content"},[i("div",{staticClass:"InviteTask-content-title"},[t._v("\n      "+t._s(t.lang_txt0)+"\n    ")]),t._v(" "),i("div",{staticClass:"InviteTask-content-url"},[i("div",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.copyText,expression:"copyText"}],staticClass:"InviteTask-content-url-text",on:{success:function(e){return t.handleCopySuccess()},error:function(e){return t.handleCopyError()},click:function(e){return t.handleCopyClick()}}},[t._v("\n        "+t._s(t.invitelink)+"\n      ")]),t._v(" "),i("div",{staticClass:"InviteTask-content-url-qr"},[i("img",{attrs:{src:n(25739)},on:{mouseenter:function(e){return t.hoverQr(!0)},mouseleave:function(e){return t.hoverQr(!1)}}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isHoverQr,expression:"isHoverQr"}],staticClass:"InviteTask-content-url-hover",on:{mouseenter:function(e){return t.hoverQr(!0)},mouseleave:},[i("div",{staticClass:"InviteTask-content-url-hover-title"},[t._v(t._s(t.lang_txt1))]),t._v(" "),t.invitelink?i("vue-qrcode",{attrs:{value:t.invitelink,options:{width:150}}}):t._e()],1)]),t._v(" "),i("div",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.copyText,expression:"copyText"}],staticClass:"InviteTask-content-btn",on:{success:function(e){return t.handleCopySuccess()},error:function(e){return t.handleCopyError()},click:},[t._v("\n      "+t._s(t.lang_txt2)+"\n    ")])])])},staticRenderFns:[],name:"InviteTask",components:{VueQrcode:p()},directives:{clipboard:l.B},props:{companyId:{type:[String,Number],default:""},source:{type:String,default:"pcoffice"},groupName:{type:String,default:""},companyName:{type:String,default:""},roleId:{type:[String,Number],default:0},userId:{type:[String,Number],default:0},groupId:{type:[String,Number],default:0},type:{type:String,default:""},caller:{type:String,default:""},scene:{type:String,default:""}},data:function(){return{headimg:"",title:(0,f.t)("logic.InviteTask.title"),invite_content:"",invitelink:"",isHoverQr:!1,lang_txt0:(0,f.t)("logic.InviteTask.txt0"),lang_txt1:(0,f.t)("logic.InviteTask.txt1"),lang_txt2:(0,f.t)("logic.InviteTask.txt2"),linkId:"",policyId:"",taskId:"",invite_content_from_request:""}},computed:{isPc:copyText:companyGroup:defaultInviteContent:function(){return(0,f.t)("logic.InviteTask.txt6")+this.companyGroup+(0,f.t)("logic.InviteTask.txt7")},role:function(){return{1:"superadm",2:"admin",3:"member"}[this.roleId]}},mounted:function(){var t=this;return(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.invite_content=t.defaultInviteContent,e.next=3,t.getPolicy(t.companyId);case 3:if(t.report({operation:"show",role:t.role,user_id:t.userId,company_id:t.companyId,policy_id:t.policyId,task_id:t.taskId,caller:t.scene}),!["grouptop_card","newbie_tips","doc_empty"].includes(t.type)||!t.groupId){e.next=9;break}return e.next=7,t.getInviteByGroupId(t.groupId);case 7:e.next=11;break;case 9:return e.next=11,t.getInviteByCompanyId(t.companyId);case 11:t.companyGroup||(t.invite_content=t.invite_content_from_request);case 12:case"end":return e.stop()}}),e)})))()},methods:{getInviteByGroupId:function(t){var e=this;return(0,r.Z)(a().mark((function n(){var i,r,o;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,s.ZB8)(t);case 3:i=n.sent,(r=i.data)&&r.title&&r.invite_url?(e.invitelink=r.invite_url,e.linkId=(null===(o=r.invite_link)||void 0===o?void 0:o.key)||"",e.invite_content_from_request=r.title,e.scene&&e.linkId&&e.getEncsGroupLink()):g((0,f.t)("logic.InviteTask.txt3")),n.next=12;break;case 8:throw n.prev=8,n.t0=n.catch(0),g((0,f.t)("logic.InviteTask.txt3")),n.t0;case 12:case"end":return n.stop()}}),n,null,[[0,8]])})))()},getEncsGroupLink:function(){var t=this;return(0,r.Z)(a().mark((function e(){var n,i,r,o,c,l,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={invite_info:{invite_source:(0,_.x_)(window)||"plus",scene:t.scene,invite_type:"link",role:t.role}},i=btoa(JSON.stringify(n)),r=(i.match(/=*$/)[0]||"").length,o=r?i.slice(0,-r):i,c={context:{encs_group_linkid:t.linkId},credential:{encs_group_linkid:t.linkId},source:o},e.next=8,(0,s.d1X)(t.companyId,c);case 8:l=e.sent,(u=l.data)&&u.msg&&u.url?(t.invite_content_from_request=u.msg,t.invitelink=u.url):g((0,f.t)("logic.InviteTask.txt3")),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(0),g((0,f.t)("logic.InviteTask.txt3")),e.t0;case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))()},getInviteByCompanyId:function(t){var e=this;return(0,r.Z)(a().mark((function n(){var i,r,o,c,l;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,i={invite_info:{invite_source:(0,_.x_)(window)||"plus",scene:e.scene,invite_type:"link",role:e.role}},r=btoa(JSON.stringify(i)),o=(r.match(/=*$/)[0]||"").length,c=o?r.slice(0,-o):r,n.next=7,(0,s.g_K)({comp_id:t,source:c});case 7:(l=n.sent)&&l.invite_content&&l.url?(e.invitelink=l.url,e.invite_content_from_request=l.invite_content):g((0,f.t)("logic.InviteTask.txt3")),n.next=15;break;case 11:throw n.prev=11,n.t0=n.catch(0),g((0,f.t)("logic.InviteTask.txt3")),n.t0;case 15:case"end":return n.stop()}}),n,null,[[0,11]])})))()},getPolicy:function(t){var e=this;return(0,r.Z)(a().mark((function n(){var i,r,o,c,l,u,v,d,p,_,k,y;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,i=e.isPc?"pc_newbie_invite":"web_newbie_invite",r={window_key:i,company_id:t},e.type&&(r.utm_term=e.type),n.next=6,(0,s.SPt)(r);case 6:if(o=n.sent,(c=o.data).task_id&&(null==c?void 0:c.data.length)>=0){for(e.headimg=(null===(l=c.data.find((function(t){return"picture"===t.key})))||void 0===l?void 0:l.value)||"",e.title=(null===(u=c.data.find((function(t){return"headline"===t.key})))||void 0===u?void 0:u.value)||(0,f.t)("logic.InviteTask.title"),e.lang_txt0=(null===(v=c.data.find((function(t){return"subtitle"===t.key})))||void 0===v?void 0:v.value)||(0,f.t)("logic.InviteTask.txt0"),e.lang_txt2=(null===(d=c.data.find((function(t){return"invite_button"===t.key})))||void 0===d?void 0:d.value)||(0,f.t)("logic.InviteTask.txt2"),_=null===(p=c.data.find(())||void 0===p?void 0:p.value,k=h(_),y=0;y<k.length;y++)_&&k[y]&&(_=_.replace("${"+k[y]+"}",e[k[y]]));e.invite_content=_,e.policyId=c.policy_id,e.taskId=c.task_id}n.next=15;break;case 11:throw n.prev=11,n.t0=n.catch(0),g((0,f.t)("logic.InviteTask.txt3")),n.t0;case 15:case"end":return n.stop()}}),n,null,[[0,11]])})))()},hoverQr:function(t){var e=this;clearTimeout(this.timer),t?this.isHoverQr=t:this.timer=setTimeout((,300)},handleCopySuccess:function(){this.isIE?window.clipboardData.setData("text",this.copyText)?m((0,f.t)("logic.InviteTask.txt4")):y((0,f.t)("logic.InviteTask.txt5")):m((0,f.t)("logic.InviteTask.txt4"))},handleCopyError:handleCopyClick:function(){this.report({operation:"click_copylink",role:this.role,user_id:this.userId,company_id:this.companyId,policy_id:this.policyId,task_id:this.taskId,caller:this.scene})},report:};ar w={InviteTask:[{trigger:"mounted",listener:function(t){var e=this;t.report=function(n){e.track("company_task_newbie_invite",{policy_id:t.policyId,task_id:t.taskId,company_id:t.companyId,role:t.roleId,caller:t.caller},n))}}},{event:"company_task_newbie_invite",trigger:"beforeDestroy",listener:function(t){if(t.$root.hasClickCloseBtn)return{operation:"click_close",task_id:t.taskId,policy_id:t.policyId,company_id:t.companyId,role:t.role,caller:t.scene,user_id:t.userId}}}]};I.install=I.dw=w;var b=I,T=(0,i.Z)({entry:b,pages:[{title:"",className:"k-dialog-invite-task",width:"540px",useNewLayout:!0,body:b,footer:null,closeOnClickModal:!1}]});T.dw=b.dw;var C=T},25739:]);
