import{domReplaceContent as l,fetchHtml as u,forceRepaintSVG as o,createFragmentFromHTML as m,domAppend as h,addParams as p,domRemove as g,resolve}from"../base/croco.js";import{getLocalData as j}from"../base/config.js";import{productTileInit as v,onCtrlKeyPressOpenWindow as T}from"./product-tile.js";import{sliderInit as k}from"../components/slider-preconfigured.js";function L(t){return Object.values(resolve("features.recommendation",Lacoste)||{}).find(}function S(t){const i=t.querySelectorAll(".js-product-tile:not(.js-tracking-ready)");let m=[];let u=null;[...i].forEach(t=>{t.classList.add("js-tracking-ready");const i=t.closest(".js-recommendation-tile");if(i){const{trackingViewUrl:o,pid:l}=i.dataset;u=o;l&&m.push(l)}});if(u&&m.length>0){fetch(p(u,{products:JSON.stringify(m)}))}}async function _(t,code){const i=t.dataset.trackOnEachEnterView;const o=[...t.querySelectorAll(".js-recommendation-tile")];const items=[];const m={ecommerce:{items:items}};const u={item_list_id:code,item_list_name:"recommendation"};const h={area:t.dataset.recoid,action:t.dataset.realid};if(o.length>0){o.forEach((l,index)=>{const i=l.querySelector(".js-product-tile");if(i){const t=window.productListData.find(;items.push({...t,index:index+1,...u});[...i.querySelectorAll(".js-product-tile-link")].forEach(t=>{t.addEventListener("click",async()=>{const t=l.dataset.trackingId;window.T2S&&t&&window.T2S.click({trackingId:t});const{sendEvent:i,EVENTS:o}=await import("../base/event-tracker.js");i(o.SELECT_ITEM,{...m,ecommerce:{...m.ecommerce,items:[items[index]]}});h.action&&i("T2S_recommandation_click",{...h,value:l.dataset.pid})})})}});const{sendEventOnEnterViewport:l,EVENTS:p}=await import("../base/event-tracker.js");l(t,p.VIEW_ITEM_LIST,m,!i,u);h.action&&l(t,"T2S_recommandation_display",h,true)}}function I(t,i){const o=[...t.querySelectorAll(".js-recommendation-tile")];if(i&&o.length>i){o.forEach((t,index)=>{if(index>=i){g(t)}})}}async function M(e){const target=e.delegateTarget||e.target;const t=target.closest(".js-recommendations-list");const i=target.closest(".js-recommendation-tile");if(t&&t.dataset.source==="Einstein"&&i&&i.dataset.trackingClickUrl){await fetch(i.dataset.trackingClickUrl)}T(e,target.href)}function t(t){for(let i of t){if(i.type==="childList"&&i.addedNodes.length>0){for(let node of i.addedNodes){if(node.classList&&node.classList.contains("js-recommendations-list")){S(node);v(node,{callback:M});k();o(node);j("wishlist").then(async t=>{const{toggleWishlistProducts:i}=await import("../modules/wishlist.js");i(resolve("refColors",t)||[])});break}}}}}function q(t){const i="document.getElementById(divId).innerHTML = this.responseText;";if(t.innerHTML.indexOf(i)>=0){const o="if (this.responseText.indexOf('data-error=\"true\"') >= 0) { return; };";t.innerHTML=t.innerHTML.replace(i,`${o} ${i}`)}}function O(t,i){q(t);var o=m(`<div>${t.innerHTML}</div>`);var c=document.importNode(o,true);if(c.children[0].children.length===3){var l=c.children[0].children[2].id;i.setAttribute("id",l);i.dataset.source="Einstein";var script=document.createElement("script");script.innerHTML=c.querySelector("script").innerHTML;h(script,document.body)}}function H(t){return t.querySelector("script")&&t.innerHTML.indexOf('id="cq_recomm_slot-')!==-1}function A(t){const i=[...t.querySelectorAll(".js-recommendations-list")];if(i.length>0){i.forEach(t=>{const i=L(t.dataset.code);if(i){I(t,i.maxItems);_(t,i.code)}})}}async function V(t,i){if(H(t)){O(t,i)}else{l(t,i)}A(i);if(document.querySelector(".js-anim-enterview-enabled")){const{animEnterViewInit:o}=await import("./anim-enterview.js");o(i)}}const i=new MutationObserver(t);const N=new IntersectionObserver((entries,t)=>{for(let i=0,o=entries.length;i<o;i++){const l=entries[i];if(l.intersectionRatio>0){const m=l.target;u(m.dataset.url,{},true).then(;t.unobserve(m)}}},{rootMargin:"0px",threshold:0});export async function recommendationInit(selector){document.querySelectorAll(selector).forEach(t=>{if(t.dataset.url){i.observe(t,{childList:true});N.observe(t)}else if(t.classList.contains("js-atc-reco")){S(t);A(t);v(t,{callback:M})}})}