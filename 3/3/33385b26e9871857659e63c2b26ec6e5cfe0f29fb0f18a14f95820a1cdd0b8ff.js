![,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"extractBatch",(function(){return extractBatch})),__webpack_require__.d(__webpack_exports__,"request",(function(){return request})),__webpack_require__.d(__webpack_exports__,"successResponse",(function(){return successResponse})),__webpack_require__.d(__webpack_exports__,"errorResponse",(function(){return errorResponse})),__webpack_require__.d(__webpack_exports__,"post",(function(){return post})),__webpack_require__.d(__webpack_exports__,"listen",(function(){return listen})),__webpack_require__.d(__webpack_exports__,"postAndForget",(function(){return postAndForget}));var com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);const extractBatch=request=(from,msg,args)=>({batch:{kind:"request",from:from,msg:msg,args:args||[]}}),successResponse=(from,msg,result)=>({batch:{kind:"response",from:from,msg:msg,success:!0,result:result}}),errorResponse=(from,msg,error)=>({batch:{kind:"response",error:error?String(error):"Unknown Error",from:from,msg:msg,success:!1}});function post(from,to,msg,args){return new Promise((resolve,reject)=>{const channel=new MessageChannel;channel.port1.onmessage=e=>{const batch=extractBatch(e);batch&&"request"!==batch.kind?batch.success?resolve(batch.result):reject(batch.error):(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("message","("+from+")","invalid response",e),reject("Invalid response"))},to.postMessage(request(from,msg,args),"*",[channel.port2])})}const listen=(from,listener)=>window.addEventListener("message",e=>{const batch=extractBatch(e);null!=batch&&batch.from===from&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.debug("message","("+from+")","recieved",batch),listener(batch,e))}),postAndForget=(from,to,msg,args)=>to.postMessage(request(from,msg,args),"*")},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"LogLevel",(function(){return LogLevel})),__webpack_require__.d(__webpack_exports__,"Log",(function(){return Log}));var com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_config__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_helpers_window__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4);let LogLevel;!function(LogLevel){LogLevel[LogLevel.None=0]="None",LogLevel[LogLevel.Public=1]="Public",LogLevel[LogLevel.PublicError=2]="PublicError",LogLevel[LogLevel.Error=3]="Error",LogLevel[LogLevel.Warn=4]="Warn",LogLevel[LogLevel.Info=5]="Info",LogLevel[LogLevel.Trace=6]="Trace",LogLevel[LogLevel.Debug=7]="Debug"}(LogLevel||(LogLevel={}));const instance=new class{oadStorageSettings(){const safeWindow=Object(_helpers_window__WEBPACK_IMPORTED_MODULE_2__.default)();if(null!=safeWindow&&"object"==typeof safeWindow.localStorage){"1"===safeWindow.localStorage.getItem("com.batch.private.logger.listeners")&&this.addGlobalEventListeners();const rawLevel=safeWindow.localStorage.getItem("com.batch.private.logger.level");if(null!=rawLevel){const level=+rawLevel;level>=0&&level<=6&&(this.level=level)}try{const rawEnabledModules=safeWindow.localStorage.getItem("com.batch.private.logger.modules.enabled");if(rawEnabledModules){const enabledModules=JSON.parse(rawEnabledModules);Array.isArray(enabledModules)&&enabledModules.forEach(m=>{this.enableModule(m)})}const rawDisabledModules=safeWindow.localStorage.getItem("com.batch.private.logger.modules.disabled");if(rawDisabledModules){const disabledModules=JSON.parse(rawDisabledModules);Array.isArray(disabledModules)&&disabledModules.forEach(}}catch(_){}}}addGlobalEventListeners(){const safeWindow=Object(_helpers_window__WEBPACK_IMPORTED_MODULE_2__.default)();null!=safeWindow&&(safeWindow.addEventListener("___batchSDK___.logger.enableModule",e=>this.enableModule(e.module)),safeWindow.addEventListener("___batchSDK___.logger.disableModule",,safeWindow.addEventListener("___batchSDK___.logger.setLogLevel",)}enableModule(module){this.enabledModules.add(module.toLowerCase())}enableTunneling(to){this.tunnelingTo=to}roupMethod(){return console.group}blic(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];this.log(LogLevel.Public,"public",...args)}rror(module){for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)args[_key3-1]=arguments[_key3];this.log(LogLevel.Error,module,...args)}warn(module){for(var _len4=arguments.length,args=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++)args[_key4-1]=arguments[_key4];this.log(LogLevel.Warn,module,...args)}info(module){for(var _len5=arguments.length,args=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++)args[_key5-1]=arguments[_key5];this.log(LogLevel.Info,module,...args)}trace(module){for(var _len6=arguments.length,args=new Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++)args[_key6-1]=arguments[_key6];this.log(LogLevel.Trace,module,...args)}og(level,moduleName){for(var _len8=arguments.length,args=new Array(_len8>2?_len8-2:0),_key8=2;_key8<_len8;_key8++)args[_key8-2]=arguments[_key8];if(this.tunnelingTo){const a=[];args.forEach(,com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__.postAndForget(this.name,this.tunnelingTo,"log",[level,this.name+":"+moduleName,...a])}level!==LogLevel.Public&&level!==LogLevel.PublicError||(moduleName="public"),this.isModuleEnabled(moduleName)&&this.shouldLogForLevel(level)&&this.logMethodForLevel(level).apply(console,[this.formatPrefix(moduleName),"-",...args])}grouped(level,module,groupTitle,lines){if(this.isModuleEnabled(module)&&this.shouldLogForLevel(level)){groupTitle?this.getGroupMethod().apply(console,[this.formatPrefix(module),"-",groupTitle]):this.getGroupMethod().apply(console,[this.formatPrefix(module)]);const logMethod=this.logMethodForLevel(level);lines.forEach(,this.getGroupEndMethod().apply(console,[])}}},outerSafeWindow=Object(_helpers_window__WEBPACK_IMPORTED_MODULE_2__.default)();null!=outerSafeWindow&&outerSafeWindow.addEventListener("message",e=>{const batch=com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__.extractBatch(e);null!=batch&&"request"===batch.kind&&"log"===batch.msg&&batch.args&&instance.log(...batch.args)});const Log=instance},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"SDK_API_LVL",(function(){return SDK_API_LVL})),__webpack_require__.d(__webpack_exports__,"SDK_VERSION",(function(){return SDK_VERSION})),__webpack_require__.d(__webpack_exports__,"SDK_MAJOR_VERSION",(function(){return SDK_MAJOR_VERSION})),__webpack_require__.d(__webpack_exports__,"SDK_DISMISS_NOTIF_AFTER",(function(){return SDK_DISMISS_NOTIF_AFTER})),__webpack_require__.d(__webpack_exports__,"RETRY_MAX_ATTEMPTS",(function(){return RETRY_MAX_ATTEMPTS})),__webpack_require__.d(__webpack_exports__,"RETRY_MIN_INTERVAL_MS",(function(){return RETRY_MIN_INTERVAL_MS})),__webpack_require__.d(__webpack_exports__,"SSL_SCRIPT_URL",(function(){return SSL_SCRIPT_URL})),__webpack_require__.d(__webpack_exports__,"WS_URL",(function(){return WS_URL})),__webpack_require__.d(__webpack_exports__,"IS_DEV",(function(){return IS_DEV})),__webpack_require__.d(__webpack_exports__,"IS_TEST",(function(){return IS_TEST}));const SDK_API_LVL="1",SDK_VERSION="2.3.0",SDK_MAJOR_VERSION="2",SDK_DISMISS_NOTIF_AFTER=30,RETRY_MAX_ATTEMPTS=3,RETRY_MIN_INTERVAL_MS=1e3,SSL_SCRIPT_URL="via.batch.com",WS_URL="https://ws.batch.com/web",IS_DEV=!1,IS_TEST=!1},function(module,__webpack_exports__,__webpack_require__){"use strict";_webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return safeGetWindow}))},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return DatabaseSDK}));var com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9),com_batch_shared_event_event_tracker__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10),com_batch_shared_helpers_primitive_ts__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(17),com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(18),com_batch_shared_helpers_uuid__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8),com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(19),com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(22),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(2),com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(23),com_batch_shared_parameters_parameter_store__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(25),com_batch_shared_webservice_executor__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(32),_sdk__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(33);class DatabaseSDK{async setup(sdkConfig){try{if(this.config=Object.assign({},sdkConfig),!this.config.apiKey)throw new Error("Configuration error: 'apiKey' is mandatory");if(!this.config.authKey)throw new Error("Configuration error: 'authKey' is mandatory");this.config.dev=Object(com_batch_shared_helpers_primitive_ts__WEBPACK_IMPORTED_MODULE_3__.asBoolean)(this.config.dev,!1);const parameterStore=await com_batch_shared_parameters_parameter_store__WEBPACK_IMPORTED_MODULE_10__.default.getInstance();this.parameterStore=parameterStore,parameterStore.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.LastConfiguration,this.config);try{null==await parameterStore.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.InstallationID)&&this.createInstallationID()}catch(e){this.createInstallationID()}const stPromise=parameterStore.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscription).then(,sdPromise=parameterStore.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscribed).then(s=>this.lastSubscribed=!0===s);let referrer;await Promise.all([stPromise,sdPromise]),this.lastPermission=await this.readPermission(),this.lastState={permission:this.lastPermission||_sdk__WEBPACK_IMPORTED_MODULE_12__.Permission.Default,subscribed:this.lastSubscribed||!1},this.config.internal&&this.config.internal.referrer&&(referrer=this.config.internal.referrer),this.webserviceExecutor=new com_batch_shared_webservice_executor__WEBPACK_IMPORTED_MODULE_11__.default(this.config.apiKey,this.config.authKey,this.config.dev,referrer,parameterStore),this.eventTracker=new com_batch_shared_event_event_tracker__WEBPACK_IMPORTED_MODULE_2__.default(this.config.dev,this.webserviceExecutor),await this.isNewSession()&&(this.eventTracker.track(new com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__.default(com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.Start,{token:this.getEventToken()})),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.info("sdk-database","New session : "+com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.Start+" sent","with sub",this.lastSubscription));try{if(null!==window&&void 0!==window.navigator&&"permissions"in window.navigator){(await window.navigator.permissions.query({name:"notifications"})).addEventListener("change",this.checkUpdate.bind(this))}else com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.warn("sdk-database","Cannot listen to permission changes: API unavailable")}catch(e){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.warn("sdk-database","Error while listening to permission changes (not a fatal error)",e)}return null!=window&&(new com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_4__.UserAgent(window.navigator.userAgent).browser===com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_4__.Browser.Firefox&&window.setInterval(this.checkUpdate.bind(this),5e3),window.addEventListener("focus",this.checkUpdate.bind(this))),this}catch(e){throw com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.error("sdk-database","Error while initializing the sdk",e),new Error("Error while initializing the sdk")}}isNewSession(){return this.getParameterStore().then(store=>store.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.session.SessionID).then(sessid=>null===sessid?store.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.session.SessionID,Object(com_batch_shared_helpers_uuid__WEBPACK_IMPORTED_MODULE_5__.default)()).then(:Promise.resolve(!1)))}getParameterStore(){return null!=this.parameterStore?Promise.resolve(this.parameterStore):Promise.reject("parameter store null")}createInstallationID(){return this.getParameterStore().then(p=>p.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.InstallationID,Object(com_batch_shared_helpers_uuid__WEBPACK_IMPORTED_MODULE_5__.default)()))}bumpProfileVersion(){return this.getParameterStore().then(p=>p.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserProfileVersion).then(version=>{const intVal=null==version?NaN:parseInt(version,10);return p.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserProfileVersion,isNaN(intVal)?0:intVal+1)})).then(}setProfileParameter(key,identifier){const definedIdentifier=void 0===identifier?null:identifier;return this.getParameterStore().then(p=>p.setOrRemoveParameterValueIfChanged(key,definedIdentifier)).then(idChanged=>(idChanged&&this.bumpProfileVersion().then(()=>{this.eventTracker&&this.eventTracker.track(new com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__.default(com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.ProfileChanged)),com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_6__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_7__.default.ProfileChanged,{[key]:definedIdentifier},!0)}),definedIdentifier))}async setCustomUserID(identifier){return await this.setProfileParameter(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.CustomIdentifier,identifier),void 0===identifier?null:identifier}setLanguage(lang){return this.setProfileParameter(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserLanguage,lang)}etCustomUserID(){return this.getParameterStore().then(p=>p.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.CustomIdentifier))}getLanguage(){return this.getParameterStore().then(p=>p.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserLanguage))}getRegion(){return this.getParameterStore().then(}async getInstallationID(){const parameterStore=await this.getParameterStore(),installID=await parameterStore.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.InstallationID);if(null!=installID)return installID;throw new Error("Invalid internal state")}async isSubscribed(){return!("granted"!==await this.getPermission()||!await this.readAndCheckSubscribed())&&this.getSubscription().then(sub=>null!=sub)}sync readPermission(){return await this.getSubscription()?_sdk__WEBPACK_IMPORTED_MODULE_12__.Permission.Granted:_sdk__WEBPACK_IMPORTED_MODULE_12__.Permission.Default}async subscribe(){if("granted"===await this.getPermission())return this.updateSubscribed(!0),this.isSubscribed();throw new Error("Permission denied")}async unsubscribe(){return await this.updateSubscribed(!1),!await this.isSubscribed()}sync getSubscriptionState(){return{permission:await this.getPermission(),subscribed:await this.isSubscribed()}}sync readAndCheckSubscribed(){let sub=await(await this.getParameterStore()).getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscribed);return sub=!0===sub,this.lastSubscribed!==sub&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.info("sdk-database","Subscribed updated",sub),this.lastSubscribed=sub,this.subscriptionChanged(!0)),sub}async readAndCheckSubscription(){const sub=await(await this.getParameterStore()).getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscription),last=this.lastSubscription;return(null==last&&null!=sub||null!=last&&null==sub||(null==last?void 0:last.endpoint)!==(null==sub?void 0:sub.endpoint))&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.info("sdk-database","Subscription updated",sub),this.lastSubscription=sub,this.subscriptionChanged(!0)),sub}async updateSubscribed(subscribed){return(await this.getParameterStore()).setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscribed,subscribed),this.readAndCheckSubscribed()}async updateSubscription(sub){const parameterStore=await this.getParameterStore();return void 0===sub||null==sub?await parameterStore.removeParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscription):await parameterStore.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscription,sub),this.readAndCheckSubscription()}async updatePermission(perm){return this.lastPermission!==perm&&(this.lastPermission=perm,this.subscriptionChanged(!1)),perm}async subscriptionChanged(){let tokenChanged=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const state=await this.getSubscriptionState();if((tokenChanged||!this.lastState||this.lastState.subscribed!==state.subscribed)&&this.eventTracker){const params={token:this.getEventToken()};this.config.internal&&this.config.internal.referrer&&(params.referrer=this.config.internal.referrer),this.eventTracker.track(new com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__.default(state.subscribed?com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.Subscribed:com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.Unsubscribed,params));const p=await this.getParameterStore();await p.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscribed,state.subscribed)}this.lastState=state,com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_6__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_7__.default.SubscriptionChanged,state,!0)}getEventToken(){return this.lastSubscription?{protocol:"WPP",subscription:this.lastSubscription}:null}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return Event}));var _helpers_uuid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8);class Event{constructor(name,params){if("string"!=typeof name)throw new Error("Error while constructing Event: 'name' is required and should be a string");if(this.id=Object(_helpers_uuid__WEBPACK_IMPORTED_MODULE_0__.default)(),this.name=name.toUpperCase(),this.date=new Date,null!=params&&"object"!=typeof params)throw new Error("Error while constructing Event: 'params' is optional but must be an object if provided");this.params=params||{}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return uuid}));const supportsPRNG=void 0!==self.crypto&&void 0!==self.crypto.getRandomValues;,function(module,__webpack_exports__,__webpack_require__){"use strict";let InternalSDKEvent;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"InternalSDKEvent",(function(){return InternalSDKEvent})),function(InternalSDKEvent){InternalSDKEvent.ProfileChanged="_PROFILE_CHANGED",InternalSDKEvent.Start="_START",InternalSDKEvent.Subscribed="_SUBSCRIPTION",InternalSDKEvent.Unsubscribed="_UNSUBSCRIPTION",InternalSDKEvent.PushOpen="_OPEN_PUSH"}(InternalSDKEvent||(InternalSDKEvent={}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return EventTracker}));var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11),_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),_webservice_event_tracker__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(12),_webservice_http_error__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(16);class EventTracker{constructor(dev,webserviceExecutor){this.dev=dev,this.buffer=[],this.webserviceExecutor=webserviceExecutor,this.attemptRunning=!1,this.lastForbiddenLog=0}track(event){this.buffer.push(event),this.debounceSend&&clearTimeout(this.debounceSend),this.debounceSend=self.setTimeout(0)}send(){let retryCount=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return!(0===retryCount&&this.attemptRunning||0===this.buffer.length)&&(this.attemptRunning=!0,this.webserviceExecutor.start(new _webservice_event_tracker__WEBPACK_IMPORTED_MODULE_3__.default(this.buffer)).then(()=>{this.attemptRunning=!1,this.buffer=[],this.send()}).catch(e=>{retryCount+=1,retryCount<_config__WEBPACK_IMPORTED_MODULE_0__.RETRY_MAX_ATTEMPTS?Object(_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__.Delay)(_config__WEBPACK_IMPORTED_MODULE_0__.RETRY_MIN_INTERVAL_MS).then(:(this.attemptRunning=!1,e instanceof _webservice_http_error__WEBPACK_IMPORTED_MODULE_4__.default&&(401===e.response.status||403===e.response.status)&&Date.now()-this.lastForbiddenLog>1e4&&this.logForbiddenError())}),!0)}},function(module,__webpack_exports__,__webpack_require__){"use strict";webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Delay",(function(){return Delay})),__webpack_require__.d(__webpack_exports__,"Timeout",(function(){return Timeout}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return EventTrackerWebservice}));var _base__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13);class EventTrackerWebservice extends _base__WEBPACK_IMPORTED_MODULE_0__.default{etQuery(){return{payload:this.events.map(e=>Object.assign({},e,{date:e.date.toISOString()}))}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return BaseWebservice}));var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(14),_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(15);st DefaultHeaderKeys=[_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.CustomIdentifier,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.UserRegion,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.UserLanguage,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.UserProfileVersion,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.InstallationID,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.SDKAPILevel,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezone,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezoneOffset,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceDate,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceLanguage],BaseURL=`${_config__WEBPACK_IMPORTED_MODULE_0__.WS_URL}/${_config__WEBPACK_IMPORTED_MODULE_0__.SDK_VERSION}/`;,function(module,__webpack_exports__,__webpack_require__){"use strict";let ProfileKeys;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ProfileKeys",(function(){return ProfileKeys})),ProfileKeys||(ProfileKeys={}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return HttpError}));class HttpError extends Error{constructor(response,message){super(message||`Response not ok. Status text: "${response.statusText}"`),this.response=response}}},function(module,__webpack_exports__,__webpack_require__){"use strict";function asBoolean(value,fallback){return"boolean"==typeof value?value:"number"==typeof value?0!==value:fallback}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"asBoolean",(function(){return asBoolean}))},function(module,__webpack_exports__,__webpack_require__){"use strict";let Browser,Platform;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Browser",(function(){return Browser})),__webpack_require__.d(__webpack_exports__,"Platform",(function(){return Platform})),__webpack_require__.d(__webpack_exports__,"UserAgent",(function(){return UserAgent})),Browser||(Browser={})),Platform||(Platform={}));class UserAgent{constructor(userAgentString){let platform=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.navigator.platform;this.rawUA=userAgentString,this.rawPlatform=platform,this.parse()}uaContains(wanted){return-1!==this.rawUA.indexOf(wanted)}sDesktop(){switch(this.platform){case Platform.GenericDesktop:case Platform.MacOS:case Platform.Windows:case Platform.Linux:return!0;default:return!1}}isMobilesVAPIDPotentiallySupported(){return(this.isDesktop()||this.platform===Platform.Android)&&(this.browser===Browser.Chrome||this.browser===Browser.Firefox)}parse(){if(this.browser=Browser.Unknown,this.uaContains("Edge/")||this.uaContains("Trident/"))return this.browser=Browser.Generic,void(this.platform=Platform.Windows);if(this.uaContains("iPhone")||this.uaContains("iPad")||this.uaContains("CriOS"))return this.browser=Browser.Generic,void(this.platform=Platform.IOS);if(this.uaContains("Android")?this.platform=Platform.Android:(this.uaContains("Mobi")||this.uaContains("Tablet"))&&(this.platform=Platform.GenericMobile),this.platform!==Platform.Android&&(this.platform=Platform.GenericDesktop),this.platform===Platform.GenericDesktop&&(this.platformContains("Mac")?this.platform=Platform.MacOS:this.platformContains("Win")?this.platform=Platform.Windows:(this.platformContains("Linux")||this.platformContains("X11"))&&(this.platform=Platform.Linux)),this.uaContains("Chrome/")||this.uaContains("Chromium/"))return this.browser=Browser.Chrome,void(this.platform===Platform.Android&&(this.uaContains("; wv")||this.uaContains("(wv;")||this.uaContains("Chrome/30.0.0.0")||this.uaContains("Chrome/33.0.0.0"))&&(this.browser=Browser.Generic));if(this.uaContains("Firefox/"))this.browser=Browser.Firefox;else if(this.uaContains("Version/")&&this.platform===Platform.Android)this.browser=Browser.Generic;else{if(this.uaContains("Safari/"))return this.browser=Browser.Safari,void(this.platform===Platform.GenericDesktop&&(this.platform=Platform.MacOS));this.browser=Browser.Unknown,this.platform===Platform.GenericDesktop&&(this.platform=Platform.Unknown)}}}__webpack_exports__.default=UserAgent},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Evt",(function(){return Evt})),__webpack_require__.d(__webpack_exports__,"EventBus",(function(){return EventBus})),__webpack_require__.d(__webpack_exports__,"LocalEventBus",(function(){return LocalEventBus}));var _helpers_bounded_queue__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(20),_helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),_local_sdk_events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(22),_logger__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2);lass EventBus{ubscribe(evt,listener){if("function"!=typeof listener||"string"!=typeof evt)throw new Error("wrong parameters");this.getListenersFor(evt).push(listener),_logger__WEBPACK_IMPORTED_MODULE_3__.Log.grouped(_logger__WEBPACK_IMPORTED_MODULE_3__.LogLevel.Info,"local-bus","new listener subscribed",["to: "+evt,listener]),this.emitMissedEvents(evt,listener)}emit(code,detail,consumePrevious){if(code===_local_sdk_events__WEBPACK_IMPORTED_MODULE_2__.default.All)return void _logger__WEBPACK_IMPORTED_MODULE_3__.Log.warn("local-bus","The event * can't be triggered");const evt=new Evt(code,detail||{},consumePrevious),passed=this.getPassedEventsFor(code),last=passed.peek();consumePrevious&&(passed.clear(),passed.push(evt)),Object(_helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_1__.default)(last,evt)?_logger__WEBPACK_IMPORTED_MODULE_3__.Log.debug("local-bus","skipped",evt):(consumePrevious||passed.push(evt),_logger__WEBPACK_IMPORTED_MODULE_3__.Log.debug("local-bus","emit",evt),(this.listeners.get(code)||[]).forEach(e=>e(evt.detail,evt)),(this.listeners.get(_local_sdk_events__WEBPACK_IMPORTED_MODULE_2__.default.All)||[]).forEach(e=>e(evt.detail,evt)))}mitMissedEvents(code,listener){code===_local_sdk_events__WEBPACK_IMPORTED_MODULE_2__.default.All?this.passedEvents.forEach(:this.passedEvents.has(code)&&this.getPassedEventsFor(code).forEach(}getPassedEventsFor(code){let events=this.passedEvents.get(code);return null==events&&(events=new _helpers_bounded_queue__WEBPACK_IMPORTED_MODULE_0__.default(10),this.passedEvents.set(code,events)),events}}const LocalEventBus=new EventBus},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return BoundedQueue}));class BoundedQueue{constructor(capacity){if(this.backingArray=[],this.capacity=capacity,capacity<=0)throw new Error("Capacity must be greater than zero")}enforceCapacity(){for(;this.backingArray.length>this.capacity;)this.backingArray.shift()}pues(){return this.backingArray}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);const isNull=isBuffer=deepEqual=__webpack_exports__.default=deepEqual},function(module,__webpack_exports__,__webpack_require__){"use strict";var LocalSDKEvent;__webpack_require__.r(__webpack_exports__),LocalSDKEvent||(LocalSDKEvent={})),__webpack_exports__.default=LocalSDKEvent},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"allowedKeyByProvider",(function(){return allowedKeyByProvider})),__webpack_require__.d(__webpack_exports__,"keysByProvider",(function(){return keysByProvider}));var _keys_profile__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14),_keys_session__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24),_keys_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(15);onst allowedKeyByProvider={profile:getValuesArrayForStringEnum(_keys_profile__WEBPACK_IMPORTED_MODULE_0__.ProfileKeys),session:getValuesArrayForStringEnum(_keys_session__WEBPACK_IMPORTED_MODULE_1__.SessionKeys),system:getValuesArrayForStringEnum(_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys)},keysByProvider={profile:_keys_profile__WEBPACK_IMPORTED_MODULE_0__.ProfileKeys,session:_keys_session__WEBPACK_IMPORTED_MODULE_1__.SessionKeys,system:_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys}},function(module,__webpack_exports__,__webpack_require__){"use strict";let SessionKeys;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"SessionKeys",(function(){return SessionKeys})),SessionKeys||(SessionKeys={}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return ParameterStore}));var _helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_persistence_indexed_db__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26),_persistence_session__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(28),_keys__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(23),_profile_parameter_provider__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(29),_session_parameter_provider__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(30),_system_parameter_provider__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(31);let storeInstance=null;class ParameterStore{constructor(p){this.providers=p}getParameterValue(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.system.indexOf(key)?this.providers.system.getParameterForKey(key):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.getParameterForKey(key):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.session.indexOf(key)?this.providers.session.getParameterForKey(key):Promise.reject(`Cannot read ${key}: it is not a managed key`)}async setParameterValue(key,value){return void 0===value||null==value?Promise.reject(`Refusing to write null/unknown for ${key}. Use removeParameterValue to do so explicitly.`):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.setParameterForKey(key,value):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.session.indexOf(key)?(await this.providers.session.setParameterForKey(key,String(value)),value):Promise.reject(`Cannot set ${key}: it is not a managed key`)}removeParameterValue(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.removeParameterForKey(key):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.session.indexOf(key)?this.providers.session.removeParameterForKey(key):Promise.reject(`Cannot delete ${key}: it is not a managed key`)}setOrRemoveParameterValueIfChanged(key,value){const definedValue=void 0===value?null:value;return new Promise((resolve,reject)=>{this.getParameterValue(key).then(oldValue=>{Object(_helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_0__.default)(oldValue,value)?resolve(!1):null==definedValue?this.removeParameterValue(key).then(()=>resolve(!0)).catch(reject):this.setParameterValue(key,value).then(()=>resolve(!0)).catch(reject)},error=>{reject(error)})})},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _batch_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(27);const tableName="BatchKVData";let dbInstance=null;class IndexedDbPersistence{constructor(db){if(!(db instanceof IDBDatabase))throw new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default("Unable to setup indexed db");this.db=db}getData(key){return new Promise((resolve,reject)=>{const query=this.db.transaction([tableName]).objectStore(tableName).get(key);query.onerror=reject,query.onsuccess=event=>{const data=event.target.result;resolve(void 0===data?null:data.value)}})}setData(key,value){return new Promise((resolve,reject)=>{const query=this.db.transaction([tableName],"readwrite").objectStore(tableName).put({k:key,value:value});query.onerror=reject,query.onsuccess=)}removeData(key){return new Promise((resolve,reject)=>{const query=this.db.transaction([tableName],"readwrite").objectStore(tableName).delete(key);query.onerror=reject,query.onsuccess=)}static getInstance(){return new Promise((resolve,reject)=>{if(dbInstance instanceof IndexedDbPersistence)resolve(dbInstance);else{indexedDB||reject(new Error("IndexedDB not available"));const request=indexedDB.open("BatchWebPush",1);request.onerror=request.onsuccess=event=>{const db=event.target.result;dbInstance=new IndexedDbPersistence(db),resolve(dbInstance)},request.onupgradeneeded=event=>{event.target.result.createObjectStore(tableName,{keyPath:"k"})}}})}}__webpack_exports__.default=IndexedDbPersistence},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return BatchError}));,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _helpers_window__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4);const safeWindow=Object(_helpers_window__WEBPACK_IMPORTED_MODULE_0__.default)();__webpack_exports__.default=,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _batch_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(27),_keys__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23);__webpack_exports__.default=class{constructor(storageProvider){this.storage=storageProvider}async getParameterForKey(key){if(-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.profile.indexOf(key)){const value=await this.storage.getData(key);return void 0===value?null:value}throw new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot read ${key}: it is not a managed profile key`)}setParameterForKey(key,value){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.profile.indexOf(key)?this.storage.setData(key,value):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot set ${key}: it is not a managed profile key`))}removeParameterForKey(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.profile.indexOf(key)?this.storage.removeData(key):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(key+" is not a managed profile key"))}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _batch_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(27),_keys__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23);__webpack_exports__.default=class{constructor(storageProvider){this.storage=storageProvider}async getParameterForKey(key){if(-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.session.indexOf(key)){const value=await this.storage.getData("com.batch."+key);return void 0===value?null:value}throw new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot read ${key}: it is not a managed session key`)}setParameterForKey(key,value){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.session.indexOf(key)?this.storage.setData("com.batch."+key,value):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot set ${key}: it is not a managed session key`))}removeParameterForKey(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.session.indexOf(key)?(this.storage.removeData("com.batch."+key),Promise.resolve()):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default(`Cannot delete ${key}: it is not a managed session key`))}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_batch_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27),_keys_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(15);class SystemParameterProvider{getParameterForKey(key){return new Promise(resolve=>{switch(key){case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.SDKAPILevel:resolve(_config__WEBPACK_IMPORTED_MODULE_0__.SDK_API_LVL);break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezone:resolve(SystemParameterProvider.getTimezone()||"");break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezoneOffset:resolve((new Date).getTimezoneOffset().toString());break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceLanguage:{const navigator=self.navigator;resolve(null!=navigator?navigator.language:"")}break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceDate:resolve((new Date).toISOString());break;default:throw new _batch_error__WEBPACK_IMPORTED_MODULE_1__.default(key+" is not a managed system key")}})}__webpack_exports__.default=SystemParameterProvider},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return WebserviceExecutor}));var _logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_http_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(16);class WebserviceExecutor{sync start(ws){if("undefined"==typeof fetch)return Promise.reject(new Error("fetch API isn't available"));const options={body:"",cache:"no-cache",credentials:"omit",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),method:"POST",mode:"cors"};this.devMode||"string"!=typeof this.authKey||options.headers.set("X-Batch-Auth",this.authKey),this.devMode&&options.headers.set("X-Batch-Dev","true"),this.referrer&&options.headers.set("X-Batch-Referer",this.referrer);try{const body=await ws.getBody(this.parameterStore);options.body=JSON.stringify(body);const URL=ws.getBaseURL()+"/"+this.apiKey;_logger__WEBPACK_IMPORTED_MODULE_0__.Log.grouped(_logger__WEBPACK_IMPORTED_MODULE_0__.LogLevel.Info,"WSExecutor","Calling WS",["URL: "+URL,body,options]);const response=await fetch(URL,options);if(!response.ok)throw new _http_error__WEBPACK_IMPORTED_MODULE_1__.default(response);return _logger__WEBPACK_IMPORTED_MODULE_0__.Log.grouped(_logger__WEBPACK_IMPORTED_MODULE_0__.LogLevel.Info,"WSExecutor","WS finished successfuly",["Status text: "+response.statusText]),!0}catch(error){throw _logger__WEBPACK_IMPORTED_MODULE_0__.Log.error("WSExecutor","Error while executing WS",error),error}}}},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var com_batch_shared_helpers_push_helper__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(36),com_batch_shared_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),_sdk_database__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6);class SecureSDK extends _sdk_database__WEBPACK_IMPORTED_MODULE_3__.default{async setup(sdkConfig){if(await super.setup(sdkConfig),null==window)throw new Error("not in a browser page. is it a service worker?");if(!("serviceWorker"in window.navigator))throw new Error("no service worker");if(!("PushManager"in window))throw new Error("Push messaging isn't supported.");if(!sdkConfig.vapidPublicKey)throw new Error("Invalid public key");try{this.pubKey=Object(com_batch_shared_helpers_push_helper__WEBPACK_IMPORTED_MODULE_0__.urlBase64ToUint8Array)(sdkConfig.vapidPublicKey)}catch(e){throw com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.publicError("Could not decode 'vapidPublicKey'. Is it well formatted?"),new Error("Could not decode 'vapidPublicKey'. Is it well formatted?")}if(null==window.navigator.serviceWorker)throw new Error("Browser does not support service workers");{const timeout=Math.max(10,sdkConfig.serviceWorkerTimeout||10);let swPath="/batchsdk-worker-loader.js";"string"==typeof sdkConfig.serviceWorkerPathOverride&&(swPath=sdkConfig.serviceWorkerPathOverride||swPath);try{return await Promise.race([this.initServiceWorker(swPath),Object(com_batch_shared_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__.Timeout)(1e3*timeout)]),this}catch(e){throw com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.error("sdk-secure","Error while initializing service worker :",e),sdkConfig.useExistingServiceWorker?com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.publicError("Timed out while waiting for the existing service worker: is your service worker properly registered?\nOriginal error: "+e):com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.publicError("Failed to register the service worker. Is it accessible at '"+swPath+"'?\nOriginal error: "+e),new Error("An error occurred while initializing the service worker: "+e)}}}async initServiceWorker(swPath){const sdkConfig=this.config,swContainer=window.navigator.serviceWorker;sdkConfig.useExistingServiceWorker?com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.info("sdk-secure","Not registering Batch's, we have been asked to use the existing one"):await swContainer.register(swPath,{scope:"/"});const registration=await swContainer.ready;com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.info("sdk-secure","service worker ready");const worker=registration.active;this.worker=worker,this.pushManager=registration.pushManager,worker&&(worker.postMessage("batchSDKConfigLoaded"),worker.addEventListener("message",this.handleWorkerMessage))}handleWorkerMessageetPushManager(){return null!=this.pushManager?Promise.resolve(this.pushManager):Promise.reject("push manager is null")}getWorker(){return null!=this.worker?Promise.resolve(this.worker):Promise.reject("worker is null")}async subscribe(){const pm=await this.getPushManager();let sub;try{sub=await pm.subscribe({applicationServerKey:this.pubKey,userVisibleOnly:!0})}catch(e){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.warn("sdk-secure","subscription failed",e),sub=null}return this.updateSubscription(sub?sub.toJSON():null),this.updateSubscribed(null!=sub),this.isSubscribed()}async unsubscribe(){const pm=await this.getPushManager();let sub;try{sub=await pm.getSubscription()}catch(e){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.warn("sdk-secure","unsubscription failed",e),sub=null}return this.updateSubscription(sub?sub.toJSON():null),super.unsubscribe()}async getSubscription(){var _window,_window$Notification;if("granted"!==(null===(_window=window)||void 0===_window||null===(_window$Notification=_window.Notification)||void 0===_window$Notification?void 0:_window$Notification.permission))return super.getSubscription();try{const pushManager=await this.getPushManager(),sub=await pushManager.getSubscription();return this.updateSubscription(sub?sub.toJSON():null)}catch(e){return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.warn("sdk-secure","get subscription failed, reading it from the database. error:",e),super.getSubscription()}}readPermission(){return null!=window?Promise.resolve(window.Notification.permission):Promise.reject("Internal error (no window available)")}}__webpack_exports__.default=new class{constructor(){this.instance=null}setup(config){if(null==this.instance){const sdkConfig=Object.assign({},config);com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.info("sdk-secure","Instantiating a new SDK");const sdk=new SecureSDK;this.instance=sdk.setup(sdkConfig).then(()=>sdk)}else com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.warn("sdk-secure","Config cannot be set again once the SDK has already been started");return this.instance||Promise.reject("Setup failed")}getInstance(){return this.instance||Promise.reject("You must setup the SDK before using it")}runsOnOrigin(){return!0}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"urlBase64ToUint8Array",(function(){return urlBase64ToUint8Array}));const urlBase64ToUint8Array=,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"DOMElement",(function(){return DOMElement})),__webpack_require__.d(__webpack_exports__,"dom",(function(){return dom})),__webpack_require__.d(__webpack_exports__,"doc",(function(){return doc}));var _size__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(38);const realHTMLElementPrototype=Object.getPrototypeOf(Object.getPrototypeOf(document.createElement("span")));function isHTMLElement(e){return Object.prototype.isPrototypeOf.call(realHTMLElementPrototype,Object.getPrototypeOf(e))}class DOMElement{constructor(elems){this.wrapped=elems}toArray(){return null!=this.doms||(this.doms=this.wrapped.map(e=>DOMElement.from(e))),this.doms}){const e=this.elem();return void 0!==e&&0!==d.length()&&d.someElem(el=>el===e)}lectOne(selector){const a=this.wrapped.map(e=>e.querySelector(selector));return DOMElement.from(a.filter(e=>null!=e))}select(selector){const a=DOMElement.flattern(this.wrapped.map(e=>e.querySelectorAll(selector)));return DOMElement.from(a)}getByTag(tag){const a=DOMElement.flattern(this.wrapped.map(e=>e.getElementsByTagName(tag)));return DOMElement.from(a)}getByClass(className){const a=DOMElement.flattern(this.wrapped.map(e=>e.getElementsByClassName(className)));return DOMElement.from(a)}parent(){return DOMElement.from(this.wrapped.map(e=>e.parentElement).filter(e=>null!=e))}closest(selector){return DOMElement.from(this.wrapped.map(e=>e.closest(selector)).filter(e=>null!=e))}ength(){return this.wrapped.length}first(){return DOMElement.from(null!=this.doms?this.doms[0]:this.wrapped[0])}last(){return DOMElement.from(null!=this.doms?this.doms[this.wrapped.length-1]:this.wrapped[this.wrapped.length-1])}forEachlter(callback){return DOMElement.from(this.toArray().filter(callback).map(e=>e.elem()))}filterElem(callback){return this.wrapped.filter(callback)}sClass(className){return this.filterHTML().some(e=>e.className.split(" ").some()}addClass(className){return null!==className&&this.filterHTML().forEach(e=>{e.className+=" "+className}),this}removeClass(className){return null!==className&&this.filterHTML().forEach(e=>{e.className=e.className.split(" ").filter(.join(" ")}),this}html(content){return null!==content&&this.filterHTML().forEach(,this}text(content){return null!==content&&this.filterHTML().forEach(e=>{e instanceof HTMLInputElement?e.value=content:e.innerText=content}),this}placeholder(content){return null!==content&&this.filterHTML().forEach(e=>{e instanceof HTMLInputElement?e.placeholder=content:e.innerText=content}),this}listenTo(evt,callback){return null!=evt&&null!=callback&&this.wrapped.forEach(,this}style(st){return this.filterHTML().forEach(e=>{Object.keys(st).forEach(k=>e.style[k]=st[k])}),this}styleProperty(st){return"function"==typeof CSSStyleDeclaration.prototype.setProperty&&this.filterHTML().forEach(e=>{Object.keys(st).forEach(}),this}styleSVG(st){return this.filterSVG().forEach(e=>{Object.keys(st).forEach(}),this}rect(){const e=this.elem();return null==e?new _size__WEBPACK_IMPORTED_MODULE_0__.Rectangle(new _size__WEBPACK_IMPORTED_MODULE_0__.Position(0,0),new _size__WEBPACK_IMPORTED_MODULE_0__.Dimension(0,0)):Object(_size__WEBPACK_IMPORTED_MODULE_0__.sizeOfElement)(e)}dim(){const e=this.elem();return void 0===e?new _size__WEBPACK_IMPORTED_MODULE_0__.Dimension(0,0):Object(_size__WEBPACK_IMPORTED_MODULE_0__.sizeOfElement)(e).dim}isFixed(){let e=this.elem();for(;e&&!(e instanceof HTMLElement);)e=e.parentElement;if(null==e)return!1;for(;null!=e;){if("fixed"===window.getComputedStyle(e).position)return!0;e=e.offsetParent}return!1}before(newElem,clone){const a=this.wrapped.map(e=>null!=e.parentNode?e.parentNode.insertBefore(clone?newElem.cloneNode(!0):newElem,e):null);return DOMElement.from(a.filter(e=>null!=e))}append(newElem,clone){const a=this.wrapped.map(e=>e.appendChild(clone?newElem.cloneNode(!0):newElem));return DOMElement.from(a.filter(e=>null!=e))}prepend(newElem,clone){const a=this.wrapped.map(e=>{const ne=clone?newElem.cloneNode(!0):newElem;if("function"==typeof e.prepend)e.prepend(ne);else{const docFrag=document.createDocumentFragment();docFrag.appendChild(ne instanceof Node?ne:document.createTextNode(String(ne))),e.insertBefore(docFrag,e.firstChild)}return ne});return DOMElement.from(a.filter()}static flattern(a){return 0===a.length?[]:a.reduce([])}static from(ne){if(null==ne)return DOMElement.EMPTY;const e=ne;if("string"==typeof e)return DOMElement.from(document.querySelectorAll(e));if("object"==typeof e){if(e instanceof Array||e instanceof NodeList){const elements=[];for(let i=0;i<e.length;i++){const node=e[i];node instanceof Element&&elements.push(node)}return new DOMElement(elements)}if(e instanceof DOMElement)return e;if(e instanceof Element)return new DOMElement([e]);if(e instanceof HTMLCollection)return new DOMElement(Array.from(e))}return DOMElement.EMPTY}}var obj,key,value;function dom(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];if(0===args.length)return DOMElement.EMPTY;if(1===args.length)return DOMElement.from(args[0]);let d=DOMElement.EMPTY;return args.forEach(e=>d=d.concat(DOMElement.from(e))),d}obj=DOMElement,key="EMPTY",value=new DOMElement([]),key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;const doc={getById:id=>dom(document.getElementById(id)),getByTag:tag=>dom(document.getElementsByTagName(tag)),getByClass:className=>dom(document.getElementsByClassName(className)),selectOne:selector=>dom(document.querySelector(selector)),select:body:},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Position",(function(){return Position})),__webpack_require__.d(__webpack_exports__,"Dimension",(function(){return Dimension})),__webpack_require__.d(__webpack_exports__,"Rectangle",(function(){return Rectangle})),__webpack_require__.d(__webpack_exports__,"screenPos",(function(){return screenPos})),__webpack_require__.d(__webpack_exports__,"screenDim",(function(){return screenDim})),__webpack_require__.d(__webpack_exports__,"windowDim",(function(){return windowDim})),__webpack_require__.d(__webpack_exports__,"windowBox",(function(){return windowBox})),__webpack_require__.d(__webpack_exports__,"fromClientRect",(function(){return fromClientRect})),__webpack_require__.d(__webpack_exports__,"sizeOfElement",(function(){return sizeOfElement}));class Position{constructor(left,top){this.left=left,this.top=top}toString(){return"left="+this.left+"px,top="+this.top+"px"}asStyleclass Dimension{constructor(width,height){this.width=width,this.height=height}centerIn(box){const dim=box.dim,pos=box.pos,l=this.width<dim.width?dim.width/2-this.width/2:0,t=this.height<dim.height?dim.height/2-this.height/2:0;return new Position(l+pos.left,t+pos.top)}class Rectangle{constructor(pos,dim){this.pos=pos,this.dim=dim}op(){return this.pos.top}left(){return this.pos.left}right(){return this.pos.left+this.dim.width}idth(){return this.dim.width}function screenPos(){return void 0===window.screenLeft||void 0===window.screenTop?new Position(window.screenX,window.screenY):new Position(window.screenLeft,window.screenTop)}function screenDim(){return new Dimension(screen.width,screen.height)}function windowDim(){if(window.innerWidth||window.innerHeight)return new Dimension(window.innerWidth,window.innerHeight);if(null!=document.documentElement){const el=document.documentElement;if(el.clientWidth&&el.clientHeight)return new Dimension(el.clientWidth,el.clientHeight)}return screenDim()}unction fromClientRect(rect){const pos=new Position(rect.left,rect.top),dim=new Dimension(rect.right-rect.left,rect.bottom-rect.top);return new Rectangle(pos,dim)},,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_config__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_public_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(42);com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.name="MSDK",_config__WEBPACK_IMPORTED_MODULE_1__.IS_DEV&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.level=com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.LogLevel.Debug,com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.enableModule("*"),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.disableModule("local-bus"));!function(w){const api=Object(_public_api__WEBPACK_IMPORTED_MODULE_2__.default)();function execute(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];if(0===args.length)return void com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","No arguments given");let mArgs=null;args[0]instanceof Array&&(mArgs=args[0],args=args.slice(1));let result,callback=null;if(args.length>0&&("function"==typeof args[0]?(args.length>1&&com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","No arguments expected after a callback"),callback=args[0]):null==mArgs&&(mArgs=args)),null!=mArgs)if("string"!=typeof mArgs[0])com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","No message name given");else{const message=mArgs[0];let msg=message,who=api;mArgs=mArgs.slice(1),msg.startsWith("ui.")&&(msg=msg.substring(3),who=api.ui),who[msg]?result=who[msg].apply(api,mArgs):com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","Unknown message",message)}callback&&callback(api,result)}const queue=w.batchSDK&&w.batchSDK.q||[];if(Array.isArray(queue)){let job;for(w.batchSDK=job=queue.shift();)execute.apply(w,job);w.batchSDK=const devToolApi=w["_com.batchsdk.web.devtool.api"];if(devToolApi){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","Enabling devtool support");const oldSDK=w.batchSDK;"function"==typeof devToolApi.sdkCalled&&(w.batchSDK=function(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];devToolApi.sdkCalled.apply(w,args),oldSDK.apply(w,args)}),"function"==typeof devToolApi.setSdkApi&&devToolApi.setSdkApi((),"function"==typeof devToolApi.sdkLoaded&&devToolApi.sdkLoaded()}}(window)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return newPublicAPI}));var com_batch_dom_sdk_impl_sdk_insecure__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(43),com_batch_dom_sdk_impl_sdk_secure__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(35),com_batch_dom_ui_popup_manager__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(44),com_batch_dom_ui_translator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(45),com_batch_dom_ui_uicomponent_handler__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(49),com_batch_shared_helpers_object_deep_clone__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(50),com_batch_shared_helpers_primitive_ts__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(17),com_batch_shared_helpers_secure_origin__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(51),com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(19),com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(22),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(2),_config__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(3);let RUNS_ON_ORIGIN=!0;function newPublicAPI(){let originalConfig;const ready=new Promise(resolve=>{"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?resolve():(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_10__.Log.debug("public-api","Waiting for DOM to be ready"),window.addEventListener("DOMContentLoaded",!0))}).then(;let instance=null;function getInstance(){return(instance||Promise.reject("Batch is not initialized yet. Have you called 'setup' before calling Batch's API?")).catch(e=>{throw"Batch SDK: Could not initialize Public API: "+e})}const eventBus=com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_8__.LocalEventBus,uiComponents=new com_batch_dom_ui_uicomponent_handler__WEBPACK_IMPORTED_MODULE_4__.UIComponentHandler;uiComponents.add("popup",com_batch_dom_ui_popup_manager__WEBPACK_IMPORTED_MODULE_2__.initPopupComponent);let setupCalled=!1;const api={setup:config=>{if(setupCalled)return void com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_10__.Log.publicError("'setup' cannot be called twice. Ignoring.");setupCalled=!0,originalConfig=Object(com_batch_shared_helpers_object_deep_clone__WEBPACK_IMPORTED_MODULE_5__.default)(config);const uiConfig=(config=Object(com_batch_shared_helpers_object_deep_clone__WEBPACK_IMPORTED_MODULE_5__.default)(config)).ui;uiConfig&&"string"==typeof uiConfig.language&&(Object(com_batch_dom_ui_translator__WEBPACK_IMPORTED_MODULE_3__.default)().setLanguage(uiConfig.language),delete uiConfig.language);const origin=document.location.origin.toLowerCase(),sdkConfig=Object.assign({},config,{internal:{origin:origin.startsWith("http")?origin:null,referrer:document.location.href.toLowerCase(),workerScriptUrl:_config__WEBPACK_IMPORTED_MODULE_11__.IS_DEV?"http://localhost:8000/worker.min.js":`https://${_config__WEBPACK_IMPORTED_MODULE_11__.SSL_SCRIPT_URL}/${_config__WEBPACK_IMPORTED_MODULE_11__.SDK_VERSION}/worker.min.js`},ui:null});Object(com_batch_shared_helpers_secure_origin__WEBPACK_IMPORTED_MODULE_7__.default)(window.location.protocol,window.location.hostname)?"boolean"!=typeof sdkConfig.sameOrigin&&(sdkConfig.sameOrigin=!0):(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_10__.Log.debug("public-api","Insecure origin: forcing sameOrigin to 'false'"),sdkConfig.sameOrigin=!1),RUNS_ON_ORIGIN=sdkConfig.sameOrigin,RUNS_ON_ORIGIN||(sdkConfig.serviceWorkerPathOverride="/v"+_config__WEBPACK_IMPORTED_MODULE_11__.SDK_MAJOR_VERSION+"/batchsdk-iframe-worker-loader.js");const sdkFactory=RUNS_ON_ORIGIN?com_batch_dom_sdk_impl_sdk_secure__WEBPACK_IMPORTED_MODULE_1__.default:com_batch_dom_sdk_impl_sdk_insecure__WEBPACK_IMPORTED_MODULE_0__.default;Object(com_batch_shared_helpers_primitive_ts__WEBPACK_IMPORTED_MODULE_6__.asBoolean)(sdkConfig.dev,!1)&&com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_10__.Log.public("Starting version "+_config__WEBPACK_IMPORTED_MODULE_11__.SDK_VERSION+" in development mode.","Environment: "+(RUNS_ON_ORIGIN?"Fully secure":"HTTP/Multidomain (subdomain: "+sdkConfig.subdomain+")"));const uiReady=uiComponents.init(uiConfig||{});if(instance=ready.then(,com_batch_dom_ui_popup_manager__WEBPACK_IMPORTED_MODULE_2__.Popup.setup(instance,sdkConfig),window)if(sdkConfig.enableHashFeatures){window.addEventListener("hashchange",e=>{if(e.newURL){const url=new URL(e.newURL);""!==url.hash&&com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_8__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_9__.default.HashChanged,{hash:url.hash},!0)}});const currentHash=window.location.hash;""!==currentHash&&com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_8__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_9__.default.HashChanged,{hash:currentHash},!0)}else com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_10__.Log.debug("Core","Hash features have been disabled by configuration, not listening to 'hashchange'.");instance.then(sdk=>{sdk.getInstallationID().then(iid=>{sdkConfig.dev&&com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_10__.Log.public("Installation ID: "+(iid||"unknown"))});const subPromise=sdk.getSubscriptionState();uiReady.catch(e=>com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_10__.Log.warn("public-api","Error while initializing the ui :",e)).then(()=>subPromise).then(state=>com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_8__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_9__.default.UiReady,state,!1))}).catch(},getConfiguration:setCustomUserID:identifier=>getInstance().then(sdk=>sdk.setCustomUserID(identifier)),getCustomUserID:()=>getInstance().then(sdk=>sdk.getCustomUserID()),setUserLanguage:language=>getInstance().then(sdk=>sdk.setLanguage(language)),getUserLanguage:()=>getInstance().then(sdk=>sdk.getLanguage()),setUserRegion:getUserRegion:()=>getInstance().then(sdk=>sdk.getRegion()),getInstallationID:()=>getInstance().then(sdk=>sdk.getInstallationID()),isSubscribed:()=>getInstance().then(sdk=>sdk.isSubscribed()),getNotificationPermission:()=>getInstance().then(sdk=>sdk.getPermission()),subscribe:()=>getInstance().then(sdk=>sdk.subscribe()),unsubscribe:()=>getInstance().then(sdk=>sdk.unsubscribe()),tryToSubscribeFrom:(state,forceAsk)=>{if(null==state)return Promise.reject("No state given");let p=Promise.resolve(!1);return p=state.subscribed?api.isSubscribed():api.runsOnOrigin()||!forceAsk&&"granted"===state.permission?api.subscribe():api.ui.get("popup").openFor(state.permission).then(,p},getSubscription:()=>getInstance().then(sdk=>sdk.getSubscription()),getSubscriptionState:runsOnOrigin:()=>RUNS_ON_ORIGIN,on:(eventCode,callback)=>{eventBus.subscribe(eventCode,},ui:{register:(code,init)=>{uiComponents.add(code,(function(config){const compConfigWithTrans=Object(com_batch_dom_ui_translator__WEBPACK_IMPORTED_MODULE_3__.default)().populateDefaultComponentText(config,code);return compConfigWithTrans.popin=Object(com_batch_dom_ui_translator__WEBPACK_IMPORTED_MODULE_3__.default)().populateDefaultComponentText(compConfigWithTrans.popin||{},"popin"),init(api,compConfigWithTrans,component=>{com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_8__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_9__.default.UiComponentDrawn,{code:code,component:component},!1)})}))},registerAfter:(dependencies,code,init)=>{const waitingFor=new Set(dependencies);0===waitingFor.size?api.ui.register(code,init):eventBus.subscribe(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_9__.default.UiComponentReady,cready=>{waitingFor.delete(cready.code)&&0===waitingFor.size&&api.ui.register(code,init)})},get:code=>{const c=uiComponents.getComponent(code);return null!=c?c.component:null},has:code=>uiComponents.getComponentState(code)===com_batch_dom_ui_uicomponent_handler__WEBPACK_IMPORTED_MODULE_4__.UIComponentState.LOADED,waitUntilDrawn:componentCode=>uiComponents.waitUntilDrawn(componentCode),show:(componentCode,force)=>(force=force||!1,api.ui.waitUntilDrawn(componentCode).then(),hide:componentCode=>api.ui.waitUntilDrawn(componentCode).then(,showPublicIdentifiers:()=>uiComponents.showPublicIdentifiers()}};return api}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(19),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),_config__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3);class InsecureSDK{constructor(){com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__.listen("iframe",this.onIframeMessage.bind(this)),this.waitingPromises=[]}setup(sdkConfig){return new Promise((resolve,reject)=>{if(this.sdkConfig=sdkConfig,this.sdkConfig.subdomain)if(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.debug("iframe",this.sdkConfig),null!=document.body){const body=document.body,ifr=document.createElement("iframe"),initIframe=()=>{this.iframe=ifr.contentWindow,InsecureSDK.postMessage(this.iframe,"setup",[this.sdkConfig]).then(.catch(reject)},iframeURL=_config__WEBPACK_IMPORTED_MODULE_3__.IS_DEV?document.location.origin+"/iframe.html":`https://${sdkConfig.subdomain}.${_config__WEBPACK_IMPORTED_MODULE_3__.SSL_SCRIPT_URL}/${_config__WEBPACK_IMPORTED_MODULE_3__.SDK_VERSION}/iframe.html`;ifr.src=iframeURL,ifr.style.display="none",ifr.addEventListener("load",initIframe,!1),body.appendChild(ifr)}else reject("Body not ready");else reject(new Error("Configuration error: 'subdomain' is mandatory"))})}setCustomUserID(identifier){return InsecureSDK.postMessage(this.iframe,"setCustomUserID",[identifier])}getCustomUserID(){return InsecureSDK.postMessage(this.iframe,"getCustomUserID")}setLanguage(lang){return InsecureSDK.postMessage(this.iframe,"setLanguage",[lang])}setRegion(region){return InsecureSDK.postMessage(this.iframe,"setRegion",[region])}getLanguage(){return InsecureSDK.postMessage(this.iframe,"getLanguage")}getRegion(){return InsecureSDK.postMessage(this.iframe,"getRegion")}getInstallationID(){return InsecureSDK.postMessage(this.iframe,"getInstallationID")}isSubscribed(){return InsecureSDK.postMessage(this.iframe,"isSubscribed")}getPermission(){return InsecureSDK.postMessage(this.iframe,"getPermission")}getSubscriptionState(){return InsecureSDK.postMessage(this.iframe,"getSubscriptionState")}getSubscription(){return InsecureSDK.postMessage(this.iframe,"getSubscription")}unsubscribe(){return InsecureSDK.postMessage(this.iframe,"unsubscribe")}nIframeMessage(batch){if("request"!==batch.kind)return;if("event"!==batch.msg)return;const args=batch.args||[];args.length<3||com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_1__.LocalEventBus.emit(args[0],args[1],args[2])}static postMessage(to,msg,args){return to?com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__.post("insecure",to,msg,args):Promise.reject("Missing iframe window")}}__webpack_exports__.default=new class{etup(config){if(null==this.instance){const sdkConfig=Object.assign({},config);com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.info("sdk-insecure","Intanciating a new SDK");const sdk=new InsecureSDK;this.instance=sdk.setup(sdkConfig).then(()=>sdk)}else com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.warn("sdk-insecure","Config cannot be set again once the SDK has already been started");return this.instance||Promise.reject("Setup failed")},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Popup",(function(){return Popup})),__webpack_require__.d(__webpack_exports__,"PopupUIComponent",(function(){return PopupUIComponent})),__webpack_require__.d(__webpack_exports__,"initPopupComponent",(function(){return initPopupComponent}));var com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_config__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),_size__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(38),_translator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(45);const popupDim=new _size__WEBPACK_IMPORTED_MODULE_3__.Dimension(650,470);class PopupManager{nitUIen(code){const pr=this.createAndKeepSubscritpionPromise();if(null==this.sdkConfig||null==this.uiConfig)return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.warn("popup-manager","Try to open a popup",code," on a non setup manager"),this.rejectPromiseWith("Not setup"),pr;const config=this.sdkConfig,url=_config__WEBPACK_IMPORTED_MODULE_2__.IS_DEV?`http://localhost:8000/popup-${code}.html`:`https://${config.subdomain}.${_config__WEBPACK_IMPORTED_MODULE_2__.SSL_SCRIPT_URL}/${_config__WEBPACK_IMPORTED_MODULE_2__.SDK_VERSION}/popup-${code}.html`,coords=new _size__WEBPACK_IMPORTED_MODULE_3__.Rectangle(popupDim.centerIn(Object(_size__WEBPACK_IMPORTED_MODULE_3__.windowBox)()),popupDim);return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.debug("popup-manager","open a popup",url,"at",coords),this.popup=window.open(url,"batchwebpush","menubar=no,status=no,toolbar=no,location=no,"+coords.toString()),null==this.popup?(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.warn("popup-manager","The navigator may have blocked the popup"),this.rejectPromiseWith("Unable to open a popup")):this.setInterval(),pr}close(){if(null!=this.popup){const popup=this.popup;this.popup=null,popup.closed||popup.close()}this.clearInterval(),this.tryResolvePromise()}checkClosed(){(null==this.popup||this.popup.closed)&&this.close()}setInterval(){null==this.intervalId&&(this.intervalId=window.setInterval(this.checkClosed.bind(this),500))}clearIntervalefreshSubscription(){return null!=this.sdkPromise?this.sdkPromise.then(:Promise.reject(new Error("Not setup"))}createAndKeepSubscritpionPromise(){return null!=this.waitingPromise&&this.close(),new Promise(}ryResolvePromiseWith(promise){if(null==this.waitingPromise)return;const waiting=this.waitingPromise;this.waitingPromise=null,promise.then(sub=>waiting.resolve(sub)).catch(}rejectPromiseWith(e){if(null==this.waitingPromise)return;const waiting=this.waitingPromise;this.waitingPromise=null,waiting.reject(e)}onPopupMessage(batch,e){if(null==this.sdkPromise)return void com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.warn("popup-manager","Recieve a message while the manager was not started",e);if("request"!==batch.kind)return void com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.warn("popup-manager","Recieved a message that is not a request",e);const sdkPromise=this.sdkPromise,sdkConfig=this.sdkConfig||{};switch(batch.msg){case"loaded":{null==this.popup&&e.source instanceof Window&&(this.popup=e.source,this.setInterval());const config=Object.assign(sdkConfig,{ui:this.uiConfig});sdkPromise.then(()=>(config.ui=Object(_translator__WEBPACK_IMPORTED_MODULE_4__.default)().populateDefaultPopupText(config.ui||{}),PopupManager.postMessage(e.source,"setup",[config])));break}case"subscription":{const sub=this.refreshSubscription();if(null!=this.popup&&this.popup===e.source){const args=batch.args;Array.isArray(args)&&0==args[0]?this.popup.closed&&(this.popup=null,this.tryResolvePromiseWith(sub)):this.popup.close()}break}case"unloaded":{const sub=this.refreshSubscription();null!=this.popup&&this.popup===e.source&&this.popup.closed&&(this.popup=null,this.tryResolvePromiseWith(sub));break}default:com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.warn("popup-manager","Unknown message",batch)}}static postMessage(to,msg,args){return!to||to instanceof ServiceWorker?Promise.reject("Invalid 'to'"):com_batch_dom_iframe_channel_message__WEBPACK_IMPORTED_MODULE_0__.post("popup-manager",to,msg,args)}}const instance=new PopupManager,Popup=instance;class PopupUIComponent{penFor(permission){return"denied"===permission?this.open("denied"):this.open("ask")}function initPopupComponent(conf){const comp=new PopupUIComponent;return instance.initUI(conf).then(}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var com_batch_translations_translations__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(46);const popups=["ask","denied","settings","subscribe"],comps=["button","switcher","banner","popin","alert","public-identifiers"],getTransForComponent=(languageCode,componentCode)=>{const translationsMap=(languageCode=>Object.prototype.hasOwnProperty.call(com_batch_translations_translations__WEBPACK_IMPORTED_MODULE_0__.translations,languageCode)?com_batch_translations_translations__WEBPACK_IMPORTED_MODULE_0__.translations[languageCode]:com_batch_translations_translations__WEBPACK_IMPORTED_MODULE_0__.translations.en)(languageCode);return Object.prototype.hasOwnProperty.call(translationsMap,componentCode)&&translationsMap[componentCode]||{}};class Translator{constructor(languageCode){this.lg=languageCode}opulateDefaultComponentText(uiConfig,componentCode){if(-1===comps.indexOf(componentCode))return uiConfig;const defaultTranslations=getTransForComponent(this.lg,componentCode);return uiConfig=Object.assign({},defaultTranslations,uiConfig)}populateDefaultPopupText(uiConfig){return popups.forEach(popupName=>{const componentCode=`popup${popupName.charAt(0).toUpperCase()}${popupName.substr(1)}`,defaultTranslations=getTransForComponent(this.lg,componentCode),configTranslations=Object.prototype.hasOwnProperty.call(uiConfig,popupName)?uiConfig[popupName]:{};uiConfig[popupName]=Object.assign({},defaultTranslations,configTranslations)}),uiConfig}}let instance=null;__webpack_exports__.default=languageCode=>(instance?languageCode&&instance.setLanguage(languageCode):instance=new Translator("string"==typeof languageCode?languageCode:navigator.language),instance)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"translations",(function(){return translations}));var _en__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(47),_fr__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(48);const translations={en:_en__WEBPACK_IMPORTED_MODULE_0__.translations,fr:_fr__WEBPACK_IMPORTED_MODULE_1__.translations}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"translations",(function(){return translations}));const shared_step1="Step 1:",shared_step2="Step 2:",shared_chrome1="Click on the green [secure] button on the left side of the address bar",shared_chrome2='Next to notifications, pick: "Always allow on this site"',shared_firefox1="Click on [i] button on the left side of the address bar",shared_firefox2='Click on the [x] next to "Block" on the notifications permission',translations={popin:{title:"Manage site notifications",btnSub:"Subscribe",btnUnsub:"Unsubscribe",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},button:{hover:"Manage notifications "},banner:{text:"Never miss an update !",btnSub:"Subscribe",btnUnsub:"Unsubscribe",title:"Reactivate notifications",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},alert:{text:"Never miss an update !",positiveSubBtnLabel:"Subscribe",positiveUnsubBtnLabel:"Unsubscribe",negativeBtnLabel:"No, thanks",title:"Reactivate notifications",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},popupDenied:{title:"How to reactive notifications",chromeTitle:"Notifications are blocked for this website",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},popupSubscribe:{title:"Register to notifications",text:"We'd like to send you notifications to keep you informed of our last news",yes:"Allow notifications",no:"No, thanks"},popupAsk:{title:"Register to notifications",text:"Please allow push notifications so we can keep you updated",close:"Close"},"public-identifiers":{titleLabel:"Batch SDK - Identifiers",isRegisteredLabel:"Subscribed to notifications?",closeLabel:"Close",loadingText:"Loading...",noValueText:"<No value>",errorText:"<Error>",copyLabel:"Copy",yesText:"Yes",noText:"No"}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"translations",(function(){return translations}));const shared_step1="Etape 1:",shared_step2="Etape 2:",shared_chrome1="Cliquer sur [Sécurisé] à gauche de la barre d'adresse",shared_chrome2='Au niveau de notifications, choisir "Toujours montrer sur ce site"',shared_firefox1="Cliquez sur le boutton [i] à gauche de la barre d'adresse",shared_firefox2='Sur la permission Notifications, cliquez sur la [x] à côté de "Bloquer"',translations={popin:{title:"Recevoir les notifs",btnSub:"Je m'abonne",btnUnsub:"Ne plus recevoir",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},button:{hover:"Gérer les notifications "},banner:{text:"Ne ratez plus jamais une nouveauté !",btnSub:"Je m'abonne",btnUnsub:"Ne plus recevoir",title:"Reactiver les notifications",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},alert:{text:"Ne ratez plus jamais une nouveauté !",positiveSubBtnLabel:"Je m'abonne",positiveUnsubBtnLabel:"Ne plus recevoir",negativeBtnLabel:"Non merci",title:"Reactiver les notifications",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},popupDenied:{title:"Comment réactiver les notifications",chromeTitle:"Les notifications Chrome sont bloquées pour ce site",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},popupSubscribe:{title:"S'inscrire aux notifications",text:"Nous aimerions vous envoyer des notifications pour vous tenir informé des dernières nouveautés",yes:"Autoriser les notifications",no:"Non merci"},popupAsk:{title:"S'inscrire aux notifications",text:"Autorisez les notifications pour que nous puissions vous tenir informé des dernières nouveautés",close:"Fermer la fenêtre"},"public-identifiers":{titleLabel:"Batch SDK - Identifiants",isRegisteredLabel:"Est abonné aux notifications?",closeLabel:"Fermer",loadingText:"Chargement...",noValueText:"<Aucune valeur>",errorText:"<Erreur>",copyLabel:"Copier",yesText:"Oui",noText:"Non"}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"UIComponentState",(function(){return UIComponentState})),__webpack_require__.d(__webpack_exports__,"UIComponent",(function(){return UIComponent})),__webpack_require__.d(__webpack_exports__,"UIComponentHandler",(function(){return UIComponentHandler}));var com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),com_batch_shared_batch_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27),com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(19),com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(22),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2),_dom__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(37);const publicComponents=["button","banner","switcher","popin","alert","native"],privateComponents=["public-identifiers"],baseComponentUrl=com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__.IS_DEV?document.location.origin+"/":`https://${com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__.SSL_SCRIPT_URL}/${com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__.SDK_VERSION}/`;leLOADED=2]="LOADED"}(UIComponentState||(UIComponentState={})ll,this.success=!1}ready(){return n()&&!this.ready()}init(conf){if(this.initialized()&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.warn("ui-component-handler","The module is already initialized",this.code),this.promise instanceof Promise))return this.promise;com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.debug("ui-component-handler","Init component",this.code);const res=this.initFunction(conf),prom=res instanceof Promise?res:Promise.resolve(res);return this.promise=prom.then(r=>(this.success=!0,this.component=null==r?{}:r)).catch(e=>(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.warn("ui-component-handler","Error while initializing the component",this.code,e),this.success=!1,this.component={})),this.promise.then(()=>{this.success&&com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_2__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_3__.default.UiComponentReady,{code:this.code,component:this.component},!1)}),this.promise}}class UIComponentHandler{constructor(){this.components=new Map,this.loadingComponents=new Set,this.config=null,com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_2__.LocalEventBus.subscribe(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_3__.default.HashChanged,this.onHashublicIdentifiers()}add(code,initFunction){if(this.getComponentState(code)==UIComponentState.LOADED)throw new com_batch_shared_batch_error__WEBPACK_IMPORTED_MODULE_1__.default("The component "+code+" already exists");this.loadingComponents.delete(code);const component=new UIComponent(code,initFunction);return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.info("ui-component-handler","Add new component",code),this.components.set(code,component),null!=this.config&&component.init(this.config[cts.get(code)||null}getComponentState(code){return this.loadingComponents.has(code)?UIComponentState.LOADING:this.components.get(code)?UIComponentState.LOADED:UIComponentState.UNKNOWN}shouldLoadComponent(code){return this.getComponentState(code)==UIComponentState.UNKNnts.indexOf(code)}loadNativeComponentScript(code){if(!this.shouldLoadComponent(code))return Promise.reject(`Refusing to load component ${code}: it is already loaded or is loading.`);if(!this.isKnownComponent(code))return Promise.reject(`Refusing to load component ${code}: it is not part of the known loadable components`);const url=`${baseComponentUrl}${code}.min.js`;return new Promise((resolve,reject)=>{const tag=document.createElement("script");tag.async=!0,tagoad=()=>resolve(!0),tag.onerror=()=>{this.loadingComponents.delete(code),reject("Loading error")},_dom__WEBPACK_IMPORTED_MODULE_5__.doc.getByTag("script").first().before(tag,!1).empty()?reject(new Error("Unable to insert the script "+url)):this.loadingComponents.add(code)})}autoLoadNativeComponents(config){const loadingPromises=Object.keys(config).filter(code=>this.isPublicCript(componentCode));return Promise.all(lo=>Promise.resolve())}async showPublicIdentifiers(){try{await this.loadNativeComponentScript("public-identifiers")}catch(_unused){}(await this.waitUntilDrawn("public-identifiers")).show(!0)}waitUntilDrawn(componentCode){return new Promise(resolve=>{com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_2__.LocalEventBus.subscribe(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_3__.default.UiComponentDrawn,data=>{data.code===componentCode&&data.component&&resolve(data.component)})})}init(config){return this.config=config,this.autoLoadNativeComponents(config).then(()=>{const promises=[];return this.components.forEach((value,key)=>{value.initialized()||promises.push(value.init(config[key]||{}))}),Promise.all(promises)})}}},function(module,__webpack_exports__,__webpack_require__){"use strict";function deepClone(src){const source=src;if("object"!=typeof source)return source;if(null==source)return null;if(source instanceof Date)return new Date(source);if(source instanceof Array){const outArray=[];for(let i=0;i<source.length;i++)outArray[i]=deepClone(source[i]);return outArray}if(source instanceof Object){const outObject={};for(const prop in source)Object.prototype.hasOwnProperty.call(source,prop)&&(outObject[prop]=deepClone(source[prop]));return outObject}return source}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return deepClone}))},function(module,__webpack_exports__,__webpack_require__){"use strict";function isOriginSecure(protocol,hostname){return!!window.isSecureContext||("https:"==protocol||"wss:"==protocol||"file:"==protocol||("localhost"==hostname||"127/8"==hostname||"::1/128"==hostname))}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_eurn isOriginSecure}))}]);