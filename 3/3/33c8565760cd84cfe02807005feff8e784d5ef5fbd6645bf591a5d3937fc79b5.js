import{a6 as B,as as j,ay as ne,dT as K,bj as Ne,bi as He,l as Ge,a1 as ee,aA as z,d5 as _t,bu as yt,az as G,aB as ze,b4 as ft,aC as gt,bd as X,bF as ht,dn as bt,ab as Ct,b0 as kt,aE as St,a5 as Be,ai as ge,dQ as me,aV as $t,dU as Pt,aa as xt,u as Et,bs as Vt,G as Dt,au as wt,Q as It,o as Tt,K as le,dP as Te,dh as Fe,aw as Ft}from"./itinerary-entities.5f897bcd.js";import{l as H,am as _e,G as p,P as x,x as l,z as e,Y as o,a6 as S,an as te,ao as ae,r as F,c as i,q as oe,a7 as $,I as P,a as N,U as Me,F as de,$ as je,H as M,Q as E,aa as qe,R as ye,w as Ue,N as Mt,O as Ut,W as Re,a3 as Rt,y as Lt}from"./graphql.5cf3693b.js";import{g as fe,b as re,u as We,l as At}from"./entry.a7cea746.js";import{T as Nt}from"./TermsAndConditionsContent.478f16c3.js";import{T as Le}from"./Timer.ca14a1b8.js";import{S as Ht}from"./Bilitcoin.e2318baf.js";import{P as ve,S as Gt}from"./itinerary-modules.2ea32123.js";import{d as Y,M as J}from"./mixins.c083cc34.js";import"./service-client.4862e840.js";const Oe=_=>(te("data-v-f3a395af"),_=_(),ae(),_),zt={class:"giftcard"},Bt={key:0},jt={class:"title",dir:"ltr"},qt={class:"info"},Wt=Oe(()=>o("span",null,"اعتبار: ",-1)),Ot={key:1},Yt=Oe(()=>o("p",{class:"title"},"عدم استفاده از سفر کارت",-1)),Jt=[Yt],Qt=H({__name:"GiftCardItem",props:{giftCardCode:{},expiration:{},credit:{},modelValue:{}},emits:["update:modelValue"],setup(_,{emit:C}){const g=B();function s(){C("update:modelValue",_.giftCardCode||""),_.giftCardCode?g.applyGiftcard(_.giftCardCode):g.removeGiftcard()}return(t,y)=>{var v;const n=_e("mr-checkbox");return p(),x("div",zt,[l(n,{"model-value":t.modelValue===t.giftCardCode,"radio-name":"giftcard",size:"large","is-radio":"",disabled:e(g).payFullyWithCredit&&((v=t.giftCardCode)==null?void 0:v.length),"onUpdate:modelValue":s},null,8,["model-value","disabled"]),t.giftCardCode?(p(),x("div",Bt,[o("p",jt,S(t.giftCardCode),1),o("p",qt,[Wt,o("span",null,S(t.expiration),1)])])):(p(),x("div",Ot,Jt))])}}});const Ae=j(Qt,[["__scopeId","data-v-f3a395af"]]),Zt=_=>(te("data-v-20683099"),_=_(),ae(),_),Kt={class:"giftcard-box"},Xt={class:"prepay-title"},ea={key:0,class:"giftcard-body"},ta={class:"giftcard-validation"},aa=Zt(()=>o("p",null," با اولین استفاده، سفر کارت به حساب کاربری شما تعلق می‌گیرد. باقیمانده‌ی مبلغ در دفعات بعدی قابل استفاده خواهد بود. ",-1)),oa={class:"giftcard-input"},sa={key:0,class:"giftcards"},ia=H({__name:"GiftCard",setup(_){const C=B(),{giftcardMessage:g,giftcardStatus:s,giftcardCode:t,payFullyWithCredit:y,userGiftCards:n}=ne(C),v=F(t.value||""),f=F(!1),m=i({get:()=>v.value,set:U=>{v.value=U.toUpperCase()}});function T(){C.applyGiftcard(m.value)}function D(){f.value=!f.value,f.value||(C.removeGiftcard(),m.value="")}function w(U){return Ge().day.jalali(U).format("YYYY MMMM DD").split(" ").reverse().join(" ")}const r=i(()=>f.value?"بستن":"استفاده"),u=i(()=>y.value&&s.value!==K.Accepted),b=i(()=>n.value.map(({expiration:U,...a})=>({...a,expiration:w(U)}))),Q=i(()=>!/[A-Z0-9]+-[A-Z0-9]+/.test(m.value));return oe(()=>C.loadGiftcards()),(U,a)=>{const R=_e("mr-button"),W=_e("mr-input");return p(),x("section",Kt,[o("div",Xt,[$(" استفاده از سفر کارت "),l(R,{type:"transparent","right-icon":e(f)?e(Ne):e(He),size:"medium",onClick:D},{default:P(()=>[$(S(e(r)),1)]),_:1},8,["right-icon"])]),e(f)?(p(),x("div",ea,[o("div",ta,[aa,o("div",oa,[l(W,{modelValue:e(m),"onUpdate:modelValue":a[0]||(a[0]=k=>N(m)?m.value=k:null),placeholder:"سفر کارت",description:e(s)===e(K).Accepted?e(g):"کد سفر کارت خود را وارد کنید.",disabled:e(u),success:e(s)===e(K).Accepted,invalid:e(s)===e(K).Rejected,"error-text":e(g),dir:"ltr",required:""},null,8,["modelValue","description","disabled","success","invalid","error-text"]),l(R,{size:"big",class:"submit-btn",disabled:e(u)||e(Q),loading:e(s)===e(K).Checking,onClick:T},{default:P(()=>[$(" بررسی ")]),_:1},8,["disabled","loading"])])]),e(n).length?(p(),x("div",sa,[l(Ae,Me({giftCardCode:""},{modelValue:e(m),"onUpdate:modelValue":a[1]||(a[1]=k=>N(m)?m.value=k:null)}),null,16,["modelValue"]),(p(!0),x(de,null,je(e(b),(k,V)=>(p(),M(Ae,Me({key:k.giftCardCode||V},k,{modelValue:e(m),"onUpdate:modelValue":a[2]||(a[2]=I=>N(m)?m.value=I:null)}),null,16,["modelValue"]))),128))])):E("",!0)])):E("",!0)])}}});const la=j(ia,[["__scopeId","data-v-20683099"]]),na={class:"form-container"},ra={class:"actions"},da=H({__name:"AddEditEntityModal",props:{initialData:{},id:{}},emits:["close"],setup(_,{emit:C}){const g=ee(),s=B(),t=F({isLegalEntity:!1}),y=F(null),n=F([{label:"شخص حقیقی",value:!1},{label:"شخص حقوقی",value:!0}]),v=i(()=>g.provinces.map(r=>({id:r.id||0,label:r.title||""}))),f=i(()=>g.provinceCities.map(r=>({id:r.title||"",label:r.title||""}))),m=i(()=>g.provinceCitiesLoading),T=i({get(){return v.value.find(r=>r.label===t.value.province)},set(r){t.value.province=r==null?void 0:r.label,r!=null&&r.id&&g.getProvinceCities(r.id)}}),D=i({get(){return f.value.find(r=>r.label===t.value.city)},set(r){t.value.city=r==null?void 0:r.id}}),w=async()=>{let r;y.value?r=await s.updateUserEntity({id:y.value,userEntityRequest:t.value}):r=await s.addUserEntity(t.value),r&&(await s.loadUserEntities(),C("close"))};return oe(()=>{_.initialData?(t.value=JSON.parse(JSON.stringify(_.initialData)),y.value=_.id||null):(y.value=null,t.value={isLegalEntity:!1})}),(r,u)=>(p(),M(ze,{id:"entity",title:e(y)?"ویرایش شخص":"افزودن شخص","mobile-page":""},{footer:P(()=>[o("div",ra,[l(z,{type:"bordered","full-width":"",onClick:u[10]||(u[10]=b=>C("close"))},{default:P(()=>[$(" لغو ")]),_:1}),l(z,{"full-width":"",onClick:w},{default:P(()=>[$("ذخیره")]),_:1})])]),default:P(()=>[o("div",na,[l(_t,{ghost:""},{default:P(()=>[l(yt,{modelValue:e(t).isLegalEntity,"onUpdate:modelValue":u[0]||(u[0]=b=>e(t).isLegalEntity=b),name:"legalType",radios:e(n),row:""},null,8,["modelValue","radios"])]),_:1}),l(G,{modelValue:e(t).fullName,"onUpdate:modelValue":u[1]||(u[1]=b=>e(t).fullName=b),required:"",label:e(t).isLegalEntity?"نام سازمان":"نام و نام خانوادگی",placeholder:e(t).isLegalEntity?"نام سازمان":"نام و نام خانوادگی"},null,8,["modelValue","label","placeholder"]),e(t).isLegalEntity?(p(),M(G,{key:0,modelValue:e(t).financialCode,"onUpdate:modelValue":u[2]||(u[2]=b=>e(t).financialCode=b),label:"کد اقتصادی",placeholder:"کد اقتصادی",required:""},null,8,["modelValue"])):E("",!0),e(t).isLegalEntity?(p(),M(G,{key:1,modelValue:e(t).orgNationalId,"onUpdate:modelValue":u[3]||(u[3]=b=>e(t).orgNationalId=b),label:"شناسه ملی",placeholder:"شناسه ملی",required:""},null,8,["modelValue"])):E("",!0),e(t).isLegalEntity?(p(),M(G,{key:2,modelValue:e(t).registerCode,"onUpdate:modelValue":u[4]||(u[4]=b=>e(t).registerCode=b),label:"شناسه ثبت",placeholder:"شناسه ثبت",required:""},null,8,["modelValue"])):E("",!0),l(G,{modelValue:e(t).phone,"onUpdate:modelValue":u[5]||(u[5]=b=>e(t).phone=b),label:e(t).isLegalEntity?"شماره تلفن ثابت":"تلفن همراه",placeholder:e(t).isLegalEntity?"شماره تلفن ثابت":"تلفن همراه",required:""},null,8,["modelValue","label","placeholder"]),e(t).isLegalEntity?(p(),M(G,{key:3,modelValue:e(t).postalCode,"onUpdate:modelValue":u[6]||(u[6]=b=>e(t).postalCode=b),label:"کد پستی",placeholder:"کد پستی",required:""},null,8,["modelValue"])):(p(),M(G,{key:4,modelValue:e(t).nationalCode,"onUpdate:modelValue":u[7]||(u[7]=b=>e(t).nationalCode=b),label:"کد ملی",placeholder:"کد ملی",required:""},null,8,["modelValue"])),l(fe,{modelValue:e(T),"onUpdate:modelValue":u[8]||(u[8]=b=>N(T)?T.value=b:null),required:"",label:e(t).isLegalEntity?"استان (محل دفتر مرکزی)":"استان",placeholder:e(t).isLegalEntity?"استان (محل دفتر مرکزی)":"استان",options:e(v)},null,8,["modelValue","label","placeholder","options"]),l(fe,{modelValue:e(D),"onUpdate:modelValue":u[9]||(u[9]=b=>N(D)?D.value=b:null),required:"",label:e(t).isLegalEntity?"شهر (محل دفتر مرکزی)":"شهر",placeholder:e(t).isLegalEntity?"شهر (محل دفتر مرکزی)":"شهر",loading:e(m),"empty-list-message":"ابتدا استان را انتخاب کنید.",options:e(f)},null,8,["modelValue","label","placeholder","loading","options"])])]),_:1},8,["title"]))}});const ca=j(da,[["__scopeId","data-v-aeaa7237"]]),ua=_=>(te("data-v-a960332d"),_=_(),ae(),_),pa={class:"entity-form-root"},ma={class:"row"},va={class:"row"},_a={key:0,class:"description"},ya=ua(()=>o("span",null," این فاکتور طی ۷ روز کاری آینده برای شما صادر شده و پس از آن از بخش پیگیری خرید قابل دریافت خواهد بود. ",-1)),fa=H({__name:"EntityForm",setup(_,{expose:C}){const g=ee(),s=B(),t=F(!1),y=F(null),{isMobileSize:n}=ft(),v=i(()=>s.userEntities.map(w=>({label:w.fullName||"",id:w.id||0}))),{open:f}=gt({component:ca}),m=()=>{f()},T=()=>{const w=s.userEntities.find(r=>{var u;return r.id===((u=y.value)==null?void 0:u.id)});w&&f({initialData:w,id:w.id})},D=async()=>{t.value&&y.value&&await s.connectEntityToBill(y.value.id)};return oe(()=>{s.loadUserEntities(),g.getProvinces()}),C({proceed:D}),(w,r)=>(p(),x("div",pa,[l(X,{modelValue:e(t),"onUpdate:modelValue":r[0]||(r[0]=u=>N(t)?t.value=u:null),label:"فاکتور رسمی می‌خواهم"},null,8,["modelValue"]),e(t)?(p(),x(de,{key:0},[o("div",ma,[l(re,{margin:"0"})]),o("div",va,[l(fe,{modelValue:e(y),"onUpdate:modelValue":r[1]||(r[1]=u=>N(y)?y.value=u:null),label:"انتخاب شخص",required:"",options:e(v),"hide-description":""},null,8,["modelValue","options"]),l(z,{"right-icon":e(n)?void 0:e(ht),type:e(n)?"bordered":"transparent",size:"medium","m-size":"big","icon-button":e(n)?e(bt):void 0,onClick:m},{default:P(()=>[$(" ایجاد شخص جدید ")]),_:1},8,["right-icon","type","icon-button"])]),e(y)?(p(),x("div",_a,[o("span",null,[$(" فاکتور این رزرو به نام «"+S(e(y).label)+"» ثبت خواهد شد. ",1),o("span",{class:"edit",onClick:T}," ویرایش اطلاعات شخص ")]),ya])):E("",!0)],64)):E("",!0)]))}});const ga=j(fa,[["__scopeId","data-v-a960332d"]]),ha=H({__name:"TheTermsAndConditionsModal",setup(_){const C=Ct();return qe(async()=>{await C.getTermsAndCondition()}),(g,s)=>(p(),M(ze,{title:"شرایط و مقررات"},{default:P(()=>[l(Nt,{class:"terms-modal-content"})]),_:1}))}});const ba=j(ha,[["__scopeId","data-v-4f35ce1f"]]),Ca={class:"gateways-row"},ka={class:"gateway-item"},Sa=["src","alt"],$a={class:"title"},Pa={key:0,class:"description"},xa=H({__name:"GatewaySelector",setup(_){const C=B(),g=F(!1),s=F([{title:"شتاب",image:"/img/form/Shetab.svg",name:"shetab",value:"",description:""},{title:"تارا",image:"/img/form/tara.png",name:"tara",value:"tara",description:"(ویژه کاربران تارا)"}]),t=i({get(){return C.gateway},set(y){C.gateway=y}});return(y,n)=>(p(),x("div",{class:ye(["gateways-root",{expanded:e(g)}])},[l(z,{size:"medium",type:"transparent","left-icon":e(g)?e(kt):e(St),class:"toggle",onClick:n[0]||(n[0]=v=>g.value=!e(g))},{default:P(()=>[$(" تغییر درگاه پرداخت ")]),_:1},8,["left-icon"]),o("div",Ca,[(p(!0),x(de,null,je(e(s),v=>(p(),x("div",{key:v.name,class:"gateway-item-wrapper"},[o("div",ka,[l(X,{"is-radio":"",size:"large",name:v.name,"model-value":e(t)===v.value,"onUpdate:modelValue":f=>t.value=v.value},null,8,["name","model-value","onUpdate:modelValue"]),o("img",{src:v.image,alt:v.name},null,8,Sa),o("span",$a,"درگاه "+S(v.title),1),v.description?(p(),x("span",Pa,S(v.description),1)):E("",!0)])]))),128))])],2))}});const Ea=j(xa,[["__scopeId","data-v-4c7ce45c"]]),Ye=_=>(te("data-v-9c289bfd"),_=_(),ae(),_),Va={key:0,class:"coupon-box"},Da={class:"prepay-title"},wa={class:"action-form"},Ia={class:"option-container"},Ta={class:"score-details"},Fa={class:"details-row"},Ma=Ye(()=>o("span",{class:"title"},"امتیاز قابل استفاده",-1)),Ua={class:"value"},Ra={class:"details-row"},La=Ye(()=>o("span",{class:"title"},"تخفیف دریافتی",-1)),Aa=H({__name:"Coupon",setup(_){const C=ee(),g=Be(),s=B(),{handleException:t}=We(),y=ge(),n=F(!1),v=F(""),f=F("coupon"),m=F(!1),T=i(()=>s.couponStatus===me.Checking),D=i(()=>s.couponStatus===me.Accepted),w=i(()=>s.couponStatus===me.Rejected),r=i(()=>s.couponMessage||null),u=i(()=>!C.loggedIn||s.applicableScore!==null&&s.applicableScore>0),b=i(()=>s.applicableScore||0),Q=i(()=>s.totalScore||0),U=i(()=>s.applicableScoreAmount||0),a=i(()=>{const k="استفاده از امتیاز کاربری به عنوان تخفیف";return C.loggedIn?k:`${k} (برای استفاده وارد شوید.)`}),R=i(()=>s.showNonCashPayment),W=()=>{D.value?s.cancelCoupon():s.applyCoupon({code:v.value})};return Ue(n,async k=>{if(!k&&D.value&&s.cancelCoupon(),!k&&f.value==="score"){m.value=!0;try{await s.cancelUserScore()}catch(V){t(V)}finally{m.value=!1}}k&&(s.loadApplicableScore(),f.value="coupon")}),Ue(f,async(k,V)=>{if(k!==V)if(k==="score"){if(!C.loggedIn)try{if(!await C.promptLogin({message:y.t("LoginModal.loginForService",{service:"امتیاز کاربری"}),rejectionText:y.t("Coupon.cancel")})){f.value="coupon";return}}catch{f.value="coupon";return}m.value=!0;try{s.removeDiscount(Pt.Score),await s.applyUserScore()}catch(I){t(I)}finally{m.value=!1}}else{m.value=!0;try{await s.cancelUserScore()}catch(I){f.value="score",t(I)}finally{m.value=!1}}}),oe(()=>{var V,I;s.loadApplicableScore();const k=g.itineraryPackages[0].isTripPackage()?(I=(V=g.itineraryPackages[0].defaultPrice)==null?void 0:V.couponCode)==null?void 0:I.code:null;k&&(s.applyCoupon({code:k}),n.value=!0,v.value=k)}),(k,V)=>e(R)?(p(),x("div",Va,[o("span",Da,[$(" کد تخفیف و امتیاز کاربری "),l(z,{type:"transparent","right-icon":e(n)?e(Ne):e(He),size:"medium",onClick:V[0]||(V[0]=I=>n.value=!e(n))},{default:P(()=>[$(" استفاده ")]),_:1},8,["right-icon"])]),l(Re,null,{default:P(()=>[Mt(o("div",{class:ye(["discount-container",{selected:e(f)==="coupon"}])},[l(X,{"model-value":e(f)==="coupon",label:e(y).t("Coupon.discountOrLottery"),"is-radio":"","mobile-wrap-label":"","onUpdate:modelValue":V[1]||(V[1]=I=>f.value="coupon")},null,8,["model-value","label"]),o("div",wa,[l(G,{modelValue:e(v),"onUpdate:modelValue":V[2]||(V[2]=I=>N(v)?v.value=I:null),"data-id":"coupon",class:"coupon-input","error-text":e(w)&&e(r)?e(r):"",description:e(D)?e(r)||"":"کد تخفیف یا شماره موبایل معرف خود را وارد کنید.",invalid:e(w),placeholder:e(y).t("Coupon.discount"),disabled:e(f)!=="coupon"||e(D),success:e(D),dir:"ltr"},null,8,["modelValue","error-text","description","invalid","placeholder","disabled","success"]),l(z,{"data-id":"check-coupon",class:"coupon-button",type:"filled",size:"big",loading:e(T),disabled:!e(v)||e(T)||e(f)!=="coupon",onClick:W},{default:P(()=>[$(S(e(D)?e(y).t("Coupon.change"):e(y).t("Coupon.check")),1)]),_:1},8,["loading","disabled"])])],2),[[Ut,e(n)]])]),_:1}),e(n)?(p(),M(re,{key:0,class:"divider",margin:"8px",size:"1px"})):E("",!0),l(Re,null,{default:P(()=>[e(n)&&e(a)?(p(),x("div",{key:0,class:ye(["user-score-container",{selected:e(f)==="score"}])},[o("div",Ia,[l(X,{"model-value":e(f)==="score",disabled:!e(u),label:e(a),"is-radio":"","mobile-wrap-label":"","onUpdate:modelValue":V[3]||(V[3]=I=>f.value="score")},null,8,["model-value","disabled","label"]),e(m)?(p(),M($t,{key:0,color:"var(--blue-400)",size:8})):E("",!0)]),o("div",Ta,[o("div",Fa,[Ma,o("span",Ua,[$(S(e(b))+" از "+S(e(Q))+" ",1),l(e(Ht),{class:"svg-coin"})])]),o("div",Ra,[La,l(At,{price:e(U),type:"small"},null,8,["price"])])])],2)):E("",!0)]),_:1})])):E("",!0)}});const Na=j(Aa,[["__scopeId","data-v-9c289bfd"]]),Ha=H({__name:"CreditForm",setup(_){const C=ee(),g=B(),s=i(()=>g.totalPriceUnformatted),t=i(()=>C.credit||0),y=i(()=>xt(t.value>s.value?s.value:t.value)),n=i({get(){return g.useCredit},set(m){g.useCredit=m}}),v=i(()=>g.showNonCashPayment),f=ge();return(m,T)=>e(t)>0&&e(v)?(p(),M(X,{key:0,modelValue:e(n),"onUpdate:modelValue":T[0]||(T[0]=D=>N(n)?n.value=D:null),disabled:e(g).totalPriceUnformatted===0,label:e(f).t("CreditForm.deductionCredit",{amount:e(y)}),class:"use-credit-checkbox"},null,8,["modelValue","disabled","label"])):E("",!0)}}),se=_=>(te("data-v-9f4a48dc"),_=_(),ae(),_),Ga={class:"prepay-page-root"},za={class:"box"},Ba={class:"header"},ja=se(()=>o("span",{class:"header-title"},"بررسی اطلاعات",-1)),qa={class:"prepay-title"},Wa={class:"box"},Oa={class:"prepay-title"},Ya={key:1,class:"box"},Ja={class:"header"},Qa=se(()=>o("span",{class:"header-title"},"بررسی اطلاعات",-1)),Za={class:"prepay-title"},Ka={key:2,class:"box"},Xa=se(()=>o("span",{class:"prepay-title"}," اطلاعات بلیط ",-1)),eo={key:3,class:"box"},to={class:"prepay-title"},ao={class:"prepay-title"},oo={key:6,class:"box"},so=se(()=>o("span",{class:"prepay-title"}," سایر تنظیمات پرداخت ",-1)),io={key:7,class:"box"},lo=se(()=>o("span",{class:"prepay-title"},[$(" صدور فاکتور "),o("span",{class:"prepay-subtitle"},"(اختیاری)")],-1)),no={class:"box"},ro={class:"prepay-title"},co={class:"rules-box"},uo=H({__name:"prepay",setup(_,{expose:C}){const g=Et(),s=ee(),t=Be(),y=Vt(),n=B(),{isAutoReserve:v}=ne(y),{showCreditPayment:f}=ne(s),{pax:m,email:T,mobile:D,landline:w,informationRegisterStatus:r,customData:u,payFullyWithCredit:b,payFullyWithGiftCard:Q}=ne(n),U=Dt(),a=ge(),{day:R}=Ge(),W=F(null),{open:k}=wt({component:ba}),V=Ft(),{handleException:I}=We(),ce=Rt(),O=It(),Je=F(!1),he=i(()=>Tt().isExtraFeaturesEnabled),be=i(()=>!n.isLoadFromSession),Qe=i(()=>!!(O!=null&&O.isFeatureEnabled("need-factor"))),Ze=i(()=>he&&!!(O!=null&&O.isFeatureEnabled("is-gift-card-enabled"))&&!v.value),Ke=i(()=>pe.value?a.t("PrePay.carOwnerInfo"):a.t("PrePay.passengerInfo")),Xe=i(()=>{var c;return Y([{key:"type",title:a.t("PassengerForm.row")},{key:"gender",title:a.t("PassengerForm.title")},{key:"fullName",title:a.t("PassengerForm.fullName")},{key:"nationality",title:a.t("PassengerForm.nationality"),condition:m.value.some(h=>h.nationality)},{key:"birthDate",title:a.t("PassengerForm.birthDate"),condition:m.value.some(h=>h.birthDate)},{key:"nationalCode",title:a.t("PassengerForm.nationalNumber"),condition:m.value.some(h=>h.nationalCode)},{key:"passportNumber",title:a.t("PassengerForm.passportNumber"),condition:m.value.some(h=>h.passportNumber)},{key:"passportExpiry",title:a.t("PassengerForm.passportExpiry"),condition:m.value.some(h=>h.passportExpiry)},{key:"seatNumber",title:"شماره صندلی",condition:!!((c=u.value)==null?void 0:c.seatHandler).selectedSeats.length},{key:"carModel",title:a.t("PassengerForm.carModel"),condition:pe.value},{key:"carPlate",title:a.t("PassengerForm.carPlate"),condition:pe.value},{key:"edit",title:"ویرایش",condition:be.value}])}),et=i(()=>{var h;const c=(h=u.value)==null?void 0:h.seatHandler;return m.value.map((d,L)=>{var A,q,xe,Ee,Ve,De,we,Ie;return{...d,type:tt(d.type),gender:d.gender?a.t("PassengerForm.mrs"):a.t("PassengerForm.mr"),fullName:`${d.firstName||d.persianFirstName} ${d.lastName||d.persianLastName}`,nationality:d.nationality==="iranian"?a.t("PassengerForm.iranian"):a.t("PassengerForm.foregin"),birthDate:R.js(d.birthDate).format(le()),passportExpiry:R.js(d.passportExpiry).format(le()),carPlate:`${(A=d.carPlate)==null?void 0:A[2]}-${(q=d.carPlate)==null?void 0:q[4]}-${(xe=d.carPlate)==null?void 0:xe[1]}-${(Ee=d.carPlate)==null?void 0:Ee[0]}`,seatNumber:[(De=(Ve=c.selectedSeats)==null?void 0:Ve[L])==null?void 0:De.departureNumber,(Ie=(we=c.selectedSeats)==null?void 0:we[L])==null?void 0:Ie.returnNumber].filter(Boolean).join("-")}})});function tt(c){switch(c){case ve.Child:return a.t("PassengerForm.child");case ve.Infant:return a.t("PassengerForm.infant");case ve.Adult:return a.t("PassengerForm.adult");default:return""}}const at=Y([{key:"corporationInfo",title:"شرکت"},{key:"compartments",title:"شماره سالن"},{key:"wagonTitle",title:"نوع واگن"},{key:"isExclusive",title:"کوپه دربست"}]),ot=i(()=>{var d,L,A;const c=ie.value,h=(L=(d=n.registerInfoResult)==null?void 0:d.map(q=>`سالن ${q.WagonNumbers} - کوپه ${q.CompartmentNumbers}`))==null?void 0:L.join("، ");return[{corporationInfo:c[0][0].corporationInfo.title,compartments:h,wagonTitle:((A=c[0][1])==null?void 0:A.title)||"",isExclusive:c[0][1].isExclusive}]}),st=Y([{key:"origin",title:a.t("ReserveDetails.origin")},{key:"destination",title:a.t("ReserveDetails.destination")},{key:"departureDateTime",title:a.t("ReserveDetails.departureTime")},{key:"stops",title:a.t("ReserveDetails.numberOfStops")},{key:"arrivalDateTime",title:a.t("ReserveDetails.arrivalTime")},{key:"corporationInfo",title:a.t("ReserveDetails.corporation")}]),it=i(()=>ie.value.map(([c])=>c)),lt=i(()=>Y([{key:"mobile",title:a.t("ContactForm.mobilePhone")},{key:"landline",title:a.t("ContactForm.linePhone")},{key:"email",title:a.t("ContactForm.email")},{key:"edit",title:"ویرایش",condition:be.value}])),nt=i(()=>({mobile:D.value,landline:w.value,email:T.value})),rt=i(()=>!!ie.value.length),ie=i(()=>v.value?y.trips:t.trips),ue=i(()=>!!t.itineraryPackages.length),Z=i(()=>t.itineraryPackages.find(c=>c.isHotelPackage())),dt=i(()=>t.itineraryPackages.some(c=>c.isTrainPackage())),pe=i(()=>{if(Z.value)return!1;const{sellType:c}=t.itineraryPackages[0].selectedPrices[0];return!!c&&c.code===Gt.Car}),ct=Y([{key:"title",title:a.t("HotelReserveDetails.name")},{key:"cityTitle",title:a.t("HotelReserveDetails.destination")},{key:"fromDate",title:a.t("HotelReserveDetails.entrance")},{key:"toDate",title:a.t("HotelReserveDetails.exit")},{key:"nights",title:a.t("HotelReserveDetails.duration")}]),ut=Y([{key:"capacity",title:a.t("HotelReserveDetails.capacity")},{key:"roomTitle",title:a.t("HotelReserveDetails.room")},{key:"services",title:a.t("HotelReserveDetails.services")}]),pt=i(()=>Z.value?Z.value.selectedPricesWithPriceClass.map(c=>{let h=`${c[1].capacity}`||"";const d=c[0].selectedExtraPerson.length;return d&&(h+=` + ${d}`),{capacity:h,roomTitle:`${c[1].title||""}`,services:`${c[0].roomServiceTitle.reduce((L,A,q)=>`${L}${A}${q+1<c[0].roomServiceTitle.length?` ${a.t("RoomCard.and")} `:""}`,"")}`}}):[]),Ce=i(()=>m.value.length>1?m.value.length*6e4:8e4),ke=i(()=>he&&!v.value),Se=()=>{const c=document.documentElement.scrollTop+80;Je.value=window.scrollY+window.innerHeight<c},$e=async()=>{var c,h;try{n.paymentLoading=!0,await n.checkBillBeforePayment(),g.currentItineraryModule().saveSmEventUrl(),await g.currentItineraryModule().sendSmStatusEvent(3),await((c=W.value)==null?void 0:c.proceed()),await n.proceedToGateway(),V==null||V.trackEvent({event:"icp-payment button click"}),U.trackAll("payment",U.searchResultsAttributesForReserve),v.value&&U.trackPosthog("auto-reserve-payment-button-click",{servicePrice:(h=y.prices)==null?void 0:h.servicePrice})}catch(d){n.paymentLoading=!1,I(d)}},Pe=async()=>{!b.value&&!Q.value&&await $e()},mt=c=>{var h;(h=n.customData)!=null&&h.seatHandler.selectedSeats.length?n.editingItem=`seat-${c}`:n.editingItem=`user-${c}`,ce.back()},vt=()=>{n.editingItem="contact",ce.back()};return qe(()=>{n.loadSession(),t.loadSession(),n.loadReceivedTripScore()}),oe(()=>{n.editingItem="",s.cacheLoggedInAtBillCreation(),s.loadCredit(!0),[Te.Registered,Te.RegisteredFromSession].includes(r.value)||ce.replace("/reserve/form"),n.initializeGateway(),window.addEventListener("scroll",Se)}),Lt(()=>{window.removeEventListener("scroll",Se)}),C({proceed:$e}),(c,h)=>(p(),x("div",Ga,[e(Z)?(p(),x(de,{key:0},[o("div",za,[o("div",Ba,[ja,l(Le,{"timer-millis":e(Ce),onTimeUp:Pe},null,8,["timer-millis"])]),l(re,{thickness:"1px",margin:"0"}),o("span",qa,S(e(a).t("HotelReserveDetails.hotelReserveDetails")),1),l(J,{headers:e(ct),items:[e(Z)]},{"item.fromDate":P(({value:d})=>[$(S(e(R).js(d).format("dddd DD MMMM")),1)]),"item.toDate":P(({value:d})=>[$(S(e(R).js(d).format("dddd DD MMMM")),1)]),"item.nights":P(({value:d})=>[$(S(e(a).t("HotelReserveDetails.nightDuration",{nights:d})),1)]),_:1},8,["headers","items"])]),o("div",Wa,[o("span",Oa,S(e(a).t("HotelReserveDetails.roomDetails")),1),l(J,{headers:e(ut),items:e(pt)},null,8,["headers","items"])])],64)):E("",!0),e(rt)?(p(),x("div",Ya,[o("div",Ja,[Qa,l(Le,{"timer-millis":e(Ce),onTimeUp:Pe},null,8,["timer-millis"])]),l(re,{thickness:"1px",margin:"0"}),o("span",Za,S(e(a).t("ReserveDetails.tripDetails")),1),l(J,{headers:e(st),items:e(it)},{"item.departureDateTime":P(({value:d})=>[$(S(e(R).js(d).format(("formatter"in c?c.formatter:e(le))({format:"long",includeWeekday:!0,includeTime:!0}))),1)]),"item.arrivalDateTime":P(({value:d})=>[$(S(e(R).js(d).format(("formatter"in c?c.formatter:e(le))({format:"long",includeWeekday:!0,includeTime:!0}))),1)]),"item.corporationInfo":P(({value:d,index:L})=>{var A;return[$(S(d.title)+"/"+S((A=e(ie)[L][1])==null?void 0:A.title),1)]}),_:1},8,["headers","items"])])):E("",!0),e(dt)?(p(),x("div",Ka,[Xa,l(J,{headers:e(at),items:e(ot)},{"item.isExclusive":P(({value:d})=>[$(S(d?"انتخاب شد":"انتخاب نشد"),1)]),_:1},8,["headers","items"])])):E("",!0),e(ue)?(p(),x("div",eo,[o("span",to,S(e(Ke)),1),l(J,{headers:e(Xe),items:e(et)},{"item.edit":P(({index:d})=>[l(z,{"icon-button":e(Fe),size:"small",type:"bordered",onClick:L=>mt(d)},null,8,["icon-button","onClick"])]),_:1},8,["headers","items"]),o("span",ao,S(e(a).t("PrePay.contactInfo")),1),l(J,{headers:e(lt),items:[e(nt)]},{"item.edit":P(()=>[l(z,{"icon-button":e(Fe),size:"small",type:"bordered",onClick:vt},null,8,["icon-button"])]),_:1},8,["headers","items"])])):E("",!0),e(ue)&&e(ke)?(p(),M(Na,{key:4,class:"coupon"})):E("",!0),e(Ze)?(p(),M(la,{key:5})):E("",!0),e(ue)&&e(ke)?(p(),x("div",oo,[so,e(f)?(p(),M(Ha,{key:0,class:"credit"})):E("",!0),l(Ea)])):E("",!0),e(Qe)?(p(),x("div",io,[lo,l(ga,{ref_key:"entityForm",ref:W},null,512)])):E("",!0),o("div",no,[o("div",ro,S(e(a).t("Rules.title")),1),o("div",co,[o("ul",null,[o("li",null,[o("span",{onClick:h[0]||(h[0]=d=>e(k)())}," شرایط و مقررات "),$(" مِستربلیط را می پذیرم. ")]),o("li",null,[$(" من با پردازش و استفاده از داده های شخصی با توجه به سیاست "),o("span",{onClick:h[1]||(h[1]=d=>e(k)())}," حفظ حریم خصوصی "),$(" مِستربلیط موافقم. ")])])])])]))}});const Co=j(uo,[["__scopeId","data-v-9f4a48dc"]]);export{Co as default};
