/* eslint-disable */
/**
 * video-player v3.2.5
 * Built 03/02/2023 at 10:28:22 PM (EST)
 * Includes:
 *   - hls.js v1.0.7
 *   - cvui v
 */
(function(){var define, require;
!function(){var t,e,u,F,j,G,x,V,H,K,W,s,r,a,o,n,l,Y,d,h,z,c,g,X,J,p,v,f,E,Q,Z,$,tt,et,m,it,A,S,T,st,nt,y,D,rt,I,at,ot,lt,dt,ut,ht,ct,gt,C,b,pt,R,P,vt,ft,M,L,Et,_t,mt,O,At,St,Tt,yt,k,N,U;!function(){var B,A="Expected a function",S="__lodash_hash_undefined__",U="__lodash_placeholder__",T=1,y=2,D=4,W=1,Y=2,z=1,q=2,X=4,J=8,Q=32,Z=64,I=1/0,C=9007199254740991,b=17976931348623157e292,$=NaN,tt=4294967295,et=[["ary",128],["bind",z],["bindKey",q],["curry",J],["curryRight",16],["flip",512],["partial",Q],["partialRight",Z],["rearg",256]],it="[object Arguments]",st="[object Array]",nt="[object AsyncFunction]",rt="[object Boolean]",at="[object Date]",ot="[object Error]",lt="[object Function]",dt="[object GeneratorFunction]",w="[object Map]",ut="[object Number]",ht="[object Null]",F="[object Object]",ct="[object Promise]",gt="[object Proxy]",pt="[object RegExp]",j="[object Set]",vt="[object String]",ft="[object Symbol]",Et="[object Undefined]",_t="[object WeakMap]",mt="[object ArrayBuffer]",At="[object DataView]",St="[object Float32Array]",Tt="[object Float64Array]",yt="[object Int8Array]",Dt="[object Int16Array]",It="[object Int32Array]",Ct="[object Uint8Array]",bt="[object Uint8ClampedArray]",Rt="[object Uint16Array]",Pt="[object Uint32Array]",Mt=/\b__p \+= '';/g,Lt=/\b(__p \+=) '' \+/g,Ot=/(__e\(.*?\)|\b__t\)) \+\n'';/g,kt=/[&<>"']/g,Nt=RegExp(kt.source),Ut=/<%=([\s\S]+?)%>/g,Bt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wt=/^\w*$/,Ft=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,jt=/^\s+|\s+$/g,Gt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,xt=/\{\n\/\* \[wrapped with (.+)\] \*/,Vt=/,? & /,Ht=/\\(\\)?/g,Kt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Wt=/\w*$/,Yt=/^[-+]0x[0-9a-f]+$/i,zt=/^0b[01]+$/i,qt=/^\[object .+?Constructor\]$/,Xt=/^0o[0-7]+$/i,Jt=/^(?:0|[1-9]\d*)$/,Qt=/($^)/,Zt=/['\n\r\u2028\u2029\\]/g,$t="\\ud800-\\udfff",te="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",t="\\ufe0e\\ufe0f",e="["+$t+"]",i="["+te+"]",s="\\ud83c[\\udffb-\\udfff]",n="[^"+$t+"]",ee="(?:\\ud83c[\\udde6-\\uddff]){2}",ie="[\\ud800-\\udbff][\\udc00-\\udfff]",se="\\u200d",ne="(?:"+i+"|"+s+")"+"?",re="["+t+"]?",re=re+ne+("(?:"+se+"(?:"+[n,ee,ie].join("|")+")"+re+ne+")*"),ne="(?:"+[n+i+"?",i,ee,ie,e].join("|")+")",ae=RegExp(s+"(?="+s+")|"+ne+re,"g"),oe=RegExp("["+se+$t+te+t+"]"),le=-1,r={},E=(r[St]=r[Tt]=r[yt]=r[Dt]=r[It]=r[Ct]=r[bt]=r[Rt]=r[Pt]=!0,r[it]=r[st]=r[mt]=r[rt]=r[At]=r[at]=r[ot]=r[lt]=r[w]=r[ut]=r[F]=r[pt]=r[j]=r[vt]=r[_t]=!1,{}),de=(E[it]=E[st]=E[mt]=E[At]=E[rt]=E[at]=E[St]=E[Tt]=E[yt]=E[Dt]=E[It]=E[w]=E[ut]=E[F]=E[pt]=E[j]=E[vt]=E[ft]=E[Ct]=E[bt]=E[Rt]=E[Pt]=!0,E[ot]=E[lt]=E[_t]=!1,{"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"}),ue=parseInt,n="object"==typeof global&&global&&global.Object===Object&&global,i="object"==typeof self&&self&&self.Object===Object&&self,R=n||i||Function("return this")(),ee="object"==typeof exports&&exports&&!exports.nodeType&&exports,ie=ee&&"object"==typeof module&&module&&!module.nodeType&&module,e=ie&&ie.exports===ee,he=e&&n.process,s=),ne=s&&s.isDate,re=s&&s.isMap,se=s&&s.isSet,$t=s&&s.isTypedArray;("length");={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};unction Le(t){return oe.test(t)}e=Array.prototype,te=Function.prototype,Fe=Object.prototype,t=R["__core-js_shared__"],je=te.toString,G=Fe.hasOwnProperty,Ge=(i=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",xe=Fe.toString,Ve=je.call(Object),He=R._,Ke=RegExp("^"+je.call(G).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),n=e?R.Buffer:B,s=R.Symbol,We=R.Uint8Array,Ye=n?n.allocUnsafe:B,ze=ke(Object.getPrototypeOf,Object),qe=Object.create,Xe=Fe.propertyIsEnumerable,Je=we.splice,Qe=s?s.isConcatSpreadable:B,Ze=s?s.iterator:B,$e=s?s.toStringTag:B,ti=),ei=Math.ceil,ii=Math.floor,si=Object.getOwnPropertySymbols,te=n?n.isBuffer:B,ni=ke(Object.keys,Object),M=Math.max,L=Math.min,ri=Date.now,ai=we.reverse,t=ms(R,"DataView"),oi=ms(R,"Map"),i=ms(R,"Promise"),e=ms(R,"Set"),n=ms(R,"WeakMap"),li=ms(Object,"create"),di=n&&new n,ui={},hi=ws(t),ci=ws(oi),gi=ws(i),pi=ws(e),vi=ws(n),s=s?s.prototype:B,fi=s?s.valueOf:B,Ei=s?s.toString:B;ar _i=function mi(){}function Ai(){}nction Si(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function a(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}} Ri(i,s,n,t,e,r){var a,o=s&T,l=s&y,d=s&D;if((a=n?e?n(i,t,e,r):n(i):a)===B){if(!m(i))return i;var u,t=H(i);if(t){if(a=i),!o)return N(i,a)}else{var h,c,g=V(i),p=g==lt||g==dt;if(sn(i))return h=i,(c=o)?h.slice():(c=h.length,c=Ye?Ye(c):new h.constructor(c),h.copy(c),c);if(g==F||g==it||p&&!e){if(a=l||p||"function"!=typeof(h=i).constructor||bs(h)?{}:_i(ze(h)),!o)return l?(p=c=i,p=(u=a)&&ds(p,mn(p),u),ds(c,Ss(c),p)):(p=u=i,p=(f=a)&&ds(p,_(p),f),ds(u,As(u),p))}else{if(!E[g])return e?i:{};a=function(t,e,i){var s=t.constructor;switch(e){case mt:return ls(t);case rt:case at:return new s(+t);case At:return function(t,e){e=e?ls(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)}(t,i);case St:case Tt:case yt:case Dt:case It:case Ct:case bt:case Rt:case Pt:return t,i);case w:return new s;case ut:case vt:return new s(t);case pt:return t);case j:return new s;case ft:return t)}}(i,g,o)}}var v,f=(r=r||new x).get(i);if(f)return f;r.set(i,a),un(i)?i.forEach(:on(i)?i.forEach(:P((v=t?B:(d?l?fs:vs:l?mn:_)(i))||i,}return a}O.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Ut,variable:"",imports:{_:O}},(O.prototype=Ai.prototype).constructor=O,(p.prototype=_i(Ai.prototype)).constructor=p,(k.prototype=_i(Ai.prototype)).constructor=k,Si.prototype.clear=Si.prototype.delete=Si.prototype.get=Si.prototype.has=Si.prototype.set=a.prototype.clear=a.prototype.delete=a.prototype.get=a.prototype.has=a.prototype.set=o.prototype.clear=o.prototype.delete=o.prototype.get=function(t){return _s(this,t).get(t)},o.prototype.has=o.prototype.set=Ti.prototype.add=Ti.prototype.push=Ti.prototype.has=function(t){return this.__data__.has(t)},x.prototype.clear=x.prototype.delete=x.prototype.get=function(t){return this.__data__.get(t)},x.prototype.has=function(t){return this.__data__.has(t)},x.prototype.set=Pi=Bi;var Pi,Mi,Li=r Ni,Ui=tion l(t){if(null==t)return t===B?Et:ht;if($e&&$e in Object(t)){var e=t,i=G.call(e,$e),s=e[$e];try{e[$e]=B;var n=!0}catch(t){}var r=xe.call(e);return n&&(i?e[$e]=s:delete e[$e]),r}return xe.call(t)}nction Vi(t,e,i){e=as(e,t),n=t;var s,n=null==(t=(s=e).length<2?n:Fi(n,is(s,0,-1)))?t:t[Bs(xs(e))];return null==n?B:ce(n,t,i)}unction Ki(t,e,i,s,n){if(t===e)return!0;if(null==t||null==e||!K(t)&&!K(e))return t!=t&&e!=e;var r=Ki,a=H(t),o=H(e),l=a?st:V(t),o=o?st:V(e),d=(l=l==it?F:l)==F,u=(o=o==it?F:o)==F;if((o=l==o)&&sn(t)){if(!sn(e))return!1;d=!(a=!0)}if(o&&!d){n=n||new x;if(a||cn(t))return ps(t,e,i,s,r,n);else{var h=t;var c=e;var g=l;var p=i;var v=s;var f=r;var E=n;switch(g){case At:if(h.byteLength!=c.byteLength||h.byteOffset!=c.byteOffset)return!1;h=h.buffer,c=c.buffer;case mt:return h.byteLength==c.byteLength&&f(new We(h),new We(c))?!0:!1;case rt:case at:case ut:return $s(+h,+c);case ot:return h.name==c.name&&h.message==c.message;case pt:case vt:return h==c+"";case w:var _=Oe;case j:var m=p&W;if(_=_||Ne,h.size!=c.size&&!m)return!1;m=E.get(h);if(m)return m==c;p|=Y,E.set(h,c);m=ps(_(h),_(c),p,v,f,E);return E.delete(h),m;case ft:if(fi)return fi.call(h)==fi.call(c)}return!1;return}}if(!(i&W)){var a=d&&G.call(t,"__wrapped__"),l=u&&G.call(e,"__wrapped__");if(a||l)return d=a?t.value():t,u=l?e.value():e,n=n||new x,r(d,u,i,s,n)}if(o){n=n||new x;var A=t,S=e,T=i,y=s,D=r,I=n,C=T&W,b=vs(A),R=b.length,a=vs(S).length;if(R!=a&&!C)return!1;for(var P=R;P--;){var M=b[P];if(!(C?M in S:G.call(S,M)))return!1}if((a=I.get(A))&&I.get(S))return a==S;for(var L=!0,O=(I.set(A,S),I.set(S,A),C);++P<R;){M=b[P];var k,N=A[M],U=S[M];if(!((k=y?C?y(U,N,M,S,A,I):y(N,U,M,A,S,I):k)===B?N===U||D(N,U,T,y,I):k)){L=!1;break}O=O||"constructor"==M}return L&&!O&&(a=A.constructor,l=S.constructor,a!=l)&&"constructor"in A&&"constructor"in S&&!("function"==typeof a&&a instanceof a&&"function"==typeof l&&l instanceof l)&&(L=!1),I.delete(A),I.delete(S),L}return!1}unction Yi(t){if("function"==typeof t)return t;if(null==t)return f;if("object"==typeof t)if(H(t)){var i=t[0],s=t[1];return Cs(i)&&Rs(s)?Ps(Bs(i),s):else{var e=t,n=e);return 1==n.length&&n[0][2]?Ps(n[0][0],n[0][1]):function(t){return t===e||function(t,e,i,s){var n=i.length,r=n,a=!s;if(null==t)return!r;for(t=Object(t);n--;){var o=i[n];if(a&&o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++n<r;){var l=(o=i[n])[0],d=t[l],u=o[1];if(a&&o[2]){if(d===B&&!(l in t))return!1}else{var h,c=new x;if(!((h=s?s(d,u,l,t,e,c):h)===B?Ki(u,d,W|Y,s,c):h))return!1}}return!0}(t,e,n)}}return Pn(t)}tion Qi(t,s,u){var n=-1;s=v(s.length?s:[f],Ie(d()));var e=Ji(t,,t=function(t,e){for(var i=u,s=-1,n=t.criteria,r=e.criteria,a=n.length,o=i.length;++s<a;){var l,d=n[s],r[s]);if(d)return o<=s?d:(l=i[s],d*("desc"==l?-1:1))}return t.index-e.index},i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}function Zi(t,e,i){for(var s=-1,n=e.length,r={};++s<n;){var a=e[s],o=Fi(t,a);if(i(o,a)){f=_=E=v=p=g=c=h=u=d=l=void 0;var l=r,d=as(a,t),u=o,h=void 0;if(m(l)){d=as(d,l);for(var c=-1,g=d.length,p=g-1,v=l;null!=v&&++c<g;){var f,E=Bs(d[c]),_=u;c!=p&&(f=v[E],(_=h?h(f,E,v):B)===B)&&(_=m(f)?f:Ds(d[c+1])?[]:{}),Di(v,E,_),v=v[E]}}}}return r}r s=di?f,es=ti?f;nction ns(t){var e;return"string"==typeof t?t:H(t)?v(t,ns)+"":h(t)?Ei?Ei.call(t):"":"0"==(e=t+"")&&1/t==-I?"-0":e}function rs(t,e){var i=t,s=(t instanceof k&&(i=t.value()),e),n=r=i,t=void 0,a=-1,o=null==s?0:s.length;for(t&&o&&(r=s[++a]);++a<o;)r=n(r,s[a],a,s);return r}n cs(c,g,p,v,f,E,_,m,A,S){var T=128&g,y=g&z,D=g&q,I=g&(16|J),C=512&g,b=D?B:hs(c);return function t(){for(var e,i,s,n,r,a,o,l,d=arguments.length,u=Array(d),h=d;h--;)u[h]=arguments[h];return I&&(e=t,n=u,e=(G.call(O,"placeholder")?O:e).placeholder)),v&&(u=u,v,f,I)),E&&(u=u,E,_,I)),d-=n,I&&d<S?(n=u,e),o=t.placeholder,s=u,(i=((i=g)|((r=i&J)?Q:Z))&~(r?Z:Q))&X||(i&=~(z|q)),a=[l=c,i,a=p,r?s:B,r?n:B,r?B:s,r?B:n,m,A,S-d],s=cs.apply(B,a),l)&&Ls(s,a),s.placeholder=o,r=l,a=i,Os(s,function(t,e){var i,s=e.length;return s?(e[i=s-1]=(1<s?"& ":"")+e[i],e=e.join(2<s?", ":" "),t.replace(Gt,"{\n/* [wrapped with "+e+"] */\n")):t}(r+="",r),a)))):(o=y?p:this,l=D?o[c]:c,d=u.length,m?u=u,m):C&&1<d&&u.reverse(),T&&A<d&&(u.length=A),(l=this&&this!==R&&this instanceof t?b||hs(l):l).apply(o,u))}}unction ps(t,e,i,s,n,r){var a=i&W,o=t.length,l=e.length;if(o!=l&&!(a&&o<l))return!1;l=r.get(t);if(l&&r.get(e))return l==e;var d=-1,u=!0,h=i&Y?new Ti:B;for(r.set(t,e),r.set(e,t);++d<o;){var c,g=t[d],p=e[d];if((c=s?a?s(p,g,d,e,t,r):s(g,p,d,t,e,r):c)!==B){if(c)continue;u=!1;break}if(h){if(!_e(e,){u=!1;break}}else if(g!==p&&!n(g,p,i,s,r)){u=!1;break}}return r.delete(t),r.delete(e),u}function vs(t){return ji(t,_,As)}ar Es=di?function(t){return di.get(t)}:Rn; As=si?Mn,Ss=si?Mn,V=l; t(new ArrayBuffer(1)))!=At||oi&&V(new oi)!=w||i&&V(i.resolve())!=ct||e&&V(new e)!=j||n&&V(new n)!=_t)&&(V=;var Ls=ks(s),Os=ks(es);s=(t=Qs(t=).cache;var Ns,Us=t;s);function Vs(t,e){if(t&&t.length&&e&&e.length){var i=t,s=e,n=void 0,r=void 0,a=r?Te:Se,o=-1,l=s.length,d=i;for(i===s&&(s=N(s)),n&&(d=v(i,Ie(n)));++o<l;)for(var u=0,h=s[o],c=n?n(h):h;-1<(u=a(d,c,u,r));)d!==i&&Je.call(d,u,1),Je.call(i,u,1);return i}return t}=ts(function(t,e){if(en(t)){var i=t,s=e,n=void 0,r=void 0,a=-1,o=ve,l=!0,d=i.length,u=[],h=s.length;if(d){n&&(s=v(s,Ie(n))),r?(o=fe,l=!1):200<=s.length&&(o=be,l=!1,s=new Ti(s));t:for(;++a<d;){var c=i[a],g=null==n?c:n(c),c=r||0!==c?c:0;if(l&&g==g){for(var p=h;p--;)if(s[p]===g)continue t;u.push(c)}else o(s,g,r)||u.push(c)}}return u}return[]});(Ms(n=function(o){function t(t){for(var e=t,i=o,s=-1,n=i.length,r=Array(n),a=null==e;++s<n;)r[s]=a?B:En(e,i[s]);return r}var e=o.length,i=e?o[0]:0,s=this.__wrapped__;return!(1<e||this.__actions__.length)&&s instanceof k&&Ds(i)?((s=s.slice(i,+i+(e?1:0))).__actions__.push({func:Ws,args:[t],thisArg:B}),new p(s,this.__chain__).thru():this.thru(t)},B,Gs),n+"");function Ys(t,e,i){var s,n=Object(t);return u(t)||(s=d(e,3),t=_(t),e=,-1<(e=zs(t,e,i))?n[s?t[e]:e]:B}var zs;zs=js;ts(;function Js(s,i,t){var n,r,a,o,l,d,u=0,h=!1,c=!1,e=!0;if("function"!=typeof s)throw new TypeError(A);n i=vn(i)||0,m(t)&&(h=!!t.leading,c="maxWait"in t,a=c?M(vn(t.maxWait)||0,i):a,e="trailing"in t?!!t.trailing:e),E.cancel=E.flush=E}Cache=o;var tn=Hi(function(){return arguments}())?Hi:H=Array.isArray;r sn=te||Ln,es=ne?Ie(ne):function(t){return K(t)&&l(t)==at};n=re?Ie(re):function(t){return K(t)&&V(t)==w};function ln(t){return"number"==typeof t||K(t)&&l(t)==ut}ar un=se?Ie(se):r cn=$t?Ie($t):=us(,n=us(,fn=us(;UpperCase";var Tn,yn=Dn=ts(;tion Rn(){}ction On(t,e){var i;return t=vn(t),(e=null==e?0:L(c(e),292))?(i=(g(t)+"e").split("e"),+((i=(g(kn(i[0]+"e"+(+i[1]+e)))+"e").split("e"))[0]+"e"+(+i[1]-e))):kn(t)}var kn,Nn;kn=Math["round"];O.assign=t,O.assignIn=n,O.assignInWith=fn,O.chain=Ks,O.compact=O.constant=In,O.debounce=Js,O.drop=O.flatten=Gs,O.iteratee=Cn,O.keys=_,O.keysIn=mn,O.map=O.memoize=Qs,O.mixin=bn,O.negate=Zs,O.omitBy=O.pickBy=An,O.property=Pn,O.pull=i,O.pullAll=Vs,O.reverse=Hs,O.sortBy=s,O.tap=O.throttle=O.thru=Ws,O.toArray=gn,O.values=Sn,O.without=e,O.extend=n,O.extendWith=fn,bn(O,O),O.attempt=Dn,O.capitalize=O.clone=O.cloneDeep=O.endsWith=O.eq=$s,O.escape=O.every=function(t,e,i){return(H(t)?ge:Oi)(t,d(e=i&&Is(t,e,i)?B:e,3))},O.find=Ys,O.findIndex=js,O.forEach=qs,O.forOwn=O.get=En,O.has=O.hasIn=_n,O.identity=f,O.includes=O.indexOf=O.inRange=O.isArguments=tn,O.isArray=H,O.isArrayLike=u,O.isArrayLikeObject=en,O.isBoolean=O.isBuffer=sn,O.isDate=es,O.isEmpty=O.isError=nn,O.isFunction=rn,O.isLength=an,O.isMap=on,O.isNaN=O.isNull=O.isNumber=ln,O.isObject=m,O.isObjectLike=K,O.isPlainObject=dn,O.isSet=un,O.isString=hn,O.isSymbol=h,O.isTypedArray=cn,O.isUndefined=O.last=xs,O.min=function(t){if(t&&t.length){for(var e=t,i=f,s=Xi,n=-1,r=e.length;++n<r;){var a,o,l=e[n],d=i(l);null!=d&&(a===B?d==d&&!h(d):s(d,a))&&(a=d,o=l)}return o}return B},O.stubArray=Mn,O.stubFalse=Ln,O.noConflict=O.noop=Rn,O.now=Xs,O.padStart=function(t,e,i){t=g(t);var s=(e=c(e))?Ue(t):0;return e&&s<e?(e=e-s,((i=(s=(s=i)===B?" ":ns(s)).length)<2?i?$i(s,e):s:(i=$i(s,ei(e/Ue(s))),Le(s)?os(Be(i),0,e).join(""):i.slice(0,e)))+t):t},O.round=On,O.some=O.startsWith=O.template=function(a,t,e){var o,l,i=O.templateSettings;e&&Is(a,t,e)&&(t=B),a=g(a),t=fn({},t,i,gs);var s=_(e=fn({},t.imports,i.imports,gs)),n=Ce(e,s),d=0,i=t.interpolate||Qt,u="__p += '",e=RegExp((t.escape||Qt).source+"|"+i.source+"|"+(i===Ut?Kt:Qt).source+"|"+(t.evaluate||Qt).source+"|$","g"),r="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++le+"]")+"\n";if(a.replace(e,,u+="';\n",(i=t.variable)||(u="with (obj) {\n"+u+"\n}\n"),u=(l?u.replace(Mt,""):u).replace(Lt,"$1").replace(Ot,"$1;"),u="function("+(i||"obj")+") {\n"+(i?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+u+"return __p\n}",(e=Dn().source=u,nn(e))throw e;return e},O.toFinite=pn,O.toInteger=c,O.toNumber=vn,O.toString=g,O.upperFirst=yn,O.each=qs,bn(O,(Nn={},Bi(O,,Nn),{chain:!1}),O.VERSION="4.17.5",P(["drop","take"],,P(["filter","map","takeWhile"],,P(["head","last"],,P(["initial","tail"],,k.prototype.compact=function(){return this.filter(f)},k.prototype.find=k.prototype.findLast=k.prototype.invokeMap=ts(,k.prototype.reject=k.prototype.slice=k.prototype.takeRightWhile=k.prototype.toArray=Bi(k.prototype,,P(["pop","push","shift","sort","splice","unshift"],,Bi(k.prototype,,ui[cs(B,q).name]=[{name:"wrapper",func:B}],k.prototype.clone=k.prototype.reverse=k.prototype.value=O.prototype.chain=O.prototype.commit=O.prototype.next=O.prototype.plant=O.prototype.reverse=O.prototype.toJSON=O.prototype.valueOf=O.prototype.value=O.prototype.first=O.prototype.head,Ze&&(O.prototype[Ze]=,ie?((ie.exports=O)._=O,ee._=O):R._=O}.call(this),"undefined"!=typeof window&&(t=this,e=function(){return i={"./node_modules/eventemitter3/index.js":function(t,e,i){"use strict";var s=Object.prototype.hasOwnProperty,g="~";function n(){}ct.create&&(n.prototype=Object.create(null),(new n).__proto__||(g=!1)),o.prototype.eventNames=o.prototype.listeners=o.prototype.listenerCount=o.prototype.emit=o.prototype.on=function(t,e,i){return a(this,t,e,i,!1)},o.prototype.once=o.prototype.removeListener=function(t,e,i,s){t=g?g+t:t;if(this._events[t])if(e){var n=this._events[t];if(n.fn)n.fn!==e||s&&!n.once||i&&n.context!==i||l(this,t);else{for(var r=0,a=[],o=n.length;r<o;r++)(n[r].fn!==e||s&&!n[r].once||i&&n[r].context!==i)&&a.push(n[r]);a.length?this._events[t]=1===a.length?a[0]:a:l(this,t)}}else l(this,t);return this},o.prototype.removeAllListeners=o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=g,t.exports=o.EventEmitter=o},"./node_modules/url-toolkit/src/url-toolkit.js":"./node_modules/webworkify-webpack/index.js":function(t,e,h){function r(i){var s={};.m=i,n.c=s,n.i=function(t){return t},n.d=n.r=n.n=n.o=n.p="/",n.oe=var t=n(n.s=ENTRY_MODULE);return t.default||t}var c="[\\.|\\-|\\+|\\w|/|@]+",g="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+c+").*?\\)";unction v(t,e,i){var s={},n=(s[i]=[],e.toString()),e=n.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(e){for(var r,e=e[1],a=new RegExp("(\\\\n|\\W)"+p(e)+g,"g");r=a.exec(n);)"dll-reference"!==r[3]&&s[i].push(r[3]);for(a=new RegExp("\\("+p(e)+'\\("(dll-reference\\s('+c+'))"\\)\\)'+g,"g");r=a.exec(n);)t[r[2]]||(s[i].push(r[1]),t[r[2]]=h(r[1]).m),s[r[2]]=s[r[2]]||[],s[r[2]].push(r[4]);for(var o,l=Object.keys(s),d=0;d<l.length;d++)for(var u=0;u<s[l[d]].length;u++)o=s[l[d]][u],isNaN(+o)||(s[l[d]][u]=+s[l[d]][u])}return s}.exports=function(t,e){var i={main:h.m},s=(e=e||{}).all?{main:Object.keys(i.main)}:a(i,t),n="",t=(Object.keys(s).filter(function(t){return"main"!==t}).forEach(,n=n+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s.main.map(.join(",")+"}))(self);",new window.Blob([n],{type:"text/javascript"}));return e.bare||(e=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(t),(t=new window.Worker(e)).objectURL=e),t}},"./src/config.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"hlsDefaultConfig",function(){return A}),i.d(e,"mergeConfig",function(){return S}),i.d(e,"enableStreamingMode",function(){return T});var e=i("./src/controller/abr-controller.ts"),s=i("./src/controller/audio-stream-controller.ts"),n=i("./src/controller/audio-track-controller.ts"),r=i("./src/controller/subtitle-stream-controller.ts"),a=i("./src/controller/subtitle-track-controller.ts"),o=i("./src/controller/buffer-controller.ts"),l=i("./src/controller/timeline-controller.ts"),d=i("./src/controller/cap-level-controller.ts"),u=i("./src/controller/fps-controller.ts"),h=i("./src/controller/eme-controller.ts"),c=i("./src/utils/xhr-loader.ts"),g=i("./src/utils/fetch-loader.ts"),p=i("./src/utils/cues.ts"),v=i("./src/utils/mediakeys-helper.ts"),f=i("./src/utils/logger.ts");function E(){return(E=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(this,arguments)}r A=m(m({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:c.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:e.default,bufferController:o.default,capLevelController:d.default,fpsController:u.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:v.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:p.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:r.SubtitleStreamController,subtitleTrackController:a.default,timelineController:l.TimelineController,audioStreamController:s.default,audioTrackController:n.default,emeController:h.default});"./src/controller/abr-controller.ts":function(t,e,i){"use strict";i.r(e);var E=i("./src/polyfills/number.ts"),n=i("./src/utils/ewma-bandwidth-estimator.ts"),_=i("./src/events.ts"),m=i("./src/utils/buffer-helper.ts"),r=i("./src/errors.ts"),o=i("./src/types/loader.ts"),A=i("./src/utils/logger.ts");function a(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}i=function(){ar e,i,s=t.prototype;return s.registerListeners=function(){var t=this.hls;t.on(_.Events.FRAG_LOADING,this.onFragLoading,this),t.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(_.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(_.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var t=this.hls;t.off(_.Events.FRAG_LOADING,this.onFragLoading,this),t.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(_.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(_.Events.ERROR,this.onError,this)},s.destroy=s.onFragLoading=function(t,e){var i=e.frag;i.type!==o.PlaylistLevelType.MAIN||this.timer||(this.fragCurrent=i,this.partCurrent=null!=(i=e.part)?i:null,this.timer=self.setInterval(this.onCheck,100))},s.onLevelLoaded=s._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,i=this.hls,s=i.autoLevelEnabled,n=i.config,r=i.media;if(t&&r){var a=(e||t).stats,o=(e||t).duration;if(a.aborted)A.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;else if(s&&!r.paused&&r.playbackRate&&r.readyState){var s=performance.now()-a.loading.start,l=Math.abs(r.playbackRate);if(!(s<=500*o/l)){var d=i.levels,u=i.minAutoLevel,h=d[t.level],h=a.total||Math.max(a.loaded,Math.round(o*h.maxBitrate/8)),c=Math.max(1,a.bwEstimate?a.bwEstimate/8:1e3*a.loaded/s),h=(h-a.loaded)/c,g=r.currentTime,p=(m.BufferHelper.bufferInfo(r,g,n.maxBufferHole).end-g)/l;if(!(2*o/l<=p||h<=p)){for(var v=Number.POSITIVE_INFINITY,f=t.level-1;u<f;f--)if((v=o*d[f].maxBitrate/(6.4*c))<p)break;h<=v||(r=this.bwEstimator.getEstimate(),A.logger.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+f+"\n      Current BW estimate: "+(Object(E.isFiniteNumber)(r)?(r/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+h.toFixed(3)+" s\n      Estimated load time for the next fragment: "+v.toFixed(3)+" s\n      Time to underbuffer: "+p.toFixed(3)+" s"),i.nextLoadLevel=f,this.bwEstimator.sample(s,a.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),i.trigger(_.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:a}))}}}}},s.onFragLoaded=function(t,e){var i,s,n,r,a=e.frag,e=e.part;a.type===o.PlaylistLevelType.MAIN&&Object(E.isFiniteNumber)(a.sn)&&(i=(e||a).stats,n=(e||a).duration,this.clearTimer(),this.lastLoadedFragLevel=a.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(s=((r=this.hls.levels[a.level]).loaded?r.loaded.bytes:0)+i.loaded,n=(r.loaded?r.loaded.duration:0)+n,r.loaded={bytes:s,duration:n},r.realBitrate=Math.round(8*s/n)),a.bitrateTest)&&(r={stats:i,frag:a,part:e,id:a.type},this.onFragBuffered(_.Events.FRAG_BUFFERED,r),a.bitrateTest=!1)},s.onFragBuffered=function(t,e){var i,s=e.frag,e=e.part,e=(e||s).stats;e.aborted||s.type===o.PlaylistLevelType.MAIN&&"initSegment"!==s.sn&&(i=e.parsing.end-e.loading.start,this.bwEstimator.sample(i,e.loaded),e.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0)},s.onError=s.clearTimer=s.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,i=this.hls,s=i.maxAutoLevel,n=i.config,r=i.minAutoLevel,i=i.media,e=e?e.duration:t?t.duration:0,t=i?i.currentTime:0,a=i&&0!==i.playbackRate?Math.abs(i.playbackRate):1,o=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,i=(m.BufferHelper.bufferInfo(i,t,n.maxBufferHole).end-t)/a,t=this.findBestLevel(o,r,s,i,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(0<=t)return t;A.logger.trace((i?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var l,a=e?Math.min(e,n.maxStarvationDelay):n.maxStarvationDelay,d=n.abrBandWidthFactor,u=n.abrBandWidthUpFactor;return i||(l=this.bitrateTestDelay)&&(a=(e?Math.min(e,n.maxLoadingDelay):n.maxLoadingDelay)-l,A.logger.trace("bitrate test took "+Math.round(1e3*l)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*a)+" ms"),d=u=1),t=this.findBestLevel(o,r,s,i+a,d,u),Math.max(t,0)},s.findBestLevel=function(t,e,i,s,n,r){for(var a,o=this.fragCurrent,l=this.partCurrent,d=this.lastLoadedFragLevel,u=this.hls.levels,h=u[d],c=!(null==h||null==(a=h.details)||!a.live),g=null==h?void 0:h.codecSet,p=l?l.duration:o?o.duration:0,v=i;e<=v;v--){var f=u[v];if(f&&(!g||f.codecSet===g)){var f=f.details,f=(l?null==f?void 0:f.partTarget:null==f?void 0:f.averagetargetduration)||p,E=void 0,E=v<=d?n*t:r*t,_=u[v].maxBitrate,m=_*f/E;if(A.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+v+"/"+Math.round(E)+"/"+_+"/"+f+"/"+s+"/"+m),_<E&&(!m||c&&!this.bitrateTestDelay||m<s))return v}}return-1},s=t,(e=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;return-1===t||e&&e.canEstimate()?(e=this.getNextABRAutoLevel(),-1!==t?Math.min(t,e):e):t},set:function(t){this._nextAutoLevel=t}}])&&a(s.prototype,e),i&&a(s,i),t}();e.default=i},"./src/controller/audio-stream-controller.ts":function(t,e,i){"use strict";i.r(e);var r=i("./src/polyfills/number.ts"),c=i("./src/controller/base-stream-controller.ts"),g=i("./src/events.ts"),a=i("./src/utils/buffer-helper.ts"),o=i("./src/controller/fragment-tracker.ts"),s=i("./src/types/level.ts"),u=i("./src/types/loader.ts"),p=i("./src/loader/fragment.ts"),h=i("./src/demux/chunk-cache.ts"),v=i("./src/demux/transmuxer-interface.ts"),f=i("./src/types/transmuxer.ts"),l=i("./src/controller/fragment-finders.ts"),d=i("./src/utils/discontinuities.ts"),E=i("./src/errors.ts"),_=i("./src/utils/logger.ts");function m(){return(m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(this,arguments)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}i=function(n){var t;=n,(i=e).prototype=Object.create(t.prototype),A(i.prototype.constructor=i,t);var i=e.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var t=this.hls;t.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(g.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(g.Events.ERROR,this.onError,this),t.on(g.Events.BUFFER_RESET,this.onBufferReset,this),t.on(g.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var t=this.hls;t.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(g.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(g.Events.ERROR,this.onError,this),t.off(g.Events.BUFFER_RESET,this.onBufferReset,this),t.off(g.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onInitPtsFound=function(t,e){var i=e.frag,s=e.id,e=e.initPTS;"main"===s&&(s=i.cc,this.initPTS[i.cc]=e,this.log("InitPTS for cc: "+s+" found from main: "+e),this.videoTrackCC=s,this.state===c.State.WAITING_INIT_PTS)&&this.tick()},i.startLoad=function(t){var e;this.levels?(e=this.lastCurrentTime,this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<e&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=c.State.IDLE):(this.loadedmetadata=!1,this.state=c.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()):(this.startPosition=t,this.state=c.State.STOPPED)},i.doTick=function(){switch(this.state){case c.State.IDLE:this.doTickIdle();break;case c.State.WAITING_TRACK:var t=this.levels,e=this.trackId,e=null==t||null==(t=t[e])?void 0:t.details;if(e){if(this.waitForCdnTuneIn(e))break;this.state=c.State.WAITING_INIT_PTS}break;case c.State.FRAG_LOADING_WAITING_RETRY:t=performance.now(),e=this.retryDate;(!e||e<=t||null!=(e=this.media)&&e.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=c.State.IDLE);break;case c.State.WAITING_INIT_PTS:var i,s,t=this.waitingData;t?(e=t.frag,i=t.part,s=t.cache,t=t.complete,void 0!==this.initPTS[e.cc]?(this.waitingData=null,this.waitingVideoCC=-1,this.state=c.State.FRAG_LOADING,i={frag:e,part:i,payload:s.flush(),networkDetails:null},this._handleFragmentLoadProgress(i),t&&n.prototype._handleFragmentLoadComplete.call(this,i)):this.videoTrackCC!==this.waitingVideoCC?(_.logger.log("Waiting fragment cc ("+e.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):(s=this.getLoadPosition(),t=a.BufferHelper.bufferInfo(this.mediaBuffer,s,this.config.maxBufferHole),Object(l.fragmentWithinToleranceTest)(t.end,this.config.maxFragLookUpTolerance,e)<0&&(_.logger.log("Waiting fragment cc ("+e.cc+") @ "+e.start+" cancelled because another fragment at "+t.end+" is needed"),this.clearWaitingFragment()))):this.state=c.State.IDLE}this.onTickEnd()},i.clearWaitingFragment=i.onTickEnd=i.doTickIdle=function(){var t,e,i=this.hls,s=this.levels,n=this.media,r=this.trackId,a=i.config;s&&s[r]&&(n||!this.startFragRequested&&a.startFragPrefetch)&&(!(a=s[r].details)||a.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(a)?this.state=c.State.WAITING_TRACK:(this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer||this.media,p.ElementaryStreamTypes.AUDIO,u.PlaylistLevelType.AUDIO)),null===(s=this.getFwdBufferInfo(this.mediaBuffer||this.media,u.PlaylistLevelType.AUDIO))||(r=s.len,t=this.getMaxBufferLength(),e=this.audioSwitch,t<=r&&!e)||(!e&&this._streamEnded(s,a)?(i.trigger(g.Events.BUFFER_EOS,{type:"audio"}),this.state=c.State.ENDED):(t=a.fragments[0].start,r=s.end,e&&(r=i=this.getLoadPosition(),a.PTSKnown)&&i<t&&(s.end>t||s.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=t+.05),(e=this.getNextFragment(r,a))?"identity"!==(null==(i=e.decryptdata)?void 0:i.keyFormat)||null!=(s=e.decryptdata)&&s.key?this.loadFragment(e,a,r):this.loadKey(e,a):this.bufferFlushed=!0))))},i.getMaxBufferLength=i.onMediaDetaching=i.onAudioTracksUpdated=i.onAudioTrackSwitching=function(t,e){var i=!!e.url,e=(this.trackId=e.id,this.fragCurrent);null!=e&&e.loader&&e.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.audioSwitch=!0,this.state=c.State.IDLE):this.state=c.State.STOPPED,this.tick()},i.onManifestLoading=i.onLevelLoaded=function(t,e){this.mainDetails=e.details},i.onAudioTrackLoaded=function(t,e){var i=this.levels,s=e.details,e=e.id;if(i){this.log("Track "+e+" loaded ["+s.startSN+","+s.endSN+"],duration:"+s.totalduration);var i=i[e],n=0;if(s.live||null!=(r=i.details)&&r.live){var r=this.mainDetails;if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed||!r)return;n=!i.details&&s.hasProgramDateTime&&r.hasProgramDateTime?(Object(d.alignPDT)(s,r),s.fragments[0].start):this.alignPlaylists(s,i.details)}i.details=s,this.levelLastLoaded=e,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(i.details,n),this.state!==c.State.WAITING_TRACK||this.waitForCdnTuneIn(s)||(this.state=c.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+e)},i._handleFragmentLoadProgress=function(t){var e,i,s,n,r=t.frag,a=t.part,t=t.payload,o=this.config,l=this.trackId,d=this.levels;d?(d=d[l],console.assert(d,"Audio track is defined on fragment load progress"),e=d.details,console.assert(e,"Audio track details are defined on fragment load progress"),o=o.defaultAudioCodec||d.audioCodec||"mp4a.40.2",d=(d=this.transmuxer)||(this.transmuxer=new v.default(this.hls,u.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this))),i=this.initPTS[r.cc],s=null==(s=r.initSegment)?void 0:s.data,void 0!==i?(n=a?a.index:-1,n=new f.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,t.byteLength,n,-1!==n),d.push(t,s,o,"",r,a,e.totalduration,!1,n,i)):(_.logger.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+e.startSN+" ,"+e.endSN+"],track "+l),(this.waitingData=this.waitingData||{frag:r,part:a,cache:new h.default,complete:!1}).cache.push(new Uint8Array(t)),this.waitingVideoCC=this.videoTrackCC,this.state=c.State.WAITING_INIT_PTS)):this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},i._handleFragmentLoadComplete=i.onBufferReset=i.onBufferCreated=i.onFragBuffered=function(t,e){var i=e.frag,e=e.part;i.type===u.PlaylistLevelType.AUDIO&&(this.fragContextChanged(i)?this.warn("Fragment "+i.sn+(e?" p: "+e.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==i.sn&&(this.fragPrevious=i,this.audioSwitch)&&(this.audioSwitch=!1,this.hls.trigger(g.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.fragBufferedComplete(i,e)))},i.onError=i.onBufferFlushed=i._handleTransmuxComplete=function(t){var e,i,s,n,r,a,o,l="audio",d=this.hls,u=t.remuxResult,t=t.chunkMeta,h=this.getCurrentContext(t);h?(e=h.frag,h=h.part,i=u.audio,s=u.text,n=u.id3,u=u.initSegment,this.fragContextChanged(e)||(this.state=c.State.PARSING,this.audioSwitch&&i&&this.completeAudioSwitch(),null!=u&&u.tracks&&(this._bufferInitSegment(u.tracks,e,t),d.trigger(g.Events.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:l,tracks:u.tracks})),i&&(u=i.startPTS,a=i.endPTS,o=i.startDTS,r=i.endDTS,h&&(h.elementaryStreams[p.ElementaryStreamTypes.AUDIO]={startPTS:u,endPTS:a,startDTS:o,endDTS:r}),e.setElementaryStreamInfo(p.ElementaryStreamTypes.AUDIO,u,a,o,r),this.bufferFragmentData(i,e,h,t)),null!=n&&null!=(u=n.samples)&&u.length&&(a=m({frag:e,id:l},n),d.trigger(g.Events.FRAG_PARSING_METADATA,a)),s&&(o=m({frag:e,id:l},s),d.trigger(g.Events.FRAG_PARSING_USERDATA,o)))):(this.warn("The loading context changed while buffering fragment "+t.sn+" of level "+t.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(t.level))},i._bufferInitSegment=function(t,e,i){var s;this.state===c.State.PARSING&&(t.video&&delete t.video,s=t.audio)&&(s.levelCodec=s.codec,s.id="audio",this.log("Init audio buffer, container:"+s.container+", codecs[parsed]=["+s.codec+"]"),this.hls.trigger(g.Events.BUFFER_CODECS,t),null!=(t=s.initSegment)&&t.byteLength&&(s={type:"audio",frag:e,part:null,chunkMeta:i,parent:e.type,data:t},this.hls.trigger(g.Events.BUFFER_APPENDING,s)),this.tick())},i.loadFragment=i.completeAudioSwitch=e}(c.default);e.default=i},"./src/controller/audio-track-controller.ts":function(t,e,i){"use strict";i.r(e);var l=i("./src/events.ts"),r=i("./src/errors.ts"),s=i("./src/controller/base-playlist-controller.ts"),a=i("./src/types/loader.ts");function o(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}i=function(i){=i,(n=t).prototype=Object.create(e.prototype),d(n.prototype.constructor=n,e);var e,s,n=t.prototype;return n.registerListeners=function(){var t=this.hls;t.on(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(l.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(l.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(l.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(l.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(l.Events.ERROR,this.onError,this)},n.unregisterListeners=n.destroy=n.onManifestLoading=n.onManifestParsed=n.onAudioTrackLoaded=n.onLevelLoading=function(t,e){this.switchLevel(e.level)},n.onLevelSwitching=function(t,e){this.switchLevel(e.level)},n.switchLevel=function(t){var e,i,t=this.hls.levels[t];null!=t&&t.audioGroupIds&&(e=t.audioGroupIds[t.urlId],this.groupId!==e)&&(this.groupId=e,t=this.tracks.filter(function(t){return!e||t.groupId===e}),this.selectDefaultTrack&&!t.some(function(t){return t.default})&&(this.selectDefaultTrack=!1),i={audioTracks:this.tracksInGroup=t},this.log("Updating audio tracks, "+t.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(l.Events.AUDIO_TRACKS_UPDATED,i),this.selectInitialTrack())},n.onError=function(t,e){i.prototype.onError.call(this,t,e),!e.fatal&&e.context&&e.context.type===a.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},n.setAudioTrack=n.selectInitialTrack=function(){var t=this.tracksInGroup,t=(console.assert(t.length,"Initial audio track should be selected when tracks are known"),this.trackName),t=this.findTrackId(t)||this.findTrackId();-1!==t?this.setAudioTrack(t):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(l.Events.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},n.findTrackId=function(t){for(var e=this.tracksInGroup,i=0;i<e.length;i++){var s=e[i];if((!this.selectDefaultTrack||s.default)&&(!t||t===s.name))return s.id}return-1},n.loadPlaylist=e=t,(n=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:])&&o(e.prototype,n),s&&o(e,s),t}(s.default);e.default=i},"./src/controller/base-playlist-controller.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return r});var o=i("./src/polyfills/number.ts"),l=i("./src/types/level.ts"),p=i("./src/controller/level-helper.ts"),s=i("./src/utils/logger.ts"),n=i("./src/errors.ts"),r=function(){ar e=t.prototype;return e.destroy=e.onError=e.clearTimer=e.startLoad=e.stopLoad=e.switchParams=function(t,e){var i=null==e?void 0:e.renditionReports;if(i)for(var s=0;s<i.length;s++){var n=i[s],r=""+n.URI;if(r===t.substr(-r.length)){var a,r=parseInt(n["LAST-MSN"]),n=parseInt(n["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode&&(a=Math.min(e.age-e.partTarget,e.targetduration),void 0!==n)&&a>e.partTarget&&(n+=1),Object(o.isFiniteNumber)(r))return new l.HlsUrlParameters(r,Object(o.isFiniteNumber)(n)?n:void 0,l.HlsSkip.No)}}},e.loadPlaylist=function(t){},e.shouldLoadTrack=e.playlistLoaded=function(t,e,i){var s=this,n=e.details,r=e.stats,a=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(n.advancedDateTime=Date.now()-a,n.live||null!=i&&i.live){if(n.reloaded(i),i&&this.log("live playlist "+t+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),i&&0<n.fragments.length&&Object(p.mergeDetails)(i,n),this.canLoad&&n.live){var o,a=void 0,l=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var d=this.hls.config.lowLatencyMode,u=n.lastPartSn,h=n.endSN,c=n.lastPartIndex,g=u===h,u=(-1!==c?(a=g?h+1:u,l=g?d?0:c:c+1):a=h+1,n.age),c=u+n.ageHeader,h=Math.min(c-n.partTarget,1.5*n.targetduration);if(0<h&&(i&&h>i.tuneInGoal?(this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+h+" with playlist age: "+n.age),h=0):(a+=c=Math.floor(h/n.targetduration),void 0!==l&&(l+=Math.round(h%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+u.toFixed(2)+"s goal: "+h+" skip sn "+c+" to part "+l)),n.tuneInGoal=h),o=this.getDeliveryDirectives(n,e.deliveryDirectives,a,l),d||!g)return void this.loadPlaylist(o)}else o=this.getDeliveryDirectives(n,e.deliveryDirectives,a,l);i=Object(p.computeReloadInterval)(n,r);void 0!==a&&n.canBlockReload&&(i-=n.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(i)+" ms"),this.timer=self.setTimeout(i)}}else this.clearTimer()},e.getDeliveryDirectives=e.retryLoadingOrFail=function(t){var e,i=this,s=this.hls.config,n=this.retryCount<s.levelLoadingMaxRetry;return n?(this.retryCount++,-1<t.details.indexOf("LoadTimeOut")&&null!=(e=t.context)&&e.deliveryDirectives?(this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist()):(e=Math.min(Math.pow(2,this.retryCount)*s.levelLoadingRetryDelay,s.levelLoadingMaxRetryTimeout),this.timer=self.setTimeout(function(){return i.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+t.details+'"'))):(this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0),n},t}()},"./src/controller/base-stream-controller.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"State",function(){return T}),i.d(e,"default",function(){return s});var l=i("./src/polyfills/number.ts"),e=i("./src/task-loop.ts"),h=i("./src/controller/fragment-tracker.ts"),a=i("./src/utils/buffer-helper.ts"),r=i("./src/utils/logger.ts"),c=i("./src/events.ts"),o=i("./src/errors.ts"),d=i("./src/types/transmuxer.ts"),u=i("./src/utils/mp4-tools.ts"),g=i("./src/utils/discontinuities.ts"),p=i("./src/controller/fragment-finders.ts"),v=i("./src/controller/level-helper.ts"),f=i("./src/loader/fragment-loader.ts"),E=i("./src/crypt/decrypter.ts"),_=i("./src/utils/time-ranges.ts"),m=i("./src/types/loader.ts");function A(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var T={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},s=function(n){=n,(s=t).prototype=Object.create(e.prototype),S(s.prototype.constructor=s,e);var e,i,s=t.prototype;return s.doTick=function(){this.onTickEnd()},s.onTickEnd=function(){},s.startLoad=function(t){},s.stopLoad=s._streamEnded=function(t,e){var i=this.fragCurrent,s=this.fragmentTracker;return!(e.live||!i||i.sn!==e.endSN||t.nextStart||(e=s.getState(i))!==h.FragmentState.PARTIAL&&e!==h.FragmentState.OK)},s.onMediaAttached=function(t,e){e=this.media=this.mediaBuffer=e.media,this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended),e=this.config;this.levels&&e.autoStartLoad&&this.state===T.STOPPED&&this.startLoad(e.startPosition)},s.onMediaDetaching=s.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,i=this.media,s=this.mediaBuffer,n=this.state,r=i?i.currentTime:0,s=a.BufferHelper.bufferInfo(s||i,r,t.maxBufferHole);this.log("media seeking to "+(Object(l.isFiniteNumber)(r)?r.toFixed(3):r)+", state: "+n),n===T.ENDED?this.resetLoadingState():e&&!s.len&&(n=t.maxFragLookUpTolerance,t=e.start-n,n=e.start+e.duration+n<r,r<t||n)&&(n&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.resetLoadingState()),i&&(this.lastCurrentTime=r),this.loadedmetadata||s.len||(this.nextLoadPosition=this.startPosition=r),this.tickImmediate()},s.onMediaEnded=s.onKeyLoaded=function(t,e){var i;this.state===T.KEY_LOADING&&e.frag===this.fragCurrent&&this.levels&&(this.state=T.IDLE,i=this.levels[e.frag.level].details)&&this.loadFragment(e.frag,i,e.frag.start)},s.onHandlerDestroying=s.onHandlerDestroyed=s.loadKey=s.loadFragment=function(t,e,i){this._loadFragForPlayback(t,e,i)},s._loadFragForPlayback=function(i,t,e){var s=this;this._doFragLoad(i,t,e,.then(function(t){var e;t&&(s.fragLoadError=0,e=s.state,s.fragContextChanged(i)?e!==T.FRAG_LOADING&&e!==T.BACKTRACKING&&(s.fragCurrent||e!==T.PARSING)||(s.fragmentTracker.removeFragment(i),s.state=T.IDLE):"payload"in t&&(s.log("Loaded fragment "+i.sn+" of level "+i.level),s.hls.trigger(c.Events.FRAG_LOADED,t),s.state===T.BACKTRACKING)?(s.fragmentTracker.backtrack(i,t),s.resetFragmentLoading(i)):s._handleFragmentLoadComplete(t))}).catch(function(t){s.warn(t),s.resetFragmentLoading(i)})},s.flushMainBuffer=s._loadInitSegment=function(r){var a=this;this._doFragLoad(r).then(function(t){if(t&&!a.fragContextChanged(r)&&a.levels)return t;throw new Error("init load aborted")}).then(function(i){var s,n=a.hls,t=i.payload,e=r.decryptdata;return t&&0<t.byteLength&&e&&e.key&&e.iv&&"AES-128"===e.method?(s=self.performance.now(),a.decrypter.webCryptoDecrypt(new Uint8Array(t),e.key.buffer,e.iv.buffer).then():i}).then(function(t){var e=a.fragCurrent,i=a.hls,s=a.levels;if(!s)throw new Error("init load aborted, missing levels");s=s[r.level].details,console.assert(s,"Level details are defined when init segment is loaded"),s=r.stats;a.state=T.IDLE,a.fragLoadError=0,r.data=new Uint8Array(t.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),t.frag===e&&i.trigger(c.Events.FRAG_BUFFERED,{stats:s,frag:e,part:null,id:r.type}),a.tick()}).catch(},s.fragContextChanged=s.fragBufferedComplete=s._handleFragmentLoadComplete=s._handleFragmentLoadProgress=function(t){},s._doFragLoad=function(t,e,i,s){var n=this;if(void 0===i&&(i=null),!this.levels)throw new Error("frag load aborted, missing levels");if(i=Math.max(t.start,i||0),this.config.lowLatencyMode&&e){var r=e.partList;if(r&&s){i>t.end&&e.fragmentHint&&(t=e.fragmentHint);var a,o=this.getNextPart(r,t,i);if(-1<o)return a=r[o],this.log("Loading part sn: "+t.sn+" p: "+a.index+" cc: "+t.cc+" of playlist ["+e.startSN+"-"+e.endSN+"] parts [0-"+o+"-"+(r.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=a.start+a.duration,this.state=T.FRAG_LOADING,this.hls.trigger(c.Events.FRAG_LOADING,{frag:t,part:r[o],targetBufferTime:i}),this.doFragPartsLoad(t,r,o,s).catch(function(t){return n.handleFragLoadError(t)});if(!t.url||this.loadedEndOfParts(r,i))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(e?"of ["+e.startSN+"-"+e.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),Object(l.isFiniteNumber)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=T.FRAG_LOADING,this.hls.trigger(c.Events.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragmentLoader.load(t,s).catch(function(t){return n.handleFragLoadError(t)})},s.doFragPartsLoad=function(o,l,e,d){var u=this;return new Promise(function(r,t){var a=[];(function i(s){var n=l[s];u.fragmentLoader.loadPart(o,n,d).then(function(t){var e=(a[n.index]=t).part,t=(u.hls.trigger(c.Events.FRAG_LOADED,t),l[s+1]);if(!t||t.fragment!==o)return r({frag:o,part:e,partsLoaded:a});i(s+1)}).catch(t)})(e)})},s.handleFragLoadError=s._handleTransmuxerFlush=s.getCurrentContext=function(t){var e,i=this.levels,s=t.level,n=t.sn,t=t.part;return i&&i[s]?(i=i[s],(e=(t=-1<t?Object(v.getPartWith)(i,n,t):null)?t.fragment:Object(v.getFragmentWithSN)(i,n,this.fragCurrent))?{frag:e,part:t,level:i}:null):(this.warn("Levels object was unset while buffering fragment "+n+" of level "+s+". The current chunk will not be buffered."),null)},s.bufferFragmentData=function(t,e,i,s){var n,r,a;t&&this.state===T.PARSING&&(a=t.data1,n=t.data2,r=(r=a)&&n?Object(u.appendUint8Array)(a,n):r)&&r.length&&(a={type:t.type,frag:e,part:i,chunkMeta:s,parent:e.type,data:r},this.hls.trigger(c.Events.BUFFER_APPENDING,a),t.dropped)&&t.independent&&!i&&this.flushBufferGap(e)},s.flushBufferGap=s.getFwdBufferInfo=s.getMaxBufferLength=s.reduceMaxBufferLength=s.getNextFragment=function(t,e){var i=e.fragments,s=i.length;if(!s)return null;var n,r=this.config,a=i[0].start;if(e.live){var o=r.initialLiveManifestSize;if(s<o)return this.warn("Not enough fragments to start playback (have: "+s+", need: "+o+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(n=this.getInitialLiveFragment(e,i),this.startPosition=n?this.hls.liveSyncPosition||n.start:t)}else t<=a&&(n=i[0]);return n||(s=r.lowLatencyMode?e.partEnd:e.fragmentEnd,n=this.getFragmentAtPosition(t,s,e)),n=null==(o=n)||!o.initSegment||null!=(a=n)&&a.initSegment.data||this.bitrateTest?n:n.initSegment},s.getNextPart=s.loadedEndOfParts=s.getInitialLiveFragment=function(t,e){var i,s=this.fragPrevious,n=null;return s?(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+s.programDateTime),n=Object(p.findFragmentByPDT)(e,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),n||((i=s.sn+1)>=t.startSN&&i<=t.endSN&&(i=e[i-t.startSN],s.cc===i.cc)&&this.log("Live playlist, switching playlist, load frag with next SN: "+(n=i).sn),n)||(n=Object(p.findFragWithCC)(e,s.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn)):null!==(i=this.hls.liveSyncPosition)&&(n=this.getFragmentAtPosition(i,this.bitrateTest?t.fragmentEnd:t.edge,t)),n},s.getFragmentAtPosition=function(t,e,i){var s,n=this.config,r=this.fragPrevious,a=i.fragments,o=i.endSN,l=i.fragmentHint,d=n.maxFragLookUpTolerance,n=!!(n.lowLatencyMode&&i.partList&&l);if(n&&l&&!this.bitrateTest&&(a=a.concat(l),o=l.sn),s=t<e?(l=e-d<t?0:d,Object(p.findFragmentByPTS)(r,a,t,l)):a[a.length-1]){e=s.sn-i.startSN,d=r&&s.level===r.level,t=a[1+e];if(this.fragmentTracker.getState(s)===h.FragmentState.BACKTRACKED){s=null;for(var u=e;a[u]&&this.fragmentTracker.getState(a[u])===h.FragmentState.BACKTRACKED;)s=r?a[u--]:a[--u];s=s||t}else r&&s.sn===r.sn&&!n&&d&&(s=s.sn<o&&this.fragmentTracker.getState(t)!==h.FragmentState.OK?(this.log("SN "+s.sn+" just loaded, load next one: "+t.sn),t):null)}return s},s.synchronizeToLiveEdge=function(t){var e,i,s,n,r=this.config,a=this.media;a&&(e=this.hls.liveSyncPosition,i=a.currentTime,n=t.fragments[0].start,s=t.edge,n=i>=n-r.maxFragLookUpTolerance&&i<=s,null!==e)&&a.duration>e&&(i<e||!n)&&(r=void 0!==r.liveMaxLatencyDuration?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*t.targetduration,!n&&a.readyState<4||i<s-r)&&(this.loadedmetadata||(this.nextLoadPosition=e),a.readyState)&&(this.warn("Playback: "+i.toFixed(3)+" is located too far from the end of live sliding playlist: "+s+", reset currentTime to : "+e.toFixed(3)),a.currentTime=e)},s.alignPlaylists=function(t,e){var i,s,n,r=this.levels,a=this.levelLastLoaded,o=this.fragPrevious,r=null!==a?r[a]:null,a=t.fragments.length;return a?(i=t.fragments[0].start,n=!e,s=t.alignedSliding&&Object(l.isFiniteNumber)(i),n||!s&&!i?(Object(g.alignStream)(o,r,t),n=t.fragments[0].start,this.log("Live playlist sliding: "+n.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(o?o.sn:"na")+" fragments: "+a),n):i):(this.warn("No fragments in live playlist"),0)},s.waitForCdnTuneIn=s.setStartPosition=s.getLoadPosition=s.handleFragLoadAborted=s.resetFragmentLoading=s.onFragmentOrKeyLoadError=s.afterBufferFlushed=function(t,e,i){t&&(t=a.BufferHelper.getBuffered(t),this.fragmentTracker.detectEvictedFragments(e,t,i),this.state===T.ENDED)&&this.resetLoadingState()},s.resetLoadingState=s.resetLiveStartWhenNotLoaded=s.updateLevelTiming=function(n,t,r,a){var o=this,l=r.details;console.assert(!!l,"level.details must be defined"),Object.keys(n.elementaryStreams).reduce(function(t,e){var i,s=n.elementaryStreams[e];return s?(i=s.endPTS-s.startPTS)<=0?(o.warn("Could not parse fragment "+n.sn+" "+e+" duration reliably ("+i+") resetting transmuxer to fallback to playlist timing"),o.resetTransmuxer(),t||!1):(i=a?0:Object(v.updateFragPTSDTS)(l,n,s.startPTS,s.endPTS,s.startDTS,s.endDTS),o.hls.trigger(c.Events.LEVEL_PTS_UPDATED,{details:l,level:r,drift:i,type:e,frag:n,start:s.startPTS,end:s.endPTS}),!0):t},!1)?(this.state=T.PARSED,this.hls.trigger(c.Events.FRAG_PARSED,{frag:n,part:t})):this.resetLoadingState()},s.resetTransmuxer=e=t,(s=[{key:"state",get:function(){return this._state},set:])&&A(e.prototype,s),i&&A(e,i),t}(e.default)},"./src/controller/buffer-controller.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return r});var l=i("./src/polyfills/number.ts"),v=i("./src/events.ts"),f=i("./src/utils/logger.ts"),E=i("./src/errors.ts"),_=i("./src/utils/buffer-helper.ts"),e=i("./src/utils/mediasource-helper.ts"),a=i("./src/loader/fragment.ts"),s=i("./src/controller/buffer-operation-queue.ts"),n=Object(e.getMediaSource)(),d=/([ha]vc.)(?:\.[^.,]+)+/,r=function(){ar e=t.prototype;return e.hasSourceTypes=e.destroy=function(){this.unregisterListeners(),this.details=null},e.registerListeners=function(){var t=this.hls;t.on(v.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(v.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(v.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(v.Events.BUFFER_RESET,this.onBufferReset,this),t.on(v.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(v.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(v.Events.BUFFER_EOS,this.onBufferEos,this),t.on(v.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(v.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(v.Events.FRAG_PARSED,this.onFragParsed,this),t.on(v.Events.FRAG_CHANGED,this.onFragChanged,this)},e.unregisterListeners=e._initSourceBuffer=e.onManifestParsed=e.onMediaAttaching=function(t,e){var i,e=this.media=e.media;e&&n&&((i=this.mediaSource=new n).addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),e.src=self.URL.createObjectURL(i),this._objectUrl=e.src)},e.onMediaDetaching=e.onBufferReset=e.onBufferCodecs=function(t,r){var a=this,o=this.getSourceBufferTypes().length;Object.keys(r).forEach(function(t){var e,i,s,n;o?(e=a.tracks[t])&&"function"==typeof e.buffer.changeType&&(i=(n=r[t]).codec,s=n.levelCodec,n=n.container,(e.levelCodec||e.codec).replace(d,"$1")!==(s||i).replace(d,"$1"))&&a.appendChangeType(t,n+";codecs="+(s||i)):a.pendingTracks[t]=r[t]}),o||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},e.appendChangeType=e.onBufferAppending=function(t,e){var n=this,i=this.hls,s=this.operationQueue,r=this.tracks,a=e.data,o=e.type,l=e.frag,d=e.part,u=e.chunkMeta,h=u.buffering[o],e=self.performance.now(),c=(h.start=e,l.stats.buffering),g=d?d.stats.buffering:null,e=(0===c.start&&(c.start=e),g&&0===g.start&&(g.start=e),r.audio),p="audio"===o&&1===u.id&&"audio/mpeg"===(null==e?void 0:e.container);s.append({execute:function(){var t,e;h.executeStart=self.performance.now(),p&&(t=n.sourceBuffer[o])&&(e=l.start-t.timestampOffset,.1<=Math.abs(e))&&(f.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+l.start+" (delta: "+e+") sn: "+l.sn+")"),t.timestampOffset=l.start),n.appendExecutor(a,o)},onStart:function(){},onComplete:function(){var t,e=self.performance.now(),i=(h.executeEnd=h.end=e,0===c.first&&(c.first=e),g&&0===g.first&&(g.first=e),n.sourceBuffer),s={};for(t in i)s[t]=_.BufferHelper.getBuffered(i[t]);n.appendError=0,n.hls.trigger(v.Events.BUFFER_APPENDED,{type:o,frag:l,part:d,chunkMeta:u,parent:l.type,timeRanges:s})},onError:,o)},e.onBufferFlushing=e.onFragParsed=function(t,e){var i=this,s=e.frag,n=e.part,e=[],r=(n||s).elementaryStreams;r[a.ElementaryStreamTypes.AUDIOVIDEO]?e.push("audiovideo"):(r[a.ElementaryStreamTypes.AUDIO]&&e.push("audio"),r[a.ElementaryStreamTypes.VIDEO]&&e.push("video"));0===e.length&&f.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+s.type+" level: "+s.level+" sn: "+s.sn),this.blockBuffers(function(){var t=self.performance.now(),t=(s.stats.buffering.end=t,n&&(n.stats.buffering.end=t),(n||s).stats);i.hls.trigger(v.Events.FRAG_BUFFERED,{frag:s,part:n,stats:t,id:s.type})},e)},e.onFragChanged=e.onBufferEos=e.onLevelUpdated=e.flushBackBuffer=function(){var t,e,i,s,n=this.hls,r=this.details,a=this.media,o=this.sourceBuffer;a&&null!==r&&(t=this.getSourceBufferTypes()).length&&(i=r.live&&null!==n.config.liveBackBufferLength?n.config.liveBackBufferLength:n.config.backBufferLength,!Object(l.isFiniteNumber)(i)||i<0||(a=a.currentTime,e=r.levelTargetDuration,i=Math.max(i,e),s=Math.floor(a/e)*e-i,t.forEach(function(t){var e=o[t];e&&0<(e=_.BufferHelper.getBuffered(e)).length&&s>e.start(0)&&(n.trigger(v.Events.BACK_BUFFER_REACHED,{bufferEnd:s}),r.live&&n.trigger(v.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s}),n.trigger(v.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:t}))})))},e.updateMediaElementDuration=e.updateSeekableRange=e.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,i=this.pendingTracks,s=Object.keys(i).length;(s&&!t||2===s)&&(this.createSourceBuffers(i),this.pendingTracks={},0===(t=this.getSourceBufferTypes()).length?this.hls.trigger(v.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"}):t.forEach()},e.createSourceBuffers=e._onSBUpdateStart=e._onSBUpdateEnd=e._onSBUpdateError=e.removeExecutor=function(t,e,i){var s=this.media,n=this.mediaSource,r=this.operationQueue,a=this.sourceBuffer[t];s&&n&&a?(s=Object(l.isFiniteNumber)(s.duration)?s.duration:1/0,n=Object(l.isFiniteNumber)(n.duration)?n.duration:1/0,(e=Math.max(0,e))<(i=Math.min(i,s,n))?(f.logger.log("[buffer-controller]: Removing ["+e+","+i+"] from the "+t+" SourceBuffer"),console.assert(!a.updating,t+" sourceBuffer must not be updating"),a.remove(e,i)):r.shiftAndExecuteNext(t)):(f.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(t))},e.appendExecutor=e.blockBuffers=function(t,e){var i,s,n=this;(e=void 0===e?this.getSourceBufferTypes():e).length?(i=this.operationQueue,s=e.map(,Promise.all(s).then():(f.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(t))},e.getSourceBufferTypes=e.addBufferListener=e.removeBufferListeners=t}()},"./src/controller/buffer-operation-queue.ts":"./src/controller/cap-level-controller.ts":function(t,e,i){"use strict";i.r(e);var s=i("./src/events.ts");function r(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}i=function(){ar t,e,i=n.prototype;return i.setStreamController=function(t){this.streamController=t},i.destroy=i.registerListeners=function(){var t=this.hls;t.on(s.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(s.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},i.unregisterListener=function(){var t=this.hls;t.off(s.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(s.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},i.onFpsDropLevelCapping=i.onMediaAttaching=i.onManifestParsed=i.onBufferCodecs=i.onMediaDetaching=function(){this.stopCapping()},i.detectPlayerSize=function(){var t,e;this.media&&0<this.mediaHeight&&0<this.mediaWidth&&(t=this.hls.levels).length&&((e=this.hls).autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping)},i.getMaxLevel=function(i){var s=this,t=this.hls.levels;return t.length?(t=t.filter(,this.clientRect=null,n.getMaxLevelByMediaSize(t,this.mediaWidth,this.mediaHeight)):-1},i.startCapping=i.stopCapping=i.getDimensions=function(){var t,e,i;return this.clientRect||(e={width:0,height:0},(t=this.media)&&(i=t.getBoundingClientRect(),e.width=i.width,e.height=i.height,e.width||e.height||(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)),this.clientRect=e)},n.isLevelAllowed=n.getMaxLevelByMediaSize=function(t,e,i){if(!t||!t.length)return-1;for(var s,n=t.length-1,r=0;r<t.length;r+=1){var a=t[r];if((a.width>=e||a.height>=i)&&(a=a,!(s=t[r+1])||a.width!==s.width||a.height!==s.height)){n=r;break}}return n},i=n,e=[{key:"contentScaleFactor",get:],(t=[{key:"mediaWidth",get:function(){return this.getDimensions().width*n.contentScaleFactor}},{key:"mediaHeight",get:])&&r(i.prototype,t),e&&r(i,e),n}();e.default=i},"./src/controller/eme-controller.ts":function(t,e,i){"use strict";i.r(e);var a=i("./src/events.ts"),o=i("./src/errors.ts"),l=i("./src/utils/logger.ts"),d=i("./src/utils/mediakeys-helper.ts");function n(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}i=function(){ar e,i,s=t.prototype;return s.destroy=s._registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this)},s._unregisterListeners=s.getLicenseServerUrl=function(t){if(t===d.KeySystems.WIDEVINE)if(this._widevineLicenseUrl)return this._widevineLicenseUrl;throw new Error('no license server URL configured for key-system "'+t+'"')},s._attemptKeySystemAccess=function(e,t,i){var s=this,t=e,t,i,this._drmSystemOptions),i=(l.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,t));this.mediaKeysPromise=i.then(,i.catch(},s._onMediaKeySystemAccessObtained=function(e,t){var i=this,s=(l.logger.log('Access for key-system "'+e+'" obtained'),{mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e}),n=(this._mediaKeysList.push(s),Promise.resolve().then(function(){return t.createMediaKeys()}).then();return n.catch(,n},s._onMediaKeysCreated=s._onNewMediaKeySession=s._onKeySessionMessage=s.onMediaEncrypted=function(e){var t,i=this;l.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),this.mediaKeysPromise?this.mediaKeysPromise.then(t=.catch(t):(l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0}))},s._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");var e;this._hasSetMediaKeys||((e=this._mediaKeysList[0])&&e.mediaKeys?(l.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0):(l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0})))},s._generateRequestWithPreferredKeySession=function(t,e){var i,s=this,n=this._mediaKeysList[0];n?n.mediaKeysSessionInitialized?l.logger.warn("Key-Session already initialized but requested again"):(i=n.mediaKeysSession)?e?(l.logger.log('Generating key-session request for "'+t+'" init data type'),n.mediaKeysSessionInitialized=!0,i.generateRequest(t,e).then(.catch():(l.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0})):(l.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0})):(l.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0}))},s._createLicenseXhr=function(t,e,i){var s=new XMLHttpRequest,e=(s.responseType="arraybuffer",s.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,s,t,e,i),this._licenseXhrSetup);if(e)try{e.call(this.hls,s,t),e=void 0}catch(t){l.logger.error(t)}try{s.readyState||s.open("POST",t,!0),e&&e.call(this.hls,s,t)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return s},s._onLicenseRequestReadyStageChange=s._generateLicenseRequestChallenge=s._requestLicense=function(t,e){l.logger.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(i)try{var s=this.getLicenseServerUrl(i.mediaKeySystemDomain),n=this._createLicenseXhr(s,t,e),r=(l.logger.log("Sending license request to URL: "+s),this._generateLicenseRequestChallenge(i,t));n.send(r)}catch(t){l.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}else l.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0})},s.onMediaAttached=s.onMediaDetached=s.onManifestParsed=s=t,(e=[{key:"requestMediaKeySystemAccess",get:])&&n(s.prototype,e),i&&n(s,i),t}();e.default=i},"./src/controller/fps-controller.ts":function(t,e,i){"use strict";i.r(e);var l=i("./src/events.ts"),d=i("./src/utils/logger.ts");e.default=function(){ar e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.registerListeners=e.unregisterListeners=e.destroy=e.onMediaAttaching=e.checkFPS=function(t,e,i){var s,n,r,a,o=performance.now();e&&(this.lastTime&&(a=o-this.lastTime,s=i-this.lastDroppedFrames,n=e-this.lastDecodedFrames,a=1e3*s/a,(r=this.hls).trigger(l.Events.FPS_DROP,{currentDropped:s,currentDecoded:n,totalDroppedFrames:i}),0<a)&&s>r.config.fpsDroppedMonitoringThreshold*n&&(a=r.currentLevel,d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),0<a)&&(-1===r.autoLevelCapping||r.autoLevelCapping>=a)&&(r.trigger(l.Events.FPS_DROP_LEVEL_CAPPING,{level:a-=1,droppedLevel:r.currentLevel}),r.autoLevelCapping=a,this.streamController.nextLevelSwitch()),this.lastTime=o,this.lastDroppedFrames=i,this.lastDecodedFrames=e)},e.checkFPSInterval=t}()},"./src/controller/fragment-finders.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"findFragmentByPDT",function(){return s}),i.d(e,"findFragmentByPTS",function(){return n}),i.d(e,"fragmentWithinToleranceTest",function(){return o}),i.d(e,"pdtWithinToleranceTest",function(){return l}),i.d(e,"findFragWithCC",function(){return d});var a=i("./src/polyfills/number.ts"),r=i("./src/utils/binary-search.ts");function s(t,e,i){if(null!==e&&Array.isArray(t)&&t.length&&Object(a.isFiniteNumber)(e)){var s=t[0].programDateTime;if(!(e<(s||0))){s=t[t.length-1].endProgramDateTime;if(!((s||0)<=e)){i=i||0;for(var n=0;n<t.length;++n){var r=t[n];if(l(e,i,r))return r}}}}return null}function n(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=0);var n=null;return t?n=e[t.sn-e[0].sn+1]||null:0===i&&0===e[0].start&&(n=e[0]),(!n||0!==o(i,s,n))&&r.default.search(e,o.bind(null,i,s))||n}./src/controller/fragment-tracker.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"FragmentState",function(){return s}),i.d(e,"FragmentTracker",function(){return r});var s,n=i("./src/events.ts"),o=i("./src/types/loader.ts"),r=((e=s=s||{}).NOT_LOADED="NOT_LOADED",e.BACKTRACKED="BACKTRACKED",e.APPENDING="APPENDING",e.PARTIAL="PARTIAL",e.OK="OK",function(){ar e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.on(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(n.Events.FRAG_LOADED,this.onFragLoaded,this)},e._unregisterListeners=e.destroy=e.getAppendedFrag=e.getBufferedFrag=e.detectEvictedFragments=e.detectPartialFragments=function(t){var s,n=this,r=this.timeRanges,a=t.frag,o=t.part;r&&"initSegment"!==a.sn&&(t=d(a),s=this.fragments[t])&&(Object.keys(r).forEach(,s.backtrack=s.loaded=null,Object.keys(s.range).length?s.buffered=!0:this.removeFragment(s.body))},e.fragBuffered=e.getBufferedTimes=e.getPartialFragment=function(e){var i,s,n=null,r=0,a=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(t){t=o[t];t&&l(t)&&(i=t.body.start-a,s=t.body.end+a,i<=e)&&e<=s&&(i=Math.min(e-i,s-e),r<=i)&&(n=t.body,r=i)}),n},e.getState=e.backtrack=function(t,e){t=d(t),t=this.fragments[t];return!t||t.backtrack?null:(e=t.backtrack=e||t.loaded,t.loaded=null,e)},e.getBacktrackData=function(t){var e=d(t),e=this.fragments[e];if(e){var i,e=e.backtrack;if(null!=e&&null!=(i=e.payload)&&i.byteLength)return e;this.removeFragment(t)}return null},e.isTimeBuffered=e.onFragLoaded=e.onBufferAppended=e.onFragBuffered=e.hasFragment=e.removeFragmentsInRange=function(e,i,s){var n=this;Object.keys(this.fragments).forEach(function(t){var t=n.fragments[t];t&&t.buffered&&(t=t.body).type===s&&t.start<i&&t.end>e&&n.removeFragment(t)})},e.removeFragment=e.removeAllFragments=t}());function l(t){var e;return t.buffered&&(null!=(e=t.range.video)&&e.partial||null!=(e=t.range.audio)&&e.partial)},"./src/controller/gap-controller.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"STALL_MINIMUM_DURATION_MS",function(){return g}),i.d(e,"MAX_START_GAP_JUMP",function(){return p}),i.d(e,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return v}),i.d(e,"SKIP_BUFFER_RANGE_START",function(){return f}),i.d(e,"default",function(){return s});var d=i("./src/utils/buffer-helper.ts"),u=i("./src/errors.ts"),h=i("./src/events.ts"),c=i("./src/utils/logger.ts"),g=250,p=2,v=.1,f=.05,s=function(){ar e=t.prototype;return e.destroy=e.poll=function(t){var e=this.config,i=this.media,s=this.stalled,n=i.currentTime,r=i.seeking,a=this.seeking&&!r,o=!this.seeking&&r;if(this.seeking=r,n!==t)this.moved=!0,null!==s&&(this.stallReported&&(t=self.performance.now()-s,c.logger.warn("playback not stuck anymore @"+n+", after "+Math.round(t)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0);else if((o||a)&&(this.stalled=null),!i.paused&&!i.ended&&0!==i.playbackRate&&d.BufferHelper.getBuffered(i).length){t=d.BufferHelper.bufferInfo(i,n,0),o=0<t.len,a=t.nextStart||0;if(o||a){if(r){var o=t.len>p,l=!a||p<a-n&&!this.fragmentTracker.getPartialFragment(n);if(o||l)return;this.moved=!1}if(!this.moved&&null!==this.stalled){o=Math.max(a,t.start||0)-n,l=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,a=(null==l||null==(a=l.details)?void 0:a.live)?2*l.details.targetduration:p;if(0<o&&o<=a)return void this._trySkipBufferHole(null)}l=self.performance.now();null===s?this.stalled=l:(o=l-s,!r&&g<=o&&this._reportStall(t.len),a=d.BufferHelper.bufferInfo(i,n,e.maxBufferHole),this._tryFixBufferStall(a,o))}}},e._tryFixBufferStall=e._reportStall=e._trySkipBufferHole=e._tryNudgeBuffer=t}()},"./src/controller/id3-track-controller.ts":function(t,e,i){"use strict";i.r(e);var s=i("./src/events.ts"),n=i("./src/utils/texttrack-utils.ts"),c=i("./src/demux/id3.ts");e.default=function(){ar e=t.prototype;return e.destroy=function(){this._unregisterListeners()},e._registerListeners=function(){var t=this.hls;t.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(s.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e._unregisterListeners=e.onMediaAttached=function(t,e){this.media=e.media},e.onMediaDetaching=e.getID3Track=e.onFragParsingMetadata=function(t,e){if(this.media)for(var i=e.frag,s=e.samples,n=(this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden"),self.WebKitDataCue||self.VTTCue||self.TextTrackCue),r=0;r<s.length;r++){var a=c.getID3Frames(s[r].data);if(a){var o=s[r].pts,l=r<s.length-1?s[r+1].pts:i.end;l-o<=0&&(l=o+.25);for(var d=0;d<a.length;d++){var u,h=a[d];c.isTimeStampFrame(h)||((u=new n(o,l,"")).value=h,this.id3Track.addCue(u))}}}},e.onBufferFlushing=t}()},"./src/controller/latency-controller.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s});var n=i("./src/errors.ts"),r=i("./src/events.ts"),a=i("./src/utils/logger.ts");function o(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var s=function(){ar e,i,s=t.prototype;return s.destroy=s.registerListeners=s.unregisterListeners=s.onMediaAttached=s.onMediaDetaching=s.onManifestLoading=s.onLevelUpdated=s.onError=s.timeupdate=function(){var t,e,i,s=this.media,n=this.levelDetails;s&&n&&(this.currentTime=s.currentTime,null!==(e=this.computeLatency()))&&(this._latency=e,i=(t=this.config).lowLatencyMode,t=t.maxLiveSyncPlaybackRate,i)&&1!==t&&null!==(i=this.targetLatency)&&(e=e-i,i=Math.min(this.maxLatency,i+n.targetduration),n.live&&e<i&&.05<e&&1<this.forwardBufferLength?(n=Math.min(2,Math.max(1,t)),i=Math.round(2/(1+Math.exp(-.75*e-this.edgeStalled))*20)/20,s.playbackRate=Math.min(n,Math.max(1,i))):1!==s.playbackRate&&0!==s.playbackRate&&(s.playbackRate=1))},s.estimateLiveEdge=s.computeLatency=s=t,(e=[{key:"latency",get:,{key:"maxLatency",get:,{key:"targetLatency",get:function(){var t,e,i,s,n,r=this.levelDetails;return null===r?null:(t=r.holdBack,s=r.partHoldBack,r=r.targetduration,e=(n=this.config).liveSyncDuration,i=n.liveSyncDurationCount,n=n.lowLatencyMode&&s||t,(n=(s=this.hls.userConfig).liveSyncDuration||s.liveSyncDurationCount||0===n?void 0!==e?e:i*r:n)+Math.min(+this.stallCount,r))}},{key:"liveSyncPosition",get:function(){var t,e=this.estimateLiveEdge(),i=this.targetLatency,s=this.levelDetails;return null===e||null===i||null===s?null:(t=s.edge,e=e-i-this.edgeStalled,i=t-s.totalduration,t=t-(this.config.lowLatencyMode&&s.partTarget||s.targetduration),Math.min(Math.max(i,e),t))}},{key:"drift",get:,{key:"edgeStalled",get:function(){var t,e=this.levelDetails;return null===e?0:(t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration),Math.max(e.age-t,0))}},{key:"forwardBufferLength",get:function(){var t,e=this.media,i=this.levelDetails;return e&&i?(t=e.buffered.length)?e.buffered.end(t-1):i.edge-this.currentTime:0}}])&&o(s.prototype,e),i&&o(s,i),t}()},"./src/controller/level-controller.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s});var g=i("./src/types/level.ts"),p=i("./src/events.ts"),v=i("./src/errors.ts"),f=i("./src/utils/codecs.ts"),E=i("./src/controller/level-helper.ts"),e=i("./src/controller/base-playlist-controller.ts"),l=i("./src/types/loader.ts");function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(this,arguments)}function r(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),s=function(o){=o,(s=t).prototype=Object.create(e.prototype),a(s.prototype.constructor=s,e);var e,i,s=t.prototype;return s._registerListeners=function(){var t=this.hls;t.on(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(p.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(p.Events.ERROR,this.onError,this)},s._unregisterListeners=s.destroy=s.startLoad=s.onManifestLoaded=function(t,e){var i,s,n=[],r=[],a=[],o={},l=!1,d=!1,u=!1;if(e.levels.forEach(function(t){var e=t.attrs,i=(l=l||!(!t.width||!t.height),d=d||!!t.videoCodec,u=u||!!t.audioCodec,_&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS);(s=o[i])?s.url.push(t.url):(s=new g.Level(t),o[i]=s,n.push(s)),e&&(e.AUDIO&&Object(E.addGroupId)(s,"audio",e.AUDIO),e.SUBTITLES)&&Object(E.addGroupId)(s,"text",e.SUBTITLES)}),n=(n=(l||d)&&u?n.filter(:n).filter(,e.audioTracks&&(r=e.audioTracks.filter(,Object(E.assignTrackIdsByGroup)(r)),e.subtitles&&(a=e.subtitles,Object(E.assignTrackIdsByGroup)(a)),0<n.length){i=n[0].bitrate,n.sort(,this._levels=n;for(var h=0;h<n.length;h++)if(n[h].bitrate===i){this._firstLevel=h,this.log("manifest loaded, "+n.length+" level(s) found, first bitrate: "+i);break}var c=u&&!d,a={levels:n,audioTracks:r,subtitleTracks:a,firstLevel:this._firstLevel,stats:e.stats,audio:u,video:d,altAudio:!c&&r.some(};this.hls.trigger(p.Events.MANIFEST_PARSED,a),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(p.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},s.onError=function(t,e){if(o.prototype.onError.call(this,t,e),!e.fatal){var i=e.context,t=this._levels[this.currentLevelIndex];if(i&&(i.type===l.PlaylistContextType.AUDIO_TRACK&&t.audioGroupIds&&i.groupId===t.audioGroupIds[t.urlId]||i.type===l.PlaylistContextType.SUBTITLE_TRACK&&t.textGroupIds&&i.groupId===t.textGroupIds[t.urlId]))this.redundantFailover(this.currentLevelIndex);else{var s,n,r=!1,a=!0;switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:e.frag&&(!(n=this._levels[e.frag.level])||(n.fragmentError++,n.fragmentError>this.hls.config.fragLoadingMaxRetry))&&(s=e.frag.level);break;case v.ErrorDetails.LEVEL_LOAD_ERROR:case v.ErrorDetails.LEVEL_LOAD_TIMEOUT:i&&(i.deliveryDirectives&&(a=!1),s=i.level),r=!0;break;case v.ErrorDetails.REMUX_ALLOC_ERROR:s=e.level,r=!0}void 0!==s&&this.recoverLevel(e,s,r,a)}}},s.recoverLevel=function(t,e,i,s){var n=t.details,r=this._levels[e];if(r.loadError++,i){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}s&&(1<(i=r.url.length)&&r.loadError<i?(t.levelRetry=!0,this.redundantFailover(e)):-1===this.manualLevelIndex&&(s=0===e?this._levels.length-1:e-1,this.currentLevelIndex!==s)&&0===this._levels[s].loadError&&(this.warn(n+": switch to "+s),t.levelRetry=!0,this.hls.nextAutoLevel=s))},s.redundantFailover=s.onFragLoaded=function(t,e){var e=e.frag;void 0!==e&&e.type===l.PlaylistLevelType.MAIN&&void 0!==(e=this._levels[e.level])&&(e.fragmentError=0,e.loadError=0)},s.onLevelLoaded=function(t,e){var i=e.level,s=e.details,n=this._levels[i];n?i===this.currentLevelIndex?(0===n.fragmentError&&(n.loadError=0,this.retryCount=0),this.playlistLoaded(i,e,n.details)):null!=(n=e.deliveryDirectives)&&n.skip&&(s.deltaUpdateFailed=!0):(this.warn("Invalid level index "+i),null!=(n=e.deliveryDirectives)&&n.skip&&(s.deltaUpdateFailed=!0))},s.onAudioTrackSwitched=s.loadPlaylist=s.removeLevel=e=t,(s=[{key:"levels",get:,{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;if(0!==e.length&&(this.currentLevelIndex!==t||null==(i=e[t])||!i.details)){if(t<0||t>=e.length){var i=t<0;if(this.hls.trigger(p.Events.ERROR,{type:v.ErrorTypes.OTHER_ERROR,details:v.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:i,reason:"invalid level idx"}),i)return;t=Math.min(t,e.length-1)}this.clearTimer();var i=this.currentLevelIndex,s=e[i],e=e[t],i=(this.log("switching to level "+t+" from "+i),n({},e,{level:this.currentLevelIndex=t,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId})),t=(delete i._urlId,this.hls.trigger(p.Events.LEVEL_SWITCHING,i),e.details);t&&!t.live||(i=this.switchParams(e.uri,null==s?void 0:s.details),this.loadPlaylist(i))}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:,{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){var t;return void 0===this._startLevel?void 0!==(t=this.hls.config.startLevel)?t:this._firstLevel:this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:set:])&&r(e.prototype,s),i&&r(e,i),t}(e.default)},"./src/controller/level-helper.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"addGroupId",function(){return s}),i.d(e,"assignTrackIdsByGroup",function(){return n}),i.d(e,"updatePTS",function(){return r}),i.d(e,"updateFragPTSDTS",function(){return f}),i.d(e,"mergeDetails",function(){return a}),i.d(e,"mapPartIntersection",function(){return E}),i.d(e,"mapFragmentIntersection",function(){return _}),i.d(e,"adjustSliding",function(){return m}),i.d(e,"addSliding",function(){return o}),i.d(e,"computeReloadInterval",function(){return l}),i.d(e,"getFragmentWithSN",function(){return d}),i.d(e,"getPartWith",function(){return u});var g=i("./src/polyfills/number.ts"),p=i("./src/utils/logger.ts");tion f(t,e,i,s,n,r){s-i<=0&&(p.logger.warn("Fragment should have a positive duration",e),s=i+e.duration,r=n+e.duration);var a,o=i,l=s,d=e.startPTS,u=e.endPTS,h=(Object(g.isFiniteNumber)(d)&&(h=Math.abs(d-i),Object(g.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(h,e.deltaPTS):e.deltaPTS=h,o=Math.max(i,d),i=Math.min(i,d),n=Math.min(n,e.startDTS),l=Math.min(s,u),s=Math.max(s,u),r=Math.max(r,e.endDTS)),e.duration=s-i,i-e.start),d=(e.appendedPTS=s,e.start=e.startPTS=i,e.maxStartPTS=o,e.startDTS=n,e.endPTS=s,e.minEndPTS=l,e.endDTS=r,e.sn);if(!t||d<t.startSN||d>t.endSN)return 0;var u=d-t.startSN,c=t.fragments;for(c[u]=e,a=u;0<a;a--)v(c[a],c[a-1]);for(a=u;a<c.length-1;a++)v(c[a],c[a+1]);return t.fragmentHint&&v(c[c.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,h}function a(t,i){for(var s=null,e=t.fragments,n=e.length-1;0<=n;n--){var r=e[n].initSegment;if(r){s=r;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var a,o=0;if(_(t,i,function(t,e){t.relurl&&(o=t.cc-e.cc),Object(g.isFiniteNumber)(t.startPTS)&&Object(g.isFiniteNumber)(t.endPTS)&&(e.start=e.startPTS=t.startPTS,e.startDTS=t.startDTS,e.appendedPTS=t.appendedPTS,e.maxStartPTS=t.maxStartPTS,e.endPTS=t.endPTS,e.endDTS=t.endDTS,e.minEndPTS=t.minEndPTS,e.duration=t.endPTS-t.startPTS,e.duration&&(a=e),i.PTSKnown=i.alignedSliding=!0),e.elementaryStreams=t.elementaryStreams,e.loader=t.loader,e.stats=t.stats,e.urlId=t.urlId,t.initSegment?(e.initSegment=t.initSegment,s=t.initSegment):e.initSegment&&e.initSegment.relurl!=(null==(t=s)?void 0:t.relurl)||(e.initSegment=s)}),i.skippedSegments&&(i.deltaUpdateFailed=i.fragments.some(,i.deltaUpdateFailed)){p.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var l=i.skippedSegments;l--;)i.fragments.shift();i.startSN=i.fragments[0].sn,i.startCC=i.fragments[0].cc}var d=i.fragments;if(o){p.logger.warn("discontinuity sliding from playlist, take drift into account");for(var u=0;u<d.length;u++)d[u].cc+=o}i.skippedSegments&&(i.startCC=i.fragments[0].cc),E(t.partList,i.partList,,a?f(i,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):m(t,i),d.length&&(i.totalduration=i.edge-d[0].start),i.driftStartTime=t.driftStartTime,i.driftStart=t.driftStart;var h,c=i.advancedDateTime;i.advanced&&c?(h=i.edge,i.driftStart||(i.driftStartTime=c,i.driftStart=h),i.driftEndTime=c,i.driftEnd=h):(i.driftEndTime=t.driftEndTime,i.driftEnd=t.driftEnd,i.advancedDateTime=t.advancedDateTime)}ion d(t,e,i){var s;return t&&t.details?(s=(t=t.details).fragments[e-t.startSN])||((s=t.fragmentHint)&&s.sn===e?s:e<t.startSN&&i&&i.sn===e?i:null):null}function u(t,e,i){if(t&&t.details){var s=t.details.partList;if(s)for(var n=s.length;n--;){var r=s[n];if(r.index===i&&r.fragment.sn===e)return r}}return null}},"./src/controller/stream-controller.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s});var p=i("./src/polyfills/number.ts"),v=i("./src/controller/base-stream-controller.ts"),a=i("./src/is-supported.ts"),f=i("./src/events.ts"),n=i("./src/utils/buffer-helper.ts"),o=i("./src/controller/fragment-tracker.ts"),h=i("./src/types/loader.ts"),E=i("./src/loader/fragment.ts"),c=i("./src/demux/transmuxer-interface.ts"),g=i("./src/types/transmuxer.ts"),l=i("./src/controller/gap-controller.ts"),d=i("./src/errors.ts"),u=i("./src/utils/logger.ts");function _(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var s=function(r){=r,(s=t).prototype=Object.create(e.prototype),m(s.prototype.constructor=s,e);var e,i,s=t.prototype;return s._registerListeners=s._unregisterListeners=s.onHandlerDestroying=s.startLoad=s.stopLoad=s.doTick=function(){switch(this.state){case v.State.IDLE:this.doTickIdle();break;case v.State.WAITING_LEVEL:var t=this.levels,e=this.level,e=null==t||null==(t=t[e])?void 0:t.details;!e||e.live&&this.levelLastLoaded!==this.level||this.waitForCdnTuneIn(e)||(this.state=v.State.IDLE);break;case v.State.FRAG_LOADING_WAITING_RETRY:t=self.performance.now(),e=this.retryDate;(!e||e<=t||null!=(e=this.media)&&e.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=v.State.IDLE)}this.onTickEnd()},s.onTickEnd=s.doTickIdle=function(){var t=this.hls,e=this.levelLastLoaded,i=this.levels,s=this.media,n=t.config,r=t.nextLoadLevel;null===e||!(s||!this.startFragRequested&&n.startFragPrefetch)||this.altAudio&&this.audioOnly||i&&i[r]&&(e=i[r],this.level=t.nextLoadLevel=r,!(n=e.details)||this.state===v.State.WAITING_LEVEL||n.live&&this.levelLastLoaded!==r?this.state=v.State.WAITING_LEVEL:null===(i=this.getFwdBufferInfo(this.mediaBuffer||s,h.PlaylistLevelType.MAIN))||(t=i.len,this.getMaxBufferLength(e.maxBitrate)<=t)||(this._streamEnded(i,n)?(r={},this.altAudio&&(r.type="video"),this.hls.trigger(f.Events.BUFFER_EOS,r),this.state=v.State.ENDED):(e=i.end,t=this.getNextFragment(e,n),this.couldBacktrack&&!this.fragPrevious&&t&&"initSegment"!==t.sn&&1<(r=t.sn-n.startSN)&&(t=n.fragments[r-1],this.fragmentTracker.removeFragment(t)),t&&this.fragmentTracker.getState(t)===o.FragmentState.OK&&this.nextLoadPosition>e&&(i=this.audioOnly&&!this.altAudio?E.ElementaryStreamTypes.AUDIO:E.ElementaryStreamTypes.VIDEO,this.afterBufferFlushed(s,i,h.PlaylistLevelType.MAIN),t=this.getNextFragment(this.nextLoadPosition,n)),t&&("identity"!==(null==(r=(t=!t.initSegment||t.initSegment.data||this.bitrateTest?t:t.initSegment).decryptdata)?void 0:r.keyFormat)||null!=(s=t.decryptdata)&&s.key?this.loadFragment(t,n,e):this.loadKey(t,n)))))},s.loadFragment=function(t,e,i){var s=this.fragmentTracker.getState(t);if(this.fragCurrent=t,s===o.FragmentState.BACKTRACKED){var n=this.fragmentTracker.getBacktrackData(t);if(n)return this._handleFragmentLoadProgress(n),void this._handleFragmentLoadComplete(n);s=o.FragmentState.NOT_LOADED}s===o.FragmentState.NOT_LOADED||s===o.FragmentState.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t):this.bitrateTest?(t.bitrateTest=!0,this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,r.prototype.loadFragment.call(this,t,e,i)):s===o.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null==(n=this.media)?void 0:n.buffered.length)&&this.fragmentTracker.removeAllFragments()},s.getAppendedFrag=s.getBufferedFrag=s.followingBufferedFrag=s.immediateLevelSwitch=s.nextLevelSwitch=function(){var t,e=this.levels,i=this.media;null!=i&&i.readyState&&((t=this.getAppendedFrag(i.currentTime))&&1<t.start&&this.flushMainBuffer(0,t.start-1),t=!i.paused&&e&&(t=e[this.hls.nextLoadLevel],e=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*e)+1:0,e=this.getBufferedFrag(i.currentTime+t))&&(i=this.followingBufferedFrag(e))&&(this.abortCurrentFrag(),t=i.maxStartPTS||i.start,i=i.duration,e=Math.max(e.end,t+Math.min(Math.max(i-this.config.maxFragLookUpTolerance,.5*i),.75*i)),this.flushMainBuffer(e,Number.POSITIVE_INFINITY))},s.abortCurrentFrag=s.flushMainBuffer=s.onMediaAttached=s.onMediaDetaching=s.onMediaPlaying=s.onMediaSeeked=s.onManifestLoading=s.onManifestParsed=function(t,e){var i,s=!1,n=!1;e.levels.forEach(function(t){(i=t.audioCodec)&&(-1!==i.indexOf("mp4a.40.2")&&(s=!0),-1!==i.indexOf("mp4a.40.5"))&&(n=!0)}),this.audioCodecSwitch=s&&n&&!Object(a.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},s.onLevelLoading=function(t,e){var i=this.levels;i&&this.state===v.State.IDLE&&(!(i=i[e.level]).details||i.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(i.details))&&(this.state=v.State.WAITING_LEVEL)},s.onLevelLoaded=function(t,e){var i=this.levels,s=e.level,n=e.details,r=n.totalduration;if(i){this.log("Level "+s+" loaded ["+n.startSN+","+n.endSN+"], cc ["+n.startCC+", "+n.endCC+"] duration:"+r);r=this.fragCurrent,e=(!r||this.state!==v.State.FRAG_LOADING&&this.state!==v.State.FRAG_LOADING_WAITING_RETRY||r.level!==e.level&&r.loader&&(this.state=v.State.IDLE,r.loader.abort()),i[s]),r=0;if(n.live||null!=(i=e.details)&&i.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;r=this.alignPlaylists(n,e.details)}if(e.details=n,this.levelLastLoaded=s,this.hls.trigger(f.Events.LEVEL_UPDATED,{details:n,level:s}),this.state===v.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(n))return;this.state=v.State.IDLE}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,r),this.tick()}else this.warn("Levels were reset while loading level "+s)},s._handleFragmentLoadProgress=function(t){var e,i,s,n,r,a,o,l=t.frag,d=t.part,t=t.payload,u=this.levels;u?(e=(u=u[l.level]).details)?(i=u.videoCodec,s=e.PTSKnown||!e.live,n=null==(n=l.initSegment)?void 0:n.data,u=this._getAudioCodec(u),r=this.transmuxer=this.transmuxer||new c.default(this.hls,h.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),a=d?d.index:-1,a=new g.ChunkMetadata(l.level,l.sn,l.stats.chunkCount,t.byteLength,a,-1!==a),o=this.initPTS[l.cc],r.push(t,n,u,i,l,d,e.totalduration,s,a,o)):this.warn("Dropping fragment "+l.sn+" of level "+l.level+" after level details were reset"):this.warn("Levels were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered")},s.onAudioTrackSwitching=function(t,e){var i=this.altAudio,s=!!e.url,e=e.id;s||(this.mediaBuffer!==this.media?(this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,null!=(s=this.fragCurrent)&&s.loader&&(this.log("Switching to main audio track, cancel main fragment load"),s.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()):this.audioOnly&&this.resetTransmuxer(),s=this.hls,i&&s.trigger(f.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),s.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:e}))},s.onAudioTrackSwitched=function(t,e){var i,e=e.id,e=!!this.hls.audioTracks[e].url;e&&(i=this.videoBuffer)&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i),this.altAudio=e,this.tick()},s.onBufferCreated=function(t,e){var i,s=e.tracks,n=!1;for(i in s){var r,a,o=s[i];"main"===o.id?(a=o,"video"===(r=i)&&(o=s[i])&&(this.videoBuffer=o.buffer)):n=!0}n&&a?(this.log("Alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media},s.onFragBuffered=function(t,e){var i,s=e.frag,e=e.part;s&&s.type!==h.PlaylistLevelType.MAIN||(this.fragContextChanged(s)?(this.warn("Fragment "+s.sn+(e?" p: "+e.index:"")+" of level "+s.level+" finished buffering, but was aborted. state: "+this.state),this.state===v.State.PARSED&&(this.state=v.State.IDLE)):(i=(e||s).stats,this.fragLastKbps=Math.round(8*i.total/(i.buffering.end-i.loading.first)),"initSegment"!==s.sn&&(this.fragPrevious=s),this.fragBufferedComplete(s,e)))},s.onError=s.checkBuffer=s.onFragLoadEmergencyAborted=s.onBufferFlushed=function(t,e){var i,e=e.type;(e!==E.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&(i=(e===E.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,this.afterBufferFlushed(i,e,h.PlaylistLevelType.MAIN))},s.onLevelsUpdated=function(t,e){this.levels=e.levels},s.swapAudioCodec=s.seekToStartPos=function(){var t,e=this.media,i=e.currentTime,s=this.startPosition;0<=s&&i<s&&(e.seeking?u.logger.log("could not seek to "+s+", already seeking at "+i):(0<(t=((t=n.BufferHelper.getBuffered(e)).length?t.start(0):0)-s)&&t<this.config.maxBufferHole&&(u.logger.log("adjusting start position by "+t+" to match buffer start"),this.startPosition=s+=t),this.log("seek to target start position "+s+" from current time "+i),e.currentTime=s))},s._getAudioCodec=s._loadBitrateTestFrag=s._handleTransmuxComplete=function(t){var e="main",i=this.hls,s=t.remuxResult,t=t.chunkMeta,n=this.getCurrentContext(t);if(n){var r=n.frag,a=n.part,n=n.level,o=s.video,l=s.text,d=s.id3,u=s.initSegment,h=this.altAudio?void 0:s.audio;if(!this.fragContextChanged(r)){if(this.state=v.State.PARSING,u&&(u.tracks&&(this._bufferInitSegment(n,u.tracks,r,t),i.trigger(f.Events.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:e,tracks:u.tracks})),c=u.initPTS,u=u.timescale,Object(p.isFiniteNumber)(c))&&(this.initPTS[r.cc]=c,i.trigger(f.Events.INIT_PTS_FOUND,{frag:r,id:e,initPTS:c,timescale:u})),o&&!1!==s.independent){if(n.details){var c=o.startPTS,u=o.endPTS,n=o.startDTS,g=o.endDTS;if(a)a.elementaryStreams[o.type]={startPTS:c,endPTS:u,startDTS:n,endDTS:g};else if(o.firstKeyFrame&&o.independent&&(this.couldBacktrack=!0),o.dropped&&o.independent){if(this.getLoadPosition()+this.config.maxBufferHole<c)return void this.backtrack(r);r.setElementaryStreamInfo(o.type,r.start,u,r.start,g,!0)}r.setElementaryStreamInfo(o.type,c,u,n,g),this.bufferFragmentData(o,r,a,t)}}else if(!1===s.independent)return void this.backtrack(r);h&&(c=h.startPTS,u=h.endPTS,n=h.startDTS,g=h.endDTS,a&&(a.elementaryStreams[E.ElementaryStreamTypes.AUDIO]={startPTS:c,endPTS:u,startDTS:n,endDTS:g}),r.setElementaryStreamInfo(E.ElementaryStreamTypes.AUDIO,c,u,n,g),this.bufferFragmentData(h,r,a,t)),null!=d&&null!=(o=d.samples)&&o.length&&(s={frag:r,id:e,samples:d.samples},i.trigger(f.Events.FRAG_PARSING_METADATA,s)),l&&(c={frag:r,id:e,samples:l.samples},i.trigger(f.Events.FRAG_PARSING_USERDATA,c))}}else this.warn("The loading context changed while buffering fragment "+t.sn+" of level "+t.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(t.level)},s._bufferInitSegment=function(t,i,s,n){var e,r,a,o,l,d=this;this.state===v.State.PARSING&&(this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio,e=i.audio,r=i.video,a=i.audiovideo,e&&(o=t.audioCodec,l=navigator.userAgent.toLowerCase(),this.audioCodecSwitch&&(o=o&&(-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==e.metadata.channelCount)&&-1===l.indexOf("firefox")&&(o="mp4a.40.5"),-1!==l.indexOf("android")&&"audio/mpeg"!==e.container&&this.log("Android: force audio codec to "+(o="mp4a.40.2")),t.audioCodec&&t.audioCodec!==o&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+o+'"'),e.levelCodec=o,e.id="main",this.log("Init audio buffer, container:"+e.container+", codecs[selected/level/parsed]=["+(o||"")+"/"+(t.audioCodec||"")+"/"+e.codec+"]")),r&&(r.levelCodec=t.videoCodec,r.id="main",this.log("Init video buffer, container:"+r.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+r.codec+"]")),a&&this.log("Init audiovideo buffer, container:"+a.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+a.codec+"]"),this.hls.trigger(f.Events.BUFFER_CODECS,i),Object.keys(i).forEach(,this.tick())},s.backtrack=s.checkFragmentChanged=function(){var t,e=this.media,i=null;e&&1<e.readyState&&!1===e.seeking&&(t=e.currentTime,n.BufferHelper.isBuffered(e,t)?i=this.getAppendedFrag(t):n.BufferHelper.isBuffered(e,t+.1)&&(i=this.getAppendedFrag(t+.1)),i)&&(e=this.fragPlaying,t=i.level,e&&i.sn===e.sn&&e.level===t&&i.urlId===e.urlId||(this.hls.trigger(f.Events.FRAG_CHANGED,{frag:i}),e&&e.level===t||this.hls.trigger(f.Events.LEVEL_SWITCHED,{level:t}),this.fragPlaying=i))},e=t,(s=[{key:"nextLevel",get:,{key:"currentLevel",get:,{key:"nextBufferedFrag",get:,{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&_(e.prototype,s),i&&_(e,i),t}(v.default)},"./src/controller/subtitle-stream-controller.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"SubtitleStreamController",function(){return s});var l=i("./src/events.ts"),d=i("./src/utils/logger.ts"),u=i("./src/utils/buffer-helper.ts"),h=i("./src/controller/fragment-finders.ts"),a=i("./src/utils/discontinuities.ts"),o=i("./src/controller/level-helper.ts"),c=i("./src/controller/fragment-tracker.ts"),g=i("./src/controller/base-stream-controller.ts"),p=i("./src/types/loader.ts"),r=i("./src/types/level.ts");function v(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var s=function(s){=s,(n=t).prototype=Object.create(e.prototype),f(n.prototype.constructor=n,e);var e,i,n=t.prototype;return n.onHandlerDestroying=n._registerListeners=function(){var t=this.hls;t.on(l.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(l.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(l.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(l.Events.ERROR,this.onError,this),t.on(l.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(l.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(l.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(l.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(l.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},n._unregisterListeners=n.startLoad=n.onManifestLoading=n.onLevelLoaded=function(t,e){this.mainDetails=e.details},n.onSubtitleFragProcessed=n.onBufferFlushing=function(t,e){var i,s,n,r=e.startOffset,a=e.endOffset;0===r&&a!==Number.POSITIVE_INFINITY&&(i=this.currentTrackId,(s=this.levels).length)&&s[i]&&s[i].details&&((n=a-s[i].details.targetduration)<=0||(e.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(,this.fragmentTracker.removeFragmentsInRange(r,n,p.PlaylistLevelType.SUBTITLE)))},n.onError=function(t,e){var e=e.frag;e&&e.type===p.PlaylistLevelType.SUBTITLE&&(null!=(e=this.fragCurrent)&&e.loader&&this.fragCurrent.loader.abort(),this.state=g.State.IDLE)},n.onSubtitleTracksUpdated=n.onSubtitleTrackSwitch=function(t,e){this.currentTrackId=e.id,this.levels.length&&-1!==this.currentTrackId?null!=(e=this.levels[this.currentTrackId])&&e.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null:this.clearInterval()},n.onSubtitleTrackLoaded=function(t,e){var i=e.details,e=e.id,s=this.currentTrackId,n=this.levels;if(n.length){var r=n[s];if(!(e>=n.length||e!==s)&&r){if(this.mediaBuffer=this.mediaBufferTimeRanges,i.live||null!=(n=r.details)&&n.live){s=this.mainDetails;if(i.deltaUpdateFailed||!s)return;n=s.fragments[0];r.details?0===this.alignPlaylists(i,r.details)&&n&&Object(o.addSliding)(i,n.start):i.hasProgramDateTime&&s.hasProgramDateTime?Object(a.alignPDT)(i,s):n&&Object(o.addSliding)(i,n.start)}r.details=i,this.levelLastLoaded=e,this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===g.State.IDLE&&!Object(h.findFragmentByPTS)(null,i.fragments,this.media.currentTime,0)&&(this.warn("Subtitle playlist not aligned with playback"),r.details=void 0)}}},n._handleFragmentLoadComplete=n.doTick=function(){var t,e,i,s,n,r,a,o;this.media?this.state===g.State.IDLE&&(s=this.currentTrackId,(t=this.levels).length)&&t[s]&&t[s].details&&(s=(t=t[s].details).targetduration,e=this.config,n=this.media,i=(n=u.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,n.currentTime-s,e.maxBufferHole)).end,n=n.len,this.getMaxBufferLength()+s<n||(console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick"),n=(s=t.fragments).length,o=t.edge,a=this.fragPrevious,i<o?(o=e.maxFragLookUpTolerance,(r=a&&t.hasProgramDateTime?Object(h.findFragmentByPDT)(s,a.endProgramDateTime,o):r)||!(r=Object(h.findFragmentByPTS)(a,s,i,o))&&a&&a.start<s[0].start&&(r=s[0])):r=s[n-1],null!=(e=r)&&e.encrypted?(d.logger.log("Loading key for "+r.sn),this.state=g.State.KEY_LOADING,this.hls.trigger(l.Events.KEY_LOADING,{frag:r})):r&&this.fragmentTracker.getState(r)===c.FragmentState.NOT_LOADED&&this.loadFragment(r,t,i))):this.state=g.State.IDLE},n.loadFragment=e=t,(n=[{key:"mediaBufferTimeRanges",get:])&&v(e.prototype,n),i&&v(e,i),t}(g.default)},"./src/controller/subtitle-track-controller.ts":function(t,e,i){"use strict";i.r(e);var l=i("./src/events.ts"),r=i("./src/utils/texttrack-utils.ts"),s=i("./src/controller/base-playlist-controller.ts"),a=i("./src/types/loader.ts");function(i){=i,(n=t).prototype=Object.create(e.prototype),d(n.prototype.constructor=n,e);var e,s,n=t.prototype;return n.destroy=n.registerListeners=function(){var t=this.hls;t.on(l.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(l.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(l.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(l.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(l.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(l.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(l.Events.ERROR,this.onError,this)},n.unregisterListeners=n.onMediaAttached=n.pollTrackChange=n.onMediaDetaching=n.onManifestLoading=n.onManifestParsed=n.onSubtitleTrackLoaded=function(t,e){var i,s=e.id,n=e.details,r=this.trackId,r=this.tracksInGroup[r];r?(i=r.details,r.details=e.details,this.log("subtitle track "+s+" loaded ["+n.startSN+"-"+n.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,e,i))):this.warn("Invalid subtitle track id "+s)},n.onLevelLoading=function(t,e){this.switchLevel(e.level)},n.onLevelSwitching=n.switchLevel=function(t){var e,i,s,n,t=this.hls.levels[t];null!=t&&t.textGroupIds&&(e=t.textGroupIds[t.urlId],this.groupId!==e)&&(t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,i=this.tracks.filter(,this.tracksInGroup=i,s=this.findTrackId(null==t?void 0:t.name)||this.findTrackId(),this.groupId=e,n={subtitleTracks:i},this.log("Updating subtitle tracks, "+i.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(l.Events.SUBTITLE_TRACKS_UPDATED,n),-1!==s)&&this.setSubtitleTrack(s,t)},n.findTrackId=n.onError=n.loadPlaylist=n.toggleTrackModes=function(t){var e,i=this,s=this.media,n=this.subtitleDisplay,r=this.trackId;s&&(e=(s=u(s.textTracks)).filter(function(t){return t.groupId===i.groupId}),-1===t?[].slice.call(s).forEach(:(s=e[r])&&(s.mode="disabled"),r=e[t])&&(r.mode=n?"showing":"hidden")},n.setSubtitleTrack=function(t,e){var i,s,n,r,a,o=this.tracksInGroup;this.media?(this.trackId!==t&&this.toggleTrackModes(t),this.trackId===t&&(-1===t||null!=(i=o[t])&&i.details)||t<-1||t>=o.length||(this.clearTimer(),i=o[t],this.log("Switching to subtitle track "+t),this.trackId=t,i?(o=i.id,s=i.groupId,n=i.name,r=i.type,a=i.url,this.hls.trigger(l.Events.SUBTITLE_TRACK_SWITCH,{id:o,groupId:void 0===s?"":s,name:n,type:r,url:a}),o=this.switchParams(i.url,null==e?void 0:e.details),this.loadPlaylist(o)):this.hls.trigger(l.Events.SUBTITLE_TRACK_SWITCH,{id:t}))):this.queuedDefaultTrack=t},n.onTextTracksChanged=e=t,(n=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:set:])&&o(e.prototype,n),s&&o(e,s),t}(s.default);.default=i},"./src/controller/timeline-controller.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"TimelineController",function(){return s});var l=i("./src/polyfills/number.ts"),c=i("./src/events.ts"),r=i("./src/utils/cea-608-parser.ts"),a=i("./src/utils/output-filter.ts"),o=i("./src/utils/webvtt-parser.ts"),d=i("./src/utils/texttrack-utils.ts"),u=i("./src/utils/imsc1-ttml-parser.ts"),h=i("./src/types/loader.ts"),g=i("./src/utils/logger.ts"),s=function(){function t(t){var e,i,s,n;this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs=p(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions&&(e=new a.default(this,"textTrack1"),i=new a.default(this,"textTrack2"),s=new a.default(this,"textTrack3"),n=new a.default(this,"textTrack4"),this.cea608Parser1=new r.default(1,e,i),this.cea608Parser2=new r.default(3,s,n)),t.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(c.Events.FRAG_LOADING,this.onFragLoading,this),t.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(c.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(c.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(c.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=t.prototype;return e.destroy=e.addCues=function(t,e,i,s,n){for(var r,a,o,l=!1,d=n.length;d--;){var u=n[d],h=(r=u[0],h=u[1],a=e,Math.min(h,i)-Math.max(r,a));if(0<=h&&(u[0]=Math.min(u[0],e),u[1]=Math.max(u[1],i),l=!0,.5<h/(i-e)))return}l||n.push([e,i]),this.config.renderTextTracksNatively?(o=this.captionsTracks[t],this.Cues.newCue(o,e,i,s)):(o=this.Cues.newCue(null,e,i,s),this.hls.trigger(c.Events.CUES_PARSED,{type:"captions",cues:o,track:t}))},e.onInitPtsFound=e.getExistingTrack=e.createCaptionsTrack=e.createNativeTrack=e.createNonNativeTrack=e.createTextTrack=e.onMediaAttaching=e.onMediaDetaching=e.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=p(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=e.onSubtitleTracksUpdated=function(t,e){var o,l=this,e=(this.textTracks=[],e.subtitleTracks||[]),i=e.some(;(this.config.enableWebVTT||i&&this.config.enableIMSC1)&&(i=this.tracks&&e&&this.tracks.length===e.length,this.tracks=e||[],this.config.renderTextTracksNatively?(o=this.media?this.media.textTracks:[],this.tracks.forEach(function(t,e){var i,s,n;if(e<o.length){for(var r=null,a=0;a<o.length;a++)if(s=o[a],n=t,s&&s.label===n.name&&!s.textTrack1&&!s.textTrack2){r=o[a];break}r&&(i=r)}i?Object(d.clearCurrentCues)(i):(i=l.createTextTrack("subtitles",t.name,t.lang))&&(i.mode="disabled"),i&&(i.groupId=t.groupId,l.textTracks.push(i))})):!i&&this.tracks&&this.tracks.length&&(e=this.tracks.map(,this.hls.trigger(c.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})))},e.onManifestLoaded=function(t,e){var i=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);e&&(e="textTrack"+e[1],e=i.captionsProperties[e])&&(e.label=t.name,t.lang&&(e.languageCode=t.lang),e.media=t)})},e.onFragLoading=function(t,e){var i=this.cea608Parser1,s=this.cea608Parser2,n=this.lastSn;this.enabled&&i&&s&&e.frag.type===h.PlaylistLevelType.MAIN&&((e=e.frag.sn)!==n+1&&(i.reset(),s.reset()),this.lastSn=e)},e.onFragLoaded=function(t,e){var i,s,n=e.frag,r=e.payload,a=this.initPTS,o=this.unparsedVttFrags;n.type===h.PlaylistLevelType.SUBTITLE&&(r.byteLength?Object(l.isFiniteNumber)(a[n.cc])?null!=(i=n.decryptdata)&&null!=i.key&&"AES-128"===i.method||(i=this.tracks[n.level],(s=this.vttCCs)[n.cc]||(s[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),i&&i.textCodec===u.IMSC1_CODEC?this._parseIMSC1(n,r):this._parseVTTs(n,r,s)):(o.push(e),a.length&&this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")})):this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")}))},e._parseIMSC1=e._parseVTTs=e._fallbackToIMSC1=e._appendCues=e.onFragDecrypted=e.onSubtitleTracksCleared=e.onFragParsingUserdata=e.onBufferFlushing=e.extractCea608Data=function(t){for(var e=31&t[0],i=2,s=[[],[]],n=0;n<e;n++){var r=t[i++],a=127&t[i++],o=127&t[i++],l=3&r;0==a&&0==o||!(0!=(4&r))||0!=l&&1!=l||(s[l].push(a),s[l].push(o))}return s},t}();,"./src/crypt/aes-crypto.ts":"./src/crypt/aes-decryptor.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"removePadding",function(){return n}),i.d(e,"default",function(){return r});var s=i("./src/utils/typed-array.ts");ar r=function(){ar e=t.prototype;return e.uint8ArrayToUint32Array_=e.initTable=function(){for(var t=this.sBox,e=this.invSBox,i=this.subMix,s=i[0],n=i[1],r=i[2],a=i[3],i=this.invSubMix,o=i[0],l=i[1],d=i[2],u=i[3],h=new Uint32Array(256),c=0,g=0,p=0,p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var v=g^g<<1^g<<2^g<<3^g<<4,f=(t[c]=v=v>>>8^255&v^99,h[e[v]=c]),E=h[f],_=h[E],m=257*h[v]^16843008*v;s[c]=m<<24|m>>>8,n[c]=m<<16|m>>>16,r[c]=m<<8|m>>>24,a[c]=m,o[v]=(m=16843009*_^65537*E^257*f^16843008*c)<<24|m>>>8,l[v]=m<<16|m>>>16,d[v]=m<<8|m>>>24,u[v]=m,c?(c=f^h[h[h[_^f]]],g^=h[h[g]]):c=g=1}},e.expandKey=e.networkToHostOrderSwap=e.decrypt=t}()},"./src/crypt/decrypter.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s});var a=i("./src/crypt/aes-crypto.ts"),o=i("./src/crypt/fast-aes-key.ts"),l=i("./src/crypt/aes-decryptor.ts"),n=i("./src/utils/logger.ts"),d=i("./src/utils/mp4-tools.ts"),u=i("./src/utils/typed-array.ts"),s=function(){ar e=t.prototype;return e.destroy=function(){this.observer=null},e.isSync=function(){return this.config.enableSoftwareAES},e.flush=e.reset=e.decrypt=e.softwareDecrypt=function(t,e,i){var s=this.currentIV,n=this.currentResult,r=this.remainderData,r=(this.logOnce("JS AES decrypt"),r&&(t=Object(d.appendUint8Array)(r,t),this.remainderData=null),this.getValidChunk(t));if(!r.length)return null;s&&(i=s);t=this.softwareDecrypter,(t=t||(this.softwareDecrypter=new l.default)).expandKey(e),s=n;return this.currentResult=t.decrypt(r.buffer,0,i),this.currentIV=Object(u.sliceUint8)(r,-16).buffer,s||null},e.webCryptoDecrypt=e.onWebCryptoError=e.getValidChunk=e.logOnce=t}()},"./src/crypt/fast-aes-key.ts":"./src/demux/aacdemuxer.ts":function(t,e,i){"use strict";i.r(e);var s=i("./src/demux/base-audio-demuxer.ts"),n=i("./src/demux/adts.ts"),r=i("./src/utils/logger.ts"),a=i("./src/demux/id3.ts");function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}i=function(s){var t;=s,(i=e).prototype=Object.create(t.prototype),o(i.prototype.constructor=i,t);var i=e.prototype;return i.resetInitSegment=function(t,e,i){s.prototype.resetInitSegment.call(this,t,e,i),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}},e.probe=function(t){if(t)for(var e=(a.getID3Data(t,0)||[]).length,i=t.length;e<i;e++)if(n.probe(t,e))return r.logger.log("ADTS sync word found !"),!0;return!1},i.canParse=function(t,e){return n.canParse(t,e)},i.appendFrame=e}(s.default);i.minProbeByteLength=9,e.default=i},"./src/demux/adts.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"getAudioConfig",function(){return r}),i.d(e,"isHeaderPattern",function(){return s}),i.d(e,"getHeaderLength",function(){return a}),i.d(e,"getFullFrameLength",function(){return o}),i.d(e,"canGetFrameLength",function(){return n}),i.d(e,"isHeader",function(){return l}),i.d(e,"canParse",function(){return d}),i.d(e,"probe",function(){return u}),i.d(e,"initTrackConfig",function(){return p}),i.d(e,"getFrameDuration",function(){return v}),i.d(e,"parseFrameHeader",function(){return f}),i.d(e,"appendFrame",function(){return E});var h=i("./src/utils/logger.ts"),c=i("./src/errors.ts"),g=i("./src/events.ts");ion l(t,e){return e+1<t.length&&s(t,e)}unction u(t,e){var i,s;return!!l(t,e)&&!(e+(s=a(t,e))>=t.length||(i=o(t,e))<=s)&&((s=e+i)===t.length||l(t,s))}nction f(t,e,i,s,n){var r=a(t,e),t=o(t,e);if(0<(t-=r))return{headerLength:r,frameLength:t,stamp:i+s*n}}function E(t,e,i,s,n){var r,a,o,s=f(e,i,s,n,v(t.samplerate));if(s)return n=s.frameLength,r=s.headerLength,s=s.stamp,n=r+n,(a=Math.max(0,i+n-e.length))?(o=new Uint8Array(n-r)).set(e.subarray(i+r,e.length),0):o=e.subarray(i+r,i+n),e={unit:o,pts:s},a||t.samples.push(e),{sample:e,length:n,missing:a}}},"./src/demux/base-audio-demuxer.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"initPTSFn",function(){return v});var s=i("./src/polyfills/number.ts"),h=i("./src/demux/id3.ts"),c=i("./src/demux/dummy-demuxed-track.ts"),g=i("./src/utils/mp4-tools.ts"),p=i("./src/utils/typed-array.ts"),v=e.default=)},"./src/demux/chunk-cache.ts":"./src/demux/dummy-demuxed-track.ts":"./src/demux/exp-golomb.ts":function(t,e,i){"use strict";i.r(e);var s=i("./src/utils/logger.ts");e.default=function(){ar e=t.prototype;return e.loadWord=e.skipBits=function(t){var e;this.bitsAvailable>t||(t=(t-=this.bitsAvailable)-((e=t>>3)>>3),this.bytesAvailable-=e,this.loadWord()),this.word<<=t,this.bitsAvailable-=t},e.readBits=e.skipLZ=e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=e.readUEG=e.readEG=e.readBoolean=e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=e.readSPS=function(){var t,e,i,s=0,n=0,r=0,a=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),d=this.readUEG.bind(this),u=this.readBoolean.bind(this),h=this.skipBits.bind(this),c=this.skipEG.bind(this),g=this.skipUEG.bind(this),p=this.skipScalingList.bind(this),v=(o(),o());if(l(5),h(3),o(),g(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){v=d();if(3===v&&h(1),g(),g(),h(1),u())for(e=3!==v?8:12,i=0;i<e;i++)u()&&p(i<6?16:64)}g();v=d();if(0===v)d();else if(1===v)for(h(1),c(),c(),t=d(),i=0;i<t;i++)c();g(),h(1);var v=d(),g=d(),l=l(1),f=(0===l&&h(1),h(1),u()&&(s=d(),n=d(),r=d(),a=d()),[1,1]);if(u()&&u())switch(o()){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(v+1)-2*s-2*n),height:(2-l)*(g+1)*16-(l?2:4)*(r+a),pixelRatio:f}},e.readSliceType=t}()},"./src/demux/id3.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"isHeader",function(){return l}),i.d(e,"isFooter",function(){return d}),i.d(e,"getID3Data",function(){return s}),i.d(e,"canParse",function(){return n}),i.d(e,"getTimeStamp",function(){return r}),i.d(e,"isTimeStampFrame",function(){return a}),i.d(e,"getID3Frames",function(){return o}),i.d(e,"decodeFrame",function(){return c}),i.d(e,"utf8ArrayToStr",function(){return E}),i.d(e,"testables",function(){return _});var u,l=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},d=s=function(t,e){for(var i=e,s=0;l(t,e);){s=(s+=10)+h(t,e+6);d(t,e+10)&&(s+=10),e+=s}if(0<s)return t.subarray(i,i+s)},h=function(t,e){var i=(127&t[e])<<21;return(i|=(127&t[e+1])<<14)|(127&t[e+2])<<7|127&t[e+3]},n=r=a=o=function(t){for(var e,i=0,s=[];l(t,i);){for(var n=h(t,i+6),r=(i+=10)+n;i+8<r;){o=t.subarray(i),e=a=void 0,a=String.fromCharCode(o[0],o[1],o[2],o[3]),e=h(o,4);var a={type:a,size:e,data:o.subarray(10,10+e)},o=c(a);o&&s.push(o),i+=a.size+10}d(t,i)&&(i+=10)}return s},c=g=function(t){var e,i;if(!(t.size<2))return e=E(t.data,!0),i=new Uint8Array(t.data.subarray(e.length+1)),{key:t.type,info:e,data:i.buffer}},p=function(t){var e,i;if(!(t.size<2))return"TXXX"===t.type?(e=1,e+=(i=E(t.data.subarray(1),!0)).length+1,e=E(t.data.subarray(e)),{key:t.type,info:i,data:e}):(i=E(t.data.subarray(1)),{key:t.type,data:i})},v=function(t){var e,i;return"WXXX"===t.type?t.size<2?void 0:(e=1,e+=(i=E(t.data.subarray(1),!0)).length+1,e=E(t.data.subarray(e)),{key:t.type,info:i,data:e}):(i=E(t.data),{key:t.type,data:i})},f=function(t){var e;if(8===t.data.byteLength)return e=1&(t=new Uint8Array(t.data))[3],t=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7],t/=45,e&&(t+=47721858.84),Math.round(t)},E=function(t,e){void 0===e&&(e=!1);var i,s=function(){u||void 0===self.TextDecoder||(u=new self.TextDecoder("utf-8"));return u}();if(s)return s=s.decode(t),e?-1!==(i=s.indexOf("\0"))?s.substring(0,i):s:s.replace(/\0/g,"");for(var n,r,a,o=t.length,l="",d=0;d<o;){if(0===(n=t[d++])&&e)return l;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(n);break;case 12:case 13:r=t[d++],l+=String.fromCharCode((31&n)<<6|63&r);break;case 14:r=t[d++],a=t[d++],l+=String.fromCharCode((15&n)<<12|(63&r)<<6|(63&a)<<0)}}return l},_={decodeTextFrame:p}},"./src/demux/mp3demuxer.ts":function(t,e,i){"use strict";i.r(e);var s=i("./src/demux/base-audio-demuxer.ts"),n=i("./src/demux/id3.ts"),r=i("./src/utils/logger.ts"),a=i("./src/demux/mpegaudio.ts");function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}i=function(s){var t;=s,(i=e).prototype=Object.create(t.prototype),o(i.prototype.constructor=i,t);var i=e.prototype;return i.resetInitSegment=e.probe=function(t){if(t)for(var e=(n.getID3Data(t,0)||[]).length,i=t.length;e<i;e++)if(a.probe(t,e))return r.logger.log("MPEG Audio sync word found !"),!0;return!1},i.canParse=i.appendFrame=e}(s.default);i.minProbeByteLength=4,e.default=i},"./src/demux/mp4demuxer.ts":"./src/demux/mpegaudio.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"appendFrame",function(){return s}),i.d(e,"parseHeader",function(){return a}),i.d(e,"isHeaderPattern",function(){return n}),i.d(e,"isHeader",function(){return r}),i.d(e,"canParse",function(){return o}),i.d(e,"probe",function(){return l});var h=null,c=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],g=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],p=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],v=[0,1,1,4];function s(t,e,i,s,n){var r;return!(i+24>e.length)&&(r=a(e,i))&&i+r.frameLength<=e.length?(s=s+n*(9e4*r.samplesPerFrame/r.sampleRate),n={unit:e.subarray(i,i+r.frameLength),pts:s,dts:s},t.config=[],t.channelCount=r.channelCount,t.samplerate=r.sampleRate,t.samples.push(n),{sample:n,length:r.frameLength,missing:0}):void 0}function a(t,e){var i,s,n,r,a,o=t[e+1]>>3&3,l=t[e+1]>>1&3,d=t[e+2]>>4&15,u=t[e+2]>>2&3;if(1!=o&&0!=d&&15!=d&&3!=u)return a=t[e+2]>>1&1,i=t[e+3]>>6,d=1e3*c[14*(3==o?3-l:3==l?3:4)+d-1],u=g[3*(3==o?0:2==o?1:2)+u],s=3==i?1:2,r=8*(o=p[o][l])*(n=v[l]),o=Math.floor(o*d/u+a)*n,null===h&&(a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),h=a?parseInt(a[1]):0),!!h&&h<=87&&2==l&&224e3<=d&&0==i&&(t[e+3]=128|t[e+3]),{sampleRate:u,channelCount:s,frameLength:o,samplesPerFrame:r}}ction l(t,e){var i;return!!(e+1<t.length&&n(t,e))&&(i=4,(e=e+(i=null!=(e=a(t,e))&&e.frameLength?e.frameLength:i))===t.length||r(t,e))}},"./src/demux/sample-aes.ts":function(t,e,i){"use strict";i.r(e);var s=i("./src/crypt/decrypter.ts"),d=i("./src/demux/tsdemuxer.ts"),i=function(){ar e=t.prototype;return e.decryptBuffer=e.decryptAacSample=e.decryptAacSamples=e.getAvcEncryptedData=e.getAvcDecryptedUnit=e.decryptAvcSample=e.decryptAvcSamples=t}();e.default=i},"./src/demux/transmuxer-interface.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s});var l=i("./node_modules/webworkify-webpack/index.js"),d=i("./src/events.ts"),S=i("./src/demux/transmuxer.ts"),T=i("./src/utils/logger.ts"),u=i("./src/errors.ts"),e=i("./src/utils/mediasource-helper.ts"),h=i("./node_modules/eventemitter3/index.js"),c=Object(e.getMediaSource)()||{isTypeSupported:function(){return!1}},s=function(){function t(i,e,s,n){ar r,a=this,s=(this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=i,this.id=e,this.onTransmuxComplete=s,this.onFlush=n,i.config),n=(this.observer=new h.EventEmitter,this.observer.on(d.Events.FRAG_DECRYPTED,t),this.observer.on(d.Events.ERROR,t),{mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')}),o=navigator.vendor;if(s.enableWorker&&"undefined"!=typeof Worker){T.logger.log("demuxing in webworker");try{r=this.worker=l("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),r.addEventListener("message",this.onwmsg),r.onerror=r.postMessage({cmd:"init",typeSupported:n,vendor:o,id:e,config:JSON.stringify(s)})}catch(t){T.logger.warn("Error in worker:",t),T.logger.error("Error while initializing DemuxerWorker, fallback to inline"),r&&self.URL.revokeObjectURL(r.objectURL),this.transmuxer=new S.default(this.observer,n,s,o,e),this.worker=null}}else this.transmuxer=new S.default(this.observer,n,s,o,e)}var e=t.prototype;return e.destroy=function(){var t=this.worker,t=(t?(t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null):(t=this.transmuxer)&&(t.destroy(),this.transmuxer=null),this.observer);t&&t.removeAllListeners(),this.observer=null},e.push=function(t,e,i,s,n,r,a,o,l,d){var u=this,h=(l.transmuxing.start=self.performance.now(),this.transmuxer),c=this.worker,g=(r||n).start,p=n.decryptdata,v=this.frag,f=!(v&&n.cc===v.cc),E=!(v&&l.level===v.level),v=v?l.sn-v.sn:-1,_=this.part?l.part-this.part.index:1,m=!E&&(1==v||0==v&&1==_),A=self.performance.now(),v=((E||v||0===n.stats.parsing.start)&&(n.stats.parsing.start=A),!r||!_&&m||(r.stats.parsing.start=A),new S.TransmuxState(f,m,o,E,g));m&&!f||(T.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+f+"\n        trackSwitch: "+E+"\n        contiguous: "+m+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+g),_=new S.TransmuxConfig(i,s,e,a,d),this.configureTransmuxer(_)),this.frag=n,this.part=r,c?c.postMessage({cmd:"demux",data:t,decryptdata:p,chunkMeta:l,state:v},t instanceof ArrayBuffer?[t]:[]):h&&(A=h.push(t,p,l,v),Object(S.isPromise)(A)?A.then(function(t){u.handleTransmuxComplete(t)}):this.handleTransmuxComplete(A))},e.flush=function(e){var i=this,t=(e.transmuxing.start=self.performance.now(),this.transmuxer),s=this.worker;s?s.postMessage({cmd:"flush",chunkMeta:e}):t&&(s=t.flush(e),Object(S.isPromise)(s)?s.then(:this.handleFlushResult(s,e))},e.handleFlushResult=e.onWorkerMessage=e.configureTransmuxer=e.handleTransmuxComplete=t}()},"./src/demux/transmuxer-worker.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return n});var o=i("./src/demux/transmuxer.ts"),s=i("./src/events.ts"),l=i("./src/utils/logger.ts"),d=i("./node_modules/eventemitter3/index.js");function n(n){ar a=new d.EventEmitter;a.on(s.Events.FRAG_DECRYPTED,r),a.on(s.Events.ERROR,r),n.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":var i=JSON.parse(e.config);n.transmuxer=new o.default(a,e.typeSupported,i,e.vendor,e.id),Object(l.enableLogs)(i.debug),r("init",null);break;case"configure":n.transmuxer.configure(e.config);break;case"demux":i=n.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(o.isPromise)(i)?i.then(function(t){u(n,t)}):u(n,i);break;case"flush":var s=e.chunkMeta,i=n.transmuxer.flush(s);Object(o.isPromise)(i)?i.then(:h(n,i,s)}})}./src/demux/transmuxer.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return h}),i.d(e,"isPromise",function(){return c}),i.d(e,"TransmuxConfig",function(){return g}),i.d(e,"TransmuxState",function(){return p});var E,l=i("./src/events.ts"),d=i("./src/errors.ts"),s=i("./src/crypt/decrypter.ts"),e=i("./src/demux/aacdemuxer.ts"),_=i("./src/demux/mp4demuxer.ts"),n=i("./src/demux/tsdemuxer.ts"),r=i("./src/demux/mp3demuxer.ts"),a=i("./src/remux/mp4-remuxer.ts"),m=i("./src/remux/passthrough-remuxer.ts"),o=i("./src/demux/chunk-cache.ts"),A=i("./src/utils/mp4-tools.ts"),S=i("./src/utils/logger.ts");try{E=self.performance.now.bind(self.performance)}catch(t){S.logger.debug("Unable to use Performance API on this environment"),E=self.Date.now}var T=[{demux:n.default,remux:a.default},{demux:_.default,remux:m.default},{demux:e.default,remux:a.default},{demux:r.default,remux:a.default}],u=1024,h=(T.forEach(,function(){ar e=t.prototype;return e.configure=e.push=function(t,e,i,s){var n=this,r=i.transmuxing,t=(r.executeStart=E(),new Uint8Array(t)),a=this.cache,o=this.config,l=this.currentTransmuxState,d=this.transmuxConfig,e=(s&&(this.currentTransmuxState=s),t,e));if(e&&"AES-128"===e.method){var u=this.getDecrypter();if(!o.enableSoftwareAES)return this.decryptionPromise=u.webCryptoDecrypt(t,e.key.buffer,e.iv.buffer).then(,this.decryptionPromise;o=u.softwareDecrypt(t,e.key.buffer,e.iv.buffer);if(!o)return r.executeEnd=E(),y(i);t=new Uint8Array(o)}var u=s||l,o=u.contiguous,s=u.discontinuity,l=u.trackSwitch,h=u.accurateTimeOffset,u=u.timeOffset,c=d.audioCodec,g=d.videoCodec,p=d.defaultInitPts,v=d.duration,f=d.initSegmentData,c=((s||l)&&this.resetInitSegment(f,c,g,v),s&&this.resetInitialTimestamp(p),o||this.resetContiguity(),this.needsProbing(t,s,l)&&(a.dataLength&&(f=a.flush(),t=Object(A.appendUint8Array)(f,t)),this.configureTransmuxer(t,d)),this.transmux(t,e,u,h,i)),g=this.currentTransmuxState;return g.contiguous=!0,g.discontinuity=!1,g.trackSwitch=!1,r.executeEnd=E(),c},e.flush=function(e){var i,s=this,t=e.transmuxing,n=(t.executeStart=E(),this.decrypter),r=this.cache,a=this.currentTransmuxState,o=this.decryptionPromise;return o?o.then(function(){return s.flush(e)}):(i=[],o=a.timeOffset,n&&(a=n.flush())&&i.push(this.push(a,null,e)),n=r.dataLength,r.reset(),a=this.demuxer,r=this.remuxer,a&&r?c(r=a.flush(o))?r.then(:(this.flushRemux(i,r,e),i):(u<=n&&this.observer.emit(l.Events.ERROR,l.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),t.executeEnd=E(),[y(e)]))},e.flushRemux=function(t,e,i){var s=e.audioTrack,n=e.avcTrack,r=e.id3Track,e=e.textTrack,a=this.currentTransmuxState,o=a.accurateTimeOffset,a=a.timeOffset,s=(S.logger.log("[transmuxer.ts]: Flushed fragment "+i.sn+(-1<i.part?" p: "+i.part:"")+" of level "+i.level),this.remuxer.remux(s,n,r,e,a,o,!0,this.id));t.push({remuxResult:s,chunkMeta:i}),i.transmuxing.executeEnd=E()},e.resetInitialTimestamp=e.resetContiguity=e.resetInitSegment=e.destroy=e.transmux=e.transmuxUnencrypted=e.transmuxSampleAes=e.configureTransmuxer=e.needsProbing=e.getDecrypter=t}());var y=ar g=function(t,e,i,s,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=s,this.defaultInitPts=n},p=,"./src/demux/tsdemuxer.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"discardEPB",function(){return F});var g=i("./src/demux/adts.ts"),o=i("./src/demux/mpegaudio.ts"),R=i("./src/demux/exp-golomb.ts"),P=i("./src/demux/id3.ts"),s=i("./src/demux/sample-aes.ts"),M=i("./src/events.ts"),L=i("./src/utils/mp4-tools.ts"),O=i("./src/utils/logger.ts"),k=i("./src/errors.ts"),n={video:1,audio:2,id3:3,text:4},i=function(){.probe=function(t){t=b.syncOffset(t);return!(t<0||(t&&O.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),0))},b.syncOffset=b.createTrack=var t=b.prototype;return t.resetInitSegment=t.resetTimeStamp=function(){},t.resetContiguity=t.demux=function(t,e,i,s){void 0===s&&(s=!1),(i=void 0===i?!1:i)||(this.sampleAes=null);var n,r=this._avcTrack,a=this._audioTrack,o=this._id3Track,l=r.pid,d=r.pesData,u=a.pid,h=o.pid,c=a.pesData,g=o.pesData,p=!1,v=this.pmtParsed,f=this._pmtId,E=t.length;if(this.remainderData&&(E=(t=Object(L.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),E<188&&!s)return this.remainderData=t,{audioTrack:a,avcTrack:r,id3Track:o,textTrack:this._txtTrack};var _=Math.max(0,b.syncOffset(t));(E-=(E+_)%188)<t.byteLength&&!s&&(this.remainderData=new Uint8Array(t.buffer,E,t.buffer.byteLength-E));for(var m,A=_;A<E;A+=188)if(71===t[A]){var S=!!(64&t[A+1]),T=((31&t[A+1])<<8)+t[A+2],y=(48&t[A+3])>>4,D=void 0;if(1<y){if((D=A+5+t[A+4])===A+188)continue}else D=A+4;switch(T){case l:S&&(d&&(n=U(d))&&this.parseAVCPES(n,!1),d={data:[],size:0}),d&&(d.data.push(t.subarray(D,A+188)),d.size+=A+188-D);break;case u:S&&(c&&(n=U(c))&&(a.isAAC?this.parseAACPES(n):this.parseMPEGPES(n)),c={data:[],size:0}),c&&(c.data.push(t.subarray(D,A+188)),c.size+=A+188-D);break;case h:S&&(g&&(n=U(g))&&this.parseID3PES(n),g={data:[],size:0}),g&&(g.data.push(t.subarray(D,A+188)),g.size+=A+188-D);break;case 0:S&&(D+=t[D]+1),f=this._pmtId=(31&(I=t)[(m=D)+10])<<8|I[m+11];break;case f:S&&(D+=t[D]+1);var I=t,D,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,i);0<(l=I.avc)&&(r.pid=l),0<(u=I.audio)&&(a.pid=u,a.isAAC=I.isAAC),0<(h=I.id3)&&(o.pid=h),p&&!v&&(O.logger.log("reparse from beginning"),p=!1,A=_-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});r.pesData=d,a.pesData=c,o.pesData=g;var C={audioTrack:a,avcTrack:r,id3Track:o,textTrack:this._txtTrack};return s&&this.extractRemainingSamples(C),C},t.flush=t.extractRemainingSamples=t.demuxSampleAes=t.decrypt=t.destroy=t.parseAVCPES=function(S,t){var T,y=this,D=this._avcTrack,e=this.parseAVCNALu(S.data),I=this.avcSample,C=!1;S.data=null,I&&e.length&&!D.audFound&&(B(I,D),I=this.avcSample=N(!1,S.pts,S.dts,"")),e.forEach(function(t){switch(t.type){case 1:T=!0,(I=I||(y.avcSample=N(!0,S.pts,S.dts,""))).frame=!0;var e=t.data;C&&4<e.length&&(2!==(e=new R.default(e).readSliceType())&&4!==e&&7!==e&&9!==e||(I.key=!0));break;case 5:T=!0,(I=I||(y.avcSample=N(!0,S.pts,S.dts,""))).key=!0,I.frame=!0;break;case 6:T=!0;for(var i=new R.default(F(t.data)),s=(i.readUByte(),0),n=0,r=!1,a=0;!r&&1<i.bytesAvailable;){for(s=0;s+=a=i.readUByte(),255===a;);for(n=0;n+=a=i.readUByte(),255===a;);if(4===s&&0!==i.bytesAvailable){var r=!0,o=i.readUByte();if(181===o)if(49===i.readUShort()){o=i.readUInt();if(1195456820===o)if(3===i.readUByte()){for(var o=i.readUByte(),l=31&o,d=[o,i.readUByte()],u=0;u<l;u++)d.push(i.readUByte()),d.push(i.readUByte()),d.push(i.readUByte());w(y._txtTrack.samples,{type:3,pts:S.pts,bytes:d})}}}else if(5===s&&0!==i.bytesAvailable){if(r=!0,16<n){for(var h=[],c=0;c<16;c++)h.push(i.readUByte().toString(16)),3!==c&&5!==c&&7!==c&&9!==c||h.push("-");for(var g=n-16,p=new Uint8Array(g),v=0;v<g;v++)p[v]=i.readUByte();w(y._txtTrack.samples,{pts:S.pts,payloadType:s,uuid:h.join(""),userData:Object(P.utf8ArrayToStr)(p),userDataBytes:p})}}else if(n<i.bytesAvailable)for(var f=0;f<n;f++)i.readUByte()}break;case 7:if(C=T=!0,!D.sps){for(var e=new R.default(t.data).readSPS(),E=(D.width=e.width,D.height=e.height,D.pixelRatio=e.pixelRatio,D.sps=[t.data],D.duration=y._duration,t.data.subarray(1,4)),_="avc1.",m=0;m<3;m++){var A=E[m].toString(16);_+=A=A.length<2?"0"+A:A}D.codec=_}break;case 8:T=!0,D.pps||(D.pps=[t.data]);break;case 9:T=!1,D.audFound=!0,I&&B(I,D),I=y.avcSample=N(!1,S.pts,S.dts,"");break;case 12:T=!1;break;default:T=!1,I&&(I.debug+="unknown NAL "+t.type+" ")}I&&T&&I.units.push(t)}),t&&I&&(B(I,D),this.avcSample=null)},t.getLastNalUnit=function(){var t,e,i=this.avcSample;return e=null!=(t=i=i&&0!==i.units.length?i:(t=this._avcTrack.samples)[t.length-1])&&t.units?(t=i.units)[t.length-1]:e},t.parseAVCNALu=function(t){var e,i,s,n=t.byteLength,r=this._avcTrack,a=g=r.naluState||0,o=[],l=0,d=-1,u=0;for(-1===g&&(u=31&t[d=0],g=0,l=1);l<n;){var h,c,g,p=t[l++];g?g=1===g?p?0:2:p?1===p?(0<=d?(h={data:t.subarray(d,l-g-1),type:u},o.push(h)):(h=this.getLastNalUnit())&&(a&&l<=4-a&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-a)),0<(e=l-g-1))&&((c=new Uint8Array(h.data.byteLength+e)).set(h.data,0),c.set(t.subarray(0,e),h.data.byteLength),h.data=c),l<n?(u=31&t[d=l],0):-1):0:3:g=p?0:1}return 0<=d&&0<=g&&(i={data:t.subarray(d,n),type:u,state:g},o.push(i)),0===o.length&&(i=this.getLastNalUnit())&&((s=new Uint8Array(i.data.byteLength+t.byteLength)).set(i.data,0),s.set(t,i.data.byteLength),i.data=s),r.naluState=g,o},t.parseAACPES=function(t){var e,i,s=0,n=this._audioTrack,r=this.aacOverFlow,a=t.data;for(r&&(this.aacOverFlow=null,d=(l=r.sample.unit.byteLength)-(l=Math.min(r.missing,l)),r.sample.unit.set(a.subarray(0,l),d),n.samples.push(r.sample),s=r.missing),e=s,i=a.length;e<i-1&&!g.isHeader(a,e);e++);if(e!==s){var o,l=e<i-1?(o="AAC PES did not start with ADTS header,offset:"+e,!1):(o="no ADTS header found in AAC PES",!0);if(O.logger.warn("parsing error:"+o),this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,fatal:l,reason:o}),l)return}if(g.initTrackConfig(n,this.observer,a,e,this.audioCodec),void 0!==t.pts)u=t.pts;else{if(!r)return void O.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var d=g.getFrameDuration(n.samplerate),u=r.sample.pts+d}for(var h=0;e<i;){if(g.isHeader(a,e)){if(e+5<i){var c=g.appendFrame(n,a,e,u,h);if(c){if(!c.missing){e+=c.length,h++;continue}this.aacOverFlow=c}}break}e++}},t.parseMPEGPES=function(t){var e=t.data,i=e.length,s=0,n=0,r=t.pts;if(void 0===r)O.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");else for(;n<i;)if(o.isHeader(e,n)){var a=o.appendFrame(this._audioTrack,e,n,r,s);if(!a)break;n+=a.length,s++}else n++},t.parseID3PES=b}();unction U(t){var e,i,s,n=0,r=t.data;if(!t||0===t.size)return null;for(;r[0].length<19&&1<r.length;){var a=new Uint8Array(r[0].length+r[1].length);a.set(r[0]),a.set(r[1],r[0].length),r[0]=a,r.splice(1,1)}if(1!==((c=r[0])[0]<<16)+(c[1]<<8)+c[2])return null;if((e=(c[4]<<8)+c[5])&&e>t.size-6)return null;var o=c[7],l=(192&o&&(i=536870912*(14&c[9])+4194304*(255&c[10])+16384*(254&c[11])+128*(255&c[12])+(254&c[13])/2,64&o?54e5<i-(s=536870912*(14&c[14])+4194304*(255&c[15])+16384*(254&c[16])+128*(255&c[17])+(254&c[18])/2)&&(O.logger.warn(Math.round((i-s)/9e4)+"s delta between PTS and DTS, align them"),i=s):s=i),(o=c[8])+9);if(t.size<=l)return null;t.size-=l;for(var d=new Uint8Array(t.size),u=0,h=r.length;u<h;u++){var c,g=(c=r[u]).byteLength;if(l){if(g<l){l-=g;continue}c=c.subarray(l),g-=l,l=0}d.set(c,n),n+=g}return e&&(e-=o+3),{data:d,pts:i,dts:s,len:e}}inProbeByteLength=188,e.default=i},"./src/errors.ts":"./src/events.ts":"./src/hls.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return l});var n=i("./node_modules/url-toolkit/src/url-toolkit.js"),c=i("./src/loader/playlist-loader.ts"),g=i("./src/loader/key-loader.ts"),p=i("./src/controller/id3-track-controller.ts"),v=i("./src/controller/latency-controller.ts"),f=i("./src/controller/level-controller.ts"),E=i("./src/controller/fragment-tracker.ts"),_=i("./src/controller/stream-controller.ts"),s=i("./src/is-supported.ts"),m=i("./src/utils/logger.ts"),A=i("./src/config.ts"),S=i("./node_modules/eventemitter3/index.js"),r=i("./src/events.ts"),a=i("./src/errors.ts");function o(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var l=function(){function h(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new S.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var e=this.config=Object(A.mergeConfig)(h.DefaultConfig,t),t=(this.userConfig=t,Object(m.enableLogs)(e.debug),this._autoLevelCapping=-1,e.progressive&&Object(A.enableStreamingMode)(e),e.abrController),i=e.bufferController,s=e.capLevelController,n=e.fpsController,t=this.abrController=new t(this),i=this.bufferController=new i(this),s=this.capLevelController=new s(this),n=new n(this),r=new c.default(this),a=new g.default(this),o=new p.default(this),l=this.levelController=new f.default(this),d=new E.FragmentTracker(this),u=this.streamController=new _.default(this,d),l=(s.setStreamController(u),n.setStreamController(u),[l,u]),u=(this.networkControllers=l,[r,a,t,i,s,n,o,d]);this.audioTrackController=this.createController(e.audioTrackController,null,l),this.createController(e.audioStreamController,d,l),this.subtitleTrackController=this.createController(e.subtitleTrackController,null,l),this.createController(e.subtitleStreamController,d,l),this.createController(e.timelineController,null,u),this.emeController=this.createController(e.emeController,null,u),this.latencyController=this.createController(v.default,null,u),this.coreComponents=u}h.isSupported=var t,e,i=h.prototype;return i.createController=i.on=function(t,e,i){this._emitter.on(t,e,i=void 0===i?this:i)},i.once=i.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},i.off=i.listeners=function(t){return this._emitter.listeners(t)},i.emit=function(t,e,i){return this._emitter.emit(t,e,i)},i.trigger=i.listenerCount=function(t){return this._emitter.listenerCount(t)},i.destroy=i.attachMedia=i.detachMedia=i.loadSource=i.startLoad=i.stopLoad=i.swapAudioCodec=i.recoverMediaError=i.removeLevel=i=h,e=[{key:"version",get:function(){return"1.0.7"}},{key:"Events",get:function(){return r.Events}},{key:"ErrorTypes",get:function(){return a.ErrorTypes}},{key:"ErrorDetails",get:function(){return a.ErrorDetails}},{key:"DefaultConfig",get:set:function(t){h.defaultConfig=t}}],(t=[{key:"levels",get:,{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:,{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:,{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){m.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:set:,{key:"startLevel",get:function(){return this.levelController.startLevel},set:,{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:,{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:,{key:"bandwidthEstimate",get:,{key:"autoLevelEnabled",get:,{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(t)for(var i=t.length,s=0;s<i;s++)if(t[s].maxBitrate>e)return s;return 0}},{key:"maxAutoLevel",get:,{key:"nextAutoLevel",get:set:,{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:,{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:set:,{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:,{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&o(i.prototype,t),e&&o(i,e),h}();l.defaultConfig=void 0},"./src/is-supported.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"isSupported",function(){return r}),i.d(e,"changeTypeSupported",function(){return a});var s=i("./src/utils/mediasource-helper.ts");function n(){return self.SourceBuffer||self.WebKitSourceBuffer}function r(){var t,e=Object(s.getMediaSource)();return!!e&&(t=n(),e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove,!!e)&&!!t}function a(){var t=n();return"function"==typeof(null==t||null==(t=t.prototype)?void 0:t.changeType)}},"./src/loader/fragment-loader.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return l}),i.d(e,"LoadError",function(){return v});var s=i("./src/polyfills/number.ts"),c=i("./src/errors.ts");function n(t){var i="function"==typeof Map?new Map:void 0;return function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return r(t,arguments,o(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a(e,t)}(t)}function r(t,e,i){return(r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(t){}}()?Reflect.construct:function(t,e,i){var s=[null];s.push.apply(s,e);e=new(Function.bind.apply(t,s));return i&&a(e,i.prototype),e}).apply(null,arguments)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var g=Math.pow(2,17),l=function(){ar e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=e.load=e.loadPart=function(a,o,l){var d=this,i=(this.abort(),this.config),u=i.fLoader,h=i.loader;return new Promise(},e.updateStatsFromPart=function(t,e){var i=t.stats,s=e.stats,n=s.total,t=(i.loaded+=s.loaded,n?(n=((t=Math.round(t.duration/e.duration))-(e=Math.min(Math.round(i.loaded/n),t)))*Math.round(i.loaded/e),i.total=i.loaded+n):i.total=Math.max(i.loaded,i.total),i.loading),e=s.loading;t.start?t.first+=e.first-e.start:(t.start=e.start,t.first=e.first),t.end=e.end},e.resetLoader=t}();function p(t,e){var i=(e=void 0===e?null:e)||t,t={frag:t,part:e,responseType:"arraybuffer",url:i.url,rangeStart:0,rangeEnd:0},e=i.byteRangeStartOffset,i=i.byteRangeEndOffset;return Object(s.isFiniteNumber)(e)&&Object(s.isFiniteNumber)(i)&&(t.rangeStart=e,t.rangeEnd=i),t}var v=n(Error))},"./src/loader/fragment.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"ElementaryStreamTypes",function(){return s}),i.d(e,"BaseSegment",function(){return g}),i.d(e,"Fragment",function(){return p}),i.d(e,"Part",function(){return v});var s,n=i("./src/polyfills/number.ts"),r=i("./node_modules/url-toolkit/src/url-toolkit.js"),a=i("./src/utils/logger.ts"),o=i("./src/loader/level-key.ts"),l=i("./src/loader/load-stats.ts");unction u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}e=s=s||{}).AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo";var g=),p=function(i){(t,i);var e=t.prototype;return e.createInitializationVector=e.setDecryptDataFromLevelKey=e.setElementaryStreamInfo=e.clearElementaryStreamInfo=c(t,[{key:"decryptdata",get:function(){var t;return this.levelkey||this._decryptdata?(!this._decryptdata&&this.levelkey&&("number"!=typeof(t=this.sn)&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&a.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)),this._decryptdata):null}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){var t;return null!==this.programDateTime&&Object(n.isFiniteNumber)(this.programDateTime)?(t=Object(n.isFiniteNumber)(this.duration)?this.duration:0,this.programDateTime+1e3*t):null}},{key:"encrypted",get:function(){var t;return!(null==(t=this.decryptdata)||!t.keyFormat||!this.decryptdata.uri)}}]),t}(g),v=function(r){function t(t,e,i,s,n){i=r.call(this,i)||this,i.fragOffset=0,i.duration=0,i.gap=!1,i.independent=!1,i.relurl=void 0,i.fragment=void 0,i.index=void 0,i.stats=new l.LoadStats,i.duration=t.decimalFloatingPoint("DURATION"),i.gap=t.bool("GAP"),i.independent=t.bool("INDEPENDENT"),i.relurl=t.enumeratedString("URI"),i.fragment=e,i.index=s,e=t.enumeratedString("BYTERANGE");return e&&i.setByteRange(e,n),n&&(i.fragOffset=n.fragOffset+n.duration),i}return d(t,r),c(t,[{key:"start",get:,{key:"end",get:,{key:"loaded",get:]),t}(g)},"./src/loader/key-loader.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return n});var a=i("./src/events.ts"),s=i("./src/errors.ts"),o=i("./src/utils/logger.ts"),n=function(){ar e=t.prototype;return e._registerListeners=function(){this.hls.on(a.Events.KEY_LOADING,this.onKeyLoading,this)},e._unregisterListeners=function(){this.hls.off(a.Events.KEY_LOADING,this.onKeyLoading)},e.destroy=e.onKeyLoading=function(t,e){var i,s,e=e.frag,n=e.type,r=this.loaders[n];e.decryptdata?(i=e.decryptdata.uri)!==this.decrypturl||null===this.decryptkey?(s=this.hls.config,r&&(o.logger.warn("abort previous key loader for type:"+n),r.abort()),i?(r=s.loader,n=e.loader=this.loaders[n]=new r(s),this.decrypturl=i,this.decryptkey=null,r={url:i,frag:e,responseType:"arraybuffer"},i={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:0},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(r,i,s)):o.logger.warn("key uri is falsy")):this.decryptkey&&(e.decryptdata.key=this.decryptkey,this.hls.trigger(a.Events.KEY_LOADED,{frag:e})):o.logger.warn("Missing decryption data on fragment in onKeyLoading")},e.loadsuccess=e.loaderror=e.loadtimeout=t}()},"./src/loader/level-details.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"LevelDetails",function(){return s});var n=i("./src/polyfills/number.ts");function r(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var s=function(){ar e,i,s;return t.prototype.reloaded=function(t){var e,i;t?(e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex,this.updated=this.endSN!==t.endSN||!!i||!!e,this.advanced=this.endSN>t.endSN||0<e||0==e&&0<i,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay):(this.advanced=!0,this.updated=!0)},e=t,(i=[{key:"hasProgramDateTime",get:,{key:"levelTargetDuration",get:,{key:"drift",get:,{key:"edge",get:,{key:"partEnd",get:,{key:"fragmentEnd",get:,{key:"age",get:,{key:"lastPartIndex",get:,{key:"lastPartSn",get:])&&r(e.prototype,i),s&&r(e,s),t}()},"./src/loader/level-key.ts":"./src/loader/load-stats.ts":"./src/loader/m3u8-parser.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s});var w=i("./src/polyfills/number.ts"),F=i("./node_modules/url-toolkit/src/url-toolkit.js"),j=i("./src/loader/fragment.ts"),G=i("./src/loader/level-details.ts"),x=i("./src/loader/level-key.ts"),V=i("./src/utils/attr-list.ts"),H=i("./src/utils/logger.ts"),u=i("./src/utils/codecs.ts"),h=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,l=/#EXT-X-MEDIA:(.*)/g,K=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),W=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Y=/\.(mp4|m4s|m4v|m4a)$/i;var s=function(){function d(){}return d.findGroup=d.convertAVC1ToAVCOTI=function(t){var e,i=t.split(".");return 2<i.length?(e=i.shift()+".",(e+=parseInt(i.shift()).toString(16))+("000"+parseInt(i.shift()).toString(16)).substr(-4)):t},d.resolve=d.parseMasterPlaylist=function(t,e){var i,s,n,r,a=[],o={},l=!1;for(h.lastIndex=0;null!=(i=h.exec(t));)i[1]?(n={attrs:s=new V.AttrList(i[1]),bitrate:s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),name:s.NAME,url:d.resolve(i[2],e)},(r=s.decimalResolution("RESOLUTION"))&&(n.width=r.width,n.height=r.height),(s.CODECS||"").split(/[ ,]+/).filter(function(t){return t}),n),n.videoCodec&&-1!==n.videoCodec.indexOf("avc1")&&(n.videoCodec=d.convertAVC1ToAVCOTI(n.videoCodec)),a.push(n)):i[3]&&(r=new V.AttrList(i[3]))["DATA-ID"]&&(l=!0,o[r["DATA-ID"]]=r);return{levels:a,sessionData:l?o:null}},d.parseMasterPlaylistMedia=d.parseLevelPlaylist=function(t,e,i,s,n){var r,a,o,l=new G.LevelDetails(e),d=l.fragments,u=null,h=0,c=0,g=0,p=0,v=null,f=new j.Fragment(s,e),E=-1,_=!1;for(K.lastIndex=0,l.m3u8=t;null!==(r=K.exec(t));){_&&(_=!1,(f=new j.Fragment(s,e)).start=g,f.sn=h,f.cc=p,f.level=i,u)&&(f.initSegment=u,f.rawProgramDateTime=u.rawProgramDateTime);var m=r[1];if(m){f.duration=parseFloat(m);var A=(" "+r[2]).slice(1);f.title=A||null,f.tagList.push(A?["INF",m,A]:["INF",m])}else if(r[3])Object(w.isFiniteNumber)(f.duration)&&(f.start=g,o&&(f.levelkey=o),f.sn=h,f.level=i,f.cc=p,f.urlId=n,d.push(f),f.relurl=(" "+r[3]).slice(1),z(f,v),g+=(v=f).duration,h++,_=!(c=0));else if(r[4]){A=(" "+r[4]).slice(1);v?f.setByteRange(A,v):f.setByteRange(A)}else if(r[5])f.rawProgramDateTime=(" "+r[5]).slice(1),f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]),-1===E&&(E=d.length);else if(r=r[0].match(W)){for(a=1;a<r.length&&void 0===r[a];a++);var S=(" "+r[a]).slice(1),T=(" "+r[a+1]).slice(1),y=r[a+2]?(" "+r[a+2]).slice(1):"";switch(S){case"PLAYLIST-TYPE":l.type=T.toUpperCase();break;case"MEDIA-SEQUENCE":h=l.startSN=parseInt(T);break;case"SKIP":var D=new V.AttrList(T),I=D.decimalInteger("SKIPPED-SEGMENTS");if(Object(w.isFiniteNumber)(I)){for(var B=l.skippedSegments=I;B--;)d.unshift(null);h+=I}I=D.enumeratedString("RECENTLY-REMOVED-DATERANGES");I&&(l.recentlyRemovedDateranges=I.split("\t"));break;case"TARGETDURATION":l.targetduration=parseFloat(T);break;case"VERSION":l.version=parseInt(T);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"#":(T||y)&&f.tagList.push(y?[T,y]:[T]);break;case"DIS":p++;case"GAP":f.tagList.push([S]);break;case"BITRATE":f.tagList.push([S,T]);break;case"DISCONTINUITY-SEQ":p=parseInt(T);break;case"KEY":var D=new V.AttrList(T),I=D.enumeratedString("METHOD"),C=D.URI,b=D.hexadecimalInteger("IV"),R=D.enumeratedString("KEYFORMATVERSIONS"),P=D.enumeratedString("KEYID"),M=null!=(M=D.enumeratedString("KEYFORMAT"))?M:"identity";-1<["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(M)?H.logger.warn("Keyformat "+M+" is not supported from the manifest"):"identity"===M&&I&&(o=x.LevelKey.fromURL(e,C),C)&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(I)&&(o.method=I,o.keyFormat=M,P&&(o.keyID=P),R&&(o.keyFormatVersions=R),o.iv=b);break;case"START":C=new V.AttrList(T).decimalFloatingPoint("TIME-OFFSET");Object(w.isFiniteNumber)(C)&&(l.startTimeOffset=C);break;case"MAP":M=new V.AttrList(T);f.relurl=M.URI,M.BYTERANGE&&f.setByteRange(M.BYTERANGE),f.level=i,f.sn="initSegment",o&&(f.levelkey=o),f.initSegment=null,u=f,_=!0;break;case"SERVER-CONTROL":P=new V.AttrList(T);l.canBlockReload=P.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=P.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=0<l.canSkipUntil&&P.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=P.optionalFloat("PART-HOLD-BACK",0),l.holdBack=P.optionalFloat("HOLD-BACK",0);break;case"PART-INF":R=new V.AttrList(T);l.partTarget=R.decimalFloatingPoint("PART-TARGET");break;case"PART":var b=(b=l.partList)||(l.partList=[]),L=0<c?b[b.length-1]:void 0,O=c++,O=new j.Part(new V.AttrList(T),f,e,O,L);b.push(O),f.duration+=O.duration;break;case"PRELOAD-HINT":L=new V.AttrList(T);l.preloadHint=L;break;case"RENDITION-REPORT":O=new V.AttrList(T);l.renditionReports=l.renditionReports||[],l.renditionReports.push(O);break;default:H.logger.warn("line parsed but not handled: "+r)}}else H.logger.warn("No matches on slow regex match for level playlist!")}v&&!v.relurl?(d.pop(),g-=v.duration,l.partList&&(l.fragmentHint=v)):l.partList&&(z(f,v),f.cc=p,l.fragmentHint=f);var k=d.length,N=d[0],U=d[k-1];return 0<(g+=l.skippedSegments*l.targetduration)&&k&&U?(l.averagetargetduration=g/k,k=U.sn,l.endSN="initSegment"!==k?k:0,N&&(l.startCC=N.cc,N.initSegment||l.fragments.every(function(t){return t.relurl&&(t=t.relurl,Y.test(null!=(t=null==(t=F.parseURL(t))?void 0:t.path)?t:""))})&&(H.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(f=new j.Fragment(s,e)).relurl=U.relurl,f.level=i,f.sn="initSegment",N.initSegment=f,l.needSidxRanges=!0))):(l.endSN=0,l.startCC=0),l.fragmentHint&&(g+=l.fragmentHint.duration),l.totalduration=g,l.endCC=p,0<E&&d,E),l},d}();"./src/loader/playlist-loader.ts":function(t,e,i){"use strict";i.r(e);var c=i("./src/polyfills/number.ts"),g=i("./src/events.ts"),p=i("./src/errors.ts"),h=i("./src/utils/logger.ts"),n=i("./src/utils/mp4-tools.ts"),v=i("./src/loader/m3u8-parser.ts"),f=i("./src/types/loader.ts"),E=i("./src/utils/attr-list.ts");function _(t,e){t=t.url;return t=void 0!==t&&0!==t.indexOf("data:")?t:e.url}e.default=function(){ar e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.unregisterListeners=function(){var t=this.hls;t.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(g.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.createInternalLoader=e.getInternalLoader=e.resetInternalLoader=e.destroyInternalLoaders=e.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},e.onManifestLoading=e.onLevelLoading=e.onAudioTrackLoading=function(t,e){var i=e.id,s=e.groupId,n=e.url,e=e.deliveryDirectives;this.load({id:i,groupId:s,level:null,responseType:"text",type:f.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:e})},e.onSubtitleTrackLoading=e.load=function(t){var e,i,s,n,r=this.hls.config;if(o=this.getInternalLoader(t)){var a=o.context;if(a&&a.url===t.url)return void h.logger.trace("[playlist-loader]: playlist request ongoing");h.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),o.abort()}switch(t.type){case f.PlaylistContextType.MANIFEST:e=r.manifestLoadingMaxRetry,i=r.manifestLoadingTimeOut,s=r.manifestLoadingRetryDelay,n=r.manifestLoadingMaxRetryTimeout;break;case f.PlaylistContextType.LEVEL:case f.PlaylistContextType.AUDIO_TRACK:case f.PlaylistContextType.SUBTITLE_TRACK:e=0,i=r.levelLoadingTimeOut;break;default:e=r.levelLoadingMaxRetry,i=r.levelLoadingTimeOut,s=r.levelLoadingRetryDelay,n=r.levelLoadingMaxRetryTimeout}var o=this.createInternalLoader(t),a={timeout:i=null!=(a=t.deliveryDirectives)&&a.part&&(t.type===f.PlaylistContextType.LEVEL&&null!==t.level?l=this.hls.levels[t.level].details:t.type===f.PlaylistContextType.AUDIO_TRACK&&null!==t.id?l=this.hls.audioTracks[t.id].details:t.type===f.PlaylistContextType.SUBTITLE_TRACK&&null!==t.id&&(l=this.hls.subtitleTracks[t.id].details),l)&&(a=l.partTarget,l=l.targetduration,a)&&l?Math.min(1e3*Math.max(3*a,.8*l),i):i,maxRetry:e,retryDelay:s,maxRetryDelay:n,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};o.load(t,a,l)},e.loadsuccess=function(t,e,i,s){var n;void 0===s&&(s=null),i.isSidxRequest?(this.handleSidxRequest(t,i),this.handlePlaylistLoaded(t,e,i,s)):(this.resetInternalLoader(i.type),0!==(n=t.data).indexOf("#EXTM3U")?this.handleManifestParsingError(t,i,"no EXTM3U delimiter",s):(e.parsing.start=performance.now(),0<n.indexOf("#EXTINF:")||0<n.indexOf("#EXT-X-TARGETDURATION:")?this.handleTrackOrLevelPlaylist(t,e,i,s):this.handleMasterPlaylist(t,e,i,s)))},e.loaderror=e.loadtimeout=e.handleMasterPlaylist=function(t,e,i,s){var n,r,a=this.hls,o=t.data,l=_(t,i),d=v.default.parseMasterPlaylist(o,l),u=d.levels,d=d.sessionData;u.length?(n=u.map(function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}}),r=u.map(,n=v.default.parseMasterPlaylistMedia(o,l,"AUDIO",n),r=v.default.parseMasterPlaylistMedia(o,l,"SUBTITLES",r),o=v.default.parseMasterPlaylistMedia(o,l,"CLOSED-CAPTIONS"),n.length&&!n.some(&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(h.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new E.AttrList({}),bitrate:0,url:""})),a.trigger(g.Events.MANIFEST_LOADED,{levels:u,audioTracks:n,subtitles:r,captions:o,url:l,stats:e,networkDetails:s,sessionData:d})):this.handleManifestParsingError(t,i,"no level found in manifest",s)},e.handleTrackOrLevelPlaylist=function(t,e,i,s){var n=this.hls,r=i.id,a=i.level,o=i.type,l=_(t,i),d=Object(c.isFiniteNumber)(r)?r:0,u=Object(c.isFiniteNumber)(a)?a:d,h=i),u=v.default.parseLevelPlaylist(t.data,l,u,h,d);u.fragments.length?(o===f.PlaylistContextType.MANIFEST&&(h={attrs:new E.AttrList({}),bitrate:0,details:u,name:"",url:l},n.trigger(g.Events.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:l,stats:e,networkDetails:s,sessionData:null})),e.parsing.end=performance.now(),u.needSidxRanges?(h=null==(d=u.fragments[0].initSegment)?void 0:d.url,this.load({url:h,isSidxRequest:!0,type:o,level:a,levelDetails:u,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})):(i.levelDetails=u,this.handlePlaylistLoaded(t,e,i,s))):n.trigger(g.Events.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:l,reason:"no fragments found in level",level:"number"==typeof i.level?i.level:void 0})},e.handleSidxRequest=e.handleManifestParsingError=e.handleNetworkError=e.handlePlaylistLoaded=t}()},"./src/polyfills/number.ts":"./src/remux/aac-helper.ts":"./src/remux/mp4-generator.ts":function(t,e,i){"use strict";i.r(e);var r=Math.pow(2,32)-1,i=function(){function h(){}return h.init=function(){for(var t in h.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})h.types.hasOwnProperty(t)&&(h.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),e=(h.HDLR_TYPES={video:e,audio:i},new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),i=new Uint8Array([0,0,0,0,0,0,0,0]),i=(h.STTS=h.STSC=h.STCO=i,h.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),h.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),h.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),h.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),new Uint8Array([105,115,111,109])),s=new Uint8Array([97,118,99,49]),n=new Uint8Array([0,0,0,1]);h.FTYP=h.box(h.types.ftyp,i,n,i,s),h.DINF=h.box(h.types.dinf,h.box(h.types.dref,e))},h.box=h.hdlr=h.mdat=h.mdhd=h.mdia=h.mfhd=h.minf=h.moof=h.moov=h.mvex=h.mvhd=h.sdtp=h.stbl=h.avc1=h.esds=h.mp4a=h.mp3=h.stsd=h.tkhd=h.traf=h.trak=h.trex=h.trun=h.initSegment=h}();i.types=void 0,i.HDLR_TYPES=void 0,i.STTS=void 0,i.STSC=void 0,i.STCO=void 0,i.STSZ=void 0,i.VMHD=void 0,i.SMHD=void 0,i.STSD=void 0,i.FTYP=void 0,i.DINF=void 0,e.default=i},"./src/remux/mp4-remuxer.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s}),i.d(e,"normalizePts",function(){return Z});var c=i("./src/polyfills/number.ts"),w=i("./src/remux/aac-helper.ts"),K=i("./src/remux/mp4-generator.ts"),W=i("./src/events.ts"),Y=i("./src/errors.ts"),z=i("./src/utils/logger.ts"),T=i("./src/types/loader.ts"),q=i("./src/utils/timescale-conversion.ts");function X(){return(X=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(this,arguments)}var J=null,n=null,Q=!1,s=function(){function t(t,e,i,s){void 0===s&&(s=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=i,this.ISGenerated=!1,null===J&&(s=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),J=s?parseInt(s[1]):0),null===n&&(t=navigator.userAgent.match(/Safari\/(\d+)/i),n=t?parseInt(t[1]):0),Q=!!J&&J<75||!!n&&n<600}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=e.resetNextTimestamp=e.resetInitSegment=e.getVideoStartPts=e.remux=function(t,e,i,s,n,r,a,o){var l,d,u,h,c,g,p,v=n,f=n,E=-1<t.pid,_=-1<e.pid,m=e.samples.length,A=0<t.samples.length,S=1<m;return((!E||A)&&(!_||S)||this.ISGenerated||a)&&(this.ISGenerated||(u=this.generateIS(t,e,n)),E=this.isVideoContiguous,a=-1,S&&(a=e.samples),!E)&&this.config.forceKeyFrameOnDiscontinuity&&(g=!0,0<a?(z.logger.warn("[mp4-remuxer]: Dropped "+a+" out of "+m+" video samples due to a missing keyframe"),p=this.getVideoStartPts(e.samples),e.samples=e.samples.slice(a),e.dropped+=a,f+=(e.samples[0].pts-p)/(e.timescale||9e4)):-1===a&&(z.logger.warn("[mp4-remuxer]: No keyframe found out of "+m+" video samples"),g=!1)),this.ISGenerated)&&(A&&S&&(p=this.getVideoStartPts(e.samples),m=(Z(t.samples[0].pts,p)-p)/e.inputTimeScale,v+=Math.max(0,m),f+=Math.max(0,-m)),A?(t.samplerate||(z.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(t,e,n)),d=this.remuxAudio(t,v,this.isAudioContiguous,r,_||S||o===T.PlaylistLevelType.AUDIO?f:void 0),S&&(p=d?d.endPTS-d.startPTS:0,e.inputTimeScale||(z.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(t,e,n)),l=this.remuxVideo(e,f,E,p))):S&&(l=this.remuxVideo(e,f,E,0)),l)&&(l.firstKeyFrame=a,l.independent=-1!==a),{audio:d,video:l,initSegment:u,independent:g,text:h=this.ISGenerated&&(i.samples.length&&(c=this.remuxID3(i,n)),s.samples.length)?this.remuxText(s,n):h,id3:c}},e.generateIS=function(t,e,i){var s,n,r,a=t.samples,o=e.samples,l=this.typeSupported,d={},u=!Object(c.isFiniteNumber)(this._initPTS),h="audio/mp4";if(u&&(r=n=1/0),t.config&&a.length&&(t.timescale=t.samplerate,t.isAAC||(l.mpeg?(h="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),d.audio={id:"audio",container:h,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array(0):K.default.initSegment([t]),metadata:{channelCount:t.channelCount}},u)&&(s=t.inputTimeScale,r=n=a[0].pts-Math.round(s*i)),e.sps&&e.pps&&o.length&&(e.timescale=e.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:K.default.initSegment([e]),metadata:{width:e.width,height:e.height}},u)&&(s=e.inputTimeScale,h=this.getVideoStartPts(o),l=Math.round(s*i),n=Math.min(n,Z(o[0].dts,h)-l),r=Math.min(r,h-l)),Object.keys(d).length)return this.ISGenerated=!0,u&&(this._initPTS=r,this._initDTS=n),{tracks:d,initPTS:r,timescale:s}},e.remuxVideo=function(t,e,i,s){var n,r=t.inputTimeScale,a=t.samples,o=[],l=a.length,d=this._initPTS,u=this.nextAvcDts,h=8,c=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,p=0,v=!1;i&&null!==u||(u=e*r-(a[0].pts-Z(a[0].dts,a[0].pts)));for(var f=0;f<l;f++){var E=a[f];E.pts=Z(E.pts-d,u),E.dts=Z(E.dts-d,u),E.dts>E.pts&&(p=Math.max(Math.min(p,E.pts-E.dts),-18e3)),E.dts<a[0<f?f-1:f].dts&&(v=!0)}v&&a.sort(,_=a[0].dts;var _,e=a[a.length-1].dts,m=Math.round((e-_)/(l-1));if(p<0){if(p<-2*m){z.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(q.toMsFromMpegTsClock)(-m,!0)+" ms");for(var A=p,S=0;S<l;S++)a[S].dts=A=Math.max(A,a[S].pts-m),a[S].pts=Math.max(A,a[S].pts)}else{z.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(q.toMsFromMpegTsClock)(p,!0)+" ms to overcome this issue");for(var T=0;T<l;T++)a[T].dts=a[T].dts+p}_=a[0].dts}i&&((P=m<(i=_-u))||i<-1)&&(P?z.logger.warn("AVC: "+Object(q.toMsFromMpegTsClock)(i,!0)+" ms ("+i+"dts) hole between fragments detected, filling it"):z.logger.warn("AVC: "+Object(q.toMsFromMpegTsClock)(-i,!0)+" ms ("+i+"dts) overlapping between fragments detected"),_=u,P=a[0].pts-i,a[0].dts=_,a[0].pts=P,z.logger.log("Video: First PTS/DTS adjusted: "+Object(q.toMsFromMpegTsClock)(P,!0)+"/"+Object(q.toMsFromMpegTsClock)(_,!0)+", delta: "+Object(q.toMsFromMpegTsClock)(i,!0)+" ms")),Q&&(_=Math.max(0,_));for(var y=0,B=0,D=0;D<l;D++){for(var I=a[D],w=I.units,F=w.length,C=0,b=0;b<F;b++)C+=w[b].data.length;B+=C,y+=F,I.length=C,I.dts=Math.max(I.dts,_),I.pts=Math.max(I.pts,I.dts,0),c=Math.min(I.pts,c),g=Math.max(I.pts,g)}e=a[l-1].dts;var R,P=B+4*y+8;try{R=new Uint8Array(P)}catch(t){return void this.observer.emit(W.Events.ERROR,W.Events.ERROR,{type:Y.ErrorTypes.MUX_ERROR,details:Y.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:P,reason:"fail allocating video mdat "+P})}var j=new DataView(R.buffer);j.setUint32(0,P),R.set(K.default.types.mdat,4);for(var M=0;M<l;M++){for(var L,O=a[M],G=O.units,x=0,k=0,V=G.length;k<V;k++){var N=G[k],H=N.data,N=N.data.byteLength;j.setUint32(h,N),h+=4,R.set(H,h),h+=N,x+=4+N}M<l-1?n=a[M+1].dts-O.dts:(U=this.config,L=O.dts-a[0<M?M-1:M].dts,U.stretchShortVideoTrack&&null!==this.nextAudioPts&&Math.floor(U.maxBufferHole*r)<(U=(s?c+s*r:this.nextAudioPts)-O.pts)?((n=U-L)<0&&(n=L),z.logger.log("[mp4-remuxer]: It is approximately "+U/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=L);var U=Math.round(O.pts-O.dts);o.push(new $(O.key,n,x,U))}o.length&&J&&J<70&&((i=o[0].flags).dependsOn=2,i.isNonSync=0),console.assert(void 0!==n,"mp4SampleDuration must be computed"),this.nextAvcDts=u=e+n,this.isVideoContiguous=!0;P={data1:K.default.moof(t.sequenceNumber++,_,X({},t,{samples:o})),data2:R,startPTS:c/r,endPTS:(g+n)/r,startDTS:_/r,endDTS:u/r,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(R.length,"MDAT length must not be zero"),P},e.remuxAudio=function(t,e,i,s,n){var r=t.inputTimeScale,a=r/(t.samplerate||r),o=t.isAAC?1024:1152,l=o*a,d=this._initPTS,u=!t.isAAC&&this.typeSupported.mpeg,h=[],c=t.samples,g=u?0:8,p=this.nextAudioPts||-1,v=e*r;if(this.isAudioContiguous=i=i||c.length&&0<p&&(s&&Math.abs(v-p)<9e3||Math.abs(Z(c[0].pts-d,v)-p)<20*l),c.forEach(,!i||p<0){if(!(c=c.filter().length)return;p=0===n?0:s?Math.max(0,v):c[0].pts}if(t.isAAC)for(var f=void 0!==n,E=this.config.maxAudioFramesDrift,_=0,m=p;_<c.length;_++){var A=c[_],S=A.pts,T=S-m,y=Math.abs(1e3*T/r);if(T<=-E*l&&f)0===_&&(z.logger.warn("Audio frame @ "+(S/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*T/r)+" ms."),this.nextAudioPts=p=m=S);else if(E*l<=T&&y<1e4&&f){var D=Math.round(T/l);(m=S-D*l)<0&&(D--,m+=l),0===_&&(this.nextAudioPts=p=m),z.logger.warn("[mp4-remuxer]: Injecting "+D+" audio frame @ "+(m/r).toFixed(3)+"s due to "+Math.round(1e3*T/r)+" ms gap.");for(var I=0;I<D;I++){var C=Math.max(m,0),b=w.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);b||(z.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),b=A.unit.subarray()),c.splice(_,0,{unit:b,pts:C}),m+=l,_++}}A.pts=m,m+=l}for(var R,P=null,M=null,L=0,O=c.length;O--;)L+=c[O].unit.byteLength;for(var k=0,B=c.length;k<B;k++){var N=c[k],U=N.unit,N=N.pts;if(null!==M)h[k-1].duration=Math.round((N-M)/a);else{if(P=N=i&&t.isAAC?p:N,!(0<L))return;L+=g;try{R=new Uint8Array(L)}catch(t){return void this.observer.emit(W.Events.ERROR,W.Events.ERROR,{type:Y.ErrorTypes.MUX_ERROR,details:Y.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:L,reason:"fail allocating audio mdat "+L})}u||(new DataView(R.buffer).setUint32(0,L),R.set(K.default.types.mdat,4))}R.set(U,g);U=U.byteLength;g+=U,h.push(new $(!0,o,U,0)),M=N}e=h.length;if(e)return s=h[h.length-1],this.nextAudioPts=p=M+a*s.duration,n={data1:u?new Uint8Array(0):K.default.moof(t.sequenceNumber++,P/a,X({},t,{samples:h})),data2:R,startPTS:n=P/r,endPTS:s=p/r,startDTS:n,endDTS:s,type:"audio",hasAudio:!0,hasVideo:!(t.samples=[]),nb:e},this.isAudioContiguous=!0,console.assert(R.length,"MDAT length must not be zero"),n},e.remuxEmptyAudio=e.remuxID3=e.remuxText=t}();function Z(t,e){var i;if(null!==e)for(i=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=i;return t}var $=r=,"./src/remux/passthrough-remuxer.ts":function(t,e,i){"use strict";i.r(e);var h=i("./src/polyfills/number.ts"),c=i("./src/utils/mp4-tools.ts"),r=i("./src/loader/fragment.ts"),g=i("./src/utils/logger.ts"),p=.default=function(){ar e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=e.resetNextTimestamp=function(){this.lastEndDTS=null},e.resetInitSegment=e.generateInitSegment=function(t){var e,i,s=this.audioCodec,n=this.videoCodec;t&&t.byteLength?(e=this.initData=Object(c.parseInitSegment)(t),s=s||a(e.audio,r.ElementaryStreamTypes.AUDIO),n=n||a(e.video,r.ElementaryStreamTypes.VIDEO),i={},e.audio&&e.video?i.audiovideo={container:"video/mp4",codec:s+","+n,initSegment:t,id:"main"}:e.audio?i.audio={container:"audio/mp4",codec:s,initSegment:t,id:"audio"}:e.video?i.video={container:"video/mp4",codec:n,initSegment:t,id:"main"}:g.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i):(this.initTracks=void 0,this.initData=void 0)},e.remux=function(t,e,i,s,n){var r,a,o,l=this.initPTS,d=this.lastEndDTS,u={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0},n=(Object(h.isFiniteNumber)(d)||(d=this.lastEndDTS=n||0),e.samples);return n&&n.length&&(e={initPTS:void 0,timescale:1},(o=this.initData)&&o.length||(this.generateInitSegment(n),o=this.initData),o&&o.length?(this.emitInitSegment&&(e.tracks=this.initTracks,this.emitInitSegment=!1),Object(h.isFiniteNumber)(l)||(this.initPTS=e.initPTS=l=p(o,n,d)),r=(a=Object(c.getDuration)(n,o))+(d=d),Object(c.offsetStartDTS)(o,n,l),0<a?this.lastEndDTS=r:(g.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp()),l="",(a=!!o.audio)&&(l+="audio"),(o=!!o.video)&&(l+="video"),u.audio="audio"===(n={data1:n,startPTS:d,startDTS:d,endPTS:r,endDTS:r,type:l,hasAudio:a,hasVideo:o,nb:1,dropped:0}).type?n:void 0,u.video="audio"!==n.type?n:void 0,u.text=s,u.id3=i,u.initSegment=e):g.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment.")),u},t}()},"./src/task-loop.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s});var s=)},"./src/types/level.ts":"./src/types/loader.ts":"./src/types/transmuxer.ts":"./src/utils/attr-list.ts":"./src/utils/binary-search.ts":function(t,e,i){"use strict";i.r(e);e.default={search:function(t,e){for(var i=0,s=t.length-1;i<=s;){var n,r,a=e(r=t[n=(i+s)/2|0]);if(0<a)i=1+n;else{if(!(a<0))return r;s=n-1}}return null}}},"./src/utils/buffer-helper.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"BufferHelper",function(){return r});var s=i("./src/utils/logger.ts"),n={length:0,start:function(){return 0},end:,r=function(){function a(){}return a.isBuffered=a.bufferInfo=a.bufferedInfo=function(t,e,i){e=Math.max(0,e),t.sort(;var s=[];if(i)for(var n=0;n<t.length;n++){var r,a=s.length;a&&(r=s[a-1].end,t[n].start-r<i)?t[n].end>r&&(s[a-1].end=t[n].end):s.push(t[n])}else s=t;for(var o,l=0,d=e,u=e,h=0;h<s.length;h++){var c=s[h].start,g=s[h].end;if(c<=e+i&&e<g)d=c,l=(u=g)-e;else if(e+i<c){o=c;break}}return{len:l,start:d||0,end:u||0,nextStart:o}},a.getBuffered=a}()},"./src/utils/cea-608-parser.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"Row",function(){return f}),i.d(e,"CaptionScreen",function(){return E});r d,s=i("./src/utils/logger.ts"),n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},o={17:2,18:4,21:6,22:8,23:10,19:13,20:15},u={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],g=((i=d=d||{})[i.ERROR=0]="ERROR",i[i.TEXT=1]="TEXT",i[i.WARNING=2]="WARNING",i[i.INFO=2]="INFO",i[i.DEBUG=3]="DEBUG",i[i.DATA=3]="DATA",)),p=),v=),f=),E=function(){ar e=t.prototype;return e.reset=e.equals=e.copy=e.isEmpty=e.backSpace=function(){this.rows[this.currRow].backSpace()},e.clearToEndOfRow=e.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.moveCursor=e.setCursor=e.setPAC=function(t){this.logger.log(d.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var i=0;i<15;i++)this.rows[i].clear();var s=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var r=n.rows[s].cueStartTime,a=this.logger.time;if(r&&null!==a&&r<a)for(var o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(n.rows[s+o])}}this.currRow=e;r=this.rows[this.currRow],null!==t.indent&&(a=t.indent,a=Math.max(a-1,0),r.setCursor(t.indent),t.color=r.chars[a].penState.foreground),r={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(r)},e.setBkgData=e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){var t;null===this.nrRollUpRows?this.logger.log(d.DEBUG,"roll_up but nrRollUpRows not set yet"):(this.logger.log(d.TEXT,this.getDisplayText()),t=this.currRow+1-this.nrRollUpRows,(t=this.rows.splice(t,1)[0]).clear(),this.rows.splice(this.currRow,0,t),this.logger.log(d.INFO,"Rolling up"))},e.getDisplayText=function(t){t=t||!1;for(var e=[],i="",s=0;s<15;s++){var n=this.rows[s].getTextString();n&&e.push(t?"Row "+(s+1)+": '"+n+"'":n.trim())}return i=0<e.length?t?"["+e.join(" | ")+"]":e.join("\n"):i},e.getTextAndFormat=function(){return this.rows},t}(),_=function(){ar e=t.prototype;return e.reset=e.getHandler=function(){return this.outputFilter},e.setHandler=e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=e.setMode=e.insertChars=e.ccRCL=function(){this.logger.log(d.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(d.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory)&&this.outputDataUpdate()},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=e.ccRU=e.ccFON=e.ccRDC=function(){this.logger.log(d.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(d.INFO,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=e.ccEDM=function(){this.logger.log(d.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=e.ccENM=e.ccEOC=e.ccTO=e.ccMIDROW=e.outputDataUpdate=e.cueSplitAtTime=function(t){!this.outputFilter||this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t)},t}(),i=function(){ar e=t.prototype;return e.getHandler=e.setHandler=e.addData=function(t,e){var i,s=!1;this.logger.time=t;for(var n=0;n<e.length;n+=2){var r,a=127&e[n],o=127&e[n+1];0==a&&0==o||(this.logger.log(d.DATA,"["+l([e[n],e[n+1]])+"] -> ("+l([a,o])+")"),(i=(i=(i=(i=this.parseCmd(a,o))||this.parseMidrow(a,o))||this.parsePAC(a,o))||this.parseBackgroundAttributes(a,o))||(s=this.parseChars(a,o))&&((r=this.currentChannel)&&0<r?this.channels[r].insertChars(s):this.logger.log(d.WARNING,"No channel found yet. TEXT-MODE?")),i)||s||this.logger.log(d.WARNING,"Couldn't parse cleaned data "+l([a,o])+" orig: "+l([e[n],e[n+1]]))}},e.parseCmd=function(t,e){var i,s,n=this.cmdHistory;return((20===t||28===t||21===t||29===t)&&32<=e&&e<=47||(23===t||31===t)&&33<=e&&e<=35)&&(A(t,e,n)?(m(null,null,n),this.logger.log(d.DEBUG,"Repeated command ("+l([t,e])+") is dropped")):(s=this.channels[i=20===t||21===t||23===t?1:2],20===t||21===t||28===t||29===t?32===e?s.ccRCL():33===e?s.ccBS():34===e?s.ccAOF():35===e?s.ccAON():36===e?s.ccDER():37===e?s.ccRU(2):38===e?s.ccRU(3):39===e?s.ccRU(4):40===e?s.ccFON():41===e?s.ccRDC():42===e?s.ccTR():43===e?s.ccRTD():44===e?s.ccEDM():45===e?s.ccCR():46===e?s.ccENM():47===e&&s.ccEOC():s.ccTO(e-32),m(t,e,n),this.currentChannel=i),!0)},e.parseMidrow=function(t,e){var i=0;return(17===t||25===t)&&32<=e&&e<=47&&((i=17===t?1:2)!==this.currentChannel?(this.logger.log(d.ERROR,"Mismatch channel in midrow parsing"),!1):!!(i=this.channels[i])&&(i.ccMIDROW(e),this.logger.log(d.DEBUG,"MIDROW ("+l([t,e])+")"),!0))},e.parsePAC=function(t,e){var i=this.cmdHistory;if(!((17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127)&&!((16===t||24===t)&&64<=e&&e<=95))return!1;if(A(t,e,i))m(null,null,i);else{var s=t<=23?1:2,n=(64<=e&&e<=95?1==s?a:u:1==s?o:h)[t],r=this.channels[s];if(!r)return!1;r.setPAC(this.interpretPAC(n,e)),m(t,e,i),this.currentChannel=s}return!0},e.interpretPAC=e.parseChars=function(t,e){var i,s=null,n=null;return 17<=(n=25<=t?(i=2,t-8):(i=1,t))&&n<=19?(this.logger.log(d.INFO,"Special char '"+r(n=17===n?e+80:18===n?e+112:e+144)+"' in channel "+i),s=[n]):32<=t&&t<=127&&(s=0===e?[t]:[t,e]),s&&(i=l(s),this.logger.log(d.DEBUG,"Char codes =  "+i.join(",")),m(t,e,this.cmdHistory)),s},e.parseBackgroundAttributes=function(t,e){var i,s;return((16===t||24===t)&&32<=e&&e<=47||(23===t||31===t)&&45<=e&&e<=47)&&(s={},16===t||24===t?(i=Math.floor((e-32)/2),s.background=c[i],e%2==1&&(s.background=s.background+"_semi")):45===e?s.background="transparent":(s.foreground="black",47===e&&(s.underline=!0)),this.channels[t<=23?1:2].setBkgData(s),m(t,e,this.cmdHistory),!0)},e.reset=e.cueSplitAtTime=t}();efault=i},"./src/utils/codecs.ts":"./src/utils/cues.ts":"./src/utils/discontinuities.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"findFirstFragWithCC",function(){return s}),i.d(e,"shouldAlignOnDiscontinuities",function(){return l}),i.d(e,"findDiscontinuousReferenceFrag",function(){return d}),i.d(e,"adjustSlidingStart",function(){return h}),i.d(e,"alignStream",function(){return n}),i.d(e,"alignPDT",function(){return c});var r=i("./src/polyfills/number.ts"),a=i("./src/utils/logger.ts"),o=i("./src/controller/level-helper.ts");nction d(t,e){t=t.fragments,e=e.fragments;if(e.length&&t.length){t=s(t,e[0].cc);if(t&&t.startPTS)return t;a.logger.log("No frag in previous level to align on")}else a.logger.log("No fragments to align")}nction n(t,e,i){var s,n;e&&(l(t=t,n=e,s=i)&&(t=d(n.details,s))&&Object(r.isFiniteNumber)(t.start)&&(a.logger.log("Adjusting PTS using last level due to CC increase within current level "+s.url),h(t.start,s)),!i.alignedSliding&&e.details&&c(i,e.details),i.alignedSliding||!e.details||i.skippedSegments||Object(o.adjustSliding)(e.details,i))}function c(t,e){var i,s;e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime&&(i=e.fragments[0].programDateTime,e=((s=t.fragments[0].programDateTime)-i)/1e3+e.fragments[0].start)&&Object(r.isFiniteNumber)(e)&&(a.logger.log("Adjusting PTS using programDateTime delta "+(s-i)+"ms, sliding:"+e.toFixed(3)+" "+t.url+" "),h(e,t))}},"./src/utils/ewma-bandwidth-estimator.ts":function(t,e,i){"use strict";i.r(e);var n=i("./src/utils/ewma.ts"),i=);e.default=i},"./src/utils/ewma.ts":function(t,e,i){"use strict";i.r(e);i=);e.default=i},"./src/utils/fetch-loader.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"fetchSupported",function(){return l});var h=i("./src/polyfills/number.ts"),s=i("./src/loader/load-stats.ts"),d=i("./src/demux/chunk-cache.ts");unction r(t,e,i){return(r=)?Reflect.construct:.apply(null,arguments)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function(){ar e=t.prototype;return e.destroy=e.abortInternal=e.abort=function(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(s,n,r){var a=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var t=function(t,e){e={method:"GET",mode:"cors",credentials:"same-origin",signal:e};t.rangeEnd&&(e.headers=new self.Headers({Range:"bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)}));return e}(s,this.controller.signal),l=r.onProgress,d="arraybuffer"===s.responseType,u=d?"byteLength":"length";this.context=s,this.config=n,this.callbacks=r,this.request=this.fetchSetup(s,t),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(n.timeout),self.fetch(this.request).then(function(t){var e,i;if((a.response=a.loader=t).ok)return o.loading.first=Math.max(self.performance.now(),o.loading.start),o.total=parseInt(t.headers.get("Content-Length")||"0"),l&&Object(h.isFiniteNumber)(n.highWaterMark)?a.loadProgressively(t,o,s,n.highWaterMark,l):d?t.arrayBuffer():t.text();throw e=t.status,i=t.statusText,new c(i||"fetch, bad network response",e,t)}).then(function(t){var e=a.response,i=(self.clearTimeout(a.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first),o.loaded=o.total=t[u],{url:e.url,data:t});l&&!Object(h.isFiniteNumber)(n.highWaterMark)&&l(o,s,t,e),r.onSuccess(i,o,s,e)}).catch(},e.getCacheAge=e.loadProgressively=function(s,n,r,a,o){void 0===a&&(a=0);var l=new d.default,t=s.body.getReader();return function i(){return t.read().then(function(t){var e;return t.done?(l.dataLength&&o(n,r,l.flush(),s),Promise.resolve(new ArrayBuffer(0))):(e=(t=t.value).length,n.loaded+=e,e<a||l.dataLength?(l.push(t),l.dataLength>=a&&o(n,r,l.flush(),s)):o(n,r,t,s),i())}).catch(function(){return Promise.reject()})}()},t}();ar c=n(Error));e.default=i},"./src/utils/imsc1-ttml-parser.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"IMSC1_CODEC",function(){return s}),i.d(e,"parseIMSC1",function(){return n});var a=i("./src/utils/mp4-tools.ts"),o=i("./src/utils/vttparser.ts"),g=i("./src/utils/vttcue.ts"),l=i("./src/demux/id3.ts"),d=i("./src/utils/timescale-conversion.ts"),p=i("./src/utils/webvtt-parser.ts");ar s="stpp.ttml.im1t",u=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,f={left:"start",center:"center",right:"end",start:"start",end:"end"};function n(t,e,i,s,n){var r=Object(a.findBox)(new Uint8Array(t),["mdat"]);if(0===r.length)n(new Error("Could not parse IMSC1 mdat"));else{r=r[0],t=Object(l.utf8ArrayToStr)(new Uint8Array(t,r.start,r.end-r.start)),r=Object(d.toTimescaleFromScale)(e,1,i);try{s(function(t,l){var i,d,u,h,c,s=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(s)return i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},d=Object.keys(i).reduce({}),u="preserve"!==s.getAttribute("xml:space"),h=_(E(s,"styling","style")),c=_(E(s,"layout","region")),t=E(s,"body","[begin]"),[].map.call(t,function(t){var e=function s(t,n){return[].slice.call(t.childNodes).reduce(function(t,e,i){return"br"===e.nodeName&&i?t+"\n":null!=(i=e.childNodes)&&i.length?s(e,n):n?t+e.textContent.trim().replace(/\s+/g," "):t+e.textContent},"")}(t,u);if(!e||!t.hasAttribute("begin"))return null;var i=S(t.getAttribute("begin"),d),s=S(t.getAttribute("dur"),d),n=S(t.getAttribute("end"),d);if(null===i)throw A(t);if(null===n){if(null===s)throw A(t);n=i+s}var r,a,o,s=new g.default(i-l,n-l,e),i=(s.id=Object(p.generateCueId)(s.startTime,s.endTime,s.text),c[t.getAttribute("region")]),n=h[t.getAttribute("style")],e=(s.position=10,s.size=80,r=i,a=n,o="http://www.w3.org/ns/ttml#styling",["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce({})),t=e.textAlign;return t&&((i=f[t])&&(s.lineAlign=i),s.align=t),v(s,e),s}).filter(;throw new Error("Invalid ttml")}(t,r))}catch(t){n(t)}}}tion S(t,e){var i,s,n,r;return t?(null===(i=Object(o.parseTimeStamp)(t))&&(u.test(t)?(s=t,n=e,s=u.exec(s),r=(0|s[4])+(0|s[5])/n.subFrameRate,i=3600*(0|s[1])+60*(0|s[2])+(0|s[3])+r/n.frameRate):h.test(t)&&(i=t,e))),i):null}},"./src/utils/logger.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"enableLogs",function(){return o}),i.d(e,"logger",function(){return l});function n(){}var s={trace:n,debug:n,log:n,warn:n,info:n,error:n},r=s;r l=r},"./src/utils/mediakeys-helper.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"KeySystems",function(){return s}),i.d(e,"requestMediaKeySystemAccess",function(){return n}),(i=s=s||{}).WIDEVINE="com.widevine.alpha",i.PLAYREADY="com.microsoft.playready";var s,n="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":"./src/utils/mp4-tools.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"bin2str",function(){return u}),i.d(e,"readUint16",function(){return c}),i.d(e,"readUint32",function(){return E}),i.d(e,"writeUint32",function(){return a}),i.d(e,"findBox",function(){return _}),i.d(e,"parseSegmentIndex",function(){return m}),i.d(e,"parseInitSegment",function(){return n}),i.d(e,"getStartDTS",function(){return o}),i.d(e,"getDuration",function(){return l}),i.d(e,"computeRawDurationFromSamples",function(){return A}),i.d(e,"offsetStartDTS",function(){return h}),i.d(e,"segmentValidRange",function(){return g}),i.d(e,"appendUint8Array",function(){return p});var s=i("./src/utils/typed-array.ts"),f=i("./src/loader/fragment.ts"),r=Math.pow(2,32)-1,d=[].push;tion _(t,e){var i=[];if(e.length)for(var s,n,r=("data"in t?(s=t.data,n=t.start,t.end):(n=0,(s=t).byteLength)),a=n;a<r;){var o,l=E(s,a),l=1<l?a+l:r;u(s.subarray(a+4,a+8))===e[0]&&(1===e.length?i.push({data:s,start:a+8,end:l}):(o=_({data:s,start:a+8,end:l},e.slice(1))).length&&d.apply(i,o)),a=l}return i}function m(t){var e=_(t,["moov"])[0],e=e?e.end:null,t=_(t,["sidx"]);if(!t||!t[0])return null;var i=[],s=t[0],t=s.data[0],n=0===t?8:16,r=E(s,n),a=s.end+0,o=c(s,n=(n+=4)+(0===t?8:16)+2);n+=2;for(var l=0;l<o;l++){var d=n,u=E(s,d),h=(d+=4,2147483647&u);if(1==(2147483648&u)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;u=E(s,d);d+=4,i.push({referenceSize:h,subsegmentDuration:u,info:{duration:u/r,start:a,end:a+h-1}}),a+=h,n=d+=4}return{earliestPresentationTime:0,timescale:r,version:t,referencesCount:o,references:i,moovEndOffset:e}}function n(t){for(var i=[],e=_(t,["moov","trak"]),s=0;s<e.length;s++){var n,r,a,o=e[s],l=_(o,["tkhd"])[0];l&&(l=E(l,0===l.data[l.start]?12:20),n=_(o,["mdia","mdhd"])[0])&&(n=E(n,0===n.data[n.start]?12:20),r=_(o,["mdia","hdlr"])[0])&&(r=u(r.data.subarray(r.start+8,r.start+12)),r={soun:f.ElementaryStreamTypes.AUDIO,vide:f.ElementaryStreamTypes.VIDEO}[r])&&(a=void 0,(o=_(o,["mdia","minf","stbl","stsd"])[0])&&(a=u(o.data.subarray(o.start+12,o.start+16))),i[l]={timescale:n,type:r},i[r]={timescale:n,id:l,codec:a})}return _(t,["moov","mvex","trex"]).forEach(,i}function o(r,t){return _(t,["moof","traf"]).reduce(function(t,e){var s=_(e,["tfdt"])[0],n=s.data[s.start],e=_(e,["tfhd"]).reduce(function(t,e){e=E(e,4),e=r[e];if(e){var i=E(s,4),e=(1===n&&(i=(i*=Math.pow(2,32))+E(s,8)),e.timescale||9e4),i=i/e;if(isFinite(i)&&(null===t||i<t))return i}return t},null);return null!==e&&isFinite(e)&&(null===t||e<t)?e:t},null)||0}function l(t,e){for(var i=0,s=0,n=0,r=_(t,["moof","traf"]),a=0;a<r.length;a++){var o=r[a],l=_(o,["tfhd"])[0],d=e[E(l,4)];if(d)for(var u=d.default,h=E(l,0)|(null==u?void 0:u.flags),c=null==u?void 0:u.duration,g=(8&h&&(c=E(l,2&h?12:8)),d.timescale||9e4),p=_(o,["trun"]),v=0;v<p.length;v++)i=c?c*E(p[v],4):A(p[v]),d.type===f.ElementaryStreamTypes.VIDEO?s+=i/g:d.type===f.ElementaryStreamTypes.AUDIO&&(n+=i/g)}if(0===s&&0===n){t=m(t);if(null!=t&&t.references)return t.references.reduce(0)}return s||n}function A(t){for(var e=E(t,0),i=8,s=(1&e&&(i+=4),4&e&&(i+=4),0),n=E(t,4),r=0;r<n;r++)256&e&&(s+=E(t,i),i+=4),512&e&&(i+=4),1024&e&&(i+=4),2048&e&&(i+=4);return s}function h(i,t,n){_(t,["moof","traf"]).forEach(function(e){_(e,["tfhd"]).forEach(function(t){var s,t=E(t,4),t=i[t];t&&(s=t.timescale||9e4,_(e,["tfdt"]).forEach(function(t){var e=t.data[t.start],i=E(t,4);0===e?a(t,4,i-n*s):(i=(i=(i*=Math.pow(2,32))+E(t,8))-n*s,i=Math.max(i,0),e=Math.floor(i/(r+1)),i=Math.floor(i%(r+1)),a(t,4,e),a(t,8,i))}))})})}function g(t){var e={valid:null,remainder:null},i=_(t,["moof"]);return i&&(i.length<2?e.remainder=t:(i=i[i.length-1],e.valid=Object(s.sliceUint8)(t,0,i.start-8),e.remainder=Object(s.sliceUint8)(t,i.start-8))),e},"./src/utils/output-filter.ts":"./src/utils/texttrack-utils.ts":"./src/utils/time-ranges.ts":"./src/utils/timescale-conversion.ts":"./src/utils/typed-array.ts":"./src/utils/vttcue.ts":function(t,e,i){"use strict";function m(t,e){return"string"==typeof e&&!!Array.isArray(t)&&(e=e.toLowerCase(),!!~t.indexOf(e))&&e}nction s(t,e,i){var s=this,n={enumerable:!0},r=(s.hasBeenReset=!1,""),a=!1,o=t,l=e,d=i,u=null,h="",c=!0,g="auto",p="start",v=50,f="middle",E=50,_="middle";Object.defineProperty(s,"id",S({},n,{get:function(){return r},set:)),Object.defineProperty(s,"pauseOnExit",S({},n,{get:function(){return a},set:)),Object.defineProperty(s,"startTime",S({},n,{get:function(){return o},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");o=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",S({},n,{get:function(){return l},set:)),Object.defineProperty(s,"text",S({},n,{get:function(){return d},set:)),Object.defineProperty(s,"region",S({},n,{get:function(){return u},set:)),Object.defineProperty(s,"vertical",S({},n,{get:function(){return h},set:)),Object.defineProperty(s,"snapToLines",S({},n,{get:function(){return c},set:)),Object.defineProperty(s,"line",S({},n,{get:function(){return g},set:)),Object.defineProperty(s,"lineAlign",S({},n,{get:function(){return p},set:function(t){t=A(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",S({},n,{get:function(){return v},set:function(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",S({},n,{get:function(){return f},set:function(t){t=A(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",S({},n,{get:function(){return E},set:)),Object.defineProperty(s,"align",S({},n,{get:function(){return _},set:)),s.displayState=void 0}var T,n;i.r(e),e.default="undefined"!=typeof self&&self.VTTCue?self.VTTCue:(T=["","lr","rl"],n=["start","middle","end","left","right"],s.prototype.getCueAsHTML=s)},"./src/utils/vttparser.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"parseTimeStamp",function(){return l}),i.d(e,"fixLineBreaks",function(){return g}),i.d(e,"VTTParser",function(){return n});var o=i("./src/utils/vttcue.ts"),s=);ar d=function(){ar e=t.prototype;return e.set=e.get=e.has=e.alt=e.integer=e.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)&&(0<=(e=parseFloat(e))&&e<=100))return this.set(t,e),!0;return!1},t}();ar h=new o.default(0,0,""),c="middle"===h.align?"middle":"center";ar n=t}()},"./src/utils/webvtt-parser.ts":function(t,e,i){"use strict";i.r(e),i.d(e,"generateCueId",function(){return D}),i.d(e,"parseWebVTn});var r=i("./src/polyfills/number.ts"),E=i("./src/utils/vttparser.ts"),_=i("./src/demux/id3.ts"),m=i("./src/utils/timescale-conversion.ts"),A=i("./src/remux/mp4-remuxer.ts"),S=/\r\n|\n\r|\n|\r/ge},y=function(t){var e=parseInt(t.substr(-3)),i=parseInt(t.substr(-6,2)),s=parseInt(t.substr(-9,2)),n=9<t.length?parseInt(t.substr(0,t.indexOf(":"))):0;if(Object(r.isFiniteNumber)(e)&&Object(r.isFiniteNumber)(i)&&Object(r.isFiniteNumber)(s)&&Object(r.isFiniteNumber)(n))return(e+=1e3*i)+6e4*s+36e5*n;throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t)})}var I=function(t,e,i){var s,n=t[e],r=t[n.prevCC];if(!r||!r.new&&n.new)t.ccOffset=t.presentationOffset=n.start,n.new=!1;else{for(;null!=(s=r)&&s.new;)t.ccOffset+=n.start-r.start,n.new=!1,r=t[(n=r).prevCC];t.presentationOffset=i}};function n(t,e,i,n,r,a,s,o){var l,d=new E.VTTParser,t=Object(_.utf8ArrayToStr)(new Uint8Array(t)).trim().replace(S,"\n").split("\n"),u=[],h=Object(m.toMpegTsClockFromTimescale)(e,i),c="00:00.000",g=0,p=0,v=!0,f=!1;d.oncue=function(t){var e=n[r],i=n.ccOffset,s=(g-h)/9e4,i=(null!=e&&e.new&&(void 0!==p?i=n.ccOffset=e.start:I(n,r,s)),s&&(i=s-n.presentationOffset),f&&(e=t.endTime-t.startTime,s=Object(A.normalizePts)(9e4*(t.startTime+i-p),9e4*a)/9e4,t.startTime=s,t.endTime=s+e),t.text.trim());t.text=decodeURIComponent(encodeURIComponent(i)),t.id||(t.id=D(t.startTime,t.endTime,i)),0<t.endTime&&u.push(t)},d.onparsingerrt},d.onflu)},t.forEa)}),d.flush()}},"./src/utils/xhr-loader.ts":function(t,e,i){"use strict";i.r(e);var o=i("./src/utils/logger.ts"),s=i("./src/loader/load-stats.ts"),n=/^age:\s*[\d.]+\s*$/m,i=function0}var e=t.prototype;return e.destrl},e.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState)&&(this.stats.aborted=!0,t.abort())},e.abo)},e.lo)},e.loadInternal=function(){var t=this.config,e=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,s=this.stats,s=(s.loading.first=0,s.loaded=0,this.xhrSetup);try{if(s)try{s(i,e.url)}catch(t){i.open("GET",e.url,!0),s(i,e.url)}i.readyState||i.open("GET",e.url,!0)}catch(t){return void this.callbacks.onError({code:i.status,text:t.message},e,i)}e.rangeEnd&&i.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),i.send()}},e.readystatechange=function(){var t,e,i,s,n=this.context,r=this.loader,a=this.stats;n&&r&&(e=r.readyState,t=this.config,a.aborted||2<=e&&(self.clearTimeout(this.requestTimeout),0===a.loading.first&&(a.loading.first=Math.max(self.performance.now(),a.loading.start)),4===e?(r.onreadystatechange=null,r.onprogress=null,200<=(e=r.status)&&e<300?(a.loading.end=Math.max(self.performance.now(),a.loading.first),s="arraybuffer"===n.responseType?(i=r.response).byteLength:(i=r.responseText).length,a.loaded=a.total=s,this.callbacks&&((s=this.callbacks.onProgress)&&s(a,n,i,r),this.callbacks)&&(s={url:r.responseURL,data:i},this.callbacks.onSuccess(s,a,n,r))):a.retry>=t.maxRetry||400<=e&&e<499?(o.logger.error(e+" while loading "+n.url),this.callbacks.onError({code:e,text:r.statusText},n,r)):(o.logger.warn(e+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,t.maxRetryDelay),a.retry++)):(self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout))))},e.loadtimeo)},e.loadprogre)},e.getCacheAe},t}();e.default=i}},s={},n.m=i,n.c=s,n)},n)},ni},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s="./src/hls.ts").default;function n(t){var e;return(s[t]||(e=s[t]={i:t,l:!1,exports:{}},i[t].call(e.exports,e,e.exports,n),e.l=!0,e)).exports}var i,s},"object"==typeof exports&&"object"==typeof module?module.exports=e():"object"==typeof exports?exports.Hls=e():t.Hls=e()),function(t){"use strict";var a,e,i,s,n;if(t){var r,o=t.crypto||t.msCrypto;if(!a&&o&&o.getRandomValues)try{var l=new Uint8Array(16);sl},a()}catch(t){}a||(r=new Array(16),er},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()"))}for(var d="function"==typeof Buffer?Buffer:Array,u=[],h={},c=0;c<256;c++)u[c]=(c+256).toString(16).substr(1),h[u[c]]=c;function g(t,e){e=e||0;return u[t[e++]]+u[t[e++]]+u[t[e++]]+u[t[e++]]+"-"+u[t[e++]]+u[t[e++]]+"-"+u[t[e++]]+u[t[e++]]+"-"+u[t[e++]]+u[t[e++]]+"-"+u[t[e++]]+u[t[e++]]+u[t[e++]]+u[t[e++]]+u[t[e++]]+u[t[+e]]}var p=a(),v=[1|p[0],p[1],p[2],p[3],p[4],p[5]],f=16383&(p[6]<<8|p[7]),E=0,_=0;function m(t,e,i){var s=e&&i||0,n=("string"==typeof t&&(e="binary"===t?new d(16):null,t=null),(t=t||{}).random||(t.rng||a)());if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e)for(var r=0;r<16;r++)e[s+r]=n[r];return e||g(n)}var A=m;A.v1=function(t,e,i){var s=e&&i||0,n=e||[],i=null!=(t=t||{}).clockseq?t.clockseq:f,r=null!=t.msecs?t.msecs:(new Date).getTime(),a=null!=t.nsecs?t.nsecs:_+1;if((o=r-E+(a-_)/1e4)<0&&null==t.clockseq&&(i=i+1&16383),1e4<=(a=(o<0||E<r)&&null==t.nsecs?0:a))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");E=r,f=i;for(var o=(1e4*(268435455&(r+=122192928e5))+(_=a))%4294967296,a=(n[s++]=o>>>24&255,n[s++]=o>>>16&255,n[s++]=o>>>8&255,n[s++]=255&o,r/4294967296*1e4&268435455),l=(n[s++]=a>>>8&255,n[s++]=255&a,n[s++]=a>>>24&15|16,n[s++]=a>>>16&255,n[s++]=i>>>8|128,n[s++]=255&i,t.node||v),d=0;d<6;d++)n[s+d]=l[d];return e||g(n)},A.v4=m,A.pare},A.unparse=g,A.BufferClass=d,A._rng=a,A._mathRNG=e,A._nodeRNG=i,A._whatwgRNG=s,"undefined"!=typeof module&&module.exports?module.exports=A:(n=t.uuid,A.noConfliA},t.uuid=A)}("undefined"!=typeof window?window:null);var Dt,It,Ct=document.attachEvent,bt=!1;if(!Ct){It=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFram)};var Rt=function(t){return It(t)},Pt=(Dt=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout,function(t){return Dt(t)t}function Lt(e){var i=this;Mt(this),this.__resizeRAF__&&Pt(this.__resizeRAF__),this.__resizeRAF__=Rt(function(){var t;(t=i).offsetWidth==t.__resizeLast__.width&&t.offsetHeight==t.__resizeLast__.height||(i.__resizeLast__.width=i.offsetWidth,i.__resizeLast__.height=i.offsetHeight,i.__resizeListeners__.forEach(function(t){t.call(i,e)}))})}var Ot=!1,kt="",Nt="animationstart",Ut="Webkit Moz O ms".split(" "),Bt="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),wt="",Ft=document.createElement("fakeelement");if(!1===(Ot=void 0!==Ft.style.animationName?!0:Ot))for(var B=0;B<Ut.length;B++)if(void 0!==Ft.style[Ut[B]+"AnimationName"]){wt=Ut[B],kt="-"+wt.toLowerCase()+"-",Nt=Bt[B],Ot=!0;break}var jt="resizeanim",Gt="@"+kt+"keyframes "+jt+" { from { opacity: 0; } to { opacity: 0; } } ",xt=kt+"animation: 1ms "+jt+"; "}function Vt(t){return(0<t&&t<10?"0":"")+t.toString()}window.addResizeListener=function(e,t){var i,s,n;Ct?e.attachEvent("onresize",t):(e.__resizeTriggers__||("static"==getComputedStyle(e).position&&(e.style.position="relative"),bt||(i=(Gt||"")+".resize-triggers { "+(xt||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',s=document.head||document.getElementsByTagName("head")[0],(n=document.createElement("style")).type="text/css",n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i)),s.appendChild(n),bt=!0),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=document.createElement("div")).className="resize-triggers",e.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e.appendChild(e.__resizeTriggers__),Mt(e),e.addEventListener("scroll",Lt,!0),Nt&&e.__resizeTriggers__.addEventListener()})),e.__resizeListeners__.push(t))},window.removeResizeListen)},t=this,e=function(){"use stricv,f,t,r=["webkit","Moz","ms","O"],E={},n={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute)}return i.defaults={},e(i.prototype,{spd},sts},lint},opaci)}}),"undefined"!=typeof document&&(t=c("style",{type:"text/css"}),h(document.getElementsByTagName("head")[0],t),f=t.sheet||t.styleSheet,!s(t=g(c("group"),{behavior:"url(#default#VML)"}),"transform")&&t.adj?(f.addRule(".spin-vml","behavior:url(#default#VML)"),i.prototype.lin)},i.prototype.opaci)}):v=s(t,"animation")),i},"object"==typeof module&&module.exports?module.exports=e():t.Spinner=e(),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_BUFFERING:"onAdBuffering",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",AD_VOLUME_CHANGE:"onAdVolumeChange",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},ErrorCode:{1001:"1200",1002:"",1003:"",2e3:"1000",2001:"1101",2002:"1100",2003:"1106",2004:"2004",2005:"2000",3e3:"3400",3001:"3100",3002:"3001",3003:"3200",3004:"3101",3005:"",3006:"3002",3007:"3102",3008:"3202",3009:"3401",3011:"3300",3012:"3301",3013:"",4e3:"4000",4001:"4300"},mapErrorCot},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam"},getVideoManag)},register:function(t){for(var e,i=t.split("."),s=window,n=i.length,r=0;r<n;r++)void 0===s[e=i[r]]&&(s[e]={}),s=s[e];return s},getClass:function(t){var e,i,s,n,r,a;if("string"!=typeof t)return t;for(e=t.split("."),i=window,s=e.length,n="",r=0;r<s;r++){if(n+=a=e[r],void 0===i[a])throw new Error("uvpjs.getClass(): "+n+" is undefined.");r<s-1&&(n+="."),i=i[a]}return i},getObject:function(t){return uvpjs.getClass(t)}},function(){var o=!1,l=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(t){var e,i,s,n,r=this.prototype;for(n in o=!0,i=new this,o=!1}},t)t.hasOwnProperty(n)&&(s=t[n],i[n]="function"==typeof s&&"function"==typeof r[n]&&l.test(s)?e(n,s):)}return((a.prototype=i).constructor=a).subClass=arguments.callee,a}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),uvpjs.register("uvpjs").b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",function(){"use strict";uvpjs.register("uvpjs").util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(t){return t&&this.xhrMessages[t]||"XHR status: "+t},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(t){var e=document.createElement("a");return e.href=t,{host:e.hostname,pathname:e.pathname,protocol:e.protocol,search:e.search}},objFromQueryStr:function(t){for(var e,t="string"==typeof t?t:"",i=(-1<t.indexOf("?")?t.split("?")[1]:t).split("&"),s={},n=0,r=i.length;n<r;n++)s[(e=i[n].split("="))[0]]=e[1];return s},queryStrFromObj:function(t,e){var i,s="",n=!1;for(i in t)s+=(n?"&":"")+i+"="+(e?encodeURIComponent(t[i]):t[i]),n=!0;return s},uid8:function)}return t()+t()},getUserStatusForQuery:function(t){var e="";switch(t){case"anon":e="sb=0";break;case"reg;sub;pay":e="sb=1";break;case"reg":e="sb=2";break;case"reg;sub;susp":e="sb=3";break;case"reg;sub;exsub":e="sb=4";break;case"reg;sub;trial":e="sb=5";break;default:if(-1<t.indexOf("|")){var i,s,n,r="",a=t.split(","),o=a.length;for(a.sort(),n=0;n<o;n++)2==(s=a[n].split("|")).length&&(i=s[0],s=s[1],r!=i?(0<e.length&&(e+="&"),e+=i+"="+s):e+=","+s,r=i)}}return e=""==e?"sb=0":e},firstInt:function(){for(var t,e=arguments.length,i=0;i<e;i++)if(t=arguments[i],parseInt(t)===t)return t},inRange:function(t,e,i){return"number"==typeof t&&e<=t&&t<=i},isEmpty:function(t){return null==t||Array.isArray(t)&&0===t.length||"object"==typeof t&&0===Object.keys(t).length||"string"==typeof t&&""===t},isPlainObjet},isFunctit},isDefinedStri)},isNumb)},isDefint},isFlagTrt},getDefinedString:function(){for(var t,e=arguments.length,i=0;i<e;i++)if(this.isDefinedString(t=arguments[i]))return t;return""},supportsLocalStorage:function(){var t;if(null===this.isLocalStorageSupported)try{localStorage.setItem("test","1"),t=localStorage.getItem("test"),this.isLocalStorageSupported="1"===t,localStorage.removeItem("test")}catch(t){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElemed},createStyleSheet:function(t,e){for(var i,s,n,r,a,o,l,d=document.styleSheets,u=d.length)},c=0;c<u;c++){n=d[c];try{if((n.href&&n.href.replace(/http(s)?:/,""))===e)return void h()}catch(t){0}}i="string"==typeof e&&""!==e,s=uvpjs.mediaCapabilities.isFirefox(),(n=document.createElement(!i||s?"style":"link")).setAttribute("type","text/css"),n.appendChild(document.createTextNode("")),i&&(n.setAttribute("rel","stylesheet"),n.setAttribute("href",e),n.textContent='@import "'+e+'"'),"function"==typeof t&&(n.onload=h,n.addEventListener&&n.addEventListener("load",h,!1),n.onreadystatechange=function(){"loaded"!==(r=n.readyState)&&"complete"!==r||(link.onreadystatechange=null,h())},a=setInterv)},10),s&&(o=setInterv}},10)),document.getElementsByTagName("head")[0].appendChild(n))},addCSSObject:function(t,e,i,s){var n,r=uvpjs.util,a="#"+e.id+" "+(s||"");for(n in i)r.addCSSRule(t,a,n,i[n])},addCSSRule:function(t,e,i,s){var n=uvpjs.mediaCapabilities,r="string"==typeof s&&s.match(/NaN(%|px)/),a=!t||!t.sheet;if(!a)if(!r||n.isAndroid()&&n.isChrome()||(s="0"),r=((a=t.sheet).rules||a.cssRules).length,n=i+":"+s+";",a.insertRule)try{a.insertRule(e+"{"+n+"}",r)}catch(t){console.warn("Unable to add CSS rule: "+t.message)}else a.addRule&&a.addRule(e,n,r)},addCSSRules:function(t,e,i){for(var s,n=i.length;n--;)s=i[n],uvpjs.util.addCSSRule(t,e,s.name,s.value)},copyObjectWithKeyMap:function(t){var i=t,s=null;return this.from=function(t){return s=t,this},this.to=function(t){if(i&&s&&t)for(var e in i)i.hasOwnProperty(e)&&s.hasOwnProperty(e)&&null!==s[e]&&(t[i[e]]=s[e]);return t},this}}}(),w=uvpjs.register("uvpjs"),u=uvpjs._,F=/\{mediaReferenceId}/g,j=/PARTNER/g,G=/\{ptype}/g,x=/\{VGUID}/g,V=/%7Bptype%7D/g,H=/%7BVGUID%7D/g,K=/;/g,w.adUtil={MOAT_PARTNER_CODE:"",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(t,e,i,s){var n,r=uvpjs.util,a="cust_params",o=t.split("?"),l=o[1],d=-1<t.indexOf("%7Bptype%7D"),t=-1<t.indexOf("{ptype}"),i=this.getAdParams(e,i,s),l=l.replace(F,i.vid).replace(j,i.partner),l=(d&&(l=l.replace(H,i.vguid).replace(V,i.ptype)),t&&(l=l.replace(x,i.vguid).replace(G,i.ptype)),s=r.objFromQueryStr(l),this.isExcludedFromVpaid(e)&&delete s.pp,(d=s[a])&&(n=r.objFromQueryStr(decodeURIComponent(d)),delete s[a]),t=i[a],delete i[a],delete i.partner,delete i.vguid,delete i.ptype,u.assign(i,s)),d=u.assign(t,n||{});return 0<=decodeURIComponent(l.iu).indexOf("/22309610186/")&&e.isMuteAtPlayStart&&!e.userHasUnmuted&&(l.sz="640x483"),this.removeEmpty(l),this.removeEmpty(d),i=r.queryStrFromObj(l,!1),s=r.queryStrFromObj(d,!1),i+="&"+a+"="+encodeURIComponent(s),o[0]+"?"+i},getAdParams:function(t,e,i){var s,n=t.dwPageParams,r=this.getDwViewGuid(t),a=this.getPpidValue(t),o=t.contentVideoState,l=encodeURIComponent(t.sessionOptions.partner),n=n.pagetype||"",d=this.getUserStatusKey(t.getSessionOption("userStatus")),i=(""!==o.contPlayState&&uvpjs.util.isFlagTrue(i),t.getSessionOption("isEmbedded")?"1":"0"),u=this.getHost("1"==i,t),h=o.pid,c={cust_params:{}},g=uvpjs.Configuration.env,p=t.getAdCallParams(),e=e?this.getVideoDfpId(t):"";for(s in c.vid=e,c.partner=l,c.ptype=n,c.vguid=r,c.cust_params.vguid=r,c.cust_params.embed=i,u&&(c.cust_params.host=u),this.populateCustParamsWithAdSessionValues(c.cust_params,h),0<o.podsToSkip.length&&(c.cust_params.resume=1,c.cust_params.skippod=o.podsToSkip),d)c.cust_params[s]=d[s];if(a&&(c.ppid=a,c.cust_params.ppid=a),p&&!uvpjs.util.isEmpty(p.standardParams))for(s in p.standardParams)c[s]=p.standardParams[s];if(p&&!uvpjs.util.isEmpty(p.customParams))for(s in p.customParams)c.cust_params[s]=p.customParams[s];return this.isExcludedFromVpaid(t)?c.pp="ssai":"local"!==g&&"dev"!==g||(c.pp="vpaid_js"),c},getVideoDfpId:function(t){return uvpjs.util.isEmpty(t.contentVideoState.dfpMediaId)?t.contentVideoState.cmsRefGuid:t.contentVideoState.dfpMediaId},isExcludedFromVpae},getDwViewGuid:function(t){t=t.dwPageParams;return t&&t.viewguid||t.pguid||""},extractAdInfo:function(t,e){var i=e===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return uvpjs.util.isEmpty(t)||!e?(e||console.error("No 'context' arg supplied"),null):((e={adId:t.getAdId(),adSystem:t.getAdSystem(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId()}).adPodInfo=this.extractPodInfo(t.getAdPodInfo()),i=this[i](t),u.assign(e,i))},extractAdStateData:function(t,e,i){var s=t.getAdPodInfo(),n=s.getPodIndex(),s=s.getAdPosition(),r=t.getDuration(),i=i?"mid":0===n?"pre":1<=n?"mid":-1===n?"post":"",n=("mid"!=i?i+"_0":"mid_"+n)+"_"+s,a=e===this.context.IMA,o=a?this.extractIdInfo(t):null,l=this.getAdStateBlank();return l.adPosition=s,l.adBitrate=t.getVastMediaBitrate?t.getVastMediaBitrate():NaN,l.adServerName=a?this.context.IMA:this.context.DAI,l.adVideoTitle=t.getTitle(),l.duration=r,l.adType=i,l.adClipID=n,l.wrapperAdId=a&&o.wrapperAdId||"",l.adVideoId=a?o.wrapperAdId||o.adId:t.getAdId(),l.creativeId=a?o.wrapperCreativeId||o.creativeId:t.getCreativeId(),e===this.context.DAI&&(l.sourceWidth=t.getVastMediaWidth(),l.sourceHeight=t.getVastMediaHeight()),l},getAdStateBla}},extractIdInfo:function(t){var e=t.getWrapperAdIds(),i=t.getWrapperCreativeIds(),s=Array.isArray(e)&&e.length||0,n=Array.isArray(i)&&i.length||0,r=null,a=null,o=t.getAdId()||"",t=t.getCreativeId()||"";return s&&(1<s&&(r=e[1]),o=e[0]),n&&(1<n&&(a=i[1]),t=i[0]),{adId:o,wrapperAdId:r,creativeId:t,wrapperCreativeId:a}},getHost:function(t,e){var i;return t?(t=e.getSessionOption("referrer"))&&(i=uvpjs.util.parseUrl(t).host):i=window.location.hostname,i&&""!==i?i:null},getUserStatusKey:function(t){for(var e,i=uvpjs.util.getUserStatusForQuery(t).split("&"),s=i.length,n={};s--;)n[(e=i[s].split("="))[0]]=e[1];return n},trackAd:function(t){var e=t.model,i=t.context,s=e.getAdVideoState(),n=i===this.context.IMA,i=i===this.context.DAI;if(n||i)return n=e.dwPageParams.pagetype||"",i={level1:"",level2:"",level3:s.adVideoId,level4:s.creativeId,slicer1:"vaw-can",slicer2:e.sessionOptions.partner,slicer3:n,moatVASTSystem:s.adServerName,moatVASTAdID:s.wrapperAdId},""!==(e=this.getDwViewGuid(e))&&(i.zMoatVGUID=e),""!==n&&(i.zMoatPT=n),this.initMoatTracking(t.adVideoContainer,i,s.duration,this.MOAT_PARTNER_CODE,null);console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(t){var e=this.getVpaidEventForEvent(t.eventName,t.context);e&&t.trackingHandle.dispatchEvent({type:e,adVolume:t.volume})},checkForAdBlocker:function(t){t=t.getSessionOption("adBlockerCallback");return t&&t()},populateCustParamsWithAdSessionValues:function(t,e){var i,s;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(e=window.getVideoAdSessionValues(e))&&""!==e)for(s in e=e.replace(K,"&"),i=uvpjs.util.objFromQueryStr(e))t[s]=i[s]},removeEmpty:function(t){for(var e in t)null!==t[e]&&""!==t[e]||delete t[e]},extractAdInfoI}},extractAdInfoD}},extractPodInfo:function(t){return t?{adPosition:t.getAdPosition(),podIndex:t.getPodIndex(),timeOffset:t.getTimeOffset(),totalAds:t.getTotalAds()}:null},getPpidValue:function(t){t=t.getSessionOption("userPPID");return uvpjs.util.isDefinedString(t)?t:null},initMoatTracking:function(t,e,i,s,n){var r,a,o=document.createElement("script"),l=[];e={adData:{ids:e,duration:i,url:n},dispatchEve)}},i="_moatApi"+Math.floor(1e8*Math.random());try{a=(r=t.ownerDocument).defaultView||r.parentWindow}catch(t){a=window}return a[i]=e,o.type="text/javascript",t&&t.insertBefore(o,t.childNodes[0]||null),o.src="https://z.moatads.com/"+s+"/moatvideo.js#"+i,e},getVpaidEventForEvent:function(t,e){e=this.moatEventMapping[e][t];return uvpjs.util.isEmpty(e)?null:this.vpaidEvents[e]}},function(){"use strict";uvpjs.Configuration={env:"prod",hostname:"",name:"UVPJS",version:"3.2.5",date:"03/02/23 10:28:22 PM (EST)",path:"/a/video-player/uvpjs-rv/3.2.5/",playerName:"video-player"}}(),uvpjs.register("uvpjs").AutoplayDetectionService=uvpjs.Class.subClass({init:function(t){this.mc=t.mediaCapabilities,this.completeCallback=t.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=t.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setIn)},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(t,e){this.killVid(),this.setInfo(t,e),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var t;this.vidEl=t=this.createVideoElement(!1),t.load(),void 0===(t=t.play())?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):t.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var t;this.killVid(),this.checkForEarlySafari()?this.finishCheck(!1,!1):(this.vidEl=t=this.createVideoElement(!0),t.load(),t.play().then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1)))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var t=this.mc.getBrowserName()===this.mc.SAFARI,e=this.mc.isDesktop(),t=t&&e?this.mc.getBrowserVersion():null,e=t&&t.split("."),i=e?11===parseInt(e[0])&&0===parseInt(e[1]):null;return null!==t&&i&&(!e[2]||parseInt(e[2])<3)},detectMobileCapabiliti)},isAutoplayEligibleAndro)},isAutoplayEligibleIos:function(){var t=this.mc.isIOSTen(),e=t&&this.mc.isSafari(),t=t&&!e&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return e||t},isChromeAutoplayEligible:function(){return 54<=parseInt(this.mc.getBrowserMajorVersion())},createVideoElement:function(t){var e=document.createElement("video");return t&&(e.muted=!0,e.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(e,!0),e.volume=.005,e.style.width="100%",e.style.height="100%",e.src=this.testVidPath,this.testDom.appendChild(e),e},createTestDom:function(){var t=document.createElement("div"),e=t.style;return e.position="absolute",e.top="-1000px",e.left="-1000px",e.width="320px",e.height="180px",document.body.appendChild(t),t}}),uvpjs.MediaCapabilities=function(){var s,t,n,r,a,i,o,l,d,e,u,h,c,g=uvpjs._,p=uuid.noConflict(),v=!1,f={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLATFORM_OUTLET_ACCOUNT_ID:"",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",FIREFOX_IOS:"FxiOS",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",FACEBOOK_IOS:"Facebook Browser iOS",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(t,e){var i=this.systemInfo;return typeof t===this.STRING?s=t:s=navigator.userAgent||null,r=document.createElement(this.VIDEO),a=document.createElement(this.AUDIO),typeof e===this.BOOLEAN&&0,E(),S(),N(),v="https:"===location.protocol,i.browser=this.getBrowserName(),i.version=parseInt(this.getBrowserMajorVersion()),i.isMobile=this.isMobile(),i.isDesktop=this.isDesktop(),i.os=this.getOS()+"; ver. "+this.getOSVersion(),i.supportsMse=this.hasMediaSourceSupport(),i.isHlsjsEligible=this.canPlayHLSJS(),i.supportsNativeHls=this.canPlayNativeHLS(),i.supportsMp4=this.canPlayH264(),i.supportsDash=this.canPlayDASH(),this},determineAutoplayCapabilities:function(t){var e;null!==this.systemInfo.supportsUnmutedAutoplay?t():(e=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,t()}.bind(this),this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:e,testVidPath:this.getPreferredPlaceholderURL()}))},setTrackingInfo:function(t){var e,i,s=uvpjs.tracking,n={};for(i in s)e=s[i],n[i]=!!t[e];this.systemInfo.trackingAvailability=n},setAutoplayIny},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSession)},checkBrowserName:function(t){return typeof t===this.STRING&&this.getBrowserName()===t},canPlayHTML5Video:function(){var t=document.createElement(this.VIDEO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var t=document.createElement(this.AUDIO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},getBrowserName:function(){return u||"unknown"},getBrowserVersion:function(){return h||-1},getBrowserMajorVersion:function(){return c||-1},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(t,e){if(typeof e===this.OBJECT){var e=e.exec(this.getUserAgent()),i="",s="";if(e&&typeof e===this.OBJECT&&e.length&&1<e.length)return(i=e[1]||"").indexOf(".")?"object"==typeof(e=i.split("."))&&e.length&&0<e.length&&(s=e[0]):s=i,u=t,h=i,c=s,!0}return!1},hasTeali)},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKe},isFiref)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrows)},setUserAgent:function(t){return typeof t===this.STRING&&(this._detectEnvironment(t),!0)},getUserAgent:function(){return s},getMimeTypesObj:function(){return t||typeof navigator===this.OBJECT&&navigator.mimeTypes&&0<navigator.mimeTypes.length&&(t=navigator.mimeTypes),t},getMimeTypes:function(){if(typeof n===this.OBJECT)return n;var t={length:0},e=this.getMimeTypesObj();if(typeof e===this.OBJECT){for(var i=0;i<this.length;i++){var s=e[i].enabledPlugin&&e[i].enabledPlugin.name?e[i].enabledPlugin.name:"";t[e[i].type]={type:e[i].type,description:e[i].description,suffixes:e[i].suffixes,enabledPlugin:e[i].enabledPlugin,enabledPluginName:s},t.length++}return n=t}},getPlatform:function(){return typeof o===this.STRING?o:null},getOS:function(){return typeof l===this.STRING?l:null},getOSVersion:function(){return typeof d===this.STRING?d:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return 0<=this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return e=typeof e!==this.BOOLEAN?this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS():e},canPlayNativeHLS:function(){return T()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP)},hasMediaSourceSupport:function(){var t,e;return null===this.hasMse&&(t=window.MediaSource||window.WebKitMediaSource,e=window.SourceBuffer||window.WebKitSourceBuffer,t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove,this.hasMse=!(!t||!e)),this.hasMse},canPlayHLSJS:function(t){var e=this.isMobile(),i=!!T(),s=this.hasMediaSourceSupport(),n=this.isFirefox()||this.isChrome(),r=this.isIE()&&11<=this.getBrowserMajorVersion()||this.isEdge(),a=this.isOpera()&&30<=this.getBrowserMajorVersion(),o=this.isPlaystation();return!(!s||!i||o||e&&!this.canPlayHlsjsAndriod(t))&&(!!t||n||r||a)},canPlayHlsjsAndriod:function(t){var e=this.getUserAgent();if(0<=e.indexOf("Android")&&(5<=parseFloat(e.slice(e.indexOf("Android")+8))&&t))return!0;return!1},canPlayNativeHLSAudio:function(){return y()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return T()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return T()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return T()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(t,e){return T()&&this.canPlayMediaType(this.VIDEO,t,e||!1)},canPlayAudioType:function(t,e){return T()&&this.canPlayMediaType(this.AUDIO,t,e||!1)},canPlayMediaType:function(t,e,i){t=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return i=1==i,!(typeof t!==this.OBJECT||typeof t.canPlayType!==this.FUNCTION||!(i&&t.canPlayType(e)===this.PROBABLY||!i&&""!==t.canPlayType(e)))},canPlayType:function(t,e){e=1==e;var i=/audio\//.test(t)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof i!==this.OBJECT||typeof i.canPlayType!==this.FUNCTION||!(e&&i.canPlayType(t)===this.PROBABLY||!e&&""!==i.canPlayType(t)))},nativeCanPlayType:function(t,e){t=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION&&t.canPlayType(e)||null},canPlayDASHType:function(t){var e;return typeof t!==this.STRING||t.length<1?null:(e=window.MediaSource||window.WebKitMediaSource||null,this.canPlayType(t)&&this.hasMSE()&&e.isTypeSupported(t))},canPlayDASH264:function(t){return t=typeof t===this.STRING?t:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(t)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWe)},requiresSeparateTagsForIMA:function(){var t=this.getUserAgent();return t&&!(this.isChromecast()||this.isIOS()||-1<t.indexOf("Android 2.")||-1<t.indexOf("Android 4.0")||-1<t.indexOf("Android 4.1"))},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(t){return!(t&&this.supportsAutoplay()||this.isChromecast()||this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutopl)},supportsIntelligentMobileAutopl)},requiresInlinePlayAttribute:function(t){return t&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(t){return!t&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(t,e){var i=this.getInlinePlayAttribute(),s=i&&i.name;e&&i?i&&t.setAttribute(s,i.value):!e&&s&&t.removeAttribute(s)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignTok"},isIOSTen:function(){return this.isIOS()&&10<=parseInt(this.getBrowserVersion())},getPreferredPlaceholderURL:function(){return uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/video/uvp_blank.mp4"},hasMd},hasEME:function(){var t="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return t&&!t.setMediaKeys},hasGooge},getStandaloneMol},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var t,e;return void 0===this._hasFullscreenApiSupport&&(this.isIOS()?this._hasFullscreenApiSupport=!1:(t=document.createElement("div"),e=uvpjs.util,this._hasFullscreenApiSupport=!!(e.isFunction(t.requestFullscreen)||e.isFunction(t.webkitRequestFullscreen)||e.isFunction(t.mozRequestFullScreen)||e.isFunction(t.msRequestFullscreen)))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(t){var e=document;return this.supportsFullscreenApi()&&(e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled)||t&&t.webkitSupportsFullscreen},getDevil},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var t=this.isIOS();return!t||10<=parseInt(this.getBrowserVersion())},supportsCaptionsC)},supportsVolu)},isTous},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(t){return/\.m3u|assetType=hls/i.test(t)},isDashU)},isSecure:function(){return v},setUrlProtoct},getDrmType:function(t){var e="none";return t.enabled&&((this.isIOS()||this.isSafari())&&null!==t.fairplay.appCertURL?e="Fairplay":(this.isIE()||this.isEdge())&&null!==t.dash.playreadyURL?e="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==t.dash.widevineURL&&(e="Widevine")),e}},E=function(){var t=new RegExp(/\s(\([^)]+\))/).exec(f.getUserAgent());t&&t.length&&1<t.length&&(t=t[1].replace(/_/gi,"."),m(t)||A(t)||_(t)||C(t))},_=function(t){return(-1!==t.indexOf(f.LINUX)||-1!==t.indexOf(f.ANDROID))&&(o=f.LINUX,-1!==t.indexOf(f.ANDROID)&&(t=new RegExp(/\ Android\ ([^\s]+);/).exec(t),l=i=f.ANDROID,d=t&&t[1]?t[1]:""),!0)},m=function(t){if(-1!==t.indexOf(f.MAC))o=f.MAC,i=f.DESKTOP,-1!==t.indexOf(f.OSX)&&(t=new RegExp(/Mac\ OS\ X\ ([\d\.]+)/).exec(t),l=f.OSX,d=t&&t[1]?t[1]:null);else{if(-1===t.indexOf("like Mac OS X"))return!1;o=f.MAC,l=f.IOS;var e=/\sOS\s([^\s]*)\s/.exec(t);if(e&&e[1]&&(d=e[1]),/\(iPhone;/.test(t))i=f.IPHONE;else if(/\(iPad;/.test(t))i=f.IPAD;else{if(!/\(iPod;/.test(t))return!1;i=f.IPOD}}return!0},A=function(t){return(t=new RegExp(/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/).exec(f.getUserAgent()))&&t[2]?(o=f.WINDOWS,l=f.WINDOWS_PHONE,d=t[2],i=f.PHONE,!0):!(!(t=new RegExp(/Windows\ NT\ ([^\s]+)[;\)]/).exec(f.getUserAgent()))||!t[1]||(l=o=f.WINDOWS,6==(t=t[1])?l=f.WINDOWS_VISTA:6.1==t?(l=f.WINDOWS7,d=7):6.2==t?(l=f.WINDOWS8,d=8):10==parseInt(t)&&(l=f.WINDOWS10,d=t),i=f.DESKTOP,0))},S=function(){return!!D()||!!b()||!!(R()||P()||M()||L()||O()||I()||k())},T=function(){return r},y=function(){return a},D=function(){var t=/Chrome\/(\S+)/,e=/CriOS\/(\S+)/,i=f.getUserAgent(),s=e.test(i);return!(!t.test(i)&&!s||/(Opera|OPR)/.test(i)||/Edge/.test(i)||/CrKey/.test(i)||(f.setBrowserVersion(f.CHROME,s?e:t),0))},I=function(){var t=/Playstation (\S+)/i;return!!t.test(f.getUserAgent())&&(f.setBrowserVersion(f.PLAYSTATION,t),!0)},C=function(){return null!=f.getUserAgent()&&-1<f.getUserAgent().indexOf(f.CHROMECAST_USER_AGENT)&&(o=f.LINUX,i=f.CHROMECAST,l=f.ANDROID,!0)},b=function(){var t=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,e=/\ Edge\/([^\s]+)/,i=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return t.test(f.getUserAgent())?(f.setBrowserVersion(f.IE,t),!0):e.test(f.getUserAgent())?(f.setBrowserVersion(f.EDGE,e),!0):!!i.test(f.getUserAgent())&&(f.setBrowserVersion(f.IE,i),!0)},R=function(){var t=/Firefox\/(\S+)/,e=/FxiOS\/(\S+)/,i=f.getUserAgent(),s=e.test(i),i=!s&&t.test(i)?f.FIREFOX:s?f.FIREFOX_IOS:null;return!!i&&(f.setBrowserVersion(i,s?e:t),!0)},P=function(){var t=/Version\/(\S+).*Safari\//,e=t.test(f.getUserAgent()),i=l===f.ANDROID?f.ANDROID:f.SAFARI;return!!e&&(f.setBrowserVersion(i,t),!0)},M=function(){var t=new RegExp(/Opera|OPR\/(\S+)/).exec(f.getUserAgent());return!!t&&(t=-1!==t.indexOf("Opera Mini/")||-1!==t.indexOf("Opera Mobi")?f.OPERA_MOBILE:f.OPERA,f.setBrowserVersion(t,/Opera|OPR\/(\S+)/),!0)},L=function(){return!!/Silk/i.test(f.getUserAgent())&&(f.setBrowserVersion(f.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},O=function(){return!!/Android/.test(f.getUserAgent())&&(u=f.ANDROID_BROWSER,!0)},k=function(){var t,e,i=f.getUserAgent();return!(!/FBAN/.test(i)||(i=(i=i).match(/\[(.*)\]/),t=null,e={},(t=i&&0<i.length?i[1]:t).split(";").forEa)}),(i=e).FBSN&&(l=i.FBSN),i.FBSV&&(d=i.FBSV),!i.FBAN)||!/iOS/i.test(i.FBAN)||(u=f.FACEBOOK_IOS,0))},N=function(){var t=T(),e=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],i=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"],s=null;f.isIOS()?s=i:t.requestFullscreen?s=e:t.webkitRequestFullscreen?s=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:t.mozRequestFullScreen?s=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:t.msRequestFullscreen?f.getBrowserVersion()<12?s=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(s=e.slice())[5]=null:f.isAndroid()&&(s=i),t=s,(e=f)._fullscreenEventName=t?t[0]:null,e._fullscreenEnterEventName=t?t[1]:null,e._fullscreenExitEventName=t?t[2]:null,e._enterFullscreenMethodName=t?t[3]:null,e._exitFullscreenMethodName=t?t[4]:null,e._isFullscreenPropertyName=t?t[5]:null,e._fullscreenElementName=t?t[6]:null,e._fullscreenErrorEventName=t?t[7]:null};return f},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(t){var e=uvpjs._,i=uvpjs.mediaCapabilities;this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,e.isObject(t)?(this.cookie=this._getCookie(),this.CDO=t,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=i.isChrome()||i.isFirefox()||i.isSafari(),this.setSessionStartTime()):this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.")},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(t,e,i){this.debugCount++;var s,n,r=uvpjs._;(this.isEnabled||r.isUndefined(this.CDO))&&(r.isString(t)&&r.isString(e)&&!r.isUndefined(i)?(this.showAll||r.isUndefined(this.CDO)||this.isParamEnabled(e)||!0===this.cookie[e])&&(s=this.showTimestamps?"["+this._timestamp()+"] ":"",n=r.drop(arguments,3),r=r.isEmpty(n)?"":n,this.supportsFormatting?console[t]("%s%cUVPJS %c%s%c %s",s,";font-weight:bold;",";text-decoration:underline;",e,";text-decoration:none;",i,r):console[t]("%sUVPJS %s %s",s,e,i,r)):console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+i,e))},isParamEnabled:function(t){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,t)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var t=uvpjs._,e=new Date-this.adjustedStartTime,i=e%1e3,s=(e=(e-i)/1e3)%60,n=(e=(e-s)/60)%60,e=(e-n)/60%24-this.adjustedTimezone;return t.padStart(e,2,"0")+":"+t.padStart(n,2,"0")+":"+t.padStart(s,2,"0")+"."+t.padStart(i,3,"0")},_getCookie:function(){var t=this._readCookie(this.COOKIE_NAME),e={};if(t){uvpjs.log(this.DEBUG_ID,"_getCookie cookie",t);try{e=JSON.parse(t)}catch(t){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",t)}uvpjs.log(this.DEBUG_ID,"_getCookie obj",e)}return e},_readCookl}},w=uvpjs.register("uvpjs"),s=w._,w.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.mc=null,this._createControls=t.createControls,this._createAds=t.createAds,this._useInlinePlayAttribute=t.useInlinePlayAttribute,this._useMutedAttribute=t.useMutedAttribute,this._DOMReadyCB=t.callback,this._useAutoplayAttribute=t.useAutoplayAttribute,this._crossOriginAttrValue=t.crossOriginAttrValue,this._userAgent=null,this.adClickElement=null,this.dom=W(),this.dom.outer.id=t.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var t=this.dom.video.el;t&&t instanceof HTMLElement&&(t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeEventListener(this.PLAY,this._handleEvent,!1),t.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return s.clone(this.dom)},createAdClickElement:function(){var t,e={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};for(t in this.adClickElement=document.createElement("div"),e)this.adClickElement.style[t]=e[t];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(t){this.dom.ad.el&&(this.dom.ad.el.style.display=t?"block":"none")},showAdClickEleme)},getAdClickElemet},_disableVideoContextMenu:function(){var t=this.dom.video.el;t.addEventListener?t.addEventListener("contextmenu",function(t){t.preventDefault()},!1):t.attachEvent("oncontextmen1})},_setupDOM:function(){var t=this.dom;t.outer.el=document.getElementById(t.outer.id),s.isNull(this.dom.outer.el)?this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",t.outer.id):(t.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),t.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),t.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),t.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),t.content.el=this._getOrCreateElement("content"),t.outer.el.insertBefore(t.content.el,t.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),t.ad.el=this._getOrCreateElement("ad"),t.outer.el.insertBefore(t.ad.el,t.content.el.nextSibling)),this._createControls?(t.controls.el=this._getOrCreateElement("controls"),t.outer.el.appendChild(t.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB())},_createVideoElement:function(){var t=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),e=document.querySelectorAll(t);if(e instanceof NodeList&&e[0]instanceof HTMLElement&&e[0].id)this._checkVideoTagAttributes(e);else{if(t=[this.dom.outer.id,this.dom.video.id].join(" "),(e=document.querySelectorAll(t))instanceof NodeList&&e[0]instanceof HTMLElement)return e[0].id?void 0:(e[0].id=this.dom.video.id,void this.dom.content.el.appendChild(e[0]));t=this._getOrCreateElement("video"),this._checkVideoTagAttributes(t),this.dom.content.el.appendChild(t),this.dom.video.el=t}},_createPlaceholderContent:function(){var t=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||s.isNull(this._userAgent)&&this.mc.isIPhone()?t.innerHTML='<source src="'+this.dom.video.url+'">':t.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),t.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY,this._handleEvent,!1),t.addEventListener(this.PLAY,this._handleEvent,!1),t.addEventListener(this.PAUSE,this._handleEvent,!1),t.style.width="100%",this._DOMReadyCB()},_handleEvent:function(t){var e=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",t),!s.isNull(e)){var i=this._useSeparateTags?e.getElementsByTagName("source")[0]:e;if(!s.isNull(i))if(t.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,t.target),e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===i.src.indexOf(this.dom.video.url))e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeEventListener(this.PLAY,this._handleEvent,!1),e.removeEventListener(this.PAUSE,this._handleEvent,!1);else switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",t.type),t.type){case this.CAN_PLAY:e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:e.removeEventListener(this.PLAY,this._handleEvent,!1),e.pause(),s.isFunction(this.dom.video.callback)?this.dom.video.callback():this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break;case this.PAUSE:e.removeEventListener(this.PAUSE,this._handleEvent,!1)}}},_checkVideoTagAttributes:function(t){this._useMutedAttribute&&t.setAttribute("muted","muted"),this._useAutoplayAttribute&&t.setAttribute("autoplay","autoplay"),this._crossOriginAttrValue&&t.setAttribute("crossorigin",this._crossOriginAttrValue),this.mc.setVideoForInlinePlay(t,this._useInlinePlayAttribute)},_addInlineStyles:function(){var t;this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds&&((t=this.dom.ad.el).style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0")},_getIdByPrefix:function(t){if(!s.isNull(t))return uvpjs.domConstants[t]+this.dom.outer.id},_getOrCreateElement:function(t){var t=this.dom[t],e=document.getElementById(t.id);return s.isNull(e)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+t.type+' id="'+t.id+'">.'),(e=document.createElement(t.type)).id=t.id),e}}),W=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}},function(t){var r=t._;t.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,uvpc:null,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,audioInfo:{},bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(t,e,i,s){r.isString(t)&&r.isObject(e)&&r.isObject(i)?(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+t),this.vidContId=t,this.cviMgr=e,this.CDO=i,this.sessionOptions=s,this.eventsMgr=e.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN")},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&r.isNumber(t.payload.newState)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+t.payload.newState),(t=t.payload.newState)!==uvpjs.mediaCapabilities.EMPTY&&t!==uvpjs.mediaCapabilities.LOADING&&t!==uvpjs.mediaCapabilities.STOPPED&&t!==uvpjs.mediaCapabilities.PLAYING&&t!==uvpjs.mediaCapabilities.PAUSED&&t!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=t,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState))},onVideoProgress:function(t){var e=t.payload;t.target===this.vidContId&&(this.isCurrVideoAd=e.isAd,this.playbackState=e.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=e.currentTime,this.adPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.adPlaybackState.duration=e.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=e.playbackStarted,this.adPlaybackState.playbackComplete=e.playbackComplete,this.adPlaybackState.sourceBitrate=e.sourceBitrate,this.adPlaybackState.playbackBitrate=e.playbackBitrate,this.adPlaybackState.errorInfo=e.errorInfo,this.adPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=e.currentTime,this.contentPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=e.playbackStarted,this.contentPlaybackState.playbackComplete=e.playbackComplete,this.contentPlaybackState.sourceBitrate=e.sourceBitrate,this.contentPlaybackState.playbackBitrate=e.playbackBitrate,this.contentPlaybackState.videoFramerate=e.videoFramerate,this.contentPlaybackState.isSeeking=e.isSeeking,this.contentPlaybackState.isHDStreamLive=e.isHDStreamLive,this.contentPlaybackState.isPlayingLive=e.isPlayingLive,this.contentPlaybackState.currentContentSegment=e.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=e.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=e.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.contentPlaybackState.bufferLength=e.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=e.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&r.isNumber(t.payload.vol)&&(this.volume=t.payload.vol,this.debug)&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume)},onVideoMute:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&(this.isFullscreen=t.payload.isFs)},onContextMetadata:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&r.isPlainObject(t.target.contextMetadata)},onResourceSta)},resetAdPlaybackState:function(){r.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){r.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoSta)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(t){this.CDO.setAdCallParams(t)},isId3HandlingRequir)},getConfiguredId3OwnerIds:function(){var t=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof t&&t.length?t:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(t){var e=void 0;return e=t&&r.isString(t)&&this.hasOwnProperty(t)&&!r.isFunction(this[t])?this[t]:e},getModule:function(t){if(r.isString(t))return this.CDO.getModule(t)},getModuleParam:function(t,e){if(r.isString(t)&&r.isString(e))return this.CDO.getModuleParam(t,e)},getModules:function(){return this.CDO.getModules()},copyModules:function(t){this.CDO.copyModules(t)},isModuleEnabled:function(t){return!(!t||!r.isString(t))&&this.CDO.isModuleEnabled(t)},isModuleSet:function(t){return!uvpjs.util.isEmpty(t)&&this.CDO.isModuleSet(t)},getSessionOptil},getClass:function(t){if(r.isString(t))return this.CDO.getClass(t)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(t,e){return this.CDO.getClassProperty(t,e)},getClassListItems:function(t){return this.CDO.getClassListItems(t)},getClassListItemProper)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoSta)},getContentVideoState:function(){var t={};return r.assign(t,this.contentVideoState),t},getAdVideoState:function(){var t={};return r.assign(t,this.adVideoState),t},getContentPlaybackStat},getAdPlaybackSta)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInt},setAdVideoSta)},setContentVideoStateItems:function(t){this._addItemsToInstanceObj("contentVideoState",t)},setContentPlaybackStateItems:function(t){this._addItemsToInstanceObj("contentPlaybackState",t)},setAdVideoStateItems:function(t){this._addItemsToInstanceObj("adVideoState",t)},setAdPlaybackStateIte)},setNonDefaultContentVideoStateItems:function(t){this.setContentVideoStateItems(this._removeDefaults(t,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateIte)},incrementAdNum:function(){this.adNum++},incrementMedN+},getVideoPlaybackCDOProperty:function(t){var e=this.VIDEO_PLAYBACK_SETTINGS,i=this.isModuleEnabled(e),e=this.getModuleParam(e,t);if(i&&e)return e},setAbrStartBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==t&&this.setStartBitrate(t)},setAbrMinBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==t&&this.setMinBitrate(t)},setAbrMaxBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==t&&this.setMaxBitrate(t)},setLiveSyncDurationCountFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==t&&this.setLiveSyncDurationCount(t)},setCapLevelToPlayerSizeFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==t&&this.setCapLevelToPlayerSize(t)},setDashJSFastSwitchABRFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==t&&this.setDashJSFastSwitchABR(t)},setStartBitrate:function(t){this.startBitrate=t,this.setContentPlaybackStateItems({startBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(t){this.minBitrate=t,this.setContentPlaybackStateItems({minBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(t){this.maxBitrate=t,this.setContentPlaybackStateItems({maxBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(t){this.liveSyncDurationCount=t,this.setContentPlaybackStateItems({liveSyncDurationCount:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(t){this.capLevelToPlayerSize=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(t){this.enableDashJSFastSwitchABR=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setAudioTrackInfo:function(t){this.contentPlaybackState.audioInfo=t},getAudioTrackInfo:function(){return this.contentPlaybackState.audioInfo},setErrorRecovery:function(t){this.errorRecovery=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(t){this.useDynamicSwitching=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var i=this;r.forOwn(this.sessionOptions,function(t,e){r.isString(t)&&(r.has(i.contentVideoState,e)?i.contentVideoState[e]=t:r.has(i.adVideoState,e)&&(i.adVideoState[e]=t))}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(i,s){return r.omitBy]})},_addItemsToInstanceObj:function(t,e){var i,s,n=this[t];if(n)if(r.isObject(e))for(i in this.debug,n)s=e[i],!e.hasOwnProperty(i)||r.isUndefined(s)||r.isFunction(s)||(n[i]=s);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",e);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+t)}})}(uvpjs.register("uvpjs")),w=uvpjs.register("uvpjs"),r=w._,w.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destrl},loadScript:function(t,e,i){var s,n;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",t),this.scriptsLoadedCB=e,this.timeout=i||this.REQUEST_TIMEOUT,r.isString(t)&&this.urls.push(t),r.isArray(t)&&(this.urls=t),n=this.urls.length,s=0;s<n;s++)this._getScript(this.urls[s])},_getScript:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",e);function i(t,e){!r.isFunction(s._onScriptLoaded)||s._onScriptLoaded.done?s.debug&&uvpjs.warn(s.DEBUG_ID,"_getScript _doCallback callback not a function or already called."):(s.urls=r.without(s.urls,t),s._onScriptLoaded({url:t,error:e}))}var s=this,t=document.createElement("script");t.src=this._setUrlProtocol(e),t.async=!0,t.onreadystatechange=t.onload=function(){t.readyState&&!/loaded|complete/.test(t.readyState)||i(e)},t.onerror=function(t){uvpjs.error(s.DEBUG_ID,"_getScript "+t.target.src+" is not accessible."),i(e,t)},document.querySelector("head").appendChild(t),this.timeoutHandle=setTimeout(function(t){-1!==r.indexOf(s.urls,t)&&(this.debug&&uvpjs.warn(s.DEBUG_ID,"_getScript request timeout"),i(t,"timeout"))}.bind(this,e),this.timeout)},_onScriptLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var e=r.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),e&&r.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(t))},createCORSRequest:function(t,e){var i=new XMLHttpRequest;return e=this._setUrlProtocol(e),"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(t,e):i=!1,i},loadXHR:function(t,e,i,s){var n;t=this._setUrlProtocol(t),!1===(n=this.createCORSRequest("GET",t))?(uvpjs.warn(this.DEBUG_ID,"loadXHR CORS not supported for url = "+t),i(n)):(s&&!uvpjs.util.isEmpty(s)&&(n.responseType=s),n.timeout=this.REQUEST_TIMEOUT,n.onload=function(){(r.inRange(n.status,200,400)?e:i)(n)},n.onerror=function(){i(n)},n.ontimeout=function(){i(n)},n.send())},loadXML:function(t,e,i){this.loadXHR(t,e,i,"document")},loadArrayBuff)}}),w=uvpjs.register("uvpjs"),a=w._,w.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t){var e=t.vidContId;if(!t.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=e,this.eventsMgr=t.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=t.readyCallback,this.cachedOptions={suppressFacadePlay:t.suppressFacadePlay,deferLoadingCaptions:t.playerOptions.deferLoadingCaptions},this.cviModel.initialize(e,this,t.CDO,t.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContaine)},setAdCallParams:function(t){this.cviModel.setAdCallParams(t)},setInitialPlaybackTye},setContextMetadal},setPlaybackInfoOnModt},finishInit:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var i=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:i.suppressFacadePlay,p2pClient:t||null,multiCdnClient:e||null,deferLoadingCaptions:i.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:i.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(t){var e=this.cviModel.getSessionOption("adBlockerCallback"),e=!(!e||!e()),i=this.eventsMgr.eventTypes,s=uvpjs.ErrorInfo,n=window.google&&google.ima;this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+e),e&&this.eventsMgr.dispatchEvent(i.AD_BLOCKED,{errorInfo:new s({eventType:i.AD_BLOCKED,errorCode:s.errorCodes.AD_BLOCKING_DETECTED,message:s.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),e||n?n&&(a.isEmpty(this.imaAdDisplayContainer)?(this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(t),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer),(e=this.adsLoader.getSettings()).setAutoPlayAdBreaks(!0),e.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)):this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed")):this.eventsMgr.dispatchEvent(i.PLAYER_START_ERROR,{errorInfo:new s({eventType:i.PLAYER_START_ERROR,errorCode:s.errorCodes.IMA_SDK_MISSING,message:s.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId)},_createIMAAdDisplayContainer:function(t){var e;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId).getElementsByTagName("video")[0],e=new google.ima.AdDisplayContainer(this.adVideoDiv,e,t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",e),e},onAdsManagerLoaded:function(t){var e=uvpjs.util,i=e.isEmpty(this.RPM),e=e.isEmpty(this.RPM.currRP),s=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA;this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",t),i||e||s?(s="CVI mgr: onAdsManagerLoaded; ",s+=i?"no RPM found":e?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+s,isFatal:!1})},this.vidContId)):this.RPM.currRP.onAdsManagerLoaded(t)},onAdError:function(t){var e=!a.isEmpty(this.RPM)&&this.RPM,i=e&&!a.isEmpty(e.currRP)&&e.currRP;this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",t),e&&i?"function"==typeof i.handleAdsLoaderError&&i.handleAdsLoaderError(t):(this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId))},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),this.RPM.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(t){void 0===t&&(t={}),this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,t,this.vidContId)},seekToRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+t),a.isNaN(t)?this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+t):(-1===t&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:t},this.vidContId))},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",t),a.isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:t},this.vidContId)},getVolue},loadCaptionsRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",t),a.isString(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:t},this.vidContId)},showCaptionsRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{language:t},this.vidContId)},setCaptionLanguage:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SET_CAPTIONS_LANG,{language:t},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},getCaptionInfo:function(){return this.captionsMgr.getCaptionInfo()},setCaptionsStyleRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",t),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(t):this.captionsMgr.setStyles(t)},setCaptionsCuePropertyRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",t,e),this.captionsMgr.setCueProperty(t,e)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},getAudioTrackInfo:function(){return this.cviModel.getAudioTrackInfo()},setAudioTrack:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_AUDIO_TRACK,{id:t})},resizeRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+t+"  height = "+e),!a.isNaN(t)&&!a.isNaN(e)&&0<=t&&0<=e&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:t,height:e},this.vidContId)},fullscreenRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",t),a.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:t},this.vidContId)},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:t},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",t),a.isPlainObject(t)},setNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",t),a.isBoolean(t)&&(this.cviModel.nativeControls=t)},createPauseAdRetriever:function(){var t=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),e={eventsMgr:this.eventsMgr,adCallUrl:t,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};t?uvpjs.PauseAdRetriever?this.pauseAdRetriever=new uvpjs.PauseAdRetriever(e):this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path."):this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+t)},checkForPauseAd:function(){var t=this.cviModel.isModuleEnabled("PauseAd"),e=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/PauseAdRetriever.js";t&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(new uvpjs.CodeLoader).loadScript(e,this.createPauseAdRetriever.bind(this)))}}),(w=uvpjs.register("uvpjs")).ErrorInfo=uvpjs.Class.subClass({init:function(t){t=t||{};this.errorCode=t.errorCode||null,this.eventType=t.eventType||null,this.isFatal=!!t.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=t.message||null,this.adInfo=t.adInfo||null,this.serverCode=t.serverCode||null,this.hlsjsErrorCode=null}}),w.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},w.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."},w=uvpjs.register("uvpjs"),o=w._,n=Math.random(),w.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(t){this.debug=uvpjs.debug,t&&t===n?(this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance().")},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(t,e){var i;t&&o.isString(t)&&e&&o.isFunction(e)?!1===(i=this._returnValidEvtTypeAndNameSpace(t))?this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+t},this.internalNS):(t=i[0],i=i[1],this.registeredEventsTable[t]||(this.registeredEventsTable[t]={}),this.registeredEventsTable[t][i]?this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",t," ns = ",i):(this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",t," ns = ",i),this.registeredEventsTable[t][i]=e)):this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(t){var e,i;t&&o.isString(t)?!1===(i=this._returnValidEvtTypeAndNameSpace(t))?this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",t):(e=i[0],i=i[1],this.registeredEventsTable[e]&&this.registeredEventsTable[e][i]?(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",t),delete this.registeredEventsTable[e][i]):this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",t)):(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",t),this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS))},dispatchEvent:function(t,e,i){var s={};if(t&&o.isString(t))if(o.isUndefined(e)||o.isPlainObject(e))if(o.isUndefined(i)||o.isString(i)){var n=this.registeredEventsTable[t];if(n)for(var r in o.isUndefined(e)&&(e={}),o.isUndefined(i)&&(i=""),s.type=t,s.payload=e,s.target=i,n)n.hasOwnProperty(r)&&n[r](s)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+t+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS)},_returnValidEvtTypeAndNameSpace:function(t){var e,i=[],t=t.split(".");return!(t.length<2||(e=t[0],t.shift(),t=t.join("_"),!this._validateEventType(e))||-1<t.indexOf("undefined"))&&(i[0]=e,i[1]=t,i)},_validateEventType:function(t){var e,i=!1,s=this.eventTypes;for(e in s)if(s.hasOwnProperty(e)&&s[e]===t){i=!0;break}return i},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(t){this.sessionStartTime=Date.now(),(this.sessionMilliseconds=0)!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),t)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(t,e,i,s){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",e);var n={};t&&o.isNumber(t)&&e&&o.isString(e)&&i&&o.isFunction(i)&&(!s||o.isNumber(s)||!(1<=s||-1===s))?(n={freq:t=t<this.uvpjsClockInterval?this.uvpjsClockInterval:t,ns:e=e.split(".").join("_"),cb:i,rptCnt:-1,nextTime:Date.now()+t},s&&(n.rptCnt=s),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",t),this.timerCBOs.push(n)):this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeTimedEventCallback:function(t,e){var i,s;if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",t+" ns = "+e),t&&o.isNumber(t)&&e&&o.isString(e))for(e=e.split(".").join("_"),i=this.timerCBOs.length;i--;)(s=this.timerCBOs[i]).freq===t&&s.ns===e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",s.freq+" CBO.ns = "+s.ns),this.timerCBOs.splice(i,1));else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;for(var t,e=Date.now(),i=this.timerCBOs.length-1;0<=i;i--)e>=(t=this.timerCBOs[i]).nextTime&&(t.cb(),t.nextTime=e+t.freq,-1!==t.rptCnt)&&(t.rptCnt=t.rptCnt-1,0===t.rptCnt)&&this.timerCBOs.splice(i,1)},eventTypes:{SWITCH_AUDIO_TRACK:"switchAudioTrack",FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,AD_BUFFERING:uvpjs.EventType.AD_BUFFERING,AD_VOLUME_CHANGE:uvpjs.EventType.AD_VOLUME_CHANGE,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",SET_CAPTIONS_LANG:"onSetCaptionLang",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),w.EventsManager._instance=null,w.EventsManager.destroyInstance=function(){this._instance=null},w.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(n)),this._instance},w=uvpjs.register("uvpjs"),l="www.nielsen.com",w.AbstractId3Parser=uvpjs.Class.subClass({init:function(t){this.findNielsen=t.findNielsen,this.dataCallback=t.dataCallback,this.ownerIds=this.assembleOwnerIds(t.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},par)},setLengths:function(t){for(var e=t.length,i=[];e--;)i[e]=t[e].length;return i},assembleOwnerIds:function(t,e){var i,s,n=[];if("string"==typeof t)for(s=(i=t.split(",")).length;s--;)n.push(i[s].trim());return e&&-1===n.indexOf(l)&&n.push(l),n}}),uvpjs.register("uvpjs").FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){for(var e=t.length,i=0;i<e;i++)t[i].data&&this.findId3(t[i])},findId3:function(t){var e,i,s,n=0,r=t.data;n+=3,"ID3"===this.readStr(r,0,3)&&(n+=3,e=127&r[n++],i=127&r[n++],s=127&r[n++],r=127&r[+n],this.findId3PrivateFrame(t,10,10+((e<<21)+(i<<14)+(s<<7)+r)))},findId3PrivateFrame:function(t,e,i){for(var s,n=t.data;e+8<=i;)s=this.readStr(n,e,4),e+=4,n[e++],n[e++],n[e++],n[e++],n[e++],n[e++],"PRIV"===s&&this.parseFrame(t,e)},parseFrame:function(t,e){for(var i,s,n=this.idLengths,r=this.totalIds,a=t.data;r--;)if(s=n[r],(i=this.readStr(a,e,s))===this.ownerIds[r]){e+=s,s="www.nielsen.com"===i?this.parseNielsen(i,a,e):this.readStr(a,++e,a.length),this.dataCallback({name:i,data:s,pts:t.pts});break}},parseNielsen:function(t,e,i){t+=this.readStr(e,i,e.length-(i+2));return 249===t.length?t:null},readStr:function(t,e,i){for(var s="",n=e||0,r=e+i;s+=String.fromCharCode(t[n++]),n<r;);return s}}),uvpjs.register("uvpjs").TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){if(1===t.length){var e=t[0];if("PRIV"===e.value.key)for(var i=0;i<this.ownerIds.length;i++){var s=this.ownerIds[i];-1!==e.value.info.indexOf(s)&&this.dataCallback({name:s,data:"www.nielsen.com"===s?e.value.info:String.fromCharCode.apply(null,new Uint8Array(e.value.data)),pts:e.startTime})}}}}),(Y=uvpjs.register("uvpjs")).SdkLoadManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var t,e={};for(t in this.historyItems)e[t]=this.historyItems[t];return e},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(t){var e="//79423.analytics.edgesuite.net/js/csma.js",e=t&&t.getModuleParam("AkamaiQOSPluginJS","libpath")||"//79423.analytics.edgesuite.net/js/csma.js";return uvpjs.mediaCapabilities.isSecure()?[e.replace("edgesuite","edgekey")]:[e]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefins},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPa]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof ADB||"undefined"===Y._.get(ADB,"va.Heartbeat"))},getPath:function(t){var e="2.3.0";try{var i=t.modules.find(function(t,e){return"SiteCatalyst"===t.name}).params.fie});i&&i.value&&(e=i.value)}catch(t){}i=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-"+e+".min.js",e=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return t.sessionOptions.usesTealium?[e]:[i,e]}},OzTam:{isDefine},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}}},init:function(t,e){var i=[],s=t.getModules(),n=uvpjs.util;if(this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.cdo=t,this.initCallback=e,n.isEmpty(s))this.invokeCallbackWithHistory();else{t.getModule("MuxQOSPluginJS")||s.push({name:"MuxQOSPluginJS",enabled:"true"});for(var r=s.length;r--;){var a,o,l=s[r],d=l.name,u=this.sdkModules[l.name];if(l.enabled&&u)if(u.isDefined())this.addToHistory({name:l.name,loaded:!0});else for(o=(a=u.getPath(t)).length;o--;)i.push({name:d,path:a[o]})}n.isEmpty(i)?this.invokeCallbackWithHistory():this.bulkLoad(i)}},invokeCallbackWithHistory:function(){var t=this.initCallback,e=this.getHistory();setTimeo)},1)},bulkLoad:function(t){var s=t,n=[],r=(this.handleAllLoadResults,function(){var t=s.shift(),e=new uvpjs.CodeLoader;e.loadScript(t.path,function(t,e,i){n.push({name:t,result:i}),e.destroy(),0===s.length?this.handleAllLoadResults(n):r()}.bind(this,t.name,e))}.bind(this));r()},handleAllLoadResults:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",t);for(var e=t.length;e--;){var i=t[e];i.result.error&&uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+i.result.error),this.addToHistory({name:i.name,loaded:!i.result.error})}this.initCallback(this.getHistory())},addToHistory:function(t){t.name?!1!==this.historyItems[t.name]&&(this.historyItems[t.name]=!t.error&&t.loaded):this.debug&&uvpjs.warn(this.DEBUG_ID,"module name not found",t)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}}),w=uvpjs.register("uvpjs"),d=w._,w.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=t.p2pClient||null,this.multiCdnClient=t.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=t.suppressFacadePlay,this.deferLoadingCaptions=t.deferLoadingCaptions,this.playlistPaused=!1,d.isEmpty(t)||this.initialize(t.vidContId,t.cviMgr)},initialize:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",t),d.isString(t)&&d.isObject(e)?(this.vidContId=t,this.cviMgr=e,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS")},setContainers:function(t){this.containers=t},setCaptionStyle:function(t){uvpjs.util.isEmpty(this.currRP)||this.currRP.setCaptionStyle(t)},onResourceLoadRequest:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",t.payload.rcObj),this.playlistPaused=!1,t=this._createResourceProvider(t.payload.rcObj),this.rscProviders.unshift(t),this.playlistInterruptionCleanup())},onResourceAddRequest:function(t){if(t.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",t.payload.rcObjs);for(var e,i=t.payload.rcObjs,s=i.length,n=0;n<s;n++)e=this._createResourceProvider(i[n]),this.rscProviders.push(e);d.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(t){if(t.target===this.vidContId){for(var e,i=t.payload.rcObjs,s=i.length,n=this.rscProviders,r=this.usedRPs,a=!1,o=!uvpjs.util.isEmpty(this.currRP);s--;)e=i[s],this.removeFromList(e,n),this.removeFromList(e,r),o&&!a&&(a=this.isMatchingResource(e,this.currRP.rco.rcoSeed));a&&this.advancePlaylist()}},removeFromList:function(t,e){for(var i=e.length;i--;)this.isMatchingResource(t,e[i].rco.rcoSeed)&&e.splice(i,1)},isMatchingResource:function(t,e){var i=uvpjs.util;return t.type===e.type&&(!i.isEmpty(t.pid)&&t.pid===e.pid||!i.isEmpty(t.assetURL)&&t.assetURL===e.assetURL||!i.isEmpty(t.selectorCall)&&t.selectorCall===e.selectorCall)},onResourcePlaylistPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),t.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(t){t.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,d.isEmpty(this.currRP))&&0<this.rscProviders.length&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP())},onResourcePlaylistAdvance:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),d.isEmpty(this.currRP)||d.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){!d.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),d.isEmpty(this.currRP)||d.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(t){var e,i={rco:t,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",t),t.type){case this.mc.RP_URL:e=new uvpjs.RP_URL(i);break;case this.mc.RP_PLATFORM:e=new uvpjs.RP_Platform(i);break;case this.mc.RP_DAI:e=new(t.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider)(i);break;case this.mc.RP_IMA:e=new uvpjs.RP_IMA(i);break;case this.mc.RP_MDIALOG:e=new uvpjs.RP_Mdialog(i)}return e},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),d.isEmpty(this.currRP)||d.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),0<this.rscProviders.length&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),d.isObject(this.currRP)?this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay):(this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),this.advancePlaylist())},rpDataLoadErrorCB:function(t){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",t.message),this.eventsMgr.dispatchEvent(t.eventType,{errorInfo:t},this.vidContId),this.advancePlaylist()},resourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:t},this.vidContId)},resourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",t),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:t,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),0<this.rscProviders.length&&!d.isEmpty(this.currRP)&&d.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}}),w=uvpjs.register("uvpjs"),h=w._,w.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.crossOriginAttrValue=null,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(t,e,i,s,n){var r=!0===n.skin;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",t),h.isString(t)&&h.isObject(e)&&h.isObject(i)&&h.isFunction(s)?(this.vidContId=t,this.namespace=".vci_"+t,this.eventsMgr=e,this.CDO=i,this.vciReadyCB=s,this._usesIMA=n.usesIMA,this._loadSkinFlag=r,this._isPreviewBtnInternallyManaged=r,this._isUnmutedAutoplay=n.enableUnmutedAutoplay,this._isMutedAutoplay=n.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!n.useBrowserControls,this.crossOriginAttrValue=n.crossOriginAttrValue,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:t,eventsMgr:e,CDO:i,playerOptions:n,suppressFacadePlay:this.checkNativeAutoplay(n.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,n)})):this.debug&&uvpjs.log(this.DEBUG_ID,"-")},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(t){var e={skin:!0===t.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:t.customCSS,enableReplay:t.enableReplay,previewImage:t.previewImage,themeName:t.themeName,controls:t.controls,template:t.template};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:t.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(t.enableNativeMobileAutoplay),crossOriginAttrValue:t.crossOriginAttrValue,callback:this.onDOMReady.bind(this,e)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(t){},onAdStart:function(t){t=t.payload.adData;this.DOMMgr.showAdContainer(!0),this.autoplayRestrictionChecked||this.checkAutoplayRestriction(t),t.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(t){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){var t,e;this.handleFirstGesture(),this.skinMgr&&(t=this.skinMgr,e=this.mc.PAUSED,setTimeo)},200))},setAdCallParams:function(t){this.CVI_Mgr.setAdCallParams(t)},checkAutoplayRestriction:function(t){this.autoplayRestrictionChecked=!0,this.contentStartReceived||"pre"!==t.adType||"ima"!==t.adServerName||!this._isMutedAutoplay||this.mc.isSingleVideoIma()||this.mc.supportsUnmutedAutoplay()||this.isPreparedForAutoplay||(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(t){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,t,this.vidContId)},prepForRestrictedAutoplay:function(t){var e=this.dom.video.el,i=function(){this.isPreparedForAutoplay=!0,e.removeEventListener("play",i,!1),e.muted=!1,t&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this),s=(this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),e.src=this.mc.getPreferredPlaceholderURL(),e.addEventListener("play",i,!1),e.muted=!0,e.load(),e.play());void 0!==s&&s.then(Function.prototype).cat)})},handleFirstGesture:function(t){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:t||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(t){this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),!this.useBrowserNativeControls&&this._loadSkinFlag?this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:t}):this.onVCIReady()},checkNativeAutoplay:function(t){return t&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),this._vciReadySent||(this._autoPlay||!this._isPreviewBtnInternallyManaged||this._previewButtonDone?(this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId))},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),h.isString(t)?this.CVI_Mgr.loadDynamicAdCall(t):this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)")},forceDynamicMidrollPodE)},onPreviewButton:function(t){uvpjs.log(this.DEBUG_ID,"onPreviewButton"),uvpjs.util.isFunction(t)?(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone?(uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=t,this.playBlankVideo()):(uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),t())):this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function.")},canOverrideUserGestue},overrideUserGesture:function(t){var e;!0===t||this.canOverrideUserGesture()?this.onPreviewButton(this.onVCIReady.bind(this)):(t=uvpjs.ErrorInfo,(e=this.eventsMgr).dispatchEvent(e.eventTypes.PLAYER_START_ERROR,{errorInfo:new t({eventType:e.eventTypes.PLAYER_START_ERROR,errorCode:t.errorCodes.USER_GESTURE_REQUIRED,message:t.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId))},addEventListener:function(t,e){t&&h.isString(t)&&h.isFunction(e)?this.eventsMgr.addEventListener(t,e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId)},removeEventListener:function(t){t&&h.isString(t)?this.eventsMgr.removeEventListener(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone?(this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,t),this.playBlankVideo()):(t=this.createResourceConfig(t),h.isObject(t)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:t},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId))},addResourcesToPlaylist:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,t),this.playBlankVideo();else if(h.isArray(t)&&0<t.length){var e,i,s=[];for(e in t)i=this.createResourceConfig(t[e]),h.isObject(i)?s.push(i):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);0<s.length&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:s},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(t){var e,i,s,n="",r=!1,a=t.type===this.mc.RP_IMA,o=!1,l=null;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",t),(s=this.prevalidateRcObj(t)).error)return n="Resource configuration error: "+s.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(n,null),!1;switch(t.type){case this.mc.RP_URL:e=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:e=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(n="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",r=!0),o=!0,e=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:e=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:o=!t.useSsb,e=uvpjs.DaiRco;break;default:n="VCI createResourceConfig "+("Unknown resource type "+t.type)+"; this.vidContId = "+this.vidContId,r=!0}return r?(this.dispatchStartError(n,null),!1):(this.rcoIdIndex++,s=(i=new e(t,this.rcoIdIndex+"_"+this.vidContId,this.vidContId)).getValidationInfo(),o&&this.checkForAdBlocker()?(!0===s.missingSDK&&(l=a?"IMA":"DAI"),this.dispatchAdBlocked(l,!0),!1):s.error?(n="VCI error initializing RCO: "+s.message,l=uvpjs.ErrorInfo.errorCodes,!0===s.missingSDK?(s=a?l.IMA_SDK_MISSING:l.DAI_SDK_MISSING,this.dispatchStartError(n,s)):this.dispatchStartError(n,null),!1):(this._replayRco=t,i))},prevalidateRcObj:function(t){var e=uvpjs.util,i="",s=!1;return e.isPlainObject(t)?e.isDefinedString(t.type)||(i="Invalid resource type encountered",s=!0):(i="Invalid resource config object format",s=!0),{error:s,message:i}},dispatchStartError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:e||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+t,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(t,e){t=t?" (Missing "+t+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+t,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+t,isFatal:!!e})},this.vidContId)},checkForAdBlock)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(t){h.isArray(t)&&0<t.length&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:t},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(t){void 0===t&&(t={}),this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest(t)},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",t),isNaN(t)||this.CVI_Mgr.seekToRequest(t)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",t),h.isEmpty(this.skinMgr)||h.isEmpty(t)||this.skinMgr.disableButton(t)},enableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",t),h.isEmpty(this.skinMgr)||h.isEmpty(t)||this.skinMgr.enableButton(t)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolu)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",t),h.isString(t)&&this.CVI_Mgr.loadCaptionsRequest(t)},showCaptions:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest(t)},setCaptionLanguage:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionLanguage to "+t),this.CVI_Mgr.setCaptionLanguage(t)},getCaptionInfo:function(){return this.CVI_Mgr.getCaptionInfo()},hideCaptio)},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},getAudioTrackInfo:function(){return this.CVI_Mgr.getAudioTrackInfo()},setAudioTrack:function(t){this.CVI_Mgr.setAudioTrack(t)},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",t),this.CVI_Mgr.setCaptionsStyleRequest(t)},setCaptionsStyleProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",t,e),this.CVI_Mgr.setCaptionsStyleRequest([{name:t,value:e}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",t,e),this.CVI_Mgr.setCaptionsCuePropertyRequest(t,e)},setSize:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+t+"  height = "+e),h.isNumber(t)||h.isNumber(e)||this.CVI_Mgr.resizeRequest(t,e)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),!h.isEmpty(t)&&(h.isArray(t)&&0<t.length||uvpjs.util.isDefinedString(t))&&this.CVI_Mgr.setUserGesture(t)},setQosMetadata:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",e),h.isEmpty(t)||h.isEmpty(e)||!h.isArray(t)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:t,paramsObj:e},this.vidContId))},fullscreen:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",t),h.isBoolean(t)&&this.CVI_Mgr.fullscreenRequest(t)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(t){t&&h.isPlainObject(t)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:t},this.vidContId))},forceTrackSessionEnd:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FORCE_TRACK_SESSION_END,{},this.vidContId)},removeNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",t),h.isBoolean(t)&&this.CVI_Mgr.setNativeControls(t)},useDynamicSwitching:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",t),h.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:t},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(t){t&&"number"==typeof t?(this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",t)},switchTo:function(t){var e=null!=t&&"string"==typeof t&&-1!=="up,down".indexOf(t),i=null!=t&&"number"==typeof t&&!isNaN(t);e||i?(this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",t),i?this.switchBitrateTo(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",t,e,i,typeof t)},setMinimumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},setMaximumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},pauseAdRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:t||null,height:e||null},this.vidContId)},_dispatchResizeEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:t},this.vidContId)},liveSegmentStart:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_START;this.eventsMgr.dispatchEvent(e,{liveSegmentData:t},this.vidContId)},liveSegmentEnd:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_END;this.eventsMgr.dispatchEvent(e,{liveSegmentData:t},this.vidContId)}}),w=uvpjs.register("uvpjs"),z=Math.random(),c=w._,w.VideoManager=uvpjs.Class.subClass({init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance?console.warn("UVPJS: An instance of VideoManager has already been created."):((uvpjs.VideoManager._instance=this).initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1)},destroy:function(){for(var t in this.VCIs)this.destroyVideoPlayer(t);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,uvpjs.VideoManager.destroyInstance()},initialize:function(t,e,i){var s=uvpjs.Configuration,n=uvpjs.VideoManager._instance,r=uvpjs.DebugManager,i=this.validateParams(t,e,i),a=i.message,o=i.isValid;if(!a||(console[o?"warn":"error"](a),!o&&i.errorCb&&i.errorCb(a),o)){if(n){if(n.isInitializing())return void n.addInitCallback(e);if(n.isReady())return void(uvpjs.util.isFunction(e)&&e(this.mc.systemInfo))}console.log([s.name,s.version,s.date].join(" ")),uvpjs.log=r.log.bind(r),uvpjs.warn=r.warn.bind(r),uvpjs.error=r.error.bind(r),r.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!t.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(e),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",t),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(t,this.onCongfigMgrReady.bind(this))}},validateParams:function(t,e,i){var s=uvpjs.util,n=null,r=!1,a="VideoManager.initialize()",i=s.isFunction(i)?i:null;return t&&c.isPlainObject(t)||(n=a+" was invoked with invalid session options.",r=!0),s.isFunction(e)||(n=a+": A success callback function is required.",r=!0),i||(n=a+" did not receive a valid error callback function.",r=!1),{errorCb:i,message:n,isValid:!r}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(t){var e=this.successCallbacks.length;if(uvpjs.util.isFunction(t)){for(;e--;)if(this.successCallbacks[e]===t)return;this.successCallbacks.push(t)}},onCongfigMgrReady:function(t){c.isObject(t)?(this.CDO=t,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS)},onSdkLoadManagerReady:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",t),uvpjs.mediaCapabilities.setTrackingInfo(t),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(t){var t=t.isModuleEnabled("VideoPlaybackSettings")&&t.getModuleParam("VideoPlaybackSettings","forceHlsjs"),e="string"==typeof t,i=e&&t.toLowerCase();!t||uvpjs.util.isEmpty(t)||!0!==t&&1!==t&&(!e||"1"!==i&&"y"!==i&&"yes"!==i)||((t=this.mc.canPlayHLSJS(!0))&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=t)},checkAutopl)},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(t,e){this.eventsMgr&&(t&&c.isString(t)&&c.isFunction(e)?this.eventsMgr.addEventListener(t,e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS))},removeEventListener:function(t){t&&c.isString(t)?this.eventsMgr.removeEventListener(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS)},getVideoPlayers:function(){var t,e={};for(t in this.VCIs)e[t]=this.VCIs[t];return e},createVideoPlayer:function(t,e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),!c.isString(t)||!c.isFunction(e)||i&&!c.isPlainObject(i)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS):(t=[t,e],i&&t.push(i),this.createMultipleVideoPlayers([t]))},destroyVideoPlayer:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),c.isString(t)?c.isEmpty(this.VCIs)||!this.VCIs[t]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+t},this.internalNS),!1):(this.VCIs[t].destroy(),delete this.VCIs[t]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayIn}},createMultipleVideoPlayers:function(t){var e,i,s,n,r,a,o;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!c.isEmpty(this.VCIs)),c.isArray(t)){for(s=t.length,i=0;i<s;i++)if(r=(n=t[i])[0],a=n[1],o=n[2],n.length<2||!c.isString(r)||!c.isFunction(a)||!c.isUndefined(o)&&!c.isPlainObject(o))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),i=0;i<s;i++)r=(n=t[i])[0],a=n[1],o=n[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",r),o=this.CDO.getSessionOptions(o),e=this.validateAutoplay(o),!1===this._allowConcurrentPlayback&&e&&(this._disableAutoplay&&(o.enableMutedAutoplay=!1,o.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),e=new uvpjs.VideoControlInterface,(this.VCIs[r]=e).initialize(r,this.eventsMgr,this.CDO,a,o);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS)},validateAutoplay:function(t){var e=t.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),i=!!(t.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||e);return e&&(t.enableMutedAutoplay=!1),i||(t.enableMutedAutoplay=!1,t.enableUnmutedAutoplay=!1),i},overrideSessionOptio)},onVideoProgress:function(t){this._allowConcurrentPlayback||!c.isPlainObject(t)||c.isUndefined(t.target)||c.isUndefined(t.payload)||c.isUndefined(t.payload.playbackState)||t.payload.playbackState!==this.mc.PLAYING||(t=t.target,c.isEmpty(this.currActiveVCI)&&!c.isUndefined(this.VCIs[t])&&(this.currActiveVCI=this.VCIs[t]),t===this.currActiveVCI.vidContId)||c.isUndefined(this.VCIs[t])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",t),this.VCIs[t].pauseVideo({autoPause:!0}))},onVideoPlaybackInitiated:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",t),this._allowConcurrentPlayback||!c.isPlainObject(t)||c.isUndefined(t.target)||(t=t.target,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),c.isEmpty(this.VCIs))||c.isUndefined(this.VCIs[t])||this.currActiveVCI&&this.currActiveVCI.vidContId===t||(this.currActiveVCI=this.VCIs[t],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))},uvpjsError:function(t){t?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",t.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(t){t?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",t.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),w.VideoManager._instance=null,w.VideoManager.destroyInstance=function(){this._instance=null},w.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(z)),this._instance},w=uvpjs.register("uvpjs"),S=w._,w.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(t){var e=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,t&&(this._cviModel=t.cviModel,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=X(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=e.getCaptionsLineOffset(),this._lineAlign=e.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=t.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._disabled=!1,this.subtitleLanguage="en",this.subtitleMasterList=null,this.ccDisplayRequested=!1,this.isAndroidOnHlsjs=uvpjs.mediaCapabilities.canPlayHlsjsAndriod(this._cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=t,this.isAndroidOnHlsjs||this._ccEl||this._createCaptionsElement()},showCaptions:function(t){this._deferLoadingCaptions&&!this._hasCaptions()?(this._loadCaptionsUrl(this._captionsUrl),this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this))):(this.setCaptionLanguage(t),this.ccDisplayRequested=!0,!this._getActiveTrack()&&uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(t,"showing"))},setCaptionLanguage:function(t){var e,t=t.payload.language;uvpjs.util.isDefinedString(t)&&((e=this._getActiveTrack())&&e.language===this.subtitleLanguage&&this.subtitleLanguage!==t&&this._clearCaptionTrack(e),this.clearCcElInnerHtml(),this.subtitleLanguage=t)},getCaptionInfo:function(){for(var t=[],e=this.subtitleMasterList||this._getTextTracks(),i=this._getActiveTrack(),s=0;s<e.length;s++){var n=e[s];enabled=i&&i.language===n.language||!1,t.push({language:n.language,label:n.label,kind:n.kind,enabled:enabled})}return 0<e.length&&(this.subtitleMasterList=t),this.subtitleMasterList},hideCaptio)},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:S.clone(this.styles)},setStyles:function(t){var e,i,s=this._pageStyles,n=t.length;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",t);n--;)i=t[n],e=m(i.name),i=i.value,s[e]=i;this._updateStylesObject(s),this._applyStyles(),this._setPosition(s["text-position"]||null)}},setCueProperty:function(t,e){var i;this._disabled||(i=this._getActiveTrack(),t&&e&&i&&this._supportsVTTCue?(this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",i,t,e),this._props[t]=isNaN(e)?e:Number(e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",t,e))},_addEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners"),t.addEventListener(e.CONTAINER_RESIZE+i,this._onContainerResize.bind(this)),t.addEventListener(e.CONTROL_LOAD_CAPTIONS+i,this._onControlLoadCaptions.bind(this)),t.addEventListener(e.CONTENT_DATA_LOADED+i,this._onContentDataLoaded.bind(this)),t.addEventListener(e.CONTROL_SHOW_CAPTIONS+i,this.showCaptions.bind(this)),t.addEventListener(e.CONTROL_HIDE_CAPTIONS+i,this.hideCaptions.bind(this)),t.addEventListener(e.SET_CAPTIONS_LANG+i,this.setCaptionLanguage.bind(this)),t.addEventListener(e.CONTENT_FACADE_CREATED+i,this._onContentFacadeCreated.bind(this)),t.addEventListener(e.RESOURCE_END+i,this._onVideoComplete.bind(this)),t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),t.addEventListener(e.AD_START+i,this._onAdStart.bind(this))},_removeEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),t.removeEventListener(e.CONTAINER_RESIZE+i),t.removeEventListener(e.CONTROL_LOAD_CAPTIONS+i),t.removeEventListener(e.CONTENT_DATA_LOADED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.SET_CAPTIONS_LANG+i),t.removeEventListener(e.CONTENT_FACADE_CREATED+i),t.removeEventListener(e.RESOURCE_END+i),t.removeEventListener(e.VIDEO_PROGRESS+i),t.removeEventListener(e.AD_START+i)},_createTrackElement:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",t);var e=document.createElement("track");e.default=!0,e.kind="captions",e.label="English",e.srclang="en",e.id=this._trackId,e.src=t,this._videoEl.appendChild(e)},_createCaptionsElement:function(){var t=uvpjs.util,e=this._styleEl,i=document.createElement("div"),s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);i.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),s?(s.appendChild(i),this._ccEl=i,t.addCSSObject(e,i,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),t.addCSSObject(e,i,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),t.addCSSObject(e,i,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container.")},_dispatchCaptionsError:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",t),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:t},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this.adjustVttCuesLinePosition(),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(t){t.target===this._containerId&&this._setRect()},_onAdSta)},clearCcElInnerHt)},_onVideoComplete:function(t){var t=t.target,e=this._videoEl;t===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",t),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,e&&e.removeEventListener("loadeddata",this._onLoadedData),e&&e.removeEventListener("timeupdate",this._onTimeUpdate),(t=this._getTextTracks())&&(t.onaddtrack=null),(e=this._getActiveTrack())instanceof window.TextTrack&&E(e)&&(e.mode="disabled",e.oncuechange=null),this._trackCount++)},_onContentDataLoaded:function(t){var e=uvpjs.util,i=t.target,t=t.payload.vidState,s=t.closedCaptionPath;t.isLive;i===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",i),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,(t=this._getTextTracks())&&(t.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),e.isDefinedString(s))&&(this._captionsUrl=s)},_onLoadedData:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",t),this._checkForLiveCaptions()},_onTimeUpdate:function(t){!this.hasDispatchedCaptionsReady&&this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(t)},_onControlLoadCaptions:function(t){var e;t.target===this._containerId&&(e=t.payload.url,S.isString(e))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",t.target),this._loadCaptionsUrl(e))},_onContentFacadeCreated:function(t){t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",t.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(e){var t=e.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",e);try{var t=(t=t.replace(/\n/g,"")).substr(t.indexOf("<?xml")),i=(new DOMParser).parseFromString(t,"text/xml");this._xmlToCues(i)}catch(t){e="Error parsing closed captions XML.";this._dispatchCaptionsError(e),this.debug&&uvpjs.error(this.DEBUG_ID,e,t)}},_onLoadError:function(t){var t=t.status,e="Unknown error";switch(t){case 404:e="File not found";break;case 500:e="Server error";break;case 0:e="Request aborted"}this._dispatchCaptionsError(e+=" "+t),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",e)},_onAddTrack:function(t){var e=t.track;e.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(e,!1),E(e)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",t)},_syncCCTrackMode:function(t,e){t&&(e?t.mode="disabled":this.useNativeBrowserControls||uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(t.mode="showing"):"hidden"!==t.mode&&(t.mode="hidden"))},_onVideoProgress:function(t){var e;if(t.target===this._containerId){var i=this._getActiveTrack();if(this.isAndroidOnHlsjs||this._syncCCTrackMode(i,!1),this._hasCaptions())if(this._liveCaptionsInitalized)if(i&&i.activeCues&&(e=i.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);e--;)1<t.payload.currentTime-i.activeCues[e].endTime&&this.showCcContainer(!1);else this.showCcContainer(!1);else this._checkForLiveCaptions();else this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!t||!this._liveCaptionsInitalized){try{t||this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(t){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",t),this._dispatchCaptionsError(t)}t&&(this._liveCaptionsInitalized=!0),this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var t=this._getActiveTrack(),e=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),t&&(t.oncuechange=e)||this._videoEl.addEventListener("timeupdate",e)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var t=S.get(this._captionsJson,"tt.head.styling.style"),t=S.isArray(t)?t[0]:t;this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",t),t?this._inlineStyles={backgroundColor:t["tts:backgroundColor"],color:t["tts:color"],fontFamily:t["tts:fontFamily"],fontSize:t["tts:fontSize"],fontStyle:t["tts:fontStyle"],fontWeight:t["tts:fontWeight"],textAlign:t["tts:textAlign"],textDecoration:t["tts:textDecoration"]}:this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file.")},_applyStyles:function(){var t,e,i,s=uvpjs.util,n=this.styles,r=this._styleSelector,a=[];for(e in this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",n),n){switch(i=n[e],t=!1,e){case"background-opacity":case"font-opacity":t=!0;break;case"text-position":t=!0,this._setPosition(i);break;case"background-color":i=g(i,n["background-opacity"]);break;case"color":case"font-color":e="color",i=g(i,n["font-opacity"]);break;case"text-edge-style":e="text-shadow",i=it(i)}t||(Q(e,i)?a.push({name:e,value:i}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",e,i))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",r,a),s.addCSSRules(this._styleEl,r,a)},_updateStylesObject:function(t){var e,i,s;for(e in t){if(!(i=t[e])||!e)return;(s=m(e))in this.styles?("font-size"===s&&(i=J(i)),this.styles[s]=i):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",s)}},_hasCaptio)},_loadOrDeferCaptio)},_loadCaptionsUrl:function(t){var e=uvpjs.util.isDefinedString(t),i=e&&-1!==t.indexOf(".vtt");e&&!this._cviModel.contentVideoState.isFlash&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),i?this._createTrackElement(t):(new uvpjs.CodeLoader).loadXHR(t,this._onLoadComplete.bind(this),this._onLoadError.bind(this)))},_checkForLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),this._hasCaptions()?(this._finalizeTrackElement(),this._finalizeLiveCaptions()):this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize.")},_clearAllCaptionTracks:function(){var t=this._getTextTracks(),e=t&&t.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",t);e--;)this._clearCaptionTrack(t[e]);this.clearCcElInnerHtml()},_clearCaptionTrack:function(t){var e,i;if(E(t)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",t),i=(e=t&&t.cues)&&e.length||0;i--;)t.removeCue(e[i]);this._syncCCTrackMode(t,!0),t.cues=null}},_toggleVisibility:function(t,e){t.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",e),this.showCcContainer("hidden"!==e))},showCcContainer:function(t){this.isAndroidOnHlsjs?this._getActiveTrack().mode=t?"showing":"hidden":this._ccEl&&(t?this._ccEl.style.display="block":(this._ccEl.style.display="none",this._ccEl.innerHTML=""))},_getTextTracs},_getActiveTrack:function(){for(var t,e,i=this._getTextTracks(),s=i&&i.length||0,n=0;n<s;n++)if((e=(t=i[n])&&t.cues)&&e.length&&E(t))return t},enableCaptionsTracks:function(){for(var t,e=this._getTextTracks(),i=e&&e.length||0;i--;)t=e[i],E(t)&&(t.mode="hidden")},_getTrackById:function(t){var e=this._getTextTracks();return e&&e.getTrackById(t||this._trackId)},_getActiveCues:function(){var t=this._getActiveTrack();return t&&t.activeCues},_getAllCus},_getStyleSelectE},_setCDOParams:function(){var e,i,t=this._cviModel.getModule(this.CONFIG_MODULE_NAME),s={};this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",t),t?!0!==t.enabled?this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled."):S.isEmpty(t.params)?this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty."):(S.each(t.params,function(t){e=t.name,i=t.value,e&&i&&(m(e),s[e]=i)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(s,null,2)),this._configStyles=s):this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found.")},_setPosition:function(t){t=-1<["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"].indexOf(t)?t:"bottom-center-floated";this._setPositionCSS(t)},_setPositionCSS:function(t){var e,i=uvpjs.util,s=this._styleEl,n=this._ccEl,r=n&&n.style.marginBottom,a=parseInt(this.BASE_CONTROLS_HEIGHT);s&&n&&(e=(t=t.split("-"))[0],t=t[1],r="inherit"===r?0:parseInt(r),a=isNaN(r)?a+"px":(a<r?10:a-r)+"px",r={top:{top:"10px",middle:"50%",bottom:"auto"}[e],bottom:{top:"auto",middle:"auto",bottom:a}[e],"text-align":t,transform:"initial"},"middle"===e&&(r.transform="translateY(-50%)"),i.addCSSObject(s,n,r,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var t=this.styles;t&&this._setPosition(t["text-position"])},_setRect:function(){var t,e,i,s,n,r,a,o,l,d,u=this._videoEl,h=this._ccEl,c=u&&u.parentNode;function g(){S.assign(u.style,n),h&&(S.assign(h.style,n),this._checkBottomPosition())}u&&c&&(l=u.videoHeight,s=u.videoWidth)&&l&&(e=u.getBoundingClientRect(),t=c.getBoundingClientRect(),i=e.height,d=e.width,o=t.height-e.height,a=t.width-e.width,d=(i=i/d/(l/s))<1||0!=a&&0==o,(n=(l=1<i||0==a&&0!=o)?{height:"auto","max-height":"100%",width:"100%",margin:0}:d?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0})&&g.call(this),e=u.getBoundingClientRect(),o=(t=c.getBoundingClientRect()).height-e.height,a=t.width-e.width,l?n={margin:"inherit","margin-top":r=o/2+"px","margin-bottom":r}:d&&(n={margin:"inherit","margin-left":r=a/2+"px","margin-right":r}),h&&(n["font-size"]=this._calculateFontSize(e.width)),n)&&g.call(this)},_calculateFontSize:function(t){var e;try{e=t/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),e=Math.max(e,parseInt(this.MIN_FONT_SIZE))}catch(t){console.error(t)}return e&&e+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(t){t=t&&t.target,t=t&&t.activeCues||this._getActiveCues();this._setCueProps(t)},adjustVttCuesLinePosition:function(){if(this.isAndroidOnHlsjs){var t=this._getAllCues();if(t&&0<t.length){this._syncCCTrackMode(this._getActiveTrack(),!1);for(var e=0;e<t.length;e++){var i=t[e];!i||"auto"!==i.line&&-1!==i.line&&-2!==i.line||(i.line=-3)}}}},_setCueProps:function(t){this._addCuesToCaptionsElement(t)},_xmlToCues:function(t){var e,i,s,n,r,a,o,l,d,u,t=A(t);if(this._captionsJson=t,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",t),!S.isEmpty(t)&&S.isPlainObject(t))if(i=S.get(t,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",i),S.isUndefined(i)||S.isEmpty(i))this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file.");else if(e=this._supportsVTTCue?window.VTTCue:window.TextTrackCue){for((n=this._videoEl.addTextTrack("captions","English","en")).id=this._trackId,d=i.length,o=0;o<d;o++)if(a=i[o],s=i[l=o+1],r=a.text,!S.isEmpty(r)){for(r=(r=(r=r.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3")).replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3")).replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),u=p(r),a._lineCountPrev=a._lineCountPrev||0,a._lineCountNext=a._lineCountNext||0;(s&&s.begin)===a.begin;)s._lineCountPrev=u+a._lineCountNext,a._lineCountNext+=p(s.text),s=i[++l];(r=new e(v(a.begin),v(a.end),r))._lineCount=u,r._lineCountPrev=a._lineCountPrev,r._lineCountNext=a._lineCountNext,r._metadata=a.metadata,r=$.call(this,r),n.addCue(r)}this._finalizeCaptions()}else this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions.")},_addCuesToCaptionsElement:function(t){var e,i,s=uvpjs.util,n=this._ccEl,r='<div class="{{cntrClass}}">{{spans}}</div>',a="",o=t&&t.length;if(o){for(e=0;e<o;e++)i=t[e].text,s.isDefinedString(i)&&(a+='<span class="{{txtClass}}">'+(i=i.replace(/(\r\n|\n|\r)/g,"<br/>"))+"</span>",e+1!==o)&&(a+="<br/>");r=(r=(r=r.replace("{{spans}}",a)).replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME)).replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),n&&(n.innerHTML=r)}}}),g=function(t,e){var i=tt(t)||f(t)||f(Z(t));return i&&e?et(i.r,i.g,i.b,e):t}}},J=function(t){var e="100%";return-1<t.indexOf("px")?(e=t.replace("px",""),e=100*(e/=18)+"%"):-1<t.indexOf("%")&&(e=t),e},p=function(t){return t&&(t.match(/\n/g)||[]).length+1},v=function(t){var e;if(!S.isNull(t)&&!S.isUndefined(t))return)},t=t.split(":"),e(60*Number(t[0])*60+60*Number(t[1])+Number(t[2]),2)},f=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$s});t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},E=function(t){return t instanceof window.TextTrack&&("captions"===t.kind||"subtitles"===t.kind)},Q=function(t,e){if(t&&e)return S.get(window,"CSS.supports")?window.CSS.supports(t,e):"string"==typeof document.createElement("div").style[t]},$=function(e){var t,i=e._metadata;if(i){e.snapToLines=!0,t=Math.round(i.cccol/35*100),e.position=t;try{e.align=t<45?"start":55<t?"end":this._lineAlign}catch(t){e.align="center"}e.positionAlign=t<45?"line-left":55<t?"line-right":"center",e.line=i.ccrow-17+this._lineOffset,e._defaults={line:e.line,position:e.position,align:e.align,positionAlign:e.positionAlign}}return e},Z=function(t){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[t.toLowerCase()]},tt=function(t){if(-1!==t.indexOf("rgba"))return{r:(t=t.substr(5,t.length).split(","))[0],g:t[1],b:t[2]}},m=function(t){if(S.isString(t)&&!S.isEmpty(t))return t.replace(/([A-Z])/g,"-$1").toLowerCase()},et=function(t,e,i,s){return"rgba("+[t,e,i,s].join(",")+")"},it=function(t){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[t]||"none"},A=function(t){var i={};if(1===t.nodeType&&0<t.attributes.length)for(var e=0,s=t.attributes.length;e<s;e++){var n=t.attributes.item(e);i[n.nodeName]=n.nodeValue}else 3===t.nodeType&&(i=t.nodeValue);if("p"===t.nodeName&&(i.text="",S.each(t.childNodes,function(t){var e;"metadata"!==t.nodeName&&(e=(new XMLSerializer).serializeToString(t),1===t.nodeType&&(i.text+="br"===t.tagName?"\n":e),3===t.nodeType)&&(i.text+=e)})),t.hasChildNodes())for(var r=0,a=t.childNodes.length;r<a;r++){var o,l=t.childNodes.item(r),d=l.nodeName;void 0===i[d]?i[d]=A(l):(void 0===i[d].push&&(o=i[d],i[d]=[],i[d].push(o)),i[d].push(A(l)))}return i},function(t){"use strict";function i(t,e,i){for(var s in t)if(t[s][e]==i)return t[s];return!1}var n=t._,s=(t.ConfigDataObject=uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",controls:null,template:null,crossOriginAttrValue:null,allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(t)},initialize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",t),this.overrideSessionOptions(t)},destrl},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(t){if(!uvpjs.util.isEmpty(t.standardParams)&&null===this.adCallParams.standardParams)for(var e in this.adCallParams.standardParams={},t.standardParams)this.adCallParams.standardParams[e]=t.standardParams[e];if(!uvpjs.util.isEmpty(t.customParams)&&null===this.adCallParams.customParams)for(e in this.adCallParams.customParams={},t.customParams)this.adCallParams.customParams[e]=t.customParams[e]},overrideSessionOptions:function(t){t=this.getSessionOptions(t);t&&n.isPlainObject(t)?this.sessionOptions=t:this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type.")},getSessionOptil},getSessionOptions:function(t){var e,i,s=n.clone(this.sessionOptions);if(t&&n.isPlainObject(t)){if((e=t.skinConfig)&&!n.isEmpty(e))for(i in uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object."),e)s.hasOwnProperty(i)&&(s[i]=e[i]);for(i in s)t.hasOwnProperty(i)&&(s[i]=t[i])}return s},getModule:function(t){return s(this.modules,t)},getModules:function(){return this.modules},getModuleParam:function(t,e){t=s(this.modules,t),t=s(t.params,e);if(t&&t.hasOwnProperty("value"))return t.value},setModule:function(t){e(this.modules,t,"name",this.DEBUG_ID)},isModuleEnabled:function(t){var e=this.getModule(t);return e?(this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+t+":",e.enabled),e.enabled):(this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled module not found: "+t),!1)},isModuleS)},getCla)},getClasses:function(){return this.classes},getClassProperty:function(t,e){t=s(this.classes,t),t=a.call(this,t,"properties",this.DEBUG_ID),t=s(t,e);return a.call(this,t,"value",this.DEBUG_ID)},getClassListItems:function(t){t=s(this.classes,t);return a.call(this,t,"list",this.DEBUG_ID)},getClassListItemProperty:function(t,e,i){t=this.getClassListItems(t),t=r(t,e),e=a.call(this,t,"properties",this.DEBUG_ID),t=s(e,i);return a.call(this,t,"value",this.DEBUG_ID)},setClass:function(t){e(this.classes,t,"name",this.DEBUG_ID)},isCAN:function(){return n.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()},copyModules:function(t){for(var e=t.length;e--;)for(var i=t[e],s=this.modules.length;s--;)if(this.modules[s].name===i.name){this.modules[s]=i;break}}}),function(t,e){return i(t,"name",e)}))},a=function(t,e,i){return t?t.hasOwnProperty(e)?t[e]:(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty no item property:",t,e),!1):(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty item not found:",t),!1)},e=function(t,e,i,s){for(var n in t)if(t[n][i]==e[i])return this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray updating existing item",e),void(t[n]=e);this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray creating item",e),t.push(e)}}(uvpjs.register("uvpjs")),w=uvpjs.register("uvpjs"),T=w._,st=Math.random(),w.ConfigManager=uvpjs.Class.subClass({init:function(t,e,i){this.debug=uvpjs.debug,t&&t===st?(this.initCallback=i,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",e),this.CDO=new uvpjs.ConfigDataObject(e),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance().")},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(this.configSources.length){var t=this.configSources.shift();if(null!=t)switch(t.constructor){case String:if(""===t)break;return void(new uvpjs.CodeLoader).loadXHR(t,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=t.concat(this.configSources);break;case Object:this.updateCDO(t)}this.loadConfig()}else T.isFunction(this.initCallback)&&this.initCallback(this.CDO)},onLoadComplete:function(t){var e,i=t.responseText,t=t.getResponseHeader("Content-Type");-1<t.indexOf("application/json")?e=JSON.parse(i):-1<t.indexOf("text/xml")||-1<t.indexOf("application/xml")?(i=(new DOMParser).parseFromString(i,"text/xml"),e=this.xmlToCDO(i)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",t),e&&this.updateCDO(e),this.loadConfig()},onLoadError:function(t){var e="unknown error";0===t.status&&(e="request timeout"),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",e,t),this.loadConfig()},updateCDO:function(e){T.isEmpty(e)?this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"):["classes","modules"].map(function(t){e.hasOwnProperty(t)&&(this.CDO[t]=nt(this.CDO[t],e[t]))},this)},xmlToCDO:function(t}var e={},u=y(t);return u.hasOwnProperty("player-config")&&(u=u["player-config"]),e.modules=function(){var t,e,i=[];if(u.modules){for(var s in t=D(u.modules.module)){var n=t[s],r={name:n.name,category:n.category,enabled:d(n.enabled),params:[]};if(t[s].hasOwnProperty("params")){var a,o=D(n.params.param);for(a in o){var l=o[a];l.name&&("y"!==(e=l.value)&&"n"!==e||(l.value=d(l.value)),r.params.push(l))}}n.category;i.push(r)}return i}}(),e.classes=function(){var t,e=D(u.classes),i=[];for(t in e){var s=e[t];if((s=s.hasOwnProperty("classDef")?s.classDef:s).name){var n={name:s.name,className:s.className,properties:[],list:[]};if(s.hasOwnProperty("list")){var r,a=D(s.list.listitem);for(r in a){var o=a[r];o.id&&(o.hasOwnProperty("properties")&&(o.properties=o.properties.property),n.list.push(o))}}s.hasOwnProperty("properties")&&(n.properties=s.properties.property),i.push(n)}}return i}(),e},getCDO:function(){return this.CDO}}),w.ConfigManager._instance=null,w.ConfigManager.destroyInstance=function(){this._instance=null},w.ConfigManager.getInstance=function(t,e){return this._instance||(this._instance=new uvpjs.ConfigManager(st,t,e)),this._instance},nt=function(t,e){for(var i in e){var s,n=!1;for(s in t)if(t[s].name===e[i].name){n=!0;break}n||t.push(e[i])}return t},y=function(t){var e={};if(1===t.nodeType&&0<t.attributes.length)for(var i=t.attributes.length,s=0;s<i;s++){var n=t.attributes.item(s);e[n.nodeName]=n.nodeValue}if(t.hasChildNodes()){i=t.childNodes.length;for(var r=0;r<i;r++){var a,o=t.childNodes.item(r),l=o.nodeName;3!==o.nodeType&&(void 0===e[l]?e[l]=y(o):(void 0===e[l].push&&(a=e[l],e[l]=[],e[l].push(a)),e[l].push(y(o))))}}return e},D=function(t){if(void 0!==t&&t.constructor!==String)return t=t.constructor===Object?[t]:t},function(t){"use strict";var s=null,n=null,a=t._;t.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1,this.isMobile=!1},initialize:function(t){var e=t.resourceProvider,i=e.vidContId;this.resourceProvider=e,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=i,this.assetURL=t.assetURL,this.vidContentId=this.PREFIX_CONTENT+i,this.internalNS="."+i+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+i),this.deferLoadingCaptions=t.deferLoadingCaptions,this._updateVolumeSettings(t),e.createWatermark()&&!t.suppressWatermark&&(s=new uvpjs.Watermark({containerId:i,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),e.is360()&&!t.suppress360&&(n=new uvpjs.Kaleidoscope360({containerId:i,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==t.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){a.isEmpty(this.resourceProvider)?this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."):(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),s&&(s.destroy(),s=null),n&&(n.destroy(),n=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1)},_updateVolumeSettings:function(t){var e=(t=t||{}).volume,i=!0===t.isMuted,s=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",t),uvpjs.util.inRange(e,0,1)&&s.volume!==e&&(s.volume=e),"isMuted"in t&&s.muted!==i&&this.muteVideo(i)},_addHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(t in this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events"),e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.addEventListener(e[t],this,!1);this.videoTagRef.addEventListener(e[i],this,!1)},_removeHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(t in this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events"),e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.removeEventListener(e[t],this,!1);this.videoTagRef.removeEventListener(e[i],this,!1)},handleEvent:function(t){var e=this.eventTypes.HTML5;if(this.videoTagRef)switch(t.type){case e.ABORT:break;case e.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(e.CAN_PLAY,this,!1);break;case e.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(e.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.CLICK:case e.DURATION_CHANGE:break;case e.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case e.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case e.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(t.target.error);break;case e.LOAD_START:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),a.isEmpty(this.resourceProvider)?this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"):uvpjs.mediaCapabilities.isIOS()&&this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!");break;case e.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case e.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case e.PLAY:break;case e.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case e.PROGRESS:this.videoLoading();break;case e.RATE_CHANGE:break;case e.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",t);break;case e.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",t),this.seeked(t.target.currentTime);break;case e.STALLED:case e.SUSPEND:break;case e.TIME_UPDATE:this.timeUpdated();break;case e.VOL_CHANGE:this.volumeChanged();break;case e.WAITING:}},seeked:function(t){var e=this.videoTagRef.paused,i=uvpjs.mediaCapabilities;this.playbackStateChange(e?i.PAUSED:i.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:t,paused:e,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:t})},videoLoading:function(){try{e=this.videoTagRef.buffered.end(0)||0}catch(t){e=0}var e={bufferLength:e,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(e)},volumeChanged:function(){var t=this.videoTagRef.volume;!a.isNumber(t)||t<0?t=0:1<t&&(t=1),this.resourceProvider.facadeVolumeChange(t)},timeUpdated:function(){var t=this.videoTagRef.currentTime;"number"==typeof t&&this.resourceProvider.facadeTimeUpdate(t)},error:function(t){var e=uvpjs.ErrorInfo.messages,i=uvpjs.ErrorInfo.errorCodes,s=e.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,n=i.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,r=!0;if(t)switch(t.code){case t.MEDIA_ERR_ABORTED:r=!1,s=e.MEDIA_ERR_ABORTED,n=i.MEDIA_ERR_ABORTED;break;case t.MEDIA_ERR_NETWORK:s=e.MEDIA_ERR_NETWORK,n=i.MEDIA_ERR_NETWORK;break;case t.MEDIA_ERR_DECODE:s=e.MEDIA_ERR_DECODE,n=i.MEDIA_ERR_DECODE;break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:s=e.MEDIA_ERR_SRC_NOT_SUPPORTED,n=i.MEDIA_ERR_SRC_NOT_SUPPORTED}this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+s),a.isEmpty(this.resourceProvider)?this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."):this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:n,message:s,isFatal:r}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVid)},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var t;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(t=this.videoTagRef.play()))&&t.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this))},handlePlayPromiseRejection:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+t.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(t.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",t),isNaN(t)||this.videoTagRef&&0<=t&&t<this.videoTagRef.duration&&(this.videoTagRef.currentTime=t)},seekToLive:function(){var t;this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef&&(t=this.videoTagRef.seekable&&0<this.videoTagRef.seekable.length&&this.videoTagRef.seekable.end(0),!isNaN(t))&&t>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=t)},toggleMute:function(){var t;this.videoTagRef&&(t=!this.videoTagRef.muted,this.muteVideo(t))},setFullscreenState:function(t){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(t){t=!1!==t;this.videoTagRef&&((this.videoTagRef.muted=t)&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),t||this.videoTagRef.removeAttribute("muted"))},unMuteVid)},getVolu0},setVolume:function(t){this.videoTagRef&&0<=t&&t<=1&&(this.videoTagRef.volume=t)},getDuration:function(){var t=0;return t=this.videoTagRef&&(t=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&0<this.videoTagRef.seekable.length?this.videoTagRef.seekable.end(0):t},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(t){this.isAbrStreamingSupported()&&"boolean"==typeof t||!this.debug||uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(t,e,i){if(0<t.length){var s=t.length,n=t[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(e>=t[s-1][n])return s-1;for(;s--;)if(t[s][n]<=e)return i?s+1:s}return 0},addSessionIdAndTicketToURL:function(t,e,i){var s;return t&&"},e&&-1===t.indexOf("SessionId=")&&(t+=s(t)+"SessionId="+e),i)&&-1===t.indexOf("Ticket=")&&(t+=s(t)+"Ticket="+i),t},processResponseHeader:function(t,e){e===this.responseHeaders.MULTI_CDN&&this.resourceProvider.getContentVideoStateCdn()!==t&&this.resourceProvider.setContentVideoStateCdn(t)},getCdnNameAtStart"},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVid)},removeEvents:function(){},setSize:function(t,e){},getBuffered:function(){var t=this.videoTagRef,t=t&&t.buffered,e=0,i=0;return t&&0<t.length&&(e=t.start&&t.start(0),i=t.end&&t.end(0)),0<(t=i-e)&&t||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkStae},manageNativeControls:function(t){var e;this.videoTagRef&&(e=this.videoTagRef.hasAttribute(this.CONTROLS),t&&!e?this.videoTagRef.setAttribute("controls",this.CONTROLS):!t&&e&&this.videoTagRef.removeAttribute(this.CONTROLS))},playbackStateChange:function(t){t!==this.playbackState&&(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+t),a.isEmpty(this.resourceProvider)?this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"):this.resourceProvider.facadePlaybackStateChange(t))},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var t=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!a.isUndefined(t),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,t=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",t),t},normalizeAudioTrackInfo:function(t,e){if(t){for(var i=[],s=0;s<t.length;s++){var n=t[s];this.checkCodecForWeb(n)&&i.push({index:s,id:n.id,type:n.type||n.kind,codec:n.codec||"n/a",label:e===uvpjs.mediaCapabilities.DASHJS?n.lang:n.label||n.name})}return i}},checkCodecForWeb:function(t){return!t.codec||-1!==t.codec.indexOf("mp4a")}})}(uvpjs.register("uvpjs")),function(t){"use strict";var s="www.nielsen.com";t.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(t){for(var e in t)this.initOptions[e]=t[e];t.suppress360=!0,t.suppressCreatedEvent=!0,this._super(t),this.swfService=t.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){for(var t in this.windowLabels)window[this.windowLabels[t]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVid)},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(t){this.player&&this.player.setVolume(t)},seekTo:function(t){this.player&&this.player.seekTo(t)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVid)},setFullscreenState:function(t){this.swfService.resetSize()},loadCaptions:function(t){this.captionsUrl=uvpjs.util.isEmpty(t)?null:t,this.captionsUrl&&!this.deferLoadingCaptions&&(this.hasCaptions=!0,this.player.loadCaptions(t))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl&&(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0),this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(t){for(var e,i,s,n=Array.isArray(t)&&t.length||0,r=uvpjs.util,a=uvpjs.VPF_Flash.styleTransform;n--;)e=t[n],s=a[i=this.dashToCamel(e.name)]?a[i](e.value):e.value,r.isEmpty(e.value)||this.player.setStyleAttribute(i,s)},setId3Options:function(t){this.id3Options=t},getAbrInl},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLi1},getDroppedFramesCount:function(){return-1},getCurrentBandwid1},getFacadeSta}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(t){this.player.enableDynamicStreaming(!1===t?"false":"true")},switchToBitrate:function(t){t=this.findClosestBitrate(t);-1!==t.index&&this.player.switchStreamingIndex(t.index)},setMinBitrateAllowed:function(t){t=this.findClosestBitrate(t);-1!==t.index&&(this.bitrateInfo.min=t.bitrate,this.player.setMinimumStreamingIndex(t.index))},setMaxBitrateAllowed:function(t){t=this.findClosestBitrate(t);-1!==t.index&&(this.bitrateInfo.max=t.bitrate,this.player.setMaximumStreamingIndex(t.index))},switchUp:function(){var t=this.currFlashVideoState.playbackBitrate,t=this.findClosestBitrate(t),e=-1!==t.index&&this.bitrateInfo.bitrates.length;-1!==t.index&&t.index<e-1&&this.player.switchStreamingIndex(t.index+1)},switchDown:function(){var t=this.currFlashVideoState.playbackBitrate,t=this.findClosestBitrate(t);-1!==t.index&&0<t.index&&this.player.switchStreamingIndex(t.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var t=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return t?this.bitrateInfo.bitrates[t-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitra1},findClosestBitrate:function(t){for(var e,i=this.bitrateInfo.bitrates,s=i?i.length:0,n={bitrate:0,delta:1/0,index:-1};s--;)(e=Math.abs(t-i[s]))<n.delta&&(n.bitrate=i[s],n.index=s,n.delta=e);return n},hContentEvent:function(t){var e=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(t){case e.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case e.CONTENT_END:}},hPlaybackEvent:function(t,e){var i,s=uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(t){case s.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+e);break;case s.VIDEO_PROGRESS:this.processCvioPayload(e);break;case s.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(e);break;case s.VIDEO_ERROR:this.processCvioPayload(e),this.dispatchError();break;case s.VIDEO_DONE:this.processCvioPayload(e),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case s.VIDEO_TRANSITION_COMPLETE:i=this.parsePayload(e),this.resourceProvider.facadeVideoTransitionComplete(i.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case s.VIDEO_TRANSITION_START:i=this.parsePayload(e),this.pendingSwitchMode=0<=i.reason.toLowerCase().indexOf("manual")?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(i.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(t){var e,i,t=this.parsePayload(t,"ContentVIO");if(t){for(e in i=t.ContentVIO)this.currFlashVideoState[e]=this.getCvioValue(i[e]);null===this.bitrateInfo.bitrates&&0<i.currentTime&&this.captureBitrateInfo()}},setStartBitra0},captureBitrateInfo:function(){for(var t=[],e=[],i=this.player.getContentBitrateInfo(),s="string"==typeof i&&i.split(","),n=Array.isArray(s)?s.length:0;n--;)t[n]=+s[n],e[n]={bitrate:+s[n]};this.bitrateInfo.bitrates=t,this.bitrateInfo.abrInfo=e},processCuepointPayload:function(t){var t=this.parsePayload(t,"Cuepoint"),e=this.id3Options,i={pts:null};!t||!e.dataCallback||0<=t.text.indexOf("syncbak.cc")||(i.name=e.findNielsen&&-1<t.text.indexOf(s)?s:t.name,i.data=t.text,e.dataCallback(i))},getCvioValue:function(t){var e,i,s,n;return"boolean"==typeof t||"number"==typeof t?t:"string"==typeof t?(i=!(e="NaN"===t||"null"===t||""===t)&&"true"===t.toLowerCase(),s=!e&&!i&&"false"===t.toLowerCase(),n=!e&&!i&&!s&&parseInt(t),t=isNaN(n)?t:n,e?-1:i||!s&&t):void 0},parsePayload:function(t,e){var i=null;if(0!==t.indexOf("{")&&0!==t.indexOf("["))return t;try{i=JSON.parse(t)}catch(t){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+e+"as JSON; "+t.message),null}return i},addUvpFlashEventListeners:function(){var t,e,i,s,n,r,a,o=uvpjs.VPF_Flash.uvpFlashEvent,l={};for(i in o)for(s in e=o[i])l[a=e[s]]=(a=a,(n=this)["h"+((r=i).charAt(0).toUpperCase()+r.substr(1))+"Event"].bind(n,a));for(i in t=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(l))this.player.addEventJSCallback(i,t[i])},loadVideo:function(){var t={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(t.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,t)},initializeCaptionStyles:function(){var t,e={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(t in e)this.player.setStyleAttribute(t,e[t])},dashToCam)}}),t.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},t.VPF_Flash.styleTransform={_opacit},backgroundOpacity:function(t){return uvpjs.VPF_Flash.styleTransform._opacity(t)},fontOpaci)},fontSize:function(t){t=t.substr(0,t.indexOf("%"));return Math.round(14*(.01*+t))}}}(uvpjs.register("uvpjs")),w=uvpjs.register("uvpjs"),rt=w._,w.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.hVideoEvent=this.onVideoEvent.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(t){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",t.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",t)),this._super(t),t.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:t.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),uvpjs.util.isEmpty(t.startTime)||(this.startTime=Math.floor(t.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",t)},handleEvent:function(t){var e=this.eventTypes.HTML5;this.videoTagRef&&(this._super(t),t.type===e.LOADED_METADATA)&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null)},handleFairPlayError:function(t,e){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:t,message:e,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(t){console.log("Error caught at setSource: ",t)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onVideoEvent:function(t){t.type===this.eventTypes.HTML5.CAN_PLAY&&(this.videoTagRef.removeEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.updateAudioTracksInfo())},switchAudioTrack:function(t){this.videoTagRef.audioTracks?(this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+t),this.videoTagRef.audioTracks[t].enabled=!0,this.updateAudioTracksInfo()):this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switching is not supported on this user agent")},updateAudioTracksInfo:function(){var t=this.normalizeAudioTrackInfo(this.videoTagRef.audioTracks,uvpjs.mediaCapabilities.HTML5);t&&(t={tracks:t,track:t[t=this.getCurrentEnabledAudioTrackIndex(this.videoTagRef.audioTracks)],index:t},this.resourceProvider.facadeSetAudioTrackInfo(t))},getCurrentEnabledAudioTrackIndex:function(t){for(var e=t.length;e--;)if(t[e].enabled)return e;return e},onAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(this.activeMetadataTrack=t.track),t.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(t){t&&t.target&&t.target.activeCues&&1<=t.target.activeCues.length&&("metadata"===t.target.kind?this.resourceProvider.facadeId3Data(t.target.activeCues):"captions"!==t.target.kind&&"subtitles"!==t.target.kind||(t.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},showCaptions:function(t){if(uvpjs.util.isDefinedString(t)){for(var e=this.videoTagRef.textTracks,i=!1,s=0,n=e.length;s<n;s++){var r=e[s];r.language===t?(i=!0,r.mode="hidden"):r.mode="disabled"}i||(uvpjs.log(this.DEBUG_ID,"Language string was supplied but nothing matched in the stream. Enabling the first track in the list as best effort",e,t),e[0].mode="hidden")}},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeSta}},getStreamTy"},onStalledEvent:function(t){var e;rt.isEmpty(this.resourceProvider)||rt.isEmpty(this.resourceProvider.cviModel)?this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",t):(e=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",t,e))}}),uvpjs.register("uvpjs").VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"prod"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isHdStreamLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.levelDetails=null,this.isMobile=uvpjs.mediaCapabilities.isMobile(),this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onAudioEvent=this.onAudioEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy");for(var t=this.videoTagRef.textTracks,e=0;e<t.length;e++){var i=t[e];"captions"!==i.kind&&"subtitles"!==i.kind||(i.textTrack1&&(i.textTrack1=!1),i.textTrack2&&(i.textTrack2=!1))}this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null,this.levelDetails=null},initialize:function(t){return this._super(t),this.id3HandlingEnabled=t.enableId3Handling,"number"==typeof t.liveSyncDurationCount&&0<t.liveSyncDurationCount&&(this.libConfig.liveSyncDurationCount=t.liveSyncDurationCount),!0===t.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=t.capLevelToPlayerSize),this.isMobile&&(this.libConfig.maxBufferLength=20,this.libConfig.maxMaxBufferLength=60,this.libConfig.liveBackBufferLength=30),uvpjs.util.isEmpty(t.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=t.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof t.startBitrate&&-1<t.startBitrate&&(this.startBitrate=t.startBitrate),"number"==typeof t.maxBitrate&&-1<t.maxBitrate&&(this.maxBitrate=t.maxBitrate),"number"==typeof t.minBitrate&&-1<t.minBitrate&&(this.minBitrate=t.minBitrate),t.startTime&&(this.startTime=Math.round(t.startTime)),t.errorRecovery&&this.setErrorRecoveryOverrides(t.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){this.player&&this._isHdStreamLive?this.seekTo(this.getLiveEdgeOffset()):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+isHDStreamLive)},isAbrStreamingSupported:function(){return this.bitrateList?0<this.bitrateList.length:this._super()},useDynamicSwitching:function(t){this._super(),this.player?this.player.nextLevel=t?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchAudioTrack:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+t),this.player.audioTrack=t},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(t){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,t,!1))},switchToIndex:function(t){var e;this.isAbrStreamingSupported()?(0<this.getMinBitrateAllowed()&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&0<this.getMaxBitrateAllowed()&&this.setMaxBitrateAllowed(-1),e=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,e=isNaN(e)?this.bitrateList.length-1:e,0<=t&&t<=e?this.player.nextLevel=t:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",e," : Index=",t)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){0<this.player.subtitleTracks.length&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var t=this.player;return this.startBitrate||this.minBitrate||t&&t.levels&&t.levels[0]&&t.levels[0].bitrate||-1},setStartBitrate:function(t){this.player?(t<this.getMinBitrateAllowed()&&(t=this.getMinBitrateAllowed(),this.debug)&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,t,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){var t;return this.player?(t=this.player.minAutoLevel,this.bitrateList?this.bitrateList[t].bitrate:this._super()):(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super())},setMinBitrateAllowed:function(t){var e;this.player?(this.player.config.minAutoBitrate=t-1,e=this.getIndexForBitrate(this.bitrateList,t,!0),this.player.currentLevel<e&&(this.player.nextAutoLevel=e),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",t)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){var t;return this.player?void 0!==(t=this.player.maxAutoLevel)?this.bitrateList[t].bitrate:this._super():(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super())},setMaxBitrateAllowed:function(t){if(!this.player)return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===t?t:this.getIndexForBitrate(this.bitrateList,t,!1),uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",t)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var t=-1;return t=this.bitrateList&&this.bitrateList[this.player.currentLevel]?this.bitrateList[this.player.currentLevel].bitrate:t},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var t,e;if(this.player)return(e=(t=this.player.media).getVideoPlaybackQuality)&&"function"==typeof e?e.call(t).droppedVideoFrames:t.webkitDroppedFrameCount||0},getAverageDroppedF)},getCappedAbrInfo:function(){var t=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,e=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(e,t)},getFacadeState:function(){this.videoTagRef&&0<this.videoTagRef.textTracks.length&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var t={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(t.abrInfo=this.bitrateList,t.currentAbr=this.bitrateList[this.player.currentLevel],t.cappedAbrInfo=this.getCappedAbrInfo(),t.startBitrate=this.getStartBitrate(),t.currentBitrate=this.getCurrentBitrate(),t.minBitrate=this.getMinBitrateAllowed(),t.maxBitrate=this.getMaxBitrateAllowed()),t},getStreamType:function(){return"HLS"},isPlayingLive:function(){var t,e=!1;return this._isHdStreamLive&&this.levelDetails&&0<=this.videoTagRef.currentTime&&(t=Math.floor(this.getLiveEdgeOffset()),e=Math.ceil(this.videoTagRef.currentTime)>=t),e},getLiveEdgeOffset:function(){var t=Number.POSITIVE_INFINITY;return t=this._isHdStreamLive&&this.levelDetails&&0<this.videoTagRef.duration?this.videoTagRef.duration-this.player.config.liveSyncDurationCount*this.levelDetails.targetduration:t},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onAudioEvent,n=this.onFragmentEvent;this.player.on(t.MEDIA_ATTACHING,e,!1),this.player.on(t.MEDIA_ATTACHED,e,!1),this.player.on(t.MEDIA_DETACHING,e,!1),this.player.on(t.MANIFEST_PARSED,e,!1),this.player.on(t.MANIFEST_LOADED,e,!1),this.player.on(t.MANIFEST_LOADING,e,!1),this.player.on(t.FPS_DROP,e,!1),this.player.on(t.SUBTITLE_TRACKS_UPDATED,e,!1),this.player.on(t.LEVEL_SWITCHING,i,!1),this.player.on(t.LEVEL_SWITCHED,i,!1),this.player.on(t.LEVEL_LOADING,i,!1),this.player.on(t.LEVEL_LOADED,i,!1),this.player.on(t.LEVEL_UPDATED,i,!1),this.player.on(t.LEVEL_PTS_UPDATED,i,!1),this.player.on(t.AUDIO_TRACKS_UPDATED,s,!1),this.player.on(t.AUDIO_TRACK_SWITCHED,s,!1),this.player.on(t.FRAG_LOADING,n,!1),this.player.on(t.FRAG_LOAD_PROGRESS,n,!1),this.player.on(t.FRAG_LOADED,n,!1),this.player.on(t.FRAG_PARSED,n,!1),this.player.on(t.FRAG_BUFFERED,n,!1),this.player.on(t.FRAG_CHANGED,n,!1),this.player.on(t.FRAG_PARSING_DATA,n,!1),this.id3HandlingEnabled&&this.player.on(t.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(t.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onAudioEvent,n=this.onFragmentEvent;this.player.off(t.MEDIA_ATTACHING,e),this.player.off(t.MEDIA_ATTACHED,e),this.player.off(t.MEDIA_DETACHING,e),this.player.off(t.MANIFEST_PARSED,e),this.player.off(t.MANIFEST_LOADED,e),this.player.off(t.MANIFEST_LOADING,e),this.player.off(t.FPS_DROP,e),this.player.off(t.SUBTITLE_TRACKS_UPDATED,e),this.player.off(t.LEVEL_SWITCHING,i),this.player.off(t.LEVEL_SWITCHED,i),this.player.off(t.LEVEL_LOADING,i),this.player.off(t.LEVEL_LOADED,i),this.player.off(t.LEVEL_UPDATED,i),this.player.off(t.LEVEL_PTS_UPDATED,i),this.player.off(t.AUDIO_TRACKS_UPDATED,s,!1),this.player.off(t.AUDIO_TRACK_SWITCHED,s,!1),this.player.off(t.FRAG_LOADING,n),this.player.off(t.FRAG_LOAD_PROGRESS,n),this.player.off(t.FRAG_LOADED,n),this.player.off(t.FRAG_PARSED,n),this.player.off(t.FRAG_BUFFERED,n),this.player.off(t.FRAG_CHANGED,n),this.player.off(t.FRAG_PARSING_DATA,n),this.id3HandlingEnabled&&this.player.off(t.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(t.ERROR,this.onError)},handleManifestData:function(t){this.bitrateList=this.player.levels;for(var e,i=t.levels,s=i.length,n=[];s--;)e=i[s],n.unshift({name:e.name||null,rate:e.bitrate,width:e.width,height:e.height});n.so0}),this.resourceProvider.facadeMetadataParsed({abrInfo:n})},onRequest:function(i,s){this.withCredentials=this.withCredentials||-1<s.indexOf("akamaihd")&&-1<s.indexOf("csmil"),i.withCredentials=this.withCredentials;!this.multiCDNEnabled&&-1===s.indexOf(".m3u8")||i.addEventListener("readystatechange",function(t){var e;-1!==s.indexOf(".ts")&&i.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled&&(e=i.getAllResponseHeaders(),this.multiCDNEnabled=-1!==e.indexOf(this.responseHeaders.MULTI_CDN),e=this.multiCDNEnabled?i.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(s),this.processResponseHeader(e,this.responseHeaders.MULTI_CDN))}.bind(this))},onLibraryEvent:function(t,e){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.MEDIA_ATTACHING:case i.MEDIA_ATTACHED:case i.MEDIA_DETACHING:case i.MANIFEST_LOADING:break;case i.MANIFEST_PARSED:this.handleManifestData(e);break;case i.FPS_DROP:break;case i.MANIFEST_LOADED:-1<this.maxBitrate&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),-1<this.minBitrate&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),-1<this.startBitrate&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case i.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(t,e){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(e.details);break;case i.LEVEL_LOADING:break;case i.LEVEL_UPDATED:e.details&&(this.levelDetails=e.details,this._isHdStreamLive=e.details.live);break;case i.LEVEL_PTS_UPDATED:break;case i.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[e.level].bitrate);break;case i.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[e.level].bitrate)}},onAudioEvent:function(t,e){t!==Hls.Events.AUDIO_TRACKS_UPDATED&&t!==Hls.Events.AUDIO_TRACK_SWITCHED||(t={tracks:t=this.normalizeAudioTrackInfo(this.player.audioTracks,this.mc.HLSJS),track:t[this.player.audioTrack],index:this.player.audioTrack},this.resourceProvider.facadeSetAudioTrackInfo(t),this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switched",t.track))},onFragmentEvent:function(t,e){var i,s=Hls.Events;switch(t){case s.FRAG_LOAD_PROGRESS:break;case s.FRAG_PARSING_DATA:"video"===e.type&&(this._playbackFramerate=e.nb/(e.endPTS-e.startPTS));break;case s.FRAG_LOADED:i=8e3*(i=e.frag.stats).loaded/Number(window.performance.now()-i.trequest),this._currentBandwidth=i,this._currentMaxBandwidth=Math.max(i,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case s.FRAG_CHANGED:}},onID3Eve)},onError:function(t,e){var i=!1,s=[Hls.ErrorDetails.MANIFEST_LOAD_ERROR,Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(e.fatal&&-1===s.indexOf(e.details))switch(this.debug&&uvpjs.error(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal),e.type){case Hls.ErrorTypes.NETWORK_ERROR:(i=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts)&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(i).network());break;case Hls.ErrorTypes.MEDIA_ERROR:i=this.tryRecoveryFromMediaError()}else e.details===Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",e.type,e.details,"isFatal: "+e.fatal),i=this.tryRecoveryFromMediaError(),setTimeo)}.bind(this),100)):this.debug&&uvpjs.warn(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal);i||(e.response&&e.response.code&&e.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,e.details,e.fatal)),this.debug&&uvpjs.warn(this.DEBUG_ID,uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(e.type,e.details,e.fatal)))},tryRecoveryFromMediaError:function(){var t=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return t&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(t).media()),t},getErrorMsg:function(t){var e=t?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,i=" attempt : ";return{network:function(){return i+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+e+i}.bind(this),media:function(){return i+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+e+i}.bind(this)}},getErrorInfoForType:function(t,e,i){var s=uvpjs.ErrorInfo,n=Hls.ErrorTypes,r=uvpjs.ErrorInfo.errorCodes;switch(t){case n.NETWORK_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_NETWORK_ERROR,message:s.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",e),isFatal:i});case n.MEDIA_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_MEDIA_ERROR,message:s.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",e),isFatal:i});case n.MUX_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_MUX_ERROR,message:s.messages.HLSJS_MUX_ERROR.replace("{INFO}",e),isFatal:i});case n.OTHER_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_OTHER_ERROR,message:s.messages.HLSJS_OTHER_ERROR.replace("{INFO}",e),isFatal:i});case r.RESOURCE_GEOBLOCKED:return new s({errorCode:r.RESOURCE_GEOBLOCKED,hlsjsErrorCode:r.HLSJS_OTHER_ERROR,message:s.messages.RESOURCE_GEOBLOCKED,isFatal:i})}},setErrorRecoveryOverrides:function(e){["network","media"].forEach(function(t){e[t]&&e[t].attempts&&"number"==typeof e[t].attempts&&(this.errorRecovery[t+"RetryAttempts"]=e[t].attempts)}.bind(this))}}),function(){"use strict";function a(t){if(!isNaN(t))return t<1048576?(t/1024).toFixed(2)+"k":t<1073741824?(t/1048576).toFixed(2)+"M":(t/1073741824).toFixed(2)+"G"}uvpjs.register("uvpjs").Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(t){var e,i=uvpjs.Configuration;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),t&&(e=t.videoEl,this._videoEl=e,this._containerEl=t.containerEl,this._eventsMgr=t.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":i.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),this._diagEl&&this._contentEl?(this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window.")},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=t,this._createDiag(),this._addEventListeners()},_createDiag:function(){var t,e,i=uvpjs.util,s=this._styleEl,n=this._contentEl;this._template,this._params;n&&((t=document.createElement("div")).id=this._diagnosticId,n.insertBefore(t,n.firstChild),(n=uvpjs.util.htmlToElement("<span>x</span>")).addEventListener("click",this._handleCloseButton.bind(this),!0),t.appendChild(n),e=document.createElement("table"),t.appendChild(e),i.addCSSObject(s,t,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),i.addCSSObject(s,t,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),i.addCSSObject(s,t,{color:"#fff"},"span:hover"),i.addCSSObject(s,t,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),i.addCSSObject(s,t,{background:"transparent"},"table td"),i.addCSSObject(s,t,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),i.addCSSObject(s,t,{width:"60px"},"table td:last-child"),this._diagEl=t,this._diagTableEl=e,this._hideDiagBtn=n)},_removeDiag:function(){var t=this._diagEl,e=this._hideDiagBtn;e&&e.removeEventListener("click",this._handleCloseButton.bind(this)),t&&t.remove()},_hideDiag:function(){var t=this._diagEl,e=this._eventsMgr;t&&(t.style.display="none"),e.dispatchEvent(e.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var t=this._diagEl;t&&(t.style.display="block")},_toggleDiag:function(){var t=this._diagEl;t&&("block"===t.style.display?this._hideDiag():this._showDiag())},_handleCloseButton:function(){var t=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),t.dispatchEvent(t.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;this._containerEl;e&&t?(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),e.addEventListener(i.VIDEO_PROGRESS+t,this._onVideoProgress.bind(this)),e.addEventListener(i.VIDEO_STATE_CHANGE+t,this._onVideoStateChange.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_START+t,this._onVideoTransitionStart.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_COMPLETE+t,this._onVideoTransitionComplete.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;this._containerEl;e&&t?(e.removeEventListener(i.VIDEO_PROGRESS+t),e.removeEventListener(i.VIDEO_STATE_CHANGE+t),e.removeEventListener(i.VIDEO_TRANSITION_START+t),e.removeEventListener(i.VIDEO_TRANSITION_COMPLETE+t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners.")},_updateTableHtml:function(){var t,e,i="",s=this._params;for(t in s)null!=(e=s[t])&&(i+="<tr><td>"+t+"</td><td>"+e+"</td></tr>");this._diagTableEl.innerHTML=i},_onVideoProgress:function(t){var e=t.payload,i=e.facadeState,s=this._params,n=i.minABRLevel,r=i.maxABRLevel;t.target===this._containerId&&(s["stream type"]=e.streamType,s.duration=e.duration,s["current time"]=e.currentTime.toFixed(2),s["buffer length"]=e.bufferLength.toFixed(2),s["total dropped frames"]=0<=e.droppedFrames&&e.droppedFrames||null,s["average dropped (fps)"]=0<=e.averageDroppedFPS&&e.averageDroppedFPS.toFixed(2)||null,s["playback framerate (fps)"]=0<=e.playbackFramerate&&e.playbackFramerate.toFixed(2)||null,s["current bandwidth (B/s)"]=0<=e.currentBandwidth&&a(e.currentBandwidth)||null,s["switching mode"]=e.switchingMode,s["current index bitrate (B/s)"]=a(i.currentAbr&&i.currentAbr.bitrate),s["start index bitrate (B/s)"]=a(i.startBitrate),void 0!==n&&void 0!==r&&(s["available indexes"]=n+" to "+r),this._updateTableHtml())},_onVideoStateChange:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(i["playback state"]=e.newState,this._updateTableHtml())},_onVideoTransitionStart:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",e),i["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",e),i["transition state"]="complete",this._updateTableHtml())}})}(),function(){"use strict";uvpjs.register("uvpjs").Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){this._imgEl&&this._contentEl?(this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark.")},_createImage:function(){var t;this._contentEl&&((t=document.createElement("img")).id=this._watermarkId,t.src=this.IMAGE,t.style.position="absolute",t.style.display="none",this._imgEl=t,this._contentEl.appendChild(t))},_removeIma)},_ensureImage:function(){document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var t=this._imgEl;t&&(t.style.display="none")},_showIma)},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.addEventListener(i.AD_START+t,this._hideImage.bind(this)),e.addEventListener(i.CONTENT_START+t,this._showImage.bind(this)),e.addEventListener(i.CONTENT_END+t,this._hideImage.bind(this)),e.addEventListener(i.CONTAINER_RESIZE+t,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),e.addTimedEventCallback(e.HALF_SECOND,t,this._ensureImage.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.removeEventListener(i.AD_START+t),e.removeEventListener(i.CONTENT_START+t),e.removeEventListener(i.CONTENT_END+t),e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeTimedEventCallback(this.TIMER_INTERVAL,t),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(t){t.target===this._containerId&&this._setPosition()},_setPosition:function(){var t,e,i,s,n,r,a,o,l,d,u=this._contentEl,h=this._videoEl,c=this._imgEl;c&&h&&u&&(l=h.videoHeight,n=h.videoWidth)&&l&&(t=this.OFFSET,s=this.SIZE,h=h.getBoundingClientRect(),u=u.getBoundingClientRect(),e=h.height,i=h.width,r=u.bottom-h.bottom,u=u.right-h.right,l=1<e/i/(h=l/n)?(a=(e-i*h)/2,o=0,d=i*s+"px","auto"):(a=0,o=(i-e/h)/2,d="auto",e*s*(this.RATIO/h)+"px"),c.style.width=d,c.style.height=l,c.style.bottom=a+r+t+"px",c.style.right=o+u+t+"px")}})}(),function(){"use strict";uvpjs.register("uvpjs").Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){this._360El&&this._kaleidoscopeViewer?(this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360.")},_loadKaleidoscope:function(t){"function"!=typeof t?this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied."):(this.pluginLoaded)}.bind(this),window.Kaleidoscope&&window.Kaleidoscope.Video?this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB)))},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.addEventListener(i.CONTAINER_RESIZE+t,this._handleContainerResize.bind(this)),e.addEventListener(i.CONTENT_START+t,this._startKaleidoscopeRender.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeEventListener(i.CONTENT_START+t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")}})}(),uvpjs.register("uvpjs").ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(t,e,i){this.debug=uvpjs.debug,this.validationInfo=null,this.id=e,this.vidContId=i,this.rcoSeed={},this.initialize(t)},initialize:function(t){this.validationInfo=this.validateUserRco(t),this.validationInfo&&(this.rcoSeed=t,this.populateSelf(t))},getContextMetadata:function(){return this.contextMetadata||null},populateSe)},has:function(t){return!uvpjs.util.isEmpty(this[t])},getValidationInfo:function(){return this.validationInfo},validateUserR}}}),uvpjs.register("uvpjs").RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t),t=uvpjs.util.isDefinedString(t.assetURL);return{error:e.error||!t,message:e.error?e.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(t,e,i)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGut},canMakePlatformCall:function(t){var e=uvpjs.util.isDefinedString(t),e=this.has("selectorCall")&&this.selectorCall||e&&t;return!!e&&(-1<e.indexOf("$PID$")?this.has("pid"):!(-1<e.indexOf("$GUID$"))||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var t=this.daiParams.dfpMediaId,e=this.daiParams.daiVideoId,i=t||e||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return t||e||i},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(t){var e=window.google&&google.ima&&google.ima.dai,i=this.validateDaiConfig(t),s=this._super(t);return{error:!((t.useSsb||e)&&i&&!s.error),missingSDK:!e,message:s.error?s.message:e?i?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing."}},populateSelf:function(t){var e,i;for(e in t)(i=t.hasOwnProperty(e))&&void 0!==this.daiParams[e]?this.daiParams[e]=t[e]:i&&(this[e]=t[e]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(t){var e=uvpjs.util,i=!e.isEmpty(t.adTagParameters),s=!e.isEmpty(t.contentSourceId),n=!e.isEmpty(t.assetKey);return t.useSsb||n||i&&s?t.useSsb?!e.isEmpty(t.assetURL):n||i&&s:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),i&&s)},checkCustomAdTagParams:function(){var t=uvpjs.util,e=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;e&&"string"!=typeof e&&t.isPlainObject(e)&&(t=t.queryStrFromObj(e),this.daiParams.adTagParameters.cust_params=encodeURIComponent(t))}}),uvpjs.register("uvpjs").RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=window.google&&google.ima,t=this._super(t);return{error:!(e&&!t.error),missingSDK:!e,message:t.error?t.message:"IMA SDK is missing."}}}),uvpjs.register("uvpjs").RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t);return{error:e.error||!uvpjs.util.isDefinedString(t.assetURL),message:e.err?e.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=uvpjs.util,i=e.isDefinedString(t.pid),s=!i&&e.isDefinedString(t.cmsRefGuid)&&!e.isDefinedString(t.assetURL),n=this._super(t);return{error:!(!n.error&&(i||s||e.isDefinedString(t.selectorCall))),message:n.error?n.message:"Supplied RCO is not valid for type rp_platform"}}}),function(t){"use strict";t.UvpSwfService=uvpjs.Class.subClass({init:function(t){this.debugId=t.debugId,this.debug=uvpjs.debug,this.containerId=t.containerId,this.dom=t.contentVideoDom,this.playerDom=t.playerDom,this.callback=t.readyCallback,this.id3OwnerIds=t.id3OwnerIds||"",this.capLevelToPlayerSize=t.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){for(var t in this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype,this.windowLabels)window[this.windowLabels[t]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSi)},setSize:function(){var t=this.getContainerSize(),e=t.width,t=t.height;this.swf&&this.swf.setSize(e,t,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=(-1!==navigator.appName.indexOf("Microsoft")?window:document)[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(t){},startTimer:function(){this.initTimeoutHandle=setTimeo)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(t){t.success?this.startTimer():this.callback(null,this.svcC.error.EMBED_FAILED)},embed:function(t){var e=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,t,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:e.jsReady,playerReady:e.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var t,e,i=this.dom;this.svcC.hasFlash()?(this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),(t=document.createElement("div")).id=this.swfName,(e=i.querySelector("video")).style.display="none",i.style.height="100%",this.playerDom.style.height="100%",i.insertBefore(t,e),this.embed(t)):this.callback(null,this.svcC.error.FLASH_NOT_DETECTED)}}),t.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},t.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},t.UvpSwfService.hasFlash=function(){var t=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(t)&&0<parseInt(t)},t.UvpSwfService.setWindowMethods=function(t){var e,i,s,n=uvpjs.util;for(e in t)i=t[e],s="f_"+n.uid8(),window[s]=i,t[e]=s;return t},t.UvpSwfService.swfobject=function(){var r,a,o,l,d,u,m="undefined",A="object",h="Shockwave Flash",p="application/x-shockwave-flash",c="SWFObjectExprInst",e="onreadystatechange",g=window,v=document,f=navigator,F=!1,n=[],E=[],_=[],S=[],T=!1,y=!1,s=!0,D=!1,I=function(){var t=typeof v.getElementById!=m&&typeof v.getElementsByTagName!=m&&typeof v.createElement!=m,e=f.userAgent.toLowerCase(),i=f.platform.toLowerCase(),s=/win/.test(i||e),i=/mac/.test(i||e),e=!!/webkit/.test(e)&&parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),n="Microsoft Internet Explorer"===f.appName,r=[0,0,0],a=null;if(typeof f.plugins!=m&&typeof f.plugins[h]==A)(a=f.plugins[h].description)&&typeof f.mimeTypes!=m&&f.mimeTypes[p]&&f.mimeTypes[p].enabledPlugin&&(n=!(F=!0),a=a.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),r[0]=U(a.replace(/^(.*)\..*$/,"$1")),r[1]=U(a.replace(/^.*\.(.*)\s.*$/,"$1")),r[2]=/[a-zA-Z]/.test(a)?U(a.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof g.ActiveXObject!=m)try{var o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");o&&(a=o.GetVariable("$version"))&&(n=!0,r=[U((a=a.split(" ")[1].split(","))[0]),U(a[1]),U(a[2])])}catch(t){}return{w3:t,pv:r,wk:e,ie:n,win:s,mac:i}}();I.w3&&((typeof v.readyState!=m&&("complete"===v.readyState||"interactive"===v.readyState)||typeof v.readyState==m&&(v.getElementsByTagName("body")[0]||v.body))&&i(),T||(typeof v.addEventListener!=m&&v.addEventListener("DOMContentLoaded",i,!1),I.ie&&(v.attachEvent)}),g==top}}(),I.w)}()));function i(){if(!T&&document.getElementsByTagName("body")[0]){try{var t,e=N("span");e.style.display="none",(t=v.getElementsByTagName("body")[0].appendChild(e)).parentNode.removeChild(t),e=t=null}catch(t){return}T=!0;for(var i=n.length,s=0;s<i;s++)n[s](t}function j(){var t=E.length;if(0<t)for(var e=0;e<t;e++){var i=E[e].id,s=E[e].callbackFn,n={success:!1,id:i};if(0<I.pv[0]){var r=k(i);if(r)if(!B(E[e].swfVersion)||I.wk&&I.wk<312)if(E[e].expressInstall&&b()){for(var a={},o=(a.data=E[e].expressInstall,a.width=r.getAttribute("width")||"0",a.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(a.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(a.align=r.getAttribute("align")),{}),l=r.getElementsByTagName("param"),d=l.length,u=0;u<d;u++)"movie"!=l[u].getAttribute("name").toLowerCase()&&(o[l[u].getAttribute("name")]=l[u].getAttribute("value"));R(a,o,i,s)}else{h=a=void 0;var h,a=r;I.ie&&4!=a.readyState?(a.style.display="none",h=N("div"),a.parentNode.insertBefore(h,a),h.parentNode.replaceChild(P(a),h),L(a)):a.parentNode.replaceChild(P(a),a),s&&s(n)}else w(i,!0),s&&(n.success=!0,n.ref=C(i),n.id=i,s(n))}else w(i,!0),s&&((r=C(i))&&typeof r.SetVariable!=m&&(n.success=!0,n.ref=r,n.id=r.id),s(n))}}function C(t){var e=null,t=k(t);return e=t&&"OBJECT"===t.nodeName.toUpperCase()?typeof t.SetVariable===m&&t.getElementsByTagName(A)[0]||t)}function R(t,e,i,s){var n=k(i);i=O(i),o=s||null,l={success:!(y=!0),id:i},n&&(a="OBJECT"==n.nodeName.toUpperCase()?(r=P(n),null):(r=n,i),t.id=c,(typeof t.width==m||!/%$/.test(t.width)&&U(t.width)<310)&&(t.width="310"),(typeof t.height==m||!/%$/.test(t.height)&&U(t.height)<137)&&(t.height="137"),s=I.ie?"ActiveX":"PlugIn",s="MMredirectURL="+encodeURIComponent(g.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+s+"&MMdoctitle="+encodeURIComponent(v.title.slice(0,47)+" - Flash Player Installation"),typeof e.flashvars!=m?e.flashvars+="&"+s:e.flashvars=s,I.ie&&4!=n.readyState&&((s=N("div")).setAttribute("id",i+="SWFObjectNew"),n.parentNode.insertBefore(s,n),n.style.display="none",L(n)),M(t,e,ie}function M(t,e,i){var s,n,r,a,o,l,d=k(i);if((i=O(i),!(I.wk&&I.wk<312))&&d){var u,h,c,g=I.ie?N("div"):N(A);for(c in typeof t.id==m&&(t.id=i),e)e.hasOwnProperty(c)&&"movie"!==c.toLowerCase()&&(r=g,o=e[a=c],l=void 0,(l=N("param")).setAttribute("name",a),l.setAttribute("value",o),r.appendChild(l));for(u in I.ie&&(i=t.data,s=g.innerHTML,(n=N("div")).innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+i+"'>"+s+"</object>",g=n.firstChild),t)t.hasOwnProperty(u)&&("styleclass"===(h=u.toLowerCase())?g.setAttribute("class",t[u]):"classid"!==h&&"data"!==h&&g.setAttribute(u,t[u]));I.ie?_[_.length]=t.id:(g.setAttribute("type",p),g.setAttribute("data",t.data)),d.parentNode.replaceChild(g,d),s=g}returnction B(t){var e=I.pv,t=(t+="").split(".");return t[0]=U(t[0]),t[1]=U(t[1])||0,t[2]=U(t[2])||0,e[0]>t[0]||e[0]==t[0]&&e[1]>t[1]||e[0]==t[0]&&e[1]==t[1]&&e[2]>=t[2]}function x(t,e,i,s){var n=v.getElementsByTagName("head")[0];n&&(i="string"==typeof i?i:"screen",s&&(u=d=null),d&&u==i||((s=N("style")).setAttribute("type","text/css"),s.setAttribute("media",i),d=n.appendChild(s),I.ie&&typeof v.styleSheets!=m&&0<v.styleSheets.length&&(d=v.styleSheets[v.styleSheets.length-1]),u=i),d)&&(typeof d.addRule!=m?d.addRule(t,e):typeof v.createTextNode!=m&&d.appendChild(v.createTextNode(t+" {"+e+"}")))}function w(t,e){var i;s&&(e=e?"visible":"hidden",i=k(t),T&&i?i.style.visibility=e:"string"==typeof t&&x("#"+t,"visibility:"+et}n[0]=function(){var i,s,n,r;(F&&(s=v.getElementsByTagName("body")[0],(n=N(A)).setAttribute("style","visibility: hidden;"),n.setAttribute("type",p),r=s.appendChild(n))?(i)}):j)()};I.ie&&window.attachEvent("onunload",function(){for(var t=S.length,e=0;e<t;e++)S[e][0].detachEvent(S[e][1],S[e][2]);for(var i,s,n=_.length,r=0;r<n;r++)L(_[r]);for(i in I)I[i]=null;for(s in I=null,swfobject)swfobject[s]=null;swfobject=null});return{registerObje)},getObjectBy)},embedSWF:function(o,l,d,u,h,c,g,p,v,f){var E=O(l),_={success:!1,id:E};I.w3&&!(I.wk&&I.wk<312)&&o&&l&&d&&u&&h?(w(E,!1),t(function(){d+="",u+="";var t={};if(v&&typeof v===A)for(var e in v)t[e]=v[e];t.data=o,t.width=d,t.height=u;var i,s={};if(p&&typeof p===A)for(var n in p)s[n]=p[n];if(g&&typeof g===A)for(var r in g)g.hasOwnProperty(r)&&(i=D?encodeURIComponent(r):r,r=D?encodeURIComponent(g[r]):g[r],typeof s.flashvars!=m?s.flashvars+="&"+i+"="+r:s.flashvars=i+"="+r);if(B(h)){var a=M(t,s,l);t.id==E&&w(E,!0),_.success=!0,_.ref=a,_.id=a.id}else{if(c&&b())return t.data=c,void R(t,s,l,f);w(E,!0)}f&&f(_)})):f&&f(_)},switchOffAutoHideSh1},enableUriEncodit},ua:I,getFlashPlayerVersi}},hasFlashPlayerVersion:B,createS)},showExpressInsta)},removeS)},createC)},addDomLoadEvent:t,addLoadEvent:function(t){var e,i,s,n;typeof g.addEventListener!=m?g.addEventListener("load",t,!1):typeof v.addEventListener!=m?v.addEventListener("load",t,!1):typeof g.attachEvent!=m?(s="onload",n=t,(i=g).attachEvent(s,n),S[S.length]=[i,s,n]):"function"==typeof g.onload?(e=g.onload,g.onlo)}):g.onload=t},getQueryParamVal"},expressInstallCallback:function(){var t;y&&((t=k(c))&&r&&(t.parentNode.replaceChild(r,t),a&&(w(a,!0),I.ie)&&(r.style.display="block"),o)&&o(l),y=!1)},version:"2.3"}}()}(uvpjs.register("uvpjs")),w=uvpjs.register("uvpjs"),I=w._,w.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.containers=t.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=t.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=t.p2pClient,this.multiCdnClient=t.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(t.rco,t.cviMgr,t.vidContId)},initialize:function(t,e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",t),this.rco=t,this.vidContId=i,this.cviMgr=e,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",(t=this.cviModel.contentVideoState).sendResumeEvent=!1,t.startTime=0,t.elapsedTime=0,t.showPreroll=!0,t.playedChapterTime=0,t.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({cviModel:this.cviModel,eventsManager:this.eventsMgr}),I.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var t=this.eventsMgr;this._removeTimers(),t.addTimedEventCallback(t.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),t.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionSty)},_removeTimers:function(){var t=this.eventsMgr;t.removeTimedEventCallback(t.TENTH_SECOND,this.internalNS),t.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var t=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(t)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProl},loadVideoAndBeginPlayback:function(t){var e=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),e.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),e.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),e.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=t,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(t){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,t)})):this.finishLoadVideoAndBeginPlayback(t),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(t,e,i){var s=uvpjs.ErrorInfo;i?(s=new s({errorCode:s.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+i,isFatal:!0}),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:s},this.vidContId)):setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,t),2)},handleCdnDecisi)},shouldUseFlash:function(){var t=this.mc.systemInfo,e=this.cviModel.getSessionOption("preventFlashPlayback"),i=t.supportsNativeHls||t.isHlsjsEligible,e=!e&&t.isDesktop&&uvpjs.UvpSwfService.hasFlash(),t=this.mc.isHlsUrl(this._getAssetUrl()),s=uvpjs.Configuration.env;return!("local"!==s&&"dev"!==s&&"stage"!==s||!window.forceFlash||!e)||t&&!i&&e},prepForCaptionEvents:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY,t.SET_CAPTIONS_LANG],i=e.length;i--;)this.eventsMgr.addEventListener(e[i]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY,t.SET_CAPTIONS_LANG],i=e.length;i--;)this.eventsMgr.removeEventListener(e[i]+this.internalNS)},hCaptionEventForUvp:function(t){var e=this.eventsMgr.eventTypes;if(this._hasFacade()&&t.target===this.vidContId)switch(t.type){case e.CAPTIONS_READY:uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case e.CONTROL_SHOW_CAPTIONS:uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions(t.payload.language);break;case e.CONTROL_HIDE_CAPTIONS:uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions();break;case e.SET_CAPTIONS_LANG:uvpjs.util.isFunction(this.facade.setCaptionLanguage)&&this.facade.setCaptionLanguage(t.payload.language)}},finishLoadVideoAndBeginPlayback:function(t){var e=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),e.incrementMedNum(),this.createFacade(),e=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(e),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),e===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(t){var e,t=t&&t.providers||null,t=t&&t[0]?t[0]:null,i=t&&t.host||null,t=t&&t.provider||null;i&&(e=this._getAssetUrl(),i!==(e=uvpjs.util.parseUrl(e)).host)&&(i=e.protocol+"//"+i+e.pathname+e.search,this.cviModel.contentVideoState.assetURL=i),t&&this.setContentVideoStateCdn(t)},setContentVideoStateCdn:function(t){this.cviModel.contentVideoState.cdn=t,this.debug&&uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:t},this.vidContId)},getContentVideoStateCn},setModelRcoOverrides:function(){function t(t){var e=i.getSessionOption(t);return"boolean"==typeof e?e:void 0!==i.getVideoPlaybackCDOProperty(t)&&i.getVideoPlaybackCDOProperty(t)}function e(t){var e=i.getSessionOption(t);return"number"==typeof e&&0<=e?e:void 0!==i.getVideoPlaybackCDOProperty(t)?Number(i.getVideoPlaybackCDOProperty(t)):-1}var i=this.cviModel,s=e(i.START_BITRATE),n=e(i.MIN_BITRATE),r=e(i.MAX_BITRATE),a=e(i.LIVE_SYNC_DURATION_COUNT),o=t(i.CAP_LEVEL_TO_PLAYER_SIZE),l=t(i.DASHJS_FAST_SWITCH_ABR),d=i.getSessionOption("useDynamicSwitching"),u=i.getSessionOption("errorRecovery"),h=Number(this.rco.startBitrate)||-1,c=Number(this.rco.minBitrate)||-1,g=Number(this.rco.maxBitrate)||-1,p=Number(this.rco.liveSyncDurationCount)||-1,v=this.rco.capLevelToPlayerSize,f=this.rco.enableDashJSFastSwitchABR,E=(this.rco.useDynamicSwitching,this.rco.useDynamicSwitching),_=this.rco.errorRecovery;-1<h?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",h),i.setStartBitrate(h)):i.setStartBitrate(s),-1<c?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",c),i.setMinBitrate(c)):i.setMinBitrate(n),-1<g?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",g),i.setMaxBitrate(g)):i.setMaxBitrate(r),-1<p?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",p),i.setLiveSyncDurationCount(p)):i.setLiveSyncDurationCount(a),"boolean"==typeof v?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",v),i.setCapLevelToPlayerSize(v)):i.setCapLevelToPlayerSize(o),"boolean"==typeof f?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",f),i.setDashJSFastSwitchABR(f)):i.setDashJSFastSwitchABR(l),"boolean"==typeof E?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",E),i.setUseDynamicSwitching(E)):i.setUseDynamicSwitching(d),"object"==typeof _?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",_),i.setErrorRecovery(_)):i.setErrorRecovery(u)},createId3Parser:function(t){this.id3EventQueue=[];var e={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(t){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(e);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(e);break;case this.mc.FLASH_HLS:e.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(e)}},handleId3Metadata:function(t){this.id3EventQueue&&this.id3EventQueue.push(t)},checkId3Events:function(t){for(var e,i=this.id3EventQueue,s=i&&i.length||0;s--;)t>=(e=i[s]).pts&&(this.dispatchCuepointEvent(e),this.id3EventQueue.splice(s,1))},dispatchCuepointEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,t,this.vidContId)},createFacade:function(){var t=this.cviModel,e=t.getContentVideoState(),i=this._getAssetUrl(),e={enableId3Handling:this.id3HandlingEnabled,assetURL:i,isMuted:t.isMuted,resourceProvider:this,startTime:e.startTime,startBitrate:t.startBitrate,maxBitrate:t.maxBitrate,minBitrate:t.minBitrate,useDynamicSwitching:t.useDynamicSwitching,liveSyncDurationCount:t.liveSyncDurationCount,volume:t.volume,capLevelToPlayerSize:t.capLevelToPlayerSize,enableDashJSFastSwitchABR:t.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:t.errorRecovery,drm:e.drm},i=(this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",e),this.facade=this.getFacade(i),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(e.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(e.swfService=this.uvpSwfService),this.facade.initialize(e));!i||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:i,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(t.nativeControls)},destroyFacade:function(){var t=this._hasFacade()&&"function"==typeof this.facade.destroy;this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),t?(this.facade.destroy(),this.facade={}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up.")},muteContentForAdPlay:function(t){var e=this.cviModel,i=this.facade;this._hasFacade()&&(!1!==t?i.muteVideo():e.isMuted||i.unMuteVideo())},getModu)},getModulePar)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:t},this.vidContId)},dispatchContentEnd:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:t},this.vidContId)},dispatchSeekDone:function(){var t=this.eventsMgr;t.dispatchEvent(t.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var t=this.cviModel&&this.cviModel.contentPlaybackState.fatalError;this.eventsMgr&&(this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+(t?"Fatal ERROR encountered":"")),t||this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId))},dispatchVideoStateChange:function(t){isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:t,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+t,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataPars)},facadeProgress:function(t){!uvpjs.util.isEmpty(t)&&"object"==typeof t&&t.currentTime&&t.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:t.currentTime}),this.setModelDuration(parseInt(t.duration)))},facadeDurationChanged:function(t){uvpjs.util.isEmpty(t)||"object"!=typeof t||t.duration},setModelDuration:function(t){0<t&&this.cviModel.contentVideoState.duration!==t&&(this.cviModel.setContentVideoStateItems({duration:t}),this.cviModel.setContentPlaybackStateItems({duration:t}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",t),this._seekFromTime?(this._seekToTime=t.seekToTime,this.dispatchSeekDone()):this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE.")},facadeError:function(t){var e,i,s=uvpjs.util,n=this.RPM&&this.RPM.currRP,r=this.eventsMgr,a=this.cviModel,o=!s.isEmpty(a),l=t.isFatal;this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+t.message),o&&l&&(i=(e=this.cviModel.getContentVideoState()).playbackStarted,e=s.isDefinedString(e.overrideAssetURL),!i)&&e&&!this._overrideAssetUrlFailure?this._handleOverrideAssetURLError(t):(o||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),s.isEmpty(r)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(i=t.eventType||r.eventTypes.VIDEO_PLAYBACK_ERROR,t.eventType=i,r.dispatchEvent(i,{errorInfo:t},this.vidContId)),l&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),o&&(a.contentPlaybackState.fatalError=!0),n&&n.rco&&n.rco.type===uvpjs.mediaCapabilities.RP_IMA?n.imaContentComplete():(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp())))},facadePlaybackStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+t),this.dispatchVideoStateChange(t)},facadeVideoLevelLoaded:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:t},this.vidContId)},facadeVideoTransitionStart:function(t,e){e=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+t+" mode = "+e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:t,mode:e},this.vidContId)},facadeVideoTransitionComplete:function(t,e){e=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+t+" mode = "+e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:t,mode:e},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeSetAudioTrackInfo:function(t){this.cviModel.setAudioTrackInfo(t)},facadeId3Da)},facadeMinimumBitrateAllowedChanged:function(t){this.cviModel.setMinBitrate(t)},facadeMaximumBitrateAllowedChanged:function(t){this.cviModel.setMaxBitrate(t)},getFacade:function(t){var e,i=this.mc.STREAMING,t=t||this._getAssetUrl(),s=this.mc.isHlsUrl(t),t=this.mc.isDashUrl(t),n=this.cviModel.contentVideoState.isFlash;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(n||s||t)&&this._setDeliveryType(i),!n&&s)this.mc.canPlayHLSJS()&&(e=new uvpjs.VPF_HLSJS);else if(!n&&t)if(uvpjs.VPF_DASHJS)e=new uvpjs.VPF_DASHJS;else{if(!uvpjs.VPF_SHAKA)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));e=new uvpjs.VPF_SHAKA}else n&&(e=new uvpjs.VPF_Flash);return e||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",s),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,t.addEventListener(e.CONTROL_SEEK+i,this.onVideoSeekTo.bind(this)),t.addEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i,this.onVideoSeekToLive.bind(this)),t.addEventListener(e.CONTROL_PAUSE+i,this.onPauseVideo.bind(this)),t.addEventListener(e.CONTROL_PLAY+i,this.onPlayVideo.bind(this)),t.addEventListener(e.CONTROL_MUTE+i,this.onMuteVideo.bind(this)),t.addEventListener(e.CONTROL_UNMUTE+i,this.onUnMuteVideo.bind(this)),t.addEventListener(e.CONTROL_VOLUME_SET+i,this.onChangeVideoVolume.bind(this)),t.addEventListener(e.CONTROL_FULLSCREEN+i,this.onFullscreen.bind(this)),t.addEventListener(e.SWITCH_REQUEST+i,this.onSwitchRequest.bind(this)),t.addEventListener(e.USE_DYNAMIC_SWITCHING+i,this.onUseDynamicSwitching.bind(this)),t.addEventListener(e.MAXIMUM_BITRATE_ALLOWED+i,this.onMaximumBitrateAllowed.bind(this)),t.addEventListener(e.MINIMUM_BITRATE_ALLOWED+i,this.onMinimumBitrateAllowed.bind(this)),t.addEventListener(e.CONTAINER_RESIZE+i,this.handleContainerResize.bind(this)),t.addEventListener(e.SWITCH_AUDIO_TRACK+i,this.onSwitchAudioTrack.bind(this)))},_removeUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",s),t.removeEventListener(e.CONTROL_SEEK+i),t.removeEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i),t.removeEventListener(e.CONTROL_PAUSE+i),t.removeEventListener(e.CONTROL_PLAY+i),t.removeEventListener(e.CONTROL_MUTE+i),t.removeEventListener(e.CONTROL_UNMUTE+i),t.removeEventListener(e.CONTROL_VOLUME_SET+i),t.removeEventListener(e.SWITCH_REQUEST+i),t.removeEventListener(e.USE_DYNAMIC_SWITCHING+i),t.removeEventListener(e.MAXIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.MINIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.CAPTIONS_READY+i),t.removeEventListener(e.CONTAINER_RESIZE+i),t.removeEventListener(e.SWITCH_AUDIO_TRACK+i)},_getAssetUrl:function(t){var e=uvpjs.util,t=t||this.cviModel.getContentVideoState(),i=t.overrideAssetURL,e=e.isDefinedString(i)&&!this._overrideAssetUrlFailure,i=e?i:t.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+e+")",i),i},_setDeliveryType:function(t){this.cviModel.setContentVideoStateItems({deliveryType:t})},_handleOverrideAssetURLError:function(t){var e=uvpjs.ErrorInfo,i=this.eventsMgr,s=i.eventTypes.VIDEO_START_ERROR,n=e.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,n+" Error using overrideAssetURL; will use assetURL."),t.eventType=s,t.message=n,t.isFatal=!1,t.errorCode=e.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,i.dispatchEvent(s,{errorInfo:t},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(t){var e=t&&t.target,t=t&&t.payload,i=t&&t.bitrate,s=this.cviModel,n=this.facade;if(e===this.vidContId&&i&&this._hasFacade())switch(typeof i){case"string":if("up"===i)s.setUseDynamicSwitching(!1),n.switchUp();else if("down"===i)s.setUseDynamicSwitching(!1),n.switchDown();else{if(i=Number(i),isNaN(i))return;s.setUseDynamicSwitching(!1),n.switchToBitrate(i)}break;case"number":s.setUseDynamicSwitching(!1),n.switchToBitrate(i);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",i)}},onSwitchAudioTrack:function(t){uvpjs.util.isFunction(this.facade.switchAudioTrack)&&this.facade.switchAudioTrack(t.payload.id)},onUseDynamicSwitching:function(t){t&&t.target===this.vidContId&&t.payload&&(t=t.payload.data,this.cviModel.setUseDynamicSwitching(t),this._hasFacade()&&(this.facade.useDynamicSwitching(t),t)&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate)),this.debug)&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",t)},onMinimumBitrateAllowed:function(t){var e=t.payload,e=e&&e.bitrate,i=this.facade;t.target===this.vidContId&&(e&&"number"==typeof e?(this.cviModel.setMinBitrate(e),this._hasFacade()&&i.setMinBitrateAllowed(e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+e,typeof e))},onMaximumBitrateAllowed:function(t){var e=t.payload,e=e&&e.bitrate,i=this.facade;t.target===this.vidContId&&(e&&"number"==typeof e?(this.cviModel.setMaxBitrate(e),this._hasFacade()&&i.setMaxBitrateAllowed(e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+e,typeof e))},onVideoSeekTo:function(t){var e=t&&t.target,t=t&&t.payload,t=t&&t.seekTime,i=this.cviModel.contentVideoState.duration,s=this.cviModel.contentPlaybackState.currentTime,n=this.facade;"number"==typeof t&&e===this.vidContId&&(t<0||i<t?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+t):(this._seekFromTime=this._seekFromTime||s,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:t,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&n.seekTo(t)))},onVideoSeekToLive:function(){var t=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&t.seekToLive()},facadeVolumeChange:function(t){!I.isNaN(t)&&I.isNumber(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:t},this.vidContId)},facadeLoading:function(t){t&&(t.bufferLength||t.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,{data:t},this.vidContId)},facadeTimeUpda)},onFullscreen:function(t){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(t.payload.isFs)},onPauseVideo:function(t){var t=t&&t.target,e=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",t),t===this.vidContId&&this._hasFacade()&&e.pauseVideo()},onPlayVideo:function(t){var t=t&&t.target,e=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",t),t===this.vidContId&&this._hasFacade()&&e.playVideo()},onChangeVideoVolume:function(t){var e=t&&t.target,t=t&&t.payload,t=t&&t.vol,i=uvpjs.util.inRange(t,0,1),s=this.cviModel.isMuted,n=this.facade;e===this.vidContId&&i&&!s&&this._hasFacade()&&n.setVolume(t)},onMuteVideo:function(t){var t=t&&t.target,e=this.facade;t===this.vidContId&&this._hasFacade()&&e.muteVideo()},onUnMuteVideo:function(t){var t=t&&t.target,e=this.facade;t===this.vidContId&&this._hasFacade()&&e.unMuteVideo()},onUVPJSTimerTick:function(){var t;this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING&&(t={},this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),t=this.cviModel.getContentVideoState(),!I.isEmpty(this.cviModel.sessionOptions.userId))&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:t},this.vidContId)),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1),t=this.getVideoProgressPayload(),this.setModelDuration(t.duration),this.id3HandlingEnabled&&this.checkId3Events(t.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t,this.vidContId))},checkBuffering:function(t){var e=this.cviModel?this.cviModel.contentPlaybackState:null;e&&e.playbackStarted&&e.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(t=t||e.currentTime||0,!this.bufferingDetected&&t<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&t>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=t)},getVideoProgressPayload:function(){this.cviModel.getCurrentVideoState();var t={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:this.facade.getDuration(),errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(t),t},setFacadeStateOnProgressPayload:function(t){var e=this.facade,i=this._hasFacade()&&e.getFacadeState();if(!i)return t;t.facadeState=i,t.averageDroppedFPS=e.getAverageDroppedFPS(),t.bufferLength=e.getBuffered()||0,t.currentTime=e.getCurrentTime()||0,t.currentBandwidth=e.getCurrentBandwidth(),t.currentMaxBandwidth=e.getCurrentMaxBandwidth(),t.droppedFrames=e.getDroppedFramesCount(),t.playbackFramerate=e.getPlaybackFramerate(),t.playbackState=e.getPlaybackState(),t.streamType=e.getStreamType(),t.isHDStreamLive=e.isHDStreamLive(),t.isPlayingLive=e.isPlayingLive(),t.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var t=this.cviModel.contentVideoState,e=localStorage.getItem("UVPJS.resumePid")||null,i=localStorage.getItem("UVPJS.resumeContentTime")||null,s=localStorage.getItem("UVPJS.resumeEpochTime")||null,n=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(e&&(t.resumePid=e),i&&(t.resumeContentTime=i),s&&(t.resumeEpochTime=s),n)&&(t.resumeSessionId=n)},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelSta)},_hasFaca)}}),w=uvpjs.register("uvpjs"),at=w._,ot="pubads.g.doubleclick.net",lt="ad.doubleclick.net",dt="request.php",ut="Request.jsp",w.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(t){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=t||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.cviModel=this.opts.cviModel,this.eventsMgr=this.opts.eventsManager,this.cviModel.contentVideoStateDefaults&&this.populateDefaults(this.cviModel.contentVideoStateDefaults),this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptio]},getModel:function(){return this.mdl},getProper]},setPropere},loadData:function(t,e){var i,s="callback=uvpHandleJsonpResult",n=e||this.opts.queryParams,r=!1,a=!uvpjs.util.isEmpty(n);if(this.opts.url=t,this.opts.queryParams=e,a)for(i in t+=t.indexOf("?")<0?"?":"&",n)t+=(r?"&":"")+i+"="+n[i],r=!0;t.indexOf(s)<0&&(t+=(t.indexOf("?")<0?"?":"&")+s),this.selectorCall=t,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var t=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),t.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalErr)},signalSucce)},parseSmilXML:function(t){var e,i,s,n,r,a,o,l=t.getElementsByTagName("ref"),d=null,u=l[0],h=!1,c=this.mdl,g=u&&this.checkForPlatformError(u);if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",t),g&&g.error)return g;if(null===(e=(t.getElementsByTagName("switch")[0]||t).getElementsByTagName("video"))[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(c.chapterTimesString="",u)for(i=0,s=l.length;i<s;i++)a=(n=l[i]).attributes.src.nodeValue,this.isAdCallURL(a)?(h||(c.imaAdCall=a),h=!0):d||(d=n,c.assetURL=d.getAttribute("src"),o=n.getElementsByTagName("param")),null!==n.getAttribute("clipEnd")&&(c.chapterTimesString+=n.getAttribute("clipEnd")+",");for(i=0,s=e.length;i<s&&(a=(r=e[i]).attributes.src.nodeValue,d||(d=r,c.assetURL=d.getAttribute("src"),o=r.getElementsByTagName("param"),null!==r.getAttribute("clipEnd")));i++)null!==r.getAttribute("clipEnd")&&(c.chapterTimesString+=r.getAttribute("clipEnd")+",");return g=o&&this.extractParams(o)||{},this.populateModelFromContentNodeAndParams(d,g),{error:!1}},populateModelFromContentNodeAndParams:function(t,e){var i,s=this.mdl,n=uvpjs.mediaCapabilities,r={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},a={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},o="true";for(q in r)s[q]=t.getAttribute(r[q])||"";for(q in a)s[q]=e[a[q]]||"";s.mediaId=this.getMediaId(e),s.duration=this.getDuration(t),s.sourceOwner=this.getSourceOwner(e),s.cmsRefGuid=t.getAttribute("guid")||t.getAttribute("vid")||"",s.isEmbedable=e.Embeddable===o,s.isLive=e.IsLive===o,s.episodeFlag=e.EpisodeFlag===o,s.useWatermark=e.WatermarkPlayback===o,0<s.chapterTimesString.length?(i=(o=s.chapterTimesString).length-1,o.lastIndexOf(",")===i&&(s.chapterTimesString=o.substring(0,i)),s.chapterStartTimes=this.convertChapterTimesToSeconds(s.chapterTimesString)):s.chapterStartTimes=[],-1<s.assetURL.indexOf(n.M3U)?(s.cdn="",s.fileType=n.M3U):-1<s.assetURL.indexOf(n.MP3)?s.fileType=n.MP3:s.fileType=n.MP4;o=this.cviModel.getVideoPlaybackCDOProperty("matchPageUrlProtocol")||!1;o&&(s.assetURL=s.assetURL.replace(/^\w*:/,"")),this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy mdl",s,o)},handleData:function(t){var t=t.responseText,e=uvpjs.util,t=t.substring(t.indexOf("{"),t.lastIndexOf("}")+1),t=this.isValidJsonStr(t)&&JSON.parse(t)||null,e=e.isEmpty(t)?null:t.metafile,t=e&&new DOMParser,t=t&&t.parseFromString(e,"application/xml"),e=t&&this.parseSmilXML(t);this.callAttempts=0,e?e.error?(this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+e.errorInfo.message),this.signalError(e.errorInfo)):(this.defineProperties(),this.signalSuccess()):(this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError()))},isValidJsonStr:function(t){return"string"==typeof t&&("{"===t.charAt(0)&&"}"===t.charAt(t.length-1)||"["===t.charAt(0)&&"]"===t.charAt(t.length-1))},handleError:function(t){var e,i="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(t.status);this.debug&&uvpjs.error(this.DEBUG_ID,i,this.selectorCall),this.shouldRetryCall(t)?(e=this.callDelays[this.callAttempts],1<=this.callAttempts&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+e,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),e)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:i+" URL: "+this.selectorCall,isFatal:!0,serverCode:t.status})))},shouldRetryCall:function(t){t=t.status;return-1<this.selectorCall.indexOf("link.theplatform")&&this.callAttempts<this.retryLimit&&500!==t&&404!==t&&403!==t&&0!==t},defineProperties:function(){},checkForPlatformError:function(t){t=t&&this.parseSmilRefNodeForException(t);return t?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(t),serverCode:t.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(t){var e=t.responseCode||"n/a",i="; PID: "+(this.opts.pid||"n/a")+"; ",s=this.opts&&this.opts.cmsRefGuid+"; "||"",n=t.abstract?t.abstract+" ":"";return"Platform Error; code: "+e+i+s+(t.exception||"Resource Unavailable.")+" "+n},populateDefaults:function(t){uvpjs.util.isEmpty(t)||at.assign(this.mdl,t)},parseSmilRefNodeForException:function(t){var e,i=t.getElementsByTagName("param"),s={};if(i&&i.length){for(e=i.length;e--;)s[i[e].getAttribute("name")]=i[e].getAttribute("value");if("true"===s.isException)return s.abstract=t.getAttribute("abstract")||"",s}return null},extractParams:function(t){var e,i,s,n={};if(!uvpjs.util.isEmpty(t))for(s=t.length;s--;)e=(i=t[s]).getAttribute("name"),i=i.getAttribute("value"),e&&i&&(n[e]=i);return n},isAdCallURL:function(t){return-1<t.indexOf(lt)||-1<t.indexOf(ot)||-1<t.indexOf(dt)||-1<t.indexOf(ut)},getMediaId:function(t){var e,i,s,n="",t=t.trackingData;if(uvpjs.util.isEmpty(t))return"";for(i=0,s=(e=t.split("|")).length;i<s;i++)-1<e[i].indexOf("cid=")&&(n=e[i].split("=")[1]);return n},getSourceOwner:function(t){var e=t.Source;return uvpjs.util.isEmpty(e)&&"true"===t.WatermarkPlayback?"Entertainment":e||""},getDuration:function(t){t=parseInt(t.getAttribute("dur"))||0;return 0<t?.001*t:t},convertChapterTimesToSeconds:function(t){for(var e=[],i=t.split(","),s=i.length;s--;)e.unshift(function(t){var e=parseInt;switch((t=i[s].split(":")).length){case 1:return e(t[0]);case 2:return 60*e(t[0])+e(t[1]);case 3:return 3600*e(t[0])+60*e(t[1])+e(t[2])}}(i[s]));return e}}),w=uvpjs.register("uvpjs"),ht=w._,w.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_URL},initiali)},loadData:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),ht.isFunction(t)&&ht.isFunction(e)?(this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,this.dataLoadErrorCB=e,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS)},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(t)}}),uvpjs.register("uvpjs").RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,inM},loadData:function(t,e){var i=this.getSelectorCall(),s=i.url||null,n=null;i.error?(this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+i.message),"function"==typeof e&&e(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+i.message,isFatal:!0}))):(this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,uvpjs.util.isDefinedString(this.rco.sig)&&(n={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:e}),this.contentDataProxy.loadData(s,n))},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(t)},getSelectorCall:function(){var t,e,i,s=this.rco,n=s.has("selectorCall")&&s.selectorCall||null;if(!n){if(e=(n=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"))&&-1<n.indexOf("$PID$"),i=n&&-1<n.indexOf("$GUID$"),t=s.has("pid")&&s.pid||null,s=s.has("cmsRefGuid")&&s.cmsRefGuid||null,(i=!e&&!i)||!t&&!s)return{error:!0,message:"Config error: "+(i?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(e?"pid":"cmsRefGuid"))};n=(n=n.replace(e?/\$PID\$/g:/\$GUID\$/g,e?t:s)).replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:n}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var t=uvpjs.util;t.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),t.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var t,e,i,s,n=this.cviModel.contentVideoState,r=this.contentDataProxy,a=this.rco;this.populateContentVideoStateFromLocalStorage(),i=Date.now()-+n.resumeEpochTime,r.setProperty("resumePid",n.resumePid),r.setProperty("resumeEpochTime",+n.resumeEpochTime),r.setProperty("resumeSessionId",n.resumeSessionId),r.setProperty("resumeContentTime",+n.resumeContentTime),r.setProperty("playedChapterTime",+n.playedChapterTime),r.setProperty("showPreroll",n.showPreroll),r.setProperty("sendResumeEvent",!1),r.getProperty("episodeFlag")&&!0!==n.isLive&&(s=r.getProperty("duration"),t=!(s=!uvpjs.util.isEmpty(a.globalResumeTime)&&0<a.globalResumeTime&&0<s&&20<s-a.globalResumeTime)&&a.pid===n.resumePid,s||t?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),a=s?a.globalResumeTime:+n.resumeContentTime||0,n=!s&&i||0,i=!s&&i>this.ONE_HOUR_MS,s=s?this.cviModel.sessionId:"",e=this.getPlayedChapterTimeForContentResume(a),r.setProperty("sendResumeEvent",!0),r.setProperty("startTime",a),r.setProperty("elapsedTime",n),r.setProperty("showPreroll",i),r.setProperty("playedChapterTime",e),r.setProperty("previousSessionId",s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(t?"local":"global")+"Resume"],startTime:a},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(t){var e,i=0,s=this.contentDataProxy.getProperty("chapterStartTimes"),n=s.length||0;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",s),n)for(;n--;)if((e=s[n])<=t){4<=t-e?i=e:(this.contentDataProxy.setProperty("startTime",t-4),0<n&&(i=s[n-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",i),i}}),w=uvpjs.register("uvpjs"),ct=w._,w.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(t,e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",i),this._super(t,e,i)},loadData:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),ct.isFunction(t)?(this.dataLoadedCB=t,this.dataLoadErrorCB=e,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS)}}),function(t){"use strict";var o=t._;t.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_BITRATE_THRESHOLD:2500,AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(t){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(t,e,i){this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",t),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",i)),this.playbackState=this.mc.EMPTY,this.vidContId=i,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=t,this.isContentScenario=!1,this._super(t,e,i),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(t=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(t.eventType,{errorInfo:t},i)):(e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=e.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(t,e){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),this.mc.isChromecast()||this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:t();break;case this.PLATFORM:this._super(t,e);break;case this.CONTENT_AND_AD_CALL:t()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,s=uvpjs.util.isDefinedString(e.adCall)?e.adCall:null,n=this.imaScenario===this.PLATFORM,s=s||(n?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(i.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(s)):(i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(e),i.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,s)):this.doFlashCheck(s))},finishLoadVideoAndBeginPlayback:function(t){var e="",i=uvpjs.adUtil,s=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,s.incrementMedNum(),this.isContentScenario=!0),t?(e=i.populateImaAdCallValues(t,s,this.isContentScenario),this.viewGuid=i.getDwViewGuid(s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",e)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(e)},dispatchContentSta)},requestAdsManagerOrResume:function(t){o.isString(t)&&!o.isEmpty(t)?this._requestAdsManager(t):this._onContentResumeRequested()},setImaAdUrl:function(){var t=this.checkForAdCallOverride();t?(this.contentDataProxy.setProperty("imaAdCall",t),this.imaAdCall=t):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var t=this.cviModel.getModule(this.AD_SETTINGS),t=null!=t&&1==t.enabled,e=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),i=null;return t&&!o.isUndefined(e)&&(i=e),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(i||"null")),i},manageLocalAndGlobalResu)},getPodsToSkip:function(){var t="",e=this.contentDataProxy,i=e.getProperty("chapterStartTimes");return e.getProperty("showPreroll")||(t="1"),0<i.length&&0<=(i=i.indexOf(e.getProperty("playedChapterTime")))&&(i+=2,t=0<t.length?t+","+String(i):String(i)),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",t),t},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(t){var t=t&&t.id,e=this.trueXInteractionIds;switch(t){case e.CLOSED_BEFORE_CREDIT:case e.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case e.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case e.OPT_OUT:case e.TIME_OUT:this.resetTrueXStatus();break;case e.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStat}},assembleAdPodInfo:function(t){var e=this.getAdPodInfo(t),i=e.podIndex;return this.currAdPod=this.APM.getAdPodById(0===i?"pre":-1===i?"post":"mid_"+i),void 0===this.currAdPod?(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(t)}),adCallUrl:this.adCallUrl},this.vidContId),!1):((t=this.currAdPod).adCount=e.totalAds,t.podDuration=e.maxDuration,t.isBumper=e.isBumper,t.imaPodIndex=e.podIndex,t.timeOffset=e.timeOffset,t.totalAds=e.totalAds,t.imaAdPostion=e.adPosition,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",i,this.currAdPod),!0)},getAdPodInfo:function(t,e){t=t.getAdPodInfo(),e=e||{};return e.adPosition=t.getAdPosition(),e.isBumper=t.getIsBumper(),e.maxDuration=t.getMaxDuration(),e.podIndex=t.getPodIndex(),e.timeOffset=t.getTimeOffset(),e.totalAds=t.getTotalAds(),e},assembleAdInfo:function(t){return{adId:t.getAdId(),adPodInfo:this.getAdPodInfo(t),adSystem:t.getAdSystem(),advertiserName:t.getAdvertiserName(),apiFramework:t.getApiFramework(),contentType:t.getContentType(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId(),dealId:t.getDealId(),description:t.getDescription(),duration:t.getDuration(),height:t.getHeight(),mediaUrl:t.getMediaUrl(),minSuggestedDuration:t.getMinSuggestedDuration(),skipTimeOffset:t.getSkipTimeOffset(),surveyUrl:t.getSurveyUrl(),title:t.getTitle(),traffickingParams:t.getTraffickingParameters(),traffickingParametersString:t.getTraffickingParametersString(),uiElements:t.getUiElements(),universalAdIdRegistry:t.getUniversalAdIdRegistry(),universalAdIdValue:t.getUniversalAdIdValue(),vastMediaHeight:t.getVastMediaHeight(),vastMediaWidth:t.getVastMediaWidth(),vastMediaBitrate:t.getVastMediaBitrate(),width:t.getWidth(),wrapperAdIds:t.getWrapperAdIds(),wrapperAdSystems:t.getWrapperAdSystems(),wrapperCreativeIds:t.getWrapperCreativeIds(),isLinear:t.isLinear()}},onAdEvent:function(t){var e=t.getAdData(),i=t.getAd(),s=google.ima.AdEvent.Type;if(t.type===s.INTERACTION)this.processInteractionEvent(e);else if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(t.type),t.type){case s.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",i),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(t)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(i))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||0<this.dynamicMidRollPodCount)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(i,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this._dispatchAdLoaded(this.assembleAdInfo(i));break;case s.STARTED:var n=i.getContentType();this.ad=i,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=i.getDuration(),this._populateAdVideoState(i,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this.cviModel.mergeCDOData(),"application/javascript"!==n&&"application/x-shockwave-flash"!==n||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===n&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(i),this.trackAdEvent(s.STARTED),(n=i.getAdPodInfo())&&(a=n.getTotalAds()),this._dispatchAdStart(a),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case s.AD_BUFFERING:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.AD_BUFFERING"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BUFFERING,{},this.vidContId);break;case s.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case s.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case s.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case s.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case s.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||o.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case s.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),(r=this.cviModel.getAdVideoState()).paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:r},this.vidContId);break;case s.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case s.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case s.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case s.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,r=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:r,adCallUrl:this.adCallUrl},this.vidContId),uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case s.LOG:var r,n=e&&e.adError,a=(uvpjs.ErrorInfo,null===i);this.eventsMgr.eventTypes.AD_ERROR;!n&&a?(r=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof r&&r()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(n,i,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),a&&!n&&-1<this.savedSeekToTime&&this.resumeContentPlay();break;case s.VOLUME_CHANGED:this._dispatchAdVolumeChange();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",s))}},_populateAdVideoState:function(t,e){var i,s;if(o.isObject(t)){if(s=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.IMA),e)for(i in e)s[i]=e[i];this.cviModel.setAdVideoState(s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())}else this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN")},_requestAdsManager:function(t){var e,i=this.cviModel;this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",t),this.adStartEventReceived=!1,this.adCallUrl=t,uvpjs.util.isEmpty(this.adsLoader)?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.resumeContentPlay()):((e=new google.ima.AdsRequest).adTagUrl=t,this._updateAdSize(),e.linearAdSlotWidth=this.containerWidth,e.linearAdSlotHeight=this.containerHeight,e.nonLinearAdSlotWidth=this.containerWidth,e.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof e.setAdWillAutoPlay&&(e.setAdWillAutoPlay(i.isAutoplay),e.setAdWillPlayMuted(i.isMuteAtPlayStart&&!i.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(e))},onAdsManagerLoaded:function(t){var e,i=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,s=uvpjs.util;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",t),this._dispatchAdResponse(),s.isEmpty(this.RPM)||s.isEmpty(this.RPM.currRP)||s.isEmpty(this.cviModel)?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)):(this.renderSettings=new google.ima.AdsRenderingSettings,(s=this.renderSettings).bitrate=this.getAdPlaybackBitrate(),s.restoreCustomPlaybackStateOnAdBreakComplete=!1,s.enablePreloading=!1,s.loadVideoTimeout=this._returnIMATimeout(),t=this.adsManager=t.getAdsManager(i,s),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",t.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",t.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",t.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(e=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",e)),this.imaCuePoints=this.adsManager.getCuePoints(),o.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,e,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",e),this.APM.initialize(this.vidContId,e,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),i=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,i),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds())},getAdPlaybackBitrate:function(){var t=this.cviModel.contentPlaybackState.facadeState.currentBitrate,e=900;return e=!uvpjs.util.isEmpty(t)&&0<t?Math.min(t/1e3,this.AD_BITRATE_THRESHOLD):e},startAds:function(){var e,i,s=null,n=null;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(t){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),e=(i=uvpjs.ErrorInfo).messages.NO_AD_CONTENT,t&&"function"==typeof t.getMessage&&(e+=": "+t.getMessage(),s=t.getErrorCode(),n=t.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new i({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:i.errorCodes.IMA_AD_ERROR,message:e,imaErrorCode:s,imaVastErrorCode:n,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoT)},_onContentPauseRequested:function(){var t,e;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),o.isEmpty(this.facade)||(t=this.cviModel.contentVideoState.isLive,(e=this.imaUsesContentVideoTag())||this.facade.hideVideo(),t&&!e?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),e&&(this.savedSeekToTime=t?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!o.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress)&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners()),!o.isEmpty(this.APM)&&this.APM.isPostRoll(this.currAdPod))this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN");else if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),this.adStartEventReceived)if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),o.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!o.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),-1<this.savedSeekToTime){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}else this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},facadePlaybackStateChange:function(t){this.seekPending&&t===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(t)},_updateIMAPlaybackState:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",t),t!==this.playbackState&&(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(t){var e=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:t||1,adData:e,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(t){var e;this.uvpjsAdStartOpened&&((e=this.cviModel.getAdVideoState()).skipped=!0===t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:e,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(t){var e="function"==typeof t.getAdData?t.getAdData():{},t="function"==typeof t.getAd?t.getAd():{};return("function"==typeof t.getMediaUrl?t.getMediaUrl():e.mediaUrl)||null},_dispatchAdLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:t},this.vidContId)},_dispatchAdRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},_dispatchAdVolumeChange:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdVolumeChange dispatch AD_VOLUME_CHANGE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_VOLUME_CHANGE,{volume:this.adsManager.getVolume()},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(t,e){t&&(this.containerWidth=t),e&&(this.containerHeight=e),this.mc.isChromecast()||(t=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),e=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),t===this.containerWidth&&e===this.containerHeight)||(this.containerWidth=t,this.containerHeight=e,this.adsManager&&(t=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,t)))},_updateCurrentAdTime:function(){var t;this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY&&(t=this.adsManager.getRemainingTime(),this._checkForStuckAd(t)?this.adsManager.discardAdBreak():(this.currImaAdTime=Math.floor(this.duration-t),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime})))},_checkForStuckAd:function(t){if(!this.stuckAdCheckDisabled){if(null!==this.previousRemainingTime){var e,i=this.previousRemainingTime-t;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+i),0==i?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS)return i="Ad playback stuck for "+this.stuckIntervals+" intervals.",e=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:i,isFatal:!1,adInfo:this.extractAdInfo(this.ad)}),this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,i,e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:e,adCallUrl:this.adCallUrl},this.vidContId),!0}this.previousRemainingTime=t}return!1},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(t){var e=t&&t.getAd&&t.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(t.getError(),e),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(t){this.dispatchAdErrorEvent(t.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(t){return uvpjs.adUtil.extractAdInfo(t,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(t,e,i){var s=null,n=null,r=null,a=uvpjs.ErrorInfo,o=uvpjs.util.isFunction;t&&o(t.getMessage)&&(s=t.getMessage(),s+=" imaErrorCode: "+(n=t.getErrorCode()||"n/a")+"; vastErrorCode: "+(r=t.getVastErrorCode()||"n/a")),t&&o(t.getInnerError)&&(t=t.getInnerError())&&(s=s||"",s+=" Inner error: "+(o(t.getMessage)?t.getMessage():t.message||"n/a")+"; inner error code: "+(o(t.getErrorCode)?t.getErrorCode():"n/a")),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new a({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:a.errorCodes.IMA_AD_ERROR,message:a.messages.IMA_AD_ERROR_EVENT_RECEIVED+((s=i?i+" "+s:s)||" Unspecified IMA ad error."),isFatal:!1,imaErrorCode:n,imaVastErrorCode:r,adInfo:this.extractAdInfo(e)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),o.isEmpty(this.facade)?(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),this.cleanUpRP_IMA()):(this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo())},cleanUpRP_IMA:function(){var t;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),this.isRP_IMACleanedUp||(t=this.rco.rcoSeed,this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(t))},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.destroyFacade()},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",t),null!==this.adsManager?this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call"):(this.dynamicMidRollPodCount++,t=uvpjs.adUtil.populateImaAdCallValues(t,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=t,this._requestAdsManager(t))},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),o.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(t)))},onPlayVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),o.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(t)))},onVideoSeekTo:function(t){var e,i=this.cviModel.contentPlaybackState.currentTime;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",t),t.target!==this.vidContId||o.isEmpty(this.facade)||!this.canSeek(t&&t.payload)?this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN"):o.isEmpty(this.APM)||!this.APM.hasMidRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),this._super(t)):(e=t.payload.seekTime,this._seekFromTime=i,i=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(e):e,e=this.APM.returnPrecedingUnplayedAdPod(i),o.isEmpty(e)||e.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(t)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",e.startTime),this.savedSeekToTime=i,e.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=e.startTime))},canSeek:function(t){return void 0!==t.seekTime&&null!==t.seekTime&&0<=t.seekTime&&t.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(t){return t},onChangeVideoVolume:function(t){o.has(t,"target")&&t.target===this.vidContId&&!this.cviModel.isMuted&&0<=t.payload.vol&&t.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(t.payload.vol):this._super(t))},onMuteVideo:function(t){o.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},onUnMuteVideo:function(t){o.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},_createBoundAdEventHandle)},_addAdsManagerEventListeners:function(){var t,e=this.adsManager,i=google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),t=this.onAdEvent,e.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.addEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.addEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.addEventListener(i.LOADED,t),e.addEventListener(i.STARTED,t),e.addEventListener(i.AD_BUFFERING,t),e.addEventListener(i.FIRST_QUARTILE,t),e.addEventListener(i.MIDPOINT,t),e.addEventListener(i.THIRD_QUARTILE,t),e.addEventListener(i.COMPLETE,t),e.addEventListener(i.ALL_ADS_COMPLETED,t),e.addEventListener(i.CLICK,t),e.addEventListener(i.PAUSED,t),e.addEventListener(i.RESUMED,t),e.addEventListener(i.USER_CLOSE,t),e.addEventListener(i.SKIPPED,t),e.addEventListener(i.LOG,t),e.addEventListener(i.VOLUME_CHANGED,t),e.addEventListener(i.VOLUME_MUTED,t),e.addEventListener(i.INTERACTION,t)},_removeAdsManagerEventListeners:function(){var t=this.onAdEvent,e=this.adsManager,i=google.ima.AdEvent.Type;e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),e.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.removeEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.removeEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.removeEventListener(i.LOADED,t),e.removeEventListener(i.STARTED,t),e.removeEventListener(i.AD_BUFFERING,t),e.removeEventListener(i.FIRST_QUARTILE,t),e.removeEventListener(i.MIDPOINT,t),e.removeEventListener(i.THIRD_QUARTILE,t),e.removeEventListener(i.COMPLETE,t),e.removeEventListener(i.ALL_ADS_COMPLETED,t),e.removeEventListener(i.CLICK,t),e.removeEventListener(i.PAUSED,t),e.removeEventListener(i.RESUMED,t),e.removeEventListener(i.USER_CLOSE,t),e.removeEventListener(i.SKIPPED,t),e.removeEventListener(i.LOG,t),e.removeEventListener(i.VOLUME_CHANGED,t),e.removeEventListener(i.VOLUME_MUTED,t))},onUVPJSTimerTick:function(){var t,e,i=uvpjs.util,s=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,n=!i.isEmpty(this.adsManager),i=!i.isEmpty(this.facade);n&&(e=this.getAdPlaybackBitrate())!==this.renderSettings.bitrate&&(this.renderSettings.bitrate=e,this.adsManager.updateAdsRenderingSettings(this.renderSettings)),s&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,-1<this.contentPlayheadTracker.pendingSeekTime?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:i?(t=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=t):this.contentPlayheadTracker.currentTime=0),this.adPodInProgress?(this.id3HandlingEnabled&&i&&this.checkId3Events(t),this.playbackState===this.mc.PLAYING&&(e=this.createAdVideoProgressPayload(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,e,this.vidContId))):(t=(i=n&&s&&(this.cviModel.sessionOptions.adBlockerCallback||null))&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),i&&(e=(new Date).getTime())&&(this.lastAdBlockCheckTime<e||t)&&(this.lastAdBlockCheckTime=e+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),this._super())},_checkForCloseToMidrollPod:function(t){var e,i,s,n=this.APM.getMidRollPods();if(!(t<=0))for(e=n.length;e--;)if(0<(i=(s=n[e]).startTime-t)&&i<1&&!s.hasPlayed&&!s.hasBeenChecked)return s.hasBeenChecked=!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(t){var e=uvpjs.util,i=this._getAssetUrl(t),s=e.isDefinedString(t.pid),n=e.isDefinedString(t.cmsRefGuid),r=e.isDefinedString(t.selectorCall),a=e.isDefinedString(t.assetURL);return s||n&&!a||r?this.PLATFORM:e.isDefinedString(i)?this.CONTENT_AND_AD_CALL:e.isDefinedString(t.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var t=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),t},_checkForContentPreload:function(){var t=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,e=this.adsManager.isCustomPlaybackUsed(),e=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!e;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&t&&5<this.duration&&e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var t=-1,e=this.cviModel.getModule(this.AD_SETTINGS),e=e&&e.enabled&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return e&&(t=0<(t=parseInt(e))?1e3*t:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+t),t},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(t){"use strict";t._;var a,o=["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"],l=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];t.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(t){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this.pendingSeekTime=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,e,i){var s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),n=s.getElementsByTagName("video")[0];a=a||google.ima.dai.api,this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new a.StreamManager(n),this.adClickElement=this.createAdClickElement(n),this.streamManager.setClickElement(this.adClickElement),this._super(t,e,i),this.resetAdStates(),this.contentVideoDiv=s,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(t,e){var i=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(i)?this._super(t,e):(this.dataLoadedCB=t,this.onDataProxyComplete())},onDataProxyComplete:function(){var t=this.contentDataProxy.getProperty("cmsRefGuid");uvpjs.util.isEmpty(t)||this.rco.getVideoId()||this.rco.setCmsRefGuid(t),this._super()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,s=this.contentDataProxy.getModel();this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),i.setNonDefaultContentVideoStateItems(s),i.setContentVideoStateItems(e),i.mergeCDOData(),this.killDataProxy(),(t=this.assembleResourceDefinition())?(this.cviMgr.setPlaybackInfoOnModel(),this.requestStream(t)):(this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0))},requestStream:function(t){var e=!uvpjs.util.isEmpty(t.assetKey),i=new(e?a.LiveStreamRequest:a.VODStreamRequest);i.apiKey=t.apiKey||null,i.adTagParameters=t.adTagParameters,e?(i.assetKey=t.assetKey,i.attemptPreroll=!0,this.isLiveStream=!0,this.id3HandlingEnabled=!0):(i.contentSourceId=t.contentSourceId,i.videoId=t.videoId),this.streamManager.requestStream(i)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(t){t=t.getStreamData().url;uvpjs.util.isDefinedString(t)?(this.cviModel.contentVideoState.assetURL=t,this.cviModel.contentVideoState.isLive=this.isLiveStream,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())):(this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0))},hStreamInitialized:function(t){this.daiStreamId=t.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(t){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(t){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null,this.pendingSeekTime&&(this._hasFacade()&&this.facade.seekTo(this.pendingSeekTime),this.pendingSeekTime=null)},hCuePointsChang)},hAdStarted:function(t){var e=t.getAd();this.resetAdStates(),!this.currAdPod&&this.isLiveStream&&(this.currAdPod={played:!0}),this.updateAdModel(e),this.currAd=e,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.trackAdEvent(t.type),this.dispatchAdPodStart()),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(t){var e,i=t.type,s=a.StreamEvent.Type,n=null;switch(i){case s.FIRST_QUARTILE:n=25;break;case s.MIDPOINT:n=50;break;case s.THIRD_QUARTILE:n=75;break;case s.AD_PROGRESS:(e=(e=(e=t.getStreamData())&&e.adProgressData)&&this.createAdProgressPayload(e))&&this.dispatchVideoProgress(e)}n&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=n,this.dispatchAdQuartile(n))},hStreamError:function(t){t=t.getStreamData(),t=t&&t.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+t,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,t||"Unknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(t){},hStreamEvent:function(t){this.isAdPlaying()&&this.trackAdEvent(t.type),this[this.hMap[t.type]](t)},onVideoSeekTo:function(t){var e=t&&t.target,t=t&&t.payload,t=t&&t.seekTime,i=this.facade,s=this._hasFacade(),n=i.getDuration(),r=this.facade.getCurrentTime();"number"==typeof t&&e===this.vidContId&&((t=this.streamManager.streamTimeForContentTime(t))<0||n<t?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+t):((e=this.getSkippedPod(t))&&(this.pendingSeekTime=t,t=e.startTime-1),this._seekFromTime=this._seekFromTime||r,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:t,seekFromTime:this._seekFromTime},null,2)),s&&i.seekTo(t)))},getSkippedPod:function(t){var e,i,s,n=[];for(e in this.adPods)n.push(this.adPods[e].startTime);for(n.soe}),i=n.length;i--;)if((s=n[i])<t)return(s=this.adPods["t_"+s]).hasPlayed?null:s;return null},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodE)},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_LOADED,{adData:t}),this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===s,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(t){var e,i,s=null,n=t&&t.length;for(n&&!this.adPods&&this.createAdPods(t);n--;)e=t[n],i=this.adPods["t_"+e.start],s||i.hasPlayed===e.played||(s=i),i.hasPlayed=e.played;return s},createAdPods:function(t){var e,i,s,n,r=0,a=[],o=t.length;for(this.adPods={},i=0;i<o;i++)e=t[i],n=i,n=1<o&&n===o-1?"post":0===n?"pre":"mid",s=e.start,a.push(s),this.adPods["t_"+s]={startTime:s,hasPlayed:!1,adPodId:n+("mid"==n?"_"+r++:"_0"),adCount:0,podDuration:e.end-s};this.cviModel.contentVideoState.chapterStartTimes=a},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(t){var e=t.getAdPodInfo();this.populateAdVideoState(t),e&&this.currAdPod&&(this.currAdPod.adCount=e.getTotalAds(),this.currAdPod.podDuration=e.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(t){t=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.DAI,this.isLiveStream);t.adBitrate=this.cviModel.getContentPlaybackState().facadeState.currentBitrate,this.cviModel.setAdVideoState(t)},createAdProgressPayload:function(t){var e=this.getVideoProgressPayload(),i=t.currentTime;return e.isAd=!0,e.duration=t.duration,e.currentTime=i,e.absoluteStreamTime=this.facade.getCurrentTime(),e.lastSecondCompleted=Math.floor(i),e.lastPercentageCompleted=this.currAdPercentComplete,e},extractAdIn)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&t!=a.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||this.isLiveStream||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var t,e;this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying()&&(t=this.facade.getCurrentTime(),this.checkForAdBlocker(t,!1),e=this.streamManager.contentTimeForStreamTime(t),!this.contentStartOpen&&(0<e||this.isLiveStream)&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(e),e=this.createVideoProgressPayload(e,t),this.dispatchVideoProgress(e))},createVideoProgressPayload:function(t,e){var i=this.getVideoProgressPayload();return i.currentTime=t,i.absoluteStreamTime=e,i.duration=this.contentDuration||-1,i},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(t,e){var i=t-this.lastAdBlockCheckTime>this.adBlockCheckInterval,e=e||i,i=e&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return e&&(this.lastAdBlockCheckTime=t),i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!i},assembleResourceDefinition:function(){var t=this.rco.getAdTagParameters(),e=this.rco.getVideoId(),i=this.rco.getContentSourceId(),s=this.rco.getAssetKey();return s&&t||t&&e&&i?{adTagParameters:t,videoId:e||null,contentSourceId:i||null,assetKey:s||null}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(t){for(var e,i="add"===t?"addEventListener":"removeEventListener",s="addEventListener"==i,n=a.StreamEvent.Type,r=o.length;r--;)e=n[o[r]],s&&(this.hMap[e]=l[r]),s||delete this.hMap[e],this.streamManager[i](e,this.hStreamEvent)},createAdClickElement:function(t){var e,i,s,n=t.nextSibling;if(n&&"uvpjsDaiContainer"===n.getAttribute("data-role"))return n;for(i in(n=document.createElement("div")).setAttribute("data-role","uvpjsDaiContainer"),s=n.style,e={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1})s[i]=e[i];return t.insertAdjacentElement("afterend",n),n},onPauseVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying())&&this.trackAdEvent(t.type)},onPlayVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying())&&this.trackAdEvent(t.type)},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,i=i&&i.vol,s=uvpjs.util.inRange(i,0,1),n=this.cviModel.isMuted;e===this.vidContId&&s&&!n&&this._hasFacade()&&(this.facade.setVolume(i),this.isAdPlaying())&&this.trackAdEvent(t.type)},onMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying())&&this.trackAdEvent(t.type)},onUnMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying())&&this.trackAdEvent(t.type)},facadeId3Data:function(t){var e;this.streamManager&&)}.bind(this),t)&&t.forEach(e)},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){this.contentDuration=this.streamManager.contentTimeForStreamTime(t.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(t){this.adClickElement&&(this.adClickElement.style.display=!1!==t?"block":"none")},log:function(t,e,i){uvpjs[i||"log"](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";var i={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};t.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,e,i){this._super(t,e,i),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(t){t()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel;this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(e),i.mergeCDOData(),this.killDataProxy(),this.contentDuration=i.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),(t=this.assembleAssetUrl(e))?(this.cviModel.contentVideoState.assetURL=t,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(e.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),this.suppressFacadePlayOnLoad||this.facade.playVideo()):this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0)},assembleAssetUrl:function(t){var e=t.assetURL,i=uvpjs.util;return i.isEmpty(e)?null:-1<e.indexOf("?")||(t=(t=t.getAdTagParameters())?i.queryStrFromObj(t):null,i.isEmpty(t))?e:e+"?"+t},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(t){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(t),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispat)},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(t){t=this.getPrerollPod(t);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:t})},dispatchAdPodEnd:function(){var t=this.getPrerollPod();t.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:t})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgre)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e,isFatal:!0===s,adInfo:null})})},getPrerollPod:function(t){return this.adPod||(this.adPod={startTime:t,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var t=uvpjs.adUtil.getAdStateBlank();t.adServerName="dai_ssb",t.duration=this.getPrerollAdDuration(),t.adClipID="pre_0",t.adPosition=1,t.adType="pre",this.cviModel.setAdVideoState(t)},getPrerollAdDuration:function(){var t=this.getAbsoluteDuration();return 0<t&&0<this.contentDuration?t-this.contentDuration:-1},getAbsoluteDuratin},createAdProgressPayload:function(){var t,e,i=this.getVideoProgressPayload(),s=this.facade.getCurrentTime(),n=this.getPrerollAdDuration(),r=Math.floor(s/n*100);switch(r){case 25:t=this.quartiles[25],e=25;break;case 50:t=this.quartiles[50],e=50;break;case 75:t=this.quartiles[75],e=75}return e&&!t&&this.dispatchAdQuartile(e),e&&(this.quartiles[String(e)]=1),i.isAd=!0,i.duration=n,i.currentTime=s,i.absoluteStreamTime=this.facade.getCurrentTime(),i.lastSecondCompleted=Math.floor(s),i.lastPercentageCompleted=r,i},startConte)},onUVPJSTimerTick:function(){var t=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,e=this.isAdPlaying(),i=this.contentStartOpen,s=t&&this.facade.getCurrentTime();t&&(t=e?this.createAdProgressPayload():i?this.createVideoProgressPayload():null,1<s&&!i&&!e&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+s),this.contentStartTime=s,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(s),t)&&this.dispatchVideoProgress(t)},createVideoProgressPayload:function(){var t=this.getVideoProgressPayload(),e=this.facade.getCurrentTime(),i=e-this.contentStartTime;return t.currentTime=i,t.absoluteStreamTime=e,t.duration=this.contentDuration||-1,t},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(t){var e=t&&t.target,t=t&&t.payload,t=t&&t.seekTime,i=this.facade,s=this._hasFacade(),n=s&&(this.absoluteDuration||i.getDuration()),r=this.getPrerollAdDuration(),a=this.facade.getCurrentTime();"number"==typeof t&&e===this.vidContId&&n&&((t+=0<r?r:0)<0||n<t?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+t):(this._seekFromTime=this._seekFromTime||a,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:t,seekFromTime:this._seekFromTime},null,2)),s&&i.seekTo(t)))},facadeProgress:function(t){},facadeTimeUpda{},facadeDurationChanged:function(t){this.absoluteDuration||(this.absoluteDuration=t.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.hCueChange=this.hCueChange.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){var t=this.vidEl.textTracks;t.removeEventListener("addtrack",this.hAddTextTrack,!1);for(var e=0,i=t.length;e<i;e++)t[e].removeEventListener("cuechange",this.hCueChange,!1)},hAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(t.track.addEventListener("cuechange",this.hCueChange,!1),t.track.mode="hidden")},hCueChange:function(t){t.target&&t.target.activeCues&&1==t.target.activeCues.length&&this.handleId3Cue(t.target.activeCues[0])},handleId3Cue:function(t){var e=t.value;"TXXX"===e.key&&(e=""!==e.info?e.info:e.data,e=i[e])&&this[e](t.startTime)},isAdPlayid},log:function(t,e,i){uvpjs[i||"log"](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.P2pClient=uvpjs.Class.subClass({inl},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var t=uvpjs.P2pClient.clientMap[this.clientName];return t&&t.getHlsjsLoader&&(t.getHlsjsLoader()||null)}}),t.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,t.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLo)},getHlsjsLoadl},getA5},loadScripts:function(t,e){var i;this.getHlsjsLoader()?t():e.apiKey?(i=this.loadHlsLoader.bind(this,t),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+e.apiKey,i,2e3)):t(!0)},loadHlsLoader:function(t,e){e?(uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",e),t(!0)):uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,t,2e3)}}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.MultiCdnClient=uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destrl},getDecision:function(t){this.inFlight||(this.inFlight=!0,this.decisionCallback=t,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),2e3),(new uvpjs.CodeLoader).loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeo)},handleDecision:function(t){clearTimeout(this.timeoutHandle),this.aborted||this.decisionCallback(t.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),this.aborted||this.decisionCallback(null),this.reset()},res1}}),t.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(t){return t&&t.customerId&&t.appId?this.decisionUrl.replace("{customerId}",t.customerId).replace("{appId}",t.appId):null},validateScriptLo0},loadScrip)}}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t,e){var i=uvpjs.VideoDeliveryPluginService.clientType;this.model=e,this.callback=t,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(i.P2P),this.multiCdnClientOptions=this.getClientOptions(i.MULTI_CDN)},destrl},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var t=null,e=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(t=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(e=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(t,e))},handleMcdnReady:function(t){var e=this.multiCdnClientOptions;!t&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,e.clientName)||(e.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+e.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var t=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,t.clientName,this.handleMcdnReady.bind(this),t.requiredParams)},handleP2pReady:function(t,e){var i=this.p2pClientOptions;!e&&this.validateScriptLoad(this.staticSvc.clientType.P2P,i.clientName)||(i.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+i.clientName)),t?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var t=this.p2pClientOptions,e=this.multiCdnClientOptions.canUse;t.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,t.clientName,this.handleP2pReady.bind(this,e),t.requiredParams):e?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(t,e,i,s){t=this.getClientObject(t,e);t||i(!0),t.loadScripts(i,s)},validateScriptLoad:function(t,e){t=this.getClientObject(t,e);return t&&t.validateScriptLoad()||!1},createClie)},getClientOptions:function(t){var e,i,s,n,r,a,o,l,d,u=this.model,h=this.getSupportedClients(t),c={canUse:!1,clientName:null};if(t!==this.staticSvc.clientType.P2P||uvpjs.mediaCapabilities.canUseP2p())for(e in h)if((l=(s=h[i=e])&&s.uvpcModuleName)&&u.isModuleEnabled(l)){for(r=(n=s.requiredParams)&&n.length||0,o={},d=!0;r--;){if(a=u.getModuleParam(l,n[r]),uvpjs.util.isEmpty(a)){d=!1;break}o[n[r]]=a}return{canUse:d,clientName:i,requiredParams:o}}return c},getSupportedClients:function(t){var e,i,s={},n=t.clientMap;if(n)for(e in n)i=n[e],s[e]={uvpcModuleName:i.uvpcModuleName,requiredParams:i.requires};return s},getClientObjel}});t=t.VideoDeliveryPluginService;t.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},t.load=function(t,e,i){(new uvpjs.CodeLoader).loadScript(t,e,i)}}(uvpjs.register("uvpjs")),w=uvpjs.register("uvpjs"),gt="loadedmetadata",w.FullscreenManager=uvpjs.Class.subClass({init:function(t){var e=uvpjs.util,t=t||{},i=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,t.videoElement&&t.container?(this.videoEl=t.videoElement,this.container=t.container,this.fullscreenChangeCallback=e.isFunction(t.fullscreenChangeCallback)&&t.fullscreenChangeCallback,this.readyCallback=e.isFunction(t.readyCallback)&&t.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=i.getEnterFullscreenMethodName(),this.exitMethod=i.getExitFullscreenMethodName(),this.fsElementName=i.getFullScreenElementName(),this.isFullscreenProperty=i.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()):uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.")},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailab)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(t){var e=this.isFullscreen();t.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(e)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener(gt,this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var t=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return t&&uvpjs.util.isFunction(t[this.exitMethod])?t:null},validateEntryAndExitMethods:function(){var t=this.fsElement&&this.fsElement[this.enterMethod],e=this.exitScope&&this.exitScope[this.exitMethod],i=uvpjs.util;this.hasValidEntryMethod=i.isFunction(t),this.hasValidExitMethod=i.isFunction(e)},initialize:function(){var t,e=uvpjs.mediaCapabilities;this.hasFsApiSupport=e.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(t=e.getFullscreenEventName(),(e.isFirefox()||e.isIE()?document:this.container).addEventListener(t,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,t=e.getFullscreenEnterEventName(),e=e.getFullscreenExitEventName(),this.fsElement.addEventListener(t,this.hFullScreenEvent,!1),this.fsElement.addEventListener(e,this.hFullScreenEvent,!1),this.enterEvt=t,this.exitEvt=e),this.validateEntryAndExitMethods(),this.hasValidEntryMethod?(this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener(gt,this.hMetadataLoaded,!1),this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())):this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo())}}),w.FullscreenManager.hasFullscreenSuppo)},function(t){"use strict";var i,s,n,r,_=t._;t.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"lib/css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=t.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=t.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._ccEnabledByUser=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this.isAndroidOnHlsjs=this.mc.canPlayHlsjsAndriod(this.vci.CVI_Mgr.cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(t.skinConfig)},destroy:function(){function t(){}this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=t,this._replayCB=t,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(t){var e=uvpjs.util,i=uvpjs.Configuration.hostname+uvpjs.Configuration.path,s=this._containerId,n=t.customCSS;this._namespace="."+s+".skin",this._autoPlay=t.isMutedAutoplay||t.isUnmutedAutoplay,this._isMutedAutoplay=t.isMutedAutoplay,this._previewImage=t.previewImage,this._enableReplay=t.enableReplay,this._themeName=t.themeName,this._controls=t.controls,this._template=t.template,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=e.isDefinedString(n)&&n||i+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(t)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaysta)},disableButt)},enableButt)},_handleFullscreenMgrRea)},_handleFullscreenChange:function(t){var e=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),t?(this.vci.fullscreen(!0),e&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),e&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",t),this._disable(t),e&&e.setAttribute("disabled","disabled")},_enableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",t),_.includes(this._disabledButtons,t)||(this._enable(t),e&&e.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t.addEventListener(i.AD_START+e,this._onAdStart.bind(this)),t.addEventListener(i.AD_END+e,this._onAdEnd.bind(this)),this._isIOS||t.addEventListener(i.CAPTIONS_READY+e,this._onCaptionsReady.bind(this)),t.addEventListener(i.CONTENT_START+e,this._onContentStart.bind(this)),t.addEventListener(i.CONTENT_END+e,this._onContentEnd.bind(this)),t.addEventListener(i.VIDEO_PROGRESS+e,this._onVideoProgress.bind(this)),t.addEventListener(i.VIDEO_STATE_CHANGE+e,this._onVideoStateChange.bind(this)),t.addEventListener(i.VIDEO_LOADING+e,this._onVideoLoading.bind(this)),t.addEventListener(i.CONTROL_MUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.CONTROL_UNMUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.RESOURCE_START+e,this._onResourceStart.bind(this)),t.addEventListener(i.RESOURCE_END+e,this._onResourceEnd.bind(this)),t.addEventListener(i.CONTAINER_RESIZE+e,this._onUVPJSResize.bind(this)),t.addEventListener(i.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+e,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t&&t instanceof uvpjs.VideoControlInterface&&(t.removeEventListener(i.AD_START+e),t.removeEventListener(i.AD_END+e),this._isIOS||t.removeEventListener(i.CAPTIONS_READY+e),t.removeEventListener(i.CONTENT_START+e),t.removeEventListener(i.CONTENT_END+e),t.removeEventListener(i.VIDEO_PROGRESS+e),t.removeEventListener(i.VIDEO_STATE_CHANGE+e),t.removeEventListener(i.VIDEO_LOADING+e),t.removeEventListener(i.CONTROL_MUTE+e),t.removeEventListener(i.CONTROL_UNMUTE+e),t.removeEventListener(i.RESOURCE_END+e),t.removeEventListener(i.CONTAINER_RESIZE+e))},_addUIEventListeners:function(){for(var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this.css,s=this.shouldTrapTaps(),n=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],r=n.length;r--;)"_onClosedCaptionBtnClick"===n[r]&&this._isIOS||(this[n[r]]=this[n[r]].bind(this));var a=this._onUVPJSGestureEvent,o=this._hNonTap,l=this._onProgressSliderEvent,d=this._onVolumeSliderEvent,u=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",o),e.addEventListener("mouseenter",a,!0),e.addEventListener("mouseleave",a,!0),e.addEventListener("mousemove",a,!0),e.addEventListener("mousedown",a,!1),e.addEventListener("mouseup",a,!1),e.addEventListener("click",a,!1),e.addEventListener("touchstart",a,!0),e.addEventListener("touchend",a,!0),this._previewBtn=this._queryByElementName(i.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",o),this._isTouch||this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(i.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),this._isTouch||this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(i.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(i.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(i.PROGRESS_SLIDER),this._progressSlider.addEventListener(t,l,!1),this._progressSlider.addEventListener("mousedown",l,!1),this._progressSlider.addEventListener("mouseup",l,!1),this._progressSlider.addEventListener("touchstart",l,!0),this._progressSlider.addEventListener("touchend",l,!0),this._volumeSlider=this._queryByElementName(i.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(t,d,!1),this._volumeSlider.addEventListener("mouseover",d,!1),this._volumeSlider.addEventListener("mouseout",d,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(i.LARGE_PLAY_BTN),s||this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(i.PLAYSTATE_BTN),s||this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(i.VOLUME_BTN),s||this._volumeBtn.addEventListener("click",u,!1),this._volumeBtn.addEventListener("mouseover",u,!1),this._volumeBtn.addEventListener("mouseout",u,!1),this._isIOS||(this._ccBtn=this._queryByElementName(i.CLOSED_CAPTION_BTN),s)||this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn=this._queryByElementName(i.SETTINGS_BTN),s||this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,i.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(i.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this._hNonTap,s=this._onUVPJSGestureEvent,n=this._onProgressSliderEvent,r=this._onVolumeSliderEvent,a=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",i,!1),e.removeEventListener("mouseenter",s,!0),e.removeEventListener("mouseleave",s,!0),e.removeEventListener("mousemove",s,!0),e.removeEventListener("mousedown",s,!1),e.removeEventListener("mouseup",s,!1),e.removeEventListener("click",s,!1),e.removeEventListener("touchstart",s,!0),e.removeEventListener("touchend",s,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",i,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(t,n,!1),this._progressSlider.removeEventListener("mousedown",n,!1),this._progressSlider.removeEventListener("mouseup",n,!1),this._progressSlider.removeEventListener("touchstart",n,!0),this._progressSlider.removeEventListener("touchend",n,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(t,r,!1),this._volumeSlider.removeEventListener("mouseover",r,!1),this._volumeSlider.removeEventListener("mouseout",r,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",a,!1),this._volumeBtn.removeEventListener("mouseover",a,!1),this._volumeBtn.removeEventListener("mouseout",a,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToD)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var t,e=!0;for(t in this._controlList)this._checkControlOnDOM(this._controlList[t])||(e=!1);return e},_waitForControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls.");setTimeout(function(){100<++this._waitCount||(this._haveControlsLoaded()?t.call(this):this._waitForControls(t))}.bind(this),50)},_clearMouseMoveInterval:function(t){t=this._getClassName(t,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[t]&&(clearInterval(this._intervals[t]),this._intervals[t]=-1)},_clearIntervals:function(){var t,e=this._intervals;for(t in e)-1!==e[t]&&(clearInterval(e[t]),e[t]=-1)},_setupDom:function(){var t=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),i(this._containerEl,this.PRIMARY_BLOCK),i(this._contentEl,this._getClassName(t.CONTENT)),i(this._controlsEl,this._getClassName(t.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&i(this._adEl,this._getClassName(t.AD)),this._hide(t.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(t.BUFFERING_FRAME),this._hide(t.LARGE_PLAY_BTN),this._hide(t.CONTROL_BAR),this._hide(t.PROGRESS),this._hide(t.VOLUME_SLIDER),this._show(t.CONTROLS),this._hide(t.BUFFERING_FRAME),this._hide(t.SETTINGS_MENU),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContaine"},_appendControlList:function(t){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t]=t},_setupControlsContainer:function(){var t=JSON.parse(JSON.stringify(this._controls))||[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(t),this._isIOS&&(this._controlsEl.querySelector(".uvpjs__btn-volume").style.right="45px",this._controlsEl.querySelector(".uvpjs__time").style.right="83px")},_generateSettingsMenu:function(t,e){for(var i,s,n,r,a,o,l=this._queryByElementName(this.css.SETTINGS_MENU),d=this._getClassName(this.css.SETTINGS_MENU_ITEM),u=_.assign({},this._menuSelections,this._getCaptionsStyle()),h=document.createRange(),c=uvpjs.util,g=[],p=this.shouldTrapTaps(),v=t&&t.length,f=0;f<v;f++)n=e,(r=(a=t[f]).name)&&(n=c.isDefinedString(e)&&[e,r].join(":")||r),g.push(E(a,n));for(e&&((o=E(this._findMenuItem(e),n=e.split(":").slice(0,-1).join(":"))).cls=d+"--back",g.unshift(o)),h.selectNodeContents(l),h.deleteContents(),l.insertAdjacentHTML("beforeend",this._templateToHTML(g)),i=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),s=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),f=i&&i.length;f--;)p||i[f].addEventListener("click",this._onSettingsMenuBtnClick);for(f=s&&s.length;f--;)p||s[f].addEventListener("click",this._onSettingsMenuInputClick);function E(t,e){var i={};if(!1!==t.enabled)return void 0===t.value?(i.el="SETTINGS_MENU_ITEM",i.type="button",i.label=t.label,i.target=e):(i.el="SETTINGS_MENU_INPUT",i.type="menu",i.label=t.label||t.value,i.value=t.value,i.property=e&&_.last(e.split(":")),i.selected=(e=(t=i).value,!(((t=(t=t.property)&&u[t])&&t.toLowerCase())!==(e&&e.toLowerCase())))),i}},_removeMenuEventListeners:function(){for(var t=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),e=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),i=t&&t.length;i--;)t[i].removeEventListener("click",this._onSettingsMenuBtnClick);for(i=e&&e.length;i--;)e[i].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(t){var i,s={items:this.settingsMenu};return _.isEmpty(t)||(i=this,t=t.split(":"),_(t).ea)})),s},_createAdLearnMoreButton:function(){},_setupPreview:function(){var t=uvpjs.util,e=this.css.PREVIEW_BTN,i=this._previewImage,s=this._queryByElementName(e);uvpjs.log(this.DEBUG_ID,"_setupPreview",i),t.isDefinedString(i)&&(s.style.backgroundImage="url('"+i+"')"),this._show(e)},_setupReplay:function(){var t=uvpjs.util,e=this.css,i=e.REPLAY_BTN,s=this._previewImage,n=this._queryByElementName(i);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),t.isDefinedString(s)&&(n.style.backgroundImage="url('"+s+"')"),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.BUFFERING_FRAME),this._show(e.CONTROLS),this._hide(e.CONTROL_BAR),this._hide(e.PROGRESS),this._show(i),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var t=this._getClassName(this.css.BUFFERING_FRAME);new Spinner({lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:t,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(this._controlsEl)},_disableInactiveButtons:function(){this._isIOS||this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(t){var e=this.css;this._containerId!==t.target||(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(t.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._disableButton(e.SETTINGS_BTN),this._disableButton(e.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._hasHidden(this.css.CONTROL_BAR)||this._show(e.PROGRESS),this._hasActive(e.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),t.payload.adData.isCustomClickTrackingUsed)||this._disable(e.LARGE_PLAY_BTN)},shouldIgnoreStateChange:function(t){return this.vci.getContentVideoData().isLive&&!!t},_onAdEnd:function(t){this._containerId===t.target&&(this.ignoreVideoStateChange=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,t.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(t){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",t),this._captionsLoaded=!0,this._enableCaptions(),this.isAndroidOnHlsjs)||this._enableButton(this.css.SETTINGS_BTN)},_onCaptionsUnavailable:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",t),this._isIOS||this._disableCaptions()},_onContentStart:function(t){var e=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",t),this._containerId===t.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),this._isLive()||this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._captionsLoaded&&this._enableButton(e.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(e.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(e.PROGRESS)):this._isStreaming()&&(this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._hasHidden(this.css.CONTROL_BAR)||this._show(e.PROGRESS)),!this._isIOS)&&this._hasActive(e.CLOSED_CAPTION_BTN)&&this.vci.showCaptions()},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===t.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(t){var e="controlMute"===t.type;this._containerId===t.target&&this._updateVolumeUI(this._volumeSlider.value,e)},_onDiagCloseButton:function(t){this._containerId===t.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",t),this._menuSelections.debug=null)},_onResourceStart:function(t){(t&&t.target)===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(t){var e=t.target,i=0===t.payload.playlistLength;this._containerId===e&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",t),this._hide(this.css.CONTROLS),this._enableReplay&&i&&this._setupReplay(),this._captionsLoaded&&(this._captionsLoaded=!1,this._disableCaptions()),this._resetProgressSlider())},_onVideoProgress:function(t){var e=t.payload,i=e.playbackState,s=this.vci.getVolume(),n=this.css.TIME_DURATION,r=this.css.TIME_CURRENT,a=!1;this._containerId===t.target&&(s!==Number(this._volumeSlider.value)&&this._updateVolumeUI(s),i!==this._playbackState&&(this._playbackState=i,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(e),i!==this.mc.PLAYING||this._isSliding||e.duration!==1/0&&(t=this._queryByElementName(n),s=this._queryByElementName(r),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&3600<=e.duration&&(this.durationChecked=a=!0):(this.durationChecked=!0,3600<=e.duration&&(a=!0)),a&&(s.parentNode.style.width="100px"),t.innerHTML=this._formatTimestampByType(n,e.duration),s.innerHTML=this._formatTimestampByType(r,e.currentTime),this._updateProgressUI(e)),this.isMonitoringMuting)&&this.checkMute()},_onVideoLoading:function(t){_.has(t,"target")&&this._containerId===t.target&&_.isObject(t)&&_.has(t,"payload.data")&&this._updateProgressLoad(t.payload.data)},_onVideoStateChange:function(t){var e;this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",t),_.isObject(t)&&this._containerId===t.target&&_.isObject(t.payload)&&_.isNumber(parseInt(t.payload.newState))&&(this.ignoreVideoStateChange&&e!==this.mc.PAUSED&&e!==this.mc.PLAYING||((e=t.payload.newState)!==this._playbackState&&(this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)),e===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)))},monitorMuting:function(t,e,i){null!==t&&(this.isMonitoringMuting=t),e&&clearInterval(this.muteMonitorIntervalId),i&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var t=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&t!==this.currVolumeInfo.muted&&((this.currVolumeInfo.muted=t)?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(t){var e=!1;switch(t.type){case"mouseenter":this._onUVPJSMouseEnter(t);break;case"mouseleave":this._onUVPJSMouseLeave(t);break;case"mousemove":this._onUVPJSMouseMove(t);break;case"mousedown":this._onUVPJSMouseDown(t);break;case"mouseup":this._onUVPJSMouseUp(t);break;case"click":this._showControlBar(t),e=!0;break;case"touchstart":this._onUVPJSTouchStart(t);break;case"touchend":this._onUVPJSTouchEnd(t),e=!0}!this._hasFirstTouch&&e&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(t)))},_getTargetInfo:function(t){t=t.target;return{isVolumeButton:-1!==t.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==t.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(t){switch(t.type){case"input":case"change":this._onProgressSliderChange(t);break;case"touchstart":case"mousedown":this._onProgressSliderStart(t);break;case"touchend":case"mouseup":this._onProgressSliderEnd(t)}},_onVolumeSliderEvent:function(t){switch(t.type){case"input":case"change":this._onVolumeSliderChange(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onVolumeBtnEve}},_onUVPJSMouseEnter:function(t){t.stopPropagation(),this._containerEl!==t.target||this._hasPaused()||this._showControlBar(t)},_onUVPJSMouseDown:function(t){t.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(t){var e=this.vci.getCurrentPlaybackState().playbackState;this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),t.target.getAttribute("disabled")?(t.stopPropagation(),t.preventDefault()):(this._touchStartTime=t.timeStamp,this._previewCallbackDone?this._hasDisabled(this.css.CONTROLS)||e!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),t.target===this._progressSlider)&&(e=1-(t.target.clientWidth-t.layerX)/t.target.clientWidth,this._onProgressSliderChange(t,e)):this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet."))},_onUVPJSTouchEnd:function(t){var e,i,s=this.css,n=this._isTap(t.timeStamp),r=[s.CLOSED_CAPTION_BTN,s.VOLUME_BTN,s.PLAYSTATE_BTN,s.SETTINGS_BTN,s.SETTINGS_MENU,s.SETTINGS_MENU_ITEM,s.SETTINGS_MENU_INPUT,s.LARGE_PLAY_BTN,s.FULLSCREEN_BTN],a=r.length,o=t.target.className;if(t.target.getAttribute("disabled"))t.stopPropagation(),t.preventDefault();else if(!this._hasDisabled(s.CONTROLS)){if(_.isString(o))for(;a--&&!(i=i||-1<o.indexOf(r[a])););this.shouldTrapTaps()&&i&&a<r.length-1?(t.stopPropagation(),t.preventDefault(),this.handleTap(r[a],t)):((s=!(i||this._isTouchActive&&n))&&t.preventDefault(),s&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),n=e||s?this.HIDE_DELAY:0,e&&clearTimeout(e),e=setTimeout(function(){this._hasPaused()||(e=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER))}.bind(this),n))}},handleTap:function(t,e){var i=this.css,s=this._queryByElementName(t);if(!s.hasAttribute("disabled"))switch(t){case i.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(e);break;case i.VOLUME_BTN:this._onVolumeBtnEvent(e);break;case i.PLAYSTATE_BTN:case i.LARGE_PLAY_BTN:this._onPlayToggle(e);break;case i.SETTINGS_BTN:this._onSettingsBtnClick(e);break;case i.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(e);break;case i.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(e)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(t){t.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(t){var e=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[e]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[e]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(t){this._isMouseActive||(this._clearMouseMoveInterval(t),this._removeModifier(t,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(t){t.stopPropagation(),this._containerEl!==t.target||this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar()},_onControlBarMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResi)},_determineBreakpoint:function(){var t=this._containerEl.offsetWidth;t>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),t<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(t){var e=this.vci.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(e?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(t){var t=parseFloat(t.target.value),e=this.vci.getPlayerMuted();e&&0<t&&this.vci.unMute(),this.vci.setVolume(t),this._updateVolumeUI(t,e)},_onFullscreenBtnClick:function(t){t.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),t.stopPropagation(),t.preventDefault(),this.ignoreVideoStateChange&&this._isLive()?this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo()):(t=this.vci.getCurrentPlaybackState().playbackState,this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",t),t===this.mc.PAUSED||t===this.mc.EMPTY||t===this.mc.LOADING?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):t!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo()))},_onPreviewBtn:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),this._isTouch&&!this._isTap(t.timeStamp)?this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback."):(t.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this)))},_hNonTl},_onReplayBtn:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),t.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._isTouch?this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0):this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),t.stopPropagation();t=this.css.CLOSED_CAPTION_BTN,t=this._hasActive(t);this._ccEnabledByUser=!t,t?(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.hideCaptions()):(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition())},_onSettingsBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),t.stopPropagation();var t=this.css.SETTINGS_MENU,e=this._hasHidden(t);uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",e),e?(this._addModifier(t,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),this._show(t)):(this._removeModifier(t,this.ACTIVE_MODIFIER),this._hide(t))},_onSettingsMenuBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",t);var e=t.target.getAttribute("data-target"),t=(this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",e),t.target.parentNode.setAttribute("data-target",e),this._findMenuItem(e));this._generateSettingsMenu(t.items,e)},_onSettingsMenuInputClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",t);var e=t.target.parentNode.getAttribute("data-target");switch(e&&e.split(":")[0]){case"cc":this._onSettingsCaptionsChange(t);break;case"controls":this._onSettingsControlsChange(t);break;case"debug":this._onSettingsDiagWindowChange(t)}},_onSettingsCaptionsChange:function(t){var t=t.target,e=t.parentNode,i=t.getAttribute("data-property"),s=t.getAttribute("data-value").toLowerCase();this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",i,s),_(e.children).ea)}.bind(this)),t.setAttribute("data-selected","true"),"text-position"===i?this._setCCPosition(s):this.vci.setCaptionsStyleProperty(i,s)},_onSettingsControlsChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",t);var t=t.target,e=t.getAttribute("data-property"),t=t.getAttribute("data-value").toLowerCase(),i="#"+this._containerId+" ";if("background-opacity"===e){var e="background-color",s=this._queryByElementName(this.css.CONTROL_BAR),s=getComputedStyle(s).getPropertyValue(e);if(-1===s.indexOf("rgba"))return;t=s.split(",").slice(0,-1).join(",")+", "+t+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",t),i+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(i,e,t)},_onSettingsDiagWindowChange:function(t){var e=t.target,i=e.getAttribute("data-property"),s=e.getAttribute("data-value"),n=!("true"===e.getAttribute("data-selected"));this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",t),this._menuSelections[i]=s,e.setAttribute("data-selected",n),n?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(t){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",t),this.vci.setCaptionsStyle(t))},_setCaptionsStyleProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",t,e),this.vci.setCaptionsStyleProperty(t,e))},_setCueProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&this._videoEl.textTracks&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",t,e),this.vci.setCaptionsCueProperty(t,e))},_setCCPosition:function(t){var e="text-position";!this._isIOS&&this._captionsLoaded&&(t=t||this._getCaptionsStyle()[e],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",e,t),this.vci.setCaptionsStyleProperty(e,t))},_showControlBar:function(t){var e=this.vci.getCurrentPlaybackState().playbackState,i=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&e!==this.mc.EMPTY&&(_.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[i.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(i.CONTROL_BAR),this.controlsVisible=!0,this._show(i.PROGRESS))},_hideMenu:function(t){this._hasHidden(this.css.SETTINGS_MENU)||-1<t.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(t){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=_.debounce(function(){this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch?this._hideControlBar.hide.cancel():(this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS))},t||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(t){var e=this.css;this._hasDisabled(e.VOLUME_BTN)||this._hasDisabled(e.CONTROLS)||(this._hasActive(e.SETTINGS_MENU)&&this._hide(e.SETTINGS_MENU),this._setDataAttribute(this._containerEl,e.VOLUME_SLIDER,!0),this._addModifier(e.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(e.VOLUME_SLIDER),(this.mc.isFirefox()||this.mc.isEdge())&&(e=this._controlsEl.querySelector(".uvpjs__volume-slider"))&&e.setAttribute("style","bottom: 62px"))},_hideVolumeSlider:function(t){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgre)},_enableCaptions:function(){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._ccEnabledByUser&&(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions()))},_disableCaptions:function(){this._isIOS||(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this._disableButton(this.css.CLOSED_CAPTION_BTN),this._disableButton(this.css.SETTINGS_BTN))},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),_.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(t,e){var i,s=uvpjs.util,n=this._containerEl;!0===this.vci.getPlayerMuted()?i="mute":.85<t?i="full":s.inRange(t,.5,.85)?i="high":s.inRange(t,.15,.5)?i="medium":s.inRange(t,0,.15)&&(i="low"),this._volumeSlider.value=t||this._videoEl.volume,this._setDataAttribute(n,"volume-level",i),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,t)},_onProgressSliderChange:function(t,e){var i=this.vci.getContentVideoData(),s=this.vci.getCurrentPlaybackState(),n=this.css.TIME_CURRENT,r=this._queryByElementName(n),e=1<(e=e||this._progressSlider.value)?1:e<0?0:e,i=Math.ceil(e*i.duration*1e4)/1e4,s=Math.abs((s.currentTime-i)/i);this._updateProgressSlider(e),r.innerHTML=this._formatTimestampByType(n,i),this._hasActive(this.css.PROGRESS_SLIDER)||s<=.02||this.vci.seekTo(i)},_onProgressMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseO)},_onProgressSliderStart:function(t){var e=this.css;this._hasAd()||this._hasDisabled(e.PROGRESS)?(t.stopPropagation(),t.preventDefault()):(this._addModifier(e.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0)},_onProgressSliderEnd:function(t){this._hasAd()||this._hasDisabled(this.css.PROGRESS)?(t.stopPropagation(),t.preventDefault()):(this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(t))},_resetProgressSlid)},_updateProgressLoad:function(t){this._isLive()||(t=Math.ceil(t.bufferLength/t.duration*1e4)/1e4,_.isNaN(t))||t==1/0||t<=0||(this._downloaded=t,this._hasAd())||(this._queryByElementName(this.css.PROGRESS_LOADED).value=this._downloaded)},_updatePlaybackStateUI:function(t){var e=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",t),t){case this.mc.PLAYING:this._show(e.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(e.PROGRESS);break;case this.mc.PAUSED:this._show(e.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(e.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(e.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(e.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(e.CONTROLS),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.LARGE_PLAY_BTN),this._show(e.BUFFERING_FRAME)}},_updateProgressUI:function(t){t=Math.ceil(t.currentTime/t.duration*1e4)/1e4;this._updateProgressSlider(t)},_updateSliderUI:function(t,e,i){var s,n,r=this,a={};_.isUndefined(this._vendorPrefix)||_.isUndefined(t)||(a.id="#"+this._containerId,a.cls=r._getClass(e),a.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[r._vendorPrefix],this._isMSEdge&&(a.pseudo=""),a.add=function(t,e,i){_.isUndefined(this.pseudo)||(e=this.id+(e||"")+" "+this.cls+(i||"")+this.pseudo,r._addCSSRule(e,"background-size",100*t+"% 100%"))},a.before=function(t,e){var i=r._getClass(r.PRIMARY_BLOCK);e&&(i+=r._getClass(r.PRIMARY_BLOCK,e)),this.add(t,i,null)},a.aft)},e===r.css.VOLUME_SLIDER?a.add(i):(e=i*t.offsetWidth,n=(.5-i)*t.offsetHeight,s=e/t.offsetWidth,e=(e+n)/t.offsetWidth,t.value=i,n=r._hasAd(),a.before(s,n?r.AD_MODIFIER:null),this._isTouch&&a.before(e,r.TOUCH_MODIFIER)))},_checkControlOnDOM:function(t){t=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t;return!!this._controlCache[t]},_getClassNai},_getCla)},_queryByClassName:function(t){var e;if(this._containerId)return e=this.ID_SELECTOR_PREFIX+this._containerId,t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),(t=this._controlCache[e]||document.querySelector(e))&&(this._controlCache[e]=t),t},_queryAllByClassName:function(t){var e=this.ID_SELECTOR_PREFIX+this._containerId;return t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),document.querySelectorAll(e)},_queryByElementName:function(t){return this._queryByClassName(this._getClassName(t))},_queryAllByElementNa)},_show:function(t){var e,i,s;t!==this.css.PROGRESS||this._isLive()||(i=(e=this._queryByElementName(t)).querySelector("input"),s=e.querySelector("progress"),e&&(e.style.display="block"),i&&(i.style.display="block"),s&&(s.style.display="block")),this._removeModifier(t,this.HIDDEN_MODIFIER)},_hide:function(t){var e,i,s;t===this.css.PROGRESS&&(i=(e=this._queryByElementName(t)).querySelector("input"),s=e.querySelector("progress"),e&&(e.style.display="none"),i&&(i.style.display="none"),s)&&(s.style.display="none"),this._addModifier(t,this.HIDDEN_MODIFIER)},_enable:function(t){this._removeModifier(t,this.DISABLED_MODIFIER)},_disab)},_enableMenuItem:function(t){t&&(t=this._findMenuItem(t))&&(t.enabled=!0)},_hasHidden:function(t){return this._hasModifier(t,this.HIDDEN_MODIFIER)},_hasActive:function(t){return this._hasModifier(t,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabl)},_hasPaus)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.PLAYING},_isStreamiG},_hasModifier:function(t,e){_.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));e=this._getClassName(t,e),t=this._queryByElementName(t);return!!t&&s(t,e)},_addModifier:function(t,e){_.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));e=this._getClassName(t,e),t=this._queryByElementName(t);t&&i(t,e)},_removeModifier:function(t,e){var i=this._queryByElementName(t);_.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER)),t=this._getClassName(t,e),i&&n(i,t)},_toggleModifier:function(t,e){_.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));e=this._getClassName(t,e),t=this._queryByElementName(t);t&&r(t,e)},_setDataAttribu)},_removeDataAttribu)},_formatTimestamp:function(t){var e;return uvpjs.util.isEmpty(t)||t===1/0?this.NULL_TIME:(isNaN(t)&&(t=0),(e=new Date(null)).setSeconds(Math.round(t)),e=e.toISOString(),3600<=t?e.substr(11,8):e.substr(14,5))},_formatTimestampByType:function(t,e){if(void 0===e||e<0){if(t===this.css.TIME_DURATION)return this.NULL_TIME;if(t===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(e)},_addCSSRule:function(t,e,i){var s=this._styleEl.sheet,n=s.cssRules.length,r=this._cssRules[t];if(!_.isUndefined(r)){s=s.rules||s.cssRules;if(0<s.length&&s[r])return void(s[r].style[e]=i)}this._cssRules[t]=n,uvpjs.util.addCSSRule(this._styleEl,t,e,i)},_setStyleSheet:function(e){var i=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(t){this._styleEl=t,i||"function"!=typeof e||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),i=!0,e())}.bind(this))},_templateToHTML:function(t){var s,n,r;if(_.isArray(t)&&!_.isEmpty(t))return s=function(t){return this._getClassName(this.css[t]||t)}.bind(this),n=JSON.parse(JSON.stringify(this._template))||{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},r=this._isIOS,function e(t){var i="";return _(t).each(function(t){t&&("CLOSED_CAPTION_BTN"!==t.el&&"SETTINGS_BTN"!==t.el||!r)&&(t.cls=_.isUndefined(t.cls)?s(t.el):[t.cls,s(t.el)].join(" "),t.children&&(t.children=e(t.children)),i+=_.template(n[t.type],{variable:"o"})(t))}),i}(t)},_getCaptionsSty)},_isTap:function(t){return!!this._touchStartTime&&t-this._touchStartTime<this.TAP_THRESHOLD}}))},i=function(t,e){s(t,e)||(t.className=(t.className+=" "+e).trim())},n=function(t,e){t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").trim()})}}(uvpjs.register("uvpjs")),w=uvpjs.register("uvpjs"),C=w._,w.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(t,e,i,s){this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",e),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",i)),C.isArray(e)?(this.vidContId=t,this._generateAdPods(e,i,s)):this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN")},_generateAdPods:function(t,e,i){function s(t,e,i){return{hasBeenChecked:!1,startTime:i||0,hasPlayed:!1,adPodId:t,adCount:0,podDuration:0,adCallURL:e}}var n,r,a,o=e.length;for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",e)),this.adPods={},0<o&&(-1<e.indexOf(0)&&(this.adPods[this.PRE]=s(this.PRE+"_0",i)),-1<e.indexOf(-1))&&(this.adPods[this.POST]=s(this.POST+"_0",i)),n=0;n<o;n++)r=0===e[0]?n:n+1,a=e[n],isNaN(a)||0===a||-1===a||(this.adPods[this.MID_+r]=s(this.MID_+r,i,a));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",t),C.isString(t))return t=this.adPods[t],this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",t),t},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var t=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",t),t},getMidRollPods:function(){var t,e=[];if(!this.midRollPods){for(t in e=[],this.adPods)0<=t.indexOf(this.MID)&&e.push(this.adPods[t]);this.midRollPods=e}return this.midRollPods},isPreRoll:function(t){return!C.isUndefined(t.adPodId)&&-1<t.adPodId.indexOf(this.PRE)},isMidRoll:function(t){return!C.isUndefined(t.adPodId)&&-1<t.adPodId.indexOf(this.MID)},isPostRoll:function(t){return!C.isUndefined(t.adPodId)&&-1<t.adPodId.indexOf(this.POST)},hasMidRoll:function(){for(var t in this.adPods)if(-1<t.indexOf(this.MID))return!0;return!1},hasPostRo)},returnPrecedingUnplayedAdPod:function(t){var e,i,s,n=null,r="No eligible ad pod found.";for(s in this.adPods)this.adPods.hasOwnProperty(s)&&(e=this.adPods[s],this.isPreRoll(e)||this.isPostRoll(e)||e.startTime<=t&&(!n||t-e.startTime<t-n.startTime)&&(n=e));return n&&(i=n.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",r="Found Ad pod; adPodId = "+n.adPodId+"; "+i),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+t+";  "+r),n}}),b=uvpjs.register("uvpjs"),R=b._,b.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",DATAZOOM_MODULE_NAME:"Datazoom",DEFAULT_SITEID:"",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},_hasAgentInit:!1,init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this.resourceStartTime=0,this.contextMetadata={},this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,t&&this.initialize(t.vidContId,t.cviMgr)},destroy:function(){for(var t,e=this.agents.length;e--;)this.agents[e]&&"function"==typeof this.agents[e].destroy&&this.agents[e].destroy(),this.agents.splice(e,1);for(t in this.eventCBs)this.eventsMgr.removeEventListener(t+this.internalNS+".agent"),delete this.eventsMgr[t];for(t in this.progressEvents)delete this.progressEvents[t];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this.contextMetadata=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),R.isString(t)&&R.isObject(e)&&(this.vidContId=t,this.eventsMgr=e.getEventsMgr(),this.cviModel=e.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._addTrackingEventListeners())},hasTrackingConfigOverrides:function(t){return null!==t&&t.hasOwnProperty("trackingConfigOverrides")&&null!==t.trackingConfigOverrides},getAgentConfig:function(t,e){for(var i=null,s=t.length;0<s--;){var n=t[s];if(n.name===e){i=n;break}}return i},_overrideUvpc:function(){var t=this.cviModel;if(this.hasTrackingConfigOverrides(t)){for(var e=t.getModules().slice(0),i=e.length;0<i--;){var s=e[i],s=this.getAgentConfig(t.trackingConfigOverrides,s.name);null!==s&&(e[i]=s)}this.agentConfigs=e}else this.agentConfigs=t.getModules().slice(0)},isTrackingAgentEnabled:function(t){var e,i=this.getAgentConfig(this.agentConfigs,t),s=this.mc.systemInfo.trackingAvailability,n=!1;for(e in uvpjs.tracking)if(uvpjs.tracking[e]===t&&s[e]){n=!0;break}return this.debug&&i&&i.enabled&&!n&&uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",i,s),null!==i&&i.enabled&&n},_createAgentsArray:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),t=t||this.cviModel,this.debug&&uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),s=t.isModuleEnabled.bind(t),t=t.isModuleSet.bind(t),i=this.getPlayerName(),i={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr,playerName:i,playerVersion:this.PLAYER_VERSION_ONLY},this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),i.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,e=new uvpjs.AdobeHeartbeatAgent(i),this.agents.push(e)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),i.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,e=new uvpjs.AkamaiAnalyticsAgent(i),this.agents.push(e)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),i.moduleName=this.COMSCORE_SS_MODULE_NAME,i.playerName=this.getPlayerName("|","_"),e=new uvpjs.ComScoreAgent(i),this.agents.push(e)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),i.moduleName=this.CONVIVA_MODULE_NAME,e=new uvpjs.ConvivaAgent(i),this.agents.push(e)),((a=s(this.DW_MODULE_NAME))||s(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),i.moduleName=a?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,i.playerName=this.getPlayerName(";"),e=new uvpjs.DWAgent(i),this.agents.push(e)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),i.moduleName=this.NIELSEN_MODULE_NAME,e=new uvpjs.NielsenAgent(i),this.agents.push(e)),t(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME)?this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC"):(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent"),s=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME),i.moduleName=this.MUX_MODULE_NAME,i.playerName=this.PLAYER_NAME_ONLY,i.playerVersion=this.PLAYER_VERSION_ONLY,i.useDefaultProperty=!s("propertyKey"),e=new uvpjs.MuxAgent(i),this.agents.push(e));var e,i,s,n=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(n&&n.params&&0<n.params.length)for(var r=n.params.length;0<r--;)this.beaconEndPoint[n.params[r].name]=n.params[r].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(i.moduleName=this.OZTAM_MODULE_NAME,e=new uvpjs.OzTamAgent(i),this.agents.push(e));var a=this.getAgentConfig(this.agentConfigs,this.DATAZOOM_MODULE_NAME);a&&a.enabled&&(i.moduleName=this.DATAZOOM_MODULE_NAME,e=new uvpjs.DatazoomAgent(i),this.agents.push(e))},_addTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.addEventListener(e.CONTEXT_METADATA+i,this._onContextMetadata.bind(this)),t.addEventListener(e.VIDEO_STATE_CHANGE+i,this._onVideoStateChange.bind(this)),t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),t.addEventListener(e.RESOURCE_START+i,this._onResourceStart.bind(this)),t.addEventListener(e.PLAYBACK_DURATION_RESUME+i,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.removeEventListener(e.VIDEO_PROGRESS+i),t.removeEventListener(e.AD_QUARTILE+i),t.removeEventListener(e.RESOURCE_START+i)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),R.isEmpty(this.agents))this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled.");else{for(var t=this.agents.length;t--;)this.agents[t].initialize();this._addAgentEventListeners()}},fireTrackingPixel:function(t){var e=document.createElement("img");e.setAttribute("src",t),e.setAttribute("width","1"),e.setAttribute("height","1"),e.setAttribute("border","0"),e.style.position="absolute",e.style.bottom="0",e.style.right="0",this._beaconElement.appendChild(e)},registerEventCallbacks:function(t){if(R.isPlainObject(t)&&!R.isEmpty(t))for(var e in t)this.eventCBs[e]=this.eventCBs[e]||[],this.eventCBs[e].push(t[e])},registerProgressEvents:function(t){if(R.isPlainObject(t)&&!R.isEmpty(t))for(var e in t)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",e),this.progressEvents[e]=this.progressEvents[e]||[],this.progressEvents[e].push(t[e])},getContentPlayhe)},getPlayerName:function(t,e){var i=this.PLAYER_NAME;return R.isEmpty(i)?"UVPJS":(t&&(i=i.replace("_",t)),e?i.replace(/\./g,e):i)},getAdLength:function(){return this._adLength=pt(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=pt(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var t in this.eventCBs)this.eventsMgr.addEventListener(t+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(t){if(t.target===this.vidContId){var e=this.eventCBs[t.type];if(!R.isEmpty(e))for(var i=e.length,s=0;s<i;s++)e[s](t)}},_onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata},_onVideoStateChange:function(t){var e,i;t.payload.newState!==this.mc.LOADING||this._hasAgentInit||(t=this.cviModel.cviMgr.RPM.currRP,e=this.cviModel.cviMgr.RPM.rscProviders,t&&t.rco&&t.rco.uvpc?i=t.rco.uvpc:e&&0<e.length&&(i=e[0].rco.uvpc),i&&i.modules&&this.cviModel.copyModules(i.modules),this._overrideUvpc(),this._createAgentsArray(),this._initializeAgents(),this._hasAgentInit=!0)},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this.resourceStartTime=new Date,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(t){var e,s=this.progressEvents[t];if(!R.isEmpty(s))for(e=s.length,i=0;i<e;i++)s[i]()},_onPlaybackDurationResume:function(t){var e=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),i=this.cviModel.getContentVideoState(),e={ts:Math.floor(Date.now()/1e3),contentid:i.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:e("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:i.isPaidContent,affiliate:i.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},i=(new b.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(e).devMode(this.debug).buildUrl();this.fireTrackingPixel(i)},_onVideoProgress:function(t){var t=t.payload,e=Math.floor(t.currentTime),i=t.duration;if(e&&i&&!t.isAd&&!(this._lastContentSecondCompleted>=e)){if((this._lastContentSecondCompleted=e)%15==0&&e<=60||e%60==0){if(this._contentTimeFired[e])return;this._contentTimeFired[e]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",e),this._onProgressEvent(this.progressEvents.TIMED)}t.isPlayingLive||i<=10||((t=Math.floor(e/i*100))!==this.percentDone&&(this.percentDone=t),R.inRange(t,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),R.inRange(t,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),75<=t&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),pt=function(t,e){e=0<e?Math.floor(1e3*e):0;return uvpjs.util.inRange(t,e-1e3,e+1e3)?t:e},uvpjs.register("uvpjs").TrackingAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,vo:null,sdkEvent:null,hasSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,isSeekDone:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(t){this.options=t,this.initTime=new Date,this.contextMetadata=t.trackingMgr.contextMetadata||{}},initialize:function(){var t=this.options.eventsMgr.eventTypes,e={};e[t.RESOURCE_START]=this.onResourceStart.bind(this),e[t.CONTENT_START]=this.onContentStart.bind(this),e[t.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),e[t.CONTROL_SEEK]=this.onSeekStart.bind(this),e[t.SEEK_DONE]=this.onSeekDone.bind(this),e[t.RESOURCE_END]=this.onResourceEnd.bind(this),e[t.CONTEXT_METADATA]=this.onContextMetadata.bind(this),e[t.CDN_UPDATED]=this.onCdnUpdated.bind(this),e[t.AD_POD_START]=this.onAdPodStart.bind(this),e[t.AD_POD_END]=this.onAdPodEnd.bind(this),e[t.AD_START]=this.onAdStart.bind(this),e[t.AD_CLICK]=this.onAdClick.bind(this),e[t.AD_END]=this.onAdEnd.bind(this),e[t.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),e[t.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),e[t.USER_GESTURE]=this.onUserGesture.bind(this),e[t.FORCE_TRACK_SESSION_END]=this.onForceTrackSessionEnd.bind(this),this.options.trackingMgr.registerEventCallbacks(e),(e={})[(t=this.options.trackingMgr.progressEvents).FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.FIRST_QUARTILE),e[t.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.MID_QUARTILE),e[t.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(e)},onResourceStart:function(t){this.hasResourceStart||(this.sendTrackEvent(this.sdkEvent.SESSION_START,this.vo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(t){this.trackContentStartEvent=!0,this.hasContentStart&&this.isPaused&&(this.sendTrackEvent(this.sdkEvent.PLAY_RESUME),this.isPaused=!1)},onQuartileProgre)},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.sdkEvent.PAUSE));break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.sdkEvent.BUFFER_START));break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.sdkEvent.BUFFER_COMPLETE),this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))}},onSeekStart:function(t){this.sendTrackEvent(this.sdkEvent.SEEK_START,this.vo.getSeekInfo())},onSeekDone:function(t){this.sendTrackEvent(this.sdkEvent.SEEK_COMPLETE,this.vo.getSeekInfo()),this.isSeekDone=!0},onResourceEnd:function(t){this.hasContentStart&&this.vo.isCompletedMarker()&&(this.sendTrackEvent(this.sdkEvent.CONTENT_COMPLETE,this.vo.getContentCompleteInfo()),this.sendTrackEvent(this.sdkEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadaa},onCdnUpdated:function(t){this.sendTrackEvent(this.sdkEvent.CDN_UPDATED,{cdn:t.payload.cdn})},onAdPodStart:function(t){this.sendTrackEvent(this.sdkEvent.AD_BREAK_START,this.vo.getAdBreakInfo())},onAdPodEnd:function(t){this.sendTrackEvent(this.sdkEvent.AD_BREAK_COMPLETE)},onAdStart:function(t){this.sendTrackEvent(this.sdkEvent.AD_START,this.vo.getAdItemInfo())},onAdClick:function(t){this.sendTrackEvent(this.sdkEvent.AD_CLICK)},onAdE)},onVideoTransition:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"bitrate",t.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(t){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.sdkEvent.QOS,this.vo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.hasContentStart||(this.sendTrackEvent(this.sdkEvent.CONTENT_START,this.vo.getContentStartInfo()),this.hasContentStart=!0)),this.isSeekDone&&(this.isSeekDone=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))},onUserGesture:function(t){0<t.payload.startTime&&(this.options.resumeTime=t.payload.startTime)},onForceTrackSessionE)},destroy:function(){this.vo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.vo=null,this.contextMetadata=null}}),function(t){"use strict";var l,n,r,a,o,d=t._;t.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",SEGMENT_OWNER_PARAM_NAME:"id3SegmentOwner",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",LIVE_CONTENT_LENGTH:86400,init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this._segmentOwner=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata=this.trackingMgr.contextMetadata||{},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._startUpTime=0,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._segmentOwner=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),d.isUndefined(this._visitorData.marketingCloudOrgId)?this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."):this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),d.isFunction(t)?(e=(e||this.cviModel).sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),this._usesTealium=e.usesTealium,e=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT],this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),e=d.without(e,this.scriptPaths.APP_MEASUREMENT)),a()&&!this.isPluginLoaded?(this.codeLoader=new uvpjs.CodeLoader,this.codeLoader.loadScript(e,this.pluginLoadedCB)):(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB())):this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!")},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var t=this._qosObject;return l.createQoSObject(t.bitrate,t.startupTime,t.fps,t.droppedFrames)},getCurrentPlaybackTi0},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),e=t(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),i=t(this.TRACKING_SERVER_PARAM_NAME);this._segmentOwner=t(this.SEGMENT_OWNER_PARAM_NAME),this.mc.isSecure()&&(d.isString(i)&&0!==i.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(i=this.TRACKING_SERVER_SSL_PREFIX+i),d.isString(e))&&(e=e.replace("heartbeats.omtrdc.net","newimagitasinc.hb.omtrdc.net")),this._appMeasurementData={account:t(this.ACCOUNT_PARAM_NAME),charSet:t(this.CHAR_SET_PARAM_NAME),trackingServer:i},this._heartbeatData={publisher:t(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:e},this._visitorData={marketingCloudOrgId:t(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:i},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var i=this.cviModel.sessionOptions;this._usesTealium=i.usesTealium;d.each({ftag:"ftag",netwk:"Network"},function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",t,e);e=i[e];d.isNull(e)||d.isUndefined(e)||d.isEmpty(e)||(this._sessionMetadata[t]=e)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_POD_END]=this._onAdPodEnd.bind(this),e[t.AD_CLICK]=this._onAdClick.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),e[t.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),e[t.PLAYER_LOADED]=this._updateVideoInfo.bind(this),e[t.RESOURCE_START]=this._updateVideoInfo.bind(this),e[t.VIDEO_RESUME]=this._updateVideoInfo.bind(this),e[t.VIDEO_DONE]=this._updateVideoInfo.bind(this),e[t.VIDEO_CUEPOINT]=this._onVideoCuePoint.bind(this),this._contextMetadataCBSetup||(e[t.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(e)},_setupContextMetadataEventCallback:function(){var t={};t[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t),this._contextMetadataCBSetup=!0},_initializePlugin:function(){var t,e,i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),a())this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded.");else if(this._mediaHeartbeat)this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used.");else if(l=ADB.va.MediaHeartbeat,n=ADB.va.MediaHeartbeatConfig,r=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),!this._usesTealium||o(this._s)||this._waitForTealium){if(this._usesTealium)e=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(t=this._appMeasurementData.account,d.isString(t)&&d.isEmpty(t))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));try{try{this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent new Visitor"),i=new Visitor(this._visitorData.marketingCloudOrgId)}catch(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Visitor.getInstance",i),i=Visitor.getInstance(this._visitorData.marketingCloudOrgId)}}catch(t){this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed.")}i.trackingServer=this._visitorData.trackingServer,i.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),(e=new AppMeasurement(t)).visitor=i,e.account=t,e.trackingServer=this._appMeasurementData.trackingServer,e.pageName=this._appMeasurementData.pageName,e.charSet=this._appMeasurementData.charSet,e.visitorID=this._appMeasurementData.visitorID}d.isNull(e)?this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."):((i=new n).trackingServer=this._heartbeatData.trackingServer,i.playerName=this._playerName,i.channel=this._heartbeatData.channel,i.debugLogging=this._heartbeatDebug,i.appVersion=this.SDK_VERSION,i.ssl=this.mc.isSecure(),i.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",i),d.extend(s.prototype,r.prototype),s.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},s.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new l(new s(this),i,e),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad())}else this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),this._getTealiumt}},_getTealium:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),o(this._s)||this._waitForTealium?this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded."):(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),d.has(window,"s")&&o(window.s)?(this._s=window.s,this._waitForTealium=!0,this._initializePlugin()):(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL)))},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(t,e){if(d.isNull(this._mediaHeartbeat))this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined");else switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",t),t){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(l.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(l.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(l.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(l.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(l.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(l.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(l.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(l.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(l.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(l.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(l.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(e)}},_getContentVideoMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),s=this._contextMetadata,n=this._sessionMetadata,r={};for(t in s)s.hasOwnProperty(t)&&(r[t]=s[t]);for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);if(i.contextMetadata)for(t in e=i.contextMetadata)e.hasOwnProperty(t)&&(r[t]=e[t]);return r.tl=i.videoTitle,r.mediaAutoPlay=this.cviModel.isAutoplay.toString(),r.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),r.mediaIsPaidContent=i.isPaidContent.toString(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",r),r},_onContextMetadata:function(t){var e=t.payload.contextMetadata;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",t),d.isEmpty(e)||(this._contextMetadata=e,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),d.isEmpty(e[this.PAGE_REPORT_SUITE_ID_KEY]),t=e[this.PAGE_SITE_ACCOUNT_KEY],d.isEmpty(t))||(e=d.isEmpty(this._appMeasurementData.account),this._appMeasurementData.account=t,e&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+t),this._initializePlugin()))},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat,this._startUpTime),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:this._startUpTime,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(t){var e,i,s=t.chapterStartTimes,n=s&&s.length||0,r=parseInt(t.currentContentSegment);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",t),i=(e=(r=isNaN(r)?1:r)<0?0:r-1)<=0?0:s[e],t=(n=n<1+e?t.duration:s[1+e])-i,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",n,i),(n={name:""}).length=isNaN(t)?0:t,n.position=r,n.startTime=s[e],this._chapterObject=l.createChapterObject(n.name,n.position,n.length,n.startTime),this._chapterInfo=n,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(t){var e,i,s;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",t),"pre"===(i=(s=(t=t.payload.adData).adClipID.split("_"))[0])?e=1:"mid"===i?e=parseInt(s[1])+1:"post"===i&&(e=this.cviModel.getNumberOfAdPods()),(s={}).name=d.isEmpty(t.adVideoTitle)?"na":t.adVideoTitle,s.position=e,s.playerName=this._playerName,s.startTime=this.getCurrentPlaybackTime(),(i={}).id=d.isEmpty(t.adVideoId)?d.isEmpty(t.adVatId)?"na":t.adVatId:t.adVideoId,i.name=s.name,i.length=t.duration,i.position=t.adPosition,this._adObject=l.createAdObject(i.name,i.id,i.position,i.length),this._adBreakObject=l.createAdBreakObject(s.name,s.position,s.startTime),this._adInfo=i,this._adBreakInfo=s,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(t){var e=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(e)},_onAdClick:function(t){t=!0===t.payload.adData.paused;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),t&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(t){t=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",t),this._contentStarted=!0,this._startUpTime=Math.abs(new Date-this.trackingMgr.resourceStartTime)/1e3,this._sendInitialPlay(),0<t.chapterStartTimes.length&&(this._setChapterInfo(t),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(t){t=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",t),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&0<t.chapterStartTimes.length&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(t){var e=this._videoInfo,e=this._contentStarted&&e&&Math.ceil(e.playhead)>=.95*e.length,i=this.cviModel.getContentVideoState().isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",e),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,!i&&e&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(t){var e=t.payload.newState,i=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",e),this._videoLoaded&&(this._isBuffering||e!==this.mc.BUFFERING?this._isBuffering&&e!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),e===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),i)&&e===this.mc.PAUSED&&this._onControlPause(t)},_updateVideoInfo:function(){var t,e=this.cviModel.getCurrentPlaybackState(),i=this.cviModel.getContentVideoState(),s=l.StreamType,n=i.duration,r=i.isLive,a=i.episodeFlag,o={};d.isEmpty(i.cmsRefGuid)?d.isEmpty(i.mediaId)?d.isEmpty(i.pid)?d.isEmpty(i.assetURL)?o.id="na":o.id=i.assetURL:o.id=i.pid:o.id=i.mediaId:o.id=i.cmsRefGuid,o.name=i.videoTitle,o.playerName=this._playerName,o.length=r?this.LIVE_CONTENT_LENGTH:isNaN(n)?0:n,o.playhead=e.currentTime,r?t=s.LIVE:(t=s.VOD,t+=":"+(a?this.FULL_EPISODES:this.CLIPS)),o.streamType=t,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",l),this._mediaObject=l.createMediaObject(o.name,o.id,o.length,o.streamType),this._videoInfo=o,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(t){var t=t&&t.facadeState,e=this._qosObject;t&&e&&(e.bitrate=t.currentBitrate||0,e.droppedFrames=t.droppedFrames||0,e.fps=t.playbackFramerate||0)},_updatePlayhead:function(t){t=t.payload;this._videoInfo&&t&&(t.isAd||(this._updateQosObj(t),this._videoInfo.playhead=t.currentTime))},_sendInitialPlay:function(){this._videoLoaded||this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)},_onVideoCuePoint:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoCuePoint",t),this._isSegmentOwner(t.payload)&&0<(t=(t=t.payload.data).split("|")).length&&this._segmentStart({segmentId:t[0],segmentTitle:t[1]})},_segmentStart:function(t){var e;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _segmentStart",t),t.segmentId&&(this._mediaHeartbeat.trackComplete(),this._mediaHeartbeat.trackSessionEnd(),this._mediaObject.data["a.videoId"]=t.segmentId,this._mediaObject.data["a.name"]=t.segmentTitle,(e=this._getContentVideoMetadata()).tl=t.segmentTitle,this._mediaHeartbeat.trackSessionStart(this._mediaObject,e),this._mediaHeartbeat.trackPlay())},_isSegmentOwner:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _isOwner",this._segmentOwner),t.data&&-1<t.data.indexOf("|")&&t.name===this._segmentOwner}}),a=function(){return"undefined"==typeof ADB||"undefined"===d.get(ADB,"va.Heartbeat")},o=function(t){return d.isObject(t)&&!d.isEmpty(t)&&d.isFunction(t.isReadyToTrack)}}(uvpjs.register("uvpjs")),P=uvpjs.register("uvpjs"),ft=P._,M="*null",L={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"},P.ComScoreAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:t("c2")||"",ns_st_pu:t("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.RESOURCE_START]=this._onResourceStart.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),e[t.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){vt()?this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."):this._setupEventCallbacks()},_createStreamingTag:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",t),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(t)},_getContentMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),s=(this.cviModel.getContentPlaybackState(),uvpjs.util),n=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),r=this.cviModel.getContentVideoState().isLive,a=parseInt(i.episodeNumber),o=parseInt(i.seasonNumber),l=(i.seriesTitle,i.videoTitle),d=l&&l.split("-")[1],u=!isNaN(a),h=!isNaN(o),c=null!==i.contextMetadata&&i.contextMetadata.comscore_c4,g=(u&&h&&(t=Vt(a),l+="--"+(e=Vt(o))+t),{ns_st_ci:s.getDefinedString(i.cmsRefGuid,i.mediaId,"0"),ns_st_cl:r?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[L.publisherBrand],ns_st_pr:s.getDefinedString(i.seriesTitle,i.videoTitle),ns_st_ep:d,ns_st_sn:h&&e||M,ns_st_en:u&&t||M,ns_st_ge:i.category||M,ns_st_ia:r?1:0,ns_st_ddt:M,ns_st_tdt:M,ns_st_st:n("c4")||M,ns_st_ce:i.episodeFlag?1:0,c3:n("c3")||this._playerName,c4:c||n("c4")||M,c6:n("c6")||l});return["ns_st_ge","ns_st_st","ns_st_pu","ns_ap_an","ns_st_ddt","ns_st_tdt"].forEa)}),g},_onAdStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",t),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",t),this._isAd=!1,this._trackStop()},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",t);t=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?t.Live:t.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",t),this._trackStop()},_onControlPlay:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",t),this.streamingTag?this._isAd?this._trackAdPlay():this._trackContentPlay():this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized")},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",t),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",t),this.streamingTag=null},_onLiveSegmentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",t),this._isLiveEvent(t)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=t.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",t),this._trackStop()},_onVideoProgre)},_onVideoStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",t);var e=t.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(e===this._mc.PAUSED?this._onControlPause(t):e===this._mc.PLAYING&&this._onControlPlay(t))},_trackAdPl)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=P.util.copyObjectWithKeyMap(L).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(t){return this.cviModel.getContentVideoState().isLive&&t.payload&&t.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof t.payload.liveSegmentData},_isSameLiveStation:function(t){return t.stationTitle===this._contentMetadata[L.stationTitle]},_getAdType:function(){var t=ns_.ReducedRequirementsStreamingAnalytics.AdType,e=this.cviModel.getAdVideoState().adClipID.split("_")[0],e="pre"===e?t.LinearOnDemandPreRoll:"mid"===e?t.LinearOnDemandMidRoll:t.LinearOnDemandPostRoll;return e=this.cviModel.getContentVideoState().isLive?t.LinearLive:e}}),vt=function(){return"undefined"==typeof ns_||ft.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)},function(t){"use strict";t.ConvivaAgent=uvpjs.Class.subClass({init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",t),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null,this.contextMetadata=this.trackingMgr.contextMetadata||{}},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null,this.contextMetadata=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){var t,e;void 0===window.Conviva?this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded."):(t=this.eventTypes,(e=this.adEventHandlerMap={})[t.AD_POD_START]=this.hPodStart.bind(this),e[t.AD_POD_END]=this.hPodEnd.bind(this),e[t.AD_LOADED]=this.hAdLoaded.bind(this),e[t.AD_START]=this.hAdStart.bind(this),e[t.AD_END]=this.hAdEnd.bind(this),e[t.AD_ERROR]=this.hAdError.bind(this),e[t.AD_BUFFERING]=this.hAdBuffering.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient)&&(this._setupEventCallbacks(),this.debug)&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client."))},_getAdType:function(t){var t="string"==typeof t?t.toLowerCase():null,e=Conviva.Client.AdPosition,i=uvpjs.ConvivaAgent.adPositions;return!t||0<=t.indexOf(i.PRE)?e.PREROLL:0<=t.indexOf(i.MID)?e.MIDROLL:0<=t.indexOf(i.POST)?e.POSTROLL:void 0},_getArgsForStartAd:function(t){var e=Conviva.Client.AdStream,i=Conviva.Client.AdPlayer,s="ima"==t.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(t.adType),stream:s?e.SEPARATE:e.CONTENT,player:s?i.SEPARATE:i.CONTENT}},_onAdEvent:function(t){var e=t.type;this.startEvents.content=0,this.hasConvivaSession||e===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[e](t.payload,t)},hPodStart:function(t,e){this.podCount++,this._onContentPaused(e),this.currAdPodInfo=this._buildAdPodInfo(t.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);e=this._getArgsForStartAd(t);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(e.key,e.stream,e.player,e.pos),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",e),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(t,e){t=this._buildAdInfo(t);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,t),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(t,e){this.adPodInProgress&&this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(t,e){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(t,e){var i=this.currAdPodInfo||{},s=this.convivaSessionKey;this.adPodInProgress=!1,uvpjs.util.isEmpty(s)||s===Conviva.Client.NO_SESSION_KEY?this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",i),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(t,e){t=t.errorInfo;this.hasConvivaAdSession?(this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",t)):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",t)},hAdBuffering:function(t,e){this.hasConvivaAdSession?(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_BUFFERING")):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad buffering - no session key")},_onContentEvent:function(t){var e=!1;this.startEvents.ad=0,t.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),this.hasConvivaSession||this._createConvivaSession(),e=!0):t.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,this.hasContentStarted=e=!0,this._killConvivaAdSession()),e&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(t){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlayi)},_onContentBuffering:function(t){this.isSeekPending||this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",t),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*t.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(t){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",t),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(t){this.isSeekDone&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",t),this._onContentPlaying(t),this.isSeekDone=!1)},_onVideoEvent:function(t){var e=this.eventTypes;switch(t.type){case e.VIDEO_STATE_CHANGE:var i=t.payload.newState,s=this._getMediaCapabilities();this.hasConvivaAdSession?i===s.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(t):i===s.PAUSED&&this._onAdPaused(t):this.hasConvivaSession&&(i===s.PLAYING?this._onContentPlaying(t):i===s.PAUSED?this._onContentPaused(t):i===s.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(t));break;case e.VIDEO_TRANSITION_COMPLETE:case e.VIDEO_DONE:this._onVideoTransition(t);break;case e.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(t){var e=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY,i=new Conviva.ContentMetadata;i.defaultResource=this._validateStr(t.payload.cdn,""),this.convivaClient.updateContentMetadata(e,i)},_onError:function(t){t=t.payload.errorInfo;t.isFatal?(this.hasConvivaSession||this._createConvivaSession(),this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(t){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",t),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(t){t=t.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(0<t&&(t*=.001),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",t),this.convivaPlayerStateManager.setBitrateKbps(t))},_onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata||{}},_createConvivaSession:function(){var t,e;this.convivaClient&&(t=this.cviModel,this._getMediaCapabilities(),Conviva.PlayerStateManager.PlayerState,t={userId:t.getSessionOption("userId"),userPPID:t.getSessionOption("userPPID"),userStatus:t.getSessionOption("userStatus")},e=new Conviva.ContentMetadata,this._setContentMetadata(e,t),this.convivaSessionKey=this.convivaClient.createSession(e),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug)&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug)&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed")},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(t,e){var i=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",t,e),this.convivaClient&&this.convivaClient.sendCustomEvent(i,t,e)},_sendError:function(t,e,i){var s;this.hasConvivaSession&&(s="",t=uvpjs.mapErrorCode(t).toString(),!0===i?(s=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,t,e)):this.convivaPlayerStateManager.sendError(t,e),this.debug)&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+s+" ERROR: "+t)},_setConvivaPlayerState:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",t),this.convivaPlayerStateManager.setPlayerState(t))},_setContentMetadata:function(t,e){var i=this.cviModel,s=Conviva.ContentMetadata.StreamType,n=i.contentVideoState,r=n.defaultBitrate;t.applicationName=this.playerName,t.assetName=this._validateStr(n.videoTitle,"N/A"),t.defaultBitrateKbps=r&&0<r?r:700,t.defaultResource=this._validateStr(n.cdn,""),t.duration=n.duration,t.streamType=n.isLive?s.LIVE:s.VOD,t.streamUrl=this._validateStr(n.assetURL,"N/A"),t.viewerId=this._validateStr(e.userId,"N/A"),t.custom={accessType:this._validateStr(e.userStatus,"anon"),contentId:this._validateStr(n.cmsRefGuid,"N/A"),contentType:n.isLive?"Live":"VOD",isEpisode:n.episodeFlag?"true":"false",Partner_ID:this._validateStr(i.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(n.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._getEpisodeTitle(n),appRegion:this._validateStr(i.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:n.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(n.drm),showId:this.contextMetadata.showId&&this._validateStr(this.contextMetadata.showId.toString(),""),connectionType:this._validateStr(i.sessionOptions.userConnectionType,"unknown")}},_getEpisodeTitle:function(t){return t.isLive?t.videoTitle||t.episodeTitle:(t=-1<(t=this._validateStr(t.episodeTitle,t.videoTitle)).search(/\w+.*-.*\w+/)?t.split("-")[1]:t).replace(/^\s+|\s+$/g,"")},_getWinDimension:function(){var t=this.cviModel.contentVideoState.sourceWidth,e=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(t=window.screen.width),window.screen.height)&&(e=window.screen.height),t+"x"+e},_createConvivaClient:function(){var t=this._getConvivaClientSettings();return t?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(t,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var t,e=this.moduleParams;return this._isValidStr(e.customerKey)&&this._isValidStr(e.serviceUrl)?((t=new Conviva.ClientSettings(e.customerKey)).heartbeatInterval=e.heartbeatInterval||this.defaultHeartbeatInterval,t.gatewayUrl=e.serviceUrl,t):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(t){var e="development"===uvpjs.Configuration.env,i=Conviva.SystemSettings.LogLevel;t.allowUncaughtExceptions=e,t.logLevel=e?i.WARNING:i.NONE},_createConvivaSystemFactory:function(){var t=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),e=new Conviva.SystemSettings;return this._setConvivaSystemProps(e),new Conviva.SystemFactory(t,e)},_buildAdPodInfo:function(t){var e,i={};uvpjs.ConvivaAgent.adPositions;return t?(void 0!==t.podDuration&&(i.podDuration=String(t.podDuration)),t.adPodId&&(e=(e=t.adPodId.split("_")[0].toLowerCase()).charAt(0).toUpperCase()+e.slice(1),t=String(t.imaPodIndex+1),i.podPosition=e+"-roll",i.podIndex=this.podCount,i.absoluteIndex=t),i):null},_buildAdInfo:function(t){var e=new Conviva.ContentMetadata,i=t.adData,s=t.imaAdData||{},n=this.cviModel.getSessionOption("partner");if(!t)return null;e.adTitle="("+i.adVideoId+")"+i.adVideoTitle,e.assetName=e.adTitle,e.adClipId=this._validateStr(i.adClipID,"N/A"),e.Partner_ID=this._validateStr(n,"N/A"),e.adServerName=this._validateStr(i.adServerName,"N/A"),e.streamUrl=this._validateStr(i.adAssetUrl,"N/A"),e.duration=i.duration,e.streamType=Conviva.ContentMetadata.StreamType.VOD;t=i.adType;return e.custom={"c3.ad.technology":"Client Side","c3.ad.id":s.adId||i.adVideoId,"c3.ad.system":s.adSystem||i.adServerName,"c3.ad.position":t.charAt(0).toUpperCase()+t.substr(1)+"roll","c3.ad.mediaFileApiFramework":s.apiFramework,"c3.ad.sequence":(s.adPodInfo||i).adPosition,"c3.ad.creativeId":s.creativeId||i.creativeId,"c3.ad.advertiser":s.advertiserName},this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",e),e},_isValidStr:function(t){return uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_isDynamicStreaming:function(t){t=t.split("?");return"mp4"===t[0].substr(t[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var t,e=this.cviModel.getModule(this.moduleName).params,i=e.length,s={};i--;)s[(t=e[i]).name]=t.value;this.moduleParams=s},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onAdEvent.bind(this),s=this._onContentEvent.bind(this),n=this._onVideoEvent.bind(this),r=this._onError.bind(this);e[t.AD_POD_START]=i,e[t.AD_LOADED]=i,e[t.AD_START]=i,e[t.AD_END]=i,e[t.AD_POD_END]=i,e[t.AD_ERROR]=i,e[t.AD_BUFFERING]=i,e[t.CONTENT_DATA_LOADED]=s,e[t.CONTENT_START]=s,e[t.CONTENT_END]=s,e[t.VIDEO_STATE_CHANGE]=n,e[t.VIDEO_TRANSITION_COMPLETE]=n,e[t.VIDEO_DONE]=n,e[t.RESOURCE_END]=n,e[t.PLAYER_START_ERROR]=r,e[t.VIDEO_START_ERROR]=r,e[t.VIDEO_PLAYBACK_ERROR]=r,e[t.CDN_UPDATED]=this._onCdnUpdated.bind(this),e[t.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e),window.addEventListener("beforeunloa)}.bind(this),!1)}}),t.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(e){"use strict";e.NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"",NIELSEN_DEFAULT_APID:"",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},adType:{LINEAR:"1",DYNAMIC:"2"},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",t),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var t,e,i=this.cviModel,s=this._metadata,n=(i.sessionOptions.partner,i.getModule(this._moduleName).params),r=n.length,a={};for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");r--;)""!==(t=n[r]).value&&(a[t.name]=t.value);this._nolggGlobalParams={nsdkv:"TODO",apn:this._playerName,sfcode:a[this.NIELSEN_SFCODE_PARAM_NAME],apid:a[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:a[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},e=i="TODO",s.ci=a.clientid||i,s.c6=a.vcid||e,s.iag_sid=a.iag_sid,s.iag_tfid=a.iag_tfid,s.channelName=a.channelName,s.segB=a.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",a,s)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){t()?this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."):(window.NOLBUNDLE&&"function"==typeof window.NOLBUNDLE.nlsQ?this._gg=window.NOLBUNDLE.nlsQ(this._nolggGlobalParams.apid,"_gg"+(new Date).getTime()):(this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams)),this._setupEventCallbacks())},_notifySDK:function(t,e){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",t,e),this._gg.ggPM(t,e))},_onContentDataLoaded:function(t){var e,i,s,n,r,a,o,l=uvpjs.mediaCapabilities.isMobile(),d=this._metadata;t.payload&&(i=0<(t=t.payload.vidState).chapterStartTimes.length?"lf":"sf",n=t.episodeNumber,r=t.seasonNumber,a=t.seriesTitle,o=t.videoTitle,e=t.duration,s=[o,r,n,i].join("|"),""===r&&(r="0"),""===n&&(n="0"),t.isAffiliateFeed&&(d.tv="true"),!t.isLive&&-1!==e||(e=this.NIELSEN_LIVE_VIDEO_DURATION),d.pc=d.ci+d.c6+d.cmsRefGuid,d.c10="plt,"+(l?"MBL":"DSK"),d.sd=e,d.dur=e,d.cg=a,d.tl=s,d.videotype="content",d.guid=t.cmsRefGuid,d.seriestitle=a,d.episodetitle=o,d.isfullepisode=t.episodeFlag?"y":"n",d.crossId1=t.mediaId,d.iag_pgm=o,d.iag_epi=s,d.iag_pd=location.hostname,d.iag_fp=i,d.iag_cte="na",d.iag_oad="na",d.iag_seg=1,this._metadata.adloadtype=t.isLive?this.adType.LINEAR:this.adType.DYNAMIC,this._isRcoTypeDai()&&(this._metadata.adloadtype=this.adType.DYNAMIC),this._metadata.adModel=this._metadata.adloadtype,this.debug)&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",d)},_onAdStart:function(t){var e,i,s,n,r,a=this.cviModel.getContentVideoState(),t=t.payload;t&&(this._metadata.hasAds=1,this._adDisplayed=!0,r=uvpjs._.clone(this._metadata),e=(i=(t=t.adData).adClipID.split("_"))[0],s=this.cviModel.getNumberOfAdPods(),n="post"===e?s:++i[1],a=["dav0",a.videoTitle,a.seasonNumber,a.episodeNumber].join("-"),s=[s,n,this._numAdsInPod,i[2]].join("_"),n=t.adVatId,i=t.adVideoUrl,""!==n&&(i+="|"+n),r.videotype=e+"roll",r.iag_cte=i,r.iag_pod=s,r.iag_apt="na",r.tl=a,r.c3="st,a","pre"===e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",r),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,r))},_onAdPodStart:function(t){t=t.payload;t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",t.adPod.adCount),this._numAdsInPod=t.adPod.adCount)},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(t){var e=t.payload;this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),e&&(this._metadata.iag_seg&&this._metadata.iag_seg++,0<(e=t.payload.contentData).duration&&Math.abs(e.duration-this._lastContentSecond)<=5?this._notifySDK(this.events.END,this._lastContentSecond):this._notifySDK(this.events.STOP,this._lastContentSecond))},_onControlPlay:function(t){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(t){var e,t=t.payload;if(t&&!((e=Math.floor(t.currentTime))<0)){if(t.isAd){if(this._lastAdSecond===e)return;this._lastAdSecond=e}else{if(this._lastContentSecond===e)return;this._lastContentSecond=e}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,e)}},_onVideoCuepoint:function(t){var t=t.payload,e=t.data;t.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&e&&"string"==typeof e&&this._notifySDK(this.events.SEND_ID3,e)},_hasAds:function(){var t=this.cviModel.getNumberOfAdPods();return-1===t?2:0===t?0:1},_isDisabled:function(){var t=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===t||!0===t},_isRcoTypeDai:function(){var t=this.cviModel.cviMgr.RPM.currRP;return!(null==t)&&t.rco.type===e.mediaCapabilities.RP_DAI}});varB}}(uvpjs.register("uvpjs")),w=uvpjs.register("uvpjs"),O=w._,w.DWAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"",DW_MODULE_NAME:"DWTracking",BASE_URL:"",RESUME_BEACON_URL:"",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),t.componentid=this.trackingMgr.componentid,t.device=this._getDevice(),t.mapp=this._playerName,t.part=this.cviModel.getSessionOption("partner"),t.playertime=0,t.siteid=this.trackingMgr.DEFAULT_SITEID,t.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var t=this.cviModel,e=t.getSessionOption("cms"),i=t.getContentVideoState(),s=t.getCurrentPlaybackState(),n=uvpjs.mediaCapabilities,r=this._tags.content,a=this._tags.ad,o=this.trackingMgr;a.adastid=e===o.PLATFORM_CMS?"43":"0",(uvpjs.util.isEmpty(r.medastid)||0===r.medastid||"0"===r.medastid)&&(i.isLive?i.isAffiliateFeed?r.medastid="cbsnews"===t.getSessionOption("playerId")?"601":"600":s.isHDStreamLive||n.isChromecast()?r.medastid="601":r.medastid="0":r.medastid=e===o.PLATFORM_CMS?"595":"0",this.debug)&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",r.medastid,a.adastid)},_loadConfigParams:function(){for(var t,e,i,s=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),n=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],r=n.length;r--;)t=this._getTagType(e=n[r]),i=s(e),O.isUndefined(t)||O.isEmpty(i)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",e,i),this._tags[t][e]=i);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var t,e,i,s=window.DW&&window.DW.pageParams||{};for(t in this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams"),s)s.hasOwnProperty(t)&&(i=s[t],O.isEmpty(i)||(this._pageParams[t]=i,e=this._getTagType(t),O.isUndefined(e))||(this._tags[e][t]=i));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_BLOCKED]=this._onAdBlocked.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.AD_ERROR]=this._onAdError.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.USER_GESTURE]=this._onUserGesture.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(e),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var t=this.trackingMgr.progressEvents,e={};e[t.FIRST_QUARTILE]=this._onProgressEvent.bind(this,t.FIRST_QUARTILE),e[t.MID_QUARTILE]=this._onProgressEvent.bind(this,t.MID_QUARTILE),e[t.THIRD_QUARTILE]=this._onProgressEvent.bind(this,t.THIRD_QUARTILE),e[t.TIMED]=this._onProgressEvent.bind(this,t.TIMED),this.trackingMgr.registerProgressEvents(e)},_sendDWEvent:function(t){var e=this._tags.content,i=e.event,s=i===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),e.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:mt(this._gestval),i!==this.events.INIT&&(e.playertime=this._getPlayerTime()),e.ts=+new Date,s+=_t(e),t&&(s+="&"+_t(this._tags.ad)),this.trackingMgr.fireTrackingPixel(s),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",s),this._gestval={},e.gestval="",e.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var t=window.location,e=uvpjs.mediaCapabilities,i=e.isMobile()?"mobile%20web":"desktop%20web",s=this.cviModel.getSessionOption("userStatus"),n=this.cviModel.getSessionOption("userId"),r=this._tags.content,a=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,r.event=this.events.INIT,r.mso=this.trackingMgr.mso,r.pageurl=t.href,r.srchost=t.host,r.ursuid=n,r.v16=a.viewguid,r.v17=a.topic,r.v18=a.topicbrcrm,r.v19=a.pagetype,r.v20=a.assetguid,r.v21=e.isChromecast()?"chromecast":i,r.v23=a.rsid,r.v25=O.isEmpty(s)?"anon":s,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(t){var e=this.trackingMgr.progressEvents,i=this._tags.content,s=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",t),t)switch(t){case e.FIRST_QUARTILE:s.pct=25;break;case e.MID_QUARTILE:s.pct=50;break;case e.THIRD_QUARTILE:s.pct=75}i.event=this.events.PLAY,this._sendDWEvent(),delete s.pct}},_onAdBlocked:function(t){this._tags.ad;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(t){var e=this._tags.ad,i=t.payload.adData,s=i.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),e.adid=O.isEmpty(i.adVideoId)?"999":i.adVideoId,e.adnum=this.cviModel.adNum,e.adtime=0,e.adtitle=i.adVideoTitle,e.adtype=i.isLinear?1:2,e.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),e.adbreak="",e.adpos=s[0],e.adpod=s[1],e.adpodpos=s[2],this._sendDWEvent(!0)},_onAdQuartile:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",t),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(t){var e=t.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",t),this._tags.content.event=this.events.END,this._tags.ad.adtime=e.duration,this._sendDWEvent(!0)},_onAdError:function(t){var e=t.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",t),e===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(t){var e=this.cviModel,i=e.getContentVideoState(),s=this._tags.content,n=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",t),s.event=this.events.START,s.codec=i.fileType,s.distntwrk=e.getSessionOption("netwk"),s.playersz=this._getPlayerSize(),s.sdlvrytype=this._getStreamType(),s.v22=i.cmsRefGuid,s.medid=i.mediaId,s.medlength=this.trackingMgr.getContentLength()/1e3,s.mednum=e.medNum,s.medrls=i.pid,s.medtitle=i.videoTitle,s.contsessid=i.previousSessionId,O.isEmpty(i.contPlayState)||(n.autoplay=i.contPlayState),n.paywall=i.isPaidContent?"1":"0",n.caption_available=i.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",t),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(t),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(t.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),t.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(t){var t=t&&t.payload,e=t&&t.seekFromTime,t=t&&t.seekToTime,i=t-e,s=this._tags.content;s.eventdur=Math.floor(Math.abs(i)),s.event=0<i?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:e,seekToTime:t,seekDuration:i,event:s.event,eventdur:s.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(t){var e,i,s,n,r=this._tags.content,a=this._gestval,o=t.payload.gestureInfo,l=this.cviModel.contentVideoState.elapsedTime,d="",u=uvpjs.Type.Gesture;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",t),"string"==typeof o&&-1===o.indexOf("event="))uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.");else{if(O.isArray(o)){if(o.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");d=o[0]}if(t=this.cviModel.contentVideoState,"string"==typeof o)s=(n=/event=([^&]*)(?:&gestval=(.*))?/.exec(o))[1],n=n[2],r.event=s,r.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===n?"":n;else if(d===u.GLOBAL_RESUME||d===u.LOCAL_RESUME)a.prevcomponentid=t.previousSessionId,a.eventdur=0<l?Math.round(l/1e3):0,a.paywall=t.isPaidContent?"1":"0",r.event=this.events.RESUME,r.medtime=t.resumeContentTime;else if(d===u.CONT_CANCEL)a.action=this.events.PROMPT;else switch(r.medtime=this.cviModel.contentPlaybackState.currentTime,d){case u.RELATED_OVERLAY:r.event=u.RELATED_OVERLAY;break;case u.RELATED_CLICK_GESTURE:2<=o.length&&(a.related_pid=o[1]),r.event=u.RELATED_CLICK_GESTURE;break;case u.SHARE_OVERLAY:r.event=u.SHARE_OVERLAY;break;case u.SHARE_NETWORK_GESTURE:2<=o.length&&(a.network=o[1]),r.event=u.SHARE_NETWORK_GESTURE;break;case u.SEND_GESTURE:2<=o.length&&(e=(i=o[1].split(",")).shift(),i=i.join(","),a.sender=e,a.recipient=i),r.event=u.SEND_GESTURE;break;case u.EMBED_GESTURE:r.event=u.EMBED_GESTURE;break;case u.LINK_GESTURE:r.event=u.LINK_GESTURE;break;case u.REPLAY_GESTURE:r.event=u.REPLAY_GESTURE;break;case u.END_CARD_OVERLAY:r.event=u.END_CARD_OVERLAY;break;case u.ERROR_OVERLAY:r.event=u.ERROR_OVERLAY;break;case u.RECOMMEND_NOW:3<=o.length?(a.mediaid=o[1],a.pid=o[2]):(a.mediaid="",a.pid=""),r.event=u.RECOMMEND_NOW;break;case u.RECOMMEND_NEXT:3<=o.length?(a.mediaid=o[1],a.pid=o[2]):(a.mediaid="",a.pid=""),r.event=u.RECOMMEND_NEXT;break;case u.RECOMMEND_CLOSE:r.event=u.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",d)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",r),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",a)),this._sendDWEvent()}},_updateTimeTa)},_getTagType:function(t){return O.has(this._tags.ad,t)?"ad":O.has(this._tags.content,t)?"content":void 0},_getStreamType:function(){var t=this.cviModel.getContentVideoState(),e=uvpjs.mediaCapabilities,i=t.deliveryType,t=t.isLive;return i===e.STREAMING?t?5:4:i===e.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var t=this._agentStartTime,t=O.isDate(t)&&parseInt((new Date-t)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",t),t},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsO}},_getDevice:function(){var t=uvpjs.mediaCapabilities,e=window.screen,t={type:(t.getDevice()||"").toLowerCase(),os:(t.getOS()||"").toLowerCase(),ver:t.getOSVersion(),screensz:[e.width,e.height].join("x")};return mt(t)},_getPlayerSize:function(){var t=this.cviModel.getContentVideoState();return[t.sourceWidth,t.sourceHeight].join("x")}}),Et=function(t,e,i){var s,n,r=[];for(s in t)t.hasOwnProperty(s)&&(n=O.isUndefined(t[s])?"":encodeURIComponent(t[s]),r.push([s,n].join(e)));return r.join(i)},_t=function(t){return Et(t,"=","&")},)};var w=uvpjs.register("uvpjs");function Ht(t){return-1<(t=t.replace(/\s/g,"")).search(/^\/\//)?t:"//"+t}w._,w.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,CONFIG_FILE_PATH:"",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this.buffering=!1,this.akamaiPlugin=null},destrl},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){var t={};this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),At()?this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."):(t.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,t.streamHeadPosition=this.getStreamHeadPosition.bind(this),t.streamLength=this.getStreamLength.bind(this),t.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(t),this._setupEventCallbacks())},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var t=this.cviModel.adVideoState,e={};e.adTitle=t.adVideoTitle,e.adDuration=t.duration,e.id=t.adVideoId,e.adPartnerId=this.cviModel.sessionOptions.partner,e.adServer=t.adServerName,this.akamaiPlugin.handleAdLoaded(e)},setContentMetaData:function(){var t=this.cviModel,e=t.sessionOptions,i=this.akamaiPlugin,s=t.getContentVideoState(),n=t.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),i.setData("viewerId",t.getModuleParam(this._moduleName,"viewerID")),i.setData("partnerId",e.partner),i.setData("playerId",this.trackingMgr.getPlayerName("|")),i.setData("Host",e.host),i.setData("Referrer",e.referrer),i.setData("title",s.title),i.setData("category",s.category),i.setData("subCategory",s.sourceOwner),i.setData("show",s.title),i.setData("contentLength",1e3*n.duration)},getStreamHeadPositie},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",t),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",t.payload),this.akamaiPlugin&&t.payload)switch(t.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentE)},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",t),this.akamaiPlugin&&((t=t.payload.newState)!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),t===uvpjs.mediaCapabilities.PLAYING)&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())},_onResourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",t),this.akamaiPlugin&&this.akamaiPlugin.handlePlayEnd("Play.End.Detected")},_onQosMetadata:function(t){var e,i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",t),this.akamaiPlugin&&-1!==t.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI))for(e in i=t.payload.paramsObj)this.akamaiPlugin.setData(e,i[e])}}),s},function(t){"use strict";var i=t._;t.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"",init:function(t){this.cviModel=t.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",t),this.trackingMgr=t.trackingMgr,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.playerVersion=t.playerVersion,this.useDefaultProperty=t.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){var t;return this.cviModel?!!(t=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME))&&!0===t[uvpjs.DebugManager.configParams.MUX_DEBUG]:uvpjs.debug},_initializePlugin:function(){console.log("[MUX] _initializePlugin"),void 0===window.mux?this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded."):this.cviModel&&this._setupEventCallbacks()},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var t=this.cviModel,e=this.moduleParams,t=i.assign({page_type:"",viewer_user_id:t.getSessionOption("userId"),experiment_name:e&&!uvpjs.util.isEmpty(e.experimentName)?e.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||uvpjs.util.isEmpty(e.subPropertyId)?t.getSessionOption("partner"):e.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:t.initTime},this._getMuxVideoData());return this.useDefaultProperty?t.property_key=this.MUX_DEFAULT_PROPERTY_KEY:t.property_key=e.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:t}),this.videoElement.mux},_getMuxVideoData:function(){var t=this.cviModel.contentVideoState;return{video_id:this._validateStr(t.cmsRefGuid,""),video_title:this._validateStr(t.videoTitle,""),video_series:this._validateStr(t.seriesTitle,""),video_producer:"",video_content_type:t.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:t.duration,video_stream_type:t.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(t.cdn,""),video_source_url:this._validateStr(t.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidS)},_validateSe},_onContentEvent:function(t){t.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(t){if(this.muxMonitor)switch(t.payload.facadeType){case this.mc.HLSJS:this.muxHLSJSMonitoring||(this.muxHLSJSMonitoring=!0,this.muxMonitor.addHLSJS({hlsjs:t.payload.player,Hls:window.Hls}));break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:t.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(t){t=t.payload.errorInfo;t&&t.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:t.errorCode,player_error_message:t.message}))},_gatherModuleParams:function(t){var e,i=this.cviModel.getModule(t).params,s={};if(!i)return null;for(var n=i.length;n--;)s[(e=i[n]).name]=e.value;return s},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onContentEvent.bind(this),s=this._onPlaybackLibraryLoaded.bind(this),n=this._onError.bind(this),r=this._onAdEvent.bind(this);e[t.CONTENT_DATA_LOADED]=i,e[t.PLAYBACK_LIBRARY_LOADED]=s,e[t.PLAYER_START_ERROR]=n,e[t.VIDEO_START_ERROR]=n,e[t.VIDEO_PLAYBACK_ERROR]=n,e[t.AD_ERROR]=n,e[t.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=r,e[t.AD_PLUGIN_CONTENT_RESUME_REQUEST]=r,e[t.AD_LOADED]=r,e[t.AD_START]=r,e[t.VIDEO_STATE_CHANGE]=r,e[t.AD_SKIPPED]=r,e[t.AD_END]=r,e[t.AD_ERROR]=r,e[t.AD_REQUEST]=r,e[t.AD_RESPONSE]=r,e[t.AD_QUARTILE]=r,this.trackingMgr.registerEventCallbacks(e)},_getMuxAdData:function(t){var e=(t.payload.adData||t.payload).adAssetUrl;return{ad_tag_url:t.payload.adCallUrl,ad_asset_url:e}},_dispatchMuxAdEvent:function(t,e){t&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),(e=e||{ad_tag_url:"",ad_asset_url:""}).ad_tag_url||(e.ad_tag_url=""),e.ad_asset_url||(e.ad_asset_url=""),window.mux.emit(this.videoElement,t,e))},_dispatchMuxEve)},_onAdEvent:function(t){var e,i,s=this.eventTypes,n=this.MUX_AD_EVENTS,r=this.MUX_EVENTS;switch(t.type){case s.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(r.PAUSE),this._dispatchMuxAdEvent(n.AD_BREAK_START);break;case s.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(n.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(r.PLAY),this._dispatchMuxEvent(r.PLAYING));break;case s.AD_LOADED:this._dispatchMuxAdEvent(n.AD_PLAY,this._getMuxAdData(t));break;case s.AD_START:this._dispatchMuxAdEvent(n.AD_PLAYING,this._getMuxAdData(t));break;case s.VIDEO_STATE_CHANGE:t.payload.isAd&&(e=t.payload.newState,i=t.payload.currentState,e===this.mc.PAUSED?this._dispatchMuxAdEvent(n.AD_PAUSE,this._getMuxAdData(t)):i==this.mc.PAUSED&&e===this.mc.PLAYING&&(this._dispatchMuxAdEvent(n.AD_PLAY,this._getMuxAdData(t)),this._dispatchMuxAdEvent(n.AD_PLAYING,this._getMuxAdData(t))));break;case s.AD_SKIPPED:case s.AD_END:this._dispatchMuxAdEvent(n.AD_ENDED,this._getMuxAdData(t));break;case s.AD_ERROR:this._dispatchMuxAdEvent(n.AD_ERROR,this._getMuxAdData(t));break;case s.AD_REQUEST:this._dispatchMuxAdEvent(n.AD_REQUEST,this._getMuxAdData(t));break;case s.AD_RESPONSE:this._dispatchMuxAdEvent(n.AD_RESPONSE,this._getMuxAdData(t));break;case s.AD_QUARTILE:switch(t.payload.percent){case 25:this._dispatchMuxAdEvent(n.AD_FIRST_QUARTILE,this._getMuxAdData(t));break;case 50:this._dispatchMuxAdEvent(n.AD_MIDPOINT,this._getMuxAdData(t));break;case 75:this._dispatchMuxAdEvent(n.AD_THIRD_QUARTILE,this._getMuxAdData(t))}}}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").OzTamAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isStopped:!1,resumeTime:-1,init:function(t){this.options=t,this.ozTamVo=new uvpjs.OzTamVo(this);t=this.ozTamVo.getConfig();this.ozTamService=new OzTAMService(t.publisherId,t.vendorVersion,t.productionMode,t.verboseLogging,t.useHTTPS),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService",t,this.ozTamService)},initialize:function(){var t=this.options.eventsMgr.eventTypes,e=this.onVideoEvent.bind(this),i={};i[t.RESOURCE_START]=e,i[t.CONTENT_START]=e,i[t.CONTROL_SEEK]=e,i[t.SEEK_DONE]=e,i[t.CONTENT_END]=e,i[t.VIDEO_STATE_CHANGE]=e,i[t.VIDEO_PROGRESS]=e,i[t.USER_GESTURE]=e,this.options.trackingMgr.registerEventCallbacks(i)},onVideoEvent:function(t){var e=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out");else switch(t.type){case e.RESOURCE_START:this.onResourceStart(t);break;case e.CONTENT_START:this.onContentStart(t);break;case e.CONTROL_SEEK:this.onSeekStart(t);break;case e.SEEK_DONE:this.onSeekDone(t);break;case e.CONTENT_END:this.onContentEnd(t);break;case e.VIDEO_STATE_CHANGE:this.onVideoStateChange(t);break;case e.VIDEO_PROGRESS:this.onVideoProgress(t);break;case e.USER_GESTURE:this.onUserGesture(t)}},onResourceStart:function(t){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(t){this.ozTamService.seekBegin()},onSeekDo0},onContentE)},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:case uvpjs.mediaCapabilities.BUFFERING:this.isStopped||(this.isStopped=!0,this.ozTamService.haltProgress())}},onVideoProgre)},onUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"startTime",t.payload.startTime),0<t.payload.startTime&&(this.resumeTime=t.payload.startTime)},destrl}}),uvpjs.register("uvpjs").DatazoomAgent=uvpjs.TrackingAgent.subClass({metadata:{},init:function(t){this._super(t),this.vo=new uvpjs.DatazoomVo(this),this.sdkEvent=this.vo.Event,this.metadata={},(new uvpjs.CodeLoader).loadScript(this.vo.sdkUrl,this.onSdkReady.bind(this))},onSdkReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent SDK Ready"),this.hasSdk="function"==typeof window.setDatazoomMetadata},sendTrackEvent:function(t,e){if(this.hasSdk){for(var i in this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent "+t),e=e||{})this.metadata[i]=e[i];switch(t){case"content_start":window.setDatazoomMetadata(this.format(this.metadata));break;case"cdn_updated":window.generateDatazoomEvent("CDNChange",this.format(e));break;case"content_complete":this.metadata={}}}},format:function(t){var e,i,s=[];for(e in t)t.hasOwnProperty(e)&&t[e]&&"object"!=typeof t[e]&&((i={})[e]=t[e],s.push(i));return this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent",s),s}}),uvpjs.register("uvpjs").DataModelVo=uvpjs.Class.subClass({agent:null,channelName:null,apiKey:null,contentInfo:{},getApiKey:function(){return this.apiKey},getPersistentData:function(t){var e,i=this.agent.options.cviModel,s=i&&i.getContentVideoState(),n=this.agent.contextMetadata;for(e in(t=t||{}).sessionId=i&&i.sessionId,t.contentAssetId=s&&(s.cmsRefGuid||s.mediaId)||"",t.playheadTime=t.playheadTime||this.getPlayhead(),t.playerTime=this.getPlayerElapsedTime(),n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t},getSessionStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,i=e.isLive?-1:isNaN(i)?0:i,n=this.getDrmInfo(e.drm);return this.getPersistentData({adAssetId:t.adVideoState.adClipID,adPodId:t.adVideoState.adVideoId||t.adVideoState.adVatId,adType:t.adVideoState.adType,allowConcurrentPlayback:t.sessionOptions.allowConcurrentPlayback,bitrate:s.currentBitrate,channel:this.channelName,cdn:e.cdn,cms:t.sessionOptions.cms,currentIndex:1,"drm.dash.playreadyURL":n.playreadyURL,"drm.dash.widevineURL":n.widevineURL,"drm.enabled":n.enabled,"drm.fairplay.appCertURL":n.appCertURL,"drm.ticket":n.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(e.drm),enableMutedAutoplay:t.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:t.sessionOptions.enableNativeMobileAutoplay,enableReplay:t.sessionOptions.enableReplay,enableUnmutedAutoplay:t.sessionOptions.enableUnmutedAutoplay,framerate:s.playbackFramerate,fullScreen:t.isFullscreen,isAutoplay:t.isAutoplay,isMultiCDN:t.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:t.isMuteAtPlayStart,isMuted:e.isMuted,isSslRequired:-1<window.location.href.search(/^https/),length:i,livestream:e.isLive,liveSyncDurationCount:t.sessionOptions.liveSyncDurationCount,maxBitrate:t.maxBitrate,method:"",minBitrate:t.minBitrate,pageProvidesTealium:t.sessionOptions.usesTealium,pagetype:t.dwPageParams.pagetype,partner:t.sessionOptions.partner,pguid:t.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sound:t.volume,startTime:e.startTime,streamType:e.isLive?"Live":"VOD",title:e.videoTitle,totalLength:i,usesIMA:t.sessionOptions.usesIMA,userConnectionType:t.sessionOptions.userConnectionType,userCountry:t.sessionOptions.userCountry,userIsp:t.sessionOptions.userISP,userPpid:t.sessionOptions.userPPID,userStatus:t.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName})},getContentStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,i=e.isLive?-1:isNaN(i)?0:i;return this.contentInfo={assetUrl:e.assetURL,assetId:e.cmsRefGuid||e.mediaId,category:e.category,channel:this.channelName,chapterStartTimes:e.chapterStartTimes.join(","),closedCaptionPath:e.closedCaptionPath,cms:t.sessionOptions.cms,cmsRefGuid:e.cmsRefGuid,dfpMediaId:e.dfpMediaId,duration:i,episodeAbstract:e.episodeAbstract,episodeFlag:e.episodeFlag,episode:e.episodeNumber,excludeNielsenTracking:e.excludeNielsenTracking,fileType:e.fileType,genre:e.category,indexPosition:t.contentPlaybackState.currentContentSegment,is360:e.is360,isAffiliateFeed:e.isAffiliateFeed,isEmbedable:e.isEmbedable,isPaidContent:e.isPaidContent,mediaId:e.mediaId,overrideAssetURL:e.overrideAssetURL,program:e.videoTitle.split("-")[0],pguid:t.dwPageParams.pguid,playbackBitrate:s.currentBitrate,playheadTime:this.getContentStartPlayhead(),season:e.seasonNumber,seriesTitle:e.seriesTitle,showPreroll:e.showPreroll,startTime:e.startTime,useWatermark:e.useWatermark,title:e.videoTitle,totalLength:i},this.getPersistentData(this.contentInfo)},getContentCompleteInfo:function(){var t=this.agent.options.cviModel;return this.contentInfo.playbackBitrate=t.contentPlaybackState.facadeState.currentBitrate,this.getPersistentData(this.contentInfo)},getQuartileInfo:function(){this.agent.options.cviModel.getContentVideoState();return this.getPersistentData()},getQosInfo:function(){var t=this.agent.options.cviModel,e=t.contentPlaybackState,t=t.contentPlaybackState.facadeState;return this.getPersistentData({averageDroppedFPS:e.averageDroppedFPS,bufferLength:e.bufferLength,currentContentSegment:e.currentContentSegment,currentMaxBandwidth:e.currentMaxBandwidth,currentTime:this.getPlayhead(),currentBitrate:t.currentBitrate,droppedFPS:t.droppedFPS,droppedFrames:t.droppedFrames,playbackFramerate:t.playbackFramerate})},getAdBreakInfo:function(){var t=this.agent.options.cviModel,e=t.adVideoState,i=e.adClipID.split("_"),s=1;return"post"===e.adType?s=t.getNumberOfAdPods():"mid"===e.adType&&(s=parseInt(i[1])+1),this.getPersistentData({indexPosition:s,startTime:this.getPlayhead(),title:e.adVideoTitle})},getAdItemInfo:function(){var t=this.agent.options.cviModel.adVideoState;return this.getPersistentData({adCallUrl:t.assetURL||t.adAssetUrl||t.adVideoUrl,adParams:t.adParameters,assetId:t.adVideoId||t.adVatId,indexPosition:t.adPosition,isCustomClickTrackingUsed:t.isCustomClickTrackingUsed,title:t.adVideoTitle,totalLength:t.duration})},getSeekIn)},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getContentStartPlayhead:function(){var t=this.getPlayhead();return this.agent.options.resumeTime&&0<this.agent.options.resumeTime&&(t=this.agent.options.resumeTime,this.agent.options.resumeTime=-1),t},getPlayerElapsedTime:function(){return parseInt((new Date-this.agent.initTime)/1e3)},getDrmInfo:function(t){return{playreadyURL:t.dash&&t.dash.playreadyURL?t.dash.playreadyURL:"",widevineURL:t.dash&&t.dash.widevineURL?t.dash.widevineURL:"",appCertURL:t.fairplay&&t.fairplay.appCertURL?t.fairplay.appCertURL:"",enabled:t.enabled||!1,ticket:t.ticket||""}},isCompletedMarker:function(){var t=this.agent.options.cviModel.getContentVideoState();return!t.isLive&&this.getPlayhead()>=.95*t.duration},destrl}}),uvpjs.register("uvpjs").DatazoomVo=uvpjs.DataModelVo.subClass({Event:{SESSION_START:"session_start",CONTENT_START:"content_start",CONTENT_COMPLETE:"content_complete",CDN_UPDATED:"cdn_updated",PAUSE:"pause",STOP:"stop",BUFFER_START:"buffer_start",BUFFER_COMPLETE:"buffer_complete",SEEK_START:"seek_start",SEEK_COMPLETE:"seek_complete",PLAY_RESUME:"resume",SESSION_END:"session_end",AD_BREAK_START:"ad_break_start",AD_BREAK_COMPLETE:"ad_break_end",AD_START:"ad_start",AD_COMPLETE:"ad_end",AD_CLICK:"ad_click",QOS:"qos",FIRST_QUARTILE:"first_quartile",MID_QUARTILE:"mid_quartile",THIRD_QUARTILE:"third_quartile"},sdkUrl:"//platform.datazoom.io/beacon/v1/config?configuration_id=",init:function(t){this.agent=t;t=this.agent.options;this.getModuleParam=t.cviModel.getModuleParam.bind(t.cviModel,t.trackingMgr.DATAZOOM_MODULE_NAME),this.sdkUrl+=this.getModuleParam("configId")}}),uvpjs.register("uvpjs").OzTamVo=uvpjs.Class.subClass({agent:null,init:function(t){this.agent=t;t=this.agent.options;this.getModuleParam=t.cviModel.getModuleParam.bind(t.cviModel,t.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.getVendorVersion(),productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:-1<top.location.href.search(/^https/)}},getVendorVersion:function(){return[this.getModuleParam("platform"),uvpjs.mediaCapabilities.isMobile()?"Mobile-Web":"Desktop-Web",this.agent.options.playerVersion].join("_")},getMediaInfo:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=t.duration,s=function(){var t=e.getCurrentPlaybackState().currentTime;return 0<this.agent.resumeTime&&(t=this.agent.resumeTime,this.agent.resumeTime=-1),t}.bind(this);return{mediaId:t.ozTamMediaId||t.cmsRefGuid||t.mediaId,url:t.assetURL,mediaDuration:t.isLive?-1:isNaN(i)?0:i,mediaType:t.isLive?"live":"vod",mediaPositionFuncti)}}},getPropertyDictionary:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),t=t.getSessionOption("userId"),i=this.agent.ozTamService,s={};return e.ozTamMediaId&&(s[i.PROP_ALT_MEDIA_ID]=e.cmsRefGuid||e.mediaId),t&&(s[i.PROP_DEMO1]=t),s},isOzTamOptOut:function(){var t=this.agent.options.cviModel.getContentVideoState();return t.hasOwnProperty("ozTamOptOut")&&t.ozTamOptOut},getValue:function(t){return t.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}}),St=uvpjs.register("uvpjs"),yt=!(Tt={prodUrl:"",stageUrl:"",path:""}),N=k=null,St.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(t){return N=Tt,t&&t.prodUrl&&t.stageUrl&&(N.prodUrl=Ht(t.prodUrl),N.stageUrl=Ht(t.stageUrl)),this},queryParams:function(t){return k=St.util.queryStrFromObj(t,!1),this},devMos},buildUrl:function(){return null===N?"Unable to build url.":(yt?N.stageUrl:N.prodUrl)+N.path+(null===k?"":"?"+k)}}),w=uvpjs.register("uvpjs"),U=w._,w.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=t.drm,this.videoTagRef=t.videoTagRef,this.eventTypes=t.eventTypes,this.errorCallback=t.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destrl},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var t=this.getLicenseServerUrl(this.initData),e=this.getId(t);if(this.drmVendor=this.getDRMVendor(t),e){if(!this.videoTagRef.webkitKeys){var i=this.KEY_SYSTEMS.FPS_1_0;if(!WebKitMediaKeys.isTypeSupported(i,"video/mp4"))return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(i))}this.videoTagRef.webkitKeys?(i=this.concatInitDataIdAndCertificate(this.initData,e,this.appCertData),(i=this.videoTagRef.webkitKeys.createSession("video/mp4",i))?(i.contentId=e,i.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,t),!1),i.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),i.addEventListener("webkitkeyerror",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)):this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null)):this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null)}else this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null)},loadAppCert:function(){U.isEmpty(this.drm.fairplay.appCertURL)||(new uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",t),this.appCertData=new Uint8Array(t.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(t){this.webKitNeedKeyCalled=!0,this.initData=t.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(t,e,i){"string"==typeof e&&(e=this.stringToArray(e));var s=0,n=new ArrayBuffer(t.byteLength+4+e.byteLength+4+i.byteLength),r=new DataView(n),t=(new Uint8Array(n,0,t.byteLength).set(t),s+=t.byteLength,r.setUint32(s,e.byteLength,!0),s+=4,new Uint8Array(n,s,e.byteLength));return t.set(e),s+=t.byteLength,r.setUint32(s,i.byteLength,!0),s+=4,new Uint8Array(n,s,i.byteLength).set(i),new Uint8Array(n,0,n.byteLength)},onLicenseRequestReady:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+t,e);var i=new XMLHttpRequest;i.session=e.target,i.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),i.addEventListener("error",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),i.open("POST",t,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?i.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(i.responseType="text");t="spc="+encodeURIComponent(this.base64EncodeUint8Array(e.message))+"&"+i.session.contentId;(i=this.setRequestHeaders(i)).send(t)},onLicenseRequestLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",t);var e=t.target,i=e.session,s=null;U.inRange(e.status,200,400)||this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,t),this.drmVendor===this.DRM_VENDORS.DRMTODAY?s=this.base64DecodeUint8Array(e.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(s=new Uint8Array(e.response)),i.update(s)},onError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t,e),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,t)},onKeyAdd)},getLicenseServerUrl:function(t){var e=null;return e=U.isEmpty(this.drm.fairplay.licenseURL)?"https://"+String.fromCharCode.apply(null,new Uint16Array(t.buffer)).split("://")[1]:this.drm.fairplay.licenseURL,this.appendDRMQueryParams(e)},appendDRMQueryParams:function(t){var e=-1===t.indexOf("?")?"?":"&";return this.drm.sessionId&&(t+=e+"SessionId="+this.drm.sessionId),this.drm.ticket&&(t+="&Ticket="+this.drm.ticket),t},getDRMVendor:function(t){var e=null;return-1!==t.indexOf(this.DRM_VENDORS.DRMTODAY)?e=this.DRM_VENDORS.DRMTODAY:-1!==t.indexOf(this.DRM_VENDORS.IRDETO)&&(e=this.DRM_VENDORS.IRDETO),e},setRequestHeaders:function(t){if(t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!U.isEmpty(this.drm.fairplay.header)){var e,i=this.drm.fairplay.header;for(e in i)t.setRequestHeader(e,i[e])}return t},getId:function(t){t=uvpjs.util.objFromQueryStr(t);return t.ContentId||t.contentId||t.assetId||null},base64EncodeUint8Array:function(t){t=String.fromCharCode.apply(null,t);return btoa(t)},base64DecodeUint8Arrn},stringToArri}})}();
})();