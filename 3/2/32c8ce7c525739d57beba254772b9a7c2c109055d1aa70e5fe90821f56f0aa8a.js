!function(){"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};ar underscore={exports:{}};!function(e,t){(function(){var n=this,r=n._,i=Array.prototype,o=Object.prototype,a=Function.prototype,s=i.push,c=i.slice,u=o.toString,l=o.hasOwnProperty,d=Array.isArray,f=Object.keys,h=a.bind,p=Object.create,m=function(){},g=e.exports&&(t=e.exports=g),t._=g,g.VERSION="1.8.3";var v=_=g.iteratee=var y=function(e,t){return function(n){var r=arguments,i=arguments.length;if(i<2||null==n)return n;for(var o=1;o<i;o++)for(var a=r[o],s=e(a),c=s.length,u=0;u<c;u++){var l=s[u];t&&void 0!==n[l]||(n[l]=a[l])}return n}},b=S=w=Math.pow(2,53)-1,I=S("length"),C=.each=g.forEach=g.map=g.collect=g.reduce=g.foldl=g.inject=E(1),g.reduceRight=g.foldr=E(-1),g.find=g.detect=g.filter=g.select=g.reject=g.every=g.all=g.some=g.any=g.contains=g.includes=g.include=g.invoke=g.pluck=function(e,t){return g.map(e,g.property(t))},g.where=function(e,t){return g.filter(e,g.matcher(t))},g.findWhere=g.max=g.min=g.shuffle=g.sample=g.sortBy=var P=g.groupBy=P((),g.indexBy=P((),g.countBy=P((),g.toArray=g.size=g.partition=g.first=g.head=g.take=g.initial=g.last=g.rest=g.tail=g.drop=g.compact=var k=flatten=g.without=g.uniq=g.unique=g.union=g.intersection=function(e){for(var t=arguments,n=[],r=arguments.length,i=0,o=I(e);i<o;i++){var a=e[i];if(!g.contains(n,a)){for(var s=1;s<r&&g.contains(t[s],a);s++);s===r&&n.push(a)}}return n},g.difference=g.zip=function(){return g.unzip(arguments)},g.unzip=g.object=g.findIndex=x(1),g.findLastIndex=x(-1),g.sortedIndex=g.indexOf=O(1,g.findIndex,g.sortedIndex),g.lastIndexOf=O(-1,g.findLastIndex),g.range=var T=g.bind=g.partial=function(e){var t=c.call(arguments,1),n=return n},g.bindAll=function(e){var t,n,r=arguments,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(t=1;t<i;t++)e[n=r[t]]=g.bind(e[n],e);return e},g.memoize=g.delay=g.defer=g.partial(g.delay,g,1),g.throttle=g.debounce=g.wrap=function(e,t){return g.partial(t,e)},g.negate=g.compose=g.after=g.before=g.once=g.partial(g.before,2);var R=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];.keys=g.allKeys=g.values=g.mapObject=g.pairs=g.invert=g.functions=g.methods=g.extend=y(g.allKeys),g.extendOwn=g.assign=y(g.keys),g.findKey=g.pick=g.omit=g.defaults=y(g.allKeys,!0),g.create=g.clone=g.tap=g.isMatch=var M=g.isEqual=g.isEmpty=g.isElement=g.isArray=d||g.isObject=g.each(["Arguments","Function","String","Number","Date","RegExp","Error"],(),g.isArguments(arguments)||(g.isArguments=,"function"!=typeof/./&&"object"!=typeof Int8Array&&(g.isFunction=,g.isFinite=g.isNaN=g.isBoolean=g.isNull=g.isUndefined=g.has=g.noConflict=function(){return n._=r,this},g.identity=function(e){return e},g.constant=g.noop=function(){},g.property=S,g.propertyOf=g.matcher=g.matches=g.times=g.random=g.now=Date.now||var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=g.invert(D),$=g.escape=$(D),g.unescape=$(N),g.result=var B=0;g.uniqueId=g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\u2028|\u2029/g,U=g.template=g.chain=var V=g.mixin=g.mixin(g),g.each(["pop","push","reverse","shift","sort","splice","unshift"],(),g.each(["concat","join","slice"],(),g.prototype.value=function(){return this._wrapped},g.prototype.valueOf=g.prototype.toJSON=g.prototype.value,g.prototype.toString=).call(commonjsGlobal)}(underscore,underscore.exports);var _=underscore.exports,propMap={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};ar doc=document,win=window,docEle=doc.documentElement,createElement=doc.createElement.bind(doc),div=createElement("div"),table=createElement("table"),tbody=createElement("tbody"),tr=createElement("tr"),isArray=Array.isArray,ArrayPrototype=Array.prototype,concat=ArrayPrototype.concat,filter=ArrayPrototype.filter,indexOf=ArrayPrototype.indexOf,map$1=ArrayPrototype.map,push=ArrayPrototype.push,slice=ArrayPrototype.slice,some=ArrayPrototype.some,splice=ArrayPrototype.splice,idRe=/^#(?:[\w-]|\\.|[^\x00-\xa0])*$/,classRe=/^\.(?:[\w-]|\\.|[^\x00-\xa0])*$/,htmlRe=/<.+>/,tagRe=/^\w+$/;ar Cash=function(e,t){if(e){if(isCash(e))return e;var n=e;if(isString(e)){var r=(isCash(t)?t[0]:t)||doc;if(!(n=idRe.test(e)?r.getElementById(e.slice(1)):htmlRe.test(e)?parseHTML(e):find$1(e,r)))return}else if(isFunction(e))return this.ready(e);(n.nodeType||n===win)&&(n=[n]),this.length=n.length;for(var i=0,o=this.length;i<o;i++)this[i]=n[i]}};Cash.prototype.init=var fn=Cash.prototype,cash=fn.init;cash.fn=cash.prototype=fn,fn.length=0,fn.splice=splice,"function"==typeof Symbol&&(fn[Symbol.iterator]=ArrayPrototype[Symbol.iterator]),fn.map=fn.slice=var dashAlphaRe=/-([a-z])/g;ion isElement$1(e){return!!e&&1===e.nodeType}function isBoolean(e){return"boolean"==typeof e}function isFunction(e){return"function"==typeof e}function isString(e){return"string"==typeof e}ion extend(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var n=!!isBoolean(e[0])&&e.shift(),r=e.shift(),i=e.length;if(!r)return{};if(!i)return extend(n,cash,r);for(var o=0;o<i;o++){var a=e[o];for(var s in a)n&&(isArray(a[s])||isPlainObject(a[s]))?(r[s]&&r[s].constructor===a[s].constructor||(r[s]=new a[s].constructor),extend(n,r[s],a[s])):r[s]=a[s]}return r}sh.guid=1,cash.isWindow=isWindow,cash.isFunction=isFunction,cash.isArray=isArray,cash.isNumeric=isNumeric,cash.isPlainObject=isPlainObject,fn.get=fn.eq=fn.first=fn.last=cash.each=each,fn.each=fn.prop=fn.removeProp=cash.extend=extend,fn.extend=function(e){return extend(fn,e)},fn.filter=var splitValuesRe=/\S+/g;Class=fn.removeAttr=fn.attr=attr,fn.toggleClass=fn.addClass=function(e){return this.toggleClass(e,!0)},fn.removeClass=cash.unique=unique,fn.add=var cssVariableRe=/^--/;ar prefixedProps={},style=div.style,vendorsPrefixes=["webkit","moz","ms"];ar numericProps={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};.css=css;var JSONStringRe=/^\s+|\s+$/;ta=data$1,each([!0,!1],(),each(["Width","Height"],();var defaultDisplay={};r displayProperty="___cd";n.toggle=function(e){return this.each((function(t,n){isElement$1(n)&&((isUndefined(e)?isHidden(n):e)?(n.style.display=n[displayProperty]||"",isHidden(n)&&(n.style.display=getDefaultDisplay(n.tagName))):(n[displayProperty]=computeStyle(n,"display"),n.style.display="none"))}))},fn.hide=function(){return this.toggle(!1)},fn.show=var eventsNamespace="___ce",eventsNamespacesSeparator=".",eventsFocus={focus:"focusin",blur:"focusout"},eventsHover={mouseenter:"mouseover",mouseleave:"mouseout"},eventsMouseRe=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;ion on(e,t,n,r,i){var o=this;if(!isString(e)){for(var a in e)this.on(a,t,n,e[a],i);return this}return isString(t)||(isUndefined(t)||isNull(t)?t="":isUndefined(n)?(n=t,t=""):(r=n,n=t,t="")),isFunction(r)||(r=n,n=void 0),r?(each(getSplitValues(e),(function(e,a){var s=parseEventName(a),c=s[0],u=s[1],l=getEventNameBubbling(c),d=c in eventsHover,f=c in eventsFocus;l&&o.each((function(e,o){if(isElement$1(o)||isDocument(o)||isWindow(o)){var a=function(e){if(e.target["___i"+e.type])return e.stopImmediatePropagation();if((!e.namespace||hasNamespaces(u,e.namespace.split(eventsNamespacesSeparator)))&&(t||!(f&&(e.target!==o||e.___ot===l)||d&&e.relatedTarget&&o.contains(e.relatedTarget)))){var s=o;if(t){for(var c=e.target;!matches(c,t);){if(c===o)return;if(!(c=c.parentNode))return}s=c,e.___cd=!0}e.___cd&&Object.defineProperty(e,"currentTarget",{configurable:!0,get:function(){return s}}),Object.defineProperty(e,"data",{configurable:!0,get:function(){return n}});var h=r.call(s,e,e.___td);i&&removeEvent(o,l,u,t,a),!1===h&&(e.preventDefault(),e.stopPropagation())}};a.guid=r.guid=r.guid||cash.guid++,addEvent(o,l,u,t,a)}}))})),this):this}.off=fn.on=on,fn.one=one,fn.ready=fn.trigger=var queryEncodeSpaceRe=/%20/g,queryEncodeCRLFRe=/\r?\n/g;ar skippableRe=/file|reset|submit|button|image/i,checkableRe=/radio|checkbox/i;n.serialize=function(){var e="";return this.each((function(t,n){each(n.elements||[n],(function(t,n){if(!(n.disabled||!n.name||"FIELDSET"===n.tagName||skippableRe.test(n.type)||checkableRe.test(n.type)&&!n.checked)){var r=getValue(n);if(!isUndefined(r))each(isArray(r)?r:[r],()}}))})),e.slice(1)},fn.val=val,fn.clone=fn.detach=var fragmentRe=/^\s*<(\w+)[^>]*>/,singleTagRe=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,containers={"*":div,tr:tbody,td:tr,th:tr,thead:table,tbody:table,tfoot:table};h.parseHTML=parseHTML,fn.empty=fn.html=html,fn.remove=fn.text=text,fn.unwrap=fn.offset=fn.offsetParent=fn.position=fn.children=fn.contents=fn.find=var HTMLCDATARe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,scriptTypeRe=/^$|^module$|\/(java|ecma)script/i,scriptAttributes=["type","src","nonce","noModule"];after=function(){return insertSelectors(arguments,this,!1,!1,!1,!0,!0)},fn.append=fn.appendTo=fn.before=fn.insertAfter=function(e){return insertSelectors(arguments,this,!0,!1,!1,!1,!1,!0)},fn.insertBefore=fn.prepend=fn.prependTo=fn.replaceWith=fn.replaceAll=fn.wrapAll=fn.wrap=fn.wrapInner=fn.has=fn.is=fn.next=function(e,t,n){return filtered(cash(unique(pluck(this,"nextElementSibling",t,n))),e)},fn.nextAll=function(e){return this.next(e,!0)},fn.nextUntil=function(e,t){return this.next(t,!0,e)},fn.not=fn.parent=fn.index=fn.closest=fn.parents=fn.parentsUntil=function(e,t){return this.parents(t,e)},fn.prev=fn.prevAll=fn.prevUntil=fn.siblings=var SERVER="https://personalization-web-stable.mindbox.ru",MINDBOXAPI="https://api.mindbox.ru",CONFIG={DATASET_PREFIX:"popmechanic",CSS_PREFIX:"popmechanic-",JS_PREFIX:"popmechanic.",WEB_URL:SERVER+"/web/",GEO_URL:MINDBOXAPI+"/geo/",TS_URL:SERVER+"/web/time/",FORM_TEST_URL:SERVER+"/web/forms/",CONTACTS_URL:SERVER+"/web/contacts/",ANIMATION_SPEED:200};function zeptoAjaxModule(e){var t,n,r=+new Date,i=window.document,o=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,a=/^(?:text|application)\/javascript/i,s=/^(?:text|application)\/xml/i,c=/^\s*$/,u=i.createElement("a");ion m(){}href=window.location.href,e.active=0,e.ajaxJSONP=e.ajaxSettings={type:"GET",beforeSend:m,success:m,error:m,complete:m,context:null,global:!0,xhr:accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,dataFilter:m},e.ajax=e.get=e.post=function(){var t=v.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=e.fn.load=var _=encodeURIComponent;e.param=function zeptoEventModule(e){var t=1,n=Array.prototype.slice,r=e.isFunction,i=o={},a={},s="onfocusin"in window,c={focus:"focusin",blur:"focusout"},u={mouseenter:"mouseover",mouseleave:"mouseout"};ion m(t,n,r,i,a,s,c){var d=l(t),m=o[d]||(o[d]=[]);n.split(/\s/).forEach((function(n){if("ready"==n)return e(document).ready(r);var o=f(n);o.fn=r,o.sel=a,o.e in u&&(r=,o.del=s;var l=s||r;o.proxy=function(e){if((e=S(e)).isImmediatePropagationStopped&&!e.isImmediatePropagationStopped()){e.data=i;var n=l.apply(t,null==e._args?[e]:[e].concat(e._args));return!1===n&&(e.preventDefault(),e.stopPropagation()),n}},o.i=m.length,m.push(o),"addEventListener"in t&&t.addEventListener(p(o.e),o.proxy,h(o,c))}))}.click=a.mousedown=a.mouseup=a.mousemove="MouseEvents",e.event={add:m,remove:g},e.proxy=e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=e.fn.one=var v=function(){return!0},_=function(){return!1},y=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,b={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=e.fn.on=e.fn.off=e.fn.trigger=e.fn.triggerHandler="focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach((),e.Event=cash.parseJSON=JSON?JSON.parse:function(){},cash.inArray=function(e,t,n){return[].indexOf.call(t,e,n)};var class2type={};cash.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),(),cash.type=cash.contains=document.documentElement.contains?cash.fn.filterVisible=function(){return this.filter((function(e,t){var n=cash(t).css("visibility"),r=cash(t).css("display"),i=parseInt(cash(t).css("opacity"),10);return"hidden"!==n&&"none"!==r&&i>0}))},cash.fn.animate=function(e,t){var n=this;return n.addClass("popmechanic-transition"),n.css(e),setTimeout((function(){n.removeClass("popmechanic-transition"),"function"==typeof t&&t.call(n)}),CONFIG.ANIMATION_SPEED),n},cash.data=cash.noop=function(){},zeptoEventModule(cash),zeptoAjaxModule(cash),function(e){var t=function(){}.toString().indexOf("_")>-1,n=function(){},r=Object.create||i=!0,o={toString:""};for(var a in o)o.hasOwnProperty(a)&&(i=!1);var s=i?["toString","valueOf"]:null;function c(n,r,o){var a=!1;if(i){var c=[];e.each(s,(function(){o.hasOwnProperty(this)&&(a=!0)&&c.push({name:this,val:o[this]})})),a&&(e.each(o,(function(e){c.push({name:e,val:this})})),o=c)}e.each(o,(function(i,o){if(a&&(i=o.name,o=o.val),e.isFunction(o)&&(!t||o.toString().indexOf(".__base")>-1)){var s=n[i]||function(){};r[i]=else r[i]=o}))}e.inherit=function(){var t=arguments,i=e.isFunction(t[0]),o=i?t[0]:n,a=t[i?1:0]||{},s=t[i?2:1],u=a.__constructor||i&&o.prototype.__constructor?function(){};if(!i)return u.prototype=a,u.prototype.__self=u.prototype.constructor=u,e.extend(u,s);e.extend(u,o);var l=o.prototype,d=u.prototype=r(l);return d.__self=d.constructor=u,c(l,d,a),s&&c(o,u,s),u},e.inheritSelf=function(e,t,n){var r=e.prototype;return c(r,r,t),n&&c(e,e,n),e}}(cash);var inherit=cash.inherit,device,previousDevice,addClass,documentElement,find,handleOrientation,hasClass,orientationEvent,removeClass,userAgent;previousDevice=window.device,device={},window.device=device,documentElement=window.document.documentElement,userAgent=window.navigator.userAgent.toLowerCase(),device.ios=device.iphone=function(){return!device.windows()&&find("iphone")},device.ipod=function(){return find("ipod")},device.ipad=function(){return find("ipad")||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},device.android=device.androidPhone=function(){return device.android()&&find("mobile")},device.androidTablet=function(){return device.android()&&!find("mobile")},device.blackberry=device.blackberryPhone=device.blackberryTablet=function(){return device.blackberry()&&find("tablet")},device.windows=function(){return find("windows")},device.macosx=function(){return find("mac os x")},device.linux=function(){return find("linux")},device.windowsPhone=function(){return device.windows()&&find("phone")},device.windowsTablet=device.fxos=device.fxosPhone=function(){return device.fxos()&&find("mobile")},device.fxosTablet=device.meego=function(){return find("meego")},device.cordova=device.nodeWebkit=device.mobile=device.tablet=function(){return!device.mobile()&&(device.ipad()||device.androidTablet()||device.blackberryTablet()||device.windowsTablet()||device.fxosTablet())},device.desktop=device.television=function(){var e,t;for(t=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","roku","pov_tv","hbbtv","ce-html"],e=0;e<t.length;){if(find(t[e]))return!0;e++}return!1},device.portrait=device.landscape=device.noConflict=find=hasClass=addClass=function(e){var t,n;n=e.split(/\s+/).map(().filter((function(e){return!hasClass(e)})).join(" "),t=documentElement.className.replace(/^\s+|\s+$/g,""),documentElement.className=t+" "+n},removeClass=function(e){var t=CONFIG.CSS_PREFIX+e;hasClass(t)&&(documentElement.className=documentElement.className.replace(" "+t,""))},device.ios()?device.ipad()?addClass("ios ipad tablet"):device.iphone()?addClass("ios iphone mobile"):device.ipod()&&addClass("ios ipod mobile"):device.android()?device.androidTablet()?addClass("android tablet"):addClass("android mobile"):device.blackberry()?device.blackberryTablet()?addClass("blackberry tablet"):addClass("blackberry mobile"):device.windows()?device.windowsTablet()?addClass("windows tablet"):device.windowsPhone()?addClass("windows mobile"):addClass("desktop"):device.fxos()?device.fxosTablet()?addClass("fxos tablet"):addClass("fxos mobile"):device.meego()?addClass("meego mobile"):device.nodeWebkit()?addClass("node-webkit"):device.television()?addClass("television"):device.desktop()&&addClass("desktop"),device.cordova()&&addClass("cordova"),handleOrientation=orientationEvent=Object.prototype.hasOwnProperty.call(window,"onorientationchange")?"orientationchange":"resize",window.addEventListener?window.addEventListener(orientationEvent,handleOrientation,!1):window.attachEvent?window.attachEvent(orientationEvent,handleOrientation):window[orientationEvent]=handleOrientation,handleOrientation();var device$1=device,$snippet,$builtInSnippetElement=cash("#"+CONFIG.CSS_PREFIX+"snippet");function disableScroll(){var e=cash("body");e.addClass("popmechanic-disable-scroll"),cash("html").addClass("popmechanic-disable-scroll"),device$1.ios()&&e.addClass("popmechanic-ios-scroll-fix")}function enableScroll(){var e=cash("body");e.removeClass("popmechanic-disable-scroll"),cash("html").removeClass("popmechanic-disable-scroll"),device$1.ios()&&e.removeClass("popmechanic-ios-scroll-fix")}function setDeviceClasses(e){device$1.mobile()&&e.addClass(CONFIG.CSS_PREFIX+"mobile"),device$1.tablet()&&e.addClass(CONFIG.CSS_PREFIX+"tablet"),device$1.desktop()&&e.addClass(CONFIG.CSS_PREFIX+"desktop")}function getContainerId(e){return CONFIG.CSS_PREFIX+"container-"+e}unction getContainerMarkup(e){var t=getContainerId(e),n=cash('<div class="'+CONFIG.CSS_PREFIX+'js-container" id="'+t+'"></div>');return setDeviceClasses(n),n}function getContainer(e){var t=getContainerId(e),n=$snippet.find("#"+t);return 0!==n.length||(n=getContainerMarkup(e)).appendTo($snippet),n}function snippetHasForm(e){return 0!==$snippet.find("#"+CONFIG.CSS_PREFIX+"form-"+e).length}function getCssReset(e){return _.template(resetTemplate)({wrapperId:"#"+getFormId(e)})}$builtInSnippetElement.length>0?$snippet=$builtInSnippetElement:($snippet=cash('<div id="'+CONFIG.CSS_PREFIX+'snippet" style="height: 0; min-height: 0;"></div>'),$snippet.prependTo("body"));var resetTemplate="<%= wrapperId %> * {  margin: 0;  padding: 0;  border: 0;  font-size: 100%;  font: inherit;  color: inherit;  line-height: normal;  vertical-align: baseline;  background: none;  pointer-events: all;  position: static;}<%= wrapperId %> *:before,<%= wrapperId %> *:after {  content: '';  content: none;}";function containerizeCss(e,t){var n="#"+getContainerId(t);return e.replace(/\/\*.*?\*\//gm,"").replace(/(#popmechanic-(?:form|button))(\s|\.|:|{|,)/g," $1-"+t+"$2").replace(selectorRegex,(function(e,t,r){for(var i=r.split(","),o=0;o<i.length;o++)i[o].match(stateRegex)?i[o]=i[o].replace(stateRegex,n+"$&"):i[o]=n+" "+i[o];return t+i.join(",")}))}var selectorRegex=/((?:^|})[\s\n]*)((?:(?:(?:[.#][_a-zA-Z0-9-.:]+)|\*|\+|~|>)[^{]*)+{)/gm,stateRegex=/\.popmechanic-(?:success|error|pending|submitted|desktop|tablet|mobile)(\s|\.|#)/g;function containerizeHtml(e,t,n){return(n?'<div id="'+getContainerId(t)+'">':"")+e.replace(/id=["']popmechanic-(form|button)["']/g,'id="'+CONFIG.CSS_PREFIX+"$1-"+t+'"')+(n?"</div>":"")}window.PopMechanic.getContainer=getContainer,window.PopMechanic.getContainerId=getContainerId;var Session={},getItem,setItem,history,idArrayChanged,getIdArray,currentLocation;try{localStorage.setItem("popmechanic.localstorage",1)}catch(e){throw new Error("Private browsing not supported")}idArrayChanged=function(e,t){var n=(e||[]).map((function(e){return e.id}));return n.sort(),n.join()!=(t||[]).sort().join()},getIdArray=getItem=function(e,t){var n=localStorage.getItem(CONFIG.JS_PREFIX+e);if(n)try{return JSON.parse(n)}catch(e){return t}return t},setItem=function(e,t){localStorage.setItem(CONFIG.JS_PREFIX+e,JSON.stringify(t))},Session.setHostReported=Session.isHostReported=function(){return getItem("host-reported")},Session.setForm=function(e,t){setItem("form-"+e,t)},Session.getForm=function(e){return getItem("form-"+e)},Session.formsChanged=function(e,t){return idArrayChanged(t,getItem("forms-"+e))},Session.setForms=function(e,t){setItem("forms-"+e,getIdArray(t))},Session.conditionsSplitsChanged=function(e,t){return idArrayChanged(t,getItem("conditions-splits-"+e))},Session.getConditionsSplit=function(e){return getItem("conditions-split-"+e)},Session.setConditionsSplit=function(e,t){setItem("conditions-split-"+e,t)},Session.setConditionsSplits=function(e,t){setItem("conditions-splits-"+e,getIdArray(t))},Session.settingsSplitsChanged=function(e,t){return idArrayChanged(t,getItem("settings-splits-"+e))},Session.getSettingsSplit=Session.setSettingsSplit=Session.setSettingsSplits=function(e,t){setItem("settings-splits-"+e,getIdArray(t))},Session.setContactsSent=function(e){setItem("contacts-sent-"+(e=e||"lead"),"1")},Session.isContactsSent=function(e){return"lead"==(e=e||"lead")?"1"===getItem("contacts-sent")||getItem("contacts-sent-lead"):"1"===getItem("contacts-sent-"+e)},Session.setLastShownWithId=function(e){setItem("last-shown-"+e,(new Date).valueOf())},Session.setLastShown=function(e){Session.setLastShownWithId(e),setItem("last-shown",(new Date).valueOf())},Session.getLastShown=function(e){var t;return null===(t=getItem(e?"last-shown-"+e:"last-shown",null))?null:new Date(+t||0)},Session.isShown=function(e){return e?!!getItem("last-shown-"+e):!!getItem("last-shown")},Session.setCompleted=function(e){var t=(new Date).valueOf();setItem("completed-"+e,t),setItem("completed",t)},Session.getCompleted=function(e){var t;return null===(t=getItem(e?"completed-"+e:"completed",null))?null:new Date(+t||0)},Session.setUncompleted=function(e){var t=(new Date).valueOf();setItem("uncompleted-"+e,t),setItem("uncompleted",t)},Session.getUncompleted=function(e){var t;return null===(t=getItem(e?"uncompleted-"+e:"uncompleted",null))?null:new Date(+t||0)},Session.set=Session.get=function(e){return getItem(e)},history=getItem("history",[]),history.push(location.href),history.splice(0,Math.max(history.length-10,0)),setItem("history",history),Session.history=history,Session.addToHistory=function(e){(history=getItem("history",[])).push(e),history.splice(0,Math.max(history.length-10,0)),setItem("history",history),Session.history=history},currentLocation=location.href,setInterval((function(){location.href!==currentLocation&&(currentLocation=location.href,Session.addToHistory(currentLocation))}),1e3);var sourcebuster={exports:{}};!function(e,t){e.exports={1:[{"./init":7}],2:[{"./helpers/utils":6,"./terms":10}],3:[function(e,t,n){var r=e("../data").delimiter,i="";t.exports={setPrefix:function(e){i=e},getPrefix:function(){return i},encodeData:function(e){return i+encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(e){try{return decodeURIComponent(e.replace(new RegExp("^"+i),"")).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(t){try{return unescape(e)}catch(e){return""}}},set:get:destroy:parse:function(e){var t=[],n={};if("string"==typeof e)t.push(e);else for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);for(var o=0;o<t.length;o++){var a;n[this.unsbjs(t[o])]={},a=this.get(t[o])?this.get(t[o]).split(r):[];for(var s=0;s<a.length;s++){var c=a[s].split("="),u=c.splice(0,1);u.push(c.join("=")),n[this.unsbjs(t[o])][u[0]]=this.decodeData(u[1])}}return n},unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":2}],4:[function(e,t,n){var r="",i=e("../data").delimiter;t.exports={setPrefix:function(e){r=e},getPrefix:function(){return r},encodeData:function(e){return r+encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(e){try{return decodeURIComponent(e.replace(new RegExp("^"+r),"")).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(t){try{return unescape(e)}catch(e){return""}}},set:function(e,t,n){var r;if(n){var i=new Date;i.setTime(i.getTime()+60*n*1e3),r=i.valueOf()}else r="";localStorage.setItem(this.encodeData(e),JSON.stringify({value:t,expires:r}))},get:function(e){var t=this.encodeData(e),n=localStorage.getItem(t);return n?(n=JSON.parse(n)).expires&&parseInt(n.expires)<(new Date).valueOf()?(n=null,localStorage.removeItem(t),null):n.value:null},parse:destroy:unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":2}],5:[function(e,t,n){t.exports={parse:parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:getHost:},{}],6:[function(e,t,n){t.exports={escapeRegexp:setDate:setLeadingZeroToInt:randomInt:},{}],7:[function(e,t,n){var r=e("./data"),i=e("./terms"),o=e("./helpers/localStorage"),a=e("./helpers/uri"),s=e("./helpers/utils"),c=e("./params"),u=e("./migrations");t.exports=function(e){var t,n,l,d,f,h,p,m,g,v=c.fetch(e),_=a.getParam(),y=v.domain.host,b=v.domain.isolate,S=v.lifetime;unction I(e){var t=document.referrer;switch(e){case i.traffic.organic:return!!t&&C(t)&&function(e){var t=new RegExp("^https://yandex\\.[a-zA-Z0-9]{2}/$"),r=new RegExp("^(?:.*\\.)?"+s.escapeRegexp("yandex")+"\\..{2,9}$"),i=new RegExp(".*"+s.escapeRegexp("text")+"=.*"),o=new RegExp("^(?:www\\.)?"+s.escapeRegexp("google")+"\\..{2,9}$");if(a.parse(e).query&&a.parse(e).host.match(r)&&a.parse(e).query.match(i)||e.match(t))return n="yandex",!0;if(a.parse(e).host.match(o))return n="google",!0;if(!a.parse(e).query)return!1;for(var c=0;c<v.organics.length;c++){if(a.parse(e).host.match(new RegExp("^(?:.*\\.)?"+s.escapeRegexp(v.organics[c].host)+"$","i"))&&a.parse(e).query.match(new RegExp(".*"+s.escapeRegexp(v.organics[c].param)+"=.*","i")))return n=v.organics[c].display||v.organics[c].host,!0;if(c+1===v.organics.length)return!1}}(t);case i.traffic.referral:return!!t&&C(t)&&t);default:return!1}}turn o.setPrefix(v.prefix),u.go(S,y,b),o.set(r.containers.current,),S,y,b),o.get(r.containers.first)||o.set(r.containers.first,o.get(r.containers.current),S,y,b),o.get(r.containers.udata)?(p=parseInt(o.parse(r.containers.udata)[o.unsbjs(r.containers.udata)][r.aliases.udata.visits])||1,p=o.get(r.containers.session)?p:p+1,m=r.pack.user(p,v.user_ip)):(p=1,m=r.pack.user(p,v.user_ip)),o.set(r.containers.udata,m,S,y,b),o.get(r.containers.session)?(g=parseInt(o.parse(r.containers.session)[o.unsbjs(r.containers.session)][r.aliases.session.pages_seen])||1,g+=1):g=1,o.set(r.containers.session,r.pack.session(g),v.session_length,y,b),v.promocode&&!o.get(r.containers.promocode)&&o.set(r.containers.promocode,r.pack.promo(v.promocode),S,y,b),o.parse(r.containers)}},{"./data":2,"./helpers/localStorage":4,"./helpers/uri":5,"./helpers/utils":6,"./migrations":8,"./params":9,"./terms":10}],8:[function(e,t,n){var r=e("./data"),i=e("./helpers/cookies"),o=e("./helpers/localStorage");t.exports={go:function(e,t,n){var a,s=this.migrations,c={l:e,d:t,i:n},u=[],l="";if(i.setPrefix(o.getPrefix()),i.get(r.containers.first)||i.get(r.service.migrations))if(i.get(r.service.migrations)){for(u=i.get(r.service.migrations).split(r.delimiter),a=0;a<s.length;a++)-1===u.indexOf(s[a].id+"=1")&&(console.log("migrating: "+s[a]),s[a].go(s[a].id,c));for(u=[],a=0;a<s.length;a++)u.push(s[a].id);for(l="",a=0;a<u.length;a++)l+=u[a]+"=1",a<u.length-1&&(l+=r.delimiter);i.set(r.service.migrations,l,c.l,c.d,c.i)}else for(a=0;a<s.length;a++)s[a].go(s[a].id,c);else{for(a=0;a<s.length;a++)u.push(s[a].id);for(l="",a=0;a<u.length;a++)l+=u[a]+"=1",a<u.length-1&&(l+=r.delimiter);i.set(r.service.migrations,l,c.l,c.d,c.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta",go:,{id:"1471519752600",version:"1.0.5",go:function(e,t){var n=e+"=1",o=e+"=0",a=i.getPrefix();try{i.setPrefix("");var s=[];for(var c in r.containers)r.containers.hasOwnProperty(c)&&s.push(r.containers[c]);for(var u=0;u<s.length;u++)if(i.setPrefix(""),i.get(s[u])){var l=i.get(s[u]);i.setPrefix(a),i.set(s[u],l,t.l,t.d,t.i)}i.setPrefix(""),i.get(r.containers.session)&&(i.setPrefix(a),i.set(r.containers.session,r.pack.session(0),t.l,t.d,t.i)),i.setPrefix(a),i.set(r.service.migrations,n,t.l,t.d,t.i)}catch(e){i.set(r.service.migrations,o,t.l,t.d,t.i)}}},{id:"1471519752605",version:"1.1.0",go:function(e,t){for(var n in r.containers)if(r.containers.hasOwnProperty(n)){var a=i.get(r.containers[n]);o.set(r.containers[n],a,t.l),i.destroy(r.containers[n])}}}]}},{"./data":2,"./helpers/cookies":3,"./helpers/localStorage":4}],9:[function(e,t,n){var r=e("./terms"),i=e("./helpers/uri");t.exports={fetch:function(e){var t=e||{},n={};if(n.prefix=this.validate.isString(t.prefix)?t.prefix:"",n.lifetime=this.validate.checkFloat(t.lifetime)||6,n.lifetime=parseInt(30*n.lifetime*24*60),n.session_length=this.validate.checkInt(t.session_length)||30,n.timezone_offset=this.validate.checkInt(t.timezone_offset),n.campaign_param=t.campaign_param||!1,n.user_ip=t.user_ip||r.none,t.promocode?(n.promocode={},n.promocode.min=parseInt(t.promocode.min)||1e5,n.promocode.max=parseInt(t.promocode.max)||999999):n.promocode=!1,t.typein_attributes&&t.typein_attributes.source&&t.typein_attributes.medium?(n.typein_attributes={},n.typein_attributes.source=t.typein_attributes.source,n.typein_attributes.medium=t.typein_attributes.medium):n.typein_attributes={source:"(direct)",medium:"(none)"},t.domain&&this.validate.isString(t.domain)?n.domain={host:t.domain,isolate:!1}:t.domain&&t.domain.host?n.domain=t.domain:n.domain={host:i.getHost(document.location.hostname),isolate:!1},n.referrals=[],t.referrals&&t.referrals.length>0)for(var o=0;o<t.referrals.length;o++)t.referrals[o].host&&n.referrals.push(t.referrals[o]);if(n.organics=[],t.organics&&t.organics.length>0)for(var a=0;a<t.organics.length;a++)t.organics[a].host&&t.organics[a].param&&n.organics.push(t.organics[a]);return n.organics.push({host:"bing.com",param:"q",display:"bing"}),n.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),n.organics.push({host:"about.com",param:"q",display:"about"}),n.organics.push({host:"aol.com",param:"q",display:"aol"}),n.organics.push({host:"ask.com",param:"q",display:"ask"}),n.organics.push({host:"globososo.com",param:"q",display:"globo"}),n.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),n.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),n.organics.push({host:"tut.by",param:"query",display:"tut.by"}),n.referrals.push({host:"t.co",display:"twitter.com"}),n.referrals.push({host:"plus.url.google.com",display:"plus.google.com"}),n},validate:{checkFloat:function(e){return!(!e||!this.isNumeric(parseFloat(e)))&&parseFloat(e)},checkInt:isNumeric:isString:function(e){return"[object String]"===Object.prototype.toString.call(e)}}}},{"./helpers/uri":5,"./terms":10}],10:[{}]},{},[1])(1)}(sourcebuster);var sbjs=sourcebuster.exports,storageKey=CONFIG.CSS_PREFIX+"-init-at";function getCachedVisitStartTs(){var e=getVisit();if(sbjs.get.current_add.fb&&"string"==typeof sbjs.get.current_add.fb){var t=new Date(sbjs.get.current_add.fb.replace(" ","T")).valueOf();return localStorage[storageKey]=e+":"+t,t}if(localStorage[storageKey]){var n=localStorage[storageKey].split(":"),r=n[0],i=n[1];if(parseInt(r,10)===e)return parseInt(i,10)}return localStorage[storageKey]=e+":"+window.PopMechanic.initStartedAt,window.PopMechanic.initStartedAt}var updateCachedVisitStartTs=getCachedVisitStartTs;function getVisit(){var e=sbjs.get.udata.vst;try{return parseInt(e)}catch(e){return 0}}var hasExtension=!1;function isDebugging(){try{return!!hasExtension||(!!window.PopMechanic.isTesting||(-1!==location.toString().indexOf("pm-test-form")||(-1!==location.hash.indexOf("pm-debug")||!!localStorage["pm-debug"])))}catch(e){return!1}}function log(){if(isDebugging()){var e=_.toArray(arguments);console.log.apply(console,["Personalization:"].concat(e))}}window.addEventListener("message",(function(e){e.source===window&&e.data&&"popmechanic-extension"===e.data.source&&(hasExtension=!0)}));var debug={isDebugging:isDebugging,log:log},DB_VERSION=10,DB_NAME="db",HISTORY_STORE_ID="h",EVENT_STORE_ID="e",PRODUCT_SEGMENTATION_STORE_ID="ps",FORM_STORE_ID="f",PERSIST_FOR_MONTHS=6,PRUNE_COOLDOWN_MS=864e5,PRUNE_UP_TO=1e3,indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,IDBKeyRange$1=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,db=null,requestQueue=[];function openDb(){var e=indexedDB.open(CONFIG.JS_PREFIX+DB_NAME,DB_VERSION);e.onerror=e.onsuccess=function(e){(db=e.target.result).onversionchange=db.onclose=function(){db=null},db.onerror=var t=parseInt(localStorage[CONFIG.JS_PREFIX+"pruned-at"]);if(!t||Date.now()-1e3*t>PRUNE_COOLDOWN_MS){localStorage[CONFIG.JS_PREFIX+"pruned-at"]=Math.floor(Date.now()/1e3);var n=new Date;n.setMonth(n.getMonth()-PERSIST_FOR_MONTHS);var r=n.valueOf();pruneRecords(HISTORY_STORE_ID,r),pruneRecords(EVENT_STORE_ID,r),pruneRecords(PRODUCT_SEGMENTATION_STORE_ID,r),pruneRecords(FORM_STORE_ID,r)}callRequestQueue()},e.onupgradeneeded=function(t){var n,r=t.target.result;if(t.oldVersion<1){var i=r.createObjectStore(HISTORY_STORE_ID,{autoIncrement:!0});i.createIndex("url","url",{unique:!1}),i.createIndex("vst","vst",{unique:!1})}if(t.oldVersion<2&&((n=r.createObjectStore(EVENT_STORE_ID,{autoIncrement:!0})).createIndex("type","type",{unique:!1}),n.createIndex("vst","vst",{unique:!1}),n.createIndex("form","form",{unique:!1})),t.oldVersion<4&&((n=e.transaction.objectStore(EVENT_STORE_ID)).indexNames.contains("ts")||n.createIndex("ts","ts",{unique:!1})),t.oldVersion<5&&((i=e.transaction.objectStore(HISTORY_STORE_ID)).indexNames.contains("pagetype")||i.createIndex("pagetype","pagetype",{unique:!1})),6===t.oldVersion&&r.deleteObjectStore(PRODUCT_SEGMENTATION_STORE_ID),t.oldVersion<7){var o=r.createObjectStore(PRODUCT_SEGMENTATION_STORE_ID,{autoIncrement:!0});o.createIndex("productIds","productIds",{unique:!1}),o.createIndex("segmentationId","segmentationId",{unique:!1}),o.createIndex("segmentId","segmentId",{unique:!1}),o.createIndex("ts","ts",{unique:!1})}(t.oldVersion<8&&((i=e.transaction.objectStore(HISTORY_STORE_ID)).indexNames.contains("productIds")||i.createIndex("productIds","productIds",{unique:!1}),i.indexNames.contains("categoryIds")||i.createIndex("categoryIds","categoryIds",{unique:!1})),t.oldVersion<9)&&(e.transaction.objectStore(HISTORY_STORE_ID).createIndex("productItem","productItem",{unique:!1}),e.transaction.objectStore(PRODUCT_SEGMENTATION_STORE_ID).createIndex("productItem","productItem",{unique:!1}));t.oldVersion<10&&((n=r.createObjectStore(FORM_STORE_ID,{autoIncrement:!0})).createIndex("id","id",{unique:!0}),n.createIndex("form","form",{unique:!1}))}}function pruneRecords(e,t){var n;debug.isDebugging()&&(n=Date.now(),debug.log("store "+e+" prune started @",n));var r=db.transaction(e,"readwrite"),i=0;r.objectStore(e).openCursor().onsuccess=function(e){var n=e.target.result;n&&((!n.value.ts||n.value.ts<t)&&(n.delete(),i+=1),i<PRUNE_UP_TO&&n.continue())},debug.isDebugging()&&(r.oncomplete=function(){var t=Date.now();debug.log("store "+e+" prune complete @",t,"total: ",t-n)})}function callRequestQueue(){requestQueue.forEach((function(e){e()})),requestQueue.push=function enqueued(e){if("function"==typeof e)return function(){var t=this,n=arguments;return new Promise((function(r,i){requestQueue.push(()}))}}function pushVisit(e){return db?new Promise((function(t,n){var r=db.transaction([HISTORY_STORE_ID],"readwrite").objectStore(HISTORY_STORE_ID).add(e);r.addEventListener("success",(function(){t(r.result)})),r.addEventListener("error",()})):Promise.resolve()}function enrichVisit(e,t){return db?new Promise((function(n,r){var i=db.transaction([HISTORY_STORE_ID],"readwrite").objectStore(HISTORY_STORE_ID),o=i.get(e);o.addEventListener("success",(function(){var a=_.extend({},o.result,t),s=i.put(a,e);s.addEventListener("success",n),s.addEventListener("error",r)})),o.addEventListener("error",(function(){n()}))})):Promise.resolve()}function pushEvent(e){if(!db)return Promise.resolve();if(!e||!e.type)return Promise.resolve();var t=_.clone(e);return"number"!=typeof e.vst&&(t.vst=getVisit()),"number"!=typeof e.ts&&(t.ts=Date.now()),db.transaction(EVENT_STORE_ID,"readwrite").objectStore(EVENT_STORE_ID).add(t),Promise.resolve()}function getLastEvent$1(e,t){return db?new Promise((function(n){var r=db.transaction(EVENT_STORE_ID).objectStore(EVENT_STORE_ID).index(e.form?"form":"type"),i=e.form?IDBKeyRange$1.only(e.form):e.type?IDBKeyRange$1.only(e.type):null,o=null;r.openCursor(i,["prev"]).onsuccess=function(r){var i=r.target.result;if(i){if(e.form&&i.value.form!==e.form)return i.continue();if(e.type&&i.value.type!==e.type)return i.continue();if("function"==typeof t&&!t(i.value))return i.continue();(!o||o&&o.ts<i.value.ts)&&(o=i.value),i.continue()}else n(o)}})):Promise.reject()}function alwaysTrue(){return!0}function forEachEvents(e,t,n){if(!db)return Promise.reject();var r=db.transaction(EVENT_STORE_ID),i=e?r.objectStore(EVENT_STORE_ID).index(e):r.objectStore(EVENT_STORE_ID);return new Promise((function(e){i.openCursor(t||null).onsuccess=function(t){var r=t.target.result;r?(n(r.value),r.continue()):e()}}))}function countVisits(e,t,n){return db?(void 0===e&&(e=alwaysTrue),void 0===t&&(t=0),new Promise((function(r){var i=[],o=db.transaction(HISTORY_STORE_ID).objectStore(HISTORY_STORE_ID).index(n?"vst":"url"),a=n?IDBKeyRange$1.only(n):null;n||"string"!=typeof e||(a=IDBKeyRange$1.only(e)),o.openCursor(a).onsuccess=function(n){var o=n.target.result;if(o){if(o.value.ts>=t){var a=Promise.resolve("string"==typeof e?e===o.value.url:e(o.value));i.push(a)}o.continue()}else Promise.all(i).then((function(e){var t=_.filter(e,_.identity).length;r(t)}))}}))):Promise.reject()}function findVisit(e,t,n){return db?(void 0===e&&(e=alwaysTrue),void 0===t&&(t=0),new Promise((function(r){var i=[],o=db.transaction(HISTORY_STORE_ID).objectStore(HISTORY_STORE_ID).index(n?"vst":"url"),a=n?IDBKeyRange$1.only(n):null;n||"string"!=typeof e||(a=IDBKeyRange$1.only(e)),o.openCursor(a,["prev"]).onsuccess=function(n){var o=n.target.result;if(o){if(o.value.ts>=t){var a=Promise.resolve("string"==typeof e?e===o.value.url:e(o.value));i.push(a)}o.continue()}else Promise.all(i).then((function(e){var t=_.filter(e,_.identity)[0];r(t||null)}))}}))):Promise.reject()}function pushProductItemSegmentation(e){return db?new Promise((function(t,n){var r=db.transaction([PRODUCT_SEGMENTATION_STORE_ID],"readwrite"),i=r.objectStore(PRODUCT_SEGMENTATION_STORE_ID);e.forEach((function(e){i.add(e)})),r.oncomplete=function(){t("OK")},r.onerror=function(e){n(e)}})):Promise.resolve()}function findProductItemSegmentation(e,t){return db?(void 0===e&&(e=alwaysTrue),void 0===t&&(t=0),new Promise((function(n){db.transaction(PRODUCT_SEGMENTATION_STORE_ID).objectStore(PRODUCT_SEGMENTATION_STORE_ID).openCursor().onsuccess=function(r){var i=r.target.result;i?(t<i.value.ts||n(null),e(i.value)?n(i.value):i.continue()):n(null)}}))):Promise.reject()}function removeProductItemSegmentation(e){return db?(void 0===e&&(e=alwaysTrue),new Promise((function(t){db.transaction(PRODUCT_SEGMENTATION_STORE_ID,"readwrite").objectStore(PRODUCT_SEGMENTATION_STORE_ID).openCursor().onsuccess=function(n){var r=n.target.result;r?(e(r.value)&&r.delete(),r.continue()):t("OK")}}))):Promise.reject()}function filterProductItemSegmentations(e,t){return db?(void 0===e&&(e=alwaysTrue),void 0===t&&(t=0),new Promise((function(n){var r=[];db.transaction(PRODUCT_SEGMENTATION_STORE_ID).objectStore(PRODUCT_SEGMENTATION_STORE_ID).openCursor(null,["prev"]).onsuccess=function(i){var o=i.target.result;o?(t<o.value.ts||n(r),("string"==typeof e?e===o.value.url:e(o.value))&&r.push(o.value),o.continue()):n(r)}}))):Promise.reject()}function addForm(e){var t=e.id,n=e.form;return db?new Promise((function(e,r){var i=db.transaction([FORM_STORE_ID],"readwrite").objectStore(FORM_STORE_ID).put(n,t);i.addEventListener("success",e),i.addEventListener("error",r)})):Promise.resolve()}function getFormById(e){return db?new Promise((function(t,n){var r=db.transaction(FORM_STORE_ID).objectStore(FORM_STORE_ID).get(e);r.addEventListener("success",(),r.addEventListener("error",()})):Promise.reject(null)}indexedDB||callRequestQueue(),openDb();var visit={push:enqueued(pushVisit),enrich:enqueued(enrichVisit),count:enqueued(countVisits),find:enqueued(findVisit)},event={push:enqueued(pushEvent),getLast:enqueued(getLastEvent$1),forEach:enqueued(forEachEvents)},productItemSegmentation={push:enqueued(pushProductItemSegmentation),remove:enqueued(removeProductItemSegmentation),find:enqueued(findProductItemSegmentation),filter:enqueued(filterProductItemSegmentations)},form={add:enqueued(addForm),getById:enqueued(getFormById)},Dispatcher={on:function(e,t){$snippet.on(e,t)},off:function(e,t){$snippet.off(e,t)},trigger:;function getAlwaysFalseChecker(){return function(e){e({result:!1,final:!0})}}function getAlwaysTrueChecker(){return stringOperators=["$any","$contains","$exclude","$startsWith","$endsWith","$eq","$neq","$regexp","$not_regexp"],stringArrayOperators=stringOperators.concat(["$any","$none","$in","$nin","$in_contains","$in_startsWith","$in_endsWith","$in_regexp"]),booleanOperators=["$any","$eq","$neq"],numberOperators=["$any","$eq","$neq","$lt","$gt","$lte","$gte","$between"],arrayOperators=["$any","$none","$in","$nin"],domElementOperators=["$exists","$not_exists"],formEventsOperators=["$after"],allowedOperators={day_of_week:arrayOperators,city:arrayOperators,region:arrayOperators,country:arrayOperators,source:arrayOperators,device:arrayOperators,operating_system:arrayOperators,push_request_unavailable:booleanOperators,page:stringArrayOperators,referrer:stringOperators,utm_source:stringOperators,utm_medium:stringOperators,utm_campaign:stringOperators,utm_content:stringOperators,utm_term:stringOperators,visit:numberOperators,form_completed:formEventsOperators,form_uncompleted:formEventsOperators,form_seen:formEventsOperators,dom_element:domElementOperators,cart:numberOperators,time:numberOperators,time_utc:numberOperators,datetime:numberOperators,datetime_utc:numberOperators,google_optimize:arrayOperators,visited_url:numberOperators,productId:stringArrayOperators,productName:stringArrayOperators,productCategoryId:stringArrayOperators,productBrandName:stringArrayOperators,productPrice:numberOperators,productPriceWithDiscount:numberOperators,productDiscount:numberOperators,categoryId:stringArrayOperators,time_passed:["$eq","$between","$any"],url:stringArrayOperators,js:["$exec"],mindboxProductSegment:["$exists","$not_exists"]},tsResult=null,tsPromise=null;unction getServerTs(){return tsPromise?tsPromise.then(cloneDate):tsPromise=(tsPromise=new Promise((function(e,t){cash.ajax({type:"GET",url:CONFIG.TS_URL,dataType:"json",success:e,error:t})}))).then((function(e){return tsResult=new Date(e.timestamp)})).catch(()}function getServerTsSync(){return tsResult?new Date(tsResult):new Date(window.PopMechanic.initAt)}var serverTsProvider={get:getServerTs,getSync:getServerTsSync},getPropertyByPath=setPropertyByPath=function(e,t,n){var r=t.split("."),i=e;r.forEach((function(e,t){t===r.length-1?i[e]=n:i=i[e]?i[e]:i[e]={}}))},hasNonAsciiCharacters=punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;rsion:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};var punycode$1=punycode,geoPromise=null;function getGeo(){return geoPromise||(geoPromise=new Promise((function(e,t){cash.ajax({type:"GET",url:CONFIG.GEO_URL,data:{domain:location.hostname,extend:!0},dataType:"json",success:e,error:t})})))}var geoProvider={getGeo:getGeo},getGlobalUtils=function(e){var t=e.globalUtils;return delete e.globalUtils,t||{getIntegrationPromise:function(){return null},waitPromisesOrDelay:function(){return null},getMindboxIsReadyPromise:function(){return null},reportFailure:function(){return null},getSettings:function(){return null},getDeviceType:function(){return"unknown"},getTabVisibilityDuration:function(){return null},resetTabVisibilityDuration:function(){return null}}},globalUtils=getGlobalUtils(window.PopMechanic),getPageDataPromise=function(){return globalUtils.getIntegrationPromise("PopMechanicPageData")},getPopmechanicCart=function(){return globalUtils.getIntegrationPromise("PopMechanicCartData")};function pad(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}var fieldValues={device:operating_system:source:function(){return sbjs.get.current.typ},time:function(){return serverTsProvider.get()},time_utc:function(){return serverTsProvider.get()},day_of_week:datetime:function(){return serverTsProvider.get()},datetime_utc:page:function(e){return hasNonAsciiCharacters(e.value)?location.href.replace(location.host,punycode$1.toUnicode(location.host)):location.href.replace(location.host,punycode$1.toASCII(location.host))},country:function(){return geoProvider.getGeo().then((function(e){return e.country_id}))},region:function(){return geoProvider.getGeo().then((function(e){return e.region_id}))},city:utm_source:function(){return sbjs.get.current.src},utm_medium:function(){return sbjs.get.current.mdm},utm_campaign:function(){return sbjs.get.current.cmp},utm_content:function(){return sbjs.get.current.cnt},utm_term:visit:referrer:function(){return document.referrer},google_optimize:function(e){return new Promise((function(t){var n=e.value.expId;!function e(r){try{var i=document.cookie.split(n)[1].split(";")[0].split(".")[2].split("!")[0];i=parseInt(i,10),t(i)}catch(n){r<500?setTimeout((,r):t(void 0)}}(100)}))},visited_url:function(e){var t,n,r;return fieldOperators.hasOwnProperty(e.value.operator)&&(t=function(t){return fieldOperators[e.value.operator](e.value.pattern,t&&t.url)}),"number"==typeof e.value.interval&&(n=Date.now()-1e3*e.value.interval),"$session"===e.value.interval&&(r=sbjs.get.udata.vst),visit.count(t,n,r).then(()},push_request_unavailable:function(){return!(window.PushManager&&"default"===Notification.permission)},productId:function(){return getPageDataPromise().then((function(e){return e&&e.product&&e.product.id}))},productName:function(){return getPageDataPromise().then((function(e){return e&&e.product&&e.product.name}))},productCategoryId:function(){return getPageDataPromise().then((function(e){return e&&e.product&&e.product.categoryId}))},productBrandName:function(){return getPageDataPromise().then((function(e){return e&&e.product&&e.product.brand}))},productPrice:function(){return getPageDataPromise().then((function(e){return e&&e.product&&e.product.price}))},productPriceWithDiscount:function(){return getPageDataPromise().then((function(e){return e&&e.product&&e.product.priceWithDiscount}))},productDiscount:function(){return getPageDataPromise().then((function(e){return e&&e.product?e.product.price>e.product.priceWithDiscount?100*(e.product.price-e.product.priceWithDiscount)/e.product.price:0:NaN}))},categoryId:function(){return getPageDataPromise().then(()}},conditionMappers={time:function(e){var t=e.match(/(\d\d)\:(\d\d)\:(\d\d)/);return serverTsProvider.get().then((function(e){var n=new Date(e);return n.setHours(t[1],t[2],t[3]),n}))},time_utc:function(e){var t=e.match(/(\d\d)\:(\d\d)\:(\d\d)([+-])(\d\d)\:(\d\d)/);return serverTsProvider.get().then((function(e){var n=new Date(e);return t[5]&&t[6]?"+"===t[4]?(n.setUTCHours(t[1]-t[5],t[2]-t[6],t[3]),n):(n.setUTCHours(t[1]+t[5],t[2]+t[6],t[3]),n):(n.setUTCHours(t[1],t[2],t[3]),n)}))},datetime:function(e){var t=(new Date).getTimezoneOffset(),n=t<0?"+":"-",r=pad(Math.abs(t)%60,2),i=pad(Math.floor(Math.abs(t)/60),2),o=e.replace(/([+-]\d\d:\d\d|Z)$/,n+i+":"+r);return new Date(o)},datetime_utc:google_optimize:function(e){return e.variation},visited_url:;function arrayOperator(e){return function(t,n){return _.isArray(t)?_.some(t,(function(t){return e(t,n)})):e(t,n)}}var fieldOperators={$in:$nin:function(e,t){return!_.contains(e,t)},$in_contains:function(e,t){return arrayOperator(fieldOperators.$contains)(e,t)},$in_startsWith:function(e,t){return arrayOperator(fieldOperators.$startsWith)(e,t)},$in_endsWith:function(e,t){return arrayOperator(fieldOperators.$endsWith)(e,t)},$in_regexp:$contains:function(e,t){var n=""+e;return 0===n.length||-1!==(""+t).indexOf(n)},$exclude:$startsWith:function(e,t){var n=""+e;return 0===n.length||0===(""+t).indexOf(n)},$endsWith:function(e,t){var n=""+t,r=""+e;return 0===r.length||n.length>=r.length&&n.indexOf(r)===n.length-r.length},$regexp:$not_regexp:$any:$none:$after:function(e,t){return Date.now()-t>=1e3*e.interval},$eq:$neq:$gt:$lt:$gte:$lte:$between:function(e,t){var n=null===e.min?-1/0:e.min,r=null===e.max?1/0:e.max;return t>=n&&t<=r}};function defaultChecker(e,t,n){return void 0===n&&(n=conditionMappers),t[e.field]&&_.contains(allowedOperators[e.field],e.operator)?function(r){var i=n[e.field]?n[e.field](e.value):e.value,o=t[e.field](e);r({result:(0,fieldOperators[e.operator])(i,o),final:!0})}:getAlwaysFalseChecker()}function getAggregatedConditionFilter(e,t,n){if(!e)return n;if(!e.field){if(e.nodes){return getGroupFilter(e,()}return n}var r=fieldOperators[e.operator],i=e.value,o=t[e.field];return o?alwaysFalse}function getGroupFilter(e,t){var n=e.nodes.map(t);switch(e.operator){case"$and":return function(e){return _.every(n,(function(t){return t(e)}))};case"$or":return default:return getAlwaysFalseChecker()}}var cartHandlersQueue=[];Dispatcher.on("destroy",(),window.PopMechanicAddToCart=var aggregators={$count:function(e){return function(t){return t.reduce((function(t,n){return e(n)?t+(n.quantity||1):t}),0)}},$countDistinct:function(e){return function(t){for(var n=0,r={},i=0;i<t.length;i++){var o=t[i];e(o)&&!r[o.id]&&(r[o.id]=!0,n++)}return n}},$countNot:function(e){return function(t){return t.reduce((function(t,n){return e(n)?t:t+1}),0)}},$priceSum:function(e){return function(t){return t.reduce((function(t,n){return e(n)?t+(n.priceWithDiscount||n.price)*(n.quantity||1):t}),0)}},$anyOf:function(e){return function(t){return _.some(t,e)}},$noneOf:function(e){return ,$every:;function baseFilter(e){return!!e&&_.isObject(e)&&_.isFinite(e.price)&&!!e.id}var productFieldValues={productPrice:_.property("price"),productPriceWithDiscount:_.property("priceWithDiscount"),productDiscount:function(e){return e.price>e.priceWithDiscount?(e.price-e.priceWithDiscount)/e.price:0},productId:function(e){return e&&e.id?e.id.toString():""},productName:_.property("name"),productCategoryId:productBrandName:_.property("brand")};function cartChecker(e){if("cart"!==e.field)return getAlwaysFalseChecker();var t=fieldOperators[e.operator]||alwaysFalse;return aggregators[e.aggregator]?function(n){var r=getAggregatedConditionFilter(e.filter,productFieldValues,baseFilter),i=aggregators[e.aggregator](r);function o(){var n=window.PopMechanicCartData;if(!n)return null;var r=i(n.products);return"boolean"==typeof r?r:t(e.value,r)}var a=setInterval((function(){var e=o();null!==e&&(clearInterval(a),n({result:e,final:!1}))}));return cartHandlersQueue.push((function(){setTimeout((function(){var e=o();null!==e&&n({result:e,final:!1})}),1e3)})),function(){clearInterval(a)}}:getAlwaysFalseChecker()}function timedChecker(e,t,n){return void 0===n&&(n=conditionMappers),t[e.field]&&_.contains(allowedOperators[e.field],e.operator)?function(r){var i=t[e.field](e),o=n[e.field]?n[e.field](e.value):e.value,a=fieldOperators[e.operator];function s(){var n=t[e.field](e);Promise.all([Promise.resolve(o),Promise.resolve(n)]).then((function(e){var t=a(e[0],e[1]);r({result:t,final:!1})}))}var c=setInterval(s,3e5);return"object"==typeof o&&"function"==typeof o.then||"object"==typeof i&&"function"==typeof i.then?(s(),null):function(){clearInterval(c)}}:getAlwaysFalseChecker()}function domElementChecker(e){if("$exists"!==e.operator&&"$not_exists"!==e.operator)return getAlwaysFalseChecker();var t=-1!==(""+e.value).indexOf(":visible"),n=(""+e.value).replace(/:visible/g,"");return function(r){var i=setInterval((function(){var i=cash(n);t&&(i=i.filterVisible()),"$exists"===e.operator&&r({result:i.length>0,final:!1}),"$not_exists"===e.operator&&r({result:0===i.length,final:!1})}),1e3),o=return Dispatcher.on("destroy",o),o}}function jsChecker(e){if(!_.contains(allowedOperators[e.field],e.operator))return getAlwaysFalseChecker();try{var t=new Function(e.value)}catch(e){return getAlwaysFalseChecker()}return function(e){var n=null;try{n=t()}catch(t){return console.error("$exec error",t),void e({result:!1,final:!0})}Promise.resolve(n).then((function(t){e({result:t,final:!0})})).catch((function(){e({result:!1,final:!0})}))}}var sessionFunctions={form_seen:Session.getLastShown,form_completed:Session.getCompleted,form_uncompleted:Session.getUncompleted};unction getAnyValue(e){var t=(0,sessionFunctions[e.field])();return"$never"===e.operator?null===t:"form_seen"===e.field&&null===t||null!==t&&Date.now()-t>=1e3*e.value.interval}function getArrayValue(e){var t=sessionFunctions[e.field],n=e.value.forms,r=1e3*e.value.interval,i=Date.now(),o=_.chain(n).map(t).map((function(e){return null===e?null:i-e>=r})).value();return"$never"===e.operator?_.every(o,_.isNull):"form_seen"===e.field?_.every(o,isTrueOrNull):0!==o.length&&_.every(o)}function formEventsChecker(e){if(!sessionFunctions.hasOwnProperty(e.field))return getAlwaysFalseChecker();if("$after"!==e.operator&&"$never"!==e.operator)return getAlwaysFalseChecker();var t=e.value.forms;return"$any"===t?function(t){var n=setInterval((function(){var n=getAnyValue(e);t({result:n,final:!1})}),1e3);return function(){clearInterval(n)}}:_.isArray(t)?function(t){var n=setInterval((function(){var n=getArrayValue(e);t({result:n,final:!1})}),1e3);return function(){clearInterval(n)}}:getAlwaysFalseChecker()}var SPEEDTEST="https://personalization-speedtest-stable.mindbox.ru";function reportMindboxError(e,t,n){var r=window.PopMechanic.client;(new Image).src=SPEEDTEST+"/mb-error?client="+r+"&form="+e+"&op="+t+"&status="+n+"&_="+ +Date.now()}function getErrorReporter(e,t){return function(n){reportMindboxError(e,t,n.statusCode||0)}}var NO_MINDBOX_TRACKER_TYPE="NoMindboxTracker",onPageDataChange=function(e){globalUtils.getMindboxIsReadyPromise().then((function(){if(!window.mindbox)return{type:NO_MINDBOX_TRACKER_TYPE};window.mindbox("personalization.invokeWithPageData",e),window.mindbox("personalization.registerOnPageChangeCallback",e)}))},getMindboxPageDataPromise=function(){return new Promise((function(e,t){onPageDataChange((function(n){n&&(n.type===NO_MINDBOX_TRACKER_TYPE&&t(n),e(n))}))}))},getCart=function(){return getMindboxPageDataPromise().then(().catch(()},getMindboxKnownPageDataPromise=function(){return new Promise((function(e,t){onPageDataChange((function(n){n&&(n.type===NO_MINDBOX_TRACKER_TYPE&&t(n),"unknown"!==n.type&&e(n))}))}))},getMindboxKnownPageDataPromiseOrNull=function(){return new Promise((function(e){getMindboxKnownPageDataPromise().then(e).catch(()}))};unction getMindboxIdsExternalId(e){var t=getMindboxIdsExternalSystemName(e);return t?e[t].toString():""}function mindboxIdsIsEqual(e,t){return _.chain(e).keys().some((function(n){return(t[n]&&t[n].toString())===e[n].toString()})).value()}function productItemIsEqual(e,t){return e.product&&t.product?mindboxIdsIsEqual(e.product.ids,t.product.ids):!(!e.productGroup||!t.productGroup)&&mindboxIdsIsEqual(e.productGroup.ids,t.productGroup.ids)}ar isValidProductItem=function(e){if(!e)return!1;var t=e.product||e.productGroup;return!!t&&!(!t||!t.ids||_.isEmpty(t.ids))};function getProductItemFromPageData(e){if(!e)return null;var t=e.product?_.pick(e,"product"):e.productGroup?_.pick(e,"productGroup"):null;return isValidProductItem(t)?t:null}function Batch(e){this._successHandlers=[],this._errorHandlers=[],this._runningTimeout=500,this._fetchData=e,this.items=[],this.isRunning=!1}atch.prototype.addItem=function(e){var t=this;return new Promise((function(n,r){var i=t;i.items.push(e),i._successHandlers.push(n),i._errorHandlers.push(r)}))},Batch.prototype.removeItem=function(e){this.items=_.filter(this.items,(function(t){return t.id!==e}))},Batch.prototype.run=function(){var e=this;return e.isRunning=!0,e._fetchData(e.items).then((function(t){e.isRunning=!1,_.forEach(e._successHandlers,(function(e){return e(t)}))})).catch((function(t){e.isRunning=!1,_.forEach(e._errorHandlers,(function(e){return e(t)}))}))},Batcher.prototype.addItem=function(e){var t=this,n=t._getIsNotRunningBatch();return n||(n=new Batch(t._fetchData),t._batches.push(n),setTimeout((function(){n&&n.run().then((function(){t._removeBatch(n)}))}),t._batchRunningTimeout)),n.addItem(e)},Batcher.prototype._getIsNotRunningBatch=Batcher.prototype._removeBatch=Batcher.prototype.removeItem=function(e){this._batches=_.forEach(this._batches,(function(t){t.removeItem(e)}))},Batcher.prototype.removeItems=function(e){this._batches=_.forEach(this._batches,()};var clientSegmentationsFetchErrorTypes={noMindboxTracker:"NoMindboxTracker",noAuth:"MindboxCustomerNoAuth"},mbClientSegmentationsSync=function(e){return new Promise((function(t,n){globalUtils.getMindboxIsReadyPromise().then((function(){window.mindbox||n({type:clientSegmentationsFetchErrorTypes.noMindboxTracker});var r=_.chain(e).map(_.property("segmentationId")).uniq().map(().value();r.length?window.mindbox("sync",{operation:e[0].operation,data:{segmentations:r},onSuccess:t,onError:n}):t({customerSegmentations:[]})}))}))},mbClientSegmentationBatcher=new Batcher(mbClientSegmentationsSync),mbClientSegmentationFetch=function(e){var t=null;return{promise:new Promise((function(n,r){return t=n,mbClientSegmentationBatcher.addItem({id:e.id,segmentationId:e.segmentationId,operation:e.operation}).then((function(t){return t.customerSegmentations||r({type:clientSegmentationsFetchErrorTypes.noAuth}),{customerSegmentation:t.customerSegmentations.find(()}})).then(n).catch(r)})),cancel:function(){mbClientSegmentationBatcher.removeItem(e.id),t&&t({cancelled:!0})}}},PageStorage=function(e){var t=this;void 0===e&&(e=Dispatcher),this._cache={},e.on("destroy",(function(){t._clear()}))};PageStorage.prototype._clear=PageStorage.prototype.getItem=PageStorage.prototype.setItem=var pageStorage=new PageStorage,cacheForMs=3e5,checkSegmentLimitExceededStatusCode=429,mindboxSegmentChecker=function(e){return"mindbox_segment"!==e.field||"$check"!==e.operator?getAlwaysFalseChecker():function(t,n){var r=n.id,i=e.value,o=i.operation,a=i.segmentation,s=i.inSegment,c=i.inSegmentByDefault,u=i.segment,l="string"==typeof a?a:a.externalId,d="client-segmentation."+l,f=pageStorage.getItem(d),h=function(e){return"$any"===u?!!e:!!e&&e.ids.externalId===u.externalId};if(!(f&&Date.now()-f.ts<cacheForMs)){var p=r+"."+e.id,m=mbClientSegmentationFetch({id:p,segmentationId:l,operation:o});return m.promise.then((function(e){if(!e.cancelled){if(e.customerSegmentation){var n=e.customerSegmentation.segment;return pageStorage.setItem(d,{ts:Date.now(),segment:n}),void t({result:h(n)===s,final:!0})}t({result:!s,final:!0})}})).catch((function(e){e.type!==clientSegmentationsFetchErrorTypes.noAuth?(e.type!==clientSegmentationsFetchErrorTypes.noMindboxTracker&&(e.statusCode||0)!==checkSegmentLimitExceededStatusCode&&reportMindboxError(r,o,e.statusCode||0),t({result:c===s,final:!0})):t({result:!s,final:!0})})),Dispatcher.on("destroy",(function(){m.cancel()})),function(){m.cancel()}}t({result:h(f.segment)===s,final:!0})}};function promiseChecker(e,t,n){return void 0===n&&(n=conditionMappers),t[e.field]&&_.contains(allowedOperators[e.field],e.operator)?function(r){var i=Promise.resolve(n[e.field]?n[e.field](e.value):e.value),o=Promise.resolve(t[e.field](e)),a=fieldOperators[e.operator];return Promise.all([i,o]).then(().catch(alwaysFalse).then((function(e){r({result:e,final:!0})})),null}:getAlwaysFalseChecker()}var queueMicrotask=window.queueMicrotask;function conditionNotification(e,t,n){if(window.PopMechanic.debugMode)try{window.postMessage({source:CONFIG.CSS_PREFIX+"script",type:"NEW_TARGETING_CONDITION_VALUE_CHANGED",data:{clientId:window.PopMechanic.client,form:e&&e.id,condition:t.source?JSON.parse(t.source):t.id,value:n.result,isFinal:n.final}},"*")}catch(e){}}function stateWrapper(e,t,n){var r={result:!1,final:!1},i=doNothing;function o(i){null===i&&(i={result:!1,final:!1}),"boolean"==typeof i&&(i={result:i,final:!1}),r.final||r.result===i.result&&r.final===i.final||(r.result=i.result,r.final=i.final,queueMicrotask(())}try{var a=e(o,t);i="function"==typeof a?a:doNothing}catch(e){console.error(e),o({result:!1,final:!0})}return{id:e.id,getValue:cancel:i}}function everyTrue(e){return _.every(e,(function(e){return!!e.result}))}unction groupChecker(e,t,n,r,i,o){if(!_.isArray(e.nodes)||"$or"!==e.operator&&"$and"!==e.operator)return getAlwaysFalseChecker();if(0===e.nodes.length)return getAlwaysTrueChecker();var a="$or"===e.operator?anyTrue:everyTrue;return function(s,c){var u=!1,l=e.nodes.map((function(d){return stateWrapper(getFieldChecker(d,t,n,r,i,o),c,(function(){u||(u=!0,queueMicrotask((function(){var t=function(){var t=l.map(();if("$or"===e.operator&&_.any(t,isFinalAndTrue))return f(),{result:!0,final:!0};if("$and"===e.operator&&_.any(t,isFinalAndFalse))return f(),{result:!1,final:!0};return{result:a(t),final:_.every(t,"final")}}();s(t),u=!1})))}))})),d=!1;function f(){d||(queueMicrotask((),d=!0)}return f}}"function"!=typeof queueMicrotask&&(queueMicrotask=;var operatorsMap={$any:"$any",$none:"$none",$in:"$eq",$nin:"$neq",$in_contains:"$contains",$in_startsWith:"$startsWith",$in_endsWith:"$endsWith",$in_regexp:"$regexp"},groupOperatorsMap={$any:"$or",$none:"$or",$in:"$or",$nin:"$and",$in_contains:"$or",$in_startsWith:"$or",$in_endsWith:"$or",$in_regexp:"$or"};function allowArraysInCondition(e){return function(t,n,r){var i;return _.contains(allowedOperators[t.field],t.operator)?_.isArray(t.value)?(i=_.map(t.value,(function(e,n){return{id:t.id+"["+n+"]",field:t.field,value:e,operator:operatorsMap[t.operator]}})),groupChecker({id:t.id,name:"pageCondition#"+t.id,operator:groupOperatorsMap[t.operator],nodes:i},n,r)):e(t,n,r):getAlwaysFalseChecker()}}var operators={$exists:function(e,t){var n=e.segment;return"$any"===n?!!t:"$none"===n?!t:n.externalId===t},$not_exists:function(e,t){var n=e.segment;return"$any"===n?!t:"$none"===n?!!t:n.externalId!==t}};function getMindboxProductItemSegmentChecker(e){return function(t,n,r,i){return operators[t.operator]?function(n,r){var o=e(t.id+"."+r.id,i,t.value.segmentation.externalId);return o.promise.then(().catch(alwaysFalse).then((),:getAlwaysFalseChecker()}}var productItemSegmentsCache={_segments:[],get:function(e,t){return _.find(this._segments,()},set:function(e){var t=e.productItem,n=e.segmentationId,r=e.segmentId,i=e.ts,o=_.filter(this._segments,(function(e){return!(e.segmentationId===n&&productItemIsEqual(e.productItem,t))}));o.push({productItem:t,segmentationId:n,segmentId:r,ts:i}),this._segments=o},clear:;function normalizeRequestProductItem(e){return _.mapObject(e,(function(e){return{ids:_.mapObject(e.ids,()}}))}Dispatcher.on("destroy",(function(){productItemSegmentsCache.clear()}));var productItemSegmentationsBatcher={_initDelay:200,_interval:2e3,_items:[],_batches:[],_isRunning:!1,addItem:function(e){productItemSegmentationsBatcher._items.push(e),productItemSegmentationsBatcher._isRunning||(productItemSegmentationsBatcher._isRunning=!0,setTimeout((function(){productItemSegmentationsBatcher._run()}),productItemSegmentationsBatcher._initDelay))},cancelItem:_hasNotProcessedProductItemSegmentation:function(e){return!_.some(productItemSegmentationsBatcher._batches,()},_getNotProcessedItems:function(){return _.filter(productItemSegmentationsBatcher._items,(function(e){return productItemSegmentationsBatcher._hasNotProcessedProductItemSegmentation(e.productItemSegmentation)}))},_hasNotProcessedItems:function(){return _.some(productItemSegmentationsBatcher._items,()},_run:function(){productItemSegmentationsBatcher._isRunning=!0;var e=[],t=[],n=[];if(_.forEach(productItemSegmentationsBatcher._getNotProcessedItems(),(function(r){var i=_.find(e,(),o=_.find(t,(),a=!i&&e.length<50,s=!o&&t.length<10;(a||i)&&(s||o)&&(a&&e.push(normalizeRequestProductItem(r.productItemSegmentation.productItem)),s&&t.push({ids:{externalId:r.productItemSegmentation.segmentationId}}),n.push(r.productItemSegmentation))})),n.length){var r=[],i=[];_.forEach(e,(),productItemSegmentationsBatcher._batches.push(n),window.mindbox("helpers.checkProductSegments",{products:r,productGroups:i,segmentations:t,onSuccess:function(r){var i=buildResponse(e,t,r);productItemSegmentation.remove((function(e){return!e.productItem||!!_.find(i,(function(t){return productItemSegmentationIsEqual(e,t)}))})).then((function(){return productItemSegmentation.push(i)}),(),_.forEach(n,(function(e,t){for(var n=productItemSegmentationsBatcher._items.length-1,r=function(){var r=productItemSegmentationsBatcher._items[n];if(productItemSegmentationIsEqual(e,r.productItemSegmentation)){var o=_.find(i,(function(e){return productItemSegmentationIsEqual(e,r.productItemSegmentation)}));r.onSuccess(o),productItemSegmentationsBatcher._items.splice(n,1)}productItemSegmentationsBatcher._batches.splice(t,1),n-=1};n>=0;)r()})),productItemSegmentationsBatcher._batches=_.filter(productItemSegmentationsBatcher._batches,()}})}productItemSegmentationsBatcher._hasNotProcessedItems()?setTimeout((,productItemSegmentationsBatcher._interval):productItemSegmentationsBatcher._isRunning=!1}};function buildResponse(e,t,n){var r=+Date.now();return e.reduce((function(e,i){var o=n.find((function(e){return productItemIsEqual(e,i)}))||{productItem:i,segmentations:[]};return t.forEach((function(t){var n=o.segmentations.find(();e.push({productItem:i,segmentationId:t.ids.externalId,segmentId:n&&n.segment&&(n.segment.externalId||n.segment.ids&&n.segment.ids.externalId)||null,ts:r})})),e}),[])}function productItemSegmentationIsEqual(e,t){return productItemIsEqual(e.productItem,t.productItem)&&e.segmentationId===t.segmentationId}var mbProductItemSegmentationsFetch=function(e){var t=_.map(e.productItemSegmentations,(function(t,n){var r=null,i=new Promise((function(e){r=e}));return{id:e.id+"["+n+"]",productItemSegmentation:t,onSuccess:r,promise:i}}));return{promise:new Promise((function(e){_.forEach(t,(),Promise.all(_.map(t,(function(e){return e.promise}))).then(e)})),cancel:function(){_.forEach(t,()}}},PRODUCT_SEGMENT_CACHE_EXPIRY_TIMEOUT=864e5,getSegmentId$1=function(e,t,n){var r={promise:Promise.resolve(null),cancel:null},i=productItemSegmentsCache.get(t,n);return void 0!==i&&+Date.now()-i.ts<PRODUCT_SEGMENT_CACHE_EXPIRY_TIMEOUT?(r.promise=Promise.resolve(i.segmentId),r):(r.promise=productItemSegmentation.find((,+Date.now()-PRODUCT_SEGMENT_CACHE_EXPIRY_TIMEOUT).then((function(i){if(i)return i.segmentId;var o=mbProductItemSegmentationsFetch({id:e,productItemSegmentations:[{productItem:t,segmentationId:n}]});return r.cancel=o.cancel,o.promise.then((function(e){var r=e[0],i=r?r.segmentId:null;return productItemSegmentsCache.set({productItem:t,segmentationId:n,segmentId:i,ts:r.ts}),i}))})),r)},mindboxProductAggregatedCondition$1={aggregators:{$exists:function(e,t){getMindboxKnownPageDataPromise().then((function(n){var r=getProductItemFromPageData(n);if(r)return t(r).then(e);e({result:!1,final:!0})})).catch((function(t){"NoMindboxTracker"===t.type&&e({result:!1,final:!0})}))},$not_exists:function(e,t){getMindboxKnownPageDataPromise().then((function(n){var r=getProductItemFromPageData(n);if(r)return t(r).then((function(t){e({result:!t.result,final:t.final})}));e({result:!0,final:!0})})).catch((function(t){"NoMindboxTracker"===t.type&&e({result:!1,final:!0})}))}},getFieldValues:function(e){return{productId:function(){var t=getIdsFromProductItem(e);return t&&getMindboxIdsExternalId(t)||""}}},fieldCheckers:{mindboxProductSegment:getMindboxProductItemSegmentChecker(getSegmentId$1)}},setPopMechanicVisitIsCompleted,popMechanicVisitIsCompletedPromise=new Promise((function(e){setPopMechanicVisitIsCompleted=e})),setMindboxVisitIsCompleted,mindboxVisitIsCompletedPromise=new Promise(();function reportVisit(e){visit.push(e).then((function(e){if(!e)return Promise.reject();getPageDataPromise().then((function(t){return t?visit.enrich(e,{pagetype:t.type,product:t.product,category:t.category}):Promise.reject()})).then((function(){return setPopMechanicVisitIsCompleted()}),(function(){return setPopMechanicVisitIsCompleted()})),getMindboxKnownPageDataPromiseOrNull().then((function(t){return t?visit.enrich(e,{productItem:getProductItemFromPageData(t),categoryIds:t.category?t.category.ids:null}):Promise.reject()})).then((function(){return setMindboxVisitIsCompleted()}),()})).catch((function(e){setPopMechanicVisitIsCompleted(),setMindboxVisitIsCompleted(),debug.log(e)}))}var getNLatestProductItemsNotQueued=function(e){return void 0===e&&(e=10),db?new Promise((function(t){var n=[];db.transaction(HISTORY_STORE_ID).objectStore(HISTORY_STORE_ID).openCursor(null,["prev"]).onsuccess=function(r){var i=r.target.result;if(i){var o=i.value.productItem;if(o)!_.find(n,()&&n.push(o);n.length>=e&&t(n),i.continue()}else t(n)}})):Promise.reject()},getNLatestProductItems=enqueued(getNLatestProductItemsNotQueued),visitIsCompletedPromise=globalUtils.waitPromisesOrDelay([getMindboxKnownPageDataPromiseOrNull()]),lastProductItemsCache={isInitialized:!1,items:[]},PRODUCT_ITEM_SEGMENT_CACHE_EXPIRY_TIMEOUT=864e5;Dispatcher.on("destroy",(function(){lastProductItemsCache={isInitialized:!1,items:[]}}));var cacheProductItemSegmentations=function(e){underscore.exports.forEach(e,()},getUncachedProductItems=function(e,t){return underscore.exports.filter(e,(function(e){var n=productItemSegmentsCache.get(e,t);return!(n&&+Date.now()-n.ts<PRODUCT_ITEM_SEGMENT_CACHE_EXPIRY_TIMEOUT)}))},updateLastProductItemsCache=function(){return lastProductItemsCache.isInitialized?Promise.resolve(null):getNLatestProductItems(10).then((function(e){lastProductItemsCache.items=e}))},updateProductItemSegmentationCache=function(e,t,n){var r={promise:Promise.resolve(),cancel:null};return t.length&&(r.promise=productItemSegmentation.filter((function(e){return e.segmentationId===n&&!!underscore.exports.find(t,()}),+Date.now()-PRODUCT_ITEM_SEGMENT_CACHE_EXPIRY_TIMEOUT).then((function(i){var o=underscore.exports.filter(t,(function(e){return!underscore.exports.find(i,()}));if(cacheProductItemSegmentations(i),o.length){var a=mbProductItemSegmentationsFetch({id:e,productItemSegmentations:underscore.exports.map(o,()});return r.cancel=a.cancel,a.promise.then(cacheProductItemSegmentations)}return Promise.resolve(null)}))),r},getSegmentId=function(e,t,n){var r={promise:Promise.resolve(null),cancel:null};return r.promise=visitIsCompletedPromise.then(updateLastProductItemsCache).then((function(){var i=getUncachedProductItems(lastProductItemsCache.items,n);if(i.length){var o=updateProductItemSegmentationCache(e,i,n);return r.cancel=o.cancel,o.promise.then(()}return productItemSegmentsCache.get(t,n).segmentId})),r},mindboxProductAggregatedCondition={aggregators:{$exists:function(e,t,n,r){r.productItem?t(r.productItem).then(e):e({result:!1,final:!0})},$not_exists:function(e,t,n,r){r.productItem?t(r.productItem).then((function(t){e({result:!t.result,final:t.final})})):e({result:!0,final:!0})}},getFieldValues:function(e){return{productId:function(){var t=getIdsFromProductItem(e);return t&&getMindboxIdsExternalId(t)||""}}},fieldCheckers:{mindboxProductSegment:getMindboxProductItemSegmentChecker(getSegmentId)}};function mindboxCategoryIdChecker(e,t,n,r){return r&&"$in"===e.operator?function(t){return t({result:_.some(e.value,(function(e){var t={};return t[e.externalSystemName]=e.externalId,mindboxIdsIsEqual(t,r)})),final:!0}),null}:getAlwaysFalseChecker()}var mindboxCategoryAggregatedCondition$1={aggregators:{$exists:function(e,t,n,r){r.categoryIds?t(r.categoryIds).then(e):e({result:!1,final:!0})},$not_exists:function(e,t,n,r){r.categoryIds?t(r.categoryIds).then((function(t){e({result:!t.result,final:t.final})})):e({result:!0,final:!0})}},fieldCheckers:{mindboxCategoryId:mindboxCategoryIdChecker},getFieldValues:function(e){return{categoryId:function(){return getMindboxIdsExternalId(e)||""}}}},visitIsCompleted=visitedPagesAggregatedCondition={aggregators:{$count:function(e,t,n){visitIsCompleted().then((function(){return visit.count((function(e){return t(e).then(_.property("result"))})).catch(().then((function(t){var r=fieldOperators[n.operator]||alwaysFalse;e({result:r(n.value,t),final:!0})}))}))},$anyOf:function(e,t){visitIsCompleted().then((function(){return visit.find((function(e){return t(e).then(_.property("result"))})).catch(_.constant(null)).then((function(t){e({result:!!t,final:!0})}))}))},$noneOf:function(e,t){visitIsCompleted().then((function(){return visit.find(().catch(_.constant(null)).then((function(t){e({result:!t,final:!0})}))}))}},getFieldValues:function(e){return{url:productId:function(){return e.product&&e.product.id?e.product.id.toString():""},productName:function(){return e.product&&e.product.name},productCategoryId:function(){return e.product&&e.product.categoryId?e.product.categoryId.toString():""},productBrandName:function(){return e.product&&e.product.brand},productPrice:function(){return e.product&&e.product.price},productPriceWithDiscount:productDiscount:function(){return e.product&&e.product.price>e.product.priceWithDiscount?100*(e.product.price-e.product.priceWithDiscount)/e.product.price:0},categoryId:time_passed:function(t){if("$current_session"===t.value)return e.vst;var n=Date.now();return Math.floor((n-e.ts)/1e3)}}},conditionMappers:{productId:function(e){return e?e.toString():""},productCategoryId:function(e){return e?e.toString():""},categoryId:url:time_passed:,aggregatedConditions:{mindboxProduct:mindboxProductAggregatedCondition,mindboxCategory:mindboxCategoryAggregatedCondition$1}},mindboxCategoryAggregatedCondition={aggregators:{$exists:function(e,t){return getMindboxKnownPageDataPromise().then((function(n){n&&n.category?t(n.category.ids).then(e):e({result:!1,final:!0})}))},$not_exists:function(e,t){return getMindboxKnownPageDataPromise().then((function(n){n&&n.category?t(n.category.ids).then((function(t){e({result:!t.result,final:t.final})})):e({result:!0,final:!0})}))}},fieldCheckers:{mindboxCategoryId:mindboxCategoryIdChecker},getFieldValues:function(e){return{categoryId:}};function getProductItem(e){return e.product?_.pick(e,"product"):e.productGroup?_.pick(e,"productGroup"):null}var onCartChange=function(e,t,n){var r=null,i=_.debounce((function(i){var o=_.uniqueId(e);r=o;t(i,()}),2e3);onPageDataChange((function(e){e&&(e.type===NO_MINDBOX_TRACKER_TYPE&&i(null),e.cart&&i(e.cart))}))};function groupHasCondition(e){return _.some(e.nodes,(function(e){return!!e.field||groupHasCondition(e)}))}var mindboxCartAggregatedCondition={aggregators:{$count:function(e,t,n){onCartChange(n.id,(function(e,r){e||r({result:!1,final:!1});var i=fieldOperators[n.operator]||alwaysFalse;if(groupHasCondition(n.filter)){var o=0,a=[];_.forEach(e,(function(e){a.push(t(getProductItem(e)).then(())})),Promise.all(a).then((function(){r({result:i(n.value,o),final:!1})}))}else{var s=_.reduce(e,(,0);r({result:i(n.value,s),final:!1})}}),e)},$countDistinct:function(e,t,n){onCartChange(n.id,(function(e,r){e||r({result:!1,final:!1});var i=fieldOperators[n.operator]||alwaysFalse;if(groupHasCondition(n.filter)){var o=0,a=[];_.forEach(e,(function(e){a.push(t(getProductItem(e)).then(())})),Promise.all(a).then((function(){r({result:i(n.value,o),final:!1})}))}else{var s=_.reduce(e,(,0);r({result:i(n.value,s),final:!1})}}),e)},$priceSum:function(e,t,n){onCartChange(n.id,(function(e,r){e||r({result:!1,final:!1});var i=fieldOperators[n.operator]||alwaysFalse;if(groupHasCondition(n.filter)){var o=0,a=[];_.forEach(e,(function(e){a.push(t(getProductItem(e)).then((function(t){t.result&&(o+=e.priceOfLine||e.pricePerItem*e.count||0)})))})),Promise.all(a).then((function(){r({result:i(n.value,o),final:!1})}))}else{var s=_.reduce(e,(function(e,t){return e+=t.priceOfLine||t.pricePerItem*t.count||0}),0);r({result:i(n.value,s),final:!1})}}),e)},$anyOf:function(e,t,n){onCartChange(n.id,(function(e,r){if(e||r({result:!1,final:!1}),!groupHasCondition(n.filter)&&e.length)r({result:!0,final:!1});else{var i=[];_.forEach(e,(function(e){i.push(t(getProductItem(e)).then((function(e){return e.result?Promise.reject():Promise.resolve()})))})),Promise.all(i).then((function(){r({result:!1,final:!1})})).catch((function(){r({result:!0,final:!1})}))}}),e)},$noneOf:function(e,t,n){onCartChange(n.id,(function(e,r){if(e||r({result:!1,final:!1}),groupHasCondition(n.filter)||e.length){var i=[];_.forEach(e,(function(e){return i.push(t(getProductItem(e)).then((function(e){return e.result?Promise.reject():Promise.resolve()})))})),Promise.all(i).then((function(){r({result:!0,final:!1})})).catch((function(){r({result:!1,final:!1})}))}else r({result:!0,final:!1})}),e)},$every:function(e,t,n){onCartChange(n.id,(function(e,r){if(e||r({result:!1,final:!1}),groupHasCondition(n.filter)){var i=[];_.forEach(e,(function(e){i.push(t(getProductItem(e)).then(())})),Promise.all(i).then((function(){r({result:!0,final:!1})})).catch(()}else r({result:!!e.length,final:!1})}),e)}},fieldCheckers:{mindboxProductSegment:getMindboxProductItemSegmentChecker(getSegmentId$1)}},aggregatedConditions={mindboxProduct:mindboxProductAggregatedCondition$1,mindboxCategory:mindboxCategoryAggregatedCondition,visited_pages:visitedPagesAggregatedCondition,"visited-pages":visitedPagesAggregatedCondition,mindboxCart:mindboxCartAggregatedCondition};function aggregatedConditionChecker(e,t,n){return void 0===t&&(t=aggregatedConditions),function(r,i){var o=t[e.field],a=o.aggregatedConditions;return o.aggregators[e.aggregator]((,(function(t){return new Promise((function(n){var r=stateWrapper(getFieldChecker(e.filter,o.getFieldValues&&o.getFieldValues(t),underscore.exports.extend({},conditionMappers,o.conditionMappers||{}),a,t,o.fieldCheckers),i,().getValue}))}),e,n),null}}var defaultFieldCheckers={default:defaultChecker,cart:cartChecker,datetime:timedChecker,datetime_utc:timedChecker,day_of_week:timedChecker,time:timedChecker,time_utc:timedChecker,dom_element:domElementChecker,js:jsChecker,form_completed:formEventsChecker,form_seen:formEventsChecker,form_uncompleted:formEventsChecker,mindbox_segment:mindboxSegmentChecker,google_optimize:promiseChecker,visited_url:promiseChecker,country:promiseChecker,region:promiseChecker,city:promiseChecker,page:allowArraysInCondition(defaultChecker),productId:allowArraysInCondition(promiseChecker),productName:allowArraysInCondition(promiseChecker),productCategoryId:allowArraysInCondition(promiseChecker),productBrandName:allowArraysInCondition(promiseChecker),productPrice:promiseChecker,productPriceWithDiscount:promiseChecker,productDiscount:promiseChecker,categoryId:allowArraysInCondition(promiseChecker),time_passed:promiseChecker,url:allowArraysInCondition(defaultChecker)};function getFieldChecker(e,t,n,r,i,o){void 0===t&&(t=fieldValues),void 0===n&&(n=conditionMappers),void 0===r&&(r=aggregatedConditions),void 0===i&&(i=void 0),void 0===o&&(o=defaultFieldCheckers);var a=null;return(a=e.hasOwnProperty("nodes")?groupChecker(e,t,n,r,i,o):e.hasOwnProperty("filter")&&underscore.exports.includes(underscore.exports.keys(r),e.field)?aggregatedConditionChecker(e,r,i):o.hasOwnProperty(e.field)?o[e.field](e,t,n,i):defaultFieldCheckers.default(e,t,n,i)).id=e.id,window.PopMechanic.debugMode||(a.source=JSON.stringify(e)),a}function initTargeting(e,t,n){return new Promise((function(r){e||r((function(){return"function"==typeof n&&queueMicrotask((),{result:!0,final:!0}}));var i=stateWrapper(getFieldChecker(e),t,().getValue}))}var promiseCache={};function checkTargeting$1(e,t,n){if(promiseCache.hasOwnProperty(t.id))return promiseCache[t.id];var r=Promise.resolve(initTargeting(e,t,n)).then(().catch(();return promiseCache[t.id]=r,r}Dispatcher.on("destroy",();var NewTargeting={init:initTargeting,check:checkTargeting$1};function check(e,t){return e.isEmbedded()||e.isStatic()?checkTargeting(e,t):e.isAlways()?Promise.resolve(!0):checkTargeting(e,t)}function checkTargeting(e,t){return NewTargeting.check(e&&e.newTargeting&&e.newTargeting.filter,e,t)}var Targeting={check:check},AbstractBehavior$1=inherit({__constructor:function(e,t){void 0===t&&(t={}),this.formId=e.form.id,this.onBeforeRenderRejectIsDebuggable=!0,this._dependencies=t,this._device=device$1.mobile()?"mobile":device$1.tablet()?"tablet":"desktop",this._getDeviceSettings=this._getDeviceSettings.bind(this)},_dependencies:{},_device:null,_getContainer:_getForm:function(e){return this._getContainer(e).find("#"+CONFIG.CSS_PREFIX+"form-"+this.formId)},_filterForm:function(e){return e.filter("#"+CONFIG.CSS_PREFIX+"form-"+this.formId)},_runAnimation:function(e,t,n){e.addClass(CONFIG.CSS_PREFIX+t).addClass(CONFIG.CSS_PREFIX+"animated").addClass(CONFIG.CSS_PREFIX+"fastest"),setTimeout((function(){return e.removeClass(CONFIG.CSS_PREFIX+"animated").removeClass(CONFIG.CSS_PREFIX+"fastest").removeClass(CONFIG.CSS_PREFIX+t),"function"==typeof n&&n()}),CONFIG.ANIMATION_SPEED)},_getDeviceSettings:function(e){return e[this._device]?e[this._device]:e.desktop?e.desktop:e||{}},getSettings:function(){},onTargetingReady:function(){},onBeforeRender:function(){},onRender:function(){},shouldRender:function(){return!0},onShow:function(){},onBeforeClose:function(){},onClose:function(){},onSuccess:function(){},onFail:function(){},onInit:function(e){}}),AlwaysBehavior=inherit(AbstractBehavior$1,{}),AbstractConditionedBehavior=inherit(AbstractBehavior$1,{__constructor:onInit:function(e){var t=e.form;cash("body").on("click","[data-"+CONFIG.CSS_PREFIX+'call-form="'+t.id+'"]',(function(){("ignore_targeting"===t.conditions.conditions.only_forced||t.inTargeting)&&e.show(!0)}))},onTargetingReady:function(e){var t=this,n=e.form;n.checkConditions().then(().catch(()}}),overlayForms=[],addOverlay=function(e,t){overlayForms=_.union(overlayForms,[{id:e,allowOverlay:t}])},removeOverlay=function(e){var t=overlayForms.find((function(t){return t.id===e}));overlayForms=_.without(overlayForms,t)},isOverlayPresent=isOverlayBlocked=defaultAnimationsIn$1={top:"fadeInUp",bottom:"fadeInDown",left:"fadeInLeft",right:"fadeInRight"},defaultAnimationsOut$1={top:"fadeOutUp",bottom:"fadeOutDown",left:"fadeOutLeft",right:"fadeOutRight"};function getStyles(e){return"top"===e.position?{top:0,left:0,right:0,"margin-top":e.offset}:"bottom"===e.position?{bottom:0,left:0,right:0,"margin-bottom":e.offset}:"left"===e.position?{left:0,top:0,bottom:0,"margin-left":e.offset}:"right"===e.position?{right:0,top:0,bottom:0,"margin-right":e.offset}:{}}var BannerBehavior=inherit(AbstractConditionedBehavior,{__constructor:function(e){this.__base(e),this.settings=_.defaults({},e.form.settings.behavior_settings.banner,{position:"bottom",allow_overlay:!0,offset:0}),this.settings.animation_in||(this.settings.animation_in=defaultAnimationsIn$1[this.settings.direction]),this.settings.animation_out||(this.settings.animation_out=defaultAnimationsOut$1[this.settings.direction]),this.staticStyles=getStyles(this.settings)},shouldRender:function(){return!isOverlayBlocked()&&!(isOverlayPresent()&&!this.settings.allow_overlay)},onRender:function(e,t,n){if(!this.shouldRender())return Promise.reject();addOverlay(this.formId,this.settings.allow_overlay);var r=this._filterForm(e),i=cash('<div class="'+CONFIG.CSS_PREFIX+'js-wrapper"></div>');this._$formWrapper=i,n.append(i);var o={display:"block","z-index":100000002,position:"fixed","text-align":"left"};_.extend(o,this.staticStyles),i.css(o),r.css({position:"relative",width:"100%",height:"100%"})},onShow:function(e,t){var n=this._getForm(e);this._$formWrapper.append(n),this._runAnimation(n,this.settings.animation_in),n.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))}))},onClose:function(e){var t=this;removeOverlay(t.formId);var n=this._getForm(e);return new Promise((function(r){t._runAnimation(n,t.settings.animation_out,(function(){e.css({position:"static",height:0,"min-height":0}),r()}))}))},onSuccess:function(){},onFail:function(){}}),defaultSettings={on:!1,positions:{mobile:{},tablet:{},desktop:{}},show_before:!0},ButtonBehavior=inherit(AbstractBehavior$1,{onInit:function(e){var t=null,n=null,r=e.form.button_template,i=cash.extend({},e.form.settings.settings,e.form.settings.button_settings),o=e.form.id+".button-hidden",a=_.defaults({},e.form.settings.behavior_settings.button,defaultSettings),s=cash.extend({},i,{desktop:device$1.desktop(),tablet:device$1.tablet(),mobile:device$1.mobile()});if(this.behavior_settings=a,this.form=e.form,this.isFormOpened=!1,a.on){e.form.settings.button_html&&(r.html=e.form.settings.button_html),e.form.settings.button_css&&(r.css=e.form.settings.button_css);try{t=cash(containerizeHtml(_.template(r.html)(s),e.form.id))}catch(e){return}try{n=cash("<style>"+containerizeCss(_.template(r.css)(s),e.form.id)+"</style>")}catch(e){return}var c=_.defaults({zIndex:100000002},this._getDeviceSettings(a.positions));if(t.css(c),t.css({position:"fixed"}),t.hide(),this._$button=t,this._$style=n,this._$button.show=function(){this[0].style.display=""},!Session.get(o))"always"===this.behavior_settings.conditions&&t.show(),getContainer(e.form.id).append(t).append(n),t.on("click",(),t.find("[data-popmechanic-close-button]").on("click",(function(e){t.hide(),Session.set(o,!0),e.stopPropagation()}))}},onTargetingReady:function(){var e=this;e.behavior_settings.on&&"targeting"===e.behavior_settings.conditions&&(e.form.inTargeting&&e._$button.show(),e.form.onTargetingChange((function(t){"targeting"===e.behavior_settings.conditions&&(t&&!e.isFormOpened?e._$button.show():e._$button.hide())})))},onShow:onClose:function(){this.behavior_settings.on&&(this.isFormOpened=!1,(this.form.inTargeting||"always"===this.behavior_settings.conditions||"on_close"===this.behavior_settings.conditions)&&this._$button.show())},onSuccess:),CopyCodeBehavior=inherit(AbstractBehavior$1,{__constructor:!"},onShow:function(e,t){try{var n=this;this.$elem=e;var r=e[0].querySelectorAll("[data-"+CONFIG.CSS_PREFIX+"copy]");_.eCopy(t))}))}catch(e){}},_getHandleCopy:function(e){var t=this,n=t.successText;return function(r){r.preventDefault();var i=this;try{var o=this.dataset[CONFIG.DATASET_PREFIX+"Copy"],a=t.$elem.find("[data-"+CONFIG.CSS_PREFIX+'copy-source="'+o+'"]').text()||"";if(a=a.trim(),navigator.clipboard)navigator.clipboard.writeText(a.trim()).then((function(){i.innerHTML=n,Dispatcher.trigger("copyCode",{form:e.form})}));else{var s=document.createElement("textarea");s.value=a,s.setAttribute("readonly",""),s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s),s.select(),s.setSelectionRange(0,a.length+1),document.execCommand("copy"),document.body.removeChild(s),i.innerHTML=n,Dispatcher.trigger("copyCode",{form:e.form})}}catch(e){}}}}),embedElement=function(e){var t=e.$element,n=e.$target,r=e.placement,i="#"+t[0].id;switch(r){case"before":var o=n.prev();o&&cash(o).is(i)&&o.remove(),n.before(t);break;case"after":var a=n.next();a&&cash(a).is(i)&&a.remove(),n.after(t);break;case"start":var s=n.children()[0];s&&cash(s).is(i)&&s.remove(),n.prepend(t);break;default:case"end":var c=n.children(),u=n.children()[c.length-1];u&&cash(u).is(i)&&u.remove(),n.append(t)}},EmbeddedBehavior$1=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e);var t=e.form.settings.behavior_settings.embedded||{},n=this._getDeviceSettings(t);this.settings=_.defaults({},n,t,{animation_out:"fadeOut"})},onShow:function(e,t,n){var r=this._getForm(e);embedElement({$element:e,$target:n,placement:t.placement}),r.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))}))},onClose:function(e){var t=this,n=t._getForm(e);return new Promise((function(e){t._runAnimation(n,t.settings.animation_out,(function(){e()}))}))},onSuccess:function(){},onFail:function(){}}),FacebookBehavior=inherit(AbstractBehavior$1,{onRender:function(e,t){return new Promise((function(e){var t=null;t=seerval(t))}),100)}))},onShow:function(e,t){var n=e.find("#popmechanic-form-"+t.form.id)[0],r=function(e,n){t.form.report("social-like"),t.success({social:!0,type:t.form.settings.behavior_settings.social.type}),Session.setContactsSent(),FB.Event.unsubscribe("edge.create",r)};FB.XFBML.parse(n),FB.Event.subscribe("edge.create",r)}}),childrenTargetingHandlers={},initListenerOnce,initListener=function(){function e(e,t){var n=t.form;childrenTargetingHandlers[n.id]&&childrenTargetingHandlers[n.id](n,n.inTargeting)}function t(e,t){var n=t.form;childrenTargetingHandlers[n.id]&&childrenTargetingHandlers[n.id](n,!1)}Dispatcher.on("targeting",e),Dispatcher.on("formClose",t),Dispatcher.on("destroy",(function(){initListenerOnce=_.once(initListener),Dispatcher.off("targeting",e),Dispatcher.off("formClose",t)}))};initListenerOnce=_.once(initListener);var FormContainerBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){var t=this;this.__base(e);var n=this;n.form=e,this.childrenDisplayQueue=[],this.childForms=e.form.childForms;try{this._onChildReady=new Function("form","child","children",e.form.template.on_child_ready)}catch(e){console.error(e),this._onChildReady=_.identity}this.children=this.childForms.map(window.PopMechanic.getModel).filter(_.identity),this.children.filter((function(e){return e.inTargeting})ady(e)}))}));for(var r=function(e){var r=t.children[e],i=r.id;childrenTargetingHy(r,t)}))}},i=0;i<t.children.length;i++)r(i);initListenerOnce()},_getAvailableChildren:function(){var e=this.children.filter((function(e){return e.inTargeting})),t=e.map((function(e){return e.checkFrequency()}));return Promise.all(t).then((function(t){rete[n]:null})).filter((function(e){return!!e}))}))},onChildReady:function(e,t){var n=this;n._getAvailableChildren().then((function(r){vaetView(t)}));try{var o=window.PopMechanic.getView(e.id);n._onChildReady(n.form,t?o:null,i)}catch(e){console.error(e)}}))},onShow:function(){var e=this;setTimeout((function(){for(;e.childrenDisplayQueue.length;){e.childrenDisplayQueue.shift()()}e.childrenDisplayQueue.push=function(e){e()}}),100)}}),FullscreenBehavior=inherit(AbstractConditionedBehavior,{__constructor:function(e){this.__base(e);var t=_.defaults({},e.form.settings.behavior_settings.fullscreen||{allow_overlay:!0});this.allowOverlay=t.allow_overlay},_prepareAnimation:function(e){var t={};t["margin-top"]=-Math.max(window.innerWidth,window.innerHeight),e.css(t)},_runAnimation:function(e,t){var n={"margin-top":0};e.animate(n,t)},shouldRender:function(){return!isOverlayBlocked()&&!(isOverlayPresent()&&!this.allowOverlay)},onRender:function(e){if(!this.shouldRender())return Promise.reject();addOverlay(this.formId,this.allowOverlay);var t=this._filterForm(e);t.css({display:"block","z-index":100000002,position:"absolute",margin:"0",top:0,left:0,bottom:0,right:0}),this._prepareAnimation(t)},onShow:function(e,t){var n=this._getForm(e),r=this._getContainer(e),i=this;disableScroll(),setTimeout((function(){r.css({position:"fixed",top:0,left:0,right:0,bottom:0,"text-align":"center",height:"auto",overflow:"auto","z-index":1e8}),i._runAnimation(n,(function(){n.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))})),cash(document).on("keyup",(function(e){27==e.keyCode&&t.close()}))}))}),10)},onClose:function(e){removeOverlay(this.formId);var t=this._getContainer(e);e.animate({top:"-50%"},(function(){t.css({position:"static",height:0,"min-height":0}),enableScroll()}))},onSuccess:function(){},onFail:function(){}}),HumbleBehavior=inherit(AbstractBehavior$1,{onShow:function(e,t){e.find("[data-"+CONFIG.CSS_PREFIX+"stop]").ot.close()}))}}),InfoBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e)},onShow:function(e,t){var n=this,r="#zuck-modal-slider-popmechanic-form-"+t.form.id+"-zuck-container",i="[data-"+CONFIG.CSS_PREFIX+"submit]",o="[data-"+CONFIG.CSS_PREFIX+"link]";cash("body").on("click",r+" "+i+","+r+" "+o,(function(){n._onClick(t)})),e.find(i+", "+o).on("click",(function(){n._onClick(t)}))},_onClick:function(e){e.form.report("follow"),Session.setCompleted(e.form.id),Dispatcher.trigger("lead",{form:e.form,lead:{form:e.form.id}})},onBeforeClose:function(e,t,n){n.showSuccess||(Dispatcher.trigger("cancel",{form:t.form.id}),event.push({type:"info-cancel",form:t.form.id}),Session.setUncompleted(t.form.id))}});function report(e){event.push({type:e.type,vst:getVisit(),ts:Date.now(),form:e.form})}var SBJS_ALIASES={source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},fieldMappers={phone:function(e){return e.replace(/\D/g,"")}},Lead=inherit({__constructor:function(e,t){var n=this;if(this.updateDeviceUUID(),this._data=e,this._data.form=this._data.id=t.id,this._data.form_name=t.name,this._sendContactsIntegrations=t.sendContactsIntegrations,t.settings&&(this._data.settings=t.settings.id),t.conditions&&(this._data.conditions=t.conditions.id),this._data.device=device$1.mobile()?"mobile":device$1.tablet()?"tablet":"pc",this._data.source=(sbjs.get.current.typ||"").split("|")[0],"file:"!==location.protocol&&(this._data.url=location.href,this._data.domain=location.hostname),this._data.name){var r=this._data.name.replace(/\s\s/g," ").split(" ");r.length>1?(this._data.first_name=r.shift(),this._data.last_name=r.join(" ")):this._data.first_name=r[0]}this._data.customs=this._data.customs||{},Object.keys(this._data).forEach((function(e){fieldMappers[e]&&(n._data[e]=fieldMappers[e](n._data[e])),0===e.indexOf("customs.")&&(n._data.customs[e.substr("customs.".length)]=n._data[e],delete n._data[e])})),window.PopMechanic.customs&&_.extend(this._data.customs,window.PopMechanic.customs),t.custom_fields&&t.custom_fields.forEach((function(e){n._data.customs[e.machine_name]||(n._data.customs[e.machine_name]=e.default_value)})),"utm"===this._data.source?Object.keys(SBJS_ALIASES).forEach((function(e){n._data["utm_"+e]=(sbjs.get.current[SBJS_ALIASES[e]]||"").replace("(none)","")})):n._data.utm_source=(sbjs.get.current[SBJS_ALIASES.source]||"").replace("(none)","")},send:function(e,t){var n=this;return new Promise((function(r,i){n._sendContactsIntegrations&&n._sendContactsIntegrations.length>0?Promise.all(n._sendContactsIntegrations.map((function(e){return e.sendContacts(n._data)n._data))t(e),i(e)})):cash.ajax({url:CONFIG.CONTACTS_URL+window.PopMechanic.client+"/",type:"POST",data:n.getJSON(),contentType:"application/json; charset=utf-){r(e(t(r),i(r)}}),Session.setContactsSent()})is._data)},updateDeviceUUID:function(){window.PopMechanic.mindboxDeviceUUID&&(window.PopMechanic.customs=window.PopMechanic.customs||{},window.PopMechanic.customs.mindboxDeviceUUID=window.PopMechanic.mindboxDeviceUUID)}}),$body=cash("body");Session.isContactsSent("lead")&&$body.addClass(CONFIG.CSS_PREFIX+"submitted"),device$1.mobile()&&$body.addClass(CONFIG.CSS_PREFIX+"mobile"),device$1.tablet()&&$body.addClass(CONFIG.CSS_PREFIX+"tablet"),device$1.desktop()&&$body.addClass(CONFIG.CSS_PREFIX+"desktop");var globalCSS={setState:function(e){cash("body").addClass(CONFIG.CSS_PREFIX+e)}},data=[{mask:"+247-####"},{mask:"+376-###-###"},{mask:"+971-5#-###-####"},{mask:"+971-#-###-####"},{mask:"+93-##-###-####"},{mask:"+1(268)###-####"},{mask:"+1(264)###-####"},{mask:"+355(###)###-###"},{mask:"+374-##-###-###"},{mask:"+599-###-####"},{mask:"+599-###-####"},{mask:"+599-9###-####"},{mask:"+244(###)###-###"},{mask:"+672-1##-###"},{mask:"+54(###)###-####"},{mask:"+1(684)###-####"},{mask:"+43(###)###-####"},{mask:"+61-#-####-####"},{mask:"+297-###-####"},{mask:"+994-##-###-##-##"},{mask:"+387-##-#####"},{mask:"+387-##-####"},{mask:"+1(246)###-####"},{mask:"+880-##-###-###"},{mask:"+32(###)###-###"},{mask:"+226-##-##-####"},{mask:"+359(###)###-###"},{mask:"+973-####-####"},{mask:"+257-##-##-####"},{mask:"+229-##-##-####"},{mask:"+1(441)###-####"},{mask:"+673-###-####"},{mask:"+591-#-###-####"},{mask:"+55-##-####-####"},{mask:"+1(242)###-####"},{mask:"+975-17-###-###"},{mask:"+975-#-###-###"},{mask:"+267-##-###-###"},{mask:"+375(##)###-##-##"},{mask:"+501-###-####"},{mask:"+243(###)###-###"},{mask:"+236-##-##-####"},{mask:"+242-##-###-####"},{mask:"+41-##-###-####"},{mask:"+225-##-###-###"},{mask:"+682-##-###"},{mask:"+56-#-####-####"},{mask:"+237-####-####"},{mask:"+86(###)####-####"},{mask:"+86(###)####-###"},{mask:"+86-##-#####-#####"},{mask:"+57(###)###-####"},{mask:"+506-####-####"},{mask:"+53-#-###-####"},{mask:"+238(###)##-##"},{mask:"+599-###-####"},{mask:"+357-##-###-###"},{mask:"+420(###)###-###"},{mask:"+49(####)###-####"},{mask:"+49(###)###-####"},{mask:"+49(###)##-####"},{mask:"+49(###)##-###"},{mask:"+49(###)##-##"},{mask:"+49-###-###"},{mask:"+253-##-##-##-##"},{mask:"+45-##-##-##-##"},{mask:"+1(767)###-####"},{mask:"+1(809)###-####"},{mask:"+1(829)###-####"},{mask:"+1(849)###-####"},{mask:"+213-##-###-####"},{mask:"+593-##-###-####"},{mask:"+593-#-###-####"},{mask:"+372-####-####"},{mask:"+372-###-####"},{mask:"+20(###)###-####"},{mask:"+291-#-###-###"},{mask:"+34(###)###-###"},{mask:"+251-##-###-####"},{mask:"+358(###)###-##-##"},{mask:"+679-##-#####"},{mask:"+500-#####"},{mask:"+691-###-####"},{mask:"+298-###-###"},{mask:"+262-#####-####"},{mask:"+33(###)###-###"},{mask:"+508-##-####"},{mask:"+590(###)###-###"},{mask:"+241-#-##-##-##"},{mask:"+1(473)###-####"},{mask:"+995(###)###-###"},{mask:"+594-#####-####"},{mask:"+233(###)###-###"},{mask:"+350-###-#####"},{mask:"+299-##-##-##"},{mask:"+220(###)##-##"},{mask:"+224-##-###-###"},{mask:"+240-##-###-####"},{mask:"+30(###)###-####"},{mask:"+502-#-###-####"},{mask:"+1(671)###-####"},{mask:"+245-#-######"},{mask:"+592-###-####"},{mask:"+852-####-####"},{mask:"+504-####-####"},{mask:"+385-##-###-###"},{mask:"+509-##-##-####"},{mask:"+36(###)###-###"},{mask:"+62(8##)###-####"},{mask:"+62-##-###-##"},{mask:"+62-##-###-###"},{mask:"+62-##-###-####"},{mask:"+62(8##)###-###"},{mask:"+62(8##)###-##-###"},{mask:"+353(###)###-###"},{mask:"+972-5#-###-####"},{mask:"+972-#-###-####"},{mask:"+91(####)###-###"},{mask:"+246-###-####"},{mask:"+964(###)###-####"},{mask:"+98(###)###-####"},{mask:"+354-###-####"},{mask:"+39(###)####-###"},{mask:"+1(876)###-####"},{mask:"+962-#-####-####"},{mask:"+81-##-####-####"},{mask:"+81(###)###-###"},{mask:"+254-###-######"},{mask:"+996(###)###-###"},{mask:"+855-##-###-###"},{mask:"+686-##-###"},{mask:"+269-##-#####"},{mask:"+1(869)###-####"},{mask:"+850-191-###-####"},{mask:"+850-##-###-###"},{mask:"+850-###-####-###"},{mask:"+850-###-###"},{mask:"+850-####-####"},{mask:"+850-####-#############"},{mask:"+82-##-###-####"},{mask:"+965-####-####"},{mask:"+1(345)###-####"},{mask:"+7(6##)###-##-##"},{mask:"+7(7##)###-##-##"},{mask:"+856(20##)###-###"},{mask:"+856-##-###-###"},{mask:"+961-##-###-###"},{mask:"+961-#-###-###"},{mask:"+1(758)###-####"},{mask:"+423(###)###-####"},{mask:"+94-##-###-####"},{mask:"+231-##-###-###"},{mask:"+266-#-###-####"},{mask:"+370(###)##-###"},{mask:"+352(###)###-###"},{mask:"+371-##-###-###"},{mask:"+218-##-###-###"},{mask:"+218-21-###-####"},{mask:"+212-##-####-###"},{mask:"+377(###)###-###"},{mask:"+377-##-###-###"},{mask:"+373-####-####"},{mask:"+382-##-###-###"},{mask:"+261-##-##-#####"},{mask:"+692-###-####"},{mask:"+389-##-###-###"},{mask:"+223-##-##-####"},{mask:"+95-##-###-###"},{mask:"+95-#-###-###"},{mask:"+95-###-###"},{mask:"+976-##-##-####"},{mask:"+853-####-####"},{mask:"+1(670)###-####"},{mask:"+596(###)##-##-##"},{mask:"+222-##-##-####"},{mask:"+1(664)###-####"},{mask:"+356-####-####"},{mask:"+230-###-####"},{mask:"+960-###-####"},{mask:"+265-1-###-###"},{mask:"+265-#-####-####"},{mask:"+52(###)###-####"},{mask:"+52-##-##-####"},{mask:"+60-##-###-####"},{mask:"+60(###)###-###"},{mask:"+60-##-###-###"},{mask:"+60-#-###-###"},{mask:"+258-##-###-###"},{mask:"+264-##-###-####"},{mask:"+687-##-####"},{mask:"+227-##-##-####"},{mask:"+672-3##-###"},{mask:"+234(###)###-####"},{mask:"+234-##-###-###"},{mask:"+234-##-###-##"},{mask:"+234(###)###-####"},{mask:"+505-####-####"},{mask:"+31-##-###-####"},{mask:"+47(###)##-###"},{mask:"+977-##-###-###"},{mask:"+674-###-####"},{mask:"+683-####"},{mask:"+64(###)###-###"},{mask:"+64-##-###-###"},{mask:"+64(###)###-####"},{mask:"+968-##-###-###"},{mask:"+507-###-####"},{mask:"+51(###)###-###"},{mask:"+689-##-##-##"},{mask:"+675(###)##-###"},{mask:"+63(###)###-####"},{mask:"+92(###)###-####"},{mask:"+48(###)###-###"},{mask:"+970-##-###-####"},{mask:"+351-##-###-####"},{mask:"+680-###-####"},{mask:"+595(###)###-###"},{mask:"+974-####-####"},{mask:"+262-#####-####"},{mask:"+40-##-###-####"},{mask:"+381-##-###-####"},{mask:"+7(###)###-##-##"},{mask:"+250(###)###-###"},{mask:"+966-5-####-####"},{mask:"+966-#-###-####"},{mask:"+677-###-####"},{mask:"+677-#####"},{mask:"+248-#-###-###"},{mask:"+249-##-###-####"},{mask:"+46-##-###-####"},{mask:"+65-####-####"},{mask:"+290-####"},{mask:"+290-####"},{mask:"+386-##-###-###"},{mask:"+421(###)###-###"},{mask:"+232-##-######"},{mask:"+378-####-######"},{mask:"+221-##-###-####"},{mask:"+252-##-###-###"},{mask:"+252-#-###-###"},{mask:"+252-#-###-###"},{mask:"+597-###-####"},{mask:"+597-###-###"},{mask:"+211-##-###-####"},{mask:"+239-##-#####"},{mask:"+503-##-##-####"},{mask:"+1(721)###-####"},{mask:"+963-##-####-###"},{mask:"+268-##-##-####"},{mask:"+1(649)###-####"},{mask:"+235-##-##-##-##"},{mask:"+228-##-###-###"},{mask:"+66-##-###-####"},{mask:"+66-##-###-###"},{mask:"+992-##-###-####"},{mask:"+690-####"},{mask:"+670-###-####"},{mask:"+670-77#-#####"},{mask:"+670-78#-#####"},{mask:"+993-#-###-####"},{mask:"+216-##-###-###"},{mask:"+676-#####"},{mask:"+90(###)###-####"},{mask:"+1(868)###-####"},{mask:"+688-90####"},{mask:"+688-2####"},{mask:"+886-#-####-####"},{mask:"+886-####-####"},{mask:"+255-##-###-####"},{mask:"+380(##)###-##-##"},{mask:"+256(###)###-###"},{mask:"+44-##-####-####"},{mask:"+598-#-###-##-##"},{mask:"+998-##-###-####"},{mask:"+39-6-698-#####"},{mask:"+1(784)###-####"},{mask:"+58(###)###-####"},{mask:"+1(284)###-####"},{mask:"+1(340)###-####"},{mask:"+84-##-####-###"},{mask:"+84(###)####-###"},{mask:"+678-##-#####"},{mask:"+678-#####"},{mask:"+681-##-####"},{mask:"+685-##-####"},{mask:"+967-###-###-###"},{mask:"+967-#-###-###"},{mask:"+967-##-###-###"},{mask:"+27-##-###-####"},{mask:"+260-##-###-####"},{mask:"+263-#-######"},{mask:"+1(###)###-####"}],Evenput"in e}function isEventProducingCharacter(e){var t=e.key,n=e.ctrlKey,r=e.metaKey,i=e.altKey,o=n||r||i,a=/^(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])$/.test(t);return!o&&"Backspace"!==t&&a}function areElementValuesEqual(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];retur==e.value}))}function areElementStatesEqual(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return t.every((function(t){var n=t.value,r=t.selection;return n===e.value&&r[0]===e.selection[0]&&r[1]===e.selection[1]}))}function getNotEmptySelection(e,t){var n=e.value,r=e.selection,i=r[0],o=r[1];return i!==o?[i,o]:t?[i,Math.min(o+1,n.length)]:[Math.max{return e}EventListener.prototr(e,i)}))},EventListener.prototyrn e()}))};var Mfuture=[]};function applyOverwriteMode(e,t,n){var r=e.value,i=e.selection,o=i[0],a=i[1];return{value:r,selection:"replace"===("function"==typeof n?n({value:r,selection:i}):n)?[o,o+t.leng=typeof e}function getLeadingFixedCharacters(e,t,n,r){for(var i="",o=t.length;o<e.length;o++){var a=e[o],s=r.value[o]===a;if(!isFixedCharacter(a)||a===n&&!s)return i;i+=a}return i}function guessValidValueByPattern(e,t,n){var r=null,i=null,o=Array.from(e.valuh),c+a):c}),"");return{value:o,selection:[null!=r?r:o.length,null!=i?i:o.length]}}function guessValidValueByRegExp(e,t){var n=e.value,r=e.selection,i=r[0],o=r[1],a=i,s=o;return{value:Array.from(ch(t)?c:e}),""),selection:[a,s]}}function validateValueWithMask(e,t){return Array.isArray(t)?e.length<=t.length&&Array.from.match(r)})):t.test(e)}function calibrateValueByMask(e,t,n){if(void 0===n&&(n=e),validateValueWithMask(e.value,t))return e;var r=Array.isArray(t)?guessValidValueByPattern(e,t,n):guessValidValueByRegExp(e,t),i=r.value;return{selection:r.selection,value:Array.isArray(t)?i.slice(0,t.length):i}}function removeFixedMaskCharacters(e,t){if(!Array.isArray(t))return e;var n=e.selection,r=n[0],i=n[1],o=[],a=Array.from(e.valu==n?e:e+n}),"");return o.length<2&&o.push.apply(o,Array(2-o.length).fill(a.length)),{value:a,selection:[o[0],o[1]]}}MaskHistory.prototype.undo=function(){var e=this.past.pop();e&&this.now&&(this.future.push(this.now),this.updateElement(e,"historyUndo"))},MaskHistory.protryRedo"))},MaskHistory.prototype.updateHistory=function(e){if(this.now){var t=this.now.value!==e.value,n=this.now.selecection[n]}));(t||n)&&(t&&(this.past.push(this.now),this.future=[]),this.now=e)}else this.now=e},MaskHistory.prototype.updateElement=function(e,t){this.now=e,this.updateValue(e.value,{inputType:t,data:null}),this.updateSelectionRange(e.selection)};var MaskModel=function(e,t){this.initialElementState=e,this.maskOptions=t,this.value="",this.selection=[0,0];var n=calibrateValueByMask(e,this.getMaskExpression(e)),r=n.value,i=n.selection;this.value=r,this.selection=i};function maskitoTransform(e,t){var n=Object.assign(Object.assign({},MASKITO_DEFAULT_OPTIONS),t),r="string"==typeof e?{value:e,selection:[0,0]}:e,i=n.preprocessor({elementState:r,data:""},"validation").elementState,o=new MaskModel(i,n),a=n.postprocessor(o,r),s=a.value,c=a.selection;return"string"==typeof e?s:{value:s,selection:c}}MaskModel.prototype.addCharacters=function(e,t){var n=e[0],r=e[1],i=this.value,o=this.getMaskExpression({value:i.slice(0,n)+t+i.slice(r),selection:[n+t.length,n+t.length]}),a={value:i,selection:[n,r]},s=removeFixedMaskCharacters(a,o),c=applyOverwriteMode(s,t,this.maskOptions.overwriteMode).selection,u=c[0],l=c[1],d=s.value.slice(0,u)+t+s.value.slice(l),f=u+t.length,h=calibrateValueByMask({value:d,selection:[f,f]},o,a);if(areElementStatesEqual(this,h))throw new Error("Invalid mask value");this.value=h.value,this.selection=h.selection},MaskModel.prototype.deleteCharacters=function(e){var t=e[0],n=e[1];if(t!==n&&n){var r=this.value,i=this.getMaskExpression({value:r.slice(0,t)+r.slice(n),selection:[t,t]}),o={value:r,selection:[t,n]},a=removeFixedMaskCharacters(o,i),s=a.selection,c=s[0],u=s[1],l=calibrateValueByMask({value:a.value.slice(0,c)+a.value.slice(u),selection:[c,c]},i,o);this.value=l.value,this.selection=l.selection}},MaskModel.prototype.getMask t?t(e):t};var MASKITO_DEFAULT_OPTIONS={mask:/^.*$/,preprocessor:identity,postprocessor:identity,overwriteMode:"shift"},Maskito=function(e){function t(t,n){var r=this;e.call(this),this.element=t,this.maskitoOptions=n,this.eventListener=new EventListener(this.element),this.options=Object.assign(Object.assign({},MASKITO_DEFAULT_OPTIONS),this.maskitoOptions),this.conformValueToMask(),this.updateHistory(this.elementState),this.eventListener.listen("keydown",(function(e){var t=e.ctrlKey,n=e.key,i=e.metaKey,o=e.shiftKey;return i&&o&&"z"===n||t&&"y"===n?(e.preventDefault(),r.redo()):(t||i)&&"z"===n?(e.preventDefault(),r.undo()):void 0})),isBeforeInputEventSupported(t)?this.eventListener.listen("beforeinput",(function(e){switch(r.updateHistory(r.elementState),e.inputType){case"historyUndo":return e.preventDefault(),r.undo();case"historyRedo":return e.preventDefault(),r.redo();case"deleteContentBackward":case"deleteWordBackward":case"deleteByCut":return r.handleDelete(e,!1);case"deleteContentForward":case"deleteWordForward":return r.handleDelete(e,!0);case"insertFromDrop":return;case"insertLineBreak":return r.handleEnter(e);case"insertFromPaste":case"insertText":default:return r.handleInsert(e,e.data||"")}})):(this.eventListener.listen("keydown",(function(e){return r.handleKeydown(e)})),this.eventListener.listen"))||"")}))),this.eventListener.listeentState)}))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={elementState:{configurable:!0},isTextArea:{configurable:!0}};return n.elemennEnd||0]}},n.isTe.nodeName},t.prototydestroy()},t.prototype.updateSelectionRange=function(e){var t,n,r=e[0],i=e[1];this.element.selectionStart===r&&this.element.selectionEnd===i||null===(n=(t=this.element).setSelectionRange)||void 0===n||n.call(t,r,i)},t.prototype.updateValue=function(e,t){if(void 0===t&&(t={inputType:"insertText",data:null}),this.element.value!==e){var n="undefined"!=typeof window?window:globalThis;this.element.value=e,(null==n?void 0:n.InputEvent)&&this.element.dispatchEvent(new InputEvent("input",Object.assign(Object.assign({},t),{bubbles:!0,cancelable:!0})))}},t.prototype.handleKeydown=function(e){var t=e.key;switch(t){case"Backspace":case"Delete":return this.handleDelete(e,"Delete"===t);case"Enter":return this.handleEnter(e)}isEventProducingCharacter(e)&&this.handleInsert(e,t)},t.prototype.conformValueToMask=function(){var e=maskitoTransform(this.elementState,this.options),t=e.value,n=e.selection;this.updateValue(t),this.updateSelectionRange(n)},t.prototype.handleDelete=function(e,t){var n={value:this.elementState.value,selection:getNotEmptySelection(this.elementState,t)},r=n.selection,i=r[0],o=r[1],a=this.options.preprocessor({elementState:n,data:""},t?"deleteForward":"deleteBackward").elementState,s=new MaskModel(a,this.options),c=a.selection,u=c[0],l=c[1];s.deleteCharacters([u,l]);var d=this.options.postprocessor(s,n);if(n.value.slice(0,i)+n.value.slice(o)!==d.value){if(e.preventDefault(),areElementValuesEqual(n,a,s,d))return this.updateSelectionRange(t?[l,l]:[u,u]);var f=t?"deleteContentForward":"deleteContentBackward";this.updateValue(d.value,{inputType:"inputType"in e?e.inputType:f,data:null}),this.updateSelectionRange(d.selection),this.updateHistory(d)}},t.prototype.handleInsert=function(e,t){var n=this.elementState,r=this.options.preprocessor({data:t,elementState:n},"insert"),i=r.elementState,o=r.data;void 0===o&&(o=t);var a=new MaskModel(i,this.options);try{a.addCharacters(i.selection,o)}catch(t){return e.preventDefault()}var s=i.selection,c=s[0],u=s[1],l=i.value.slice(0,c)+t+i.value.slice(u),d=this.options.postprocessor(a,n),f=d.value,h=d.selection;l!==f&&(e.preventDefault(),this.updateValue(f,{data:t,inputType:"inputType"in e?e.inputType:"insertText"}),this.updateSelectionRange(h),this.updateHistory({value:f,selection:h}))},t.prototype.ht(e,"\n")},Object.defineProperties(t.prototype,n),t}(MaskHistory),PHONE_MASK_DATA_ID=CONFIG.CSS_PREFIX+"phone-mask",DIGIT=/\d/;function maskToMaskito(e){return e.splie?DIGIT:e}))}function masksSort(e,t,n,r){return e.sort((function(e,i){for(var o=0,a=0;o<e[r].length&&a<i[r].length;){var s=e[r].charAt(o),c=i[r].charAt(a);if(n.test(s))if(n.test(c)){if(-1!==t.indexOf(s)&&-1===t.indexOf(c))return 1;if(-1===t.indexOf(s)&&-1!==t.indexOf(c))return-1;if(-1===t.indexOf(s)&&-1===t.indexOf(c)&&s!==c)return s<c?-1:1;o++,a++}else a++;else o++}for(;o<e[r].length||a<i[r].length;)if(o<e[r].length&&!n.test(e[r].charAt(o)))o++;else if(a<i[r].length&&!n.test(i[r].charAt(a)))a++;else{if(o<e[r].length)return 1;if(a<i[r].length)return-1}return 0})),e}var nullMask={testMask:["+"],mask:["+"],stringMask:"+"},phonesMaskList=masksSort(data,["#"],/[0-9]|#/,"mask").map((function(e){var t=maskToMaskito(e.mask),n=t.map((function(e){return"string"==typeof e&&/\d/.test(e)?/\d/:e}));return{testMask:t,mask:n,stringMask:e.mask}}));function getFittingMask(e){if(0===(e=e.replace(/\D/g,"")).length)return null;for(var t=0;t<phonesMaskList.length;t++){for(var n=phonesMaskList[t].testMaT.test(e)})),r=!0,i=0;i<e.length&&void 0!==n[i];i++)if("string"==typeof n[i]){if(n[i]!==e[i]){r=!1;break}}else if(!n[i].test(e[i])){r=!1;break}if(r)return phonesMaskList[t]}return null}var inputmasksReadyPromise=ne(){e()}))})),inputsCache=[];function isMaskitoCompleted(e,t){var n=t.split("");if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if("string"==typeof e[r]){if(n[r]!==e[r])return!1}else if(!e[r].test(n[r]))return!1;return!0}function inputmasks(e,t){var n=maskToMaskito(t);return cash(e).each((function(e,t){var r=new Maskito(t,{mask:n,overwriteMode:"shift"});inputsCache.push(r)})),this}function phoneMasks(e){cash(e).each((function(e,t){var n=new Maskito(t,{mask:function(e){var n=e.value?getFittingMask(e.value):nullMask;return n?(cash(t).data(PHONE_MASK_DATA_ID,n.stringMask),n.mask):maskToMaskito(cash(t).data(PHONE_MASK_DATA_ID)||"+")},overwriteMode:"shift"});inputsCache.push(n)}))}Dispatcher.on("destroy",(function(){for(;inputsCache.length>0;){inputsCache.pop().destroy()}}));var inputmask={common:function(e,t){inputmasks(e,t)},phones:function(e){phoneMasks##.####")},isCompleted:function(e,t){return isMaskitoCompleted(maskToMaskito(t=t||cash(e).data(PHONE_MASK_DATA_ID)),cash(e).val())},readyPromise:inputmasksReadyPromise},fieldValidators={e).test(e)}},phone:/^\+?[\d\s-()]+$/,name:/^[\s\S]+$/},fieldTypeValidators={date:{test:function(e){try{var t=e.split("."),n=t[0],r=t[1],i=t[2],o=Date.parse([i,r,n].join("-"));return!isNaN(o)}catch(e){return!1}}}},validators={fieldValidators:fieldValidators,fieldTypeValidators:fieldTypeValidators};function convertBaseFieldNameToLowercase(e){var t=e.toLowerCase();return["name","email","phone","first_name","last_name"].includes(t)?t:e}function normalizeDate(e){if(!device$1.desktop())try{var t=e.split("-"),n=t[0],r=t[1],i=t[2];return _.some(t)?[i,r,n].join("."):""}catch(e){return"Date(t):t}var AbstractLeadBehavior=inherit(AbstractBehavior$1,{_sending:!1,_fields:[],_fieldNamesInHtml:[],_canSubmit:!0,_$elem:null,_view:null,_showSuccess:!0,_sent:!1,_requiredFields:["name","email","phone"],__constructor:function(e){this.__base(e),this._fields=[],this._fieldNamesInHtml=[]},_updateField:function(e,t,n){var r=!0,i=this._fieldNamesInHtml.find((function(t){return t.field===e})),o=i?i.fieldName:"",a=this._$elem.find("[data-"+CONFIG.CSS_PREFIX+'input="'+o+'"]'),s=(!!a.filter("[data-"+CONFIG.CSS_PREFIX+"required]").length||_.includes(this._requiredFields,e))&&!a.filter("[data-"+CONFIG.CSS_PREFIX+"unrequired]").length,c=a.first().data(CONFIG.CSS_PREFIX+"type"),u=validators.fieldTypeValidators[c];if(!(!(t=(t=null==t?"":t).trim?t.trim():+t)&&!s)){if(validators.fieldValidators[e]&&(r=r&&validators.fieldValidators[e].test(t)),r&&u&&(r=r&&u.test(t)),"phone"===e&&r&&t)try{var l=cash(a).filter("[data-"+CONFIG.CSS_PREFIX+"mask]").first().data(CONFIG.CSS_PREFIX+"mask");r=r&&inputmask.isCompleted(a.first(),l)}catch(e){r=!1}if(r&&a.filter("[data-"+CONFIG.CSS_PREFIX+"mask]").length)try{var d=cash(a).filter("[data-"+CONFIG.CSS_PREFIX+"mask]").first().data(CONFIG.CSS_PREFIX+"mask");r=r&&inputmask.isCompleted(a.first(),d)}catch(e){r=!1}s&&(r=r&&!!t)}return!r&&n?(a.filter(':not([type="radio"])').filter(':not([type="checkbox"])').val(t),a.addClass(CONFIG.CSS_PREFIX+"invalid")):a.addClass(CONFIG.CSS_PREFIX+"valid"),this._leadModel[e]=t,this._runIf(),r},_runIf:function(){var e=this._leadModel;this._$elem.find("[data-popmechanic-if]").each((function(){var t=new Function("lead","PopMechanic","return "+cash(this).data("popmechanic-if")+";"),n=_.clone(e);n.customs=n.customs||{},_.extend(n.customs,window.PopMechanic.customs);try{t(n,window.PopMechanic)?cash(this).show():cash(this).hide()}catch(e){cash(this).hide()}}))}his._sent},_submit:function(e){var t,n=!0,r=this;if(r.canSubmit()&&(r._fields.forEach((function(e){var t=r._updateField(e,r._leadModel[e],!0);n=t&&n})),n))return r._sending=!0,t=new Lead(r._leadModel,r._view.form),r._$elem.addClass(CONFIG.CSS_PREFIX+"pending"),e&&e.preventDefault(),t.send((function(e){if(r._runIf(),window.PopMechanic.leads.push(e),r._$elem.removeClass(CONFIG.CSS_PREFIX+"pending"),r._$elem.addClass(CONFIG.CSS_PREFIX+"submitted"),r._$elem.addClass(CONFIG.CSS_PREFIX+"success"),globalCSS.setState("success"),r._sending=!1,r._sent=!0,Dispatcher.trigger("lead",{lead:e,form:r._view.form}),event.push({type:"lead-success",form:r._view.form.id}),Session.setCompleted(e.form||r._view.form.id),r._showSuccess)return r._view.success(e)}),(function(){return r._$elem.removeClass(CONFIG.CSS_PREFIX+"pending"),r._$elem.addClass(CONFIG.CSS_PREFIX+"error"),r._sending=!1,report({type:"exception"}),Dispatcher.trigger("cancel",{form:r._view.form}),event.push({type:"lead-cancel",form:r._view.form.id}),Session.setUncompleted(r._view.form.id),r._view.close()}))},_bindEvents:function(){},onBeforeRender:function(){return inputmask.readyPromise},onRender:function(e,t){this.__base(e,t),device$1.desktop()||e.find("input[data-"+CONFIG.CSS_PREFIX+"type=date]").attr("type","date")},onShow:function(e,t){var n=this;this._$elem=e,this._view=t,this._leadModel={},e.find("[data-"+CONFIG.CSS_PREFIX+"input]").each((function(){var t=this,r=cash(this),i=r.data(CONFIG.CSS_PREFIX+"input"),o=e.find("[data-"+CONFIG.CSS_PREFIX+'input="'+i+'"]'),a=r.data(CONFIG.CSS_PREFIX+"type(cash(t))}));var s=convertBaseFieldNameToLowercase(i);if(-1===n._fields.indexOf(s)&&(n._fields.push(s),n._fieldNamesInHtml.push({field:s,fieldName:i})),r.on("keyup click",(function(){var e="checkbox"===r.attr("type")?r.is(":checked"):r.val();o.removeClass(CONFIG.CSS_PREFIX+"invalid"),e=normalizeInputValue(a,e),n._updateField(s,e)})),r.on("change blur",(function(){var e="checkbox"===r.attr("type")?r.is(":checked"):r.val();e=normalizeInputValue(a,e),n._updateField(s,e,!0)})),"radio"!==r.attr("type")){var c="checkbox"===r.attr("type")?r.is(":checked"):r.val();c=normalizeInputValue(a,c),n._updateField(s,c,!1)}else{var u=r.val();u=normalizeInputValue(a,u),r.is(":checked")&&n._updateField(s,u,!1)}})),this._bindEvents()},_initInputMask:function(e){try{e.is("input[data-"+CONFIG.CSS_PREFIX+"mask]")?inputmask.common(e,e.data(CONFIG.CSS_PREFIX+"mask")):e.is("input[data-"+CONFIG.CSS_PREFIX+"input=phone]")?inputmask.phones(e):e.is("input[data-"+CONFIG.CSS_PREFIX+"type=date]")&&device$1.desktop()&&inputmask.dates(e)}catch(e){window.PopMechanic.debugMode&&console.error("Error setting inputmask:",e)}},onSuccess:function(e,t,n){var r=!1;return new Promise((function(t){n=n||window.PopMechanic.leads[window.PopMechanic.leads.length-1],e.find("[data-popmechanic-var]").each((function(){var e=cash(this),t=e.attr("data-popmechanic-var");0===t.indexOf("customs")&&(r=!0),e.text(getPropertyByPath(n,t))})),r?(cash("."+CONFIG.CSS_PREFIX+"close").on("click",(function(){t()})),cash(document).oCode&&t()})),cash("."+CONFIG.CSS_PREFIX+"js-paranja").on("click",(function(){t()}))):t()}))},onClose:function(e,t,n){n.success||(Dispatcher.trigger("cancel",{form:t.form}),Session.setUncompleted(t.form.id),event.push({type:"lead-cancel",form:this._view.form.id}))}}),LeadBehavior=inherit(AbstractLeadBehavior,{_bindEvents:function(){var e=this;this._$elem.find("[data-"+CONFIG.CSS_PREFIX+"submit]").on("click",(function(t){e._submit(t)})),this._$elem.on("keyup",(function(t){13==t.keyCode&&"textarea"!==t.target.type.toLowerCase()&&e._submit(t)})),this._$elem.find("form").on("submit",(function(e){e.preventDefault()}))}}),LeadOnClose=inherit(AbstractLeadBehavior,{_canSubmit:!1,_bindEvents:function(){var e=this;this._$elem.find("[data-popmechanic-submit]").oSubmit=!0})),this._$elem.find("[data-popmechanic-submit-close]").oclose(!0)}))},onBeforeClose:function(e,t,n){return this._showSuccess=n.showSuccess,this._submit()}}),MultiscreenBehavior=inherit(AbstractBehavior$1,{onShow:function(e,t){e.find("[rel=screen], [data-target=screen]").on("click",(function(n){var r,i,o=e.find(cash(this).attr("href")),a=e.find(".popmechanic-screen").filterVisible(),s=e.find("#popmechanic-form-"+t.form.id),c=!0;if(a.find("[data-popmechanic-input]").each((function(){var e=cash(this),t=e.attr("data-popmechanic-input"),n=e.data(CONFIG.CSS_PREFIX+"type"),r=void 0!==e.attr("data-popmechanic-required"),i=validators.fieldValidators[t]&&!validators.fieldValidators[t].test(e.val()),o=validators.fieldTypeValidators[n]&&!validators.fieldTypeValidators[n].test(e.val()),a=r&&"checkbox"===e.attr("type")&&!e.is(":checked"),s=r&&!e.val();(i||o||a||s)&&(c=!1,e.addClass("popmechanic-invalid"))})),!c&&!cash(n.target).attr("data-popmechanic-novalidate"))return!1;o.show(),r=o.outerWidth(),i=o.outerHeight(),o.hide(),s.animate({width:r,height:i}),a.animate({opacity:0},(function(){this.hide(),o.css({opacity:0}).show().animate({opacity:1},(function(){if(o.data("onshow"))try{new Function(o.data("onshow"))()}catch(e){}}))})),n.preventDefault(),n.stopPropagation()}))}}),BASE_WRAPPER_CLASS=CONFIG.CSS_PREFIX+"js-wrapper",ANIMATION_WRAPPER_CLASS=CONFIG.CSS_PREFIX+"js-animation-wrapper",AbstractPositioner=function(e){var t=e.settings,n=e.id,r=e.runAnimation;this._settings=t,this._id=n,this._runAnimation=r,this.onRender=this.onRender.bind(this),this.onShow=this.onShow.bind(this),this.onClose=this.onClose.bind(this)};function getCssPropertyWithUnits(e){return"number"==typeof e?e+"px":"string"!=typeof e?0:-1!==e.indexOf("%")?e:(parseFloat(e)||0)+"px"}AbstractPositioner.prototype._initBaseWrapper=function(){return cash('<div class="'+BASE_WRAPPER_CLASS+'" />')},AbstractPositioner.prototype._getBaseWrapper=function(e){return e.find("."+BASE_WRAPPER_CLASS)},AbstractPositioner.prototype._initAnimatS+'" />')},AbstractPositioner.prototype._getAnimationWrapper=function(e){return e.find("."+ANIMATION_WRAPPER_CLASS)},AbstractPositioner.prototype.shouldRender=function(){return!0},AbstractPositioner.prototype.onRender=function(){},AbstractPositioner.prototype.onShow=function(e,t,n){},AbstractPositioner.prototype.onClose=function(e){};var STATIC_STYLES={top:{top:0,left:"50%",transform:"translate(-50%, 0)"},left:{left:0,top:"50%",transform:"translate(0, -50%)"},right:{right:0,top:"50%",transform:"translate(0, -50%)"},bottom:{bottom:0,left:"50%",transform:"translate(-50%, 0)"},"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},center:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},CLICKABLE_OVERLAY_CLASS=CONFIG.CSS_PREFIX+"js-clickable-overlay",WRAPPER_BASE_STYLES={display:"block",textAlign:"left",maxHeight:"100%",maxWidth:"100%"},PARANJA_POSITION_STYLES={position:"fixed",top:0,left:0,right:0,bottom:0,height:"auto",minHeight:0,overflow:"auto",zIndex:100000001},WindowPositioner=function(e){function t(t){e.call(this,t),this._paranjaId=CONFIG.CSS_PREFIX+"paranja-"+this._id,this._getParanja=this._getParanja.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._handleKeyUp=function(){},t.prototype._getBaseWrapperStyles=function(){var e=_.extend({},{zIndex:100000002},STATIC_STYLES[this._settings.position]);return-1!==this._settings.position.indexOf("top")&&(e.marginTop=getCssPropertyWithUnits(this._settings.vertical_offset)),-1!==this._settings.position.indexOf("bottom")&&(e.marginBottom=getCssPropertyWithUnits(this._settings.vertical_offset)),-1!==this._settings.position.indexOf("left")&&(e.marginLeft=getCssPropertyWithUnits(this._settings.horizontal_offset)),-1!==this._settings.position.indexOf("right")&&(e.marginRight=getCssPropertyWithUnits(this._settings.horizontal_offset)),"center"===this._settings.position?e.position="absolute":e.position="fixed",e},t.prototype._initParanja=function(){return cash('<div class="'+CONFIG.CSS_PREFIX+'js-paranja" id="'+this._paranjaId+'">').css(_.extend({},PARANJA_POSITION_STYLES,{backgroundColor:this._settings.paranja_color,opacity:"0",transition:"opacity "+CONFIG.ANIMATION_SPEED+"ms"}))},t.prototype._aranjaId)},t.prototype._getClickaAY_CLASS)},t.prototype._initWrappers=function(e){var t=this._initBaseWrapper();t.css(_.extend({},WRAPPER_BASE_STYLES,this._getBaseWrapperStyles()));var n=this._initAnimationWrapper();n.append(t),e.append(n);var r=null,i=null;return"center"===this._settings.position&&(r=this._initParanja(),i=cash('<div class="'+CLICKABLE_OVERLAY_CLASS+'" />'),n.append(i),e.append(r)),{$paranja:r,$animationWrapper:n,$baseWrapper:t,$clickableOverlay:i}},t.prototype.shouldRender=function(){return!isOverlayBlocked()&&!(isOverlayPresent()&&!this._settings.allow_overlay)},t.prototype.onRender=function(){if(!this.shouldRender())return Promise.reject();addOverlay(this._id,this._settings.allow_overlay)},t.prototype.onShow=function(e,t,n){var r=this;return new Promise((function(i){var o=r._initWrappers(t),a=o.$paranja,s=o.$animationWrapper,c=o.$baseWrapper,u=o.$clickableOverlay;r._handleKeyUp=function(e){27===e.keyCode&&n()},cash(document).on("keyup",r._handleKeyUp),"center"===r._settings.position&&(disableScroll(),e.css({position:"relative"}),s.css(_.extend({},PARANJA_POSITION_STYLES,{pointerEvents:"all"})),a.css({zIndex:1e8,opacity:r._settings.paranja_opacity})),c.append(e),r._runAnimation(s,r._settings.animation_in,(function(){a&&u.on("click",(function(){n(!1)})),i("OK")}))}))},t.prototype.onClose=function(e){var t=this,n=t._getAnimationWrapper(e),r=t._getBaseWrapper(e),i=t._getParanja(e),o=t._getClickableOverlay(e);return removeOverlay(t._id),new Promise((function(e){t._runAnimation(n,t._settings.animation_out,(function(){r.remove(),n.css({position:"static",height:0,minHeight:0,overflow:"visible"}),i?(i.css({opacity:0}),setTimeout((function(){i.remove(),o.remove(),enableScroll(),cash(document).off("keyup",t._handleKeyUp),e()}),CONFIG.ANIMATION_SPEED)):(enableScroll(),cash(document).off("keyup",t._handleKeyUp),e())}))})).catch((function(){i&&(i.remove(),o.remove()),cash(document).off("keyup",t._handleKeyUp)}))},t}(AbstractPositioner),top="top",bottom="bottom",right="right",left="left",auto="auto",basePlacements=[top,bottom,right,left],start="start",end="end",clippingParents="clippingParents",viewport="viewport",popper="popper",reference="reference",variationPlacements=basePlacemen"-"+end])}),[]),placements=[].concat(basePlacements,[auto"-"+end])}),[]),beforeRead="beforeRead",read="read",afterRead="afterRead",beforeMain="beforeMain",main="main",afterMain="afterMain",beforeWrite="beforeWrite",write="write",afterWrite="afterWrite",modifierPhases=[beforeRead,read,afterRead,beforeMain,main,afterMain,beforeWrite,write,areturn e}function isElement(e){return e instanceof getWindow(e).Element||e instance))}))}}var applyStyles$1={name:"applyStyles",enabled:!0,phase:"write",fn:applyStyles,effect:effect$2,requires:["computeStyles"]};function getBasePlacement(e){return e.split("-")[0]}var round$1=ll}function getContainingBlock(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&isHTMLElement(e)&&"fixed"===getComputedStyle(e).position)return null;for(var n=getParentNode(e);isHTMLElement(n)&&["html","body"].indexOf(getNodeName(n))<0;){var r=getComputedStyle(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}r?"x":"y"}var max=Math.max,min=Math.min,round=}),{})}var toPadarrow=r)}var arrow$1={name:"arrow",enabled:!0,phase:"main",fn:arrow,effect:effect$1,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},unsetSides={top:"auto",right:"auto",bottom:"auto",left:"auto"};function roundOffsetsByDPR(e){var t=e.x,n=e.y,r=window.devicePixelRatio||1;return{x:round(round(t*r)/r)||0,y:round(round(n*r)/r)||0}}function mapToStyles(e){var t,n=e.popper,r=e.popperRect,i=e.placement,o=e.offsets,a=e.position,s=e.gpuAcceleration,c=e.adaptive,u=e.roundOffsets,l=!0===u?roundOffsetsByDPR(o):"function"==typeof u?u(o):o,d=l.x,f=void 0===d?0:d,h=l.y,p=void 0===h?0:h,m=o.hasOwnProperty("x"),g=o.hasOwnProperty("y"),v=left,_=top,y=window;if(c){var b=getOffsetParent(n),S="clientHeight",w="clientWidth";b===getWindow(n)&&"static"!==getComputedStyle(b=getDocumentElement(n)).position&&(S="scrollHeight",w="scrollWidth"),b=b,i===top&&(_=bottom,p-=b[S]-r.height,p*=s?1:-1),i===left&&(v=right,f-=b[w]-r.width,f*=s?1:-1)}var I,C=Object.assign({position:a},c&&unsetSides);return s?Object.assign({},C,((I={})[_]=g?"0":"",I[v]=m?"0":"",I.transform=(y.devicePixelRatio||1)<2?"translate("+f+"px, "+p+"px)":"translate3d("+f+"px, "+p+"px, 0)",I)):Object.assign({},C,((t={})[_]=g?p+"px":"",t[v]=m?f+"px":"",t.transfacement})}var computeStyles$1={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:computeStyles,data:{}},passive={ppassive)}}var eventListeners={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:effect,data:{}},hash$1={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,(function(e){return hash$1[e]}))}var hash={start:"end",en$1={name:"flip",enabled:!0,phase:"main",fn:flip,requiresIfExists:["offset"],data:{ed":d})}var hide$1={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"ata[r]=a}var offset$1={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],acement})}var popperOffsets$1={name:"popperOffsets",enabled:!0,phase:"read",fn:popperOffsete?"y":"x"}function preventOverflow(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,o=void 0===i||i,a=n.altAxis,s=void 0!==a&&a,c=n.boundary,u=n.rootBoundary,l=n.altBoundary,d=n.padding,f=n.tether,h=void 0===f||f,p=n.tetherOffset,m=void 0===p?0:p,g=detectOverflow(t,{boundary:c,rootBoundary:u,padding:d,altBoundary:l}),v=getBasePlacement(t.placement),_=getVariation(t.placement),y=!_,b=getMainAxisFromPlacement(v),S=getAltAxis(b),w=t.modifiersData.popperOffsets,I=t.rects.reference,C=t.rects.popper,E="function"==typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,P={x:0,y:0};if(w){if(o||s){var k="y"===b?top:left,x="y"===b?bottom:right,O="y"===b?"height":"width",T=w[b],R=w[b]+g[k],F=w[b]-g[x],A=h?-C[O]/2:0,M=_===start?I[O]:C[O],D=_===start?-C[O]:-I[O],N=t.elements.arrow,$=h&&N?getLayoutRect(N):{width:0,height:0},B=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:getFreshSideObject(),j=B[k],H=B[x],L=within(0,I[O],$[O]),U=y?I[O]/2-A-L-j-E:M-L-j-E,V=y?-I[O]/2+A+L+H+E:D+L+H+E,G=t.elements.arrow&&getOffsetParent(t.elements.arrow),q=G?"y"===b?G.clientTop||0:G.clientLeft||0:0,W=t.modifiersData.offset?t.modifiersData.offset[t.placement][b]:0,X=w[b]+U-W-q,z=w[b]+V-W;if(o){var K=within(h?min(R,X):R,T,h?max(F,z):F);w[b]=K,P[b]=K-T}if(s){var Y="x"===b?top:left,J="x"===b?bottom:right,Q=w[S],Z=Q+g[Y],ee=Q-g[J],te=within(h?min(Z,X):Z,Q,h?max(ee,z):ee);w[S]=te,P[S]=te-Q}}t.modifiersData[r]=P}}var preventOverflow$1={name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:[||1!==r}function getCompositeRect(e,t,n){void 0===n&&(n=!1);var r=isHTMLElement(t),i=isHTMLElement(t)&&isElementScaled(t),o=getDocumentElement(t),a=getBoundingClientRect(e,i),s={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(r||!r&&!n)&&(("body"!==getNodeName(t)||isScrollParent(o))&&(s=getNodeScroll(t)),isHTMLElement(t)?((c=getBoundingClientRect(t,!0)).x+=t.clientLeft,c.y+=t.clientTop):o&&(c.x=getWindowScrollBarX(o))),{x:a.left+s.scrollLeft-c.x,y:a.top+s.scrollTop-c.y,width:a.width,height[e]}))}var DEFAULT_OPTIONS={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var e=arguments,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=e[r];retuientRect)}))}function popperGenerator(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,i=t.defaultOptions,o=void 0===i?DEFAULT_OPTIONS:i;return function(e,t,n){void 0===n&&(n=o);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,o),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},a=[],s=!1,c={state:i,setOptions:function(n){u(),i.options=Object.assign({},o,i.options,n),i.scrollParents={reference:isElement(e)?listScrollParents(e):e.contextElement?listScrollParents(e.contextElement):[],popper:listScrollParents(t)};var s=orderModifiers(mergeByName([].concat(r,i.options.modifiers)));return i.orderedModifiers=s.filter((function(e){return e.enabled})),i.orderedModifierion(){})}})),c.update()},f!1,r=-1}}},update),e(i)}))}{u(),s=!0}};if(!areValidElements(e,t)})),a=[]}return c.setOptionUpdate(e)})),c}}var defaultModifiers=[eventListeners,popperOffsets$1,computeStyles$1,applyStyles$1,offset$1,flip$1,preventOverflow$1,arrow$1,hide$1],createPopper=popperGenerator({defaultModifiers:defaultModifiers});function getIsVerticalElementPlacement(e){return-1!==e.indexOf("top")||-1!==e.indexOff("end")}function convertOffsetsToPopperJs(e,t,n){var r=0,i=0;return getIsVerticalElementPlacement(e)?(i=n,r=t):getIsHorizontalElementPlacement(e)&&(i=t,r=n),getIsEndElementPlacement(e)&&(r*=-1),[r,i]}var targetElementCheckingIntervalDelay=100,PopperPositioner=function(e){function t(t){e.call(this,t),this._targetElementCheckingIntervalId=null,this._popper=null,this._getTargetElement=this._getTargetElement.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._getTararget)[0]},t.prototype._initWrappers=function(e){var t=this._initBaseWrapper();t.css({display:"block",textAlign:"left",maxHeight:"100%",maxWidth:"100%",zIndex:99999998});var n=this._initAnimationWrapper();return n.css({position:"relative",zIndex:1}),n.append(t),e.append(n),{$animationWrapper:n,$baseWrapper:t}},t.prototype._initPopper=function(e){var t=this;t._popper=createPopper(t._getTargetElement(),e,{placement:t._settings.element_position,modifiers:[{name:"offset",options:{offset:function(e){return convertOffsetsToPopperJs(e.placement,t._settings.element_horizontal_offset,t._settings.element_vertical_offset)}}}]})},t.prototype._cper=null)},t.prototype.onRender=function(){var e=this;return new Promise((function(t){var n=setInterval((function(){e._getTargetElement()&&(clearInterval(n),t())}),targetElementCheckingIntervalDelay)}))},t.prototype.onShow=function(e,t){var n=this;return new Promise((function(r){var i=n._initWrappers(t),o=i.$baseWrapper,a=i.$animationWrapper;o.append(e),n._initPopper(a[0]),n._runAnimation(a,n._settings.animation_in,(function(){n._targetElementCheckingIntervalId=setInterval((function(){var e=n._getTargetElement();!e&&t.filterVisible().length&&n._popper&&(t.hide(),n._clearPopper()),!e||t.filterVisible().length||n._popper||(t.show(),n._initPopper(a[0]))}),targetElementCheckingIntervalDelay),r()}))}))},t.prototype.onClose=function(e){var t=this,n=t._getAnimationWrapper(e),r=t._getBaseWrapper(e);return new Promise((function(e){t._runAnimation(n,t._settings.animation_out,(function(){r.remove(),n.css({position:"static",height:0,minHeight:0,overflow:"visible"}),t._clearPopper(),t._targetElementCheckingIntervalId&&clearInterval(t._targetElementCheckingIntervalId),e()}))})).catch((function(){t._clearPopper()}))},t}(AbstractPositioner),PartscreenBehavior=inherit(AbstractConditionedBehavior,{__constructor:function(e){this.__base(e);var t=e.form.settings.behavior_settings.partscreen||{},n=this._getDeviceSettings(t);this.settings=_.defaults({},n,t,{animation_in:"fadeIn",animation_out:"fadeOut",paranja_opacity:.3,paranja_color:"black",position:"center",horizontal_offset:0,vertical_offset:0,allow_overlay:!1,target:"window",element_position:"right",element_horizontal_offset:0,element_vertical_offset:0}),"desktop"===this._device||n.hasOwnProperty("horizontal_offset")||(this.settings.horizontal_offset=0),"desktop"===this._device||n.hasOwnProperty("vertical_offset")||(this.settings.vertical_offset=0);var r={id:this.formId,settings:this.settings,runAnimation:this._runAnimation};this._positioner="window"===this.settings.target?new WindowPositioner(r):new PopperPositioner(r)},_positioner:null,shouldRender:function(){return this._positioner.shouldRender()nRender()},onShow:function(e,t){var n=this._getForm(e),r=this._getContainer(e);Promise.resolve(this._positioner.onShow(n,r,t.close)).then((function(){n.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))}))})nClose(t)}}),PopupBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e);var t=_.defaults({},e.form.settings.behavior_settings.popup,{paranja_opacity:.3,animation_type:"slide",animation_settings:{from:"top"}});this.animationType=t.animation_type,this.animationSettings=t.animation_settings,this.paranjaOpacity=t.paranja_opacity},_prepareAnimation:function(e){if("slide"===this.animationType){var t={};t["margin-"+this.animationSettings.from]=-Math.max(window.innerWidth,window.innerHeight),e.css(t)}else this._initialOpacity=e.css("opacity")||1,e.css({opacity:0})},_runAnimation:function(e,t){var n={};"slide"===this.animationType?n["margin-"+this.animationSettings.from]=0:n.opacity=this._initialOpacity,e.animate(n,{duration:CONFIG.ANIMATION_SPEED,queue:!1,always:t})},onRender:function(e,t,n){var r=this._filterForm(e),i=cash('<div class="'+CONFIG.CSS_PREFIX+'js-wrapper"></div>');this._$formWrapper=i,n.append(i),this._$paranja=cash('<div class="'+CONFIG.CSS_PREFIX+'js-paranja" id="'+CONFIG.CSS_PREFIX+"paranja-"+this.formId+'">').css({display:"block",position:"absolute",top:"0",left:"0",bottom:"0",right:"0","background-color":"black",opacity:"0",pointerEvents:"all","z-index":1e6}),i.append(this._$paranja),i.css({position:"relative","text-align":"center",margin:"0",top:0,left:0,right:0}),r.css({display:"inline-block","z-index":100000002,position:"relative","vertical-align":"middle","text-align":"left"}),this._prepareAnimation(i)},onShow:function(e,t){var n=this._getForm(e),r=this._$formWrapper,i=this._getContainer(e),o=this._$paranja,a=this;disableScroll(),this._$formWrapper.append(n),setTimeout((function(){i.css({position:"fixed",top:0,left:0,right:0,bottom:0,height:"auto","min-height":0,overflow:"auto","z-index":1e8}),a._$vaHelper=cash("<div></div>"),a._$vaHelper.css({height:window.innerHeight,display:"inline-block",width:0,"vertical-align":"middle"}).appendTo(r),cash(window).onrHeight})})),o.animate({opacity:a.paranjaOpacity},{duration:CONFIG.ANIMATION_SPEED,queue:!1}),a._runAnimation(a._$formWrapper,(function(){o.oclose(!1)})),n.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))}))})),cash(document).ot.close()}))}),10)},onClose:function(e){var t=this,n=this._getContainer(e);return new Promise((function(r){e.animate({top:"-50%"},CONFIG.ANIMATION_SPEED,(function(){t._$paranja.animate({opacity:"0"},CONFIG.ANIMATION_SPEED,(function(){t._$paranja.remove(),t._$vaHelper.remove(),t._$formWrapper.remove(),n.css({position:"static",height:0,"min-height":0}),enableScroll(),r()}))}))}))},onSuccess:function(){},onFail:function(){}}),PostTextBehavior=inherit(AbstractBehavior$1,{onSuccess:function(e){return new Promise((function(t){e.addClass(CONFIG.CSS_PREFIX+"success"),setTimeout(t,6e3)}))}});function randInt(e,t){return void 0===t&&(t=0),Math.floor(t+Math.random()*(e-t))}var getFakePicture=function(e){return"https://picsum.photos/"+randInt(300,200)+"/"+randInt(300,200)+"?image="+a4Event=o};Tracker.prototype.selectItem=function(e,t,n){},Tracker.prototype.vin(e,t,n){};var Ga4Tracker=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._transform=function(e,t){try{return{item_id:e.ids[this._shopId],item_name:e.displayName,item_list_name:this._listName,item_brand:e.manufacturer?e.manufacturer.name:"",price:e.price,index:t+1,quantity:1}}catch(e){return void this._logError(e)}},t.prototype._sendProductEvent=function(e,t){var n=t.product,r=t.index,i=t.props,o=this._transform(n,r);if(o){var a={item_list_name:this._listName,items:[o]},s={};this._measurementId&&Object.assign(s,{send_to:this._measurementId}),i&&Object.assign(s,i);var c={ecommerce:a};Object.keys(s).length&&Object.assign(c,{common:s});try{this._trySendGa4Event(e,c)}catch(e){this._logError(e)}}},t.prototype.selectItem=function(e,t,n){this._sendProductEvent("select_item",{product:e,index:t,props:n})},t.prototype.viprops:n})},t}(Tracker),UaTracker_DEPRECATED$1=frguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._transform=function(e,t){try{return{name:e.displayName,id:e.ids[this._shopId],price:e.price,brand:e.manufacturer?e.manufacturer.name:"",list:this._listName,position:t+1}}catch(e){return void this._logError(e)}},t.prototype.selectItem=function(e,t){var n=this._transform(e,t);if(n)try{window.ga(this._trackerName+".ec:addProduct",n),window.ga(this._trackerName+".ec:setAction","click",{list:this._listName}),window.ga(this._trackerName+".send","event","Mindbox","click",this._listName)}catch(e){this._logError(e)}},t.prototype.viewItemList=function(e,t){var n=this._transform(e,t);if(n)try{window.ga(this._trackerName+".ec:addImpression",n),window.ga(this._trackerName+".send","event","Mindbox","widget",this._listName,{nonInteraction:1})}catch(e){this._logError(e)}},t}(Tracker),trySendGa4Event=function(e,t){void 0===t&&(t={});var n=t.common,r=t.ecommerce;if(window.gtag){var i={};return n&&Object.assign(i,n),r&&Object.assign(i,r),Object.keys(i).length?void window.gtag("event",e,i):void window.gtag("event",e)}if(window.dataLayer){var o={};return n&&Object.assign(o,n),r&&Object.assign(o,{ecommerce:r}),void window.dataLayer.push(Object.assign({event:e},o))}throw Error("no google analytics on site")},recoIds={location:"",ids:[]},fakeProductsList=[];function coinToss(){return!!Math.floor(Math.random()+.5)}function getFakeProduct(e,t){var n,r="Product "+randInt(1e5),i=randInt(1e5,1),o=coinToss?Math.round(i*(1+.5*Math.random())):i;return"number"!=typeof e&&(e=randInt(70,50)),{ids:(n={mindboxId:randInt(1e4)},n[t]=randInt(1e4),n),name:r,displayName:r,description:Array(randInt(6,4)).fill("lorem ipsum").join(" "),code:"Category",url:"#",pictureUrl:getFakePicture(e),price:i,oldPrice:o,manufacturer:{name:"Mfr"}}}function firstLetterToLower(e){if(!e)return"";var t=e[0],n=e.slice(1);return""+t.toLowerCase()+n}var RecoDataBehavior=inherit(AbstractBehavior$1,{__constructor:function(e,t){void 0===t&&(t={trySendGa4Event:trySendGa4Event}),this.__base(e,t),this.view=e,this.behaviorSettings=_.defaults({},e.form.settings.behavior_settings.reco_data,{shopId:"website",operations:[],productIdsCode:null,filterByOtherReco:!1,returnOptimizedPictures:!1,ga:{useGa4:"1"===e.form.settings.settings.useGa4,enabled:"1"===e.form.settings.settings.enableGA,trackerName:e.form.settings.settings.gaTrackerName||"",listName:e.form.settings.settings.gaListName||"",measurementId:e.form.settings.settings.gaMeasurementId||""}}),this.currentEntityDataIds=[],this.onBeforeRenderRejectIsDebuggable=!1,this.behaviorSettings.shopId=firstLetterToLower(this.behaviorSettings.shopId),this._reportedMbError=!1,this.recommendations=[],this._handleSuccess=this._handleSuccess.bind(this),this._handleError=this._handleError.bind(this),this._reportMbError=this._reportMbError.bind(this),this._parseMbError=this._parseMbError.bind(this),this._processQueue=this._processQueue.bind(this),this._sendRequest=this._sendRequest.bind(this),this._reportSlaSuccess=this._reportSlaSuccess.bind(this),this._reportSlaFailure=this._reportSlaFailure.bind(this),this._setProductPriceAndDiscount=this._setProductPriceAndDiscount.bind(this),this._getEntityDataIds=this._getEntityDataIds.bind(this),this._logError=this._logError.bind(this)},onInit:function(){this.behaviorSettings.operations.forEach((function(e){switch(e.recoTarget){case"Offer":e.recoType="product";break;case"Category":e.recoType="category";break;default:e.recoType="personal"}})),this.behaviorSettings.recoType=this.behaviorSettings.operations[0]?this.behaviorSettings.operations[0].recoType:"personal"},onBeforeRender:function(e,t){var n=this,r=n.behaviorSettings.operations.filter((function(e){return!e.disabled}));return this._getEntityDataIds(t,r[0]&&r[0].recoType).then((function(e){return n.currentEntityDataIds=e,function(){var e=Promise.resolve();n.sendArea=t.attr("data-popmechanic-area")||window.mindboxAreaId;try{if(window.mindbox&&-1===location.href.indexOf("pm-dummy")){try{e=Promise.all(r.map((function(e){return n._processQueue([e.id],e.recoType,e.limit,0)}))).then((function(e){return _.chain(e).flatten().uniq(!1,(function(e){return e.ids.mindboxId})).value()})).then(n._handleSuccess).catch(n._handleError)}catch(e){n._logError(e)}window.mindboxInitialized||n._reportSlaSuccess()}else location.href.indexOf("pm-dummy")>-1?(n._handleSuccess(n._getFakeRecommendations()),n._reportSlaSuccess()):n._reportSlaSuccess()}catch(e){n._logError(e),n.recommendations=[],n._reportSlaFailure(encodeURIComponent(e.message))}return e}()}))},onClose:function(){},getSettings:function(){var e=this.behaviorSettings.ga.enabled?this.behaviorSettings.ga.useGa4?Ga4Tracker:UaTracker_DEPRECATED$1:Tracker;return{recommendations:this.recommendations,gaTracker:new e({shopId:this.behaviorSettings.shopId,logError:this._logError,trackerName:this.behaviorSettings.ga.trackerName,listName:this.behaviorSettings.ga.listName,measurementId:this.behaviorSettings.ga.measurementId,trySendGa4Event:this._dependencies.trySendGa4Event})}},_setProductPriceAndDiscount:function(e){var t=_.extend({},e);t.customFields=t.customFields||{},t.oldPrice&&t.oldPrice<=t.price&&(t.oldPrice=null),t.discount=null,t.oldPrice&&t.oldPrice!==t.price&&(t.discount=(100*(t.oldPrice-t.price)/t.oldPrice).toFixed(0)+"%");try{t.formattedPrice=t.price.toLocaleString("ru-RU"),t.oldPrice&&(t.formattedOldPrice=t.oldPrice.toLocaleString("ru-RU"))}catch(e){}return t},_filterProductListByOtherReco:function(e){var t=location.href.split("#")[0];if(recoIds.location!==t||location.href.indexOf(".mindbox.ru")>-1||location.href.indexOf(".directcrm.ru")>-1)return e;var n=recoIds.ids;retu.mindboxId)}))},_saveProductIdsToFilter:function(e){var t=location.href.split("#")[0];(recoIds.location!==t||location.href.indexOf(".mindbox.ru")>-1||location.href.indexOf(".directcrm.ru")>-1)&&(recoIds={location:t,ids:[]});vas.mindboxId}));recoIds.ids=_.union(recoIds.ids,n)},_handleSuccess:function(e){var t=this;try{t.currentEntityDataIds.length&&"category"!==t.behaviorSettings.recoType&&(e=e.filter((function(e){var n=e.ids[t.behaviorSettings.shopId];return void 0!==n&&-1===t.currentEntityDataIds.indexOf(n.toString())})))}catch(e){t._logError(e)}var n=t.behaviorSettings.filterByOtherReco?t._filterProductListByOtherReco(e):e;t._saveProductIdsToFilter(n),t.recommendations=n.map(t._setProductPriceAndDiscount)},_handleError:function(e){return this.recommendations=[],this._reportedMbError?this._reportSlaSuccess():this._reportSlaFailure(e||"request error"),this._logError(e||"request error"),Promise.reject(e)},_logError:function(e){debug.log("reco widget "+this.formId+": ",e)},_processQueue:function(e,t,n,r){var i=this;if(!e||r>e.length)return Promise.resolve([]);var o=e[r],a=i._getRequestParams(t,n);return i._sendRequest(o,t,a).catch((function(o){return i._logError(o),i._processQueue(e,t,n,r+1)}))},_getRequestParams:function(e,t){var n,r,i=this.behaviorSettings.shopId,o={recommendation:{returnOptimizedPictures:!!this.behaviorSettings.returnOptimizedPictures,limit:t}};if(this.sendArea&&(o.recommendation.area={ids:{externalId:this.sendArea}}),"product"===e){var a=this.currentEntityDataIds[0];o.recommendation.product={ids:(n={},n[i]=a,n)}}if("category"===e){var s=this.currentEntityDataIds[0];o.recommendation.productCategory={ids:(r={},r[i]=s,r)}}return o},_sendRequest:function(e,t,n){var r=this;return e?globalUtils.getMindboxIsReadyPromise().then((function(){return new Promise((function(i,o){var a=!1;window.mindbox("sync",{operation:e,data:n,onSuccess:function(e){a=!0,i(e.recommendations||[])},onError:function(e){a=!0;var i=r._parseMbError(e,t,n);r._reportMbError(i),o(e)}})laSuccess()}),1e3)}))})).catch((function(){return[]})):Promise.resolve([])},_parseMbError:function(e,t,n){var r="unknownError",i={},o=/^Unknown endpoint: "([^"]+)"/,a=this.behaviorSettings.shopId;return o.test(e.errorMessage)?(r="endpointInvalid",i={endpoint:e.errorMessage.replace(o,"$1"),site:document.location.host}):"product"===t&&/  /.test(e.message)?(r="productNotFound",void 0===(i={productId:n.recommendation.product.ids[a]}).productId&&(i.productId="undefined")):"category"===t&&/   /.test(e.message)&&(r="categoryNotFound",void 0===(i={categoryId:n.recommendation.productCategory.ids[a]}).categoryId&&(i.categoryId="undefined")),{type:r,payload:i,url:document.location.href}},_reportMbError:function(e){var t=CONFIG.WEB_URL;if("unknownError"!==e.type){this._reportedMbError=!0;try{cash.ajax({type:"post",url:t+window.PopMechanic.client+"/report/"+this.formId+"/",data:JSON.stringify(e),contentType:"application/json",dataType:"json"})}catch(e){this._logError(e)}}else this._reportedMbError=!1},_getFakeRecommendations:function(){var e=this;if(!fakeProductsList.length){fakeProductsList=[];var t=_.reduce(e.behaviorSettings.operations,(function(e,t){return t.disabled||"number"!=typeof t.limit?e:e+t.limit}),0);fakeProductsList=_.times(t,(function(t){return getFakeProduct(t+50,e.behaviorSettingsuccess:function(e){this.view.form.reportSlaSuccess(e)},_reportSlaFailure:function(e){globalUtils.reportFailure(e)},_getEntityDataIds:function(e,t){var n=this;return new Promise((function(r){try{if("string"==typeof n.behaviorSettings.productIdsCode){var i=new Function(n.behaviorSettings.productIdsCode)();r(i)}}catch(e){}var o=e.attr("data-popmechanic-argument");o&&"ID   mindbox"!==o&&r(o.split(",")),(!t||"product"!==t&&"category"!==t)&&r([]),getMindboxKnownPageDataPromise().then((function(e){var i=n.behaviorSetti&e[t]&&e[t].ids[i]&&(o=[e[t].ids[i]]),r(o)}),(function(){r([])}))}))}});function reportSuccess(e){if(!window.PopMechanic.sampleSent){window.PopMechanic.sampleSent=!0;var t=globalUtils.getTabVisibilityDuration(),n=window.PopMechanic.initReadyTs,r=window.PopMechanic.targetingReadyTs,i=navigator&&navigator.connection&&navigator.connection.downlink,o=globalUtils.getDeviceType();(new Image).src=SPEEDTEST+"/check-reco?result=success"+(e?"&reason="+e:"")+"&t="+t+"&t1="+n+"&t2="+r+"&dl="+("number"==typeof i?i:"unknown")+"&dt="+o+"&c="+window.PopMechanic.client+"&url="+encodeURIComponent(location.pathname)+"&_="+ +Date.now()}}var lifecycle_es5={exports:{}};
/*!
	 Copyright 2018 Google Inc. All Rights Reserved.
	 Licensed under the Apache License, Version 2.0 (the "License");
	 you may not use this file except in compliance with the License.
	 You may obtain a copy of the License at

	     http://www.apache.org/licenses/LICENSE-2.0

	 Unless required by applicable law or agreed to in writing, software
	 distributed under the License is distributed on an "AS IS" BASIS,
	 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 See the License for the specific language governing permissions and
	 limitations under the License.
	*/!function(e,t){
/*! lifecycle.es5.js v0.1.1 */
e.exports=function(){var e=void 0;try{new EventTarget,e=!1}catch(t){e=!1}vae.ofretubjalnction(e){return this._registr=ee=r.oldState,i.originalEvent=r.originalEvent,i}return i(t,c),t}(),l="active",d="passive",f="hidden",h="frozen",p="terminated",m="object"===("undefined"==typeof safari?"undefined":t(safari))&&safari.pushNotification,g=["focus","blur","visibilitychange","freeze"ion(e){return e.preventDefault(),e.returnValue="Are yoution{return docscarded",get:function(){return document.wasDiscarded||!1}}]),t}())}()}(lifecycle_es5);var pageLifecycle=lifecycle_es5.exports;function reportUnload(){if(!window.PopMechanic.sampleSent){window.PopMechanic.sampleSent=!0;var e=globalUtils.getTabVisibilityDuration(),t=window.PopMechanic.initReadyTs,n=window.PopMechanic.targetingReadyTs,r=navigator&&navigator.connection&&navigator.connection.downlink,i=globalUtils.getDeviceType(),o=SPEEDTEST+"/check-reco?result=unknown&t="+e+"&t1="+t+"&t2="+n+"&dl="+("number"==typeof r?r:"unknown")+"&dt="+i+"&c="+window.PopMechanic.client+"&url="+encodeURIComponent(location.pathname)+"&_="+ +Date.now();navigator&&navigator.sendBeacon(o,"")}}var reportUnloadEnabled=!1,enableReportUnload=function(){reportUnloadEnabled||(reporchange",(function(e){"terminated"===e.newState&&reportUnload()})))},pendingRecoWidgets=[],RecoSlaBehavior=inherit(AbstractBehavior$1,{onTargetingReady:function(e){window.PopMechanic.slaRequired=!0,pendingRecoWidgets.push(this.formId),e.form.reportSlaSuccess=this._reportSlaSuccess.bind(this),e.form.reportSlaFailure=this._reportSlaFailure.bind(this),enableReportUnload()},_reportSlaSuccess:function(e){0===(pendingRecoWidgets=_.without(pendingRecoWidgets,this.formId)).length&&reportSuccess(e)},_reportSlaFailure:function(e){globalUtils.reportFailure(e)}});function getVerticalStyles(e){return-1!==e.direction.indexOf("top")?{top:0,"margin-top":e.vertical_offset}:-1!==e.direction.indexOf("bottom")?{bottom:0,"margin-bottom":e.vertical_offset}:{top:"50%",transform:"translate(0, -50%)"}}function getHorizontalStyles(e){return-1!==e.direction.indexOf("left")?{left:0,"margin-left":e.horizontal_offset}:-1!==e.direction.indexOf("right")?{right:0,"margin-right":e.horizontal_offset}:{left:"50%",transform:"translate(-50%, 0)"}}var defaultAnimationsIn={top:"fadeInUp",bottom:"fadeInDown",left:"fadeInLeft",right:"fadeInRight","top-left":"fadeInUp","top-right":"fadeInUp","bottom-left":"fadeInDown","bottom-right":"fadeInDown"},defaultAnimationsOut={top:"fadeOutUp",bottom:"fadeOutDown",left:"fadeOutLeft",right:"fadeOutRight","top-left":"fadeOutUp","top-right":"fadeOutUp","bottom-left":"fadeOutDown","bottom-right":"fadeOutDown"},ScrollboxBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e),this.settings=_.defaults({},e.form.settings.behavior_settings.scrollbox,{direction:"bottom",horizontal_offset:0,vertical_offset:0}),this.settings.animation_in||(this.settings.animation_in=defaultAnimationsIn[this.settings.direction]),this.settings.animation_out||(this.settings.animation_out=defaultAnimationsOut[this.settings.direction]),this.staticStyles=_.extend({},getVerticalStyles(this.settings),getHorizontalStyles(this.settings))},onRender:function(e,t,n){this._filterForm(e);var r=cash('<div class="'+CONFIG.CSS_PREFIX+'js-wrapper"></div>');this._$formWrapper=r,n.append(r);var i={display:"block","z-index":100000002,position:"fixed","text-align":"left"};_.extend(i,this.staticStyles),r.css(i)},onShow:function(e,t){var n=this._getForm(e);this._$formWrapper.append(n),this._runAnimation(n,this.settings.animation_in),n.find("."+Cick",(function(){t.close(cash(this).data("popmechanic-close"))}))},onClose:function(e){var t=this,n=this._getForm(e);return new Promise((function(r){t._runAnimation(n,t.settings.animation_out,(function(){e.css({position:"static",height:0,"min-height":0}),r()}))}))},onSuccess:function(){},onFail:function(){}});function padLeft(e){return"number"!=typeof e||e<=0?"00":e<10?"0"+e:""+e}function toDigits(e){return'<span class="'+CONFIG.CSS_PREFIX+'timer-digit">'+e.split("").join('</span><span class="'+CONFIG.CSS_PREFIX+'timer-digit">')+"</span>"}var formatters={seconds:function(e){return Math.flofloor.floor(e/3600)%24},days:function(e){return Math.floor(e/86400)}},secondsInWeek=604800,TimerBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e),this._updateLoop=null,this._showTime=Math.floor(getCachedVisitStartTs()/1e3),this._settings=e.form&&e.form.settings&&e.form.settings.behavior_settings&&e.form.settings.behavior_settings.timer||{}},_getTimers:function(e,t)s;return _.chain(e).filter((function(e){return"timer"===e.type})).map((function(e){var r="object"==typeof t[e.machine_name]?t[e.machine_name]:JSON.parse(t[e.machine_name]);return{id:e.machine_name,settings:r,end:n._getEndTime(r)}})).value()},_getEndTime:function(e){switch(e.type){case"end":return e.end.date;case"range":return"visit"===e.range.start?this._showTime+e.range.duration:e.range.start+e.range.duration;case"cycle":if(!e.cycle||!e.cycle.day||!e.cycle.day.length)return 0;var t=new Date,n=(24*t.getUTCDay()*60*60+60*t.getUTCHours()*60+60*t.getUTCMinutes()+t.getUTCSeconds())%secondsInWeek,r=e.cycle.time.split(":");r=60*r[0]*60+60*r[1]+60*e.cycle.local;var i=_.chain(e.cycle.day).map((function(e){return(24*e*6sortBy(_.identity).value(),o=i.filter((function(e){return e<=n})),a=!o.length,s=a?_.last(i):_.last(o),c=n-s+(a?secondsInWeek:0);return Math.round(new Date/1e3)-c+e.cycle.duration;default:return 0}},_updateValues:function(e,t,n){var r=this,i=Math.floor(Date.now()/1e3);t.forEach((function(t){Object.keys(formatters).forEach((function(o){var a="[data-"+CONFIG.CSS_PREFIX+'timer="'+t.id+":"+o+'"]',s=e.find(a),c=t.end-i,u=formatters[o];s.each((function(){var e;try{e=parseInt(cash(this).data("popmechanicDigit"),10)}catch(e){}var t=padLeft(u(c));0!==e&&1!==e||(t=t[e]),cash(this).html(toDigits(t))})),c<=0&&r._settings.close_on_end&&n()}))}))},onBeforeRender:function(e){var t=Math.floor(Date.now()/1e3);this.timers=this._getTimers(e.form.templat.settings);var n=_.any(this.timers,(function(e){return e.end<t}));if(this._settings.close_on_end&&n)return Promise.reject("Form #"+this.formId+": timer has expired")},onShow:function(e,t){var n=this;n.$view=e,this.e,n.timers,(functi}))}),100)},onClose:function(){clearInterval(this._updateLoop)}}),getFakeCartProduct=function(e){var t=e+1;return{co}},getFakeCart=function(){return _.times(3,getFakeCartProduct)},getFakePopmechanicProduct=function(e){var t=1e3*e,n=e+1;return{id:n,price:t,priceWithDiscount:.75*t,name:"Product "+n,quantity:1,pictureUrl:getFakePicture(e),url:"#",brand:"Brand",brandId:120,hasDiscount:!0,category:"Category",categoryId:229,tags:["tag 1"]}},getFakePopmechanicCart=function(){var e=_.times(3,getFakePopmechanicProduct);return{total:_.reduce(e,(function(e,t)educe(e,(function(e,t){return e+parseInt(t.priceWithDiscount,10)}),0),products:e}},CartBehavior=inherit(AbstractBehavior$1,{__constructor:function(e,t){this.__base(e,t),this._cart=[],this._popmechanicCart=null,this.getSettings=this.getSettings.bind(this),this.onBeforeRender=this.onBeforeRender.bind(this)},onBeforeRender:function(){var e=this;return this._dependencies.dummyIsRequired?(this._cart=getFakeCart(),this._popmechanicCart=getFakePopmechanicCart(),Promise.resolve()):Promise.all([globalUtils.waitPromisesOrDelay([this._dependencies.getCart().catch((function(){return[]}))],1e3),globalUtils.wa_dependencies.getPopmechanicCart().catch((function(){return null}))],1e3)]).then((function(t){e._cart=t[0]&&t[0][0]||[],e._popmechanicCart=t[1]&&t[1][0]||null}))},getSettings:function(){return{cart:this._cart||[],popmechanicCart:this._popmechanicCart||null}}}),STATIC="https://personalization-web-stable.mindbox.ru/js",scriptPromisesBySrc={},addScript=function(e){return scriptPromisesBySrc[e]||(scriptPromisesBySrc[e]=new Promise((function(t,n){var r=document.createElement("script");r.onload=t,r.onerror=function(e){return n(e)},r.src=e,document.head.appendChild(r)}))),scriptPromisesBySrc[e]},TNS_VERSION="2",TNS_SRC$1=STATIC+"/media/popmechanic/tns-2.9.2.js?v="+TNS_VERSION,loadTns=function(){return addScript(TNS_SRC$1).catch((function(e){throw console.error("Error loading tns-slider script:",e),e}))},TnsBehavior=inherit(AbstractBehavior$1,{onBeforeRender:loadTns}),TNS_SRC=STATIC+"/media/popmechanic/tns-new.js",TnsLegacyBehavior=inherit(AbstractBehavior$1,{onBeforeRender:function(){return addScript(TNS_SRC).catch((function(e){throw console.error("Error loading tns-slider script:",e),e}))}}),behaviorMap$1={"banner-h":BannerBehavior,"banner-v":BannerBehavior,"copy-code":CopyCodeBehavior,"form-container":FormContainerBehavior,"lead-on-close":LeadOnClose,"post-text":PostTextBehavior,"reco-data":RecoDataBehavior,"reco-sla":RecoSlaBehavior,always:AlwaysBehavior,banner:BannerBehavior,banner_h:BannerBehavior,banner_v:BannerBehavior,button:ButtonBehavior,copy_code:CopyCodeBehavior,embedded:EmbeddedBehavior$1,fullscreen:FullscreenBehavior,humble:HumbleBehavior,info:InfoBehavior,lead:LeadBehavior,lead_on_close:LeadOnClose,multiscreen:MultiscreenBehavior,partscreen:PartscreenBehavior,popup:PopupBehavior,post_text:PostTextBehavior,reco_data:RecoDataBehavior,reco_sla:RecoSlaBehavior,scrollbox:ScrollboxBehavior,social:FacebookBehavior,timer:TimerBehavior,cart:CartBehavior,tns:TnsBehavior,"tns-legacy":TnsLegacyBehavior},dependencies={dummyIsRequired:PopMechanic.dummyIsRequired,getCart:getCart,getPopmechanicCart:getPopmechanicCart,trySendGa4Event:trySendGa4Event};function getInstances$1(e,t){return e.map((function(e){if(behaviorMap$1[e])return new behaviorMap$1[e](t,dependencies)}))}var BehaviorFactory$1={getInstances:getInstances$1},$;$=cash,$.fn.fontSpy=function(e,t){var n=$("html"),r=$("body");if("string"!=typeof e||""===e)throw"A valid fontName is required. fontName must be a string and must not be an empty string.";var i={font:e,fontClass:e.toLowerCase().replace(/\s/g,""),success:function(){},failure:function(){},testFont:"Courier New",testString:"QW@HhsXJ",glyphs:"",delay:50,timeOut:1e3,callback:$.noop},o=$.extend(i,t),a=$("<span>"+o.testString+o.glyphs+"</span>").css("position","absolute").css("top","-9999px").css("left","-9999px").css("visibility","hidden").css("fontFamily",o.testFont).css("fontSize","250px");r.append(a);var s=a.outerWidth();a.css("fontFamily",o.font+","+o.testFont);var c=function(){var e=a.outerWidth();s!==e?(o.callback(),n.addClass(o.fontClass),o&&o.success&&o.success(),a.remove()):o.timeOut<0?(n.addClass("no-"+o.fontClass),o&&o.failure&&o.failure(),o.callback(new Error("FontSpy timeout")),a.remove()):(setTimeout(c,o.delay),o.timeOut=o.timeOut-o.delay)};c()};var fontSpy=cash.fn.fontSpy,AVAILABLE_VARS=["first_name","last_name","email"],AbstractFormView=inherit({_resources:[],_success:!1,__constructor:function(e){var t=e.template;this.id=t.id,this.html=e.settings.html||t.html,this.css=e.settings.css||t.css,this.behaviors=t.behaviors||[],this.fonts=t.fonts,this.form=e,this.data=t,this.init()},init:function(){this.behaviors=BehaviorFactory$1.getInstances(this.behaviors,this),this.behaviorsReady=this.form.isControlGroup?Promise.resolve():this._behaviorsOnInit(),this.form.subscribeIntegrations()},_behaviorsOnInit:function(){var e=this,t=this.behaviors.map((function(t){return t.onInit(e)})).filter((function(e){return!!e}));return Promise.all(t)},_getSettings:function(e){var t=_.extend({},this.form.settings.settings,{desktop:device$1.desktop(),tablet:device$1.tablet(),mobile:device$1.mobile(),formId:this.form.id});if(e)return t;var n=[t].concat(ction(e){return e.getSettings()})).filter((function(e){return!!e})));return _.extend.apply(_,n)},_extractImports:function(){var e=this._getSettings(!0),t=_.template(this.css)(e).matchAll(/(?:@import)\s(?:url\()?\s?["'](.*?)["']\s?\)?(?:[^;]*);?/gi);Array.from(t).forEach((function(e){e[0];var t=e[1];cash("head").append('<link href="'+t+'" rel="stylesheet"/>')}))},_extractFonts:function(){var e=this._getSettings(!0),t=_.template(this.css)(e).match(/@font-face\s{[\s\S]*?}/gi);return t?t.map((function(e){return{name:e.split("font-family:")[1].split(";")[0].trim(),body:e}})):null},_prefetchFonts:function(){var e=this,t=this._extractFonts(),n=this._getSettings(!0);t&&($snippet.append("<style>"+_.template(t.map((function(e){return e.body})).join("\n"))(n)+"</style>"),t.forEach((function(t){e._resources.push(new Promise((function(e){fontSpy(t.name,{fontClass:"pm-"+t.name+"-loaded",success:e,fail:e}),setTimeout(e,5e3)})))})))},_prefetchUrl:function(e){var t,n=new Promise((function(n){if(e.indexOf(".ttf")>-1||e.indexOf(".svg")>-1||e.indexOf(".eot")>-1||e.indexOf(".woff")>-1)return n();(t=new Image).onload=n,t.onerror=n,setTimeout(n,5e3),t.src=e}));this._resources.push(n)},_prefetch:function(){var e,t,n,r,i=/url\((.*?)\)|src="(.*?)"/g;for(t=(e=this._render()).html(),e.remove(),this._extractImports();n=i.exec(t);)r=n[1].replace(/'|"/g,""),this._prefetchUrl(r);this._prefetchFonts()},_getCssTemplate:function(e){return containerizeCss(_.template(this.css)(e),this.form.id)},_getCssReset:function(){return containerizeCss(getCssReset(this.form.id),this.form.id)},_getHtmlTemplate:function(e){return containerizeHtml(_.template(this.html)(e),this.form.id).replace(/%([\w.]+?)%/g,(function(e,t){return AVAILABLE_VARS.indexOf(t)>-1||0===t.indexOf("customs")?"<span data-popmechanic-var="+t+"></span>":e}))},_setDeviceClasses:function(e){device$1.mobile()&&e.addClass(CONFIG.CSS_PREFIX+"mobile"),device$1.tablet()&&e.addClass(CONFIG.CSS_PREFIX+"tablet"),device$1.desktop()&&e.addClass(CONFIG.CSS_PREFIX+"desktop")},_render:function(){var e,t,n;return e=this._getSettings(),t=cash('<style id="'+CONFIG.CSS_PREFIX+"css-"+this.form.id+'">'+this._getCssTemplate(e)+"</style>"),(n=cash(this._getHtmlTemplate(e))).addClass(CONFIG.CSS_PREFIX+"js-form"),this._setDeviceClasses(n),this.data.need_reset?cash('<style id="'+CONFIG.CSS_PREFIX+"reset-"+this.form.id+'">'+this._getCssReset(e)+"</style>").add(t).add(n):t.add(n)},_handler:function(e,t){var n,r,i=function(){};if(!e)return i;n=this._getSettings();try{r=_.template(e)(n),i=new Function("form","settings",r)}catch(n){return debug.log("Error creating form#"+this.form.id+", "+t+" handler",r,e,n),i}return function(r){try{return i.call(this,r,n)}catch(n){debug.log("Error in form#"+r.id+", "+t+" handler",e,n)}aviors.forEach((function(t){try{t.onTargetingReady(e)}catch(e){}})),e.data.on_targeting_ready)try{e.onTargetingReady=e._handler(e.data.on_targeting_ready,"on_targeting_ready"),e.onTargetingReady(e.form)}catch(e){}if(e.data.on_child_ready)try{e.onChildReady=e._handler(e.data.on_child_ready,"on_child_ready")}catch(e){}Dispatcher.trigger("targeting",{form:e.form}),e._prefetch()},controlGroupIsShownNotify:function(){debug.isDebugging()&&console.log("Form "+this.form.id+" control group is shoform.isControlGroup?this.controlGroupShow(e):this.variantShow(e)},success:function(){},close:function(){},terminate:function(){}}),FormView=inherit(AbstractFormView,{_resources:[],_success:!1,__constructor:function(e){this.__base(e),this.close=this.close.bind(this)},init:function(){var e=this.form;-1===this.behaviors.indexOf("button")&&e.button_template&&e.button_template.id&&this.behaviors.push("button"),this.__base()},variantShow:function(e){var t,n=getContainer(this.form.id),r=this;this._$elem||snippetHasForm(this.form.id)||(this._closed=!1,r.form.cancelConditions(),Promise.all(this._resources).then((function(){return r.behaviorsReady})).then((function(){return!(!e&&!window.PopMechanic.isTesting)||(!r.form.newTargeting||r.form.newTargeting.double_check?Targeting.check(r.form):r.form.inTargeting)})).then((function(i){if(i)return Promise.all(r.behaviors.map((function(e){return Promise.resolve(e.onBeforeRender(r,n)).catch((function(t){return e.onBeforeRenderRejectIsDebuggable&&debug.isDebugging()?Promise.resolve():Promise.reject(t)}))}))).then((function(){return!1})).catch((function(e){return debug.log("onBeforeRender error:",e),!0})).then((function(i){if(!i){return(e?Promise.resolve(!0):Promise.all([r.form.checkFrequency(),r.form.checkAccountFrequency()]).then((function(e){var t=e[0],n=e[1];return!!t&&(n?(event.push({type:"show_start",form:r.form.id,behaviors:r.form.template.behaviors}),!0):(r.form.report("frequency_exceed"),!1))})).catch((function(e){return console.error("Error checking frequency:",e),!0}))).then((function(e){if(e&&_.every(r.behaviors,(function(e){return e.shouldRender()})))return r.onShow=r._handler(r.data.on_show,"on_show"),t=r.romise.all(r.behaviors.map((function(e){return e.onRender(t,r,n)})).concat(r.form.integrationsOnRender())).then((functi)||(n.append(t),r.behaviors.forEach((function(e){e.onShow(n,r,n)})),r.form.inTargeting||r.form.report("bucket"),r.form.reportShow(),Session.setLastShown(r.form.id),"function"==typeof window.PopMechanic.onFormShow&&window.PopMechanic.onFormShow({form:r.form}),r.onShow(r.form))})).catch((function(){t.remove()}))}))}}));r.form.report("targeting_excluded")})))},controlGroupShow:function(e){var t=this;t.form.cancelConditions();(e||window.PopMechanic.isTesting?Promise.resolve(!0):!t.form.newTargeting||t.form.newTargeting.double_check?Targeting.check(t.form):Promise.resolve(t.form.inTargeting)).then((function(n){return n?!!e||Promise.all([t.form.checkFrequency(),t.form.checkAccountFrequency()]).then((function(e){var r=e[0],i=e[1];return!!r&&(i?n:(t.form.report("frequency_exceed"),!1))})).catch((function(e){return console.error("Error checking frequency:",e),n})):(t.form.report("targeting_excluded"),!1)})).then((function(e){if(e&&_.every(t.behaviors,(function(e){return e.shouldRender()})))return t.form.integrationsOnRender().then((function(){t.form.inTargeting||t.form.report("bucket"),t.controlGroupIsShownNotify(),t.form.reportShow()}))}))},success:function(){var e=this;return this._success=!0,Promise.all(this.behaviors.map((function(t){return t.onSuccess(e._$container,e)}))).then((function(){e.close()}),(function(){e.close()}))},close:function(e){this.termi n=this;function r(){n._$elem&&(n._$elem.remove(),n._$elem=null)}n._closed||(Promise.all(this.behaviors.map((function(e){return Promise.resolve(e.onBeforeClose(n._$container,n,{showSuccess:!!t})).catch((function(){}))}))).then((function(){if(!n._closed)return n._closed=!0,Promise.all(n.behaviors.map((function(e){return e.onClose(n._$container,n,{success:n._success})})))})).then(r,r),"function"==typeof e&&e(),"function"==typeof window.PopMechanic.onFormClose&&window.PopMechanic.onFormClose(this._success),n.onClose=n._handler(n.data.on_close,"on_close"),n.onClose(n.form))}}),StaticFormView=inherit({__constructor:function(e,t){var n=e.template;this.id=n.id,this.html=n.html,this.css=n.css,this.behaviors=n.behaviors,this.form=e,this.data=n,this.behaviors=BehaviorFactory$1.getInstances(t,this),this._behaviorsOnInit()},init:function(){var e=this;this._$elem=cash("[data-popmechanic-form="+this.form.id+"]"),this._$elem.each((function(){var t=cash(this);t.on("submit",(function(e){e.preventDefault()})),Session.isContactsSent(e.form.getLeadType(EFIX+"submitted"):e.behaviors.forEach((function(n){n.onShow(t,e)}))}))},success:function(e){vl(this.behaviors.map((function(e){return e.onSuccess(t._$elem,t)}))).then((function(){t.close()}),(function(){t.close()}))th<=(window.innerWidth||document.documentElement.clientWidth)+t}function appear(e){return function(e){var t,n,r,i,o=!1,a=[],s=[],c=0,u=0,l={};fl.delta<l.delta.speed&&(r||(r=!0,p(),setTments;clearTimeout(n),n=setTimeouEventListener("scroll",d,!1),removeEventListener("resize",d,!1)}function p(){i||(a.forEach((function(e,t){e&&viewable(e,l.bounds)?s[t]&&(s[t]=!1,c++,l.appear&&l.appear(e),l.disappear||l.reappear||(a[t]=null)):(!1===s[t]&&(l.disappear&&l.disappear(e),u++,l.reappear||(a[t]=null)),s[t]=!0)})),l.reappear||l.appear&&(!l.appear||c!==t)|s)){t=e.length;for(var n=0;n<t;n+=1)a.push(e[n]),s.push(!0);f()}}var g=function(e){l={init:(e=e||{}).init,elements:e.elements,appear:e.appear,disappear:e.disappear,done:e.done,reappear:e.reappear,bounds:e.bounds||0,debounce:e.debounce||50,delta:{speed:e.deltaSpeed||50,timeout:e.deltaTimeout||500}},addEventListener("DOMContentLoaded",m,!1);var t=!1;Function("/*@cc_on return document.documentMode===10@*/")()&&(t=!0);var r="complete"===document.readyState||"loaded"===document.readyState;return t?r&&m():(r||"interactive"===document.readygger:fune:function(){f()},destroy:function(){a=[],n&&clearTimeout(n),h()}}};if("undefined"==typeof module||void 0===module.exports)return g;module.exports=g}()(e)}addEventListener("scroll",track,!1);var EmbeddedFormView=inherit(AbstractFormView,{_success:!1,_appear:null,$target:null,__constructor:function(e){this.__base(e)},init:function(){var e=this.form;this.placement=e.embed_selector?e.placement:"end",this.__base()},controlGroupShow:function(){var e,t=this;return Promise.m.getTargetElement()).then((function(n){e=n,t.onTargetingReady()})).then((function(){return window.PopMechanic.isTesting||Targeting.check(t.{return eunction(t){return console.error("Error checking freq)})).then((function(e){if(e)return t.form.integrationsOnRender()})).then((function(){var n=CONFIG.CSS_PREFIX+"form-"+t.form.id+"-control-group";embedElement({$target:e,$element:cash('<div id="'+n+'" style="visibility: hidden; width: 0; height: 0; padding: 0; margin: 0; overflow: hid),t._appear=appear({elements:function(){return cash("#"+n).get()},appear:function(){t.controlGroupIsShownNotify(),t.form.reportShow(),this._appear&&this._appear.destroy()}})}))},variantShow:function(){var e,t=this,n=null,r=getContainerMarkup(t.form.id);return Promise.etElement&&t.form.getTargetElement()).then((function(e){e&&(n=e)})).then((function(){t.onTargetingReady()})).then((function(){return t.behaviorsReady})).then((function(){return window.PopMechanic.isTesting||Targeting.check(t.form)})).then((function(i){if(i)return Promise.all(t.behaviors.map((function(e){return Promise.resolve(e.onBeforeRender(t,n)).catch((function(t){return e.onBeforeRenderRejectIsDebuggable&&debug.isDebugging()?Promise.resolve():Promise.reject(t)}))}))).then((function(){return!1})).catch((function(e){return debug.log("onBeforeRender error:",e),!0nction(e){return console.error("Error checking frequency:",e),!0})).then((function(i){if(i)return event.push({type:"show_start",form:t.form.id,behaviors:t.form.template.behaviors}),t.onShow=t._handler(t.data.on_show,"on_show"),t.onClose=t._handler(t.data.on_close,"on_close"),.map((function(e){return Promise.resolve(e.onRender(t._$elem,t))})).concat(t.form.int(){var e;t.behaviors.forEach((function(e){e.onShow(t._$elem,t,n)})),t.onShow(t.form),window.PopMechanic.leads&&window.PopMechanic.leads.some((function(n){return n.form===t.form.id&&(e=n,!0)}))&&t.success(e,!0)})).then((function(){t._appear=appear({elements:function(){return cash("#"+CONFIG.CSS_PREFIX+"form-"+t.form.id).get()},appear:function(){t.form.reportShow(),Session.setLastShownWithId(t.form.id),this._appear&&this._appear.destroy()}})}))}))}));t.form.report("targeting_excluded")}))},success:function(e){vthis.behav)})))},close:function(e){this.terminate(this.form.reportClose,e)},terminate:function(e,t){var n=this;function r(){n._$elem&&(n._$elem.remove(),n._$elem=null);for(var e="#"+getContainerId(n.form.id.toString());cash(e).length;)cash(e).remove()}n.form.terminate(),n._$elem&&Promise.all(this.behaviors.map((function(e){return Promise.resolve(e.onBeforeClose(n._$container,n,{showSuccess:!!t})).catch((function(){}))}))).then((functionp((function(e){return e.onClose(n._$elem,n,{success:n._success})})))})).then(r,r),"function"==typeof e&&e(),"function"==typeof window.PopMechanic.onFormClose&&window.PopMechanic.onFormClose(this._success),n.onClose=n._handler(n.data.on_close,"on_close"),n.onClose(n.form)}}),view={init:function(e){return e.isStatic()?view.initStatic(e):e.isEmbedded()?view.initEmbedded(e):view.initNormal(e)},in=function(r){r&&(e.clearTargetingChange(n),t.onTargetingReady())};return e.ignoresTargeting()?n(!0):e.onTargetingChange(n),t},initStatic:function(e){var t=new StaticFormView(e,e.template.behaviors);return t.init(),t},initEmbedded:function(e){var t=window.PopMechanic.initAt,n=new EmbeddedFormView(e),r=function(i){i&&t===window.PopMechanic.initAt&&(n.show(),e.clearTargetingChange(r))};return e.onTargetingChange(r),n}};function getDelayCPS(e){if(e.delay)return function(t){setTimeout(t,1e3*parseInt(e.delay,10),!0)}}var STORAGE_KEY=CONFIG.JS_PREFIX+"la",LAST_UPDATE,timeouts=[],lastUpdate={set:function(e){LAST_UPDATE=e;try{sessionStorage[STORAGE_KEY]=e}catch(e){}},get:function(){try{return parseInt(sessionStorage[STORAGE_KhandleActivity=_.throttle((function(){lastUpdate.set(Date.now())}),500);function setIdleTimeout(ut(e){e.handler=_.identity}function handleDestroy(){timeouts=[]}setInterval((function(){if(timeastUpdate.get(),t=timeouts.flay<=e}));timeouts=timeouts.filter((f(function(e){setTimeout((function(){e.handler.apply(this,e.args)}),0)}))}}),500),document.addEventListener("mousemove",handleActivity,!1),document.addEventListener("mousedown",handleActivity,!1),document.addEventListener("keydown",handleActivity,!1),document.addEventListener("touchmove",handleActivity,!1),document.addEventListener("touchstart",handleActivity,!1),document.addEventListener("scroll",handleActivity,!1),handleActivity(),Dispatcher.on("destroy",handleDestroy);var idleTime={setTimeout:setIdleTimeout,clearTimeout:clearIdleTimeout};function getInactiveCPS(e){if(e.inactive)return function(t){try{idleTime.setTimeout(t,1e3*parseInt(e.inactive,10),[!0])}catch(e){console.log(e)}}}function getPagesCPS(e){if(e.pages){var t=parseInt(e.pages,10);return Session.history.length>=t?always(!0):function(e){var n=setInterval((function(){Session.history.length>=t&&(clearInterval(n),e(!0))}),1e3)}}}function getPagesSessionCPS(e){if(e.pages_session){var t=parseInt(e.pages_session,10);return sbjs.get.session.pgs>=t?always(!0):function(e){var n=setInterval((function(){sbjs.get.session.pgs>=t&&(clearInterval(n),e(!0))}),1e3)}}}function getSessionTimeCPS(e){if(e.session_time){var t;try{t=parseInt(sessionStorage[CONFIG.JS_PREFIX+"session-start"],10)}catch(e){}t||(t=Date.now()),sessionStorage[CONFIG.JS_PREFIX+"session-start"]=t;var n=1e3*parseInt(e.session_time,10)-(Date.now()-t);return function(e){setTimeout(e,Math.max(n,0),!0)}}}function getMouseleaveCPS(e){if(e.mouseleave&&"0"!==e.mouseleave)return function(e){var t=_.debounce((function(){e(!1)}),100);cash(document).on("mouseout",(function(t){t.relatedTarget||"INPUT"===t.target.nodeName||e(!0)})),cash(document).on("mouseenter",t),cash(document).on("mousemove",t)}}function getReadCPS(e){if(e.read){var t=parseInt(e.read,10);return function(e){var n=_.debounce((function(){var n=window.pageYOffset,r=cash(document).height()-window.innerHeight;(0===r||n/r*100>t)&&e(!0)}),100);cash(window).scroll(n),cash(document).height()-window.innerHeight>0?window.pageYOffset/cash(document).height()*100>=t&&e(!0):e(!0)}}}function getReturnedCPS(e){if(e.returned&&"0"!==e.reta.vst>1?e(!0):e(!1)}}function always(e){return function(t){t(e)}}var conditionCPS=[getDelayCPS,getInactiveCPS,getMouseleaveCPS,getPagesCPS,getPagesSessionCPS,getReadCPS,getReturnedCPS,getSessionTimeCPS];function orCombinator(e){return function(t){var n=e.map((function(){return!1})),r=_.any(n);e.forEach((function(e,i){e((function(e){n[i]=e;var o=_.any(n);o!==r&&t(r=o)}))}))}}function andCombinator(e){return function(t){var n=e.map((function(){return!1})),r=_.every(n);e.forEach((function(e,i){e((function(e){n[i]=e;var o=_.every(n);o!==r&&t(r=o)}))}))}}function getConditionsCPS(e,t){if(void 0===e&&(e={}),void 0===t&&(t="or"),e.only_forced)return aleturn always(!0);var n=conditionCPS.map((function(t){return t(e)})).filter(_.identity);return 0===n.length?always(!0):"and"===t?andCombinator(n):"or"===t?orCombinator(n):void 0}function getConditionsPromise(e,t){var n=getConditionsCPS(e,t),r=!1;return new Promise((function(e){n((function(t){(r=r||t)&&e()}))}))}function getFormContainerId(e){var t=window.PopMechanic.getModel(e);rel):form.getById(e).then((function(e){return e?e.containerId:null}))}var getLastEvent=event.getLas){return _.some(e,(function(e){return _.includes(["embeddeturn _.isEmpty(e)||_.every(e,(function(e){retuthen((function(){return getLastEvent({form:t,type:"show_start"})})).then((function(n){var r,i=getVisit();return r=n?n.ts:+Session.getLastShown(t),(!e.once_lifetime||!n)&&((!e.once_session||!n||n.vst!==i)&&!(e.minimal_timeout&&Date.now()-r<1e3*e.minimal_timeout))})).catch((function(){var n=+Session.getLastShown(t),r=Date.now();return(!e.once_lifetime||!n)&&(!(e.once_session&&r-n<18e5)&&!(e.minimal_timeout&&r-n<1e3*e.minimal_timeout))}))}function accountMinimalTimeoutLastEventFilter(e){return!e.behaviors||!hasInvalidAccountFrequencyBehavior(e.behaviors)}functEvent({type:"show_start"},accountMinimalTimeoutLastEventFilter)})).then((function(t){var n=t?t.ts:+Session.getLastShown();return Date.now()-n>=e}))}function checkAccount(e,t){return _.isEmpty(e)||_.every(e,_.isNull)?Promise.resolve(!0):getFormContainerId(t).then((function(n){if(n)return!0;var r=getVisit(),i=Date.now(),o=i-864e5,a=i-6048e5,s=i-2592e6,c={day:0,week:0,month:0,session:0},u=[];return event.forEach("ts",IDBKeyRange.lowerBound(s),(function(e){if(!("show_start"!==e.type||e.behaviors&&hasInvalidAccountFrequencyBehavior(e.behaviors))){var t=getFormContainerId(e.form).then((function(t){t||(e.ts>o&&(c.day+=1),e.ts>a&&(c.week+=1),e.ts>s&&(c.month+=1),e.vst===r&&(c.session+=1))}));u.push(t)}})).then((function(){return Promise.all(u)})).then((function(){return!(e.session&&c.session>=e.session)&&(!(e.day&&c.day>=e.day)&&(!(e.week&&c.week>=e.week)&&(!(e.month&&c.month>=e.month)&&(!e.minimal_timeout||checkAccountMinimalTimeout(1e3*e.minimal_timeout)))))})).catch((function(){var n=+Session.getLastShown(t),r=864e5,i=Date.now()-n;return!(e.session&&n&&i<18e5)&&(!(e.day&&n&&i<r)&&(!(e.week&&n&&i<6048e5)&&(!(e.month&&n&&i<2592e6)&&!(e.minimal_timeout&&i<1e3*e.minimal_timeout))))}))}))}var Frequency={checkForm:checkForm,c,AbstractBehavior=inherit({__constructor:function(e){this.form=e},getTargetElement:null,terminate:function(){}}),INTERVAL_MS=500,EmbeddedBehavior=inherit(AbstractBehavior,{_timeoutId:null,_selector:null,__constructor:function(e){this.__base(e),this.getTargetElement=this.getTargetElement.bind(this),this.terminate=this.terminate.bind(this),this._selector=e.embed_selector&&e.selector||"[data-"+CONFIG.CSS_PREFIX+"embed='"+e.id+"']"},_waitForTargetElement:function(e){var t=this,n=cash(t._selector);n.l):t._timeoutId=setTimeout((functis;return minate:function(){this._timeoutId&&clearTimeout(this._timeoutId)}}),behaviorMap={embedded:EmbeddedBehavior};function getInstances(e,t){return _.reduce(e,(function(e,n){return behaviorMap[n]&&(e[n]=new behaviorMap[n](t)),e}),{})}var BehaviorFactory={getInstances:getInstances},sha256={exports:{}};
/**
	 * [js-sha256]{@link https://github.com/emn178/js-sha256}
	 *
	 * @version 0.9.0
	 * @author Chen, Yi-Cyuan [emn178@gmail.com]
	 * @copyright =exports:(root.sha256=exports.sha256,root.sha224=exports.sha224)}()}(sha256);var getModulusHash=function(e,t){try{var n=e.toString().toUpperCase()+t.toUpperCase(),r=sha256.exports.sha256.digest(n);return((r[28]<<24|r[29]<<16|r[30]<<8|r[31])>>>0)%100}catch(e){throw new Error("Couldn't calculate modulus hash for A/B test")}},hashMatchesInterval=function(e,t,n,r){if(n<0||r>100)throw new Error("[modulusLower, modulusUpper) should be within [0, 100).");if(n>=r)throw new Error("Modulus lower bound can't be more or equal to modulus upper bound.");var i=getModulusHash(.filters=e.filter,this.filterType=e.filter_type,this.form=e.form},shouldRunForControlGroup:function(){},shouldRunOnContactsSent:function(e){if(this.form&&this.form!==e.form)return!1;if(this.filters){var t=this.filterType||"all",n=Object.keys(this.filters);for(var r in n){if("all"===t&&e.customs[n[r]]!==this.filters[n[r]])return!1;if("any"===t&&e.customs[n[r]]===this.filters[n[r]])return!0}}return!0},shouldRunOnSendContacts:function(){return!1}tion(e){},onTargetingReady:function(e,t){},onRender:function(e){},onShow:function(e,t){},on,t){},sendContacts:function(e,t){},onContactsSent:function(e,t){},_interpolate:function(e,t){var n=t.form,r=t.lead,i=e;return i=(i=(i=(i=(i=(i=(i=i.replace("%url%",location.href)).replace("%domain%",location.host)).replace("%utm_source%",sbjs.get.current.src)).replace("%utm_medium%",sbjs.get.current.mdm)).replace("%utm_campaign%",sbjs.get.current.cmp)).replace("%utm_term%",sbjs.get.current.trm)).replace("%utm_content%",sbjs.get.current.cnt),n&&(i=(i=i.replace("%form_id%",n.id)).replace("%form_name%",n.name)),r&&(Object.keys(r).forEach((function(e){"customs"===e?Object.keys(r.customs).forEach((function(e){i=i.replace(new RegExp("%customs."+e+"%","g"),r.customs[e])})):i=i.replace(new RegExp("%"+e+"%","g"),r[e])})),i=i.replace(new RegExp("%name%","g"),[r.first_name," ",r.last_name].join(" "))),i}}),CarrotQuestIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.carrotquest=window.carrotquest,this.fields=e.fields,this.open_event=e.open_event,this.close_event=e.close_event,this.lead_event=e.lead_event},onShow:function(e,t){this.open_event&&this.carrotquest&&this.carrotquest.track&&this.carrotquest.track(this._interpolate(this.open_event,{form:t.form}))},onClose:function(e,t){this.close_event&&this.carrotquest&&this.carrotquest.track&&this.carrotquest.track(this._interpolate(this.close_event,{form:t.form}))},onContactsSent:function(e,t){var n=t.form,r=t.lead,i={},o=this;r.phone&&(i.$phone=r.phone),r.name&&(i.$name=r.nach((function(e){i[e]=o._interpolate(o.fields[e],{form:n,lead:r})})),this.lead_event&&this.carrotquest&&this.carrotquest.track&&this.carrotquest.track(this.lead_event),this.carrotquest.identify(i)}}),UaTracker_DEPRECATED=function(e){var t=e.measurementId,n=e.logError;this._measurementId=t,this._trackerName=this._getTrackerName(),this._logError=n,window._gaq?this._mode="gaq":window.ga&&(this._mode="ga"),this._mode||this._logError("no GA found"),this._create(),this.send=this.send.bind(this)};UaTracker_DEPRECATED.prototype._getTrackerName=function(){return this._measurementId?0===this._measurementId.indexOf("UA-")?("popmechanic"+this._measurementId).replace(/-/g,""):this._measurementId:"t0"},UaTracker_DEPRECATED.prototype._create=function(){try{if("gaq"===this._mode)window._gat._getTrackerByName(this._trackerName)||window._gat._createTracker(this._measurementId,this._trackerName);if("ga"===this._mode)window.ga.getByName(this._trackerName)||window.ga("create",this._measurementId,"auto",this._trackerName)}catch(e){this._logError(e)}},UaTracker_DEPRECATED.prototype.send=function(e,t){var n=t.eventLabel,r=t.eventValue,i=t.eventCategory;try{"gaq"===this._mode&&window._gaq.push([this._trackerName+"._trackEvent",i,e,n,r]),"ga"===this._mode&&window.ga(this._trackerName+".send","event",i,e,n,r)}catch(e){this._logError(e)}};var GoogleAnalyticsIntegration=inherit(AbstractIntegration,{__constructor:function(e,t){void 0===t&&(t={}),this.__base(e);var n=t.trySendGa4Event;if(void 0===n&&(n=trySendGa4Event),this._eventCategory=this.data.event_category,this._openAction=this.data.open_action,this._closeAction=this.data.close_action,this._leadAction=this.data.lead_action,this._eventLabel=this.data.event_label,this._eventValue=this.data.event_value,this._measurementId=this.data.measurement_id||this.data.tracker_name,this._sendTo=this.data.send_to||this._measurementId,this._trySendGa4Event=n,this.data.use_ga4)this._sendEvent=this._sendGa4Event;else{var r=new UaTracker_DEPRECATED({measurementId:this._measurementId,logError:this._logError});this._sendEvent=r.send}},_sendEvent:function(){},_sendGa4Event:function(e,t){var n=t.sendTo,r=t.eventLabel,i=t.eventValue,o=t.eventCategory,a={};n&&(a.send_to=n),a.event_label=r,a.event_value=i,a.event_category=o;try{this._tryrn console.log("mindbox Google Analytics integration failed:",e)},_send:function(e,t){var n=this._interpolate(this._eventCategory,t),r=this._interpolate(e,t);try{this._sendEvent(r,{sendTo:this._sendTo,eventCategory:n,eventLabel:this._eventLabel,eventValue:this._eventValue})}catch(e){this._logError(e)}},onShow:function(e,t){this._openAction&&this._send(this._openAction,t)},onClose:function(e,t){tt:function(e,t){this._leadAction&&this._send(this._leadAction,t)}}),variables=[{key:"product_in e.product?e.product.ids:e.productGroup?e.productGroup.ids:null}))}},{key:"product_id_value",fetch:function(){return getMindboxKnownPageDataPromise().then((function(e){return e.product?getMindboxIdsExternalId(e.product.ids):e.productGroup?getMindboxIdsExternalId(e.productGroup.ids):null}))}},{key:"category_iromise().then((function(e){return e.category?e.category.ids:null}))}},{key:"category_id_valu){return e.category?getMindboxIdsExternalId(e.category.ids):null}))}},{key:"cart_sum",fetch:function(){return getCart().then((function(e){return _.reduce(e,(function(e,t){return e+=t.priceOfLine||t.pricePerItem*t.count||0}),0)}))}},{key:"cart_products",fetch:getCart}],JavaScriptIntegration=inh_methodHasVariable:function(e,t){return-1!==e.indexOf("%"+t+"%")},_getRequirfilter((function(n){var r=n.key;return t._methodHasVariable(e,r)}))},_getVariabliables(e),n=t.map((function(e){return Promise.resolve(e.fetchion(e){return _.reduce(t,(function(t,n,r){return t[n.key]=e[r],t}),{})}))},_interpolateWithVariables:function(e,t,n){var r=this._interpolate(e,t);return Object.keys(n).forEach((function(e){r=r.replace(new RegExp("%"+e+"%","g"),"(JSON.parse('"+JSON.stringify(n[e])+"'))")})),r},_executeLifecycleMethod:function(e){var t=e.methodName,n=e.params,r=this,i=this.data[t];if(i)try{return this._getVariablesValues(i).then((function(e){var t=r._interpolateWithVariables(i,n,e);return n.lead?new Function("lead","form",t)(n.lead,n.form):new Function("form",t)(n.form)}))}catch(e){debug.log(t+" erroexecuteLifecycleMethod({methodName:"on_render",params:{form:e}})},onShow:function(e,t){return this._executeLifecycleMethod({methodName:"on_show",params:{form:t.form}})},onClose:function(e,t){return this.success?this._executeLifecycleMethod({methodName:"on_close_success",params:{form:t.form}}):this._executeLifecycleMethod({methodName:"on_close_fail",params:{form:t.form}})},onContactsSent:function(e,t){return this.success=!0,this._executeLifecycleMethod({methodName:"on_success",params:{form:t.form,lead:t.lead}})},onTargetingReady:function(e,t){return this._executeLifecycleMethod({methodName:"on_targeting",params:{form:t.form}})}}),KissmetricsIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.open_event=this.data.open_event,this.close_event=s.data.lead_event},_push:function(e,t){_kmq.push(["record",e,t])},onShow:function(e,t){this.open_event&&this._push(this.open_event,{form:t.form.id})},onClose:function(e,t){this.close_event&&this._push(this.close_event,{form:t.form.id})},onContactsSent:function(e,t){var n=t.lead;this.lead_event&&this._push(this.lead_event,{form:n.form,conditions:n.conditions}),n.email&&_kmq.push(["set",{email:n.email}])}}),MindboxIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.provider=e.provider,this.operation=e.operation},onContactsSent:function(e,t){var n,r=this,i=t.lead,o={};n="email"===this.provider?"email":"phone"===this.provider?"phone":"id",i.first_name&&(o.firstName=i.first_name),i.last_name&&(o.lastName=i.last_name),i.email&&(o.email=i.email),i.phone&&(o.phone=i.phone),globalUtils.getMindboxIsReadyPromise().then((function(){r.counter=window.mindbox,r.counter||(console.log("PopMechanic Mindbox integration error: no counter presented"),r.counter=function(){}),r.counter("identify",{operation:r.operation,identificator:{provider:r.provider,identity:i[n]},data:o})}))}}),it(AbstractIntegration,{__constructor:function(e){this.__base(e)},shouldRunForControlGroup:function(){return!0},skipForm:function(){return!(window.PushManager&&window.Notification&&"default"===window.Notification.permission)},onContactsSent:function(){globalUtils.getMindboxIsReadyPromise().then((function(){window.mindbox&&window.mindbox("webpush.subscribe",{onGranted:function(){},onDenied:function(){}})}))}}),MindboxTrackingIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.isLead=!1,this._trackShow=this._trackShow.bind(this),this._trackClick=this._trackClick.bind(this)},shouldRunForControlGroup:function(){return!0},shouldRunOnContactsSent:function(e){return(!this.data.form||this.data.form===e.form)&&!this.isLead},onTargetingReady:function(e,t){this._trackTargeting(t)},onRender:function(e){Dispatcher.on("copyCode",this._trackClick),e.template&&e.template.behaviorsaviors.indexOf(trackShow(t)},onContactsSent:function(e,t){this._trackClick(e,t)},_trackTargeting:function(e){var t=this;this.data&&this.data.targeting_operation&&globalUtils.getMindboxIsReadyPromise().then((function(){window.mindbox&&window.mindbox("async",{operation:t.data.targeting_operation,data:{omitCdpAction:e.form.isControlGroup},onSuccess:function(){},onValidationError:function(){},onError:getErrorReporter(e.form.id,t.data.targeting_operation)})}))},_trackShow:function(e){var t=this;this.data&&this.data.show_operation&&globalUtils.getMindboxIsReadyPromise().then((function(){window.mindbox&&window.mindbox("async",{operation:t.data.show_operation,data:{omitCdpAction:e.form.isControlGroup},onSuccess:function(){},onValidationError:function(){},onError:getErrorReporter(e.form.id,t.data.show_operation)})}))},_trackClick:function(e,t){if(this.data.form===t.form.id){var n=this,r=t.form.id;this.data&&this.data.click_operation&&globalUtils.getMindboxIsReadyPromise().then((function(){window.mindbox&&window.mindbox("async",{operation:n.data.click_operation,data:{},onSuccess:function(){},onValidationError:function(){},onError:getErrorReporter(r,n.data.cid#getrandomvalues-not-supported");return getRandomValues(rnds8)}for(var byteToH[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]}var randomUUID="undefined"!=typeof crypto&&crypto.randomUU(var i=0;i<16;++i)t[n+i]=r[i];return t}return unsafeStringify(r)}var stringifyFieldValue=function(e){return null===e?"None":!0===e?"True":!1===e?"False":String(e)},geoFieldValuesMap={geo_city_ru:"city_ru",geo_city_en:"city_en",geo_country_ru:"country_ru",geo_country_en:"country_en",geo_geoname_id:"city_ieldValuesMap),geoValues=geoKeys.map((function(e){return"%"+e+"%"})),MindboxServerJsonIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.reportMindboxError=getErrorReporter(e.form,e.operthis._getNeedsGeo()},shouldRunOnSendContacts:function(){return!0},sendContacts:function(e){var t=this,n=v4();return new Promise((function(r,i){t._getGeoPromise().then((function(){globalUtils.getMindboxIsReadyPromise().then((function(){window.mindbox&&window.mindbox("async",{operation:t.data.operation,transactionId:n,data:t.e),onSucnction(e){i(e)},onEror(e),i(e)}})}))}))}))},onShow:function(){this._getGeoPromise()},_getNeedsGeo:function(){var e=[];return this.data.send_customer&&this.data.customer_extended&&this.data.customer_extended.length&&e.push.apply(e,this.data.customer_extended),this.data.issue_action&&this.data.customer_action_extended&&this.data.customer_action_extended.l),e.some((function(e){var t=e.value;return geoValues.includes(t)}))},_getOperationData:function(e){var t=this,n=this.data,r={};if(n.send_customer){var i=n.customer_extended;i&&i.length&&(r.customer=i.reduce((function(n,r){var i=r.value,o=r.systemName;return t._addOperationFieldValue(n,e,o,i)}),{}),"create"===n.mode&&(r.customer.subscriptions=n.subscriptions),_.isEmpty(r.customer)&&delete r.customer)}if(n.issue_action&&n.customer_action_extended){var o=n.customer_action_extended;o&&o.length&&(r.customerAction=o.reduce((function(n,r){var i=r.value,o=r.systemName;return t._addOperationFieldValue(n,e,o,i)}),{}),_.isEmpty(r.customerAction)&&delete r.customerAction)}return r},_addOperationFieldValue:function(e,t,n,r){var i,o=convertBaseFieldNameToLowercase(r.replace(/%/g,""));if("customs."===o.slice(0,8)){var a=o.slice(8);a in t.customs&&(i=t.customs[a])}else o in t?i=t[o]:"created_date"===o?i=(new Date).toISOString().split("T")[0]:"created_time"===o?i=(new Date).toISOString():geoKeys.includes(o)&&(i=this.geoData[geoFieldValuesMap[o]]);if(void 0!==i){var s=stringifyFieldValue(i);setPropertyByPath(e,n,s)}else console.warn("Mindbox personalization module: couldn't retrieve value for field \""+r+'". Skipping the field. It may lead to the inconsistency or data losses. Check the form template settings.');return e},_getGeoPromise:functhis.needsGeo?geoProvider.getGeo().then((function(t){e.geoData=t})):Promise.resolve()}}),RetailRocketIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.counter=window.rrApi,this.counter||(console.log("PopMechanic RetailRocket integration error: no counter presented"),this.counter=function(){})},onContactsSent:function(e,t){var n=t.lead,r={};if(n.email){(n.first_name||n.last_name)&&(r.name=[n.first_name,n.last_name].filter(Boolean).join(" ")),n.phone&&(r.phone=n.phone);try{rrApi.setEmail(n&&window.rrApiOnReady.push((function(){rrApi.setEmail(n.email,r)}))}}}}),SailplayIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.tags=e.tags,this.fields=e.fields},onContactss.map((function(e){return o._interpolate(e,{form:t.form,lead:n})}));if(Object.keys(this.fields).forEach((function(e){i[e]=o._interpolate(o.fields[e],{form:t.form,lead:n})})),i.email=n.email,n.first_name&&(r.firstName=n.first_name),n.last_name&&(r.lastName=n.last_name),n.email&&(r.email=n.email),n.phone&&(r.phone=n.phone),this.counter=window.SP,!this.counter)return console.log("PopMechanic Saition error: no counter presented"),void(this.counter=function(){});try{this.counter.api.users.update(r),this.counter.api.customVariables.add(i),this.counter.tags({action:"add",tags:a,email:n.email})}catch(e){console.log("PopMechanic Sailplay integration error:"),console.log(e)}}}),YandexMetrikaIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.openGoal=this.data.open_event,this.closeGoal=this.data.close_event,this.leadGoal=this.data.lead_event},getCounter:function(){var e=/^yaCounter/,t=this;return this.data.counter?this.counte.keys(window).some((function(n){e.test(n)&&(t.counter=window[n])})),this.counter||console.log("PopMechanic Yandex.Metrika integration failed: no counter found on site"),this.counter},onShow:function(){this.getCounter();try{this.openGoal&&this.counter.reachGoal(this.openGoal)}catch(e){console.log(e)}},onClose:function(){this.getCounter();try{this.closeGoal&&this.counter.reachGoal(this.closeGoal)}catch(e){console.log(e)}},onContactsSent:function(){this.getCounter();try{this.leadGoal&&this.counter.reachGoal(this.leadGoal)}catch(e){console.log(e)}}});function IntegrationFactory(e){switch(e.integration_type){case"yandexmetrika":return new YandexMetrikaIntegration(e);case"googleanalytics":return new GoogleAnalyticsIntegration(e);case"carrotquest":return new CarrotQuestIntegration(e);case"mindbox":return new MindboxIntegration(e);case"mindbox_push":return new MindboxPushIntegration(e);case"mindbox_tracking":return new MindboxTrackingIntegration(e);case"mindbox_server_json":return new MindboxServerJsonIntegration(e);case"kissmetrics":return new KissmetricsIntegration(e);case"sailplay":return new SailplayIntegration(e);case"retailrocket":return new RetailRocketIntegration(e);case"javascript":return new JavaScriptIntegration(e)}}var VARIANT_ID_PARAM="form-variant-id",Form=function(e,t){var n=this;this.id=e.id,this.name=e.name,this.settings_splits=e.settings_splits,this.settings={},this.salt=e.salt,this.control_group=e.control_group,this.variants=e.variants,this.newTargeting=e.test_group?e.test_group.new_targeting:e.new_targeting,this.template_id=e.template,this.template=null,this.button_template_id=e.button_template,this.button_template=null,this.conditions=e.conditions,this.frequency=e.frequency||{},this.accountFrequency=e.accountFrequency||{},this.test_group=e.test_group,this.inTargeting=!1,this.inSplitTest=!1,this.embed_selector=e.embed_selector,this.selector=e.selector,this.placement=e.placement,this._targetingCb=[],this.custom_fields=e.custom_fields,this.containerId=e.container_id,this.childForms=e.child_forms||[],this.behaviors={},this.getTargetElement=null,this.isControlGroup=!1,this.isTransactional=e.is_transactional,this._isAbTest=!(!this.salt||!window.PopMechanic.mindboxDeviceUUID),this._setSettings(),this._integrations=t.reduce((function(e,t){if(t&&(!t.form||t.form===n.id)){var r=IntegrationFactory(t);!r||n.isControlGroup&&!r.shouldRunForControlGroup()||e.push(r)}return e}),[]),this.sendContactsIntegrations=this.getSendContactsIntegrations(),this.reportClose=this.reportClose.bind(this),this.reportShow=this.reportShow.bind(this),this._getTargetElementCreator=this._getTargetElementCreator.bind(this),this.setBehaviors=this.setBehaviors.bind(this),this.subscribeIntegrations=this.subscribeIntegrations.bind(this),this.integrationsOnRender=this.integrationsOnRender.bind(this)};Form.prototype.isStatic=function(){return"static"===this.template.template_type||-1!==this.template.behaviors.indexOf("static")},Form.prototype.isEmbedded=function(){return"embedded"===this.template.template_type||-1!==this.template.behaviors.indexOf("embedded")},Form.prototype.setBehaviors=function(){this.behaviors=BehaviorFactory.getInstances(this.template.behaviors,this),this.getTargetElement=this._getTargetElementCreator()},Form.prototype._getFormVariant=function(){var e=this,t=window.PopMechanic.formHash,n=this.variants[0];if(!this._isAbTest)return n;if(t){var r=document.location.toString();if(-1!==r.indexOf(VARIANT_ID_PARAM+"=")){var i=r.split(VARIANT_ID_PARAM+"=")[1].split("&")[0],o=this.variants.find((function(e){return e.ab_test_variant_internal_id===i}));if(o)return o}return n}return this.variants.find((function(e){return e.is_winner}))||this.variants.find((function(t){try{return hashMatchesInterval(window.PopMechanic.mindboxDeviceUUID,e.salt,t.modulus_lower_inclusive,t.modulus_upper_exclusive)}catch(e){return debug.log(e),!1}}))||n},Form.prototype._setSettings=function(){var e=this._getFormVariant();if(!window.PopMechanic.formHash&&this._isAbTest&&this.control_group)try{hashMatchesInterval(window.PopMechanic.mindboxDeviceUUID,this.salt,this.control_group.modulus_lower_inclusive,this.control_group.modulus_upper_exclusive)&&(this.isControlGroup=!0)}catch(e){debug.log(e)}this.settings=e.view_settings,this.button_template_id=this.settings.button_template,this.settings.conditions_splits=this.settings_splits[0].conditions_splits},Form.prototype.setConditions=function(e){this.conditions=_.find(this.settings.conditions_splits,(function(t){return t.id===e})),this.conditions||(window.PopMechanic.isTesting||this.isEmbedded()?this.conditions={conditions:{delay:0}}:t=function(){return-1!==this.template.behaviors.indexOf("always")},Form.prototype.ignoresTargeting=function(){return!(!this.conditions||!this.conditions.conditions||"ignore_targeting"!==this.conditions.conditions.only_forced)},Form.prototype.checkFrequency=function(){return window.PopMechanic.isTesting?Promise.resolve(!0):Frequency.checkForm(this.frequency,this.id)},Form.prototype.checkAccountFrequency=function(){return this.frequency.priority||window.PopMechanic.isTesting?Promise.resolve(!0):Frequency.checkAccount(this.accountFrequency,this.id)},Form.prototype.checkTargeting=function(e){var t=this;if(!t._integrations.some((function(e){return e.skipForm(t)}))){var n=_.once((function(){report({type:"bucket",form:t.id,settings:t.settings?t.settings.id:0,conditions:t.conditions?t.conditions.id:""})}));return Promise.resolve(t.getTargetElement&&t.getTargetElement()).then((function(){return!!window.PopMechanic.isTesting||Targeting.check(t,(function(r){t.setInTargeteturn!1})).then((function(e){return t.setInTargeting(e),e&&n(),e}))}},Form.prototype.cancelConditions=function(){},Form.prototype.checkConditions=function(){var e=this,t=getConditionsPromisns.combinator),n=new Promise((function(t,n){e.cancelConditions=n}));return Promise.race([t,n]).then(_.constant(!0)).catch(_.constant(!1))},Form.prototype.setInTargeting=function(e){e!==this.inTargeting&&(this.inTargeting=e,this._targetingCb.forEach((function(t){t(e)})))},Form.prototype.onTargetingChange=function(e){if("function"==typeof e){this._targetingCb.push(e),this.inTargeting&&setTimnge=function(e){this._targetingCb=_.without(this._targetingCb,e)},Form.prototype.getLeadType=function(){var e=this.template.behaviors;return e.indexOf("lead")>-1?"lead":e.indexOf("info")>-1?"info-"+this.id:void 0},Form.prototype.getTestGroupId=function(){return this.test_group&&this.test_group.id?this.test_group.id:"form-"+this.id},Form.prototype.setTemplate=function(e){this.template=e,"embedded"===this.template.template_type&&-1===this.template.behaviors.indexOf("embedded")&&this.template.behaviors.push("embedded"),(_.includes(this.template.behaviors,"banner-h")||_.includes(this.template.behaviors,"banner-v"))&&(this.template.behaviors=_.without(this.template.behaviors,"banner")),this.setBehaviors()},Form.prototype.setButtonTemplate=function(e){this.button_template=e},Form.prototype.setInSplitTest=function(e){this.inSplitTest=e};var specialCaseEvents={show:"formShow",close:"formClose"};function chunk(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(Array.prototype.slice.call(e,r,r+=t));return n}function rafMap(e,t,n){void 0===n&&(n=10);var r,i,o=[],a=0,s=chunk(e,n),c=new Promise((function(e,t){r=e,i=t}));return requestAnimationFrame((function e(){if(a>=s.length)return r(_.flatten(o,1));try{var n=s[a];o.push(_.map(n,t)),a+=1,requestAnimationFrame(e)}catch(e){i(e)}})),c}Form.prototype.report=function(e,t){var n={form:this.id,settings:this.settings?this.settings.id:"",conditions:this.conditions?this.conditions.id:"",type:e};t&&_.merge(n,t),report(n);var r=specialCaseEvents[e]||e;Dispatcher.trigger(r,{form:this})},Form.prototype.repoow")},Form.prototype.reportClose=function(){this.report("close")},Form.prototype.reportSlaSuccess=function(){},Form.prototype.reportSlaFailure=function(){},Form.prototype._getTargetElementCreator=function(){var e=_.chain(this.behaviors).values().reverse().find((function(e){return!!e.getTargetElement})).vunction(){_.forEach(this.behaviors,(function(e){e.terminate()}))},Form.prototype.pushToHistory=function(){form.add({id:this.id,form:{containerId:this.containerId}})},Form.prototype.subscribeIntegrations=function(){var e=this;this._integrations.forEach((function(t){Dispatcher.on("lead",(function(n,r){r.form.id===e.id&&t.shouldRunOnContactsSent(r.lead)&&t.onContactsSent(n,r)})),Dispatcher.on("targeting",(function(n,r){r.form.id===e.id&&t.onTargetingReady(n,r)})),Dispatcher.on("formShow",(function(n,r){r.form.id===e.id&&t.onShow(n,r)})),Dispatcher.on("formClose",(function(n,r){r.form.id===e.id&ations.filter((function(e){return e.shouldRunOnSendContacts()}))},Form.prototype.integrationsOnRenderegrations.map((function(t){return Promise.resolve(t.onRender(e))})))};var Init=inherit({forms:[],activeForms:[],pluginData:[],formsMap:{},formsReady:null,_deviceUUID:null,__constructor:function(e){var t=e.data,n=e.deviceUUID,r=e.onTargetingChange,i=e.debug;void 0===i&&(i=,a=_.identity;this.formsReady=new Promise((function(e,t){o=e,a=t})),this.onTargetingChange=r,this._debug=i,this._data=this._normalizeData(t),this._data.contacts?window.PopMechanic.leads=this._data.contacts:window.PopMechanic.leads=[],n&&(this._deviceUUID=n),this._getAbTestFormsIds=this._getAbTestFormsIds.bind(this),this._getTransactionalForms=this._getTransactionalForms.bind(this),this._setFormsAsync().then(o,(function(e){report({type:"exception",url:location.href}),a(e)}))},_getFormsIds:function(e){return e.map((function(e){return e.id}))},_getWithFormsOnlyLogicForms:function(e,t){var n=this,r=this._getFormsIds(this.forms),i=e.variants.reduce((function(e,i){if(i.internal_id===t.internal_id)return e;var o="all"===i.form_selection_kind?r:n._getFormsIds(i.forms);return _.union(e,o)}),[]),o=_.difference(r,i),a="all"===t.form_selection_kind?r:this._getFormsIds(t.forms);return _.union(o,a)},_getWithoutFormsAvailableLogicForms:function(e,t){var n=this;if(t.is_control_group)return this._debug.log('Control group of global a/b test (global_ab_test_internal_id="'+e.glos.reduce((function(e,t){return e.concat(n._getFormsIds(t.forms))}),[]),i=_.difference(r,this._getFormsIds(t.forms));return _.difference(this._getFormsIds(this.forms),i)},_getAbTestFormsIds:function(e){var t=this,n=_.find(e.variants,(function(n){try{return hashMatchesInterval(t._deviceUUID,e.salt,n.modulus_lower_inclusive,n.modulus_upper_exclusive)}catch(e){return debug.log(e),!1}}));return n?e.variants.every((function(e){return e.form_selection_kind}))?this._getWithFormsOnlyLogicForms(e,n):e.variants.every((function(e){return!e.form_selection_kind}))?this._getWithoutFormsAvailableLogicForms(e,n):(this._debug.log('Variants of a/b test (global_ab_test_internal_id="'+e.global_ab_test_internal_id+'") are corrupted. Skipping the test.'),this._getFormsIds(this.forms)):this._getFormsIds(this.forms)},_getAbTestsForms:function(){var e=this;return this._data.global_ab_tests.length?_.intersection.apply(_,this._data.global_ab_tests.map(this._getAbTestFormsIds)).map((function(t){return e.foreturn this.formsTestsForms(),t=this._getTransactionalForms();return _.union(e,t)},_normalizeData:function(e){return _.extend({},{global_ab_tests:[]},e)},_selectFormFromGroup:function(e,t){if(!e.length)return null;if(1===e.length)return e[0];if(!Session.formsChanged(t,e)){var n=Session.getForm(t);return _.find(e,(function(e){return e.id===n}))}var r=_.sample(e);return Session.setForms(t,e),Session.setForm(t,r.id),r},_setFormsAsync:function(){var e=this;return rafMap(this._data.forms,(function(t){var n=new Form(_.extend({},t,{accountFrequency:e._data.frequency}),e._data.integrations||[]);return n.setTemplate(e.getTemplate(n.template_id)),n.setButtonTemplate(e.getButtonTemplate(n.button_template_id)),n.pushToHistory(),n})).then((function(t){e.formsMap=_.indexBy(t,"id");var n=_.groupBy(t,(function(e){return e.getTestGroupId()}));return _.map(n,e._selectFormFromGroup).filter(_.isObject)})).then((function(t){e.forms=t,t.forEach((function(e){e.setInSplitTest(!0);var t=e.test_group?e.test_group.conditions_splits:e.settings.conditions_splits;if(Session.conditionsSplitsChanged(e.id,t)){var n=_.sample(t);n&&Session.setConditionsSplit(e.id,n.id)}e.setConditions(Session.getConditionsSplit(e.id))}))})).then((function(){return e.activeForms=e._getActiveForms(),window.PopMechanic.initReae.activeForms,(function(t){t.checkTargeting(e.onTargetingChange)}))})).then((function(){e.pluginData=_.map(e.formsMap,(function(e){return{id:e.id,name:e.name,isEmbedded:e.isEmbedded()||e.isStatic(),testGroup:{id:e.getTestGroupId(),name:e.test_group?e.test_group.name:""},inSplitTest:!!e.inSplitTest,inTargeting:e.inTargeting}}))}))},getTemplate:function(e){return _.find(this._data.templates,(function(t){return t.id===e}))||{}},getButtonTemplate:function(e){return _.find(this._data.button_templates,(function(t){return t.id===e}))||{}}}),settings=window.PopMechanic,prevLocation=null,locationWatchInterval=null,formViews={},lockUpdate=!0;window.PopMechanic.sbjs=sbjs,window.PopMechanic.$=cash,window.PopMechanic._=_,window.PopMechanic.Promise=Promise;try{updateCachedVisitStartTs()}catch(e){}function init(e){var t,n=e.config,r=e.deviceUUID;lockUpdate=!0,window.PopMechanic.initAt=Date.now(),window.PopMechanic.initReadyTs=0,window.PopMechanic.targetingReadyTs=0,r&&(window.PopMechanic.customs=window.PopMechanic.customs||{},window.PopMechanic.customs.mindboxDeviceUUID=r,window.PopMechanic.mindboxDeviceUUID=r),reportVisit({url:location.href,ts:Date.now(),vst:sbjs.get.udata.vst}),(t=new Init({data:n,deviceUUID:r,onTargetingChange:function(e,n){t.formsReady.then((function(){if(n&&!formViews[e.id]){var t=view.init(e);t&&(formViews[e.id]=t)}if(window.PopMechanic.targetingReadyTs=globalUtils.getTabVisibilityDuration(),window.PopMechanic.debugMode)try{window.postMessage({source:CONFIG.CSS_PREFIX+"script",type:"SET_IN_TARGETING",data:{clientId:window.PopMechanic.client,formId:e.id,inTargeting:n}},"*")}catch(e){}}))}})).formsReady.then((function(){report({type:"pageview",url:location.href}),Dispatcher.on("lead",(function(e,t){try{window.PopMechanic.onContactsSent(t.lead)}catch(e){}})),window.PopMechanic.show=function(e,n){var r=t.formsMap[e];if(!r||r.isEmbedded()||r.isStatic())return!1;var i=formViews[r.id];if(!i){if(!(i=new FormView(t.formsMap[e],t.formsMap[e].template.behaviors)))return!1;formViews[r.id]=i}var o=i.form.getLeadType();return!(Session.isContactsSent(o)&&!n)&&(i.show(!0),i)},window.PopMechanic.getModel=function(e){return t.formsMap[e]},window.PopMechanic.getView=function(e){return formViews[e]},window.PopMechanic.embed=function(e,n){if(void 0===n&&(n={}),t.formsMap[e]){var r="string"==typeof n?{selector:n}:n;r.selector&&(t.formsMap[e].selector=r.selector,t.formsMap[e].embed_selector=!0);var i=view.init(t.formsMap[e]);r.force&&i.show(!0)}},window.PopMechanic.watchHash?(prevLocation=window.location.href,locationWatchInterval=setInterval(watchLocation,300)):!1!==window.PopMechanic.watchLocation&&(prevLocation=window.location.pathname,locationWatchInterval=setInterval(watchPathname,300)),t.activeForms.forEach((function(e){if(!formViews[e.id]){var t=view.init(e);t&&(formViews[e.id]=t)}})),settings.isTesting&&n.forms.forEach((function(e){e.container_id||window.PopMechanic.show(e.id,!0)})),window.PopMechanic.loaded=!0,window.PopMechanic.onLoad&&"function"==typeof window.PopMechanic.onLoad&&window.PopMechanic.onLoad();try{window.postMessage({source:CONFIG.CSS_PREFIX+"script",type:"SET_LOADED",data:{clientId:window.PopMechanic.client,forms:t.pluginData}},"*")}catch(e){}cash("html").addClass(CONFIG.CSS_PREFIX+"loaded"),lockUpdate=!1}))}function watchPathname(){var e=window.location.pathname;e!==prevLocation&&(prevLocation=e,window.PopMechanic.update())}function watchLocation(){var e=window.location.href;e!==prevLocation&&(prevLocation=e,window.PopMechanic.update())}funcws,(function(e){e&&"function"==typeof e.terminate&&e.terminate()})),formViews={},Dispatcher.off("lead"),Dispatcher.off("formShow"),Dispatcher.off("formClose"),Dispatcher.off("targeting"),window.PopMechanic.loaded=!1,window.PopMechanic.sampleSent=!1,clearInterval(locationWatchInterval),cash("#"+CONFIG.CSS_PREFIX+"snippet").html(""),cash("[data-popmechanic-embed]").html(""),cash("html").removeClass(CONFIG.CSS_PREFIX+"loaded"),enableScroll(),window.PopMechanic.restartWatchdog()}sbjs.init({prefix:"popmechanic_"}),cash.ajaxSettings.xhrFields={withCredentials:!!settings.formHash},cash.ajaxSettings.global=!1,globalUtils.getSettings().then(init),window.PopMechanic.update=function(){lockUpdate||(lockUpdate=!0,destroy(),window.PopMechanic.initStartedAt=Date.now(),globalUtils.resetTabVisibilityDuration(),sbjs.init({prefix:"popmechanic_"}),globalUtils.getSettings(!1).then(init))},window.PopMechanic.destroy=destroy,window.addEventListener("message",(function(e){e.source===window&&e.data&&"popmechanic-extension"===e.data.source&&"SHOW"===e.data.type&&window.PopMechanic.show(e.data.id,!0)}))}();
