/*! For license information please see 130.7a9fe400df46e8f5baaf.chunk.v7.js.LICENSE.txt */
(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[130],{j9A4:function(e,t,r){"use strict";r.d(t,"a",();var n=r("he5V"),s=r("1bkS"),i=r("XPga"),o=r("NgDi");class c extends o.a{mit(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return super.emit(e,...r)}catch(t){return this.errorHandler(e,t),!0}}}var a=r("O9x+"),d=(r("rK/e"),r("A3AF"));const l=e=>"function"==typeof(null==e?void 0:e.getTelemetryProperties)&&"function"==typeof(null==e?void 0:e.addTelemetryProperties);function h(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&(e=>"string"==typeof(null==e?void 0:e.errorInstanceId))(e)&&l(e)}function u(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&l(e)}function g(e,t){const r={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if((e=>null!==e&&!Array.isArray(e)&&"object"==typeof e)(e)){const{errorType:n,stack:s,name:i}=e;"string"==typeof n&&(r.errorType=n),"string"==typeof s&&(r.stack=((e,r)=>{if(!t)return e;const n=e.split("\n");return n.shift(),void 0!==r&&n.unshift(r),n.join("\n")})(s,"string"==typeof i?i:void 0))}return r}function p(e){void 0===e.errorInstanceId&&(e.errorInstanceId=Object(d.a)())}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;if(u(e)&&p(e),h(e))return e.addTelemetryProperties(null!==(r=t.props)&&void 0!==r?r:{}),e;const{message:n,stack:s}=g(e,!1),i=new k({message:n,stack:s});if("object"==typeof e&&null!==e){const{canRetry:t,retryAfterSeconds:r}=e;Object.assign(f,{canRetry:t,retryAfterSeconds:r})}"object"!=typeof e&&i.addTelemetryProperties({typeofError:typeof e});const o=O.typeCheck(e)?e.getTelemetryProperties():{untrustedOrigin:1};return i.addTelemetryProperties(Object.assign(Object.assign({},o),t.props)),i}let v;function y(e){var t;return"string"==typeof(null===(t=e)||void 0===t?void 0:t.tag)}function m(e,t){return Array.isArray(e)&&e.every(()?JSON.stringify(e):b(e)?e:(console.error(`UnSupported Format of Logging Error Property for key ${t}:`,e),"REDACTED (arbitrary object)")}function b(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}class O extends Error{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;super(e),this.omitPropsFromLogging=r,this._errorInstanceId=Object(d.a)(),this.fluidErrorCode="-",r.add("omitPropsFromLogging"),r.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}atic typeCheck(e){return"object"==typeof e&&null!==e&&"function"==typeof e.addTelemetryProperties&&"function"==typeof e.getTelemetryProperties&&"string"==typeof e.errorInstanceId}addTelemetryProperties(e){!function(e,t){for(const r of Object.keys(t))void 0===e[r]&&(e[r]=t[r])}(this,e)}getTelemetryProperties(){const e=function(e,t){const r={};for(const n of Object.keys(e)){if(t.has(n))continue;const s=e[n];r[n]=y(s)?{value:m(s.value,n),tag:s.tag}:m(s,n)}return r}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}class k extends O{constructor(e){super(e.message),this.errorType="genericError",void 0!==e.stack&&function(e,t){try{Object.assign(e,{stack:t})}catch(r){e.addTelemetryProperties({stack2:t})}}(this,e.stack)}}var E;!E||(E={}));class j{atic numberFromString(e){if(null==e)return;const t=Number(e);return Number.isNaN(t)?e:t}tatic prepareErrorObject(e,t,r){const{message:n,errorType:s,stack:i}=g(t,!0);if(e.stack=i,e.error=n,e.errorType=s,((t)){const r=t.getTelemetryProperties();for(const t of Object.keys(r))void 0===e[t]&&(e[t]=r[t])}void 0===e.stack&&r&&(e.stack=function(){return function(){const e=new Error("<<generated stack>>");if(void 0===v&&(v=void 0!==e.stack),v)return e;try{throw e}catch(e){return e}}().stack}())}sendTelemetryEvent(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"generic"}),t)}sendTelemetryEventCore(e,t){const r=function(e){var{category:t,eventName:r}=e,n=e,["category","eventName"]);const s={category:t,eventName:r};for(const e of Object.keys(n))s[e]=T(n[e]);return s}(e);void 0!==t&&j.prepareErrorObject(r,t,!1),"number"==typeof r.duration&&(r.duration=j.formatTick(r.duration)),this.send(r)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var r;const n=Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"performance"});this.sendTelemetryEventCore(n,t)}prepareEvent(e){const t="error"===e.category||void 0!==e.error,r=Object.assign({},e);if(void 0!==this.namespace&&(r.eventName=`${this.namespace}${j.eventNamespaceSeparator}${r.eventName}`),this.properties){const n=[];n.push(this.properties.all),t&&n.push(this.properties.error);for(const t of n)if(void 0!==t)for(const n of Object.keys(t)){if(void 0!==e[n])continue;const s=t[n],i="function"==typeof s?s():s;void 0!==i&&(r[n]=i)}}return r}}j.eventNamespaceSeparator=":";class C extends j{constructor(e,t,r){super(t,r),this.baseLogger=e,H(e)&&R(this,new D(this,e.config))}static create(e,t,r){if(e instanceof C){const n={};for(const t of[e.properties,r])void 0!==t&&(void 0!==t.all&&(n.all=Object.assign(Object.assign({},n.all),t.all)),void 0!==t.error&&(n.error=Object.assign(Object.assign({},n.error),t.error)));return new C(e.baseLogger,void 0===e.namespace?t:void 0===t?e.namespace:`${e.namespace}${j.eventNamespaceSeparator}${t}`,n)}return new C(e||new w,t,r)}unction T(e){return y(e)?{value:S(e.value),tag:e.tag}:S(e)}function S(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return e;case"object":return JSON.stringify(e);default:return console.error(`convertToBasePropertyTypeUntagged: INVALID PROPERTY (typed as ${typeof e})`),`INVALID PROPERTY (typed as ${typeof e})`}}const L=new a.a((),N={getRawConfig:,P=e=>null!=e?new D(void 0,{getRawConfig:t=>{var r,n;try{return null===(n=I(null!==(r=e.getItem(t))&&void 0!==r?r:void 0))||void 0===n?void 0:n.raw}catch(e){}}}):N;unction I(e){let t,r=e;if("string"==typeof e)try{r=JSON.parse(e),t={raw:e,string:e}}catch(e){}if(void 0===r)return t;const n=typeof r;if(_(n))return Object.assign(Object.assign({},t),{raw:e,[n]:r});if(Array.isArray(r)){const n=typeof r[0];if(!_(n))return t;for(const e of r)if(typeof e!==n)return t;return Object.assign(Object.assign({},t),{raw:e,[`${n}[]`]:r})}return t}const A=()=>{var e;try{return null!==(e=globalThis.sessionStorage)&&void 0!==e?e:void 0}catch(e){return}};class D{constructor(e){this.logger=e,this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set;for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];const i=[...n];for(;i.length>0;){const e=i.shift();void 0!==e&&M(e)&&!t.has(e)&&(t.add(e),e instanceof D?i.push(...e.orderedBaseProviders):this.orderedBaseProviders.push(e))}}getBoolean(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}getNumber(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}getString(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}getBooleanArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}getNumberArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}getStringArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}etCacheEntry(e){var t;if(!this.configCache.has(e)){for(const r of this.orderedBaseProviders){const n=I(null==r?void 0:r.getRawConfig(e));if(void 0!==n)return this.configCache.set(e,n),null===(t=this.logger)||void 0===t||t.send({category:"generic",eventName:"ConfigRead",configName:{tag:E.CodeArtifact,value:e},configValue:{tag:E.CodeArtifact,value:JSON.stringify(n)}}),n}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function H(e){const t=e;return M(null==t?void 0:t.config)&&void 0!==(null==t?void 0:t.logger)}function R(e){if(H(e))throw new Error("Logger is already a monitoring context");const t=e;for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return t.config=new D(e,...n),t.logger=e,t}onst x="2.0.0-internal.4.3.0";class $ extends c{constructor(e,t,r){var s;let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0;super(((e,t)=>{r.sendErrorEvent({eventName:"DeltaConnection:EventException",name:e},t)})),s=this,this.socket=e,this.documentId=t,this.enableLongPollingDowngrades=i,this.connectionId=o,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(e,t)=>{this.queuedMessages.push(...t)},this.earlySignalHandler=this.mc=C.create(r,"DeltaConnection")),this.on("newListener",((e,t)=>{if(Object(n.a)(!this.disposed,522),$.eventsAlwaysForwarded.includes(e))Object(n.a)(this.trackedListeners.has(e),581);else{if(!$.eventsToForward.includes(e))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${e}`);Object(n.a)(0!==this.listeners(e).length===this.trackedListeners.has(e),523),this.trackedListeners.has(e)||this.addTrackedListener(e,()}}))}et disposed(){const e=Error.stackTraceLimit;try{Error.stackTraceLimit=50,Object(n.a)(this._disposed||this.socket.connected,580)}catch(e){throw this.addPropsToError(e)}finally{Error.stackTraceLimit=e}return this._disposed}get logger(){return this.mc.logger}et clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}et version(){return this.details.version}heckNotDisposed(){const e=Error.stackTraceLimit;try{Error.stackTraceLimit=50,Object(n.a)(!this.disposed,524)}catch(e){throw this.addPropsToError(e)}finally{Error.stackTraceLimit=e}}get initialMessages(){return this.checkNotDisposed(),Object(n.a)(this.earlyOpHandlerAttached,142),Object(n.a)(0!==this.listeners("op").length,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort((),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotDisposed(),Object(n.a)(0!==this.listeners("signal").length,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}mitMessages(e,t){this.disposed||this.socket.emit(e,this.clientId,t)}submit(e){this.checkNotDisposed(),this.emitMessages("submitOp",[e])}submitSignal(e){this.checkNotDisposed(),this.emitMessages("submitSignal",[[e]])}closeSocket(e){this._disposed?this.logger.sendTelemetryEvent({eventName:"SocketCloseOnDisposedConnection",driverVersion:x,details:JSON.stringify(Object.assign(Object.assign({},this.getConnectionDetailsProps()),{trackedListenerCount:this.trackedListeners.size}))},e):this.closeSocketCore(e)}ispose(){this.logger.sendTelemetryEvent({eventName:"ClientClosingDeltaConnection",driverVersion:x,details:JSON.stringify(Object.assign({},this.getConnectionDetailsProps()))}),this.disconnect(Object(s.k)("Client closing delta connection",{canRetry:!0},{driverVersion:x}))}disconnect(e){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnectCore(),this.emit("disconnect",e),this.logger.sendTelemetryEvent({eventName:"AfterDisconnectEvent",driverVersion:x,details:JSON.stringify(Object.assign(Object.assign({},this.getConnectionDetailsProps()),{disconnectListenerCount:this.listenerCount("disconnect")}))}))}sync initialize(e,t){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0;let r=0;const s=o=()=>s()?this.socket.io.reconnectionAttempts():0;this._details=await new Promise(((n,c)=>{const a=e=>{try{this.closeSocket(e)}catch(e){const t=this.addPropsToError(e);this.logger.sendErrorEvent({eventName:"CloseSocketError"},t)}c(e)},d=e=>{try{this.disconnect(e)}catch(e){const t=this.addPropsToError(e);this.logger.sendErrorEvent({eventName:"FailConnectionError"},t)}c(e)};this.socketConnectionTimeout=setTimeout((()=>{d(this.createErrorObject("orderingServiceHandshakeTimeout"))}),t+2e3),this.addConnectionListener("connect_error",(e=>{var t,n,i;r++;let c=!1;try{const r=null==e?void 0:e.description,s=null==e?void 0:e.context;if(s&&"object"==typeof s){if("DEPTH_ZERO_SELF_SIGNED_CERT"===(null===(t=s.statusText)||void 0===t?void 0:t.code))return void a(this.createErrorObject("connect_error",e,!1))}else if(r&&"object"==typeof r){if("DEPTH_ZERO_SELF_SIGNED_CERT"===(null===(n=r.error)||void 0===n?void 0:n.code))return void a(this.createErrorObject("connect_error",e,!1));"TransportError"===e.type&&(c=!0),r.target=void 0}}catch(e){}c&&this.enableLongPollingDowngrades&&"polling"!==(null===(i=this.socket.io.opts.transports)||void 0===i?void 0:i[0])&&(this.socket.io.opts.transports=["polling","websocket"],s()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),s()&&r<(()||a(this.createErrorObject("connect_error",e))})),this.addConnectionListener("connect_timeout",(()=>{a(this.createErrorObject("connect_timeout"))})),this.addConnectionListener("connect_document_success",(t=>{if(void 0!==e.nonce&&void 0!==t.nonce&&t.nonce!==e.nonce)return;const r=e.mode,s=t.mode;if(t.claims.scopes.includes(i.a.DocWrite)){if(s!==r)return void d(this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1))}else if("write"===s)return void d(this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));this.checkpointSequenceNumber=t.checkpointSequenceNumber,this.removeConnectionListeners(),n(t)})),this.addTrackedListener("disconnect",(e=>{const t=this.createErrorObject("disconnect",e);a(t)})),this.addTrackedListener("error",(e=>{const t=this.createErrorObject("error",e,"Invalid namespace"!==e);a(t)})),this.addConnectionListener("connect_document_error",(t=>{void 0!==e.nonce&&void 0!==t.nonce&&t.nonce!==e.nonce||d(this.createErrorObject("connect_document_error",t))})),this.socket.emit("connect_document",e)})),Object(n.a)(!this.disposed,582)}addPropsToError(e){return f(e,{props:{details:JSON.stringify(Object.assign({},this.getConnectionDetailsProps()))}})}getConnectionDetailsProps(){var e,t;return{disposed:this._disposed,socketConnected:null===(e=this.socket)||void 0===e?void 0:e.connected,clientId:null===(t=this._details)||void 0===t?void 0:t.clientId,connectionId:this.connectionId}}dConnectionListener(e,t){Object(n.a)(!$.eventsAlwaysForwarded.includes(e),583),Object(n.a)(!$.eventsToForward.includes(e),584),this.socket.on(e,t),Object(n.a)(!this.connectionListeners.has(e),525),this.connectionListeners.set(e,t)}addTrackedListener(e,t){this.socket.on(e,t),Object(n.a)(!this.trackedListeners.has(e),526),this.trackedListeners.set(e,t)}removeTrackedListeners(){for(const[e,t]of this.trackedListeners.entries())this.socket.off(e,t);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){void 0!==this.socketConnectionTimeout&&clearTimeout(this.socketConnectionTimeout);for(const[e,t]of this.connectionListeners.entries())this.socket.off(e,t);this.connectionListeners.clear()}createErrorObject(e,t){let r,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return r="TransportError"===(null==t?void 0:t.type)?`${void 0!==(null==t?void 0:t.message)?`${t.message}: `:""}${JSON.stringify(t,(()=>{const e=new WeakSet;return(t,r)=>{if("object"==typeof r&&null!==r){if(e.has(r))return"<removed/circular>";e.add(r)}return r}})())}`:g(t,!0).message,Object(s.k)(`socket.io (${e}): ${r}`,{canRetry:n},{driverVersion:x,details:JSON.stringify(Object.assign({},this.getConnectionDetailsProps()))})}}$.eventsToForward=["nack","op","signal","pong"],$.eventsAlwaysForwarded=["disconnect","error"]}}]);
//# sourceMappingURL=130.7a9fe400df46e8f5baaf.chunk.v7.js.map