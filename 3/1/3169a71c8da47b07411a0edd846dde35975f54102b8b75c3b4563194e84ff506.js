//! TrackJS JavaScript error monitoring agent.
//! COPYRIGHT (c) 2023 ALL RIGHTS RESERVED
//! See License at https://trackjs.com/terms/
self.TrackJS=self.trackJs=(function(g,l,n){"use awesome";var u=function(a,b){this.config=a;this.onError=b;a.enabled&&this.watch()};u.prototype={watch:function(){c.forEach(["EventTarget","Node","XMLHttpRequest"],this);this.wrapTimer("setTimeout");this.wrapTimer("setInterval")},wrap:function(a){ar d=this;try{if(!c.isFunction(a)||c.hasOwn(a,"__trackjs__"))return a;if(c.hasOwn(a,"__trackjs_state__"))return a.__trackjs_state__}catch(p){return a}var e,f;if(d.config.bindStack)try{throw Error();}catch(p){f=p.stack,e=c.isoNow()}for(var h in a)c.hasOwn(a,h)&&(b[h]=a[h]);b.prototype=a.prototype;b.__trackjs__=!0;return a.__trackjs_state__=b},wrapEventTarget:wrapTimer:function(a){var b=this;c.patch(g,a,function(a){return function(e,f){var h=Array.prototype.slice.call(arguments),g=h[0];c.isFunction(g)&&(h[0]=b.wrap(g));return c.has(a,"apply")?a.apply(this,h):
a(h[0],h[1])}})}};var q=q.prototype={current:{},initOnly:{application:!0,cookie:!0,enabled:!0,token:!0,callback:{enabled:!0},console:{enabled:!0},navigation:{enabled:!0},network:{enabled:!0,fetch:!0},visitor:{enabled:!0},window:{enabled:!0,promise:!0}},defaults:{application:"",cookie:!1,dedupe:!0,dependencies:!0,enabled:!0,forwardingDomain:"",errorURL:"https://capture.trackjs.com/capture",errorNoSSLURL:"http://capture.trackjs.com/capture",
faultURL:"https://usage.trackjs.com/fault.gif",usageURL:"https://usage.trackjs.com/usage.gif",onError:serialize:function(a){f(""===a)return"Empty String";if(a===n)return"undefined";if(c.isString(a)||c.isNumber(a)||c.isBoolean(a)||c.isFunction(a))return""+a;if(c.isElement(a))return b(a);if("symbol"===typeof a)return Symbol.prototype.toString.call(a);
var d;try{d=JSON.stringify(a,}catch(f){d="";for(var e in a)if(a.hasOwnProperty(e))try{d+=',"'+e+'":"'+a[e]+'"'}catch(h){}d=d?"{"+d.replace(",","")+"}":"Unserializable Object"}return d.replace(/"undefined"/g,"undefined").replace(/"NaN"/g,"NaN")},sessionId:"",token:"",userId:"",version:"",callback:{enabled:!0,bindStack:!1},console:{enabled:!0,display:!0,
error:!0,warn:!1,watch:["log","debug","info","warn","error"]},navigation:{enabled:!0},network:{enabled:!0,error:!0,fetch:!0},visitor:{enabled:!0},window:{enabled:!0,promise:!0}},initCurrent:function(a){this.removeEmpty(a);if(this.validate(a,this.defaults,"[TrackJS] config",{}))return this.current=c.defaultsDeep({},a,this.defaults),!0;this.current=c.defaultsDeep({},this.defaults);return!1},setCurrent:removeEmpty:validate:function(a,b,d,e){var f=!0;d=d||"";e=e||{};for(var c in a)if(a.hasOwnProperty(c))if(b.hasOwnProperty(c)){var g=typeof b[c];g!==typeof a[c]?(console.warn(d+"."+c+": property must be type "+g+"."),f=!1):"[object Array]"!==Object.prototype.toString.call(a[c])||this.validateArray(a[c],b[c],d+"."+c)?"[object Object]"===Object.prototype.toString.call(a[c])?f=this.validate(a[c],b[c],d+"."+
c,e[c]):e.hasOwnProperty(c)&&(console.warn(d+"."+c+": property cannot be set after load."),f=!1):f=!1}else console.warn(d+"."+c+": property not supported."),f=!1;return f},validateArray:;var r=r.prototype=
{wrapConsoleObject:function(a,b){a=a||{};var d=a.log||function(){},e=this,f;for(f=0;f<b.watch.length;f++)(function(f){var g=a[f]||d;a[f]=function(){try{var d=Array.prototype.slice.call(arguments);e.log.add("c",{timestamp:e.util.isoNow(),severity:f,message:e.serialize(1===d.length?d[0]:d)});if(b[f])if(c.isError(d[0])&&1===d.length)e.onError("console",d[0]);else try{throw Error(e.serialize(1===d.length?d[0]:d));}catch(m){e.onError("console",m)}b.display&&(e.util.hasFunction(g,"apply")?g.apply(a,d):
g(d[0]))}catch(m){e.onFault(m)}}})(b.watch[f]);return a},report:function(){return this.log.all("c")}};var v=function(a,b,d,e,c){this.config=a;this.util=b;this.log=d;this.window=e;this.document=c;this.correlationId=this.token=null;this.initialize()};v.prototype={initialize:getCustomerToken:getCorrelationId:report:;var w=function(a){this.config=a;this.loadedOn=(new Date).getTime();this.originalUrl=c.getLocation();this.referrer=c.isBrowser?l.referrer:""};w.prototype={discoverDependencies:function(){var a={TrackJS:"3.10.4"};g.jQuery&&g.jQuery.fn&&g.jQuery.fn.jquery&&(a.jQuery=g.jQuery.fn.jquery);g.jQuery&&g.jQuery.ui&&g.jQuery.ui.version&&(a.jQueryUI=g.jQuery.ui.version);g.angular&&g.angular.version&&g.angular.version.full&&
(a.angular=g.angular.version.full);for(var b in g)if("_trackJs"!==b&&"_trackJS"!==b&&"_trackjs"!==b&&"webkitStorageInfo"!==b&&"webkitIndexedDB"!==b&&"top"!==b&&"parent"!==b&&"frameElement"!==b)try{if(g[b]){var d=g[b].version||g[b].Version||g[b].VERSION;"string"===typeof d&&(a[b]=d)}}catch(e){}a.TrackJS&&a.trackJs&&delete a.trackJs;return a},report:;var x=x.prototype={all:clear:truncate:add:get:;var D=y=y.prototype={isCompatible:function(a){a=a||g;return!c.has(a,"chrome.app.runtime")&&c.has(a,"addEventListener")&&c.has(a,"history.pushState")},record:report:function(){return this.log.all("h")},watch:function(){if(this.isCompatible()){var a=this,b=c.getLocationURL().relative;g.addEventListener("popstate",
function(){var d=c.getLocationURL().relative;a.record("popState",b,d);b=d},!0);c.forEach(["pushState","replaceState"],function(d){c.patch(history,d,function(e){return function(){b=c.getLocationURL().relative;var f=e.apply(this,arguments),h=c.getLocationURL().relative;a.record(d,b,h);b=h;return f}})})}}};var z=z.prototype={initialize:function(a){a.XMLHttpRequest&&this.util.hasFunction(a.XMLHttpRequest.prototype.open,
"apply")&&this.watchNetworkObject(a.XMLHttpRequest);a.XDomainRequest&&this.util.hasFunction(a.XDomainRequest.prototype.open,"apply")&&this.watchNetworkObject(a.XDomainRequest);this.options.fetch&&c.isWrappableFunction(a.fetch)&&this.watchFetch()},escapeUrl:watchFetch:function(){var a=this,b=this.log,d=this.options,e=this.onError;c.patch(g,"fetch",function(f){return function(h,p){if(p&&p.__trackjs__)return f.apply(g,arguments);var k;
try{throw Error();}catch(E){k=E.stack}var m=h instanceof Request?h.url:h,n=h instanceof Request?h.method:(p||{}).method||"GET",m=a.escapeUrl(m),l=f.apply(g,arguments);l.__trackjs_state__=b.add("n",{type:"fetch",startedOn:c.isoNow(),method:n,url:c.truncate(m,2E3)});return l.then(function(a){var f=b.get("n",l.__trackjs_state__);if(f){c.defaults(f,{completedOn:c.isoNow(),statusCode:a.status,statusText:a.statusText});var h=a.headers.get("trackjs-correlation-id");h&&(f.requestCorrelationId=h);d.error&&
400<=a.status&&(f=Error(f.statusCode+" : "+f.method+" "+f.url),f.stack=k,e("ajax",f))}return a})["catch"](function(a){a=a||{};var f=b.get("n",l.__trackjs_state__);f&&(c.defaults(f,{completedOn:c.isoNow(),statusCode:0,statusText:a.toString()}),d.error&&(e("ajax",{name:a.name,message:(a.message||"Failed")+": "+f.method+" "+f.url,stack:a.stack||k}),a.__trackjs_state__=!0));throw a;})}})},watchNetworkObject:function(a){var b=this,d=a.prototype.open,e=a.prototype.send;a.prototype.open=function(a,e){var c=
(e||"").toString();0>c.indexOf("localhost:0")&&(c=b.escapeUrl(c),this._trackJs={method:a,url:c});return d.apply(this,arguments)};a.prototype.send=return a},listenForNetworkComplete:function(a){var b=
this;b.window.ProgressEvent&&a.addEventListener&&a.addEventListener("readystatechange",!0);a.addEventListener?a.addEventListener("load",!0):setTimeout(function(){try{var d=a.onload;a.onload=function(){b.finalizeNetworkEvent(a);b.checkNetworkFault(a);"function"===typeof d&&b.util.hasFunction(d,"apply")&&d.apply(a,arguments)};var e=a.onerror;a.onerror=function(){b.finalizeNetworkEvent(a);
b.checkNetworkFault(a);"function"===typeof oldOnError&&e.apply(a,arguments)}}catch(c){b.onFault(c)}},0)},finalizeNetworkEvent:checkNetworkFault:report:function(){return this.log.all("n")}};var t=function(a,b){this.util=a;this.config=b;this.disabled=!1;this.throttleStats={attemptCount:0,throttledCount:0,lastAttempt:(new Date).getTime()};g.JSON&&g.JSON.stringify||(this.disabled=!0)};t.prototype={errorEndpoint:function(a){var b=this.config.current,d=b.errorURL;
c.isBrowser&&!c.testCrossdomainXhr()&&-1===g.location.protocol.indexOf("https")?d=b.errorNoSSLURL:b.forwardingDomain&&(d="https://"+b.forwardingDomain+"/capture");return d+"?token="+a+"&v=3.10.4"},usageEndpoint:function(a){var b=this.config.current,d=b.usageURL;b.forwardingDomain&&(d="https://"+b.forwardingDomain+"/usage.gif");return this.appendObjectAsQuery(a,d)},trackerFaultEndpoint:function(a){var b=(this.config||{}).current||q.prototype.defaults,d=b.faultURL;b.forwardingDomain&&(d="https://"+
b.forwardingDomain+"/fault.gif");return this.appendObjectAsQuery(a,d)},appendObjectAsQuery:getCORSRequest:function(a,b){var d;this.util.testCrossdomainXhr()?(d=new g.XMLHttpRequest,d.open(a,b),d.setRequestHeader("Content-Type","text/plain")):"undefined"!==typeof g.XDomainRequest?(d=new g.XDomainRequest,d.open(a,b)):d=null;return d},sendTrackerFault:sendUsage:sendError:function(a,b){var d=this;if(!this.disabled&&!this.throttle(a))try{if(c.isBrowser){var e=this.getCORSRequest("POST",this.errorEndpoint(b));e.onreadystatechange=e._trackJs=n;e.send(g.JSON.stringify(a))}else if(c.isWorker){var f={method:"POST",mode:"cors",body:g.JSON.stringify(a),__trackjs__:1};fetch(this.errorEndpoint(b),f).then(["catch"](}}catch(h){throw this.disabled=!0,h;}},throttle:function(a){var b=(new Date).getTime();this.throttleStats.attemptCount++;if(this.throttleStats.lastAttempt+1E3>=b){if(this.throttleStats.lastAttempt=b,10<this.throttleStats.attemptCount)return this.throttleStats.throttledCount++,
!0}else a.throttled=this.throttleStats.throttledCount,this.throttleStats.attemptCount=0,this.throttleStats.lastAttempt=b,this.throttleStats.throttledCount=0;return!1}};var c=function(){function a(d,e,f,h){f=f||!1;h=h||0;c.forEach(e,;return d}eturn{isBrowser:"undefined"!==
typeof g&&"undefined"!==typeof g.document,isWorker:"object"===typeof self&&self.constructor&&0<=(self.constructor.name||"").indexOf("WorkerGlobalScope"),isNode:"undefined"!==typeof process&&null!=process.versions&&null!=process.versions.node,addEventListenerSafe:afterDocumentLoad:bind:contains:defaults:function(d){return a(d,Array.prototype.slice.call(arguments,1),!1)},defaultsDeep:defer:forEach:getLocation:getLocationURL:has:hasFunction:hasOwn:isArray:
isBoolean:function(a){return"boolean"===typeof a||c.isObject(a)&&"[object Boolean]"===b(a)},isBrowserIE:isBrowserSupported:isError:isElement:isFunction:function(a){return!(!a||"function"!==typeof a)},isNumber:isObject:isString:isWrappableFunction:isoNow:keys:noop:pad:function(a){a=String(a);1===a.length&&(a="0"+a);return a},parseURL:function(a){var b=a.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);
if(!b)return{};b={protocol:b[2],host:b[4],path:b[5],query:b[6],hash:b[8]};b.origin=(b.protocol||"")+"://"+(b.host||"");b.relative=(b.path||"")+(b.query||"")+(b.hash||"");b.href=a;return b},patch:testCrossdomainXhr:truncate:function(a,b){a=""+a;if(a.length<=b)return a;var c=a.length-b;return a.substr(0,b)+"...{"+c+"}"},tryGet:uuid:wrapError:function(a){var b=a||Object.prototype.toString.call(a);if(b&&b.innerError)return a;var c=Error("TrackJS Caught: "+(b.message||b));c.description="TrackJS Caught: "+b.description;c.file=b.file;c.line=b.line||b.lineNumber;c.column=b.column||b.columnNumber;c.stack=b.stack;c.innerError=a;return c}}}(),A=function(a,b,d,c,f,g){this.util=a;this.log=b;this.onError=d;this.onFault=c;this.options=g;this.document=f;a.isBrowser&&
g.enabled&&this.initialize(f)};A.prototype={initialize:onDocumentClicked:onInputChanged:function(a){try{var b=this.getElementFromEvent(a);if(b&&b.tagName)if(this.isDescribedElement(b,"textarea"))this.writeVisitorEvent(b,"input",b.value);else if(this.isDescribedElement(b,"select")&&b.options&&b.options.length)this.onSelectInputChanged(b);else this.isDescribedElement(b,"input")&&!this.isDescribedElement(b,
"input",["button","submit","hidden","checkbox","radio"])&&this.writeVisitorEvent(b,"input",b.value)}catch(d){this.onFault(d)}},onSelectInputChanged:writeVisitorEvent:function(a,b,d,c){"password"===this.getElementType(a)&&(d=n);var f=this.getElementAttributes(a);
a.innerText&&(f.__trackjs_element_text=this.util.truncate(a.innerText,500));this.log.add("v",{timestamp:this.util.isoNow(),action:b,element:{tag:a.tagName.toLowerCase(),attributes:f,value:this.getMetaValue(d,c)}})},getElementFromEvent:isDescribedElement:function(a,b,d){if(a.tagName.toLowerCase()!==b.toLowerCase())return!1;if(!d)return!0;a=this.getElementType(a);for(b=0;b<d.length;b++)if(d[b]===a)return!0;return!1},getElementType:getElementAttributes:getMetaValue:matchInputPattern:report:;var B=B.prototype={watchPromiseErrors:function(a){var b=this;a.addEventListener?a.addEventListener("unhandledrejection",function(a){try{a=a||{};var e=a.detail?c.tryGet(a.detail,"reason"):c.tryGet(a,"reason");if(e!==n&&null!==e&&!e.__trackjs_state__){if(!c.isError(e))try{throw Error(b.serialize(e));
}catch(f){e=f}b.onError("promise",e)}}catch(f){b.onFault(f)}}):c.patch(a,"onunhandledrejection",function(a){return function(c){b.onError("promise",c);a.apply(this,arguments)}})},watchWindowErrors:function(a){var b=this;c.patch(a,"onerror",function(a){return function(e,f,g,l,k){try{if(c.isError(k)){b.onError("window",k);a.apply(this,arguments);return}k=k||{};var m={message:k.message||b.serialize(e),name:k.name||"Error",line:k.line||parseInt(g,10)||null,column:k.column||parseInt(l,10)||null,stack:k.stack||
null};"[object Event]"!==Object.prototype.toString.call(e)||f?m.file=k.file||b.serialize(f):m.file=(e.target||{}).src;b.onError("window",m)}catch(n){b.onFault(n)}a.apply(this,arguments)}})}};var C=function(){this.hasInstalled=!1;this.hasEnabled=!0;this.window=g;this.document=l;this.util=c;this.install=c.bind(this.install,this);this.onError=c.bind(this.onError,this);this.onFault=c.bind(this.onFault,this);this.serialize=c.bind(this.serialize,this);this.log=new x(c);this.metadata=new D(this.serialize);
var a=g&&(g._trackJs||g._trackJS||g._trackjs);a&&this.install(a)};C.prototype={install:function(a){try{if(c.isNode)return this.warn("monitoring disabled in node"),!1;if(!c.has(a,"token"))return this.warn("missing token"),!1;if(this.hasInstalled)return this.warn("already installed"),!1;this.config=new q(a);this.transmitter=new t(this.util,this.config);this.environment=new w(this.config);this.customer=new v(this.config,this.util,this.log,this.window,this.document);if(!this.config.current.enabled)return this.hasEnabled=
!1;this.windowConsoleWatcher=new r(this.util,this.log,this.onError,this.onFault,this.serialize,this.window,this.config.current.console);if(!this.util.isBrowserSupported())return!1;this.callbackWatcher=new u(this.config.current.callback,this.onError,this.onFault);this.visitorWatcher=new A(this.util,this.log,this.onError,this.onFault,this.document,this.config.current.visitor);this.navigationWatcher=new y(this.log,this.config.current.navigation);this.networkWatcher=new z(this.util,this.log,this.onError,
this.onFault,this.window,this.config.current.network);this.windowWatcher=new B(this.onError,this.onFault,this.serialize,this.window,this.config.current.window);var b=this;c.afterDocumentLoad(;return this.hasInstalled=!0}catch(d){return this.onFault(d),!1}},pub:function(){var a=this,b={addMetadata:this.metadata.addMetadata,attempt:configure:hash:"ee2d3930f78cfd8bb97c23558688dedfac2d12ce",isInstalled:install:this.install,removeMetadata:this.metadata.removeMetadata,track:function(b){if(!a.hasInstalled&&a.hasEnabled)a.warn("agent must be installed");else{var e=
c.isError(b)?b.message:a.serialize(b);b=b||{};if(!b.stack)try{throw Error(e);}catch(f){b=f}a.onError("direct",b)}},version:"3.10.4",watch:watchAll:function(a){var b=Array.prototype.slice.call(arguments,1),f;for(f in a)"function"!==typeof a[f]||c.contains(b,f)||(a[f]=this.watch(a[f],a));return a}};new r(c,a.log,a.onError,a.onFault,a.serialize,
b,q.prototype.defaults.console);return b},onError:function(){var a,b=!1;return function(d,e,f){if(this.hasInstalled&&this.hasEnabled&&c.isBrowserSupported())try{if(f=f||{bindStack:null,bindTime:null,force:!1},e&&c.isError(e)||(e={name:"Error",message:this.serialize(e,f.force)}),-1===e.message.indexOf("TrackJS Caught"))if(b&&-1!==e.message.indexOf("Script error"))b=!1;else{var h=c.defaultsDeep({},{agentPlatform:c.isBrowser?"browser":"worker",bindStack:f.bindStack,bindTime:f.bindTime,column:e.column||
e.columnNumber,console:this.windowConsoleWatcher.report(),customer:this.customer.report(),entry:d,environment:this.environment.report(),file:e.file||e.fileName,line:e.line||e.lineNumber,message:e.message,metadata:this.metadata.report(),nav:this.navigationWatcher.report(),network:this.networkWatcher.report(),url:(g.location||"").toString(),stack:e.stack,timestamp:this.util.isoNow(),visitor:this.visitorWatcher.report(),version:"3.10.4"});if(!f.force)try{if(!this.config.current.onError(h,e))return}catch(m){h.console.push({timestamp:this.util.isoNow(),
severity:"error",message:m.message});var l=this;setTimeout(0)}if(this.config.current.dedupe){var k=(h.message+h.stack).substr(0,1E4);if(k===a)return;a=k}(function(){function a(){var b=0;c.forEach(h.console,;return 8E4<=b}for(var b=0;a()&&b<h.console.length;)h.console[b].message=c.truncate(h.console[b].message,1E3),b++})();this.log.clear();setTimeout(;b=!0;this.transmitter.sendError(h,this.customer.token)}}catch(m){this.onFault(m)}}}(),
onFault:function(a){var b=this.transmitter||new t;a=a||{};a={token:(this.customer||{}).token,file:a.file||a.fileName,msg:a.message||"unknown",stack:(a.stack||"unknown").substr(0,1E3),url:this.window.location,v:"3.10.4",h:"ee2d3930f78cfd8bb97c23558688dedfac2d12ce",x:this.util.uuid()};b.sendTrackerFault(a)},serialize:
warn:;return(new C).pub()})("undefined"===typeof self?void 0:self,"undefined"===typeof document?void 0:document);

