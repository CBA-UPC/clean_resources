var ys=Object.defineProperty;var Rf=(r,e,t)=>e in r?ys(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Gt=r=>ys(r,"__esModule",{value:!0});var Vt=(r,e)=>()=>(e||(e={exports:{}},r(e.exports,e)),e.exports),jt=(r,e)=>{for(var t in e)ys(r,t,{get:e[t],enumerable:!0})};var k=(r,e,t)=>(Rf(r,typeof e!="symbol"?e+"":e,t),t),Io=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)},tt=(r,e,t)=>(Io(r,e,"read from private field"),t?t.call(r):e.get(r)),di=(r,e,t,n)=>(Io(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var Ys=Vt(Kp=>{Gt(Kp);jt(Kp,{prebid:()=>qp,stats:()=>zp});var vn={},Oc={},qp=ft.then(r=>new Promise((e,t)=>{let n=r,i=n.document,s=i.createElement("script");s.crossOrigin="anonymous",s.integrity="sha384-gHZmRucNaVC8CxTZBOi/WNnoVHTYfei5A9Gco8ZC6/AXqlJ47EmEc1rXAZXL1iHL",s.src="https://embed.sendtonews.com/library/prebid/8.6.0/prebid.js";function a(){l(),e(n.pbjs)}function o(c){l(),t(`Could not load Prebid library from ${c.target.src}`)}function l(){s.removeEventListener("load",a),s.removeEventListener("error",o)}s.addEventListener("load",a),s.addEventListener("error",o),i.head.appendChild(s)}).then(e=>{if(!e)throw new Error("Prebid library loaded but pbjs does not exist");["auctionInit","bidRequested","bidderError","bidResponse","noBid","auctionEnd"].forEach(n=>{e.onEvent(n,t.bind(null,n))});function t(n,i){let{auctionId:s}=i;switch(n){case"auctionInit":vn[s]={bidders:Object.fromEntries(i.bidderRequests.map(o=>[o.bidderCode,{}])),start:performance.now(),time:-performance.now(),timeout:i.timeout},i.adUnitCodes.forEach(o=>Oc[o]=vn[s]);break;case"auctionEnd":vn[s].time+=performance.now();break;case"bidRequested":vn[s].bidders[i.bidderCode].time=-performance.now();break;case"bidderError":{let o=i.bidderRequest.auctionId;vn[o].bidders[i.bidderRequest.bidderCode].error={status:i.error.status,message:i.error.statusText};break}case"bidResponse":vn[s].bidders[i.bidderCode].bid=i.cpm;case"noBid":let a=i.bidderCode||i.bidder;if(vn[s].bidders[a].time>=0)return;vn[s].bidders[a].time+=performance.now();break;default:break}}return e}));function zp(r){return JSON.parse(JSON.stringify(Oc[r]),(e,t)=>typeof t=="number"?t>=0?Math.round(t*1e3)/1e3:"timeout":t)}});var Zs=Vt(Jp=>{Gt(Jp);jt(Jp,{apstag:()=>Zp});var Zp=ft.then(r=>new Promise((e,t)=>{let n=r,i=n.document;function s(u,d){n.apstag._Q.push([u,d])}n.apstag={init:function(){s("i",arguments)},fetchBids:function(){s("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]};let a=i.createElement("script");a.src="https://c.amazon-adsystem.com/aax2/apstag.js";function o(){c(),e(n.apstag)}function l(u){c(),t(`Could not load apstag library from ${u.target.src}`)}function c(){a.removeEventListener("load",o),a.removeEventListener("error",l)}a.addEventListener("load",o),a.addEventListener("error",l),i.head.appendChild(a)}).then(e=>{if(!e)throw new Error("apstag library loaded but apstag does not exist");return e}))});var lf=Vt(Ob=>{Gt(Ob);jt(Ob,{resonateAnalytics:()=>Fb});var Mb=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","profile"],Fb=ft.then(r=>new Promise((e,t)=>{let n=r,i=n.resonateAnalytics=[];Mb.forEach(u=>{i[u]=function(){return i.push([u,...arguments]),i}}),i.SNIPPET_VERSION="1.0.0";let s=n.document,a=s.createElement("script");a.src="https://cdn.resonate.com/analytics.js/v1/200302733/analytics.min.js";function o(){c(),e(n.resonateAnalytics)}function l(u){c(),t(`Could not load Resonate Analytics from ${u.target.src}`)}function c(){a.removeEventListener("load",o),a.removeEventListener("error",l)}a.addEventListener("load",o),a.addEventListener("error",l),s.head.appendChild(a)}).then(e=>{if(!e)throw new Error("Resonate Analytics library loaded but object does not exist");return e}))});var uf=Vt(Nb=>{Gt(Nb);jt(Nb,{Amp:()=>cf});var cf=class{constructor(e,t,n){e.method("play",()=>{n.userInitiatedPlay()}),e.method("pause",()=>{n.userInitiatedPause()}),e.method("mute",()=>{n.muted=!0}),e.method("unmute",()=>{n.muted=!1}),e.method("showcontrols",j(()=>{t.isAmpFloating=!1,n.controls=!0,n.controlsOverlay=!0})),e.method("hidecontrols",j(()=>{t.isAmpFloating=!0,n.controls=!1,n.controlsOverlay=!1})),e.method("fullscreenenter",j(()=>{n.controlBar.isFullscreen=!0,n.controls=!0,n.controlsOverlay=!0,t.isAmpFloating=!1})),e.method("fullscreenexit",j(()=>{n.controlBar.isFullscreen=!1,n.controls=!1,n.controlsOverlay=!1,t.isAmpFloating=!0})),x(()=>[n.paused,t.ampFloat],([i,s])=>{i||!s?e.postEvent("pause"):e.postEvent("playing")}),x(()=>n.muted,i=>{i?e.postEvent("muted"):e.postEvent("unmuted")}),x(()=>n.revenuePlayer.adPlaying,i=>{i?e.postEvent("ad_start"):e.postEvent("ad_end")})}}});var hf=Vt(Bb=>{Gt(Bb);jt(Bb,{LoopPlaylist:()=>df});var df=class{constructor(e,t){let n=!1;x(()=>e.isLastPlaylistItem,i=>{n=i},{fireImmediately:!0}),x(()=>t.ended,i=>{i&&n&&(e.selectedPlaylistItem={idx:0})})}}});var ff=Vt(Ub=>{Gt(Ub);jt(Ub,{EngagementLogger:()=>Eo});var zi,Eo=class{constructor(e,t){zi(this,{mediagroup:t,playedTotal:null,playedTotalTarget:0});let n=zi(this),i=()=>{let a=t.played,o=0;for(let l=0;l<a.length;++l)o+=a.end(l)-a.start(l);return o},s=()=>{let a=e.currentItem.isAlternate?-1:1,o=e.currentItem.loadCount,l=a*o;return isNaN(l)?null:a*o};x(()=>t.contentCurrentTime,()=>{let a=i(),o=n.playedTotal;n.playedTotal=i(),n.SM_ID=e.currentItem.SM_ID,n.sequence=s(),(o===null||a<o)&&(n.playedTotalTarget=0,clearInterval(n.interval),n.interval=setInterval(()=>ps.call(this,{}),500),ps.call(this,{forceLog:!0}))}),x(()=>!!e.waitForEngagementLoggingToFinish,a=>{!a||(clearInterval(n.interval),ps.call(this,{forceLog:!0}),e.waitForEngagementLoggingToFinish=!1)}),n.onUnload=()=>{clearInterval(n.interval),ps.call(this,{unloading:!0})}}};function $b(){let r=zi(this);return r.playedTotal>=r.playedTotalTarget?(r.playedTotalTarget+=r.playedTotalTarget>=60?60:10,!0):!1}function ps({forceLog:r,unloading:e}){let t=zi(this);!($b.call(this)||r)||ae.call(t.mediagroup,"ENGAGEMENT",{etime:t.playedTotal})}zi=oe(Eo)});var pf=Vt(Gb=>{Gt(Gb);jt(Gb,{PlaybackMode:()=>mf});var mf=class{constructor(e,t){let n,i;if(L(()=>n=e.isAutoplay),L(()=>i=e.isPlayOnView),n)t.play();else if(i)Q(()=>e.hasMediaGroupContainerBeenVisible||e.isMediaGroupFloating,()=>{t.play()});else{let s;L(()=>s=e.playbackMode),console.warn(`Playback mode [${s}] is not implemented, or unknown. Fallback to clickToPlay`)}}}});var Tf=Vt(Vb=>{Gt(Vb);jt(Vb,{RecircContent:()=>bf});var yf=document.createElement("template");yf.innerHTML=`<style>
${gf}</style>
${vf}`;var bf=class{constructor(e,t){t.parentElement.appendChild(yf.content.cloneNode(!0));let n=t.parentElement.querySelector("#recircContent"),i=n.querySelector("#pillOverlay"),s=n.querySelector("#graphicOverlay"),a=n.querySelector("#externalLink"),o,l=new class{get activeMediaLink(){let w=e.mediaLinks;o=t.contentCurrentTime;let O=t.adPlaying,S=t.isFullscreen;return!w.length||O||S?(u(),[]):(c(),w.filter(I=>I.startTime<=o&&I.endTime>o))}};ye(l),Object.freeze(l);function c(){n.style.display="",t.recircActive=!0}function u(){n.style.display="none",t.recircActive=!1}let d=null;function h(w){d=!0,n.href=w,n.style.cursor=""}function f(){d!==!1&&(d=!1,n.removeAttribute("href"),n.style.cursor="default")}function m(w){d&&ae.call(n,"RECIRC",{url:n.href,timeClicked:o})}n.addEventListener("click",m);function p(){i.style.display="none"}function g(){i.style.display=""}function T(){s.style.display="none"}function _(w){if(!w){T(),g();return}s.style.display="",s.src=w}function y(){a.style.display=""}function b(){a.style.display="none"}function E(w){let O=w.url,S=w.status,I=w.graphicURL;switch(h(O),S){case"INVIDEO":p(),T(),b();break;case"ACTIVE":p(),b(),_(I);break;case"EXTERNAL":p(),T(),y();break;case"DEFAULT":default:g(),T(),b();break}}P(()=>{let w=e.playerMediaWidth;n.style.fontSize=`${w*.028}px`});let C=null;P(()=>{let w=l.activeMediaLink;if(w.length<=0){C=null,f(),p(),T(),b();return}C!==w[0]&&(C=w[0],E(C))})}}});var Sf=Vt(Hb=>{Gt(Hb);jt(Hb,{Api:()=>So});var Sn,So=class{constructor(e){let t={},n=null,i=!1,s=!1,a=e;Sn(this,{apis:t,configurationDelay:n,configurationDelayLocked:i,isFloatPlayer:s,model:a,modelApi:null});let l=Sn(this);this.reset(),P(()=>l.modelApi=e.api),P(()=>l.isFloatPlayer=e.isFloatPlayer),l.configurationDelay=Promise.resolve(),l.apis={floatApi:new gs(a)},Object.freeze(this)}get floatApi(){let e=Sn(this);if(!!e.isFloatPlayer)return e.apis.floatApi}get configurationDelay(){return Sn(this).configurationDelay}set configurationDelay(e){let t=Sn(this);if(t.configurationDelayLocked){console.warn("Configuration delay is locked and cannot be set");return}t.configurationDelay=Ef(5e3,e).then(n=>{n&&console.log(n)}).catch(n=>{this.reset(),n==="stnPromiseTimedOut"?console.error("Player API configurationDelay expired."):n&&console.error(n)})}reset(){let e=Sn(this);L(()=>e.model.api={}),Object.entries(e.apis).forEach(([t,n])=>{n?.reset()})}lockConfigurationDelay(){let e=Sn(this);e.configurationDelayLocked=!0}get float(){return this.floatApi.float}set float(e){this.floatApi.float=e}get floatVerticalTranslate(){return this.floatApi.verticalTranslate}set floatVerticalTranslate(e){this.floatApi.verticalTranslate=e}};Sn=oe(So)});var Pf={0:"Invalid value for configuration 'enforceActions', expected 'never', 'always' or 'observed'",1:function(e,t){return"Cannot apply '"+e+"' to '"+t.toString()+"': Field not found."},5:"'keys()' can only be used on observable objects, arrays, sets and maps",6:"'values()' can only be used on observable objects, arrays, sets and maps",7:"'entries()' can only be used on observable objects, arrays and maps",8:"'set()' can only be used on observable objects, arrays and maps",9:"'remove()' can only be used on observable objects, arrays and maps",10:"'has()' can only be used on observable objects, arrays and maps",11:"'get()' can only be used on observable objects, arrays and maps",12:"Invalid annotation",13:"Dynamic observable objects cannot be frozen. If you're passing observables to 3rd party component/function that calls Object.freeze, pass copy instead: toJS(observable)",14:"Intercept handlers should return nothing or a change object",15:"Observable arrays cannot be frozen. If you're passing observables to 3rd party component/function that calls Object.freeze, pass copy instead: toJS(observable)",16:"Modification exception: the internal structure of an observable array was changed.",17:function(e,t){return"[mobx.array] Index out of bounds, "+e+" is larger than "+t},18:"mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js",19:function(e){return"Cannot initialize from classes that inherit from Map: "+e.constructor.name},20:function(e){return"Cannot initialize map from "+e},21:function(e){return"Cannot convert to map from '"+e+"'"},22:"mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js",23:"It is not possible to get index atoms from arrays",24:function(e){return"Cannot obtain administration from "+e},25:function(e,t){return"the entry '"+e+"' does not exist in the observable map '"+t+"'"},26:"please specify a property",27:function(e,t){return"no observable property '"+e.toString()+"' found on the observable object '"+t+"'"},28:function(e){return"Cannot obtain atom from "+e},29:"Expecting some object",30:"invalid action stack. did you forget to finish an action?",31:"missing option for computed: get",32:function(e,t){return"Cycle detected in computation "+e+": "+t},33:function(e){return"The setter of computed value '"+e+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"},34:function(e){return"[ComputedValue '"+e+"'] It is not possible to assign a new value to a computed value."},35:"There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`",36:"isolateGlobalState should be called before MobX is running any reactions",37:function(e){return"[mobx] `observableArray."+e+"()` mutates the array in-place, which is not allowed inside a derivation. Use `array.slice()."+e+"()` instead"},38:"'ownKeys()' can only be used on observable objects",39:"'defineProperty()' can only be used on observable objects"},kf=Pf;function H(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];{var i=typeof r=="string"?r:kf[r];throw typeof i=="function"&&(i=i.apply(null,t)),new Error("[MobX] "+i)}}var Df={};function bs(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:Df}var Co=Object.assign,Xi=Object.getOwnPropertyDescriptor,xt=Object.defineProperty,hi=Object.prototype,Qi=[];Object.freeze(Qi);var Ts={};Object.freeze(Ts);var xf=typeof Proxy!="undefined",Of=Object.toString();function Ro(){xf||H("`Proxy` objects are not available in the current environment. Please configure MobX to enable a fallback implementation.`")}function fi(r){V.verifyProxies&&H("MobX is currently configured to be able to run in ES5 mode, but in ES5 MobX won't be able to "+r)}function nt(){return++V.mobxGuid}function Es(r){var e=!1;return function(){if(!e)return e=!0,r.apply(this,arguments)}}var Fn=function(){};function Pe(r){return typeof r=="function"}function An(r){var e=typeof r;switch(e){case"string":case"symbol":case"number":return!0}return!1}function Ji(r){return r!==null&&typeof r=="object"}function He(r){if(!Ji(r))return!1;var e=Object.getPrototypeOf(r);if(e==null)return!0;var t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t.toString()===Of}function Po(r){var e=r==null?void 0:r.constructor;return e?e.name==="GeneratorFunction"||e.displayName==="GeneratorFunction":!1}function mi(r,e,t){xt(r,e,{enumerable:!1,writable:!0,configurable:!0,value:t})}function ko(r,e,t){xt(r,e,{enumerable:!1,writable:!1,configurable:!0,value:t})}function ln(r,e){var t="isMobX"+r;return e.prototype[t]=!0,function(n){return Ji(n)&&n[t]===!0}}function Nn(r){return r instanceof Map}function pi(r){return r instanceof Set}var Do=typeof Object.getOwnPropertySymbols!="undefined";function Mf(r){var e=Object.keys(r);if(!Do)return e;var t=Object.getOwnPropertySymbols(r);return t.length?[].concat(e,t.filter(function(n){return hi.propertyIsEnumerable.call(r,n)})):e}var Bn=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Do?function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:Object.getOwnPropertyNames;function Ss(r){return typeof r=="string"?r:typeof r=="symbol"?r.toString():new String(r).toString()}function xo(r){return r===null?null:typeof r=="object"?""+r:r}function ot(r,e){return hi.hasOwnProperty.call(r,e)}var Ff=Object.getOwnPropertyDescriptors||function(e){var t={};return Bn(e).forEach(function(n){t[n]=Xi(e,n)}),t};function Oo(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,Nf(n.key),n)}}function _s(r,e,t){return e&&Oo(r.prototype,e),t&&Oo(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ht(){return Ht=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Ht.apply(this,arguments)}function Mo(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,As(r,e)}function As(r,e){return As=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},As(r,e)}function Zi(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Bf(r,e){if(!!r){if(typeof r=="string")return Fo(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Fo(r,e)}}function Fo(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Un(r,e){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(t)return(t=t.call(r)).next.bind(t);if(Array.isArray(r)||(t=Bf(r))||e&&r&&typeof r.length=="number"){t&&(r=t);var n=0;return function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Uf(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Nf(r){var e=Uf(r,"string");return typeof e=="symbol"?e:String(e)}var Ue=Symbol("mobx-stored-annotations");function Ot(r){function e(t,n){gi(t,n,r)}return Object.assign(e,r)}function gi(r,e,t){if(ot(r,Ue)||mi(r,Ue,Ht({},r[Ue])),er(t)&&!ot(r[Ue],e)){var n=r.constructor.name+".prototype."+e.toString();H("'"+n+"' is decorated with 'override', but no such decorated member was found on prototype.")}$f(r,t,e),er(t)||(r[Ue][e]=t)}function $f(r,e,t){if(!er(e)&&ot(r[Ue],t)){var n=r.constructor.name+".prototype."+t.toString(),i=r[Ue][t].annotationType_,s=e.annotationType_;H("Cannot apply '@"+s+"' to '"+n+"':"+(`
The field is already decorated with '@`+i+"'.")+`
Re-decorating fields is not allowed.
Use '@override' decorator for methods overridden by subclass.`)}}function Gf(r){return ot(r,Ue)||(r[Ue]||H("No annotations were passed to makeObservable, but no decorated members have been found either"),mi(r,Ue,Ht({},r[Ue]))),r[Ue]}var te=Symbol("mobx administration"),vi=function(){function r(t){t===void 0&&(t="Atom@"+nt()),this.name_=void 0,this.isPendingUnobservation_=!1,this.isBeingObserved_=!1,this.observers_=new Set,this.diffValue_=0,this.lastAccessedBy_=0,this.lowestObserverState_=me.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=t}var e=r.prototype;return e.onBO=function(){this.onBOL&&this.onBOL.forEach(function(n){return n()})},e.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(n){return n()})},e.reportObserved=function(){return No(this)},e.reportChanged=function(){We(),Bo(this),V.stateVersion=V.stateVersion<Number.MAX_SAFE_INTEGER?V.stateVersion+1:Number.MIN_SAFE_INTEGER,Ke()},e.toString=function(){return this.name_},r}(),ws=ln("Atom",vi);function $o(r,e,t){e===void 0&&(e=Fn),t===void 0&&(t=Fn);var n=new vi(r);return e!==Fn&&Vf(n,e),t!==Fn&&Uo(n,t),n}function jf(r,e){return r===e}function Hf(r,e){return Ls(r,e)}function Wf(r,e){return Ls(r,e,1)}function Kf(r,e){return Object.is?Object.is(r,e):r===e?r!==0||1/r==1/e:r!==r&&e!==e}var $n={identity:jf,structural:Hf,default:Kf,shallow:Wf};function Vn(r,e,t){return Gn(r)?r:Array.isArray(r)?Le.array(r,{name:t}):He(r)?Le.object(r,void 0,{name:t}):Nn(r)?Le.map(r,{name:t}):pi(r)?Le.set(r,{name:t}):typeof r=="function"&&!tr(r)&&!nr(r)?Po(r)?Wt(r):yi(t,r):r}function qf(r,e,t){if(r==null||Mt(r)||cn(r)||lt(r)||Kt(r))return r;if(Array.isArray(r))return Le.array(r,{name:t,deep:!1});if(He(r))return Le.object(r,void 0,{name:t,deep:!1});if(Nn(r))return Le.map(r,{name:t,deep:!1});if(pi(r))return Le.set(r,{name:t,deep:!1});H("The shallow modifier / decorator can only used in combination with arrays, objects, maps and sets")}function ir(r){return r}function zf(r,e){return Gn(r)&&H("observable.struct should not be used with observable values"),Ls(r,e)?e:r}var Yf="override";function er(r){return r.annotationType_===Yf}function bi(r,e){return{annotationType_:r,options_:e,make_:Xf,extend_:Qf}}function Xf(r,e,t,n){var i;if((i=this.options_)!=null&&i.bound)return this.extend_(r,e,t,!1)===null?0:1;if(n===r.target_)return this.extend_(r,e,t,!1)===null?0:2;if(tr(t.value))return 1;var s=Go(r,this,e,t,!1);return xt(n,e,s),2}function Qf(r,e,t,n){var i=Go(r,this,e,t);return r.defineProperty_(e,i,n)}function Jf(r,e,t,n){var i=e.annotationType_,s=n.value;Pe(s)||H("Cannot apply '"+i+"' to '"+r.name_+"."+t.toString()+"':"+(`
'`+i+"' can only be used on properties with a function value."))}function Go(r,e,t,n,i){var s,a,o,l,c,u,d;i===void 0&&(i=V.safeDescriptors),Jf(r,e,t,n);var h=n.value;if((s=e.options_)!=null&&s.bound){var f;h=h.bind((f=r.proxy_)!=null?f:r.target_)}return{value:wn((a=(o=e.options_)==null?void 0:o.name)!=null?a:t.toString(),h,(l=(c=e.options_)==null?void 0:c.autoAction)!=null?l:!1,(u=e.options_)!=null&&u.bound?(d=r.proxy_)!=null?d:r.target_:void 0),configurable:i?r.isPlainObject_:!0,enumerable:!1,writable:!i}}function Vo(r,e){return{annotationType_:r,options_:e,make_:Zf,extend_:em}}function Zf(r,e,t,n){var i;if(n===r.target_)return this.extend_(r,e,t,!1)===null?0:2;if((i=this.options_)!=null&&i.bound&&(!ot(r.target_,e)||!nr(r.target_[e]))&&this.extend_(r,e,t,!1)===null)return 0;if(nr(t.value))return 1;var s=jo(r,this,e,t,!1,!1);return xt(n,e,s),2}function em(r,e,t,n){var i,s=jo(r,this,e,t,(i=this.options_)==null?void 0:i.bound);return r.defineProperty_(e,s,n)}function tm(r,e,t,n){var i=e.annotationType_,s=n.value;Pe(s)||H("Cannot apply '"+i+"' to '"+r.name_+"."+t.toString()+"':"+(`
'`+i+"' can only be used on properties with a generator function value."))}function jo(r,e,t,n,i,s){s===void 0&&(s=V.safeDescriptors),tm(r,e,t,n);var a=n.value;if(nr(a)||(a=Wt(a)),i){var o;a=a.bind((o=r.proxy_)!=null?o:r.target_),a.isMobXFlow=!0}return{value:a,configurable:s?r.isPlainObject_:!0,enumerable:!1,writable:!s}}function Is(r,e){return{annotationType_:r,options_:e,make_:nm,extend_:im}}function nm(r,e,t){return this.extend_(r,e,t,!1)===null?0:1}function im(r,e,t,n){return rm(r,this,e,t),r.defineComputedProperty_(e,Ht({},this.options_,{get:t.get,set:t.set}),n)}function rm(r,e,t,n){var i=e.annotationType_,s=n.get;s||H("Cannot apply '"+i+"' to '"+r.name_+"."+t.toString()+"':"+(`
'`+i+"' can only be used on getter(+setter) properties."))}function rr(r,e){return{annotationType_:r,options_:e,make_:sm,extend_:am}}function sm(r,e,t){return this.extend_(r,e,t,!1)===null?0:1}function am(r,e,t,n){var i,s;return om(r,this,e,t),r.defineObservableProperty_(e,t.value,(i=(s=this.options_)==null?void 0:s.enhancer)!=null?i:Vn,n)}function om(r,e,t,n){var i=e.annotationType_;"value"in n||H("Cannot apply '"+i+"' to '"+r.name_+"."+t.toString()+"':"+(`
'`+i+"' cannot be used on getter/setter properties"))}var lm="true",cm=Ho();function Ho(r){return{annotationType_:lm,options_:r,make_:um,extend_:dm}}function um(r,e,t,n){var i,s;if(t.get)return jn.make_(r,e,t,n);if(t.set){var a=wn(e.toString(),t.set);return n===r.target_?r.defineProperty_(e,{configurable:V.safeDescriptors?r.isPlainObject_:!0,set:a})===null?0:2:(xt(n,e,{configurable:!0,set:a}),2)}if(n!==r.target_&&typeof t.value=="function"){var o;if(Po(t.value)){var l,c=(l=this.options_)!=null&&l.autoBind?Wt.bound:Wt;return c.make_(r,e,t,n)}var u=(o=this.options_)!=null&&o.autoBind?yi.bound:yi;return u.make_(r,e,t,n)}var d=((i=this.options_)==null?void 0:i.deep)===!1?Le.ref:Le;if(typeof t.value=="function"&&(s=this.options_)!=null&&s.autoBind){var h;t.value=t.value.bind((h=r.proxy_)!=null?h:r.target_)}return d.make_(r,e,t,n)}function dm(r,e,t,n){var i,s;if(t.get)return jn.extend_(r,e,t,n);if(t.set)return r.defineProperty_(e,{configurable:V.safeDescriptors?r.isPlainObject_:!0,set:wn(e.toString(),t.set)},n);if(typeof t.value=="function"&&(i=this.options_)!=null&&i.autoBind){var a;t.value=t.value.bind((a=r.proxy_)!=null?a:r.target_)}var o=((s=this.options_)==null?void 0:s.deep)===!1?Le.ref:Le;return o.extend_(r,e,t,n)}var hm="observable",fm="observable.ref",mm="observable.shallow",pm="observable.struct",Wo={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(Wo);function sr(r){return r||Wo}var Ko=rr(hm),gm=rr(fm,{enhancer:ir}),vm=rr(mm,{enhancer:qf}),ym=rr(pm,{enhancer:zf}),qo=Ot(Ko);function ar(r){return r.deep===!0?Vn:r.deep===!1?ir:bm(r.defaultDecorator)}function Tm(r){var e;return r?(e=r.defaultDecorator)!=null?e:Ho(r):void 0}function bm(r){var e,t;return r&&(e=(t=r.options_)==null?void 0:t.enhancer)!=null?e:Vn}function zo(r,e,t){if(An(e)){gi(r,e,Ko);return}return Gn(r)?r:He(r)?Le.object(r,e,t):Array.isArray(r)?Le.array(r,e):Nn(r)?Le.map(r,e):pi(r)?Le.set(r,e):typeof r=="object"&&r!==null?r:Le.box(r,e)}Co(zo,qo);var Am={box:function(e,t){var n=sr(t);return new Ln(e,ar(n),n.name,!0,n.equals)},array:function(e,t){var n=sr(t);return(V.useProxies===!1||n.proxy===!1?_m:Sm)(e,ar(n),n.name)},map:function(e,t){var n=sr(t);return new Xo(e,ar(n),n.name)},set:function(e,t){var n=sr(t);return new Qo(e,ar(n),n.name)},object:function(e,t,n){return Yo(V.useProxies===!1||(n==null?void 0:n.proxy)===!1?Ti({},n):Em({},n),e,t)},ref:Ot(gm),shallow:Ot(vm),deep:qo,struct:Ot(ym)},Le=Co(zo,Am),Jo="computed",wm="computed.struct",Zo=Is(Jo),Lm=Is(wm,{equals:$n.structural}),jn=function(e,t){if(An(t))return gi(e,t,Zo);if(He(e))return Ot(Is(Jo,e));Pe(e)||H("First argument to `computed` should be an expression."),Pe(t)&&H("A setter as second argument is no longer supported, use `{ set: fn }` option instead");var n=He(t)?t:{};return n.get=e,n.name||(n.name=e.name||""),new Hn(n)};Object.assign(jn,Zo);jn.struct=Ot(Lm);var el,tl,or=0,Im=1,Cm=(el=(tl=Xi(function(){},"name"))==null?void 0:tl.configurable)!=null?el:!1,nl={value:"action",configurable:!0,writable:!1,enumerable:!1};function wn(r,e,t,n){t===void 0&&(t=!1),Pe(e)||H("`action` can only be invoked on functions"),(typeof r!="string"||!r)&&H("actions should have valid names, got: '"+r+"'");function i(){return il(r,t,e,n||this,arguments)}return i.isMobxAction=!0,Cm&&(nl.value=r,xt(i,"name",nl)),i}function il(r,e,t,n,i){var s=Rm(r,e,n,i);try{return t.apply(n,i)}catch(a){throw s.error_=a,a}finally{Pm(s)}}function Rm(r,e,t,n){var i=Ne()&&!!r,s=0;if(i){s=Date.now();var a=n?Array.from(n):Qi;it({type:Rs,name:r,object:t,arguments:a})}var o=V.trackingDerivation,l=!e||!o;We();var c=V.allowStateChanges;l&&(Wn(),c=Ei(!0));var u=Cs(!0),d={runAsAction_:l,prevDerivation_:o,prevAllowStateChanges_:c,prevAllowStateReads_:u,notifySpy_:i,startTime_:s,actionId_:Im++,parentActionId_:or};return or=d.actionId_,d}function Pm(r){or!==r.actionId_&&H(30),or=r.parentActionId_,r.error_!==void 0&&(V.suppressReactionErrors=!0),Si(r.prevAllowStateChanges_),_i(r.prevAllowStateReads_),Ke(),r.runAsAction_&&un(r.prevDerivation_),r.notifySpy_&&rt({time:Date.now()-r.startTime_}),V.suppressReactionErrors=!1}function Ps(r,e){var t=Ei(r);try{return e()}finally{Si(t)}}function Ei(r){var e=V.allowStateChanges;return V.allowStateChanges=r,e}function Si(r){V.allowStateChanges=r}var rl,km="create";rl=Symbol.toPrimitive;var Ln=function(r){Mo(e,r);function e(n,i,s,a,o){var l;return s===void 0&&(s="ObservableValue@"+nt()),a===void 0&&(a=!0),o===void 0&&(o=$n.default),l=r.call(this,s)||this,l.enhancer=void 0,l.name_=void 0,l.equals=void 0,l.hasUnreportedChange_=!1,l.interceptors_=void 0,l.changeListeners_=void 0,l.value_=void 0,l.dehancer=void 0,l.enhancer=i,l.name_=s,l.equals=o,l.value_=i(n,void 0,s),a&&Ne()&&In({type:km,object:Zi(l),observableKind:"value",debugObjectName:l.name_,newValue:""+l.value_}),l}var t=e.prototype;return t.dehanceValue=function(i){return this.dehancer!==void 0?this.dehancer(i):i},t.set=function(i){var s=this.value_;if(i=this.prepareNewValue_(i),i!==V.UNCHANGED){var a=Ne();a&&it({type:Et,object:this,observableKind:"value",debugObjectName:this.name_,newValue:i,oldValue:s}),this.setNewValue_(i),a&&rt()}},t.prepareNewValue_=function(i){if(Kn(this),ct(this)){var s=ut(this,{object:this,type:Et,newValue:i});if(!s)return V.UNCHANGED;i=s.newValue}return i=this.enhancer(i,this.value_,this.name_),this.equals(this.value_,i)?V.UNCHANGED:i},t.setNewValue_=function(i){var s=this.value_;this.value_=i,this.reportChanged(),bt(this)&&Tt(this,{type:Et,object:this,newValue:i,oldValue:s})},t.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},t.intercept_=function(i){return Ai(this,i)},t.observe_=function(i,s){return s&&i({observableKind:"value",debugObjectName:this.name_,object:this,type:Et,newValue:this.value_,oldValue:void 0}),wi(this,i)},t.raw=function(){return this.value_},t.toJSON=function(){return this.get()},t.toString=function(){return this.name_+"["+this.value_+"]"},t.valueOf=function(){return xo(this.get())},t[rl]=function(){return this.valueOf()},e}(vi),Dm=ln("ObservableValue",Ln),sl;sl=Symbol.toPrimitive;var Hn=function(){function r(t){this.dependenciesState_=me.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.isBeingObserved_=!1,this.isPendingUnobservation_=!1,this.observers_=new Set,this.diffValue_=0,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=me.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new lr(null),this.name_=void 0,this.triggeredBy_=void 0,this.isComputing_=!1,this.isRunningSetter_=!1,this.derivation=void 0,this.setter_=void 0,this.isTracing_=dt.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,t.get||H(31),this.derivation=t.get,this.name_=t.name||"ComputedValue@"+nt(),t.set&&(this.setter_=wn(this.name_+"-setter",t.set)),this.equals_=t.equals||(t.compareStructural||t.struct?$n.structural:$n.default),this.scope_=t.context,this.requiresReaction_=t.requiresReaction,this.keepAlive_=!!t.keepAlive}var e=r.prototype;return e.onBecomeStale_=function(){Om(this)},e.onBO=function(){this.onBOL&&this.onBOL.forEach(function(n){return n()})},e.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(n){return n()})},e.get=function(){if(this.isComputing_&&H(32,this.name_,this.derivation),V.inBatch===0&&this.observers_.size===0&&!this.keepAlive_)ks(this)&&(this.warnAboutUntrackedRead_(),We(),this.value_=this.computeValue_(!1),Ke());else if(No(this),ks(this)){var n=V.trackingContext;this.keepAlive_&&!n&&(V.trackingContext=this),this.trackAndCompute()&&xm(this),V.trackingContext=n}var i=this.value_;if(cr(i))throw i.cause;return i},e.set=function(n){if(this.setter_){this.isRunningSetter_&&H(33,this.name_),this.isRunningSetter_=!0;try{this.setter_.call(this.scope_,n)}finally{this.isRunningSetter_=!1}}else H(34,this.name_)},e.trackAndCompute=function(){var n=this.value_,i=this.dependenciesState_===me.NOT_TRACKING_,s=this.computeValue_(!0),a=i||cr(n)||cr(s)||!this.equals_(n,s);return a&&(this.value_=s,Ne()&&In({observableKind:"computed",debugObjectName:this.name_,object:this.scope_,type:"update",oldValue:n,newValue:s})),a},e.computeValue_=function(n){this.isComputing_=!0;var i=Ei(!1),s;if(n)s=al(this,this.derivation,this.scope_);else if(V.disableErrorBoundaries===!0)s=this.derivation.call(this.scope_);else try{s=this.derivation.call(this.scope_)}catch(a){s=new lr(a)}return Si(i),this.isComputing_=!1,s},e.suspend_=function(){this.keepAlive_||(Ds(this),this.value_=void 0,this.isTracing_!==dt.NONE&&console.log("[mobx.trace] Computed value '"+this.name_+"' was suspended and it will recompute on the next access."))},e.observe_=function(n,i){var s=this,a=!0,o=void 0;return P(function(){var l=s.get();if(!a||i){var c=Wn();n({observableKind:"computed",debugObjectName:s.name_,type:Et,object:s,newValue:l,oldValue:o}),un(c)}a=!1,o=l})},e.warnAboutUntrackedRead_=function(){this.isTracing_!==dt.NONE&&console.log("[mobx.trace] Computed value '"+this.name_+"' is being read outside a reactive context. Doing a full recompute."),(typeof this.requiresReaction_=="boolean"?this.requiresReaction_:V.computedRequiresReaction)&&console.warn("[mobx] Computed value '"+this.name_+"' is being read outside a reactive context. Doing a full recompute.")},e.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},e.valueOf=function(){return xo(this.get())},e[sl]=function(){return this.valueOf()},r}(),Li=ln("ComputedValue",Hn),me;(function(r){r[r.NOT_TRACKING_=-1]="NOT_TRACKING_",r[r.UP_TO_DATE_=0]="UP_TO_DATE_",r[r.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",r[r.STALE_=2]="STALE_"})(me||(me={}));var dt;(function(r){r[r.NONE=0]="NONE",r[r.LOG=1]="LOG",r[r.BREAK=2]="BREAK"})(dt||(dt={}));var lr=function(e){this.cause=void 0,this.cause=e};function cr(r){return r instanceof lr}function ks(r){switch(r.dependenciesState_){case me.UP_TO_DATE_:return!1;case me.NOT_TRACKING_:case me.STALE_:return!0;case me.POSSIBLY_STALE_:{for(var e=Cs(!0),t=Wn(),n=r.observing_,i=n.length,s=0;s<i;s++){var a=n[s];if(Li(a)){if(V.disableErrorBoundaries)a.get();else try{a.get()}catch(o){return un(t),_i(e),!0}if(r.dependenciesState_===me.STALE_)return un(t),_i(e),!0}}return ol(r),un(t),_i(e),!1}}}function Kn(r){var e=r.observers_.size>0;!V.allowStateChanges&&(e||V.enforceActions==="always")&&console.warn("[MobX] "+(V.enforceActions?"Since strict-mode is enabled, changing (observed) observable values without using an action is not allowed. Tried to modify: ":"Side effects like changing state are not allowed at this point. Are you trying to modify state from, for example, a computed value or the render function of a React component? You can wrap side effects in 'runInAction' (or decorate functions with 'action') if needed. Tried to modify: ")+r.name_)}function Mm(r){!V.allowStateReads&&V.observableRequiresReaction&&console.warn("[mobx] Observable '"+r.name_+"' being read outside a reactive context.")}function al(r,e,t){var n=Cs(!0);ol(r),r.newObserving_=new Array(r.observing_.length+100),r.unboundDepsCount_=0,r.runId_=++V.runId;var i=V.trackingDerivation;V.trackingDerivation=r,V.inBatch++;var s;if(V.disableErrorBoundaries===!0)s=e.call(t);else try{s=e.call(t)}catch(a){s=new lr(a)}return V.inBatch--,V.trackingDerivation=i,Nm(r),Fm(r),_i(n),s}function Fm(r){r.observing_.length===0&&(typeof r.requiresObservable_=="boolean"?r.requiresObservable_:V.reactionRequiresObservable)&&console.warn("[mobx] Derivation '"+r.name_+"' is created/updated without reading any observable value.")}function Nm(r){for(var e=r.observing_,t=r.observing_=r.newObserving_,n=me.UP_TO_DATE_,i=0,s=r.unboundDepsCount_,a=0;a<s;a++){var o=t[a];o.diffValue_===0&&(o.diffValue_=1,i!==a&&(t[i]=o),i++),o.dependenciesState_>n&&(n=o.dependenciesState_)}for(t.length=i,r.newObserving_=null,s=e.length;s--;){var l=e[s];l.diffValue_===0&&ll(l,r),l.diffValue_=0}for(;i--;){var c=t[i];c.diffValue_===1&&(c.diffValue_=0,Bm(c,r))}n!==me.UP_TO_DATE_&&(r.dependenciesState_=n,r.onBecomeStale_())}function Ds(r){var e=r.observing_;r.observing_=[];for(var t=e.length;t--;)ll(e[t],r);r.dependenciesState_=me.NOT_TRACKING_}function cl(r){var e=Wn();try{return r()}finally{un(e)}}function Wn(){var r=V.trackingDerivation;return V.trackingDerivation=null,r}function un(r){V.trackingDerivation=r}function Cs(r){var e=V.allowStateReads;return V.allowStateReads=r,e}function _i(r){V.allowStateReads=r}function ol(r){if(r.dependenciesState_!==me.UP_TO_DATE_){r.dependenciesState_=me.UP_TO_DATE_;for(var e=r.observing_,t=e.length;t--;)e[t].lowestObserverState_=me.UP_TO_DATE_}}var ur=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0,this.stateVersion=Number.MIN_SAFE_INTEGER},dr=!0,ul=!1,V=function(){var r=bs();return r.__mobxInstanceCount>0&&!r.__mobxGlobals&&(dr=!1),r.__mobxGlobals&&r.__mobxGlobals.version!==new ur().version&&(dr=!1),dr?r.__mobxGlobals?(r.__mobxInstanceCount+=1,r.__mobxGlobals.UNCHANGED||(r.__mobxGlobals.UNCHANGED={}),r.__mobxGlobals):(r.__mobxInstanceCount=1,r.__mobxGlobals=new ur):(setTimeout(function(){ul||H(35)},1),new ur)}();function Um(){if((V.pendingReactions.length||V.inBatch||V.isRunningReactions)&&H(36),ul=!0,dr){var r=bs();--r.__mobxInstanceCount==0&&(r.__mobxGlobals=void 0),V=new ur}}function Bm(r,e){r.observers_.add(e),r.lowestObserverState_>e.dependenciesState_&&(r.lowestObserverState_=e.dependenciesState_)}function ll(r,e){r.observers_.delete(e),r.observers_.size===0&&dl(r)}function dl(r){r.isPendingUnobservation_===!1&&(r.isPendingUnobservation_=!0,V.pendingUnobservations.push(r))}function We(){V.inBatch++}function Ke(){if(--V.inBatch==0){hl();for(var r=V.pendingUnobservations,e=0;e<r.length;e++){var t=r[e];t.isPendingUnobservation_=!1,t.observers_.size===0&&(t.isBeingObserved_&&(t.isBeingObserved_=!1,t.onBUO()),t instanceof Hn&&t.suspend_())}V.pendingUnobservations=[]}}function No(r){Mm(r);var e=V.trackingDerivation;return e!==null?(e.runId_!==r.lastAccessedBy_&&(r.lastAccessedBy_=e.runId_,e.newObserving_[e.unboundDepsCount_++]=r,!r.isBeingObserved_&&V.trackingContext&&(r.isBeingObserved_=!0,r.onBO())),r.isBeingObserved_):(r.observers_.size===0&&V.inBatch>0&&dl(r),!1)}function Bo(r){r.lowestObserverState_!==me.STALE_&&(r.lowestObserverState_=me.STALE_,r.observers_.forEach(function(e){e.dependenciesState_===me.UP_TO_DATE_&&(e.isTracing_!==dt.NONE&&fl(e,r),e.onBecomeStale_()),e.dependenciesState_=me.STALE_}))}function xm(r){r.lowestObserverState_!==me.STALE_&&(r.lowestObserverState_=me.STALE_,r.observers_.forEach(function(e){e.dependenciesState_===me.POSSIBLY_STALE_?(e.dependenciesState_=me.STALE_,e.isTracing_!==dt.NONE&&fl(e,r)):e.dependenciesState_===me.UP_TO_DATE_&&(r.lowestObserverState_=me.UP_TO_DATE_)}))}function Om(r){r.lowestObserverState_===me.UP_TO_DATE_&&(r.lowestObserverState_=me.POSSIBLY_STALE_,r.observers_.forEach(function(e){e.dependenciesState_===me.UP_TO_DATE_&&(e.dependenciesState_=me.POSSIBLY_STALE_,e.onBecomeStale_())}))}function fl(r,e){if(console.log("[mobx.trace] '"+r.name_+"' is invalidated due to a change in: '"+e.name_+"'"),r.isTracing_===dt.BREAK){var t=[];ml($m(r),t,1),new Function(`debugger;
/*
Tracing '`+r.name_+`'

You are entering this break point because derivation '`+r.name_+"' is being traced and '"+e.name_+`' is now forcing it to update.
Just follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update
The stackframe you are looking for is at least ~6-8 stack-frames up.

`+(r instanceof Hn?r.derivation.toString().replace(/[*]\//g,"/"):"")+`

The dependencies for this derivation are:

`+t.join(`
`)+`
*/
    `)()}}function ml(r,e,t){if(e.length>=1e3){e.push("(and many more)");return}e.push(""+"	".repeat(t-1)+r.name),r.dependencies&&r.dependencies.forEach(function(n){return ml(n,e,t+1)})}var hr=function(){function r(t,n,i,s){t===void 0&&(t="Reaction@"+nt()),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=me.NOT_TRACKING_,this.diffValue_=0,this.runId_=0,this.unboundDepsCount_=0,this.isDisposed_=!1,this.isScheduled_=!1,this.isTrackPending_=!1,this.isRunning_=!1,this.isTracing_=dt.NONE,this.name_=t,this.onInvalidate_=n,this.errorHandler_=i,this.requiresObservable_=s}var e=r.prototype;return e.onBecomeStale_=function(){this.schedule_()},e.schedule_=function(){this.isScheduled_||(this.isScheduled_=!0,V.pendingReactions.push(this),hl())},e.isScheduled=function(){return this.isScheduled_},e.runReaction_=function(){if(!this.isDisposed_){We(),this.isScheduled_=!1;var n=V.trackingContext;if(V.trackingContext=this,ks(this)){this.isTrackPending_=!0;try{this.onInvalidate_(),void 0!=="production"&&this.isTrackPending_&&Ne()&&In({name:this.name_,type:"scheduled-reaction"})}catch(i){this.reportExceptionInDerivation_(i)}}V.trackingContext=n,Ke()}},e.track=function(n){if(!this.isDisposed_){We();var i=Ne(),s;i&&(s=Date.now(),it({name:this.name_,type:"reaction"})),this.isRunning_=!0;var a=V.trackingContext;V.trackingContext=this;var o=al(this,n,void 0);V.trackingContext=a,this.isRunning_=!1,this.isTrackPending_=!1,this.isDisposed_&&Ds(this),cr(o)&&this.reportExceptionInDerivation_(o.cause),i&&rt({time:Date.now()-s}),Ke()}},e.reportExceptionInDerivation_=function(n){var i=this;if(this.errorHandler_){this.errorHandler_(n,this);return}if(V.disableErrorBoundaries)throw n;var s="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";V.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name_+"' suppressed, fix error of causing action below)"):console.error(s,n),Ne()&&In({type:"error",name:this.name_,message:s,error:""+n}),V.globalReactionErrorHandlers.forEach(function(a){return a(n,i)})},e.dispose=function(){this.isDisposed_||(this.isDisposed_=!0,this.isRunning_||(We(),Ds(this),Ke()))},e.getDisposer_=function(){var n=this.dispose.bind(this);return n[te]=this,n},e.toString=function(){return"Reaction["+this.name_+"]"},e.trace=function(n){n===void 0&&(n=!1),Gm(this,n)},r}(),pl=100,xs=function(e){return e()};function hl(){V.inBatch>0||V.isRunningReactions||xs(Vm)}function Vm(){V.isRunningReactions=!0;for(var r=V.pendingReactions,e=0;r.length>0;){++e===pl&&(console.error("Reaction doesn't converge to a stable state after "+pl+" iterations."+(" Probably there is a cycle in the reactive function: "+r[0])),r.splice(0));for(var t=r.splice(0),n=0,i=t.length;n<i;n++)t[n].runReaction_()}V.isRunningReactions=!1}var fr=ln("Reaction",hr);function jm(r){var e=xs;xs=function(n){return r(function(){return e(n)})}}function Ne(){return!!V.spyListeners.length}function In(r){if(!!V.spyListeners.length)for(var e=V.spyListeners,t=0,n=e.length;t<n;t++)e[t](r)}function it(r){var e=Ht({},r,{spyReportStart:!0});In(e)}var Hm={type:"report-end",spyReportEnd:!0};function rt(r){In(r?Ht({},r,{type:"report-end",spyReportEnd:!0}):Hm)}function Wm(r){return V.spyListeners.push(r),Es(function(){V.spyListeners=V.spyListeners.filter(function(e){return e!==r})})}var Rs="action",Km="action.bound",gl="autoAction",qm="autoAction.bound",vl="<unnamed action>",yl=bi(Rs),zm=bi(Km,{bound:!0}),bl=bi(gl,{autoAction:!0}),Ym=bi(qm,{autoAction:!0,bound:!0});function Tl(r){var e=function(n,i){if(Pe(n))return wn(n.name||vl,n,r);if(Pe(i))return wn(n,i,r);if(An(i))return gi(n,i,r?bl:yl);if(An(n))return Ot(bi(r?gl:Rs,{name:n,autoAction:r}));H("Invalid arguments for `action`")};return e}var j=Tl(!1);Object.assign(j,yl);var yi=Tl(!0);Object.assign(yi,bl);j.bound=Ot(zm);yi.bound=Ot(Ym);function L(r){return il(r.name||vl,!1,r,this,void 0)}function tr(r){return Pe(r)&&r.isMobxAction===!0}function P(r,e){var t,n;e===void 0&&(e=Ts),Pe(r)||H("Autorun expects a function as first argument"),tr(r)&&H("Autorun does not accept actions since actions are untrackable");var i=(t=(n=e)==null?void 0:n.name)!=null?t:r.name||"Autorun@"+nt(),s=!e.scheduler&&!e.delay,a;if(s)a=new hr(i,function(){this.track(c)},e.onError,e.requiresObservable);else{var o=El(e),l=!1;a=new hr(i,function(){l||(l=!0,o(function(){l=!1,a.isDisposed_||a.track(c)}))},e.onError,e.requiresObservable)}function c(){r(a)}return a.schedule_(),a.getDisposer_()}var Xm=function(e){return e()};function El(r){return r.scheduler?r.scheduler:r.delay?function(e){return setTimeout(e,r.delay)}:Xm}function x(r,e,t){var n;t===void 0&&(t=Ts),(!Pe(r)||!Pe(e))&&H("First and second argument to reaction should be functions"),He(t)||H("Third argument of reactions should be an object");var i=(n=t.name)!=null?n:"Reaction@"+nt(),s=j(i,t.onError?Qm(t.onError,e):e),a=!t.scheduler&&!t.delay,o=El(t),l=!0,c=!1,u,d,h=t.compareStructural?$n.structural:t.equals||$n.default,f=new hr(i,function(){l||a?m():c||(c=!0,o(m))},t.onError,t.requiresObservable);function m(){if(c=!1,!f.isDisposed_){var p=!1;f.track(function(){var g=Ps(!1,function(){return r(f)});p=l||!h(u,g),d=u,u=g}),(l&&t.fireImmediately||!l&&p)&&s(u,d,f),l=!1}}return f.schedule_(),f.getDisposer_()}function Qm(r,e){return function(){try{return e.apply(this,arguments)}catch(t){r.call(this,t)}}}var Jm="onBO",Zm="onBUO";function Vf(r,e,t){return Sl(Jm,r,e,t)}function Uo(r,e,t){return Sl(Zm,r,e,t)}function Sl(r,e,t,n){var i=typeof n=="function"?dn(e,t):dn(e),s=Pe(n)?n:t,a=r+"L";return i[a]?i[a].add(s):i[a]=new Set([s]),function(){var o=i[a];o&&(o.delete(s),o.size===0&&delete i[a])}}var ep="never",mr="always",tp="observed";function _l(r){r.isolateGlobalState===!0&&Um();var e=r.useProxies,t=r.enforceActions;if(e!==void 0&&(V.useProxies=e===mr?!0:e===ep?!1:typeof Proxy!="undefined"),e==="ifavailable"&&(V.verifyProxies=!0),t!==void 0){var n=t===mr?mr:t===tp;V.enforceActions=n,V.allowStateChanges=!(n===!0||n===mr)}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach(function(i){i in r&&(V[i]=!!r[i])}),V.allowStateReads=!V.observableRequiresReaction,V.disableErrorBoundaries===!0&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),r.reactionScheduler&&jm(r.reactionScheduler)}function Yo(r,e,t,n){arguments.length>4&&H("'extendObservable' expected 2-4 arguments"),typeof r!="object"&&H("'extendObservable' expects an object as first argument"),lt(r)&&H("'extendObservable' should not be used on maps, use map.merge instead"),He(e)||H("'extendObservable' only accepts plain objects as second argument"),(Gn(e)||Gn(t))&&H("Extending an object with another observable (object) is not supported");var i=Ff(e),s=Ti(r,n)[te];We();try{Bn(i).forEach(function(a){s.extend_(a,i[a],t&&a in t?t[a]:!0)})}finally{Ke()}return r}function $m(r,e){return Al(dn(r,e))}function Al(r){var e={name:r.name_};return r.observing_&&r.observing_.length>0&&(e.dependencies=np(r.observing_).map(Al)),e}function np(r){return Array.from(new Set(r))}var ip=0;function wl(){this.message="FLOW_CANCELLED"}wl.prototype=Object.create(Error.prototype);var Ll=Vo("flow"),rp=Vo("flow.bound",{bound:!0}),Wt=Object.assign(function(e,t){if(An(t))return gi(e,t,Ll);arguments.length!==1&&H("Flow expects single argument with generator function");var n=e,i=n.name||"<unnamed flow>",s=function(){var o=this,l=arguments,c=++ip,u=j(i+" - runid: "+c+" - init",n).apply(o,l),d,h=void 0,f=new Promise(function(m,p){var g=0;d=p;function T(b){h=void 0;var E;try{E=j(i+" - runid: "+c+" - yield "+g++,u.next).call(u,b)}catch(C){return p(C)}y(E)}function _(b){h=void 0;var E;try{E=j(i+" - runid: "+c+" - yield "+g++,u.throw).call(u,b)}catch(C){return p(C)}y(E)}function y(b){if(Pe(b==null?void 0:b.then)){b.then(y,p);return}return b.done?m(b.value):(h=Promise.resolve(b.value),h.then(T,_))}T(void 0)});return f.cancel=j(i+" - runid: "+c+" - cancel",function(){try{h&&Il(h);var m=u.return(void 0),p=Promise.resolve(m.value);p.then(Fn,Fn),Il(p),d(new wl)}catch(g){d(g)}}),f};return s.isMobXFlow=!0,s},Ll);Wt.bound=Ot(rp);function Il(r){Pe(r.cancel)&&r.cancel()}function nr(r){return(r==null?void 0:r.isMobXFlow)===!0}function sp(r,e){return r?e!==void 0?lt(r)||cn(r)?H("isObservable(object, propertyName) is not supported for arrays and maps. Use map.has or array.length instead."):Mt(r)?r[te].values_.has(e):!1:Mt(r)||!!r[te]||ws(r)||fr(r)||Li(r):!1}function Gn(r){return arguments.length!==1&&H("isObservable expects only 1 argument. Use isObservableProp to inspect the observability of a property"),sp(r)}function Cl(r){if(Mt(r))return r[te].keys_();if(lt(r)||Kt(r))return Array.from(r.keys());if(cn(r))return r.map(function(e,t){return t});H(5)}function Rl(r){if(Mt(r))return Cl(r).map(function(e){return r[e]});if(lt(r))return Cl(r).map(function(e){return r.get(e)});if(Kt(r))return Array.from(r.values());if(cn(r))return r.slice();H(6)}function ap(r){if(Mt(r))return r[te].ownKeys_();H(38)}function pr(r,e,t){return r.set(e,t),t}function qn(r,e){if(r==null||typeof r!="object"||r instanceof Date||!Gn(r))return r;if(Dm(r)||Li(r))return qn(r.get(),e);if(e.has(r))return e.get(r);if(cn(r)){var t=pr(e,r,new Array(r.length));return r.forEach(function(a,o){t[o]=qn(a,e)}),t}if(Kt(r)){var n=pr(e,r,new Set);return r.forEach(function(a){n.add(qn(a,e))}),n}if(lt(r)){var i=pr(e,r,new Map);return r.forEach(function(a,o){i.set(o,qn(a,e))}),i}else{var s=pr(e,r,{});return ap(r).forEach(function(a){hi.propertyIsEnumerable.call(r,a)&&(s[a]=qn(r[a],e))}),s}}function qe(r,e){return e&&H("toJS no longer supports options"),qn(r,new Map)}function Gm(){for(var r=!1,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];typeof t[t.length-1]=="boolean"&&(r=t.pop());var i=op(t);if(!i)return H("'trace(break?)' can only be used inside a tracked computed value or a Reaction. Consider passing in the computed value or reaction explicitly");i.isTracing_===dt.NONE&&console.log("[mobx.trace] '"+i.name_+"' tracing enabled"),i.isTracing_=r?dt.BREAK:dt.LOG}function op(r){switch(r.length){case 0:return V.trackingDerivation;case 1:return dn(r[0]);case 2:return dn(r[0],r[1])}}function qt(r,e){e===void 0&&(e=void 0),We();try{return r.apply(e)}finally{Ke()}}function Q(r,e,t){return arguments.length===1||e&&typeof e=="object"?lp(r,e):Pl(r,e,t||{})}function Pl(r,e,t){var n;if(typeof t.timeout=="number"){var i=new Error("WHEN_TIMEOUT");n=setTimeout(function(){if(!a[te].isDisposed_)if(a(),t.onError)t.onError(i);else throw i},t.timeout)}t.name=t.name||"When@"+nt();var s=wn(t.name+"-effect",e),a=P(function(o){var l=Ps(!1,r);l&&(o.dispose(),n&&clearTimeout(n),s())},t);return a}function lp(r,e){var t;if(e&&e.onError)return H("the options 'onError' and 'promise' cannot be combined");if(e!=null&&(t=e.signal)!=null&&t.aborted)return Object.assign(Promise.reject(new Error("WHEN_ABORTED")),{cancel:function(){return null}});var n,i,s=new Promise(function(a,o){var l,c=Pl(r,a,Ht({},e,{onError:o}));n=function(){c(),o(new Error("WHEN_CANCELLED"))},i=function(){c(),o(new Error("WHEN_ABORTED"))},e==null||(l=e.signal)==null||l.addEventListener==null||l.addEventListener("abort",i)}).finally(function(){var a;return e==null||(a=e.signal)==null||a.removeEventListener==null?void 0:a.removeEventListener("abort",i)});return s.cancel=n,s}function Cn(r){return r[te]}var cp={has:function(e,t){return V.trackingDerivation&&fi("detect new properties using the 'in' operator. Use 'has' from 'mobx' instead."),Cn(e).has_(t)},get:function(e,t){return Cn(e).get_(t)},set:function(e,t,n){var i;return An(t)?(Cn(e).values_.has(t)||fi("add a new observable property through direct assignment. Use 'set' from 'mobx' instead."),(i=Cn(e).set_(t,n,!0))!=null?i:!0):!1},deleteProperty:function(e,t){var n;return fi("delete properties from an observable object. Use 'remove' from 'mobx' instead."),An(t)?(n=Cn(e).delete_(t,!0))!=null?n:!0:!1},defineProperty:function(e,t,n){var i;return fi("define property on an observable object. Use 'defineProperty' from 'mobx' instead."),(i=Cn(e).defineProperty_(t,n))!=null?i:!0},ownKeys:function(e){return V.trackingDerivation&&fi("iterate keys to detect added / removed properties. Use 'keys' from 'mobx' instead."),Cn(e).ownKeys_()},preventExtensions:function(e){H(13)}};function Em(r,e){var t,n;return Ro(),r=Ti(r,e),(n=(t=r[te]).proxy_)!=null?n:t.proxy_=new Proxy(r,cp)}function ct(r){return r.interceptors_!==void 0&&r.interceptors_.length>0}function Ai(r,e){var t=r.interceptors_||(r.interceptors_=[]);return t.push(e),Es(function(){var n=t.indexOf(e);n!==-1&&t.splice(n,1)})}function ut(r,e){var t=Wn();try{for(var n=[].concat(r.interceptors_||[]),i=0,s=n.length;i<s&&(e=n[i](e),e&&!e.type&&H(14),!!e);i++);return e}finally{un(t)}}function bt(r){return r.changeListeners_!==void 0&&r.changeListeners_.length>0}function wi(r,e){var t=r.changeListeners_||(r.changeListeners_=[]);return t.push(e),Es(function(){var n=t.indexOf(e);n!==-1&&t.splice(n,1)})}function Tt(r,e){var t=Wn(),n=r.changeListeners_;if(!!n){n=n.slice();for(var i=0,s=n.length;i<s;i++)n[i](e);un(t)}}function gr(r,e,t){var n=Ti(r,t)[te];We();try{var i;void 0!=="production"&&e&&r[Ue]&&H("makeObservable second arg must be nullish when using decorators. Mixing @decorator syntax with annotations is not supported."),(i=e)!=null||(e=Gf(r)),Bn(e).forEach(function(s){return n.make_(s,e[s])})}finally{Ke()}return r}var Os=Symbol("mobx-keys");function ye(r,e,t){if(!He(r)&&!He(Object.getPrototypeOf(r))&&H("'makeAutoObservable' can only be used for classes that don't have a superclass"),Mt(r)&&H("makeAutoObservable can only be used on objects not already made observable"),He(r))return Yo(r,r,e,t);var n=Ti(r,t)[te];if(!r[Os]){var i=Object.getPrototypeOf(r),s=new Set([].concat(Bn(r),Bn(i)));s.delete("constructor"),s.delete(te),mi(i,Os,s)}We();try{r[Os].forEach(function(a){return n.make_(a,e&&a in e?e[a]:!0)})}finally{Ke()}return r}var kl="splice",Et="update",up=1e4,dp={get:function(e,t){var n=e[te];return t===te?n:t==="length"?n.getArrayLength_():typeof t=="string"&&!isNaN(t)?n.get_(parseInt(t)):ot(vr,t)?vr[t]:e[t]},set:function(e,t,n){var i=e[te];return t==="length"&&i.setArrayLength_(n),typeof t=="symbol"||isNaN(t)?e[t]=n:i.set_(parseInt(t),n),!0},preventExtensions:function(){H(15)}},Ms=function(){function r(t,n,i,s){t===void 0&&(t="ObservableArray@"+nt()),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=i,this.legacyMode_=s,this.atom_=new vi(t),this.enhancer_=function(a,o){return n(a,o,t+"[..]")}}var e=r.prototype;return e.dehanceValue_=function(n){return this.dehancer!==void 0?this.dehancer(n):n},e.dehanceValues_=function(n){return this.dehancer!==void 0&&n.length>0?n.map(this.dehancer):n},e.intercept_=function(n){return Ai(this,n)},e.observe_=function(n,i){return i===void 0&&(i=!1),i&&n({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),wi(this,n)},e.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},e.setArrayLength_=function(n){(typeof n!="number"||isNaN(n)||n<0)&&H("Out of range: "+n);var i=this.values_.length;if(n!==i)if(n>i){for(var s=new Array(n-i),a=0;a<n-i;a++)s[a]=void 0;this.spliceWithArray_(i,0,s)}else this.spliceWithArray_(n,i-n)},e.updateArrayLength_=function(n,i){n!==this.lastKnownLength_&&H(16),this.lastKnownLength_+=i,this.legacyMode_&&i>0&&Dl(n+i+1)},e.spliceWithArray_=function(n,i,s){var a=this;Kn(this.atom_);var o=this.values_.length;if(n===void 0?n=0:n>o?n=o:n<0&&(n=Math.max(0,o+n)),arguments.length===1?i=o-n:i==null?i=0:i=Math.max(0,Math.min(i,o-n)),s===void 0&&(s=Qi),ct(this)){var l=ut(this,{object:this.proxy_,type:kl,index:n,removedCount:i,added:s});if(!l)return Qi;i=l.removedCount,s=l.added}if(s=s.length===0?s:s.map(function(d){return a.enhancer_(d,void 0)}),this.legacyMode_||void 0!=="production"){var c=s.length-i;this.updateArrayLength_(o,c)}var u=this.spliceItemsIntoValues_(n,i,s);return(i!==0||s.length!==0)&&this.notifyArraySplice_(n,s,u),this.dehanceValues_(u)},e.spliceItemsIntoValues_=function(n,i,s){if(s.length<up){var a;return(a=this.values_).splice.apply(a,[n,i].concat(s))}else{var o=this.values_.slice(n,n+i),l=this.values_.slice(n+i);this.values_.length+=s.length-i;for(var c=0;c<s.length;c++)this.values_[n+c]=s[c];for(var u=0;u<l.length;u++)this.values_[n+s.length+u]=l[u];return o}},e.notifyArrayChildUpdate_=function(n,i,s){var a=!this.owned_&&Ne(),o=bt(this),l=o||a?{observableKind:"array",object:this.proxy_,type:Et,debugObjectName:this.atom_.name_,index:n,newValue:i,oldValue:s}:null;a&&it(l),this.atom_.reportChanged(),o&&Tt(this,l),a&&rt()},e.notifyArraySplice_=function(n,i,s){var a=!this.owned_&&Ne(),o=bt(this),l=o||a?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:kl,index:n,removed:s,added:i,removedCount:s.length,addedCount:i.length}:null;a&&it(l),this.atom_.reportChanged(),o&&Tt(this,l),a&&rt()},e.get_=function(n){if(this.legacyMode_&&n>=this.values_.length){console.warn("[mobx.array] Attempt to read an array index ("+n+") that is out of bounds ("+this.values_.length+"). Please check length first. Out of bound indices will not be tracked by MobX");return}return this.atom_.reportObserved(),this.dehanceValue_(this.values_[n])},e.set_=function(n,i){var s=this.values_;if(this.legacyMode_&&n>s.length&&H(17,n,s.length),n<s.length){Kn(this.atom_);var a=s[n];if(ct(this)){var o=ut(this,{type:Et,object:this.proxy_,index:n,newValue:i});if(!o)return;i=o.newValue}i=this.enhancer_(i,a);var l=i!==a;l&&(s[n]=i,this.notifyArrayChildUpdate_(n,i,a))}else{for(var c=new Array(n+1-s.length),u=0;u<c.length-1;u++)c[u]=void 0;c[c.length-1]=i,this.spliceWithArray_(s.length,0,c)}},r}();function Sm(r,e,t,n){t===void 0&&(t="ObservableArray@"+nt()),n===void 0&&(n=!1),Ro();var i=new Ms(t,e,n,!1);ko(i.values_,te,i);var s=new Proxy(i.values_,dp);if(i.proxy_=s,r&&r.length){var a=Ei(!0);i.spliceWithArray_(0,0,r),Si(a)}return s}var vr={clear:function(){return this.splice(0)},replace:function(e){var t=this[te];return t.spliceWithArray_(0,t.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];var a=this[te];switch(arguments.length){case 0:return[];case 1:return a.spliceWithArray_(e);case 2:return a.spliceWithArray_(e,t)}return a.spliceWithArray_(e,t,i)},spliceWithArray:function(e,t,n){return this[te].spliceWithArray_(e,t,n)},push:function(){for(var e=this[te],t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.spliceWithArray_(e.values_.length,0,n),e.values_.length},pop:function(){return this.splice(Math.max(this[te].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[te],t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.spliceWithArray_(0,0,n),e.values_.length},reverse:function(){return V.trackingDerivation&&H(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){V.trackingDerivation&&H(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var t=this[te],n=t.dehanceValues_(t.values_).indexOf(e);return n>-1?(this.splice(n,1),!0):!1}};xe("concat",zt);xe("flat",zt);xe("includes",zt);xe("indexOf",zt);xe("join",zt);xe("lastIndexOf",zt);xe("slice",zt);xe("toString",zt);xe("toLocaleString",zt);xe("every",hn);xe("filter",hn);xe("find",hn);xe("findIndex",hn);xe("flatMap",hn);xe("forEach",hn);xe("map",hn);xe("some",hn);xe("reduce",xl);xe("reduceRight",xl);function xe(r,e){typeof Array.prototype[r]=="function"&&(vr[r]=e(r))}function zt(r){return function(){var e=this[te];e.atom_.reportObserved();var t=e.dehanceValues_(e.values_);return t[r].apply(t,arguments)}}function hn(r){return function(e,t){var n=this,i=this[te];i.atom_.reportObserved();var s=i.dehanceValues_(i.values_);return s[r](function(a,o){return e.call(t,a,o,n)})}}function xl(r){return function(){var e=this,t=this[te];t.atom_.reportObserved();var n=t.dehanceValues_(t.values_),i=arguments[0];return arguments[0]=function(s,a,o){return i(s,a,o,e)},n[r].apply(n,arguments)}}var hp=ln("ObservableArrayAdministration",Ms);function cn(r){return Ji(r)&&hp(r[te])}var Ol,Ml,fp={},fn="add",yr="delete";Ol=Symbol.iterator;Ml=Symbol.toStringTag;var Xo=function(){function r(t,n,i){var s=this;n===void 0&&(n=Vn),i===void 0&&(i="ObservableMap@"+nt()),this.enhancer_=void 0,this.name_=void 0,this[te]=fp,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=n,this.name_=i,Pe(Map)||H(18),this.keysAtom_=$o(this.name_+".keys()"),this.data_=new Map,this.hasMap_=new Map,Ps(!0,function(){s.merge(t)})}var e=r.prototype;return e.has_=function(n){return this.data_.has(n)},e.has=function(n){var i=this;if(!V.trackingDerivation)return this.has_(n);var s=this.hasMap_.get(n);if(!s){var a=s=new Ln(this.has_(n),ir,this.name_+"."+Ss(n)+"?",!1);this.hasMap_.set(n,a),Uo(a,function(){return i.hasMap_.delete(n)})}return s.get()},e.set=function(n,i){var s=this.has_(n);if(ct(this)){var a=ut(this,{type:s?Et:fn,object:this,newValue:i,name:n});if(!a)return this;i=a.newValue}return s?this.updateValue_(n,i):this.addValue_(n,i),this},e.delete=function(n){var i=this;if(Kn(this.keysAtom_),ct(this)){var s=ut(this,{type:yr,object:this,name:n});if(!s)return!1}if(this.has_(n)){var a=Ne(),o=bt(this),l=o||a?{observableKind:"map",debugObjectName:this.name_,type:yr,object:this,oldValue:this.data_.get(n).value_,name:n}:null;return a&&it(l),qt(function(){var c;i.keysAtom_.reportChanged(),(c=i.hasMap_.get(n))==null||c.setNewValue_(!1);var u=i.data_.get(n);u.setNewValue_(void 0),i.data_.delete(n)}),o&&Tt(this,l),a&&rt(),!0}return!1},e.updateValue_=function(n,i){var s=this.data_.get(n);if(i=s.prepareNewValue_(i),i!==V.UNCHANGED){var a=Ne(),o=bt(this),l=o||a?{observableKind:"map",debugObjectName:this.name_,type:Et,object:this,oldValue:s.value_,name:n,newValue:i}:null;a&&it(l),s.setNewValue_(i),o&&Tt(this,l),a&&rt()}},e.addValue_=function(n,i){var s=this;Kn(this.keysAtom_),qt(function(){var c,u=new Ln(i,s.enhancer_,s.name_+"."+Ss(n),!1);s.data_.set(n,u),i=u.value_,(c=s.hasMap_.get(n))==null||c.setNewValue_(!0),s.keysAtom_.reportChanged()});var a=Ne(),o=bt(this),l=o||a?{observableKind:"map",debugObjectName:this.name_,type:fn,object:this,name:n,newValue:i}:null;a&&it(l),o&&Tt(this,l),a&&rt()},e.get=function(n){return this.has(n)?this.dehanceValue_(this.data_.get(n).get()):this.dehanceValue_(void 0)},e.dehanceValue_=function(n){return this.dehancer!==void 0?this.dehancer(n):n},e.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},e.values=function(){var n=this,i=this.keys();return Ii({next:function(){var a=i.next(),o=a.done,l=a.value;return{done:o,value:o?void 0:n.get(l)}}})},e.entries=function(){var n=this,i=this.keys();return Ii({next:function(){var a=i.next(),o=a.done,l=a.value;return{done:o,value:o?void 0:[l,n.get(l)]}}})},e[Ol]=function(){return this.entries()},e.forEach=function(n,i){for(var s=Un(this),a;!(a=s()).done;){var o=a.value,l=o[0],c=o[1];n.call(i,c,l,this)}},e.merge=function(n){var i=this;return lt(n)&&(n=new Map(n)),qt(function(){He(n)?Mf(n).forEach(function(s){return i.set(s,n[s])}):Array.isArray(n)?n.forEach(function(s){var a=s[0],o=s[1];return i.set(a,o)}):Nn(n)?(n.constructor!==Map&&H(19,n),n.forEach(function(s,a){return i.set(a,s)})):n!=null&&H(20,n)}),this},e.clear=function(){var n=this;qt(function(){cl(function(){for(var i=Un(n.keys()),s;!(s=i()).done;){var a=s.value;n.delete(a)}})})},e.replace=function(n){var i=this;return qt(function(){for(var s=mp(n),a=new Map,o=!1,l=Un(i.data_.keys()),c;!(c=l()).done;){var u=c.value;if(!s.has(u)){var d=i.delete(u);if(d)o=!0;else{var h=i.data_.get(u);a.set(u,h)}}}for(var f=Un(s.entries()),m;!(m=f()).done;){var p=m.value,g=p[0],T=p[1],_=i.data_.has(g);if(i.set(g,T),i.data_.has(g)){var y=i.data_.get(g);a.set(g,y),_||(o=!0)}}if(!o)if(i.data_.size!==a.size)i.keysAtom_.reportChanged();else for(var b=i.data_.keys(),E=a.keys(),C=b.next(),w=E.next();!C.done;){if(C.value!==w.value){i.keysAtom_.reportChanged();break}C=b.next(),w=E.next()}i.data_=a}),this},e.toString=function(){return"[object ObservableMap]"},e.toJSON=function(){return Array.from(this)},e.observe_=function(n,i){return i===!0&&H("`observe` doesn't support fireImmediately=true in combination with maps."),wi(this,n)},e.intercept_=function(n){return Ai(this,n)},_s(r,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:Ml,get:function(){return"Map"}}]),r}(),lt=ln("ObservableMap",Xo);function mp(r){if(Nn(r)||lt(r))return r;if(Array.isArray(r))return new Map(r);if(He(r)){var e=new Map;for(var t in r)e.set(t,r[t]);return e}else return H(21,r)}var Fl,Nl,pp={};Fl=Symbol.iterator;Nl=Symbol.toStringTag;var Qo=function(){function r(t,n,i){n===void 0&&(n=Vn),i===void 0&&(i="ObservableSet@"+nt()),this.name_=void 0,this[te]=pp,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=i,Pe(Set)||H(22),this.atom_=$o(this.name_),this.enhancer_=function(s,a){return n(s,a,i)},t&&this.replace(t)}var e=r.prototype;return e.dehanceValue_=function(n){return this.dehancer!==void 0?this.dehancer(n):n},e.clear=function(){var n=this;qt(function(){cl(function(){for(var i=Un(n.data_.values()),s;!(s=i()).done;){var a=s.value;n.delete(a)}})})},e.forEach=function(n,i){for(var s=Un(this),a;!(a=s()).done;){var o=a.value;n.call(i,o,o,this)}},e.add=function(n){var i=this;if(Kn(this.atom_),ct(this)){var s=ut(this,{type:fn,object:this,newValue:n});if(!s)return this}if(!this.has(n)){qt(function(){i.data_.add(i.enhancer_(n,void 0)),i.atom_.reportChanged()});var a=Ne(),o=bt(this),l=o||a?{observableKind:"set",debugObjectName:this.name_,type:fn,object:this,newValue:n}:null;a&&void 0!=="production"&&it(l),o&&Tt(this,l),a&&void 0!=="production"&&rt()}return this},e.delete=function(n){var i=this;if(ct(this)){var s=ut(this,{type:yr,object:this,oldValue:n});if(!s)return!1}if(this.has(n)){var a=Ne(),o=bt(this),l=o||a?{observableKind:"set",debugObjectName:this.name_,type:yr,object:this,oldValue:n}:null;return a&&void 0!=="production"&&it(l),qt(function(){i.atom_.reportChanged(),i.data_.delete(n)}),o&&Tt(this,l),a&&void 0!=="production"&&rt(),!0}return!1},e.has=function(n){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(n))},e.entries=function(){var n=0,i=Array.from(this.keys()),s=Array.from(this.values());return Ii({next:function(){var o=n;return n+=1,o<s.length?{value:[i[o],s[o]],done:!1}:{done:!0}}})},e.keys=function(){return this.values()},e.values=function(){this.atom_.reportObserved();var n=this,i=0,s=Array.from(this.data_.values());return Ii({next:function(){return i<s.length?{value:n.dehanceValue_(s[i++]),done:!1}:{done:!0}}})},e.replace=function(n){var i=this;return Kt(n)&&(n=new Set(n)),qt(function(){Array.isArray(n)?(i.clear(),n.forEach(function(s){return i.add(s)})):pi(n)?(i.clear(),n.forEach(function(s){return i.add(s)})):n!=null&&H("Cannot initialize set from "+n)}),this},e.observe_=function(n,i){return i===!0&&H("`observe` doesn't support fireImmediately=true in combination with sets."),wi(this,n)},e.intercept_=function(n){return Ai(this,n)},e.toJSON=function(){return Array.from(this)},e.toString=function(){return"[object ObservableSet]"},e[Fl]=function(){return this.values()},_s(r,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:Nl,get:function(){return"Set"}}]),r}(),Kt=ln("ObservableSet",Qo),Bl=Object.create(null),Ul="remove",Fs=function(){function r(t,n,i,s){n===void 0&&(n=new Map),s===void 0&&(s=cm),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=t,this.values_=n,this.name_=i,this.defaultAnnotation_=s,this.keysAtom_=new vi(this.name_+".keys"),this.isPlainObject_=He(this.target_),jl(this.defaultAnnotation_)||H("defaultAnnotation must be valid annotation"),this.appliedAnnotations_={}}var e=r.prototype;return e.getObservablePropValue_=function(n){return this.values_.get(n).get()},e.setObservablePropValue_=function(n,i){var s=this.values_.get(n);if(s instanceof Hn)return s.set(i),!0;if(ct(this)){var a=ut(this,{type:Et,object:this.proxy_||this.target_,name:n,newValue:i});if(!a)return null;i=a.newValue}if(i=s.prepareNewValue_(i),i!==V.UNCHANGED){var o=bt(this),l=Ne(),c=o||l?{type:Et,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:s.value_,name:n,newValue:i}:null;l&&it(c),s.setNewValue_(i),o&&Tt(this,c),l&&rt()}return!0},e.get_=function(n){return V.trackingDerivation&&!ot(this.target_,n)&&this.has_(n),this.target_[n]},e.set_=function(n,i,s){return s===void 0&&(s=!1),ot(this.target_,n)?this.values_.has(n)?this.setObservablePropValue_(n,i):s?Reflect.set(this.target_,n,i):(this.target_[n]=i,!0):this.extend_(n,{value:i,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,s)},e.has_=function(n){if(!V.trackingDerivation)return n in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var i=this.pendingKeys_.get(n);return i||(i=new Ln(n in this.target_,ir,this.name_+"."+Ss(n)+"?",!1),this.pendingKeys_.set(n,i)),i.get()},e.make_=function(n,i){if(i===!0&&(i=this.defaultAnnotation_),i!==!1){if(Vl(this,i,n),!(n in this.target_)){var s;if((s=this.target_[Ue])!=null&&s[n])return;H(1,i.annotationType_,this.name_+"."+n.toString())}for(var a=this.target_;a&&a!==hi;){var o=Xi(a,n);if(o){var l=i.make_(this,n,o,a);if(l===0)return;if(l===1)break}a=Object.getPrototypeOf(a)}Gl(this,i,n)}},e.extend_=function(n,i,s,a){if(a===void 0&&(a=!1),s===!0&&(s=this.defaultAnnotation_),s===!1)return this.defineProperty_(n,i,a);Vl(this,s,n);var o=s.extend_(this,n,i,a);return o&&Gl(this,s,n),o},e.defineProperty_=function(n,i,s){s===void 0&&(s=!1);try{We();var a=this.delete_(n);if(!a)return a;if(ct(this)){var o=ut(this,{object:this.proxy_||this.target_,name:n,type:fn,newValue:i.value});if(!o)return null;var l=o.newValue;i.value!==l&&(i=Ht({},i,{value:l}))}if(s){if(!Reflect.defineProperty(this.target_,n,i))return!1}else xt(this.target_,n,i);this.notifyPropertyAddition_(n,i.value)}finally{Ke()}return!0},e.defineObservableProperty_=function(n,i,s,a){a===void 0&&(a=!1);try{We();var o=this.delete_(n);if(!o)return o;if(ct(this)){var l=ut(this,{object:this.proxy_||this.target_,name:n,type:fn,newValue:i});if(!l)return null;i=l.newValue}var c=$l(n),u={configurable:V.safeDescriptors?this.isPlainObject_:!0,enumerable:!0,get:c.get,set:c.set};if(a){if(!Reflect.defineProperty(this.target_,n,u))return!1}else xt(this.target_,n,u);var d=new Ln(i,s,void 0!=="production"?this.name_+"."+n.toString():"ObservableObject.key",!1);this.values_.set(n,d),this.notifyPropertyAddition_(n,d.value_)}finally{Ke()}return!0},e.defineComputedProperty_=function(n,i,s){s===void 0&&(s=!1);try{We();var a=this.delete_(n);if(!a)return a;if(ct(this)){var o=ut(this,{object:this.proxy_||this.target_,name:n,type:fn,newValue:void 0});if(!o)return null}i.name||(i.name=void 0!=="production"?this.name_+"."+n.toString():"ObservableObject.key"),i.context=this.proxy_||this.target_;var l=$l(n),c={configurable:V.safeDescriptors?this.isPlainObject_:!0,enumerable:!1,get:l.get,set:l.set};if(s){if(!Reflect.defineProperty(this.target_,n,c))return!1}else xt(this.target_,n,c);this.values_.set(n,new Hn(i)),this.notifyPropertyAddition_(n,void 0)}finally{Ke()}return!0},e.delete_=function(n,i){if(i===void 0&&(i=!1),!ot(this.target_,n))return!0;if(ct(this)){var s=ut(this,{object:this.proxy_||this.target_,name:n,type:Ul});if(!s)return null}try{var a,o;We();var l=bt(this),c=void 0!=="production"&&Ne(),u=this.values_.get(n),d=void 0;if(!u&&(l||c)){var h;d=(h=Xi(this.target_,n))==null?void 0:h.value}if(i){if(!Reflect.deleteProperty(this.target_,n))return!1}else delete this.target_[n];if(void 0!=="production"&&delete this.appliedAnnotations_[n],u&&(this.values_.delete(n),u instanceof Ln&&(d=u.value_),Bo(u)),this.keysAtom_.reportChanged(),(a=this.pendingKeys_)==null||(o=a.get(n))==null||o.set(n in this.target_),l||c){var f={type:Ul,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:d,name:n};void 0!=="production"&&c&&it(f),l&&Tt(this,f),void 0!=="production"&&c&&rt()}}finally{Ke()}return!0},e.observe_=function(n,i){return i===!0&&H("`observe` doesn't support the fire immediately property for observable objects."),wi(this,n)},e.intercept_=function(n){return Ai(this,n)},e.notifyPropertyAddition_=function(n,i){var s,a,o=bt(this),l=Ne();if(o||l){var c=o||l?{type:fn,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:n,newValue:i}:null;l&&it(c),o&&Tt(this,c),l&&rt()}(s=this.pendingKeys_)==null||(a=s.get(n))==null||a.set(!0),this.keysAtom_.reportChanged()},e.ownKeys_=function(){return this.keysAtom_.reportObserved(),Bn(this.target_)},e.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},r}();function Ti(r,e){var t;if(e&&Mt(r)&&H("Options can't be provided for already observable objects."),ot(r,te))return Ns(r)instanceof Fs||H("Cannot convert '"+br(r)+`' into observable object:
The target is already observable of different type.
Extending builtins is not supported.`),r;Object.isExtensible(r)||H("Cannot make the designated object observable; it is not extensible");var n=(t=e==null?void 0:e.name)!=null?t:(He(r)?"ObservableObject":r.constructor.name)+"@"+nt(),i=new Fs(r,new Map,String(n),Tm(e));return mi(r,te,i),r}var gp=ln("ObservableObjectAdministration",Fs);function $l(r){return Bl[r]||(Bl[r]={get:function(){return this[te].getObservablePropValue_(r)},set:function(t){return this[te].setObservablePropValue_(r,t)}})}function Mt(r){return Ji(r)?gp(r[te]):!1}function Gl(r,e,t){var n;r.appliedAnnotations_[t]=e,(n=r.target_[Ue])==null||delete n[t]}function Vl(r,e,t){if(jl(e)||H("Cannot annotate '"+r.name_+"."+t.toString()+"': Invalid annotation."),!er(e)&&ot(r.appliedAnnotations_,t)){var n=r.name_+"."+t.toString(),i=r.appliedAnnotations_[t].annotationType_,s=e.annotationType_;H("Cannot apply '"+s+"' to '"+n+"':"+(`
The field is already annotated with '`+i+"'.")+`
Re-annotating fields is not allowed.
Use 'override' annotation for methods overridden by subclass.`)}}var vp=Hl(0),Bs=0,Wl=function(){};function yp(r,e){Object.setPrototypeOf?Object.setPrototypeOf(r.prototype,e):r.prototype.__proto__!==void 0?r.prototype.__proto__=e:r.prototype=e}yp(Wl,Array.prototype);var Us=function(r,e,t){Mo(n,r);function n(s,a,o,l){var c;o===void 0&&(o="ObservableArray@"+nt()),l===void 0&&(l=!1),c=r.call(this)||this;var u=new Ms(o,a,l,!0);if(u.proxy_=Zi(c),ko(Zi(c),te,u),s&&s.length){var d=Ei(!0);c.spliceWithArray(0,0,s),Si(d)}return Object.defineProperty(Zi(c),"0",vp),c}var i=n.prototype;return i.concat=function(){this[te].atom_.reportObserved();for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return Array.prototype.concat.apply(this.slice(),o.map(function(c){return cn(c)?c.slice():c}))},i[t]=function(){var s=this,a=0;return Ii({next:function(){return a<s.length?{value:s[a++],done:!1}:{done:!0,value:void 0}}})},_s(n,[{key:"length",get:function(){return this[te].getArrayLength_()},set:function(a){this[te].setArrayLength_(a)}},{key:e,get:function(){return"Array"}}]),n}(Wl,Symbol.toStringTag,Symbol.iterator);Object.entries(vr).forEach(function(r){var e=r[0],t=r[1];e!=="concat"&&mi(Us.prototype,e,t)});function Hl(r){return{enumerable:!1,configurable:!0,get:function(){return this[te].get_(r)},set:function(t){this[te].set_(r,t)}}}function bp(r){xt(Us.prototype,""+r,Hl(r))}function Dl(r){if(r>Bs){for(var e=Bs;e<r+100;e++)bp(e);Bs=r}}Dl(1e3);function _m(r,e,t){return new Us(r,e,t)}function dn(r,e){if(typeof r=="object"&&r!==null){if(cn(r))return e!==void 0&&H(23),r[te].atom_;if(Kt(r))return r.atom_;if(lt(r)){if(e===void 0)return r.keysAtom_;var t=r.data_.get(e)||r.hasMap_.get(e);return t||H(25,e,br(r)),t}if(Mt(r)){if(!e)return H(26);var n=r[te].values_.get(e);return n||H(27,e,br(r)),n}if(ws(r)||Li(r)||fr(r))return r}else if(Pe(r)&&fr(r[te]))return r[te];H(28)}function Ns(r,e){if(r||H(29),e!==void 0)return Ns(dn(r,e));if(ws(r)||Li(r)||fr(r)||lt(r)||Kt(r))return r;if(r[te])return r[te];H(24,r)}function br(r,e){var t;if(e!==void 0)t=dn(r,e);else{if(tr(r))return r.name;Mt(r)||lt(r)||Kt(r)?t=Ns(r):t=dn(r)}return t.name_}var Kl=hi.toString;function Ls(r,e,t){return t===void 0&&(t=-1),$s(r,e,t)}function $s(r,e,t,n,i){if(r===e)return r!==0||1/r==1/e;if(r==null||e==null)return!1;if(r!==r)return e!==e;var s=typeof r;if(s!=="function"&&s!=="object"&&typeof e!="object")return!1;var a=Kl.call(r);if(a!==Kl.call(e))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+r==""+e;case"[object Number]":return+r!=+r?+e!=+e:+r==0?1/+r==1/e:+r==+e;case"[object Date]":case"[object Boolean]":return+r==+e;case"[object Symbol]":return typeof Symbol!="undefined"&&Symbol.valueOf.call(r)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":t>=0&&t++;break}r=ql(r),e=ql(e);var o=a==="[object Array]";if(!o){if(typeof r!="object"||typeof e!="object")return!1;var l=r.constructor,c=e.constructor;if(l!==c&&!(Pe(l)&&l instanceof l&&Pe(c)&&c instanceof c)&&"constructor"in r&&"constructor"in e)return!1}if(t===0)return!1;t<0&&(t=-1),n=n||[],i=i||[];for(var u=n.length;u--;)if(n[u]===r)return i[u]===e;if(n.push(r),i.push(e),o){if(u=r.length,u!==e.length)return!1;for(;u--;)if(!$s(r[u],e[u],t-1,n,i))return!1}else{var d=Object.keys(r),h;if(u=d.length,Object.keys(e).length!==u)return!1;for(;u--;)if(h=d[u],!(ot(e,h)&&$s(r[h],e[h],t-1,n,i)))return!1}return n.pop(),i.pop(),!0}function ql(r){return cn(r)?r.slice():Nn(r)||lt(r)||pi(r)||Kt(r)?Array.from(r.entries()):r}function Ii(r){return r[Symbol.iterator]=Tp,r}function Tp(){return this}function jl(r){return r instanceof Object&&typeof r.annotationType_=="string"&&Pe(r.make_)&&Pe(r.extend_)}["Symbol","Map","Set"].forEach(function(r){var e=bs();typeof e[r]=="undefined"&&H("MobX requires global '"+r+"' to be available or polyfilled")});typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:Wm,extras:{getDebugName:br},$mobx:te});var Gs=new WeakMap,zl=new WeakMap;function oe(r){return function(e,t=null){Gs.has(e)||((!t||typeof t!="object")&&(t={}),Gs.set(e,t),zl.set(t,r));let n=Gs.get(e),i=zl.get(n);if(r!==i)throw new ReferenceError("Invalid Key");return n}}function Yl(r){let e=Object.fromEntries([Object.entries(Object.getOwnPropertyDescriptors(r)).filter(([t,n])=>"value"in n),Object.entries(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(r))).filter(([t,n])=>t!=="constructor"&&"get"in n)].flat().map(([t,n])=>{if(typeof n.value=="function")return[t,j];if(typeof n.get=="function")return[t,jn];if("value"in n)return[t,Le]}).filter(t=>t));gr(r,e)}var Vs={false:!1,true:!0};ye(Vs);function $e(r,e){let t=document.createNodeIterator(r,NodeFilter.SHOW_ALL),n;for(;n=t.nextNode();){if(n.hasAttribute?.("foreach")){let s=n,[a,o]=s.getAttribute("foreach").split(" of ").map(d=>d.trim()),[l,c]=a.split(",").map(d=>d.trim()),u=document.createDocumentFragment();u.append(...s.children),queueMicrotask(()=>{let d=[],h=[];x(()=>e[o],function(m){for(let p of[...h,...d])p();d=[],h=[],d[0]=x(()=>Vs.true&&m.length,p=>{for(;h.length>p;)h.pop()();for(;h.length<p;){let g=h.length,T=Object.create(e,{[c]:{value:g,configurable:!0},[l]:{value:m[g],configurable:!0}});Yl(T);let _=$e(u.cloneNode(!0),T),y=[..._.childNodes];s.appendChild(_),h.push(()=>{for(let b of y)b.remove()})}},{fireImmediately:!0,name:"ApplyTemplate lengthObserver"})},{fireImmediately:!0})}),n.removeAttribute("foreach")}let i=n.splitText&&n.textContent&&n.textContent.match(/[$%]{[^}]*}/);if(i)if(i.index)n.splitText(i.index);else{n.length!==i[0].length&&n.splitText(i[0].length);let s=n,a=i[0][0]==="%";if(a){let c=document.createElement("span");s.parentNode.insertBefore(c,s),s.parentNode.removeChild(s),s=c}let o=i[0].slice(2,-1),l=P(()=>{if(s.parentNode){let c=o.split("."),u=e[c.shift()];for(;c.length;)u=u[c.shift()];a?s.innerHTML=u:s.nodeValue=u}else l(),s=null})}else(n.getAttributeNames?.()??[]).forEach(s=>{let a=!1,o=[n.getAttribute(s)];s[0]==="$"&&(n.removeAttribute(s),s=s.slice(1));for(let l=0;l<o.length;++l){let c=o[l],u=c.match(/\${[^}]*}/);u&&(a=!0,u.index===0?u[0].length!==c.length?o.splice(l,1,c.substr(2,u[0].length-3),c.substr(u[0].length)):o[l]=o[l].slice(2,-1):o.splice(l,1,c.substr(0,u.index),c.substr(u.index))),o[l]=[u?.index===0,o[l]]}if(a){let l=n;P(()=>{let c=o.map(([u,d])=>{if(!u)return d;let h=d.split(":"),f=h.shift(),m=h.shift()||f,p=f.split("."),g=e[p.shift()];for(;p.length;)g=g[p.shift()];return typeof g=="boolean"&&(g=g?m:""),g}).join("").replace(/ +/g," ").trim();l.setAttribute(s,c)})}})}return r}function Tr(r){if(!r)return null;let e=r.split(/[ :-]/);return e[1]--,new Date(Date.UTC.apply(Date,e)||null)}var Xl="stnLogging";function ae(r,e={}){let t=new CustomEvent(Xl,{bubbles:!0,detail:{logName:r,data:e}});this.dispatchEvent(t)}function js(r){this.addEventListener(Xl,e=>r.listener.call(r,e))}var Ql="stnEvent";function ht(r,e={}){let t=new CustomEvent(Ql,{bubbles:!0,detail:{stnEventName:r,data:e}});this.dispatchEvent(t)}function Hs(r){this.addEventListener(Ql,e=>r.listener.call(r,e))}var Ep=()=>{let r=new URLSearchParams(location.search);return r.has("stnDebug")?["1","true"].includes(r.get("stnDebug")):!1},Sp=!1,ie=Ep()?!0:Sp;function Ci(r,e){!ie&&!e||(r=[].concat(r).join(`
`).split(`
`),console.log("%c STNVideo Debug %c %s","background:hsl(40, 94%, 56%);font-weight:bolder;color:black","",r.join(`
 - `)))}function Jl(r,e){let t={},n=Le({});P(()=>{Object.keys(t).filter(s=>!(s in r.css)).forEach(s=>{t[s](),delete t[s],delete n[s]}),Object.getOwnPropertyNames(r.css).filter(s=>!(s in t)).forEach(s=>{t[s]=x(()=>[].concat(r.css[s]),([a,o])=>{n[s]=o?`--${s}: var(--${e}-${s},${a})`:`--${s}: ${a}`},{fireImmediately:!0})})});let i=document.createElement("style");return x(()=>Rl(n),s=>{i.textContent=`:host 
{
	`+s.join(`;
	`)+`;
}`,i.isConnected&&(ie&&console.warn("Css variables have been modified after initial setting"),i.parentNode.replaceChild(i,i))},{fireImmediately:!0}),i}var _p=["https://fonts.googleapis.com/css?family=Open+Sans:600","https://fonts.googleapis.com/icon?family=Material+Icons"],Ap=_p.map(r=>{let e=document.createElement("link");return e.href=r,e.rel="stylesheet",e});function St(){return Ap.map(r=>r.cloneNode())}var wp=new Date().toISOString().split("T")[0].slice(2).replace(/-/g,"");function Ri(){return wp}function Yt(r=16,e="-",t="_"){return e=e.charCodeAt(0),t=t.charCodeAt(0),String.fromCharCode.apply(0,[...Array(r)].map(()=>{let n=Math.random()*64|0;return n<10?n+48:n<36?n+55:n<62?n+61:n===62?e:t}))}var zn=null;try{zn=sessionStorage}catch(r){zn={}}var Zl=class{constructor(){}get key(){let e=ec(zn.s2nKey);return e||(e=Yt(),ec(e)||(console.error("Session Key is Invalid"),e="_InvalidSession_"),zn.s2nKey=e)}get floatInhibited(){return(zn.s2nFloatInhibited??"false")==="true"}set floatInhibited(e){zn.s2nFloatInhibited=!!e}},_t=new Zl;function ec(r){return r&&r.match(/^[A-Za-z0-9_-]+$/)?.[0]||null}var Lp="7.30.6-E",tc="";function At(){return Lp}function Pi(){return At()+(tc?`-${tc}`:"")}var nc=Pi(),Ip=nc.split("-")[1]??"",Ws=Ip.charCodeAt(0)-64||0;Ws>=10&&(Ws=9);var L0=nc.split("-")[0].split(".").reduce((r,e)=>1e3*r+1*e,0)*10+Ws;function Er(r){return r&&Object.keys(r).length===0&&r.constructor===Object}function Ks(r){return"%"+r.charCodeAt(0).toString(16)}function wt(r){return Object.entries(r).map(([e,t])=>{for(;typeof t=="function";)t=t();switch(typeof t){case"boolean":case"number":case"string":case"symbol":case"bigint":t=`${t}`;break;case"undefined":case"object":if(!t)return null;t instanceof Set&&(t=[...t]),Array.isArray(t)?t=t.join(","):t=wt(t)}return e=e.replace(/[#=&%]/g,Ks),t=t.replace(/[#&%+]/g,Ks),`${e}=${t}`}).filter(e=>e).join("&")}var ic=[...new Array(2)].map(()=>Math.random().toString().slice(2)).join(""),rc=[];function sc({data:r}){if(r===ic){window.removeEventListener("message",sc);for(let e of rc.splice(0))try{queueMicrotask(e)}catch(t){}}}function Xt(r){rc.push(r),window.addEventListener("message",sc),window.postMessage(ic,"*")}var ft=new Promise(r=>{let e=document.createElement("iframe");e.style.cssText=["position: fixed","border: 0","height: 100vh","top:   -100vh","width:  100vw","left:  -200vw"].join(";"),e.addEventListener("load",()=>{e.contentDocument.open(),e.contentDocument.close(),r(e.contentWindow)},{once:!0});function t(n){try{document.body.insertAdjacentElement("afterbegin",e),document.removeEventListener("readystatechange",t)}catch(i){}}document.addEventListener("readystatechange",t),t({target:document})});var ac="1.13.1",oc=ft.then(r=>new Promise((e,t)=>{let n=r,i=n.document,s=i.createElement("script");s.src=`https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/${ac}/js/OverlayScrollbars.min.js`;function a(){l(),e(n.OverlayScrollbars)}function o(c){l(),t(`Could not load scrollbar library from ${c.target.src}`)}function l(){s.removeEventListener("load",a),s.removeEventListener("error",o)}s.addEventListener("load",a),s.addEventListener("error",o),i.head.appendChild(s)}).then(e=>{if(!e)throw new Error("Scrollbar library loaded but scrollbar object does not exist");return e})),lc=`
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/${ac}/css/OverlayScrollbars.min.css"/>
`;var cc=`.os-scrollbar .os-scrollbar-track {
    background: var(--scrollBarTrackColor) !important;
    border-radius: 15px;
}

.os-scrollbar .os-scrollbar-handle {
    background-color: var(--scrollBarColor) !important;
}

/* Without this, the overlay scrollbar is too fat */
.os-host *,
.os-host *:before,
.os-host *:after
{
    box-sizing: border-box;
}
.os-host .os-content *,
.os-host .os-content *:before,
.os-host .os-content *:after
{
    box-sizing: unset;
}
`;var uc=`/*
os-theme-thick-dark
*/

.os-theme-thick-dark > .os-scrollbar {
    padding: 5px;
}
.os-theme-thick-dark > .os-scrollbar:before {
    content: '';
    display: block;
    position: absolute;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 15px;
    top: 2px;
    bottom: 2px;
    right: 2px;
    left: 2px;
    border: 1px solid rgba(0, 0, 0, 0.08);
}
.os-theme-thick-dark > .os-scrollbar:hover:before {
    border: 1px solid rgba(0, 0, 0, 0.16);
}
.os-theme-thick-dark > .os-scrollbar.active:before {
    border: 1px solid rgba(0, 0, 0, 0.24);
}
.os-theme-thick-dark > .os-scrollbar-horizontal {
    right: 18px;
    height: 18px;
}
.os-theme-thick-dark > .os-scrollbar-vertical {
    bottom: 18px;
    width: 18px;
}
.os-theme-thick-dark.os-host-rtl > .os-scrollbar-horizontal {
    left: 18px;
    right: 0;
}
.os-theme-thick-dark > .os-scrollbar-corner {
    height: 18px;
    width: 18px;
    background-color: transparent;
}
.os-theme-thick-dark > .os-scrollbar > .os-scrollbar-track {
    background: transparent;
}
.os-theme-thick-dark > .os-scrollbar > .os-scrollbar-track > .os-scrollbar-handle {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 15px;
}
.os-theme-thick-dark > .os-scrollbar > .os-scrollbar-track > .os-scrollbar-handle:hover {
    background: rgba(0, 0, 0, 0.6);
}
.os-theme-thick-dark > .os-scrollbar > .os-scrollbar-track > .os-scrollbar-handle.active {
    background: rgba(0, 0, 0, 0.8);
}
.os-theme-thick-dark > .os-scrollbar-horizontal > .os-scrollbar-track > .os-scrollbar-handle {
    min-width: 30px;
}
.os-theme-thick-dark > .os-scrollbar-vertical > .os-scrollbar-track > .os-scrollbar-handle {
    min-height: 30px;
}
.os-theme-thick-dark > .os-scrollbar > .os-scrollbar-track > .os-scrollbar-handle:before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: -3px;
    bottom: -5px;
    display: block;
}
.os-theme-thick-dark > .os-scrollbar-horizontal > .os-scrollbar-track > .os-scrollbar-handle:before {
    top: -3px;
    bottom: -5px;
}
.os-theme-thick-dark > .os-scrollbar-vertical > .os-scrollbar-track > .os-scrollbar-handle:before {
    left: -3px;
    right: -5px;
}
.os-theme-thick-dark.os-host-rtl > .os-scrollbar-vertical > .os-scrollbar-track > .os-scrollbar-handle:before {
    right: -3px;
    left: -5px;
}
.os-theme-thick-dark.os-host-transition > .os-scrollbar > .os-scrollbar-track > .os-scrollbar-handle {
    transition: background 0.3s;
}
.os-theme-thick-dark.os-host-transition > .os-scrollbar:before {
    transition: border 0.3s;
}
`;var dc=document.createElement("template");dc.innerHTML=`${lc}
<style>${uc}${cc}</style>
`;async function ki(r){let e=r.getRootNode(),t=dc.content.cloneNode(!0);e.appendChild(t);let i=(await oc)(r,{className:"os-theme-thick-dark"});return i.getElements().scrollbarVertical.handle.addEventListener("mousedown",a=>{a.preventDefault()}),i}function fc(){if(typeof ReportingObserver!="function")return;let r=new ReportingObserver((e,t)=>{hc.call(this,e)},{buffered:!0});r.observe(),window.addEventListener("pagehide",e=>{let t=r.takeRecords();hc.call(this,t)})}function hc(r){let e=r.filter(t=>t.type==="intervention"&&t.body.id==="HeavyAdIntervention");e.length<=0||ae.call(this,"REPORTING",e)}function Sr(r){return L(()=>r=qe(r)),typeof r=="object"?JSON.parse(JSON.stringify(r)):r}function mn(r,e,t,n){Array.isArray(r)||(r=[r]);let i;function s(){let l=!0;clearTimeout(i),n(!0,!0),e!==null&&(i=setTimeout(()=>{n(!1,!0)},e))}function a(){clearTimeout(i),i=setTimeout(()=>{n(!1,!1)},t)}r.forEach(l=>{l.addEventListener("mousemove",s),l.addEventListener("mouseleave",a)});function o(){r.forEach(l=>{l.removeEventListener("mousemove",s),l.removeEventListener("mouseleave",a)}),delay=0,a()}return o}var mc=`:host
{
    --height: 22px;
    --width: 66px;
}

:host, :host *
{
    cursor: pointer;
}

:host .container
{
    position: absolute;
    width: var(--width);
    height: var(--height);
    overflow: hidden;
}

:host .logoWrapper
{
    position: absolute;
    height: var(--height);
    left: 0;
}

/* This was used for the animation */
/* :host(:hover) .logoWrapper svg */
/* { */
/*     left: 0; */
/* } */
/* :host .logoWrapper svg */
/* { */
/*     left: calc(var(--width) - 30px); */
/*     transition: left 300ms; */
/* } */

:host .container > svg:last-child
{
    right: 0;
}

:host .container svg
{
    width: auto;
    height: 100%;
    position: absolute;
}

:host .container svg #topPiece
{
    fill: var(--stnLinkPlayTop);
}

:host .container svg #rightPiece
{
    fill: var(--stnLinkPlayRight);
}

:host .container svg #bottomPiece
{
    fill: var(--stnLinkPlayBottom);
}

:host .container svg .stnText
{
    fill: var(--stnLinkStnText);
}

:host .container svg .videoText
{
    fill: var(--stnLinkVideoText);
}
`;var pc=`<div class='container'></div>
`;var Qt=`<svg width="335" height="407" viewbox='0 0 335 407' xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1">
        <path id="topPiece" fill="#FFFFFF" d="m165.9,197.8l-6.9,-4.8l-36.5,-24.6l-85.7,-57.8c-0.1,0 -0.1,-0.1 -0.1,-0.1l-4,-2.7c-26.2,-17.7 -33.1,-53.3 -15.5,-79.6c17.7,-26.2 53.3,-33.1 79.6,-15.5l132.8,89.6c0,0 0.1,0 0.1,0.1l40.8,29.6l-104.6,65.8z"/>
        <path id="rightPiece" fill="#FFFFFF" d="m100.6,250.5l33.7,-23.2l5.1,-3.4c0.1,0 0.1,-0.1 0.2,-0.1l29.5,-19.9l0.2,-0.2l106.7,-67.7c0,0 17.7,12.2 25.8,18.6c0.2,0.2 0.4,0.3 0.6,0.4c1,0.7 2,1.4 2.9,2.2c0.8,0.6 1.6,1.3 2.4,2c1.1,0.9 2.1,1.8 3,2.8l0.1,0.1c1,1 3.2,3.3 4.1,4.4c0.5,0.6 1,1.2 1.4,1.8c0.2,0.2 0.3,0.4 0.4,0.5c0.5,0.6 0.9,1.2 1.3,1.8c0.3,0.4 0.6,0.8 0.9,1.2c1.9,2.8 3.5,5.8 4.9,8.8c0.5,1.1 0.9,2.1 1.3,3.1c0.4,1.1 0.8,2.2 1.1,3.3c0.4,1.1 0.6,2.2 0.9,3.3c0.2,1.1 0.5,2.1 0.7,3.2c0,0.1 0,0.2 0.1,0.4c0.2,1.1 0.4,2.1 0.5,3.2c0.1,1.1 0.2,2.3 0.3,3.4c0.1,1.1 0.1,2.2 0.1,3.3l0,0.1c0,1.1 0,2.2 -0.1,3.3c-0.1,1.2 -0.2,2.3 -0.3,3.4c-0.1,1.2 -0.3,2.3 -0.5,3.4c0,0.1 0,0.1 0,0.2c-0.2,1.1 -0.5,2.1 -0.7,3.2c-0.8,3.3 -1.9,6.6 -3.3,9.8c-0.5,1.1 -1,2.1 -1.5,3.1l0,0c-0.5,1 -1.1,2 -1.7,3c-0.5,0.9 -1.1,1.8 -1.6,2.6c-1.4,2.1 -2.9,4 -4.6,5.9c-0.8,0.9 -1.6,1.8 -2.5,2.6c-2.6,2.5 -5.4,4.9 -8.4,6.9l-1.9,1.3l-0.6,0.4l-18.7,12.6c0,0 0,0 0,0c0,0 0,0 -0.1,0c0,0 0,0 -0.1,0l0,0c0,0 -0.1,0.1 -0.2,0.1l-65.6,44.2l-9,6l-106.8,-65.4z"/>
        <path id="bottomPiece" fill="#FFFFFF" d="m202.2,320.4l-109.6,74c-9.8,6.6 -21,9.8 -32,9.8c-11.5,0 -22.9,-3.5 -32.5,-10.1c-0.4,-0.2 -0.6,-0.5 -0.8,-0.6c-5.4,-3.8 -10.3,-8.7 -14.3,-14.6c-6.2,-9.2 -9.4,-19.6 -9.7,-29.9l0,-150.8l91.7,56.4l85.5,52.6c0,0 0.1,0 0.1,0.1l19.1,11.8l2.5,1.3z"/>
</svg>
`;var gc=`<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 25.4.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 864 436" style="enable-background:new 0 0 864 436;" xml:space="preserve">
	<path class="videoText" fill='#ffffff' d="M42.2,347.7l26.6,52.5l26.5-52.5h16L77,414.2H60.6l-34.4-66.5H42.2z"/>
	<path class="videoText" fill='#ffffff' d="M232.8,414.2v-66.5h14.2v66.5H232.8z"/>
	<path class="videoText" fill='#ffffff' d="M419.9,347.7c20.6,0,25.5,7,25.5,23.7v19.1c0,16.7-4.9,23.7-25.5,23.7h-41v-66.5H419.9z M393,359.9v42h26.9
	c8.3,0,11.3-2.5,11.3-11.1v-19.7c0-8.6-3.1-11.2-11.3-11.2H393z"/>
	<path class="videoText" fill='#ffffff' d="M637.8,414.2h-40.9c-20.6,0-25.5-7-25.5-23.7v-19.1c0-16.7,4.9-23.7,25.5-23.7h40.9v12.2h-40.9
	c-8.5,0-11.3,2.6-11.3,11.2v3.5h47.2V387h-47.2v3.9c0,8.6,2.8,11.1,11.3,11.1h40.9V414.2z"/>
	<path class="videoText" fill='#ffffff' d="M763.6,371.3c0-16.7,4.9-23.7,25.5-23.7h19.3c20.7,0,25.6,7,25.6,23.7v19.1c0,16.7-4.9,23.7-25.6,23.7h-19.3
	c-20.6,0-25.5-7-25.5-23.7V371.3z M819.8,371.1c0-8.6-2.8-11.2-11.4-11.2h-19.3c-8.5,0-11.3,2.6-11.3,11.2v19.7
	c0,8.6,2.8,11.1,11.3,11.1h19.3c8.6,0,11.4-2.5,11.4-11.1V371.1z"/>
	<path class="stnText" fill='#ffffff' d="M262,150.1c-16.7-13.5-42.7-19.8-81.7-19.8h-49.8c-26.4,0-40.8-3.5-40.8-22.2c0-15,6.3-22.6,40.8-22.6h135.7
	V29.3H130.4c-38.3,0-64.8,6.6-81.2,20.3C33.9,62.3,26.7,81,26.7,108.5c0,27.2,7.1,45.7,22.5,58.3c16.6,13.6,42.4,20,81.2,20h49.8
	c34.8,0,41.2,7.5,41.2,22.2c0,14.7-6.6,22.6-41.2,22.6H26.7v56.1h153.5c38.6,0,65.4-6.7,82-20.4c15.4-12.8,22.5-31.4,22.5-58.7
	C284.7,181.2,277.5,162.6,262,150.1z"/>
	<polygon class="stnText" fill='#ffffff' points="292.5,85.5 390,85.5 390,287.7 453.3,287.7 453.3,85.5 550.9,85.5 550.9,29.3 292.5,29.3 	"/>
	<polygon class="stnText" fill='#ffffff' points="772.3,29.3 772.3,195 638.6,29.3 577.2,29.3 577.2,287.7 640.5,287.7 640.5,122.5 774.2,287.7 835.6,287.7 835.6,29.3 "/>
</svg>
`;var _r=document.createElement("iframe");document.body.append(_r);var Cp=_r.contentWindow.EventTarget;_r.remove();_r=null;var vc=new WeakMap,ke=class extends HTMLElement{constructor(){super();vc.set(this,{prototype:Object.getPrototypeOf(this)})}adoptedCallback(){let{prototype:e}=vc.get(this);Object.getPrototypeOf(this)!==e&&Object.setPrototypeOf(this,e)}addEventListener(...e){return Cp.prototype.addEventListener.apply(this,e)}};var Re=navigator.webdriver&&window?.Cypress?.constructor?.name==="$Cypress"&&!!window?.Cypress?.stn,Rp=function(r){Re&&(r=[].concat(r).join(`
`).split(`
`),console.log("%c STNVideo [Test] %c %s","background:hsl(212, 100%, 69%);font-weight:bolder;color:black","",r.join(`
  `)))};Rp("Testing Mode is Enabled");var aT=oe(Symbol("StnPlayButton")),yc=document.createElement("template");yc.innerHTML=`<style>
${mc}</style>${pc}
`;var Pp="stn-link",bc=class extends ke{constructor(){super();let e=this.attachShadow({mode:Re?"open":"closed"});e.appendChild(yc.content.cloneNode(!0));let t=e.querySelector("div");t.innerHTML=`
			<div class='logoWrapper'>
				${gc}
			</div>
			${Qt}
		`,this.addEventListener("click",()=>{window.open("https://stnvideo.com")})}hide(){this.style.display="none"}show(){this.style.display=""}};customElements.define(Pp,bc);function Tc(r){let{iu:e,clientWidth:t,clientHeight:n,lineItem:i,adX:s,bid:a}=r,o=window,l=o.assertive;for(;!l?.logCustomImpression&&o!==o.parent&&"document"in Object.getOwnPropertyDescriptors(o);)o=o.parent,l=o.assertive;let c={source:"video",slotId:"stn_video",adUnitPath:e,highestPreBid:a,highestPreBid_partner:"stn_video",mediaType:"instream",creative_width:t,creative_height:n,preBidWon:!0,timeToRespond:null,dfpResponseInformation:{lineItemId:parseInt(i,10)||0,isBackfill:s}};return l?.logCustomImpression?(ie&&console.log(`Assertive Yield Log
%o`,c),l.logCustomImpression(c),!0):(ie&&console.error(`Assertive Yield Failed: %o
%o`,"No assertive yield callback found",c),!1)}function Jt(r,e=!1){return Ec(r,"",e)}function Ec(r,e,t=!1){let n={};return Object.keys(r).forEach(i=>{typeof r[i]=="object"?r[i]===null?t&&(n[`${e}${i}`]=""):Object.assign(n,Ec(r[i],`${e}${i}.`,t)):n[`${e}${i}`]=r[i]}),n}var pn=window,qs=null;for(;pn.parent!==pn&&Object.getOwnPropertyNames(pn.parent).includes("document");)qs=pn,pn=pn.parent;Re&&qs&&(pn=qs);var le=pn;var kp=3,Ar=0,Di=Promise.resolve(le).then(r=>{let e=()=>new Promise((t,n)=>{let i=r;i.google?.ima&&t(i.google?.ima);let s=i.document,a=s.createElement("script");a.src="https://imasdk.googleapis.com/js/sdkloader/ima3.js";function o(){c(),t(i.google?.ima)}function l(u){c(),n(`Could not load Google IMA library from ${u.target.src}`)}function c(){a.removeEventListener("load",o),a.removeEventListener("error",l)}a.addEventListener("load",o),a.addEventListener("error",l),s.head.appendChild(a)}).then(t=>{if(!t)throw new Error("Google IMA library loaded but google.ima does not exist");return t});return(async()=>{let t,n;do try{++Ar,n=null,t=await e()}catch(i){n=i}while(!t&&Ar<kp);if(n)throw n;return t})()});var Dp=0,xp="https://s2l.sendtonews.com/stn_trk.gif",Te,Sc=!1,Mp=Op(),wr=class{constructor(e){let t={},n={},i=null,s={},a=performance.now();Te(this,{hasRun:t,ldtCounters:n,model:e,preInitTime:i,quartileRun:s,unloadListenerTime:a,pageVisibleTime:0,pageLastVisibleTime:null,playerVisibleTime:0,playerLastVisibleTime:null,rtpStart:null});let h=Te(this);P(()=>h.adRecovery=e.adRecovery),P(()=>h.feedCid=e.feed.C_ID),P(()=>h.feedEsID=e.feed.ES_ID),P(()=>h.playerType=e.playerType),P(()=>h.feedCompanyName=e.feed.C_companyName),P(()=>h.feedStripQueryString=e.feed.ESG_stripQueryString),P(()=>h.modelActiveLoadCount=e.activeLoadCount),P(()=>h.modelCurrentItem=e.currentItem),P(()=>h.dfpCodeInvPlay=e.playerStatus?.getAdjustedDfpCode(!0)),P(()=>h.dfpCode=e.playerStatus?.getAdjustedDfpCode(!1)),P(()=>h.logCodeInvPlay=e.playerStatus?.getAdjustedLogCode(!0)),P(()=>h.logCode=e.playerStatus?.getAdjustedLogCode(!1)),P(()=>h.idInvPlay=e.playerStatus?.getAdjustedId(!0)),P(()=>h.id=e.playerStatus?.getAdjustedId(!1)),P(()=>h.visibility=e.playerStatus?.toString(["visibility"])),P(()=>h.sound=e.playerStatus?.sound),P(()=>h.playlistType=e.playerStatus?.playlistType),P(()=>h.playerKey=e.playerKey||"NO_KEY"),P(()=>h.smartMatchLocation=e.pageMeta?.smartMatchLocation),P(()=>h.href=e.pageMeta?.href),P(()=>h.ogSet=e.pageMeta?.ogSet),P(()=>h.smartMatchLocationIsReferrer=e.pageMeta?.smartMatchLocationIsReferrer),P(()=>h.usrID=e.usrID),P(()=>h.imaVersion=e.imaVersion),P(()=>h.logAssertiveYield=e.logAssertiveYield),P(()=>h.adTag=e.adTag),P(()=>h.mediagroupContainerWidth=e.mediagroupContainerWidth),P(()=>h.isFloating=e.isMediaGroupFloating),P(()=>h.isMiniFloatActive=e.isMiniFloatActive),P(()=>h.isAmpFloating=e.isAmp&&e.isAmpFloating),P(()=>h.vIndex=e.selectedPlaylistItem?.idx),P(()=>h.useConfigurablePlaylist=e.useConfigurablePlaylist),P(()=>h.domainStatus=e.domainStatus??"null"),P(()=>h.doViewabilityLog=e.doViewabilityLog),P(()=>{let f=e.stnEngage;if(!f)h.stnEngage={};else{let m=f.source==="override";h.stnEngage={enabled:f.enabled,delay:f.buttonShowDelay,ctdwn:f.countdown,vl:f.minVideoLength,mid:f.stayClickMidrollBehaviour==="remove"?"rm":"kp",source:f.useConfigurable?"p7":"p6",time:m,timerule:m?`${f.startTime};${f.endTime}`:null}}}),this.UNLOAD_BEFORE_GET_BOUND=this.UNLOAD_BEFORE_GET.bind(this),this.PAGE_CLOSE_BOUND=this.PAGE_CLOSE.bind(this),this.visibilityHandlerBound=this.visibilityHandler.bind(this),x(()=>e.isMediaGroupContainerVisible,f=>{h.playerMediaVisible=e.isMediaGroupContainerVisible,this.visibilityHandlerBound({type:"playerVisibleChange"})},{fireImmediately:!0}),window.addEventListener("pagehide",this.visibilityHandlerBound),window.addEventListener("pagehide",this.UNLOAD_BEFORE_GET_BOUND),window.addEventListener("pagehide",this.PAGE_CLOSE_BOUND),document.addEventListener("visibilitychange",this.visibilityHandlerBound),this.visibilityHandlerBound({type:"init"}),this.VW()}listener(e){let{logName:t,data:n}=e.detail;if(!this[t]){console.error(`Undefined STN log fired [${t}]`);return}this[t](n)}PRE_INIT(){let e=Te(this);e.preInitTime===null&&(e.preInitTime=performance.now());let t;L(()=>t=e.model.embedScriptTag);let n=new URL(t.src).host,i=t.host||n;Ie.call(this,"PRE_INIT",{EXTREF:e.smartMatchLocation,REF:e.href,serverHost:i},{isCmd:!0})}GET(){let e=Te(this),t;L(()=>t=e.model.embedScriptTag);let n=new URL(t.src).host,i=t.host||n;Ie.call(this,"GET",{serverHost:i},{isTimber:!0}),window.removeEventListener("pagehide",this.UNLOAD_BEFORE_GET_BOUND)}GETERR(e){let t=Te(this),n;L(()=>n=t.model.embedScriptTag);let i=new URL(n.src).host,s=n.host||i;Ft.call(this,"GETERR",Object.assign({},e,{serverHost:s}),{isTimber:!0}),window.removeEventListener("pagehide",this.UNLOAD_BEFORE_GET_BOUND)}INV(){Ft.call(this,"INV",{},{isTimber:!0})}PLAY(){let e=Te(this),t=Ac.call(this);this.INV(),Ft.call(this,"PLAY",{pposition:Lr.call(this),floattype:Ir.call(this),smVersion:t!==null?e.useConfigurablePlaylist?2:1:null,smPlaylist:t},{isTimber:!0})}resetPlay(){let e=Te(this);e.hasRun.INV=null,e.hasRun.PLAY=null,e.quartileRun={}}resetOpenVV(){let e=Te(this);e.ldtCounters.OPENVV=0}resetDV(){let e=Te(this);e.ldtCounters.EXVIEW1=0}API(e){Ie.call(this,"API",e)}RTP(){let e=Te(this),t=Ac.call(this);Ft.call(this,"RTP",{smVersion:t!==null?e.useConfigurablePlaylist?2:1:null,smPlaylist:t,DS:e.domainStatus,...Jt({eg:e.stnEngage},!1)},{isTimber:!0})}VIEWABLE_PLAYER_LOAD(e){!Te(this).doViewabilityLog||Ft.call(this,"VPL",e)}CLOSE({reason:e}){Ie.call(this,`CLOSE${e}`,{},{isTimber:!0})}ENGAGEMENT(e){Ie.call(this,"ENGAGEMENT",e)}BIDS(e){Ie.call(this,"BIDS",Jt(e,!0))}IMA({hasAdParams:e,adBlocked:t,areAdsRecovered:n}){let i=Te(this);Ft.call(this,"IMA",{recoveryMethod:i.adRecovery,imaVersion:i.imaVersion,blocked:t,recovered:n,hasAdParams:e,imaAttempt:Ar},{isCmd:!0})}REPORTING(e){for(let t of e){let n=JSON.parse(JSON.stringify({report:t})),i=Jt(n);Ie.call(this,"REPORTING",i)}}SHARE(e){Ie.call(this,"SHARE",e)}UNMUTE_ICON(){Ft.call(this,"USR",{action:"UNMUTE_ICON"})}RECIRC({url:e,timeClicked:t}){Ie.call(this,"USR",{action:"RECIRC_CLICK",url:e,timeClicked:t})}STAY(){Ie.call(this,"USR",{action:"STAY"})}NEXT(){Ie.call(this,"USR",{action:"NEXT"})}PAGE_CLOSE(){let e=Te(this),t=performance.now();Ft.call(this,"PAGECLOSE",{unloadTime:Lt(t-e.unloadListenerTime),playerVisibleTime:Lt(e.playerVisibleTime),pageVisibleTime:Lt(e.pageVisibleTime),sinceRTP:e.rtpStart?Lt(t-e.rtpStart):null},{isCmd:!0})}UNLOAD_BEFORE_GET(){let e=Te(this);Ft.call(this,"UNLOADBFGET",{EXTREF:e.smartMatchLocation,REF:e.href,playerCfg:zs(e.playerType),unloadTime:Lt(performance.now()-e.unloadListenerTime),pageVisibleTime:Lt(e.pageVisibleTime)},{isCmd:!0})}visibilityHandler(e){let t=Te(this),n=e.type,i=performance.now(),s=document.visibilityState==="visible",a=!!t.pageLastVisibleTime,o=n==="pagehide",l=t.playerMediaVisible&&s,c=!!t.playerLastVisibleTime;l&&c&&o?(t.playerVisibleTime+=i-t.playerLastVisibleTime,t.playerLastVisibleTime=null):l&&!c?t.playerLastVisibleTime=i:!l&&c&&(t.playerVisibleTime+=i-t.playerLastVisibleTime,t.playerLastVisibleTime=null),s&&a&&o?(t.pageVisibleTime+=i-t.pageLastVisibleTime,t.pageLastVisibleTime=null):s&&!a?t.pageLastVisibleTime=i:!s&&a&&(t.pageVisibleTime+=i-t.pageLastVisibleTime,t.pageLastVisibleTime=null)}QUARTILE({quartile:e}){Ft.call(this,"QUARTILE",{quartile:e,pposition:Lr.call(this),floattype:Ir.call(this)})}AD_QUARTILE({quartile:e,adIndex:t}){Ie.call(this,"AD_QUARTILE",{quartile:e,adIndex:t,pposition:Lr.call(this),floattype:Ir.call(this),rand:_c.call(this)})}NO_AD_IMPRESSION(e){let t=Te(this);e.DS=t.domainStatus,e={...e,...t.adTag.prebidAB,plcmt:t.adTag.param.plcmt,placement:t.adTag.param.cust_params.placement,...Jt({eg:t.stnEngage},!1)},Ie.call(this,"NO_IMP",e)}AD_IMPRESSION(e){let t=e.isClientAdRequest?"HB_IMP":"AD_IMP",n=Te(this);e.pposition=Lr.call(this),e.floattype=Ir.call(this),e.DS=n.domainStatus;let i,s,a=n.adTag.param.iu;if(a?(e.adServer="gam",e.iu=a,i=n.adTag.param.cust_params.player_width,s=n.adTag.param.cust_params.player_height,e.logAssertiveYield=n.logAssertiveYield):(e.adServer="springServe",i=n.adTag.param.x,s=n.adTag.param.y,e.logAssertiveYield=!1),e.rand=_c.call(this),e.rmt="ns",e={...e,...n.adTag.prebidAB,plcmt:n.adTag.param.plcmt,placement:n.adTag.param.cust_params.placement,...Jt({eg:n.stnEngage},!1)},e.isClientAdRequest){Ie.call(this,t,e);return}fetch(`https://cache.sendtonews.com/av/?id=${e.lineItem}&cid=${e.cid}`).then(o=>o.text()).then(o=>{let l;try{l=JSON.parse(o),(!l||typeof l!="object")&&(l=!1)}catch(c){l=!1}if(!l){Ie.call(this,t,e);return}e.isDesktop=l.isDesktop,e.isTablet=l.isTablet,e.isMobile=l.isMobile,e.platform=l.platform,e.bidvl=wc(l.bidvl,NaN),e.logAssertiveYield&&(e.bid=wc(l.bid,NaN),isNaN(e.bid)||(e.rmt="s",Tc({...e,clientWidth:i,clientHeight:s})||(e.rmt="na"))),Ie.call(this,t,e)})}LEVEL_LOAD_ERROR({removedLevel:e}){Ie.call(this,"LEVEL_ERROR",{removedLevel:e})}BAD_CONTENT_ERROR(e){Ie.call(this,"CONTENT_ERR",e)}VW(){if(Sc||!Mp){Sc=!0;return}Ie.call(this,"VW",{})}DV(e){let t=["adhgt","adwdth","norhgt","norwdth","advisonl","dvp_adEng","isvelg","brid","brver","cerrt","dup","dvp_cimh","dvp_cimw","dvp_vadt","dvp_vvas","dvp_vvasm","eoid","iscvmvms","isiabvms","ismms","lftb","nvr","q1iabvms","q2iabvms","q3iabvms","q4iabvms","sei","vad","vct"],n={exview:{}};t.forEach(i=>{e.hasOwnProperty(i)&&(n.exview[i]=e[i])}),Ie.call(this,"EXVIEW1",Jt(n,!0))}OPENVV(e){e.percentViewable=Lt(e.percentViewable),Ie.call(this,"OPENVV",e)}};function Ie(r,e={},t={}){let n=Te(this),{isTimber:i=!1,isCmd:s=!1}=t;if(r.length>12){console.error(`STN Logging Error: ${r} name is too long`);return}switch(r){case"EXVIEW1":case"OPENVV":n.ldtCounters[r]||(n.ldtCounters[r]=0),n.ldtCounters[r]++;break;default:break}n.ldtCounters[r]&&(e.counter=n.ldtCounters[r]);let a;i?a=Lc.call(this,r,{EXTREF:n.smartMatchLocation,REF:n.href,playerCfg:zs(n.playerType),playerType:n.playerType,...e},!1):a=Lc.call(this,r,e,!s),navigator.sendBeacon(`${xp}?${wt(a)}`)}function Ft(r,e,t){let n=Te(this);switch(r){case"QUARTILE":if(n.quartileRun[e.quartile])return;n.quartileRun[e.quartile]=!0;break;case"VPL":if(n.hasRun[r])return;n.hasRun[r]=!0;let{stnMedia:i}=e;delete e.stnMedia;let s=null,a=0,o,l=new IntersectionObserver(c=>{c.forEach(u=>{u.isVisible===void 0?(l.disconnect(),l=null,clearTimeout(o),o=!1):u.isVisible?s===null&&(s=u.time):(s&&(a+=u.time-s),s=null)})},{threshold:.5,trackVisibility:!0,delay:100});l.observe(i),o=setTimeout(()=>{l.disconnect(),l=null,s&&(a+=performance.now()-s),e.viewableTime=Lt(a),e.viewablePercent=Lt(a/e.durationMeasured),Ie.call(this,r,e,t)},e.durationMeasured);return;default:if(n.hasRun[r])return;n.hasRun[r]=!0;break}Ie.call(this,r,e,t)}function Lc(r,e,t=!0){let n=t?"ldt":"cmd",i=Te(this),s=performance.now(),a={session:_t.key,instance:i.usrID,version:At(),age:Ri(),[n]:r,key:i.playerKey,c_id:i.feedCid,seq:i.modelActiveLoadCount,order:++Dp,vIndex:i.vIndex,absoluteTime:Lt(s),relativeTime:Lt(s-i.preInitTime)};if(t){let o=i.modelCurrentItem;Object.assign(a,{sm_id:o.SM_ID,visiblestatecd:i.visibility,soundcd:i.sound?"ON":"OFF"})}switch(r){case"GET":case"GETERR":case"UNLOADBFGET":case"PRE_INIT":{a.canonical=i.smartMatchLocation;break}case"IMA":{a.EXTREF=i.smartMatchLocation,a.REF=i.href,a.playerCfg=zs(i.playerType);break}case"SHARE":case"REPORTING":case"QUARTILE":case"AD_QUARTILE":case"AD_IMP":{delete a.c_id;break}case"USR":a=Fp.call(this,a,e);break;default:{let o=i.modelCurrentItem,l=r==="INV"||r==="PLAY"?i.idInvPlay:i.id,c=r==="INV"||r==="PLAY"?i.dfpCodeInvPlay:i.dfpCode;Object.assign(a,{alt:o.isAlternate?1:0,sC_ID:o.C_ID,sm_id:o.SM_ID,load:o.loadCount,status:c,ac_id:l})}}return r==="RTP"&&(delete a.alt,i.rtpStart=performance.now()),{...a,...e}}function Fp(r,e){let t=Te(this);switch(e.action){case"RECIRC_CLICK":{let n=t.modelCurrentItem.S_ID;Object.assign(r,{s_id:n});break}default:delete r.c_id;break}return r}function zs(r){return r===void 0?"UN":r===null?"NL":typeof r!="string"?"NS":{BARKER:"BR",FLOAT:"FL",FULL:"FP",SINGLE:"SN",SIDE:"SD"}[r]}function Op(){let r=navigator.userAgent.toLowerCase();return["lighthouse","gtmetrix"].some(t=>r.includes(t))}function Lr(){let r=Te(this);return r.isFloating||r.isAmpFloating?"float":"home"}function Ir(){let r=Te(this);return r.isAmpFloating?"a":r.isFloating?r.isMiniFloatActive?"m":"s":null}function Lt(r){return Math.round(r*1e3)/1e3}function _c(){let r=Te(this);return!!r.adTag.param.iu?r.adTag.param.cust_params.rand:r.adTag.param.r}function Ac(){switch(Te(this).playlistType){case"smart":return"smart";case"defaultOnSmart":return"default";default:return null}}function wc(r,e=NaN){try{return Math.floor(parseFloat(r)*100)/100}catch(t){return e}}Te=oe(wr);var gn,Cr=class{constructor(e){gn(this,{hasRun:{},model:e});let n=gn(this);P(()=>n.playerKey=e.playerKey),P(()=>n.optimera=e.optimera)}listener(e){let{stnEventName:t,data:n}=e.detail;if(!this[t]){console.error(`Undefined STN log fired [${t}]`);return}this[t](n)}RTP(){Ic.call(this,"readyToPlay")}adStart(e={}){gn(this).hasRun.adStart?Zt.call(this,"adStart",e):Ic.call(this,"adStart",e)}adEnded(e={}){Zt.call(this,"adEnded",e)}adPause(e={}){Zt.call(this,"adPause",e)}adPlay(e={}){Zt.call(this,"adPlay",e)}play(e={}){Zt.call(this,"play",e)}pause(e={}){Zt.call(this,"pause",e)}contentStart(e={}){Zt.call(this,"contentStart",e)}contentEnded(e={}){Zt.call(this,"contentEnded",e)}volumeChange(e={}){Zt.call(this,"volumeChange",e)}resetAdStart(){let e=gn(this);e.hasRun.adStart=null}};function Cc(r,e){let t=gn(this),n={type:"s2nEvent",playerKey:t.playerKey,s2nEvent:r,...e},i=null,s=window;for(s;s!==i;i=s,s=s.parent)s.postMessage(n,"*")}function Zt(r,e){!gn(this).optimera||Cc.call(this,r,e)}function Ic(r,e){let t=gn(this);t.hasRun[r]||(t.hasRun[r]=!0,Cc.call(this,r,e))}gn=oe(Cr);var xi,Rc=["floatMode","playType","playOrder","playlistType","size","amp","visibility","looping"],Pc=["floatMode","playType","playOrder","playlistType","size","amp"],Rr=class{constructor(e){this.playerModel=e;let t=new Map;this.divTag=e.divTag;let i={values:t,rawID:0};xi(this,{model:i}),ye(this),ye(i);let s=xi(this);P(()=>{let a=this.floatMode,o=Np(a);L(()=>{s.model.values.set("floatMode",{value:a,code:o})})}),P(()=>{let a=this.playType,o=Bp(a);L(()=>{s.model.values.set("playType",{value:a,code:o}),s.model.rawID=Hp(s.model.rawID,a)})}),P(()=>{let a=this.playOrder,o=kc(a);L(()=>{s.model.values.set("playOrder",{value:a,code:o}),s.model.rawID=Dc(s.model.rawID,a)})}),P(()=>{let a=this.playlistType,o=Up(a);L(()=>{s.model.values.set("playlistType",{value:a,code:o})})}),P(()=>{let a=this.size,o=$p(a);L(()=>{s.model.values.set("size",{value:a,code:o})})}),P(()=>{let a=this.amp,o=Gp(a);L(()=>{s.model.values.set("amp",{value:a,code:o})})}),P(()=>{let a=this.visibility,o=Pr(a);L(()=>{s.model.values.set("visibility",{value:a,code:o}),s.model.rawID=kr(s.model.rawID,a)})}),P(()=>{let a=this.looping,o=Vp(a);L(()=>{s.model.values.set("looping",{value:a,code:o})})}),P(()=>{let a=this.sound,o=jp(a);L(()=>{s.model.values.set("sound",{value:a,code:o}),s.model.rawID=Wp(s.model.rawID,a)})})}get id(){return 2e3+xi(this).model.rawID}getAdjustedId(e=!1){return xc(this.values,this.id,e).id}getAdjustedLogCode(e){return this.getAdjustedString(Pc,e)}getAdjustedDfpCode(e){return this.getAdjustedString(Rc,e)}get logCode(){return this.toString(Pc)}get dfpCode(){return this.toString(Rc)}toJSON(){return this.values}toString(e,t){return Array.from(t??this.values).filter(([i,s])=>!e||e.includes(i)).map(([i,s])=>s.code).join("")}getAdjustedString(e,t){return this.toString(e,xc(this.values,this.id,t).values)}get values(){return xi(this).model.values}get floatMode(){return this.playerModel.float}get playType(){return this.playerModel.userInitiated?"userInitiated":this.playerModel.playbackMode}get playOrder(){return this.playerModel.activeLoadCount===1?"firstVideo":"notFirstVideo"}get playlistType(){return this.playerModel.configuredAsSmartPlayer&&this.playerModel.playlistType==="SMART"?"smart":this.playerModel.configuredAsSmartPlayer&&this.playerModel.playlistType!=="SMART"?"defaultOnSmart":this.playerModel.playerType==="SINGLE"?"singleEmbed":"notSmart"}get size(){return this.playerModel.playerSize}get amp(){return this.playerModel.isAmp}get visibility(){return!this.playerModel.isMediaGroupContainerVisible&&!this.playerModel.isMediaGroupFloating?"outOfView":this.playerModel.pageHidden?"tabHidden":"inView"}get looping(){return this.playerModel.isLoopingPlaylist}get sound(){return!this.playerModel.muted&&this.playerModel.volume>0}};function Np(r){switch(r){case"onLoad":return"L";case"onScroll":return"D";case"view":return"V";case"none":return"N";default:return"?"}}function Bp(r){switch(r){case"autoplay":return"A";case"clickToPlay":return"C";case"playOnView":return"V";case"userInitiated":return"U";default:return"?"}}function kc(r){switch(r){case"firstVideo":return"F";case"notFirstVideo":return"N";default:return"?"}}function Up(r){switch(r){case"defaultOnSmart":return"D";case"notSmart":return"N";case"singleEmbed":return"S";case"smart":return"P";default:return"?"}}function $p(r){switch(r){case"large":return"L";case"medium":return"M";case"small":return"S";default:return"?"}}function Gp(r){switch(r){case!0:return"A";case!1:return"N";default:return"?"}}function Pr(r){switch(r){case"inView":return"I";case"outOfView":return"O";case"tabHidden":return"H";default:return"?"}}function Vp(r){switch(r){case!0:return"Y";case!1:return"N";default:return"?"}}function jp(r){switch(r){case!0:return"Y";case!1:return"N";default:return"?"}}function Hp(r,e){switch(r&=231,e){case"autoplay":default:return r|0;case"clickToPlay":return r|16;case"playOnView":return r|8;case"userInitiated":return r|24}}function Wp(r,e){switch(r&=223,e){case!1:default:return r|0;case!0:return r|32}}function Dc(r,e){switch(r&=251,e){case"firstVideo":default:return r|0;case"notFirstVideo":return r|4}}function kr(r,e){switch(r&=252,e){case"inView":default:return r|0;case"outOfView":return r|2;case"tabHidden":return r|1}}function xc(r,e,t=!1){let n=new Map(r),i=e-2e3,s=n.get("playType").value==="clickToPlay",a=n.get("playType").value==="userInitiated",o=n.get("playType").value==="playOnView";if(t&&s){let l="inView",c=Pr(l);n.set("visibility",{value:l,code:c}),i=kr(i,l)}if(a){{let l="inView",c=Pr(l);n.set("visibility",{value:l,code:c}),i=kr(i,l)}{let l="firstVideo",c=kc(l);n.set("playOrder",{value:l,code:c}),i=Dc(i,l)}}if(o){let l=n.get("playOrder").value==="notFirstVideo";if(t||l){let u=n.get("visibility").value==="tabHidden"?"tabHidden":"inView",d=Pr(u);n.set("visibility",{value:u,code:d}),i=kr(i,u)}}return{values:n,id:i+2e3}}xi=oe(Rr);function en(r,e){return e&&(r=r.split("#")[0].split("?").slice(1).join("?")),r.split("&").reduce((t,n)=>(n=n.split("="),t[n.shift()]=n.join("="),t),{})}var Or=Ys();var Yp=300,Xs;function Qs(){let r=le.location.hostname.split(".").slice(-2).join("."),e=84,t={"chicagotribune.com":3}[r]||e,n=["https://d15kdpgjg3unno.cloudfront.net/oPS.js",`cid=${t}`];if(!le.document.querySelector(`script[src^='${n[0]}']`)){let i=le.document.createElement("script");i.src=n.join("?"),le.document.head.append(i)}if(!Xs){Xs=fetch(`https://dn6rwwtxa647p.cloudfront.net/${t}/${le.location.host}${le.location.pathname}.js`).then(i=>i.json()).catch(()=>({}));try{typeof oSetDataParam=="function"&&oSetDataParam("stnPlayerVersion",At())}catch(i){}}}var Mc=r=>{Qs(),r={desktop:"de",mobile:"mo",tablet:"tb"}[r];let e=new Promise(n=>setTimeout(n,Yp)),t=Xs.then(n=>(n?.device?.[r]?.["stn-player"]||n?.["stn-player"])?.join());return Promise.race([e,t]).then(n=>n??"null").then(n=>({key:"optimera",value:n}))};function Dr(r=1){return[...Array(r)].map(()=>Math.floor(Math.random()*10)).join("")}var Js=class{constructor(){this._params={bidIndex:0,prebid:{cid:void 0,bidders:void 0,winner:void 0},amazon:{bid:void 0}}}incrementBidIndex(){this._params.bidIndex++}get bidIndex(){return this._params.bidIndex}setPrebidCid(e){this._params.prebid.cid=e}setPrebidStats(e){Object.assign(this._params.prebid,e)}setPrebidBidders(e){this._params.prebid.bidders=Object.fromEntries(Object.values(e).map(t=>[t.bidder,null])),this._params.prebid.winner=void 0}setPrebidWinner(e){this._params.prebid.winner=e}get params(){return this._params}};var Fc=Promise.resolve(le).then(r=>new Promise((e,t)=>{let n=r,i=n.document,s={},a=[{src:"https://cdn-ima.33across.com/ppid.js",returnValue:"_33AcrossPpidMappingsProvider"}];a.forEach(o=>{let l=i.createElement("script");l.src=o.src;function c(){d(),s[o.returnValue]=n[o.returnValue],Object.keys(s).length===a.length&&e(s)}function u(h){d(),t(`Could not load 33Across '${o.returnValue}' from ${h.target.src}`)}function d(){l.removeEventListener("load",c),l.removeEventListener("error",u)}l.addEventListener("load",c),l.addEventListener("error",u),i.head.appendChild(l)})}).then(async e=>{if(!e)throw new Error("33 Across loaded but data do not exist");let t="0015a00003LiqV3AAJ",n,s=await new Promise((a,o)=>{n=new e._33AcrossPpidMappingsProvider({pid:t,callback:l=>{a(l)}}),n.loadIds(),setTimeout(()=>a([]),500)});return{userId:{name:"33acrossId",params:{pid:t},storage:{name:"33acrossId",type:"html5",expires:90,refreshInSeconds:8*3600}},eids:s}}));var Nc={6407246797:.5,6407246800:.6,6407246803:.7,6407924105:.8,6405080322:.9,5245153654:1,5245557794:1.2,5245159360:1.4,5245160080:1.6,5245565213:1.8,5245565501:2,5244567765:2.1,5244569736:2.2,5244570474:2.3,5244572601:2.4,5244575424:2.5,5245169272:2.6,5245170169:2.7,5245574600:2.8,5245171843:2.9,5244593892:3,5244595410:3.1,5244605733:3.2,5244606885:3.3,5245197019:3.4,5245609193:3.5,5244609078:3.6,5245172533:3.7,5245610126:3.8,5245620164:3.9,5245621118:4,5245205977:4.1,5245622549:4.2,5245624793:4.3,5244621792:4.4,5244623931:4.5,5245628075:4.6,5244624378:4.7,5245191274:4.8,5245211995:4.9,5245216270:5,5246265515:5.1,5245280061:5.2,5246267186:5.3,5245880143:5.4,5246277302:5.5,5245290648:5.6,5246278256:5.7,5245880878:5.8,5246278730:5.9,5245294971:6,5246283095:6.1,5245882975:6.2,5246285021:6.3,5246285696:6.4,5246284064:6.5,5245886536:6.6,5246286893:6.7,5245297653:6.8,5245888948:6.9,5245887529:7,5246287634:7.1,5245299963:7.2,5245300980:7.3,5245300530:7.4,5246291486:7.5,5246291756:7.6,5246292158:7.7,5245895758:7.8,5246293172:7.9,5245896388:8,5484899518:8.01,5245306932:8.1,5246294147:8.2,5246295083:8.3,5245308441:8.4,5245905511:8.5,5246302310:8.6,5246302937:8.7,5245315380:8.8,5246303942:8.9,5245914220:9,5245321434:9.1,5245321830:9.2,5245917982:9.3,5246315012:9.4,5245919926:9.5,5245920946:9.6,5245324962:9.7,5245923820:9.8,5246317430:9.9,5245925953:10,5246320493:10.1,5245330716:10.2,5246321963:10.3,5245333080:10.4,5246326928:10.5,5246327477:10.6,5246329160:10.7,5246330342:10.8,5245938376:10.9,5245397184:11,5245997719:11.1,5245998136:11.2,5246002711:11.3,5246399759:11.4,5246002276:11.5,5246400842:11.6,5246401607:11.7,5245402263:11.8,5245404381:11.9,5246007106:12,5640697157:12,5246406440:12.1,5245412145:12.2,5247433130:12.3,5246415555:12.4,5247434810:12.5,5247435062:12.6,5247435281:12.7,5247056863:12.8,5246416455:12.9,5247437180:13,5246421777:13.1,5246422788:13.2,5246423178:13.3,5247061378:13.4,5247061429:13.5,5247441050:13.6,5246423883:13.7,5247441575:13.8,5247441764:13.9,5246424627:14,5247074350:14.1,5247452564:14.2,5246438289:14.3,5247457838:14.4,5247459482:14.5,5246439300:14.6,5247077269:14.7,5247079162:14.8,5247460247:14.9,5247085165:15,5247500102:15.1,5246486580:15.2,5247502052:15.3,5247501338:15.4,5247503435:15.5,5247128569:15.6,5246489193:15.7,5246489754:15.8,5247504149:15.9,5247130759:16,5247131479:16.1,5247137992:16.2,5247139366:16.3,5247513779:16.4,5246499093:16.5,5247514274:16.6,5246500053:16.7,5247141046:16.8,5246501424:16.9,5247155422:17,5247157171:17.1,5247158284:17.2,5247157897:17.3,5246514639:17.4,5247159286:17.5,5246515674:17.6,5247528893:17.7,5247529850:17.8,5246516781:17.9,5247530384:18,5246518716:18.1,5247536066:18.2,5246523348:18.3,5247536150:18.4,5247519302:18.5,5247168157:18.6,5247537812:18.7,5246526393:18.8,5246527332:18.9,5247168691:19,5247169861:19.1,5247170806:19.2,5246529801:19.3,5246528298:19.4,5246530314:19.5,5247171745:19.6,5247519521:19.7,5247541601:19.8,5247547085:19.9,5247175438:20,5247178759:20.2,5247550925:20.4,5247551912:20.6,5246537889:20.8,5247183322:21,5246541552:21.2,5247554813:21.4,5247556553:21.6,5247557264:21.8,5247559847:22,5246545194:22.2,5247189040:22.4,5246546856:22.6,5247561305:22.8,5247198232:23,5246553795:23.2,5247571910:23.4,5246556423:23.6,5246556948:23.8,5247173896:24,5247576368:24.2,5247209470:24.4,5247208753:24.6,5246565354:24.8,5247212332:25,5246566041:25.2,5247213823:25.4,5247214555:25.6,5246568675:25.8,5247219280:26,5246574630:26.2,5246574897:26.4,5247591974:26.6,5246575386:26.8,5247222850:27,5247573098:27.2,5247223660:27.4,5247595649:27.6,5247224371:27.8,5246579004:28,5247226933:28.2,5246579976:28.4,5246580462:28.6,5246581128:28.8,5246582802:29,5247600437:29.2,5247229846:29.4,5246583837:29.6,5247601562:29.8,5246585961:30,5247231295:30.2,5247603737:30.4,5246589504:30.6,5247232549:30.8,5246591172:31,5247606689:31.2,5247606959:31.4,5247236317:31.6,5247237820:31.8,5247607826:32,5246594589:32.2,5246595540:32.4,5247611219:32.6,5246600805:32.8,5247242638:33,5247243592:33.2,5247612458:33.4,5246601312:33.6,5246601528:33.8,5247612164:34,5247244684:34.2,5247244780:34.4,5247613655:34.6,5246603685:34.8,5247615023:35,5247616232:35.2,5247249109:35.4,5246605662:35.6,5246606058:35.8,5247250444:36,5246607720:36.2,5246608212:36.4,5247251506:36.6,5247251728:36.8,5247250702:37,5246610366:37.2,5247621755:37.4,5247622550:37.6,5246611659:37.8,5247254632:38,5246612541:38.2,5246612049:38.4,5246613039:38.6,5247623210:38.8,5247623501:39,5247623750:39.2,5247624434:39.4,5247256318:39.6,5246615163:39.8,5247256936:40,5247258700:40.2,5247259585:40.4,5247258934:40.6,5247257263:40.8,5247257416:41,5247260080:41.2,5247260389:41.4,5247627527:41.6,5247262756:41.8,5247263209:42,5247263449:42.2,5247263686:42.4,5247263956:42.6,5246618067:42.8,5247265321:43,5247630704:43.2,5247631916:43.4,5246618790:43.6,5247632312:43.8,5246619075:44,5247632813:44.2,5247633074:44.4,5246620254:44.6,5246621196:44.8,5247267058:45,5247267514:45.2,5247267790:45.4,5247268039:45.6,5246622840:45.8,5246624571:46,5247635504:46.2,5246625330:46.4,5247637586:46.6,5247638282:46.8,5247638045:47,5247638771:47.2,5247270364:47.4,5246628429:47.6,5247640514:47.8,5246628708:48,5247270712:48.2,5247272866:48.4,5247641705:48.6,5247273496:48.8,5247273562:49,5247274006:49.2,5247643889:49.4,5247644849:49.6,5246631012:49.8,5245231843:50,5247279052:60,5247279271:70,5246637966:80,5246638680:90,5247290548:100,5247291331:110,5246652162:120,5247666224:130,5247651509:140,5246636292:150,5247651290:160,5246639199:958},Bc={6242719805:.25,6240250989:.5,6242068969:.75,6242068972:1,6242068975:1.25,6242068978:1.5,6240250995:1.75,6240251001:2,6242721350:2.25,6242719817:2.5,6240250491:2.75,6242721353:3,6242721482:3.25,6242721485:3.5,6242721488:3.75,6242719832:4,6242068993:4.25,6242721491:4.5,6242721494:4.75,6242721497:5,6242068708:5.25,6240250509:5.5,6240250512:5.75,6240250515:6,6240250518:6.25,6240250458:6.5,6240250521:6.75,6242068714:7,6240250524:7.25,6240250530:7.5,6242068717:7.75,6240250539:8,6240250542:8.25,6240250548:8.5,6242068720:8.75,6242719589:9,6242068723:9.25,6240250683:9.5,6240250686:9.75,6240250695:10,6240250698:10.25,6242068732:10.5,6242719592:10.75,6240250704:11,6240250707:11.25,6240250455:11.5,6242719598:11.75,6240250716:12,6242719601:12.25,6242719604:12.5,6240250722:12.75,6242068735:13,6240250461:13.25,6242068738:13.5,6240250725:13.75,6240250728:14,6242719607:14.25,6240250734:14.5,6242719610:14.75,6242068747:15,6242068750:15.25,6240250740:15.5,6240250494:15.75,6240250746:16,6240250749:16.25,6242719616:16.5,6242068756:16.75,6240250755:17,6240250761:17.25,6240250764:17.5,6242068762:17.75,6242068765:18,6240250770:18.25,6242719631:18.5,6240250773:18.75,6242068768:19,6240250782:19.25,6240250785:19.5,6242068771:19.75,6240250788:20,6240250794:20.5,6242719580:21,6240250797:21.5,6240250500:22,6240250923:22.5,6240250929:23,6242719640:23.5,6242719643:24,6242068786:24.5,6240250932:25,6242719649:25.5,6240250941:26,6242068789:26.5,6242046436:27,6242719652:27.5,6242068792:28,6242068795:28.5,6240250947:29,6240250950:29.5,6242068921:30,6240250953:31,6240250962:32,6242068927:33,6242719661:34,6242068930:35,6240250968:36,6242068933:37,6240250971:38,6240250503:39,6242719667:40,6242068939:41,6242719670:42,6242068942:43,6242068945:44,6242068948:45,6242068951:46,6242068954:47,6242068957:48,6242068960:49,6242068966:50},Uc={MWp6Y25iNA:.25,ODlhaGhj:.5,MTBrNTJpbw:.75,eDg5eHhj:1,MXVpeDd1bw:1.25,ZnF6aXRj:1.5,MTlwcm81Yw:1.75,aWl2Z240:2,MW5sN2RhOA:2.25,NDNna3Fv:2.5,MTZpd2M4dw:2.75,czNoZ2Nn:3,MXZodnNvdw:3.25,YzA1MDVj:3.5,MWgyZ3dzZw:3.75,b2htcWRj:4,MWlnZXZwYw:4.25,NTJmNWt3:4.5,MTJkMmZpOA:4.75,ejE3YXd3:5,MXFrbDA1Yw:5.25,ZXVpdWJr:5.5,MWM1NjQ4dw:5.75,a3k5d3Fv:6,MXEwbHRkcw:6.25,NTRkMWM:6.5,MTU3ZzlvZw:6.75,dTN3aWRj:7,MXhpYXVwcw:7.25,YW9veGt3:7.5,MWQ0NHAzNA:7.75,bmw2MXZr:8,MWt2dGJzdw:8.25,N2h0bG9n:8.5,MTFnbHIwZw:8.75,djJ2Mzdr:9,MXNkaWQ0dw:9.25,Z25nN2I0:9.5,MTh5YXNjZw:9.75,amZjNTR3:10,MW04aWNqaw:10.25,MnFyazAw:10.5,MTd0M2duNA:10.75,cnByMGcw:11,MXdzMngzNA:11.25,ZGFjNGpr:11.5,MWZhc2h6NA:11.75,cHJ0dXJr:12,MWkyb2Zzdw:12.25,NmNtOXo0:12.5,MTNuOWp3Zw:12.75,eG9pYTY4:13,MXJuYWZpOA:13.25,ZTlhcGRz:13.5,MWJqeHpiNA:13.75,bTB6YzNr:14,MW8xZnBqNA:14.25,MTd0c2U4:14.5,MTRtODRxbw:14.75,dGlvZGZr:15,MXlsMGEybw:15.25,OWJ6d3U4:15.5,MWVlYnRoYw:15.75,bjdmbHo0:16,MWtpMnZ3Zw:16.25,OHMwcTJv:16.5,em94Yzc0:16.75,d2QyN2xz:17,MXRucGhqNA:17.25,ZzlwcmVv:17.5,MWE4aHdxbw:17.75,aTJuNGU4:18,MW40ejExYw:18.25,M244OGhz:18.5,MTcxbWt1OA:18.75,c203b3hz:19,MXVtbzJkYw:19.25,YjR4OXRz:19.5,MWc3OTZndw:19.75,cDBjeXlv:20,NHkxdHo0:20.5,eXd0emI0:21,ZmhtZWlv:21.5,azdmaTB3:22,czd4OGc:22.5,dXIwMmtn:23,YWN0d3hz:23.5,bzg5bTJv:24,NnF6Nnlv:24.5,dnB5bmVv:25,aGFqcmk4:25.5,amF5dGo0:26,MzdtZGMw:26.5,cXNudXY0:27,Y2Q4eXlv:27.5,cThvbzNr:28,NXVpaWd3:28.5,eTVkM2k4:29,ZGM3anN3:29.5,bDN3Nmlv:30,dGViMXRz:31,bWdsNzlj:32,eDA1cnN3:33,aXBxb2xj:34,cnZkYTgw:35,b3Z6bmN3:36,emZrN3dn:37,a3E1cW04:38,dWFycWJr:39,bmQxdnI0:40,dmtubTY4:41,ang0bzNr:42,cmV0cGZr:43,cHZ2eHRz:44,eGRrejVz:45,bHEyMTM0:46,dHU4NWo0:47,bXdpYXlv:48,d2g0YW8w:49,aHJwdGRz:50};var $c=300,Xp=.01,Yn,Gc=class{constructor(){Yn.set(this,{amazon:[],prebid:[]})}addAmazon({amznbid:e,params:t,ttl:n=$c}){let i=Uc[btoa(String(e).replace(/^v_/,"")).replaceAll("=","")]??0;if(ie?console.log("Cache Amazon",{cpm:i,ttl:n,params:t}):console.log("Cache Amazon",{amznbid:e,ttl:n,params:t}),!i){console.error("Invalid Amazon Bid");return}let s=new Date(Date.now()+n*1e3),a=`https://aax.amazon-adsystem.com/e/dtb/vast?b=${t.amzniid}&rnd=${Yt()}&pp=${t.amznbid}`;tt(this,Yn).amazon.push({cpm:i,timeout:s,params:t,vastURL:a})}addPrebid({hb_bid:e,params:t,ttl:n=$c}){console.log("Cache Prebid",{cpm:e,ttl:n,params:t});let i=new Date(Date.now()+n*1e3),s=t.hb_bidder==="rubicon"?`https://prebid-server.rubiconproject.com/cache?uuid=${t.hb_uuid}`:`https://prebid.adnxs.com/pbc/v1/cache?uuid=${t.hb_uuid}`;tt(this,Yn).prebid.push({cpm:e,timeout:i,params:t,vastURL:s})}requestBid(e=!0){let t=tt(this,Yn),n=Date.now();Object.keys(t).forEach(o=>{t[o].forEach((l,c,u)=>{(l.cpm<Xp||l.timeout<n)&&(console.log("Cache Eject %o",l),delete u[c])}),t[o]=t[o].flat(0),t[o].sort((l,c)=>l.cpm===c.cpm?c.timeout-l.timeout:l.cpm-c.cpm)});let i=Object.keys(t).map(o=>[o,t[o].pop()]);if(i=i.filter(([,o])=>o),i.length===0)return console.log("Cache Request Bid Unavailable"),null;if(e)return new xr(t,Object.fromEntries(i));let s=Math.max(...i.map(o=>o[1].cpm));if(i.forEach((o,l,c)=>{o[1].cpm!==s&&(delete c[l],t[o[0]].push(o[1]))}),i=i.flat(0),i.length===1)return new xr(t,Object.fromEntries(i));let a=i.splice(Math.floor(Math.random()*i.length),1);return i.forEach(o=>{t[o[0]].push(o[1])}),new xr(t,Object.fromEntries(a))}};Yn=new WeakMap;var Qp={amazon:Bc,prebid:Nc},Rn,mt,xr=class{constructor(e,t){Rn.set(this,void 0);mt.set(this,void 0);console.log("Cache Request Bid %o",t),di(this,Rn,e),di(this,mt,t)}resolve(e){let t=[];if(!tt(this,Rn))return console.log("Bid Already Resolved - Ignoring Resolve Call"),{};let n=e&&Object.entries(Qp).find(([,s])=>e in s)?.[0],i=tt(this,mt);return n&&(console.log("Cache Request %o Bid was used - Deleting Bid %o",n,i[n]),t.push([n,i[n]]),delete i[n]),Object.keys(i).forEach(s=>{console.log("Cache Request %o Bid was not used - Inserting Bid %o",s,i[s]),tt(this,Rn)[s].push(i[s])}),di(this,Rn,null),di(this,mt,null),Object.fromEntries(t)}get params(){return tt(this,mt)&&Object.values(tt(this,mt)).reduce((e,t)=>Object.assign(e,t?.params),{})||{}}get vastURL(){return tt(this,mt)&&Object.fromEntries(Object.entries(tt(this,mt)).map(([e,t])=>[e,t.vastURL]))}get cpm(){return Object.fromEntries(Object.keys(tt(this,mt)).map(e=>[e,tt(this,mt)[e].cpm]))}};Rn=new WeakMap,mt=new WeakMap;var Xn=new Gc;var It,Mr="0_7.29.5D",ea={IN_STREAM:1,IN_BANNER:2,IN_ARTICLE:3,IN_FEED:4,INTERSTITIAL:5},Fr={IN_STREAM:1,ACCOMPANYING:2,INTERSTITIAL:3,STANDALONE:4},Nr=class{constructor(e,t){It(this,{firstAdTag:!0,model:e,mediaContainer:t,currentParams:!1});let s=It(this);P(()=>{s.optimeraEnabled=e.optimera}),P(()=>{s.divTag=e.divTag}),P(()=>{s.platform=e.platform}),P(()=>{s.hasPrebid=s.model.hasPrebid}),P(()=>{s.hasSpotXPrebid=s.model.hasSpotXPrebid}),P(()=>{s.hasAmazonPrebid=s.model.hasAmazonPrebid}),P(()=>{let{SM_ID:l,C_ID:c,STL_ID:u,SM_length:d,S_headLine:h,STL_leagueNameShort:f}=s.model?.rawCurrentItem??{};s.SM_ID=l,s.C_ID=c,s.STL_ID=`stl_id${u.toString().padStart(5,"0")}`,s.SM_length=d,s.S_headLine=h,s.STL_leagueNameShort=f}),P(()=>{let l=s.model.pageMeta,c=new URL(l.smartMatchLocation).hostname;s.url=l.smartMatchLocation,s.domain=(c.match(/[^. ]{4,}(?:\.[^. ]{1,3})+$/)||[])[0]||c}),P(()=>{let l=s.model.pageMeta;s.topics=l.stnMeta?.topics,s.tags=l.stnMeta?.tags,s.cid=l.stnMeta?.cid,s.ch=l.stnMeta?.ch});let a=rg();P(()=>{let l=Math.floor(s.model.mediaGroupContainerVisibilityRatio*100),c=s.model.float==="onLoad";s.view100=l===100||c&&s.firstAdTag&&l<50?1:0}),P(()=>{let l=Object.values(s.model.rawCurrentItem?.configuration?.adschedule??{})[0]?.tag||!1,c=!1,u;l?u=en(l,!0):u={},u.hasOwnProperty("usePageAdTag")&&(a?c=a:console.warn('window does not have a "usePageAdTag" value. Ignoring usePageAdTag param.')),s.pageAdTag=c;let d=en(decodeURIComponent(u.cust_params)),h=(d.schain||d.pchain||"").split(",");if(s.schainAsi="stnvideo.com",s.schainSid=h[1],s.schain=`${s.schainAsi},${s.schainSid}`,s.iu=u?.iu,s.adServer="gam",c)s.adServer="tagTest";else if(!s.iu&&l){let f=new URL(l);if(f.hostname.match(/(^|\.)springserve\.com$/)){let m=f.pathname.slice(1).split("/");["vast","vmap"].includes(m[0])?(s.springServeUnit=[f.hostname,m[0],m[1]],s.adServer="springServe"):s.springServeUnit=null}}}),P(()=>{s.sessionKey=`${s.model.usrID}-${_t.key}`}),P(()=>{s.placementType=s.model.placementType}),P(()=>s.keywchk=s.model.keywchk?.join(",")),P(()=>{s.playerKey=s.model.playerKey}),P(()=>{s.playerSize=s.model.playerSize}),P(()=>{s.playerType=s.model.playerType.toLowerCase()}),P(()=>{let l=s.model.playerStatus.playlistType;s.smartmatch=l==="smart"||l==="defaultOnSmart"?"yes":"no"}),P(()=>{s.dfpCode=s.model.playerStatus.dfpCode}),P(()=>{s.acID=s.model.playerStatus.getAdjustedId(!0)}),P(()=>{let l=s.model.rawCurrentItem;s.irisID=l?.irisMetaData?.EMD_providerId}),P(()=>{let c=s.model.rawCurrentItem?.irisMetaData?.EMD_context;s.irisContextStr=c?.join()}),P(()=>{s.umsEntities=ta(s.model.metaEntities)}),P(()=>{s.umsKeywords=ta(s.model.metaKeywords)}),P(()=>{s.umsTaxonomy=ta(s.model.metaTaxonomy)}),P(()=>{s.currentItemLevels=Object.fromEntries(Object.entries(s.model.rawCurrentItem).filter(([l])=>l.toLowerCase().startsWith("level")).map(([l,c])=>[l.toLowerCase(),typeof c=="string"?c.toLowerCase():c]))}),P(()=>{s.isMobile=s.model.isMobile}),P(()=>{let l=s.model.rawCurrentItem;s.irisMetaData=qe(l?.irisMetaData)}),P(()=>{let l=s.model.rawCurrentItem;s.IAB_uniqueID=qe(l?.IAB_uniqueID)}),P(()=>{let l=s.model.playerStatus.playlistType,c=l==="smart"||l==="defaultOnSmart",u=s.model.isClickToPlay,d=s.model.hasEverBeenEngaged,h=s.model.hasSoundEverBeenOn,f=s.model.mediagroupContainerPxFromTopOfPage+s.model.mediagroupContainerHeight<=s.model.mediagroupContainerWidth*4,m=s.model.isMediaGroupFloating,p=s.model.playlist&&s.model.playlist?.length>0;c||u||d||h||f?s.placement=ea.IN_STREAM:m?s.placement=ea.INTERSTITIAL:s.placement=ea.IN_ARTICLE,p?c||u||d||h||f?s.plcmt=Fr.IN_STREAM:s.plcmt=Fr.ACCOMPANYING:f?s.plcmt=Fr.INTERSTITIAL:s.plcmt=Fr.STANDALONE});let o={0:Br(Mr)};Q(()=>s.model.hasPrebid&&s.model.hasSpotXPrebid,()=>{s.bidTracker=new Js,P(()=>{let l=s.model.customPrebid,c=s.model.prebidTargeting,u=s.model?.rawCurrentItem?.C_ID,d=s.model?.rawCurrentItem?.STL_ID,h=s.model.feedCID,f=s.model.customPrebidRatio,m=0,p,[g,T]=s.model.prebidAB,_=Math.random()*100,y=Math.random()*100;if(l==="SOLO"){o[h]=Br(h);let b=c.LID,E=c.CID;_<f&&(b.includes(d)||E.includes(u))&&(m=h)}else{let b=y,E=[...s.model.prebidAB[0]];for(;b>=0&&(p=E.shift());)b-=p[0];p&&(o[p[2]]=Br(p[2]))}s.getPrebidBidsPromise=Promise.all([o[m],p?o[p[2]]:null]).then(([b,E])=>function(w){let O,S;try{O=E(w)}catch(N){O={}}S=b(w);let I=Object.fromEntries(Object.entries({...S,...O}).filter(([,N])=>N));return ie&&console.log({prebidResult:I}),I}),s.prebidProviderCid=m,s.prebidABS=T,s.prebidABC=g?.length?JSON.stringify(g):null,p?s.prebidAB=p[1]:s.prebidAB=null,s.bidTracker.setPrebidCid(m)})})}get bidTracker(){return It(this).bidTracker}get prebidAB(){let{prebidABS:e,prebidABC:t,prebidAB:n}=It(this);return{prebidABS:e,prebidABC:t,prebidAB:n}}get param(){return It(this).currentParams}async getOptimeraParams(){let e=It(this),t=e.optimeraEnabled?await Mc(e.platform):void 0;return ie&&console.log({optimeraData:t}),t?{[t.key]:t.value}:{}}newParams(){let e=It(this);e.currentParams=!1;let t=eg(),n=tg();e.firstAdTag=!1;let i;switch(e.adServer){case"tagTest":i=en(e.pageAdTag,!0),i.cust_params=en(decodeURIComponent(i.cust_params));break;case"gam":{if(!e.iu)return!1;i={iu:e.iu,env:"vp",gdfp_req:1,unviewed_position_start:1,ad_rule:1,output:"xml_vmap1",sz:"480x270",ciu_szs:"300x60",description_url:e.url,hl:"en",vpa:"auto",vconp:2,cmsid:2631244,plcmt:e.plcmt,vid:e.SM_ID,us_privacy:t,...n,cust_params:{sessionKey:e.sessionKey,schain:e.schain,content:e.C_ID,placementType:e.placementType,embed:e.playerKey,domain:e.domain,player_size:e.playerSize,player_width:e.mediaContainer.clientWidth,player_height:e.mediaContainer.clientHeight,player_type:e.playerType,smartmatch:e.smartmatch,version:Pi(),player_status:e.dfpCode,play_code:e.acID,view100:e.view100,excl_cat:new Set([e.STL_ID]),rand:Math.floor(Math.random()*20)+1,uhr:new Date().getHours().toFixed(0).padStart(2,"0"),iris_id:e.irisID,iris_context:e.irisContextStr,us_privacy:t,...n,ums_entities:e.umsEntities,ums_keywords:e.umsKeywords,ums_taxonomy:e.umsTaxonomy,keywchk:e.keywchk,prebidAB:e.prebidAB,topics:e.topics,tags:e.tags,cid:e.cid,ch:e.ch,plcmt:e.plcmt,placement:e.placement}};break}case"springServe":{if(!e.springServeUnit)return!1;i={cb:Dr(14),content:e.C_ID,desc:e.S_headLine,domain:e.domain,dur:e.SM_length,embed:e.playerKey,h:e.mediaContainer.clientHeight,level1:e.currentItemLevels.level1,level2:e.currentItemLevels.level2,owner:e.STL_leagueNameShort,play_code:e.acID,player_size:e.playerSize,player_type:e.playerType,smartmatch:e.smartmatch,r:Math.floor(Math.random()*20)+1,schain:e.schain,url:e.url,vid:e.SM_ID,w:e.mediaContainer.clientWidth};break}default:return!1}return e.currentParams=i,!!i}get paramsEncoded(){return encodeURIComponent(wt(this.param))}get adServerUrlPath(){let e=It(this);switch(e.adServer){case"tagTest":let t=new URL(e.pageAdTag);return`${t.origin}${t.pathname}`;case"gam":return"https://pubads.g.doubleclick.net/gampad/ads";case"springServe":return`https://${e.springServeUnit.join("/")}/`}}getPrebid(){let e=ng.call(this),t=ig.call(this),n={},i=[],s=Promise.allSettled([e,t]).then(([a,o])=>{ie&&(console.log("prebidParams:",a),console.log("amsParams:",o));let l=this.prebidBid=Xn.requestBid();if(l){let c=l.params;Object.assign(n,c);let u=l.cpm;(u.amazon||u.prebid>1)&&i.push(d=>d.excl_cat.add("has_bid")),c.hb_bidder&&(n.hb_version_bidder=Pi()+"_"+c.hb_bidder)}else console.error("NO BIDS");return{result:n,finalizers:i}}).catch(()=>({result:n,finalizers:i}));return e.catch(({pbjs:a,msg:o})=>{ie&&console.warn("Prebid:",o),a?.removeAdUnit()}),s}};It=oe(Nr);function ta(r){return r.length<=0?null:r.map(e=>e.replace(/[,=&]/,"").trim()).join(",")}function eg(){let r=!1;try{top.__uspapi("getUSPData",1,(e,t)=>{t&&(r=e.uspString)})}catch(e){return!1}return r}function tg(){let r={};try{top.__tcfapi("addEventListener",2,(e,t)=>{t&&e.eventStatus==="tcloaded"&&(r={gdpr:e.gdprApplies?1:0,gdpr_consent:e.tcString,addtl_consent:e.addtlConsent})})}catch(e){}return r}function ng(){let r=this.param.cust_params,e=It(this);if(!e.hasSpotXPrebid)return Promise.reject({pbjs:null,msg:"Prebid is not enabled"});let n={...e.currentItemLevels,play_code:r.play_code,content_owner:e.STL_leagueNameShort},i=r.player_width,s=r.player_height,a={context:"instream",mimes:["video/x-m4v","video/mpeg","video/mp4","application/javascript","video/webm","video/ogg"],minduration:5,maxduration:30,protocols:[2,3,5,6,7,8],w:i,h:s,sizes:[[i,s]],playerSize:[[i,s]],placement:r.placement,plcmt:this.param.plcmt,linearity:1,api:[2],battr:[9]},o={code:`${new Date().getTime().toString(36)}.${Yt(6)}`,mediaTypes:{video:a},bids:[]},l=[o,JSON.parse(JSON.stringify(o))];return l[1].mediaTypes.video.placement=1,l[1].mediaTypes.video.plcmt=1,Or.prebid.then(c=>Promise.race([new Promise((u,d)=>setTimeout(d,5e3,"Prebid timeout")),(async()=>{let u=await Fc;c.setConfig({cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"},userSync:{iframeEnabled:!0,filterSettings:{iframe:{bidders:["openx","rubicon"],filter:"include"}},userIds:[{...u.userId}]},eids:u.eids,consentManagement:{usp:{cmpApi:"iab",timeout:100}},schain:{validation:"strict",config:{ver:"1.0",complete:1,nodes:[{asi:e.schainAsi,sid:e.schainSid,hp:1}]}},ortb2:Object.assign({device:{language:navigator.language}},!e.IAB_uniqueID&&!e.irisID?null:{site:{content:Object.assign({},!e.IAB_uniqueID||e.IAB_uniqueID.length===0?null:{cattax:7,cat:e.IAB_uniqueID},!e.irisMetaData||!e.irisID?null:{data:[{name:"iris.tv",segment:(e.irisMetaData?.EMD_context||[]).map(T=>({id:T})),ext:{segtax:501,cids:[e.irisID]}}]})}})});let d=await e.getPrebidBidsPromise,h=L(()=>({valueOf:()=>e.acID,pageHidden:e.model.pageHidden,outsideViewPort:!e.model.isMediaGroupContainerVisible})),f=d({prebidVideoConfig:l.map(T=>T.mediaTypes.video),custom:n,ac_id:h,isMobile:e.isMobile,irisMetaData:Sr(e.irisMetaData),playerVersion:At()});["openX","telaria","yahoo"].forEach(T=>{delete f[T]}),e.prebidProviderCid!==0&&Object.keys(f).forEach(T=>{let _=f[T].bidder,y=`${_}_ext`;f[T].bidder=y,c.aliasBidder(_,y,{})});let p=Pi().includes("-spotx")||ag(),g=sg();return p||g?(console.log("Prebid Override Enabled - %o",g||"spotx"),p?o.bids=[{bidder:"spotx",params:{channel_id:79391,ad_unit:"instream"}}]:o.bids=Object.values(Object.fromEntries(Object.entries(f).filter(([T,_])=>T.toLowerCase()===g||_.bidder.toLowerCase()===g)))):l.forEach((T,_)=>{T.bids=Object.values(f).filter(y=>(y.bucket??0)===_)}),e.bidTracker.setPrebidBidders(o.bids),c.removeAdUnit(),c.addAdUnits(l),ie&&console.log({prebidAdUnits:l}),new Promise((T,_)=>{c.requestBids({bidsBackHandler:y=>{if(ie&&console.warn({bids:y}),e.bidTracker.setPrebidStats((0,Or.stats)(o.code)),!y[o.code]){_({pbjs:c,msg:"No Bids"});return}let b=0,E=[];y[o.code].bids.forEach(w=>{let{bidder:O,cpm:S,videoCacheKey:I,dealId:N,ttl:B}=w,A={hb_bidder:O,hb_bid:(Math.round(parseFloat(S)*100)/100).toFixed(2),hb_deal:N,hb_uuid:I,hb_bidder_cid:e.prebidProviderCid};A.hb_deal||delete A.hb_deal,S>b&&(E=[],b=S),S===b&&E.push(A),Xn.addPrebid({hb_bid:S,params:A,ttl:B})});let C=E[Math.random()*E.length|0];e.bidTracker.setPrebidWinner(C.hb_bidder),T(C)}})})})()]))}function ig(){let r=It(this);return r.hasAmazonPrebid?new Promise(async(e,t)=>{let i=await(await Promise.resolve().then(()=>Zs())).apstag;setTimeout(t,2e3,"timeout"),i.fetchBids({slots:[Object.assign({slotID:"standard",mediaType:"video"},r.irisID?{slotParams:{irisid:r.irisID}}:null)],timeout:2e3},s=>{if(ie&&console.log({amazonBids:s}),!s?.length){t("No Amazon Bids");return}s.forEach(a=>{try{let o=a.helpers?.encodedQsParams||a.encodedQsParams;typeof o=="function"&&(o=o());let l=Object.fromEntries(new URLSearchParams(decodeURIComponent(o)).entries());Xn.addAmazon({amznbid:l.amznbid,params:l,ttl:600})}catch(o){console.error(o)}}),e()})}):Promise.reject("Amazon ads are not enabled")}async function Br(r){r===void 0&&(r=Mr);try{return(await import(`https://player.sendtonews.com/bidderFiles/${r}.js`)).default}catch(e){return r===Mr?{}:Br(Mr)}}var sg=()=>{let r=new URLSearchParams(location.search);return r.has("stnForcePrebid")?r.get("stnForcePrebid").toLowerCase():!1},ag=()=>{let r=new URLSearchParams(location.search);return r.has("stnSpotxDV")?["1","true"].includes(r.get("stnSpotxDV")):!1};function rg(){let r=window;for(;r;){let e=r.usePageAdTag;if(typeof e=="string")return e;if(r===r.parent||!Object.getOwnPropertyNames(r.parent).includes("document"))return null;r=r.parent}}var Vc=ft.then(r=>new Promise((e,t)=>{let n=r,i=n.document,s=i.createElement("script");s.crossOrigin="anonymous",s.integrity="sha384-tD/Nw3vth7aA9BUoHdJl0C32cRNlTS3rV0Uz0uA8/uLLVvaCAbg7xzFkcX77ptYA",s.src="https://embed.sendtonews.com/library/streamsense/6.3.4.190424/comScore.gt.min.js";function a(){l(),e(n.ns_)}function o(c){l(),t(`Could not load Comscore library from ${c.target.src}`)}function l(){s.removeEventListener("load",a),s.removeEventListener("error",o)}s.addEventListener("load",a),s.addEventListener("error",o),i.head.appendChild(s)}).then(e=>{if(!e)throw new Error("Comscore library loaded but comscore object does not exist");return e}));var na=class{constructor(e){let t=void 0;this.assetLabels={ns_st_pr:"*null",ns_st_ep:"*null",ns_st_sn:"*null",ns_st_en:"*null",ns_st_ge:"Sports",ns_st_ia:"0",ns_st_ddt:"*null",ns_st_tdt:"*null",ns_st_st:"SendtoNews",c3:"sendtonews",c6:"*null"};let n=[];this.contentLabels={ns_st_ct:"vc12",ns_st_ce:"0"},this.model={adCuePoints:n,lib:t},ye(this.model),(async()=>{try{let i=await Vc;L(()=>this.model.lib=i)}catch{console.error("Comscore failed to load. No Comscore data will be logged"),L(()=>this.model.lib=null)}})(),P(()=>{this.usingAltPlaylist=e.usingAltPlaylist}),P(()=>{this.assetLabels.ns_st_ci=`${e.currentItem.SM_ID}`}),P(()=>{this.assetLabels.ns_st_pu=`${e.rawCurrentItem?.STL_leagueNameShort||"SendtoNews"}`}),P(()=>{let i=e.rawCurrentItem?.level1,s=e.rawCurrentItem?.level2??"Sports";this.assetLabels.c4=i!=="Sports"&&!e.usingAltPlaylist?s:"Sports"}),P(()=>{let i=e.rawCurrentItem?.SM_M_LENGTH??0;this.contentLabels.ns_st_cl=`${i*1e3}`}),P(()=>{let i=this.model.adCuePoints,s=this.model.adCuePoints.filter(og).filter(lg);this.contentLabels.ns_st_tp=`${s.length+1}`,this.midRolls=s})}load(){L(()=>this.model.adCuePoints=[]),this.setContentAssetOnContentPlay=!0;try{L(()=>this.streamingAnalytics=new this.model.lib.StreamingAnalytics({publisherId:"18065638"})),this.streamingAnalytics.createPlaybackSession()}catch(e){return console.error("Comscore load(): Failed to create streaming analytics",e),!1}return!0}adStart(e){if(!this.streamingAnalytics)return;this.setContentAssetOnContentPlay=!0;let t=null,n=null;switch(e.adPosition){case-1:t="post-roll",n="va13";break;case 0:t="pre-roll",n="va11";break;default:t="mid-roll",n="va12"}L(()=>this.model.adCuePoints=e.adCuePoints);let i=Object.assign({ns_st_cl:`${e.adLength*1e3}`,ns_st_ad:t,ns_st_ct:n},this.assetLabels);this.streamingAnalytics.getPlaybackSession().setAsset(i),this.streamingAnalytics.notifyPlay(0)}adPause(){!this.streamingAnalytics||this.streamingAnalytics.notifyPause()}adPlay(e){!this.streamingAnalytics||(this.setContentAssetOnContentPlay=!0,this.streamingAnalytics.notifyPlay(e.currentTime*1e3))}adFinish(){!this.streamingAnalytics||this.streamingAnalytics.notifyEnd()}contentPlay(e={}){if(!this.streamingAnalytics)return;let{currentTime:t,content_id:n}=e,i=this.midRolls.filter(cg(t)),s;switch(Number(n)){case 11259:case 11283:case 11284:case 11285:case 11286:case 11287:case 13136:s={CA2:"6035208",CA3:"FoxSports",CA4:"SendToNews"};break;default:s={}}if(this.contentLabels.ns_st_pn=`${i.length+1}`,!this.setContentAssetOnContentPlay){this.streamingAnalytics.notifyPlay(t*1e3);return}this.setContentAssetOnContentPlay=!1;let a=Object.assign({},this.assetLabels,this.contentLabels,s);this.streamingAnalytics.getPlaybackSession().setAsset(a),this.streamingAnalytics.notifyPlay(0)}contentPause(e){!this.streamingAnalytics||(e.ended?this.streamingAnalytics.notifyEnd():this.streamingAnalytics.notifyPause())}};function og(r,e,t){return t.indexOf(r)===e}function lg(r){return r>0}function cg(r){return e=>e<=r}var jc=!1;function Hc(r,e){if(jc)return;jc=!0;let n=le.document,i=n.createElement("script"),s=n.createComment("Start videoTrack Snippet"),a=n.createComment("End videoTrack Snippet");i.innerHTML=`
		!function (e, t, n, a, c, i, o) {
			e[a] || ((c = e[a] = function () {
				c.process ? c.process.apply(c, arguments) : c.queue.push(arguments)
			}).queue = [], c.t = +new Date, (i = t.createElement(n)).async = 1,
				i.src = "https://cdn.aivideofeed.com/pixel/v1/analytics.1.0.2.js",
				(o = t.getElementsByTagName(n)[0]).parentNode.insertBefore(i, o))
		}(window, document, "script", "videoTrack"), videoTrack("init", "${r}", {pageload: true, pkey: '${e}'});
	`,n.head.append(s,i,a)}var Qn=(r,e,t)=>Math.min(Math.max(r,e),t);var ug=ye({originRoot:le}),Ct,Ur=class{constructor(e){let t={get divTag(){return e.divTag},get originRoot(){return ug.originRoot},get href(){return this.originRoot?.location.href.split("#")[0]},get rawMeta(){let n,i,s,a=this.divTag;if(!a)return{og:n,canonical:i,element:a};do{try{let o=a.ownerDocument.querySelector('meta[property="og:url"]')?.content;if(o){let l=new URL(o,this.href);if(l.hash="",!l.protocol.startsWith("http"))throw new TypeError("Invalid Og Url Protocol");n=o}}catch(o){console.error("OG:URL Error - %o",o)}try{let o=a.ownerDocument.querySelector('link[rel="canonical"]')?.href;if(o){let l=new URL(i,this.href);if(l.hash="",!l.protocol.startsWith("http"))throw new TypeError("Invalid Canonical HREF Protocol");i=o}}catch(o){console.error("Canonical Error - %o",o)}s=a,a=a.ownerDocument.defaultView.frameElement}while(!n&&!i&&a);return{og:n,canonical:i,element:s}},get og(){return this.rawMeta.og},get canonical(){return this.rawMeta.canonical},get ogMatch(){return this.og===this.href},get canonicalMatch(){return this.canonical===this.href}};ye(this),Ct(this,{model:t})}get title(){return Ct(this).model.rawMeta.element?.ownerDocument.title}get keywords(){return Ct(this).model.rawMeta.element?.ownerDocument.querySelector('meta[name="keywords"]')?.content}get description(){return Ct(this).model.rawMeta.element?.ownerDocument.querySelector('meta[name="description"]')?.content}get revised(){let e=Ct(this).model.rawMeta.element?.ownerDocument;return e?[()=>e.querySelector('meta[property="article:modified_time"]')?.content,()=>e.querySelector('meta[name="revised"]')?.content,()=>e.querySelector('meta[itemprop="dateModified"]')?.content,()=>ia(e).find(n=>n?.dateModified)?.dateModified].reduce((n,i)=>n||i(),null):""}get published(){let e=Ct(this).model.rawMeta.element?.ownerDocument;return e?[()=>e.querySelector('meta[property="article:published_time"]')?.content,()=>e.querySelector('meta[itemprop="datePublished"]')?.content,()=>ia(e).find(n=>n?.datePublished)?.datePublished].reduce((n,i)=>n||i(),null):""}get href(){return Ct(this).model.href}get smartMatchLocation(){let e=Ct(this).model;return e.ogMatch||e.canonicalMatch?e.href:e.og??e.canonical??e.href??""}get ogSet(){return this.smartMatchLocation!==""}get smartMatchLocationIsReferrer(){let e=Ct(this).model;return!(e.ogMatch||e.canonicalMatch)}get stnMeta(){let e=Ct(this).model.rawMeta.element?.ownerDocument;return e?ia(e).find(t=>t?.stnMeta)?.stnMeta:{}}};function ia(r){return Array.from(r.querySelectorAll('script[type="application/ld+json"]')).map(t=>dg(t.innerText))}function dg(r,e={}){try{return JSON.parse(r)}catch(t){return e}}Ct=oe(Ur);var Ee=null,hg=1,fg=[],$r=new Date,ra=class{constructor(e){Ee||(Ee=e.constructor.config.model);{let c=this,u="#045473",d="#F3B91A",h="#95E5E5",f="rgb(255, 255, 255)",m="hsl(8, 88%, 33%)",p="hsl(8, 88%, 52%)",g=()=>{let T=document.createElement("div");T.style.overflow="scroll",document.body.appendChild(T);let _=T.offsetWidth-T.clientWidth;return T.remove(),`${_}px`};this.css={adProgressBarTrackColor:["#FF0",!0],get adProgressBarTrackTimeLeftColor(){return[c.isNewUI?"transparent":this.adProgressBarTrackColor[0],!0]},adProgressBarThumbColor:[f,!0],get progressBarTrackColor(){return c.isRedTheme?[p,!0]:c.isNewUI?[d,!0]:[u,!0]},get progressBarTrackTimeLeftColor(){return[c.isNewUI?"transparent":this.progressBarTrackColor[0],!0]},progressBarThumbColor:[f,!0],timeElapsedColorMini:[d,!0],timeRemainingColorMini:[f,!0],get adVolumeBarTrackColor(){return c.isRedTheme?[p,!0]:c.isNewUI?[d,!0]:[u,!0]},get adVolumeBarTrackUnusedColor(){return[c.isNewUI?"rgba(0,0,0,0.3)":this.adVolumeBarTrackColor[0],!0]},adVolumeBarThumbColor:[f,!0],get volumeBarTrackColor(){return c.isRedTheme?[p,!0]:c.isNewUI?[d,!0]:[u,!0]},get volumeBarTrackUnusedColor(){return[c.isNewUI?"rgba(0,0,0,0.3)":this.volumeBarTrackColor[0],!0]},volumeBarThumbColor:[f,!0],barkerSelectedPlaylistItemBackgroundColor:["inherit",!0],get barkerSelectedPlaylistItemLeftBorderColor(){return[c.isRedTheme?m:u,!0]},get hoveredPlaylistItemTitleColor(){return[c.isRedTheme?m:u,!0]},selectedPlaylistItemBackgroundColor:["rgb(217, 217, 217)",!0],selectedPlaylistItemLeftBorderColor:["transparent",!0],bigPlayButtonColor:[f,!0],get bigPlayButtonBackground(){return c.isRedTheme?[m,!0]:c.isNewUI?[d,!0]:[u,!0]},controlbarActiveButtonsColour:[d,!0],panelBackground:["rgb(241, 241, 241)",!0],playerBackground:["rgb(249, 249, 249)",!0],get scrollBarColor(){return[c.isRedTheme?m:u,!0]},scrollBarTrackColor:["rgb(225, 225, 225)",!0],smartMenuButtonBackground:["inherit",!0],smartMenuButtonColor:["green",!0],get menuButtonBackground(){return[c.isRedTheme?m:"inherit",!0]},menuButtonColor:["inherit",!0],spinnerColor1:[h,!0],spinnerColor2:[u,!0],subtitleCueColor:[f,!0],subtitleCueFontSize:["0.75em",!0],get subtitleCueBackgroundColor(){return[c.isRedTheme?m:u,!0]},titleBarColor:[f,!0],get titleBarButtonsBackground(){return[c.isNewUI?d:"#333",!0]},get titleBarButtonsBackgroundHover(){return[c.isNewUI?d:"#555",!0]},get titleBarBackground(){return[c.isRedTheme?m:u,!0]},get miniTitleBarColor(){let T=c.miniTheme,_;switch(T){case"white":_="black";break;default:case"black":_=f;break}return[_,!0]},get miniTitleBarBackground(){let T=c.miniTheme,_;switch(T){case"white":_=f;break;default:case"black":_="black";break}return[_,!0]},get miniTitleBarButtonsBackground(){return[c.isNewUI?d:"transparent",!0]},get miniTitleBarButtonsColor(){return[(c.isNewUI,"white"),!0]},unmuteBackgroundColor:[d,!0],unmuteColor:[f,!0],upNextBannerColor:[f,!0],get upNextBannerBackground(){return[c.isRedTheme?m:u,!0]},borderRadius:["8px",!0],floatZIndex:[2147483647,!0],stnEngageProgressColor:["#F5B900",!0],stnEngageTimeLeftColor:["#282829",!0],get stnEngageCountdownTime(){return[`${c.stnEngage?.countdown??0}s`,!1]},stnLinkPlayTop:[h,!1],stnLinkPlayRight:[d,!1],stnLinkPlayBottom:["#0F3D61",!1],stnLinkStnText:[d,!1],stnLinkVideoText:["#0F3D61",!1],controlbarHeight:["30px",!1],nativeScrollbarWidth:[g(),!1],get mediaHeight(){return`${c.playerMediaHeight}px`},get mediaWidth(){return`${c.playerMediaWidth}px`},get shareLinkSize(){let T=40,_=20,y=c.shareIconCount,b=c.playerMediaHeight,C=y*T+2*_;if(b>=C)return`${T}px`;let w=T/C;return`${b*w}px`},get titleBarHeight(){return`${c.titleBarHeight}px`},get barkerPadding(){return`${c.barkerSpacing}px`},get barkerTitleMargin(){return`${!!c.titleBarHeight*c.barkerSpacing}px`},get barkerMediaGroupContainerWidth(){return`${c.barkerMediaGroupContainerWidth.toFixed(4)}px`},get barkerMediaGroupContainerHeight(){return`${c.barkerMediaGroupContainerHeight.toFixed(4)}px`},get floatTop(){let T=`${c.floatMarginY}px`;return c.floatPosition.includes("top")?T:c.floatPosition.includes("bottom")?"auto":"50%"},get floatLeft(){return c.floatPosition.includes("left")?`${c.floatMarginX}px`:c.floatPosition.includes("right")?"auto":"50%"},get floatBottom(){let T;return c.useSafeAreaInsets?T=`calc(env(safe-area-inset-bottom, 0) + ${c.floatMarginY}px)`:T=`${c.floatMarginY}px`,c.floatPosition.includes("bottom")?T:"auto"},get floatRight(){return c.floatPosition.includes("right")?`${c.floatMarginX}px`:"auto"},get floatWidth(){let T=c.floatWidth,_=T<=1,y=_?"vw":"px",b=_?T*100:T;return _?`calc(${b}${y} - ${g()})`:`${b}${y}`},get floatMarginX(){return`${c.floatMarginX}px`},get floatTransform(){let T=c.floatPosition.includes("left")||c.floatPosition.includes("right")?"0":"-50%",_=c.floatPosition.includes("top")||c.floatPosition.includes("bottom")?"0":"-50%";return`translate3d(${T}, ${_}, 0);`},get titleBarBorderRadius(){let T=c.isMediaGroupReallyFloating,_=c.isBarker,y=c.isFloatHeaderVisible||c.isMiniFloatActive,b=_||c.isHeaderVisible||c.isMiniFloatActive,E=!c.isNewUI||c.isFullscreen||T&&y||!T&&b,C,w;return E?(C="0",w="0"):(C="var(--borderRadius)",w="var(--borderRadius)"),`${C} ${w} 0 0`},get contentBorderRadius(){let T=c.isMediaGroupReallyFloating,_=c.isBarker,y=c.isMiniFloatActive||c.isFloatHeaderVisible||c.isFloatTitleBarVisible,b=c.isMiniFloatActive,E=_||c.isHeaderVisible||!_&&c.isTitleBarVisible,C=_||c.isFooterVisible,w=!c.isNewUI||c.isFullscreen||T&&y||!T&&E,O=!c.isNewUI||c.isFullscreen||T&&b||!T&&C,S,I,N,B;return w?(S="0",I="0"):(S="var(--borderRadius)",I="var(--borderRadius)"),O?(N="0",B="0"):(N="var(--borderRadius)",B="var(--borderRadius)"),`${S} ${I} ${B} ${N}`},get playlistContainerMinHeight(){return c.hasNoTitlePrepend?"75px":"115px"},get miniFloatTitleMargins(){switch(c.miniFloatControlsLocation){case"bottom":return["1ch 2ch 0ch 2ch",!1];case"top":default:return["0 2ch 1ch 2ch",!1]}},get miniFloatTitleTemplate(){let T;switch(c.miniFloatControlsLocation){case"bottom":T=`
								"title title    title"
								"img   maximize close"
							`;break;case"top":default:T=`
								"img   maximize close"
								"title title    title"
							`;break}return[T,!1]},get miniFloatTitleTemplateRows(){let T;switch(c.miniFloatControlsLocation){case"bottom":T="1fr fit-content(0%)";break;case"top":default:T="fit-content(0%) 1fr";break}return[T,!1]},get miniFloatTitleButtonMargins(){let T,_,y,b,E;switch(c.miniFloatControlsLocation){case"bottom":_="0ch",b="0.6ch",E="0.6ch",y="0.6ch";break;case"top":default:_="0.6ch",b="0.6ch",E="0.6ch",y="0ch";break}return[`${_} ${E} ${y} ${b}`,!1]},get innerHeight(){return[`${c.innerHeight}px`,!1]}}}let t=j(()=>{this.innerHeight=le.innerHeight});le.addEventListener("resize",t),t(),this.isFloatTitleBarVisible=!0,this.isTitleBarVisible=!0,this.isHeaderVisible=!0,this.isFloatHeaderVisible=!0,this.isFooterVisible=!0,this.isFullscreen=!1,this.playerKey=null,this.shareIconCount=0,this.titleBarHeight=25,this.measuredPlayerWidth=void 0,this.mediagroupContainerWidth=void 0,this.mediagroupContainerHeight=void 0,this.mediagroupContainerPxFromTopOfPage=void 0,this.playerMediaWidth=void 0,this.barkerSpacing=5,this.pageHidden=!1,this.userEngaged=!1,this.hasEverBeenEngaged=!1,this.hasSoundEverBeenOn=!1,this.playerShow=!1,this.hasMediaGroupContainerBeenVisible=!1,this.mediaGroupContainerVisibilityRatio=0,this.hasBeenFloated=!1,this.floatClosing=!1,this.floatClosed=!1,this.miniClosed=!0,this.pausedWhileNotFloating=!1,this.hasEverStarted=!1,this.primaryDataread=null,this.altDataread=null,this.configurablePrimaryDataread=null,this.configurableAltDataread=null,this.rawCurrentItem=null,this.usingAltPlaylist=!1,this._selectedPlaylistItem={idx:0},this.randomFirstIdx=null,this.activeLoadCount=1,this.error=null,this.usrIdRandom=Dr(6),this.divTag=null,this.embedScriptTag=null,this.embedMutationObserver=null,this.volume=1,this.muted=!0,this.playerStatus=null,this.adTag=null,this.adActive=!1,this.pageMeta=new Ur(this),this.waitForEngagementLoggingToFinish=!1,this.imaVersion=null,this.isScrollFloatTriggered=!1,this.hasScrolled=!1,this.pxScrolled=0,this.api={},this.userInitiated=!1,this.paused=!0,this.hasStarted=!1,this.allowSubtitles=!1,this.mediagroupSet=!1,this.scrollbar=null,this.badContent=!1,this.isAmpFloating=!1,this.floatInhibited=!1,this.notFloatingReason=null,this.playerClicked={value:!1},ye(this),Object.freeze(this),x(()=>[this.userEngaged,this.isCurrentContentRecirc],([c,u])=>{u||(this.muted=!c)}),Q(()=>!this.muted&&this.volume>0,()=>{this.hasSoundEverBeenOn=!0}),x(()=>this.playlist,c=>{this.randomFirstIdx=this.randomizePlaylistStart?vg(0,this.rawPlaylist.length-1):0,c.forEach((u,d)=>{let h=!!u?.configuration?.liveFeed,f=u?.SM_length??0;if(h)u.duration="Live Feed";else{let p=new Date(0);p.setUTCSeconds(f),u.duration=`${p.getUTCMinutes()}:${("0"+p.getUTCSeconds()).slice(-2)}`}let m=[].concat(u.configuration.title);u.titleText=m.pop(),u.titleImg=m.pop()?.img,u.isActive=this.selectedPlaylistItem.idx===d,c[d]=u})}),x(()=>this.isFullscreen,c=>{c?Ee.isFullscreen.push(this):Ee.isFullscreen=Ee.isFullscreen.filter(u=>u!==this)}),x(()=>this.selectedPlaylistItem,c=>{let u=this.playlist;u.forEach((d,h)=>{u[h].isActive=h===c.idx})}),Q(()=>!!this.primaryDataread,()=>{if(this.float!=="onScroll")return;let c=[],u=window;do c.push(u);while(u!==u.parent&&(u=u.parent)&&Object.getOwnPropertyNames(u).includes("document"));let d=j(h=>{if(!h.isTrusted)return;let f=this.floatTriggerScroll;c.map(p=>p.scrollY).reduce((p,g)=>p+g,0)>=f&&(this.isScrollFloatTriggered=!0,c.splice(0).forEach(p=>{p.removeEventListener("scroll",d)}))});c.forEach(h=>{h.addEventListener("scroll",d)})});let n=[],i=window;do n.push(i);while(i!==i.parent&&(i=i.parent)&&Object.getOwnPropertyNames(i).includes("document"));let s=j(c=>{!c.isTrusted||(this.hasScrolled=!0,n.splice(0).forEach(u=>{u.removeEventListener("scroll",s)}))});n.forEach(c=>{c.addEventListener("scroll",s)}),Q(()=>!!this.primaryDataread,()=>{(this.float==="onLoad"||this.float==="immediate")&&!Ee.onLoadPushed?(Ee.onLoadPushed=!0,Ee.lastVisible.push(this)):this.float==="onScroll"&&!Ee.onScrollPushed&&(Ee.onScrollPushed=!0,Q(()=>this.isScrollFloatTriggered,()=>{Ee.lastVisible.push(this)}))}),Q(()=>this.miniFloat!==!1,()=>{this.miniClosed=!1});let a=()=>{Ee.lastVisible=Ee.lastVisible.filter(c=>c!==this)};x(()=>this.hasMediaGroupContainerBeenVisible&&!this.isMediaGroupContainerVisible,c=>{if(this.pausedWhileNotFloating||!this.isFloatPlayer||this.miniClosed&&this.floatClosed||this.floatOnce&&this.hasBeenFloated){a();return}c?Ee.lastVisible.push(this):a()}),Q(()=>this.isMediaGroupContainerVisible,()=>this.hasMediaGroupContainerBeenVisible=!0),x(()=>this.paused,c=>{this.pausedWhileNotFloating=c&&!this.isMediaGroupFloating});let o=x(()=>this.isMediaGroupFloating,()=>{this.isMediaGroupFloating||(this.hasBeenFloated=!0,o())});Q(()=>this.playlist.length>0,()=>{let c=!0;x(()=>this.selectedPlaylistItem,(u,d)=>{let h=u.idx,f=d?.idx??0,m=this.playlist.length;this.rawCurrentItem&&this.badContent&&(this.rawCurrentItem.loadFail||(this.rawCurrentItem.loadFail=0),this.rawCurrentItem.loadFail++);let p=this.playlist.length;if(p!==0){if(m!==p){let g=f>p-1?0:f;this.selectedPlaylistItem={idx:g};return}c||this.activeLoadCount++,c=!1,this.nextItemPlaylist[h].loadCount||(this.nextItemPlaylist[h].loadCount=0),this.nextItemPlaylist[h].loadCount++,this.usingAltPlaylist=this.nextItemIsAlternate,this.rawCurrentItem=this.nextItemPlaylist[h]}},{fireImmediately:!0})}),L(()=>{let c=()=>{Ee.viewportWidth=le.innerWidth,Ee.viewportHeight=le.innerHeight};Ee.viewportWidth===null&&Ee.viewportHeight===null&&(le.addEventListener("resize",j(c)),c()),le.addEventListener("scroll",u=>{!u.isTrusted||L(()=>this.pxScrolled=le.scrollY)}),this.pxScrolled=le.scrollY});let l=null;x(()=>[this.inhibitFloatOnClose,this.floatClosed&&this.miniClosed],([c,u],[d,h])=>{let f=u!==h,m=1*1e3*60*60,p=null;switch(c){case"NO":this.floatInhibited=!1;break;case"SESSION":u&&(_t.floatInhibited=!0),this.floatInhibited=_t.floatInhibited,clearTimeout(l);break;case"1HR":p=m;break;case"2HR":p=2*m;break;default:break}p!==null&&u&&f&&(clearTimeout(l),this.floatInhibited=!0,l=setTimeout(()=>{L(()=>this.floatInhibited=!1)},p))}),ie&&x(()=>this.notFloatingReason,c=>{c!=="N/A"?console.log("Reason why player is not floating: %o",c):console.log("Player is floating")},{fireImmediately:!0})}get keywchk(){return this.pageMetaData?.brandSafe?.keywchk}get configurableOverrides(){return this.configurableFeed?.overrides??{}}get configurableTimeDataOverrides(){return Object.values(this.configurableOverrides?.timeData??{})??[]}get configurableActiveTimeOverride(){let e=this.configurableTimeDataOverrides.filter(t=>{let n=t.PSCC_startTime,i=t.PSCC_endTime,s=new Date,a=new Date;s.setHours(...n.split(":")),a.setHours(...i.split(":"));let o=$r>=s&&$r<=a;return a<s&&(o=$r>=s||$r<=a),Ci(o?"Time override in bounds":"Time override not in bounds"),o});return e.length>=1?e[0]:{}}get preventImaRefreshOfGpt(){let e=this.feed.hasOwnProperty("PS_preventImaRefreshOfGpt"),t=this.feed.PS_preventImaRefreshOfGpt,n=this.feed.ESG_preventImaRefreshOfGpt==="YES",i=e?t:n;return Object.keys(this.feed).length?i:!1}get useLogoForPlay(){let e=this.feed.hasOwnProperty("PS_playButtonIcon"),t=this.feed.PS_playButtonIcon??"stnLogo",n=this.feed.ESG_playButtonIcon??"stnLogo",i=e?t:n;return Object.keys(this.feed).length?i==="stnLogo":!1}get playerMediaHeight(){return this.playerMediaWidth*9/16}get isLandscape(){return Ee.viewportWidth>Ee.viewportHeight}get selectedPlaylistItem(){return this._selectedPlaylistItem}set selectedPlaylistItem(e){this.userInitiated=!1,Wc.call(this,e)}set userSelectedPlaylistItem(e){this.userInitiated=!0,Wc.call(this,e)}nextSelectedPlaylistItem(e={}){let{force:t=!1,userInitiated:n=!1}=e,i=this.selectedPlaylistItem.idx>=this.playlist.length-1;if(!t&&i)return;let s=(this.selectedPlaylistItem.idx+1)%this.playlist.length;n?this.userSelectedPlaylistItem={idx:s}:this.selectedPlaylistItem={idx:s}}get feed(){let e=this.primaryDataread?.feed,t=this.configurablePrimaryDataread?.feed?.data;return this.useConfigurableFeed===null||!e||this.useConfigurableFeed&&!t?{}:e}get configurableFeed(){return this.configurablePrimaryDataread?.feed?.data||{}}get isFeedEmpty(){return Object.keys(this.feed).length===0}get pageMetaData(){let e=this.primaryDataread?.pageMetaData,t=this.configurablePrimaryDataread?.pageMetaData;return this.useConfigurablePageMetaData===null?null:this.useConfigurablePageMetaData?t:e}get playlistData(){let e=this.primaryDataread?.playlistData,t=this.configurablePrimaryDataread?.playlistData;return this.useConfigurablePlaylist===null?null:this.useConfigurablePlaylist?t:e}get altPlaylistData(){let e=this.altDataread?.playlistData,t=this.configurableAltDataread?.playlistData;return this.useConfigurablePlaylist===null?null:this.useConfigurablePlaylist?t:e}get rawPlaylist(){return this.playlistData?.[0]||fg}get playlist(){return qc.call(this,this.rawPlaylist)}resetLoadFail(){this.playlistData?.[0].forEach((e,t)=>{this.playlistData[0][t].loadFail=0})}get rawAltPlaylist(){return this.altPlaylistData?.[0]||[]}get altPlaylist(){return qc.call(this,this.rawAltPlaylist)}get nextItemPlaylist(){let e=this.altPlaylist,t=this.playlist;return this.nextItemIsAlternate?e:t}get playlistType(){return this.playlistData?.[1]||"No Playlist"}get disablePageGesture(){return this.isFeedEmpty?void 0:this.feed.PS_disablePageGesture??this.feed.ESG_disablePageGesture==="YES"}configurableDataReadEndpointCustomSource(e){let t=e?.feed||{},n=null;t.hasOwnProperty("PS_playlistEndpointURL")&&(n=t.PS_playlistEndpointURL);let i=null;return t.hasOwnProperty("ESG_playlistEndpointURL")?i=t.ESG_playlistEndpointURL:t.hasOwnProperty("ESG_playlistDataRead")&&(i=t.ESG_playlistDataRead),this.rawIgnoreConfigurableDataReadEndpointCustomSource(e)==="DISABLED"?!1:Object.keys(t).length?n??i??!1:null}rawIgnoreConfigurableDataReadEndpointCustomSource(e){let t=e?.feed||{},n=null;t.hasOwnProperty("PS_playlistEndpoint")&&(n=t.PS_playlistEndpoint);let i=null;return t.hasOwnProperty("ESG_playlistEndpoint")?i=t.ESG_playlistEndpoint:t.hasOwnProperty("ESG_ignorePlaylistDataRead")&&(i=t.ESG_ignorePlaylistDataRead!=="NO"?"TESTMODE":"ENABLED"),Object.keys(t).length?n??i??"DISABLED":null}ignoreConfigurableDataReadEndpointCustomSource(e){let t=this.rawIgnoreConfigurableDataReadEndpointCustomSource(e);return t===null?null:t!=="ENABLED"}useConfigurablePlaylistCustomSource(e){let t=this.configurableDataReadEndpointCustomSource(e);if(t===null)return null;let n=this.ignoreConfigurableDataReadEndpointCustomSource(e);return n===null?null:!!t&&!n}get configurableDataReadEndpoint(){return this.configurableDataReadEndpointCustomSource(this.primaryDataread)}get ignoreConfigurableDataReadEndpoint(){return this.ignoreConfigurableDataReadEndpointCustomSource(this.primaryDataread)}get useConfigurablePlaylist(){return this.useConfigurablePlaylistCustomSource(this.primaryDataread)}get useConfigurablePageMetaData(){return this.useConfigurablePlaylist}get useConfigurableFeed(){return this.useConfigurablePlaylist===null?null:!!this.configurableFeed.PS_stnEngage}get stnEngageFeed(){return this.useConfigurableFeed===null?{}:this.configurableFeed?this.useConfigurableFeed?this.configurableFeed:this.feed:{}}get removeTagAttributes(){let e=this.feed.hasOwnProperty("PS_removeTagAttributes")?!!this.feed.PS_removeTagAttributes:null,t=this.feed.hasOwnProperty("ESG_removeTagAttributes")?this.feed.ESG_removeTagAttributes==="YES":null;return Object.keys(this.feed).length?e??t??!0:null}get prebidAB(){let e=null,t;if(this.feed.hasOwnProperty("PS_playerPrebidAB")?(e="P",t=this.feed.PS_playerPrebidAB):this.feed.hasOwnProperty("PS_globalPrebidAB")&&(e="G",t=this.feed.PS_globalPrebidAB),typeof t=="string")try{t=JSON.parse(t)}catch(n){t=null}return(!t||!Array.isArray(t))&&(e=null,t=[]),[t.filter(n=>typeof n[0]=="number"&&typeof n[1]=="string"&&(typeof n[2]=="string"||typeof n[2]=="undefined")),e]}get enableCatapultX(){let e=this.feed.hasOwnProperty("PS_catapultX"),t=!!this.feed.PS_catapultX,n=this.feed.ESG_enableCatapultX==="YES";return e?t:n}get configuredAsSmartPlayer(){let e=this.feed.hasOwnProperty("PS_contentType"),t=this.feed.PS_contentType==="smart",n=this.feed.ESG_smartPlayer==="YES";return e?t:n}get metaEntities(){return this.feed?.pageMetaData?.UMS_entities??[]}get metaKeywords(){return this.feed?.pageMetaData?.UMS_keywords??[]}get metaTaxonomy(){return this.feed?.pageMetaData?.UMS_taxonomy??[]}get altPlaylistKey(){let e=this.feed.hasOwnProperty("PS_altPlaylistKey"),t=this.feed.PS_altPlaylistKey??null,n=this.feed.ESG_altPlaylist??null;return e?t:n}get hasAltPlaylist(){return this.altPlaylist.length>0}get visibleToPlayAmount(){let e=this.feed.hasOwnProperty("PS_visibleToPlayAmount"),t=this.feed.PS_visibleToPlayAmount??.5,n=Rt(this.feed.ESG_minVisRatio,.5);return e?t:n}get isFloatPlayer(){return this.float!=="none"}get floatPercent(){let e=parseFloat(this.feed.ESG_floatPercent),t=parseFloat(this.feed.ESG_mobileFloatPercent);return this.isMobile?t:e}get isFloatOnLoad(){let e=this.feed.ESG_floatOnLoad==="YES",t=parseFloat(this.feed.ESG_floatPercent)<1,n=this.feed.ESG_floatOnLoadMobile==="YES",i=(e||t)&&(!this.isMobile||n);return this.floatPercent<1||i}get isFloatOnScroll(){return!!(this.floatPercent&&this.floatPercent<1)}get float(){let e=this.feed.hasOwnProperty("PS_float"),t=this.feed.PS_float,n=this.floatPercent,i=this.feed.ESG_enableBarkerFloat==="YES",s=this.playerType,a=this.disableFloat,o=this.isMobile,l=this.feed.ESG_enableMobileFloat==="YES",c=this.feed.ESG_floatTrigger??!1,d=(s==="FLOAT"||s==="BARKER"&&i)&&(!o||l)||n<=1,h;return d?this.isFloatOnScroll?h="onScroll":this.isFloatOnLoad?h="onLoad":c==="immediate"?h="immediate":h="view":h="none",a?"none":e?t:h}get disableFloat(){let e=this.endemic==="nf";if(!le)return!1;let t=!le.document.referrer,n=en(le.document.location.search,!0).stn;return e&&(t||n==="nf")}get endemic(){let e=this.feed.hasOwnProperty("PS_endemic"),t=this.feed.PS_endemic,n=this.feed.ESG_directLoadFloat==="NO"?"nf":"";return e?t:n}get floatTriggerScroll(){let e=this.feed.hasOwnProperty("PS_floatTriggerScroll"),t=this.feed.PS_floatTriggerScroll??0,n=this.isMobile,i=Rt(this.feed.ESG_floatPercent,0),s=Rt(this.feed.ESG_mobileFloatPercent,0);return(e?t:n?s:i)*1e3}get isAmp(){let{hostname:e="",pathname:t="",hash:n=""}=this.divTag?.ownerDocument.location||{};return!!(n==="#amp=1"||e.endsWith("cdn.ampproject.org")||t.startsWith("/amp")&&(e.endsWith("sendtonews.com")||e==="localhost")||e==="amp.stnvideo.com"&&t.startsWith("/avi"))}get playerType(){let e=this.isAmp?"FULL":null,t=this.feed.ESG_playerType,n=this.divTag?.getAttribute("data-type");return(e??t??n??"FULL").toUpperCase().replaceAll(/[0-9]/g,"")}get configuredAsBarker(){return this.skin==="barker"||this.divTag?.hasAttribute("data-forcebarker")}get configuredFloatMarginX(){let e=this.feed.hasOwnProperty("PS_floatOffsetX"),t=this.feed.PS_floatOffsetX,n=this.isMobile,i=Rt(this.feed.ESG_mobileOffsetX),s=Rt(this.feed.ESG_offsetX),a=n?i:s,o=parseInt(this.divTag?.getAttribute("data-float-x"),10),l=(e?t:a)??o??null;return isNaN(l)?null:l}get configuredFloatMarginY(){let e=this.feed.hasOwnProperty("PS_floatOffsetY"),t=this.feed.PS_floatOffsetY,n=this.isMobile,i=this.feed.ESG_mobileOffsetY,s=this.feed.ESG_offsetY,a=n?i:s,o=parseInt(this.divTag?.getAttribute("data-float-y"),10),l=(e?t:a)??o??null;if(typeof l=="string")try{l=JSON.parse(l)}catch(c){l=null}return isNaN(l)?l:{0:l}}get currentFloatMarginY(){return Kc.call(this,this.configuredFloatMarginY)}get configuredMiniFloatMarginY(){let e=this.feed.hasOwnProperty("PS_miniFloatOffsetY"),t=this.feed.PS_miniFloatOffsetY,n=this.feed.ESG_miniOffsetY,i=(e?t:n)??null;if(typeof i=="string")try{i=JSON.parse(i)}catch(s){i=null}return isNaN(i)?i:{0:i}}get currentMiniFloatMarginY(){return Kc.call(this,this.configuredMiniFloatMarginY)}get configuredMiniFloatMarginX(){let e=this.feed.hasOwnProperty("PS_miniFloatOffsetX"),t=this.feed.PS_miniFloatOffsetX,n=Rt(this.feed.ESG_miniOffsetX),i=(e?t:n)??null;return isNaN(i)?null:i}get configuredFloatWidthPortrait(){let e=this.feed.hasOwnProperty("PS_floatWidth"),t=this.feed.PS_floatWidth,n=this.isMobile,i=Rt(this.feed.ESG_mobileFloatWidth,.6),s=Rt(this.feed.ESG_floatingWidth,400),a=n?i:s;return this.isMiniFloatActive?1:(e?t:a)??400}get configuredFloatWidthLandscape(){let e=this.feed.hasOwnProperty("PS_floatWidthLandscape"),t=this.feed.PS_floatWidthLandscape,i=this.isMobile?null:Rt(this.feed.ESG_floatingWidthLandscape);return this.isMiniFloatActive?.4:(e?t:i)??this.configuredFloatWidthPortrait}get configuredFloatPosition(){let e=this.feed.hasOwnProperty("PS_floatPositionX")&&this.feed.hasOwnProperty("PS_floatPositionY"),t=this.feed.PS_floatPositionX,i=`${this.feed.PS_floatPositionY} ${t}`,s=this.isMobile,a=this.feed.ESG_mobileFloatPosition,o=this.feed.ESG_floatingPosition,l=(s?a:o)?.split("-").join(" "),c=this.divTag?.getAttribute("data-float-position")?.split("-").join(" ").toLowerCase();return(e?i:l)??c}get isLastPlaylistItem(){return this.selectedPlaylistItem.idx>=this.playlist.length-1}get isLoopingPlaylist(){let e=this.feed.hasOwnProperty("PS_playlistMode"),t=this.feed.PS_playlistMode==="loop",n=this.feed.ESG_loopPlaylist==="YES";return e?t:n}get socialSharingTrigger(){let e=this.feed.hasOwnProperty("PS_socialSharing"),t,n=this.feed.PS_socialSharing?.toLowerCase?.();switch(n){case"static":t="hover";break;case"toggle":t="controlBarClick";break;default:t=!1;break}let i;switch(n=this.feed.ESG_socialSharing?.toLowerCase?.(),n){case"yes":case"static":i="hover";break;case"no":i=!1;break;default:i="controlBarClick";break}return e?t:i}get adRecovery(){let e=this.feed.hasOwnProperty("PS_adRecovery"),t=this.feed.PS_adRecovery,n=this.feed.ESG_adRecovery,i=(e?t:n)??"NONE";return this.isCurrentContentRecirc?"NONE":i}get apiEnabled(){let e=this.feed.hasOwnProperty("PS_api"),t=!!this.feed.PS_api,n=this.feed.ESG_api==="YES";return e?t:n}get logAssertiveYield(){let e=this.feed.hasOwnProperty("PS_logAssertiveYield"),t=!!this.feed.PS_logAssertiveYield,n=this.feed.ESG_logAssertiveYield==="YES";return e?t:n}get delayPlayStart(){let e=this.feed.hasOwnProperty("PS_delayPlayStart"),t=this.feed.PS_delayPlayStart??"disabled",n=this.feed.ESG_delayStartOnScroll==="YES"?"onScroll":"disabled";return e?t:n}get playbackMode(){let e=this.feed.hasOwnProperty("PS_playbackMode"),t=this.feed.PS_playbackMode??"playOnView",n=this.isMobile,i=this.feed.ESG_mobileAutoplay==="YES",s=this.feed.ESG_playerAutoplay==="YES",a=n?i:s,o=this.feed.ESG_floatTrigger,l=this.feed.ESG_playOnVisible==="YES"||this.isFloatOnLoad||o==="immediate";return e?t:a?"autoplay":l?"playOnView":"clickToPlay"}get isClickToPlay(){return this.playbackMode==="clickToPlay"}get isAutoplay(){return this.playbackMode==="autoplay"}get isPlayOnView(){return this.playbackMode==="playOnView"}get isBarker(){return this.configuredAsBarker&&!(this.measuredPlayerWidth<this.minBarkerWidth)}get playerSize(){return this.playerMediaWidth<400?"small":this.playerMediaWidth<601?"medium":"large"}get schain(){let t=Object.entries(this.playlist[0]?.configuration?.adschedule??{})?.[0]?.[1]?.tag||!1,n=t?en(t,!0):{},i=en(decodeURIComponent(n.cust_params)),s=(i.schain||i.pchain||"").split(",");return{asi:"stnvideo.com",sid:s[1]}}get nextItemIsAlternate(){let e=this.hasAltPlaylist,t=this.isMediaGroupFloating||this.isAmpFloating,n=this.isPlayOnView,i=this.isMediaGroupContainerVisible,s=this.pageHidden,a=this.ampAlt;return e?a||s&&(!n||i||t)?!0:!(n||i||t):!1}get rawTitle(){let t=this.rawCurrentItem?.configuration.title??"";return(Array.isArray(t)?t?.[1]:t)??""}get titleFrontImage(){let t=this.rawCurrentItem?.configuration.title??"";return(Array.isArray(t)?t?.[0]?.img:"")??""}get hasTitleFrontImage(){return this.titleFrontImage!==""}get dataReadSubtitles(){let e=this.rawCurrentItem;return!e||!e.videoConversions?[]:Object.keys(e.videoConversions).filter(mg).map(n=>{let i=e.videoConversions[n],s=pg(n);return{kind:"subtitles",srclang:s,src:gg(e,i),label:`Subtitles ${s.toUpperCase()}`,active:!1}})}get mediaLinks(){let e=this.rawCurrentItem,t=this.isMiniFloatActive;return(e?.mediaLinks??[]).map(i=>({endTime:i.SML_endTime,graphicURL:i.SML_overlayGraphicUrl,startTime:i.SML_startTime,status:t?"EXTERNAL":i.SML_overlayStatusCD,url:i.SML_url}))}get isCurrentContentRecirc(){return this.mediaLinks.length>0}get currentItem(){let e=this.rawCurrentItem,t={poster:e?.configuration.poster??"",content:e?.configuration.sources.src??"",title:this.rawTitle,titleFrontImage:this.titleFrontImage,shortSummary:e?.S_shortSummary??"",liveFeed:e?.configuration?.liveFeed,C_ID:e?.C_ID,SM_ID:e?.SM_ID,S_ID:e?.S_ID,STL_ID:e?.STL_ID,S_RKEY:e?.S_RKEY,irisMetaData:e?.irisMetaData,loadCount:e?.loadCount,isAlternate:this.usingAltPlaylist};return e?t:{}}get feedCID(){return this.feed.C_ID}get platform(){return this.feed?.platform?.toLowerCase()}get isMobile(){return this.platform==="mobile"}get hasEngagementLogging(){let e=this.feed.hasOwnProperty("PS_engagementLogging"),t=!!this.feed.PS_engagementLogging,n=this.feed.ESG_enableEngagementLogging==="YES";return e?t:n}get dvLogging(){let e=this.feed.hasOwnProperty("PS_dvLogging"),t=!!this.feed.PS_dvLogging,n=this.feed.ESG_dvLogging==="YES";return e?t:n}get fullscreenFallback(){let e=this.feed.hasOwnProperty("PS_fullscreenFallback"),t=this.feed.PS_fullscreenFallback??"fullWidth",n=this.feed.ESG_fullscreenFallback??"fullWidth";return e?t:n}get hasPrebid(){return this.headerBidding.length>0}get hasSpotXPrebid(){return this.headerBidding.includes("spotx")}get hasAmazonPrebid(){return this.headerBidding.includes("amazon")}get prebidTargeting(){let e=this.feed.hasOwnProperty("PS_customPrebidSelector"),t=this.feed.PS_customPrebidSelector??{},n=this.feed.ESG_customPrebidSelector??"{}",i=e?t:JSON.parse(n);return i.LID=[].concat(i.LID).filter(s=>s).map(s=>String(s)),i.CID=[].concat(i.CID).filter(s=>s).map(s=>String(s)),i}get customPrebid(){let e=this.feed.hasOwnProperty("PS_useCustomPrebid"),t=this.feed.PS_useCustomPrebid,n=this.feed.ESG_useCustomPrebid;return e?t:n}get customPrebidRatio(){let e=this.feed.PS_customPrebidRatio,t=this.feed.ESG_customPrebidRatio;return Number(e||t)||100}get headerBidding(){let e=this.feed.hasOwnProperty("PS_headerBidding"),t=this.feed.PS_headerBidding??null,n;Array.isArray(t)?n=t:t?n=[t]:n=[];let i=[];return this.feed.ESG_enableSpotXHeaderBidding!=="NO"&&i.push("spotx"),this.feed.ESG_amazonAds!=="NO"&&i.push("amazon"),e?n:i}get insecureVpaid(){return!(this.feed.PS_secureIframe?this.feed.PS_secureIframe===1:this.feed.ESG_secureImaFrame==="YES")}get playerLayout(){return this.isBarker?"barker":"full"}get barkerHeight(){let e=this.feed.hasOwnProperty("PS_skinSize"),t=this.feed.PS_skinSize,n=Rt(this.feed.ESG_playerSize),i=parseInt(this.divTag?.getAttribute("data-size"),10),s={220:220,400:265,500:313},a=s[n],o=(e?t:a)??s[i]??265;return Qn(o,200,350)}get minBarkerWidth(){let e=this.barkerHeight;return-5/6696*e*e+9865/6696*e+606025/1674}get barkerMediaGroupContainerHeight(){return this.barkerHeight-!!this.titleBarHeight*(this.titleBarHeight+this.barkerSpacing)-2*this.barkerSpacing}get barkerMediaGroupContainerWidth(){return this.barkerMediaGroupContainerHeight*16/9}get floatPosition(){let e=this.configuredFloatPosition??"bottom right";return this.api?.floatApi?.position??e}get floatMarginX(){let e=this.configuredFloatMarginX??10,t=this.configuredMiniFloatMarginX??0,n=this.isMiniFloatActive,i=this.isLandscape,s=this.api?.floatApi?.horizontalTranslate??0;return n?(i?t:0)+s:e+s}get floatMarginY(){let e=this.currentFloatMarginY??10,t=this.currentMiniFloatMarginY??0,n=this.isMiniFloatActive,i=this.api?.floatApi?.verticalTranslate??0;return(n?t:e)+i}get floatWidth(){let e=this.configuredFloatWidthLandscape,t=this.configuredFloatWidthPortrait;return this.isLandscape?e:t}get floatMode(){let e=this.feed.hasOwnProperty("PS_floatMode"),t=this.feed.PS_floatMode,n=this.feed.ESG_floatOnce==="YES"?"once":"always";return e?t:n}get floatOnce(){return this.floatMode==="once"}get isMediaGroupReallyFloating(){return this.isMediaGroupFloating?this.float==="immediate"||this.hasEverStarted?!0:(L(()=>this.notFloatingReason="Player has not started yet."),!1):!1}get isMediaGroupFloating(){let e=this.floatTriggerScroll,t=this.float,n=this.hasMediaGroupContainerBeenVisible,i=this.floatClosed,s=this.floatClosing,a=this.isLastVisible,o=this.isScrollFloatTriggered,l=this.isMediaGroupContainerVisible,c=this.apiEnabled,u=this.api?.floatApi?.float,d=this.floatOnce,h=this.hasBeenFloated,f=this.pausedWhileNotFloating,m=Ee.isFullscreen.length>0,p=this.miniClosed,g=this.floatInhibited,T=this.divTag?.ownerDocument.defaultView!==this.divTag?.ownerDocument.defaultView.parent,_=c&&u===!1;return g?(L(()=>this.notFloatingReason="Float has been inhibited"),!1):T&&this.isAmp?(L(()=>this.notFloatingReason="AMP Players cannot float inside of a frame"),!1):m?(L(()=>this.notFloatingReason="Page has a fullscreen player active"),!1):f?(L(()=>this.notFloatingReason="Player was paused while not floating"),!1):d&&h?(L(()=>this.notFloatingReason="Player has floated and is configured to float only once"),!1):_?(L(()=>this.notFloatingReason="Float API turned off floating"),!1):t==="none"?(L(()=>this.notFloatingReason="Float type is 'none'"),!1):i&&p?(L(()=>this.notFloatingReason="Float was closed by user"),!1):n?l?(s?L(()=>this.notFloatingReason="N/A"):L(()=>this.notFloatingReason="Player is not in a floatable position"),s):(a?L(()=>this.notFloatingReason="N/A"):L(()=>this.notFloatingReason="Player is not the last visible player"),a):t==="onScroll"?o?(a?L(()=>this.notFloatingReason="N/A"):L(()=>this.notFloatingReason="Player is not the last visible player"),a):(L(()=>this.notFloatingReason="User hasn't triggered float on scroll"),!1):t==="onLoad"||t==="immediate"?(a?L(()=>this.notFloatingReason="N/A"):L(()=>this.notFloatingReason="Player is not the last visible player"),a):(L(()=>this.notFloatingReason="Player hasn't been visible yet"),!1)}get configuredSecondaryFloatBehaviour(){let e=this.feed.hasOwnProperty("PS_secondaryFloatBehaviour"),t=this.feed.PS_secondaryFloatBehaviour,n=this.isMobile?this.feed.ESG_secondaryFloatBehaviour:"none";return e?t:n}get closingOrMinimizing(){return this.miniFloat==="miniOnClose"&&!this.isMiniFloatActive?"Minimizing":"Closing"}get closeOrMinimize(){let e="close",t="close_fullscreen";return this.miniFloat==="miniOnClose"&&!this.isMiniFloatActive?t:e}get miniFloat(){let e=this.configuredSecondaryFloatBehaviour;switch(e){case"mini":case"miniOnClose":return e;default:return!1}}get miniType(){return this.miniFloat?this.miniFloat:""}get isMiniFloatActive(){let e=this.miniFloat,t=this.isMediaGroupFloating,n=this.floatClosed;return!(!e||!t||!n&&e==="miniOnClose")}get miniTheme(){let e=this.feed.hasOwnProperty("PS_miniTheme"),t=this.feed.PS_miniTheme,n=this.feed.ESG_miniTheme;return(e?t:n)??"black"}get miniFloatControlsLocation(){let e=this.feed.hasOwnProperty("PS_miniFloatControlsLocation"),t=this.feed.PS_miniFloatControlsLocation,n=this.feed.ESG_miniFloatControlsLocation;return(e?t:n)??"top"}get isMediaGroupContainerVisible(){return this.mediaGroupContainerVisibilityRatio>=this.visibleToPlayAmount}get title(){let e=this.rawTitle,t=this.titlePrepend;return t===""?e:`${t} - ${e}`}get poster(){return this.currentItem?.poster??""}get shortSummary(){return this.currentItem?.shortSummary??""}get usrID(){return`${this.feed.cacheCode||""}${this.usrIdRandom}`}get isLastVisible(){return Ee.lastVisible[Ee.lastVisible.length-1]===this}get placementType(){return this.feed.LR_placementType||"Premium"}get frameBreak(){let e=this.feed.hasOwnProperty("PS_frameBreak"),t=!!this.feed.PS_frameBreak,n=this.feed.ESG_enableFrameBreak==="YES";return e?t:n}get resonateEnabled(){let e=this.feed.hasOwnProperty("PS_resonate"),t=this.feed.hasOwnProperty("ESG_disableResonate"),n=e?!!this.feed.PS_resonate:null,i=t?this.feed.ESG_disableResonate!=="YES":null,s=this.isFeedEmpty?!1:n??i??!0;return Math.random()*100<this.resonateRatio?s:!1}get resonateRatio(){let e=this.feed.PS_resonateRatio,t=this.feed.ESG_resonateRatio;return e||t||100}get titleBarDisplayMode(){let e=this.feed.hasOwnProperty("PS_titleBar"),t=this.feed.PS_titleBar??null,n=this.feed.ESG_noTitle,i;switch(n){case"YES":i="disabled";break;case"NO":i="always";break;case"onHover":i="onHover";break;default:i=null;break}let s=e?t:i;return this.isAmp?"onHover":s==="onHover"&&(!this.isNewUI||this.isBarker)?"always":s}get hideTitleBar(){let e=this.titleBarDisplayMode,t=this.isRedTheme;switch(e){case"always":case"onHover":return!1;case"disabled":return!0;default:return t}}get skin(){let e=this.feed.hasOwnProperty("PS_skin"),t=this.feed.PS_skin,n=this.playerType==="BARKER"?"barker":"standard";return e?t:n}get theme(){let e=this.feed.hasOwnProperty("PS_theme"),t=this.feed.PS_theme??"standard",n=this.feed.ESG_skin??"standard";return(n.includes("usatoday")||n.includes("s2n_light"))&&(n="red"),e?t:n}get isRedTheme(){return this.theme==="red"}get titlePrepend(){let e=this.feed.hasOwnProperty("PS_titleText"),t=this.feed.PS_titleText??"",n=this.feed.ESG_titlePrepend??"",i=e?t:n,s=this.adActive;return i.length&&s?`Up Next - ${i}`:s?"Up Next":i}get hasNoTitlePrepend(){return this.titlePrepend.length===0}get configuredPauseWhenPageHidden(){let e=this.feed.hasOwnProperty("PS_hiddenBehaviour"),t=this.feed.PS_hiddenBehaviour,n=this.feed.ESG_pauseWhenHidden??"standard";switch(n){case"YES":n="pause";break;case"STATIC":n="static";break;case"skip":n="skip";break;default:n="standard";break}return e?t:n}get pauseWhenPageHiddenStatic(){return this.configuredPauseWhenPageHidden==="static"}get pauseWhenPageHiddenSkipNext(){return this.configuredPauseWhenPageHidden==="skip"}get videosToPlayWhilePageHidden(){let e=this.feed.hasOwnProperty("PS_maxHiddenVideoPlays"),t=this.feed.PS_maxHiddenVideoPlays,n=Rt(this.feed.ESG_videosToPlayWhileHidden),i=e?t:n,s=this.configuredPauseWhenPageHidden==="pause",a=parseInt(i,10),o=s?a:-1;return isNaN(o)||o<-1?0:o}get muteIcon(){let e=this.feed.hasOwnProperty("PS_muteIcon"),t=!!this.feed.PS_muteIcon,n=this.feed.ESG_showUnmuteIcon!=="NO",i=e?t:n,s=this.isClickToPlay,a=!!this.stnEngage?.enabled;return s||a?!1:i}get initialQuality(){let e=this.feed.hasOwnProperty("PS_initialQuality"),t=this.feed.PS_initialQuality??"LOW",n=this.feed.ESG_initialQuality??"LOW";return e?t:n}get wrapperEnabled(){let e=this.feed.hasOwnProperty("PS_wrapper"),t=this.feed.PS_wrapper,n=t==="both"||t==="fixed",i=t==="both"||t==="float",s=this.feed.ESG_headerShowFixed==="YES",a=this.feed.ESG_headerShowFloated==="YES";return{fixed:e?n:s,float:e?i:a}}get floatWrapperEnabled(){return this.wrapperEnabled.float}get fixedWrapperEnabled(){return this.wrapperEnabled.fixed}get wrapperCSS(){let e=this.feed.hasOwnProperty("PS_wrapperCSS"),t=this.feed.PS_wrapperCSS??"",n=this.feed.ESG_headerCSS??"";return e?t:n}get wrapperText(){let e=this.feed.hasOwnProperty("PS_wrapperText"),t=this.feed.PS_wrapperText??"",n=this.feed.ESG_headerText??"";return e?t:n}get ui(){let e=this.feed.hasOwnProperty("PS_ui"),t=this.feed.PS_ui??"",n=this.feed.ESG_ui??"";return e?t:n}get isNewUI(){return this.ui==="newUI"}get stnLinkEnabled(){let e=this.feed.hasOwnProperty("PS_stnBranding"),t=this.feed.PS_stnBranding??"",n=this.feed.ESG_stnBranding??"";return(e?t:n)==="enabled"}get floatCloseBehaviour(){let e=this.feed.hasOwnProperty("PS_floatCloseBehaviour"),t=this.feed.PS_floatCloseBehaviour??"continue",n=this.feed.ESG_floatCloseBehaviour??"continue";return e?t:n}get mutationObserverControl(){let e=this.feed.hasOwnProperty("PS_mutationObs"),t=this.feed.PS_mutationObs??"enabled",n=this.feed.ESG_mutationObs??"enabled";return e?t:n}get useSafeAreaInsets(){let e=this.feed.hasOwnProperty("PS_useSafeAreaInsets"),t=!!this.feed.PS_useSafeAreaInsets,n=this.feed.ESG_useSafeAreaInsets==="YES";return e?t:n}get openvv(){let e=this.feed.hasOwnProperty("PS_openvv"),t=this.feed.PS_openvv==="enabled",n=this.feed.ESG_openvv==="enabled",i=e?t:n;return Object.keys(this.feed).length?i??!1:!1}get ampFloat(){let e=this.feed.hasOwnProperty("PS_ampFloat"),t=this.feed.PS_ampFloat===!0,n=this.feed.ESG_ampFloat==="YES";return e?t:n}get configuredAmpAlt(){let e=this.feed.hasOwnProperty("PS_ampAlt"),t=this.feed.PS_ampAlt,n=this.feed.ESG_ampAlt==="YES",i=e?t:n;return Object.keys(this.feed).length?i??!1:!1}get ampAlt(){let e=this.configuredAmpAlt,t=this.playlistType.toLowerCase()==="default",n=this.configuredAsSmartPlayer;return!this.isAmp||!e?!1:n?t:!0}get optimera(){let e=this.feed.hasOwnProperty("PS_optimera"),t=this.feed.PS_optimera==="enabled",n=this.feed.ESG_optimera==="enabled",i=e?t:n;return Object.keys(this.feed).length?i??!1:!1}get inhibitFloatOnClose(){let e=this.feed.hasOwnProperty("PS_inhibitFloatOnClose"),t=this.feed.PS_inhibitFloatOnClose??"NO",n=this.feed.ESG_inhibitFloatOnClose??"NO",i=e?t:n;return Object.keys(this.feed).length?i??!1:!1}get configuredRandomizePlaylistStart(){let e=this.feed.hasOwnProperty("PS_randomizePlaylistStart"),t=!!this.feed.PS_randomizePlaylistStart,n=this.feed.ESG_randomizePlaylistStart==="YES";return e?t:n}get configuredStnEngage(){let e=this.stnEngageFeed.hasOwnProperty("PS_stnEngage"),t=!!this.stnEngageFeed.PS_stnEngage,n=[];t&&(n=this.isMobile?["stay"]:["stay","next"]);let i=this.feed.ESG_nextStay==="YES"?["stay","next"]:[],s=this.feed.ESG_nextStayMobile==="YES"?["stay"]:[],a=this.isMobile?s:i,o=e?n:a;return Object.keys(this.feed).length&&Object.keys(this.stnEngageFeed).length?o:null}get configuredStnEngageLocation(){let e=this.stnEngageFeed.hasOwnProperty("PS_stnEngageLocation"),t=this.stnEngageFeed.PS_stnEngageLocation,n=this.isMobile?"bottom":"right",i=this.configurableActiveTimeOverride.hasOwnProperty("PS_stnEngageLocation"),s=this.configurableActiveTimeOverride.PS_stnEngageLocation;return{feed:e?t:n,override:i?s:n}}get configuredStnEngageTimeBeforeButtonsShow(){let e=Gr.call(this,"PS_stnEngageTimeBeforeButtonsShown","ESG_nextStayTimeBeforeButtonsShown",15);return e.feed=Qn(e.feed,1,30),e.override=Qn(e.override,1,30),Object.keys(this.feed).length&&Object.keys(this.stnEngageFeed).length?e:null}get configuredStnEngageCountdownTime(){let e=Gr.call(this,"PS_stnEngageCountDownTime","ESG_nextStayCountDownTime",5);return e.feed=Qn(e.feed,3,10),e.override=Qn(e.override,3,10),Object.keys(this.feed).length&&Object.keys(this.stnEngageFeed).length?e:null}get configuredStnEngageMinVideoLength(){let e=Gr.call(this,"PS_stnEngageMinVideoLength","ESG_nextStayMinVideoLength",30);return e.override=e.override??e.feed,Object.keys(this.feed).length&&Object.keys(this.stnEngageFeed).length?e:null}get configuredStnEngageStayClickMidrollBehaviour(){let e=Gr.call(this,"PS_stnEngageStayClickMidrollBehaviour","ESG_nextStayStayClickMidrollBehaviour","remove");return e.override=e.override??e.feed,Object.keys(this.feed).length&&Object.keys(this.stnEngageFeed).length?e:null}get aiMetaCapture(){let e=this.feed.hasOwnProperty("PS_aiMetaCapture"),t=!!this.feed.PS_aiMetaCapture,n=this.feed.ESG_aiMetaCapture==="YES",i=e?t:n;return Object.keys(this.feed).length?i:!1}get domainStatus(){return this.feed.DS??null}get stnEngage(){let e=this.configuredStnEngage,t=!!(e?.length??0)&&!this.isCurrentContentRecirc,n=this.configuredStnEngageTimeBeforeButtonsShow?.feed+this.configuredStnEngageCountdownTime?.feed,i=this.configuredStnEngageTimeBeforeButtonsShow?.override+this.configuredStnEngageCountdownTime?.override,s=isNaN(i)||n<=i?"feed":"override",a={enabled:t,location:this.configuredStnEngageLocation?.[s],buttonShowDelay:this.configuredStnEngageTimeBeforeButtonsShow?.[s],countdown:this.configuredStnEngageCountdownTime?.[s],minVideoLength:this.configuredStnEngageMinVideoLength?.[s],stayClickMidrollBehaviour:this.configuredStnEngageStayClickMidrollBehaviour?.[s],hasNextButton:t&&e?.includes?.("next"),hasStayButton:t&&e?.includes?.("stay"),source:s,useConfigurable:this.useConfigurableFeed,startTime:this.configurableActiveTimeOverride?.PSCC_startTime,endTime:this.configurableActiveTimeOverride?.PSCC_endTime};return ie&&(Ci("STN Engage Settings:",!0),console.table(a)),a}get doViewabilityLog(){return this.optionalLogEvents.includes("viewability")}get optionalLogEvents(){let e=this.feed.hasOwnProperty("PS_optionalLogEvents"),t=this.feed.PS_optionalLogEvents??[],n=JSON.parse(this.feed.ESG_optionalLogEvents??"[]");return e?t:n}get randomizePlaylistStart(){let e=this.configuredRandomizePlaylistStart;return this.playlistType.toLowerCase()==="smart"?!1:e}get hideSTNLink(){let e=this.adActive,t=this.isMediaGroupFloating||this.isAmpFloating,n=this.isBarker,i=this.isNewUI,s=this.playerSize;return!this.stnLinkEnabled||!i||e||n||t||s==="small"}get hasError(){return!!this.error}get clickableError(){return(this.error??"")?.toLowerCase?.()?.includes("click")??!1}userEngagedPlayer(){let e=this.isMiniFloatActive;this.playerClicked={value:!0},this.floatClosing||(this.userEngaged=!0,this.hasEverBeenEngaged=!0,this.floatClosed=e,this.miniClosed=this.miniFloat===!1)}userClosedFloat(){let e=this.isMiniFloatActive||this.miniClosed;this.userEngaged=!e,this.floatClosing=!0,setTimeout(j(()=>{this.floatClosing=!1,this.floatClosed=!0,this.miniClosed=e}),1e3)}userMaximizedFloat(){this.floatClosed=!1,this.miniClosed=!1}resetGlobal(){Ee.lastVisible=[],Ee.onLoadPushed=!1,Ee.onScrollPushed=!1}};function Wc(r){this.waitForEngagementLoggingToFinish=this.hasEngagementLogging,Q(()=>!this.waitForEngagementLoggingToFinish,()=>{this._selectedPlaylistItem=r})}function mg(r){return r.startsWith("CC_")}function pg(r){let e=r.slice("CC_".length);return!!e[2]&&(e[2]="-"),e.toLowerCase()}function gg(r,e){let t=document.createElement("a");return t.href=r.configuration.sources.src,t.pathname=e,t.href}function Rt(r,e=null){return Number.isFinite(r)?r:typeof r!="string"?e:Number(r)}function Kc(r){let e=this.pxScrolled;if(!r)return null;let t=r?.[0]??0;for(let[n,i]of Object.entries(r))if(e>=n)t=i;else break;return t}function vg(r,e){return Math.floor(Math.random()*e)+r}function yg(r,e){return e=e%r.length,r.slice(e,r.length).concat(r.slice(0,e))}function qc(r){return this.randomFirstIdx===null?[]:yg(r,this.randomFirstIdx).filter(n=>(n.loadFail??0)<=hg)}function Gr(r,e,t){let n=this.stnEngageFeed.hasOwnProperty(r),i=this.stnEngageFeed[r],s=this.feed[e]??t,a=this.configurableActiveTimeOverride.hasOwnProperty(r),o=this.configurableActiveTimeOverride[r],l=this.configurableActiveTimeOverride[e];return{feed:n?i:s,override:a?o:l}}var zc=`/* setup css reset for shadow dom inheritable properties */
:host > *
{
    color: initial;
    cursor: initial;
    font-family: 'Open Sans', sans-serif;
    font-size: initial;
    font-style: initial;
    font-variant: initial;
    font-weight: initial;
    letter-spacing: initial;
    line-height: initial;
    list-style: initial;
    text-align: initial;
    text-indent: initial;
    text-transform: initial;
    visibility: initial;
    white-space: initial;
    word-spacing: initial;

    /* In Safari on iOS when you tap a button a dark highlight surrounds the button */
    /* Setting this CSS style disables that highlight, since we don't want it on */
    /* our player. */
    -webkit-tap-highlight-color: transparent;
}

:host {
    display: block;
    --fontSize: 12px;

    overflow: hidden;
}

.player {
    display: flex;
    flex-direction: column;
    position: relative;
    border-radius: var(--contentBorderRadius);
}

.player[layout="barker"] {
    padding: var(--barkerPadding);
    background: var(--playerBackground);
}

.titleBar:not(.onHover) {
    display: flex;
    align-items: center;
    height: var(--titleBarHeight);
    background: var(--titleBarBackground);
    color: var(--titleBarColor);
    white-space: nowrap;
    font-size: 12px;
}

.titleBar.onHover {
    background: rgba(0, 0, 0, 0.2);
    color: var(--titleBarColor);
    font-size: 12px;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    width: 100%;
    padding: 0.5em 1em 0.5em 1em;
    box-sizing: border-box;
    pointer-events: none;

    transition: opacity 300ms;
}

.titleBar.onHover:not(.hovered) {
    opacity: 0;
}

.titleBar {
    border-radius: var(--titleBarBorderRadius);
    overflow: hidden;
}

.titleBar:not(.onHover) .title
{
    flex-grow: 1;
    line-height: var(--titleBarHeight);
    font-weight: 700;
    margin-left: 0.5em;
    position: relative;
    height: 100%;
}

.title img
{
    height: 1em;
    vertical-align: middle;
}

.title img[src]:not(img[src=""])
{
    margin-right: 0.5em;
}

.player:not(.miniActive) .titleBar:not(.onHover) .title span
{
    overflow: hidden;
    text-overflow: ellipsis;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.titleBar.onHover .title
{
    font-weight: 700;

    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-inline-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

@media (max-width: 450px)
{

    .titleBar.onHover .title
    {
        -webkit-line-clamp: 1;
    }
}

.player.floating.miniActive .floatContainer .titleBar .title
{
    --lines: 2;
    --lineHeight: 1.4em;

    grid-area: title;

    line-height: var(--lineHeight);
    height: calc(var(--lineHeight) * var(--lines));
    margin: var(--miniFloatTitleMargins);
    overflow: hidden;
    text-overflow: ellipsis;

    -webkit-line-clamp: var(--lines);
    -webkit-box-orient: vertical;
    display: -webkit-box;
    align-self: flex-start;
    flex-grow: initial;
}

.titleBar img
{
    height: 100%;
    border-right: 1px solid white;
}

.titleBar.onHover img
{
    height: 1.2em;
}

.player.miniActive .floatContainer .titleBar img
{
    grid-area: img;
    border: none;
    margin-left: 2ch;
}

.titleBar img:not(.hasTitleFrontImage),
.player.miniActive .hasTitleFrontImage
{
    display: none;
}

@media (max-width: 450px)
{
    .player:not(.newUI) .playlistContainer
    {
        width: 100% !important;
    }

    .overlayContainer
    {
        display: none;
    }
}

.player:not([layout="barker"i]) .playlistContainer
{
    position:absolute;
    width: 50%;
    height: 100%;
    top: 0;
    right: 0;
    border: none;

    /* To make sure that the mute button never shows over the playlist container */
    z-index: 1;
}

.playlistContainer
{
    flex-grow: 1;
    height: var(--barkerMediaGroupContainerHeight);
    /*overflow: hidden;*/

    /* Fixes issue where playlist takes up more space than it should */
    width: 0;

    border: 1px solid rgb(219, 219, 219);
    position: inherit;

    /* No pointer events on the playlist container so that the control bar will */
    /* display when you hover over the right side of the player */
    pointer-events: none;
}

.overlayContainer,
.playlistContainer
{
    /* Container blocks the player, causing a drop in viewability, so hide it */
    visibility: hidden;
}

.overlayContainer > *,
.playlistContainer > *
{
    /* Children are visible though */
    visibility: visible;
}

.player:not([layout="barker"i]):not(.newUI):not(.adActive).paused.hasStarted .playlistWrapper
{
    left: 0;
}

.player:not([layout="barker"i]) .playlistWrapper
{
    left: 100%;
}

.playlistWrapper
{
    transition: left 0.5s ease 0s;
    position: absolute;
    width: 100%;
    height: 100%;
    background: var(--panelBackground);

    /* Pointer events on the playlist wrapper so that we are able to click on */
    /* playlist items, and hovering over doesn't activate the control bar */
    pointer-events: auto;
}

/* Block out the playlist when an ad is playing */
.player.adActive .playlistWrapper::before
{
    display: block;
    background: rgba(204, 204, 204, 0.7);
    z-index: 10000;
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    cursor: not-allowed;
}

.player[layout="barker"i] .playlistContainer {
    margin-left: var(--barkerPadding);
    font-size: var(--fontSize);
}

.playlist
{
    background: var(--panelBackground);
    min-height: 100%;
}

/* If the vertical scrollbar is hidden, then don't use a margin because there is no */
/* scrollbar we have to get out of the way of */
.playlistWrapper.os-host-scrollbar-vertical-hidden .playlist .item
{
    margin-right: 0;
}

.playlist .item
{
    border-left: 4px solid transparent;
    cursor: pointer;
    font-size: var(--fontSize);
    padding: 0.5em;

    /* It looks like detection of scrollbar width doesn't work inside a shadow dom */
    /* because I keep getting a 30px border on the content wrapper. This will be */
    /* used to counteract that. */
    margin-right: calc(19px - var(--nativeScrollbarWidth));
}

.player[layout="barker"i] .playlist .item:hover .title
{
    color: var(--hoveredPlaylistItemTitleColor);
}

.player:not([layout="barker"i]) .playlist .item
{
    display: grid;
    grid-template-columns: auto 1fr;
    grid-template-rows: auto 1fr;
    height: 55px;
}

.player[layout="barker"i] .playlist .item.active
{
    border-left-color: var(--barkerSelectedPlaylistItemLeftBorderColor);
    background: var(--barkerSelectedPlaylistItemBackgroundColor)
}

.player:not([layout="barker"i]) .playlist .item.active
{
    border-left-color: var(--selectedPlaylistItemLeftBorderColor);
    background: var(--selectedPlaylistItemBackgroundColor);
}

.playlist .item:not(:last-child)
{
    border-bottom: 1px solid rgb(219, 219, 219);
}

.playlist .item .title
{
    display: block;
    grid-area: 1 / 2 / auto / auto;
    max-height: 3.5em;
    line-height: 1.2em;
    overflow: hidden;
}

.playlist .item .detail
{
    font-size: calc(var(--fontSize) * (5/6));
    color: rgb(165, 165, 165);
    grid-area: 2 / 2 / auto / auto;
    overflow: hidden;
}

.playlist .item .detail *
{
    display: inline-block;
}

.player[layout="barker"i] .playlist .thumbnail
{
    display: none;
}

.playlist .thumbnail
{
    margin-right: 0.5em;
    grid-area: 1 / 1 / 3 / auto;
    display: grid;
    grid-template-rows: 1fr auto;
    grid-template-columns: 1fr auto;
}

.playlist .thumbnail .poster
{
    display: block;
    grid-area: 1 / 1 / 3 / 3;
    height: 55px;
    width: 99px;
}

.menuButton
{
    background: var(--menuButtonBackground);
    color: var(--menuButtonColor);
    line-height: 100%;
    font-family: 'Material Icons', sans-serif;
    cursor: pointer;
    user-select: none;
}

.adActive .menuButton,
.newUI .menuButton
{
    display: none;
}

.player[playlist="smart"i] .menuButton
{
    background: var(--smartMenuButtonBackground);
    color: var(--smartMenuButtonColor);
}

.player.floating .menuButton,
.player[layout="barker"i] .menuButton,
.player .titleBar.onHover .menuButton
{
    display: none;
}

.content {
    flex-grow: 1;
    display: flex;
    position: relative;
    border-radius: var(--contentBorderRadius);
}

.player[layout="barker"i] .titleBar {
    margin-bottom: var(--barkerTitleMargin);
}

.player:not(.floating) .titleBar.hide {
    display: none;
}

.mediaGroupContainer {
    background: var(--panelBackground);
    position: relative;
    width: 100%;
    border-radius: var(--contentBorderRadius);
}

.player[layout="barker"i] .mediaGroupContainer {
    width: var(--barkerMediaGroupContainerWidth);
}

.mediaGroupContainer > .placeholder::before {
    display: block;
    content: '';
    padding-bottom: calc(100% / 16 * 9);
}

.floatContainer
{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    border-radius: var(--contentBorderRadius);
    overflow: hidden;
}

.floatContainer::before
{
    display: block;
    content: '';
    float: left;
    padding-bottom: calc(100% / 16 * 9);
}

.player.floating.miniActive .floatContainer::before
{
    display: none;
}

.floatContainer > .titleBar,
.floatContainer > .titleBar .material-icons
{
    display: none;
}

.player.floating .floatContainer {
    position: fixed;
    top: var(--floatTop);
    left: var(--floatLeft);
    bottom: var(--floatBottom);
    right: var(--floatRight);
    width: var(--floatWidth);
    transform: var(--floatTransform);
    height: initial;
    max-width: max(calc(100% - 2 * var(--floatMarginX)),60%);
    z-index: var(--floatZIndex);
}

.player.floating.miniActive .floatContainer {
    display: grid;
    grid-template-areas: "header header"
                         "media  titleBar";
    grid-template-columns: clamp(115px, 45%, 200px) 1fr;
    border-width: 0px;
    border-bottom: 5px solid;
    max-width: 100vw;
}

.player.floating:not(.floatClosing) .titleBar .material-icons
{
    background: #333;
    background: var(--titleBarButtonsBackground);
    cursor: pointer;
    font-size: calc(var(--titleBarHeight) - 10px);
    padding: 2px;
    margin: 3px;
    border-radius: 100%;
}

.player.floating:not(.floatClosing) .titleBar .floatClose
{
    display: block;
}

.player.floating.miniActive:not(.floatClosing) .titleBar .floatClose
{
    display: block;
    grid-area: close;
    background: none;
    justify-self: end;
}

.player.floating.miniActive.miniOnClose:not(.floatClosing) .titleBar .floatMaximize
{
    display: block;
    grid-area: maximize;
    background: none;
    justify-self: end;
}

.player.floating.miniActive.miniOnClose:not(.floatClosing).newUI .titleBar .floatMaximize,
.player.floating.miniActive:not(.floatClosing).newUI .titleBar .floatClose
{
    margin: var(--miniFloatTitleButtonMargins);
    background: var(--miniTitleBarButtonsBackground);
    color: var(--miniTitleBarButtonsColor);
}

.player.floating .floatClosingNotify
{
    font-size: var(--fontSize);
    padding: 0.5em;
    display: none;
}

.player.floatClosing .floatClosingNotify
{
    display: block;
}

.player.miniActive.floatClosing .floatClosingNotify
{
    grid-area: close;
    display: block;
}

.player.floating .titleBar .material-icons:hover
{
    background: var(--titleBarButtonsBackgroundHover);
}

.player.floating .floatContainer::before
{
    margin-top: var(--titleBarHeight);
}

.player.floating .floatContainer .titleBar
{
    display: flex;
    margin: 0;
}

.player .floatHeader,
.player .miniFloatHeader
{
    display: none
}

.player.floating.miniActive .floatContainer .titleBar
{
    grid-area: titleBar;

    display: grid;
    grid-template-areas: var(--miniFloatTitleTemplate);
    grid-template-columns: 1fr fit-content(0%) max-content;
    grid-template-rows: var(--miniFloatTitleTemplateRows);

    height: 100%;

    background: var(--miniTitleBarBackground);
    color: var(--miniTitleBarColor);

    line-height: normal;
    white-space: unset;
}

.player.floating:not(.miniActive) .floatHeader,
.player.floating.miniActive .miniFloatHeader
{
    display: block;
    width: 100%;
}

.player.floating.miniActive .miniFloatHeader
{
    grid-area: header;
}

.miniFloatHeader, .floatHeader, .floatContainer .titleBar
{
    z-index: 2;
    position: relative;
}

.player.floating.miniActive .floatContainer stn-media
{
    aspect-ratio: 16/9;
    grid-area: media;
}

stn-media {
    display: block;
    background: #333;
}

stn-media:fullscreen {
    background: black;
}

stn-media::before
{
    /*display: block;*/
    content: "";
    width: 100%;
    padding-bottom: calc(100% / 16 * 9);
}

.stnError
{
    background: #222;
    color: #DDD;
    display: none;
    align-items: center;
    justify-content: center;
    white-space: pre-wrap;
    padding: 1em;
    font-family: sans-serif;
    box-sizing: border-box !important;
    text-align: center;
    overflow: hidden;
    flex-direction: column;
}

.stnError.clickable
{
    cursor: pointer;
}

.stnError.show
{
    display: flex;
}

.player[layout="barker"i].adActive .upNext
{
    display: block;
}

.upNext
{
    display: none;

    background: var(--upNextBannerBackground);
    box-sizing: border-box;
    color: var(--upNextBannerColor);
    font-size: 14px;
    left: 0;
    overflow: hidden;
    padding: 0.5em;
    position: absolute;
    text-align: center;
    text-overflow: ellipsis;
    top: 50%;
    transform: translateY(-50%);
    white-space: nowrap;
    width: 100%;
    z-index: 10001;
    cursor: not-allowed;
}

.player[layout="barker"i] .overlay
{
    display: none;
}

.player:not([layout="barker"i]):not(.adActive).paused.hasStarted .overlay
{
    right: 0;
}

.player:not([layout="barker"i]) .overlay
{
    right: 100%;
}

.overlayContainer
{
    overflow: hidden;
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 50%;

    /* No pointer events on the overlay container so that the control bar will */
    /* display when you hover over the right side of the player */
    pointer-events: none;
}

.overlayContainer .overlay
{
    position: absolute;
    top: 0;
    right: 100%;
    bottom: auto;
    left: auto;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.75);
    color: rgb(255, 255, 255);
    transition: right 0.5s ease 0s;
    z-index: 2;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    cursor: pointer;

    /* Overlay has pointer events so that hovering over the overlay doesn't trigger */
    /* the control bar to display */
    pointer-events: auto;
}

.overlayContainer .overlay > *
{
    padding: 0.5em 0.5em 0;
}

.overlayContainer .overlay .posterContainer
{
    padding-top: calc(100% / 16 * 9);
    position: relative;
}

.overlayContainer .overlay .posterContainer .poster
{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.poster
{
    background-size: cover;
}

.poster img
{
    height: 100%;
    width: 100%;
}

.overlayContainer .overlay .title
{
    font-size: 14px;
    font-weight: bolder;
    overflow: hidden;
}

.overlayContainer .overlay .title > *
{
    height: 1em;
    vertical-align: middle;
}

.overlayContainer .overlay .detail
{
    overflow: hidden;
    font-size: 11px;
    flex: 1 1 0;
}

.hide
{
    display: none !important;
}

/* NEW UI */

.player.newUI .overlayContainer
{
    display: none;
}


.player:not([layout="barker"i]).newUI:not(.adActive).paused.hasStarted .playlistContainer *
{
    pointer-events: unset;
}

.player:not([layout="barker"i]).newUI:not(.adActive).paused.hasStarted .playlistContainer
{
    pointer-events: unset;
    opacity: 100;
}

.player:not([layout="barker"i]).newUI .playlistContainer *
{
    pointer-events: none;
}

.player:not([layout="barker"i]).newUI .playlistContainer
{
    --xEdges: 17px;
    --height: 37.5%;

    user-select: none;

    /* TODO: Transition doesn't work, when resizing a barker player to a full */
    /* transition: opacity 300ms; */

    opacity: 0;

    left: var(--xEdges);
    width: calc(100% - (2 * var(--xEdges)));
    height: var(--height);
    min-height: var(--playlistContainerMinHeight);
    top: 50%;
    transform: translate(0, -50%);

    pointer-events: none;

    background: rgba(0,0,0, 0.7);

    display: flex;
    flex-direction: column;
    padding: 2%;
    box-sizing: border-box;
}

.player:not([layout="barker"i]).newUI .playlistWrapper
{
    transition: none;
    height: 50%;
    background: none;
    position: relative;
    flex-grow: 2;
    left: 0;
}

.player:not([layout="barker"i]).newUI .playlist
{
    display: inline-block;

    width: 100%;
    height: 100%;
    white-space: nowrap;
    overflow: hidden;
    background: transparent;
}

.player:not([layout="barker"i]).newUI .playlist .item
{
    display: inline-block;

    padding: 0;
    margin: 0;
    border: 2px solid transparent;
    height: 100%;
    position: relative;
    /* margin-right: 15px; */
    margin-right: 2%;
    overflow: hidden;
    white-space: normal;
    border-radius: 6px;
    box-sizing: border-box;
    aspect-ratio: calc(16/9);
}

.player:not([layout="barker"i]).newUI .playlist .item:last-child
{
    margin-right: 0;
}

.player:not([layout="barker"i]).newUI .playlist .item:hover
{
    border-color: white;
}

.player:not([layout="barker"i]).newUI .playlist .item.active
{
    background: none;
}

.player:not([layout="barker"i]).newUI .playlist .thumbnail
{
    height: 100%;
    width: 100%;
}

.player:not([layout="barker"i]).newUI .playlist .thumbnail .poster
{
    height: 100%;
    width: 100%;
}

.player:not([layout="barker"i]).newUI .playlist .item .title
{
    position: absolute;
    top: 0;
    left: 0;
}

.player:not([layout="barker"i]).newUI .playlist .item .detail
{
    position: absolute;
    bottom: 0;
    right: 0;
}

.player:not([layout="barker"i]).newUI .playlist .item .company
{
    display: none;
}

.player:not([layout="barker"i]).newUI .playlist .item .title,
.player:not([layout="barker"i]).newUI .playlist .item .detail .time
{
    color: white;
    background: rgba(0,0,0,0.5);
    padding: 1px 3px 1px 3px;
    font-size: xx-small;
}

.player:not([layout="barker"i]).newUI .playlist .item .title
{
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    display: -webkit-box;
    text-overflow: ellipsis;
    overflow: hidden;
}

.player:not(.newUI) .playlistWrapper .playlistChevron,
.player[layout="barker"i] .playlistWrapper .playlistChevron
{
    display: none;
}

.player:not([layout="barker"i]).newUI .playlistWrapper .playlistChevron
{
    position: absolute;
    font-size: 20px;
    top: 50%;
    color: grey;
    /* text-shadow: 0 -1px 1px #000, 0 1px 1px #000, -1px 0 1px #000, 1px 0 1px #000; */
    cursor: pointer;
    border-radius: 100%;
    border: 1px solid silver;
    background: rgba(255,255,255,0.7);
}

.player:not([layout="barker"i]).newUI .playlistWrapper .playlistChevron:hover
{
    background: rgba(255,255,255,0.8);
    font-size: 22px;
}

.player:not([layout="barker"i]).newUI .playlistWrapper .playlistChevron.left
{
    left: 0;
    padding: 0.4em 0.5em 0.4em 0.3em;
    transform: translate(-66%, -50%);
}

.player:not([layout="barker"i]).newUI .playlistWrapper .playlistChevron.right
{
    right: 0;
    padding: 0.4em 0.3em 0.4em 0.5em;
    transform: translate(66%, -50%);
}

.player[layout="barker"i] .playlistContainer .prepend,
.player:not([layout="barker"i]):not(.newUI) .playlistContainer .prepend
{
    display: none;
}

.player:not([layout="barker"i]).newUI .playlistContainer .prepend
{
    color: white;
    text-transform: uppercase;
    font-size: large;
    flex-grow: 1;

    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.player:not([layout="barker"i]).newUI .playlistContainer .upNext
{
    display: none;
}
`;var Yc=`<slot name="header" class='\${isAmp:hide}'></slot>
<div class="player \${isMediaGroupReallyFloating:floating} \${ui} \${isMiniFloatActive:miniActive} \${miniType} \${floatClosing} \${adActive} \${paused} \${hasStarted} \${hasError:hide}" layout="\${playerLayout}" playlist="\${playlistType}">
    <div class="titleBar \${titleBarDisplayMode} \${hideTitleBar:hide}">
        <img class='\${hasTitleFrontImage}' $src='\${titleFrontImage}'>
        <span class="title"><span>\${title}</span></span>
        <span class="menuButton material-icons">menu</span>
    </div>
    <div class="content">
        <div class="mediaGroupContainer">
            <div class="placeholder"></div>
            <div class="floatContainer">
                <slot name=floatHeader class="floatHeader \${isAmp:hide}"></slot>
                <slot name=miniFloatHeader class="miniFloatHeader \${isAmp:hide}"></slot>
                <div class="titleBar">
                    <img class='\${hasTitleFrontImage}' $src='\${titleFrontImage}'>
                    <span class="title"><span>\${title}</span></span>
                    <span class="floatClosingNotify">\${closingOrMinimizing}</span>
                    <span class="floatMaximize material-icons">open_in_full</span>
                    <span class="floatClose material-icons">\${closeOrMinimize}</span>
                </div>
                <stn-media><slot name="imaHost"></slot></stn-media>
            </div>
        </div>
        <div class="overlayContainer">
            <div class="overlay">
                <div class='posterContainer'>
                    <div class="poster">
                        <img crossorigin="anonymous" $src="\${poster}">
                        <stn-play-button></stn-play-button>
                    </div>
                </div>
                <div class='title'>
                    <span>\${title}</span>
                </div>
                <div class='detail'>
                    <span>\${shortSummary}</span>
                </div>
            </div>
        </div>
        <div class="playlistContainer">
            <div class='prepend \${hasNoTitlePrepend:hide}'>\${titlePrepend}</div>
            <div class="playlistWrapper">
                <div class="playlist" foreach="item,i of playlist">
                    <div class="item \${item.isActive:active}" data-item="\${i}">
                        <div class="thumbnail">
                            <img class="poster" crossorigin="anonymous" $src="\${item.thumbnailUrl}" loading="lazy">
                        </div>
                        <div class='title'><img $src="\${item.titleImg}">\${item.titleText}</div>
                        <div class='detail'>
                            <div class='company'>\${item.S_category} |</div> <div class='time'>\${item.duration}</div>
                        </div>
                    </div>
                </div>
                <div class='material-icons playlistChevron left'>arrow_back_ios_new</div>
                <div class='material-icons playlistChevron right'>arrow_forward_ios</div>
            </div>
            <div class='upNext'>\${title}</div>
        </div>
    </div>
</div>
<div class='stnError \${clickableError:clickable} \${hasError:show}'>
    <p>\${error}</p>
</div>
<slot name="footer" class='\${isAmp:hide}'></slot>
`;var Xc=`:host
{
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    position: absolute;
    pointer-events: none;
}

:host button
{
    position: absolute;
    width: 8%;
    aspect-ratio: 1;

    min-width: 48px;
    min-height: 48px;
    max-width: 120px;
    max-height: 120px;

    border: 0;
    border-radius: 14px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: var(--bigPlayButtonBackground);

    font-family: 'material icons';
    font-size: 3em;
    color: white;

    display: flex;
    justify-content: center;
    align-items: center;
}

:host(.newUI) button
{
    border-radius: 100vw;
}

:host button svg
{
    width: 80%;
    height: 80%;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
}

:host(.newUI) button svg
{
    width: 60%;
    height: 60%;
    transform: translate(-44%, -50%);
}

:host button svg path
{
    fill: var(--bigPlayButtonColor);
}
`;var Qc=`<button>%{contents}</button>
`;var Jc=oe(Symbol("StnPlayButton")),Zc=document.createElement("template");Zc.innerHTML=`<style>
${Xc}</style>${Qc}
`;var bg="stn-play-button",eu=class extends ke{constructor(){super();let e=new class{constructor(){k(this,"useLogoForPlay",!0)}get contents(){return this.useLogoForPlay?Qt:"play_arrow"}};ye(e),Object.freeze(e);let t=this.attachShadow({mode:Re?"open":"closed"}),n=$e(Zc.content.cloneNode(!0),e);t.append(...St(),n),Jc(this,{shadow:t,model:e})}hide(){this.style.display="none"}show(){this.style.display=""}set useLogoForPlay(e){Jc(this).model.useLogoForPlay=e}};customElements.define(bg,eu);var tu="";var nu=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"muted"),iu=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"volume"),ru=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"play"),sa=new WeakMap,Oi=class{constructor(e,t){let n=this,i={element:e,volume:1,muted:!0},s=!1;sa.set(this,i),e.tagName!=="VIDEO"&&e.shadowRoot&&(e=e.shadowRoot.querySelector("video"));try{let a=function(){!e.paused&&!e.muted&&(t.removeEventListener("stnGesture",o),e.removeEventListener("play",a),e.removeEventListener("volumechange",a))},o=function(){e.paused?(n.muted=!e.muted,n.muted=!e.muted):e.play(),s&&(e.paused?(n.muted=!e.muted,s=!1):(n.muted=!e.muted,e.paused&&e.play()))};if(e?.tagName!=="VIDEO")throw new Error("Element is not a VIDEO element");t.addEventListener("stnGesture",o),e.addEventListener("play",a),e.addEventListener("volumechange",a),Object.defineProperties(e,{muted:{get:function(){return nu.get.call(this)},set:function(l){l=i.muted;let c=e.paused;nu.set.call(this,l),!c&&e.paused&&(n.muted=!0,e.play(),s=!0)}},volume:{get:function(){return iu.get.call(this)},set:function(l){l=i.volume,iu.set.call(this,l)}},play:{value:function(){let c=ru.value.call(this);return c.catch(()=>i.muted?c:(n.muted=!0,s=!0,ru.value.call(this)))}}})}catch(a){console.warn(`While attempting to install a synchronous volume control in element
%o
The following error occurred:
%o
Asynchronous control is still in effect`,e,a)}e.addEventListener("volumechange",()=>{e.muted!==i.muted&&(e.muted=i.muted),e.volume!==i.volume&&(e.volume=i.volume)})}set muted(e){let t=sa.get(this);t.muted=e,t.element.muted=e,t.element.defaultMuted=e}set volume(e){let t=sa.get(this);t.volume=e,t.element.volume=e}};var su=`:host
{
    display: block;
    padding-top: calc(100% / 16 * 9);
    position: relative;
    cursor: pointer;
}

:host(.mediaIsFullscreen)
{
    padding: 0;
    height: 100%;
}

:host > *
{
    pointer-events: none;
}

video
{
    display: block;
    position:absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: black;
    border-radius: var(--contentBorderRadius);
}

.subtitleContainer
{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: center;
}

.subtitleContainer > *
{
    color: var(--subtitleCueColor);
    background-color: var(--subtitleCueBackgroundColor);
    font-size: var(--subtitleCueFontSize);
    width: fit-content;
    max-width: 80%;
    border-radius: 8px;
    text-align: center;
    padding: 0.25em 1ch;
    margin-bottom: 0.5em;

    /* Sometimes without this the subtitles aren't visible */
    /* Particularly when seeking to a spot in the video that doesn't have subtitles */
    z-index: 0;
}

/* Keep the subtitles above the height of the controlbar */
.subtitleContainer.controlbarActive > *:last-child
{
    margin-bottom: calc(var(--controlbarHeight) + 0.5em);
}

.subtitleContainer > *:last-child
{
    transition: margin-bottom 300ms;
}

.disabled
{
    display: none;
}
`;var au=`<video></video>
<div class="subtitleContainer \${controlbarActive} \${subtitlesDisabled:disabled}" foreach="cue,i of activeCues">
    <div data-idx='\${i}'>\${cue.text}</div>
</div>
`;var ou=document.createElement("template");ou.innerHTML=`<style>
${su}</style>
${au}`;var se,Tg="stn-video",Jn=class extends ke{constructor(){super();let e=new class{constructor(){k(this,"activeCues",[]);k(this,"activeQualityLevel",null);k(this,"activeSubtitle",null);k(this,"badContent",!1);k(this,"buffered",{});k(this,"browserPause",!0);k(this,"closestQuality","auto");k(this,"controlbarActive",!1);k(this,"currentTime",0);k(this,"datareadSubtitles",[]);k(this,"duration",NaN);k(this,"ended",!1);k(this,"error",null);k(this,"hasEverStarted",!1);k(this,"hasStarted",!1);k(this,"initialQuality",!1);k(this,"metadataLoaded",!1);k(this,"muted",!0);k(this,"pageGestureTarget",null);k(this,"paused",!0);k(this,"playPromise",Promise.resolve());k(this,"poster","");k(this,"qualityLevelRemoved",!1);k(this,"qualityLevels",[]);k(this,"quartile",null);k(this,"rawPaused",!0);k(this,"seeking",!1);k(this,"selectedQualityLevel","auto");k(this,"src",{content:""});k(this,"subtitlesDisabled",!1);k(this,"textTracks",[]);k(this,"videoHeight",0);k(this,"videoWidth",0);k(this,"volume",1);k(this,"waiting",!1)}get subtitles(){return this.textTracks.filter(o=>!!o.cues?.length)}};ye(e);let t=this.attachShadow({mode:Re?"open":"closed"}),n=$e(ou.content.cloneNode(!0),e);t.append(n);let i=t.querySelector("video");lu.call(e,i),se(this,{shadow:t,video:i,model:e}),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("playsinline",""),i.playsInline=!0,i.setAttribute("crossorigin","anonymous"),i.crossOrigin="anonymous",i.addEventListener("emptied",lu.bind(e,i)),i.addEventListener("durationchange",Ge.bind(e,i,["duration","videoWidth","videoHeight"])),i.addEventListener("error",Ge.bind(e,i,"error")),i.addEventListener("loadeddata",Ge.bind(e,i,["duration","videoWidth","videoHeight"])),i.addEventListener("loadedmetadata",Ge.bind(e,i,["duration","videoWidth","videoHeight"])),i.addEventListener("resize",Ge.bind(e,i,["duration","videoWidth","videoHeight"])),i.addEventListener("timeupdate",Ge.bind(e,i,"currentTime")),i.addEventListener("progress",Ge.bind(e,i,"buffered")),i.addEventListener("ended",Ge.bind(e,{ended:!0},"ended")),i.addEventListener("loadedmetadata",Ge.bind(e,{metadataLoaded:!0},"metadataLoaded")),i.addEventListener("loadstart",Ge.bind(e,{metadataLoaded:!1},"metadataLoaded")),i.addEventListener("pause",Ge.bind(e,{rawPaused:!0},"rawPaused")),i.addEventListener("playing",Ge.bind(e,{rawPaused:!1,waiting:!1},["rawPaused","waiting"])),i.addEventListener("seeked",Ge.bind(e,{seeking:!1},"seeking")),i.addEventListener("seeking",Ge.bind(e,{ended:!1,seeking:!0},["ended","seeking"])),i.addEventListener("waiting",Ge.bind(e,{waiting:!0},"waiting")),i.textTracks.addEventListener("addtrack",j(()=>e.textTracks=[...i.textTracks])),i.textTracks.addEventListener("removetrack",j(()=>e.textTracks=[...i.textTracks])),i.addEventListener("loadedmetadata",j(()=>e.textTracks=[...i.textTracks]));let s=j(a=>{e.activeCues=[...e.activeSubtitle.activeCues].reverse()});x(()=>e.textTracks,(a,o)=>{a.forEach(l=>{!o.includes(l)&&(l.mode="hidden")})}),x(()=>e.activeSubtitle,(a,o)=>{o&&o.removeEventListener("cuechange",s),L(()=>e.activeCues=[]),a&&(a.addEventListener("cuechange",s),s())}),x(()=>[e.currentTime,e.ended],([a,o])=>{let l=a/this.duration;l>=.25&&l<.5?L(()=>e.quartile=1):l>=.5&&l<.75?L(()=>e.quartile=2):l>=.75&&l<1?L(()=>e.quartile=3):l>=1||o?L(()=>e.quartile=4):L(()=>e.quartile=0)}),Q(()=>e.pageGestureTarget,()=>{let a=new Oi(i,e.pageGestureTarget);P(()=>a.muted=e.muted),P(()=>a.volume=e.volume)}),x(()=>e.src,()=>{e.hasStarted=!1}),x(()=>[e.paused,e.rawPaused],async([a,o],[l,c])=>{let u=a!==l,d=o!==c;if(a===o){a===!1&&(e.hasEverStarted=!0,e.hasStarted=!0);return}if(i.ended){L(()=>e.paused=e.rawPaused);return}try{let h;h=e.playPromise,await h}catch(h){}L(()=>e.browserPause=d?o:null),!d&&(a?i.pause():L(()=>e.playPromise=i.play()))}),x(()=>e.datareadSubtitles,a=>{Eg.call(this),a.forEach(o=>{let l=document.createElement("track");l.kind=o.kind,l.label=o.label,l.srclang=o.srclang,l.src=o.src,i.appendChild(l)})}),x(()=>[e.selectedQualityLevel,e.qualityLevels],([a,o])=>{if(a==="auto"){e.closestQuality="auto";return}if(!a){e.closestQuality=null;return}e.closestQuality=this.getQualityPriority(a)[0]}),ie&&Object.keys(e).forEach(a=>{P(()=>{console.log("Video Value: %o = %o",a,e[a])})})}get quartile(){return se(this).model.quartile}get currentTime(){return se(this).model.currentTime}set currentTime(e){let{model:t,video:n}=se(this);t.playPromise.finally(()=>n.currentTime=e)}get duration(){let{duration:e,buffered:t}=se(this).model;return e!==Infinity?e:t.end(t.length-1)}get paused(){return se(this).model.paused}get ended(){return se(this).model.ended}get error(){return se(this).model.error}get videoWidth(){return se(this).model.videoWidth}get videoHeight(){return se(this).model.videoHeight}get poster(){return se(this).model.poster}set poster(e){let{model:t,video:n}=se(this);L(()=>t.poster=n.poster=e)}get src(){return se(this).model.src}set src(e){L(()=>{let{video:t,model:n}=se(this);n.src=e,t.src=e.content})}get waiting(){return se(this).model.waiting}play(){let{model:e}=se(this);Q(()=>e.metadataLoaded,()=>{e.paused=!1})}get browserPause(){return se(this).model.browserPause}pause(){se(this).model.paused=!0}get playPromise(){return se(this).model.playPromise}get played(){return se(this).video.played}get volume(){return se(this).model.volume}set volume(e){se(this).model.volume=e}get muted(){return se(this).model.muted}set muted(e){se(this).model.muted=e}get seeking(){return se(this).model.seeking}get ready(){return!0}get qualityLevelRemoved(){return se(this).model.qualityLevelRemoved}set qualityLevelRemoved(e){L(()=>{let{model:t}=se(this);t.qualityLevelRemoved=e})}set pageGestureTarget(e){L(()=>se(this).model.pageGestureTarget=e)}set activeSubtitle(e){L(()=>se(this).model.activeSubtitle=e)}set subtitles(e){L(()=>se(this).model.datareadSubtitles=e)}get subtitles(){return se(this).model.subtitles}set controlbarActive(e){L(()=>se(this).model.controlbarActive=!!e)}set mediaIsFullscreen(e){this.classList.toggle("mediaIsFullscreen",e)}get qualityLevels(){return se(this).model.qualityLevels}get activeQualityLevel(){return se(this).model.activeQualityLevel}get selectedQualityLevel(){return se(this).model.selectedQualityLevel}set selectedQualityLevel(e){L(()=>se(this).model.selectedQualityLevel=e)}set initialQuality(e){L(()=>se(this).model.initialQuality=e)}endClip(){this.currentTime=this.duration}set subtitlesDisabled(e){se(this).model.subtitlesDisabled=!!e}get hasEverStarted(){return se(this).model.hasEverStarted}get hasStarted(){return se(this).model.hasStarted}get videoElement(){return se(this).video}get badContent(){return se(this).model.badContent}getQualityPriority(e){return se(this).model.qualityLevels.toSorted((t,n)=>t===e?-1:n===e?1:t>e&&n>e?t-n:t>e?-1:n>e?1:n-t)}};se=oe(Jn);var lu=j(function(){this.currentTime=0,this.duration=NaN,this.buffered={},this.paused=!0,this.rawPaused=!0,this.ended=!1,this.error=null,this.videoWidth=0,this.videoHeight=0,this.waiting=!1,this.metadataLoaded=!1}),Ge=j(function(e,t){t=[].concat(t);for(let n of t)this[n]=e[n]});function Eg(){se(this).video.querySelectorAll("track").forEach(e=>{e.remove()})}customElements.define(Tg,Jn);var Mi={},Sg={get exports(){return Mi},set exports(r){Mi=r}};(function(r,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var h=o.parseURL(c);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return u.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):c;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var m=i.exec(f.path);f.netLoc=m[1],f.path=m[2]}f.netLoc&&!f.path&&(f.path="/");var p={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(p.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)p.path=f.path,h.params||(p.params=f.params,h.query||(p.query=f.query));else{var g=f.path,T=g.substring(0,g.lastIndexOf("/")+1)+h.path;p.path=o.normalizePath(T)}return p.path===null&&(p.path=u.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(p)},parseURL:function(l){var c=n.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};r.exports=o})()})(Sg);function cu(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function ze(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cu(Object(t),!0).forEach(function(n){_g(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):cu(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function _g(r,e,t){return e=Ag(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Oe(){return Oe=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Oe.apply(this,arguments)}function wg(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Ag(r){var e=wg(r,"string");return typeof e=="symbol"?e:String(e)}var X=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},v=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r}({}),J=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),F=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.UNKNOWN="unknown",r}({}),Pn=function(){},aa={trace:Pn,debug:Pn,log:Pn,warn:Pn,info:Pn,error:Pn},Fi=aa;function Lg(r){let e=self.console[r];return e?e.bind(self.console,`[${r}] >`):Pn}function Ig(r,...e){e.forEach(function(t){Fi[t]=r[t]?r[t].bind(r):Lg(t)})}function Cg(r,e){if(self.console&&r===!0||typeof r=="object"){Ig(r,"debug","log","info","warn","error");try{Fi.log(`Debug logs enabled for "${e}" in hls.js version 1.4.0`)}catch(t){Fi=aa}}else Fi=aa}var R=Fi,Rg=/^(\d+)x(\d+)$/,uu=/(.+?)=(".*?"|.*?)(?:,|$)/g,Ae=class{constructor(e){typeof e=="string"&&(e=Ae.parseAttrList(e));for(let t in e)e.hasOwnProperty(t)&&(t.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){let t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?Infinity:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;let n=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)n[i]=parseInt(t.slice(i*2,i*2+2),16);return n}else return null}hexadecimalIntegerAsNumber(e){let t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?Infinity:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){let n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){let t=Rg.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t,n={},i='"';for(uu.lastIndex=0;(t=uu.exec(e))!==null;){let s=t[2];s.indexOf(i)===0&&s.lastIndexOf(i)===s.length-1&&(s=s.slice(1,-1));let a=t[1].trim();n[a]=s}return n}};function Pg(r){return r!=="ID"&&r!=="CLASS"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function kg(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"}var oa=class{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){let n=t.attr;for(let i in n)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==n[i]){R.warn(`DATERANGE tag attribute: "${i}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=i;break}e=Oe(new Ae({}),n,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){let n=new Date(this.attr["END-DATE"]);X(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;let e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){let e=this.attr.decimalFloatingPoint("DURATION");if(X(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&X(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}},Ni=class{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},be={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},la=class{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[be.AUDIO]:null,[be.VIDEO]:null,[be.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){let n=e.split("@",2),i=[];n.length===1?i[0]=t?t.byteRangeEndOffset:0:i[0]=parseInt(n[1]),i[1]=parseInt(n[0])+i[0],this._byteRange=i}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Mi.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}},Vr=class extends la{constructor(e,t){super(t);this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new Ni,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){let{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){let t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{let n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!X(this.programDateTime))return null;let e=X(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){let t=Object.keys(this.levelkeys),n=t.length;if(n>1||n===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){let t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,i,s,a=!1){let{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:s,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,n),l.startDTS=Math.min(l.startDTS,i),l.endDTS=Math.max(l.endDTS,s)}clearElementaryStreamInfo(){let{elementaryStreams:e}=this;e[be.AUDIO]=null,e[be.VIDEO]=null,e[be.AUDIOVIDEO]=null}},du=class extends la{constructor(e,t,n,i,s){super(n);this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new Ni,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;let a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){let{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}},Dg=10,hu=class{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}let t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?X(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Dg}get drift(){let e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}};function ca(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function xg(r){let e=fu(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Og(r){let e=function(n,i,s){let a=n[i];n[i]=n[s],n[s]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function Mg(r){let e=r.split(":"),t=null;if(e[0]==="data"&&e.length===2){let n=e[1].split(";"),i=n[n.length-1].split(",");if(i.length===2){let s=i[0]==="base64",a=i[1];s?(n.splice(-1,1),t=ca(a)):t=xg(a)}}return t}function fu(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}var Ce={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ye={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function mu(r){switch(r){case Ye.FAIRPLAY:return Ce.FAIRPLAY;case Ye.PLAYREADY:return Ce.PLAYREADY;case Ye.WIDEVINE:return Ce.WIDEVINE;case Ye.CLEARKEY:return Ce.CLEARKEY}}var pu={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Fg(r){if(r===pu.WIDEVINE)return Ce.WIDEVINE}function gu(r){switch(r){case Ce.FAIRPLAY:return Ye.FAIRPLAY;case Ce.PLAYREADY:return Ye.PLAYREADY;case Ce.WIDEVINE:return Ye.WIDEVINE;case Ce.CLEARKEY:return Ye.CLEARKEY}}function ua(r){let{drmSystems:e,widevineLicenseUrl:t}=r,n=e?[Ce.FAIRPLAY,Ce.WIDEVINE,Ce.PLAYREADY,Ce.CLEARKEY].filter(i=>!!e[i]):[];return!n[Ce.WIDEVINE]&&t&&n.push(Ce.WIDEVINE),n}var vu=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Bg(r,e,t,n){let i;switch(r){case Ce.FAIRPLAY:i=["cenc","sinf"];break;case Ce.WIDEVINE:case Ce.PLAYREADY:i=["cenc"];break;case Ce.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return Ng(i,e,t,n)}function Ng(r,e,t,n){return[{initDataTypes:r,persistentState:n.persistentState||"not-allowed",distinctiveIdentifier:n.distinctiveIdentifier||"not-allowed",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function kn(r,e,t){return Uint8Array.prototype.slice?r.slice(e,t):new Uint8Array(Array.prototype.slice.call(r,e,t))}var da=(r,e)=>e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128,yu=(r,e)=>e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128,Hr=(r,e)=>{let t=e,n=0;for(;da(r,e);)n+=10,n+=jr(r,e+6),yu(r,e+10)&&(n+=10),e+=n;if(n>0)return r.subarray(t,t+n)},jr=(r,e)=>{let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t},Ug=(r,e)=>da(r,e)&&jr(r,e+6)+10<=r.length-e,Gg=r=>{let e=Tu(r);for(let t=0;t<e.length;t++){let n=e[t];if(bu(n))return $g(n)}},bu=r=>r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp",Vg=r=>{let e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=jr(r,4),n=10;return{type:e,size:t,data:r.subarray(n,n+t)}},Tu=r=>{let e=0,t=[];for(;da(r,e);){let n=jr(r,e+6);e+=10;let i=e+n;for(;e+8<i;){let s=Vg(r.subarray(e)),a=jg(s);a&&t.push(a),e+=s.size+10}yu(r,e)&&(e+=10)}return t},jg=r=>r.type==="PRIV"?Hg(r):r.type[0]==="W"?Kg(r):Wg(r),Hg=r=>{if(r.size<2)return;let e=Nt(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}},Wg=r=>{if(r.size<2)return;if(r.type==="TXXX"){let t=1,n=Nt(r.data.subarray(t),!0);t+=n.length+1;let i=Nt(r.data.subarray(t));return{key:r.type,info:n,data:i}}let e=Nt(r.data.subarray(1));return{key:r.type,data:e}},Kg=r=>{if(r.type==="WXXX"){if(r.size<2)return;let t=1,n=Nt(r.data.subarray(t),!0);t+=n.length+1;let i=Nt(r.data.subarray(t));return{key:r.type,info:n,data:i}}let e=Nt(r.data);return{key:r.type,data:e}},$g=r=>{if(r.data.byteLength===8){let e=new Uint8Array(r.data),t=e[3]&1,n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}},Nt=(r,e=!1)=>{let t=qg();if(t){let c=t.decode(r);if(e){let u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}let n=r.length,i,s,a,o="",l=0;for(;l<n;){if(i=r[l++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:s=r[l++],o+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=r[l++],a=r[l++],o+=String.fromCharCode((i&15)<<12|(s&63)<<6|(a&63)<<0);break}}return o},ha;function qg(){return!ha&&typeof self.TextDecoder!="undefined"&&(ha=new self.TextDecoder("utf-8")),ha}var Bt={hexDump:function(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}},Wr=Math.pow(2,32)-1,zg=[].push,Eu={video:1,audio:2,id3:3,text:4};function Be(r){return String.fromCharCode.apply(null,r)}function Su(r,e){let t=r[e]<<8|r[e+1];return t<0?65536+t:t}function re(r,e){let t=_u(r,e);return t<0?4294967296+t:t}function _u(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function fa(r,e,t){r[e]=t>>24,r[e+1]=t>>16&255,r[e+2]=t>>8&255,r[e+3]=t&255}function he(r,e){let t=[];if(!e.length)return t;let n=r.byteLength;for(let i=0;i<n;){let s=re(r,i),a=Be(r.subarray(i+4,i+8)),o=s>1?i+s:n;if(a===e[0])if(e.length===1)t.push(r.subarray(i+8,o));else{let l=he(r.subarray(i+8,o),e.slice(1));l.length&&zg.apply(t,l)}i=o}return t}function Yg(r){let e=[],t=r[0],n=8,i=re(r,n);n+=4;let s=0,a=0;t===0?n+=8:n+=16,n+=2;let o=r.length+a,l=Su(r,n);n+=2;for(let c=0;c<l;c++){let u=n,d=re(r,u);u+=4;let h=d&2147483647;if((d&2147483648)>>>31===1)return R.warn("SIDX has hierarchical references (not supported)"),null;let m=re(r,u);u+=4,e.push({referenceSize:h,subsegmentDuration:m,info:{duration:m/i,start:o,end:o+h-1}}),o+=h,u+=4,n=u}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:l,references:e}}function Au(r){let e=[],t=he(r,["moov","trak"]);for(let i=0;i<t.length;i++){let s=t[i],a=he(s,["tkhd"])[0];if(a){let o=a[0],l=o===0?12:20,c=re(a,l),u=he(s,["mdia","mdhd"])[0];if(u){o=u[0],l=o===0?12:20;let d=re(u,l),h=he(s,["mdia","hdlr"])[0];if(h){let f=Be(h.subarray(8,12)),m={soun:be.AUDIO,vide:be.VIDEO}[f];if(m){let p=he(s,["mdia","minf","stbl","stsd"])[0],g;p&&(g=Be(p.subarray(12,16))),e[c]={timescale:d,type:m},e[m]={timescale:d,id:c,codec:g}}}}}}return he(r,["moov","mvex","trex"]).forEach(i=>{let s=re(i,4),a=e[s];a&&(a.default={duration:re(i,12),flags:re(i,20)})}),e}function Xg(r,e){if(!r||!e)return r;let t=e.keyId;return t&&e.isCommonEncryption&&he(r,["moov","trak"]).forEach(i=>{let a=he(i,["mdia","minf","stbl","stsd"])[0].subarray(8),o=he(a,["enca"]),l=o.length>0;l||(o=he(a,["encv"])),o.forEach(c=>{let u=l?c.subarray(28):c.subarray(78);he(u,["sinf"]).forEach(h=>{let f=wu(h);if(f){let m=f.subarray(8,24);m.some(p=>p!==0)||(R.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Bt.hexDump(m)} -> ${Bt.hexDump(t)}`),f.set(t,8))}})})}),r}function wu(r){let e=he(r,["schm"])[0];if(e){let t=Be(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return he(r,["schi","tenc"])[0]}return R.error("[eme] missing 'schm' box"),null}function Qg(r,e){return he(e,["moof","traf"]).reduce((t,n)=>{let i=he(n,["tfdt"])[0],s=i[0],a=he(n,["tfhd"]).reduce((o,l)=>{let c=re(l,4),u=r[c];if(u){let d=re(i,4);if(s===1){if(d===Wr)return R.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),o;d*=Wr+1,d+=re(i,8)}let h=u.timescale||9e4,f=d/h;if(isFinite(f)&&(o===null||f<o))return f}return o},null);return a!==null&&isFinite(a)&&(t===null||a<t)?a:t},null)}function Zg(r,e){let t=0,n=0,i=0,s=he(r,["moof","traf"]);for(let a=0;a<s.length;a++){let o=s[a],l=he(o,["tfhd"])[0],c=re(l,4),u=e[c];if(!u)continue;let d=u.default,h=re(l,0)|(d==null?void 0:d.flags),f=d==null?void 0:d.duration;h&8&&(h&2?f=re(l,12):f=re(l,8));let m=u.timescale||9e4,p=he(o,["trun"]);for(let g=0;g<p.length;g++){if(t=Jg(p[g]),!t&&f){let T=re(p[g],4);t=f*T}u.type===be.VIDEO?n+=t/m:u.type===be.AUDIO&&(i+=t/m)}}if(n===0&&i===0){let a=0,o=he(r,["sidx"]);for(let l=0;l<o.length;l++){let c=Yg(o[l]);c!=null&&c.references&&(a+=c.references.reduce((u,d)=>u+d.info.duration||0,0))}return a}return n||i}function Jg(r){let e=re(r,0),t=8;e&1&&(t+=4),e&4&&(t+=4);let n=0,i=re(r,4);for(let s=0;s<i;s++)e&256&&(n+=re(r,t),t+=4),e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4);return n}function ev(r,e,t){he(e,["moof","traf"]).forEach(n=>{he(n,["tfhd"]).forEach(i=>{let s=re(i,4),a=r[s];if(!a)return;let o=a.timescale||9e4;he(n,["tfdt"]).forEach(l=>{let c=l[0],u=re(l,4);if(c===0)u-=t*o,u=Math.max(u,0),fa(l,4,u);else{u*=Math.pow(2,32),u+=re(l,8),u-=t*o,u=Math.max(u,0);let d=Math.floor(u/(Wr+1)),h=Math.floor(u%(Wr+1));fa(l,4,d),fa(l,8,h)}})})})}function tv(r){let e={valid:null,remainder:null},t=he(r,["moof"]);if(t){if(t.length<2)return e.remainder=r,e}else return e;let n=t[t.length-1];return e.valid=kn(r,0,n.byteOffset-8),e.remainder=kn(r,n.byteOffset-8),e}function Dn(r,e){let t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Iu(r,e){let t=[],n=e.samples,i=e.timescale,s=e.id,a=!1;return he(n,["moof"]).map(l=>{let c=l.byteOffset-8;he(l,["traf"]).map(d=>{let h=he(d,["tfdt"]).map(f=>{let m=f[0],p=re(f,4);return m===1&&(p*=Math.pow(2,32),p+=re(f,8)),p/i})[0];return h!==void 0&&(r=h),he(d,["tfhd"]).map(f=>{let m=re(f,4),p=re(f,0)&16777215,g=(p&1)!=0,T=(p&2)!=0,_=(p&8)!=0,y=0,b=(p&16)!=0,E=0,C=(p&32)!=0,w=8;m===s&&(g&&(w+=8),T&&(w+=4),_&&(y=re(f,w),w+=4),b&&(E=re(f,w),w+=4),C&&(w+=4),e.type==="video"&&(a=nv(e.codec)),he(d,["trun"]).map(O=>{let S=O[0],I=re(O,0)&16777215,N=(I&1)!=0,B=0,A=(I&4)!=0,M=(I&256)!=0,$=0,q=(I&512)!=0,Y=0,W=(I&1024)!=0,K=(I&2048)!=0,ue=0,fe=re(O,4),de=8;N&&(B=re(O,de),de+=4),A&&(de+=4);let Se=B+c;for(let De=0;De<fe;De++){if(M?($=re(O,de),de+=4):$=y,q?(Y=re(O,de),de+=4):Y=E,W&&(de+=4),K&&(S===0?ue=re(O,de):ue=_u(O,de),de+=4),e.type===be.VIDEO){let Me=0;for(;Me<Y;){let je=re(n,Se);if(Se+=4,iv(a,n[Se])){let at=n.subarray(Se,Se+je);Lu(at,a?2:1,r+ue/i,t)}Se+=je,Me+=je+4}}r+=$/i}}))})})}),t}function nv(r){if(!r)return!1;let e=r.indexOf("."),t=e<0?r:r.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function iv(r,e){if(r){let t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Lu(r,e,t,n){let i=Cu(r),s=0;s+=e;let a=0,o=0,l=!1,c=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;c=i[s++],a+=c}while(c===255);o=0;do{if(s>=i.length)break;c=i[s++],o+=c}while(c===255);let u=i.length-s;if(!l&&a===4&&s<i.length){if(l=!0,i[s++]===181){let h=Su(i,s);if(s+=2,h===49){let f=re(i,s);if(s+=4,f===1195456820){let m=i[s++];if(m===3){let p=i[s++],g=31&p,T=64&p,_=T?2+g*3:0,y=new Uint8Array(_);if(T){y[0]=p;for(let b=1;b<_;b++)y[b]=i[s++]}n.push({type:m,payloadType:a,pts:t,bytes:y})}}}}}else if(a===5&&o<u){if(l=!0,o>16){let d=[];for(let m=0;m<16;m++){let p=i[s++].toString(16);d.push(p.length==1?"0"+p:p),(m===3||m===5||m===7||m===9)&&d.push("-")}let h=o-16,f=new Uint8Array(h);for(let m=0;m<h;m++)f[m]=i[s++];n.push({payloadType:a,pts:t,uuid:d.join(""),userData:Nt(f),userDataBytes:f})}}else if(o<u)s+=o;else if(o>u)break}}function Cu(r){let e=r.byteLength,t=[],n=1;for(;n<e-2;)r[n]===0&&r[n+1]===0&&r[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return r;let i=e-t.length,s=new Uint8Array(i),a=0;for(n=0;n<i;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=r[a];return s}function rv(r){let e=r[0],t="",n="",i=0,s=0,a=0,o=0,l=0,c=0;if(e===0){for(;Be(r.subarray(c,c+1))!=="\0";)t+=Be(r.subarray(c,c+1)),c+=1;for(t+=Be(r.subarray(c,c+1)),c+=1;Be(r.subarray(c,c+1))!=="\0";)n+=Be(r.subarray(c,c+1)),c+=1;n+=Be(r.subarray(c,c+1)),c+=1,i=re(r,12),s=re(r,16),o=re(r,20),l=re(r,24),c=28}else if(e===1){c+=4,i=re(r,c),c+=4;let d=re(r,c);c+=4;let h=re(r,c);for(c+=4,a=2**32*d+h,Number.isSafeInteger(a)||(a=Number.MAX_SAFE_INTEGER,R.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=re(r,c),c+=4,l=re(r,c),c+=4;Be(r.subarray(c,c+1))!=="\0";)t+=Be(r.subarray(c,c+1)),c+=1;for(t+=Be(r.subarray(c,c+1)),c+=1;Be(r.subarray(c,c+1))!=="\0";)n+=Be(r.subarray(c,c+1)),c+=1;n+=Be(r.subarray(c,c+1)),c+=1}let u=r.subarray(c,r.byteLength);return{schemeIdUri:t,value:n,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:u}}function sv(r,...e){let t=e.length,n=8,i=t;for(;i--;)n+=e[i].byteLength;let s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(r,4),i=0,n=8;i<t;i++)s.set(e[i],n),n+=e[i].byteLength;return s}function av(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let n,i;if(e){n=1,i=new Uint8Array(e.length*16);for(let o=0;o<e.length;o++){let l=e[o];if(l.byteLength!==16)throw new RangeError("Invalid key");i.set(l,o*16)}}else n=0,i=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;let a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),sv([112,115,115,104],new Uint8Array([n,0,0,0]),r,s,i,a,t||new Uint8Array)}function ov(r){if(!(r instanceof ArrayBuffer)||r.byteLength<32)return null;let e={version:0,systemId:"",kids:null,data:null},t=new DataView(r),n=t.getUint32(0);if(r.byteLength!==n&&n>44||t.getUint32(4)!==1886614376||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=Bt.hexDump(new Uint8Array(r,12,16));let s=t.getUint32(28);if(e.version===0){if(n-32<s)return null;e.data=new Uint8Array(r,32,s)}else if(e.version===1){e.kids=[];for(let a=0;a<s;a++)e.kids.push(new Uint8Array(r,32+a*16,16))}return e}var Kr={},Zn=class{static clearKeyUriToKeyIdMap(){Kr={}}constructor(e,t,n,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ye.FAIRPLAY:case Ye.WIDEVINE:case Ye.PLAYREADY:case Ye.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&R.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);let n=lv(e);return new Zn(this.method,this.uri,"identity",this.keyFormatVersions,n)}let t=Mg(this.uri);if(t)switch(this.keyFormat){case Ye.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Ye.PLAYREADY:{let n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=av(n,null,t);let i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),s=String.fromCharCode.apply(null,Array.from(i)),a=s.substring(s.indexOf("<"),s.length),c=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("KID")[0];if(c){let u=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(u){let d=ca(u).subarray(0,16);Og(d),this.keyId=d}}break}default:{let n=t.subarray(0,16);if(n.length!==16){let i=new Uint8Array(16);i.set(n,16-n.length),n=i}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=Kr[this.uri];if(!n){let i=Object.keys(Kr).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,i),Kr[this.uri]=n}this.keyId=n}return this}};function lv(r){let e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}var Ru=/\{\$([a-zA-Z0-9-_]+)\}/g;function Pu(r){return Ru.test(r)}function Xe(r,e,t){if(r.variableList!==null||r.hasVariableRefs)for(let n=t.length;n--;){let i=t[n],s=e[i];s&&(e[i]=ma(r,s))}}function ma(r,e){if(r.variableList!==null||r.hasVariableRefs){let t=r.variableList;return e.replace(Ru,n=>{let i=n.substring(2,n.length-1),s=t==null?void 0:t[i];return s===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),n):s})}return e}function ku(r,e,t){let n=r.variableList;n||(r.variableList=n={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{let a=new self.URL(t).searchParams;if(a.has(i))s=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,s=e.VALUE;i in n?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=s||""}function cv(r,e,t){let n=e.IMPORT;if(t&&n in t){let i=r.variableList;i||(r.variableList=i={}),i[n]=t[n]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}var uv={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function dv(r,e){let t=uv[e];return!!t&&t[r.slice(0,4)]===!0}function pa(r,e){return MediaSource.isTypeSupported(`${e||"video"}/mp4;codecs="${r}"`)}var Du=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,xu=/#EXT-X-MEDIA:(.*)/g,hv=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ou=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),fv=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),pt=class{static findGroup(e,t){for(let n=0;n<e.length;n++){let i=e[n];if(i.id===t)return i}}static convertAVC1ToAVCOTI(e){let t=e.split(".");if(t.length>2){let n=t.shift()+".";return n+=parseInt(t.shift()).toString(16),n+=("000"+parseInt(t.shift()).toString(16)).slice(-4),n}return e}static resolve(e,t){return Mi.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return hv.test(e)}static parseMasterPlaylist(e,t){let n=Pu(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];Du.lastIndex=0;let a;for(;(a=Du.exec(e))!=null;)if(a[1]){var o;let c=new Ae(a[1]);Xe(i,c,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);let u=ma(i,a[2]),d={attrs:c,bitrate:c.decimalInteger("AVERAGE-BANDWIDTH")||c.decimalInteger("BANDWIDTH"),name:c.NAME,url:pt.resolve(u,t)},h=c.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),mv((c.CODECS||"").split(/[ ,]+/).filter(f=>f),d),d.videoCodec&&d.videoCodec.indexOf("avc1")!==-1&&(d.videoCodec=pt.convertAVC1ToAVCOTI(d.videoCodec)),(o=d.unknownCodecs)!=null&&o.length||s.push(d),i.levels.push(d)}else if(a[3]){let c=a[3],u=a[4];switch(c){case"SESSION-DATA":{let d=new Ae(u);Xe(i,d,["DATA-ID","LANGUAGE","VALUE","URI"]);let h=d["DATA-ID"];h&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[h]=d);break}case"SESSION-KEY":{let d=Mu(u,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):R.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{let d=new Ae(u);Xe(i,d,["NAME","VALUE","QUERYPARAM"]),ku(i,d,t)}break}case"CONTENT-STEERING":{let d=new Ae(u);Xe(i,d,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:pt.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Fu(u);break}}}let l=s.length>0&&s.length<i.levels.length;return i.levels=l?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i,s={},a=n.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]},l=0;for(xu.lastIndex=0;(i=xu.exec(e))!==null;){let c=new Ae(i[1]),u=c.TYPE;if(u){let d=o[u],h=s[u]||[];s[u]=h,Xe(n,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);let f={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?pt.resolve(c.URI,t):""};if(d!=null&&d.length){let m=pt.findGroup(d,f.groupId)||d[0];Nu(f,m,"audioCodec"),Nu(f,m,"textCodec")}h.push(f)}}return s}static parseLevelPlaylist(e,t,n,i,s,a){let o=new hu(t),l=o.fragments,c=null,u=0,d=0,h=0,f=0,m=null,p=new Vr(i,t),g,T,_,y=-1,b=!1;for(Ou.lastIndex=0,o.m3u8=e,o.hasVariableRefs=Pu(e);(g=Ou.exec(e))!==null;){b&&(b=!1,p=new Vr(i,t),p.start=h,p.sn=u,p.cc=f,p.level=n,c&&(p.initSegment=c,p.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null));let O=g[1];if(O){p.duration=parseFloat(O);let S=(" "+g[2]).slice(1);p.title=S||null,p.tagList.push(S?["INF",O,S]:["INF",O])}else if(g[3]){if(X(p.duration)){p.start=h,_&&$u(p,_,o),p.sn=u,p.level=n,p.cc=f,p.urlId=s,l.push(p);let S=(" "+g[3]).slice(1);p.relurl=ma(o,S),Bu(p,m),m=p,h+=p.duration,u++,d=0,b=!0}}else if(g[4]){let S=(" "+g[4]).slice(1);m?p.setByteRange(S,m):p.setByteRange(S)}else if(g[5])p.rawProgramDateTime=(" "+g[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),y===-1&&(y=l.length);else{if(g=g[0].match(fv),!g){R.warn("No matches on slow regex match for level playlist!");continue}for(T=1;T<g.length&&typeof g[T]=="undefined";T++);let S=(" "+g[T]).slice(1),I=(" "+g[T+1]).slice(1),N=g[T+2]?(" "+g[T+2]).slice(1):"";switch(S){case"PLAYLIST-TYPE":o.type=I.toUpperCase();break;case"MEDIA-SEQUENCE":u=o.startSN=parseInt(I);break;case"SKIP":{let B=new Ae(I);Xe(o,B,["RECENTLY-REMOVED-DATERANGES"]);let A=B.decimalInteger("SKIPPED-SEGMENTS");if(X(A)){o.skippedSegments=A;for(let $=A;$--;)l.unshift(null);u+=A}let M=B.enumeratedString("RECENTLY-REMOVED-DATERANGES");M&&(o.recentlyRemovedDateranges=M.split("	"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(I),1);break;case"VERSION":o.version=parseInt(I);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(I||N)&&p.tagList.push(N?[I,N]:[I]);break;case"DISCONTINUITY":f++,p.tagList.push(["DIS"]);break;case"GAP":p.gap=!0,p.tagList.push([S]);break;case"BITRATE":p.tagList.push([S,I]);break;case"DATERANGE":{let B=new Ae(I);Xe(o,B,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Xe(o,B,B.clientAttrs);let A=new oa(B,o.dateRanges[B.ID]);A.isValid||o.skippedSegments?o.dateRanges[A.id]=A:R.warn(`Ignoring invalid DATERANGE tag: "${I}"`),p.tagList.push(["EXT-X-DATERANGE",I]);break}case"DEFINE":{{let B=new Ae(I);Xe(o,B,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in B?cv(o,B,a):ku(o,B,t)}break}case"DISCONTINUITY-SEQUENCE":f=parseInt(I);break;case"KEY":{let B=Mu(I,t,o);if(B.isSupported()){if(B.method==="NONE"){_=void 0;break}_||(_={}),_[B.keyFormat]&&(_=Oe({},_)),_[B.keyFormat]=B}else R.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${I}"`);break}case"START":o.startTimeOffset=Fu(I);break;case"MAP":{let B=new Ae(I);if(Xe(o,B,["BYTERANGE","URI"]),p.duration){let A=new Vr(i,t);Uu(A,B,n,_),c=A,p.initSegment=c,c.rawProgramDateTime&&!p.rawProgramDateTime&&(p.rawProgramDateTime=c.rawProgramDateTime)}else Uu(p,B,n,_),c=p,b=!0;break}case"SERVER-CONTROL":{let B=new Ae(I);o.canBlockReload=B.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=B.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&B.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=B.optionalFloat("PART-HOLD-BACK",0),o.holdBack=B.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{let B=new Ae(I);o.partTarget=B.decimalFloatingPoint("PART-TARGET");break}case"PART":{let B=o.partList;B||(B=o.partList=[]);let A=d>0?B[B.length-1]:void 0,M=d++,$=new Ae(I);Xe(o,$,["BYTERANGE","URI"]);let q=new du($,p,t,M,A);B.push(q),p.duration+=q.duration;break}case"PRELOAD-HINT":{let B=new Ae(I);Xe(o,B,["URI"]),o.preloadHint=B;break}case"RENDITION-REPORT":{let B=new Ae(I);Xe(o,B,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(B);break}default:R.warn(`line parsed but not handled: ${g}`);break}}}m&&!m.relurl?(l.pop(),h-=m.duration,o.partList&&(o.fragmentHint=m)):o.partList&&(Bu(p,m),p.cc=f,o.fragmentHint=p,_&&$u(p,_,o));let E=l.length,C=l[0],w=l[E-1];if(h+=o.skippedSegments*o.targetduration,h>0&&E&&w){o.averagetargetduration=h/E;let O=w.sn;o.endSN=O!=="initSegment"?O:0,o.live||(w.endList=!0),C&&(o.startCC=C.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(h+=o.fragmentHint.duration),o.totalduration=h,o.endCC=f,y>0&&pv(l,y),o}};function Mu(r,e,t){var n,i;let s=new Ae(r);Xe(t,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);let a=(n=s.METHOD)!=null?n:"",o=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=(i=s.KEYFORMAT)!=null?i:"identity";o&&s.IV&&!l&&R.error(`Invalid IV: ${s.IV}`);let d=o?pt.resolve(o,e):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Zn(a,d,u,h,l)}function Fu(r){let t=new Ae(r).decimalFloatingPoint("TIME-OFFSET");return X(t)?t:null}function mv(r,e){["video","audio","text"].forEach(t=>{let n=r.filter(i=>dv(i,t));if(n.length){let i=n.filter(s=>s.lastIndexOf("avc1",0)===0||s.lastIndexOf("mp4a",0)===0);e[`${t}Codec`]=i.length>0?i[0]:n[0],r=r.filter(s=>n.indexOf(s)===-1)}}),e.unknownCodecs=r}function Nu(r,e,t){let n=e[t];n&&(r[t]=n)}function pv(r,e){let t=r[e];for(let n=e;n--;){let i=r[n];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function Bu(r,e){r.rawProgramDateTime?r.programDateTime=Date.parse(r.rawProgramDateTime):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime),X(r.programDateTime)||(r.programDateTime=null,r.rawProgramDateTime=null)}function Uu(r,e,t,n){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",n&&(r.levelkeys=n),r.initSegment=null}function $u(r,e,t){r.levelkeys=e;let{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&n.push(r)}var pe={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Z={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Gu(r){let{type:e}=r;switch(e){case pe.AUDIO_TRACK:return Z.AUDIO;case pe.SUBTITLE_TRACK:return Z.SUBTITLE;default:return Z.MAIN}}function ga(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}var Vu=class{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){let{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){let{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){let t=this.hls.config,n=t.pLoader,i=t.loader,s=n||i,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){let{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:pe.MANIFEST,url:n,deliveryDirectives:null})}onLevelLoading(e,t){let{id:n,level:i,url:s,deliveryDirectives:a}=t;this.load({id:n,level:i,responseType:"text",type:pe.LEVEL,url:s,deliveryDirectives:a})}onAudioTrackLoading(e,t){let{id:n,groupId:i,url:s,deliveryDirectives:a}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:pe.AUDIO_TRACK,url:s,deliveryDirectives:a})}onSubtitleTrackLoading(e,t){let{id:n,groupId:i,url:s,deliveryDirectives:a}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:pe.SUBTITLE_TRACK,url:s,deliveryDirectives:a})}load(e){var t;let n=this.hls.config,i=this.getInternalLoader(e);if(i){let c=i.context;if(c&&c.url===e.url){R.trace("[playlist-loader]: playlist request ongoing");return}R.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===pe.MANIFEST?s=n.manifestLoadPolicy.default:s=Oe({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),(t=e.deliveryDirectives)!=null&&t.part){let c;if(e.type===pe.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===pe.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===pe.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){let u=c.partTarget,d=c.targetduration;if(u&&d){let h=Math.max(u*3,d*.8)*1e3;s=Oe({},s,{maxTimeToFirstByteMs:Math.min(h,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,s.maxTimeToFirstByteMs)})}}}let a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,u,d,h)=>{let f=this.getInternalLoader(d);this.resetInternalLoader(d.type);let m=c.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,d,new Error("no EXTM3U delimiter"),h||null,u);return}u.parsing.start=performance.now(),pt.isMediaPlaylist(m)?this.handleTrackOrLevelPlaylist(c,u,d,h||null,f):this.handleMasterPlaylist(c,u,d,h)},onError:(c,u,d,h)=>{this.handleNetworkError(u,d,!1,c,h)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}};i.load(e,o,l)}handleMasterPlaylist(e,t,n,i){let s=this.hls,a=e.data,o=ga(e,n),l=pt.parseMasterPlaylist(a,o);if(l.playlistParsingError){this.handleManifestParsingError(e,n,l.playlistParsingError,i,t);return}let{contentSteering:c,levels:u,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:m}=l;this.variableList=m;let{AUDIO:p=[],SUBTITLES:g,"CLOSED-CAPTIONS":T}=pt.parseMasterPlaylistMedia(a,o,l);p.length&&!p.some(y=>!y.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(R.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ae({}),bitrate:0,url:""})),s.trigger(v.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:g,captions:T,contentSteering:c,url:o,stats:t,networkDetails:i,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:m})}handleTrackOrLevelPlaylist(e,t,n,i,s){let a=this.hls,{id:o,level:l,type:c}=n,u=ga(e,n),d=X(o)?o:0,h=X(l)?l:d,f=Gu(n),m=pt.parseLevelPlaylist(e.data,u,h,f,d,this.variableList);if(c===pe.MANIFEST){let p={attrs:new Ae({}),bitrate:0,details:m,name:"",url:u};a.trigger(v.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:u,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=m,this.handlePlaylistLoaded(m,e,t,n,i,s)}handleManifestParsingError(e,t,n,i,s){this.hls.trigger(v.ERROR,{type:J.NETWORK_ERROR,details:F.MANIFEST_PARSING_ERROR,fatal:t.type===pe.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,n=!1,i,s){let a=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===pe.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===pe.AUDIO_TRACK||e.type===pe.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);let o=new Error(a);R.warn(`[playlist-loader]: ${a}`);let l=F.UNKNOWN,c=!1,u=this.getInternalLoader(e);switch(e.type){case pe.MANIFEST:l=n?F.MANIFEST_LOAD_TIMEOUT:F.MANIFEST_LOAD_ERROR,c=!0;break;case pe.LEVEL:l=n?F.LEVEL_LOAD_TIMEOUT:F.LEVEL_LOAD_ERROR,c=!1;break;case pe.AUDIO_TRACK:l=n?F.AUDIO_TRACK_LOAD_TIMEOUT:F.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case pe.SUBTITLE_TRACK:l=n?F.SUBTITLE_TRACK_LOAD_TIMEOUT:F.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);let d={type:J.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:o,networkDetails:t,stats:s};if(i){let h=(t==null?void 0:t.url)||e.url;d.response=ze({url:h,data:void 0},i)}this.hls.trigger(v.ERROR,d)}handlePlaylistLoaded(e,t,n,i,s,a){let o=this.hls,{type:l,level:c,id:u,groupId:d,deliveryDirectives:h}=i,f=ga(t,i),m=Gu(i),p=typeof i.level=="number"&&m===Z.MAIN?c:void 0;if(!e.fragments.length){let T=new Error("No Segments found in Playlist");o.trigger(v.ERROR,{type:J.NETWORK_ERROR,details:F.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:T,reason:T.message,response:t,context:i,level:p,parent:m,networkDetails:s,stats:n});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));let g=e.playlistParsingError;if(g){o.trigger(v.ERROR,{type:J.NETWORK_ERROR,details:F.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:g,reason:g.message,response:t,context:i,level:p,parent:m,networkDetails:s,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case pe.MANIFEST:case pe.LEVEL:o.trigger(v.LEVEL_LOADED,{details:e,level:p||0,id:u||0,stats:n,networkDetails:s,deliveryDirectives:h});break;case pe.AUDIO_TRACK:o.trigger(v.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:d||"",stats:n,networkDetails:s,deliveryDirectives:h});break;case pe.SUBTITLE_TRACK:o.trigger(v.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:d||"",stats:n,networkDetails:s,deliveryDirectives:h});break}}};function ju(r,e){let t;try{t=new Event("addtrack")}catch(n){t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function Hu(r,e){let t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){R.debug(`[texttrack-utils]: ${n}`);let i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,r.addCue(i)}t==="disabled"&&(r.mode=t)}function ei(r){let e=r.mode;if(e==="disabled"&&(r.mode="hidden"),r.cues)for(let t=r.cues.length;t--;)r.removeCue(r.cues[t]);e==="disabled"&&(r.mode=e)}function va(r,e,t,n){let i=r.mode;if(i==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){let s=gv(r.cues,e,t);for(let a=0;a<s.length;a++)(!n||n(s[a]))&&r.removeCue(s[a])}i==="disabled"&&(r.mode=i)}function vv(r,e){if(e<r[0].startTime)return 0;let t=r.length-1;if(e>r[t].endTime)return-1;let n=0,i=t;for(;n<=i;){let s=Math.floor((i+n)/2);if(e<r[s].startTime)i=s-1;else if(e>r[s].startTime&&n<t)n=s+1;else return s}return r[n].startTime-e<e-r[i].startTime?n:i}function gv(r,e,t){let n=[],i=vv(r,e);if(i>-1)for(let s=i,a=r.length;s<a;s++){let o=r[s];if(o.startTime>=e&&o.endTime<=t)n.push(o);else if(o.startTime>t)return n}return n}var Pt={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"},yv=.25;function ya(){if(typeof self!="undefined")return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var qr=(()=>{let r=ya();try{new r(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function ba(r,e){return r.getTime()/1e3-e}function bv(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var Wu=class{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){let{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){let{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){!this.id3Track||(ei(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){let t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(!!this.media){for(let t=0;t<e.length;t++){let n=e[t];if(n.kind==="metadata"&&n.label==="id3")return ju(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;let{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:i}}}=this;if(!n&&!i)return;let{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));let a=ya();for(let o=0;o<s.length;o++){let l=s[o].type;if(l===Pt.emsg&&!n||!i)continue;let c=Tu(s[o].data);if(c){let u=s[o].pts,d=u+s[o].duration;d>qr&&(d=qr),d-u<=0&&(d=u+yv);for(let f=0;f<c.length;f++){let m=c[f];if(!bu(m)){this.updateId3CueEnds(u);let p=new a(u,d,"");p.value=m,l&&(p.type=l),this.id3Track.addCue(p)}}}}}updateId3CueEnds(e){var t;let n=(t=this.id3Track)==null?void 0:t.cues;if(n)for(let i=n.length;i--;){let s=n[i];s.startTime<e&&s.endTime===qr&&(s.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){let{id3Track:s,hls:a}=this;if(!a)return;let{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let c;i==="audio"?c=u=>u.type===Pt.audioId3&&l:i==="video"?c=u=>u.type===Pt.emsg&&o:c=u=>u.type===Pt.audioId3&&l||u.type===Pt.emsg&&o,va(s,t,n,c)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;let{dateRangeCuesAppended:n,id3Track:i}=this,{dateRanges:s}=t,a=Object.keys(s);if(i){let u=Object.keys(n).filter(d=>!a.includes(d));for(let d=u.length;d--;){let h=u[d];Object.keys(n[h].cues).forEach(f=>{i.removeCue(n[h].cues[f])}),delete n[h]}}let o=t.fragments[t.fragments.length-1];if(a.length===0||!X(o==null?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));let l=o.programDateTime/1e3-o.start,c=ya();for(let u=0;u<a.length;u++){let d=a[u],h=s[d],f=n[d],m=(f==null?void 0:f.cues)||{},p=(f==null?void 0:f.durationKnown)||!1,g=ba(h.startDate,l),T=qr,_=h.endDate;if(_)T=ba(_,l),p=!0;else if(h.endOnNext&&!p){let b=a.reduce((E,C)=>{let w=s[C];return w.class===h.class&&w.id!==C&&w.startDate>h.startDate&&E.push(w),E},[]).sort((E,C)=>E.startDate.getTime()-C.startDate.getTime())[0];b&&(T=ba(b.startDate,l),p=!0)}let y=Object.keys(h.attr);for(let b=0;b<y.length;b++){let E=y[b];if(!Pg(E))continue;let C=m[E];if(C)p&&!f.durationKnown&&(C.endTime=T);else{let w=h.attr[E];C=new c(g,T,""),kg(E)&&(w=bv(w)),C.value={key:E,data:w},C.type=Pt.dateRange,C.id=d,this.id3Track.addCue(C),m[E]=C}}n[d]={cues:m,dateRange:h,durationKnown:p}}}},Ku=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){let{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){let{levelDetails:e}=this;if(e===null)return null;let{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig,c=o&&n||t;(l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:a*i);let u=i,d=1;return c+Math.min(this.stallCount*d,u)}get liveSyncPosition(){let e=this.estimateLiveEdge(),t=this.targetLatency,n=this.levelDetails;if(e===null||t===null||n===null)return null;let i=n.edge,s=e-t-this.edgeStalled,a=i-n.totalduration,o=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,s),o)}get drift(){let{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){let{levelDetails:e}=this;if(e===null)return 0;let t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){let{media:e,levelDetails:t}=this;if(!e||!t)return 0;let n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(v.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(v.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var n;t.details===F.BUFFER_STALLED_ERROR&&(this.stallCount++,(n=this.levelDetails)!=null&&n.live&&R.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){let{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;let n=this.computeLatency();if(n===null)return;this._latency=n;let{lowLatencyMode:i,maxLiveSyncPlaybackRate:s}=this.config;if(!i||s===1)return;let a=this.targetLatency;if(a===null)return;let o=n-a,l=Math.min(this.maxLatency,a+t.targetduration),c=o<l;if(t.live&&c&&o>.05&&this.forwardBufferLength>1){let u=Math.min(2,Math.max(1,s)),d=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(u,Math.max(1,d))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){let{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){let e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}},Ta=["NONE","TYPE-0","TYPE-1",null],Bi={No:"",Yes:"YES",v2:"v2"};function Tv(r,e){let{canSkipUntil:t,canSkipDateRanges:n,endSN:i}=r,s=e!==void 0?e-i:0;return t&&s<t?n?Bi.v2:Bi.Yes:Bi.No}var Ea=class{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){let t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}},ti=class{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>t).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){let t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return(e=this.audioGroupIds)==null?void 0:e[this.urlId]}get textGroupId(){var e;return(e=this.textGroupIds)==null?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}};function Sa(r,e){let t=e.startPTS;if(X(t)){let n=0,i;e.sn>r.sn?(n=t-r.start,i=r):(n=r.start-t,i=e),i.duration!==n&&(i.duration=n)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.start=r.start+(r.minEndPTS-r.start):e.start=r.start+r.duration:e.start=Math.max(r.start-e.duration,0)}function qu(r,e,t,n,i,s){n-t<=0&&(R.warn("Fragment should have a positive duration",e),n=t+e.duration,s=i+e.duration);let o=t,l=n,c=e.startPTS,u=e.endPTS;if(X(c)){let g=Math.abs(c-t);X(e.deltaPTS)?e.deltaPTS=Math.max(g,e.deltaPTS):e.deltaPTS=g,o=Math.max(t,c),t=Math.min(t,c),i=Math.min(i,e.startDTS),l=Math.min(n,u),n=Math.max(n,u),s=Math.max(s,e.endDTS)}let d=t-e.start;e.start!==0&&(e.start=t),e.duration=n-e.start,e.startPTS=t,e.maxStartPTS=o,e.startDTS=i,e.endPTS=n,e.minEndPTS=l,e.endDTS=s;let h=e.sn;if(!r||h<r.startSN||h>r.endSN)return 0;let f,m=h-r.startSN,p=r.fragments;for(p[m]=e,f=m;f>0;f--)Sa(p[f],p[f-1]);for(f=m;f<p.length-1;f++)Sa(p[f],p[f+1]);return r.fragmentHint&&Sa(p[p.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,d}function Av(r,e){let t=null,n=r.fragments;for(let l=n.length-1;l>=0;l--){let c=n[l].initSegment;if(c){t=c;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let i=0,s;if(_v(r,e,(l,c)=>{l.relurl&&(i=l.cc-c.cc),X(l.startPTS)&&X(l.endPTS)&&(c.start=c.startPTS=l.startPTS,c.startDTS=l.startDTS,c.maxStartPTS=l.maxStartPTS,c.endPTS=l.endPTS,c.endDTS=l.endDTS,c.minEndPTS=l.minEndPTS,c.duration=l.endPTS-l.startPTS,c.duration&&(s=c),e.PTSKnown=e.alignedSliding=!0),c.elementaryStreams=l.elementaryStreams,c.loader=l.loader,c.stats=l.stats,c.urlId=l.urlId,l.initSegment&&(c.initSegment=l.initSegment,t=l.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(c=>{var u;(!c.initSegment||c.initSegment.relurl===((u=t)==null?void 0:u.relurl))&&(c.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(l=>!l),e.deltaUpdateFailed){R.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=Ev(r.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));let a=e.fragments;if(i){R.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<a.length;l++)a[l].cc+=i}e.skippedSegments&&(e.startCC=e.fragments[0].cc),Sv(r.partList,e.partList,(l,c)=>{c.elementaryStreams=l.elementaryStreams,c.stats=l.stats}),s?qu(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):zu(r,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;let o=e.advancedDateTime;if(e.advanced&&o){let l=e.edge;e.driftStart||(e.driftStartTime=o,e.driftStart=l),e.driftEndTime=o,e.driftEnd=l}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime}function Ev(r,e,t){let n=Oe({},r);return t&&t.forEach(i=>{delete n[i]}),Object.keys(e).forEach(i=>{let s=new oa(e[i].attr,n[i]);s.isValid?n[i]=s:R.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[i].attr)}"`)}),n}function Sv(r,e,t){if(r&&e){let n=0;for(let i=0,s=r.length;i<=s;i++){let a=r[i],o=e[i+n];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):n--}}}function _v(r,e,t){let n=e.skippedSegments,i=Math.max(r.startSN,e.startSN)-e.startSN,s=(r.fragmentHint?1:0)+(n?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let c=i;c<=s;c++){let u=l[a+c],d=o[c];n&&!d&&c<n&&(d=e.fragments[c]=u),u&&d&&t(u,d)}}function zu(r,e){let t=e.startSN+e.skippedSegments-r.startSN,n=r.fragments;t<0||t>=n.length||_a(e,n[t].start)}function _a(r,e){if(e){let t=r.fragments;for(let n=r.skippedSegments;n<t.length;n++)t[n].start+=e;r.fragmentHint&&(r.fragmentHint.start+=e)}}function wv(r,e=Infinity){let t=1e3*r.targetduration;if(r.updated){let n=r.fragments,i=4;if(n.length&&t*i>e){let s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function Lv(r,e,t){if(!(r!=null&&r.details))return null;let n=r.details,i=n.fragments[e-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===e)?i:e<n.startSN&&t&&t.sn===e?t:null}function Xu(r,e,t){var n;return r!=null&&r.details?Yu((n=r.details)==null?void 0:n.partList,e,t):null}function Yu(r,e,t){if(r)for(let n=r.length;n--;){let i=r[n];if(i.index===t&&i.fragment.sn===e)return i}return null}function zr(r){switch(r.details){case F.FRAG_LOAD_TIMEOUT:case F.KEY_LOAD_TIMEOUT:case F.LEVEL_LOAD_TIMEOUT:case F.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Qu(r,e){let t=zr(e);return r.default[`${t?"timeout":"error"}Retry`]}function Aa(r,e){let t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function Ju(r){return ze(ze({},r),{errorRetry:null,timeoutRetry:null})}function Yr(r,e,t,n){return!!r&&e<r.maxNumRetry&&(Iv(n)||!!t)}function Iv(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}var Zu={search:function(r,e){let t=0,n=r.length-1,i=null,s=null;for(;t<=n;){i=(t+n)/2|0,s=r[i];let a=e(s);if(a>0)t=i+1;else if(a<0)n=i-1;else return s}return null}};function Rv(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!X(e))return null;let n=r[0].programDateTime;if(e<(n||0))return null;let i=r[r.length-1].endProgramDateTime;if(e>=(i||0))return null;t=t||0;for(let s=0;s<r.length;++s){let a=r[s];if(Cv(e,t,a))return a}return null}function Ui(r,e,t=0,n=0){let i=null;if(r?i=e[r.sn-e[0].sn+1]||null:t===0&&e[0].start===0&&(i=e[0]),i&&wa(t,n,i)===0)return i;let s=Zu.search(e,wa.bind(null,t,n));return s&&(s!==r||!i)?s:i}function wa(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;let n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=r?1:t.start-n>r&&t.start?-1:0}function Cv(r,e,t){let n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>r}function Pv(r,e){return Zu.search(r,t=>t.cc<e?1:t.cc>e?-1:0)}var kv=3e5,Qe={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},gt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},ed=class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=R.log.bind(R,"[info]:"),this.warn=R.warn.bind(R,"[warning]:"),this.error=R.error.bind(R,"[error]:"),this.registerListeners()}registerListeners(){let e=this.hls;e.on(v.ERROR,this.onError,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this)}unregisterListeners(){let e=this.hls;!e||(e.off(v.ERROR,this.onError,this),e.off(v.ERROR,this.onErrorOut,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Z.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onError(e,t){var n;if(t.fatal)return;let i=this.hls,s=t.context;switch(t.details){case F.FRAG_LOAD_ERROR:case F.FRAG_LOAD_TIMEOUT:case F.KEY_LOAD_ERROR:case F.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case F.FRAG_GAP:case F.FRAG_PARSING_ERROR:case F.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Qe.SendAlternateToPenaltyBox;return}case F.LEVEL_EMPTY_ERROR:case F.LEVEL_PARSING_ERROR:{var a,o;let l=t.parent===Z.MAIN?t.level:i.loadLevel;t.details===F.LEVEL_EMPTY_ERROR&&!!((a=t.context)!=null&&(o=a.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case F.LEVEL_LOAD_ERROR:case F.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case F.AUDIO_TRACK_LOAD_ERROR:case F.AUDIO_TRACK_LOAD_TIMEOUT:case F.SUBTITLE_LOAD_ERROR:case F.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){let l=i.levels[i.loadLevel];if(l&&(s.type===pe.AUDIO_TRACK&&s.groupId===l.audioGroupId||s.type===pe.SUBTITLE_TRACK&&s.groupId===l.textGroupId)){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Qe.SendAlternateToPenaltyBox,t.errorAction.flags=gt.MoveAllAlternatesMatchingHost;return}}return;case F.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{let l=i.levels[i.loadLevel],c=l==null?void 0:l.attrs["HDCP-LEVEL"];c&&(t.errorAction={action:Qe.SendAlternateToPenaltyBox,flags:gt.MoveAllAlternatesMatchingHDCP,hdcpLevel:c})}return;case F.BUFFER_ADD_CODEC_ERROR:case F.REMUX_ALLOC_ERROR:t.errorAction=this.getLevelSwitchAction(t,(n=t.level)!=null?n:i.loadLevel);return;case F.INTERNAL_EXCEPTION:case F.BUFFER_APPENDING_ERROR:case F.BUFFER_APPEND_ERROR:case F.BUFFER_FULL_ERROR:case F.LEVEL_SWITCH_ERROR:case F.BUFFER_STALLED_ERROR:case F.BUFFER_SEEK_OVER_HOLE:case F.BUFFER_NUDGE_ON_STALL:t.errorAction={action:Qe.DoNothing,flags:gt.None};return}if(t.type===J.KEY_SYSTEM_ERROR){let l=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l);return}}getPlaylistRetryOrSwitchAction(e,t){var n,i;let s=this.hls,a=Qu(s.config.playlistLoadPolicy,e),o=this.playlistError++,l=(n=e.response)==null?void 0:n.code;return Yr(a,o,zr(e),l)?{action:Qe.RetryRequest,flags:gt.None,retryConfig:a,retryCount:o}:(i=e.context)!=null&&i.deliveryDirectives?{action:Qe.DoNothing,flags:gt.None,retryConfig:a||{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},retryCount:o}:this.getLevelSwitchAction(e,t)}getFragRetryOrSwitchAction(e){let t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,o=Qu(e.details.startsWith("key")?a:s,e),l=t.levels.reduce((d,h)=>d+h.fragmentError,0);if(i){var c;e.details!==F.FRAG_GAP&&i.fragmentError++;let d=(c=e.response)==null?void 0:c.code;if(Yr(o,l,zr(e),d))return{action:Qe.RetryRequest,flags:gt.None,retryConfig:o,retryCount:l}}let u=this.getLevelSwitchAction(e,n);return o&&(u.retryConfig=o,u.retryCount=l),u}getLevelSwitchAction(e,t){let n=this.hls;t==null&&(t=n.loadLevel);let i=this.hls.levels[t];if(i&&(i.loadError++,n.autoLevelEnabled)){var s,a;let o=-1,l=n.levels,c=(s=e.frag)==null?void 0:s.type,{type:u,groupId:d}=(a=e.context)!=null?a:{};for(let h=l.length;h--;){let f=(h+n.loadLevel)%l.length;if(f!==n.loadLevel&&l[f].loadError===0){let m=l[f];if(e.details===F.FRAG_GAP&&e.frag){let p=l[f].details;if(p){let g=Ui(e.frag,p.fragments,e.frag.start);if(g!=null&&g.gap)continue}}else{if(u===pe.AUDIO_TRACK&&d===m.audioGroupId||u===pe.SUBTITLE_TRACK&&d===m.textGroupId)continue;if(c===Z.AUDIO&&i.audioGroupId===m.audioGroupId||c===Z.SUBTITLE&&i.textGroupId===m.textGroupId)continue}o=f;break}}if(o>-1&&n.loadLevel!==o)return e.levelRetry=!0,{action:Qe.SendAlternateToPenaltyBox,flags:gt.None,nextAutoLevel:o}}return{action:Qe.SendAlternateToPenaltyBox,flags:gt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Qe.DoNothing:break;case Qe.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==F.FRAG_GAP&&(t.fatal=!0);break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){let t=this.hls,n=e.errorAction;if(!n)return;let{flags:i,hdcpLevel:s,nextAutoLevel:a}=n;switch(i){case gt.None:this.switchLevel(e,a);break;case gt.MoveAllAlternatesMatchingHost:n.resolved||(n.resolved=this.redundantFailover(e));break;case gt.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=Ta[Ta.indexOf(s)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,a)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){let{hls:t,penalizedRenditions:n}=this,i=e.parent===Z.MAIN?e.level:t.loadLevel,s=t.levels[i],a=s.url.length,o=e.frag?e.frag.urlId:s.urlId;s.urlId===o&&(!e.frag||s.details)&&this.penalizeRendition(s,e);for(let l=1;l<a;l++){let c=(o+l)%a,u=n[c];if(!u||Dv(u,e,n[o]))return this.warn(`Switching to Redundant Stream ${c+1}/${a}: "${s.url[c]}" after ${e.details}`),this.playlistError=0,t.levels.forEach(d=>{d.urlId=c}),t.nextLoadLevel=i,!0}return!1}penalizeRendition(e,t){let{penalizedRenditions:n}=this,i=n[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,n[e.urlId]=i}};function Dv(r,e,t){if(performance.now()-r.lastErrorPerfMs>kv)return!0;let n=r.details;if(e.details===F.FRAG_GAP&&n&&e.frag){let i=e.frag.start,s=Ui(null,n.fragments,i);if(s&&!s.gap)return!0}if(t&&r.errors.length<t.errors.length){let i=r.errors[r.errors.length-1];if(n&&i.frag&&e.frag&&Math.abs(i.frag.start-e.frag.start)>n.targetduration*3)return!0}return!1}var Xr=class{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=R.log.bind(R,`${t}:`),this.warn=R.warn.bind(R,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){let n=t==null?void 0:t.renditionReports;if(n){let i=-1;for(let s=0;s<n.length;s++){let a=n[s],o;try{o=new self.URL(a.URI,t.url).href}catch(l){R.warn(`Could not construct new URL for Rendition Report: ${l}`),o=a.URI||""}if(o===e){i=s;break}else o===e.substring(0,o.length)&&(i=s)}if(i!==-1){let s=n[i],a=parseInt(s["LAST-MSN"])||(t==null?void 0:t.lastPartSn),o=parseInt(s["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){let l=Math.min(t.age-t.partTarget,t.targetduration);o>=0&&l>t.partTarget&&(o+=1)}return new Ea(a,o>=0?o:void 0,Bi.No)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,n){let{details:i,stats:s}=t,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;if(i.advancedDateTime=Date.now()-o,i.live||n!=null&&n.live){if(i.reloaded(n),n&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED"}`),n&&i.fragments.length>0&&Av(n,i),!this.canLoad||!i.live)return;let l,c,u;if(i.canBlockReload&&i.endSN&&i.advanced){let g=this.hls.config.lowLatencyMode,T=i.lastPartSn,_=i.endSN,y=i.lastPartIndex,b=y!==-1,E=T===_,C=g?0:y;b?(c=E?_+1:T,u=E?C:y+1):c=_+1;let w=i.age,O=w+i.ageHeader,S=Math.min(O-i.partTarget,i.targetduration*1.5);if(S>0){if(n&&S>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${S} with playlist age: ${i.age}`),S=0;else{let I=Math.floor(S/i.targetduration);c+=I,u!==void 0&&(u+=Math.round(S%i.targetduration/i.partTarget)),this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${w.toFixed(2)}s goal: ${S} skip sn ${I} to part ${u}`)}i.tuneInGoal=S}if(l=this.getDeliveryDirectives(i,t.deliveryDirectives,c,u),g||!E){this.loadPlaylist(l);return}}else i.canBlockReload&&(l=this.getDeliveryDirectives(i,t.deliveryDirectives,c,u));let d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,f=(i.edge-h)*1e3,m=wv(i,f);i.updated&&a>this.requestScheduled+m&&(this.requestScheduled=s.loading.start),c!==void 0&&i.canBlockReload?this.requestScheduled=s.loading.first+m-(i.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+m<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=m);let p=this.requestScheduled-a;p=Math.max(0,p),this.log(`reload live playlist ${e} in ${Math.round(p)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),p)}else this.clearTimer()}getDeliveryDirectives(e,t,n,i){let s=Tv(e,n);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,s=Bi.No),new Ea(n,i,s)}checkRetry(e){let t=e.details,n=zr(e),i=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=i||{},l=s===Qe.RetryRequest&&!!i&&!!o;if(l){var c;if(this.requestScheduled=-1,n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{let u=Aa(o,a);this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,i.resolved=!0}return l}},La,td=class extends Xr{constructor(e,t){super(e,"[level-controller]");this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.ERROR,this.onError,this)}_unregisterListeners(){let{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let n=[],i={},s;t.levels.forEach(a=>{var o;let l=a.attrs;((o=a.audioCodec)==null?void 0:o.indexOf("mp4a.40.34"))!==-1&&(La||(La=/chrome|firefox/i.test(navigator.userAgent)),La&&(a.audioCodec=void 0));let{AUDIO:c,CODECS:u,"FRAME-RATE":d,"PATHWAY-ID":h,RESOLUTION:f,SUBTITLES:m}=l,g=`${`${h||"."}-`}${a.bitrate}-${f}-${d}-${u}`;s=i[g],s?s.addFallback(a):(s=new ti(a),i[g]=s,n.push(s)),Qr(s,"audio",c),Qr(s,"text",m)}),this.filterAndSortMediaOptions(n,t)}filterAndSortMediaOptions(e,t){let n=[],i=[],s=!1,a=!1,o=!1,l=e.filter(({audioCodec:f,videoCodec:m,width:p,height:g,unknownCodecs:T})=>(s||(s=!!(p&&g)),a||(a=!!m),o||(o=!!f),!(T!=null&&T.length)&&(!f||pa(f,"audio"))&&(!m||pa(m,"video"))));if((s||a)&&o&&(l=l.filter(({videoCodec:f,width:m,height:p})=>!!f||!!(m&&p))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let f=new Error("no level with compatible codecs found in manifest");this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:f,reason:f.message})}});return}t.audioTracks&&(n=t.audioTracks.filter(f=>!f.audioCodec||pa(f.audioCodec,"audio")),nd(n)),t.subtitles&&(i=t.subtitles,nd(i));let c=l.slice(0);l.sort((f,m)=>f.attrs["HDCP-LEVEL"]!==m.attrs["HDCP-LEVEL"]?(f.attrs["HDCP-LEVEL"]||"")>(m.attrs["HDCP-LEVEL"]||"")?1:-1:f.bitrate!==m.bitrate?f.bitrate-m.bitrate:f.attrs["FRAME-RATE"]!==m.attrs["FRAME-RATE"]?f.attrs.decimalFloatingPoint("FRAME-RATE")-m.attrs.decimalFloatingPoint("FRAME-RATE"):f.attrs.SCORE!==m.attrs.SCORE?f.attrs.decimalFloatingPoint("SCORE")-m.attrs.decimalFloatingPoint("SCORE"):s&&f.height!==m.height?f.height-m.height:0);let u=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let f=0;f<c.length;f++)if(c[f].pathwayId===l[0].pathwayId){u=c[f];break}}this._levels=l;for(let f=0;f<l.length;f++)if(l[f]===u){this._firstLevel=f,this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${u.bitrate}`);break}let d=o&&!a,h={levels:l,audioTracks:n,subtitleTracks:i,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:a,altAudio:!d&&n.some(f=>!!f.url)};this.hls.trigger(v.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){let t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){let u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(v.ERROR,{type:J.OTHER_ERROR,details:F.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}let n=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&a.details&&i&&s===o)return;this.log(`Switching to level ${e}${o?" with Pathway "+o:""} from level ${n}${s?" with Pathway "+s:""}`);let l=Oe({},a,{level:e,maxBitrate:a.maxBitrate,attrs:a.attrs,uri:a.uri,urlId:a.urlId});delete l._attrs,delete l._urlId,this.hls.trigger(v.LEVEL_SWITCHING,l);let c=a.details;if(!c||c.live){let u=this.switchParams(a.uri,i==null?void 0:i.details);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){let e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===pe.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(t!==void 0&&t.type===Z.MAIN){let n=this._levels[t.level];n!==void 0&&(n.loadError=0)}}onLevelLoaded(e,t){var n;let{level:i,details:s}=t,a=this._levels[i];if(!a){var o;this.warn(`Invalid level index ${i}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}i===this.currentLevelIndex?(a.fragmentError===0&&(a.loadError=0),this.playlistLoaded(i,t,a.details)):(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){let n=this.currentLevel;if(!n)return;let i=this.hls.audioTracks[t.id].groupId;if(n.audioGroupIds&&n.audioGroupId!==i){let s=-1;for(let a=0;a<n.audioGroupIds.length;a++)if(n.audioGroupIds[a]===i){s=a;break}s!==-1&&s!==n.urlId&&(n.urlId=s,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();let t=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){let i=n.urlId,s=n.uri;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}let a=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${a?" Pathway "+a:""} URI ${i+1}/${n.url.length} ${s}`),this.clearTimer(),this.hls.trigger(v.LEVEL_LOADING,{url:s,level:t,id:i,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){let n=(s,a)=>a!==t,i=this._levels.filter((s,a)=>a!==e?!0:s.url.length>1&&t!==void 0?(s.url=s.url.filter(n),s.audioGroupIds&&(s.audioGroupIds=s.audioGroupIds.filter(n)),s.textGroupIds&&(s.textGroupIds=s.textGroupIds.filter(n)),s.urlId=0,!0):(this.steering&&this.steering.removeLevel(s),!1));this.hls.trigger(v.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){t.forEach((n,i)=>{let{details:s}=n;s!=null&&s.fragments&&s.fragments.forEach(a=>{a.level=i})}),this._levels=t}};function Qr(r,e,t){!t||(e==="audio"?(r.audioGroupIds||(r.audioGroupIds=[]),r.audioGroupIds[r.url.length-1]=t):e==="text"&&(r.textGroupIds||(r.textGroupIds=[]),r.textGroupIds[r.url.length-1]=t))}function nd(r){let e={};r.forEach(t=>{let n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}var Ve={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},id=class{constructor(e){this.mainFragEntity=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(v.BUFFER_APPENDED,this.onBufferAppended,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){let{hls:e}=this;e.off(v.BUFFER_APPENDED,this.onBufferAppended,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.mainFragEntity=this.activeParts=null}getAppendedFrag(e,t){if(t===Z.MAIN){let{mainFragEntity:n,activeParts:i}=this;if(n){if(n&&i)for(let s=i.length;s--;){let a=i[s],o=a?a.end:n.appendedPTS;if(a.start<=e&&o!==null&&e<=o)return s>9&&(this.activeParts=i.slice(s-9)),a}else if(n.body.start<=e&&n.appendedPTS!==null&&e<=n.appendedPTS)return n.body}}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){let{fragments:n}=this,i=Object.keys(n);for(let s=i.length;s--;){let a=n[i[s]];if((a==null?void 0:a.body.type)===t&&a.buffered){let o=a.body;if(o.start<=e&&e<=o.end)return o}}return null}detectEvictedFragments(e,t,n){this.timeRanges&&(this.timeRanges[e]=t),Object.keys(this.fragments).forEach(i=>{let s=this.fragments[i];if(!s)return;if(!s.buffered&&!s.loaded){s.body.type===n&&this.removeFragment(s.body);return}let a=s.range[e];!a||a.time.some(o=>{let l=!this.isTimeBuffered(o.startPTS,o.endPTS,t);return l&&this.removeFragment(s.body),l})})}detectPartialFragments(e){let t=this.timeRanges,{frag:n,part:i}=e;if(!t||n.sn==="initSegment")return;let s=yn(n),a=this.fragments[s];!a||(Object.keys(t).forEach(o=>{let l=n.elementaryStreams[o];if(!l)return;let c=t[o],u=i!==null||l.partial===!0;a.range[o]=this.getBufferedTimes(n,i,u,c)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,a.body.endList&&(this.endListFragments[a.body.type]=a)):this.removeFragment(a.body))}fragBuffered(e,t){let n=yn(e),i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,n,i){let s={time:[],partial:n},a=t?t.start:e.start,o=t?t.end:e.end,l=e.minEndPTS||o,c=e.maxStartPTS||a;for(let u=0;u<i.length;u++){let d=i.start(u)-this.bufferPadding,h=i.end(u)+this.bufferPadding;if(c>=d&&l<=h){s.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(o,i.end(u))});break}else if(a<h&&o>d)s.partial=!0,s.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(o,i.end(u))});else if(o<=d)break}return s}getPartialFragment(e){let t=null,n,i,s,a=0,{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{let u=l[c];!u||Ia(u)&&(i=u.body.start-o,s=u.body.end+o,e>=i&&e<=s&&(n=Math.min(e-i,s-e),a<=n&&(t=u.body,a=n)))}),t}isEndListAppended(e){let t=this.endListFragments[e];return t!==void 0&&(t.buffered||Ia(t))}getState(e){let t=yn(e),n=this.fragments[t];return n?n.buffered?Ia(n)?Ve.PARTIAL:Ve.OK:Ve.APPENDING:Ve.NOT_LOADED}isTimeBuffered(e,t,n){let i,s;for(let a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,s=n.end(a)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onFragLoaded(e,t){let{frag:n,part:i}=t;if(n.sn==="initSegment"||n.bitrateTest||i)return;let s=yn(n);this.fragments[s]={body:n,appendedPTS:null,loaded:t,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){let{frag:n,part:i,timeRanges:s}=t,a=this.mainFragEntity;if(n.type===Z.MAIN){let o=a?a.body:null;if(o!==n){a&&o&&o.sn!==n.sn&&(a.buffered=!0,this.fragments[yn(o)]=a);let l=yn(n);a=this.mainFragEntity=this.fragments[l]||{body:n,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)}}if(i){let l=this.activeParts;l||(this.activeParts=l=[]),l.push(i)}else this.activeParts=null}this.timeRanges=s,Object.keys(s).forEach(o=>{let l=s[o];if(this.detectEvictedFragments(o,l),!i&&a){let c=n.elementaryStreams[o];if(!c)return;for(let u=0;u<l.length;u++){let d=l.end(u);d<=c.endPTS&&d>c.startPTS?a.appendedPTS=Math.max(d,a.appendedPTS||0):a.appendedPTS=c.endPTS}}})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){let t=yn(e);return!!this.fragments[t]}removeFragmentsInRange(e,t,n,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{let o=this.fragments[a];if(!o)return;let l=o.body;l.type!==n||i&&!l.gap||l.start<t&&l.end>e&&(o.buffered||s)&&this.removeFragment(l)})}removeFragment(e){let t=yn(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),this.mainFragEntity===this.fragments[t]&&(this.mainFragEntity=null),delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.mainFragEntity=null,this.activeParts=null,this.hasGaps=!1}};function Ia(r){var e,t;return r.buffered&&(r.body.gap||((e=r.range.video)==null?void 0:e.partial)||((t=r.range.audio)==null?void 0:t.partial))}function yn(r){return`${r.type}_${r.level}_${r.urlId}_${r.sn}`}var rd=Math.pow(2,17),sd=class{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){let n=e.url;if(!n)return Promise.reject(new Ut({type:J.NETWORK_ERROR,details:F.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();let i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap){l(od(e));return}let c=this.loader=e.loader=s?new s(i):new a(i),u=ad(e),d=Ju(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?Infinity:rd};e.stats=c.stats,c.load(u,h,{onSuccess:(f,m,p,g)=>{this.resetLoader(e,c);let T=f.data;p.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(T.slice(0,16)),T=T.slice(16)),o({frag:e,part:null,payload:T,networkDetails:g})},onError:(f,m,p,g)=>{this.resetLoader(e,c),l(new Ut({type:J.NETWORK_ERROR,details:F.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ze({url:n,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:p,stats:g}))},onAbort:(f,m,p)=>{this.resetLoader(e,c),l(new Ut({type:J.NETWORK_ERROR,details:F.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:p,stats:f}))},onTimeout:(f,m,p)=>{this.resetLoader(e,c),l(new Ut({type:J.NETWORK_ERROR,details:F.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:p,stats:f}))},onProgress:(f,m,p,g)=>{t&&t({frag:e,part:null,payload:p,networkDetails:g})}})})}loadPart(e,t,n){this.abort();let i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(od(e,t));return}let c=this.loader=e.loader=s?new s(i):new a(i),u=ad(e,t),d=Ju(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:rd};t.stats=c.stats,c.load(u,h,{onSuccess:(f,m,p,g)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);let T={frag:e,part:t,payload:f.data,networkDetails:g};n(T),o(T)},onError:(f,m,p,g)=>{this.resetLoader(e,c),l(new Ut({type:J.NETWORK_ERROR,details:F.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ze({url:u.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:p,stats:g}))},onAbort:(f,m,p)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Ut({type:J.NETWORK_ERROR,details:F.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:p,stats:f}))},onTimeout:(f,m,p)=>{this.resetLoader(e,c),l(new Ut({type:J.NETWORK_ERROR,details:F.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:p,stats:f}))}})})}updateStatsFromPart(e,t){let n=e.stats,i=t.stats,s=i.total;if(n.loaded+=i.loaded,s){let l=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/s),l),d=(l-c)*Math.round(n.loaded/c);n.total=n.loaded+d}else n.total=Math.max(n.loaded,n.total);let a=n.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}};function ad(r,e=null){let t=e||r,n={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(X(i)&&X(s)){var a;let o=i,l=s;if(r.sn==="initSegment"&&((a=r.decryptdata)==null?void 0:a.method)==="AES-128"){let c=s-i;c%16&&(l=s+(16-c%16)),i!==0&&(n.resetIV=!0,o=i-16)}n.rangeStart=o,n.rangeEnd=l}return n}function od(r,e){let t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),n={type:J.MEDIA_ERROR,details:F.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(n.part=e),(e||r).stats.aborted=!0,new Ut(n)}var Ut=class extends Error{constructor(e){super(e.error.message);this.data=void 0,this.data=e}},ld=class{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(){for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e].loader;t&&t.abort()}}detach(){for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=F.KEY_LOAD_ERROR,n,i,s){return new Ut({type:J.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){let{sn:n,cc:i}=e;for(let s=0;s<t.length;s++){let a=t[s];if(i<=a.cc&&(n==="initSegment"||a.sn==="initSegment"||n<a.sn)){this.emeController.selectKeySystemFormat(a).then(o=>{a.setKeyFormat(o)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);let s=e.decryptdata;if(!s){let c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,F.KEY_LOAD_ERROR,c))}let a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,F.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let o=this.keyUriToKeyInfo[a];if((n=o)!=null&&n.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if((i=o)!=null&&i.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(c=>(s.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,F.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){let n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){let i=this.emeController.loadKey(n);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,n))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(n)}loadKeyHTTP(e,t){let n=this.config,i=n.loader,s=new i(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{let l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,m,p)=>{let{frag:g,keyInfo:T,url:_}=m;if(!g.decryptdata||T!==this.keyUriToKeyInfo[_])return o(this.createKeyLoadError(g,F.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));T.decryptdata.key=g.decryptdata.key=new Uint8Array(h.data),g.keyLoader=null,T.loader=null,a({frag:g,keyInfo:T})},onError:(h,f,m,p)=>{this.resetLoader(f),o(this.createKeyLoadError(t,F.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),m,ze({url:l.url,data:void 0},h)))},onTimeout:(h,f,m)=>{this.resetLoader(f),o(this.createKeyLoadError(t,F.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(h,f,m)=>{this.resetLoader(f),o(this.createKeyLoadError(t,F.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};s.load(l,u,d)})}resetLoader(e){let{frag:t,keyInfo:n,url:i}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}},cd=class{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}},xv={length:0,start:()=>0,end:()=>0},_e=class{static isBuffered(e,t){try{if(e){let n=_e.getBuffered(e);for(let i=0;i<n.length;i++)if(t>=n.start(i)&&t<=n.end(i))return!0}}catch(n){}return!1}static bufferInfo(e,t,n){try{if(e){let i=_e.getBuffered(e),s=[],a;for(a=0;a<i.length;a++)s.push({start:i.start(a),end:i.end(a)});return this.bufferedInfo(s,t,n)}}catch(i){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.sort(function(c,u){let d=c.start-u.start;return d||u.end-c.end});let i=[];if(n)for(let c=0;c<e.length;c++){let u=i.length;if(u){let d=i[u-1].end;e[c].start-d<n?e[c].end>d&&(i[u-1].end=e[c].end):i.push(e[c])}else i.push(e[c])}else i=e;let s=0,a,o=t,l=t;for(let c=0;c<i.length;c++){let u=i[c].start,d=i[c].end;if(t+n>=u&&t<d)o=u,l=d,s=l-t;else if(t+n<u){a=u;break}}return{len:s,start:o||0,end:l||0,nextStart:a}}static getBuffered(e){try{return e.buffered}catch(t){return R.log("failed to get media.buffered",t),xv}}},Jr=class{constructor(e,t,n,i=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Zr(),this.buffering={audio:Zr(),video:Zr(),audiovideo:Zr()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=s,this.partial=a}};function Zr(){return{start:0,executeStart:0,executeEnd:0,end:0}}function ud(r,e){let t=null;for(let n=0,i=r.length;n<i;n++){let s=r[n];if(s&&s.cc===e){t=s;break}}return t}function Ov(r,e,t){return!!(e.details&&(t.endCC>t.startCC||r&&r.cc<t.startCC))}function Mv(r,e,t=0){let n=r.fragments,i=e.fragments;if(!i.length||!n.length){R.log("No fragments to align");return}let s=ud(n,i[0].cc);if(!s||s&&!s.startPTS){R.log("No frag in previous level to align on");return}return s}function dd(r,e){if(r){let t=r.start+e;r.start=r.startPTS=t,r.endPTS=t+r.duration}}function Ca(r,e){let t=e.fragments;for(let n=0,i=t.length;n<i;n++)dd(t[n],r);e.fragmentHint&&dd(e.fragmentHint,r),e.alignedSliding=!0}function Bv(r,e,t){!e||(Fv(r,t,e),!t.alignedSliding&&e.details&&Nv(t,e.details),!t.alignedSliding&&e.details&&!t.skippedSegments&&zu(e.details,t))}function Fv(r,e,t){if(Ov(r,t,e)){let n=Mv(t.details,e);n&&X(n.start)&&(R.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),Ca(n.start,e))}}function Nv(r,e){if(!e.fragments.length||!r.hasProgramDateTime||!e.hasProgramDateTime)return;let t=e.fragments[0].programDateTime,n=r.fragments[0].programDateTime,i=(n-t)/1e3+e.fragments[0].start;i&&X(i)&&(R.log(`Adjusting PTS using programDateTime delta ${n-t}ms, sliding:${i.toFixed(3)} ${r.url} `),Ca(i,r))}function hd(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;let t=r.fragments,n=e.fragments;if(!t.length||!n.length)return;let i=Math.round(n.length/2)-1,s=n[i],a=ud(t,s.cc)||t[Math.round(t.length/2)-1],o=s.programDateTime,l=a.programDateTime;if(o===null||l===null)return;let c=(l-o)/1e3-(a.start-s.start);Ca(c,r)}var fd=class{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}},md=class{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}};function Uv(r){let e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?kn(r,0,e-t):r}var pd=class{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){let t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(i*4);return n}initTable(){let e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],s=n[1],a=n[2],o=n[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],h=l[3],f=new Uint32Array(256),m=0,p=0,g=0;for(g=0;g<256;g++)g<128?f[g]=g<<1:f[g]=g<<1^283;for(g=0;g<256;g++){let T=p^p<<1^p<<2^p<<3^p<<4;T=T>>>8^T&255^99,e[m]=T,t[T]=m;let _=f[m],y=f[_],b=f[y],E=f[T]*257^T*16843008;i[m]=E<<24|E>>>8,s[m]=E<<16|E>>>16,a[m]=E<<8|E>>>24,o[m]=E,E=b*16843009^y*65537^_*257^m*16843008,c[T]=E<<24|E>>>8,u[T]=E<<16|E>>>16,d[T]=E<<8|E>>>24,h[T]=E,m?(m=_^f[f[f[b^_]]],p^=f[f[p]]):m=p=1}}expandKey(e){let t=this.uint8ArrayToUint32Array_(e),n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;let s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);let a=this.ksRows=(s+6+1)*4,o,l,c=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),d=this.sBox,h=this.rcon,f=this.invSubMix,m=f[0],p=f[1],g=f[2],T=f[3],_,y;for(o=0;o<a;o++){if(o<s){_=c[o]=t[o];continue}y=_,o%s==0?(y=y<<8|y>>>24,y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[y&255],y^=h[o/s|0]<<24):s>6&&o%s==4&&(y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[y&255]),c[o]=_=(c[o-s]^y)>>>0}for(l=0;l<a;l++)o=a-l,l&3?y=c[o]:y=c[o-4],l<4||o<=4?u[l]=y:u[l]=m[d[y>>>24]]^p[d[y>>>16&255]]^g[d[y>>>8&255]]^T[d[y&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){let i=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],u=o[2],d=o[3],h=this.uint8ArrayToUint32Array_(n),f=h[0],m=h[1],p=h[2],g=h[3],T=new Int32Array(e),_=new Int32Array(T.length),y,b,E,C,w,O,S,I,N,B,A,M,$,q,Y=this.networkToHostOrderSwap;for(;t<T.length;){for(N=Y(T[t]),B=Y(T[t+1]),A=Y(T[t+2]),M=Y(T[t+3]),w=N^s[0],O=M^s[1],S=A^s[2],I=B^s[3],$=4,q=1;q<i;q++)y=l[w>>>24]^c[O>>16&255]^u[S>>8&255]^d[I&255]^s[$],b=l[O>>>24]^c[S>>16&255]^u[I>>8&255]^d[w&255]^s[$+1],E=l[S>>>24]^c[I>>16&255]^u[w>>8&255]^d[O&255]^s[$+2],C=l[I>>>24]^c[w>>16&255]^u[O>>8&255]^d[S&255]^s[$+3],w=y,O=b,S=E,I=C,$=$+4;y=a[w>>>24]<<24^a[O>>16&255]<<16^a[S>>8&255]<<8^a[I&255]^s[$],b=a[O>>>24]<<24^a[S>>16&255]<<16^a[I>>8&255]<<8^a[w&255]^s[$+1],E=a[S>>>24]<<24^a[I>>16&255]<<16^a[w>>8&255]<<8^a[O&255]^s[$+2],C=a[I>>>24]<<24^a[w>>16&255]<<16^a[O>>8&255]<<8^a[S&255]^s[$+3],_[t]=Y(y^f),_[t+1]=Y(C^m),_[t+2]=Y(E^p),_[t+3]=Y(b^g),f=N,m=B,p=A,g=M,t=t+4}return _.buffer}},$v=16,es=class{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{let n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch(n){}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){let{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;let n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Uv(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n){return this.useSoftware?new Promise((i,s)=>{this.softwareDecrypt(new Uint8Array(e),t,n);let a=this.flush();a?i(a.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n)}softwareDecrypt(e,t,n){let{currentIV:i,currentResult:s,remainderData:a}=this;this.logOnce("JS AES decrypt"),a&&(e=Dn(a,e),this.remainderData=null);let o=this.getValidChunk(e);if(!o.length)return null;i&&(n=i);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new pd),l.expandKey(t);let c=s;return this.currentResult=l.decrypt(o.buffer,0,n),this.currentIV=kn(o,-16).buffer,c||null}webCryptoDecrypt(e,t,n){let i=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new md(i,t)),this.fastAesKey.expandKey().then(s=>i?(this.logOnce("WebCrypto AES decrypt"),new fd(i,new Uint8Array(n)).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(R.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n)))}onWebCryptoError(e,t,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n);let i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e,n=e.length-e.length%$v;return n!==e.length&&(t=kn(e,0,n),this.remainderData=kn(e,n)),t}logOnce(e){!this.logEnabled||(R.log(`[decrypter]: ${e}`),this.logEnabled=!1)}},Gv={toString:function(r){let e="",t=r.length;for(let n=0;n<t;n++)e+=`[${r.start(n).toFixed(3)}-${r.end(n).toFixed(3)}]`;return e}},U={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},ts=class extends cd{constructor(e,t,n,i,s){super();this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=U.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=i,this.log=R.log.bind(R,`${i}:`),this.warn=R.warn.bind(R,`${i}:`),this.hls=e,this.fragmentLoader=new sd(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new es(e.config),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort();let e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=U.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;let n=t.partList;if(n!=null&&n.length){let s=n[n.length-1];return _e.isBuffered(this.media,s.start+s.duration/2)}let i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levels[this.levelLastLoaded])==null?void 0:e.details}}onMediaAttached(e,t){let n=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);let i=this.config;this.levels&&i.autoStartLoad&&this.state===U.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(){let e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){let{config:e,fragCurrent:t,media:n,mediaBuffer:i,state:s}=this,a=n?n.currentTime:0,o=_e.bufferInfo(i||n,a,e.maxBufferHole);if(this.log(`media seeking to ${X(a)?a.toFixed(3):a}, state: ${s}`),this.state===U.ENDED)this.resetLoadingState();else if(t){let l=e.maxFragLookUpTolerance,c=t.start-l,u=t.start+t.duration+l;if(!o.len||u<o.start||c>o.end){let d=a>u;(a<c||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests()),this.resetLoadingState())}}n&&(this.fragmentTracker.removeFragmentsInRange(a,Infinity,this.playlistType,!0),this.lastCurrentTime=a),!this.loadedmetadata&&!o.len&&(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=U.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){let i=s=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${s.part?" p: "+s.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,i).then(s=>{if(!s)return;let a=this.state;if(this.fragContextChanged(e)){(a===U.FRAG_LOADING||!this.fragCurrent&&a===U.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=U.IDLE);return}"payload"in s&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(v.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===U.STOPPED||this.state===U.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;if(this.fragmentTracker.getState(e)===Ve.APPENDING){let i=e.type,s=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,s?s.len:this.config.maxBufferLength);this.reduceMaxBufferLength(a)&&this.fragmentTracker.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0&&this.fragmentTracker.removeAllFragments()}flushMainBuffer(e,t,n=null){if(!(e-t))return;let i={startOffset:e,endOffset:t,type:n};this.hls.trigger(v.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{if(!n||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{let{hls:i}=this,{payload:s}=n,a=e.decryptdata;if(s&&s.byteLength>0&&a&&a.key&&a.iv&&a.method==="AES-128"){let o=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),a.key.buffer,a.iv.buffer).catch(l=>{throw i.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{let c=self.performance.now();return i.trigger(v.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:o,tdecrypt:c}}),n.payload=l,n})}return n}).then(n=>{let{fragCurrent:i,hls:s,levels:a}=this;if(!a)throw new Error("init load aborted, missing levels");let o=e.stats;this.state=U.IDLE,t.fragmentError=0,e.data=new Uint8Array(n.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),n.frag===i&&s.trigger(v.FRAG_BUFFERED,{stats:o,frag:i,part:null,id:e.type}),this.tick()}).catch(n=>{this.state===U.STOPPED||this.state===U.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}fragContextChanged(e){let{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var n,i,s,a;let o=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level} (frag:[${((n=e.startPTS)!=null?n:NaN).toFixed(3)}-${((i=e.endPTS)!=null?i:NaN).toFixed(3)}] > buffer:${o?Gv.toString(_e.getBuffered(o)):"(detached)"})`),this.state=U.IDLE,!!o&&(!this.loadedmetadata&&e.type==Z.MAIN&&o.buffered.length&&((s=this.fragCurrent)==null?void 0:s.sn)===((a=this.fragPrevious)==null?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){let{transmuxer:t}=this;if(!t)return;let{frag:n,part:i,partsLoaded:s}=e,a=!s||s.length===0||s.some(l=>!l),o=new Jr(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var s;let a=t==null?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=U.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(u=>{if(!this.fragContextChanged(u.frag))return this.hls.trigger(v.KEY_LOADED,u),this.state===U.KEY_LOADING&&(this.state=U.IDLE),u}),this.hls.trigger(v.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments),n=Math.max(e.start,n||0),this.config.lowLatencyMode){let u=a.partList;if(u&&i){n>e.end&&a.fragmentHint&&(e=a.fragmentHint);let d=this.getNextPart(u,e,n);if(d>-1){let h=u[d];this.log(`Loading part sn: ${e.sn} p: ${h.index} cc: ${e.cc} of playlist [${a.startSN}-${a.endSN}] parts [0-${d}-${u.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=U.FRAG_LOADING;let f;return o?f=o.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(e,h,t,i)).catch(m=>this.handleFragLoadError(m)):f=this.doFragPartsLoad(e,h,t,i).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(v.FRAG_LOADING,{frag:e,part:h,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):f}else if(!e.url||this.loadedEndOfParts(u,n))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${a?"of ["+a.startSN+"-"+a.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),X(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=U.FRAG_LOADING;let l=this.config.progressive,c;return l&&o?c=o.then(u=>!u||this.fragContextChanged(u==null?void 0:u.frag)?null:this.fragmentLoader.load(e,i)).catch(u=>this.handleFragLoadError(u)):c=Promise.all([this.fragmentLoader.load(e,l?i:void 0),o]).then(([u])=>(!l&&u&&i&&i(u),u)).catch(u=>this.handleFragLoadError(u)),this.hls.trigger(v.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,n,i){return new Promise((s,a)=>{var o;let l=[],c=(o=n.details)==null?void 0:o.partList,u=d=>{this.fragmentLoader.loadPart(e,d,i).then(h=>{l[d.index]=h;let f=h.part;this.hls.trigger(v.FRAG_LOADED,h);let m=Xu(n,e.sn,d.index+1)||Yu(c,e.sn,d.index+1);if(m)u(m);else return s({frag:e,part:f,partsLoaded:l})}).catch(a)};u(t)})}handleFragLoadError(e){if("data"in e){let t=e.data;e.data&&t.details===F.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(v.ERROR,t)}else this.hls.trigger(v.ERROR,{type:J.OTHER_ERROR,details:F.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){let t=this.getCurrentContext(e);if(!t||this.state!==U.PARSING){!this.fragCurrent&&this.state!==U.STOPPED&&this.state!==U.ERROR&&(this.state=U.IDLE);return}let{frag:n,part:i,level:s}=t,a=self.performance.now();n.stats.parsing.end=a,i&&(i.stats.parsing.end=a),this.updateLevelTiming(n,i,s,e.partial)}getCurrentContext(e){let{levels:t,fragCurrent:n}=this,{level:i,sn:s,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of level ${i}. The current chunk will not be buffered.`),null;let o=t[i],l=a>-1?Xu(o,s,a):null,c=l?l.fragment:Lv(o,s,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:l,level:o}):null}bufferFragmentData(e,t,n,i){var s;if(!e||this.state!==U.PARSING)return;let{data1:a,data2:o}=e,l=a;if(a&&o&&(l=Dn(a,o)),!((s=l)!=null&&s.length))return;let c={type:e.type,frag:t,part:n,chunkMeta:i,parent:t.type,data:l};this.hls.trigger(v.BUFFER_APPENDING,c),e.dropped&&e.independent&&!n&&this.flushBufferGap(t)}flushBufferGap(e){let t=this.media;if(!t)return;if(!_e.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}let n=t.currentTime,i=_e.bufferInfo(t,n,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,i.end-a),n+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){let n=this.getLoadPosition();return X(n)?this.getFwdBufferInfoAtPos(e,n,t):null}getFwdBufferInfoAtPos(e,t,n){let{config:{maxBufferHole:i}}=this,s=_e.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){let a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&s.nextStart<a.end)return _e.bufferInfo(e,t,Math.max(s.nextStart,i))}return s}getMaxBufferLength(e){let{config:t}=this,n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e){let t=this.config,n=e||t.maxBufferLength;return t.maxMaxBufferLength>=n?(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0):!1}getNextFragment(e,t){let n=t.fragments,i=n.length;if(!i)return null;let{config:s}=this,a=n[0].start,o;if(t.live){let l=s.initialLiveManifestSize;if(i<l)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${l})`),null;!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(o=this.getInitialLiveFragment(t,n),this.startPosition=o?this.hls.liveSyncPosition||o.start:e)}else e<=a&&(o=n[0]);if(!o){let l=s.lowLatencyMode?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(e,t){let n=this.fragmentTracker.getState(e);return(n===Ve.OK||n===Ve.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,s){let a=e.gap,o=this.getNextFragment(this.nextLoadPosition,t);if(o===null)return o;if(e=o,a&&e&&!e.gap&&n.nextStart){let l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i);if(l!==null&&n.len+l.len>=s)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let i=-1,s=!1,a=!0;for(let o=0,l=e.length;o<l;o++){let c=e[o];if(a=a&&!c.independent,i>-1&&n<c.start)break;let u=c.loaded;u?i=-1:(s||c.independent||a)&&c.fragment===t&&(i=o),s=u}return i}loadedEndOfParts(e,t){let n=e[e.length-1];return n&&t>n.start&&n.loaded}getInitialLiveFragment(e,t){let n=this.fragPrevious,i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=Rv(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){let s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){let a=t[s-e.startSN];n.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Pv(t,n.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{let s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){let{config:i}=this,{fragPrevious:s}=this,{fragments:a,endSN:o}=n,{fragmentHint:l}=n,c=i.maxFragLookUpTolerance,u=!!(i.lowLatencyMode&&n.partList&&l);u&&l&&!this.bitrateTest&&(a=a.concat(l),o=l.sn);let d;if(e<t){let h=e>t-c?0:c;d=Ui(s,a,e,h)}else d=a[a.length-1];if(d){let h=d.sn-n.startSN,f=this.fragmentTracker.getState(d);if((f===Ve.OK||f===Ve.PARTIAL&&d.gap)&&(s=d),s&&d.sn===s.sn&&!u&&s&&d.level===s.level){let p=a[h+1];d.sn<o&&this.fragmentTracker.getState(p)!==Ve.OK?d=p:d=null}}return d}synchronizeToLiveEdge(e){let{config:t,media:n}=this;if(!n)return;let i=this.hls.liveSyncPosition,s=n.currentTime,a=e.fragments[0].start,o=e.edge,l=s>=a-t.maxFragLookUpTolerance&&s<=o;if(i!==null&&n.duration>i&&(s<i||!l)){let c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&n.readyState<4||s<o-c)&&(this.loadedmetadata||(this.nextLoadPosition=i),n.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${i.toFixed(3)}`),n.currentTime=i))}}alignPlaylists(e,t){let{levels:n,levelLastLoaded:i,fragPrevious:s}=this,a=i!==null?n[i]:null,o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;let l=e.fragments[0].start,c=!t,u=e.alignedSliding&&X(l);if(c||!u&&!l){Bv(s,a,e);let d=e.fragments[0].start;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${s?s.sn:"na"} fragments: ${o}`),d}return l}waitForCdnTuneIn(e){let t=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*t)}setStartPosition(e,t){let n=this.startPosition;if(n<t&&(n=-1),n===-1||this.lastCurrentTime===-1){let i=this.startTimeOffset!==null,s=i?this.startTimeOffset:e.startTimeOffset;s!==null&&X(s)?(n=t+s,s<0&&(n+=e.totalduration),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Start time offset ${s} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${n}`),this.startPosition=n):e.live?n=this.hls.liveSyncPosition||t:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n}getLoadPosition(){let{media:e}=this,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part"+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==U.FRAG_LOADING_WAITING_RETRY)&&(this.state=U.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){let u=this.getCurrentContext(t.chunkMeta);u&&(t.frag=u.frag)}let n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var i;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}let s=t.details===F.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(n,!0);let a=t.errorAction,{action:o,retryCount:l=0,retryConfig:c}=a||{};if(a&&o===Qe.RetryRequest&&c){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);let u=Aa(c,l);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${u}ms`),a.resolved=!0,this.retryDate=self.performance.now()+u,this.state=U.FRAG_LOADING_WAITING_RETRY}else c&&a?(this.resetFragmentErrors(e),l<c.maxNumRetry?s||(a.resolved=!0):R.warn(`${t.details} reached or exceeded max retry (${l})`)):this.state=U.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===U.PARSING||this.state===U.PARSED){let t=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,t),i=n&&n.len>.5;i&&this.reduceMaxBufferLength(n.len);let s=!i;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===Z.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==U.STOPPED&&(this.state=U.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;let i=_e.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===U.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=U.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;let t=this.levels?this.levels[e].details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,Infinity,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){var s;let a=n.details;if(!a){this.warn("level.details undefined");return}if(Object.keys(e.elementaryStreams).reduce((l,c)=>{let u=e.elementaryStreams[c];if(u){let d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;let h=i?0:qu(a,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS);return this.hls.trigger(v.LEVEL_PTS_UPDATED,{details:a,level:n,drift:h,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1))n.fragmentError=0;else if(((s=this.transmuxer)==null?void 0:s.error)===null){let l=new Error(`Found no media in fragment ${e.sn} of level ${n.id} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=U.PARSED,this.hls.trigger(v.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())}set state(e){let t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}};function Ra(){if(typeof self!="undefined")return self.MediaSource||self.WebKitMediaSource}function gd(){return self.SourceBuffer||self.WebKitSourceBuffer}function Vv(){let r=Ra();if(!r)return!1;let e=gd(),t=r&&typeof r.isTypeSupported=="function"&&r.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function";return!!t&&!!n}function jv(){var r;let e=gd();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}function Hv(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Wv(){let r=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(r);return{worker:new self.Worker(e),objectURL:e}}function Kv(r){let e=new self.URL(r,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function $t(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}var Pa=class{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Dn(this.cachedData,e),this.cachedData=null);let n=Hr(e,0),i=n?n.length:0,s,a=this._audioTrack,o=this._id3Track,l=n?Gg(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&X(l))&&(this.basePTS=qv(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Pt.audioId3,duration:Number.POSITIVE_INFINITY});i<c;){if(this.canParse(e,i)){let u=this.appendFrame(a,e,i);u?(this.frameIndex++,this.lastPTS=u.sample.pts,i+=u.length,s=i):i=c}else Ug(e,i)?(n=Hr(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Pt.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,s=i):i++;if(i===c&&s!==c){let u=kn(e,s);this.cachedData?this.cachedData=Dn(this.cachedData,u):this.cachedData=u}}return{audioTrack:a,videoTrack:$t(),id3Track:o,textTrack:$t()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){let t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:$t(),id3Track:this._id3Track,textTrack:$t()}}destroy(){}},qv=(r,e,t)=>{if(X(r))return r*90;let n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};function zv(r,e,t,n){let i,s,a,o,l=navigator.userAgent.toLowerCase(),c=n,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=((e[t+2]&192)>>>6)+1;let d=(e[t+2]&60)>>>2;if(d>u.length-1){r.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${d}`});return}return a=(e[t+2]&1)<<2,a|=(e[t+3]&192)>>>6,R.log(`manifest codec:${n}, ADTS type:${i}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(i=5,o=new Array(4),s=d-3):(i=2,o=new Array(2),s=d):l.indexOf("android")!==-1?(i=2,o=new Array(2),s=d):(i=5,o=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&d>=6?s=d-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(d>=6&&a===1||/vivaldi/i.test(l))||!n&&a===1)&&(i=2,o=new Array(2)),s=d)),o[0]=i<<3,o[0]|=(d&14)>>1,o[1]|=(d&1)<<7,o[1]|=a<<3,i===5&&(o[1]|=(s&14)>>1,o[2]=(s&1)<<7,o[2]|=2<<2,o[3]=0),{config:o,samplerate:u[d],channelCount:a,codec:"mp4a.40."+i,manifestCodec:c}}function vd(r,e){return r[e]===255&&(r[e+1]&246)==240}function yd(r,e){return r[e+1]&1?7:9}function ka(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function Yv(r,e){return e+5<r.length}function ns(r,e){return e+1<r.length&&vd(r,e)}function Xv(r,e){return Yv(r,e)&&vd(r,e)&&ka(r,e)<=r.length-e}function Qv(r,e){if(ns(r,e)){let t=yd(r,e);if(e+t>=r.length)return!1;let n=ka(r,e);if(n<=t)return!1;let i=e+n;return i===r.length||ns(r,i)}return!1}function bd(r,e,t,n,i){if(!r.samplerate){let s=zv(e,t,n,i);if(!s)return;r.config=s.config,r.samplerate=s.samplerate,r.channelCount=s.channelCount,r.codec=s.codec,r.manifestCodec=s.manifestCodec,R.log(`parsed codec:${r.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function Td(r){return 1024*9e4/r}function Jv(r,e){let t=yd(r,e);if(e+t<=r.length){let n=ka(r,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function Ed(r,e,t,n,i){let s=Td(r.samplerate),a=n+i*s,o=Jv(e,t),l;if(o){let{frameLength:d,headerLength:h}=o,f=h+d,m=Math.max(0,t+f-e.length);m?(l=new Uint8Array(f-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+f);let p={unit:l,pts:a};return m||r.samples.push(p),{sample:p,length:f,missing:m}}let c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:c,missing:-1}}var Sd=class extends Pa{constructor(e,t){super();this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let n=(Hr(e,0)||[]).length;for(let i=e.length;n<i;n++)if(Qv(e,n))return R.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Xv(e,t)}appendFrame(e,t,n){bd(e,this.observer,t,n,e.manifestCodec);let i=Ed(e,t,n,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}},Zv=/\/emsg[-/]ID3/i,_d=class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){let s=this.videoTrack=$t("video",1),a=this.audioTrack=$t("audio",1),o=this.txtTrack=$t("text",1);if(this.id3Track=$t("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;let l=Au(e);if(l.video){let{id:c,timescale:u,codec:d}=l.video;s.id=c,s.timescale=o.timescale=u,s.codec=d}if(l.audio){let{id:c,timescale:u,codec:d}=l.audio;a.id=c,a.timescale=u,a.codec=d}o.id=Eu.text,s.sampleDuration=0,s.duration=a.duration=i}resetContiguity(){}static probe(e){return e=e.length>16384?e.subarray(0,16384):e,he(e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let n=e,i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Dn(this.remainderData,e));let o=tv(n);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=n;let a=this.extractID3Track(i,t);return s.samples=Iu(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){let e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;let i=this.extractID3Track(t,this.timeOffset);return n.samples=Iu(e,t),{videoTrack:t,audioTrack:$t(),id3Track:i,textTrack:$t()}}extractID3Track(e,t){let n=this.id3Track;if(e.samples.length){let i=he(e.samples,["emsg"]);i&&i.forEach(s=>{let a=rv(s);if(Zv.test(a.schemeIdUri)){let o=X(a.presentationTime)?a.presentationTime/a.timeScale:t+a.presentationTimeDelta/a.timeScale,l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);let c=a.payload;n.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:Pt.emsg,duration:l})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},is=null,ey=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ty=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ny=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],iy=[0,1,1,4];function wd(r,e,t,n,i){if(t+24>e.length)return;let s=Ad(e,t);if(s&&t+s.frameLength<=e.length){let a=s.samplesPerFrame*9e4/s.sampleRate,o=n+i*a,l={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return r.config=[],r.channelCount=s.channelCount,r.samplerate=s.sampleRate,r.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function Ad(r,e){let t=r[e+1]>>3&3,n=r[e+1]>>1&3,i=r[e+2]>>4&15,s=r[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){let a=r[e+2]>>1&1,o=r[e+3]>>6,l=t===3?3-n:n===3?3:4,c=ey[l*14+i-1]*1e3,d=ty[(t===3?0:t===2?1:2)*3+s],h=o===3?1:2,f=ny[t][n],m=iy[n],p=f*8*m,g=Math.floor(f*c/d+a)*m;if(is===null){let y=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);is=y?parseInt(y[1]):0}return!!is&&is<=87&&n===2&&c>=224e3&&o===0&&(r[e+3]=r[e+3]|128),{sampleRate:d,channelCount:h,frameLength:g,samplesPerFrame:p}}}function Da(r,e){return r[e]===255&&(r[e+1]&224)==224&&(r[e+1]&6)!=0}function Ld(r,e){return e+1<r.length&&Da(r,e)}function ry(r,e){let t=4;return Da(r,e)&&t<=r.length-e}function sy(r,e){if(e+1<r.length&&Da(r,e)){let t=4,n=Ad(r,e),i=t;n!=null&&n.frameLength&&(i=n.frameLength);let s=e+i;return s===r.length||Ld(r,s)}return!1}var xa=class{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(n,n+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;if(e>32&&R.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!=0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let e=this.skipLZ();return this.readBits(e+1)-1}readEG(){let e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,n=8,i;for(let s=0;s<e;s++)n!==0&&(i=this.readEG(),n=(t+i+256)%256),t=n===0?t:n}readSPS(){let e=0,t=0,n=0,i=0,s,a,o,l=this.readUByte.bind(this),c=this.readBits.bind(this),u=this.readUEG.bind(this),d=this.readBoolean.bind(this),h=this.skipBits.bind(this),f=this.skipEG.bind(this),m=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);l();let g=l();if(c(5),h(3),l(),m(),g===100||g===110||g===122||g===244||g===44||g===83||g===86||g===118||g===128){let C=u();if(C===3&&h(1),m(),m(),h(1),d())for(a=C!==3?8:12,o=0;o<a;o++)d()&&(o<6?p(16):p(64))}m();let T=u();if(T===0)u();else if(T===1)for(h(1),f(),f(),s=u(),o=0;o<s;o++)f();m(),h(1);let _=u(),y=u(),b=c(1);b===0&&h(1),h(1),d()&&(e=u(),t=u(),n=u(),i=u());let E=[1,1];if(d()&&d())switch(l()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:{E=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((_+1)*16-e*2-t*2),height:(2-b)*(y+1)*16-(b?2:4)*(n+i),pixelRatio:E}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}},Id=class{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new es(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,n){let i=e[t].unit;if(i.length<=16)return;let s=i.subarray(16,i.length-i.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{let l=new Uint8Array(o);i.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)})}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){let t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t),i=0;for(let s=32;s<e.length-16;s+=160,i+=16)n.set(e.subarray(s,s+16),i);return n}getAvcDecryptedUnit(e,t){let n=new Uint8Array(t),i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(n.subarray(i,i+16),s);return e}decryptAvcSample(e,t,n,i,s){let a=Cu(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)})}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){i();return}let s=e[t].units;for(;!(n>=s.length);n++){let a=s[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,n,i,a),!this.decrypter.isSync()))return}}}},Je=188,tn=class{constructor(e,t,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=n}static probe(e){let t=tn.syncOffset(e);return t>0&&R.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){let t=e.length,n=Math.min(Je*5,e.length-Je)+1,i=0;for(;i<n;){let s=!1;for(let a=i;a<t&&e[a]===71;a+=Je)if(!s&&Oa(e,a)===0&&(s=!0),s&&a+Je>n)return i;i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Eu[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=tn.createTrack("video"),this._audioTrack=tn.createTrack("audio",i),this._id3Track=tn.createTrack("id3"),this._txtTrack=tn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n,this._duration=i}resetTimeStamp(){}resetContiguity(){let{_audioTrack:e,_avcTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,n=!1,i=!1){n||(this.sampleAes=null);let s,a=this._avcTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack,u=a.pid,d=a.pesData,h=o.pid,f=l.pid,m=o.pesData,p=l.pesData,g=null,T=this.pmtParsed,_=this._pmtId,y=e.length;if(this.remainderData&&(e=Dn(this.remainderData,e),y=e.length,this.remainderData=null),y<Je&&!i)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};let b=Math.max(0,tn.syncOffset(e));y-=(y-b)%Je,y<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let E=0;for(let w=b;w<y;w+=Je)if(e[w]===71){let O=!!(e[w+1]&64),S=Oa(e,w),I=(e[w+3]&48)>>4,N;if(I>1){if(N=w+5+e[w+4],N===w+Je)continue}else N=w+4;switch(S){case u:O&&(d&&(s=ni(d))&&this.parseAVCPES(a,c,s,!1),d={data:[],size:0}),d&&(d.data.push(e.subarray(N,w+Je)),d.size+=w+Je-N);break;case h:if(O){if(m&&(s=ni(m)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(N,w+Je)),m.size+=w+Je-N);break;case f:O&&(p&&(s=ni(p))&&this.parseID3PES(l,s),p={data:[],size:0}),p&&(p.data.push(e.subarray(N,w+Je)),p.size+=w+Je-N);break;case 0:O&&(N+=e[N]+1),_=this._pmtId=ay(e,N);break;case _:{O&&(N+=e[N]+1);let B=oy(e,N,this.typeSupported,n);u=B.avc,u>0&&(a.pid=u),h=B.audio,h>0&&(o.pid=h,o.segmentCodec=B.segmentCodec),f=B.id3,f>0&&(l.pid=f),g!==null&&!T&&(R.warn(`MPEG-TS PMT found at ${w} after unknown PID '${g}'. Backtracking to sync byte @${b} to parse all TS packets.`),g=null,w=b-188),T=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=S;break}}else E++;if(E>0){let w=new Error(`Found ${E} TS packet/s that do not start with 0x47`);this.observer.emit(v.ERROR,v.ERROR,{type:J.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,fatal:!1,error:w,reason:w.message})}a.pesData=d,o.pesData=m,l.pesData=p;let C={audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};return i&&this.extractRemainingSamples(C),C}flush(){let{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){let{audioTrack:t,videoTrack:n,id3Track:i,textTrack:s}=e,a=n.pesData,o=t.pesData,l=i.pesData,c;if(a&&(c=ni(a))?(this.parseAVCPES(n,s,c,!0),n.pesData=null):n.pesData=a,o&&(c=ni(o))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break}t.pesData=null}else o!=null&&o.size&&R.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(c=ni(l))?(this.parseID3PES(i,c),i.pesData=null):i.pesData=l}demuxSampleAes(e,t,n){let i=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new Id(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(n=>{let{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this._duration=0}parseAVCPES(e,t,n,i){let s=this.parseAVCNALu(e,n.data),a=this.avcSample,o,l=!1;n.data=null,a&&s.length&&!e.audFound&&(Ma(a,e),a=this.avcSample=rs(!1,n.pts,n.dts,"")),s.forEach(c=>{switch(c.type){case 1:{o=!0,a||(a=this.avcSample=rs(!0,n.pts,n.dts,"")),a.frame=!0;let u=c.data;if(l&&u.length>4){let d=new xa(u).readSliceType();(d===2||d===4||d===7||d===9)&&(a.key=!0)}break}case 5:o=!0,a||(a=this.avcSample=rs(!0,n.pts,n.dts,"")),a.key=!0,a.frame=!0;break;case 6:{o=!0,Lu(c.data,1,n.pts,t.samples);break}case 7:if(o=!0,l=!0,!e.sps){let u=c.data,h=new xa(u).readSPS();e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.sps=[u],e.duration=this._duration;let f=u.subarray(1,4),m="avc1.";for(let p=0;p<3;p++){let g=f[p].toString(16);g.length<2&&(g="0"+g),m+=g}e.codec=m}break;case 8:o=!0,e.pps||(e.pps=[c.data]);break;case 9:o=!1,e.audFound=!0,a&&Ma(a,e),a=this.avcSample=rs(!1,n.pts,n.dts,"");break;case 12:o=!0;break;default:o=!1,a&&(a.debug+="unknown NAL "+c.type+" ");break}a&&o&&a.units.push(c)}),i&&a&&(Ma(a,e),this.avcSample=null)}getLastNalUnit(e){var t;let n=this.avcSample,i;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){let s=n.units;i=s[s.length-1]}return i}parseAVCNALu(e,t){let n=t.byteLength,i=e.naluState||0,s=i,a=[],o=0,l,c,u,d=-1,h=0;for(i===-1&&(d=0,h=t[0]&31,i=0,o=1);o<n;){if(l=t[o++],!i){i=l?0:1;continue}if(i===1){i=l?0:2;continue}if(!l)i=3;else if(l===1){if(d>=0){let f={data:t.subarray(d,o-i-1),type:h};a.push(f)}else{let f=this.getLastNalUnit(e.samples);if(f&&(s&&o<=4-s&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-s)),c=o-i-1,c>0)){let m=new Uint8Array(f.data.byteLength+c);m.set(f.data,0),m.set(t.subarray(0,c),f.data.byteLength),f.data=m,f.state=0}}o<n?(u=t[o]&31,d=o,h=u,i=0):i=-1}else i=0}if(d>=0&&i>=0){let f={data:t.subarray(d,n),type:h,state:i};a.push(f)}if(a.length===0){let f=this.getLastNalUnit(e.samples);if(f){let m=new Uint8Array(f.data.byteLength+t.byteLength);m.set(f.data,0),m.set(t,f.data.byteLength),f.data=m}}return e.naluState=i,a}parseAACPES(e,t){let n=0,i=this.aacOverFlow,s=t.data;if(i){this.aacOverFlow=null;let d=i.missing,h=i.sample.unit.byteLength;if(d===-1){let f=new Uint8Array(h+s.byteLength);f.set(i.sample.unit,0),f.set(s,h),s=f}else{let f=h-d;i.sample.unit.set(s.subarray(0,d),f),e.samples.push(i.sample),n=i.missing}}let a,o;for(a=n,o=s.length;a<o-1&&!ns(s,a);a++);if(a!==n){let d,h=a<o-1;h?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES";let f=new Error(d);if(R.warn(`parsing error: ${d}`),this.observer.emit(v.ERROR,v.ERROR,{type:J.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,fatal:!1,levelRetry:h,error:f,reason:d}),!h)return}bd(e,this.observer,s,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(i){let d=Td(e.samplerate);l=i.sample.pts+d}else{R.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;a<o;)if(u=Ed(e,s,a,l,c),a+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;a<o-1&&!ns(s,a);a++);}parseMPEGPES(e,t){let n=t.data,i=n.length,s=0,a=0,o=t.pts;if(o===void 0){R.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(Ld(n,a)){let l=wd(e,n,a,o,s);if(l)a+=l.length,s++;else break}else a++}parseID3PES(e,t){if(t.pts===void 0){R.warn("[tsdemuxer]: ID3 PES unknown PTS");return}let n=Oe({},t,{type:this._avcTrack?Pt.emsg:Pt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}};function rs(r,e,t,n){return{key:r,frame:!1,pts:e,dts:t,units:[],debug:n,length:0}}function Oa(r,e){return((r[e+1]&31)<<8)+r[e+2]}function ay(r,e){return(r[e+10]&31)<<8|r[e+11]}function oy(r,e,t,n){let i={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=(r[e+1]&15)<<8|r[e+2],a=e+3+s-4,o=(r[e+10]&15)<<8|r[e+11];for(e+=12+o;e<a;){let l=Oa(r,e);switch(r[e]){case 207:if(!n){R.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:i.audio===-1&&(i.audio=l);break;case 21:i.id3===-1&&(i.id3=l);break;case 219:if(!n){R.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:i.avc===-1&&(i.avc=l);break;case 3:case 4:t.mpeg!==!0&&t.mp3!==!0?R.log("MPEG audio found, not supported in this browser"):i.audio===-1&&(i.audio=l,i.segmentCodec="mp3");break;case 36:R.warn("Unsupported HEVC stream type found");break}e+=((r[e+3]&15)<<8|r[e+4])+5}return i}function ni(r){let e=0,t,n,i,s,a,o=r.data;if(!r||r.size===0)return null;for(;o[0].length<19&&o.length>1;){let c=new Uint8Array(o[0].length+o[1].length);c.set(o[0]),c.set(o[1],o[0].length),o[0]=c,o.splice(1,1)}if(t=o[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(n=(t[4]<<8)+t[5],n&&n>r.size-6)return null;let c=t[7];c&192&&(s=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,c&64?(a=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,s-a>60*9e4&&(R.warn(`${Math.round((s-a)/9e4)}s delta between PTS and DTS, align them`),s=a)):a=s),i=t[8];let u=i+9;if(r.size<=u)return null;r.size-=u;let d=new Uint8Array(r.size);for(let h=0,f=o.length;h<f;h++){t=o[h];let m=t.byteLength;if(u)if(u>m){u-=m;continue}else t=t.subarray(u),m-=u,u=0;d.set(t,e),e+=m}return n&&(n-=i+3),{data:d,pts:s,dts:a,len:n}}return null}function Ma(r,e){if(r.units.length&&r.frame){if(r.pts===void 0){let t=e.samples,n=t.length;if(n){let i=t[n-1];r.pts=i.pts,r.dts=i.dts}else{e.dropped++;return}}e.samples.push(r)}r.debug.length&&R.log(r.pts+"/"+r.dts+":"+r.debug)}var Cd=class extends Pa{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let n=(Hr(e,0)||[]).length;for(let i=e.length;n<i;n++)if(sy(e,n))return R.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return ry(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return wd(e,t,n,this.basePTS,this.frameIndex)}},Fa=class{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}},bn=Math.pow(2,32)-1,D=class{static init(){D.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in D.types)D.types.hasOwnProperty(e)&&(D.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);let t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:t,audio:n};let i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=s,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);let a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,a,l,a,o),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,i))}static box(e,...t){let n=8,i=t.length,s=i;for(;i--;)n+=t[i].byteLength;let a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),i=0,n=8;i<s;i++)a.set(t[i],n),n+=t[i].byteLength;return a}static hdlr(e){return D.box(D.types.hdlr,D.HDLR_TYPES[e])}static mdat(e){return D.box(D.types.mdat,e)}static mdhd(e,t){t*=e;let n=Math.floor(t/(bn+1)),i=Math.floor(t%(bn+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return D.box(D.types.mdia,D.mdhd(e.timescale,e.duration),D.hdlr(e.type),D.minf(e))}static mfhd(e){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(e)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(e))}static moof(e,t,n){return D.box(D.types.moof,D.mfhd(e),D.traf(n,t))}static moov(e){let t=e.length,n=[];for(;t--;)n[t]=D.trak(e[t]);return D.box.apply(null,[D.types.moov,D.mvhd(e[0].timescale,e[0].duration)].concat(n).concat(D.mvex(e)))}static mvex(e){let t=e.length,n=[];for(;t--;)n[t]=D.trex(e[t]);return D.box.apply(null,[D.types.mvex,...n])}static mvhd(e,t){t*=e;let n=Math.floor(t/(bn+1)),i=Math.floor(t%(bn+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,s)}static sdtp(e){let t=e.samples||[],n=new Uint8Array(4+t.length),i,s;for(i=0;i<t.length;i++)s=t[i].flags,n[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return D.box(D.types.sdtp,n)}static stbl(e){return D.box(D.types.stbl,D.stsd(e),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))}static avc1(e){let t=[],n=[],i,s,a;for(i=0;i<e.sps.length;i++)s=e.sps[i],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],a=s.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(s));let o=D.box(D.types.avcC,new Uint8Array([1,t[3],t[4],t[5],252|3,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){let t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){let t=e.samplerate;return D.box(D.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]),D.box(D.types.esds,D.esds(e)))}static mp3(e){let t=e.samplerate;return D.box(D.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?D.box(D.types.stsd,D.STSD,D.mp3(e)):D.box(D.types.stsd,D.STSD,D.mp4a(e)):D.box(D.types.stsd,D.STSD,D.avc1(e))}static tkhd(e){let t=e.id,n=e.duration*e.timescale,i=e.width,s=e.height,a=Math.floor(n/(bn+1)),o=Math.floor(n%(bn+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){let n=D.sdtp(e),i=e.id,s=Math.floor(t/(bn+1)),a=Math.floor(t%(bn+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),D.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,D.box(D.types.trak,D.tkhd(e),D.mdia(e))}static trex(e){let t=e.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){let n=e.samples||[],i=n.length,s=12+16*i,a=new Uint8Array(s),o,l,c,u,d,h;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<i;o++)l=n[o],c=l.duration,u=l.size,d=l.flags,h=l.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&240<<8,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return D.box(D.types.trun,a)}static initSegment(e){D.types||D.init();let t=D.moov(e),n=new Uint8Array(D.FTYP.byteLength+t.byteLength);return n.set(D.FTYP),n.set(t,D.FTYP.byteLength),n}};D.types=void 0;D.HDLR_TYPES=void 0;D.STTS=void 0;D.STSC=void 0;D.STCO=void 0;D.STSZ=void 0;D.VMHD=void 0;D.SMHD=void 0;D.STSD=void 0;D.FTYP=void 0;D.DINF=void 0;var Rd=9e4;function Na(r,e,t=1,n=!1){let i=r*e*t;return n?Math.round(i):i}function ly(r,e,t=1,n=!1){return Na(r,e,1/t,n)}function $i(r,e=!1){return Na(r,1e3,1/Rd,e)}function cy(r,e=1){return Na(r,Rd,1/e)}var uy=10*1e3,Pd=1024,dy=1152,ss=null,Ba=null,as=class{constructor(e,t,n,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,ss===null){let a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ss=a?parseInt(a[1]):0}if(Ba===null){let s=navigator.userAgent.match(/Safari\/(\d+)/i);Ba=s?parseInt(s[1]):0}}destroy(){}resetTimeStamp(e){R.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){R.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){R.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1,n=e.reduce((i,s)=>{let a=s.pts-i;return a<-4294967296?(t=!0,vt(i,s.pts)):a>0?i:s.pts},e[0].pts);return t&&R.debug("PTS rollover detected"),n}remux(e,t,n,i,s,a,o,l){let c,u,d,h,f,m,p=s,g=s,T=e.pid>-1,_=t.pid>-1,y=t.samples.length,b=e.samples.length>0,E=o&&y>0||y>1;if((!T||b)&&(!_||E)||this.ISGenerated||o){this.ISGenerated||(d=this.generateIS(e,t,s,a));let w=this.isVideoContiguous,O=-1,S;if(E&&(O=hy(t.samples),!w&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,O>0){R.warn(`[mp4-remuxer]: Dropped ${O} out of ${y} video samples due to a missing keyframe`);let I=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(O),t.dropped+=O,g+=(t.samples[0].pts-I)/t.inputTimeScale,S=g}else O===-1&&(R.warn(`[mp4-remuxer]: No keyframe found out of ${y} video samples`),m=!1);if(this.ISGenerated){if(b&&E){let I=this.getVideoStartPts(t.samples),B=(vt(e.samples[0].pts,I)-I)/t.inputTimeScale;p+=Math.max(0,B),g+=Math.max(0,-B)}if(b){if(e.samplerate||(R.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,a)),u=this.remuxAudio(e,p,this.isAudioContiguous,a,_||E||l===Z.AUDIO?g:void 0),E){let I=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(R.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,a)),c=this.remuxVideo(t,g,w,I)}}else E&&(c=this.remuxVideo(t,g,w,0));c&&(c.firstKeyFrame=O,c.independent=O!==-1,c.firstKeyFramePTS=S)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(f=kd(n,s,this._initPTS,this._initDTS)),i.samples.length&&(h=Dd(i,s,this._initPTS))),{audio:u,video:c,initSegment:d,independent:m,text:h,id3:f}}generateIS(e,t,n,i){let s=e.samples,a=t.samples,o=this.typeSupported,l={},c=this._initPTS,u=!c||i,d="audio/mp4",h,f,m;if(u&&(h=f=Infinity),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):D.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(m=e.inputTimeScale,!c||m!==c.timescale?h=f=s[0].pts-Math.round(m*n):u=!1)}if(t.sps&&t.pps&&a.length&&(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:D.initSegment([t]),metadata:{width:t.width,height:t.height}},u))if(m=t.inputTimeScale,!c||m!==c.timescale){let p=this.getVideoStartPts(a),g=Math.round(m*n);f=Math.min(f,vt(a[0].dts,p)-g),h=Math.min(h,p-g)}else u=!1;if(Object.keys(l).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:h,timescale:m},this._initDTS={baseTime:f,timescale:m}):h=m=void 0,{tracks:l,initPTS:h,timescale:m}}remuxVideo(e,t,n,i){let s=e.inputTimeScale,a=e.samples,o=[],l=a.length,c=this._initPTS,u=this.nextAvcDts,d=8,h=this.videoSampleDuration,f,m,p=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,T=!1;if(!n||u===null){let W=t*s,K=a[0].pts-vt(a[0].dts,a[0].pts);u=W-K}let _=c.baseTime*s/c.timescale;for(let W=0;W<l;W++){let K=a[W];K.pts=vt(K.pts-_,u),K.dts=vt(K.dts-_,u),K.dts<a[W>0?W-1:W].dts&&(T=!0)}T&&a.sort(function(W,K){let ue=W.dts-K.dts,fe=W.pts-K.pts;return ue||fe}),f=a[0].dts,m=a[a.length-1].dts;let y=m-f,b=y?Math.round(y/(l-1)):h||e.inputTimeScale/30;if(n){let W=f-u,K=W>b,ue=W<-1;if((K||ue)&&(K?R.warn(`AVC: ${$i(W,!0)} ms (${W}dts) hole between fragments detected, filling it`):R.warn(`AVC: ${$i(-W,!0)} ms (${W}dts) overlapping between fragments detected`),!ue||u>a[0].pts)){f=u;let fe=a[0].pts-W;a[0].dts=f,a[0].pts=fe,R.log(`Video: First PTS/DTS adjusted: ${$i(fe,!0)}/${$i(f,!0)}, delta: ${$i(W,!0)} ms`)}}f=Math.max(0,f);let E=0,C=0;for(let W=0;W<l;W++){let K=a[W],ue=K.units,fe=ue.length,de=0;for(let Se=0;Se<fe;Se++)de+=ue[Se].data.length;C+=de,E+=fe,K.length=de,K.dts=Math.max(K.dts,f),p=Math.min(K.pts,p),g=Math.max(K.pts,g)}m=a[l-1].dts;let w=C+4*E+8,O;try{O=new Uint8Array(w)}catch(W){this.observer.emit(v.ERROR,v.ERROR,{type:J.MUX_ERROR,details:F.REMUX_ALLOC_ERROR,fatal:!1,error:W,bytes:w,reason:`fail allocating video mdat ${w}`});return}let S=new DataView(O.buffer);S.setUint32(0,w),O.set(D.types.mdat,4);let I=!1,N=Number.POSITIVE_INFINITY,B=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let W=0;W<l;W++){let K=a[W],ue=K.units,fe=0;for(let De=0,Me=ue.length;De<Me;De++){let je=ue[De],at=je.data,ui=je.data.byteLength;S.setUint32(d,ui),d+=4,O.set(at,d),d+=ui,fe+=4+ui}let de;if(W<l-1)h=a[W+1].dts-K.dts,de=a[W+1].pts-K.pts;else{let De=this.config,Me=W>0?K.dts-a[W-1].dts:b;if(de=W>0?K.pts-a[W-1].pts:b,De.stretchShortVideoTrack&&this.nextAudioPts!==null){let je=Math.floor(De.maxBufferHole*s),at=(i?p+i*s:this.nextAudioPts)-K.pts;at>je?(h=at-Me,h<0?h=Me:I=!0,R.log(`[mp4-remuxer]: It is approximately ${at/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=Me}else h=Me}let Se=Math.round(K.pts-K.dts);N=Math.min(N,h),A=Math.max(A,h),B=Math.min(B,de),M=Math.max(M,de),o.push(new Ua(K.key,h,fe,Se))}if(o.length){if(ss){if(ss<70){let W=o[0].flags;W.dependsOn=2,W.isNonSync=0}}else if(Ba&&M-B<A-N&&b/A<.025&&o[0].cts===0){R.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let W=f;for(let K=0,ue=o.length;K<ue;K++){let fe=W+o[K].duration,de=W+o[K].cts;if(K<ue-1){let Se=fe+o[K+1].cts;o[K].duration=Se-de}else o[K].duration=K?o[K-1].duration:b;o[K].cts=0,W=fe}}}h=I||!h?b:h,this.nextAvcDts=u=m+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;let $=D.moof(e.sequenceNumber++,f,Oe({},e,{samples:o})),q="video",Y={data1:$,data2:O,startPTS:p/s,endPTS:(g+h)/s,startDTS:f/s,endDTS:u/s,type:q,hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Y}remuxAudio(e,t,n,i,s){let a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,c=e.segmentCodec==="aac"?Pd:dy,u=c*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],m=s!==void 0,p=e.samples,g=h?0:8,T=this.nextAudioPts||-1,_=t*a,y=d.baseTime*a/d.timescale;if(this.isAudioContiguous=n=n||p.length&&T>0&&(i&&Math.abs(_-T)<9e3||Math.abs(vt(p[0].pts-y,_)-T)<20*u),p.forEach(function(q){q.pts=vt(q.pts-y,_)}),!n||T<0){if(p=p.filter(q=>q.pts>=0),!p.length)return;s===0?T=0:i&&!m?T=Math.max(0,_):T=p[0].pts}if(e.segmentCodec==="aac"){let q=this.config.maxAudioFramesDrift;for(let Y=0,W=T;Y<p.length;Y++){let K=p[Y],ue=K.pts,fe=ue-W,de=Math.abs(1e3*fe/a);if(fe<=-q*u&&m)Y===0&&(R.warn(`Audio frame @ ${(ue/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*fe/a)} ms.`),this.nextAudioPts=T=W=ue);else if(fe>=q*u&&de<uy&&m){let Se=Math.round(fe/u);W=ue-Se*u,W<0&&(Se--,W+=u),Y===0&&(this.nextAudioPts=T=W),R.warn(`[mp4-remuxer]: Injecting ${Se} audio frame @ ${(W/a).toFixed(3)}s due to ${Math.round(1e3*fe/a)} ms gap.`);for(let De=0;De<Se;De++){let Me=Math.max(W,0),je=Fa.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);je||(R.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),je=K.unit.subarray()),p.splice(Y,0,{unit:je,pts:Me}),W+=u,Y++}}K.pts=W,W+=u}}let b=null,E=null,C,w=0,O=p.length;for(;O--;)w+=p[O].unit.byteLength;for(let q=0,Y=p.length;q<Y;q++){let W=p[q],K=W.unit,ue=W.pts;if(E!==null){let de=f[q-1];de.duration=Math.round((ue-E)/l)}else if(n&&e.segmentCodec==="aac"&&(ue=T),b=ue,w>0){w+=g;try{C=new Uint8Array(w)}catch(de){this.observer.emit(v.ERROR,v.ERROR,{type:J.MUX_ERROR,details:F.REMUX_ALLOC_ERROR,fatal:!1,error:de,bytes:w,reason:`fail allocating audio mdat ${w}`});return}h||(new DataView(C.buffer).setUint32(0,w),C.set(D.types.mdat,4))}else return;C.set(K,g);let fe=K.byteLength;g+=fe,f.push(new Ua(!0,c,fe,0)),E=ue}let S=f.length;if(!S)return;let I=f[f.length-1];this.nextAudioPts=T=E+l*I.duration;let N=h?new Uint8Array(0):D.moof(e.sequenceNumber++,b/l,Oe({},e,{samples:f}));e.samples=[];let B=b/a,A=T/a,$={data1:N,data2:C,startPTS:B,endPTS:A,startDTS:B,endDTS:A,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.isAudioContiguous=!0,$}remuxEmptyAudio(e,t,n,i){let s=e.inputTimeScale,a=e.samplerate?e.samplerate:s,o=s/a,l=this.nextAudioPts,c=this._initDTS,u=c.baseTime*9e4/c.timescale,d=(l!==null?l:i.startDTS*s)+u,h=i.endDTS*s+u,f=o*Pd,m=Math.ceil((h-d)/f),p=Fa.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(R.warn("[mp4-remuxer]: remux empty Audio"),!p){R.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}let g=[];for(let T=0;T<m;T++){let _=d+T*f;g.push({unit:p,pts:_,dts:_})}return e.samples=g,this.remuxAudio(e,t,n,!1)}};function vt(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function hy(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function kd(r,e,t,n){let i=r.samples.length;if(!i)return;let s=r.inputTimeScale;for(let o=0;o<i;o++){let l=r.samples[o];l.pts=vt(l.pts-t.baseTime*9e4/t.timescale,e*s)/s,l.dts=vt(l.dts-n.baseTime*9e4/n.timescale,e*s)/s}let a=r.samples;return r.samples=[],{samples:a}}function Dd(r,e,t){let n=r.samples.length;if(!n)return;let i=r.inputTimeScale;for(let a=0;a<n;a++){let o=r.samples[a];o.pts=vt(o.pts-t.baseTime*9e4/t.timescale,e*i)/i}r.samples.sort((a,o)=>a.pts-o.pts);let s=r.samples;return r.samples=[],{samples:s}}var Ua=class{constructor(e,t,n,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=n,this.cts=i,this.flags=new xd(e)}},xd=class{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}},Od=class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(Xg(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}let i=this.initData=Au(e);t||(t=Md(i.audio,be.AUDIO)),n||(n=Md(i.video,be.VIDEO));let s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+n,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:n,initSegment:e,id:"main"}:R.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,n,i,s,a){var o,l;let{initPTS:c,lastEndTime:u}=this,d={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};X(u)||(u=this.lastEndTime=s||0);let h=t.samples;if(!(h!=null&&h.length))return d;let f={initPTS:void 0,timescale:1},m=this.initData;if((o=m)!=null&&o.length||(this.generateInitSegment(h),m=this.initData),!((l=m)!=null&&l.length))return R.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);let p=Qg(m,h),g=p===null?s:p;(fy(c,g,s)||f.timescale!==c.timescale&&a)&&(f.initPTS=g-s,this.initPTS=c={baseTime:f.initPTS,timescale:1});let T=Zg(h,m),_=e?g-c.baseTime/c.timescale:u,y=_+T;ev(m,h,c.baseTime/c.timescale),T>0?this.lastEndTime=y:(R.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());let b=!!m.audio,E=!!m.video,C="";b&&(C+="audio"),E&&(C+="video");let w={data1:h,startPTS:_,startDTS:_,endPTS:y,endDTS:y,type:C,hasAudio:b,hasVideo:E,nb:1,dropped:0};return d.audio=w.type==="audio"?w:void 0,d.video=w.type!=="audio"?w:void 0,d.initSegment=f,d.id3=kd(n,s,c,c),i.samples.length&&(d.text=Dd(i,s,c)),d}};function fy(r,e,t){if(r===null)return!0;let n=e-r.baseTime/r.timescale;return n<0&&Math.abs(n-t)>1}function Md(r,e){let t=r==null?void 0:r.codec;return t&&t.length>4?t:t==="hvc1"||t==="hev1"?"hvc1.1.c.L120.90":t==="av01"?"av01.0.04M.08":t==="avc1"||e===be.VIDEO?"avc1.42e01e":"mp4a.40.5"}var nn;try{nn=self.performance.now.bind(self.performance)}catch(r){R.debug("Unable to use Performance API on this environment"),nn=typeof self!="undefined"&&self.Date.now}var $a=[{demux:_d,remux:Od},{demux:tn,remux:as},{demux:Sd,remux:as},{demux:Cd,remux:as}],Ga=class{constructor(e,t,n,i,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.vendor=i,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){let s=n.transmuxing;s.executeStart=nn();let a=new Uint8Array(e),{currentTransmuxState:o,transmuxConfig:l}=this;i&&(this.currentTransmuxState=i);let{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:h,timeOffset:f,initSegmentChange:m}=i||o,{audioCodec:p,videoCodec:g,defaultInitPts:T,duration:_,initSegmentData:y}=l,b=my(a,t);if(b&&b.method==="AES-128"){let O=this.getDecrypter();if(O.isSync()){let S=O.softwareDecrypt(a,b.key.buffer,b.iv.buffer);if(n.part>-1&&(S=O.flush()),!S)return s.executeEnd=nn(),Va(n);a=new Uint8Array(S)}else return this.decryptionPromise=O.webCryptoDecrypt(a,b.key.buffer,b.iv.buffer).then(S=>{let I=this.push(S,null,n);return this.decryptionPromise=null,I}),this.decryptionPromise}let E=this.needsProbing(u,d);if(E){let O=this.configureTransmuxer(a);if(O)return R.warn(`[transmuxer] ${O.message}`),this.observer.emit(v.ERROR,v.ERROR,{type:J.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,fatal:!1,error:O,reason:O.message}),s.executeEnd=nn(),Va(n)}(u||d||m||E)&&this.resetInitSegment(y,p,g,_,t),(u||m||E)&&this.resetInitialTimestamp(T),c||this.resetContiguity();let C=this.transmux(a,b,f,h,n),w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,s.executeEnd=nn(),C}flush(e){let t=e.transmuxing;t.executeStart=nn();let{decrypter:n,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));let a=[],{timeOffset:o}=i;if(n){let d=n.flush();d&&a.push(this.push(d,null,e))}let{demuxer:l,remuxer:c}=this;if(!l||!c)return t.executeEnd=nn(),[Va(e)];let u=l.flush(o);return os(u)?u.then(d=>(this.flushRemux(a,d,e),a)):(this.flushRemux(a,u,e),a)}flushRemux(e,t,n){let{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;R.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);let u=this.remuxer.remux(i,s,a,o,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=nn()}resetInitialTimestamp(e){let{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){let{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,s){let{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,n,i),o.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,n,i,s):a=this.transmuxUnencrypted(e,n,i,s),a}transmuxUnencrypted(e,t,n,i){let{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,l,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,s){return this.demuxer.demuxSampleAes(e,t,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){let{config:t,observer:n,typeSupported:i,vendor:s}=this,a;for(let d=0,h=$a.length;d<h;d++)if($a[d].demux.probe(e)){a=$a[d];break}if(!a)return new Error("Failed to find demuxer by probing fragment data");let o=this.demuxer,l=this.remuxer,c=a.remux,u=a.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(n,t,i,s)),(!o||!(o instanceof u))&&(this.demuxer=new u(n,t,i),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new es(this.config)),e}};function my(r,e){let t=null;return r.byteLength>0&&e!=null&&e.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}var Va=r=>({remuxResult:{},chunkMeta:r});function os(r){return"then"in r&&r.then instanceof Function}var Fd=class{constructor(e,t,n,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=s||null}},Nd=class{constructor(e,t,n,i,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=a}},Gi={},py={get exports(){return Gi},set exports(r){Gi=r}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,d||l,h),m=t?t+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],f]:l._events[m].push(f):(l._events[m]=f,l._eventsCount++),l}function a(l,c){--l._eventsCount==0?l._events=new n:delete l._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,m=new Array(f);h<f;h++)m[h]=d[h].fn;return m},o.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,h,f,m){var p=t?t+c:c;if(!this._events[p])return!1;var g=this._events[p],T=arguments.length,_,y;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),T){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,h),!0;case 5:return g.fn.call(g.context,u,d,h,f),!0;case 6:return g.fn.call(g.context,u,d,h,f,m),!0}for(y=1,_=new Array(T-1);y<T;y++)_[y-1]=arguments[y];g.fn.apply(g.context,_)}else{var b=g.length,E;for(y=0;y<b;y++)switch(g[y].once&&this.removeListener(c,g[y].fn,void 0,!0),T){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,u);break;case 3:g[y].fn.call(g[y].context,u,d);break;case 4:g[y].fn.call(g[y].context,u,d,h);break;default:if(!_)for(E=1,_=new Array(T-1);E<T;E++)_[E-1]=arguments[E];g[y].fn.apply(g[y].context,_)}}return!0},o.prototype.on=function(c,u,d){return s(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return s(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,h){var f=t?t+c:c;if(!this._events[f])return this;if(!u)return a(this,f),this;var m=this._events[f];if(m.fn)m.fn===u&&(!h||m.once)&&(!d||m.context===d)&&a(this,f);else{for(var p=0,g=[],T=m.length;p<T;p++)(m[p].fn!==u||h&&!m[p].once||d&&m[p].context!==d)&&g.push(m[p]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&a(this,u)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o})(py);var ja=Ra()||{isTypeSupported:()=>!1},Ha=class{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;let s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;let a=(c,u)=>{u=u||{},u.frag=this.frag,u.id=this.id,c===v.ERROR&&(this.error=u.error),this.hls.trigger(c,u)};this.observer=new Gi,this.observer.on(v.FRAG_DECRYPTED,a),this.observer.on(v.ERROR,a);let o={mp4:ja.isTypeSupported("video/mp4"),mpeg:ja.isTypeSupported("audio/mpeg"),mp3:ja.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"&&(s.workerPath||Hv())){try{s.workerPath?(R.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Kv(s.workerPath)):(R.log(`injecting Web Worker for "${t}"`),this.workerContext=Wv()),this.onwmsg=d=>this.onWorkerMessage(d);let{worker:u}=this.workerContext;u.addEventListener("message",this.onwmsg),u.onerror=d=>{let h=new Error(`${d.message}  (${d.filename}:${d.lineno})`);s.enableWorker=!1,R.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(v.ERROR,{type:J.OTHER_ERROR,details:F.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})},u.postMessage({cmd:"init",typeSupported:o,vendor:l,id:t,config:JSON.stringify(s)})}catch(u){R.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.resetWorker(),this.error=null,this.transmuxer=new Ga(this.observer,o,s,l,t)}return}this.transmuxer=new Ga(this.observer,o,s,l,t)}resetWorker(){if(this.workerContext){let{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{let t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,n,i,s,a,o,l,c,u){var d,h;c.transmuxing.start=self.performance.now();let{transmuxer:f}=this,m=a?a.start:s.start,p=s.decryptdata,g=this.frag,T=!(g&&s.cc===g.cc),_=!(g&&c.level===g.level),y=g?c.sn-g.sn:-1,b=this.part?c.part-this.part.index:-1,E=y===0&&c.id>1&&c.id===(g==null?void 0:g.stats.chunkCount),C=!_&&(y===1||y===0&&(b===1||E&&b<=0)),w=self.performance.now();(_||y||s.stats.parsing.start===0)&&(s.stats.parsing.start=w),a&&(b||!C)&&(a.stats.parsing.start=w);let O=!(g&&((d=s.initSegment)==null?void 0:d.url)===((h=g.initSegment)==null?void 0:h.url)),S=new Nd(T,C,l,_,m,O);if(!C||T||O){R.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${c.sn} p: ${c.part} level: ${c.level} id: ${c.id}
        discontinuity: ${T}
        trackSwitch: ${_}
        contiguous: ${C}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${O}`);let I=new Fd(n,i,t,o,u);this.configureTransmuxer(I)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:c,state:S},e instanceof ArrayBuffer?[e]:[]);else if(f){let I=f.push(e,p,c,S);os(I)?(f.async=!0,I.then(N=>{this.handleTransmuxComplete(N)}).catch(N=>{this.transmuxerError(N,c,"transmuxer-interface push error")})):(f.async=!1,this.handleTransmuxComplete(I))}}flush(e){e.transmuxing.start=self.performance.now();let{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let n=t.flush(e);os(n)||t.async?(os(n)||(n=Promise.resolve(n)),n.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(n,e)}}transmuxerError(e,t,n){!this.hls||(this.error=e,this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}onWorkerMessage(e){let t=e.data,n=this.hls;switch(t.event){case"init":{var i;let s=(i=this.workerContext)==null?void 0:i.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":R[t.data.logType]&&R[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data);break}}}configureTransmuxer(e){let{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}},gy=250,Wa=2,vy=.1,yy=.05,Bd=class{constructor(e,t,n,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=n,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){let{config:n,media:i,stalled:s}=this;if(i===null)return;let{currentTime:a,seeking:o}=i,l=this.seeking&&!o,c=!this.seeking&&o;if(this.seeking=o,a!==e){if(this.moved=!0,s!==null){if(this.stallReported){let T=self.performance.now()-s;R.warn(`playback not stuck anymore @${a}, after ${Math.round(T)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(c||l){this.stalled=null;return}if(i.paused&&!o||i.ended||i.playbackRate===0||!_e.getBuffered(i).length)return;let u=_e.bufferInfo(i,a,0),d=u.len>0,h=u.nextStart||0;if(!d&&!h)return;if(o){let T=u.len>Wa,_=!h||t&&t.start<=a||h-a>Wa&&!this.fragmentTracker.getPartialFragment(a);if(T||_)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var f;let T=Math.max(h,u.start||0)-a,_=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,b=(_==null||(f=_.details)==null?void 0:f.live)?_.details.targetduration*2:Wa,E=this.fragmentTracker.getPartialFragment(a);if(T>0&&(T<=b||E)){this._trySkipBufferHole(E);return}}let m=self.performance.now();if(s===null){this.stalled=m;return}let p=m-s;if(!o&&p>=gy&&(this._reportStall(u),!this.media))return;let g=_e.bufferInfo(i,a,n.maxBufferHole);this._tryFixBufferStall(g,p)}_tryFixBufferStall(e,t){let{config:n,fragmentTracker:i,media:s}=this;if(s===null)return;let a=s.currentTime,o=i.getPartialFragment(a);o&&(this._trySkipBufferHole(o)||!this.media)||(e.len>n.maxBufferHole||e.nextStart&&e.nextStart-a<n.maxBufferHole)&&t>n.highBufferWatchdogPeriod*1e3&&(R.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){let{hls:t,media:n,stallReported:i}=this;if(!i&&n){this.stallReported=!0;let s=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(e)})`);R.warn(s.message),t.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){let{config:t,hls:n,media:i}=this;if(i===null)return 0;let s=i.currentTime,a=_e.bufferInfo(i,s,0),o=s<a.start?a.start:a.nextStart;if(o){let l=a.len<=t.maxBufferHole,c=a.len>0&&a.len<1&&i.readyState<3,u=o-s;if(u>0&&(l||c)){if(u>t.maxBufferHole){let{fragmentTracker:h}=this,f=!1;if(s===0){let m=h.getAppendedFrag(0,Z.MAIN);m&&o<m.end&&(f=!0)}if(!f){let m=e||h.getAppendedFrag(s,Z.MAIN);if(m){let p=!1,g=m.end;for(;g<o;){let T=h.getPartialFragment(g);if(T)g+=T.duration;else{p=!0;break}}if(p)return 0}}}let d=Math.max(o+yy,s+vy);if(R.warn(`skipping hole, adjusting currentTime from ${s} to ${d}`),this.moved=!0,this.stalled=null,i.currentTime=d,e&&!e.gap){let h=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${d}`);n.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:e})}return d}}return 0}_tryNudgeBuffer(){let{config:e,hls:t,media:n,nudgeRetry:i}=this;if(n===null)return;let s=n.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){let a=s+(i+1)*e.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${s} to ${a}`);R.warn(o.message),n.currentTime=a,t.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{let a=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);R.error(a.message),t.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.BUFFER_STALLED_ERROR,error:a,fatal:!0})}}},by=100,Ud=class extends ts{constructor(e,t,n){super(e,t,n,"[stream-controller]",Z.MAIN);this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(v.ERROR,this.onError,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(v.ERROR,this.onError,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){let{lastCurrentTime:t,hls:n}=this;if(this.stopLoad(),this.setInterval(by),this.level=-1,!this.startFragRequested){let i=n.startLevel;i===-1&&(n.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=n.nextAutoLevel),this.level=n.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=U.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=U.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case U.WAITING_LEVEL:{var e;let{levels:n,level:i}=this,s=n==null||(e=n[i])==null?void 0:e.details;if(s&&(!s.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(s))break;this.state=U.IDLE;break}break}case U.FRAG_LOADING_WAITING_RETRY:{var t;let n=self.performance.now(),i=this.retryDate;(!i||n>=i||(t=this.media)!=null&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=U.IDLE)}break}this.state===U.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:n,media:i}=this,{config:s,nextLoadLevel:a}=e;if(t===null||!i&&(this.startFragRequested||!s.startFragPrefetch)||this.altAudio&&this.audioOnly||!(n!=null&&n[a]))return;let o=n[a],l=this.getMainFwdBufferInfo();if(l===null)return;let c=this.getLevelDetails();if(c&&this._streamEnded(l,c)){let g={};this.altAudio&&(g.type="video"),this.hls.trigger(v.BUFFER_EOS,g),this.state=U.ENDED;return}e.loadLevel!==a&&e.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=e.nextLoadLevel=a;let u=o.details;if(!u||this.state===U.WAITING_LEVEL||u.live&&this.levelLastLoaded!==a){this.level=a,this.state=U.WAITING_LEVEL;return}let d=l.len,h=this.getMaxBufferLength(o.maxBitrate);if(d>=h)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);let f=this.backtrackFragment?this.backtrackFragment.start:l.end,m=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&m&&m.sn!=="initSegment"&&this.fragmentTracker.getState(m)!==Ve.OK){var p;let T=((p=this.backtrackFragment)!=null?p:m).sn-u.startSN,_=u.fragments[T-1];_&&m.cc===_.cc&&(m=_,this.fragmentTracker.removeFragment(_))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,f)){if(!m.gap){let T=this.audioOnly&&!this.altAudio?be.AUDIO:be.VIDEO,_=(T===be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;_&&this.afterBufferFlushed(_,T,Z.MAIN)}m=this.getNextFragmentLoopLoading(m,u,l,Z.MAIN,h)}!m||(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,o,f))}loadFragment(e,t,n){let i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===Ve.NOT_LOADED?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,n)):this.clearTrackerIfNeeded(e)}getAppendedFrag(e){let t=this.fragmentTracker.getAppendedFrag(e,Z.MAIN);return t&&"fragment"in t?t.fragment:t}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Z.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){let{levels:e,media:t}=this;if(t!=null&&t.readyState){let n,i=this.getAppendedFrag(t.currentTime);if(i&&i.start>1&&this.flushMainBuffer(0,i.start-1),!t.paused&&e){let a=this.hls.nextLoadLevel,o=e[a],l=this.fragLastKbps;l&&this.fragCurrent?n=this.fragCurrent.duration*o.maxBitrate/(1e3*l)+1:n=0}else n=0;let s=this.getBufferedFrag(t.currentTime+n);if(s){let a=this.followingBufferedFrag(s);if(a){this.abortCurrentFrag();let o=a.maxStartPTS?a.maxStartPTS:a.start,l=a.duration,c=Math.max(s.end,o+Math.min(Math.max(l-this.config.maxFragLookUpTolerance,l*.5),l*.75));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){let e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case U.KEY_LOADING:case U.FRAG_LOADING:case U.FRAG_LOADING_WAITING_RETRY:case U.PARSING:case U.PARSED:this.state=U.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);let n=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new Bd(this.config,n,this.fragmentTracker,this.hls)}onMediaDetaching(){let{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){let e=this.media,t=e?e.currentTime:null;X(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);let n=this.getMainFwdBufferInfo();if(n===null||n.len===0){this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(v.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null}onManifestParsed(e,t){let n=!1,i=!1,s;t.levels.forEach(a=>{s=a.audioCodec,s&&(s.indexOf("mp4a.40.2")!==-1&&(n=!0),s.indexOf("mp4a.40.5")!==-1&&(i=!0))}),this.audioCodecSwitch=n&&i&&!jv(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){let{levels:n}=this;if(!n||this.state!==U.IDLE)return;let i=n[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(i.details))&&(this.state=U.WAITING_LEVEL)}onLevelLoaded(e,t){var n;let{levels:i}=this,s=t.level,a=t.details,o=a.totalduration;if(!i){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${a.startSN},${a.endSN}], cc [${a.startCC}, ${a.endCC}] duration:${o}`);let l=i[s],c=this.fragCurrent;c&&(this.state===U.FRAG_LOADING||this.state===U.FRAG_LOADING_WAITING_RETRY)&&(c.level!==t.level||c.urlId!==l.urlId)&&c.loader&&this.abortCurrentFrag();let u=0;if(a.live||(n=l.details)!=null&&n.live){if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,l.details)}if(l.details=a,this.levelLastLoaded=s,this.hls.trigger(v.LEVEL_UPDATED,{details:a,level:s}),this.state===U.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=U.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,u),this.tick()}_handleFragmentLoadProgress(e){var t;let{frag:n,part:i,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}let o=a[n.level],l=o.details;if(!l){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}let c=o.videoCodec,u=l.PTSKnown||!l.live,d=(t=n.initSegment)==null?void 0:t.data,h=this._getAudioCodec(o),f=this.transmuxer=this.transmuxer||new Ha(this.hls,Z.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=i?i.index:-1,p=m!==-1,g=new Jr(n.level,n.sn,n.stats.chunkCount,s.byteLength,m,p),T=this.initPTS[n.cc];f.push(s,d,h,c,n,i,l.totalduration,u,g,T)}onAudioTrackSwitching(e,t){let n=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();let s=this.hls;n&&(s.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(v.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){let n=t.id,i=!!this.hls.audioTracks[n].url;if(i){let s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i,this.tick()}onBufferCreated(e,t){let n=t.tracks,i,s,a=!1;for(let o in n){let l=n[o];if(l.id==="main"){if(s=o,i=l,o==="video"){let c=n[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){let{frag:n,part:i}=t;if(n&&n.type!==Z.MAIN)return;if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===U.PARSED&&(this.state=U.IDLE);return}let s=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),n.sn!=="initSegment"&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}onError(e,t){var n;if(t.fatal){this.state=U.ERROR;return}switch(t.details){case F.FRAG_GAP:case F.FRAG_PARSING_ERROR:case F.FRAG_DECRYPT_ERROR:case F.FRAG_LOAD_ERROR:case F.FRAG_LOAD_TIMEOUT:case F.KEY_LOAD_ERROR:case F.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Z.MAIN,t);break;case F.LEVEL_LOAD_ERROR:case F.LEVEL_LOAD_TIMEOUT:case F.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===U.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===pe.LEVEL&&(this.state=U.IDLE);break;case F.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case F.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){let{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!_e.getBuffered(e).length){let n=this.state!==U.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,n)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=U.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==be.AUDIO||this.audioOnly&&!this.altAudio){let n=(t===be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,t,Z.MAIN)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){let{media:e}=this;if(!e)return;let t=e.currentTime,n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}let i=_e.getBuffered(e),a=(i.length?i.start(0):0)-n;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),n+=a,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${t}`),e.currentTime=n}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{let{hls:i}=this;if(!n||this.fragContextChanged(e))return;t.fragmentError=0,this.state=U.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;let s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),i.trigger(v.FRAG_LOADED,n),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;let n="main",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}let{frag:l,part:c,level:u}=o,{video:d,text:h,id3:f,initSegment:m}=s,{details:p}=u,g=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=U.PARSING,m){m.tracks&&(this._bufferInitSegment(u,m.tracks,l,a),i.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:l,id:n,tracks:m.tracks}));let T=m.initPTS,_=m.timescale;X(T)&&(this.initPTS[l.cc]={baseTime:T,timescale:_},i.trigger(v.INIT_PTS_FOUND,{frag:l,id:n,initPTS:T,timescale:_}))}if(d&&s.independent!==!1){if(p){let{startPTS:T,endPTS:_,startDTS:y,endDTS:b}=d;if(c)c.elementaryStreams[d.type]={startPTS:T,endPTS:_,startDTS:y,endDTS:b};else if(d.firstKeyFrame&&d.independent&&a.id===1&&(this.couldBacktrack=!0),d.dropped&&d.independent){let E=this.getMainFwdBufferInfo(),C=(E?E.end:this.getLoadPosition())+this.config.maxBufferHole,w=d.firstKeyFramePTS?d.firstKeyFramePTS:T;if(C<w-this.config.maxBufferHole){this.backtrack(l);return}l.setElementaryStreamInfo(d.type,l.start,_,l.start,b,!0)}l.setElementaryStreamInfo(d.type,T,_,y,b),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,c,a)}}else if(s.independent===!1){this.backtrack(l);return}if(g){let{startPTS:T,endPTS:_,startDTS:y,endDTS:b}=g;c&&(c.elementaryStreams[be.AUDIO]={startPTS:T,endPTS:_,startDTS:y,endDTS:b}),l.setElementaryStreamInfo(be.AUDIO,T,_,y,b),this.bufferFragmentData(g,l,c,a)}if(p&&f!=null&&(t=f.samples)!=null&&t.length){let T={id:n,frag:l,details:p,samples:f.samples};i.trigger(v.FRAG_PARSING_METADATA,T)}if(p&&h){let T={id:n,frag:l,details:p,samples:h.samples};i.trigger(v.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,n,i){if(this.state!==U.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;let{audio:s,video:a,audiovideo:o}=t;if(s){let l=e.audioCodec,c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5"),s.metadata.channelCount!==1&&c.indexOf("firefox")===-1&&(l="mp4a.40.5")),c.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),s.levelCodec=l,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${s.codec}]`)}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${a.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${o.codec}]`),this.hls.trigger(v.BUFFER_CODECS,t),Object.keys(t).forEach(l=>{let u=t[l].initSegment;u!=null&&u.byteLength&&this.hls.trigger(v.BUFFER_APPENDING,{type:l,data:u,frag:n,part:null,chunkMeta:i,parent:n.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Z.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=U.IDLE}checkFragmentChanged(){let e=this.media,t=null;if(e&&e.readyState>1&&e.seeking===!1){let n=e.currentTime;if(_e.isBuffered(e,n)?t=this.getAppendedFrag(n):_e.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;let i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s||t.urlId!==i.urlId)&&(this.fragPlaying=t,this.hls.trigger(v.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(v.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){let e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){let e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){let e=this.media;if(e){let t=e.currentTime,n=this.currentFrag;if(n&&X(t)&&X(n.programDateTime)){let i=n.programDateTime+(t-n.start)*1e3;return new Date(i)}}return null}get currentLevel(){let e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){let e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}},xn=class{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){let n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){let e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}},$d=class{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new xn(e),this.fast_=new xn(t),this.defaultTTFB_=i,this.ttfb_=new xn(e)}update(e,t){let{slow_:n,fast_:i,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new xn(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new xn(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new xn(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);let n=8*t,i=e/1e3,s=n/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){let t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}},Gd=class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;let t=e.config;this.bwEstimator=new $d(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){let{hls:e}=this;e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var n;let i=t.frag;this.ignoreFragment(i)||(this.fragCurrent=i,this.partCurrent=(n=t.part)!=null?n:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,n,i){let s=e+n/t,a=i?this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){let n=this.hls.config,{total:i,bwEstimate:s}=t.stats;X(i)&&X(s)&&(this.lastLevelLoadSec=8*i/s),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}_abandonRulesCheck(){let{fragCurrent:e,partCurrent:t,hls:n}=this,{autoLevelEnabled:i,media:s}=n;if(!e||!s)return;let a=performance.now(),o=t?t.stats:e.stats,l=t?t.duration:e.duration,c=a-o.loading.start;if(o.aborted||o.loaded&&o.loaded===o.total||e.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!i||s.paused||!s.playbackRate||!s.readyState)return;let u=n.mainForwardBufferInfo;if(u===null)return;let d=this.bwEstimator.getEstimateTTFB(),h=Math.abs(s.playbackRate);if(c<=Math.max(d,1e3*(l/(h*2))))return;let f=u.len/h;if(f>=2*l/h)return;let m=o.loading.first?o.loading.first-o.loading.start:-1,p=o.loaded&&m>-1,g=this.bwEstimator.getEstimate(),{levels:T,minAutoLevel:_}=n,y=T[e.level],b=o.total||Math.max(o.loaded,Math.round(l*y.maxBitrate/8)),E=c-m;E<1&&p&&(E=Math.min(c,o.loaded*8/g));let C=p?o.loaded*1e3/E:0,w=C?(b-o.loaded)/C:b*8/g+d/1e3;if(w<=f)return;let O=C?C*8:g,S=Number.POSITIVE_INFINITY,I;for(I=e.level-1;I>_;I--){let N=T[I].maxBitrate;if(S=this.getTimeToLoadFrag(d/1e3,O,l*N,!T[I].details),S<f)break}S>=w||S>l*10||(n.nextLoadLevel=I,p?this.bwEstimator.sample(c-Math.min(d,m),o.loaded):this.bwEstimator.sampleTTFB(c),this.clearTimer(),R.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;
      Time to underbuffer: ${f.toFixed(3)} s
      Estimated load time for current fragment: ${w.toFixed(3)} s
      Estimated load time for down switch fragment: ${S.toFixed(3)} s
      TTFB estimate: ${m}
      Current BW estimate: ${X(g)?(g/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${I}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),n.trigger(v.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:o}))}onFragLoaded(e,{frag:t,part:n}){let i=n?n.stats:t.stats;if(t.type===Z.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){let s=n?n.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+i.loaded,l=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){let s={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered(v.FRAG_BUFFERED,s),t.bitrateTest=!1}}}onFragBuffered(e,t){let{frag:n,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;let a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Z.MAIN||e.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){let e=this._nextAutoLevel,t=this.bwEstimator;if(e!==-1&&!t.canEstimate())return e;let n=this.getNextABRAutoLevel();if(e!==-1){let i=this.hls.levels;if(i.length>Math.max(e,n)&&i[e].loadError<=i[n].loadError)return e}return e!==-1&&(n=Math.min(e,n)),n}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:n}=this,{maxAutoLevel:i,config:s,minAutoLevel:a,media:o}=n,l=t?t.duration:e?e.duration:0,c=o&&o.playbackRate!==0?Math.abs(o.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,d=n.mainForwardBufferInfo,h=(d?d.len:0)/c,f=this.findBestLevel(u,a,i,h,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(f>=0)return f;R.trace(`[abr] ${h?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let m=l?Math.min(l,s.maxStarvationDelay):s.maxStarvationDelay,p=s.abrBandWidthFactor,g=s.abrBandWidthUpFactor;if(!h){let T=this.bitrateTestDelay;T&&(m=(l?Math.min(l,s.maxLoadingDelay):s.maxLoadingDelay)-T,R.trace(`[abr] bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),p=g=1)}return f=this.findBestLevel(u,a,i,h+m,p,g),Math.max(f,0)}findBestLevel(e,t,n,i,s,a){var o;let{fragCurrent:l,partCurrent:c,lastLoadedFragLevel:u}=this,{levels:d}=this.hls,h=d[u],f=!!(h!=null&&(o=h.details)!=null&&o.live),m=h==null?void 0:h.codecSet,p=c?c.duration:l?l.duration:0,g=this.bwEstimator.getEstimateTTFB()/1e3,T=t,_=-1;for(let y=n;y>=t;y--){let b=d[y];if(!b||m&&b.codecSet!==m){b&&(T=Math.min(y,T),_=Math.max(y,_));continue}_!==-1&&R.trace(`[abr] Skipped level(s) ${T}-${_} with CODECS:"${d[_].attrs.CODECS}"; not compatible with "${h.attrs.CODECS}"`);let E=b.details,C=(c?E==null?void 0:E.partTarget:E==null?void 0:E.averagetargetduration)||p,w;y<=u?w=s*e:w=a*e;let O=d[y].maxBitrate,S=this.getTimeToLoadFrag(g,w,O*C,E===void 0);if(R.trace(`[abr] level:${y} adjustedbw-bitrate:${Math.round(w-O)} avgDuration:${C.toFixed(1)} maxFetchDuration:${i.toFixed(1)} fetchDuration:${S.toFixed(1)}`),w>O&&(S===0||!X(S)||f&&!this.bitrateTestDelay||S<i))return y}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}},Ka=class{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){let{chunks:e,dataLength:t}=this,n;if(e.length)e.length===1?n=e[0]:n=Ty(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}};function Ty(r,e){let t=new Uint8Array(e),n=0;for(let i=0;i<r.length;i++){let s=r[i];t.set(s,n),n+=s.length}return t}var Vd=100,jd=class extends ts{constructor(e,t,n){super(e,t,n,"[audio-stream-controller]",Z.AUDIO);this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){let{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.ERROR,this.onError,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.ERROR,this.onError,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s}){if(n==="main"){let a=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${a} found from main: ${i}`),this.videoTrackCC=a,this.state===U.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=U.STOPPED;return}let t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Vd),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=U.IDLE):(this.loadedmetadata=!1,this.state=U.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case U.IDLE:this.doTickIdle();break;case U.WAITING_TRACK:{var e;let{levels:n,trackId:i}=this,s=n==null||(e=n[i])==null?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=U.WAITING_INIT_PTS}break}case U.FRAG_LOADING_WAITING_RETRY:{var t;let n=performance.now(),i=this.retryDate;(!i||n>=i||(t=this.media)!=null&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=U.IDLE);break}case U.WAITING_INIT_PTS:{let n=this.waitingData;if(n){let{frag:i,part:s,cache:a,complete:o}=n;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=U.FRAG_LOADING;let l=a.flush(),c={frag:i,part:s,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),o&&super._handleFragmentLoadComplete(c)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${i.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{let l=this.getLoadPosition(),c=_e.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);wa(c.end,this.config.maxFragLookUpTolerance,i)<0&&(this.log(`Waiting fragment cc (${i.cc}) @ ${i.start} cancelled because another fragment at ${c.end} is needed`),this.clearWaitingFragment())}}else this.state=U.IDLE}}this.onTickEnd()}clearWaitingFragment(){let e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=U.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){let{media:e}=this;!(e!=null&&e.readyState)||(this.lastCurrentTime=e.currentTime)}doTickIdle(){let{hls:e,levels:t,media:n,trackId:i}=this,s=e.config;if(!(t!=null&&t[i])||!n&&(this.startFragRequested||!s.startFragPrefetch))return;let a=t[i],o=a.details;if(!o||o.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(o)){this.state=U.WAITING_TRACK;return}let l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,be.AUDIO,Z.AUDIO));let c=this.getFwdBufferInfo(l,Z.AUDIO);if(c===null)return;let{bufferedTrack:u,switchingTrack:d}=this;if(!d&&this._streamEnded(c,o)){e.trigger(v.BUFFER_EOS,{type:"audio"}),this.state=U.ENDED;return}let h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Z.MAIN),f=c.len,m=this.getMaxBufferLength(h==null?void 0:h.len);if(f>=m&&!d)return;let g=o.fragments[0].start,T=c.end;if(d&&n){let E=this.getLoadPosition();u&&d.attrs!==u.attrs&&(T=E),o.PTSKnown&&E<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=g+.05)}let _=this.getNextFragment(T,o),y=!1;if(_&&this.isLoopLoading(_,T)&&(y=!!_.gap,_=this.getNextFragmentLoopLoading(_,o,c,Z.MAIN,m)),!_){this.bufferFlushed=!0;return}let b=h&&_.start>h.end+o.targetduration;if(b||!(h!=null&&h.len)&&c.len){let E=this.fragmentTracker.getBufferedFrag(_.start,Z.MAIN);if(E===null||(y||(y=!!E.gap||!!b&&h.len===0),b&&!y||y&&c.nextStart&&c.nextStart<E.end))return}this.loadFragment(_,a,T)}getMaxBufferLength(e){let t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new ti(n))}onAudioTrackSwitching(e,t){let n=!!t.url;this.trackId=t.id;let{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?this.setInterval(Vd):this.resetTransmuxer(),n?(this.switchingTrack=t,this.state=U.IDLE):(this.switchingTrack=null,this.bufferedTrack=t,this.state=U.STOPPED),this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.bufferedTrack=null,this.switchingTrack=null}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(v.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var n;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}let{levels:i}=this,{details:s,id:a}=t;if(!i){this.warn(`Audio tracks were reset while loading level ${a}`);return}this.log(`Track ${a} loaded [${s.startSN},${s.endSN}],duration:${s.totalduration}`);let o=i[a],l=0;if(s.live||(n=o.details)!=null&&n.live){let c=this.mainDetails;if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed||!c)return;!o.details&&s.hasProgramDateTime&&c.hasProgramDateTime?(hd(s,c),l=s.fragments[0].start):l=this.alignPlaylists(s,o.details)}o.details=s,this.levelLastLoaded=a,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(o.details,l),this.state===U.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=U.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;let{frag:n,part:i,payload:s}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}let c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}let u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}let d=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2",h=this.transmuxer;h||(h=this.transmuxer=new Ha(this.hls,Z.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));let f=this.initPTS[n.cc],m=(t=n.initSegment)==null?void 0:t.data;if(f!==void 0){let p=!1,g=i?i.index:-1,T=g!==-1,_=new Jr(n.level,n.sn,n.stats.chunkCount,s.byteLength,g,T);h.push(s,m,d,"",n,i,u.totalduration,p,_,f)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${o}`);let{cache:p}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new Ka,complete:!1};p.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=U.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){let n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){let{frag:n,part:i}=t;if(n.type!==Z.AUDIO){if(!this.loadedmetadata&&n.type===Z.MAIN){var s;(s=this.videoBuffer||this.media)!=null&&s.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(n.sn!=="initSegment"){this.fragPrevious=n;let a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(v.AUDIO_TRACK_SWITCHED,ze({},a)))}this.fragBufferedComplete(n,i)}onError(e,t){var n;if(t.fatal){this.state=U.ERROR;return}switch(t.details){case F.FRAG_GAP:case F.FRAG_PARSING_ERROR:case F.FRAG_DECRYPT_ERROR:case F.FRAG_LOAD_ERROR:case F.FRAG_LOAD_TIMEOUT:case F.KEY_LOAD_ERROR:case F.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Z.AUDIO,t);break;case F.AUDIO_TRACK_LOAD_ERROR:case F.AUDIO_TRACK_LOAD_TIMEOUT:case F.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===U.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===pe.AUDIO_TRACK&&(this.state=U.IDLE);break;case F.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case F.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushed(e,{type:t}){t===be.AUDIO&&(this.bufferFlushed=!0,this.state===U.ENDED&&(this.state=U.IDLE))}_handleTransmuxComplete(e){var t;let n="audio",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}let{frag:l,part:c,level:u}=o,{details:d}=u,{audio:h,text:f,id3:m,initSegment:p}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=U.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks&&(this._bufferInitSegment(p.tracks,l,a),i.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:l,id:n,tracks:p.tracks})),h){let{startPTS:g,endPTS:T,startDTS:_,endDTS:y}=h;c&&(c.elementaryStreams[be.AUDIO]={startPTS:g,endPTS:T,startDTS:_,endDTS:y}),l.setElementaryStreamInfo(be.AUDIO,g,T,_,y),this.bufferFragmentData(h,l,c,a)}if(m!=null&&(t=m.samples)!=null&&t.length){let g=Oe({id:n,frag:l,details:d},m);i.trigger(v.FRAG_PARSING_METADATA,g)}if(f){let g=Oe({id:n,frag:l,details:d},f);i.trigger(v.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,t,n){if(this.state!==U.PARSING)return;e.video&&delete e.video;let i=e.audio;if(!i)return;i.levelCodec=i.codec,i.id="audio",this.log(`Init audio buffer, container:${i.container}, codecs[parsed]=[${i.codec}]`),this.hls.trigger(v.BUFFER_CODECS,e);let s=i.initSegment;if(s!=null&&s.byteLength){let a={type:"audio",frag:t,part:null,chunkMeta:n,parent:t.type,data:s};this.hls.trigger(v.BUFFER_APPENDING,a)}this.tick()}loadFragment(e,t,n){let i=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||i===Ve.NOT_LOADED||i===Ve.PARTIAL){var s;e.sn==="initSegment"?this._loadInitSegment(e,t):(s=t.details)!=null&&s.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=U.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(e,t,n))}else this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){let{hls:t,media:n,bufferedTrack:i}=this,s=i==null?void 0:i.attrs,a=e.attrs;n&&s&&(s.CHANNELS!==a.CHANNELS||s.NAME!==a.NAME||s.LANGUAGE!==a.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(v.AUDIO_TRACK_SWITCHED,ze({},e))}},Hd=class extends Xr{constructor(e){super(e,"[audio-track-controller]");this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){let{id:n,groupId:i,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Track with id:${n} and group:${i} not found in active group ${a.groupId}`);return}let o=a.details;a.details=t.details,this.log(`audio-track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!(t!=null&&t.audioGroupIds))return;let n=t.audioGroupIds[t.urlId];if(this.groupId!==n){this.groupId=n||null;let i=this.tracks.filter(a=>!n||a.groupId===n);this.selectDefaultTrack&&!i.some(a=>a.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;let s={audioTracks:i};this.log(`Updating audio tracks, ${i.length} track(s) found in group:${n}`),this.hls.trigger(v.AUDIO_TRACKS_UPDATED,s),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===pe.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){let t=this.tracksInGroup;if(e<0||e>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();let n=this.currentTrack;t[this.trackId];let i=t[e],{groupId:s,name:a}=i;if(this.log(`Switching to audio-track ${e} "${a}" lang:${i.lang} group:${s}`),this.trackId=e,this.currentTrack=i,this.selectDefaultTrack=!1,this.hls.trigger(v.AUDIO_TRACK_SWITCHING,ze({},i)),i.details&&!i.details.live)return;let o=this.switchParams(i.url,n==null?void 0:n.details);this.loadPlaylist(o)}selectInitialTrack(){let e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(t!==-1)this.setAudioTrack(t);else{let n=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(n.message),this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:n})}}findTrackId(e){let t=this.tracksInGroup;for(let n=0;n<t.length;n++){let i=t[n];if((!this.selectDefaultTrack||i.default)&&(!e||e.attrs["STABLE-RENDITION-ID"]===i.attrs["STABLE-RENDITION-ID"]||e.name===i.name&&e.lang===i.lang))return i.id}return-1}loadPlaylist(e){super.loadPlaylist();let t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){let n=t.id,i=t.groupId,s=t.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`loading audio-track playlist ${n} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(v.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:e||null})}}};function Wd(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!Ey(r[t].attrs,e[t].attrs))return!1;return!0}function Ey(r,e){let t=r["STABLE-RENDITION-ID"];return t?t===e["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(n=>r[n]!==e[n])}var Kd=500,qd=class extends ts{constructor(e,t,n){super(e,t,n,"[subtitle-stream-controller]",Z.SUBTITLE);this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){let{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.ERROR,this.onError,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.ERROR,this.onError,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=U.IDLE,this.setInterval(Kd),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){let{frag:n,success:i}=t;if(this.fragPrevious=n,this.state=U.IDLE,!i)return;let s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a,o=n.start;for(let c=0;c<s.length;c++)if(o>=s[c].start&&o<=s[c].end){a=s[c];break}let l=n.start+n.duration;a?a.end=l:(a={start:o,end:l},s.push(a)),this.fragmentTracker.fragBuffered(n)}onBufferFlushing(e,t){let{startOffset:n,endOffset:i}=t;if(n===0&&i!==Number.POSITIVE_INFINITY){let{currentTrackId:s,levels:a}=this;if(!a.length||!a[s]||!a[s].details)return;let l=a[s].details.targetduration,c=i-l;if(c<=0)return;t.endOffsetSubtitles=Math.max(0,c),this.tracksBuffered.forEach(u=>{for(let d=0;d<u.length;){if(u[d].end<=c){u.shift();continue}else if(u[d].start<c)u[d].start=c;else break;d++}}),this.fragmentTracker.removeFragmentsInRange(n,c,Z.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===Z.MAIN){var n;(n=this.media)!=null&&n.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){let n=t.frag;(n==null?void 0:n.type)===Z.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==U.STOPPED&&(this.state=U.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(Wd(this.levels,t)){this.levels=t.map(n=>new ti(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{let i=new ti(n);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Z.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}let n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(Kd)}onSubtitleTrackLoaded(e,t){var n;let{details:i,id:s}=t,{currentTrackId:a,levels:o}=this;if(!o.length)return;let l=o[a];if(s>=o.length||s!==a||!l)return;this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(i.live||(n=l.details)!=null&&n.live){let u=this.mainDetails;if(i.deltaUpdateFailed||!u)return;let d=u.fragments[0];l.details?(c=this.alignPlaylists(i,l.details),c===0&&d&&(c=d.start,_a(i,c))):i.hasProgramDateTime&&u.hasProgramDateTime?(hd(i,u),c=i.fragments[0].start):d&&(c=d.start,_a(i,c))}l.details=i,this.levelLastLoaded=s,!this.startFragRequested&&(this.mainDetails||!i.live)&&this.setStartPosition(l.details,c),this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===U.IDLE&&(Ui(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(e){let{frag:t,payload:n}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&i&&i.key&&i.iv&&i.method==="AES-128"){let a=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).catch(o=>{throw s.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{let l=performance.now();s.trigger(v.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=U.IDLE})}}doTick(){if(!this.media){this.state=U.IDLE;return}if(this.state===U.IDLE){let{currentTrackId:e,levels:t}=this,n=t[e];if(!t.length||!n||!n.details)return;let i=n.details,s=i.targetduration,{config:a}=this,o=this.getLoadPosition(),l=_e.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o-s,a.maxBufferHole),{end:c,len:u}=l,d=this.getFwdBufferInfo(this.media,Z.MAIN),h=this.getMaxBufferLength(d==null?void 0:d.len)+s;if(u>h)return;let f=i.fragments,m=f.length,p=i.edge,g=null,T=this.fragPrevious;if(c<p){let{maxFragLookUpTolerance:_}=a;g=Ui(T,f,Math.max(f[0].start,c),_),!g&&T&&T.start<f[0].start&&(g=f[0])}else g=f[m-1];if(!g)return;g=this.mapToInitFragWhenRequired(g),this.fragmentTracker.getState(g)===Ve.NOT_LOADED&&this.loadFragment(g,n,c)}}getMaxBufferLength(e){let t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,n){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,n))}get mediaBufferTimeRanges(){return new zd(this.tracksBuffered[this.currentTrackId]||[])}},zd=class{constructor(e){this.buffered=void 0;let t=(n,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}},Yd=class extends Xr{constructor(e){super(e,"[subtitle-track-controller]");this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){let{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,!!this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),qa(this.media.textTracks).forEach(t=>{ei(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){let{id:n,details:i}=t,{trackId:s}=this,a=this.tracksInGroup[s];if(!a){this.warn(`Invalid subtitle track id ${n}`);return}let o=a.details;a.details=t.details,this.log(`subtitle track ${n} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!(t!=null&&t.textGroupIds))return;let n=t.textGroupIds[t.urlId],i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==n){let s=this.tracks.filter(l=>!n||l.groupId===n);this.tracksInGroup=s;let a=this.findTrackId(i==null?void 0:i.name)||this.findTrackId();this.groupId=n||null;let o={subtitleTracks:s};this.log(`Updating subtitle tracks, ${s.length} track(s) found in "${n}" group-id`),this.hls.trigger(v.SUBTITLE_TRACKS_UPDATED,o),a!==-1&&this.setSubtitleTrack(a,i)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId,i)}findTrackId(e){let t=this.tracksInGroup;for(let n=0;n<t.length;n++){let i=t[n];if((!this.selectDefaultTrack||i.default)&&(!e||e===i.name))return i.id}return-1}onError(e,t){t.fatal||!t.context||t.context.type===pe.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;let t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(e){super.loadPlaylist();let t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){let n=t.id,i=t.groupId,s=t.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(v.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(e){let{media:t,trackId:n}=this;if(!t)return;let i=qa(t.textTracks),s=i.filter(o=>o.groupId===this.groupId);if(e===-1)[].slice.call(i).forEach(o=>{o.mode="disabled"});else{let o=s[n];o&&(o.mode="disabled")}let a=s[e];a&&(a.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var n;let i=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(e===-1||(n=i[e])!=null&&n.details)||e<-1||e>=i.length)return;this.clearTimer();let s=i[e];if(this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:"")),this.trackId=e,s){let{id:a,groupId:o="",name:l,type:c,url:u}=s;this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:c,url:u});let d=this.switchParams(s.url,t==null?void 0:t.details);this.loadPlaylist(d)}else this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1,t=qa(this.media.textTracks);for(let n=0;n<t.length;n++)if(t[n].mode==="hidden")e=n;else if(t[n].mode==="showing"){e=n;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}};function qa(r){let e=[];for(let t=0;t<r.length;t++){let n=r[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(r[t])}return e}var Xd=class{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){let n=this.queues[t];n.push(e),n.length===1&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t,n=new Promise(s=>{t=s}),i={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(i,e),n}executeNext(e){let{buffers:t,queues:n}=this,i=t[e],s=n[e];if(s.length){let a=s[0];try{a.execute()}catch(o){R.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),a.onError(o),i!=null&&i.updating||(s.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}},Qd=Ra(),Jd=/([ha]vc.)(?:\.[^.,]+)+/,Zd=class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{let{media:t,mediaSource:n}=this;R.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(v.MEDIA_ATTACHED,{media:t})),n&&n.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{R.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{R.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{let{media:t,_objectUrl:n}=this;t&&t.src!==n&&R.error(`Media element src was set while attaching MediaSource (${n} > ${t.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){let{hls:e}=this;e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_APPENDING,this.onBufferAppending,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.BUFFER_EOS,this.onBufferEos,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.FRAG_PARSED,this.onFragParsed,this),e.on(v.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){let{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_APPENDING,this.onBufferAppending,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.BUFFER_EOS,this.onBufferEos,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.FRAG_PARSED,this.onFragParsed,this),e.off(v.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Xd(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestParsed(e,t){let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,R.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){let n=this.media=t.media;if(n&&Qd){let i=this.mediaSource=new Qd;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(i),this._objectUrl=n.src,n.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){let{media:e,mediaSource:t,_objectUrl:n}=this;if(t){if(R.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(i){R.warn(`[buffer-controller]: onMediaDetaching: ${i.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),e.src===n?(e.removeAttribute("src"),e.load()):R.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(v.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{let t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(n){R.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,n)}}),this._initSourceBuffer()}onBufferCodecs(e,t){let n=this.getSourceBufferTypes().length;Object.keys(t).forEach(i=>{if(n){let s=this.tracks[i];if(s&&typeof s.buffer.changeType=="function"){let{id:a,codec:o,levelCodec:l,container:c,metadata:u}=t[i],d=(s.levelCodec||s.codec).replace(Jd,"$1"),h=(l||o).replace(Jd,"$1");if(d!==h){let f=`${c};codecs=${l||o}`;this.appendChangeType(i,f),R.log(`[buffer-controller]: switching codec ${d} to ${h}`),this.tracks[i]={buffer:s.buffer,codec:o,container:c,levelCodec:l,metadata:u,id:a}}}}else this.pendingTracks[i]=t[i]}),!n&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(e,t){let{operationQueue:n}=this,i={execute:()=>{let s=this.sourceBuffer[e];s&&(R.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),s.changeType(t)),n.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:s=>{R.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,s)}};n.append(i,e)}onBufferAppending(e,t){let{hls:n,operationQueue:i,tracks:s}=this,{data:a,type:o,frag:l,part:c,chunkMeta:u}=t,d=u.buffering[o],h=self.performance.now();d.start=h;let f=l.stats.buffering,m=c?c.stats.buffering:null;f.start===0&&(f.start=h),m&&m.start===0&&(m.start=h);let p=s.audio,g=!1;o==="audio"&&(p==null?void 0:p.container)==="audio/mpeg"&&(g=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);let T=l.start,_={execute:()=>{if(d.executeStart=self.performance.now(),g){let y=this.sourceBuffer[o];if(y){let b=T-y.timestampOffset;Math.abs(b)>=.1&&(R.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${T} (delta: ${b}) sn: ${l.sn})`),y.timestampOffset=T)}}this.appendExecutor(a,o)},onStart:()=>{},onComplete:()=>{let y=self.performance.now();d.executeEnd=d.end=y,f.first===0&&(f.first=y),m&&m.first===0&&(m.first=y);let{sourceBuffer:b}=this,E={};for(let C in b)E[C]=_e.getBuffered(b[C]);this.appendError=0,this.hls.trigger(v.BUFFER_APPENDED,{type:o,frag:l,part:c,chunkMeta:u,parent:l.type,timeRanges:E})},onError:y=>{R.error(`[buffer-controller]: Error encountered while trying to append to the ${o} SourceBuffer`,y);let b={type:J.MEDIA_ERROR,parent:l.type,details:F.BUFFER_APPEND_ERROR,frag:l,part:c,chunkMeta:u,error:y,err:y,fatal:!1};y.code===DOMException.QUOTA_EXCEEDED_ERR?b.details=F.BUFFER_FULL_ERROR:(this.appendError++,b.details=F.BUFFER_APPEND_ERROR,this.appendError>n.config.appendErrorMaxRetry&&(R.error(`[buffer-controller]: Failed ${n.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),b.fatal=!0)),n.trigger(v.ERROR,b)}};i.append(_,o)}onBufferFlushing(e,t){let{operationQueue:n}=this,i=s=>({execute:this.removeExecutor.bind(this,s,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(v.BUFFER_FLUSHED,{type:s})},onError:a=>{R.warn(`[buffer-controller]: Failed to remove from ${s} SourceBuffer`,a)}});t.type?n.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(s=>{n.append(i(s),s)})}onFragParsed(e,t){let{frag:n,part:i}=t,s=[],a=i?i.elementaryStreams:n.elementaryStreams;a[be.AUDIOVIDEO]?s.push("audiovideo"):(a[be.AUDIO]&&s.push("audio"),a[be.VIDEO]&&s.push("video"));let o=()=>{let l=self.performance.now();n.stats.buffering.end=l,i&&(i.stats.buffering.end=l);let c=i?i.stats:n.stats;this.hls.trigger(v.FRAG_BUFFERED,{frag:n,part:i,stats:c,id:n.type})};s.length===0&&R.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(o,s)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((i,s)=>{let a=this.sourceBuffer[s];return a&&(!t.type||t.type===s)&&(a.ending=!0,a.ended||(a.ended=!0,R.log(`[buffer-controller]: ${s} sourceBuffer now EOS`))),i&&!!(!a||a.ended)},!0)&&(R.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{let a=this.sourceBuffer[s];a&&(a.ending=!1)});let{mediaSource:i}=this;if(!i||i.readyState!=="open"){i&&R.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${i.readyState}`);return}R.log("[buffer-controller]: Calling mediaSource.endOfStream()"),i.endOfStream()}))}onLevelUpdated(e,{details:t}){!t.fragments.length||(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){let{hls:e,details:t,media:n,sourceBuffer:i}=this;if(!n||t===null)return;let s=this.getSourceBufferTypes();if(!s.length)return;let a=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!X(a)||a<0)return;let o=n.currentTime,l=t.levelTargetDuration,c=Math.max(a,l),u=Math.floor(o/l)*l-c;s.forEach(d=>{let h=i[d];if(h){let f=_e.getBuffered(h);if(f.length>0&&u>f.start(0)){if(e.trigger(v.BACK_BUFFER_REACHED,{bufferEnd:u}),t.live)e.trigger(v.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u});else if(h.ended&&f.end(f.length-1)-o<l*2){R.info(`[buffer-controller]: Cannot flush ${d} back buffer while SourceBuffer is in ended state`);return}e.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:d})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;let{details:e,hls:t,media:n,mediaSource:i}=this,s=e.fragments[0].start+e.totalduration,a=n.duration,o=X(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(R.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=Infinity,this.updateSeekableRange(e)):(s>o&&s>a||!X(a))&&(R.log(`[buffer-controller]: Updating Media Source duration to ${s.toFixed(3)}`),i.duration=s)}updateSeekableRange(e){let t=this.mediaSource,n=e.fragments;if(n.length&&e.live&&t!=null&&t.setLiveSeekableRange){let s=Math.max(0,n[0].start),a=Math.max(s,s+e.totalduration);t.setLiveSeekableRange(s,a)}}checkPendingTracks(){let{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:n}=this,i=Object.keys(n).length;if(i&&!e||i===2){this.createSourceBuffers(n),this.pendingTracks={};let s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(v.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(a=>{t.executeNext(a)});else{let a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}createSourceBuffers(e){let{sourceBuffer:t,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(let i in e)if(!t[i]){let s=e[i];if(!s)throw Error(`source buffer exists for track ${i}, however track does not`);let a=s.levelCodec||s.codec,o=`${s.container};codecs=${a}`;R.log(`[buffer-controller]: creating sourceBuffer(${o})`);try{let l=t[i]=n.addSourceBuffer(o),c=i;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.tracks[i]={buffer:l,codec:a,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(l){R.error(`[buffer-controller]: error while trying to add sourceBuffer: ${l.message}`),this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:o})}}}_onSBUpdateStart(e){let{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){let{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){let n=new Error(`${e} SourceBuffer error`);R.error(`[buffer-controller]: ${n}`,t),this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:F.BUFFER_APPENDING_ERROR,error:n,fatal:!1});let i=this.operationQueue.current(e);i&&i.onError(t)}removeExecutor(e,t,n){let{media:i,mediaSource:s,operationQueue:a,sourceBuffer:o}=this,l=o[e];if(!i||!s||!l){R.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),a.shiftAndExecuteNext(e);return}let c=X(i.duration)?i.duration:Infinity,u=X(s.duration)?s.duration:Infinity,d=Math.max(0,t),h=Math.min(n,c,u);h>d&&!l.ending?(l.ended=!1,R.log(`[buffer-controller]: Removing [${d},${h}] from the ${e} SourceBuffer`),l.remove(d,h)):a.shiftAndExecuteNext(e)}appendExecutor(e,t){let{operationQueue:n,sourceBuffer:i}=this,s=i[t];if(!s){R.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),n.shiftAndExecuteNext(t);return}s.ended=!1,s.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){R.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}let{operationQueue:n}=this,i=t.map(s=>n.appendBlocker(s));Promise.all(i).then(()=>{e(),t.forEach(s=>{let a=this.sourceBuffer[s];a!=null&&a.updating||n.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,n){let i=this.sourceBuffer[e];if(!i)return;let s=n.bind(this,e);this.listeners[e].push({event:t,listener:s}),i.addEventListener(t,s)}removeBufferListeners(e){let t=this.sourceBuffer[e];!t||this.listeners[e].forEach(n=>{t.removeEventListener(n.event,n.listener)})}},eh={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},th=function(e){let t=e;return eh.hasOwnProperty(e)&&(t=eh[e]),String.fromCharCode(t)},kt=15,rn=100,Sy={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},_y={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ay={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},wy={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Ly=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],nh=class{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){let n=typeof t=="function"?t():t;R.log(`${this.time} [${e}] ${n}`)}}},On=function(e){let t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t},za=class{constructor(e,t,n,i,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=i||"black",this.flash=s||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){let t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){let i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}},ih=class{constructor(e,t,n,i,s,a){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new za(t,n,i,s,a)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}},rh=class{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let t=0;t<rn;t++)this.chars.push(new ih);this.logger=e,this.pos=0,this.currPenState=new za}equals(e){let t=!0;for(let n=0;n<rn;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t}copy(e){for(let t=0;t<rn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<rn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>rn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=rn)}moveCursor(e){let t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();let t=th(e);if(this.pos>=rn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<rn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){let e=[],t=!0;for(let n=0;n<rn;n++){let i=this.chars[n].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}},ls=class{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<kt;t++)this.rows.push(new rh(e));this.logger=e,this.currRow=kt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<kt;e++)this.rows[e].clear();this.currRow=kt-1}equals(e){let t=!0;for(let n=0;n<kt;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<kt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<kt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<kt;o++)this.rows[o].clear();let s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){let o=a.rows[s].cueStartTime,l=this.logger.time;if(o&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[s+c])}}this.currRow=t;let n=this.rows[this.currRow];if(e.indent!==null){let s=e.indent,a=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}let i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());let e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;let t=[],n="",i=-1;for(let s=0;s<kt;s++){let a=this.rows[s].getTextString();a&&(i=s+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}},Ya=class{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new ls(n),this.nonDisplayedMemory=new ls(n),this.lastOutputScreen=new ls(n),this.currRollUpRow=this.displayedMemory.rows[kt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[kt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);let t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){let e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){let t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{let n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){let t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}},Xa=class{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;let i=new nh;this.channels=[null,new Ya(e,t,i),new Ya(e+1,n,i)],this.cmdHistory=ah(),this.logger=i}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let n,i,s,a=!1;this.logger.time=e;for(let o=0;o<t.length;o+=2)if(i=t[o]&127,s=t[o+1]&127,!(i===0&&s===0)){if(this.logger.log(3,"["+On([t[o],t[o+1]])+"] -> ("+On([i,s])+")"),n=this.parseCmd(i,s),n||(n=this.parseMidrow(i,s)),n||(n=this.parsePAC(i,s)),n||(n=this.parseBackgroundAttributes(i,s)),!n&&(a=this.parseChars(i,s),a)){let l=this.currentChannel;l&&l>0?this.channels[l].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!n&&!a&&this.logger.log(2,"Couldn't parse cleaned data "+On([i,s])+" orig: "+On([t[o],t[o+1]]))}}parseCmd(e,t){let{cmdHistory:n}=this,i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(i||s))return!1;if(sh(e,t,n))return ii(null,null,n),this.logger.log(3,"Repeated command ("+On([e,t])+") is dropped"),!0;let a=e===20||e===21||e===23?1:2,o=this.channels[a];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),ii(e,t,n),this.currentChannel=a,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;let i=this.channels[n];return i?(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+On([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n,i=this.cmdHistory,s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(e===16||e===24)&&t>=64&&t<=95;if(!(s||a))return!1;if(sh(e,t,i))return ii(null,null,i),!0;let o=e<=23?1:2;t>=64&&t<=95?n=o===1?Sy[e]:Ay[e]:n=o===1?_y[e]:wy[e];let l=this.channels[o];return l?(l.setPAC(this.interpretPAC(n,t)),ii(e,t,i),this.currentChannel=o,!0):!1}interpretPAC(e,t){let n,i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,i.underline=(n&1)==1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((n-16)/2)*4,i}parseChars(e,t){let n,i=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,"Special char '"+th(a)+"' in channel "+n),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);if(i){let a=On(i);this.logger.log(3,"Char codes =  "+a.join(",")),ii(e,t,this.cmdHistory)}return i}parseBackgroundAttributes(e,t){let n=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(n||i))return!1;let s,a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=Ly[s],t%2==1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));let o=e<=23?1:2;return this.channels[o].setBkgData(a),ii(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){let t=this.channels[e];t&&t.reset()}this.cmdHistory=ah()}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){let n=this.channels[t];n&&n.cueSplitAtTime(e)}}};function ii(r,e,t){t.a=r,t.b=e}function sh(r,e,t){return t.a===r&&t.b===e}function ah(){return{a:null,b:null}}var Vi=class{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}},Qa=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;let r=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;let c=l.toLowerCase();return~o.indexOf(c)?c:!1}function n(o){return t(r,o)}function i(o){return t(e,o)}function s(o,...l){let c=1;for(;c<arguments.length;c++){let u=arguments[c];for(let d in u)o[d]=u[d]}return o}function a(o,l,c){let u=this,d={enumerable:!0};u.hasBeenReset=!1;let h="",f=!1,m=o,p=l,g=c,T=null,_="",y=!0,b="auto",E="start",C=50,w="middle",O=50,S="middle";Object.defineProperty(u,"id",s({},d,{get:function(){return h},set:function(I){h=""+I}})),Object.defineProperty(u,"pauseOnExit",s({},d,{get:function(){return f},set:function(I){f=!!I}})),Object.defineProperty(u,"startTime",s({},d,{get:function(){return m},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");m=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",s({},d,{get:function(){return p},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");p=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",s({},d,{get:function(){return g},set:function(I){g=""+I,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",s({},d,{get:function(){return T},set:function(I){T=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",s({},d,{get:function(){return _},set:function(I){let N=n(I);if(N===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",s({},d,{get:function(){return y},set:function(I){y=!!I,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",s({},d,{get:function(){return b},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");b=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",s({},d,{get:function(){return E},set:function(I){let N=i(I);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");E=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",s({},d,{get:function(){return C},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");C=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",s({},d,{get:function(){return w},set:function(I){let N=i(I);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");w=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",s({},d,{get:function(){return O},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");O=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",s({},d,{get:function(){return S},set:function(I){let N=i(I);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");S=N,this.hasBeenReset=!0}})),u.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}(),oh=class{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}};function lh(r){function e(n,i,s,a){return(n|0)*3600+(i|0)*60+(s|0)+parseFloat(a||0)}let t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}var ch=class{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){let n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}};function uh(r,e,t,n){let i=n?r.split(n):[r];for(let s in i){if(typeof i[s]!="string")continue;let a=i[s].split(t);if(a.length!==2)continue;let o=a[0],l=a[1];e(o,l)}}var Ja=new Qa(0,0,""),cs=Ja.align==="middle"?"middle":"center";function Iy(r,e,t){let n=r;function i(){let o=lh(r);if(o===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,l){let c=new ch;uh(o,function(h,f){let m;switch(h){case"region":for(let p=t.length-1;p>=0;p--)if(t[p].id===f){c.set(h,t[p].region);break}break;case"vertical":c.alt(h,f,["rl","lr"]);break;case"line":m=f.split(","),c.integer(h,m[0]),c.percent(h,m[0])&&c.set("snapToLines",!1),c.alt(h,m[0],["auto"]),m.length===2&&c.alt("lineAlign",m[1],["start",cs,"end"]);break;case"position":m=f.split(","),c.percent(h,m[0]),m.length===2&&c.alt("positionAlign",m[1],["start",cs,"end","line-left","line-right","auto"]);break;case"size":c.percent(h,f);break;case"align":c.alt(h,f,["start",cs,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&Ja.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",cs);let d=c.get("position","auto");d==="auto"&&Ja.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),a(),e.endTime=i(),a(),s(r,e)}function dh(r){return r.replace(/<br(?: \/)?>/gi,`
`)}var hh=class{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new oh,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){let t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,a=0;for(s=dh(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;let o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),o}function i(s){uh(s,function(a,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();let o=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=n(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new Qa(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Iy(s,t.cue,t.regionList)}catch(o){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{let o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch(s){t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){let e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}},Cy=/\r\n|\n\r|\n|\r/g,Za=function(e,t,n=0){return e.slice(n,n+t.length)===t},Ry=function(e){let t=parseInt(e.slice(-3)),n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!X(t)||!X(n)||!X(i)||!X(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*i,t+=60*60*1e3*s,t},eo=function(e){let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return(t>>>0).toString()};function to(r,e,t){return eo(r.toString())+eo(e.toString())+eo(t)}var Py=function(e,t,n){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=n};function ky(r,e,t,n,i,s,a){let o=new hh,l=Nt(new Uint8Array(r)).trim().replace(Cy,`
`).split(`
`),c=[],u=cy(e.baseTime,e.timescale),d="00:00.000",h=0,f=0,m,p=!0;o.oncue=function(g){let T=t[n],_=t.ccOffset,y=(h-u)/9e4;T!=null&&T.new&&(f!==void 0?_=t.ccOffset=T.start:Py(t,n,y)),y&&(_=y-t.presentationOffset);let b=g.endTime-g.startTime,E=vt((g.startTime+_-f)*9e4,i*9e4)/9e4;g.startTime=Math.max(E,0),g.endTime=Math.max(E+b,0);let C=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(C)),g.id||(g.id=to(g.startTime,g.endTime,C)),g.endTime>0&&c.push(g)},o.onparsingerror=function(g){m=g},o.onflush=function(){if(m){a(m);return}s(c)},l.forEach(g=>{if(p)if(Za(g,"X-TIMESTAMP-MAP=")){p=!1,g.slice(16).split(",").forEach(T=>{Za(T,"LOCAL:")?d=T.slice(6):Za(T,"MPEGTS:")&&(h=parseInt(T.slice(7)))});try{f=Ry(d)/1e3}catch(T){m=T}return}else g===""&&(p=!1);o.parse(g+`
`)}),o.flush()}var no="stpp.ttml.im1t",fh=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,mh=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Dy={left:"start",center:"center",right:"end",start:"start",end:"end"};function ph(r,e,t,n){let i=he(new Uint8Array(r),["mdat"]);if(i.length===0){n(new Error("Could not parse IMSC1 mdat"));return}let s=i.map(o=>Nt(o)),a=ly(e.baseTime,1,e.timescale);try{s.forEach(o=>t(xy(o,a)))}catch(o){n(o)}}function xy(r,e){let i=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");let s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((d,h)=>(d[h]=i.getAttribute(`ttp:${h}`)||s[h],d),{}),o=i.getAttribute("xml:space")!=="preserve",l=gh(io(i,"styling","style")),c=gh(io(i,"layout","region")),u=io(i,"body","[begin]");return[].map.call(u,d=>{let h=vh(d,o);if(!h||!d.hasAttribute("begin"))return null;let f=ro(d.getAttribute("begin"),a),m=ro(d.getAttribute("dur"),a),p=ro(d.getAttribute("end"),a);if(f===null)throw yh(d);if(p===null){if(m===null)throw yh(d);p=f+m}let g=new Qa(f-e,p-e,h);g.id=to(g.startTime,g.endTime,g.text);let T=c[d.getAttribute("region")],_=l[d.getAttribute("style")],y=Oy(T,_,l),{textAlign:b}=y;if(b){let E=Dy[b];E&&(g.lineAlign=E),g.align=b}return Oe(g,y),g}).filter(d=>d!==null)}function io(r,e,t){let n=r.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function gh(r){return r.reduce((e,t)=>{let n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function vh(r,e){return[].slice.call(r.childNodes).reduce((t,n,i)=>{var s;return n.nodeName==="br"&&i?t+`
`:(s=n.childNodes)!=null&&s.length?vh(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function Oy(r,e,t){let n="http://www.w3.org/ns/ttml#styling",i=null,s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),s.reduce((o,l)=>{let c=so(e,n,l)||so(r,n,l)||so(i,n,l);return c&&(o[l]=c),o},{})}function so(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function yh(r){return new Error(`Could not parse ttml timestamp ${r}`)}function ro(r,e){if(!r)return null;let t=lh(r);return t===null&&(fh.test(r)?t=My(r,e):mh.test(r)&&(t=Fy(r,e))),t}function My(r,e){let t=fh.exec(r),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function Fy(r,e){let t=mh.exec(r),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}var bh=class{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Th(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){let t=new Vi(this,"textTrack1"),n=new Vi(this,"textTrack2"),i=new Vi(this,"textTrack3"),s=new Vi(this,"textTrack4");this.cea608Parser1=new Xa(1,t,n),this.cea608Parser2=new Xa(3,i,s)}e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){let{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,n,i,s){let a=!1;for(let o=s.length;o--;){let l=s[o],c=By(l[0],l[1],t,n);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],n),a=!0,c/(n-t)>.5))return}if(a||s.push([t,n]),this.config.renderTextTracksNatively){let o=this.captionsTracks[e];this.Cues.newCue(o,t,n,i)}else{let o=this.Cues.newCue(null,t,n,i);this.hls.trigger(v.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s}){let{unparsedVttFrags:a}=this;n==="main"&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),a.length&&(this.unparsedVttFrags=[],a.forEach(o=>{this.onFragLoaded(v.FRAG_LOADED,o)}))}getExistingTrack(e){let{media:t}=this;if(t)for(let n=0;n<t.textTracks.length;n++){let i=t.textTracks[n];if(i[e])return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;let{captionsProperties:t,captionsTracks:n,media:i}=this,{label:s,languageCode:a}=t[e],o=this.getExistingTrack(e);if(o)n[e]=o,ei(n[e]),ju(n[e],i);else{let l=this.createTextTrack("captions",s,a);l&&(l[e]=!0,n[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;let t=this.captionsProperties[e];if(!t)return;let n=t.label,i={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){let i=this.media;if(!!i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){let{captionsTracks:e}=this;Object.keys(e).forEach(t=>{ei(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Th(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){let{media:e}=this;if(!e)return;let t=e.textTracks;if(t)for(let n=0;n<t.length;n++)ei(t[n])}onSubtitleTracksUpdated(e,t){let n=t.subtitleTracks||[],i=n.some(s=>s.textCodec===no);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(Wd(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){let a=this.media?this.media.textTracks:null;this.tracks.forEach((o,l)=>{let c;if(a&&l<a.length){let u=null;for(let d=0;d<a.length;d++)if(Ny(a[d],o)){u=a[d];break}u&&(c=u)}if(c)ei(c);else{let u=this._captionsOrSubtitlesFromCharacteristics(o);c=this.createTextTrack(u,o.name,o.lang),c&&(c.mode="disabled")}c&&(c.groupId=o.groupId,this.textTracks.push(c))})}else if(this.tracks.length){let a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){let t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&n)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{let i=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!i)return;let s=`textTrack${i[1]}`,a=this.captionsProperties[s];!a||(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){let t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){let{cea608Parser1:n,cea608Parser2:i,lastSn:s,lastPartIndex:a}=this;if(!(!this.enabled||!(n&&i))&&t.frag.type===Z.MAIN){var o,l;let c=t.frag.sn,u=(o=t==null||(l=t.part)==null?void 0:l.index)!=null?o:-1;c===s+1||c===s&&u===a+1||(n.reset(),i.reset()),this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){let{frag:n,payload:i}=t,{initPTS:s,unparsedVttFrags:a}=this;if(n.type===Z.SUBTITLE)if(i.byteLength){if(!s[n.cc]){a.push(t),s.length&&this.hls.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")});return}let o=n.decryptdata,l="stats"in t;if(o==null||!o.encrypted||l){let c=this.tracks[n.level],u=this.vttCCs;u[n.cc]||(u[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),c&&c.textCodec===no?this._parseIMSC1(n,i):this._parseVTTs(n,i,u)}}else this.hls.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){let n=this.hls;ph(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),n.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{R.log(`Failed to parse IMSC1: ${i}`),n.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e,t,n){var i;let s=this.hls,a=(i=e.initSegment)!=null&&i.data?Dn(e.initSegment.data,new Uint8Array(t)):t;ky(a,this.initPTS[e.cc],n,e.cc,e.start,o=>{this._appendCues(o,e.level),s.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},o=>{this._fallbackToIMSC1(e,t),R.log(`Failed to parse VTT cue: ${o}`),s.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:o})})}_fallbackToIMSC1(e,t){let n=this.tracks[e.level];n.textCodec||ph(t,this.initPTS[e.cc],()=>{n.textCodec=no,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){let n=this.hls;if(this.config.renderTextTracksNatively){let i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>Hu(i,s))}else{let i=this.tracks[t];if(!i)return;let s=i.default?"default":"subtitles"+t;n.trigger(v.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){let{frag:n}=t;if(n.type===Z.SUBTITLE){if(!this.initPTS[n.cc]){this.unparsedVttFrags.push(t);return}this.onFragLoaded(v.FRAG_LOADED,t)}}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){let{cea608Parser1:n,cea608Parser2:i}=this;if(!this.enabled||!(n&&i))return;let{frag:s,samples:a}=t;if(!(s.type===Z.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let o=0;o<a.length;o++){let l=a[o].bytes;if(l){let c=this.extractCea608Data(l);n.addData(a[o].pts,c[0]),i.addData(a[o].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:s}){let{media:a}=this;if(!(!a||a.currentTime<n)){if(!s||s==="video"){let{captionsTracks:o}=this;Object.keys(o).forEach(l=>va(o[l],t,n))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){let{textTracks:o}=this;Object.keys(o).forEach(l=>va(o[l],t,i))}}}extractCea608Data(e){let t=[[],[]],n=e[0]&31,i=2;for(let s=0;s<n;s++){let a=e[i++],o=127&e[i++],l=127&e[i++];if(o===0&&l===0)continue;if((4&a)!=0){let u=3&a;(u===0||u===1)&&(t[u].push(o),t[u].push(l))}}return t}};function Ny(r,e){return!!r&&r.label===e.name&&!(r.textTrack1||r.textTrack2)}function By(r,e,t,n){return Math.min(e,n)-Math.max(r,t)}function Th(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var us=class{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){let{hls:e}=this;e.on(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){let{hls:e}=this;e.off(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){let n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){let n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){let e=this.hls.levels;if(e.length){let t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){let t=this.hls.levels;if(!t.length)return-1;let n=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,us.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;let e=this.media,t={width:0,height:0};if(e){let n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;let i=(a,o)=>o?a.width!==o.width||a.height!==o.height:!0,s=e.length-1;for(let a=0;a<e.length;a+=1){let o=e[a];if((o.width>=t||o.height>=n)&&i(o,e[a+1])){s=a;break}}return s}},Eh=class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){let n=this.hls.config;if(n.capLevelOnFPSDrop){let i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,n){let i=performance.now();if(t){if(this.lastTime){let s=i-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/s,c=this.hls;if(c.trigger(v.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),l>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let u=c.currentLevel;R.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(v.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){let e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){let t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},ds="[eme]",Mn=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Mn.CDMCleanupPromise?[Mn.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=R.debug.bind(R,ds),this.log=R.log.bind(R,ds),this.warn=R.warn.bind(R,ds),this.error=R.error.bind(R,ds),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();let e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(v.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(v.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){let{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===Ce.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){let{drmSystems:t}=this.config,n=t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){let t=this.hls.levels,n=(a,o,l)=>!!a&&l.indexOf(a)===o,i=t.map(a=>a.audioCodec).filter(n),s=t.map(a=>a.videoCodec).filter(n);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{let l=c=>{let u=c.shift();this.getMediaKeysPromise(u,i,s).then(d=>a({keySystem:u,mediaKeys:d})).catch(d=>{c.length?l(c):d instanceof st?o(d):o(new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){let{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${n}`;return vu===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return n(e,t)}getMediaKeysPromise(e,t,n){let i=Bg(e,t,n,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e],a=s==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(i)}`),a=this.requestMediaKeySystemAccess(e,i);let o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),a.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);let c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),o.mediaKeys=l.createMediaKeys().then(u=>(this.log(`Media-keys created for "${e}"`),c.then(d=>d?this.setMediaKeysServerCertificate(u,e,d):u))),o.mediaKeys.catch(u=>{this.error(`Failed to create media-keys for "${e}"}: ${u}`)}),o.mediaKeys})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Bt.hexDump(e.keyId||[])}`);let i=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){let t=e.decryptdata;if(t.pssh){let n=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,s,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Bt.hexDump(e.keyId)}updateKeySession(e,t){var n;let i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${Bt.hexDump(((n=e.decryptdata)==null?void 0:n.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),i.update(t)}selectKeySystemFormat(e){let t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,n)=>{let i=ua(this.config),s=e.map(mu).filter(a=>!!a&&i.indexOf(a)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:a})=>{let o=gu(a);o?t(o):n(new Error(`Unable to find format for key-system "${a}"`))}).catch(n)})}loadKey(e){let t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let s=this.keyIdToKeySessionPromise[n];return s||(s=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:o})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(a,o).then(()=>{this.throwIfDestroyed();let l=this.createMediaKeySessionContext({keySystem:a,mediaKeys:o,decryptdata:t}),c="cenc";return this.generateRequestWithPreferredKeySession(l,c,t.pssh,"playlist-key")}))),s.catch(a=>this.handleError(a))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){!this.hls||(this.error(e.message),e instanceof st?this.hls.trigger(v.ERROR,e.data):this.hls.trigger(v.ERROR,{type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){let t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){let i=mu(e.keyFormat),s=i?[i]:ua(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=ua(this.config)),e.length===0)throw new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){let{initDataType:t,initData:n}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),n===null)return;let i,s;if(t==="sinf"&&this.config.drmSystems[Ce.FAIRPLAY]){let u=Be(new Uint8Array(n));try{let d=ca(JSON.parse(u).sinf),h=wu(new Uint8Array(d));if(!h)return;i=h.subarray(8,24),s=Ce.FAIRPLAY}catch(d){this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{let u=ov(n);if(u===null)return;u.version===0&&u.systemId===pu.WIDEVINE&&u.data&&(i=u.data.subarray(8,24)),s=Fg(u.systemId)}if(!s||!i)return;let a=Bt.hexDump(i),{keyIdToKeySessionPromise:o,mediaKeySessions:l}=this,c=o[a];for(let u=0;u<l.length;u++){let d=l[u],h=d.decryptdata;if(h.pssh||!h.keyId)continue;let f=Bt.hexDump(h.keyId);if(a===f||h.uri.replace(/-/g,"").indexOf(a)!==-1){c=o[f],delete o[f],h.pssh=new Uint8Array(n),h.keyId=i,c=o[a]=c.then(()=>this.generateRequestWithPreferredKeySession(d,t,n,"encrypted-event-key-match"));break}}c||(c=o[a]=this.getKeySystemSelectionPromise([s]).then(({keySystem:u,mediaKeys:d})=>{var h;this.throwIfDestroyed();let f=new Zn("ISO-23001-7",a,(h=gu(u))!=null?h:"");return f.pssh=new Uint8Array(n),f.keyId=i,this.attemptSetMediaKeys(u,d).then(()=>{this.throwIfDestroyed();let m=this.createMediaKeySessionContext({decryptdata:f,keySystem:u,mediaKeys:d});return this.generateRequestWithPreferredKeySession(m,t,n,"encrypted-event-no-match")})})),c.catch(u=>this.handleError(u))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){let n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);let i=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,i){var s,a;let o=(s=this.config.drmSystems)==null||(a=s[e.keySystem])==null?void 0:a.generateRequest;if(o)try{let h=o.call(this.hls,t,n,e);if(!h)throw new Error("Invalid response from configured generateRequest filter");t=h.initDataType,n=e.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(h){var l;if(this.warn(h.message),(l=this.hls)!=null&&l.config.debug)throw h}if(n===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);let c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${c} (init data type: ${t} length: ${n?n.byteLength:null})`);let u=new Gi;e.mediaKeysSession.onmessage=h=>{let f=e.mediaKeysSession;if(!f){u.emit("error",new Error("invalid state"));return}let{messageType:m,message:p}=h;this.log(`"${m}" message event for session "${f.sessionId}" message size: ${p.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,p).catch(g=>{this.handleError(g),u.emit("error",g)}):m==="license-release"?e.keySystem===Ce.FAIRPLAY&&(this.updateKeySession(e,fu("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${m}"`)},e.mediaKeysSession.onkeystatuseschange=h=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);let m=e.keyStatus;u.emit("keyStatus",m),m==="expired"&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};let d=new Promise((h,f)=>{u.on("error",f),u.on("keyStatus",m=>{m.startsWith("usable")?h():m==="output-restricted"?f(new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):m==="internal-error"?f(new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${m}"`)):m==="expired"?f(new Error("key expired while generating request")):this.warn(`unhandled key status change "${m}"`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{var h;this.log(`Request generated for key-session "${(h=e.mediaKeysSession)==null?void 0:h.sessionId}" keyId: ${c}`)}).catch(h=>{throw new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_NO_SESSION,error:h,fatal:!1},`Error generating key-session request: ${h}`)}).then(()=>d).catch(h=>{throw u.removeAllListeners(),this.removeSession(e),h}).then(()=>(u.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,n)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Bt.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${Bt.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){let t=this.config,n=t.loader,i=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching serverCertificate for "${e}"`),new Promise((a,o)=>{let l={responseType:"arraybuffer",url:s},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,m,p)=>{a(h.data)},onError:(h,f,m,p)=>{o(new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:ze({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${s}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,m)=>{o(new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(h,f,m)=>{o(new Error("aborted"))}};i.load(l,u,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,s)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n==null?void 0:n.byteLength}) on "${t}"`),i(e)}).catch(a=>{s(new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(i=>{throw new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:i,fatal:!0},i.message)}))}setupLicenseXHR(e,t,n,i){let s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,i)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,n,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){let n=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{let a=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${a}`);let o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);let c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,a,e)}catch(u){this.error(u)}i(l)}else{let l=n.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)s(new st({type:J.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{let u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:c})=>{l.send(c)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;let n=t.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){let e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Zn.clearKeyUriToKeyIdMap();let n=t.length;Mn.CDMCleanupPromise=Promise.all(t.map(i=>this.removeSession(i)).concat(e==null?void 0:e.setMediaKeys(null).catch(i=>{this.log(`Could not clear media keys: ${i}. media.src: ${e==null?void 0:e.src}`)}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(i=>{this.log(`Could not close sessions and clear media keys: ${i}. media.src: ${e==null?void 0:e.src}`)})}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){let n=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){let{mediaKeysSession:t,licenseXhr:n}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),t.onmessage=null,t.onkeystatuseschange=null,n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;let i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),t.remove().catch(s=>{this.log(`Could not remove session: ${s}`)}).then(()=>t.close()).catch(s=>{this.log(`Could not close session: ${s}`)})}}};Mn.CDMCleanupPromise=void 0;var st=class extends Error{constructor(e,t){super(t);this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}},Uy=1,Ze={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},$y="h",sn=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Ze.MANIFEST,su:!this.initialized})}catch(s){R.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{let s=i.frag,a=this.hls.levels[s.level],o=this.getObjectType(s),l={d:s.duration*1e3,ot:o};(o===Ze.VIDEO||o===Ze.AUDIO||o==Ze.MUXED)&&(l.br=a.bitrate/1e3,l.tb=this.getTopBandwidth(o)/1e3,l.bl=this.getBufferLength(o)),this.apply(i,l)}catch(s){R.warn("Could not generate segment CMCD data.",s)}},this.hls=e;let t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||sn.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}registerListeners(){let e=this.hls;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHED,this.onMediaDetached,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){let e=this.hls;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHED,this.onMediaDetached,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:Uy,sf:$y,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Oe(t,this.createData());let n=t.ot===Ze.INIT||t.ot===Ze.VIDEO||t.ot===Ze.MUXED;if(this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){let i=sn.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),Oe(e.headers,i)}else{let i=sn.toQuery(t);if(!i)return;e.url=sn.appendQueryToUri(e.url,i)}}getObjectType(e){let{type:t}=e;if(t==="subtitle")return Ze.TIMED_TEXT;if(e.sn==="initSegment")return Ze.INIT;if(t==="audio")return Ze.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ze.VIDEO:Ze.MUXED}getTopBandwidth(e){let t=0,n,i=this.hls;if(e===Ze.AUDIO)n=i.audioTracks;else{let s=i.maxAutoLevel,a=s>-1?s+1:i.levels.length;n=i.levels.slice(0,a)}for(let s of n)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){let t=this.hls.media,n=e===Ze.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:_e.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){let{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}createFragmentLoader(){let{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}static uuid(){let e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){let t=[],n=c=>!Number.isNaN(c)&&c!=null&&c!==""&&c!==!1,i=c=>Math.round(c),s=c=>i(c/100)*100,o={br:i,d:i,bl:s,dl:s,mtp:s,nor:c=>encodeURIComponent(c),rtp:s,tb:i},l=Object.keys(e||{}).sort();for(let c of l){let u=e[c];if(!n(u)||c==="v"&&u===1||c=="pr"&&u===1)continue;let d=o[c];d&&(u=d(u));let h=typeof u,f;c==="ot"||c==="sf"||c==="st"?f=`${c}=${u}`:h==="boolean"?f=c:h==="number"?f=`${c}=${u}`:f=`${c}=${JSON.stringify(u)}`,t.push(f)}return t.join(",")}static toHeaders(e){let t=Object.keys(e),n={},i=["Object","Request","Session","Status"],s=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(let o of t){let l=a[o]!=null?a[o]:1;s[l][o]=e[o]}for(let o=0;o<s.length;o++){let l=sn.serialize(s[o]);l&&(n[`CMCD-${i[o]}`]=l)}return n}static toQuery(e){return`CMCD=${encodeURIComponent(sn.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;let n=e.includes("?")?"&":"?";return`${e}${n}${t}`}},Gy=3e5,Sh=class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=R.log.bind(R,"[content-steering]:"),this.registerListeners()}registerListeners(){let e=this.hls;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){let e=this.hls;!e||(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){let e=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){let t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){let{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){let{errorAction:n}=t;if((n==null?void 0:n.action)===Qe.SendAlternateToPenaltyBox&&n.flags===gt.MoveAllAlternatesMatchingHost){let i=this.pathwayPriority,s=this.pathwayId;this.penalizedPathways[s]||(this.penalizedPathways[s]=performance.now()),!i&&this.levels&&(i=this.levels.reduce((a,o)=>(a.indexOf(o.pathwayId)===-1&&a.push(o.pathwayId),a),[])),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==s)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){let n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t,n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(s=>{i-n[s]>Gy&&delete n[s]});for(let s=0;s<e.length;s++){let a=e[s];if(n[a])continue;if(a===this.pathwayId)return;let o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,this.hls.trigger(v.LEVELS_UPDATED,{levels:t});let c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}clonePathways(e){let t=this.levels;if(!t)return;let n={},i={};e.forEach(s=>{let{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=s;if(t.some(u=>u.pathwayId===a))return;let c=this.getLevelsForPathway(o).map(u=>{let d=Oe({},u);d.details=void 0,d.url=Ah(u.uri,u.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);let h=new Ae(u.attrs);h["PATHWAY-ID"]=a;let f=h.AUDIO&&`${h.AUDIO}_clone_${a}`,m=h.SUBTITLES&&`${h.SUBTITLES}_clone_${a}`;f&&(n[h.AUDIO]=f,h.AUDIO=f),m&&(i[h.SUBTITLES]=m,h.SUBTITLES=m),d.attrs=h;let p=new ti(d);return Qr(p,"audio",f),Qr(p,"text",m),p});t.push(...c),_h(this.audioTracks,n,l,a),_h(this.subtitleTracks,i,l,a)})}loadSteeringManifest(e){let t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let i;try{i=new self.URL(e)}catch(u){this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){let u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+u)}let s={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(u,d,h,f)=>{this.log(`Loaded steering manifest: "${i}"`);let m=u.data;if(m.VERSION!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;let{"RELOAD-URI":p,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":T}=m;if(p)try{this.uri=new self.URL(p,i).href}catch(_){this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||h.url),g&&this.clonePathways(g),T&&this.updatePathwayPriority(T)},onError:(u,d,h,f)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let m=this.timeToLoad*1e3;if(u.code===429){let p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){let g=p.getResponseHeader("Retry-After");g&&(m=parseFloat(g)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,m)},onTimeout:(u,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},t)}};function _h(r,e,t,n){!r||Object.keys(e).forEach(i=>{let s=r.filter(a=>a.groupId===i).map(a=>{let o=Oe({},a);return o.details=void 0,o.attrs=new Ae(o.attrs),o.url=o.attrs.URI=Ah(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[i],o.attrs["PATHWAY-ID"]=n,o});r.push(...s)})}function Ah(r,e,t,n){let{HOST:i,PARAMS:s,[t]:a}=n,o;e&&(o=a==null?void 0:a[e],o&&(r=o));let l=new self.URL(r);return i&&!o&&(l.host=i),s&&Object.keys(s).sort().forEach(c=>{c&&l.searchParams.set(c,s[c])}),l.href}var Vy=/^age:\s*[\d.]+\s*$/im,ao=class{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Ni,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){let{config:e,context:t}=this;if(!e)return;let n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0;let s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!this.stats.aborted)return s(n,t.url)}).catch(a=>(n.open("GET",t.url,!0),s(n,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(a=>{this.callbacks.onError({code:n.status,text:a.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);let i=this.context.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=n.loadPolicy;if(i)for(let o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&X(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){let{context:e,loader:t,stats:n}=this;if(!e||!t)return;let i=t.readyState,s=this.config;if(!n.aborted&&i>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;let a=t.status,o=t.responseType!=="text";if(a>=200&&a<300&&(o&&t.response||t.responseText!==null)){n.loading.end=Math.max(self.performance.now(),n.loading.first);let l=o?t.response:t.responseText,c=t.responseType==="arraybuffer"?l.byteLength:l.length;if(n.loaded=n.total=c,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first),!this.callbacks)return;let u=this.callbacks.onProgress;if(u&&u(n,e,l,t),!this.callbacks)return;let d={url:t.responseURL,data:l,code:a};this.callbacks.onSuccess(d,n,e,t)}else{let l=s.loadPolicy.errorRetry,c=n.retry;Yr(l,c,!1,a)?this.retry(l):(R.error(`${a} while loading ${e.url}`),this.callbacks.onError({code:a,text:t.statusText},e,t,n))}}}loadtimeout(){var e;let t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry,n=this.stats.retry;if(Yr(t,n,!0))this.retry(t);else{R.warn(`timeout while loading ${this.context.url}`);let i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){let{context:t,stats:n}=this;this.retryDelay=Aa(e,n.retry),n.retry++,R.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Vy.test(this.loader.getAllResponseHeaders())){let t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}};function jy(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(r){}return!1}var Hy=/(\d+)-(\d+)\/(\d+)/,oo=class{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||qy,this.controller=new self.AbortController,this.stats=new Ni}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){let e=this.response;e!=null&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){let i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();let s=Wy(e,this.controller.signal),a=n.onProgress,o=e.responseType==="arraybuffer",l=o?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=c&&X(c)?c:u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(i,e,this.response)},t.timeout),self.fetch(this.request).then(d=>{this.response=this.loader=d;let h=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(i,e,this.response)},u-(h-i.loading.start)),!d.ok){let{status:f,statusText:m}=d;throw new wh(m||"fetch, bad network response",f,d)}return i.loading.first=h,i.total=Ky(d.headers)||i.total,a&&X(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,a):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{let{response:h}=this;self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);let f=d[l];f&&(i.loaded=i.total=f);let m={url:h.url,data:d,code:h.status};a&&!X(t.highWaterMark)&&a(i,e,d,h),n.onSuccess(m,i,e,h)}).catch(d=>{if(self.clearTimeout(this.requestTimeout),i.aborted)return;let h=d&&d.code||0,f=d?d.message:null;n.onError({code:h,text:f},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){let t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,s){let a=new Ka,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return a.dataLength&&s(t,n,a.flush(),e),Promise.resolve(new ArrayBuffer(0));let u=c.value,d=u.length;return t.loaded+=d,d<i||a.dataLength?(a.push(u),a.dataLength>=i&&s(t,n,a.flush(),e)):s(t,n,u,e),l()}).catch(()=>Promise.reject());return l()}};function Wy(r,e){let t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Oe({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function zy(r){let e=Hy.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Ky(r){let e=r.get("Content-Range");if(e){let n=zy(e);if(X(n))return n}let t=r.get("Content-Length");if(t)return parseInt(t)}function qy(r,e){return new self.Request(r.url,e)}var wh=class extends Error{constructor(e,t,n){super(e);this.code=void 0,this.details=void 0,this.code=t,this.details=n}},Yy=/\s/,Xy={newCue(r,e,t,n){let i=[],s,a,o,l,c,u=self.VTTCue||self.TextTrackCue;for(let h=0;h<n.rows.length;h++)if(s=n.rows[h],o=!0,l=0,c="",!s.isEmpty()){var d;for(let p=0;p<s.chars.length;p++)Yy.test(s.chars[p].uchar)&&o?l++:(c+=s.chars[p].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;let f=dh(c.trim()),m=to(e,t,f);r!=null&&(d=r.cues)!=null&&d.getCueById(m)||(a=new u(e,t,f),a.id=m,a.line=h+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),i.push(a))}return r&&i.length&&(i.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),i.forEach(h=>Hu(r,h))),i}},Qy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Zy=ze(ze({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:Infinity,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ao,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Gd,bufferController:Zd,capLevelController:us,errorController:ed,fpsController:Eh,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:vu,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:Qy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:Infinity,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Jy()),{},{subtitleStreamController:qd,subtitleTrackController:Yd,timelineController:bh,audioStreamController:jd,audioTrackController:Hd,emeController:Mn,cmcdController:sn,contentSteeringController:Sh});function Jy(){return{cueHandler:Xy,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function eb(r,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let t=lo(r),n=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(s=>{let a=`${s==="level"?"playlist":s}LoadPolicy`,o=e[a]===void 0,l=[];i.forEach(c=>{let u=`${s}Loading${c}`,d=e[u];if(d!==void 0&&o){l.push(u);let h=t[a].default;switch(e[a]={default:h},c){case"TimeOut":h.maxLoadTimeMs=d,h.maxTimeToFirstByteMs=d;break;case"MaxRetry":h.errorRetry.maxNumRetry=d,h.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":h.errorRetry.retryDelayMs=d,h.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=d,h.timeoutRetry.maxRetryDelayMs=d;break}}}),l.length&&R.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${a}": ${JSON.stringify(e[a])}`)}),ze(ze({},t),e)}function lo(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(lo):Object.keys(r).reduce((e,t)=>(e[t]=lo(r[t]),e),{}):r}function tb(r){let e=r.loader;e!==oo&&e!==ao?(R.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):jy()&&(r.loader=oo,r.progressive=!0,r.enableSoftwareAES=!0,R.log("[config]: Progressive streaming enabled, using FetchLoader"))}var Tn=class{static get version(){return"1.4.0"}static isSupported(){return Vv()}static get Events(){return v}static get ErrorTypes(){return J}static get ErrorDetails(){return F}static get DefaultConfig(){return Tn.defaultConfig?Tn.defaultConfig:Zy}static set DefaultConfig(e){Tn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Gi,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,Cg(e.debug||!1,"Hls instance");let t=this.config=eb(Tn.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&tb(t);let{abrController:n,bufferController:i,capLevelController:s,errorController:a,fpsController:o}=t,l=new a(this),c=this.abrController=new n(this),u=this.bufferController=new i(this),d=this.capLevelController=new s(this),h=new o(this),f=new Vu(this),m=new Wu(this),p=t.contentSteeringController,g=p?new p(this):null,T=this.levelController=new td(this,g),_=new id(this),y=new ld(this.config),b=this.streamController=new Ud(this,_,y);d.setStreamController(b),h.setStreamController(b);let E=[f,T,b];g&&E.splice(1,0,g),this.networkControllers=E;let C=[c,u,d,h,m,_];this.audioTrackController=this.createController(t.audioTrackController,E);let w=t.audioStreamController;w&&E.push(new w(this,_,y)),this.subtitleTrackController=this.createController(t.subtitleTrackController,E);let O=t.subtitleStreamController;O&&E.push(new O(this,_,y)),this.createController(t.timelineController,C),y.emeController=this.emeController=this.createController(t.emeController,C),this.cmcdController=this.createController(t.cmcdController,C),this.latencyController=this.createController(Ku,C),this.coreComponents=C,E.push(l);let S=l.onErrorOut;typeof S=="function"&&this.on(v.ERROR,S,l)}createController(e,t){if(e){let n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){R.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),this.trigger(v.ERROR,{type:J.OTHER_ERROR,details:F.INTERNAL_EXCEPTION,fatal:!1,event:e,error:n})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){R.log("destroy"),this.trigger(v.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;let e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){R.log("attachMedia"),this._media=e,this.trigger(v.MEDIA_ATTACHING,{media:e})}detachMedia(){R.log("detachMedia"),this.trigger(v.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();let t=this.media,n=this.url,i=this.url=Mi.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});R.log(`loadSource:${i}`),t&&n&&n!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(v.MANIFEST_LOADING,{url:e})}startLoad(e=-1){R.log(`startLoad(${e})`),this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){R.log("stopLoad"),this.networkControllers.forEach(e=>{e.stopLoad()})}swapAudioCodec(){R.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){R.log("recoverMediaError");let e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){let e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){R.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){R.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){R.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){R.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){R.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){let t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(R.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Ta.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){let{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;let n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){let{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this,i;if(t===-1&&e&&e.length?i=e.length-1:i=t,n)for(let s=i;s--;){let a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=n)return s}return i}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){let e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){let e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){let t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){let e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){let e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){let t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){let e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){let t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}};Tn.defaultConfig=void 0;var Lh=Tn;var nb=navigator.userAgent.toLowerCase(),Ih=new URL(location.href),ib=Ih.hostname,rb=Ih.searchParams.has("wtr-session-id"),Ch=ib==="localhost"&&rb,Rh=nb.includes("firefox");var Ph=document.createElement("template");Ph.innerHTML=`<style>
${tu}</style>
`;var sb=Promise.resolve(Lh),ri,ab="stn-video-hlsjs",kh=class extends Jn{constructor(){super();let{shadow:e,video:t,model:n}=ri(this);e.appendChild(Ph.content.cloneNode(!0)),n.hlsContainer=null,gr(n,{hlsContainer:Le});let i=j((s,a)=>{let o=n.hlsContainer[0](),l=a.type,c=a.details,u=a.fatal;n.error=a;let d=l===o.ErrorTypes.NETWORK_ERROR&&c===o.ErrorDetails.LEVEL_LOAD_ERROR,h=l===o.ErrorTypes.MEDIA_ERROR&&c===o.ErrorDetails.BUFFER_STALLED_ERROR,f=n.hlsContainer[1];if(u)switch(l){case o.ErrorTypes.NETWORK_ERROR:console.log("fatal network error encountered, try to recover",a),f.startLoad(),n.badContent=!0;break;case o.ErrorTypes.MEDIA_ERROR:console.log("fatal media error encountered, try to recover",a),f.recoverMediaError();break;default:console.error("stn-video-hlsjs cannot recover fatal error",a),f.destroy(),delete n.hlsContainer[1];break}else if(d){console.log("non fatal level load network error encountered, try to recover",a);let m=f.loadLevel;f.removeLevel(m),f.currentLevel=-1,f.startLoad(),n.qualityLevelRemoved=m}else Rh&&Ch&&h||console.error("stn-video-hlsjs experienced a non-fatal",a)});x(()=>[n.hlsContainer,n.src],([s,a])=>{if(a=a.content,n.badContent=!1,s===null)return;let o=new URL(a,location.href);if(o.pathname.endsWith(".m3u8"))if(a=o.href,s){if(s.length===2){let d=s[1];d.detachMedia(t),d.destroy()}let c=s[0](),u=s[1]=new c({maxMaxBufferLength:5});u.on(c.Events.MANIFEST_PARSED,j((d,h)=>{n.qualityLevels=h.levels.map(m=>m.height);let f=parseInt(n.initialQuality,10);if(isNaN(f))switch(n.initialQuality){case"LOW":u.startLevel=0;break;case"HIGH":u.startLevel=n.qualityLevels.length-1;break;case"AUTO":default:u.startLevel=-1;break}else{let p=this.getQualityPriority(f)[0];u.startLevel=n.qualityLevels.indexOf(p)}})),u.on(c.Events.LEVELS_UPDATED,j((d,h)=>{n.qualityLevels=h.levels.map(f=>f.height)})),u.on(c.Events.LEVEL_SWITCHED,j((d,h)=>{n.activeQualityLevel=u.levels[u.currentLevel].height})),u.on(c.Events.ERROR,i),u.attachMedia(t),u.loadSource(a)}else console.warn("Attempting native browser m3u8 playback."),t.src=a;else a?.startsWith("blob:")||(s?.length===2&&(s[1].detachMedia(t),s[1].destroy(t),delete s[1]),t.src=a)}),sb.then(j(s=>{if(!s.isSupported()){console.warn("Hls.js is not supported in this browser."),n.hlsContainer=!1;return}n.hlsContainer=[()=>s]})),x(()=>n.closestQuality,s=>{let a=n.hlsContainer[1];if(s==="auto"){a.currentLevel=-1;return}if(!s){a.currentLevel=0;return}a.currentLevel=n.qualityLevels.indexOf(s)})}get src(){return ri(this).model.src}set src(e){L(()=>{let{model:t}=ri(this);t.src=e})}get ready(){let e=ri(this).model.hlsContainer;return e===!1?!0:e?!!e[0]:!1}shadowSelector(...e){return ri(this).shadow.querySelector(...e)}};ri=oe(Jn);customElements.define(ab,kh);var Dh=`<div class='controlbarContainer \${active} \${mode}'>
    <div title='\${playStateTitle}' class='playState \${playStateClass} material-icons hoverable'>%{playStateIcon}</div>
    <div title='\${volumeIconTitle}' class='muteState material-icons hoverable'>\${volumeIcon}</div>
    <div class='volumeState \${volumeExpand}'>
        <stn-input type="range" min="0" max="100" value="\${volume}"></stn-input>
    </div>
    <div class='spacer'></div>
    <div class='progressBar'>
        <stn-input type="range" min="0" max="\${duration}" value="\${currentTime}" step='0.01' stn-disabled='\${progressDisabled:true}'></stn-input>
    </div>
    <div title='\${timeDisplayTitle}' class='timeDisplay hoverable'>\${timeDisplay}</div>
    <div title='Quality Selector' class='qualities hoverable material-icons \${qualityBtnHidden:hide} \${qualityMenuBtnClicked:clicked}'>\${qualityIcon}</div>
    <div title='Share' class='share hoverable material-icons \${shareBtnHidden:hide} \${shareBtnClicked:clicked}'>share</div>
    <div title='Subtitles' class='subtitles hoverable material-icons \${subtitlesActive:active} \${subtitlesBtnHidden:hide} \${subtitleMenuBtnClicked:clicked}'>closed_caption</div>
    <div title='\${fullscreenTitle}' class='fullscreen material-icons hoverable \${fullscreenBtnHidden:hide}'>\${fullscreenIcon}</div>
    <div title='stnvideo.com' class='stnLink \${hideSTNLink:hide}'>
        <stn-link></stn-link>
    </div>
</div>
<div class='qualitiesContainer \${qualitiesMenuHidden:hide}'>
    <div class='qualitiesWrapper'>
        <div class='qualitiesMenu' foreach="quality,i of qualities">
            <div class="\${quality.active:active}" data-idx='\${i}'>\${quality.label}</div>
        </div>
    </div>
</div>
<div class='subtitlesContainer \${subtitlesMenuHidden:hide}'>
    <div class='subtitlesWrapper'>
        <div class='subtitlesMenu' foreach="subtitle,i of subtitles">
            <div class="\${subtitle.active:active}" data-idx='\${i}'>\${subtitle.label}</div>
        </div>
    </div>
</div>
`;var xh=`:host
{
    --rangeTrackHeight: 9px;
    --rangeThumbHeight: 15px;
    --rangeThumbWidth: 15px;
    --rangeThumbMargin: -4px 0 0 0;
    --rangeThumbBorderRadius: 100px;

    --newUIRangeTrackHeight: 3px;
    --newUIRangeTrackHeightExpand: 3px;
    --newUIRangeThumbHeight: 12px;
    --newUIRangeThumbWidth: 12px;
    --newUIRangeThumbMargin: -5px 0 0 0;
    --newUIRangeThumbBorderRadius: 100px;

    --subtitleMenuWidth: 20%;
    --subtitleMenuMinWidth: 180px;

    width: 100%;
    height: 100%;
    left: 0;
    bottom: 0;
    position: absolute;
    overflow: hidden;

    /* stn-control is a container that takes up the whole player size, in order to */
    /* allow menus to be within it. Because of this, the stn-control element blocks */
    /* clicks to it's siblings like contentplayer. */
    /* Make clicks of stn-control pass through, and we will add back pointer events */
    /* for its children that actually need clicks */
    pointer-events: none;
}

:host > *
{
    /* Pointer events brought back for immediate children */
    pointer-events: all;
}

.controlbarContainer
{
    display: flex;

    /* Don't wrap the control bar info */
    flex-wrap: nowrap;

    /* Space out the contents of the control bar evenly by default */
    justify-content: space-between;

    background: rgba(0, 0, 0, 0.3);
    color: white;
    position: absolute;
    width: 100%;
    height: var(--controlbarHeight);
    transition: bottom 300ms;
    padding-left: 0.5em;
    padding-right: 0.5em;
    box-sizing: border-box;
}

:host(.newUI) .controlbarContainer
{
    gap: 2%;
}

.progressBar
{
    /* Any extra space in the control bar is given to the progress bar */
    flex-grow: 1;
}

input[type=range]
{
    width: 100%;
}

.volumeState.expand
{
    width: 15%;
}
:host(.newUI) .controlbarContainer .volumeState
{
    width: 20%;
    font-size: unset;
}

:host(.newUI) .volumeState input
{
    position: relative;
    /*
        bottom is set for webkit, and top is set for others because
        idk... \\(_o)/
        Without them, both are misaligned in 2 different directions
     */
}

:host(:not(.newUI)) .volumeState:not(.expand)
{
    width: 0;
    visibility: hidden;
}

.volumeState
{
    overflow: hidden;
    transition: width 300ms ease-in-out, visibility 200ms;
}

.controlbarContainer.active
{
    bottom: 0;
}

.controlbarContainer:not(.active)
{
    bottom: calc(-1 * var(--controlbarHeight));
}

.controlbarContainer *
{
    /* Don't allow user to select text / icons in the control bar */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.controlbarContainer > div
{
    border: 1px solid transparent;
    box-sizing: border-box;
    display: inline-block;
    width: fit-content;
    height: 100%;
    vertical-align: top;
    padding: 2px;
}

:host(.newUI) .controlbarContainer > div
{
    padding: 3px;
    font-size: 22px;
}

.controlbarContainer > div.active
{
    color: var(--controlbarActiveButtonsColour);
}

.controlbarContainer > .material-icons
{
    width: var(--controlbarHeight);
}

.controlbarContainer > div.hoverable:hover
{
    background: rgba(0, 0, 0, 0.6);
    cursor: pointer;
    border: 1px solid #3e3d3d;
}

.controlbarContainer > div.hoverable.clicked
{
    background: rgba(0, 0, 0, 0.9);
}

.playState svg
{
    width: auto;
    height: 100%;
    padding: 2px 4px;
    box-sizing: border-box;
}

.playState svg path
{
    fill: var(--bigPlayButtonColor);
}

input[type=range] {
    -webkit-appearance: none;
    cursor: pointer;
    background: transparent;
}

input[type=range]:focus {
    outline: none;
}

:host .controlbarContainer.ad .progressBar input
{
    cursor: not-allowed;
}

input[type=range]::-webkit-slider-runnable-track {
    width: 100%;
    height: var(--rangeTrackHeight);
    border: 1px solid #010101;
}
input[type=range]::-moz-range-progress {
    width: 100%;
    height: var(--rangeTrackHeight);
    border: 1px solid #010101;
}
input[type=range]::-moz-range-track {
    width: 100%;
    height: var(--rangeTrackHeight);
    border: 1px solid #010101;
}
input[type=range]::-ms-track {
    width: 100%;
    height: var(--rangeTrackHeight);
    background: transparent;
    border-color: transparent;
    border-width: 16px 0;
    color: transparent;
}
input[type=range]::-ms-fill-lower,
input[type=range]::-ms-fill-upper {
    border: 1px solid #010101;
    border-radius: 3px;
}

.progressBar input[type=range]::-moz-range-progress {
    background: var(--progressBarTrackColor);
}
.progressBar input[type=range]::-moz-range-track {
    background: var(--progressBarTrackTimeLeftColor);
}
.progressBar input[type=range]::-ms-fill-lower {
    background: var(--progressBarTrackColor);
}
.progressBar input[type=range]::-ms-fill-upper {
    background: var(--progressBarTrackTimeLeftColor);
}

.controlbarContainer.ad .progressBar input[type=range]::-moz-range-progress {
    background: var(--adProgressBarTrackColor);
}
.controlbarContainer.ad .progressBar input[type=range]::-moz-range-track {
    background: var(--adProgressBarTrackTimeLeftColor);
}
.controlbarContainer.ad .progressBar input[type=range]::-ms-fill-lower {
    background: var(--adProgressBarTrackColor);
}
.controlbarContainer.ad .progressBar input[type=range]::-ms-fill-upper {
    background: var(--adProgressBarTrackTimeLeftColor);
}

.volumeState input[type=range]::-moz-range-progress {
    background: var(--volumeBarTrackColor);
}
.volumeState input[type=range]::-moz-range-track {
    background: var(--volumeBarTrackUnusedColor);
}
.volumeState input[type=range]::-ms-fill-lower {
    background: var(--volumeBarTrackColor);
}
.volumeState input[type=range]::-ms-fill-upper {
    background: var(--volumeBarTrackUnusedColor);
}

.controlbarContainer.ad .volumeState input[type=range]::-moz-range-progress {
    background: var(--adVolumeBarTrackColor);
}
.controlbarContainer.ad .volumeState input[type=range]::-moz-range-track {
    background: var(--adVolumeBarTrackUnusedColor);
}
.controlbarContainer.ad .volumeState input[type=range]::-ms-fill-lower {
    background: var(--adVolumeBarTrackColor);
}
.controlbarContainer.ad .volumeState input[type=range]::-ms-fill-upper {
    background: var(--adVolumeBarTrackUnusedColor);
}

input[type=range]::-webkit-slider-thumb {
    border: 1px solid #000000;
    height: var(--rangeThumbHeight);
    width: var(--rangeThumbWidth);
    border-radius: var(--rangeThumbBorderRadius);
    -webkit-appearance: none;
    margin: var(--rangeThumbMargin)
}
input[type=range]::-moz-range-thumb {
    border: 1px solid #000000;
    height: var(--rangeThumbHeight);
    width: var(--rangeThumbWidth);
    border-radius: var(--rangeThumbBorderRadius);
}
input[type=range]::-ms-thumb {
    border: 1px solid #000000;
    height: var(--rangeThumbHeight);
    width: var(--rangeThumbWidth);
    border-radius: var(--rangeThumbBorderRadius);
}

:host(.newUI) input[type=range]::-webkit-slider-thumb {
    border: none;
    height: var(--newUIRangeThumbHeight);
    width: var(--newUIRangeThumbWidth);
    border-radius: var(--newUIRangeThumbBorderRadius);
    -webkit-appearance: none;
    margin: var(--newUIRangeThumbMargin)
}
:host(.newUI) input[type=range]::-moz-range-thumb {
    border: none;
    height: calc(var(--newUIRangeThumbHeight) * 0.75);
    width: calc(var(--newUIRangeThumbWidth) * 0.75);
    border-radius: var(--newUIRangeThumbBorderRadius);
}
:host(.newUI) input[type=range]::-ms-thumb {
    border: none;
    height: var(--newUIRangeThumbHeight);
    width: var(--newUIRangeThumbWidth);
    border-radius: var(--newUIRangeThumbBorderRadius);
}


.progressBar input[type=range]::-webkit-slider-thumb {
    background: var(--progressBarThumbColor);
}
.progressBar input[type=range]::-moz-range-thumb {
    background: var(--progressBarThumbColor);
}
.progressBar input[type=range]::-ms-thumb {
    background: var(--progressBarThumbColor);
}

.controlbarContainer.ad .progressBar input[type=range]::-webkit-slider-thumb {
    background: var(--adProgressBarThumbColor);
}
.controlbarContainer.ad .progressBar input[type=range]::-moz-range-thumb {
    background: var(--adProgressBarThumbColor);
}
.controlbarContainer.ad .progressBar input[type=range]::-ms-thumb {
    background: var(--adProgressBarThumbColor);
}

:host(.newUI) .progressBar:not(:hover) input[type=range]::-webkit-slider-thumb,
:host(.newUI) .ad .progressBar input[type=range]::-webkit-slider-thumb {
    display: none;
}
:host(.newUI) .progressBar:not(:hover) input[type=range]::-moz-range-thumb,
:host(.newUI) .ad .progressBar input[type=range]::-moz-range-thumb {
    width: 0;
    height: 0;
    border: none;
    background: transparent;
}
:host(.newUI) .progressBar:not(:hover) input[type=range]::-ms-thumb,
:host(.newUI) .ad .progressBar input[type=range]::-ms-thumb {
    display: none;
}


.volumeState input[type=range]::-webkit-slider-thumb {
    background: var(--volumeBarThumbColor);
}
.volumeState input[type=range]::-moz-range-thumb {
    background: var(--volumeBarThumbColor);
}
.volumeState input[type=range]::-ms-thumb {
    background: var(--volumeBarThumbColor);
}

.controlbarContainer.ad .volumeState input[type=range]::-webkit-slider-thumb {
    background: var(--adVolumeBarThumbColor);
}
.controlbarContainer.ad .volumeState input[type=range]::-moz-range-thumb {
    background: var(--adVolumeBarThumbColor);
}
.controlbarContainer.ad .volumeState input[type=range]::-ms-thumb {
    background: var(--adVolumeBarThumbColor);
}

.controlbarContainer > .hide
{
    display: none;
}

.subtitlesContainer,
.qualitiesContainer
{
    position: absolute;
    width: var(--subtitleMenuWidth);
    height: calc(100% - (2 * var(--controlbarHeight)));
    right: 10px;
    bottom: calc(var(--controlbarHeight) + 5px);
    overflow: hidden;

    min-width: var(--subtitleMenuMinWidth);
    text-align: center;
    transition: right 300ms;
    display: flex;

    /* The containers shouldn't get in the way of pointer events, such as hover */
    /* for controlling whether or not the control bar etc should show */
    pointer-events: none;
}

.subtitlesContainer > *,
.qualitiesContainer > *
{
    /* Override for children so that the actual menu items can be used */
    pointer-events: auto;
}

.subtitlesWrapper,
.qualitiesWrapper
{
    max-height: 100%;
    width: 100%;
    align-self: flex-end;
}

.subtitlesMenu,
.qualitiesMenu
{
    background: rgba(0, 0, 0, 0.5);
    color: white;
    cursor: pointer;
    width: 100%;
    min-height: 100%;
}

.subtitlesContainer.hide,
.qualitiesContainer.hide
{
    right: calc(-1 * max(var(--subtitleMenuMinWidth), var(--subtitleMenuWidth)));
}

.subtitlesMenu > .active,
.qualitiesMenu > .active
{
    border: 1px solid white;
    background: rgba(0, 0, 0, 0.8);
}

.subtitlesMenu > *,
.qualitiesMenu > *
{
    border: 1px solid transparent;
    padding: 0.5em 0.5ch;
}

/* Override the scrollbar z-index so that it doesn't show through the playlist */
/* overlay when paused */
:host .os-scrollbar
{
    z-index: 0 !important;
}

/* Used to hide the track for the scrollbar */
:host .os-scrollbar:before
{
    border: none !important;
    background: transparent !important;
}

/* Used to hide the track for the scrollbar */
:host .os-scrollbar .os-scrollbar-track {
    background: transparent !important;
}

:host .os-scrollbar .os-scrollbar-handle {
    background-color: rgba(0, 0, 0, 0.8) !important;
}

.subtitlesMenu,
.qualitiesMenu
{
    /* It looks like detection of scrollbar width doesn't work inside a shadow dom */
    /* because I keep getting a 30px border on the content wrapper. This will be */
    /* used to counteract that. */
    width: calc(100% - (19px - var(--nativeScrollbarWidth)));
}

:host .os-host-scrollbar-vertical-hidden .subtitlesMenu,
:host .os-host-scrollbar-vertical-hidden .qualitiesMenu
{
    width: 100%;
}

/* Safari likes to give disabled inputs a 0.4 opacity. I don't */
input:disabled
{
    opacity: 1;
}

:host(.newUI) .progressBar
{
    width: 100%;
    position: absolute;
    top: calc(-1 * var(--newUIRangeTrackHeight));
    left: 0;
    padding: 0;
    border: none;
    height: fit-content;

    transition: top 50ms;
}
:host(.newUI) :not(.ad) .progressBar:hover
{
    top: calc(-1 * var(--newUIRangeTrackHeight) - var(--newUIRangeTrackHeightExpand));
}

:host(.newUI) .progressBar input
{
    position: absolute;
    top: 0;
    left: 0;
    margin: 0;
    height: var(--newUIRangeTrackHeight);

    transition: height 50ms;
}
:host(.newUI) :not(.ad) .progressBar:hover input
{
    height: calc(var(--newUIRangeTrackHeight) + var(--newUIRangeTrackHeightExpand));
}

:host(.newUI) input[type=range] {
    -webkit-appearance: none;
    cursor: pointer;
    background: transparent;
}

:host(.newUI) input[type=range]::-webkit-slider-runnable-track {
    width: 100%;
    height: var(--newUIRangeTrackHeight);
    border: none;
}
:host(.newUI) input[type=range]::-moz-range-progress {
    width: 100%;
    height: var(--newUIRangeTrackHeight);
    border: none;
}
:host(.newUI) input[type=range]::-moz-range-track {
    width: 100%;
    height: var(--newUIRangeTrackHeight);
    border: none;
}
:host(.newUI) input[type=range]::-ms-track {
    width: 100%;
    height: var(--newUIRangeTrackHeight);
    background: transparent;
    border: none;
    color: transparent;
}
:host(.newUI) input[type=range]::-ms-fill-lower,
:host(.newUI) input[type=range]::-ms-fill-upper {
    border: 1px solid #010101;
    border-radius: 3px;
}

:host(.newUI) .volumeState input[type=range]::-webkit-slider-thumb {
    background: var(--volumeBarThumbColor);
}
:host(.newUI) .volumeState input[type=range]::-moz-range-thumb {
    background: var(--volumeBarThumbColor);
}
:host(.newUI) .volumeState input[type=range]::-ms-thumb {
    background: var(--volumeBarThumbColor);
}

:host(.newUI) .controlbarContainer.ad .volumeState input[type=range]::-webkit-slider-thumb {
    background: var(--adVolumeBarThumbColor);
}
:host(.newUI) .controlbarContainer.ad .volumeState input[type=range]::-moz-range-thumb {
    background: var(--adVolumeBarThumbColor);
}
:host(.newUI) .controlbarContainer.ad .volumeState input[type=range]::-ms-thumb {
    background: var(--adVolumeBarThumbColor);
}

:host(:not(.newUI)) .spacer
{
    display: none;
}
:host(.newUI) .spacer
{
    flex-grow: 1;
}

:host(.newUI) .controlbarContainer .timeDisplay
{
    font-size: 15px;
}

:host(.newUI) .controlbarContainer .timeDisplay
{
    font-size: 15px;
}

.controlbarContainer .stnLink
{
    width: 74px;
}
`;var Oh=oe(Symbol("StnInput")),ob="stn-input",Mh=class extends ke{static get observedAttributes(){return["max","min","step","stn-disabled","type","value"]}constructor(){super();let e=document.createElement("input");this.appendChild(e),Oh(this,{input:e})}attributeChangedCallback(e,t,n){let i=Oh(this);switch(e){case"stn-disabled":i.input.disabled=n==="true";break;default:i.input[e]=n,i.input.setAttribute(e,n);break}}};customElements.define(ob,Mh);function ji(r){(isNaN(r)||r<0)&&(r=0);let e=Math.floor(r/60),t=Math.floor(r-e*60);return`${e}:${t.toString().padStart(2,"0")}`}var Hi=CSS.supports("transition","d 1s")&&CSS.supports("d",'path("")'),hs=lb();function lb(){if(!Hi)return"";let r=300,e=r/(13/4),t=.83705,n=r/Math.sqrt(1+Math.pow(t,2)),i=t*n,s=-1.194765,a=e/Math.sqrt(1+Math.pow(s,2)),o=s*a,l=-.539384,c=r/Math.sqrt(1+Math.pow(l,2)),u=l*c,d=1.853967,h=e/Math.sqrt(1+Math.pow(d,2)),f=d*h,m=90-Math.abs(Math.atan(t)*180/Math.PI),p=90-Math.abs(Math.atan(l)*180/Math.PI);return`
		.pause svg #topPiece {
			d: path("m 165.9 197.8 l 0 0 l 0 0 l 0 0 c 0 0 0 0 0 0 l ${-1*n} ${-1*i} c 0 0 0 0 ${a} ${o} c 0 0 0 0 0 0 l ${n} ${i} c 0 0 0 0 0 0 l 0 0 l ${-1*a} ${-1*o} Z");
			transform: translate(-5px, 141px) rotate(${m}deg);
		}

		.pause #rightPiece {
			d: path("m 100.6 250.5 l ${c} ${u} l 0 0 c 0 0 0 0 0 0 l 0 0 l 0 0 l 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 l 0 0 c 0 0 0 0 ${h} ${f} c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 l 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 l 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 l 0 0 l 0 0 l 0 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0 0 0 0 ${-1*c} ${-1*u} l 0 0 c 0 0 0 0 0 0 l 0 0 l 0 0 l ${-1*h} ${-1*f} Z");
			transform: translate(5px, -12.6px) rotate(${-1*p}deg);
		}

		#rightPiece, #topPiece, #bottomPiece {
			transition: 500ms;
			transform-origin: center;
			transform-box: fill-box;
		}

		.pause #bottomPiece {
			transform: translateY(209px);
		}
	`}var ge=oe(Symbol("StnControl")),Fh=document.createElement("template");Fh.innerHTML=`<style>
${xh}
${hs}</style>${Dh}
`;var cb="stn-control",Nh=class extends ke{constructor(){super();let e=new class{constructor(){k(this,"active",!1);k(this,"adCurrentTime",0);k(this,"adDuration",0);k(this,"btnActive",null);k(this,"contentCurrentTime",0);k(this,"contentDuration",0);k(this,"fullscreenAllowed",!0);k(this,"hideSTNLink",!0);k(this,"isFullscreen",!1);k(this,"mode","content");k(this,"muted",!0);k(this,"paused",!0);k(this,"playStateUserInitiated",!1);k(this,"rawQualities",[]);k(this,"rawSelectedSubtitle",null);k(this,"rawSubtitles",[]);k(this,"rawVolume",1);k(this,"rawVolumeExpand",!1);k(this,"seekedTo",0);k(this,"showTimeLeft",!0);k(this,"socialSharingTrigger",!1);k(this,"useLogoForPlay",!0);k(this,"selectedQuality","auto");k(this,"activeQuality",null)}get qualityIcon(){let o=this.activeQuality;return o<700?"sd":o<2e3?"hd":o<1e4?`${Math.floor(o/1e3)}k`:"9k_plus"}get subtitleMenuBtnClicked(){return this.btnActive==="subtitle"}get subtitlesActive(){return!!this.selectedSubtitle}get qualityMenuBtnClicked(){return this.btnActive==="quality"}get shareBtnClicked(){return this.btnActive==="share"}get qualities(){let o=this.activeQuality,c=this.selectedQuality==="auto",u=this.rawQualities.map(j((h,f)=>({active:!c&&o===h,label:`${h}p`,value:h}))),d="Auto";return c&&(d=`Auto (${o}p)`),[{label:d,active:c,value:"auto"},...u]}get hasQualities(){return this.rawQualities.length>0}get qualitiesMenuHidden(){let o=this.hasQualities,l=this.qualityMenuBtnClicked,c=this.mode==="ad";return!this.active||c||!l||!o}get selectedSubtitle(){let o=this.rawSelectedSubtitle,l=o?.language??null,c=this.rawSubtitles;if(!c.length||l===null||o===null)return null;let u=c.filter(p=>p===o);if(u.length===1)return u[0];let d=c.filter(p=>p.language===l);if(d.length)return d[0];let[h,f]=l.split("-");if(!!h&&!!f){let p=c.filter(g=>g.language===h);if(p.length)return p[0]}return null}get hasSubtitles(){return this.rawSubtitles.length>0}get subtitlesMenuHidden(){let o=this.hasSubtitles,l=this.subtitleMenuBtnClicked,c=this.mode==="ad";return!this.active||c||!l||!o}get subtitles(){let o=this.selectedSubtitle,l=this.rawSubtitles;return l.forEach(j((c,u)=>{c.active=o===c})),[{label:"Subtitles Off",active:o===null,language:null},...l]}get progressDisabled(){let o=this.mode;return this.mode==="ad"}get shareBtnHidden(){let o=this.mode,l=this.socialSharingTrigger;return o==="ad"?!0:l!=="controlBarClick"}get qualityBtnHidden(){let o=this.mode,l=this.hasQualities;return this.mode==="ad"||!l}get subtitlesBtnHidden(){let o=this.mode,l=this.hasSubtitles;return this.mode==="ad"||!l}get fullscreenBtnHidden(){return!this.fullscreenAllowed}get volumeExpand(){return this.rawVolumeExpand?"expand":""}get currentTime(){let o=this.adCurrentTime,l=this.contentCurrentTime;return this.mode==="ad"?o:l}get duration(){let o=this.adDuration,l=this.contentDuration,c=this.mode==="ad"?o:l;return isNaN(c)?0:c}get volume(){return parseInt(this.rawVolume*100,10)}set volume(o){this.rawVolume=o/100}get fullscreenIcon(){return this.isFullscreen?"fullscreen_exit":"fullscreen"}get fullscreenTitle(){return this.isFullscreen?"Exit Fullscreen":"Enter Fullscreen"}get timeDisplay(){return this.showTimeLeft?this.timeLeft:this.timeElapsed}get timeDisplayTitle(){return this.showTimeLeft?"Time Left":"Time Elapsed"}get timeElapsed(){return ji(this.currentTime)}get timeLeft(){return`-${ji(this.duration-this.currentTime)}`}get playStateClass(){return this.paused?"play":"pause"}get playStateIcon(){let o=this.paused,l=this.useLogoForPlay,c=l?Qt:"play_arrow";return l&&Hi||o?c:"pause"}get playStateTitle(){return this.paused?"Play":"Pause"}get volumeIcon(){let o=!!this.muted,l=parseInt(this.volume,10);return o?"volume_off":l===0?"volume_mute":l<50?"volume_down":"volume_up"}get volumeIconTitle(){return this.muted?"Unmute":"Mute"}};ye(e),Object.freeze(e);let t=this.attachShadow({mode:Re?"open":"closed"}),n=$e(Fh.content.cloneNode(!0),e);t.append(...St(),n);let i=t.querySelector(".controlbarContainer");ge(this,{shadow:t,model:e,container:i,subtitleDelay:null}),Object.freeze(this),x(()=>e.active,o=>{o||(e.btnActive=null)}),t.querySelector(".playState").addEventListener("click",j(()=>{e.playStateUserInitiated=!0,e.paused=!e.paused})),t.querySelector(".muteState").addEventListener("click",j(()=>{let l=e.muted=!e.muted,c=e.volume;!l&&c<5&&(e.volume=5)}));{let o=t.querySelector(".muteState"),l=t.querySelector(".volumeState"),c=l.querySelector("input");window.getComputedStyle(c,"::-webkit-slider-runnable-track").length>0?(P(()=>{let d=e.volume,h=e.mode==="ad",f=h?"adVolumeBarTrackColor":"volumeBarTrackColor",m=h?"adVolumeBarTrackUnusedColor":"volumeBarTrackUnusedColor";c.style.background=`linear-gradient(to right, var(--${f}) 0%, var(--${f}) ${d}%, var(--${m}) ${d}%, var(--${m}) 100%)`}),c.style.bottom="3px"):c.style.top="2px",c.addEventListener("input",j(d=>{let h=c.value;e.volume=h,h&&(e.muted=!1)})),mn([o,l],null,250,j(d=>{e.rawVolumeExpand=d}))}{let o=t.querySelector(".progressBar input");window.getComputedStyle(o,"::-webkit-slider-runnable-track").length>0&&P(()=>{let c=e.currentTime,u=e.duration,d=e.mode==="ad",h=!c||!u?0:100*(c/u),f=d?"adProgressBarTrackColor":"progressBarTrackColor",m=d?"adProgressBarTrackTimeLeftColor":"progressBarTrackTimeLeftColor";o.style.background=`linear-gradient(to right, var(--${f}) 0%, var(--${f}) ${h}%, var(--${m}) ${h}%, var(--${m}) 100%)`}),o.addEventListener("input",j(c=>{e.seekedTo=o.value}))}t.querySelector(".timeDisplay").addEventListener("click",j(()=>{e.showTimeLeft=!e.showTimeLeft}));{t.querySelector(".qualities").addEventListener("click",j(u=>{e.btnActive=e.qualityMenuBtnClicked?null:"quality"}));let l=t.querySelector(".qualitiesMenu"),c=t.querySelector(".qualitiesWrapper");ki(c),l.addEventListener("click",j(u=>{let d=u.target;if(!d){ie&&console.log("Couldn't get clicked quality");return}let h=d.dataset.idx;if(!h){ie&&console.log("Couldn't get clicked quality's index");return}let f=e.qualities[h].value;f!=="auto"&&(e.activeQuality=e.qualities[h].value),e.selectedQuality=f}))}t.querySelector(".share").addEventListener("click",j(()=>{e.btnActive=e.shareBtnClicked?null:"share"}));{t.querySelector(".subtitles").addEventListener("click",j(u=>{e.btnActive=e.subtitleMenuBtnClicked?null:"subtitle"}));let l=t.querySelector(".subtitlesMenu"),c=t.querySelector(".subtitlesWrapper");ki(c),l.addEventListener("click",j(u=>{let d=u.target;if(!d){ie&&console.log("Couldn't get clicked subtitle");return}let h=d.dataset.idx;if(!h){ie&&console.log("Couldn't get clicked subtitle's index");return}e.rawSelectedSubtitle=e.subtitles[h]}))}t.querySelector(".fullscreen").addEventListener("click",j(()=>{e.isFullscreen=!e.isFullscreen}))}get paused(){return ge(this).model.paused}get playStateUserInitiated(){return ge(this).model.playStateUserInitiated}set playStateUserInitiated(e){L(()=>{ge(this).model.playStateUserInitiated=e})}set paused(e){L(()=>{ge(this).model.paused=e})}get muted(){return ge(this).model.muted}set muted(e){L(()=>{ge(this).model.muted=e})}get volume(){return ge(this).model.rawVolume}set volume(e){L(()=>{ge(this).model.rawVolume=e})}get contentCurrentTime(){return ge(this).model.contentCurrentTime}set contentCurrentTime(e){L(()=>{ge(this).model.contentCurrentTime=e})}set adCurrentTime(e){L(()=>{ge(this).model.adCurrentTime=e})}get seekedTo(){return ge(this).model.seekedTo}get contentDuration(){return ge(this).model.contentDuration}set contentDuration(e){L(()=>{ge(this).model.contentDuration=e})}set adDuration(e){L(()=>{ge(this).model.adDuration=e})}get isFullscreen(){return ge(this).model.isFullscreen}set isFullscreen(e){L(()=>{ge(this).model.isFullscreen=!!e})}get shareBtnClicked(){return ge(this).model.shareBtnClicked}set shareBtnClicked(e){L(()=>{ge(this).model.btnActive=e?"share":null})}get isMenuOpen(){return!!ge(this).model.btnActive}set active(e){L(()=>{ge(this).model.active=!!e})}set mode(e){L(()=>{ge(this).model.mode=e})}set socialSharingTrigger(e){L(()=>{ge(this).model.socialSharingTrigger=e})}set subtitles(e){let t=ge(this);clearTimeout(t.subtitleDelay);let n=e.length===0?200:0;t.subtitleDelay=setTimeout(j(()=>{t.model.rawSubtitles=e}),n)}get selectedSubtitle(){return ge(this).model.selectedSubtitle}set availableQualities(e){ge(this).model.rawQualities=e}get selectedQuality(){return ge(this).model.selectedQuality}set activeQuality(e){ge(this).model.activeQuality=e}set fullscreenAllowed(e){ge(this).model.fullscreenAllowed=!!e}set hideSTNLink(e){let{model:t}=ge(this);L(()=>{t.hideSTNLink=!!e})}set useLogoForPlay(e){ge(this).model.useLogoForPlay=e}};customElements.define(cb,Nh);var Bh=`<div class='shareContainer \${mode}'>
    <a data-share='reddit' target='_blank' href='https://www.reddit.com/submit?url=\${location}'>
        <img src='https://d29xw9s9x32j3w.cloudfront.net/images/social/reddit.png'>
    </a>
    <a data-share='facebook' target='_blank' href='https://www.facebook.com/sharer/?u=\${location}'>
        <img src='https://d29xw9s9x32j3w.cloudfront.net/images/social/facebook.png'>
    </a>
    <a data-share='twitter' target='_blank' href='https://twitter.com/intent/tweet?url=\${location}'>
        <img src='https://d29xw9s9x32j3w.cloudfront.net/images/social/twitter.png'>
    </a>
    <a data-share='email' target='_blank' href='mailto:?body=\${location}'>
        <img src='https://d29xw9s9x32j3w.cloudfront.net/images/social/email.png'>
    </a>
</div>
`;var Uh=`:host
{
    --hostRightPadding: 10px;
    --linkBorderWidth: 1px;

    position: absolute;
    right: 0;
    top: 50%;
    transform: translate(100%, -50%);
    padding-right: var(--hostRightPadding);

    transition: transform 300ms;

    /* To make social share show on top of the pause overlay */
    z-index: 1;
}

:host(.active)
{
    transform: translate(0, -50%);
}

[data-share]
{
    display: block;
}

[data-share="reddit"]
{
    background: #ff4500;
}

[data-share="twitter"]
{
    background: #1da1f2;
}

[data-share="facebook"]
{
    background: #3b5998;
}

[data-share="email"]
{
    background: #a6b1b7;
}

[data-share]:hover
{
    box-shadow: RGBA(0,0,0,0.2) 0 0 100px inset;
}

a
{
    display: block;
    border: var(--linkBorderWidth) solid white;
    height: var(--shareLinkSize);
    width: var(--shareLinkSize);
    justify-content: center;
    position: relative;
    box-sizing: border-box;
}

img
{
    display: block;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    max-width: 60%;
    max-height: 60%;
}
`;var an=oe(Symbol("StnControl")),$h=document.createElement("template");$h.innerHTML=`<style>
${Uh}</style>${Bh}
`;var ub="stn-social-share",Gh=class extends ke{constructor(){super();let e=new class{constructor(){k(this,"controlbarClicked",!1);k(this,"mediaHovered",!1);k(this,"lastSharedUrl",!1);k(this,"location",location.href);k(this,"mode","content");k(this,"trigger",!1)}get active(){let o=this.controlbarClicked,l=this.mediaHovered,c=this.mode,u=this.trigger;if(c==="ad")return!1;switch(u){case"hover":return l;case"controlBarClick":return o;default:console.warn(`Unknown Social Sharing trigger [${u}]`);case!1:return!1}}get iconClicked(){return this.active||L(()=>this.lastSharedUrl=!1),!!this.lastSharedUrl}};ye(e),Object.freeze(e);let t=this.attachShadow({mode:Re?"open":"closed"}),n=$e($h.content.cloneNode(!0),e);t.append(n);let i="",s=t.querySelectorAll("a[data-share]");an(this,{shadow:t,model:e,lastUrlShared:i,shareIcons:s}),Object.freeze(this),s.forEach(o=>{o.addEventListener("click",()=>{e.lastSharedUrl=o.dataset.share})}),P(()=>this.classList.toggle("active",e.active))}set controlbarClicked(e){L(()=>{an(this).model.controlbarClicked=!!e})}set mediaHovered(e){L(()=>{an(this).model.mediaHovered=!!e})}set mode(e){L(()=>{an(this).model.mode=e})}set socialSharingTrigger(e){L(()=>{an(this).model.trigger=e})}set shareURL(e){L(()=>{an(this).model.location=e})}get iconClicked(){return an(this).model.iconClicked}get lastSharedUrl(){return an(this).model.lastSharedUrl}get shareIconCount(){return an(this).shareIcons.length}};customElements.define(ub,Gh);var Vh=`:host
{
	--fontSize: 24px;
	--padding: 5px;
	--width: calc(var(--fontSize) + (2 * var(--padding)));

	width: fit-content;
	height: fit-content;
	position: absolute;
	padding: 1.5em 10% 10% 1em;
	top: 0;
	left: 0;

	opacity: 1;
	transition: opacity 300ms 200ms;

	/* Bring the unmute forward so that it is on top of the recirc overlay */
	z-index: 1;
}

:host(.hide)
{
	opacity: 0;
	pointer-events: none;
}

:host(.pushDown)
{
	padding-top: calc(1.5em + 25px);
}

:host, :host *
{
	cursor: pointer;
}

:host button
{
	border: 0;
	border-radius: 100vw;
	padding: var(--padding);
	background: var(--unmuteBackgroundColor);
	color: var(--unmuteColor);

	width: var(--width);
	height: var(--width);
	white-space: nowrap;
	overflow: hidden;
}

:host button span
{
	font-size: var(--fontSize);
}

:host button :first-child
{
	transition: margin-left 300ms;
}

:host button :first-child
{
	margin-left: -0.25px;
}

:host button.unmuted :first-child
{
	margin-left: calc(-1 * (var(--fontSize) + var(--padding) - 1px) );
}
`;var jh=`<button class='\${iconClass}'>
    <span class='material-icons'>volume_off</span>
    <span class='material-icons'>volume_up</span>
</button>
`;var co=oe(Symbol("StnMuteButton")),Hh=document.createElement("template");Hh.innerHTML=`<style>
${Vh}</style>${jh}
`;var db="stn-mute-button",Wh=class extends ke{constructor(){super();let e=new class{constructor(){k(this,"muted",!0)}get iconClass(){return this.muted?"muted":"unmuted"}};ye(e),Object.freeze(e);let t=this.attachShadow({mode:Re?"open":"closed"}),n=$e(Hh.content.cloneNode(!0),e);t.append(...St(),n),co(this,{shadow:t,model:e}),this.addEventListener("click",j(()=>{e.muted=!e.muted}))}get muted(){return co(this).model.muted}set muted(e){L(()=>{co(this).model.muted=e})}};customElements.define(db,Wh);var Kh=`:host
{
    display: block;
}`;var uo="start",ho="stop",fs="change",Wi="complete",si="unmeasureable",fo="inview",mo="outview",hb=Object.freeze({__proto__:null,START:uo,STOP:ho,CHANGE:fs,COMPLETE:Wi,UNMEASUREABLE:si,INVIEW:fo,OUTVIEW:mo}),po=class{constructor(e){this.duration=e,this.listeners=[],this.completed=!1}timerComplete(){this.completed=!0,this.listeners.forEach(e=>e())}elapsed(e){typeof e=="function"&&this.listeners.push(e)}start(){this.endTimer(),this.timer=setTimeout(this.timerComplete.bind(this),this.duration)}stop(){this.endTimer()}endTimer(){this.timer&&(clearTimeout(this.timer),this.listeners.length=0)}dispose(){this.endTimer()}},Ki=class{constructor(){this.listeners={inView:[],outView:[],changeView:[]},this.percentViewable=0}onInView(e){return this.addCallback(e,"inView")}onChangeView(e){return this.addCallback(e,"changeView")}onOutView(e){return this.addCallback(e,"outView")}addCallback(e,t){if(typeof e=="function"&&this.listeners[t])this.listeners[t].push(e);else if(typeof e!="function")throw"callback must be function";return this}start(){}dispose(){}get unmeasureable(){return!1}get viewable(){return!1}get techniqueName(){return"BaseTechnique"}},fb=r=>typeof r=="function"&&Object.getOwnPropertyNames(Ki).reduce((t,n)=>n&&typeof r[t]==typeof Ki[t],!0),mb=r=>r&&r.toString().indexOf("Element")>-1,pb=({inViewThreshold:r,timeInView:e})=>{let t=!1,n=[];return(typeof r!="number"||r>1)&&(t=!0,n.push("inViewThreshold must be a number equal to or less than 1")),(typeof e!="number"||e<0)&&(t=!0,n.push("timeInView must be a number greater to or equal 0")),{invalid:t,reasons:n.join(" | ")}},qh=({autostart:r,techniques:e,criteria:t})=>{let n=!1,i=[];typeof r!="boolean"&&(n=!0,i.push("autostart must be boolean")),(!Array.isArray(e)||e.length===0)&&(n=!0,i.push("techniques must be an array containing atleast on measurement techniques"));let s=pb(t);return s.invalid&&(n=!0,i.push(s.reasons)),{invalid:n,reasons:i.join(" | ")}},ms=class extends Ki{constructor(e,t=ai.criteria){super(e,t);if(t!==void 0&&e)this.element=e,this.criteria=t,this.inView=!1,this.started=!1,this.notificationLevels=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],this.notificationLevels.indexOf(this.criteria.inViewThreshold)===-1&&this.notificationLevels.push(this.criteria.inViewThreshold);else if(!e)throw"element not provided"}start(){this.observer=new window.IntersectionObserver(this.viewableChange.bind(this),{threshold:this.notificationLevels}),this.observer.observe(this.element)}dispose(){this.observer&&(this.observer.unobserve(element),this.observer.disconnect(element))}get unmeasureable(){return!window.IntersectionObserver||this.usesPolyfill||!mb(this.element)}get viewable(){return this.inView}get techniqueName(){return"IntersectionObserver"}get usesPolyfill(){return typeof window.IntersectionObserver.prototype.THROTTLE_TIMEOUT=="number"}viewableChange(e){e&&e.length&&e[0].intersectionRatio!==void 0&&(this.percentViewable=e[0].intersectionRatio,e[0].intersectionRatio<this.criteria.inViewThreshold&&this.started&&this.inView&&(this.inView=!1,this.listeners.outView.forEach(t=>t())),e[0].intersectionRatio>=this.criteria.inViewThreshold&&!this.inView&&(this.started=!0,this.inView=!0,this.listeners.inView.forEach(t=>t())),this.listeners.changeView.forEach(t=>t()))}};(function(){if(typeof window!="object")return;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});return}function r(y){try{return y.defaultView&&y.defaultView.frameElement||null}catch(b){return null}}var e=function(y){for(var b=y,E=r(b);E;)b=E.ownerDocument,E=r(b);return b}(window.document),t=[],n=null,i=null;function s(y){this.time=y.time,this.target=y.target,this.rootBounds=m(y.rootBounds),this.boundingClientRect=m(y.boundingClientRect),this.intersectionRect=m(y.intersectionRect||f()),this.isIntersecting=!!y.intersectionRect;var b=this.boundingClientRect,E=b.width*b.height,C=this.intersectionRect,w=C.width*C.height;E?this.intersectionRatio=Number((w/E).toFixed(4)):this.intersectionRatio=this.isIntersecting?1:0}function a(y,b){var E=b||{};if(typeof y!="function")throw new Error("callback must be a function");if(E.root&&E.root.nodeType!=1&&E.root.nodeType!=9)throw new Error("root must be a Document or Element");this._checkForIntersections=l(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=y,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(E.rootMargin),this.thresholds=this._initThresholds(E.threshold),this.root=E.root||null,this.rootMargin=this._rootMarginValues.map(function(C){return C.value+C.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}a.prototype.THROTTLE_TIMEOUT=100,a.prototype.POLL_INTERVAL=null,a.prototype.USE_MUTATION_OBSERVER=!0,a._setupCrossOriginUpdater=function(){return n||(n=function(y,b){!y||!b?i=f():i=p(y,b),t.forEach(function(E){E._checkForIntersections()})}),n},a._resetCrossOriginUpdater=function(){n=null,i=null},a.prototype.observe=function(y){var b=this._observationTargets.some(function(E){return E.element==y});if(!b){if(!(y&&y.nodeType==1))throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:y,entry:null}),this._monitorIntersections(y.ownerDocument),this._checkForIntersections()}},a.prototype.unobserve=function(y){this._observationTargets=this._observationTargets.filter(function(b){return b.element!=y}),this._unmonitorIntersections(y.ownerDocument),this._observationTargets.length==0&&this._unregisterInstance()},a.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},a.prototype.takeRecords=function(){var y=this._queuedEntries.slice();return this._queuedEntries=[],y},a.prototype._initThresholds=function(y){var b=y||[0];return Array.isArray(b)||(b=[b]),b.sort().filter(function(E,C,w){if(typeof E!="number"||isNaN(E)||E<0||E>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return E!==w[C-1]})},a.prototype._parseRootMargin=function(y){var b=y||"0px",E=b.split(/\s+/).map(function(C){var w=/^(-?\d*\.?\d+)(px|%)$/.exec(C);if(!w)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(w[1]),unit:w[2]}});return E[1]=E[1]||E[0],E[2]=E[2]||E[0],E[3]=E[3]||E[1],E},a.prototype._monitorIntersections=function(y){var b=y.defaultView;if(!!b&&this._monitoringDocuments.indexOf(y)==-1){var E=this._checkForIntersections,C=null,w=null;this.POLL_INTERVAL?C=b.setInterval(E,this.POLL_INTERVAL):(c(b,"resize",E,!0),c(y,"scroll",E,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in b&&(w=new b.MutationObserver(E),w.observe(y,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))),this._monitoringDocuments.push(y),this._monitoringUnsubscribes.push(function(){var I=y.defaultView;I&&(C&&I.clearInterval(C),u(I,"resize",E,!0)),u(y,"scroll",E,!0),w&&w.disconnect()});var O=this.root&&(this.root.ownerDocument||this.root)||e;if(y!=O){var S=r(y);S&&this._monitorIntersections(S.ownerDocument)}}},a.prototype._unmonitorIntersections=function(y){var b=this._monitoringDocuments.indexOf(y);if(b!=-1){var E=this.root&&(this.root.ownerDocument||this.root)||e,C=this._observationTargets.some(function(S){var I=S.element.ownerDocument;if(I==y)return!0;for(;I&&I!=E;){var N=r(I);if(I=N&&N.ownerDocument,I==y)return!0}return!1});if(!C){var w=this._monitoringUnsubscribes[b];if(this._monitoringDocuments.splice(b,1),this._monitoringUnsubscribes.splice(b,1),w(),y!=E){var O=r(y);O&&this._unmonitorIntersections(O.ownerDocument)}}}},a.prototype._unmonitorAllIntersections=function(){var y=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var b=0;b<y.length;b++)y[b]()},a.prototype._checkForIntersections=function(){if(!(!this.root&&n&&!i)){var y=this._rootIsInDom(),b=y?this._getRootRect():f();this._observationTargets.forEach(function(E){var C=E.element,w=h(C),O=this._rootContainsTarget(C),S=E.entry,I=y&&O&&this._computeTargetAndRootIntersection(C,w,b),N=null;this._rootContainsTarget(C)?(!n||this.root)&&(N=b):N=f();var B=E.entry=new s({time:o(),target:C,boundingClientRect:w,rootBounds:N,intersectionRect:I});S?y&&O?this._hasCrossedThreshold(S,B)&&this._queuedEntries.push(B):S&&S.isIntersecting&&this._queuedEntries.push(B):this._queuedEntries.push(B)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},a.prototype._computeTargetAndRootIntersection=function(y,b,E){if(window.getComputedStyle(y).display!="none"){for(var C=b,w=T(y),O=!1;!O&&w;){var S=null,I=w.nodeType==1?window.getComputedStyle(w):{};if(I.display=="none")return null;if(w==this.root||w.nodeType==9)if(O=!0,w==this.root||w==e)n&&!this.root?!i||i.width==0&&i.height==0?(w=null,S=null,C=null):S=i:S=E;else{var N=T(w),B=N&&h(N),A=N&&this._computeTargetAndRootIntersection(N,B,E);B&&A?(w=N,S=p(B,A)):(w=null,C=null)}else{var M=w.ownerDocument;w!=M.body&&w!=M.documentElement&&I.overflow!="visible"&&(S=h(w))}if(S&&(C=d(S,C)),!C)break;w=w&&T(w)}return C}},a.prototype._getRootRect=function(){var y;if(this.root&&!_(this.root))y=h(this.root);else{var b=_(this.root)?this.root:e,E=b.documentElement,C=b.body;y={top:0,left:0,right:E.clientWidth||C.clientWidth,width:E.clientWidth||C.clientWidth,bottom:E.clientHeight||C.clientHeight,height:E.clientHeight||C.clientHeight}}return this._expandRectByRootMargin(y)},a.prototype._expandRectByRootMargin=function(y){var b=this._rootMarginValues.map(function(C,w){return C.unit=="px"?C.value:C.value*(w%2?y.width:y.height)/100}),E={top:y.top-b[0],right:y.right+b[1],bottom:y.bottom+b[2],left:y.left-b[3]};return E.width=E.right-E.left,E.height=E.bottom-E.top,E},a.prototype._hasCrossedThreshold=function(y,b){var E=y&&y.isIntersecting?y.intersectionRatio||0:-1,C=b.isIntersecting?b.intersectionRatio||0:-1;if(E!==C)for(var w=0;w<this.thresholds.length;w++){var O=this.thresholds[w];if(O==E||O==C||O<E!=O<C)return!0}},a.prototype._rootIsInDom=function(){return!this.root||g(e,this.root)},a.prototype._rootContainsTarget=function(y){var b=this.root&&(this.root.ownerDocument||this.root)||e;return g(b,y)&&(!this.root||b==y.ownerDocument)},a.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},a.prototype._unregisterInstance=function(){var y=t.indexOf(this);y!=-1&&t.splice(y,1)};function o(){return window.performance&&performance.now&&performance.now()}function l(y,b){var E=null;return function(){E||(E=setTimeout(function(){y(),E=null},b))}}function c(y,b,E,C){typeof y.addEventListener=="function"?y.addEventListener(b,E,C||!1):typeof y.attachEvent=="function"&&y.attachEvent("on"+b,E)}function u(y,b,E,C){typeof y.removeEventListener=="function"?y.removeEventListener(b,E,C||!1):typeof y.detachEvent=="function"&&y.detachEvent("on"+b,E)}function d(y,b){var E=Math.max(y.top,b.top),C=Math.min(y.bottom,b.bottom),w=Math.max(y.left,b.left),O=Math.min(y.right,b.right),S=O-w,I=C-E;return S>=0&&I>=0&&{top:E,bottom:C,left:w,right:O,width:S,height:I}||null}function h(y){var b;try{b=y.getBoundingClientRect()}catch(E){}return b?(b.width&&b.height||(b={top:b.top,right:b.right,bottom:b.bottom,left:b.left,width:b.right-b.left,height:b.bottom-b.top}),b):f()}function f(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function m(y){return!y||"x"in y?y:{top:y.top,y:y.top,bottom:y.bottom,left:y.left,x:y.left,right:y.right,width:y.width,height:y.height}}function p(y,b){var E=b.top-y.top,C=b.left-y.left;return{top:E,left:C,height:b.height,width:b.width,bottom:E+b.height,right:C+b.width}}function g(y,b){for(var E=b;E;){if(E==y)return!0;E=T(E)}return!1}function T(y){var b=y.parentNode;return y.nodeType==9&&y!=e?r(y):(b&&b.assignedSlot&&(b=b.assignedSlot.parentNode),b&&b.nodeType==11&&b.host?b.host:b)}function _(y){return y&&y.nodeType===9}window.IntersectionObserver=a,window.IntersectionObserverEntry=s})();var zh=(r={})=>({viewportWidth:Math.max(document.body.clientWidth,window.innerWidth)||-1,viewportHeight:Math.max(document.body.clientHeight,window.innerHeight)||-1,elementWidth:r.clientWidth||-1,elementHeight:r.clientHeight||-1,iframeContext:go(),focus:gb()}),gb=()=>document.hidden!=="undefined"&&document.hidden===!0?!1:go()===oi.CROSS_DOMAIN_IFRAME?!0:window.document.hasFocus?window.top.document.hasFocus():!0,go=()=>{try{if(window.top===window)return oi.ON_PAGE;let r=window,e=0;for(;r.parent!==r&&e<1e3;){if(r.parent.document.domain!==r.document.domain)return oi.CROSS_DOMAIN_IFRAME;r=r.parent}oi.SAME_DOMAIN_IFRAME}catch(r){return oi.CROSS_DOMAIN_IFRAME}},oi={ON_PAGE:"on page",SAME_DOMAIN_IFRAME:"same domain iframe",CROSS_DOMAIN_IFRAME:"cross domain iframe"},vo=class extends ms{get unmeasureable(){return go()===oi.CROSS_DOMAIN_IFRAME}get techniqueName(){return"IntersectionObserverPolyFill"}},vb=Object.freeze({__proto__:null,IntersectionObserver:ms,IntersectionObserverPolyfill:vo,BaseTechnique:Ki}),Yh={inViewThreshold:.5,timeInView:2e3},yb={inViewThreshold:.5,timeInView:1e3},bb=(r=.5,e=2e3)=>({inViewThreshold:r,timeInView:e}),Tb=Object.freeze({__proto__:null,MRC_VIDEO:Yh,MRC_DISPLAY:yb,customCriteria:bb}),ai={autostart:!0,techniques:[ms,vo],criteria:Yh},Eb=(r=ai.autostart,e=ai.techniques,t=ai.criteria)=>{let n={autostart:r,techniques:e,criteria:t},i=qh(n);if(i.invalid)throw i.reasons;return n},Sb=Object.freeze({__proto__:null,DEFAULT_STRATEGY:ai,StrategyFactory:Eb}),yo=class{constructor(e,t={}){this._listeners={start:[],stop:[],change:[],complete:[],unmeasureable:[]},this._element=e,this._strategy=Object.assign({},ai,t),this._criteriaMet=!1;let n=qh(this._strategy);if(n.invalid)throw n.reasons;this._technique=this._selectTechnique(this._strategy.techniques),this._technique&&this._addSubscriptions(this._technique),this.unmeasureable?setTimeout(()=>this._publish(si,zh(this._element)),0):this._strategy.autostart&&this._technique.start()}start(){this._technique.start()}dispose(){this._technique&&this._technique.dispose(),this.timer&&this.timer.dispose()}onViewableStart(e){return this._addCallback(e,uo)}onViewableStop(e){return this._addCallback(e,ho)}onViewableChange(e){return this._addCallback(e,fs)}onViewableComplete(e){return this._addCallback(e,Wi),this.criteriaMet&&this._techniqueChange(Wi,this._technique),this}onUnmeasureable(e){return this._addCallback(e,si),this.unmeasureable&&this._techniqueChange(si),this}get unmeasureable(){return!this._technique||this._technique.unmeasureable}_selectTechnique(e){return e.filter(fb).map(this._instantiateTechnique.bind(this)).find(t=>!t.unmeasureable)}_instantiateTechnique(e){return new e(this._element,this._strategy.criteria)}_addSubscriptions(e){e&&(e.onInView(this._techniqueChange.bind(this,fo,e)),e.onChangeView(this._techniqueChange.bind(this,fs,e)),e.onOutView(this._techniqueChange.bind(this,mo,e)))}_techniqueChange(e,t={}){let n,i=this._appendEnvironment(t);switch(e){case fo:this._criteriaMet||(this.timer=new po(this._strategy.criteria.timeInView),this.timer.elapsed(this._timerElapsed.bind(this,t)),this.timer.start(),n=uo);break;case fs:n=e;break;case Wi:this._criteriaMet||(this._criteriaMet=!0,n=e);break;case mo:this._criteriaMet||(this.timer&&(this.timer.stop(),delete this.timer),n=ho);break;case si:n=si}n&&this._publish(n,i)}_publish(e,t){Array.isArray(this._listeners[e])&&this._listeners[e].forEach(n=>n(t))}_timerElapsed(e){this._techniqueChange(Wi,e)}_addCallback(e,t){if(this._listeners[t]&&typeof e=="function")this._listeners[t].push(e);else if(typeof e!="function")throw"Callback must be a function";return this}_appendEnvironment(e){return Object.assign({},{percentViewable:typeof e.percentViewable=="undefined"?-1:e.percentViewable,technique:e.techniqueName||-1,viewable:typeof e.viewable=="undefined"?-1:e.viewable},zh(this._element))}},En=class{constructor(){this.executors=[]}measureElement(e,t){let n=new yo(e,t);return this.executors.push(n),n}dispose(){this.executors.forEach(e=>e.dispose())}};En.ViewabilityCriteria=Tb;En.MeasurementExecutor=yo;En.MeasurementTechniques=vb;En.InViewTimer=po;En.Strategies=Sb;En.Events=hb;var qi=En;var Xh=document.createElement("template");Xh.innerHTML=`<slot></slot><style>
${Kh}</style>
`;var ee,_b="stn-ima",bo=class extends ke{connectedCallback(){console.log("Connected"),L(()=>ee(this).model.isConnected=!0)}disconnectedCallback(){console.log("Disconnected"),L(()=>ee(this).model.isConnected=!1)}constructor(){super();let e=this.attachShadow({mode:Re?"open":"closed"});e.appendChild(Xh.content.cloneNode(!0));let t=new class{constructor(){k(this,"isConnected",!1);k(this,"adDisplayContainer",null);k(this,"adsLoader",null);k(this,"adIndex",null);k(this,"insecureVpaid",!0);k(this,"adsRequest",null);k(this,"adsManager",null);k(this,"browserPause",!0);k(this,"dv",null);k(this,"openvv");k(this,"playerModelOpenvv",!1);k(this,"dvLogging",!1);k(this,"volume",1);k(this,"muted",!0);k(this,"hasEverBeenUnmuted",!1);k(this,"ready",!1);k(this,"width",null);k(this,"height",null);k(this,"src","");k(this,"paused",!0);k(this,"waiting",!1);k(this,"adsRequested",!1);k(this,"allAdsCompleted",!1);k(this,"contentCompleteCalled",!1);k(this,"contentCurrentTime",0);k(this,"contentEnded",!1);k(this,"error",null);k(this,"waitForClientBid",!1);k(this,"contentPauseRequested",!0);k(this,"isLinear",null);k(this,"companionAd",{});k(this,"started",!1);k(this,"adQuartile",null);k(this,"adCurrentTime",null);k(this,"adPosition",null);k(this,"totalAds",null);k(this,"adLength",null);k(this,"adCuePoints",[]);k(this,"pageGestureTarget",null);k(this,"lineItem",0);k(this,"adX",!1);k(this,"iframe",null);k(this,"impression",{});k(this,"removeMidrolls",!1);k(this,"rawPaused",!0);k(this,"hasEverStarted",!1);k(this,"preventImaRefreshOfGpt",!1)}get contentShouldPause(){let{waitForClientBid:i,ended:s,contentPauseRequested:a,isLinear:o}=this;return i||!(s||!a||o===!1)}get ended(){let{waitForClientBid:i,allAdsCompleted:s,error:a}=this;return!!(!i&&s||a)}};ye(t),Object.freeze(t),x(()=>!t.muted,i=>t.hasEverBeenUnmuted|=i);let n={shadow:e,model:t,started:!1};ee(this,n),new ResizeObserver(j(i=>{let{length:s}=i,{width:a,height:o}=i[s-1].contentRect;t.height=o,t.width=a})).observe(this),Di.then(i=>Q(()=>t.isConnected).then(()=>i)).then(j(i=>{x(()=>{let{waitForClientBid:f,allAdsCompleted:m,error:p}=t;return!!(m||p)&&f},f=>{if(!f)return;this.src.prebidBid?.resolve(null);let m=Xn.requestBid(!1);if(!m){t.waitForClientBid=!1;return}t.adsLoader.contentComplete();let g=new i.AdsRequest;g.isClientAdRequest=!0,g.clientInfo={provider:Object.keys(m.cpm)[0]==="amazon"?"amazon":m.params.hb_bidder,cpm:Object.values(m.cpm)[0]},h(g,Object.values(m.vastURL)[0])});let s=i.AdEvent.Type,a={};for(let f of Object.keys(s).sort())!s.hasOwnProperty(f)||!f.match(/^[A-Z_]+$/)||(a[f]=s[f]);ie&&console.table(a),n.ima=i,Qh(i,t);let o=e.querySelector("slot").assignedElements({flatten:!0})[0];t.adDisplayContainer=new i.AdDisplayContainer(o),t.adDisplayContainer.initialize(),t.adsLoader=new i.AdsLoader(t.adDisplayContainer),t.iframe=o.querySelector("iframe");let l=[...o.childNodes].flatMap(f=>[...f.querySelectorAll?.('video, [playsinline], [title="Advertisement"]:not(iframe)')??[]]);l.filter(f=>f.tagName==="LIMA-VIDEO").map(f=>f.shadowRoot.firstElementChild).filter(f=>f.tagName==="VIDEO").forEach(f=>{try{let m=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"src");Object.defineProperty(f,"src",{get:()=>m.get.call(f),set:p=>m.set.call(f,p??"")&&!p&&f.removeAttribute("src")})}catch(m){}}),Q(()=>t.pageGestureTarget,()=>{let f=l.map(m=>new Oi(m,t.pageGestureTarget));P(()=>f.forEach(m=>m.muted=t.muted)),P(()=>f.forEach(m=>m.volume=t.volume))});let c,u=()=>{c&&c.executors.forEach(f=>f._listeners={})};x(()=>t.playerModelOpenvv&&t.openvv!==void 0&&this.adPlaying,f=>{if(!f)return;u(),c=new qi;let m=!0,p=[qi.MeasurementTechniques.IntersectionObserver,qi.MeasurementTechniques.IntersectionObserverPolyfill],g={inViewThreshold:.5,timeInView:2e3},T=qi.Strategies.StrategyFactory(m,p,g),_=this.adIndex;l.forEach(y=>{c.measureElement(y,T).onViewableStart(b=>{L(()=>t.openvv={...b,type:"start",adIndex:_})}).onViewableStop(b=>{L(()=>t.openvv={...b,type:"stop",adIndex:_})}).onViewableChange(b=>{L(()=>t.openvv={...b,type:"change",adIndex:_})}).onViewableComplete(b=>{L(()=>t.openvv={...b,type:"complete",adIndex:_}),u()}).onUnmeasureable(()=>{L(()=>t.openvv={...args,type:"unmeasureable",adIndex:_}),u()})})},{fireImmediately:!0});let d={};P(()=>d.currentTime=t.contentCurrentTime);let h=(f,m)=>{f.adTagUrl=m,t.adsRequested=!1,t.error=null,t.paused=!1,t.started=!1,t.adsRequest=f};x(()=>[t.contentCurrentTime,t.adCuePoints],(f,m)=>{let p=f[0],g=p===0?-Infinity:m[0],T=f[1],_=Object.keys(T).map(Number).sort().filter(y=>y>=g&&y<=p);try{let y=_[0],E=T[y][0].querySelector("AdTagURI").textContent,C=new i.AdsRequest;Wt(function*(){let O=y===Infinity,S=y===-Infinity;if(!O&&!S){yield Q(()=>t.removeMidrolls!==null);let N=L(()=>t.removeMidrolls);if(Ci(`Should${N?" ":" NOT "}Remove Midrolls`),N){h(C,null);return}}O?t.adIndex=0:S?t.adIndex=-1:t.adIndex===null?t.adIndex=1:t.adIndex++,h(C,yield this.getAdTagUrl(E))}).call(this)}catch(y){}}),t.adsLoader.addEventListener(i.AdErrorEvent.Type.AD_ERROR,j(f=>{t.error=f.getError().getMessage(),t.allAdsCompleted=!0})),t.adsLoader.addEventListener(i.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,f=>{try{L(()=>t.preventImaRefreshOfGpt)&&le.googletag.companionAds().notifyUnfilledSlots(!1)}catch(y){}let m=f.getUserRequestContext();if(!m)throw new Error("IMA SDK failed to provide a request context");L(()=>{if(t.adsRequest!==m)throw new Error("AdsRequest returned but does not match current AdsRequest")});let{isClientAdRequest:p,clientInfo:g}=m,T=new i.AdsRenderingSettings;T.restoreCustomPlaybackStateOnAdBreakComplete=!1,T.uiElements=null,T.useStyledNonLinearAds=!0;let _=f.getAdsManager(d,T);if(ie){let y=function({type:b}){console.log("IMA Event %o",b)};Object.values(a).forEach(b=>_.addEventListener(b,y))}Q(()=>t.dvLogging,()=>{let y=b=>{Array.from(b.querySelectorAll('iframe[src="about:blank"]')).forEach(C=>{try{C.contentWindow.navigator.sendBeacon=(...w)=>{let O=new URL(w[0]),S=O.hostname,I=O.pathname;if(S.endsWith("doubleverify.com")&&I==="/event.png"){let N=Object.fromEntries(O.searchParams);L(()=>t.dv=N)}navigator.sendBeacon(...w)},y(C.contentDocument)}catch(w){}})};_.addEventListener(i.AdEvent.Type.AD_CAN_PLAY,b=>{L(()=>t.dv=null),y(o)})}),_.addEventListener(i.AdEvent.Type.IMPRESSION,j(y=>{t.waitForClientBid=!1,t.adQuartile=0;let b,E,C,w,O,S=null,I,N=t.adIndex,B;try{let $=y.getAd(),q=$.getWrapperAdIds().slice();q.length===0&&q.push($.getAdId());let Y=$.getWrapperAdSystems().slice();Y.length===0&&Y.push($.getAdSystem());let W=Y.map(K=>K.toLowerCase());O=W.map((K,ue)=>K==="gdfp"?q[ue]:null).filter(K=>K!==null),I=W.includes("adx")||W.includes("adsense/adx"),ie&&console.log({adSystems:Y,lineItems:q,lineItemsGDFP:O,adX:I}),b=q.slice(-1)[0],E=Y.slice(-1)[0],C=q[0],w=Y[0],B=$.getAdvertiserName()}catch($){S=$.message,console.error(y.getAd(),$)}let{prebidBid:A}=this.src;A?.resolve(b);let M={adX:I,lineItem:b,adSystem:E,firstLineItem:C,firstAdSystem:w,lineItemsGDFP:O,error:S,adIndex:N,advertiser:B,isClientAdRequest:p,bidProvider:g?.provider,bidvl:g?.cpm};try{M.bidIndex=this.src.bidTracker?.bidIndex}catch($){}t.impression=M})),_.addEventListener(i.AdEvent.Type.FIRST_QUARTILE,j(()=>t.adQuartile=1)),_.addEventListener(i.AdEvent.Type.MIDPOINT,j(()=>t.adQuartile=2)),_.addEventListener(i.AdEvent.Type.THIRD_QUARTILE,j(()=>t.adQuartile=3)),_.addEventListener(i.AdEvent.Type.COMPLETE,j(()=>t.adQuartile=4)),_.addEventListener(i.AdEvent.Type.AD_CAN_PLAY,j(()=>{_[t.paused?"pause":"resume"](),t.openvv=null})),_.addEventListener(i.AdEvent.Type.RESUMED,j(()=>t.rawPaused=!1)),_.addEventListener(i.AdEvent.Type.PAUSED,j(()=>t.rawPaused=!0)),_.addEventListener(i.AdEvent.Type.ALL_ADS_COMPLETED,j(()=>{t.allAdsCompleted=!0})),_.addEventListener(i.AdEvent.Type.AD_PROGRESS,j(y=>{let b=y.getAdData();b.hasOwnProperty("currentTime")?t.adCurrentTime=b.currentTime:t.adCurrentTime=b.duration-y.target.getRemainingTime()})),_.addEventListener(i.AdEvent.Type.LOG,j(y=>{let b=[],E=y.getAdData().adError,C=E;for(;C;){let w={code:C.getErrorCode&&C.getErrorCode()||null,message:C.getMessage&&C.getMessage()||C.message||null,type:C.getType&&C.getType()||null,vastCode:C.getVastErrorCode&&C.getVastErrorCode()||null};b.push(w),C=C.getInnerError&&C.getInnerError()||null}console.warn(`IMA Error (LOG Event):
${b.map(()=>`%o
`)}%s`,...b,E.stack)})),_.addEventListener(i.AdEvent.Type.VOLUME_CHANGED,()=>{let y=_.getVolume(),b;L(()=>b=t.muted?0:t.volume),(b===0&&y!==0||Math.abs(y-b)>.1)&&_.setVolume(b)}),_.addEventListener(i.AdEvent.Type.CONTENT_PAUSE_REQUESTED,j(()=>t.contentPauseRequested=!0)),_.addEventListener(i.AdEvent.Type.CONTENT_RESUME_REQUESTED,j(()=>t.contentPauseRequested=!1)),_.addEventListener(i.AdEvent.Type.COMPLETE,j(()=>t.isLinear=null)),_.addEventListener(i.AdEvent.Type.SKIPPED,j(()=>t.isLinear=null)),_.addEventListener(i.AdEvent.Type.STARTED,j(y=>{_.setVolume(_.getVolume()),t.rawPaused=!1,t.waiting=!1;let b=y.getAd();t.isLinear=b.isLinear();let E=i.CompanionAdSelectionSettings,C=new E;C.resourceType=E.ResourceType.STATIC,C.creativeType=E.CreativeType.IMAGE,C.sizeCriteria=E.SizeCriteria.SELECT_NEAR_MATCH,C.nearMatchPercent=80;let w=b.getCompanionAds(320,60,C),O=w[0]?.getContent()??"";if(O){let S=w[0].getWidth(),I=w[0].getHeight();t.companionAd={content:O,width:S,height:I}}try{t.adPosition=b.getAdPodInfo().getAdPosition()}catch(S){t.adPosition=null}try{t.totalAds=b.getAdPodInfo().getTotalAds()}catch(S){t.totalAds=null}try{t.adLength=b.getDuration()}catch(S){t.adLength=null}t.adCurrentTime=0})),L(()=>{_.init(t.width,t.height,i.ViewMode.NORMAL),t.adsManager=_})}),x(()=>[t.adsManager,t.paused,t.rawPaused],([f,m,p],g)=>{let[,,T]=g||[],_=m!==p,y=p!==T;f&&!_&&!t.paused&&(t.hasEverStarted=!0),!(!f||!_)&&(t.browserPause=y?p:null,!y&&(t.paused?f.pause():f.resume()))},{fireImmediately:!0}),x(()=>t.contentEnded,f=>{ie&&console.log("Content Ended %o",f),t.contentEnded&&(t.contentCompleteCalled=!0,t.companionAd={},t.adIndex=null)}),x(()=>t.contentCompleteCalled,f=>{ie&&console.log("Content Complete %o",f),f&&t.adsLoader.contentComplete()}),x(()=>[t.adsRequest,t.height],([f,m])=>{!f||!m||(ie&&console.log("AdsRequest Height Set %o",m),Object.assign(f,{linearAdSlotHeight:m,nonLinearAdSlotHeight:m}))}),x(()=>[t.adsRequest,t.width],([f,m])=>{!f||!m||(ie&&console.log("AdsRequest Width Set %o",m),Object.assign(f,{linearAdSlotWidth:m,nonLinearAdSlotWidth:m}))}),x(()=>[t.adsRequest,!t.paused&&!t.adsRequested],Wt(function*([m,p]){if(!m||!p)return;ie&&console.log("AdsRequest Request Ads");try{if(m.adTagUrl&&new URL(m.adTagUrl).searchParams.get("ad_rule")==="1"){let E=function(w){let O;return w==="start"?-Infinity:w==="end"?Infinity:(O=w.match(/^([0-9]{2}):([0-9]{2}):([0-9]{2})/),O?O[1]*60*60+O[2]*60+O[3]*1:null)},T=yield fetch(m.adTagUrl);m.adTagUrl="";let _=yield T.text(),C=[...new DOMParser().parseFromString(_,"text/xml").querySelectorAll("AdBreak")];if(!C.length){t.allAdsCompleted=!0;return}t.adCuePoints=C.reduce((w,O)=>{let S=E(O.getAttribute("timeOffset"));return S!==null&&(w[S]=(w[S]||[]).concat(O)),w},{});return}}catch(T){console.error(T),m.adTagUrl="",m.adsResponse=""}m.forceNonLinearFullSlot=!1,m.setContinuousPlayback(!0);let g=L(()=>t.hasEverBeenUnmuted);ie&&console.log("AdsRequest AutoPlay %o",!g),m.setAdWillAutoPlay(!g),t.adsRequested=!0,t.waiting=!0,t.waitForClientBid=!0,t.allAdsCompleted=!1,Qh(i,t),t.adsLoader.requestAds(m,m)}.bind(this))),x(()=>[t.adsManager,t.muted?0:t.volume],([f,m])=>{!f||(ie&&console.log("AdsManager SetVolume %o",m),f.setVolume(m))}),x(()=>[t.adsManager,t.width,t.height],([f,m,p])=>{!f||(ie&&console.log("AdsManager Resize %ox%o",m,p),f.resize(t.width,t.height,i.ViewMode.NORMAL))}),x(()=>[t.adsManager,t.paused,t.isLinear],([f,m,p])=>{if(!f)return;let g=m?"pause":t.started?"resume":"start";!p&&g!=="start"||(ie&&console.log("AdsManager Start/Pause/Resume %o",g),m||(t.started=!0),f[g]())}),x(()=>{let{ready:f,src:m}=t;return f&&m},f=>{if(t.adsRequested=!1,t.contentCompleteCalled=!1,t.allAdsCompleted=!1,t.error=null,t.contentPauseRequested=!0,t.isLinear=null,t.companionAd={},t.adsManager&&(t.adsManager.destroy(),t.adsManager=null),t.adsLoader.contentComplete(),t.adsRequest=null,t.started=!1,t.adCuePoints=[],!t.src){t.src===!1&&(t.error="Ad not configured");return}Wt(function*(){let p=new i.AdsRequest;p.adTagUrl=yield this.getAdTagUrl(),t.adsRequest=p}.bind(this))()},{equals:()=>!1,fireImmediately:!0}),t.ready=!0}),j(i=>{t.error=i,t.allAdsCompleted=!0}))}set preventImaRefreshOfGpt(e){L(()=>ee(this).model.preventImaRefreshOfGpt=!!e)}get muted(){return ee(this).model.muted}set muted(e){L(()=>ee(this).model.muted=!!e)}get volume(){return ee(this).model.volume}set volume(e){if(e=parseFloat(e),isNaN(e))throw new Error("Volume is not a number");if(e<0)throw new Error("Volume is less than 0");if(e>1)throw new Error("Volume is more than 1");L(()=>ee(this).model.volume=e)}get height(){return ee(this).model.height}get width(){return ee(this).model.width}set src(e){L(()=>{ee(this).model.src="",ee(this).model.src=e})}get src(){return ee(this).model.src}get ended(){return ee(this).model.ended}get paused(){return ee(this).model.paused}get waiting(){let e=ee(this).model.waiting;return this.contentShouldPause&&e}get isLinear(){return ee(this).model.isLinear}get browserPause(){return ee(this).model.browserPause}set contentCurrentTime(e){L(()=>ee(this).model.contentCurrentTime=e)}set contentEnded(e){L(()=>ee(this).model.contentEnded=e)}get contentShouldPause(){return ee(this).model.contentShouldPause}get companionAd(){return ee(this).model.companionAd}get adQuartile(){return ee(this).model.adQuartile}get adCompleted(){return this.isLinear===null}get adPlaying(){return this.isLinear===!0}get adCurrentTime(){return ee(this).model.adCurrentTime}get adPosition(){return ee(this).model.adPosition}get totalAds(){return ee(this).model.totalAds}get adLength(){return ee(this).model.adLength}get adCuePoints(){return Object.keys(ee(this).model.adCuePoints)}get started(){return ee(this).model.started}get impression(){return ee(this).model.impression}async getAdTagUrl(e){let{src:t}=ee(this).model,n=this.adIndex,i,s,a=[];if(e){t.newParams();let d=t.getPrebid(),h=t.getOptimeraParams();({result:i,finalizers:a}=await d);try{let f=L(()=>this.src.bidTracker);f?.incrementBidIndex(),ae.call(this.getRootNode().host.getRootNode().host,"BIDS",{...f?.params,adIndex:n})}catch(f){}s=await h}let{adServerUrlPath:o,param:l}=t;e&&(l.ad_rule=0,l.output="vast");let c=Object.assign({},l.cust_params,i,s);a.forEach(d=>d(c)),c=wt(c);let u=new URL(e??`${o}?${wt(l)}`);return u.searchParams.set("cust_params",c),u.searchParams.set("plcmt",l.plcmt),u.href}play(){L(()=>{ee(this).model.paused=!1})}pause(){L(()=>{ee(this).model.paused=!0})}set pageGestureTarget(e){L(()=>ee(this).model.pageGestureTarget=e)}get insecureVpaid(){L(()=>ee(this).model.insecureVpaid)}set insecureVpaid(e){L(()=>ee(this).model.insecureVpaid=e)}stop(){ee(this).model.adsManager?.stop(),ee(this).model.adsManager?.destroy(),ee(this).model.allAdsCompleted=!0}get frame(){return ee(this).model.iframe}get hasEverStarted(){return ee(this).model.hasEverStarted}get openvv(){return ee(this).model.openvv}set playerModelOpenvv(e){L(()=>ee(this).model.playerModelOpenvv=e)}get dv(){return ee(this).model.dv}set dvLogging(e){L(()=>ee(this).model.dvLogging=e)}get adIndex(){return ee(this).model.adIndex}get allAdsCompleted(){return ee(this).model.allAdsCompleted}set removeMidrolls(e){L(()=>ee(this).model.removeMidrolls=e)}};function Qh(r,e){let t=r.ImaSdkSettings,n=r.settings;n.setAutoPlayAdBreaks(!0),n.setCompanionBackfill(t.CompanionBackfillMode.ALWAYS),n.setCookiesEnabled(!0),n.setDisableCustomPlaybackForIOS10Plus(!0),n.setFeatureFlags({}),n.setLocale("en"),n.setNumRedirects(4),n.setPlayerType("stnvideo/player"),n.setPlayerVersion(""),n.setPpid(),n.setVpaidAllowed(!0),e.insecureVpaid?n.setVpaidMode(t.VpaidMode.INSECURE):n.setVpaidMode(t.VpaidMode.ENABLED)}ee=oe(bo);customElements.define(_b,bo);var Jh=`:host
{
    display: block;
    position: relative;
    --translate: -50%;
    overflow: hidden;
}

stn-ima
{
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
}

:host(.manualFullscreen)
{
    position: fixed !important;
    max-width: none !important;
    top: 0 !important;
    left: 0 !important;
    z-index: var(--floatZIndex) !important;
    height: var(--innerHeight) !important;
    width: 100vw !important;
    background: black !important;
}

:host .spinner
{
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* STN Play Button Logo Spinner */
/* :host .spinner-active */
/* { */
/*     opacity: 0.4; */
/* } */

/* :host .spinner svg */
/* { */
/*     height: 35%; */
/*     width: 35%; */
/* } */

/* :host .spinner svg path */
/* { */
/*     fill: var(--spinnerColor1) */
/* } */

/* :host .spinner svg { */
/*     animation: 2s spin ease infinite; */
/* } */

/* @keyframes spin { */
/*     0% { */
/*         transform: translate(var(--translate), var(--translate)) rotate(0); */
/*     } */
/*     20% { */
/*         transform: translate(var(--translate), var(--translate)) rotate(-45deg); */
/*     } */
/*     60% { */
/*         transform: translate(var(--translate), var(--translate)) rotate(740deg); */
/*     } */
/*     70% { */
/*         transform: translate(var(--translate), var(--translate)) rotate(705deg); */
/*     } */
/*     80% { */
/*         transform: translate(var(--translate), var(--translate)) rotate(725deg); */
/*     } */
/*     90% { */
/*         transform: translate(var(--translate), var(--translate)) rotate(719deg); */
/*     } */
/*     100% { */
/*         transform: translate(var(--translate), var(--translate)) rotate(720deg); */
/*     } */
/* } */

.spinner
{
    width: 65px;
    height: 65px;
    --spinner-duration: 1.4s;
    animation: rotate var(--spinner-duration) linear infinite;
    transform: translate(-50%, -50%);
    color: #95E5E5;
}

.spinner svg
{
    animation: colors calc(var(--spinner-duration) * 4) infinite;
}

.spinner svg circle
{
    stroke: currentColor;
    animation: dash var(--spinner-duration) ease-in-out infinite;
    stroke-dasharray: 80px, 200px;
    stroke-dashoffset: 0;
}

@keyframes rotate
{
    0%
    {
        transform-origin: 50% 50%;
    }
    100%
    {
        transform: translate(-50%, -50%) rotate(360deg);
    }
}

@keyframes dash
{
    0%
    {
        stroke-dasharray: 1px, 200px;
        stroke-dashoffset: 0;
    }

    50%
    {
        stroke-dasharray: 100px, 200px;
        stroke-dashoffset: -15px;
    }

    100%
    {
        stroke-dasharray: 100px, 200px;
        stroke-dashoffset: -125px;
    }
}

@keyframes colors
{
    0%
    {
        color: var(--spinnerColor1);
    }
    25%
    {
        color: var(--spinnerColor2);
    }
    50%
    {
        color: var(--spinnerColor1);
    }
    75%
    {
        color: var(--spinnerColor2);
    }
}

.adInfo
{
    position: absolute;
    left: 1em;
    top: 0.5em;
    color: #FF0;
    font-size: 50%;
    text-shadow: #FFF 0 0 1px, #000 0 0 2px, #000 0 0 2px
}

.pausePlayOverlay
{
    opacity: 0;
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    color: white;
    background: rgba(0, 0, 0, 0.5);

    /* Pointer events pass through when not active */
    pointer-events: none;

    transition: opacity 300ms;

    /* To be on top of recirc, when we allow this overlay to appear on recirc */
    z-index: 1;
}

stn-control
{
    /* control bar to be on top of the pause overlay */
    z-index: 1;
    border-radius: var(--contentBorderRadius);
}


.pausePlayOverlay div
{
    --min: 32px;
    --idealRatio: 0.16;
    --max: 150px;

    font-size: clamp(var(--min), calc(var(--mediaWidth) * var(--idealRatio)), var(--max));
    width: calc(var(--idealRatio) * 100%);
    aspect-ratio: 1;

    min-width: var(--min);
    min-height: var(--min);
    max-width: var(--max);
    max-height: var(--max);
    text-align: center;
}

.pausePlayOverlay svg
{
    width: 100%;
    height: 100%;
}

.pausePlayOverlay.active
{
    opacity: 1;

    /* When active, enable pointer-events, but only at the end of a delay, */
    /* otherwise the click on the pause overlay to initiate a pause is immediately */
    /* executed */
    animation: pausePlayOverlayDisablePointer 300ms;
    pointer-events: all;
}

@keyframes pausePlayOverlayDisablePointer
{
    0%, 99%
    {
        pointer-events: none;
    }
}

stn-play-button
{
    opacity: 1;
    transition: opacity 300ms;
}

stn-play-button.hide
{
    opacity: 0;
}

.hide
{
    display: none;
}

.companionAd
{
    position: absolute;
    bottom: var(--controlbarHeight);
    transform: translate(-50%, 0);
    left: 50%;
}

.companionAd .close
{
    position: absolute;
    right: 0;
    top: 0;
    transform: translate(35%, -35%);
    background: black;
    color: white;
    border-radius: 100vw;
    font-size: 18px;
    cursor: pointer;
}

.companionAd iframe
{
    border: none;
}

.contextMenu:not(.active)
{
    display: none;
}

.contextMenu
{
    position: absolute;
    top: 0;
    left: 0;
    padding: 1em;
    z-index: 1;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    font-size: xx-small;
    font-family: monospace;
    max-width: 60%;
    white-space: nowrap;
}

.contextMenu div
{
    text-overflow: ellipsis;
    overflow: hidden;
}

.stnEngage
{
    position: absolute;
    color: white;
    z-index: 2;
}

.stnEngage.right
{
    --y: 50%;
    --x: 10px;

    top: var(--y);
    right: var(--x);
    transform: translate(0, calc(-1 * var(--y)));
}

.stnEngage.left
{
    --y: 50%;
    --x: 10px;

    top: var(--y);
    left: var(--x);
    transform: translate(0, calc(-1 * var(--y)));
}

.stnEngage.controlbarActive.bottom
{
    --y: calc(var(--controlbarHeight) + 5px);
}

.stnEngage.bottom
{
    --y: 5px;
    --x: 50%;

    bottom: var(--y);
    left: var(--x);
    transform: translate(calc(-1 * var(--x)), 0);
    transition: bottom 300ms;
}

.stnEngage.top
{
    --y: 40px;
    --x: 50%;

    top: var(--y);
    left: var(--x);
    transform: translate(calc(-1 * var(--x)), 0);
}

.stnEngage > .next:not(.hide) + .stay:not(.hide)
{
    margin-top: 10px;
}

.stnEngage > div
{
    z-index: 1;
    position: relative;
    overflow: hidden;
}

.stnEngage > div,
.stay:before,
.next:before
{
    --verticalPadding: 0.25em;

    background: var(--stnEngageTimeLeftColor);
    opacity: 0.8;
    height: 1.5em;
    width: 100px;
    text-align: center;
    padding: var(--verticalPadding) 0px var(--verticalPadding) 0px;
    border-radius: var(--borderRadius);

    /* offset-x offset-y blur-radius color */
    box-shadow: 0px 0px 2px 0px white;

    cursor: pointer;
}

.stnEngage.hideStnEngage,
.next.hideStnEngage,
.stay.hideStnEngage
{
    opacity: 0;
    pointer-events: none;
}

.next:before,
.stay:before
{
    background: var(--stnEngageProgressColor);
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
    width: 0%;
}

.next.progress:before,
.stay.progress:before
{
    width: 100%;
    transition: width var(--stnEngageCountdownTime) linear;
}
`;var Zh=`<svg viewBox="22 22 44 44">
    <circle cx="44" cy="44" r="20.2" fill="none" stroke-width="3.6"></circle>
</svg>
`;var ef=`<stn-video-hlsjs></stn-video-hlsjs>
<stn-play-button class='\${hidePlayButton:hide} \${ui}'></stn-play-button>
<div class='companionAd \${hideCompanion:hide}' style="height: \${companionAdHeight}px; width: \${companionAdWidth}px">
    <div class='close material-icons'>close</div>
    <iframe width="\${companionAdWidth}" height="\${companionAdHeight}" srcdoc="\${companionAdSrc}" scrolling='no'></iframe>
</div>
<stn-ima class='\${hideStnIma:hide}'><slot></slot></stn-ima>
<div class='adInfo'>\${adInfo}</div>
<stn-mute-button class='\${hideMuteButton:hide} \${pushDown} \${ui}'></stn-mute-button>
<div class='pausePlayOverlay \${playState} \${pausePlayOverlayActive:active}'>
    <div class='fullscreen material-icons \${limitOverlayControls:hide}'>\${fullscreenOverlay}</div>
    <div class='playPause material-icons'>%{pausePlayOverlay}</div>
    <div class='mute material-icons \${limitOverlayControls:hide}'>\${muteOverlay}</div>
</div>
<div class='stnEngage \${hideStnEngage:hideStnEngage} \${controlbarActive} \${stnEngageLocation}'>
    <div class='next \${hideNextButton:hideStnEngage}'>Next</div>
    <div class='stay \${hideStayButton:hideStnEngage}'>Stay</div>
</div>
<stn-social-share class='\${disableSocialShare:hide}'></stn-social-share>
<div class='contextMenu \${contextMenuActive:active}'>%{contextMenuHTML}</div>
<stn-control class='\${disableControlBar:hide} \${ui}'></stn-control>
<div class="spinner"></div>
`;var tf=`/* #stn1 stn2 and stn3 are used solely to increase the specificity of the rules */
body.stnFullscreen:not(#stn1):not(#stn2):not(#stn3)
{
    overflow: hidden !important;
    margin: 0 !important;
}
`;var nf=["fullscreenEnabled","fullscreenElement","requestFullscreen","exitFullscreen","fullscreenchange","fullscreenerror"],Ab=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],wb=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],Lb=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],Ib=[nf,Ab,wb,Lb].filter(r=>r[0]in document)[0]||[],on=Object.fromEntries(nf.map((r,e)=>[r,Ib[e]])),rf=!1,To=class{constructor(e){this.element=e}async requestFullscreen(){if(this.isFullscreen)return null;if(this.fullscreenEnabled){let e=this.element[on.requestFullscreen]();try{let t=await e;return!0}catch(t){return console.error("Error entering STN Player fullscreen",t),!1}}else return this.fallback==="fullWidth"?(Cb(this.element),this.element.dispatchEvent(new CustomEvent(this.fullscreenchange,{bubbles:!0})),!0):!1}async exitFullscreen(){if(!this.isFullscreen)return null;if(this.fullscreenEnabled)try{return await this.document[on.exitFullscreen](),!1}catch(e){return console.error("Error exiting STN Player fullscreen",e),!0}else return this.fallback==="fullWidth"?(Rb(this.element),this.element.dispatchEvent(new CustomEvent(this.fullscreenchange,{bubbles:!0})),!1):!0}addEventListener(e,t,n){return this.document.addEventListener(on[e],t,n)}removeEventListener(e,t,n){return this.document.removeEventListener(on[e],t,n)}get fullscreenEnabled(){return Boolean(this.document[on.fullscreenEnabled])}get fullscreenchange(){return this.fullscreenEnabled?on.fullscreenchange:"fullscreenchangefallback"}get fullscreenerror(){return this.fullscreenEnabled?on.fullscreenerror:"fullscreenerrorfallback"}get fullscreenElement(){return this.fullscreenEnabled?this.document[on.fullscreenElement]:this.isFullscreen?this.element:null}get isFullscreen(){return this.fullscreenEnabled?this.document[on.fullscreenElement]!==null:this.fallback==="fullWidth"?this.element.classList.contains("manualFullscreen"):!1}get isManualMode(){return this.fallback==="fullWidth"&&!this.fullscreenEnabled}set fallback(e){this.rawFallback=e}get fallback(){return this.rawFallback}get document(){return this.element.ownerDocument}};function Cb(r){rf||Pb(),kb(r),document.body.classList.add("stnFullscreen")}function Rb(r){Db(r),document.body.classList.remove("stnFullscreen")}function Pb(){let r=document.createElement("style");r.innerHTML=tf,document.head.appendChild(r),rf=!0}var sf=r=>r.preventDefault();function kb(r){r.addEventListener("touchmove",sf,!1)}function Db(r){r.removeEventListener("touchmove",sf,!1)}var z=oe(Symbol("StnMedia")),af=document.createElement("template");af.innerHTML=`<style>
${Jh}
${hs}</style>${ef}
`;var xb="stn-media",of=class extends ke{constructor(){super();let e=new class{constructor(){k(this,"adCompleted",null);k(this,"adPlaying",null);k(this,"cid",null);k(this,"companionAd",{});k(this,"contextMenuActive",!1);k(this,"contextMenuData",{});k(this,"controlbarActive",!1);k(this,"fullscreenFallback",!1);k(this,"hasEverStarted",!1);k(this,"hasStarted",!1);k(this,"hideControls",!1);k(this,"isFullscreen",!1);k(this,"isManualModeFullscreen",!1);k(this,"isMobile",!1);k(this,"liveStreamEnded",!1);k(this,"muteButtonEnabled",!1);k(this,"muted",!0);k(this,"next",{buttonClicked:!1});k(this,"pausePlayOverlayActiveCondition",!1);k(this,"pausePlayOverlayDisabled",!1);k(this,"paused",!0);k(this,"playStateUserInitiated",!1);k(this,"playerClicked",{value:!1});k(this,"pushDown",!1);k(this,"recircActive",!1);k(this,"socialSharingTrigger",!1);k(this,"stay",{buttonClicked:!1});k(this,"stnEngage",null);k(this,"touch",{start:{x:null,y:null},end:{x:null,y:null}});k(this,"ui",!1);k(this,"useLogoForPlay",!0);k(this,"volume",1);k(this,"width",null)}get pausePlayOverlayActive(){return!this.pausePlayOverlayDisabled&&!!this.pausePlayOverlayActiveCondition}get limitOverlayControls(){return!this.hideControls}get disableSocialShare(){return this.hideControls}get disableControlBar(){return this.hideControls}get playState(){return this.paused?"play":"pause"}get pausePlayOverlay(){let S=this.paused;return Hi?Qt:this.paused?Qt:"pause"}get muteOverlay(){return this.muted?"volume_off":"volume_up"}get fullscreenOverlay(){return this.isFullscreen?"fullscreen_exit":"fullscreen"}get hidePlayButton(){let S=this.paused,I=this.hasEverStarted;return!S||I}get hideStnIma(){let S=this.hasEverStarted,I;try{I=s.contentShouldPause}catch(N){return!0}return!S||!I}get isManualFullscreen(){let S=this.isFullscreen,I=this.isManualModeFullscreen;return S&&I}get ended(){let S=!!this.liveStreamEnded,I=!!i.badContent,N=!!i.ended,B=!!s.ended;return I||S||N&&B}get contentPaused(){let{paused:S}=e,{contentShouldPause:I}=s;return S||I}get adInfo(){if(!this.adPlaying)return"";let S=s.adPosition,I=s.totalAds,N=s.adLength-s.adCurrentTime;return`Ad ${S} of ${I} (${ji(N)})`}get hideMuteButton(){return this.hideControls||!this.muteButtonEnabled&&!this.recircActive}get hideCompanion(){return this.recircActive||(this.companionAd.content??"").length===0||this.companionAd.width>=this.width-32}get companionAdSrc(){return`
					<style>
						body
						{
							margin: 0;
						}
					</style>
					${this.companionAd.content??""}
				`}get companionAdWidth(){return this.companionAd.width??0}get companionAdHeight(){return this.companionAd.height??0}get contextMenuHTML(){return Object.keys(this.contextMenuData).reduce((S,I)=>{let N=this.contextMenuData[I];return`${S}<div><strong>${I}:</strong> ${N}</div>`},"")}get swipe(){let S=this.touch,I=20;if(S.end.x===null||S.end.y===null)return null;let N=S.end.x-S.start.x,B=S.end.y-S.start.y,A=null,M=null,$=0;return N<-1*I?A="left":N>I&&(A="right"),B<-1*I?M="up":B>I&&(M="down"),$=Math.sqrt(N*N+B*B),A===null&&M===null?null:{xDirection:A,yDirection:M,distance:$}}get hideStnEngage(){let S=this.stnEngage,{buttonClicked:I}=this.stay,{value:N}=this.playerClicked;if(!S?.enabled||I||N)return!0;let{currentTime:B,duration:A}=i,M=A<S.minVideoLength,$=B<=0,q=B<S.buttonShowDelay,Y=B>S.buttonShowDelay+S.countdown;return!S?.enabled||$||M||q||Y}get stnEngageLocation(){return this.stnEngage?.location??""}get hideStayButton(){return!(this.stnEngage?.hasStayButton??!1)}get hideNextButton(){return!(this.stnEngage?.hasNextButton??!1)}};ye(e),Object.freeze(e);let t=this.attachShadow({mode:Re?"open":"closed"}),n=$e(af.content.cloneNode(!0),e);t.append(...St(),n);let i=t.querySelector("stn-video-hlsjs"),s=t.querySelector("stn-ima"),a=t.querySelector("stn-control"),o=t.querySelector("stn-mute-button"),l=t.querySelector("stn-social-share"),c=t.querySelector("stn-play-button"),u=t.querySelector(".pausePlayOverlay"),d=t.querySelector(".companionAd .close"),h=t.querySelector(".stnEngage .next"),f=t.querySelector(".stnEngage .stay"),m=t.querySelector(".spinner");m.innerHTML=Zh,z(this,{contentPlayer:i,controlBar:a,model:e,muteButton:o,revenuePlayer:s,shadow:t,socialShare:l}),Object.freeze(this),t.addEventListener("contextmenu",j(S=>{S.target.closest(".contextMenu")||(S.preventDefault(),this.contextMenuActive=!this.contextMenuActive)})),this.addEventListener("touchstart",j(S=>{e.touch={start:{x:S.changedTouches[0].screenX,y:S.changedTouches[0].screenY},end:{x:null,y:null}}})),this.addEventListener("touchend",j(S=>{e.touch.end.x=S.changedTouches[0].screenX,e.touch.end.y=S.changedTouches[0].screenY})),x(()=>e.swipe,S=>{S&&this.isFullscreen&&S.yDirection==="down"&&(a.isFullscreen=!1)}),i.addEventListener("pointerdown",S=>{let I;L(()=>I=this.paused);let N=S.pointerType==="mouse",B=S.button===0;N&&!B||(I?this.userInitiatedPlay():N&&this.userInitiatedPause())}),t.querySelector(".pausePlayOverlay .playPause").addEventListener("click",S=>{L(()=>e.paused?this.userInitiatedPlay():this.userInitiatedPause())}),t.querySelector(".pausePlayOverlay .fullscreen").addEventListener("click",S=>{a.isFullscreen=!a.isFullscreen}),t.querySelector(".pausePlayOverlay .mute").addEventListener("click",S=>{L(()=>this.muted=!e.muted)}),o.addEventListener("click",()=>{ae.call(this,"UNMUTE_ICON")}),d.addEventListener("click",j(()=>{e.companionAd.content=""}));let y;function b(){y&&(clearTimeout(y),y=null)}h.addEventListener("click",j(()=>{b(),e.next={buttonClicked:!0},ae.call(this,"NEXT")})),f.addEventListener("click",j(()=>{b(),e.stay={buttonClicked:!0},ae.call(this,"STAY")})),P(()=>{i.browserPause!==null&&(i.browserPause?this.userInitiatedPause():this.userInitiatedPlay())}),P(()=>{s.browserPause!==null&&(s.browserPause?this.userInitiatedPause():this.userInitiatedPlay())}),P(()=>{s.started&&ae.call(this,"INV")}),x(()=>e.playerClicked,S=>{S.value&&b()}),x(()=>s.companionAd,S=>{e.companionAd=S}),x(()=>i.src,()=>{e.hasStarted=!1,e.companionAd.content=""}),x(()=>i.hasStarted||s.started,S=>{S&&(e.hasEverStarted=!0,e.hasStarted=!0,e.stay={buttonClicked:!1},e.playerClicked={value:!1})}),x(()=>i.hasStarted,S=>{S?ht.call(this,"contentStart"):ht.call(this,"contentEnded")}),x(()=>e.paused,S=>{ie&&console.log("Media Value: %o = %o","mediaPause",S),S?(s.pause(),ht.call(this,"pause")):(ae.call(this,"RTP"),ht.call(this,"RTP"),ae.call(this,"VIEWABLE_PLAYER_LOAD",{stnMedia:this,durationMeasured:2e3}),s.play(),ht.call(this,"play"))});{let S=!1;mn(a,null,null,(M,$)=>{S=!!$});let I,N=(M,$)=>{clearTimeout(I),L(()=>M=M&&(!e.recircActive||e.hideControls));let q;L(()=>q=e.isMobile);let Y;L(()=>Y=a.isMenuOpen),!(!q&&S)&&(I=setTimeout(j(()=>{a.active=!!M,l.mediaHovered=!!M,i.controlbarActive=!!M,e.controlbarActive=!!M,e.pausePlayOverlayActiveCondition=!!M&&!!q})(!M&&!$&&Y)?2e3:0))};u.addEventListener("click",M=>{L(()=>e.pausePlayOverlayActiveCondition=!1)});let B=null;x(()=>s.frame,()=>{B?.(),B=mn(s.frame,2e3,250,N)}),mn(this,2e3,250,N),x(()=>e.paused,M=>{a.playStateUserInitiated=e.playStateUserInitiated,a.paused=M},{fireImmediately:!0}),x(()=>a.paused,M=>{e.paused=M}),x(()=>a.playStateUserInitiated,M=>{e.playStateUserInitiated=M}),x(()=>e.muted,M=>{a.muted=M,o.muted=M,e.muteButtonEnabled&&!M&&(e.muteButtonEnabled=!1)},{fireImmediately:!0}),x(()=>a.muted,M=>{e.muted=M}),x(()=>o.muted,M=>{e.muted=M}),x(()=>e.volume,M=>{a.volume=M},{fireImmediately:!0}),x(()=>a.volume,M=>{e.volume=M}),x(()=>[s.adCurrentTime,s.adLength],([M,$])=>{a.adCurrentTime=M,a.adDuration=$},{fireImmediately:!0}),x(()=>[i.currentTime,i.duration],([M,$])=>{a.contentCurrentTime=M,a.contentDuration=$},{fireImmediately:!0}),x(()=>a.seekedTo,M=>{i.currentTime=M});let A=new To(this);P(()=>{let M=e.fullscreenFallback;A.fallback=M;let $;switch(M){case"fullWidth":$=!0;break;default:$=A.fullscreenEnabled;break}L(()=>a.fullscreenAllowed=!!$)}),P(()=>{e.isManualFullscreen?this.classList.add("manualFullscreen"):this.classList.remove("manualFullscreen")}),this.addEventListener(A.fullscreenchange,j(()=>{e.isFullscreen=A.isFullscreen,e.isManualModeFullscreen=A.isManualMode})),x(()=>e.isFullscreen,M=>{M!==null&&(a.isFullscreen=M,i.mediaIsFullscreen=M)},{fireImmediately:!0}),x(()=>a.isFullscreen,async M=>{L(()=>e.isFullscreen=null);let q=await(M?A.requestFullscreen():A.exitFullscreen());L(()=>e.isFullscreen=!!q)}),x(()=>e.socialSharingTrigger,M=>{a.socialSharingTrigger=M,l.socialSharingTrigger=M},{fireImmediately:!0}),x(()=>a.shareBtnClicked,M=>{l.controlbarClicked=!!M}),x(()=>a.selectedQuality,M=>{i.selectedQualityLevel=M},{fireImmediately:!0}),x(()=>i.qualityLevels,M=>{a.availableQualities=M},{fireImmediately:!0}),x(()=>i.activeQualityLevel,M=>{a.activeQuality=M},{fireImmediately:!0}),x(()=>a.selectedSubtitle,M=>{i.activeSubtitle=M},{fireImmediately:!0}),x(()=>i.subtitles,M=>{a.subtitles=M},{fireImmediately:!0}),x(()=>l.iconClicked,M=>{M&&(a.shareBtnClicked=!1)})}x(()=>l.lastSharedUrl,S=>{S&&ae.call(this,"SHARE",{share:S})}),x(()=>s.adCompleted,S=>{e.adCompleted=S}),x(()=>s.paused||!s.adPlaying,S=>{S?ht.call(this,"adPause"):ht.call(this,"adPlay")}),x(()=>s.adPlaying,S=>{e.adPlaying=S,S?(a.mode="ad",l.mode="ad",ht.call(this,"adStart",{adPosition:qe(s.adPosition),adLength:qe(s.adLength),adCuePoints:qe(s.adCuePoints)})):(a.mode="content",l.mode="content",ht.call(this,"adEnded"))}),x(()=>e.contentPaused,S=>{ie&&console.log("Media Value: %o = %o","contentPaused",S),S?i.pause():i.play()}),x(()=>i.playPromise,async S=>{try{await S,ae.call(this,"PLAY")}catch(I){}}),x(()=>i.qualityLevelRemoved,S=>ae.call(this,"LEVEL_LOAD_ERROR",{removedLevel:S})),x(()=>i.currentTime,S=>s.contentCurrentTime=S);let E=()=>{m.style.display="block",i.classList.add("spinner-active"),s.classList.add("spinner-active")},C=()=>{m.style.display="none",i.classList.remove("spinner-active"),s.classList.remove("spinner-active")},w;x(()=>i.waiting||s.waiting,S=>{S?w=setTimeout(E,500):(clearTimeout(w),C())},{fireImmediately:!0}),x(()=>i.ended,S=>{S&&this.pause(),s.contentEnded=S}),x(()=>s.impression,S=>{ae.call(this,"AD_IMPRESSION",Object.assign(qe(S),{cid:e.cid}))}),x(()=>s.adQuartile,S=>{if(S!==0){let I=s.adIndex;ae.call(this,"AD_QUARTILE",{quartile:S,adIndex:I})}}),x(()=>i.quartile,S=>{S&&ae.call(this,"QUARTILE",{quartile:S})}),x(()=>s.dv,S=>{S?ae.call(this,"DV",qe(S)):ae.call(this,"resetDV")}),x(()=>s.openvv,S=>{S?ae.call(this,"OPENVV",qe(S)):ae.call(this,"resetOpenVV")});let O=L(()=>s.impression);x(()=>[s.allAdsCompleted,s.impression],([S,I])=>{let N=s.adIndex,B=s.adCuePoints.length>0,{isClientAdRequest:A}=O;B&&!(O!==I)&&S&&ae.call(this,"NO_AD_IMPRESSION",{adIndex:N,isClientAdRequest:A}),S&&(O=I)}),x(()=>e.muted,S=>{i.muted=!!S,s.muted=!!S}),x(()=>e.volume,S=>{i.volume=S,s.volume=S}),x(()=>[e.volume,e.muted],([S,I])=>{ht.call(this,"volumeChange",{volume:S,muted:I})}),x(()=>[e.stnEngage,i.duration,e.stay],([S,I,N])=>{if(!S?.enabled){s.removeMidrolls=!1;return}let B=N.buttonClicked,{minVideoLength:A,stayClickMidrollBehaviour:M}=S,$=S?.enabled,q=isNaN(I),Y=$&&(!B||M==="remove")&&I>=A;s.removeMidrolls=q?null:Y}),x(()=>e.hideStnEngage,S=>{let{countdown:I,hasNextButton:N,hasStayButton:B}=e.stnEngage;S||(y=setTimeout(j(()=>{e.next={buttonClicked:!1}}),I*1e3)),f.classList.toggle("progress",!S&&!N&&B),h.classList.toggle("progress",!S&&N)}),x(()=>e.useLogoForPlay,S=>{a.useLogoForPlay=c.useLogoForPlay=S},{fireImmediately:!0})}get hasEverStarted(){return z(this).model.hasEverStarted}set cid(e){L(()=>z(this).model.cid=e)}get muted(){return z(this).model.muted}set muted(e){L(()=>z(this).model.muted=!!e)}get volume(){return z(this).model.volume}set volume(e){if(e=parseFloat(e),isNaN(e))throw new Error("Volume is not a number");if(e<0)throw new Error("Volume is less than 0");if(e>1)throw new Error("Volume is more than 1");L(()=>z(this).model.volume=e)}set content(e){let t=z(this);t.contentPlayer.src=e,ae.call(this,"resetPlay"),ht.call(this,"resetAdStart"),this.liveStreamEnded=!1}get content(){return z(this).contentPlayer.src}get contentPlayer(){return z(this).contentPlayer}get revenuePlayer(){return z(this).revenuePlayer}set ad(e){z(this).revenuePlayer.src=e}get ad(){return z(this).revenuePlayer.src}get ended(){return z(this).model.ended}get paused(){return z(this).model.paused}get playStateUserInitiated(){return z(this).model.playStateUserInitiated}play(){L(()=>{z(this).model.playStateUserInitiated=!1,z(this).model.paused=!1})}pause(){L(()=>{z(this).model.playStateUserInitiated=!1,z(this).model.paused=!0})}userInitiatedPlay(){L(()=>{z(this).model.playStateUserInitiated=!0,z(this).model.paused=!1})}userInitiatedPause(){L(()=>{z(this).model.playStateUserInitiated=!0,z(this).model.paused=!0})}get poster(){return z(this).contentPlayer.poster}set poster(e){z(this).contentPlayer.poster=e}get contentPaused(){return this.contentPlayer.paused}get contentCurrentTime(){return z(this).contentPlayer.currentTime}set contentCurrentTime(e){z(this).contentPlayer.currentTime=e}get adCompleted(){return z(this).model.adCompleted}get adPlaying(){return z(this).model.adPlaying}get companionAdShowing(){return!!z(this).model.companionAd.content}get adCurrentTime(){return z(this).revenuePlayer.adCurrentTime}get adPosition(){return z(this).revenuePlayer.adPosition}get adLength(){return z(this).revenuePlayer.adLength}get adCuePoints(){return z(this).revenuePlayer.adCuePoints}set liveStreamEnded(e){L(()=>z(this).model.liveStreamEnded=!!e)}get played(){return z(this).contentPlayer.played}set pageGestureTarget(e){z(this).contentPlayer.pageGestureTarget=e,z(this).revenuePlayer.pageGestureTarget=e}get hasStarted(){return z(this).model.hasStarted}set socialSharingTrigger(e){L(()=>{z(this).model.socialSharingTrigger=e})}get socialShare(){return z(this).socialShare}set fullscreenFallback(e){L(()=>{z(this).model.fullscreenFallback=e})}set isMobile(e){L(()=>{z(this).model.isMobile=e})}end(){L(()=>{let{revenuePlayer:e,contentPlayer:t}=z(this);e.stop(),t.endClip()})}set muteButtonEnabled(e){L(()=>{z(this).model.muteButtonEnabled=!!e})}set recircActive(e){L(()=>{z(this).model.recircActive=!!e})}get isFullscreen(){return z(this).model.isFullscreen}get currentTime(){let e=this.revenuePlayer.adPlaying,t=this.adCurrentTime,n=this.contentCurrentTime;return e?t:n}get duration(){let e=this.revenuePlayer.adPlaying,t=this.revenuePlayer.adLength,n=this.contentPlayer.duration;return e?t:n}set controlsOverlay(e){let{model:t}=z(this);t.pausePlayOverlayDisabled=!e}set controls(e){let{contentPlayer:t,model:n}=z(this);n.hideControls=!e,t.subtitlesDisabled=!e}set width(e){let{model:t}=z(this);t.width=e}set ui(e){let{model:t}=z(this);L(()=>{t.ui=e})}set pushDown(e){let{model:t}=z(this);L(()=>{t.pushDown=e})}set contextMenuData(e){let{model:t}=z(this);L(()=>{t.contextMenuData=e})}set contextMenuActive(e){let{model:t}=z(this);L(()=>{t.contextMenuActive=!!e})}get contextMenuActive(){let{model:e}=z(this);return e.contextMenuActive}get controlBar(){let{controlBar:e}=z(this);return e}set stnEngage(e){let{model:t}=z(this);L(()=>{t.stnEngage=e})}get next(){let{model:e}=z(this);return e.next}set playerClicked(e){let{model:t}=z(this);L(()=>{t.playerClicked=e})}get stayClickChange(){let{model:e}=z(this);return e.stay}set useLogoForPlay(e){z(this).model.useLogoForPlay=e}};customElements.define(xb,of);for(let r of["pointerdown","touchstart","touchend","pointerup","click"])document.addEventListener(r,e=>{if(e.target.tagName==="STN-PLAYER")for(let t of["preventDefault","stopPropagation","stopImmediatePropagation"])e[t]=()=>console.log("Cancelled call to %o on event %o bound for STN-PLAYER",t+"()",r)},{capture:!0});var ve,_f=document.createElement("template");_f.innerHTML=`<style>
${zc}</style>
${Yc}`;var Af=!1,li;_l({enforceActions:"always",computedRequiresReaction:!0,reactionRequiresObservable:!0,observableRequiresReaction:!0,isolateGlobalState:!0});var wf=document.createElement("script");wf.src="//js-sec.indexww.com/ht/p/187621-164323601241456.js";document.head.appendChild(wf);var gf=`#recircContent
{
    position: absolute;
    top: 0;
    height: 100%;
    width: 100%;
    text-decoration: none;
    cursor: pointer;
}

#recircContent #pillOverlay
{
    background: #F8B024;
    border-radius: 30px;
    color: #FFF;
    font-weight: bold;
    padding: 0.1em 1.5ch;
    position: absolute;

    /* Bottom centre */
    bottom: calc(0.25em + 5px);
    left: 50%;
    transform: translateX(-50%);
}

#recircContent #graphicOverlay
{
    height: 1.7em;
    position: absolute;

    /* Bottom Centre */
    bottom: 0.15em;
    left: 50%;
    transform: translateX(-50%);
}

.player.floating.miniActive #recircContent
{
    top: 0;
    right: calc(100% - var(--mediaWidth));
    color: white;
    padding: 1.5em 1.5em 10% 10%;
    width: auto;
    height: auto;
}
`;var vf=`<a id='recircContent' target='_blank'>
    <div style='display: none;' id='externalLink' class='material-icons'>launch</div>
    <div style='display: none;' id='pillOverlay'>READ MORE</div>
    <img style='display: none;' id='graphicOverlay'>
</a>
`;var ci=class extends ke{constructor(){let e=ci.config,t={backendHost:"https://embed.sendtonews.com/",backendPath:"/player4/data_read.php",backendParam:{}},n=[],i=window;for(;i;)n.push(...i.document.querySelectorAll('script[type="application/s2n+json"]')),i!==i.parent&&Object.getOwnPropertyNames(i.parent).includes("document")?i=i.parent:i=null;if(n.length){n.length>1&&console.warn("Multiple configuration objects for S2N Player. Only one will be used.");try{Object.assign(t,JSON.parse(n[0]?.textContent||"{}"))}catch(A){console.error("S2N Player configuration object error: %o",A.message)}}Object.setPrototypeOf(t,e);let s=Object.getPrototypeOf(e);window.addEventListener("unload",()=>{s.model=null}),s.model||(s.model={lastVisible:[],onLoadPushed:!1,onScrollPushed:!1,isFullscreen:[],viewportWidth:null,viewportHeight:null},ye(s.model),ie&&Object.keys(s.model).forEach(A=>{P(()=>{let M=Array.from(s.model[A]||[]).map($=>$.playerKey);console.log("Video Value: %o = %o",`global.${A}`,M)})})),super(),typeof WeakRef=="undefined"?s.allPlayers.push(this):s.allPlayers.push(new WeakRef(this));let a={},o=new ra(this),l=null,c=null,u=null,d=null,h={},f=null,m=null,p;do p=Yt(16);while(!p.match(/^[A-Za-z]/));ve(this,{config:t,classId:p,features:a,model:o,embedScriptTag:l,usrID:c,liveInterval:u,apiEnabled:d,api:h,divTag:f,mediagroup:m});let g=this.attachShadow({mode:Re?"open":"closed"}),T=$e(_f.content.cloneNode(!0),o);P(()=>ve(this).usrID=o.usrID),P(()=>{ve(this).pageMeta=Object.fromEntries(Object.getOwnPropertyNames(o.pageMeta).map(A=>[A,o.pageMeta[A]]))}),P(()=>ve(this).embedScriptTag=o.embedScriptTag),P(()=>ve(this).apiEnabled=o.apiEnabled),P(()=>ve(this).divTag=o.divTag),ve(this).originConfig=s,Q(()=>o.optimera,()=>{Qs()});let _;P(()=>{let A=o.divTag;clearInterval(_),A&&o.removeTagAttributes&&(_=setInterval(()=>{getComputedStyle(A).display==="none"&&(clearInterval(_),A.className=A.className.replace(/\bs2nPlayer-?\w*(?: k-\w+)?/g,"").replace("  "," "),delete A.dataset.stnPlayer)},2e3))});let y=new wr(o),b=new Cr(o);js.call(this,y),js.call(g,y),Hs.call(this,b),Hs.call(g,b),fc.call(this),x(()=>o.api?.floatApi?.float,A=>{y.API(Jt({api:"float",float:{float:JSON.stringify(A)}}))});let E=new na(o),C=()=>!Er(o.feed)&&o.playlistData;Q(C,()=>{o.playerStatus=new Rr(o)}),g.append(Jl(o,"stn-player"),...St(),T),document.addEventListener("visibilitychange",j(()=>{o.pageHidden=document.hidden})),Q(()=>o.frameBreak&&this.divTag,()=>{let A=this.divTag.ownerDocument.defaultView.frameElement,M=!!(Re&&A?.classList.contains("aut-iframe"));!A||M||(A.style.setProperty("visibility","hidden","important"),A.style.setProperty("position","fixed","important"),A.style.setProperty("border","0","important"),A.style.setProperty("top","0","important"),A.style.setProperty("left","-100vw","important"),A.style.setProperty("width","1px","important"),A.style.setProperty("height","1px","important"),A.insertAdjacentElement("beforebegin",this.divTag))}),Q(()=>o.hasSpotXPrebid,()=>Promise.resolve().then(()=>Ys())),Q(()=>o.resonateEnabled,async()=>{let M=await(await Promise.resolve().then(()=>lf())).resonateAnalytics;await Q(()=>o.rawCurrentItem);let $={};L(()=>{$={"Publisher Site":this.divTag.ownerDocument.location.host,Level1:o.rawCurrentItem.level1,Level2:o.rawCurrentItem.level2,Level3:o.rawCurrentItem.level3}}),M.track("Video Play",$)}),Q(()=>o.hasAmazonPrebid,async()=>{let M=await(await Promise.resolve().then(()=>Zs())).apstag;Q(()=>o.schain.asi&&o.schain.sid,()=>{Af||(Af=!0,M.init({pubID:"6c3f03cd-6fa8-4477-ac05-2c0f4f8da092",videoAdServer:"DFP",isSelfServePub:!0,deals:!0,schain:{ver:"1.0",complete:1,nodes:[{asi:o.schain?.asi,sid:o.schain?.sid,hp:1}]}}))})}),(async()=>{let A;try{A=(await Di).VERSION}catch(M){A=null}L(()=>o.imaVersion=A)})(),x(()=>[o.playerKey,o.altPlaylistKey,o.configurableDataReadEndpoint],([A,M,$])=>{let q=o.primaryDataread,Y=o.altDataread,W=o.configurablePrimaryDataread,K=o.configurableAltDataread,ue=!!$,fe=o.ignoreConfigurableDataReadEndpoint;if(A&&!q&&vs.call(this,A),M&&!Y&&vs.call(this,M,!0),ue&&A&&!W)if(fe){o.configurablePrimaryDataread=!0;let{fetchURL:de}=_o.call(this,A,$);(async()=>{try{let De=await(await fetch(de)).json(),Me=Lf.call(this,A,De,$);Me&&fetch(Me.fetchURL).catch(()=>{})}catch(Se){}})()}else vs.call(this,A,!1,$);if(ue&&M&&!K)if(fe){o.configurableAltDataread=!0;let{fetchURL:de}=_o.call(this,M,$);fetch(de).catch(()=>{})}else vs.call(this,M,!0,$)}),P(()=>{let A=o.embedMutationObserver,M=o.mutationObserverControl;if(!!A)switch(M){case"disabled":A.disconnect(),L(()=>o.embedMutationObserver=null);break;case"enabled":default:break}});let w=A=>{if(this.querySelector(`div[slot="${A}"]`))return;let $=document.createElement("div");$.slot=A,$.textContent=o.wrapperText;let q=document.createElement("style");q.textContent=`
				stn-player.${p} div[slot="${A}"]
				{
					${o.wrapperCSS}
				}
			`,this.appendChild(q),this.appendChild($)};Q(()=>o.floatWrapperEnabled,()=>{w("floatHeader"),N()}),Q(()=>o.fixedWrapperEnabled,()=>{w("header"),S()}),x(()=>[o.aiMetaCapture,o.feedCID,o.playerKey],([A,M,$])=>{A&&!isNaN(M)&&$&&Hc(M,$)}),this.addEventListener("click",()=>o.userEngagedPlayer());{let A=g.querySelector(".player"),M=g.querySelector(".stnError");window.ResizeObserver&&new ResizeObserver(q=>{let{contentRect:Y}=q.pop();Xt(j(()=>o.measuredPlayerWidth=Y.left+Y.right))}).observe(A);let $=g.querySelector(".playlistWrapper");x(()=>[o.isNewUI,o.isBarker,o.scrollbar],async([q,Y,W])=>{if((!q||Y)&&!W){let K=await ki($);L(()=>o.scrollbar=K)}else q&&!Y&&W&&(o.scrollbar.destroy(),L(()=>o.scrollbar=null))})}{let A=g.querySelector(".player > .titleBar"),M=A.getBoundingClientRect(),$=j(()=>{let q=A.classList.contains("onHover");o.isTitleBarVisible=!q&&M.width>0&&M.height>0});window.ResizeObserver&&new ResizeObserver(q=>{M=q.pop().contentRect,Xt($)}).observe(A),$()}{let A=g.querySelector(".floatContainer .titleBar"),M=j(()=>{let $=A.getBoundingClientRect();o.isFloatTitleBarVisible=$.width>0&&$.height>0});window.ResizeObserver&&new ResizeObserver($=>{let{contentRect:q}=$.pop();Xt(M)}).observe(A),M()}let O=!1,S=()=>{if(O)return;let A=this.querySelector('div[slot="header"]');window.ResizeObserver&&A?(new ResizeObserver(M=>{let{contentRect:$}=M.pop();Xt(j(()=>o.isHeaderVisible=$.width>0&&$.height>0))}).observe(A),O=!0):L(()=>o.isHeaderVisible=!1)};S();let I=!1,N=()=>{if(I)return;let A=this.querySelector('div[slot="floatHeader"]');window.ResizeObserver&&A?(new ResizeObserver(M=>{let{contentRect:$}=M.pop();Xt(j(()=>o.isFloatHeaderVisible=$.width>0&&$.height>0))}).observe(A),I=!0):L(()=>o.isFloatHeaderVisible=!1)};N();{let A=this.querySelector('div[slot="footer"]');window.ResizeObserver&&A?new ResizeObserver(M=>{let{contentRect:$}=M.pop();Xt(j(()=>o.isFooterVisible=$.width>0&&$.height>0))}).observe(A):L(()=>o.isFooterVisible=!1)}{let A=g.querySelector(".mediaGroupContainer"),M=new IntersectionObserver(j($=>{o.mediaGroupContainerVisibilityRatio=$.pop().intersectionRatio}),{threshold:[...Array(21)].map(($,q,Y)=>q/(Y.length-1))});Q(()=>o.playerShow,()=>{let $=A.getBoundingClientRect();o.mediagroupContainerPxFromTopOfPage=$.top+le.scrollY}),window.ResizeObserver&&new ResizeObserver($=>{let{contentRect:q}=$.pop();Xt(j(()=>{let Y=q.left+q.right;o.mediagroupContainerWidth=Y,o.mediagroupContainerHeight=Y*9/16}))}).observe(A),Q(C,async()=>{try{await qb.call(this)}finally{M.observe(A),Q(()=>!Er(o.currentItem),()=>{o.adTag=new Nr(o,A)})}})}customElements.whenDefined("stn-media").then(()=>{let A=ve(this).mediagroup=g.querySelector("stn-media");L(()=>o.mediagroupSet=!0),g.addEventListener("contextmenu",j(G=>{G.target!==A&&(G.preventDefault(),A.contextMenuActive=!A.contextMenuActive)})),P(()=>A.cid=o.feedCID),P(()=>A.revenuePlayer.insecureVpaid=o.insecureVpaid),P(()=>A.revenuePlayer.dvLogging=o.dvLogging),P(()=>A.revenuePlayer.playerModelOpenvv=o.openvv),P(()=>A.revenuePlayer.preventImaRefreshOfGpt=o.preventImaRefreshOfGpt);let M=g.querySelector("stn-play-button");x(()=>o.useLogoForPlay,G=>A.useLogoForPlay=M.useLogoForPlay=G,{fireImmediately:!0});let $=g.querySelector(".floatContainer"),q=g.querySelector(".floatClose"),Y=g.querySelector(".floatMaximize"),W=g.querySelector(".menuButton");Q(()=>A.hasEverStarted,()=>o.hasEverStarted=!0),q.addEventListener("click",G=>{G.stopPropagation(),o.userClosedFloat()}),Y.addEventListener("click",G=>{G.stopPropagation(),o.userMaximizedFloat()}),W.addEventListener("click",j(G=>{A.paused?A.userInitiatedPlay():A.userInitiatedPause()})),new ResizeObserver(G=>{let{contentRect:ne}=G.pop();Xt(j(()=>{let ce=ne.left+ne.right;o.playerMediaWidth=ce,A.width=ce}))}).observe(A);let K,ue,fe,de=()=>{K&&K(),ue&&ue(),fe&&fe(),E.load(),K=x(()=>A.contentPaused,G=>{G?E.contentPause({ended:A.ended}):E.contentPlay({content_id:o.currentItem.C_ID,currentTime:A.contentCurrentTime})}),ue=x(()=>A.adCompleted,G=>{G?E.adFinish({currentTime:A.contentCurrentTime}):E.adStart({adPosition:A.adPosition,adLength:A.adLength,adCuePoints:A.adCuePoints})}),fe=x(()=>A.adPlaying,G=>{G?E.adPlay({currentTime:A.adCurrentTime}):E.adPause()})};x(()=>o.playlist,G=>{if(G.length===0){o.error="Unable to load the playlist, please click to retry.";let ce=g.querySelector(".stnError"),we=j(()=>{ce.removeEventListener("click",we),o.error=null,o.resetLoadFail(),o.selectedPlaylistItem={idx:0}});ce.addEventListener("click",we)}}),x(()=>o.currentItem,async G=>{await Q(()=>o.adTag),await Q(()=>E.model.lib!==void 0),de();let ne=ve(this);if(clearInterval(ne.liveInterval),A.poster=G.poster,G.liveFeed){let _n=Kb.call(this,G,A);if(_n){G.content=_n,A.content=G,A.ad=!1,L(()=>o.allowSubtitles=!1);return}}if(!G.content){L(()=>o.allowSubtitles=!1);return}let ce;L(()=>ce=o.adTag);let we=ce.newParams();if(!we){A.content=G,A.ad=!1,L(()=>o.allowSubtitles=!0),ae.call(this,"IMA",{hasAdParams:we});return}let Fe=!1,et=!1,Dt=G.content;try{await Di,A.ad=ce}catch(_n){let Yi=G.content;Fe=!0,A.ad=!1,Dt=Wb(o,Yi),et=Yi!==Dt}finally{G.content=Dt,A.content=G,ae.call(this,"IMA",{hasAdParams:we,adBlocked:Fe,areAdsRecovered:et}),L(()=>o.allowSubtitles=!et)}}),P(()=>{let G=o.allowSubtitles,ne=o.dataReadSubtitles;A.contentPlayer.subtitles=G?ne:[]}),x(()=>A.contentPlayer.badContent,G=>{if(o.badContent=G,G){let{S_ID:ne}=o.currentItem;ae.call(this,"BAD_CONTENT_ERROR",{S_ID:ne})}}),x(()=>A.next,G=>{let{buttonClicked:ne}=G;o.nextSelectedPlaylistItem({force:!0,userInitiated:ne})}),P(()=>{A.playerClicked=o.playerClicked});let Se=0;x(()=>A.ended,G=>{G&&(Se++,A.pause(),o.nextSelectedPlaylistItem())}),P(()=>{o.pageHidden||(Se=0)}),Q(()=>A.hasEverStarted,()=>{x(()=>[o.isMediaGroupFloating,o.isPlayOnView,o.isMediaGroupContainerVisible,o.pageHidden,o.videosToPlayWhilePageHidden,A.ended,A.hasStarted,o.isFullscreen],([ne,ce,we,Fe,et,Dt,_n,Yi])=>{let Cf=!A.paused,Lo=ne||we||Yi;if(et>=0&&Fe){if(ce&&!Lo&&!Cf||Se>et)return}else if(ce&&!Lo)return;_n||setTimeout(()=>A.play())});let G=!1;x(()=>[o.pageHidden,o.pauseWhenPageHiddenSkipNext,o.pauseWhenPageHiddenStatic],([ne,ce,we])=>{let Fe=!A.paused;!we&&!ce||(ne?Fe&&(G=!0,A.pause()):G&&(ce&&A.end(),G=!1,A.play()))})});let De=!1;x(()=>A.paused,G=>{G||(De=!1)}),x(()=>[o.isMediaGroupContainerVisible,o.floatClosed,o.floatCloseBehaviour],([G,ne,ce],[we,Fe])=>{let et=ne&&ne!==Fe,Dt=G&&G!==we;switch(ce){case"resume":et&&(A.pause(),De=!0),Dt&&De&&A.play();break;case"pause":et&&(A.pause(),De=!0);break;case"continue":default:break}}),x(()=>A.adPlaying,G=>{o.adActive=G});let Me={AD_ACTIVE:"AD",CONTENT_PLAYING:"PL",CONTENT_PAUSED:"PA"};x(()=>o.floatClosed,G=>{if(!G)return;let ne;A.adPlaying?ne=Me.AD_ACTIVE:A.contentPaused?ne=Me.CONTENT_PAUSED:ne=Me.CONTENT_PLAYING,ae.call(this,"CLOSE",{reason:ne})}),x(()=>A.hasStarted,G=>{o.hasStarted=G}),x(()=>[A.paused,A.playStateUserInitiated],([G,ne])=>{(ne||!G)&&(o.paused=G)},{fireImmediately:!0}),x(()=>A.muted,G=>{o.muted=!!G},{fireImmediately:!0}),x(()=>A.volume,G=>{o.volume=G},{fireImmediately:!0}),x(()=>A.isFullscreen,G=>{o.isFullscreen=G}),x(()=>[A.currentTime,A.duration,o.isMediaGroupFloating&&o.isMiniFloatActive],([G,ne,ce])=>{if(ce){let we=!G||!ne?0:100*(G/ne);$.style.borderImage=`linear-gradient(to right, var(--timeElapsedColorMini) ${we}%, var(--timeRemainingColorMini) ${we}%) 2`}else $.style.borderImage=""}),x(()=>o.isMiniFloatActive,G=>{A.controls=!G}),P(()=>{A.fullscreenFallback=o.fullscreenFallback}),P(()=>{A.socialSharingTrigger=o.socialSharingTrigger}),P(()=>{A.muteButtonEnabled=o.muteIcon}),P(()=>{A.isMobile=o.isMobile}),P(()=>{A.contentPlayer.initialQuality=o.initialQuality}),P(()=>{A.ui=o.ui}),P(()=>{A.pushDown=o.titleBarDisplayMode==="onHover"}),P(()=>{let G=o.usrID,ne=_t.key,ce={"Player Version":At(),"Player Key":o.playerKey,"Configured as Smart Player":o.configuredAsSmartPlayer,"Playlist Type":o.playlistType,"Float Mode":o.float,Sess:`${G}~${ne}`};A.contextMenuData=ce}),P(()=>{A.controlBar.hideSTNLink=o.hideSTNLink});let je=g.querySelector(".player > .titleBar");mn(this,2e3,null,(G,ne)=>{je.classList.toggle("hovered",G)}),P(()=>{A.socialShare.shareURL=o.pageMeta.smartMatchLocation}),Q(()=>o.isAmp,async()=>{let G=window.ampApi;if(!G)return;let ne=await Promise.resolve().then(()=>uf());this.features.amp=new ne.Amp(G,o,A)}),Q(()=>o.isLoopingPlaylist,async()=>{let G=await Promise.resolve().then(()=>hf());this.features.loopPlaylist=new G.LoopPlaylist(o,A)}),Q(()=>o.hasEngagementLogging,async()=>{let G=await Promise.resolve().then(()=>ff());this.features.engagementLogger=new G.EngagementLogger(o,A)}),Q(()=>!o.isClickToPlay,async()=>{let G;switch(L(()=>G=o.delayPlayStart),G){case"onScroll":await Q(()=>o.hasScrolled);break;case"disabled":default:break}let ne=await Promise.resolve().then(()=>pf());this.features.playbackMode=new ne.PlaybackMode(o,A)}),P(()=>A.muted=o.muted),x(()=>A.muted,G=>{o.muted=G}),P(()=>A.volume=o.volume),x(()=>A.volume,G=>{o.volume=G}),P(()=>A.stnEngage=o.stnEngage),x(()=>A.stayClickChange,G=>{let ne=G.buttonClicked,ce=o.isMiniFloatActive;if(ne&&ce){let et=this.getBoundingClientRect().top+le.scrollY-(this.divTag.ownerDocument.documentElement.clientHeight-this.offsetHeight)/2;le.scrollTo({top:et,behavior:"smooth"})}}),Q(()=>o.hasEverStarted&&o.isCurrentContentRecirc,async()=>{let G=await Promise.resolve().then(()=>Tf());this.features.recircContent=new G.RecircContent(o,A)}),Q(()=>o.disablePageGesture!==void 0,()=>A.pageGestureTarget=o.disablePageGesture?new EventTarget:ci.config.pageGestureTarget);let at=g.querySelector(".playlist");at.addEventListener("click",G=>{let ne=G.target.closest(".item");if(!ne)return;let ce=parseInt(ne.dataset.item,10),we;L(()=>we=o.selectedPlaylistItem.idx);let Fe=ce===we;Fe||(o.userSelectedPlaylistItem={idx:ce}),A.pause(),Q(()=>!A.hasStarted||Fe,()=>{setTimeout(()=>A.userInitiatedPlay())})});let ui=g.querySelector(".playlistChevron.left"),If=g.querySelector(".playlistChevron.right"),wo=()=>{let G=at.querySelector(".item"),ne=parseFloat(getComputedStyle(G).marginRight),ce=parseFloat(getComputedStyle(G).marginLeft);return(G.offsetWidth+ne+ce)*2};ui.addEventListener("click",()=>{at.scrollBy({left:-1*wo(),behavior:"smooth"})}),If.addEventListener("click",()=>{at.scrollBy({left:wo(),behavior:"smooth"})}),g.querySelector(".overlay").addEventListener("click",G=>{A.userInitiatedPlay()}),L(()=>o.shareIconCount=A.socialShare.shareIconCount),Q(()=>o.enableCatapultX,()=>{if(!li){let G=()=>A.contentPlayer.shadowSelector("cx-overlay")?.setAttribute("cx-wait","false"),ne=()=>A.contentPlayer.shadowSelector("cx-overlay")?.setAttribute("cx-wait","true");x(()=>A.adPlaying||A.companionAdShowing,ce=>{ce?ne():G()},{fireImmediately:!0}),li=[],ft.then(ce=>{let we=ce.document,Fe=we.createElement("script");Fe.src="https://tags.qortex.ai/bootstrapper",we.head.append(Fe),Fe.addEventListener("load",()=>{Object.defineProperty(ce,"CXBootstrapper",{set:et=>{delete ce.CXBootstrapper,ce.CXBootstrapper=et,li.push=Dt=>Dt(ce.CXBootstrapper),li.splice(0).forEach(Dt=>{try{li.push(Dt)}catch(_n){console.error(_n)}})},configurable:!0})},{once:!0})})}li.push(G=>{Q(()=>o.feedCID,()=>{let ne=`stn-${o.feedCID}`;new G(ne).initCX({videoDescriptors:[{videoElement:A.contentPlayer.videoElement}]})})})})});let B=Object.keys(this);for(let A of["divTag","playerKey","embedScriptTag","embedMutationObserver"])if(B.includes(A)){let M=this[A];delete this[A],this[A]=M}zb.call(this)}disconnectedCallback(){let e=ve(this),t=e.model;L(()=>{e.originConfig.model.lastVisible=e.originConfig.model.lastVisible.filter(n=>n!==t)})}connectedCallback(){let e=ve(this),t=e.model;if(this.classList.add(e.classId),this.isConnected){this.append(...St()),Q(()=>!Er(t.feed)&&t.playlistData||t.error,()=>{this.style.display="",t.playerShow=!0});let i=document.createElement("div");i.setAttribute("slot","imaHost");let s=document.createElement("div");i.append(s),this.append(i)}}get features(){return ve(this).features}get playerKey(){return ve(this).model.playerKey}set playerKey(e){let t=ve(this).model;L(()=>t.playerKey=e)}get divTag(){return ve(this).model.divTag}set divTag(e){let t=ve(this).model;e.id||(e.id=Yb()),L(()=>t.divTag=e)}get embedScriptTag(){return ve(this).embedScriptTag}set embedScriptTag(e){let t=ve(this).model;L(()=>t.embedScriptTag=e)}set embedMutationObserver(e){let t=ve(this).model;L(()=>t.embedMutationObserver=e)}get usrID(){return ve(this).usrID}get playerStatus(){return ve(this).model.playerStatus}get api(){let e=ve(this);return e.apiEnabled?e.api:null}};function vs(r,e=!1,t=null){let n=ve(this).model;Xb.call(this,r,e,t).then(()=>L(()=>n.error=null)).catch(i=>{e||L(()=>n.error=i),ae.call(this,"GETERR",{reason:"uncaught",isAltPlaylist:e,useConfigurablePlaylist:!!t}),console.error(i)})}async function Xb(r,e=!1,t=null){if(!r)return;let n=ve(this),i=!!t;await Q(()=>n.model.embedScriptTag);let{datareadURL:s,fetchURL:a}=_o.call(this,r,t);ae.call(this,"PRE_INIT");let o=await fetch(a).catch(d=>{throw ae.call(this,"GETERR",{reason:"adblock",isAltPlaylist:e,useConfigurablePlaylist:i}),`An ad blocker has likely prevented this video content from loading.
Please disable your ad blocker to view the video content.`}),l;try{l=await o.json()}catch(d){throw ae.call(this,"GETERR",{reason:"invalid json",isAltPlaylist:e,useConfigurablePlaylist:i}),"Could not load player data. Please try again later."}function c(d){for(let[h,f]of Object.entries(d))if(!!f)switch(typeof f){case"string":{d[h]=f.replace(/^(http:)?\/\//,"https://");break}case"object":{c(f);break}}}c(l);let u=Qb.call(this,l,e,i);if(u)throw u;if(e)i?L(()=>n.model.configurableAltDataread=Ao(l)):L(()=>n.model.altDataread=l);else{let d=Lf.call(this,r,l,t);d&&fetch(d.fetchURL).catch(()=>{}),i?L(()=>n.model.configurablePrimaryDataread=Ao(l)):(L(()=>n.model.primaryDataread=l),ae.call(this,"GET"))}}function Wb(r,e){let t;switch(L(()=>t=r.adRecovery),t){default:case"SSAI":return Jb(r,e);case"NONE":return e}}function Jb(r,e){let t,n;if(L(()=>t=r.adTag),!t||!e.endsWith(".m3u8"))return e;let i="https://165e347693a540c184a4827b405dba07.mediatailor.us-east-1.amazonaws.com/v1/master/08ac7296b74aba263f61ed5f9103ae30c77400e9/dai_m3u8/",s="https://d29xw9s9x32j3w.cloudfront.net/videos/m3u8/";L(()=>n=t.paramsEncoded);let a=ie?"aws.logMode=DEBUG&":"";return e=e.replace(s,i)+`?${a}ads.query=${n}`,e}function Kb({liveFeed:r,SM_ID:e},t){let n=ve(this);if(n.liveInterval)return;let i=new Date,s,a;L(()=>s=r.startTime),L(()=>a=r.endTime);let o=Tr(s),l=Tr(a),c=(o-i)/1e3,u=(l-i)/1e3,d=60/5,h=-1,f=async()=>{let g=new Date;if(u=(l-g)/1e3,u<=0){clearInterval(n.liveInterval),t.liveStreamEnded=!0;return}if(h=++h%d,h===0)try{let _=await(await fetch(`https://player.sendtonews.com/player4/update.php?q=liveFeed&sm_id=${e}`)).json();l=Tr(_.endDate||null)}catch(T){console.error(T)}},m=c<=0,p=u<=0;if(m&&!p){n.liveInterval=setInterval(f,5e3),t.liveStreamEnded=!1,f();let g;return L(()=>g=r.sources.src),g}return null}function Qb(r,e,t){let n=ve(this),i=t,s=!n.model.useConfigurablePlaylistCustomSource(r),a=!1,o=!1;if(i||s){let c=r?.playlistData?.[0]?.error||r?.playlistData?.[0]?.[0]?.error;a=c?{msg:c,details:"Error message came from the backend"}:r.playlistData?r.playlistData?.length!==2?{msg:"Playlist is Unavailable",details:"playlistData doesn't have 2 indices"}:r.playlistData[0][0]?!1:{msg:"Playlist is Empty",details:"Playlist is empty"}:{msg:"Playlist is Unavailable",details:"playlistData object is missing"}}return i||(o=r.feed.error),o?ae.call(this,"GETERR",{reason:"feed",isAltPlaylist:e,msg:o,useConfigurablePlaylist:t}):a&&ae.call(this,"GETERR",{reason:"playlist",isAltPlaylist:e,msg:a.msg,details:a.details,useConfigurablePlaylist:t}),[{type:"Feed Error",msg:o},{type:"Playlist Error",msg:a.msg}].filter(c=>!!c.msg).map(c=>`${c.type}: ${c.msg}`).join(`

`)}function Ef(r,e){let t=null,n=new Promise((i,s)=>{t=setTimeout(()=>s("stnPromiseTimedOut"),r)});return Promise.race([n,e.then(i=>(clearTimeout(t),i))])}var yt,gs=class{constructor(e){yt(this,{model:e,modelApi:null});let i=yt(this);this.reset(),P(()=>i.modelApi=e.api.floatApi),Object.freeze(this),P(()=>i.float=i.modelApi.float),P(()=>i.verticalTranslate=i.modelApi.verticalTranslate),P(()=>i.horizontalTranslate=i.modelApi.horizontalTranslate),P(()=>i.position=i.modelApi.position)}get float(){return yt(this).float}set float(e){let t=yt(this);L(()=>t.modelApi.float=e)}get verticalTranslate(){return yt(this).verticalTranslate}set verticalTranslate(e){let t=yt(this);if(typeof e!="number"){console.error("Invalid value set for float API");return}L(()=>t.modelApi.verticalTranslate=e)}get horizontalTranslate(){return yt(this).horizontalTranslate}set horizontalTranslate(e){let t=yt(this);if(typeof e!="number"){console.error("Invalid value set for float API");return}L(()=>t.modelApi.horizontalTranslate=e)}get position(){return yt(this).position}set position(e){let t=yt(this);!jb(e)||L(()=>t.modelApi.position=e)}reset(){let e=yt(this);L(()=>e.model.api.floatApi={})}};function jb(r){if(typeof r!="string")return console.error("Invalid value set for float API"),!1;let[e,t]=r.split(" ");switch(e){case"top":case"bottom":case"middle":break;default:return console.error("Invalid value set for float API"),!1}switch(t){case"left":case"right":case"middle":break;default:return console.error("Invalid value set for float API"),!1}return!0}yt=oe(gs);async function qb(){let r=ve(this);if(!r.apiEnabled)return;let e=await Promise.resolve().then(()=>Sf());r.api=new e.Api(r.model);let t=r.divTag.getAttribute("data-stn-api")??r.divTag.getAttribute("data-s2n-api");if(!t){this.api.lockConfigurationDelay();return}let n=Zb(t);if(!n){console.warn(`API callback ${t} not found.`),this.api.lockConfigurationDelay();return}return n(i=>r.divTag!==i?null:this.api),this.api.lockConfigurationDelay(),await this.api.configurationDelay}function Zb(r){let e=window;for(;e;){let t=e[r];if(typeof t=="function")return t;if(e===e.parent)return null;e=e.parent}}async function zb(){if(!ie)return;let r=ve(this);await Q(()=>r.model.mediagroupSet);let e;L(()=>e=this.playerKey),le.stnPlayersOnPage||(le.stnPlayersOnPage={mobx:{action:j,autorun:P,getUnObserved:Sr,reaction:x,runInAction:L,toJS:qe,when:Q},players:{}}),le.stnPlayersOnPage.players[e]||(le.stnPlayersOnPage.players[e]=[]),le.stnPlayersOnPage.players[e].push({key:e,media:r.mediagroup,player:this,playerModel:r.model})}function Yb(){let r,e,t;do r=Yt(16),e=r.match(/^[A-Za-z]/),t=document.getElementById(r);while(!e||t);return r}function _o(r,e=null){let t=ve(this),n=!!e,i=new URL(t.config.backendPath,this.embedScriptTag?.host||t.config.backendHost).href,s=n?e:i,a=r.split("-"),o=a.length===3?r:null,l={cmd:"loadInitial",session:_t.key,instance:t.usrID,version:At(),age:Ri(),ESG_key:a.length<=2?a[0]:null,PL_key:a.length===2?a[1]:null,SC:o,type:o?"SINGLE":"FULL",EXTREF:t.pageMeta.smartMatchLocation,REF:t.pageMeta.href,ogSet:t.pageMeta.ogSet?"1":"0",recache:t.divTag.getAttribute("data-recache")};Object.assign(l,t.config.backendParam);let c=`${s}?${wt(l)}`;return{datareadURL:s,dataReadParams:l,fetchURL:c}}function Lf(r,e,t=null){let n=ve(this),i=!!t,s=new URL(n.config.backendPath,this.embedScriptTag?.host||n.config.backendHost).href,a=i?t:s;if("UMSE_urlHash"in(e.pageMetaData??{})&&!("UMPD_titleHash"in(e.pageMetaData??{}))){let o={cmd:"readPageMeta",ESG_key:r,session:_t.key,instance:n.usrID,version:At(),age:Ri(),EXTREF:n.pageMeta.smartMatchLocation,REF:n.pageMeta.href,UMSE_urlHash:e.pageMetaData?.UMSE_urlHash,UMPD_title:n.pageMeta.title,UMPD_keywords:n.pageMeta.keywords,UMPD_description:n.pageMeta.description,UMPD_revised:n.pageMeta.revised,UMPD_published:n.pageMeta.published,smVersion:i?2:null},l=`${a}?${wt(o)}`;return{datareadURL:a,smartMatchPassBackParam:o,fetchURL:l}}return!1}function Ao(r){let e;try{e=JSON.parse(r)}catch(t){e=r}if(typeof e=="object"&&e!==null)for(let t in e)e[t]=Ao(e[t]);return e}ve=oe(ci);export{ci as StnPlayer};
