"use strict";Kobo.Gizmo.Carousel=function(){var n,e,a,o,t,s,r,c,l,d,u,f,b=this,g="carousel-tab-navigation-target",h="."+g;b.setDefaults({slidesToShow:6}),Kobo.Gizmo.apply(b,arguments),b.setType("Carousel"),o=function(){var o,t=window.DynamicConfiguration.resourceStrings.previous,i=window.DynamicConfiguration.resourceStrings.next;n=b.$el.find(".carousel"),o=n.find(".cover-image[data-lazy]"),n.on("init setPosition",function(){e=n.find(".next"),a=n.find(".previous"),o.on("load",s),c(),l(),r()}),n.slick({accessibility:!1,infinite:!1,waitForAnimate:!1,respondTo:"min",lazyload:"ondemand",slidesToShow:b.settings.slidesToShow,slidesToScroll:b.settings.slidesToShow,prevArrow:'<button type="button" class="previous" aria-label="'+t+'"></button>',nextArrow:'<button type="button" class="next" aria-label="'+i+'"></button>',responsive:[{breakpoint:810,settings:{slidesToShow:4,slidesToScroll:4}},{breakpoint:670,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:410,settings:{slidesToShow:2,slidesToScroll:2}}]})},t=function(){var o;o="endofcarousel-"+b.guid,b.$el.find(".skip-carousel").attr("href","#"+o),b.$el.find(".skip-carousel-target").attr("id",o);function t(){var o=d();o.find(".cta-container a, .cta-container button").addClass(g),o.find(h).attr("tabindex",-1),u().find(h).attr("tabindex",0)}t();function i(){function o(t){13===t.which&&n.on("afterChange.keyboardFocus",function(){n.off("afterChange.keyboardFocus");var o=Kobo.$(t.target);f(o)&&t.data.$focusTargetWhenNavArrowDisabled.focus()})}e.on("keypress",null,{$focusTargetWhenNavArrowDisabled:b.$el.find(h).last()},o),a.on("keypress",null,{$focusTargetWhenNavArrowDisabled:b.$el.find(h).first()},o)}i();n.on("init",function(){t(),i()}),n.on("afterChange",t)},s=function(o){"data"!==o.target.src.substring(0,4)&&Kobo.$(this).parents(".image-container").removeClass("lazy")},r=function(){var o=Kobo._tracker.getTrackAttribute();a.attr(o,'{"Description": "Previous"}'),e.attr(o,'{"Description": "Next"}')},c=function(){var n,o=d(),i=0,e=0;o.each(function(){var o=Kobo.$(this),t=o.find(".book-details").outerHeight(!0)||0,o=o.find(".cta-container:visible").outerHeight(!0)||0;i=Math.max(i,t),e=Math.max(e,o)}),n=i+e,o.each(function(){var o=Kobo.$(this),t=o.find(".book-details").outerHeight(!0)||0,i=o.find(".cta-container:visible").outerHeight(!0)||0,i=n-t-i;o.find(".book-details-container").length?o.find(".book-details-container").css("padding-bottom",i):o.css({paddingTop:1+i,top:-i})})},l=function(){var o=n.find(".book-details").outerHeight(!0)/2;e.css("margin-bottom",o),a.css("margin-bottom",o)},d=function(){return n.find(".item-container")},u=f=function(o){return o.hasClass("slick-disabled")},),b.destroy=function(){n.slick("unslick")}},Kobo.Gizmo.Carousel.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Kobo.Gizmo.LightweightCarousel=function(e,t){Kobo.Gizmo.apply(this,arguments),this.setType("LightweightCarousel");var r,o,n,i,a,s=Kobo.$.extend({isNavigationButtonsEnabled:!1,navButtonScrollSpeed:400},t),c=Kobo.$(e),l=".button-container",u=".navigation-button-container",f=".vertical-buffer, .cta-vertical-buffer",b=c.find(".next"),d=c.find(".previous"),p=c.find(".item-container"),y=c.find(".carousel-items"),h=!1,g=6,v=y.find("a, button"),m=c.find(".primary-heading").text().trim(),w=null,A=null;function K(e){var t=e.closest(l),r=e.closest(u),e=r.find(f),r=r.height(),o=0;e.each(function(){o+=$(this).outerHeight(!0)});r-=o;t.css("height",r+"px")}b.on("keypress click",function(e){O(e,E)}),d.on("keypress click",function(e){O(e,S)}),x(),r=Kobo.Utilities.Events.debounce(x,50),y.on("scroll",r),o=Kobo.Utilities.Events.debounce(x,200),Kobo.$window.on("resize",o),s.isNavigationButtonsEnabled&&!1===Modernizr.flexbox&&(K(d),K(b)),i=y[0],w=new IntersectionObserver(function(e,t){[].slice.call(e).forEach(function(e){e.isIntersecting&&.9<e.intersectionRatio?(e.target.setAttribute("aria-hidden",!1),e.target.setAttribute("tabindex",0)):(e.target.setAttribute("aria-hidden",!0),e.target.setAttribute("tabindex",-1))})},_objectSpread(_objectSpread({},{rootMargin:"0px",threshold:.9}),{},{root:i})),A=new IntersectionObserver(function(e,t){e.forEach(function(e){var t;e.isIntersecting&&.8<=e.intersectionRatio&&(a=Date.now(),t=e.target,setTimeout(function(){var e;2e3<=Date.now()-a&&(e=new CustomEvent("impression",{bubbles:!0,detail:{event:"impression",carouselName:m}}),t.dispatchEvent(e))},2e3))})},{threshold:.8}),v.toArray().forEach(function(e){w.observe(e)}),A.observe(y[0]),s.isAutoMarginsEnabled&&(k(),n=Kobo.Utilities.Events.debounce(k,200),Kobo.$window.on("resize",n)),this.destroy=function(){b.off("click",E),d.off("click",S),y.off("scroll",r),Kobo.$window.off("resize",o),Kobo.$window.off("resize",n),v.toArray().forEach(function(e){w.unobserve(e)}),A.unobserve(y[0])};var O=function(e,t){"click"!==e.type&&("keypress"!==e.type||e.keyCode!=Kobo.KeyCodes.RETURN&&e.keyCode!=Kobo.KeyCodes.SPACE)||t()};function E(){_("next")}function S(){_("previous")}function _(e){if(!h){var t=j();if(t.length){var r,o=t.length,t=t.eq(0),t=p.index(t);if("next"===e)r=Math.min(t+o,p.length-1);else{if("previous"!==e)throw new Error("Invalid scroll direction: "+e);r=Math.max(t-o,0)}!function(e,r){h=!0;e=e.position().left+e.outerWidth(!0)-e.width();y.animate({scrollLeft:y.scrollLeft()+e-g},{duration:s.navButtonScrollSpeed,always:function(){var e,t;h=!1,c.trigger("carouselScrollComplete"),e=r,t=_toConsumableArray(Kobo.Utilities.findAllFocusableElements(y)).filter(function(e){return"false"===e.ariaHidden&&e.classList.contains("carousel-tab-navigation-target")}),"next"===e?t[0].focus():"previous"===e&&t[t.length-1].focus()}})}(p.eq(r),e)}}}function j(){var e=p.toArray().filter(function(e){return e.querySelector("a[aria-hidden=false]")});return $(e)}function x(){var e=0<y.scrollLeft();d.prop("disabled",!e);e=y.scrollLeft()+y.innerWidth()<y[0].scrollWidth;b.prop("disabled",!e)}function k(){y.scrollLeft(0);var e=p.slice(1);e.css("marginLeft","");var t,r,o=j();o.length&&(t=o.eq(o.length-1),(r=p.index(t)+1)>=p.length?x():(r=p.eq(r),r=y.width()-r.position().left,o=o.length-1,o=t.outerWidth(!0)-t.width()+Math.ceil(r/o),e.css("marginLeft",o+"px")))}},Kobo.Gizmo.LightweightCarousel.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.Collapsible=function(){var e,l,o,s,i,t,n,c,a=this;a.setDefaults({isOpen:!1,name:"",ignoreExternalCloseRequests:!1}),Kobo.Gizmo.apply(a,arguments),c=a.currentBreakpoint(),l=function(){var e="object"===Kobo.typeOf(a.settings.isOpen)?Kobo.Object.parseBool(a.settings.isOpen[a.currentBreakpoint()]):Kobo.Object.parseBool(a.settings.isOpen);return e},o=s=function(e,l){if(l.detail&&l.detail.name===a.settings.name)switch(e.type){case"collapsible::isOpen":l.detail.callback&&l.detail.callback(a.isOpen());break;case"collapsible::toggle":a.toggle();break;case"collapsible::open":a.open();break;case"collapsible::close":a.close();break;case"collapsible::reset":a.reset()}},i=function(e,l){l.detail&&l.detail.name!==a.settings.name&&!a.settings.ignoreExternalCloseRequests&&a.close()},t=Kobo.Utilities.Events.debounce(function(){var e=a.currentBreakpoint();c!==e&&(c=e,Kobo._mediator.fire("collapsible::reset",{name:a.settings.name}))}),a.isOpen=a.toggle=a.open=function(){e.open()},a.close=function(){e.close()},a.reset=function(){o()},n=function(){a.register("collapsible::isOpen"),a.register("collapsible::toggle"),a.register("collapsible::open"),a.register("collapsible::close"),a.register("collapsible::reset"),a.subscribe("collapsible::isOpen collapsible::toggle collapsible::open collapsible::close collapsible::reset",s),a.register("collapsible::closeAllOther"),a.subscribe("collapsible::closeAllOther",i),Kobo.$window.on("resize",t)},a.destroy=function(){a.unSubscribe("collapsible::isOpen",s),a.unSubscribe("collapsible::toggle",s),a.unSubscribe("collapsible::open",s),a.unSubscribe("collapsible::close",s),a.unSubscribe("collapsible::reset",s),a.unSubscribe("collapsible::closeAllOther",i),Kobo.$window.off("resize",t)},function(){if(!a.settings.name)throw new Error("Collapsible requires a name!");e=new Collapsible(a.$el),o(),n(),Kobo._mediator.fire("collapsible::loaded")}()},Kobo.Gizmo.Collapsible.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.Collapsible.HasHeader=function(){var o,e,t,n,i,l,a,s,r,c,p,m,b,f,g=this;Kobo.Gizmo.Collapsible.apply(this,arguments),o=function(o){o.stopPropagation(),Kobo._mediator.fire("collapsible::toggle",{name:g.options.name}),Kobo._mediator.fire("collapsible::isOpen",{name:g.options.name,callback:c}),!0===g.options.closeOtherCollapsibles&&Kobo._mediator.fire("collapsible::isOpen",{name:g.options.name,callback:p}),!0===g.options.closeOnClickAnywhere&&Kobo._mediator.fire("collapsible::isOpen",{name:g.options.name,callback:s}),!0===g.options.setButtonTextToInternalItemText&&g.options.internalElementClass&&o.srcElement.className===g.options.internalElementClass&&m.text(o.srcElement.text)},n=function(){Kobo._mediator.fire("collapsible::close",{name:g.options.name}),r(!1),g.options.toggleButtonText&&e(),Kobo.$body.off("click",n)},i=function(){m.trigger("blur")},l=function(){m.on("click",o),m.on("mouseup",i)},a=function(){f.on("click",o)},s=c=function(o){r(o),g.options.toggleButtonText&&e()},r=function(o){o?m.attr("aria-expanded",!0):m.attr("aria-expanded",!1)},e=function(){var e;t=t||m.text(),Kobo._mediator.fire("collapsible::isOpen",{name:g.options.name,callback:function(o){e=o}}),e?m.text(DynamicConfiguration.resourceStrings[g.settings.toggleButtonText]):m.text(t)},p=function(o){o&&Kobo._mediator.fire("collapsible::closeAllOther",{name:g.options.name})},function(){if(!g.options.toggleClass)throw new Error("Collapsible.HasHeader requires a toggle!");if(!(m=g.$el.find("."+g.options.toggleClass)).attr("aria-controls"))throw new Error("Accessibility constraints violated: toggle must specify aria-controls ("+g.settings.name+")");if(m.attr("aria-expanded",!1),b=g.$el.find("#"+m.attr("aria-controls")),l(),!0===g.options.internalClickIsToggle){if(!g.options.internalElementClass)throw new Error("Internal element class must be specified ("+g.settings.name+")");f=b.find("."+g.options.internalElementClass),a()}}()},Kobo.Gizmo.Collapsible.HasHeader.prototype=Kobo.chainPrototype(Kobo.Gizmo.Collapsible.prototype);
"use strict";Kobo.Gizmo.Collapsible.IsList=function(){var o=this;Kobo.Gizmo.Collapsible.HasHeader.apply(this,arguments),function(){if(!o.options.toggleClass)throw new Error("Collapsible.HasHeader requires a toggle!");if(!o.$el.children("."+o.options.toggleClass).attr("aria-controls"))throw new Error("Accessibility constraints violated: toggle must specify aria-controls ("+o.settings.name+")");if(!o.options.internalElementClass)throw new Error("Internal element class must be specified ("+o.settings.name+")")}()},Kobo.Gizmo.Collapsible.IsList.prototype=Kobo.chainPrototype(Kobo.Gizmo.Collapsible.HasHeader.prototype);
"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Kobo.Gizmo.Collapsible.ActionMenu=function(){var o=this;Kobo.Gizmo.Collapsible.HasHeader.apply(this,arguments);var n=13,i=27,l=38,c=40,s=9,t=32,e=o.options,a=e.name,u=e.toggleClass,d=e.actionMenuId;o.collapsibleIsOpen=!1,o.toggleButton=null,o.actionItems=null,o.focusedActionItemIndex=null,this.getCollapsibleState=function(){return new Promise(},this.toggleCollapsibleState=function(){return o.getCollapsibleState().then(},this.handleToggleEvent=function(e,t){t.detail.name===a&&o.toggleCollapsibleState()},this.handleToggleButtonClick=function(){o.toggleCollapsibleState()},this.handleToggleButtonKeyDown=function(e){e.keyCode!==n&&e.keyCode!==t||(Kobo._mediator.fire("collapsible::closeAllOther",{name:a}),o.toggleCollapsibleState().then()},this.deactivateToggle=function(e,t){t.detail.name===a&&o.toggleButton.removeClass("activated")},this.deactivateToggleIfNotNamed=function(e,t){t.detail.name!==a&&o.toggleButton.removeClass("activated")},this.shiftFocusToFirstAction=function(){Kobo.Utilities.waitForElementToBeVisible("#".concat(o.options.actionMenuId," .action"),function(){o.focusedActionItemIndex=0,o.actionItems[o.focusedActionItemIndex].focus()},25)},this.shiftFocusToNextAction=function(e){e.preventDefault(),o.focusedActionItemIndex++,o.focusedActionItemIndex>=o.actionItems.length&&(o.focusedActionItemIndex=0),o.actionItems[o.focusedActionItemIndex].focus()},this.shiftFocusToPreviousAction=function(e){e.preventDefault(),o.focusedActionItemIndex--,o.focusedActionItemIndex<0&&(o.focusedActionItemIndex=o.actionItems.length-1),o.actionItems[o.focusedActionItemIndex].focus()},this.handleActionItemKeyDown=function(e){var t=(_defineProperty(t={},l,o.shiftFocusToPreviousAction),_defineProperty(t,c,o.shiftFocusToNextAction),_defineProperty(t,n,o.simulateActivatedActionState),_defineProperty(t,s,o.handleActionItemFocusOut),_defineProperty(t,i,o.handleEscapeFromActionMenu),t);if(t[e.keyCode])return t[e.keyCode](e)},this.handleEscapeFromActionMenu=function(){o.focusedActionItemIndex=null,Kobo._mediator.fire("collapsible::close",{name:a}),o.toggleButton.focus()},this.handleActionItemFocusOut=function(){o.focusedActionItemIndex=null,Kobo._mediator.fire("collapsible::close",{name:a})},this.simulateActivatedActionState=function(e){e.preventDefault();var t=e.target;t.classList.add("activated"),setTimeout(25)},this.setupEvents=function(){o.toggleButton.on("click",o.handleToggleButtonClick),o.toggleButton.on("keydown",o.handleToggleButtonKeyDown),o.actionItems.on("keydown",o.handleActionItemKeyDown),Kobo._mediator.subscribe("collapsible::toggle",o.handleToggleEvent),Kobo._mediator.subscribe("collapsible::close",o.deactivateToggle),Kobo._mediator.subscribe("collapsible::closeAllOther",o.deactivateToggleIfNotNamed)},this.init=function(){if(!u||!d)throw new Error("Missing required options.");if(o.toggleButton=o.$el.find(".".concat(o.options.toggleClass)),o.actionItems=o.$el.find("#".concat(o.options.actionMenuId," .action")),!o.toggleButton.length||!o.actionItems.length)throw new Error("Could not find toggle button or action items.");o.setupEvents()},o.init()},Kobo.Gizmo.Collapsible.ActionMenu.prototype=Kobo.chainPrototype(Kobo.Gizmo.Collapsible.HasHeader.prototype);
"use strict";Kobo.Gizmo.RippleContainer=function(o,i){Kobo.Gizmo.apply(this,arguments);var t=i.rippleClassName;this.init=this.init()},Kobo.Gizmo.RippleContainer.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ScrollingList=function(e,i){var t=this;t.defaults=t.defaults||{ListViewModelClassName:"List",ItemViewModelClassName:"Item",navViewModel:"Paging.Dynamic",animationMixin:"HorizontalScrollAnimation",scrollOnMouseWheel:!1,navigationOptions:{}},t.settings=Kobo.extend({},i),Kobo.Gizmo.apply(this,arguments),t.expandable=null,t.currentItemViewModel=ko.observable(),t.setType("ScrollingList"),t.viewModels={listViewModel:"",navViewModel:""},t.element=e,t.elementList=Kobo.$(e).find(".list")[0],t.elementNav=Kobo.$(e).find(".nav")[0],t.QuickViewEnabled=t.settings.QuickView&&(!0===t.settings.QuickView||"true"===t.settings.QuickView.toLowerCase()),t.gizmoEvents={onclick:function(e){t.viewModels.listViewModel.isActivated()||t.QuickViewEnabled&&t.viewModels.listViewModel.isActivated(!0),t.viewModels.listViewModel.onclick(e)},onmousewheel:function(e){var i=t.viewModels.navViewModel;Math.max(-1,Math.min(1,e.originalEvent.wheelDelta||-e.originalEvent.detail))<=0?i.existsNextPage()&&(e.preventDefault(),t.viewModels.navViewModel.showNext()):i.existsPreviousPage()&&(e.preventDefault(),t.viewModels.navViewModel.showPrevious())}},function(){t.unhide(),t.instantiateViewModels(),t.setupLinkBetweenNavigationAndMainViewModel(t.elementList),t.QuickViewEnabled&&(t.setupQuickView(),t.subscribeToCurrentItemViewModel()),t.setupEvents(),t.addBottomWhiteBorderIfFirstOfMultipleCarousel(),t.loadPages(2)}()},Kobo.Gizmo.ScrollingList.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype),Kobo.Gizmo.ScrollingList.prototype.addBottomWhiteBorderIfFirstOfMultipleCarousel=function(){var i=this;i.subscribe("gizmosInitialized",function(){var e=i.$gizmo.parent();i.shouldAddBorder(e)&&e.addClass("white-border-bottom")})},Kobo.Gizmo.ScrollingList.prototype.shouldAddBorder=function(e){return!e.isEmptyObject&&("CarouselWidget"===e.data("kobo-widget")&&"CarouselWidget"===e.next().data("kobo-widget")&&!e.hasClass("white-border-bottom"))},Kobo.Gizmo.ScrollingList.prototype.instantiateViewModels=function(){var e,i,t;if(this.elementNav&&((i=Kobo.Object.resolveKoboNamespace("ViewModel.Navigation."+this.settings.navViewModel))?this.viewModels.navViewModel=new i(this.elementNav,Kobo.extend({},{pages:[],totalNumberOfItems:this.settings.totalNumberOfItems,useCircularScroll:this.settings.useCircularScroll},this.settings.navigationOptions)):this.error("instantiateViewModels","ScrollingList",this,"Cannot instantiate NavViewModel as [ViewModel.Navigation."+this.settings.navViewModel+"]")),e=Kobo.Object.resolveKoboNamespace("ViewModel."+this.settings.ItemViewModelClassName),this.viewModels.ItemViewModelClass)throw t="Cannot resolve ItemViewModelClassName as [Kobo.ViewModel."+this.settings.ItemViewModelClassName+"]",this.error("instantiateViewModels","ScrollingList",this,t),new Error("[Kobo.Gizmo.ScrollingList.instantiateViewModels] "+t);if((i=this.settings).ItemViewModelClass=e,i.fetchUrl=this.settings.url,!(e=Kobo.Object.resolveKoboNamespace("ViewModel."+this.settings.ListViewModelClassName)))throw t="Cannot instantiate listViewModel as [ViewModel."+this.settings.ListViewModelClassName+"]",this.error("instantiateViewModels","ScrollingList",this,t),new Error("[Kobo.Gizmo.ScrollingList.instantiateViewModels] "+t);this.viewModels.listViewModel=new e(this.elementList,i,this)},Kobo.Gizmo.ScrollingList.prototype.setupQuickView=function(){var o=this;o.subscribe("gizmosInitialized",function(){if(null===o.expandable){var e,i,t=o.descendants.length;if(0<t)for(i=0;i<t;i+=1)"Class.Gizmo.Expandable"===(e=o.descendants[i]).type&&(o.expandable=e);else o.expandable=!1}})},Kobo.Gizmo.ScrollingList.prototype.loadPages=function(e){var i,t=this;t.settings.Prefetch&&"null"!==t.settings.Prefetch?t.settings.Prefetch.length&&(i=t.settings.Prefetch,t.viewModels.listViewModel.addNewItems(i)):this.viewModels.listViewModel.fetchData({startingIndex:0,endIndex:9})},Kobo.Gizmo.ScrollingList.prototype.subscribeToCurrentItemViewModel=function(){var i=this;i.viewModels.listViewModel.currentItemViewModel&&i.viewModels.listViewModel.currentItemViewModel.subscribe(},Kobo.Gizmo.ScrollingList.prototype.setupLinkBetweenNavigationAndMainViewModel=function(e){var i=this.viewModels.navViewModel,t=this.viewModels.listViewModel;i&&i.navObject&&(Kobo.subscribeObservablesFromTo(i.navObject.read,t,null,!0),Kobo.subscribeObservablesFromTo(t,i.navObject.write,{scrollPositionIndexCorrected:"scrollPositionIndexCorrected",numberOfItemsToDisplayPerPage:"pageSize",totalNumberOfItems:"totalNumberOfItems",totalPages:"numberOfAvailPages"},!0))},Kobo.Gizmo.ScrollingList.prototype.setupEvents=function(){var e=this;e.$el.find(".ul-container").on("click","[data-purchaseUrl], .book-item-image-container, .book-title",e.gizmoEvents.onclick),e.$el.find(".ul-container").on("mouseover",e.gizmoEvents.onmouseover),e.$el.find(".ul-container").on("mouseout",e.gizmoEvents.onmouseout),e.$el.find(".quick-view-content").on("click","[data-purchaseUrl]",e.gizmoEvents.onclick),e.settings.scrollOnMouseWheel&&(e.$el.on("mousewheel",e.gizmoEvents.onmousewheel),e.$el.on("DOMMouseScroll",e.gizmoEvents.onmousewheel))},Kobo.Gizmo.ScrollingList.prototype.unhide=
"use strict";Kobo.Gizmo.ScrollingList.MarkupOnly=function(i,e){var o=this;o.defaults={ListViewModelClassName:"FitListToContainer",navViewModel:"Paging.Static",animationMixin:"VerticalScrollAnimation",defaultHeight:"400px",scrollOnMouseWheel:!1},Kobo.Gizmo.ScrollingList.apply(this,arguments),o.viewModels.listViewModel.isActivated(!0),o.viewModels.navViewModel.isActivated(!0),Kobo._gizmo.register("pageChanged"),Kobo._gizmo.subscribe("pageChanged",function(){o.viewModels.listViewModel.items.find("a").attr("tabindex","-1").attr("aria-hidden","true");var i=o.viewModels.navViewModel.currentPage(),e=o.viewModels.navViewModel.pageSize();o.viewModels.listViewModel.items.slice(i*e-e,i*e).find("a").attr("tabindex","0").attr("aria-hidden","false")}),Kobo._gizmo.fire("pageChanged")},Kobo.Gizmo.ScrollingList.MarkupOnly.prototype=Kobo.chainPrototype(Kobo.Gizmo.ScrollingList.prototype),Kobo.Gizmo.ScrollingList.MarkupOnly.prototype.loadPages=function(i){};
"use strict";Kobo.Gizmo.MagazinePrintedSubscription=function(e,s){var r=this;Kobo.Gizmo.apply(this,arguments),r.setType("MagazinePrintedSubscription"),r.settings=Kobo.extend({},s),r.GENERIC_SUCCESS_MESSAGE=DynamicConfiguration.resourceStrings.SubscriptionNumberSubmitted,r.GENERIC_ERROR_MESSAGE=DynamicConfiguration.resourceStrings.GenericErrorMessage,r.SYSTEM_ERROR_RESULT="Error",r.SUBSCRIPTION_CODE_ERROR_RESULT="Failure",r.SUCCESS_RESULT="Success",r.$inputSubscriptionNumber=r.$gizmo.find(".printed-subscription-number-input"),r.$submitButton=r.$gizmo.find(".printed-subscription-input-button"),r.$messageLarge=r.$gizmo.find(".printed-subscription-message-large"),r.$messageSmall=r.$gizmo.find(".printed-subscription-message-small"),r.submitPrintedSubscriptionNumber=function(){var e=r.$inputSubscriptionNumber?r.$inputSubscriptionNumber.val():"",s=r.settings.publicationId;Kobo.Ajax({url:"/Magazine/AuthorizePrintSubscription?publicationId="+s+"&subscriptionNumber="+e,success:function(e){r.handleResponse(e)},fail:)},r.handleResponse=function(e){if(e&&e.Result)switch(e.Result.toString()){case r.SUCCESS_RESULT:r.showInfoMessage(e.Message);break;case r.SUBSCRIPTION_CODE_ERROR_RESULT:r.showErrorMessage(e.Message);break;case r.SYSTEM_ERROR_RESULT:r.showSystemErrorMessage(e.Message);break;default:r.showSystemErrorMessage(r.GENERIC_ERROR_MESSAGE)}else r.showSystemErrorMessage(r.GENERIC_ERROR_MESSAGE)},r.hideMessages=function(){r.$messageLarge.addClass("hide-printed-subscription-message"),r.$messageSmall.addClass("hide-printed-subscription-message"),r.$inputSubscriptionNumber.removeClass("printed-subscription-number-input-error"),r.adjustContentHeight()},r.showErrorMessage=function(e){e=e&&""!=e?e:r.GENERIC_ERROR_MESSAGE,r.$messageLarge.text(e),r.$messageLarge.removeClass("hide-printed-subscription-message"),r.$messageLarge.addClass("error-message-left-arrow"),r.$messageSmall.text(e),r.$messageSmall.removeClass("hide-printed-subscription-message"),r.$messageSmall.addClass("error-message-top-arrow"),r.$inputSubscriptionNumber.addClass("printed-subscription-number-input-error"),r.adjustContentHeight()},r.showSystemErrorMessage=function(e){e=e&&""!=e?e:r.GENERIC_ERROR_MESSAGE,r.showErrorMessage(e),r.$inputSubscriptionNumber.val("")},r.showInfoMessage=function(e){e=e&&""!=e?e:r.GENERIC_SUCCESS_MESSAGE,r.$messageLarge.text(e),r.$messageLarge.removeClass("hide-printed-subscription-message"),r.$messageLarge.removeClass("error-message-left-arrow"),r.$messageLarge.addClass("info-message-left-arrow"),r.$messageSmall.text(e),r.$messageSmall.removeClass("hide-printed-subscription-message"),r.$messageSmall.removeClass("error-message-top-arrow"),r.$messageSmall.addClass("info-message-top-arrow"),r.$inputSubscriptionNumber.removeClass("printed-subscription-number-input-error"),r.adjustContentHeight()},r.adjustContentHeight=function(){var e,s=Kobo._mediator.determineBreakpoint();"small"!==s&&"medium"!==s||(e=r.$gizmo.find(".kobo-widget.magazineitem-printed-subscription.kobo-gizmo.gizmo-expandable .gizmo-expandable-inner-masker"),s=r.$gizmo.find(".gizmo-expandable-inner-content").height(),e.css("height",s))},r.disableSubmitAndCleanIfEmpty=function(){r.$inputSubscriptionNumber&&""!=r.$inputSubscriptionNumber.val()?r.$submitButton.prop("disabled",!1):(r.$submitButton.attr("disabled",!0),r.hideMessages())},function(){r.disableSubmitAndCleanIfEmpty(),r.$submitButton.on("click",r.submitPrintedSubscriptionNumber),r.$inputSubscriptionNumber.on("input",r.disableSubmitAndCleanIfEmpty),r.$inputSubscriptionNumber.on("keypress",}()},Kobo.Gizmo.MagazinePrintedSubscription.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.BuyPad=function(e){var o,t,r,i,a,l=this,n=!1,s=!1,d=e.addToLibrarySelector||".add-to-library",b=e.undoRemoveFromLibrarySelector||".undo-remove";Kobo.Gizmo.apply(this,arguments),l.setType("BuyPad"),l.isInLibrary=ko.observable(Kobo.Object.parseBool(l.settings.isInLibrary)),l.isPreordered=ko.observable(Kobo.Object.parseBool(l.settings.isPreordered)),l.isRemoved=ko.observable(Kobo.Object.parseBool(l.settings.isRemoved)),o=function(e){e.preventDefault(),n||(n=!0,l.fire("library::add",{actionUrl:l.settings.addToLibraryUrl,completeCallback:r}))},t=function(e){e.preventDefault(),s||(s=!0,l.fire("library::addRemoved",{actionUrl:l.settings.undoRemoveFromLibraryUrl,completeCallback:r}))},r=function(e){e&&"success"===e.result&&(l.isRemoved(!1),l.isInLibrary(!0))},l.bindCollapsibleToggle=function(e,t){1===e.length&&e.on("click",function(e){var o=Kobo.$(e.target);"true"===Kobo.$(e.target).attr("aria-expanded")?o.attr("aria-expanded",!1):o.attr("aria-expanded",!0),o.toggleClass("open"),Kobo._mediator.fire("collapsible::toggle",{name:t})})},l.loveToggleHandler=function(e){Kobo.$(e.target).toggleClass("open"),Kobo._mediator.fire("collapsible::toggle",{name:"KoboLovePointsExtra"})},l.redeemWithPoints=l.destroy=function(){i.length&&i.off("click"),a.length&&a.off("click")},function(){i=l.$el.find(".toggle-love-message"),a=Kobo.$(".toggle-price-guarantee"),l.$el.find(".redeem-button").on("click",l.redeemWithPoints),l.$el.find(d).on("click",o),l.$el.find(b).on("click",t),l.bindCollapsibleToggle(i,"KoboLovePointsExtra"),l.bindCollapsibleToggle(a,"PreorderPriceGuarantee"),ko.applyBindings(l,e)}()},Kobo.Gizmo.BuyPad.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.OrangeRedirect=function(){var t=this;Kobo.Gizmo.apply(t,arguments),this.showWidgetOnMatchedQueryString=function(o){var e;-1!==o.indexOf("orangeSuccess=true")&&(o=Kobo.$("#credit-from-orange-template"),e=Kobo.$(o.html()),t.viewModel.closeDialog.subscribe(function(){Kobo._modal.close(),e.remove()}),Kobo._modal.open(e,{customClass:"activated-offer-content-wrap"}),ko.applyBindings(t.viewModel,e[0]))},this.viewModel={closeDialog:ko.observable()},t.showWidgetOnMatchedQueryString(window.location.search)},Kobo.Gizmo.OrangeRedirect.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";!function(s){function e(){this.setDefaults({isCollapsed:!1,height:"0px",duration:"0.5s",initiallyHiddenClasses:["gizmo-expandable-collapsed-on-load","gizmo-expandable-collapsed-on-load-mobile"],allowBindings:!0,collapseOnEvent:!1,toggleEvent:!1,expandableContentClassName:"",extendToListItemWidth:!1,ariaLabel:"",heightBinding:!1}),s.Gizmo.apply(this,arguments),this.setType("Expandable"),this.settings.expandableContentClassName&&0<this.$gizmo.find("."+this.settings.expandableContentClassName).length?this.contents=this.$gizmo.find("."+this.settings.expandableContentClassName):this.contents=this.$gizmo.contents(),this.contents.wrapAll('<div class="gizmo-expandable-inner-content" data-bind="allowBindings: '+this.settings.allowBindings.toString()+'"></div>'),this.$innerContent=this.$gizmo.find(".gizmo-expandable-inner-content:first"),this.isExpandable=!1,this.$innerMasker=null,this.animationComplete=!1,this.viewModel=null,this.currentScreenSize=s._mediator.determineBreakpoint(),this.applyTransitions=this.applyTransitions.bind(this),this.setupHandlers(),this.toggleExpandable(),this.clearInitiallyHiddenStyle()}(e.prototype=s.chainPrototype(s.Gizmo.prototype)).clearInitiallyHiddenStyle=function(){for(var e=0;e<this.settings.initiallyHiddenClasses.length;e++)this.$el.removeClass(this.settings.initiallyHiddenClasses[e])},e.prototype.defaultHeight=e.prototype.shouldConsiderHeightBinding=e.prototype.checkIfScreenSizeIsLarge=e.prototype.updateDefaultHeight=function(){var e=this.defaultHeight();this.$innerMasker.css({height:e+"px"})},e.prototype.buildExpandable=function(){this.isExpandable||(this.wrapContents(),void 0!==this.settings.viewModel&&s.ViewModel.Expandable[this.settings.viewModel]?this.viewModel=new s.ViewModel.Expandable[this.settings.viewModel](this):this.viewModel=new s.ViewModel.Expandable(this),ko.dataFor(this.el)||ko.applyBindings(this.viewModel,this.el)),this.setupAccessibilityHandlers(),this.isExpandable=!0},e.prototype.tearDownExpandable=function(){ko.cleanNode(this.el),this.$innerMasker.replaceWith(this.$innerContent),this.isExpandable=!1,this.fire("expandable::removeButton")},e.prototype.toggleExpandable=function(){this.needsExpanding()&&!this.isExpandable?(this.buildExpandable(),setTimeout(this.applyTransitions,500)):!this.needsExpanding()&&this.isExpandable&&this.tearDownExpandable()},e.prototype.setupHandlers=e.prototype.setupAccessibilityHandlers=function(){var n=this;this.viewModel.$contentLinks.on("keydown",function(e){var t,i;(e.keyCode!==s.KeyCodes.TAB||n.viewModel.allowTab||n.viewModel.isCollapsed())&&(e.keyCode!==s.KeyCodes.ESC||n.viewModel.isCollapsed())?e.keyCode===s.KeyCodes.DOWN?(e.preventDefault(),(0<(t=(i=$(e.target).parent()).next()).length?t:i.siblings().first()).children().focus()):e.keyCode===s.KeyCodes.UP&&(e.preventDefault(),(0<(e=(i=$(e.target).parent()).prev()).length?e:i.siblings().last()).children().focus()):(n.viewModel.onButtonSelected(),n.viewModel.$button.focus())})},e.prototype.wrapContents=function(){this.shouldConsiderHeightBinding()&&this.checkIfScreenSizeIsLarge()?this.$innerContent.wrapAll('<div class="gizmo-expandable-inner-masker"></div>'):this.$innerContent.wrapAll('<div class="gizmo-expandable-inner-masker" data-bind="style: { height: height }"></div>'),this.$innerMasker=this.$gizmo.find(".gizmo-expandable-inner-masker:first")},e.prototype.applyTransitions=function(){Modernizr.csstransitions&&this.$innerMasker.css(Modernizr.prefixed("transition",this.$innerMasker.prop("style"),!1),"height "+this.settings.duration)},e.prototype.needsExpanding=function(){return parseInt(this.defaultHeight(),10)>parseInt(this.settings.height,10)},e.getExpandableDescendants=function(e){return(!e||"string"!=typeof e.type||0===e.type.indexOf("Class.Gizmo"))&&(0<e.descendants.length?s.Gizmo.Expandable.getExpandables(e.descendants):[])},e.getExpandables=function(e){for(var t,i=[],n=0;n<e.length;n++)0===(t=e[n]).type.indexOf("Class.Gizmo.Expandable")&&i.push(t);return i},s.Gizmo.Expandable=e}(Kobo);
"use strict";Kobo.Gizmo.Expandable.Popup=function(e,o){var i,t=this;this.setDefaults({ariaHasPopup:!0}),Kobo.Gizmo.Expandable.apply(this,arguments),t.setType("Popup"),i=function(o){Kobo.$.contains(e,o.target)||t.viewModel.$button.click()},t.subscribe("gizmosInitialized",function(){t.viewModel&&t.viewModel.isCollapsed.subscribe(function(){"large"!==t.currentBreakpoint()&&"jumbo"!==t.currentBreakpoint()||(t.viewModel.isCollapsed()?Kobo.$(document).off("click",i):setTimeout(150))})})},Kobo.Gizmo.Expandable.Popup.prototype=Kobo.chainPrototype(Kobo.Gizmo.Expandable.prototype);
"use strict";Kobo.Gizmo.Header=function(e,o){Kobo.Gizmo.apply(this,arguments),this.setType("Header");var a,l=this,i=l.$gizmo.find(".header-slideout-menu-button"),n=l.$gizmo.find(".header-main-menu"),t=l.$gizmo,s=l.$gizmo.find(".search-bar-toggle"),d=l.$gizmo.find(".icon-cart"),r=d.find("em"),c=l.$gizmo.find(".small-cart-link .cart-item-count em"),g=(l.$gizmo.find(".small-cart-link"),Kobo.$("html,body")),u=Kobo.$(".rakuten-logo-bar"),h=Kobo.$(".search-section");Kobo.$(".hero-drawer div");function p(){l.fire("shoppingCart::toggle",{toggle:!1}),l.fire("toggleSearchHero",{isCollapsed:!s.hasClass("is-collapsed"),$searchSection:h,$mainNavBar:t})}l.accountExpandableTriggerSmall=l.$gizmo.find(".account-expandable-trigger-small"),l.accountExpandableTriggerLarge=l.$gizmo.find(".account-expandable-trigger-large"),l.expandables=[],l.expandableSmall=null,l.expandableLarge=null,l.doToggleSearchBar=!0,l.isSearchExpanded=!1,l.isCartExpanded=!1,l.doToggleCart=!0,Kobo.$window.on("scroll",function(e){var o,a=Kobo.$window.scrollTop();u.offset().top+u.height()<a?Kobo.$body.addClass("header-fixed"):Kobo.$body.removeClass("header-fixed"),0<h.length&&(o=h.offset().top+h.height(),l.doToggleSearchBar=a<o)}),l.slideMenuOpen=function(){n.removeClass("hide-flyout-menu").addClass("show-flyout-menu"),Kobo.$body.removeClass("push-content-left").addClass("push-content-right"),t.removeClass("slide-left").addClass("slide-right"),i.addClass("flyout-active"),t.removeClass("slide-left")},l.slideMenuClose=function(){n.removeClass("show-flyout-menu").addClass("hide-flyout-menu"),Kobo.$body.removeClass("push-content-right").addClass("push-content-left"),t.removeClass("slide-right").addClass("slide-left"),i.removeClass("flyout-active")},l.calculateHeight=function(e){var o;"large"===e||"jumbo"===e?(n.css("overflow-y",""),n.height("")):(e=Kobo.$(window).height(),o=0,n.children().each(,e<o?(n.css("overflow-y","scroll"),n.height(e)):(n.css("overflow-y",""),n.height(o+e)))},a=function(){i.click(function(e){t.hasClass("slide-right")?l.slideMenuClose():t.hasClass("slide-left")?l.slideMenuOpen():(l.slideMenuOpen(),i.addClass("flyout-active"))}),l.events.onResize(function(e){"large"!==e.currentSize&&"jumbo"!==e.currentSize||l.slideMenuClose(),l.calculateHeight(e.currentSize)}),s.click(function(e){e.preventDefault(),l.doToggleSearchBar?p():g.animate({scrollTop:"0"},{duration:400,complete:function(){s.hasClass("is-collapsed")&&(s.removeClass("is-collapsed"),p()),setTimeout(function(){Kobo.$(".search-field").focus()},250)}})}),d.click(function(e){e.preventDefault(),l.fire("toggleSearchHero",{toggle:!1}),l.fire("shoppingCart::toggle")}),l.subscribe("gizmosInitialized",function(){var e;0===l.expandables.length&&((e=Kobo.Gizmo.Expandable.getExpandableDescendants(l))&&0<e.length?(l.expandables=e,l.expandableSmall=l.expandables[0],l.expandableLarge=l.expandables[1]):l.expandables=!1)}),l.accountExpandableTriggerSmall.on("click",function(e){e.preventDefault(),l.expandableSmall&&l.expandableSmall.viewModel.toggle()}),l.accountExpandableTriggerLarge.on("click",function(e){e.preventDefault(),l.expandableLarge&&l.expandableLarge.viewModel.toggle()}),l.subscribe("shoppingCartItems::updated",function(e,o){o=o.detail.items&&o.detail.items.length;0<o?(r.text(o=99<o?"99+":o),c.text(o),d.addClass("show-icon"),c.css("display","inline-block")):(d.removeClass("show-icon"),c.css("display","none"))})},l.init=function(){a()},l.init()},Kobo.Gizmo.Header.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.MyBooksFilters=function(){Kobo.Gizmo.apply(this,arguments),this.setType("MyBooksFilters"),this.defaults={filterChip:null,filterButton:null,filterList:null,filterItem:null};var t,e,o=this;function s(t,e){var s=1<arguments.length&&void 0!==e&&e,e=t.closest("."+o.settings.filterChip),e=$(e.find("."+o.settings.filterList));e.hasClass("open")||s?(t.removeClass("selected"),e.removeClass("open"),t.attr("aria-expanded","false"),e.attr("aria-hidden","true")):(t.addClass("selected"),e.addClass("open"),t.attr("aria-expanded","true"),e.attr("aria-hidden","false"))}t=$("."+o.settings.filterButton),e=$("."+o.settings.filterList),t.on("click",function(){s($(this))}),t.on("focusout",function(t){null!==t.relatedTarget&&$(t.relatedTarget).hasClass(o.settings.filterItem)||s($(this),!0)}),t.on("keydown",function(t){var e=$(this);t.keyCode===Kobo.KeyCodes.ESC&&s(e,!0)}),e.on("focusout keydown",function(t){$(this).prevAll("."+o.settings.filterButton).first().trigger(t)})},Kobo.Gizmo.MyBooksFilters.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.KoboLoveAutoRenewalWithPoints=function(){Kobo.Gizmo.apply(this,arguments),this.setType("KoboLoveAutoRenewalWithPoints");var o,t,i,s,n,e=this;function a(){t.change(function(){var o,e=t.is(":checked")||!1;o=n,e={newStatus:e},t.prop("disabled",!0),Kobo.$.ajax({method:"POST",url:o,data:e,dataType:"json",cache:!1,complete:)}),Kobo._mediator.subscribe("koboLove::autoRenewToggled",function(o,e){e.detail.isAutoRenewOn?i.removeClass(s):i.addClass(s)})}o=e.$el,i=$("."+e.settings.addClassTo),s=e.settings.classWhenHidden,n=e.settings.setAutoRenewalUrl,t=o.find("input[type='checkbox']"),a()},Kobo.Gizmo.KoboLoveAutoRenewalWithPoints.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";function ownKeys(t,e){var i,s=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,i)),s}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(function(e){_defineProperty(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}!function(n){function e(e,t){n.Gizmo.apply(this,arguments),this.setType("SearchBar"),this.$el=n.$(e),this.$primaryInputField=n.$("#"+t.primaryInputId),this.$secondaryInputField=n.$("#"+t.secondaryInputId),this.$inputField=this.$gizmo.find("input.search-field"),this.$autoComplete=this.$gizmo.find("ul.search-autocomplete"),this.$submitButton=this.$gizmo.find("input[type=submit]"),this.$deleteIcon=this.$gizmo.find("button.deleteicon"),this.$searchToggleButton=n.$(".search-bar-toggle"),this.$searchBarWrap=n.$(".search-bar-wrap"),this.currentScreenSize=n._mediator.determineBreakpoint(),this.expandables=[],this.searchExpandable=null,this.$searchSection=this.$gizmo.find(".search-section"),this.$form=this.$gizmo.find("form.search-form"),this.onClearInput=this.onClearInput.bind(this),this.onToggle=this.onToggle.bind(this),this.onToggleSearchHero=this.onToggleSearchHero.bind(this),this.onGizmosInitialized=this.onGizmosInitialized.bind(this),this.onResize=this.onResize.bind(this),this.onViewResized=this.onViewResized.bind(this),this.onSyncInputs=this.onSyncInputs.bind(this),this.onResizeHack=this.onResizeHack.bind(this),this.disableSubmitButton=this.disableSubmitButton.bind(this),this.loseFocus=this.loseFocus.bind(this),this.gainFocus=this.gainFocus.bind(this),this.triggerClearEvent=this.triggerClearEvent.bind(this),this.init(),n.$(window).on("resize",this.onResizeHack)}(e.prototype=n.chainPrototype(n.Gizmo.prototype)).onResizeHack=function(){var e=n._mediator.determineBreakpoint();this.currentScreenSize!==e&&(this.currentScreenSize=e,n._mediator.fire("searchInput::viewResized",{guid:this.guid}))},e.prototype.triggerClearEvent=e.prototype.onClearInput=function(e,t){this.$inputField.val(""),t.detail.guid===this.guid&&this.$inputField.focus()},e.prototype.onToggle=function(e,t){t.detail.isCollapsed?this.$searchToggleButton.addClass("is-collapsed"):(this.$searchToggleButton.removeClass("is-collapsed"),this.$searchSection.find("input.search-field").focus())},e.prototype.disableSubmitButton=function(){this.isSubmitEnabled()?(this.$submitButton.prop("disabled",!1),this.$deleteIcon.removeClass("clear-field-display-none")):(this.$submitButton.attr("disabled","disabled"),this.$deleteIcon.addClass("clear-field-display-none"))},e.prototype.isSubmitEnabled=e.prototype.loseFocus=function(){this.disableSubmitButton(),this.$inputField.off("keyup",this.disableSubmitButton),n._mediator.fire("searchInput::syncInputs",{guid:this.guid})},e.prototype.gainFocus=function(){this.disableSubmitButton(),this.$inputField.on("keyup",this.disableSubmitButton),this.$inputField.on("keydown",function(e){e.keyCode===n.KeyCodes.BACKSPACE&&n.$(window).scrollTop()})},e.prototype.setupTriggers=function(){this.$inputField.on("blur",this.loseFocus),this.$inputField.on("focus",this.gainFocus),this.$deleteIcon.on("click",this.triggerClearEvent)},e.prototype.clearTriggers=e.prototype.onToggleSearchHero=function(e,t){var i;t&&t.detail&&void 0!==t.detail.toggle&&(i=t.detail.toggle),this.searchExpandable.viewModel&&this.searchExpandable.viewModel.toggle(i)},e.prototype.onGizmosInitialized=function(){var t,i=this;0===this.expandables.length&&(0<this.descendants.length?(this.descendants.forEach(function(e){0===(t=e).type.indexOf("Class.Gizmo.Expandable")&&i.expandables.push(t)}),this.searchExpandable=this.expandables[0]):this.expandables=!1),("large"===this.currentScreenSize||"jumbo"===this.currentScreenSize)&&n.$("body").hasClass("Store-HomePage")&&this.searchExpandable&&this.searchExpandable.viewModel&&!this.searchExpandable.viewModel.isCollapsed()&&(this.$inputField.focus(),this.$submitButton.css({opacity:"1"})),this.searchExpandable&&this.searchExpandable.viewModel&&this.fire("isSearchBarExpanded",{isExpanded:this.searchExpandable.viewModel.isCollapsed()}),this.searchExpandable&&null!==this.searchExpandable.viewModel&&this.searchExpandable.viewModel.isCollapsed()?this.$searchToggleButton.addClass("is-collapsed"):this.$searchToggleButton.removeClass("is-collapsed")},e.prototype.onResize=function(){this.searchExpandable&&null!==this.searchExpandable.viewModel&&"object"===n.typeOf(this.searchExpandable.viewModel)&&this.searchExpandable.viewModel.recalculateHeight()},e.prototype.onViewResized=function(){this.reset()},e.prototype.setupHandlers=function(){n._mediator.register("searchInput::clearInput"),n._mediator.subscribe("searchInput::clearInput",this.onClearInput),n._mediator.register("searchBar::toggle"),n._mediator.subscribe("searchBar::toggle",this.onToggle),this.register("toggleSearchHero"),this.subscribe("toggleSearchHero",this.onToggleSearchHero),this.subscribe("gizmosInitialized",this.onGizmosInitialized),this.events.onResize(this.onResize)},e.prototype.reset=function(){this.clearTriggers(),this.setupTriggers(),n._mediator.fire("searchInput::syncInputs",{guid:this.guid,reset:!0})},e.prototype.onSyncInputs=function(e,t){t&&t.detail&&void 0!==t.detail.reset?t.detail.reset&&t.detail.guid!==this.guid&&(this.$primaryInputField.is(":visible")?this.$primaryInputField.val(this.$secondaryInputField.val()):"large"===this.currentScreenSize&&this.$secondaryInputField.val(this.$primaryInputField.val())):t.detail.guid!==this.guid&&(this.settings.primaryInputId!==this.settings.inputId?this.$secondaryInputField.val(this.$primaryInputField.val()):this.$primaryInputField.val(this.$secondaryInputField.val()))},e.prototype.init=function(){this.setupHandlers(),this.setupTriggers(),this.disableSubmitButton(),this.settings.autoCompleteEnabled&&this.setupAutocomplete(),n._mediator.register("searchInput::viewResized"),n._mediator.subscribe("searchInput::viewResized",this.onViewResized),0<this.$primaryInputField.length&&0<this.$secondaryInputField.length&&(n._mediator.register("searchInput::syncInputs"),n._mediator.subscribe("searchInput::syncInputs",this.onSyncInputs)),"small"!==this.currentScreenSize&&this.$inputField.is(":focus")&&this.$inputField.focus()},e.prototype.destroy=function(){this.clearTriggers(),n._mediator.unSubscribe("searchInput::viewResized",this.reset),n._mediator.unRegister("searchInput::viewResized"),n._mediator.unSubscribe("searchInput::clearInput",this.onClearInput),n._mediator.unRegister("searchInput::clearInput"),n._mediator.unSubscribe("searchBar::toggle",this.onToggle),n._mediator.unRegister("searchBar::toggle")},e.prototype.positionAutoComplete=function(){var o=this;setTimeout(function(){var e=o.$inputField.outerWidth(),t=n.$window.height()-40,i=o.$inputField.offset(),s=o.currentBreakpoint();"small"===s||"medium"===s?o.$searchBarWrap.css({position:"relative"}):o.$searchBarWrap.css({position:"static"}),o.$autoComplete.css({left:i.left,"max-height":t,width:e})},1500)},e.prototype.setupAutocompleteHandlers=function(){var i=this;n._mediator.register("searchInput::clearInput"),n._mediator.subscribe("searchInput::clearInput",,this.events.onResize(function(){i.positionAutoComplete()}),this.$inputField.on("blur",function(){i.viewModels.AutoCompleteViewModel.active(!1),i.viewModels.AutoCompleteViewModel.unSelectAll(!0),i.positionAutoComplete()}),this.$inputField.on("focus",,this.subscribe("toggleSearchHero",function(){i.positionAutoComplete()}),this.$autoComplete.on({mouseover:function(){i.viewModels.AutoCompleteViewModel.hover(!0)},mouseout:),this.$inputField.on({keyup:function(){i.viewModels.AutoCompleteViewModel.query(i.$inputField.val())},keydown:function(e){switch(e.keyCode){case n.KeyCodes.RETURN:null!==i.viewModels.AutoCompleteViewModel.currentSelected&&i.viewModels.AutoCompleteViewModel.isActive()?(i.viewModels.AutoCompleteViewModel.goToCurrentActive(),e.preventDefault()):i.$form.trigger("submit");break;case n.KeyCodes.UP:i.viewModels.AutoCompleteViewModel.moveUp(),e.preventDefault();break;case n.KeyCodes.DOWN:i.viewModels.AutoCompleteViewModel.moveDown(),e.preventDefault()}}})},e.prototype.setupAutocomplete=function(){this.viewModels={AutoCompleteViewModel:null},this.setupAutocompleteHandlers(),this.instantiateViewModels()},e.prototype.instantiateViewModels=function(){if(this.settings.autoCompleteEnabled){var e=n.Object.resolveKoboNamespace("ViewModel.Search.AutoComplete.Item"),t=_objectSpread(_objectSpread({},this.settings),{},{ItemViewModelClass:e}),i=n.Object.resolveKoboNamespace("ViewModel.Search.AutoComplete");if(!i){e="Cannot instantiate listViewModel as [ViewModel.Search.AutoComplete]";throw this.error("instantiateViewModels","SearchBar",this,e),new Error("[Kobo.Gizmo.ScrollingList.instantiateViewModels] "+e)}this.viewModels.AutoCompleteViewModel=new i(this.el,t),this.viewModels.AutoCompleteViewModel.query(this.$inputField.val())}},n.Gizmo.SearchBar=e}(Kobo);
"use strict";Kobo.Gizmo.FacetCheckBox=function(){var e,t,a,o=this;Kobo.Gizmo.apply(this,arguments),o.setType("FacetCheckBox"),e=o.$el.find(".facet-list-view-widget"),t="fclanguages",a=e.parent('ul[data-field-name="'+t+'"]'),e.each(function(){var o=Kobo.$(this);a.length&&o.click(function(){var e={preferred:o.find("a").attr("href").match(t+"=.*").toString().replace(t+"=","")},e=decodeURIComponent($.param(e));Cookies.set("searchlanguage",e,{expires:BotTracker.addDays(new Date,31),path:"/",raw:!0})})})},Kobo.Gizmo.FacetCheckBox.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.AddToLibraryButton=function(r,e,o){var i=this;i.defaults={url:"/Book/AddToLibrary",checkOwnershipUrl:void 0,isInLibrary:!1,isAddedToLibraryMessage:!1,toastFailureResourceString:void 0},e.url||delete e.url,Kobo.Gizmo.apply(this,arguments),i.setType("AjaxButton"),i.sendAddToLibraryAction=function(){i.$flowViewItem.addClass("flowview-item-spinner"),Kobo.Ajax({method:"post",url:i.settings.url,success:i.addToLibrarySuccessCallback,error:i.addToLibraryErrorCallback,complete:i.addToLibraryCompleteCallback})},i.viewModel={isAddedToLibraryMessage:ko.observable(i.settings.isAddedToLibraryMessage),isInLibrary:ko.observable(i.settings.isInLibrary),sendAction:i.sendAddToLibraryAction},i.addToLibraryCompleteCallback=function(){i.$flowViewItem.removeClass("flowview-item-spinner")},i.addToLibraryErrorCallback=function(e){i.settings.toastFailureResourceString&&i.settings.toastFailureResourceString in DynamicConfiguration.resourceStrings&&i.fire("toast::error",{message:DynamicConfiguration.resourceStrings[i.settings.toastFailureResourceString]}),i.error("Data.Ajax.Failure","Kobo.Gizmo.AddToLibraryButton",i,{msg:"Cannot add the book to the Library.",dataResult:e.result})},i.showAddToLibraryMessages=i.addToLibrarySuccessCallback=function(e){e&&"success"===e.result?i.showAddToLibraryMessages():"failure"===e.result?i.addToLibraryErrorCallback(e):"redirect"===e.result&&(Kobo._tracker.sendResultsSynchronously(),window.location.href=e.redirectUrl,i.showAddToLibraryMessages())},i.sendCheckOwnershipAction=function(){Kobo.Ajax({method:"post",url:i.settings.checkOwnershipUrl,success:i.checkOwnershipAjaxCallback})},i.checkOwnershipAjaxCallback=function(e){"object"===Kobo.typeOf(e)&&e.result&&"success"===e.result&&e.data&&(i.viewModel.isInLibrary(e.data.IsOwned),ko.applyBindings(i.viewModel,i.el))};!function(){var e;if(!i.settings.url)return e="ERROR: url is not provided for "+i.type,Kobo.log(e);void 0===i.settings.checkOwnershipUrl?ko.applyBindings(i.viewModel,r):i.sendCheckOwnershipAction(),i.$flowViewItem=i.$el.parents(".flowview-item")}()},Kobo.Gizmo.AddToLibraryButton.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ItemPromoOfferBanner=function(e,o){var i,t,r,n,s,a,m=this;Kobo.Gizmo.apply(m,arguments),this.setType("ItemPromoOfferBanner"),n=function(e){var o;return(o=e?Cookies.get(e):o)?JSON.parse(o):null},r=a=function(e,o){o.detail.itemPromotionAvailable&&o.detail.showItemAddedToCartBanner&&(t.showNewCustomerCreditAppliedBanner(o.detail.showCreditAppliedBanner),t.showNewCustomerCreditAvailableBanner(!o.detail.showCreditAppliedBanner),setTimeout(t.hideItemPromotionAddedToCartNotification,5e3))},s=function(){m.register("ItemPromoOfferBanner::showNewCustomerCreditNotification"),m.subscribe("ItemPromoOfferBanner::showNewCustomerCreditNotification",a)},t=new Kobo.ViewModel.ItemPromoOfferBannerVM({cookieName:o.cookieName,isBannerDismissed:o.isBannerDismissed,setCookie:function(e){Cookies.set(e,JSON.stringify({isDismissed:!0}),{expires:365,path:"/",raw:!0})}}),i=function(){var e=r(o.cookieName);t.isDismissed(e),s()},ko.applyBindings(t,m.el),i()},Kobo.Gizmo.ItemPromoOfferBanner.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.DropDownSelect=function(n,e){var i,r,a,s,c=this,p="drop-down-select";Kobo.Gizmo.apply(this,arguments),this.setType("DropDownSelect"),c.settings=Kobo.extend({hideDropdownWhenSingleOption:!1},e),e=function(){var e=Kobo.$(n),t={},o=e.is("select")?e:e.find("select");i(o)&&(c.register("dropDownSelectChange"),c.register("invalidate"),c.subscribe("invalidate",function(){c.onInvalidate(o)}),e.removeClass("kobo-input-select"),t.customClass=p,c.generateDropDown(o,t),o.change(r),a(),s(o),o.attr("aria-busy",!1))},i=function(e){var t=!0;return e.each(function(){if(!this.hasAttribute("name"))return t=!1}),t},r=function(){c.fire("dropDownSelectChange",{selectName:this.getAttribute("name"),value:this.value,label:0<=this.selectedIndex?this.options[this.selectedIndex].innerHTML:""})},a=function(){Kobo.$("."+p).each(function(){var e=document.createElement("span"),t=document.createElement("span");if(this.querySelector(".drop-down-arrow-container"))return!0;t.className="drop-down-arrow-container",t.appendChild(e),e.className="drop-down-arrow",this.appendChild(t)})},s=function(e){e.each(function(){this.invalidateSingleOption=c.settings.hideDropdownWhenSingleOption?function(){var e=$(this).find('option[value!=""]'),t=$(this).next().find(".drop-down-arrow-container");1===e.length?($(this).val(e.val()),$(this).prop("disabled",!0),t.hide()):($(this).prop("disabled",!1),t.show())}:function(){}})},e()},Kobo.Gizmo.DropDownSelect.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype),Kobo.Gizmo.DropDownSelect.prototype.generateDropDown=function(e,t){e.customSelect(t),e.each(,e.css({height:"",width:"",top:0,left:0,bottom:0,right:0}),e.parent().find("."+t.customClass+"Inner").css("width","")},Kobo.Gizmo.DropDownSelect.prototype.onInvalidate=function(e){e.each(function(){this.invalidateSingleOption(),this.repaint()})};
"use strict";Kobo.Gizmo.MultiButton=function(o,t){var n,e,r,i,a,u,s,d,l,c,m,p,b=this;Kobo.Gizmo.apply(this,arguments),b.setType("MultiButton"),n=function(){b.$rootButton=Kobo.$('<div class="multi-button"></div>'),b.$primaryLink=Kobo.$("<a></a>"),b.$dropDownArrow=Kobo.$('<a href="#" class="drop-down-button"aria-label="Toggle options"aria-controls="multibutton-drop-down"rel="nofollow"></a>'),b.$rootButton.append(b.$primaryLink),b.$rootButton.append(b.$dropDownArrow),b.$gizmo.empty(),b.$gizmo.append(b.$rootButton)},e=function(o){if(o){if(!o.length)throw"No menu items to set in the multibutton. At least one must be specified.";b.menuItems=o,i()}},i=function(){r(),(1<b.menuItems.length?l:c)(),b.fire("multiButtonDropDown::close")},r=function(){var o=b.menuItems[0];Kobo.Gizmo.MultiButton._dropDown.setupMenuItemLink(o,b.$primaryLink),o="secondary"===o.ranking?"secondary-button":"tertiary"===o.ranking?"tertiary-button":"primary-button",b.$primaryLink.removeClass().addClass(o)},l=function(){b.$primaryLink.addClass("add-padding"),b.$dropDownArrow.show()},c=function(){b.$primaryLink.removeClass("add-padding"),b.$dropDownArrow.hide()},p=d=s=function(){b.subscribe("multiButtonDropDown::closed",m),b.$dropDownArrow.addClass("active"),b.fire("multiButtonDropDown::open",{menuItems:b.menuItems.slice(1),anchor:b.$rootButton[0]})},u=function(o){(p()?d:s)(),o.preventDefault(),o.stopPropagation()},m=function(o,t){t.detail.anchor===b.$rootButton[0]&&(b.unSubscribe("multiButtonDropDown::closed",m),b.$dropDownArrow.removeClass("active"))},a=function(){b.$dropDownArrow.on("click",u)},b.destroy=function(){b.$primaryLink.off("click"),b.unSubscribe("multiButtonDropDown::closed",m),b.$dropDownArrow.off("click",u)},function(){n(),e(t.menuItems),a()}()},Kobo.Gizmo.MultiButton.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype),Kobo.Gizmo.MultiButton._dropDown=function(){var e,r,i,t="multibutton-drop-down",o=function(){var o=Kobo.$('<div class="arrow"></div>');e=Kobo.$('<div id="'+t+'"></div>'),r=Kobo.$('<ol aria-live="polite"></ol>'),e.append(o),e.append(r),Kobo.$body.append(e)},a=function(o){var t,n,e;for(r.empty(),e=0;e<o.length;++e)t=Kobo.$("<li></li>"),n=Kobo.$("<a></a>"),u(o[e],n),t.append(n),r.append(t)},u=function(o,t){var n=o.eventName,e=Kobo._tracker.getTrackAttribute(),r="#";if(!n)throw"Menu items must have an associated Kobo event";if("navigate"===n&&!(r=o.actionUrl))throw"Navigate events must provide an actionUrl";t.html(o.label).attr("href",r).attr(e,o.trackingPayload).attr("rel","nofollow"),t.click(o,s)},s=function(o){var t=o.data,n={actionUrl:t.actionUrl};"navigate"!==t.eventName&&(t.eventData&&Kobo.$.extend(n,t.eventData),Kobo._mediator.fire(t.eventName,n),o.preventDefault())},d=function(o){var t=Kobo._tracker.aggregateTrackInfo(o),o=Kobo._tracker.getTrackAttribute();Kobo.$.isEmptyObject(t)?e.removeAttr(o):e.attr(o,JSON.stringify(t))},n=function(o,t){var n=i&&i!==t;if(!o||!o.length||!t)throw"Both menuItems and an anchor element have to be specified to display a drop-down";n&&(e.css("transition","none"),l()),a(o),c(i=t),n?setTimeout(0):e.addClass("show"),d(t),Kobo.$body.on("click",l),Kobo.$body.on("touchmove",l),Kobo._mediator.subscribe(Kobo._mediator.defaultEventNames.resize,l)},l=function(){e.removeClass("show"),i&&(Kobo._mediator.fire("multiButtonDropDown::closed",{anchor:i}),i=null),Kobo._mediator.unSubscribe(Kobo._mediator.defaultEventNames.resize,l),Kobo.$body.off("click",l),Kobo.$body.off("touchmove",l)},c=function(o){var t=Kobo.$(o),n=t.offset().top+t.height()-6,o=t.offset().left;e.width(t.width()),e.offset({top:n,left:o})};return function(){Kobo._mediator.register("multiButtonDropDown::open"),Kobo._mediator.register("multiButtonDropDown::close"),Kobo._mediator.register("multiButtonDropDown::closed"),Kobo._mediator.subscribe("multiButtonDropDown::open",,Kobo._mediator.subscribe("multiButtonDropDown::close",l),o()}(),{reset:function(){l(),e.remove(),e=r=i=null,o(),Kobo._mediator.unSubscribe(Kobo._mediator.defaultEventNames.resize,l)},dropDownId:t,setupMenuItemLink:u}}();
"use strict";Kobo.Gizmo.ModalButtonTrigger=function(o,t){var i=this;Kobo.Gizmo.apply(this,arguments),i.modalTrigger=i.$gizmo.find(".modal-trigger"),i.modalClose=i.$gizmo.find(".modal-close"),i.modalContent=i.$gizmo.find(".pottermore-content"),i.init=function(){i.modalTrigger.on("click",function(){i.modalContent.removeClass("hidden"),Kobo._modal.open(i.modalContent.get(0),{customClass:"pottermore"})}),i.modalClose.on("click",},i.init()},Kobo.Gizmo.ModalButtonTrigger.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.Slider=function(o){var n=$(o);Kobo.Gizmo.apply(this,arguments);var a=function(){return n.wrap("<span class='gizmo-slider'></span>"),n.after("<span class='slider-container'><span class='bar'><span></span></span><span class='bar-btn'><span></span></span></span>"),n.on("change",.off("mousedown touchstart").on("mousedown touchstart",function(){$(this).data("isMoving",!0)}).off("mouseup touchend").on("mouseup touchend",,n};(function(){a()})()},Kobo.Gizmo.Slider.updateSlider=function(o){var n=o.val(),a=o.attr("min"),t=o.attr("max"),t=(100*(n-a)/Math.round(t-a)).toFixed(4),a=o.next(),o=a.find("span.bar-btn"),a=a.find("span.bar > span");o.css("left","calc(".concat(t,"% - ").concat(o.width()/2,"px)")),a.css("width",t+"%")},Kobo.Gizmo.Slider.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Utilities.assignToNamespace("Kobo.Purchasing.ViewModels.ThankYouAudiobookSubscriptionVM",function(i){var a=this;a.creditUsed=ko.observable(!1),a.appLinks=i.appLinks,a.relatedLinks=i.relatedLinks,a.productAvailable=i.productAvailable,a.isWalmartAffiliate=i.isWalmartAffiliate});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.Purchasing.ViewModels.ThankYouKoboPlusSubscriptionVM",function(s){this.appLinks=s.appLinks,this.productRedeemed=ko.observable(!1)});
"use strict";Kobo.Gizmo.InteractiveRecommendationsWidget=function(e){Kobo.Gizmo.apply(this,arguments);var o=this,i=this.options.interactiveRecommendationsUrl,s=function(){o.viewModel.showSpinner(!0),o.viewModel.showFailure(!1),o.viewModel.showSuccess(!1)},n=function(){o.viewModel.showSpinner(!1),o.viewModel.showSuccess(!0),o.viewModel.showFailure(!1)},t=r=function(){s();var e=document.createElement("script");e.onload=n,e.onerror=t,e.src=i,document.getElementsByTagName("body")[0].appendChild(e)};this.viewModel={fadeIn:ko.observable(!0),showSpinner:ko.observable(!1),showFailure:ko.observable(!1),showSuccess:ko.observable(!1),loadAppBundle:r,resetViewModel:s,scriptLoadSuccess:n,scriptLoadFailure:t},r(),ko.applyBindings(this.viewModel,e)},Kobo.Gizmo.InteractiveRecommendationsWidget.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.Spotlight=function(){var t,r,b=[{r:0,g:101,b:189},{r:0,g:191,b:224},{r:99,g:29,b:118},{r:191,g:34,b:150},{r:0,g:98,b:101},{r:0,g:178,b:169},{r:210,g:73,b:42},{r:255,g:109,b:34},{r:145,g:0,b:75},{r:198,g:12,b:48},{r:0,g:152,b:95},{r:105,g:190,b:40},{r:99,g:29,b:118},{r:164,g:77,b:196}];Kobo.Gizmo.apply(this,arguments),this.setType("Spotlight");var g=this;!function(){t=g.$el,r=t.find("."+g.options.imageContainer);var o=b[Math.floor(Math.random()*b.length)];r[0].style.backgroundColor="rgb(".concat(o.r,",").concat(o.g,",").concat(o.b,", 0.1)")}()},Kobo.Gizmo.Spotlight.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.BillingInfo=function(e,i){var s,l,o,r,n,a,b,t=this;Kobo.Gizmo.apply(this,arguments),t.setType("BillingInfo"),l=function(){var e=this;e.name=ko.observable(""),e.label=ko.observable(""),e.value=ko.observable(""),e.possibleValues=ko.observableArray([]),e.possibleLabels=ko.observableArray([]),e.error=ko.observable(""),e.visible=ko.observable(!0)},s=function(){var e=this;e.address=new l,e.city=new l,e.state=new l,e.postalCode=new l,e.country=new l,e.phone=new l,e.vatNumber=new l},r=n=function(e,i){var s=i.detail.addressTemplateName,l=i.detail.addressFields||[],o=i.detail.errorMessage;"boolean"==typeof i.detail.isKid&&t.isApplicable(!i.detail.isKid),Kobo.$.each(l,function(){var e=this,i=e.Name.charAt(0).toLowerCase()+e.Name.slice(1);t.billingAddress[i].name=i,t.billingAddress[i].label(e.Label),t.billingAddress[i].visible(e.Visible),t.billingAddress[i].error(e.Error),e.PossibleValues&&1===e.PossibleValues.length&&e.Value===t.billingAddress[i].value()||(e.PossibleValues&&t.billingAddress[i].possibleValues.replaceAll(e.PossibleValues),e.PossibleLabels&&(t.billingAddress[i].possibleLabels.removeAll(),Kobo.$.each(e.PossibleLabels,),t.billingAddress[i].value(e.Value))}),s&&s!==t.billingAddressTemplateName&&(ko.cleanNode(t.$gizmo[0]),t.$gizmo.html(i.detail.addressTemplate),ko.applyBindings(t,t.$gizmo[0]),Kobo._gizmo.initContext(t.$gizmo),t.billingAddressTemplateName=s),t.error(o),t.fire("invalidate")},a=function(e,i){i=i.detail.orderData;i.Address=t.billingAddress.address.value(),i.City=t.billingAddress.city.value(),i.State=t.billingAddress.state.value(),i.Country=t.billingAddress.country.value(),i.PostalCode=t.billingAddress.postalCode.value(),i.Phone=t.billingAddress.phone.value()},o=function(){t.register("billingInfo::countryChanged"),t.register("billingInfo::update"),t.register("billingInfo::getCountry"),t.koSubscriptions.push(t.billingAddress.country.value.subscribeChanged(function(e,i){i!==e&&t.fire("billingInfo::countryChanged",{countryCode:e})})),t.koSubscriptions.push(t.error.subscribe(function(e){e&&t.fire("regularCheckout::requestFocus",{target:t.gizmo})})),t.subscribe("billingInfo::getCountry",r),t.subscribe("billingInfo::update",n),t.subscribe("regularCheckout::marshallOrderData",a)},b=function(){t.billingAddressTemplateName="",t.billingAddress=new s,t.error=ko.observable(""),t.error.extend({notify:"always"}),t.infoMessage=ko.observable(""),t.koSubscriptions=[],t.isApplicable=ko.observable(""),t.isApplicable(!0),o()},t.destroy=function(){Kobo.$.each(t.koSubscriptions,function(){this.dispose()}),t.unSubscribe("regularCheckout::marshallOrderData",a),t.unSubscribe("billingInfo::update",n),t.unSubscribe("billingInfo::getCountry",r)},b()},Kobo.Gizmo.BillingInfo.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.GiftCards=function(r,e){var t,i,a,o,n,d,s,u,c,f,C,l,b,p,g,G,m,y=this,T={theme:Kobo._modal.themes.LIGHT};Kobo.Gizmo.apply(this,arguments),y.setType("GiftCards"),t=function(){var r=this;r.number=ko.observable(""),r.cardType=ko.observable(),r.pin=ko.observable(""),r.appliedToOrder=ko.observable(""),r.balance=ko.observable(""),r.errorMessage=ko.observable(""),r.errorMessage.extend({notify:"always"})},i=o=function(){Kobo.$.each(y.descendants,function(){0===this.type.indexOf("Class.Gizmo.Expandable")&&(y.expandable=this)})},n=function(r){r.viewModel&&(r.viewModel.registerExpandableResizedEvent(),r.subscribe("expandableResized",function(){r.viewModel.isCollapsed()||r.viewModel.toggle(!0)}))},g=function(r,e){e=e.detail.gaEvent;y.$gizmo.append(e)},s=function(r,e){e=e.detail;y.currentGiftCard.number(e.number),y.currentGiftCard.cardType(d(e.cardTypeId)),y.currentGiftCard.pin(e.pin),y.currentGiftCard.appliedToOrder(e.appliedToOrder),y.currentGiftCard.balance(e.balance),y.currentGiftCard.errorMessage(e.errorMessage),y.showGiftCardSummary(!0),y.showGiftCardForm(!1)},d=function(r){var e=null;return!r&&0!==r||Kobo.$.each(y.giftCardTypes(),,e||Kobo.log("Unable to find gift card type corresponding to "+r+". Check if card types have been set with giftCards::replaceGiftCardTypes"),e},u=function(r,e){e=e.detail.giftCard;e.number=y.currentGiftCard.number(),e.cardType=y.currentGiftCard.cardType()&&y.currentGiftCard.cardType().id,e.pin=y.currentGiftCard.pin(),e.hasApplied=y.currentGiftCard.appliedToOrder()},c=function(){y.currentGiftCard.number(""),y.currentGiftCard.cardType(),y.currentGiftCard.pin(""),y.currentGiftCard.appliedToOrder(""),y.currentGiftCard.balance(""),y.currentGiftCard.errorMessage(""),y.showGiftCardSummary(!1),y.showGiftCardForm(!0)},G=function(){y.currentGiftCard.number()?(y.showGiftCardSummary(!0),y.showGiftCardForm(!1)):(y.showGiftCardSummary(!1),y.showGiftCardForm(y.giftCardTypes().length))},f=function(r,e){e=e.detail.types;y.giftCardTypes.removeAll(),e&&Kobo.$.each(e,,G()},C=function(){var r=y.$gizmo.find(".giftcard-form");y.expandable&&y.expandable.viewModel&&y.expandable.viewModel.isCollapsed()?y.expandable.viewModel.toggle(!0):Kobo.$("html, body").animate({scrollTop:r.offset().top-Kobo.$window.outerHeight()/2+r.outerHeight()/2})},p=function(){y.$el.is(":visible")&&y.expandable&&(y.expandable.toggleExpandable(),n(y.expandable))},l=function(r){y.fire("giftCards::gaEventTrigger",{gaEvent:r.GAEvent}),r.IsSuccess&&(y.currentGiftCard.appliedToOrder(r.GiftCard.AppliedToOrder),y.currentGiftCard.balance(r.GiftCard.Balance),y.showGiftCardSummary(r.IsSuccess),y.showGiftCardForm(!r.IsSuccess),y.expandable.viewModel.toggle(!1)),r.PriceSummary&&y.fire("priceSummary::update",{lineItems:r.PriceSummary}),r.Total&&y.fire("regularCheckout::updateGrandTotal",{grandTotal:r.Total}),y.fire("regularCheckout::updateStoreCreditBalance",{storeCreditBalance:r.StoreCreditBalance}),"boolean"===Kobo.Object.typeOf(r.SufficientAlternativePayment)&&y.fire("regularCheckout::updateSufficientPayment",{sufficientPayment:r.SufficientAlternativePayment}),y.currentGiftCard.errorMessage(r.ErrorMessage)},b=function(r){y.fire("giftCards::gaEventTrigger",{gaEvent:r.GAEvent}),r.IsSuccess&&(y.currentGiftCard.number(""),y.currentGiftCard.cardType(),y.currentGiftCard.pin(""),y.currentGiftCard.appliedToOrder(""),y.currentGiftCard.balance(""),y.showGiftCardForm(!0),y.showGiftCardSummary(!1)),r.PriceSummary&&y.fire("priceSummary::update",{lineItems:r.PriceSummary}),r.Total&&y.fire("regularCheckout::updateGrandTotal",{grandTotal:r.Total}),y.fire("regularCheckout::updateStoreCreditBalance",{storeCreditBalance:r.StoreCreditBalance}),"boolean"===Kobo.Object.typeOf(r.SufficientAlternativePayment)&&y.fire("regularCheckout::updateSufficientPayment",{sufficientPayment:r.SufficientAlternativePayment}),y.currentGiftCard.errorMessage(r.ErrorMessage)},m=function(r,e){e=e.detail.errorMessage;y.currentGiftCard.errorMessage(e)},a=function(){y.register("giftCards::setCurrentGiftCard"),y.register("giftCards::getCurrentGiftCard"),y.register("giftCards::resetCurrentGiftCard"),y.register("giftCards::replaceGiftCardTypes"),y.register("giftCards::toggleOpen"),y.register("giftCards::update"),y.register("giftCards::gaEventTrigger"),y.subscribe("gizmosInitialized",o),y.subscribe("giftCards::setCurrentGiftCard",s),y.subscribe("giftCards::getCurrentGiftCard",u),y.subscribe("giftCards::resetCurrentGiftCard",c),y.subscribe("giftCards::replaceGiftCardTypes",f),y.subscribe("giftCards::toggleOpen",C),y.subscribe("giftCards::update",m),y.subscribe("giftCards::gaEventTrigger",g),y.subscribe("regularCheckout::dataLoaded",p),y.koSubscriptions.push(y.giftCardTypes.subscribe(G)),y.koSubscriptions.push(y.currentGiftCard.cardType.subscribe(),y.koSubscriptions.push(y.currentGiftCard.errorMessage.subscribe(function(r){r&&y.fire("regularCheckout::requestFocus",{target:y.gizmo})}))},y.destroy=function(){Kobo.$.each(y.koSubscriptions,function(){this.dispose()}),y.unSubscribe("regularCheckout::dataLoaded",p),y.unSubscribe("giftCards::update",m),y.unSubscribe("giftCards::toggleOpen",C),y.unSubscribe("giftCards::replaceGiftCardTypes",f),y.unSubscribe("giftCards::resetCurrentGiftCard",c),y.unSubscribe("giftCards::getCurrentGiftCard",u),y.unSubscribe("giftCards::setCurrentGiftCard",s),y.unSubscribe("gizmosInitialized",o),y.unSubscribe("giftCards::gaEventTrigger",g)},y.applyGiftCard=function(){var r={};Kobo._modal.open("<div class ='ajax-spinner'></div>",T),y.fire("billingInfo::getCountry",r),r.country?y.currentGiftCard.number()?Kobo.Ajax({url:y.applyGiftCardUrl,method:"POST",dataType:"json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:{CardType:y.currentGiftCard.cardType()&&y.currentGiftCard.cardType().id,Number:y.currentGiftCard.number(),Pin:y.currentGiftCard.pin(),CurrentCountry:r.country},success:function(r){Kobo._modal.close(),l(r)},error:function(){Kobo._modal.close(),y.currentGiftCard.errorMessage(DynamicConfiguration.resourceStrings.giftCardNotApplied)}}):(Kobo._modal.close(),y.currentGiftCard.errorMessage(DynamicConfiguration.resourceStrings.giftCardMissing)):(Kobo._modal.close(),y.currentGiftCard.errorMessage(DynamicConfiguration.resourceStrings.giftCardSelectCountry))},y.clearGiftCard=function(){Kobo._modal.open('<div class="ajax-spinner"></div>',T),Kobo.Ajax({url:y.clearGiftCardUrl,method:"POST",dataType:"json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:{CardType:y.currentGiftCard.cardType()&&y.currentGiftCard.cardType().id,Number:y.currentGiftCard.number()},success:error:)},function(){y.applyGiftCardUrl=e.applyGiftCardUrl,y.clearGiftCardUrl=e.clearGiftCardUrl,y.currentGiftCard=new t,y.giftCardTypes=ko.observableArray([]),y.showGiftCardForm=ko.observable(!1),y.showGiftCardSummary=ko.observable(!1),y.koSubscriptions=[],a()}(),ko.applyBindings(y,r)},Kobo.Gizmo.GiftCards.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.RakutenSuperPoints=function(e,o){var n,i,t,s,r,a,p,u,l,d=this,c={theme:Kobo._modal.themes.LIGHT};Kobo.Gizmo.apply(this,arguments),d.applyPoints=function(){d.promoCodeReset(!1);var e=d.pointsToApply();e==parseInt(e)?(e=parseInt(e))>parseInt(d.balanceCarriedOver())?v(r,!0):e<parseInt(d.minimumPoints())?v(a.replace("{0}",d.minimumPoints()),!0):(v("",!1),Kobo._modal.open("<div class ='ajax-spinner'></div>",c),Kobo.Ajax({url:"/Purchase/ApplyRakutenSuperPoints",method:"POST",dataType:"json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:{superAppliedToPurchase:e,PurchaseToken:d.purchaseToken},success:function(e){e.IsSuccess?(S(e.PriceSummary),k(e.RakutenSuperPointsApplied,e.RakutenSuperPointsApplied,!0),g(e.SufficientAlternativePayment),d.fire("rakutenSuperPoints::apply",{appliedSuperPoints:e.RakutenSuperPointsApplied}),e.ErrorMessage&&v(e.ErrorMessage,!0)):v(e.ErrorMessage,!0),Kobo._modal.close(),d.fixExpandable()},error:function(){Kobo._modal.close(),v(s,!0)}})):v(p,!0)},d.clearAppliedPoints=function(e,o){v("",!1),d.pointsHaveBeenApplied()?(Kobo._modal.open("<div class ='ajax-spinner'></div>",c),Kobo.Ajax({url:"/Purchase/ClearRakutenSuperPoints",method:"POST",dataType:"json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:{PurchaseToken:d.purchaseToken},success:function(e){e.IsSuccess?(S(e.PriceSummary),k(0,0,!1),g(e.SufficientAlternativePayment),d.fixExpandable(),d.fire("rakutenSuperPoints::apply",{appliedSuperPoints:0})):v(e.ErrorMessage,!0),Kobo._modal.close()},error:function(){Kobo._modal.close(),v(t,!0)},complete:)):d.fire("paymentOptions::validated",{isSuccess:!0})},i=function(){d.clearAppliedPoints()},d.toggleAboutPanel=function(){d.showAboutPanel(!d.showAboutPanel()),d.fixExpandable()},d.toggleSuperpointsNeeded=function(e,o){d.pointsHaveBeenApplied()?d.superpointsNeeded(!0):(d.superpointsNeeded(!o.detail.sufficientPayment),d.superpointsNeeded()||v(u,!1))};function b(e,o){!o.detail.errorMessage&&d.superpointsNeeded&&d.pointsHaveBeenApplied()?(d.promoCodeReset(!0),f()):d.promoCodeReset(!1)}function m(e,o){d.balanceCarriedOver(o.detail.pointsBalance),d.balanceTimeSensitive(o.detail.pointsTimeSensitive),d.balanceCash(o.detail.pointsCash),d.minimumPoints(o.detail.minimumRedeemable||50),0==o.detail.pointsRedeemed?k(0,0,!1):k(o.detail.pointsRedeemed,o.detail.pointsRedeemed,!0)}var f=function(){d.superPointsExpandable&&d.superPointsExpandable.viewModel&&d.superPointsExpandable.viewModel.isCollapsed()&&d.superPointsExpandable.viewModel.toggle(!0)},S=g=function(e){"boolean"===Kobo.Object.typeOf(e)&&d.fire("regularCheckout::updateSufficientPayment",{sufficientPayment:e})},k=function e(){3==arguments.length&&e.fromDirectValues.apply(this,arguments),2==arguments.length&&e.fromReturnedObject.apply(this,arguments)};k.fromReturnedObject=function(e,o){k.fromDirectValues(o.detail.RakutenSuperPointsApplied,o.detail.RakutenSuperPointsApplied,void 0!==o.detail.RakutenSuperPointsApplied&&0!=o.detail.RakutenSuperPointsApplied)},k.fromDirectValues=function(e,o,n){void 0===o&&(o=0),d.pointsToApply(e=void 0===e?0:e),d.pointsApplied(o),d.pointsHaveBeenApplied(n)};function P(){Kobo.$.each(d.descendants,function(e,o){0===this.type.indexOf("Class.Gizmo.Expandable")&&(d.superPointsExpandable=this,h(o))})}var v=h=function(e){e.viewModel&&(e.viewModel.registerExpandableResizedEvent(),e.subscribe("expandableResized",function(){e.viewModel.isCollapsed()||e.viewModel.toggle(!0)}))};d.fixExpandable=function(){d.fire("expandableResized")},d.setupResourceStrings=function(){var e=window.DynamicConfiguration;e&&(e.resourceStrings.superpointsCash,n=e.resourceStrings.superpointsToRedeem,e.resourceStrings.rakutenSuperPoints,t=e.resourceStrings.cannotClearPoints,s=e.resourceStrings.cannotUsePoints,r=e.resourceStrings.notEnoughPoints,a=e.resourceStrings.belowMinimum,e.resourceStrings.genericInvalidSuperpoints,p=e.resourceStrings.superpointsInvalidNumberError,u=e.resourceStrings.amountAlreadyCovered)},l=function(){var e=Kobo.$(this).offset().top-100;Kobo.$("html, body").animate({scrollTop:e},500)},d.setupHandlers=function(){d.register("rakutenSuperPoints::toggleOpen"),d.subscribe("gizmosInitialized",P),d.subscribe("regularCheckout::loadRakutenSuperpoints",m),d.subscribe("regularCheckout::updateAppliedRakutenSuperpoints",k),d.subscribe("regularCheckout::updateRakutenSuperpointsNeededState",d.toggleSuperpointsNeeded),d.subscribe("promoCode::update",b),d.subscribe("regularCheckout::clearAppliedRakutenSuperpoints",i),d.subscribe("rakutenSuperPoints::toggleOpen",f),$("#superpointsToRedeem").keypress(function(e){return 13==e.keyCode?(d.applyPoints(),d.fixExpandable(),!1):void d.promoCodeReset(!1)}),$("#superpointsToRedeem").change(function(){0<$("#superpointsToRedeem").length&&$("#superpointsToRedeem")[0].value.length<1&&(d.errorState()&&(d.errorState(!1),d.fixExpandable()),d.promoCodeReset()&&(d.promoCodeReset(!1),d.fixExpandable()))}),Modernizr.touchevents&&$("#superpointsToRedeem").on("focus",l)},d.destroy=function(){d.unSubscribe("regularCheckout::loadRakutenSuperpoints",m),d.unSubscribe("regularCheckout::updateAppliedRakutenSuperpoints",k),d.unSubscribe("regularCheckout::updateRakutenSuperpointsNeededState",d.toggleSuperpointsNeeded),d.unSubscribe("rakutenSuperPoints::toggleOpen",f),d.unSubscribe("regularCheckout::clearAppliedRakutenSuperpoints",i),d.unSubscribe("gizmosInitialized",P)},function(){d.setupResourceStrings(),d.balanceCarriedOver=ko.observable(0),d.balanceTimeSensitive=ko.observable(0),d.balanceCash=ko.observable(0),d.pointsToBeEarned=ko.observable(0),d.pointsToApply=ko.observable(0),d.pointsApplied=ko.observable(0),d.pointsHaveBeenApplied=ko.observable(!1),d.errorState=ko.observable(!1),d.error=ko.observable(""),d.superpointsNeeded=ko.observable(!0),d.promoCodeReset=ko.observable(!1),d.showPanel=ko.observable(void 0!==o.isFeatureTurnedOn&&"true"==o.isFeatureTurnedOn.toLowerCase()),d.showAboutPanel=ko.observable(!1),d.minimumPoints=ko.observable(0),d.superPointsToRedeem=ko.computed(this),d.purchaseToken=o.purchaseToken,d.setupHandlers(),$(".gizmo-superpoints").removeClass("hidden"),setTimeout(function(){d.fixExpandable()},2500)}(),ko.bindingHandlers.fadeVisible={init:function(e){$(e).toggle(d.showAboutPanel())},update:function(e){d.showAboutPanel()?$(e).fadeIn():$(e).fadeOut()}},ko.applyBindings(d,e)},Kobo.Gizmo.RakutenSuperPoints.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.PaymentOptions=function(e,t){var a,i,r,o,n,d,s,c,l,u,b,p,m,v,y,f,C,h,k,g,P,M,S,O,E,T,D,A,x,N,z=this,$=t.braintreeToken,I=t.braintreeMerchantAccountId,w="",K=t.isDoNotCaptureCreditCardHolderNameEnabled;Kobo.Gizmo.apply(this,arguments),z.setType("PaymentOptions"),z.DEFAULT_PAYMENT_METHOD="",a=function(){var e=this;e.ccPaymentProvider=null,e.isAvailable=ko.observable(""),e.type=ko.observable(""),e.expiryYear=ko.observable(""),e.expiryMonth=ko.observable(""),e.lastFourDigits=ko.observable(""),e.fullName={name:ko.observable(""),label:ko.observable(""),value:ko.observable("")},e.creditCardToken=ko.observable(""),e.cvvToken=ko.observable(""),e.clearTokens=e.hasSavedInfo=ko.observable(!1),e.useSavedInfo=ko.computed(,e.savedInformation=ko.computed(,N={cardType:"",key:$,isOldPP:!0,createFields:!0,collectDeviceData:!0,isDoNotCaptureCreditCardHolderNameEnabled:K},e.editMode=ko.observable(!1),e.enableEditMode=function(){Kobo._mediator.fire("braintreeCard::refreshIframe"),e.editMode(!0),e.ccPaymentProvider=e.ccPaymentProvider||new Kobo.Purchasing.BraintreePayments(N),e.ccPaymentProvider&&e.creditCard.ccPaymentProvider.collectDeviceDataEvent.subscribe(function(e){w=e})},e.disableEditMode=function(){e.editMode(!1)},e.types=ko.observableArray([]),e.expiryMonths=ko.observableArray([]),e.expiryYears=ko.observableArray([]),e.error=ko.observable(),e.error.extend({notify:"always"})},i=function(){var e=this;e.isAvailable=ko.observable(),e.isSelected=ko.observable(),e.banks=ko.observableArray(),e.bank=ko.observable(),e.error=ko.observable(),e.error.extend({notify:"always"})},r=function(){var e=this;e.isAvailable=ko.observable(!1),e.isSelected=ko.observable(!1),e.error=ko.observable(!1),e.availableBalance=ko.observable()},o=function(){var e=this;e.isAvailable=ko.observable(),e.isSelected=ko.observable(),e.error=ko.observable(),e.error.extend({notify:"always"})},s=function(e){e&&(z.ideal.isAvailable(e.IsAvailable),z.ideal.isSelected(e.IsSelected),z.ideal.banks(e.Banks),z.ideal.bank(e.Bank))},c=function(e){e&&(z.superpoints.isAvailable(e.IsAvailable),z.superpoints.error(!1),e.IsAvailable&&(e.Balance?z.superpoints.availableBalance(e.Balance):z.superpoints.error(!0)))},l=function(e){e&&(z.vme.isAvailable(e.IsAvailable),z.vme.isSelected(e.IsSelected))},d=function(e){e&&(u(e.ExpiryMonths,e.ExpiryYears,e.Types),z.creditCard.isAvailable(e.IsAvailable),z.creditCard.expiryYear(e.ExpiryYear),z.creditCard.expiryMonth(e.ExpiryMonth),z.creditCard.type(e.Type),z.creditCard.lastFourDigits(e.LastFourDigits),z.creditCard.creditCardToken(e.CreditCardToken),z.creditCard.cvvToken(e.CvvToken),z.creditCard.hasSavedInfo(e.HasSavedInfo),e.Name=e.Name||{},z.creditCard.fullName.name(e.Name.Name),z.creditCard.fullName.value(e.Name.Value),z.creditCard.fullName.label(e.Name.Label))},u=function(e,t,a){e&&""===z.creditCard.expiryMonth()&&(z.creditCard.expiryMonths.removeAll(),Kobo.$.each(e,function(){z.creditCard.expiryMonths.push(this)})),t&&""===z.creditCard.expiryYear()&&(z.creditCard.expiryYears.removeAll(),Kobo.$.each(t,function(){z.creditCard.expiryYears.push(this)})),a&&(z.creditCard.types.removeAll(),Kobo.$.each(a,)},E=T=function(e){var t=z.$gizmo.find("#security-code-tooltip"),a=z.$gizmo.find(".security-code-outer"),i=D(a),r=t[0].offsetHeight+10;A(t,i<r),"click"===e.type&&(a.hasClass("clicked")?E():(a.addClass("clicked"),window.setTimeout(0)))},D=function(e){var t=e[0].getBoundingClientRect(),e=document.body;return(document.documentElement.clientHeight||e.clientHeight||0)-t.bottom},A=function(e,t){e.addClass("show-tooltip"),t?e.addClass("info-message-bottom-arrow").removeClass("info-message-top-arrow"):e.addClass("info-message-top-arrow").removeClass("info-message-bottom-arrow")},y=function(e,t){z.$gizmo.append(t.detail.gaEvent)},v=function(e,t){var a=t.detail.paymentOptionsTemplate,i=t.detail.selectedPaymentMethod,r=t.detail.paymentOptions,t=t.detail.errorMessage;a&&(ko.cleanNode(z.$gizmo[0]),z.$gizmo.html(a),ko.applyBindings(z,z.$gizmo[0]),Kobo._gizmo.initContext(z.$gizmo)),N={cardType:"",key:$,isOldPP:!0,createFields:!0,collectDeviceData:!0,merchantAccountId:I,triggerBraintreeLocalPayment:!1,isDoNotCaptureCreditCardHolderNameEnabled:K},i&&(z.selectedPaymentMethod(i),"creditcard"===i&&(z.creditCard.ccPaymentProvider=z.creditCard.ccPaymentProvider||new Kobo.Purchasing.BraintreePayments(N),z.creditCard.ccPaymentProvider&&z.creditCard.ccPaymentProvider.collectDeviceDataEvent.subscribe(function(e){w=e}))),r&&(d(r.CreditCard),s(r.Ideal),c(r.SuperPoints),l(r.Vme)),z.selectedPaymentMethod()&&p(z.selectedPaymentMethod())||m(),b(t),z.fire("regularCheckout::updateButton")},x=function(e,t){(0,t.detail.saveDeviceData)(w)},p=function(e){return"creditcard"===e?z.creditCard.isAvailable():"ideal"===e?z.ideal.isAvailable():"superpoints"===e?z.superpoints.isAvailable():"vme"===e?z.vme.isAvailable():(Kobo.log("Unrecognized payment method "+e),!1)},m=function(){z.selectedPaymentMethod(z.DEFAULT_PAYMENT_METHOD)},b=function(e){switch(z.selectedPaymentMethod()){case"creditcard":z.creditCard.error(e);break;case"ideal":z.ideal.error(e);break;case"vme":z.vme.error(e)}e&&z.fire("regularCheckout::requestFocus",{target:z.gizmo})},C=function(e,t){b(null),"creditcard"!==z.selectedPaymentMethod()||z.creditCard.useSavedInfo()||z.sufficientPayment()?"ideal"!==z.selectedPaymentMethod()||z.sufficientPayment()?"superpoints"===z.selectedPaymentMethod()?z.fire("regularCheckout::clearAppliedRakutenSuperpoints"):z.fire("paymentOptions::validated",{isSuccess:!0}):h():(t&&t.detail&&t.detail.purchaseMode&&(z.purchaseMode=t.detail.purchaseMode),z.creditCard.clearTokens(),z.fire("braintreeCard::validate"))},h=function(){var e=void 0!==z.ideal.bank();e?z.ideal.error(""):z.ideal.error(DynamicConfiguration.resourceStrings.idealMessages.errorNoBankSelected),z.fire("paymentOptions::validated",{isSuccess:e})},k=function(e,t){t.detail.isSuccess?(z.creditCard.creditCardToken(t.detail.creditCardToken),z.creditCard.cvvToken(t.detail.cvvToken),z.creditCard.lastFourDigits(t.detail.lastFourCardDigits),z.creditCard.expiryMonth(t.detail.expiryMonth),z.creditCard.expiryYear(t.detail.expiryYear)):"CCNotRequired"===z.purchaseMode&&(z.fire("paymentOptions::validated",{isSuccess:!0}),t.detail.errorMessage=""),b(t.detail.errorMessage),z.fire("paymentOptions::validated",{isSuccess:t.detail.isSuccess})},f=function(e,t){var a,i=t.detail.orderData,t={};i.HasSufficientPayment=z.sufficientPayment(),z.sufficientPayment()||(i.SelectedPaymentMethod=z.selectedPaymentMethod(),"creditcard"===i.SelectedPaymentMethod?(a=z.creditCard,(i.CreditCard=t).UseSavedInfo=a.useSavedInfo(),t.UseSavedInfo||(t.Type=a.type(),t.ExpiryMonth=a.expiryMonth(),t.ExpiryYear=a.expiryYear(),t.CreditCardToken=a.creditCardToken(),t.CvvToken=a.cvvToken(),t.Name={Name:a.fullName.name(),Label:a.fullName.label(),Value:a.fullName.value()},t.FullName=a.fullName.value())):"ideal"===i.SelectedPaymentMethod&&(a=z.ideal,i.Ideal=t,i.Ideal.Bank=a.bank()))},g=function(e,t){"boolean"===Kobo.Object.typeOf(t.detail.sufficientPayment)&&z.sufficientPayment(t.detail.sufficientPayment)},P=function(){z.creditCard.disableEditMode()},S=function(){z.creditCard.disableEditMode()},M=function(){z.creditCard.enableEditMode()},O=n=function(){z.register("paymentOptions::update"),z.register("paymentOptions::validate"),z.register("paymentOptions::validated"),z.register("paymentOptions::gaEventTrigger"),z.register("paymentOptions::enableEditMode"),z.register("paymentOptions::disableEditMode"),z.register("paymentOptions::setCurrentPaymentMethodError"),z.register("paymentOptions::collectDeviceData"),z.subscribe("paymentOptions::gaEventTrigger",y),z.subscribe("paymentOptions::update",v),z.subscribe("paymentOptions::validate",C),z.subscribe("creditCard::validated",k),z.subscribe("braintreeCard::validated",k),z.subscribe("regularCheckout::marshallOrderData",f),z.subscribe("regularCheckout::updateSufficientPayment",g),z.subscribe("regularCheckout::continuePurchaseValid",P),z.subscribe("paymentOptions::enableEditMode",M),z.subscribe("paymentOptions::disableEditMode",S),z.subscribe("paymentOptions::setCurrentPaymentMethodError",O),z.subscribe("paymentOptions::collectDeviceData",x),z.$gizmo.on("click",".skip-this",function(){z.fire("paymentOptions::validate")}),z.koSubscriptions.push(z.selectedPaymentMethod.subscribe(function(){z.fire("regularCheckout::updateButton")})),z.$gizmo.on("click",".security-code-outer",T),z.$gizmo.on("mouseover",".security-code-outer",T),z.$gizmo.on("mouseout",".security-code-outer",E),z.$gizmo.on("change",".paymentoptions-headings input[type=radio]",},z.destroy=function(){z.$gizmo.off("click","input[type=radio]"),z.$gizmo.off("click",".security-code-outer",T),z.$gizmo.off("mouseover",".security-code-outer",T),z.$gizmo.off("mouseout",".security-code-outer",E),z.unSubscribe("regularCheckout::marshallOrderData",f),z.unSubscribe("creditCard::validated",k),z.unSubscribe("braintreeCard::validated",k),z.unSubscribe("paymentOptions::validate",C),z.unSubscribe("paymentOptions::update",v),z.unSubscribe("regularCheckout::continuePurchaseValid",P),z.unSubscribe("paymentOptions::gaEventTrigger",y),z.unSubscribe("paymentOptions::enableEditMode",M),z.unSubscribe("paymentOptions::disableEditMode",S),z.unSubscribe("paymentOptions::setCurrentPaymentMethodError",O),z.unSubscribe("paymentOptions::collectDeviceData",x),Kobo.$.each(z.koSubscriptions,},function(){z.koSubscriptions=[],z.creditCard=new a,z.ideal=new i,z.superpoints=new r,z.vme=new o,z.selectedPaymentMethod=ko.observable(""),z.sufficientPayment=ko.observable(!1),z.purchaseMode="",n()}()},Kobo.Gizmo.PaymentOptions.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.PriceSummary=function(e,o){var i,t,s,r,a=this;Kobo.Gizmo.apply(this,arguments),a.setType("PriceSummary"),i=function(){this.label=ko.observable(),this.subLabel=ko.observable(),this.amount=ko.observable(),this.isCredit=ko.observable(),this.isSuperPoints=ko.observable(),this.isTotal=ko.observable(),this.isTotalSavings=ko.observable(),this.isFirstPurchasePromotion=ko.observable(!1)},t=function(e,o){a.lineItems.removeAll(),o.detail.lineItems&&Kobo.$.each(o.detail.lineItems,function(){var e=new i;e.label(this.Label),e.subLabel(this.SubLabel),e.amount(this.Amount),e.isCredit(this.IsCredit),e.isSuperPoints(this.IsSuperPoints),e.isTotal(this.IsTotal),e.isTotalSavings(this.IsTotalSavings),e.isFirstPurchasePromotion(this.IsFirstPurchasePromotion),this.IsTotal&&(a.fire("regularCheckout::updateGrandTotal",{grandTotal:this.Amount}),a.allowSuperPoints()&&void 0!==o.detail.rakutenSuperPointsEarned&&a.pointsToEarn(r.replace("{0}",o.detail.rakutenSuperPointsEarned))),a.lineItems.push(e)})},a.setupResourceStrings=s=a.destroy=function(){a.unSubscribe("priceSummary::update",t)},function(){a.lineItems=ko.observableArray(),a.allowSuperPoints=ko.observable(o.isFeatureTurnedOn&&"true"===o.isFeatureTurnedOn.toLowerCase()),a.pointsToEarn=ko.observable(""),a.setupResourceStrings(),s(),ko.applyBindings(a,e)}()},Kobo.Gizmo.PriceSummary.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.RegularCheckout=function(u,l){var c,o,d,r,t,a,i,n,s,p,g,f,b,m,h,C,y,P,S,e,k,v,T,K,A,M,E,B,O,U,I,R,G,D,L,_,w,F=this;Kobo.Gizmo.apply(this,arguments),this.setType("RegularCheckout"),L=o=function(e){return e?"#"===(e=e.toString()).charAt(0)?e.substring(1):e.substring(e.indexOf("#")+1,e.length):""},E=function(e){var r={},t=e||T,e=Kobo._tracker.getTrackAttribute()+'=\'{ "section": "errorDialog" }\'';r.customClass="error-dialog",Kobo._modal.open('<div class="error-content" '+e+'><button class="close-button"></button><p>'+t+"</p></div>",r),document.querySelector(".close-button").addEventListener("click",Kobo._modal.close)},M=function(e,r){var t={customClass:"error-dialog"};Kobo._modal.open('<div class="error-content">'+e+"</div>",t),r&&setTimeout(Kobo._modal.close,r)},O=function(){Kobo._modal.open("<div class ='ajax-spinner'></div>",{theme:Kobo._modal.themes.LIGHT})},U=function(){Kobo._modal.close()},r=function(e,r){var t=r&&r.detail&&r.detail.navigatePurchaseSection;F.currentStatusUrl&&(O(),Kobo.Ajax({method:"GET",cache:!1,url:F.currentStatusUrl,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},success:function(e){h(e,t)},complete:function(){F.inBuyProcess()||(Kobo._modal.close(),"True"===l.showInitialError&&E(A))},error:function(){}}))},h=function(e,r){e.loadRakutenSuperpoints&&(F.loadRakutenSuperpoints(e.loadRakutenSuperpoints),F.haveSuperPointsBeenApplied=e.RakutenSuperPointsApplied&&0<e.RakutenSuperPointsApplied,F.fire("regularCheckout::loadRakutenSuperpoints",{pointsBalance:e.SuperPoints.Balance,pointsTimeSensitive:e.SuperPoints.TimeSensitivePoints,pointsCash:e.SuperPoints.CashPoints,minimumRedeemable:e.SuperPoints.MinimumRedeemable,pointsRedeemed:e.RakutenSuperPointsApplied})),e.PaymentOptions&&e.PaymentOptions.CreditCard&&F.isCreditCardAvailable(e.PaymentOptions.CreditCard.IsAvailable&&e.PaymentOptions.CreditCard.HasSavedInfo),e.StoreCreditApplied&&F.storeCreditApplied(e.StoreCreditApplied),e.StoreCreditBalance&&F.fire("regularCheckout::updateStoreCreditBalance",{storeCreditBalance:e.StoreCreditBalance}),e.BillingAddressFields&&F.fire("billingInfo::update",{addressFields:e.BillingAddressFields}),e.GiftCardTypes&&(F.giftCardFormVisible(0<e.GiftCardTypes.length),F.fire("giftCards::replaceGiftCardTypes",{types:e.GiftCardTypes})),e.GiftCard&&F.fire("giftCards::setCurrentGiftCard",{number:e.GiftCard.Number,appliedToOrder:e.GiftCard.AppliedToOrder,balance:e.GiftCard.Balance,cardTypeId:e.GiftCard.CardType,errorMessage:e.GiftCard.ErrorMessage}),e.PaymentOptions&&(F.availablePaymentMethods=e.PaymentOptions,F.fire("paymentOptions::update",{paymentOptions:e.PaymentOptions})),D(e),e.PriceSummary&&F.fire("priceSummary::update",{lineItems:e.PriceSummary,rakutenSuperPointsEarned:e.RakutenSuperPointsEarned}),F.fire("koboLove::updateDetails",L(e)),e.BuyUrl&&(F.buyUrl=e.BuyUrl),e.PollingUrl&&F.pollPurchaseProcess(e.PollingUrl),e.Total&&F.fire("regularCheckout::updateGrandTotal",{grandTotal:e.Total}),"boolean"===Kobo.Object.typeOf(e.SufficientAlternativePayment)&&F.fire("regularCheckout::updateSufficientPayment",{sufficientPayment:e.SufficientAlternativePayment}),r&&(Kobo.Object.parseBool(e.ShowBillingInfoSection)?F.updatePurchaseSection("paymentMethods"):F.updatePurchaseSection("purchaseConfirmation")),F.hasKoboLoveMemberships(e.IsPurchasingKoboLoveMembership),F.fire("invalidate"),F.fire("regularCheckout::dataLoaded")},i=function(e,r){var t;F.changeCountryUrl&&(t={},Kobo._mediator.fire("giftCards::getCurrentGiftCard",{giftCard:t}),t.hasApplied||(t={}),Kobo.Ajax({method:"POST",url:F.changeCountryUrl,dataType:"json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:{CountryCode:r.detail.countryCode,GiftCardNumber:t.number,GiftCardType:t.cardType,GiftCardPin:t.pin},success:F.onCountryChanged,error:function(){}}))},D=function(e){var r={showKoboLoveVipUpsell:e.ShowKoboLoveVipUpsell,koboLoveVipUpsellProductId:e.KoboLoveVipUpsellProductId,vipMessage:e.VipMessage};e.Deals&&!e.CheckoutItems?r.deals=e.Deals:!e.Deals&&e.CheckoutItems?r.cartItems=e.CheckoutItems:e.Deals&&e.CheckoutItems&&(r.cartItems=e.CheckoutItems,r.deals=e.Deals),(r.deals||r.cartItems)&&F.fire("shoppingCartItems::update",r)},F.addCardDetailsToHeader=function(e){var r,t,o;e.ShortName&&e.LastFourDigits&&(t=(r=F.$gizmo.find(".payment-type")).find("span"),o=e.ShortName,e=".... "+e.LastFourDigits,t.length?(t.html(e),t.removeClass().addClass(o)):(t=Kobo.$("<span>"+e+"</span>").addClass(o),r.html(t)))},F.onCountryChanged=function(e){F.fire("regularCheckout::gaEventTrigger",{gaEvent:e.GAEvent}),F.fire("billingInfo::update",{addressFields:e.BillingAddressFields,addressTemplateName:e.BillingTemplateName,addressTemplate:e.BillingHtml,errorMessage:e.BillingInfoErrorMessage,isKid:e.IsKid}),F.fire("paymentOptions::update",{paymentOptionsTemplate:e.PaymentOptionsHtml,paymentOptions:e.PaymentOptions,selectedPaymentMethod:e.SelectedPaymentMethod}),e.PaymentOptions&&e.PaymentOptions.CreditCard&&F.addCardDetailsToHeader(e.PaymentOptions.CreditCard),e.GiftCardCleared&&F.fire("giftCards::resetCurrentGiftCard"),e.GiftCardTypes&&F.fire("giftCards::replaceGiftCardTypes",{types:e.GiftCardTypes}),e.GiftCard&&F.fire("giftCards::setCurrentGiftCard",{number:e.GiftCard.Number,appliedToOrder:e.GiftCard.AppliedToOrder,balance:e.GiftCard.Balance,cardTypeId:e.GiftCard.CardType,errorMessage:e.GiftCard.ErrorMessage}),F.fire("koboLove::updateDetails",L(e)),F.fire("koboLove::updateState",{showKoboLove:e.ShowKoboLove,showDiscount:e.ShowKoboLoveDiscounts,showPointsEarned:e.ShowKoboLovePoints,showPointsBalance:e.ShowKoboLoveBalance,showPointsEarnedBreakdown:e.KoboLoveSummaryHasBonusPoints}),D(e),F.fire("giftCards::update",{errorMessage:e.GiftCardErrorMessage}),e.RakutenSuperPointsApplied&&F.fire("regularCheckout::updateAppliedRakutenSuperpoints",{RakutenSuperPointsApplied:e.RakutenSuperPointsApplied}),e.Total&&F.grandTotal(e.Total),e.PriceSummary&&F.fire("priceSummary::update",{lineItems:e.PriceSummary}),e.TopLevelWarningMessages&&F.topLevelWarningMessages(e.TopLevelWarningMessages),F.fire("invalidate")},F.continuePurchase=n=function(){F.continuePurchase()},g=function(e,r){var t;F.continuePurchaseUrl&&(t={},r.detail.isSuccess&&(t.Mode=F.purchaseMode,F.fire("regularCheckout::marshallOrderData",{orderData:t}),O(),Kobo.Ajax({method:"POST",url:F.continuePurchaseUrl,dataType:"json",contentType:"application/json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:JSON.stringify(t),success:F.onContinuePurchaseResponse,error:function(){}})))},F.onContinuePurchaseResponse=function(e){var r=!0,t=F.$gizmo.find(".continue-link").attr("href");if(F.fire("billingInfo::update",{errorMessage:e.BillingAddressErrorMessage}),F.fire("giftCards::update",{errorMessage:e.GiftCardErrorMessage}),F.fire("paymentOptions::update",{errorMessage:e.PaymentOptionsErrorMessage}),F.fire("regularCheckout::gaEventTrigger",{gaEvent:e.GAEvent}),F.fire("vatNumber::updateError",{errorMessage:e.VatNumberErrorMessage}),e.BillingAddressErrorMessage&&(Kobo.log(e.BillingAddressErrorMessage),r=!1),e.GiftCardErrorMessage&&(Kobo.log(e.GiftCardErrorMessage),r=!0),e.PaymentOptionsErrorMessage&&(Kobo.log(e.PaymentOptionsErrorMessage),r=!1),e.VatNumberErrorMessage&&(Kobo.log(e.VatNumberErrorMessage),r=!1),!0===r){if(F.fire("regularCheckout::continuePurchaseValid"),F.continueValidRedirectUrl)return void(window.location.href=F.continueValidRedirectUrl);e.PaymentOptions&&(F.fire("paymentOptions::update",{paymentOptions:e.PaymentOptions}),e.PaymentOptions.CreditCard&&(F.isCreditCardAvailable(e.PaymentOptions.CreditCard.IsAvailable&&e.PaymentOptions.CreditCard.HasSavedInfo),F.addCardDetailsToHeader(e.PaymentOptions.CreditCard))),e.PriceSummary&&F.fire("priceSummary::update",{lineItems:e.PriceSummary}),D(e),e.Total&&F.grandTotal(e.Total),F.updatePurchaseSection(o(t)),F.fire("regularCheckout::requestFocus",{target:F.gizmo.querySelector("#paymentMethods")}),F.fire("rakutenSuperPoints::toggleOpen"),I()}Kobo._modal.close()},p=function(e,r){0===r.detail.items.length?F.disabled(!0):F.disabled(!1)},b=f=function(e,r){r.detail.grandTotal&&F.grandTotal(r.detail.grandTotal),I()},m=function(e,r){"boolean"===Kobo.Object.typeOf(r.detail.sufficientPayment)&&(F.sufficientPayment(r.detail.sufficientPayment),I()),F.fire("regularCheckout::updateRakutenSuperpointsNeededState",{sufficientPayment:r.detail.sufficientPayment})},s=function(e,r){Kobo.Ajax({url:F.applyPromoCodeUrl,method:"POST",dataType:"json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:{promoCode:r.detail.promoCodeNumber},success:function(e){e.IsSuccess&&h(e),F.fire("promoCode::update",{ResponseMessage:e.ResponseMessage,IsSuccess:e.IsSuccess,GAEvent:e.GAEvent}),F.fire("regularCheckout::updateAppliedRakutenSuperpoints",{RakutenSuperPointsApplied:e.RakutenSuperPointsApplied}),"boolean"===Kobo.Object.typeOf(e.SufficientAlternativePayment)&&F.fire("regularCheckout::updateSufficientPayment",{sufficientPayment:e.SufficientAlternativePayment})},error:function(){}})},y=function(){e("/Purchase/RedirectSuccess")},P=function(){e("/Purchase/RedirectFailure")},S=e=function(e){F.purchaseToken&&F.purchaseId||Kobo.log("purchaseToken and purchaseId need to be defined to notify the server of the state of 3DS credit card verification"),e=e+"?"+Kobo.$.param({purchaseToken:F.purchaseToken,purchaseId:F.purchaseId}),Kobo.Utilities.navigateTo(e)},F.startBuyNowProcess=function(e){var r;F.inBuyProcess(!0),O(),F.fire("paymentOptions::collectDeviceData",{saveDeviceData:function(e){r=e}}),Kobo.Ajax({method:"POST",url:F.buyUrl,dataType:"json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:{location:e,deviceData:r},success:function(e){var r;e.IsSuccess?setTimeout(function(){F.pollPurchaseProcess(e.PollingUrl)},F.pollingInterval):(F.fire("regularCheckout::gaEventTrigger",{gaEvent:e.GAEvent}),Kobo._modal.close(),r=F.availablePaymentMethods&&F.availablePaymentMethods.SuperPoints&&F.availablePaymentMethods.SuperPoints.IsAvailable,e.CheckSufficientPaymentsApplied&&r?I(!0):e.IsKid?E(e.ErrorMessage):(r=e.ErrorMessage||"",E(r)))},error:)},F.pollPurchaseProcess=function(t){var o;F.inBuyProcess(!0),O(),Kobo.Ajax({method:"GET",cache:!1,url:t,dataType:"json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},success:function(e){var r;"Complete"===e.Status||"Redirect"===e.Status?window.location.href=e.RedirectUrl:"Failed"===e.Status?(Kobo.log("Payment failed: "+(e.Errors&&e.Errors.length?e.Errors:"empty error response")),F.fire("regularCheckout::gaEventTrigger",{gaEvent:e.GAEvent}),r=[],e.Errors&&e.Errors.length&&Kobo.$.each(e.Errors,,r.length?M("<ul>"+r.join("")+"</ul>",5e3):E()):"Pending"===e.Status?(F.pollingCount++,F.pollingCount*F.pollingInterval<1e3*F.pollingTimeout?setTimeout(F.pollingInterval):(F.pollingCount=0,Kobo.log("Polling timeout error, taking longer than "+F.pollingTimeout+" seconds to finish processing the payment"),Kobo.Ajax({method:"POST",url:F.logPurchaseTimeoutUrl,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:{purchaseToken:F.purchaseToken,timeoutLength:F.pollingTimeout}}),M(K))):"Use3dSec"===e.Status?(o=e.RedirectUrl,F.purchaseId=e.PurchaseId,F.pollingUrl=e.PollingUrl,C(o)):"Cancelled"===e.Status&&Kobo._modal.close()},error:function(){E()}})},C=function(e){var r=Kobo._purchaseBroker.buildThreeDSecIFrame(e),t=Kobo.$("<div></div>"),e=Kobo.$('<button class="close-button"></button>');t.append(e).append(r),Kobo._modal.open(t.get(0),{customClass:"three-ds"}),e.on("click",S)},F.updatePurchaseSection=function(e){"paymentMethods"===e?F.fire("collapsible::close",{name:"purchaseConfirmation"}):F.fire("collapsible::close",{name:"paymentMethods"}),F.fire("collapsible::open",{name:e})},k=function(e,r){r=r.detail.target;r&&B.scrollTo(Kobo.$(r).offset().top-56,200)},t=_=!(a=function(e,r){"vme"===r.source.selectedPaymentMethod()?F.vmeSelected(!0):F.vmeSelected(!1)}),w=0,B={scrollTo:function(e,r){"small"===F.currentBreakpoint()&&(_&&w<e||(w=Math.max(e,0),_=!0,Kobo.$body.animate({scrollTop:w},{duration:r,complete:)))}},I=function(e){var r=F.availablePaymentMethods&&F.availablePaymentMethods.SuperPoints&&F.availablePaymentMethods.SuperPoints.IsAvailable;void 0!==e&&!0===e?!r||F.isCreditCardAvailable()||F.sufficientPayment()?F.sufficientSuperPoints(!0):F.sufficientSuperPoints(!1):r&&F.haveSuperPointsBeenApplied&&!F.isCreditCardAvailable()&&!F.sufficientPayment()?F.sufficientSuperPoints(!1):F.sufficientSuperPoints(!0)},R=function(e,r){r&&void 0!==r.detail.appliedSuperPoints&&(F.haveSuperPointsBeenApplied=0<r.detail.appliedSuperPoints,I())},d=function(){F.register("regularCheckout::dataLoaded"),F.register("regularCheckout::marshallOrderData"),F.register("regularCheckout::paymentSectionCompleted"),F.register("regularCheckout::updateGrandTotal"),F.register("regularCheckout::updateStoreCreditBalance"),F.register("regularCheckout::updateSufficientPayment"),F.register("regularCheckout::updateButton"),F.register("promoCode::apply"),F.register("regularCheckout::continuePurchaseValid"),F.register("regularCheckout::requestFocus"),F.register("regularCheckout::gaEventTrigger"),F.register("regularCheckout::loadRakutenSuperpoints"),F.register("regularCheckout::showSpinner"),F.register("regularCheckout::hideSpinner"),F.register("regularCheckout::continuePurchase"),F.register("regularCheckout::getCheckoutDetails"),F.register("rakutenSuperPoints::apply"),F.register("regularCheckout::updateRakutenSuperpointsNeededState"),F.register("regularCheckout::updateAppliedRakutenSuperpoints"),F.register("regularCheckout::clearAppliedRakutenSuperpoints")},v=function(){var e=window.DynamicConfiguration;e&&(T=e.resourceStrings.genericPurchasingError,K=e.resourceStrings.purchasingTimeoutMessage,A=e.resourceStrings.initialPurchasingErrorMessage,e.resourceStrings.locationChangeMessage)},G=function(){"small"!==F.currentBreakpoint()&&"medium"!==F.currentBreakpoint()||!F.loadRakutenSuperpoints||Kobo.$(".kobo-main").addClass("add-padding-for-soft-keyboard")},c=function(){var e=F.$gizmo.find(".giftcard-link");F.subscribe("billingInfo::countryChanged",i),F.subscribe("promoCode::apply",s),F.subscribe("paymentOptions::validated",g),F.subscribe("regularCheckout::gaEventTrigger",t),F.subscribe("regularCheckout::updateButton",a),F.subscribe("shoppingCartItems::updated",p),F.subscribe("regularCheckout::updateGrandTotal",f),F.subscribe("regularCheckout::updateStoreCreditBalance",b),F.subscribe("regularCheckout::updateSufficientPayment",m),F.subscribe("regularCheckout::requestFocus",k),F.subscribe("regularCheckout::continuePurchase",n),F.subscribe("creditCard::threeDsSuccess",y),F.subscribe("creditCard::threeDsError",P),F.subscribe("rakutenSuperPoints::apply",R),F.subscribe("regularCheckout::showSpinner",O),F.subscribe("regularCheckout::hideSpinner",U),F.subscribe("regularCheckout::getCheckoutDetails",r),F.$gizmo.on("click",".section-link",function(e){e.preventDefault(),F.updatePurchaseSection(o(this.href))}),e.click(function(){F.fire("giftCards::toggleOpen")})},F.destroy=function(){F.$gizmo.find(".giftcard-link").off("click"),F.$gizmo.off("click",".section-link"),F.unSubscribe("creditCard::threeDsError",P),F.unSubscribe("creditCard::threeDsSuccess",y),F.unSubscribe("regularCheckout::requestFocus",k),F.unSubscribe("regularCheckout::updateSufficientPayment",m),F.unSubscribe("regularCheckout::updateStoreCreditBalance",b),F.unSubscribe("regularCheckout::updateGrandTotal",f),F.unSubscribe("regularCheckout::showSpinner",O),F.unSubscribe("regularCheckout::hideSpinner",U),F.unSubscribe("regularCheckout::continuePurchase",n),F.unSubscribe("shoppingCartItems::updated",p),F.unSubscribe("paymentOptions::validated",g),F.unSubscribe("promoCode::apply",s),F.unSubscribe("billingInfo::countryChanged",i),F.unSubscribe("regularCheckout::getCheckoutDetails",r),F.unSubscribe("rakutenSuperPoints::apply",R)},function(){var e=u.querySelector(".error.high-level"),r=u.querySelector(".grand-total"),t=u.querySelector(".checkout"),o=u.querySelector(".edit-payment-info"),a=(u.querySelector(".promo-code-giftcard-link"),u.querySelector("#promoCodeContainer")),i=u.querySelector("#priceContainer"),n=u.querySelector(".insufficient-superpoints-error"),s=u.querySelector("#rakutenSuperPointsPanel");F.currentStatusUrl=l.currentStatusUrl,F.applyGiftCardUrl=l.applyGiftCardUrl,F.changeCountryUrl=l.changeCountryUrl,F.continuePurchaseUrl=l.continuePurchaseUrl,F.applyPromoCodeUrl=l.applyPromoCodeUrl,F.applyRgiSuperPointsUrl=l.applyRgiSuperPointsUrl,F.logPurchaseTimeoutUrl=l.logPurchaseTimeoutUrl,F.continueValidRedirectUrl=l.continueValidRedirectUrl,F.loadRakutenSuperpoints=ko.observable(!1),F.buyUrl="",F.pollingUrl="",F.pollingInterval=1e3,F.pollingCount=0,F.pollingTimeout=90,F.purchaseToken=l.purchaseToken,F.emptyCartRedirectUrl=l.emptyCartRedirectUrl,F.inBuyProcess=ko.observable(!1),F.disabled=ko.observable(!1),F.grandTotal=ko.observable(),F.giftCardFormVisible=ko.observable(!1),F.storeCreditApplied=ko.observable(),F.storeCreditBalance=ko.observable(),F.sufficientPayment=ko.observable(!1),F.hasKoboLoveMemberships=ko.observable(!1),F.vmeSelected=ko.observable(!1),F.sufficientSuperPoints=ko.observable(!0),F.availablePaymentMethods=[],F.isCreditCardAvailable=ko.observable(!1),F.haveSuperPointsBeenApplied=!1,F.purchaseMode=l.PurchaseMode,F.isKwlPromotion=ko.observable("undefined"!==l.IsKwlPromotion&&"true"===String(l.IsKwlPromotion).toLowerCase()),F.topLevelWarningMessages=ko.observableArray(),v(),d(),c(),G(),F.fire("regularCheckout::getCheckoutDetails",{navigatePurchaseSection:!0}),e&&ko.applyBindings(F,e),r&&ko.applyBindings(F,r),t&&ko.applyBindings(F,t),o&&ko.applyBindings(F,o),a&&ko.applyBindings(F,a),i&&ko.applyBindings(F,i),n&&ko.applyBindings(F,n),s&&ko.applyBindings(F,s),Kobo.$(".continue-area").each(}()},Kobo.Gizmo.RegularCheckout.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";function ownKeys(t,e){var i,o=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,i)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(:Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}!function(p){unction e(e,t,i){p.Gizmo.apply(this,arguments),this.setType("ShoppingCartItems"),this.StageSelectionVM=i,this.modalOptions={theme:"light"};i=t&&t.fetchItemsUrl||"";this.fetchItemsUrl=i,this.shoppingCartList=new r(this.StageSelectionVM,i,t.addItemUrl),this.itemAddSucceededCount=0,this.itemAddFailedCount=0,this.fireUpdatedEvent=this.fireUpdatedEvent.bind(this),this.onFetchItems=this.onFetchItems.bind(this),this.onUpdate=this.onUpdate.bind(this),this.onAddItem=this.onAddItem.bind(this),this.onAddSeriesItems=this.onAddSeriesItems.bind(this),this.setupHandlers(),ko.applyBindings(this.shoppingCartList,e)}function r(e,t,i){var o=this;this.fetchItemsUrl=t,this.addItemUrl=i,this.StageSelectionVM=e,this.items=ko.observableArray([]),this.dealsSummaryArray=ko.observableArray([]),this.regularItems=ko.computed(function(){return ko.utils.arrayFilter(o.items(),}),this.groupedDealItems=ko.computed(function(){var e=[];if(!o.dealsSummaryArray)return e;for(var t=0;t<o.dealsSummaryArray().length;t++){var i=new a(o.dealsSummaryArray()[t]);i.items(ko.utils.arrayFilter(o.items(),),e.push(i)}return e}),this.containsInvalidItems=ko.computed(function(){return ko.utils.arrayFirst(o.items(),}),this.preOrderItems=ko.computed(function(){return ko.utils.arrayFilter(o.items(),}),this.hasPreOrder=ko.computed(,this.preOrderMessage=ko.computed(function(){return o.hasPreOrder()?o.preOrderItems()[0].infoMessage:""}),this.notification=new n,this.removeItemInline=this.removeItemInline.bind(this)}function s(e,t){var a=this;if(null==e)throw"An id must be provided for a shopping cart item";this.id=e,this.title=ko.observable(""),this.subTitle=ko.observable(""),this.imageUrl=ko.observable(""),this.seriesName=ko.observable(""),this.authors=ko.observable([]),this.ProductType=ko.observable(""),this.type=ko.observable(),this.publisher=ko.observable(""),this.hasKoboLoveDiscount=ko.observable(""),this.isAudiobookSubscription=ko.observable(!1),this.isMonetaryGift=ko.observable(!1),this.configurationId=ko.observable(""),this.isBookSubscription=ko.observable(!1),this.isTrial=ko.observable(!1),this.isKoboLoveProduct=ko.observable(""),this.offersText=ko.observable(""),this.publisherCheckboxVisible=ko.observable(""),this.hasOptedInForOffers=ko.observable(t),this.isPreOrder=ko.observable(!1),this.availableOnDate=ko.observable(),this.narrators=ko.observable([]),this.duration=ko.observable(""),this.secondaryMessage=ko.observable(""),this.recommendationKey=ko.observable(""),this.restricted=ko.observable(!1),this.removeItemUrl=ko.observable(!1),this.editItemUrl=ko.observable(""),this.itemDetailUrl=ko.observable(""),this.updateSubscriptionUrl=ko.observable(""),this.errorMessage=ko.observable(""),this.infoMessage=ko.observable(""),this.description=ko.observable(""),this.descriptionFullName=ko.observable(""),this.priceDetails=ko.observableArray([]),this.dealsFound=ko.observable(),this.isKoboLoveMembership=ko.observable(!1),this.availableInCurrentGeo=ko.observable(!1),this.appliedNewCustomerPromotion5Message=ko.observable(""),this.priceAfterNewCustomerPromotionCredit=ko.observable(""),this.hasAudiobookSubscriptionDiscount=ko.observable(!1),this.attributes=ko.observable({}),this.isAudiobookProduct=ko.observable(!1),this.isEBookProduct=ko.observable(!1),this.additionalProductInfo=ko.computed(function(){return a.isEBookProduct()?a.additionalBookInfo():a.isAudiobookProduct()?a.additionalAudiobookInfo():{}}),this.additionalBookInfo=ko.computed(function(){var e=p.Enums,t=e.ProductFormat,i=e.BookLayout,o=e.ProductType,r=a.attributes(),s=r.ProductFormatType,e=r.BookLayoutType,r=a.type(),s=t.Extensions.mapToResourceString(t.parseFromServer(s)),e=i.Extensions.mapToResourceString(i.parseFromServer(e)),r=o.Extensions.mapToResourceString(r),e=s&&e?"(".concat(s,", ").concat(e,")"):"";return"".concat(r," ").concat(e)}),this.additionalAudiobookInfo=ko.computed(function(){var e=p.Enums.ProductType,t=DynamicConfiguration.resourceStrings,i=a.attributes().IsAbridged,o=a.type(),t=i?t.abridged:t.unabridged,o=e.Extensions.mapToResourceString(o);return"".concat(o," (").concat(t,")")}),this.hasOptedInForOffers.subscribe(function(){var t=this;p.Ajax({method:"POST",url:this.updateSubscriptionUrl(),dataType:"json",data:JSON.stringify({productId:this.id,hasOptedInForRenewals:!1,hasOptedInForOffers:this.hasOptedInForOffers()}),contentType:"application/json; charset=utf-8",success:error:function(){}})})}function a(e){this.name=ko.observable(e.DealName),this.originalPrice=ko.observable(e.OriginalPrice),this.discountedPrice=ko.observable(e.DiscountedPrice),this.id=e.DealId,this.index=e.DealIndex,this.items=ko.observableArray([])}function d(e,t,i,o,r,s,a,n){this.label=e,this.amount=t,this.isCredit=i,this.isTotal=o,this.isTotalSavings=r,this.isBookSubSummary=s,this.verboseLabel=function(){var e=(this.isCredit?"-":"")+this.amount;return this.label&&this.isBookSubSummary?this.label:e},this.isNewCustomerPromotionAvailable=a,this.isPriceAfterNewCustomerCredit=n}e.prototype=p.chainPrototype(p.Gizmo.prototype)).showError=function(e){var t=_objectSpread(_objectSpread({},this.modalOptions),{},{customClass:"error-dialog"});p._modal.open("<p>"+e+"</p>",t),setTimeout(p._modal.close,2500)},e.prototype.onFetchItems=e.prototype.updateCart=function(e){var t=!1;if(e.cartItems){this.shoppingCartList.replaceItems(e.cartItems);var t=!0,i=!1,o=!1;if(1===e.cartItems.length&&e.cartItems[0].IsKoboLoveMembership)o=i=!0;else for(var r=1;r<e.cartItems.length;r++)if(this.IsKoboLoveMembership){i=!0;break}this.fire("shoppingCartItems::changedKoboLoveMembership",{vipMembershipInCart:i,onlyVipInCart:o,showKoboLoveVipUpsell:e.showKoboLoveVipUpsell,koboLoveVipUpsellProductId:e.koboLoveVipUpsellProductId,vipMessage:e.vipMessage})}e.deals&&(this.shoppingCartList.setDealsSummaryArray(e.deals),t=!0),e.priceSummary&&this.fire("priceSummary::update",{lineItems:e.priceSummary,rakutenSuperPointsEarned:e.RakutenSuperPointsEarned}),e.Total&&this.fire("regularCheckout::updateGrandTotal",{grandTotal:e.Total}),t&&this.fireUpdatedEvent()},e.prototype.onUpdate=e.prototype.onAddItem=function(e,t){p.Object.parseBool(t.detail.ageVerificationRequired)&&(this.initialAgeVerificationRequired=!0),this.shoppingCartList.addItem({productId:t.detail.productId,purchaseToken:t.detail.purchaseToken,isKoboLoveMembership:void 0!==t.detail.isKoboLoveMembership&&t.detail.isKoboLoveMembership,suppressToast:t.detail.suppressToast,ageVerificationRequired:t.detail.ageVerificationRequired,itemPromotionAvailable:t.detail.itemPromotionAvailable,caller:t.detail.caller},this.fireUpdatedEvent)},e.prototype.onAddSeriesItems=function(e,i){var o=this,t=$.Deferred(),r=t.promise(),s=0;$.each(i.detail.series,function(e,t){r=r.then(function(){return o.shoppingCartList.addItem({productId:t,suppressToast:++s<i.detail.series.length,caller:p.Enums.ShoppingCart.Source.AddSeries},function(e){"error"==e&&o.itemAddFailedCount++})})}),t.resolve(),r.done(function(){p._mediator.fire("seriesDrawer::seriesAddComplete"),o.fireAddSeriesToast()})},e.prototype.fireAddSeriesToast=function(){0<this.itemAddSucceededCount&&0==this.itemAddFailedCount?p._mediator.fire("toast::success",{message:p.Utilities.stringFormat(DynamicConfiguration.resourceStrings.addedXItemsToCart,this.itemAddSucceededCount)}):0==this.itemAddSucceededCount&&0<this.itemAddFailedCount?p._mediator.fire("toast::error",{message:p.Utilities.stringFormat(DynamicConfiguration.resourceStrings.errorAddedXItemsToCart,this.itemAddFailedCount)}):0<this.itemAddSucceededCount&&0<this.itemAddFailedCount&&p._mediator.fire("toast::warning",{message:p.Utilities.stringFormat(DynamicConfiguration.resourceStrings.warningAddedXItemsToCart,this.itemAddSucceededCount,this.itemAddFailedCount)}),this.itemAddSucceededCount=0,this.itemAddFailedCount=0},e.prototype.fireUpdatedEvent=function(){var e=this.shoppingCartList.items().map(function(e){return{recommendationKey:e.recommendationKey(),id:e.id,availableInCurrentGeo:e.availableInCurrentGeo()}});this.fire("shoppingCartItems::updated",{items:e})},e.prototype.setupHandlers=function(){this.register("shoppingCartItems::fetchItems"),this.register("shoppingCartItems::addItem"),this.register("shoppingCartItems::addSeriesItems"),this.register("shoppingCartItems::update"),this.register("shoppingCartItems::updated"),this.register("shoppingCartItems::readyForRecos"),this.register("shoppingCartItems::changedKoboLoveMembership"),this.register("shoppingCartItems::removeItem"),this.register("ageVerificationCheck"),this.subscribe("shoppingCartItems::fetchItems",this.onFetchItems),this.subscribe("shoppingCartItems::update",this.onUpdate),this.subscribe("shoppingCartItems::addItem",this.onAddItem),this.subscribe("shoppingCartItems::addSeriesItems",this.onAddSeriesItems)},e.prototype.destroy=function(){this.unSubscribe("shoppingCartItems::addItem",this.onAddItem),this.unSubscribe("shoppingCartItems::update",this.onUpdate),this.unSubscribe("shoppingCartItems::fetchItems",this.onFetchItems),this.unRegister("shoppingCartItems::fetchItems"),this.unRegister("shoppingCartItems::addItem"),this.unRegister("shoppingCartItems::update"),this.unRegister("shoppingCartItems::updated"),this.register("shoppingCartItems::readyForRecos"),this.unRegister("shoppingCartItems::changedKoboLoveMembership"),this.unRegister("shoppingCartItems::removeItem")},(r.prototype={}).setDealsSummaryArray=function(e){if(e){this.dealsSummaryArray.removeAll();for(var t=0;t<e.length;t++)this.dealsSummaryArray.push(e[t])}},r.prototype.addItemWithDetails=function(e){var t=new s(e.Id,e.PublisherCheckboxCheckedByDefault);t.CurrentStage="function"==typeof this.StageSelectionVM?this.StageSelectionVM().currentStage:null,t.title(e.Title),t.subTitle(e.SubTitle),t.imageUrl(e.ImageUrl),t.seriesName(e.SeriesName),t.authors(e.Authors),t.ProductType(e.ProductType),t.publisher(e.Publisher),t.offersText(e.OffersText),t.publisherCheckboxVisible(e.PublisherCheckboxVisible),t.secondaryMessage(e.SecondaryMessage),t.recommendationKey(e.RecommendationKey),t.restricted(e.Restricted),t.errorMessage(e.ErrorMessage),t.hasKoboLoveDiscount(e.HasKoboLoveDiscount),t.infoMessage(e.InfoMessage),t.description(e.Description),t.removeItemUrl(e.RemoveItemUrl),t.editItemUrl(e.EditItemUrl),t.descriptionFullName(e.DescriptionFullName),t.isPreOrder(e.IsPreOrder),t.isAudiobookSubscription(e.IsAudiobookSubscription),t.isMonetaryGift(e.IsMonetaryGift),t.configurationId(e.ConfigurationId),t.isBookSubscription(e.IsBookSubscription),t.isTrial(e.IsTrial),t.availableOnDate(e.AvailableOnDate),t.isKoboLoveMembership(e.IsKoboLoveMembership),t.availableInCurrentGeo(e.AvailableInCurrentGeo),t.narrators(e.Narrators),t.hasAudiobookSubscriptionDiscount(e.HasAudiobookSubscriptionDiscount),null!=e.Type&&t.type(p.Enums.ShoppingCart.ParseProductTypeFromServer(e.Type)),t.isAudiobookProduct(p.Enums.ProductType.parseFromServer(e.Type)===p.Enums.ProductType.Audiobook),t.isEBookProduct(p.Enums.ProductType.parseFromServer(e.Type)===p.Enums.ProductType.Book),t.attributes(_objectSpread({},e.Attributes)),e.DealId&&(t.deal={id:e.DealId,index:e.DealIndex}),e.ItemDetailUrl&&t.itemDetailUrl(e.ItemDetailUrl),t.updateSubscriptionUrl(e.UpdateSubscriptionUrl);var i=!1;e.AppliedNewCustomerPromotion5Message&&(i=!0),e.PriceDetails&&(p.$.each(e.PriceDetails,function(){t.addPriceDetail(this.Label,this.Amount,this.IsCredit,this.IsTotal,this.IsTotalSavings,this.IsBookSubSummary,i,!1)}),e.PriceAfterNewCustomerPromotionCredit&&t.addPriceDetail("",e.PriceAfterNewCustomerPromotionCredit,!1,!1,!1,!1,!1,!0)),t.dealsFound(e.DealsFound),t.appliedNewCustomerPromotion5Message(e.AppliedNewCustomerPromotion5Message),this.items.push(t)},r.prototype.fetchItems=function(e){p.Ajax({method:"GET",url:e,dataType:"json",contentType:"application/json; charset=utf-8",data:{},cache:!1,headers:{__RequestVerificationToken:o()},success:function(e){p._mediator.fire("shoppingCartItems::update",{cartItems:e.CartItems,deals:e.Deals,priceSummary:e.PriceSummary,koboLovePricingEnabled:e.KoboLoveDiscountsEnabled,koboLovePointsEnabled:e.KoboLovePointsEnabled,vipMessage:e.VipMessage})},error:function(){}})},r.prototype.replaceItems=function(e){var t=this;this.items.removeAll(),e&&e.forEach(},r.prototype.fireReadyForRecosEvent=function(){0<this.items().length&&p._mediator.fire("shoppingCartItems::readyForRecos")},r.prototype.addItem=function(e,t,i){if(!p._AgeVerification.isRequired(e.ageVerificationRequired))return this.doAddItem(e,t,i);p._mediator.fire("ageVerificationCheck",_objectSpread(_objectSpread({},e),{},{caller:"shoppingCartItems::addItem"}))},r.prototype.doAddItem=function(n,d,u){var c=this;return p.Ajax({method:"POST",url:this.addItemUrl,dataType:"json",headers:{__RequestVerificationToken:o()},data:JSON.stringify({Id:n.productId,PurchaseToken:n.purchaseToken,IsKoboLoveMembership:n.isKoboLoveMembership,Caller:p.Enums.ShoppingCart.Source.convertToServer(n.caller)}),contentType:"application/json; charset=utf-8",success:function(e){var t,i,o,r,s,a;e.IsSuccess?(c.addItemWithDetails(e.ItemDetails),p._mediator.fire("koboLove::updateDetails",{amountSaved:e.KoboLoveDiscountAmount,pointsEarned:e.KoboLovePointsEarned,basePointsEarned:e.KoboLoveBasePointsEarned,bonusPointsEarned:e.KoboLoveBonusPointsEarned,pointsBalance:e.KoboLovePointsBalance,showPointsEarnedBreakdown:e.KoboLoveSummaryHasBonusPoints,vipUpsellText:e.VipUpsellText}),t=e.ItemDetails&&e.ItemDetails.IsKoboLoveMembership,e.IsUserVip,a=p.$("[data-kobo-gizmo=DealWidget]").length,o=c.dealsSummaryArray().length,c.initialAgeVerificationRequired&&(c.fetchItems(c.fetchItemsUrl),c.initialAgeVerificationRequired=!1),p._mediator.fire("shoppingCartItems::update",{cartItems:e.CartItems,deals:e.Deals,priceSummary:e.PriceSummary,total:e.Total,koboLovePricingEnabled:e.KoboLoveDiscountsEnabled,koboLovePointsEnabled:e.KoboLovePointsEnabled,vipMessage:e.VipMessage}),c.fireReadyForRecosEvent(),r=c.dealsSummaryArray().length>o,i=e.ItemDetails&&e.ItemDetails.DealsFound,o=n.suppressToast,i?r?(s=p.$("<div>"+DynamicConfiguration.resourceStrings.dealNotificationCompleted+" </div>"),r=p.$('<span class="primary-link">'+DynamicConfiguration.resourceStrings.viewCart+"</span>"),s.append(r),r.click(,p.Utilities.buildAddToCartNotification.open("deal",s)):a?p._mediator.fire("toast::info",{message:DynamicConfiguration.resourceStrings.addedToCart}):(s=p.$("<div>"+DynamicConfiguration.resourceStrings.dealNotificationEligible+"</div>"),e.DealLandingPageUrl&&(a=p.$('<span> <a class="primary-link" href="'+e.DealLandingPageUrl+'">'+DynamicConfiguration.resourceStrings.viewDeal+"</a></span>"),s.append(a)),p.Utilities.buildAddToCartNotification.open("deal",s)):t&&!o?c.showVipAddedToCartNotification():o||p._mediator.fire("toast::info",{message:DynamicConfiguration.resourceStrings.addedToCart}),e.Total&&p._mediator.fire("regularCheckout::updateGrandTotal",{grandTotal:e.Total}),p._mediator.fire("priceSummary::update",{lineItems:e.PriceSummary}),d&&d(),p._mediator.fire("ItemPromoOfferBanner::showNewCustomerCreditNotification",{itemPromotionAvailable:e.itemPromotionAvailable,showCreditAppliedBanner:e.ShowCreditAppliedBanner,showItemAddedToCartBanner:e.ShowItemAddedToCartBanner})):(u&&u(e.MessageType),"error"===e.MessageType?p._mediator.fire("toast::error",{message:e.ErrorMessage}):"info"!==e.MessageType||n.suppressToast||p._mediator.fire("toast::info",{message:e.ErrorMessage}))},error:function(){u&&u(),p._mediator.fire("toast::error",{message:DynamicConfiguration.resourceStrings.errorAddedToCart})}})},r.prototype.showVipAddedToCartNotification=function(){p._mediator.fire("toast::info",{message:DynamicConfiguration.resourceStrings.loveNotificationTitle})},r.prototype.removeItemAjaxRequest=function(t){var i=this,e=t.removeItemUrl();e?p.Ajax({method:"POST",url:e,dataType:"json",headers:{__RequestVerificationToken:o()},data:JSON.stringify({Id:t.id,IsKoboLoveMembership:t.isKoboLoveMembership()}),contentType:"application/json; charset=utf-8",success:function(e){e.IsSuccess?(p._mediator.fire("shoppingCartItems::update",{cartItems:e.CartItems,deals:e.Deals,priceSummary:e.PriceSummary,total:e.Total,koboLovePricingEnabled:e.KoboLoveDiscountsEnabled,koboLovePointsEnabled:e.KoboLovePointsEnabled,showKoboLoveVipUpsell:e.ShowKoboLoveVipUpsell,vipMessage:e.VipMessage}),i.fireReadyForRecosEvent(),p._mediator.fire("regularCheckout::updateStoreCreditBalance",{storeCreditBalance:e.StoreCreditBalance}),p._mediator.fire("koboLove::updateDetails",{amountSaved:e.KoboLoveDiscountAmount,pointsEarned:e.KoboLovePointsEarned,basePointsEarned:e.KoboLoveBasePointsEarned,bonusPointsEarned:e.KoboLoveBonusPointsEarned,pointsBalance:e.KoboLovePointsBalance,showPointsEarnedBreakdown:e.KoboLoveSummaryHasBonusPoints,vipUpsellText:e.VipUpsellText})):t.errorMessage(e.ErrorMessage),p._mediator.fire("priceSummary::update",{lineItems:e.PriceSummary})},error:function(){}}):p._mediator.fire("shoppingCartItems::removeItem",{item:t})},r.prototype.removeItemInline=function(e){var t=this;e.isDealItem()?this.warnOnRemovingDeal(e).done(function(){t.removeItemAjaxRequest(e)}):e.isKoboLoveMembership()?this.warnOnRemovingKoboLoveMembership().done(function(){t.removeItemAjaxRequest(e)}):this.removeItemAjaxRequest(e)},r.prototype.editItemInline=r.prototype.warnOnRemovingDeal=function(e){for(var t,i,o=this.dealsSummaryArray(),r=p.$.Deferred(),s=e.deal.id,a=0;a<o.length;a++)s===(t=o[a]).DealId&&(i=t.DealName);return p.Utilities.showDialog({title:DynamicConfiguration.resourceStrings.removeDialogTitle,content:p.Utilities.stringFormat(DynamicConfiguration.resourceStrings.removeDialogMessage,i),buttons:[{label:DynamicConfiguration.resourceStrings.removeItem,action:function(){r.resolve()}},{label:DynamicConfiguration.resourceStrings.keepItem}]}),r},r.prototype.warnOnRemovingKoboLoveMembership=function(){var e=p.$.Deferred();return p.Utilities.showDialog({title:DynamicConfiguration.resourceStrings.vipRemoveTitle,content:DynamicConfiguration.resourceStrings.vipRemoveMessage,buttons:[{label:DynamicConfiguration.resourceStrings.vipRemoveNegativeAction,action:function(){e.resolve()}},{label:DynamicConfiguration.resourceStrings.vipRemovePositiveAction}]}),e},(s.prototype={}).addPriceDetail=s.prototype.isDealItem=s.prototype.displayAsAudiobookTrialSubscriptionBanner=function(){return this.isAudiobookSubscription()&&this.isTrial()},s.prototype.displayAsKoboPlusTrialSubscriptionBanner=(n.prototype={}).buildNotification=function(){var e=p.$('<button class="close" type="button" aria-label="'.concat(DynamicConfiguration.resourceStrings.close,'"/>')),t=p.$('<div class="deal-notification-text-wrapper"></div>');$notificationWrapper=p.$('<div class="deal-notification"><div class="logo-circle"/></div>'),$notificationText=p.$('<div class="deal-notification-text"></div>'),t.append($notificationText),t.append(e),$notificationWrapper.append(t),e.click(cartSelf.notification.close),p.$body.append($notificationWrapper),this.$notificationText=this.$notificationText,this.$notificationWrapper=this.$notificationWrapper},n.prototype.open=function(e){this.$notificationWrapper||buildNotification(),this.$notificationText.html(e),this.$notificationWrapper.addClass("show")},n.prototype.close=function(){this.$notificationWrapper.removeClass("show")},p.Gizmo.ShoppingCartItems=e}(Kobo);
"use strict";Kobo.Gizmo.KoboLoveMembershipUpsell=function(e,s){var i,p,t,l=this;Kobo.Gizmo.apply(this,arguments),l.setType("KoboLoveMembershipUpsell"),i=function(o,e){void 0!==e.detail&&e.detail.showKoboLoveVipUpsell&&(1===(e=e.detail.showKoboLoveVipUpsell)?l.show(!1):2===e&&l.show(!0))},p=function(o,e){e.detail&&void 0!==e.detail.vipUpsellText&&l.message(e.detail.vipUpsellText)},t=function(o,e){e.detail.cartItems.length<=0?l.show(!1):e.detail.showKoboLoveVipUpsell&&(1===(e=e.detail.showKoboLoveVipUpsell)?l.show(!1):2===e&&l.show(!0))},l.addKoboLoveMembership=function(){l.fire("shoppingCartItems::addItem",{productId:s.vipMembershipProductId,purchaseToken:s.purchaseToken,isKoboLoveMembership:!0,suppressToast:!0}),l.show(!1)},function(){var o=Kobo.Object.parseBool(s.isVip);l.show=ko.observable(Kobo.Object.parseBool(""!==s.vipUpsellText)),l.message=ko.observable(s.vipUpsellText),!o&&l.show()&&(l.subscribe("shoppingCartItems::changedKoboLoveMembership",i),l.subscribe("koboLove::updateDetails",p),l.subscribe("shoppingCartItems::update",t)),ko.applyBindings(l,e)}()},Kobo.Gizmo.KoboLoveMembershipUpsell.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.VatNumber=function(e,r){var t,i,a,l,o,u,n,d,s=this;Kobo.Gizmo.apply(this,arguments),s.setType("VatNumber"),t=function(){Kobo.$(e).addClass("hide")},i=a=l=function(e){void 0!==s.errorElem&&(""===e||"string"!=typeof e?a():(s.errorElem.html(e),s.errorElem.removeClass("hide")))},o=function(e,r){void 0!==r&&void 0!==r.detail&&null!=r.detail.errorMessage?l(r.detail.errorMessage):a()},u=function(e,r){var o;void 0!==r&&void 0!==r.detail&&void 0!==r.detail.addressFields&&(o=null,Kobo.$.each(r.detail.addressFields,function(e,r){if("VatNumber"==r.Name)return o=r,!1}),null!==o&&(o.Visible?(""!==o.Value&&"string"==typeof o.Value&&s.inputElem.val(o.Value),""!==o.Label&&"string"==typeof o.Label&&s.inputElem.attr("placeholder",o.Label),void 0!==o.Error&&null!==o.Error?l(o.Error):a(),i()):t()))},n=function(e,r){r.detail.orderData.VatNumber=s.inputElem.val()},d=function(){s.register("vatNumber::updateError"),s.subscribe("vatNumber::updateError",o),s.subscribe("billingInfo::update",u),s.subscribe("regularCheckout::marshallOrderData",n)},s.destroy=function(){s.unSubscribe("vatNumber::updateError",o),s.unSubscribe("billingInfo::update",u),s.unSubscribe("regularCheckout::marshallOrderData",n)},function(){s.inputElem=Kobo.$("."+r.inputSelector),s.errorElem=Kobo.$(e).find("."+r.errorSelector),d()}()},Kobo.Gizmo.VatNumber.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";!function(o){function t(t,i){o.Gizmo.apply(this,arguments),this.setType("CartRecommendationsGrid"),this.$preloader=this.$el.find(".ajax-preloader"),this.$recommendationList=this.$el.find(".recommendation-list");var e=new o.ViewModel.CartRecommendationsGrid(this);ko.applyBindings(e,t)}function i(t){this.gizmo=t,this.settings=this.gizmo.settings,o.ViewModel.Base.apply(this,[this.gizmo.el,this.settings]),this.setType("CartRecommendationsViewModel"),this.$preloader=this.$el.find(".ajax-preloader"),this.items=ko.observableArray([]),this.isFetching=ko.observable(!1),this.itemHeight=null,this.itemWidth=null,this.transitionIn=null,this.transitionOut=null,this.transitionTiming=1e3,this.onUpdate=this.onUpdate.bind(this),this.transitionSetup(),this.setupHandlers(),this.setupEvents()}function e(t,i){var e=this;this.gizmo=i,this.id=ko.observable(t.Id),this.imageUrl=ko.observable(t.ProductImage),this.ageVerificationRequired=ko.observable(t.AgeVerificationRequired),this.productDetail=ko.observable(t.ProductDetail),this.price=ko.observable(t.IsKoboLove?t.KoboLovePrice:t.OurPrice),this.isKoboLoveEligible=ko.observable(t.IsKoboLoveEligible),this.title=ko.observable(t.Title),this.itemDataTrack=ko.computed(,this.addToCart=this.addToCart.bind(this)}t.prototype=o.chainPrototype(o.Gizmo.prototype),(i.prototype=o.chainPrototype(o.ViewModel.Base.prototype)).setupEvents=function(){this.gizmo.register("cartRecommendations::updated")},i.prototype.transitionSetup=function(){var i=this.transitionTiming,e=this.gizmo.$preloader;Modernizr.csstransitions?(this.transitionIn=function(t){t.isTransitionIn=!0,t.css({display:"block",opacity:"1"}),e.removeClass("no-display")},this.transitionOut=function(t){e.addClass("no-display"),t.isTransitionIn=!1,t.css({opacity:"0"})}):(this.transitionIn=function(t){t.fadeIn(i)},this.transitionOut=function(t){t.fadeOut(i)})},i.prototype.startAjax=function(){this.transitionIn(this.gizmo.$preloader),this.transitionOut(this.gizmo.$recommendationList)},i.prototype.endAjax=i.prototype.calcItemHeight=function(t,i){(i||o.Object.isNullOrEmpty(this.itemHeight))&&0<t&&(t=this.gizmo.$recommendationList.find("li:first"),this.itemHeight=t.outerHeight(!0),this.itemWidth=t.width())},i.prototype.layoutItems=function(t){this.calcItemHeight(this.items().length,t);var i=this.gizmo.$recommendationList,e=i.find("li"),t=i.width(),t=Math.floor(t/this.itemWidth),o=Math.min(e.length,t),s=0;e.each(function(t,i){i=$(i);t%o==0&&(i.css({"padding-left":"0"}),s++)});e=this.settings.rows[this.gizmo.currentBreakpoint()],e=Math.min(e,s)*this.itemHeight;i.height(e)},i.prototype.onUpdate=function(t){var i=this;this.startAjax(),o.Ajax({cache:!1,url:this.settings.url,success:function(t){t.result&&(t=t.data.Items,i.items.removeAll(),t.forEach(function(t){i.items.push(new o.ViewModel.CartRecommendationItem(t,i.gizmo))}))},error:function(t){o.log(t)},complete:function(){i.endAjax(),i.layoutItems(!1),i.gizmo.fire("cartRecommendations::updated")}})},i.prototype.setupHandlers=function(){var t=this;this.subscribe("shoppingCartItems::readyForRecos",this.onUpdate),this.subscribe("shoppingCart::opening",this.onUpdate),this.subscribe("shoppingCartItems::closing",this.onUpdate),this.events.onResize(function(){setTimeout(500)})},(e.prototype=o.chainPrototype(o.ViewModel.Base.prototype)).addToCart=function(){this.gizmo.fire("shoppingCartItems::addItem",{productId:this.id(),ageVerificationRequired:this.ageVerificationRequired()})},o.Gizmo.CartRecommendationsGrid=t,o.ViewModel.CartRecommendationsGrid=i,o.ViewModel.CartRecommendationItem=e}(Kobo);
"use strict";!function(a){function i(){this.itemLength=ko.observable(0),this.containsKoboLoveMembership=ko.observable(!1),this.priceAndPointsEnabled=ko.observable(!1),this.vipMessage=ko.observable(""),this.shoppingCartNavigatorPopupVM=ko.observable({cssClass:"large-view",links:[{text:DynamicConfiguration.resourceStrings.closeShoppingCartNavigateToHeader,destinationId:"shopping-cart-button-area",callBack:function(){return a._mediator.fire("richHeader::hideShoppingCart"),!0}},{text:DynamicConfiguration.resourceStrings.closeShoppingCartNavigateToContent,destinationId:"main-content",callBack:function(){return a._mediator.fire("richHeader::hideShoppingCart"),!0}}]})}function t(t,e){a.Gizmo.apply(this,arguments),this.setType("ShoppingCart"),this.cartExpandable=null,this.$cartToggleButton=a.$(".rich-header-shopping-cart"),this.$cartDrawer=a.$(".cart-drawer"),this.$checkoutButton=a.$(".cart-actions .primary-button"),this.$closeCart=this.$gizmo.find(".close-cart"),this.onToggle=this.onToggle.bind(this),this.onSizeAdjusted=this.onSizeAdjusted.bind(this),this.onRecommendationsUpdated=this.onRecommendationsUpdated.bind(this),this.onGizmosInitialized=this.onGizmosInitialized.bind(this),this.onCartUpdate=this.onCartUpdate.bind(this),this.onCartUpdated=this.onCartUpdated.bind(this),this.onKoboLoveMembershipChanged=this.onKoboLoveMembershipChanged.bind(this),this.onResize=this.onResize.bind(this),this.onClose=this.onClose.bind(this),this.shoppingCart=new i,this.registerEvents(),this.setupHandlers(),ko.applyBindings(this,t)}i.prototype={},(t.prototype=a.chainPrototype(a.Gizmo.prototype)).onToggle=function(t,e){var i=this,o=!this.cartExpandable.viewModel.isCollapsed(),s=e&&e.detail&&void 0!==e.detail.toggle&&"boolean"===a.Object.typeOf(e.detail.toggle)?e.detail.toggle:!o,n=!0;e&&e.detail&&void 0!==e.detail.scrollPage&&"boolean"===a.Object.typeOf(e.detail.scrollPage)&&(n=e.detail.scrollPage),e=a.$window.scrollTop()>this.$el.offset().top+this.$el.outerHeight(),o=s!==o,n&&e?(this.animationComplete=!1,a.$("html, body").animate({scrollTop:0},{duration:400,complete:function(){!1===i.animationComplete&&(i.animationComplete=!0,i.cartExpandable.viewModel.toggle(s))}})):this.cartExpandable.viewModel.toggle(s),s&&o?(this.fire("shoppingCart::opening"),this.$cartDrawer.addClass("open"),this.$cartToggleButton.addClass("cart-open")):!s&&o&&(this.fire("shoppingCart::closing"),this.$cartDrawer.removeClass("open"),this.$cartToggleButton.removeClass("cart-open"))},t.prototype.onCartUpdate=function(t,e){void 0!==e.detail.koboLovePointsEnabled&&void 0!==e.detail.koboLovePricingEnabled&&this.shoppingCart.priceAndPointsEnabled(e.detail.koboLovePointsEnabled&&e.detail.koboLovePricingEnabled)},t.prototype.onCartUpdated=function(t,e){e.detail.priceLineItems&&this.shoppingCart.priceLineItems(e.detail.priceLineItems),this.shoppingCart.itemLength(e.detail.items.length),this.cartExpandable.viewModel.isCollapsed()||this.cartExpandable.viewModel.toggle(!0)},t.prototype.onKoboLoveMembershipChanged=function(t,e){void 0!==e.detail&&void 0!==e.detail.vipMembershipInCart&&(this.shoppingCart.containsKoboLoveMembership(e.detail.vipMembershipInCart),this.shoppingCart.vipMessage(e.detail.vipMessage))},t.prototype.onRecommendationsUpdated=function(){this.cartExpandable.viewModel.isCollapsed()||this.cartExpandable.viewModel.toggle(!0)},t.prototype.onGizmosInitialized=function(){for(var t=0;t<this.ancestors.length;t++){var e=this.ancestors[t];if(0===e.type.indexOf("Class.Gizmo.Expandable")){this.cartExpandable=e;break}}this.fire("shoppingCartItems::fetchItems")},t.prototype.onClose=function(t){t.preventDefault(),this.fire("shoppingCart::toggle",{toggle:!1})},t.prototype.onSizeAdjusted=function(){this.cartExpandable.viewModel.isCollapsed()||this.cartExpandable.viewModel.toggle(!0)},t.prototype.onResize=function(t){this.cartExpandable&&this.cartExpandable.viewModel&&!this.cartExpandable.viewModel.isCollapsed()&&this.cartExpandable.viewModel.toggle(!0)},t.prototype.registerEvents=t.prototype.setupHandlers=function(){this.subscribe("shoppingCart::toggle",this.onToggle),this.subscribe("shoppingCart::adjustsize",this.onSizeAdjusted),this.subscribe("cartRecommendations::updated",this.onRecommendationsUpdated),this.subscribe("gizmosInitialized",this.onGizmosInitialized),this.subscribe("shoppingCartItems::update",this.onCartUpdate),this.subscribe("shoppingCartItems::updated",this.onCartUpdated),this.subscribe("shoppingCartItems::changedKoboLoveMembership",this.onKoboLoveMembershipChanged),this.events.onResize(this.onResize),this.$closeCart.on("click",this.onClose)},t.prototype.destroy=function(){this.unSubscribe("shoppingCart::toggle",this.onToggle),this.unSubscribe("shoppingCart::adjustsize",this.onSizeAdjusted),this.unSubscribe("cartRecommendations::updated",this.onRecommendationsUpdated),this.unSubscribe("gizmosInitialized",this.onGizmosInitialized),this.unSubscribe("shoppingCartItems::update",this.onCartUpdate),this.unSubscribe("shoppingCartItems::updated",this.onCartUpdated),this.unSubscribe("shoppingCartItems::changedKoboLoveMembership",this.onKoboLoveMembershipChanged),this.events.offResize(this.onResize),this.$closeCart.off("click",this.onClose),this.unRegister("shoppingCart::toggle"),this.unRegister("shoppingCart::opening"),this.unRegister("shoppingCart::closing"),this.unRegister("shoppingCart::adjustsize")},a.Gizmo.ShoppingCart=t}(Kobo);
"use strict";Kobo.Gizmo.PromoCode=function(){var e,o,t,r,i,s,a,n,u,g=this;Kobo.Gizmo.apply(this,arguments),g.setType("PromoCode"),e=function(){""!==Kobo.$.trim(n.val())?(g.promoCodeNumber=n.val(),g.fire("promoCode::apply",{promoCodeNumber:g.promoCodeNumber})):(n.attr("gaenabled")&&Kobo.GoogleAnalytics.trackEvent("OS:PurchaseConfirmation","promoCode","fail:blank"),clearTimeout(a),g.message(DynamicConfiguration.resourceStrings.invalidPromoCode),g.hasError(!0),n.addClass("error"))},g.toggleSubmitButtonState=function(){g.isSubmitEnabled()?(i.prop("disabled",!1),i.css({opacity:"1"})):(i.attr("disabled","disabled"),i.css({opacity:"0.5"}))},g.gainFocus=function(){g.toggleSubmitButtonState(),n.on("keyup",},g.isSubmitEnabled=g.setupTriggers=function(){n.on("focus",g.gainFocus)},g.clearTriggers=function(){n.off("blur",g.loseFocus),i.off("focus",g.gainFocus)},o=function(o,e){var t=e.detail.ResponseMessage,r=e.detail.IsSuccess;g.fire("promoCode::gaEventTrigger",{gaEvent:e.detail.GAEvent}),t&&r?(g.message(e.detail.ResponseMessage),g.hasError(!1),n.removeClass("error"),n.val(""),g.toggleSubmitButtonState(),a=setTimeout(function(){s.fadeOut("slow")},5e3)):(g.hasError(!0),g.message(e.detail.ResponseMessage),n.addClass("error"))},r=function(){var o=Kobo.$(this).offset().top-100;Kobo.$("html, body").animate({scrollTop:o},500)},t=function(o,e){g.$gizmo.append(e.detail.gaEvent)},u=function(){n=g.$gizmo.find("input[type=text]"),i=g.$gizmo.find(".promo-submit-button"),s=g.$gizmo.find(".notification"),g.toggleSubmitButtonState(),g.setupTriggers(),g.register("promoCode::apply"),g.register("promoCode::update"),g.register("promoCode::gaEventTrigger"),g.subscribe("promoCode::update",o),g.subscribe("promoCode::gaEventTrigger",t),i.on("click",e),Modernizr.touchevents&&n.on("focus",r),g.message=ko.observable(""),g.hasError=ko.observable(),g.message.extend({notify:"always"}),g.koSubscription=g.message.subscribe(function(o){o&&g.fire("regularCheckout::requestFocus",{target:g.gizmo})})},g.destroy=function(){g.koSubscription.dispose(),i.off("click",e),g.unSubscribe("promoCode::update",o),g.unSubscribe("promoCode::gaEventTrigger",t),g.clearTriggers()},u(),ko.applyBindings(g,g.el)},Kobo.Gizmo.PromoCode.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.VisaCheckout=function(e,o){var r,t,i=this;Kobo.Gizmo.apply(this,arguments),i.setType("VisaCheckout"),i.onVmeReady=function(){var e=window.V;e.init({apikey:i.settings.apiKey,settings:{logoUrl:i.settings.logoUrl,displayName:i.settings.displayName,websiteUrl:i.settings.websiteUrl,shipping:{collectShipping:!1}}}),e.on("payment.success",function(e){i.success(e)}),e.on("payment.cancel",function(e){}),e.on("payment.error",},i.success=function(e){i.$gizmo.find(i.settings.errorSelector).hide(),i.fire("regularCheckout::showSpinner"),Kobo.Ajax({method:"post",url:i.settings.actionUrl,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},success:i.ajaxSuccess,error:i.ajaxError,data:{purchaseToken:i.settings.purchaseToken,callId:e.callid}})},i.ajaxSuccess=function(e){e&&!0===e.IsSuccess?(i.fire("regularCheckout::hideSpinner"),i.fire("regularCheckout::getCheckoutDetails",{navigatePurchaseSection:!0})):i.ajaxError(e)},i.showError=function(e,o,r){i.fire("regularCheckout::hideSpinner"),i.error(e,"Kobo.Gizmo.VisaCheckout",i,{msg:o,dataResult:r}),i.fire("paymentOptions::setCurrentPaymentMethodError",{errorMessage:o})},i.ajaxError=function(e){i.showError("Data.Ajax.Failure",e.ErrorMessage||r.visaCheckoutGeneralUnexpectedError,e.result)},t=r=window.DynamicConfiguration?{visaCheckoutGeneralUnexpectedError:window.DynamicConfiguration.resourceStrings.visaCheckoutGeneralUnexpectedError}:{},t()},Kobo.Gizmo.VisaCheckout.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,t){if(r){if("string"==typeof r)return _arrayLikeToArray(r,t);var o=Object.prototype.toString.call(r).slice(8,-1);return"Map"===(o="Object"===o&&r.constructor?r.constructor.name:o)||"Set"===o?Array.from(r):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(r,t):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,t){(null==t||t>r.length)&&(t=r.length);for(var o=0,e=new Array(t);o<t;o++)e[o]=r[o];return e}Kobo.Gizmo.ThankYou=function(r,t){var o,e,n,a,i=r.querySelectorAll(".item-message"),u=r.querySelector(".thank-you-next-actions-container");Kobo.Gizmo.apply(this,arguments),this.setType("ThankYou"),o=e=a=function(t){_toConsumableArray(i).forEach(},n=function(){var r,t=[];return 0!==i.length&&(_toConsumableArray(i).forEach(function(r){t.push(r.clientHeight)}),r=Math.max.apply(Math,t)),r},function(){o(),e(),Kobo.event.setRippleEffectEvent(u,"button")}()},Kobo.Gizmo.ThankYou.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ThankYouAudiobookSubscription=function(){var i=this;Kobo.Gizmo.apply(i,arguments);var t=new Kobo.Purchasing.ViewModels.ThankYouAudiobookSubscriptionVM({isInLibrary:Kobo.Object.parseBool(i.settings.isInLibrary),appLinks:i.settings.appLinks,relatedLinks:i.settings.relatedLinks,productAvailable:i.settings.productAvailable,isWalmartAffiliate:i.settings.isWalmartAffiliate}),o=i.$el.find(".use-credit"),e=function(){t.creditUsed(!0)},s=function(){i.settings&&i.settings.deviceDownloadUrl&&Kobo.event.fireDeviceEvent(i.settings.deviceDownloadUrl)};ko.applyBindings(t,i.el),o.on("click",function(){i.fire("creditRedemption::start",{creditAmount:i.settings.creditAmount,productId:i.settings.productId,creditRedemptionSuccess:e,isWalmartAffiliate:i.settings.isWalmartAffiliate})}),s()},Kobo.Gizmo.ThankYouAudiobookSubscription.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ThankYouKoboPlusSubscription=function(){var t=this;Kobo.Gizmo.apply(t,arguments);var n=new Kobo.Purchasing.ViewModels.ThankYouKoboPlusSubscriptionVM({appLinks:t.settings.appLinks}),o=function(){t.settings&&t.settings.contentPurchasedUrl&&Kobo.event.fireDeviceEvent(t.settings.contentPurchasedUrl)},e=i=function(o){t.fire("productAction::addToReadingListUnderSubscription",{actionUrl:t.settings.addToMyBooksUrl,productId:t.settings.productId,subscriptionId:t.settings.subscriptionId,completeCallback:s})},s=function(o){o&&"success"===o.result&&(n.productRedeemed(!0),e())};ko.applyBindings(n,t.el),t.$el.find(".redeem-button").on("click",i),o(),Kobo.$(".keep-browsing-container").remove()},Kobo.Gizmo.ThankYouKoboPlusSubscription.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.KoboLoveSummary=function(o,e){var s,a,n,t,i=this;Kobo.Gizmo.apply(this,arguments),i.setType("KoboLoveSummary"),s=function(o,e){i.amountSaved(e.detail.amountSaved),i.pointsEarned(e.detail.pointsEarned),i.basePointsEarned(e.detail.basePointsEarned),i.showPointsEarnedBreakdown(e.detail.showPointsEarnedBreakdown),i.bonusPointsEarned(e.detail.bonusPointsEarned),i.pointsBalance(e.detail.pointsBalance)},a=function(o,e){i.initialShowDiscountState=e.detail.showDiscount,i.showLove(e.detail.showKoboLove),i.showDiscount(e.detail.showDiscount),i.showPointsEarned(e.detail.showPointsEarned),i.showPointsEarnedBreakdown(e.detail.showPointsEarnedBreakdown),i.showPointsEarnedMessage(e.detail.showPointsEarned),i.showPointsBalance(e.detail.showPointsBalance)},t=function(o,e){var s,a;e.detail&&e.detail.vipMembershipInCart?(s=e.detail.vipMembershipInCart,a=e.detail.onlyVipInCart,e=e.detail.vipMessage,s&&i.vipMessage(e),a&&(i.showDiscount(!1),i.showPointsEarnedMessage(!1),i.vipMessage(""))):(i.showDiscount(i.initialShowDiscountState),i.vipMessage(""))},n=function(){i.register("koboLove::updateDetails"),i.register("koboLove::updateState"),i.subscribe("koboLove::updateDetails",s),i.subscribe("koboLove::updateState",a),i.subscribe("shoppingCartItems::changedKoboLoveMembership",t)},i.destroy=function(){i.amountSaved=ko.observable(""),i.pointsEarned=ko.observable(""),i.showPointsEarnedBreakdown=ko.observable(!1),i.basePointsEarned=ko.observable(""),i.bonusPointsEarned=ko.observable(""),i.pointsBalance=ko.observable(""),i.bonusPointsDealName=ko.observable(""),i.showLove=ko.observable("True"===e.showKoboLove),i.showDiscount=ko.observable("True"===e.showKoboLoveDiscounts),i.showPointsEarned=ko.observable("True"===e.showKoboLovePoints),i.showPointsEarnedMessage=ko.observable("True"===e.showKoboLovePoints),i.vipMessage=ko.observable(""),i.showPointsBalance=ko.observable("True"===e.showKoboLovePointsBalance),n(),ko.applyBindings(i,o)}()},Kobo.Gizmo.KoboLoveSummary.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";!function(o){function e(){o.Gizmo.apply(this,arguments),this.setType("RichHeaderLanguageSelector"),this.$languageSelectorButton=this.$gizmo,this.$languageSelectorDropDownMenu=this.$gizmo.find("."+this.settings.languageSelectorDropDownMenuSelector),this.$languageSelectorShowDropdown=this.settings.languageSelectorShowDropdownSelector,this.$languageSelectorExpanded=this.settings.languageSelectorExpandedSelector,this.$languageSelectorCollapsed=this.settings.languageSelectorCollapsedSelector,this.$languageSelectorButtonSelector=this.$gizmo.find("."+this.settings.languageSelectorButtonSelector),this.setupHandlers()}(e.prototype=o.chainPrototype(o.Gizmo.prototype)).expandLanguageDropdown=function(){this.$languageSelectorDropDownMenu.addClass(this.$languageSelectorShowDropdown),this.$languageSelectorButton.removeClass(this.$languageSelectorCollapsed).addClass(this.$languageSelectorExpanded),this.$languageSelectorButtonSelector.attr("aria-expanded",!0)},e.prototype.collapseLanguageDropdown=function(){this.$languageSelectorDropDownMenu.removeClass(this.$languageSelectorShowDropdown),this.$languageSelectorButton.addClass(this.$languageSelectorCollapsed).removeClass(this.$languageSelectorExpanded),this.$languageSelectorButtonSelector.attr("aria-expanded",!1)},e.prototype.setupHandlers=function(){var t=this;this.$languageSelectorButton.on("click",function(){t.$languageSelectorButton.hasClass(t.$languageSelectorCollapsed)?t.expandLanguageDropdown():t.collapseLanguageDropdown()}),o.$(document).on("click",function(e){0===o.$(e.target).closest(t.$languageSelectorButton).length&&t.collapseLanguageDropdown()})},o.Gizmo.RichHeaderLanguageSelector=e}(Kobo);
"use strict";Kobo.Gizmo.SmallSecondaryRichHeader=function(e,a){var r,t,i,n,s,o,c,l,d,S,u=this,h=Kobo._mediator.determineBreakpoint();Kobo.Gizmo.apply(this,arguments),this.setType("SmallSecondaryRichHeader"),u.toggleSearchBar=function(e){!0===e?Kobo._mediator.fire("collapsible::open",{name:"searchBar"}):!1===e?Kobo._mediator.fire("collapsible::close",{name:"searchBar"}):Kobo._mediator.fire("collapsible::toggle",{name:"searchBar"}),u.isSearchBarOpen(},u.isSearchBarOpen=u.updatePageState=function(e){e?(o.addClass(a.headerSearchOpenSelector),"small"!==h&&(u.fire("richHeader::hideShoppingCart"),setTimeout(function(){u.toggleHideSearchOnScrollBehaviour(!0)},1e3))):(o.removeClass(a.headerSearchOpenSelector),"small"!==h&&u.toggleHideSearchOnScrollBehaviour(!1))},u.toggleHideSearchOnScrollBehaviour=function(e){e?Kobo.$window.on("scroll",u._hideSearchWhenScrolledOutOfView):Kobo.$window.off("scroll",u._hideSearchWhenScrolledOutOfView)},u.setDefaultSearchBarToggle=function(e){"small"===(e=e||Kobo._mediator.determineBreakpoint())?u.toggleSearchBar(!0):u.toggleSearchBar(!1)},u._hideSearch=function(){u.toggleSearchBar(!1)},u._hideSearchWhenScrolledOutOfView=Kobo.Utilities.Events.debounce(function(){Kobo.Utilities.DomUtils.isScrolledIntoView(c)||(u._hideSearch(),u.toggleHideSearchOnScrollBehaviour(!1))},50),u.setFocusSearchBar=function(e){e&&"small"!==h&&setTimeout(function(){l.focus()},250)},u.closeSmallSideMenu=function(e,o){var l=o&&o.detail&&o.detail.targetElement?o.detail.targetElement:null,o=!1;l&&(o=0===Kobo.$(l).closest(t).length),l&&!o||i&&(n.classList.remove("side-menu-show-document-overlay"),s.parentElement.style.display="none",i=!1,u.$gizmo.removeClass(a.slideSmallMainMenuRightSelector).addClass(a.slideSmallMainMenuLeftSelector),t.removeClass(a.showSideMenuSelector).addClass(a.hideSideMenuSelector),r.removeClass(a.sideMenuIsOpenSelector).addClass(a.sideMenuIsClosedSelector),r.attr("aria-expanded",!1),Kobo.$body.removeClass(a.pushContentRightSelector).addClass(a.pushContentLeftSelector),c.removeClass(a.pushSearchBarRightSelector).addClass(a.pushSearchBarLeftSelector))},u.toggleSmallSideMenu=function(e){u.$gizmo.hasClass(a.slideSmallMainMenuLeftSelector)?(i=!0,null===s&&(s=document.querySelector(".close-side-menu-button")).addEventListener("click",function(e){e.preventDefault(),u.closeSmallSideMenu()}),s.parentElement.style.display="block",(n=null===n?document.querySelector(".side-menu-document-overlay"):n).classList.add("side-menu-show-document-overlay"),u.$gizmo.removeClass(a.slideSmallMainMenuLeftSelector).addClass(a.slideSmallMainMenuRightSelector),t.removeClass(a.hideSideMenuSelector).addClass(a.showSideMenuSelector),r.removeClass(a.sideMenuIsClosedSelector).addClass(a.sideMenuIsOpenSelector),r.attr("aria-expanded",!0),Kobo.$body.removeClass(a.pushContentLeftSelector).addClass(a.pushContentRightSelector),c.removeClass(a.pushSearchBarLeftSelector).addClass(a.pushSearchBarRightSelector),"keydown"===e.type&&(0<d.length?d:S).trigger("focus")):i&&u.closeSmallSideMenu(e)},u.setupSearchBar=u.destroy=function(){u.unSubscribe("richHeader::hideSmallSearch",u._hideSearch),u.unSubscribe("shoppingCart::opening",u._onShoppingCartOpened),u.unSubscribe("shoppingCart::closing",u._onShoppingCartClosed),u.unSubscribe("smallSideMenu::toggle",u.toggleSmallSideMenu),u.unSubscribe("smallSideMenu::close",u.closeSmallSideMenu),u.toggleHideSearchOnScrollBehaviour(!1),u._hideSearchWhenScrolledOutOfView=null},u.setupHandlers=function(){u.register("richHeader::hideSmallSearch"),u.subscribe("richHeader::hideSmallSearch",u._hideSearch),u.register("collapsible::loaded"),u.subscribe("collapsible::loaded",u.setupSearchBar),u.register("smallSideMenu::toggle"),u.subscribe("smallSideMenu::toggle",u.toggleSmallSideMenu),u.register("smallSideMenu::close"),u.subscribe("smallSideMenu::close",u.closeSmallSideMenu),r.on("click keydown",function(e){"click"!==e.type&&("keydown"!==e.type||e.keyCode!==Kobo.KeyCodes.SPACE&&e.keyCode!==Kobo.KeyCodes.RETURN)||(e.preventDefault(),e.stopPropagation(),u.toggleSmallSideMenu(e))}),o.on("click",,u.events.onResize(function(){var e=Kobo._mediator.determineBreakpoint();u.toggleSearchInputClass(e),h!==e&&(h=e,u.setDefaultSearchBarToggle(h))})},u.toggleSearchInputClass=function(e){"small"===(e||Kobo._mediator.determineBreakpoint())?c.addClass("SearchInputWidgetSmall"):c.removeClass("SearchInputWidgetSmall")},function(){t=Kobo.$("."+a.sideMenuSelector),r=u.$gizmo.find("."+a.sideMenuToggleSelector),o=u.$gizmo.find("."+a.headerSearchBarToggleSelector),c=Kobo.$("."+a.headerSearchInputWidgetSelector),l=Kobo.$("."+a.headerSearchFieldSelector),d=Kobo.$(".language-selector"),S=Kobo.$("button.profile-wrapper"),i=!1,n=s=null,u.setupHandlers(),u.$el.toggleClass("is-not-mobile-device",!window.DynamicConfiguration.isMobileDevice),u.toggleSearchInputClass()}()},Kobo.Gizmo.SmallSecondaryRichHeader.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.RichHeaderEReadersAndAppsPanel=function(e,t){var o,a,i,n,s=this;Kobo.Gizmo.apply(s,arguments),s.setType("RichHeaderEReadersAndAppsPanel"),s.activateItem=function(e){Kobo.$(e).closest("."+i).siblings().removeClass(n),Kobo.$(e).closest("."+i).addClass(n)},s.selectItem=s.applyDefaultSelection=function(){s.activateItem(o)},s.setupHandlers=function(){a.each(},function(){o=s.$gizmo.find("."+t.defaultSelection),a=s.$gizmo.find("."+t.menuItemSelector),i=t.itemWrapperClass,n=t.activeClass,s.setupHandlers(),s.applyDefaultSelection()}()},Kobo.Gizmo.RichHeaderEReadersAndAppsPanel.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.RichHeaderAccountOptions=function(o,e){Kobo.Gizmo.apply(this,arguments),this.setType("RichHeaderAccountOptions");var n=this,t=n.$gizmo.find("."+e.accountDropDownMenuSelector),c=n.$gizmo.find("."+e.accountDropDownButtonSelector),a=n.$gizmo,s=e.accountDropDownShowMenuSelector,r=e.accountDropDownCollapseSelector,u=e.accountDropDownExpandSelector,i=!1,p=window.matchMedia("all and (max-width: 880px)");n.collapseAccountDropdown=function(){t.removeClass(s),a.addClass(r).removeClass(u),c.attr("aria-expanded",!1)},n.expandAccountDropdown=function(){t.addClass(s),a.removeClass(r).addClass(u),c.attr("aria-expanded",!0)},n.isTouchScreen=n.setupHandlers=function(){a.on("mouseenter",function(){p.matches||a.hasClass(r)&&n.expandAccountDropdown()}),a.on("mouseleave",function(){p.matches||a.hasClass(u)&&n.collapseAccountDropdown()}),c.on("mousedown",,a.on("click",function(o){a.hasClass(u)?n.collapseAccountDropdown():n.expandAccountDropdown(),n.isTouchScreen()||p.matches||document.activeElement.blur()}),a.on("focusin",function(o){a.hasClass(r)&&!i&&(o.preventDefault(),n.expandAccountDropdown())}),a.on("focusout",function(o){!i&&null===o.relatedTarget&&a.hasClass(u)&&n.collapseAccountDropdown(),i=!1}),a.on("keydown",function(o){a.hasClass(u)?o.keyCode===Kobo.KeyCodes.TAB?(o.shiftKey&&o.target===$("button.profile-wrapper")[0]||!o.shiftKey&&o.target===$("li.sign-out a")[0])&&(n.collapseAccountDropdown(),t.blur()):o.keyCode===Kobo.KeyCodes.ESC&&(n.collapseAccountDropdown(),t.blur()):o.keyCode!==Kobo.KeyCodes.RETURN&&o.keyCode!==Kobo.KeyCodes.SPACE||(o.preventDefault(),t.focus(),n.expandAccountDropdown())})},n.init=function(){n.setupHandlers();var o=document.querySelector(".rich-header");Kobo.event.setRippleEffectEvent(o,"ripple")},n.init()},Kobo.Gizmo.RichHeaderAccountOptions.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";!function(o){function i(i,t){o.Gizmo.apply(this,arguments),this.setType("RichHeaderShoppingCart"),this.invalidItemsDialog=null,this.dialogCookieName="hideCheckCart",this.$shoppingCartToggle=this.$gizmo.find("."+this.settings.shoppingCartToggleSelector),this.$shoppingCartIcon=this.$gizmo.find("."+this.settings.shoppingCartIconSelector),this.$shoppingCartCount=this.$shoppingCartIcon.find("em"),this.$shoppingCartWidget=o.$("."+this.settings.shoppingCartWidgetSelector),this.shoppingCartUpdated=this.shoppingCartUpdated.bind(this),this.hideShoppingCart=this.hideShoppingCart.bind(this),this.toggleShoppingCart=this.toggleShoppingCart.bind(this),this.viewCartDialogAction=this.viewCartDialogAction.bind(this),this.closeDialogAction=this.closeDialogAction.bind(this),this._hideShoppingCartWhenScrolledOutOfView=o.Utilities.Events.debounce(this._hideShoppingCartWhenScrolledOutOfView.bind(this),50),this.setupHandlers()}(i.prototype=o.chainPrototype(o.Gizmo.prototype)).showShoppingCart=function(){this.$shoppingCartToggle.removeClass(this.settings.shoppingCartCollapsedSelector),o._mediator.fire("shoppingCart::toggle",{toggle:!0}),"small"!==o._mediator.determineBreakpoint()&&o._mediator.fire("richHeader::hideSmallSearch"),this.invalidItemsDialog&&this.closeDialogAction()},i.prototype.hideShoppingCart=function(i){this.$shoppingCartToggle.addClass(this.settings.shoppingCartCollapsedSelector),o._mediator.fire("shoppingCart::toggle",{toggle:!1,scrollPage:i})},i.prototype.toggleShoppingCart=function(i){i.preventDefault(),this.$shoppingCartToggle.hasClass(this.settings.shoppingCartCollapsedSelector)?(this.showShoppingCart(),this.toggleHideShoppingCartOnScrollBehaviour(!0),"keydown"===i.type&&(i=o.Utilities.findAllFocusableElements(this.$shoppingCartWidget).toArray().filter([0],$(i).trigger("focus"))):(this.hideShoppingCart(),this.toggleHideShoppingCartOnScrollBehaviour(!1))},i.prototype.shouldShowInvalidItemsDialog=function(i){for(var t=!1,o=0;o<i.length;o++)if(i[o]&&!i[o].availableInCurrentGeo){t=!0;break}return!!(t&&this.$shoppingCartToggle.hasClass(this.settings.shoppingCartCollapsedSelector)&&window.DynamicConfiguration.user.inHomeStoreFront)},i.prototype.shoppingCartUpdated=function(i,t){var o=t.detail.items&&t.detail.items.length;0<o?(o=99<o?"99+":o,this.$shoppingCartIcon.addClass(this.settings.shoppingCartShowIconSelector),this.$shoppingCartCount.text(o)):(this.$shoppingCartIcon.removeClass(this.settings.shoppingCartShowIconSelector),this.$shoppingCartCount.text("")),void 0===Cookies.get(this.dialogCookieName)&&t.detail.items&&this.shouldShowInvalidItemsDialog(t.detail.items)&&(this.initInvalidItemsDialog(),Cookies.set(this.dialogCookieName,"true",{path:"/"}))},i.prototype.destroy=function(){o._mediator.unSubscribe("shoppingCartItems::updated",this.shoppingCartUpdated),o._mediator.unSubscribe("richHeader::hideShoppingCart",this.hideShoppingCart),o._mediator.unRegister("richHeader::hideShoppingCart"),this.$shoppingCartToggle.off("click",this.toggleShoppingCart),this.toggleHideShoppingCartOnScrollBehaviour(!1)},i.prototype._hideShoppingCartWhenScrolledOutOfView=function(){o.Utilities.DomUtils.isWithinView(this.$shoppingCartWidget)||(this.hideShoppingCart(!1),this.toggleHideShoppingCartOnScrollBehaviour(!1))},i.prototype.toggleHideShoppingCartOnScrollBehaviour=function(i){i?o.$window.on("scroll",this._hideShoppingCartWhenScrolledOutOfView):o.$window.off("scroll",this._hideShoppingCartWhenScrolledOutOfView)},i.prototype.setupHandlers=function(){var t=this;o._mediator.subscribe("shoppingCartItems::updated",this.shoppingCartUpdated),o._mediator.register("richHeader::hideShoppingCart"),o._mediator.subscribe("richHeader::hideShoppingCart",this.hideShoppingCart),this.$shoppingCartToggle.on("click",this.toggleShoppingCart),this.$shoppingCartToggle.on("keydown ",},i.prototype.initInvalidItemsDialog=function(){var i=window.DynamicConfiguration.resourceStrings;this.invalidItemsDialog=new o.Popup({parent:this.$el,layout:"dialog",title:i.checkCart,content:i.invalidCartItems,buttons:[new o.Controls.Dialog.ButtonVM({label:i.viewCart,action:this.viewCartDialogAction}),new o.Controls.Dialog.ButtonVM({label:i.close,action:this.closeDialogAction})],ariaLive:"assertive",role:"alertdialog",position:{rightAligned:!0,top:"90%"},width:"280px",style:{zIndex:"999"}}),this.invalidItemsDialog.show()},i.prototype.viewCartDialogAction=i.prototype.closeDialogAction=o.Gizmo.RichHeaderShoppingCartToggle=i}(Kobo);
"use strict";Kobo.Gizmo.HeaderCategories=function(e,o){var i=this;Kobo.Gizmo.apply(this,arguments),this.setType("HeaderCategories"),i.fitListToPanel=function(){var e=Kobo._mediator.determineBreakpoint(),o=Kobo.$("."+i.ulSelectorClass+" > li");"small"===e||"medium"===e?i.showHideForSmallView(o,parseInt(i.smallViewMaxDisplay,10)):o.show()},i.showHideForSmallView=function(e,o){for(var i=0;i<e.length;i++)i<o?Kobo.$(e[i]).show():Kobo.$(e[i]).hide()},i._onWindowResized=function(){i.fitListToPanel()},i.setupHandlers=function(){i.events.onResize(i._onWindowResized)},i.init=function(){i.ulSelectorClass=o.ulSelectorClass,i.wrapperDivClass=o.wrapperDivClass,i.smallViewMaxDisplay=o.smallViewMaxDisplay,i.wrapperId=o.wrapperId,i.fitListToPanel(),i.setupHandlers()},i.destroy=function(){i.events.offResize(i._onWindowResized)},i.init()},Kobo.Gizmo.HeaderCategories.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.GroupLink=function(e){var t,n,a,r,s=this;Kobo.Gizmo.apply(this,arguments),this.setType("GroupLink"),s.showHideLinks=function(){var e,i,o=Kobo._mediator.determineBreakpoint();for("small"!==o&&"medium"!==o||(a=parseInt(s.maxSmallViewLinks,10),r=parseInt(s.maxSmallViewFeaturedListLinks,10)),e=0;e<t.length;e++)e<a?Kobo.$(t[e]).show():Kobo.$(t[e]).hide();for(i=0;i<n.length;i++)i<r?Kobo.$(n[i]).show():Kobo.$(n[i]).hide()},s.events.onResize(function(){s.showHideLinks()}),function(){s.maxSmallViewLinks=e.maxSmallViewLinks,s.maxLargeViewLinks=e.maxLargeViewLinks,s.maxSmallViewFeaturedListLinks=e.maxSmallViewFeaturedListLinks,s.maxLargeViewFeaturedListLinks=e.maxLargeViewFeaturedListLinks,s.linkSelector=e.linkSelector,s.featureLinkSelector=e.featureLinkSelector,t=s.$gizmo.find("."+s.linkSelector),n=s.$gizmo.find("."+s.featureLinkSelector),a=parseInt(s.maxLargeViewLinks,10),r=parseInt(s.maxLargeViewFeaturedListLinks,10),s.showHideLinks()}()},Kobo.Gizmo.GroupLink.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.RichHeaderAudiobookCreditBalance=function(e,o){var i,t,a,n=this;Kobo.Gizmo.apply(this,arguments),this.setType("RichHeaderAudiobookCreditBalance"),i=new Kobo.ViewModel.RichHeader.AudiobookCreditBalanceVM,t=function(){Kobo.Ajax({url:n.settings.getCreditBalanceUrl,method:"GET",traditional:!0,dataType:"json",success:function(e){null!==e&&null!==e.CreditBalance?(n.fire("audiobookCreditBalance::get",{creditAmount:e.CreditBalance}),i.creditBalance(e.CreditBalance)):i.creditBalance(DynamicConfiguration.resourceStrings.notApplicable),i.isHidden(!1)},error:function(){i.isHidden(!0)}})},a=function(){Kobo._mediator.subscribe("creditRedemption::end",t),Kobo._mediator.register("audiobookCreditBalance::get"),t()},ko.applyBindings(i,n.el),a()},Kobo.Gizmo.RichHeaderAudiobookCreditBalance.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.RichHeaderRgiSuperPointsBalance=function(i){Kobo.Gizmo.apply(this,arguments),this.setType("RichHeaderRgiSuperPointsBalance"),this.viewModel=new Kobo.ViewModel.RichHeader.RgiSuperPointsBalanceVM,ko.applyBindings(this.viewModel,i),this.getRgiSuperPointsBalance()},Kobo.Gizmo.RichHeaderRgiSuperPointsBalance.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype),Kobo.Gizmo.RichHeaderRgiSuperPointsBalance.prototype.getRgiSuperPointsBalance=function(){var e=this;e.viewModel.availablePoints(DynamicConfiguration.resourceStrings.rgiPointsLoading),e.viewModel.standardPoints(DynamicConfiguration.resourceStrings.rgiPointsLoading),e.viewModel.limitedTermPoints(DynamicConfiguration.resourceStrings.rgiPointsLoading),Kobo.$.ajax({url:e.settings.getPointsBalanceUrl,method:"GET",dataType:"json",success:function(i){i&&(e.viewModel.update(i),e.viewModel.isHidden(!1),e.viewModel.isHidden(!1))},error:)};
"use strict";Kobo.Utilities.assignToNamespace("Kobo.ViewModel.RichHeader.RgiSuperPointsBalanceVM",function(){this.isHidden=ko.observable(!0),this.availablePoints=ko.observable(0),this.standardPoints=ko.observable(0),this.limitedTermPoints=ko.observable(0),this.pointsLabel=DynamicConfiguration.resourceStrings.rgiPoints,this.standardPointsLabel=DynamicConfiguration.resourceStrings.rgiStandardPoints,this.termLimitedPointsLabel=DynamicConfiguration.resourceStrings.rgiTermLimitedPoints,this.update=);
"use strict";Kobo.Utilities.assignToNamespace("Kobo.ViewModel.RichHeader.AudiobookCreditBalanceVM",function(){this.creditBalance=ko.observable(0),this.isHidden=ko.observable(!0),this.creditLabel=ko.pureComputed(function(){return 1===this.creditBalance()?DynamicConfiguration.resourceStrings.credit_singular:DynamicConfiguration.resourceStrings.credit_plural},this)});
"use strict";!function(i){function o(o,t){i.Gizmo.apply(this,arguments)}o.prototype=i.chainPrototype(i.Gizmo.prototype),i.Gizmo.RichHeaderNewUserOptions=o}(Kobo);
"use strict";!function(o){function i(i){o.Gizmo.apply(this,arguments),this.setType("RichHeaderTabNavigation");var a=new o.RichHeader.RichHeaderTabNavigationVM;ko.applyBindings(a,i)}i.prototype=o.chainPrototype(o.Gizmo.prototype),o.Gizmo.RichHeaderTabNavigation=i}(Kobo);
"use strict";Kobo.Utilities.assignToNamespace("Kobo.RichHeader.RichHeaderTabNavigationVM",function(e){var t,i,n=Kobo.$.extend({tabSelectDelay:150,ignoreTabClickDelay:500},e),a=this;this.selectedTab=ko.observable(null),this.breakpoint=ko.observable(null),this.listenToTabClicks=ko.observable(!0),this.ignoreHoverEventsBecauseOfTouchScreen=ko.observable(!1),this.touchTabClicked=ko.observable(!0),this.headerNavigatorPopupVM=ko.observable({cssClass:"small-and-medium-view",links:[{text:DynamicConfiguration.resourceStrings.closeMenuNavigateToHeader,destinationId:"small-header",callBack:function(){return Kobo._mediator.fire("smallSideMenu::toggle"),!0}},{text:DynamicConfiguration.resourceStrings.closeMenuNavigateToContent,destinationId:"main-content",callBack:]}),this.listenToHoverEvents=ko.computed(function(){if(a.ignoreHoverEventsBecauseOfTouchScreen())return!1;var e=a.breakpoint();return e===Kobo.Breakpoints.large||e===Kobo.Breakpoints.jumbo}),this.tabClicked=function(e,o){!1!==a.listenToTabClicks()&&(e=a.selectedTab()!==e?e:null,a.selectedTab(e||null),!1===a.touchTabClicked()?null===e&&a.touchTabClicked(!0):a.touchTabClicked(!1),(e=a.breakpoint())!==Kobo.Breakpoints.large&&e!==Kobo.Breakpoints.jumbo||Modernizr.touch_events&&Modernizr.pointerevents||!0===a.touchTabClicked()&&Kobo.Utilities.navigateTo(o))},this.tabHoverStart=function(e){!1!==a.listenToHoverEvents()&&(a.touchTabClicked(!1),a._delaySelectTab(e).done(function(){a._brieflyIgnoreTabClicks()}))},this.tabHoverEnd=function(){!1!==a.listenToHoverEvents()&&(a.touchTabClicked(!0),a._delaySelectTab(null))},this.tabTouchEnd=function(){!1===a.ignoreHoverEventsBecauseOfTouchScreen()&&(a.ignoreHoverEventsBecauseOfTouchScreen(!0),a._cancelDelaySelectionOfTab())},this.closeAll=function(e){a._cancelDelaySelectionOfTab(),a.selectedTab(null),e&&Kobo._mediator.fire("smallSideMenu::close",{targetElement:e.target})},this._delaySelectTab=function(e){a._cancelDelaySelectionOfTab(),i&&(i.reject(),i=null);var o=Kobo.$.Deferred();return t=setTimeout(n.tabSelectDelay),(i=o).promise()},this._cancelDelaySelectionOfTab=this._brieflyIgnoreTabClicks=function(){clearTimeout(void 0),a.listenToTabClicks(!1),setTimeout(n.ignoreTabClickDelay)}});
"use strict";Kobo.Gizmo.CreditRedemption=function(){var i=this;function e(e,t){i.viewModel=(t=t.detail,new Kobo.Product.Tandy.ViewModels.CreditRedemptionVM({creditAmount:t.creditAmount,productId:t.productId,creditRedemptionSuccess:t.creditRedemptionSuccess,isWalmartAffiliate:t.isWalmartAffiliate,canRedeemCreditUrl:i.settings.canRedeemCreditUrl,redeemCreditUrl:i.settings.redeemCreditUrl,signInUrl:i.settings.signInUrl,updateBillingUrl:i.settings.updateBillingUrl}));var o=(t=Kobo.$("#credit-redemption-content-template"),Kobo.$(t.html()));i.viewModel.validateRedeem(),Kobo._modal.open(o,{customClass:"credit-redemption-content-wrap"}),i.viewModel.closeDialogEvent.subscribe(function(){Kobo._modal.close(),o.remove()}),ko.applyBindings(i.viewModel,o[0])}i.setDefaults({creditRedemptionEndpoint:null}),Kobo.Gizmo.apply(i,arguments),Kobo._mediator.register("creditRedemption::start"),Kobo._mediator.register("creditRedemption::end"),Kobo._mediator.subscribe("creditRedemption::start",e),i.destroy=,Kobo.Gizmo.CreditRedemption.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Utilities.assignToNamespace("Kobo.Product.Tandy.ViewModels.CreditRedemptionVM",function(r){var o,i=this,e=DynamicConfiguration.resourceStrings.creditLower,n=DynamicConfiguration.resourceStrings.creditsLower,t=DynamicConfiguration.resourceStrings.getThisTandy,s=DynamicConfiguration.resourceStrings.pleaseNoteFnac,a=DynamicConfiguration.resourceStrings.pleaseNoteWalmart,c=DynamicConfiguration.resourceStrings.pleaseNote,u={unknown:0,unauthenticated:1,insufficientBalance:2,noBillingAddress:3,ineligibleProduct:4,success:5,error:6,productAlreadyOwned:7},d={tryAgain:0,updateBilling:1};this.showFnacMessaging=ko.observable("fr"===DynamicConfiguration.user.currentStorefront&&"fr-fr"===document.body.parentElement.getAttribute("lang").toLowerCase()),this.pleaseNoteFnac=s,this.pleaseNoteWalmart=a,this.pleaseNote=c,this.creditAmount=ko.observable(r&&r.creditAmount),this.redeemSuccess=ko.observable(),this.closeDialogEvent=new ko.subscribable,this.closeDialog=function(){i.closeDialogEvent.notifySubscribers()},this.pleaseNoteMessage=ko.pureComputed(function(){return i.showFnacMessaging()?i.pleaseNoteFnac:r.isWalmartAffiliate?i.pleaseNoteWalmart:i.pleaseNote}),this.hasError=ko.pureComputed(function(){return!(!i.errorHeading()&&!i.errorMessage())}),this.errorHeading=ko.observable(""),this.errorMessage=ko.observable(""),this.errorActionType=ko.observable(null),this.errorActionHandler=function(){switch(i.errorActionType()){case d.tryAgain:i.confirmRedeem();break;case d.updateBilling:window.location=r.updateBillingUrl}},this.errorActionText=ko.pureComputed(function(){switch(i.errorActionType()){case d.tryAgain:return DynamicConfiguration.resourceStrings.tryAgain;case d.updateBilling:return DynamicConfiguration.resourceStrings.updateInfo}return""}),this.validateRedeem=function(){Kobo.$body.addClass("ajax-spinner-overlay"),Kobo.Ajax({method:"POST",url:r.canRedeemCreditUrl,data:{productId:r.productId},dataType:"json",cache:!1,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},success:function(e){"Unauthenticated"===e.result?o({ResponseCode:u.unauthenticated}):(Kobo.$body.removeClass("ajax-spinner-overlay"),e.ResponseCode&&e.ResponseCode===u.success||o(e))},error:)},this.confirmRedeem=function(){Kobo.$body.addClass("ajax-spinner-overlay"),Kobo.Ajax({method:"POST",url:r.redeemCreditUrl,data:{productId:r.productId},dataType:"json",cache:!1,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},success:function(e){"Unauthenticated"===e.result?o({ResponseCode:u.unauthenticated}):e.ResponseCode===u.success?(r.creditRedemptionSuccess(),i.closeDialogEvent.notifySubscribers(),e.DeviceEvent&&Kobo.event.fireDeviceEvent(e.DeviceEvent)):o(e)},error:o,complete:)},this.creditString=ko.pureComputed(function(){return 1===i.creditAmount()?e:n}),this.heading=ko.pureComputed(function(){return Kobo.Utilities.stringFormat(t,i.creditAmount(),i.creditString())}),o=function(e){switch(e.ResponseCode){case u.unauthenticated:window.location=r.signInUrl;break;case u.insufficientBalance:i.errorHeading(DynamicConfiguration.resourceStrings.dontHaveCredits),i.errorMessage(DynamicConfiguration.resourceStrings.noCreditsLeft),i.errorActionType(null);break;case u.noBillingAddress:i.errorHeading(DynamicConfiguration.resourceStrings.noBillingAddress),i.errorMessage(DynamicConfiguration.resourceStrings.couldNotFindBilling),i.errorActionType(d.updateBilling);break;case u.ineligibleProduct:i.errorHeading(DynamicConfiguration.resourceStrings.ineligibleForCredit),i.errorMessage(DynamicConfiguration.resourceStrings.cantBePurchasedWithCredit),i.errorActionType(null);break;case u.productAlreadyOwned:i.errorHeading(DynamicConfiguration.resourceStrings.alreadyOwned),i.errorMessage(DynamicConfiguration.resourceStrings.titleAlreadyYours),i.errorActionType(null);break;default:i.errorHeading(DynamicConfiguration.resourceStrings.somethingWentWrong),i.errorMessage(DynamicConfiguration.resourceStrings.couldntProcessRequest),i.errorActionType(d.tryAgain)}}});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.Product.Audiobooks.ViewModels.AudiobookPlanSwitcherVM",function(i){var t=this;this.fromPlan=i.fromPlan,this.toPlan=i.toPlan,this.planDetails=i.planDetails,this.nextBillingDate=i.nextBillingDate,this.purchasePathUrl=i.purchasePathUrl,this.creditAmountString=i.creditAmountString,this.closeDialogEvent=new ko.subscribable,this.closeDialog=function(){t.closeDialogEvent.notifySubscribers()}});
"use strict";Kobo.Gizmo.AudiobookPlanSwitcher=function(){var o,i=this;function t(){var o=(t=Kobo.$("#audiobook-plan-switcher-template"),Kobo.$(t.html())),t=new Kobo.Product.Audiobooks.ViewModels.AudiobookPlanSwitcherVM(i.settings);t.closeDialogEvent.subscribe(,Kobo._modal.open(o,{customClass:"audiobook-plan-switcher-wrap"}),ko.applyBindings(t,o[0])}i.setDefaults({fromPlan:null,toPlan:null,planDetails:null,nextBillingDate:null,purchasePathUrl:null,creditAmountString:null,switchToThisPlanString:null,upgradeNowString:null,isUpgrade:null}),Kobo.Gizmo.apply(i,arguments),o=i.$el.find(".switch-plan"),i.options.isUpgrade?o.text(i.options.upgradeNowString):o.text(i.options.switchToThisPlanString),o.on("click",t),i.destroy=function(){o.off("click",t)}},Kobo.Gizmo.AudiobookPlanSwitcher.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.CookieConsent=function(o){var e,n,t=this;Kobo.Gizmo.apply(t,arguments),t.persistCookieConsent=function(){Cookies.set("PersistentCookieConsent",Kobo.$.param({cookieConsent:!0}),{expires:365,path:"/",raw:!0}),Kobo.$("#CookieConsent").hide("slow")},t.persistGDPRCookieConsent=function(){e()},t.persistGDPRCookieDecline=function(){n()},e=function(){Kobo.Ajax({url:t.settings.useRecommendedSettingsUrl,method:"POST",traditional:!0,dataType:"json",complete:)},n=function(){Kobo.Ajax({url:t.settings.declineRecommendedSettingsUrl,method:"POST",traditional:!0,dataType:"json",complete:)},function(){ko.applyBindings(t,o),Kobo.$("#cookieConsentCta").on("click",t.persistCookieConsent),Kobo.$("#gdprCookieConsentCta").on("click",t.persistGDPRCookieConsent),Kobo.$("#gdprDeclineCta").on("click",t.persistGDPRCookieDecline),t.register("Gdpr::useRecommendedSettings"),t.register("Gdpr::declineRecommendedSettings")}()},Kobo.Gizmo.CookieConsent.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.AddSubItemToReadingList=function(o,e){var i,t,n,r,a=this,s=window.DynamicConfiguration.resourceStrings.addToReadingListError,c="."+e.widgetContainerClass;Kobo.Gizmo.apply(this,arguments),a.setType("AddSubItemToReadingList"),i=function(){Kobo.Spinner.showSpinnerOverlay(Kobo.$(c)),Kobo.Ajax({method:"POST",cache:!1,url:e.addToReadingListUrl,success:function(){o.className+=" success",a.settings.contentDownloadEventData&&Kobo.event.fireDeviceEvent(a.settings.contentDownloadEventData)},error:complete:)},t=function(){e&&e.itemPageRedirectUrl&&(window.location.href=e.itemPageRedirectUrl)},n=function(){e&&e.addToReadingListUrl?r.on("click",i):e&&e.itemPageRedirectUrl&&r.on("click",t)},function(){e&&e.isWidgetVisible&&(r=a.$gizmo.find("."+a.options.buttonClass),n())}()},Kobo.Gizmo.AddSubItemToReadingList.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.FixHangingChevron=function(o,i,t){var n=Kobo.$(o);Kobo.Gizmo.apply(this,arguments),this.setType("FixHangingChevron"),this.settings={},function(){n.width()-n.find("a").width()<20&&n.css("width","80%")}()},Kobo.Gizmo.FixHangingChevron.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.Tabs=function(){var i,o,n,r,s,e,t,a,f,l=this;l.defaults={tabsSelector:"",hashSuffix:"-tab",validTabs:[]},Kobo.Gizmo.apply(this,arguments),n=function(t){var e;0<t.length&&(e=t.attr("href"),l.$el.find(l.settings.tabsSelector).attr("aria-selected","false"),t.attr("aria-selected","true"),r(e),Kobo.Utilities.replaceState(e+l.settings.hashSuffix))},r=function(t){l.$el.find(i).attr("aria-hidden","true"),l.$el.find(t).attr("aria-hidden","false"),i=t},t=function(t){t.preventDefault(),n(Kobo.$(this))},a=function(t){t=e(t=t||"");return l.$el.find(l.settings.tabsSelector).filter('[href="'+t+'"]')},s=function(){l.$el.on("click",l.settings.tabsSelector,t),Kobo.$(o.map(function(t){return t+l.settings.hashSuffix}).join(",")).on("click",t)},e=function(t){return t=0<=t.indexOf(l.settings.hashSuffix)?t.substring(0,t.length-l.settings.hashSuffix.length):t},f=function(){if(!l.settings.tabsSelector)throw new Error("tabsSelector gizmo config value is required");var t=l.$el.find(l.settings.tabsSelector);o=t.map(.toArray();var e=l.$el.find(l.settings.tabsSelector).filter("[aria-selected=true]");i=e.attr("href");t=a(Kobo.Utilities.getLocationHash());t.length<1&&(t=e),n(t),s()},l.destroy=function(){l.$el.off("click",l.settings.tabsSelector,t),Kobo.$(o.map(.join(",")).off("click",t)},f()},Kobo.Gizmo.Tabs.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.SeriesDrawer=function(e,r){var s,i=this,o=Kobo.$(e);Kobo.Gizmo.apply(this,arguments),i.setType("SeriesDrawer"),i.openDrawer=function(){o.addClass("open")},i.closeDrawer=function(){o.removeClass("open")},i.triggerDrawerChange=function(e){0==Kobo.$(e.target).parents("a").size()&&(o.hasClass("open")?Kobo._mediator.fire("seriesDrawer::closeDrawer"):Kobo._mediator.fire("seriesDrawer::openDrawer"))},i.addSeriesToCart=function(e){o.find(".series-add-to-cart-text").html(DynamicConfiguration.resourceStrings.addingSeriesToCart),o.find(".series-add-to-cart").addClass("series-adding-to-cart").removeClass("series-add-to-cart"),o.find(".spinner").addClass("animated-spinner-icon").addClass("spinner-vector"),Kobo._mediator.fire("shoppingCartItems::addSeriesItems",{series:s})},i.addSeriesComplete=function(e){o.find(".series-add-to-cart-text").html(DynamicConfiguration.resourceStrings.addSeriesToCart),o.find(".series-adding-to-cart").addClass("series-add-to-cart").removeClass("series-adding-to-cart"),o.find(".spinner").removeClass("animated-spinner-icon").removeClass("spinner-vector")},function(){if(!i.settings.handle||!i.settings.drawer)return e="ERROR: parameters missing for "+i.type,Kobo.log(e);o.find(".series-add-to-cart").on("click",i.addSeriesToCart),o.find("."+i.settings.handle),o.find("."+i.settings.drawer);var e=i.settings.seriesItems;s=e.split(",").filter(,Kobo._mediator.register("seriesDrawer::openDrawer"),Kobo._mediator.subscribe("seriesDrawer::openDrawer",i.openDrawer),Kobo._mediator.register("seriesDrawer::closeDrawer"),Kobo._mediator.subscribe("seriesDrawer::closeDrawer",i.closeDrawer),Kobo._mediator.register("seriesDrawer::seriesAddComplete"),Kobo._mediator.subscribe("seriesDrawer::seriesAddComplete",i.addSeriesComplete),o.on("click",i.triggerDrawerChange)}()},Kobo.Gizmo.SeriesDrawer.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ProductAction=function(t,o){var n,e,i,c,s,a=this,r=Kobo.Utilities.getProductActionClassList(),l=!1;Kobo.Gizmo.apply(this,arguments),a.setType("ProductAction"),i=a.settings||{},c=a.$el.attr("class").split(" "),a.getProductAction=function(){var t,o,n=[];if(c.length&&r.length)for(t=0;t<c.length;t++)for(o=0;o<r.length;o++)c[t]===r[o]&&n.push(c[t]);if(1<n.length)throw"You can only have one product action per button";return e=n[0]||null},a.mapActionToEvent=function(){if(a.getProductAction(),!e)throw"There is no action associated with this button";l&&"add-to-cart"!==e||(l=!0,n=Kobo.Utilities.productActionEventMapper(e),a.settings.contentDownloadEventData&&(i.completeCallback=s),Kobo._mediator.fire(n,i))},s=function(t){l=!1,t&&"success"===t.result&&a.settings.contentDownloadEventData&&Kobo.event.fireDeviceEvent(a.settings.contentDownloadEventData)},a.setupHandlers=function(){a.$el.on("click",a.mapActionToEvent)},a.destroy=function(){a.setupHandlers()}()},Kobo.Gizmo.ProductAction.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ScrollableTabHeader=function(e,t){var i,o,n,l,s,a=this,r=[],c=[];a.setDefaults({duration:500,easing:"swing"},t),Kobo.Gizmo.apply(this,arguments),a.setType("ScrollableTabHeader"),a.init=function(){i=a.$el.find(a.settings.previousButtonSelector),o=a.$el.find(a.settings.nextButtonSelector),n=a.$el.find(a.settings.wrapperContainerSelector),l=n.find(a.settings.tabHeaderListSelector).toArray(),c=Kobo.Utilities.findAllFocusableElements(n),a.events.onResize(a.onResize),i.click(f),o.click(d),a.onResize()},a.getScrollPages=function(){var s=[];return l.reduce(function(e,t,i){var o=l[i].offsetLeft>n[0].offsetWidth;if(0===i||o){o={scrollPosition:e.scrollPosition+e.size,size:l[i].offsetWidth,pageOffset:e.scrollPosition+e.size};return s.push({tab:[t],scrollPosition:o.scrollPosition}),o}return s[s.length-1].tab.push(t),{scrollPosition:e.scrollPosition+e.size,size:l[i].offsetWidth,pageOffset:e.pageOffset}},{scrollPosition:0,size:0,pageOffset:0}),s};var f=function(){0<s&&(o.show(),u(--s),0===s&&(i.hide(),Kobo.Utilities.findAllFocusableElements(r[s].tab)[0].focus()))},d=function(){s<r.length-1&&(i.show(),u(++s),s===r.length-1&&(o.hide(),Kobo.Utilities.findAllFocusableElements(r[s].tab)[0].focus()))},u=function(e){n.animate({scrollLeft:r[e].scrollPosition},{duration:a.settings.duration,easing:a.settings.easing}),b()},b=function(){r.length&&(c.attr("tabindex",-1).attr("aria-hidden",!0),Kobo.Utilities.findAllFocusableElements(r[s].tab).attr("tabindex",0).attr("aria-hidden",!1))};a.onResize=function(){s=0,"small"===Kobo._mediator.determineBreakpoint()?(0===s?i.hide():i.show(),r=a.getScrollPages(),s===r.length-1?o.hide():o.show(),b()):c.attr("tabindex",0).attr("aria-hidden",!1)},a.destroy=a.init()},Kobo.Gizmo.ScrollableTabHeader.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.DealWidget=function(o,i){Kobo.Gizmo.apply(this,arguments),this.setType("DealWidget");var e,t=this,n=t.$el.find(".long-legal"),l=t.$el.find(".modal-trigger"),c=function(){var o=n.clone();o.removeClass("hidden"),(e=o.find(".close")).on("click",f),Kobo._modal.open(o)},f=function(){Kobo._modal.close(),e.off("click",f)},a=function(){l.on("click",c)};t.destroy=function(){l.off("click",c),e&&e.off("click",f)},)},Kobo.Gizmo.DealWidget.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.BrowseHistory=function(o,t){Kobo.Gizmo.apply(this,arguments),this.setType("BrowseHistory");var i,s=Kobo.$(o);function e(){Kobo.Ajax({url:"/ContentPresenterWidget/RenderBrowseHistoryWidget",success:function(o){var e=Kobo.$.parseHTML(o);e&&(s.html(e),0!=(o=s.find("[data-kobo-gizmo='LightweightCarousel']")).length&&(e=o.attr("data-kobo-gizmo-config"),e=JSON.parse(e),(i=new Kobo.Gizmo.LightweightCarousel(o,e)).$el.find("."+t.RemoveButtonClass).on("click",r),n(i.$el)))},error:function(){},complete:function(){}})}e();var r=function(o){o=JSON.parse(o.delegateTarget.dataset.koboGizmoConfig);Kobo.Ajax({type:"POST",url:"/ContentPresenterWidget/RemoveFromBrowseHistory",dataType:"json",contentType:"application/json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:JSON.stringify({productId:o.productId,workId:o.workId}),success:function(){e()},error:function(){},complete:function(){}})},n=function(o){o.find("[data-kobo-gizmo='Collapsible.HasHeader']").each(function(){var o=$(this).attr("data-kobo-gizmo-config"),o=JSON.parse(o),o=new Kobo.Gizmo.Collapsible.HasHeader($(this),o);$(this).replaceWith(o.$el)}),o.find("."+t.CarouselItemsClass).addClass(t.BrowseHistoryItemsClass)};this.destroy=function(){i&&(i.destroy(),s.find("."+t.RemoveButtonClass).off("click",r))}},Kobo.Gizmo.BrowseHistory.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ContentPresenterBrowseHistory=function(o,e){Kobo.Gizmo.apply(this,arguments),this.setType("ContentPresenterBrowseHistory");var r,t,i,n=Kobo.$(o),s=function(o){var t=JSON.parse(o.delegateTarget.dataset.koboGizmoConfig);Kobo.Ajax({type:"POST",url:"/ContentPresenterWidget/RemoveFromBrowseHistory",dataType:"json",contentType:"application/json",headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:JSON.stringify({productId:t.productId,workId:t.workId}),success:function(){for(var o=r.$el.find("[data-product-id='"+t.productId+"']"),e=0;e<o.length;e++)o[e].remove();0===r.$el.find(".item-container").length&&r.$el.parent().parent().remove()},error:function(){},complete:function(){}})};0!=(i=n.find("[data-kobo-gizmo='LightweightCarousel']")).length&&(t=i.attr("data-kobo-gizmo-config"),t=JSON.parse(t),(r=new Kobo.Gizmo.LightweightCarousel(i,t)).$el.find("."+e.RemoveButtonClass).on("click",s),n.find(".carousel-items").addClass(e.BrowseHistoryItemsClass)),this.destroy=function(){r&&(r.destroy(),n.find("."+e.RemoveButtonClass).off("click",s))}},Kobo.Gizmo.ContentPresenterBrowseHistory.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ShortLongLegalTextWidget=function(o,e){Kobo.Gizmo.apply(this,arguments),this.setType("ShortLongLegalTextWidget");var t,i,n,c,l,f=this,g=function(){var o=c.clone();o.removeClass("hidden"),(n=o.find(".close")).on("click",r),Kobo._modal.open(o)},r=function(){Kobo._modal.close(),n.off("click",r)},d=f.destroy=function(){t=e.dialogSelector,i=e.dialogTriggerSelector,c=f.$el.find(t),l=f.$el.find(i),c.length&&l.length&&d()}()},Kobo.Gizmo.ShortLongLegalTextWidget.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ResultDisplayController=function(e,o){var t,a,s=this,r=Kobo.$(e),i=Kobo.$(window).width();Kobo.Gizmo.apply(this,arguments),s.setType("ResultDisplayController"),s.setViewSettings=function(e,o){var i="list"===o.detail.searchView&&"list"!==t;s.persistDisplayPreferences({resultsFormat:o.detail.searchView}),i?Kobo.Utilities.reload():(r.removeClass(a).addClass(o.detail.searchView),s.removeEllisions(),a=o.detail.searchView,r.data("view",a),Kobo._mediator.fire("searchLayout::viewChanged",{searchView:a}))},s.hasOverflowed=function(e){return e.offsetHeight+1<e.scrollHeight},s.setReadMore=function(){r.find(".synopsis").each(function(){s.hasOverflowed(this)?Kobo.$(this).addClass("read-more"):Kobo.$(this).removeClass("read-more")})},s.setReadMore=function(){r.find(".synopsis-contributors").each(function(){s.hasOverflowed(this)?Kobo.$(this).addClass("read-more"):Kobo.$(this).removeClass("read-more")})},s.setEllisions=function(){r.find("[data-ellide=true]").each(function(){var e=Kobo.$(this).data("ellideOnly");"undefined"!==e&&e!==a||(s.hasOverflowed(this)?Kobo.$(this).addClass("ellided"):Kobo.$(this).removeClass("ellided"))})},s.removeEllisions=function(){r.find("[data-ellide=true]").each(},s.updateDisplay=s.bindActions=function(){r.on("click","[data-action-event]",null,function(){var e=Kobo.$(this).attr("data-action-event"),o=Kobo.$(this).attr("data-action-params");Kobo._mediator.fire(e,JSON.parse(o))})},e=function(){Kobo._mediator.register("searchLayout::viewChangeRequested"),Kobo._mediator.subscribe("searchLayout::viewChangeRequested",s.setViewSettings),Kobo._mediator.register("searchLayout::viewInitialised"),Kobo._mediator.subscribe("searchLayout::viewInitialised",s.updateDisplay),Kobo._mediator.register("searchLayout::viewChanged"),Kobo._mediator.subscribe("searchLayout::viewChanged",s.updateDisplay),Kobo._mediator.register("searchLayout::viewResized"),Kobo._mediator.subscribe("searchLayout::viewResized",s.updateDisplay),a=r.data("view"),t=a,Kobo._mediator.fire("searchLayout::viewInitialised",{searchView:a}),s.bindActions(),o.isUsingNarrowDownFilterTheme&&Kobo.$("aside.column-aside.content-aside").addClass("narrow-down-filters")},s.destroy=function(){Kobo._mediator.unSubscribe("searchLayout::viewChangeRequested",s.setViewSettings),Kobo._mediator.unRegister("searchLayout::viewChangeRequested"),Kobo._mediator.unRegister("searchLayout::viewInitialised"),Kobo._mediator.unSubscribe("searchLayout::viewInitialised",s.updateDisplay),Kobo._mediator.unRegister("searchLayout::viewChanged"),Kobo._mediator.unSubscribe("searchLayout::viewChanged",s.updateDisplay),Kobo._mediator.unRegister("searchLayout::viewResized"),Kobo._mediator.unSubscribe("searchLayout::viewResized",s.updateDisplay)},e(),Kobo.$(window).resize(function(){var e=Kobo.$(window).width();i!==e&&(i=e,Kobo._mediator.fire("searchLayout::viewResized"))})},Kobo.Gizmo.ResultDisplayController.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.ContentPresenterLoader=function(){Kobo.Gizmo.apply(this,arguments);var t,o,e=this,i=e.settings.workId,n=e.settings.productType,a=e.settings.url,r=e.$el.find(".search-item-carousel"),s=e.$el.find(".related-titles-carousel-toggle"),d=DynamicConfiguration.resourceStrings.seeSimilarTitles,l=DynamicConfiguration.resourceStrings.hideSimilarTitles;"Book"===n&&(o=function(o){o.stopPropagation(),Kobo._mediator.fire("collapsible::toggle",{name:e.options.name}),s.text().trim()===d?(s.attr("aria-expanded",!0),s.text(l)):(s.attr("aria-expanded",!1),s.text(d))},t=r,Kobo.$.ajax({type:"GET",url:a,data:{workId:i,productType:n}}).done(function(o){var e;0<o.length&&(e=Kobo.$.parseHTML(o,!0),s.removeClass("hidden"),o=e,(e=t).append(o),(o=e.find(".carousel-container")).length&&Kobo._gizmo.initGizmo(o),(e=e.find("[lazy-load-parent]")).length&&1===e.length&&Kobo.LazyLoad.addToObserver(e[0]),dispatchEvent(new Event("loadRelatedBooks")))}),s.on("click",o))},Kobo.Gizmo.ContentPresenterLoader.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";!function(s){function i(i,t){var e=this;s.Gizmo.apply(this,arguments),this.setType("LandingPageHeader"),this.settings=s.extend({},t),this.events.onResize(function(){e.resizeDescriptionContainer()}),s.$(document).ready(function(){"small"!==e.currentBreakpoint()&&e.resizeDescriptionContainer()})}(i.prototype=s.chainPrototype(s.Gizmo.prototype)).resizeDescriptionContainer=function(){var i;"small"!==this.currentBreakpoint()?(i=this.$gizmo.find("."+this.settings.descriptionSelector).height(),this.$gizmo.find("."+this.settings.descriptionContainerSelector).css("height",i),this.$gizmo.find("."+this.settings.expandableInnerMaskerSelector).css("height",i)):(this.$gizmo.find("."+this.settings.descriptionContainerSelector).css("height",""),this.$gizmo.find("."+this.settings.expandableInnerMaskerSelector).css("height",this.settings.smallDescriptionDefaultHeight))},s.Gizmo.LandingPageHeader=i}(Kobo);
"use strict";Kobo.Gizmo.CountryStoreModal=function(){var o,t,e=this;e.setDefaults({cookieDomain:"kobobooks.com"}),Kobo.Gizmo.apply(e,arguments),o=function(){var o=e.$el.children();(t=e.$el.find(".close")).on("click",Kobo._modal.close),Kobo._modal.open(o,{customClass:"country-store-modal-container"}),Cookies.set("persistent",Cookies.get("persistent")+"&countryStoreModal=0",{raw:!0,path:"/",domain:e.settings.cookieDomain})},e.destroy=o()},Kobo.Gizmo.CountryStoreModal.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.CountryStoreHeader=function(o,e){var t,i,n,s,r,a,c,l,d,b,m=this,u="top-banner",p="top-banner-content";m.setDefaults({cookieDomain:"kobo.com"}),Kobo.Gizmo.apply(m,arguments),s=function(o,e){i(),c(e=e||{}),o&&(d.html(o),a())},r=function(){Kobo.$("#"+u).remove(),Kobo.$body.removeClass(u),Cookies.set("persistent",Cookies.get("persistent")+"&countryStoreModal=0",{raw:!0,path:"/",domain:m.settings.cookieDomain})},b=function(o){o.stopPropagation()},c=function(o){l.removeClass(),d.removeClass(),o.isCancellable?(d.on("click",b),l.on("click",Kobo._modal.close)):(d.off("click",b),l.off("click",Kobo._modal.close)),o.theme&&l.addClass(o.theme),o.customClass&&d.addClass(o.customClass),o.role&&d.attr("role",o.role)},t=n=function(){d.outerHeight(!0)>Kobo.$window.height()?d.css({verticalAlign:"top"}):d.css({verticalAlign:""}),d.css("width","auto"),d.outerWidth(!0)<=Kobo.$window.width()&&d.css("width","")},i=function(){var o="";Kobo._tracker&&(o=Kobo._tracker.getTrackAttribute()+'=\'{ "section": "modal" }\''),t()||(l=Kobo.$('<div id="'+u+'" '+o+"></div>"),d=Kobo.$('<div id="'+p+'" role="dialog"></div>'),l.append(d),Kobo.$(".rich-header-spacer").before(l))},a=function(){var o=m.$el.children();!0===e.slimHeader&&(u+="-slim",p+="-slim"),m.$el.find(".close").on("click",r),s(o,{customClass:"country-store-top-banner-container"})}()},Kobo.Gizmo.CountryStoreHeader.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.Dismissable=function(){var o,i,s=this;Kobo.Gizmo.apply(s,arguments),o=function(){i.close()},s.destroy=function(){i=null,s.$el.find(".dismiss").off("click",o)},function(){i=new Collapsible(s.$el),s.$el.find(".dismiss").on("click",o)}()},Kobo.Gizmo.Dismissable.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.KoboPlusAvailabilityPad=function(o){Kobo.Gizmo.apply(this,arguments);var i=this,s=null,t=null,e=!1,n=this.options.isUserAnonymous,b=this.options.isSubbedToKoboPlusRead,l=this.options.isSubbedToKoboPlusListen,d=this.options.isSubbedToKoboPlusCombo,u=this.options.itemOwnedUnderKoboPlus,a=this.options.isBook;this.viewModel={unauthenticated:ko.observable(n),isSubbedToKoboPlusRead:ko.observable(b),isSubbedToKoboPlusListen:ko.observable(l),isSubbedToKoboPlusCombo:ko.observable(d),itemOwnedUnderKoboPlus:ko.observable(u),isBook:ko.observable(a)},a=s=function(o){e=!1,o&&"success"===o.result&&(i.viewModel.itemOwnedUnderKoboPlus(!0),i.settings.contentDownloadEventData&&Kobo.event.fireDeviceEvent(i.settings.contentDownloadEventData))},t=function(){e||(e=!0,i.fire("productAction::addToReadingListUnderSubscription",{actionUrl:i.settings.addBookUnderSubToLibraryUrl,productId:i.settings.productId,subscriptionId:i.settings.subscriptionId,completeCallback:s}))},a(),ko.applyBindings(i.viewModel,o)},Kobo.Gizmo.KoboPlusAvailabilityPad.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.ViewModel.Navigation||(Kobo.ViewModel.Navigation={}),Kobo.ViewModel.Navigation.Paging={},Kobo.ViewModel.Navigation.Paging.Base=function(i,e,t){var o=this;this.setDefaults({noInit:!1,pageSize:6,totalNumberOfItems:0,useCircularScroll:!0}),Kobo.ViewModel.Base.apply(o,[i,e]),o.setType("Navigation.Paging.Base"),o.scrollPositionIndex=ko.observable(0).extend({notify:"always"}),o.isActivated=ko.observable(!1),o.pageSize=ko.observable(o.settings.pageSize),o.totalNumberOfItems=ko.observable(o.settings.totalNumberOfItems),o.isCircular=o.settings.useCircularScroll,o.numberOfAvailPages=ko.observable(),o.numberOfAvailPages.subscribe(function(){o.updatePageObservables()}),o.prevButton=ko.observable(),o.nextButton=ko.observable(),o.numberOfPages=ko.computed(,i=function(){ko.applyBindings(this,this.el),this.updatePageObservables("initial")},o.existsNextPage||(o.existsNextPage=ko.observable(!1)),o.existsPreviousPage||(o.existsPreviousPage=ko.observable(!1)),e.noInit||i.call(this)},Kobo.ViewModel.Navigation.Paging.Base.prototype=Kobo.chainPrototype(Kobo.ViewModel.Base.prototype),Kobo.ViewModel.Navigation.Paging.Base.prototype.navObject={},Kobo.ViewModel.Navigation.Paging.Dynamic=function(i,e,t){Kobo.ViewModel.Navigation.Paging.Base.apply(this,arguments),this.isCircular?this.existsNextPage=ko.computed(this):this.existsNextPage=ko.computed(function(){return this.scrollPositionIndex()+1+this.pageSize()<this.totalNumberOfItems()},this),this.scrollPositionIndexCorrected=ko.observable(this.scrollPositionIndex()),this.navObject={read:{scrollPositionIndex:this.scrollPositionIndex,isActivated:this.isActivated},write:{scrollPositionIndexCorrected:this.scrollPositionIndexCorrected,pageSize:this.pageSize,totalNumberOfItems:this.totalNumberOfItems}},function(){ko.applyBindings(this,this.el),this.updatePageObservables("initial")}.call(this)},Kobo.ViewModel.Navigation.Paging.Dynamic.prototype=Kobo.chainPrototype(Kobo.ViewModel.Navigation.Paging.Base.prototype),Kobo.ViewModel.Navigation.Paging.Dynamic.prototype.showNext=function(){this.isActivated()||this.isActivated(!0),this.existsNextPage()&&this.goByPage(1)},Kobo.ViewModel.Navigation.Paging.Dynamic.prototype.goByPage=function(i){this.scrollPositionIndex();i=this.scrollPositionIndexCorrected()+i*this.pageSize();!this.isCircular&&i+this.pageSize()-1>this.totalNumberOfItems()&&(i=this.totalNumberOfItems()-this.pageSize()),this.scrollPositionIndexCorrected(i=i<0?0:i),this.scrollPositionIndex(i),this.updatePageObservables()},Kobo.ViewModel.Navigation.Paging.Dynamic.prototype.showPrevious=function(){this.isActivated()||this.isActivated(!0),this.existsPreviousPage()&&this.goByPage(-1)},Kobo.ViewModel.Navigation.Paging.Dynamic.prototype.updatePageObservables=function(i){this.isCircular?this.existsPreviousPage(!i&&this.pageSize()<this.totalNumberOfItems()):this.existsPreviousPage(0!==this.scrollPositionIndex())},Kobo.ViewModel.Navigation.Paging.Static=function(i,e,t){this.currentPage=ko.observable(1),this.currentPage.subscribe(,Kobo.ViewModel.Navigation.Paging.Base.apply(this,arguments),this.navObject={read:{scrollPositionIndex:this.scrollPositionIndex,isActivated:this.isActivated},write:{pageSize:this.pageSize,numberOfAvailPages:this.numberOfAvailPages}},this.currentPage.subscribe(function(i){i=(i-1)*this.pageSize();this.scrollPositionIndex(i=i<0?0:i),this.updatePageObservables()},this),this.pageSize.subscribe(function(i){0<i&&(i=Math.round((this.scrollPositionIndex()-1)/i+1),this.currentPage(i))},this)},Kobo.ViewModel.Navigation.Paging.Static.prototype=Kobo.chainPrototype(Kobo.ViewModel.Navigation.Paging.Base.prototype),Kobo.ViewModel.Navigation.Paging.Static.prototype.updatePageObservables=function(){this.existsPreviousPage(1<this.currentPage()),this.existsNextPage(this.currentPage()<this.numberOfAvailPages())},Kobo.ViewModel.Navigation.Paging.Static.prototype.showNext=function(){this.isActivated()||this.isActivated(!0);var i=this.currentPage()+1;(this.existsNextPage()||this.isCircular)&&1<this.numberOfAvailPages()&&this.currentPage(i)},Kobo.ViewModel.Navigation.Paging.Static.prototype.showPrevious=function(){var i;this.isActivated()||this.isActivated(!0),(this.existsPreviousPage()||this.isCircular)&&1<this.numberOfAvailPages()&&(i=this.currentPage(),this.currentPage(i-1))};
"use strict";Kobo.Utilities.assignToNamespace("Kobo.ViewModel.AudiobookCreditBalanceBannerVM",function(e){var o=this,s=DynamicConfiguration.resourceStrings.audiobookCreditBanner,r=DynamicConfiguration.resourceStrings.audiobookCreditsBanner,t=DynamicConfiguration.resourceStrings.getMoreCredits,n=e.setCookie;this.creditsInitialized=ko.observable(!1),this.creditBalance=ko.observable(0),this.isDismissed=ko.observable(!0),this.isHidden=ko.pureComputed(function(){return!!o.isDismissed()||(!e.hasHadAudiobooksSubscription&&!e.hasAudiobooksSubscription||!(e.hasHadAudiobooksSubscription&&o.creditsInitialized()&&0<o.creditBalance())&&(!e.hasAudiobooksSubscription||!o.creditsInitialized()))}),this.dismissBanner=function(){o.isDismissed(!0);var i=o.creditBalance();n({isDismissed:!0,creditBalance:i}),Kobo.$(".AudiobooksSubscriptionBannerWidget").remove()},this.iconClass=ko.pureComputed(,this.link=ko.pureComputed(function(){var i=o.creditBalance();return e.hasAudiobooksSubscription&&0===i?e.getMoreCreditsUrl:""}),this.creditLabel=ko.pureComputed(function(){var i=o.creditBalance();return(0===i?t:1===i?s:r).replace("{0}",i)},this)});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.ViewModel.CreateAccountBannerVM",function(t){var o=t.setCookie,e=t.createAccountUrl;this.dismissBanner=function(){o(!0),Kobo.$(t.createAccountWidgetClass).remove()},this.openDialog=function(){var o=Kobo.$("#"+t.templateId),e=Kobo.$('<div id="'+t.dialogId+'">');e.html(o.html()),Kobo._modal.open(e),ko.applyBindings(this,document.getElementById(t.dialogId))},this.closeDialog=function(){Kobo._modal.close()},this.createAccountRedirect=);
"use strict";Kobo.Gizmo.CreateAccountBanner=function(e,t){var o,n,i,a,r;Kobo.Gizmo.apply(this,arguments),this.setType("CreateAccountBanner"),n=function(){Kobo.$(e).find("."+t.showDialogBtnClass).on("click",function(){o.openDialog()})},i=a=function(){var o=i();o&&!0===o?Kobo.$(e).parent().addClass("hidden"):Kobo.$(e).parent().removeClass("hidden")},o=new Kobo.ViewModel.CreateAccountBannerVM({setCookie:function(o){Cookies.set(t.hideBannerCookie,JSON.stringify(o),{expires:365,path:"/",raw:!0})},createAccountUrl:t.createAccountUrl,templateId:t.templateId,dialogId:t.dialogId,createAccountWidgetClass:t.createAccountWidgetClass}),r=function(){n()},a(),ko.applyBindings(o,this.el),r()},Kobo.Gizmo.CreateAccountBanner.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Utilities.assignToNamespace("Kobo.ViewModel.ItemPromoOfferBannerVM",function(e){var i=this,o=e.setCookie;this.isDismissed=ko.observable(!0),this.isHidden=ko.pureComputed(,this.dismissBanner=this.showNewCustomerCreditAppliedBanner=ko.observable(!1),this.showNewCustomerCreditAvailableBanner=ko.observable(!1),this.hideItemPromotionAddedToCartNotification=this.showItemPromotionAddedToCartNotification=ko.pureComputed(});
"use strict";unction _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(i),!0).forEach(function(t){_defineProperty(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(}return e}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(n){function t(t){((this.gizmo=t).viewModel=this).settings=t.settings,this.$el=t.$gizmo,this.$expandableHeader=t.$innerContent.find("> .expandable-header"),this.isCollapsed=this.createIsCollapsedObservable(),this.$contentLinks=n.Utilities.findAllFocusableElements(t.$innerContent);this.transEndEventName={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[Modernizr.prefixed("transition")],this.height=ko.observable(this.getGizmoHeight()),this.animationQueueEnd=function(){},this.recalculateHeight=this.recalculateHeight.bind(this),this.setupHandlers(),0<this.$expandableHeader.length&&(this.$el.prepend(this.$expandableHeader),"false"===this.settings.allowBindings&&this.$expandableHeader.wrapAll('<div data-bind="allowBindings: '+this.settings.allowBindings.toString()+'"/>'))}function e(t,e){n.ViewModel.Expandable.apply(this,arguments);var i=this;i.$button=null,i.buttonWidth=null,i.registerExpandableRemoveButton=function(){t.register("expandable::removeButton"),t.subscribe("expandable::removeButton",function(){i.removeButton()})},i.onButtonSelected=function(){i.isCollapsed()?(i.$button.find(".gizmo-expandable-subbutton").css("-webkit-animation","rotation-down 0.5s 1 linear").css("transform",""),i.$contentLinks.attr("tabindex","0").attr("aria-hidden","")):(i.$button.find(".gizmo-expandable-subbutton").css("-webkit-animation","rotation-up 0.5s 1 linear").css("transform","none"),i.$contentLinks.attr("tabindex","-1").attr("aria-hidden","true")),i.toggle(),i.updateAria(i.$button)},i.handleButtonKeyDown=function(t){switch(t.keyCode){case n.KeyCodes.ESC:i.isCollapsed()||(i.onButtonSelected(),i.$button.focus());break;case n.KeyCodes.SPACE:t.preventDefault();case n.KeyCodes.DOWN:case n.KeyCodes.RETURN:i.onButtonSelected(),i.$contentLinks&&0!==i.$contentLinks.length&&i.$contentLinks[0].focus();break;case n.KeyCodes.UP:i.onButtonSelected(),i.$contentLinks&&0!==i.$contentLinks&&i.$contentLinks[i.$contentLinks.length-1].focus()}},t.$gizmo.addClass("gizmo-expandable"),i.addButton(),i.$button.on("click",i.onButtonSelected),i.$button.on("keydown",i.handleButtonKeyDown),i.registerExpandableRemoveButton()}(t.prototype={}).recalculateHeight=function(){this.height(this.getGizmoHeight())},t.prototype.getGizmoHeight=function(){return this.isCollapsed()?this.gizmo.settings.height:this.gizmo.defaultHeight()+"px"},t.prototype.createIsCollapsedObservable=function(){var t;return"object"===n.typeOf(this.gizmo.settings.isCollapsed)?(t=n.Object.parseBool(this.gizmo.settings.isCollapsed[this.gizmo.currentBreakpoint()]),ko.observable(t)):ko.observable(this.gizmo.settings.isCollapsed)},t.prototype.animate=function(t){this.gizmo.$innerMasker.stop().animate({height:t},this.animationQueueEnd)},t.prototype.toggle=function(t){var e=this;"boolean"===n.Object.typeOf(t)?(this.isCollapsed(!t),t=this.getGizmoHeight()):(isNaN(parseFloat(t))&&(t=void 0),this.isCollapsed(!this.isCollapsed()));t=void 0!==t?t:this.getGizmoHeight();Modernizr.csstransitions?this.height(t):this.animate(t),!1!==this.settings.toggleEvent&&this.gizmo.fire(this.settings.toggleEvent,{isCollapsed:this.isCollapsed()}),!1!==this.settings.collapseOnEvent&&("small"!==(t=this.gizmo.currentBreakpoint())&&"medium"!==t||this.gizmo.fire(this.settings.collapseOnEvent,{gizmo:this.gizmo})),this.stockAndroidTimeout=setTimeout(function(){e.gizmo.fire("expandableResized",{height:e.height()})},800)},t.prototype.updateAria=function(t){var e="true"===t.attr("aria-expanded");t.attr("aria-expanded",!e)},t.prototype.toggleAction=t.prototype.registerExpandableResizedEvent=function(){var t=this;this.gizmo.register("expandableResized"),Modernizr.csstransitions?this.gizmo.$innerMasker.on(this.transEndEventName,function(){clearTimeout(t.stockAndroidTimeout),t.gizmo.fire("expandableResized",{height:t.height()})}):this.animationQueueEnd=,t.prototype.setupHandlers=function(){this.gizmo.events.onResize(this.recalculateHeight)},(e.prototype=n.chainPrototype(t.prototype)).addButton=function(){var t,e,i;this.gizmo.settings.isButtonRenderedOnServer?this.$button=this.$el.find("button#"+this.gizmo.settings.expandableButtonId):(t="expandable-button-".concat(this.gizmo.guid),e="expandable-list-".concat(this.gizmo.guid),i=_objectSpread(_objectSpread({},this.gizmo.settings.ariaLabel?{"aria-label":DynamicConfiguration.resourceStrings.filterSortProducts}:{}),this.gizmo.settings.ariaHasPopup?{"aria-haspopup":!0}:{}),this.$button=n.$("<button>",_objectSpread({id:t,class:"gizmo-expandable-button",type:"button","aria-controls":e},i)),this.$button.text(this.gizmo.settings.text),this.$el.find("ul").attr("id",e).attr("aria-labelledby",t),this.$el.append(this.$button)),this.$button.data("bind",'css: {"gizmo-expandable-button-collapsed": isCollapsed()}'),this.$button.attr("aria-expanded",!this.isCollapsed()),this.buttonWidth=this.$button.width()/2,this.$el.find("ul").attr("aria-busy",!1),this.$el.data("data-bind",'css: {"gizmo-expandable-collapsed": isCollapsed()}')},e.prototype.removeButton=void 0===n.ViewModel&&(n.ViewModel={}),n.ViewModel.Expandable=t,n.ViewModel.Expandable.BaseButton=e}(Kobo);
"use strict";!function(e){function t(t,o){var n=this;e.ViewModel.Expandable.BaseButton.apply(this,arguments),this.setButtonX(this.returnButtonX()),t.events.onResize(}(t.prototype=e.chainPrototype(e.ViewModel.Expandable.BaseButton.prototype)).addButton=function(){e.ViewModel.Expandable.BaseButton.prototype.addButton.call(this),this.$subButton=e.$('<div class="gizmo-expandable-subbutton">').attr("tabindex","0").attr("role","button").attr("aria-label","open and close the section to read more"),this.$button.addClass("gizmo-expandable-button-arrow"),this.$button.append(this.$subButton)},t.prototype.setButtonX=t.prototype.returnButtonX=function(){return this.$el.width()/2-this.buttonWidth},e.ViewModel.Expandable.ArrowButton=t}(Kobo);
"use strict";Kobo.ViewModel.Expandable.ExternalTrigger=Kobo.ViewModel.Expandable.ExternalTrigger.prototype=Kobo.chainPrototype(Kobo.ViewModel.Expandable.BaseButton.prototype),Kobo.ViewModel.Expandable.ExternalTrigger.prototype.addButton=function(){var t=this.$el.find(".external-trigger")[0];t.setAttribute("class","gizmo-expandable-button"),t.setAttribute("data-bind",'css: {"gizmo-expandable-button-collapsed": isCollapsed()}'),this.$el.attr("data-bind",'css: {"gizmo-expandable-collapsed": isCollapsed()}'),this.$button=Kobo.$(t),this.buttonWidth=this.$button.width()/2,this.$el.prepend(this.$button),this.$button.addClass("external-trigger"),this.$button.addClass("gizmo-expandable-button-fixed-chevron")};
"use strict";!function(i){function e(e,t){i.ViewModel.Expandable.BaseButton.apply(this,arguments),this.currentSize=e.currentBreakpoint(),this.gizmo=e,this.handleResize=this.handleResize.bind(this),this.handleGizmosInitialized=this.handleGizmosInitialized.bind(this),this.registerEvents()}(e.prototype=i.chainPrototype(i.ViewModel.Expandable.BaseButton.prototype)).registerEvents=function(){this.gizmo.events.onResize(this.handleResize),this.gizmo.subscribe("gizmosInitialized",this.handleGizmosInitialized)},e.prototype.addButton=function(){i.ViewModel.Expandable.BaseButton.prototype.addButton.call(this),this.$button.addClass("gizmo-expandable-button-plus")},e.prototype.setButtonX=e.prototype.handleResize=function(e){this.currentSize!==e.currentSize&&("small"!==e.currentSize||this.isCollapsed()||this.toggle(),"small"!==e.currentSize&&this.isCollapsed()&&this.toggle()),this.currentSize=e.currentSize},e.prototype.handleGizmosInitialized=function(){this.gizmo.viewModel.registerExpandableResizedEvent(),this.gizmo.subscribe("expandableResized",this.recalculateHeight),this.gizmo.fire("expandableResized")},i.ViewModel.Expandable.PlusButton=e}(Kobo);
"use strict";Kobo.ViewModel.Expandable.PlusButtonGiftCard=Kobo.ViewModel.Expandable.PlusButtonGiftCard.prototype=Kobo.chainPrototype(Kobo.ViewModel.Expandable.BaseButton.prototype),Kobo.ViewModel.Expandable.PlusButtonGiftCard.prototype.addButton=function(){Kobo.ViewModel.Expandable.BaseButton.prototype.addButton.call(this),this.$button.addClass("gizmo-expandable-button-plus")};
"use strict";Kobo.ViewModel.Expandable.FacetListButton=function(i,t){var o=this;o.$header=i.$innerContent.find("> .facet-list-header"),i.$gizmo.prepend(o.$header),Kobo.ViewModel.Expandable.BaseButton.apply(this,arguments),i.register("updateHeight"),i.subscribe("updateHeight",function(){i.viewModel.height(i.viewModel.isCollapsed()?i.viewModel.settings.height:i.defaultHeight()+"px")}),!1!==i.settings.collapseOnEvent&&(i.register(i.settings.collapseOnEvent),i.subscribe(i.settings.collapseOnEvent,function(t,e){e.detail.gizmo.viewModel.isCollapsed()||e.detail.gizmo.guid===i.guid||i.viewModel.toggle(!1)})),!1!==i.settings.extendToListItemWidth&&(o.headerText=o.$header.find(".facet-list-largeview-header"),o.facetList=i.$gizmo.find("ul.facet-list"),o.extendToListItemWidth=function(){var e,t=Kobo._mediator.determineBreakpoint();"large"===t||"jumbo"===t?(e=o.headerText.width(),o.facetList.css("width","1000px"),o.facetList.find("li a").each(function(){var t=Kobo.$(this).css("display");Kobo.$(this).css("display","inline-block"),Kobo.$(this).width()>e&&(e=Kobo.$(this).width()),Kobo.$(this).css("display",t)}),o.facetList.css("width","auto"),o.headerText.width(e)):o.headerText.css("width","auto")},i.events.onResize(o.extendToListItemWidth),o.extendToListItemWidth())},Kobo.ViewModel.Expandable.FacetListButton.prototype=Kobo.chainPrototype(Kobo.ViewModel.Expandable.BaseButton.prototype),Kobo.ViewModel.Expandable.FacetListButton.prototype.addButton=function(){var t;Kobo.ViewModel.Expandable.BaseButton.prototype.addButton.call(this),this.$button.addClass("gizmo-expandable-button-facetlist"),(t=document.createElement("div")).setAttribute("class","gizmo-expandable-subbutton-wrapper"),this.subButtonWrapper=Kobo.$(t),this.$button.append(this.subButtonWrapper),(t=document.createElement("div")).setAttribute("class","gizmo-expandable-subbutton"),this.$subButton=Kobo.$(t),this.subButtonWrapper.append(this.$subButton),void 0!==this.$header&&this.$header.append(this.$button)};
"use strict";Kobo.ViewModel.Expandable.FilterListButton=function(t,e){Kobo.ViewModel.Expandable.BaseButton.apply(this,arguments);var o=this;o.$header=t.$innerContent.find("> .facet-list-header"),t.$gizmo.prepend(o.$header),t.events.onResize(},Kobo.ViewModel.Expandable.FilterListButton.prototype=Kobo.chainPrototype(Kobo.ViewModel.Expandable.BaseButton.prototype),Kobo.ViewModel.Expandable.FilterListButton.prototype.addButton=function(){var t;Kobo.ViewModel.Expandable.BaseButton.prototype.addButton.call(this),this.$button.addClass("gizmo-expandable-button-sort"),(t=document.createElement("div")).setAttribute("class","gizmo-expandable-sort-subbutton-wrapper"),this.subButtonWrapper=Kobo.$(t),this.$button.append(this.subButtonWrapper),(t=document.createElement("div")).setAttribute("class","gizmo-expandable-sort-subbutton"),this.$subButton=Kobo.$(t),this.subButtonWrapper.append(this.$subButton),this.$header.append(this.$button)};
"use strict";!function(e){function t(t,o){e.ViewModel.Expandable.ArrowButton.apply(this,arguments),this.toggle=this.toggle.bind(this),this.registerEvents()}(t.prototype=e.chainPrototype(e.ViewModel.Expandable.ArrowButton.prototype)).registerEvents=t.prototype.handleResize=t.prototype.toggle=function(){this.isCollapsed(!this.isCollapsed()),Modernizr.csstransitions?this.recalculateHeight():this.gizmo.$gizmo.animate("height")},t.prototype.addButton=function(){e.ViewModel.Expandable.ArrowButton.prototype.addButton.call(this),this.buttonWidth=this.$button.width()/2,this.$button.addClass("gizmo-expandable-button-twostep")},e.ViewModel.Expandable.TwoStepExpandableButton=t}(Kobo);
"use strict";Kobo.ViewModel.Expandable.FacetListButtonNested=function(n,e){var l=this;l.$header=n.$innerContent.find("> .facet-list-header"),n.$gizmo.prepend(l.$header),Kobo.ViewModel.Expandable.BaseButton.apply(this,arguments),l.childExpandables=[],l.currentSize=n.currentBreakpoint(),n.viewModel.allowTab=!0,n.subscribe("gizmosInitialized",function(){var e,t=n.descendants.length;if(0<t){for(var i=0;i<t;i++)"Class.Gizmo.Expandable"===(e=n.descendants[i]).type&&(l.childExpandables.push(e),e.viewModel.registerExpandableResizedEvent(),e.viewModel.allowTab=!0);n.subscribe("expandableResized",function(){l.$contentLinks=Kobo.Utilities.findAllFocusableElements(n.$innerContent),l.isCollapsed()?(l.childExpandables.map(function(e){e.viewModel.isCollapsed()||e.viewModel.toggle()}),l.height("0px"),l.$contentLinks.attr("tabindex","-1").attr("aria-hidden",!0)):(l.height(l.childExpandables.reduce(function(e,t){return e+parseInt(t.viewModel.height())},0)+parseInt(l.getGizmoHeight())+"px"),l.$contentLinks.attr("tabindex","0").removeAttr("aria-hidden"),l.childExpandables.map(function(e){e.viewModel.isCollapsed()&&e.viewModel.$contentLinks.attr("tabindex","-1").attr("aria-hidden",!0)}))})}n.fire("expandableResized")}),n.events.onResize(function(e){var t,i=l.childExpandables.length,n=!1,o=!1,a=!1,s=!1;if("boolean"!=typeof l.settings.isCollapsed&&(n=l.settings.isCollapsed.small||!1,o=l.settings.isCollapsed.medium||!1,a=l.settings.isCollapsed.large||!1,s=l.settings.isCollapsed.jumbo||!1),l.currentSize!==e.currentSize)if(("small"===e.currentSize&&n||"medium"===e.currentSize&&o)&&!l.isCollapsed()){for(;i--;)(t=l.childExpandables[i]).viewModel.isCollapsed()||t.viewModel.toggle();l.toggle()}else if(("medium"===e.currentSize&&!o||"large"===e.currentSize&&!a||"jumbo"===e.currentSize&&!s)&&l.isCollapsed()){for(;i--;)(t=l.childExpandables[i]).viewModel.isCollapsed()&&t.viewModel.toggle();l.toggle()}l.currentSize=e.currentSize}),!1!==n.settings.collapseOnEvent&&(n.register(n.settings.collapseOnEvent),n.subscribe(n.settings.collapseOnEvent,function(e,t){t.detail.gizmo.viewModel.isCollapsed()||t.detail.gizmo.guid===n.guid||n.viewModel.toggle(!1)}))},Kobo.ViewModel.Expandable.FacetListButtonNested.prototype=Kobo.chainPrototype(Kobo.ViewModel.Expandable.BaseButton.prototype),Kobo.ViewModel.Expandable.FacetListButtonNested.prototype.addButton=function(){var e;Kobo.ViewModel.Expandable.BaseButton.prototype.addButton.call(this),this.$button.addClass("gizmo-expandable-button-facetlist"),(e=document.createElement("div")).setAttribute("class","gizmo-expandable-subbutton-wrapper"),this.subButtonWrapper=Kobo.$(e),this.$button.append(this.subButtonWrapper),(e=document.createElement("div")).setAttribute("class","gizmo-expandable-subbutton"),this.$subButton=Kobo.$(e),this.subButtonWrapper.append(this.$subButton),void 0!==this.$header&&this.$header.append(this.$button)};
"use strict";!function(t){function e(e,i){t.ViewModel.Expandable.BaseButton.apply(this,arguments),this.$header=this.gizmo.$innerContent.find("> .facet-list-header"),this.gizmo.$gizmo.prepend(this.$header),this.currentSize=this.gizmo.currentBreakpoint(),this.setupHandlers()}(e.prototype=t.chainPrototype(t.ViewModel.Expandable.BaseButton.prototype)).setupHandlers=function(){this.handleGizmosInitialized=this.handleGizmosInitialized.bind(this),this.handleResize=this.handleResize.bind(this),this.gizmo.subscribe("gizmosInitialized",this.handleGizmosInitialized),this.gizmo.events.onResize(this.handleResize)},e.prototype.handleGizmosInitialized=function(){this.gizmo.viewModel.allowTab=!0,this.handleCollapse=this.handleCollapse.bind(this),this.gizmo.viewModel.registerExpandableResizedEvent(),this.gizmo.subscribe("expandableResized",this.recalculateHeight);var e=this.gizmo.settings.collapseOnEvent;e&&(this.gizmo.register(e),this.gizmo.subscribe(e,this.handleCollapse)),this.gizmo.fire("expandableResized"),t._gizmo.fire("pageChanged")},e.prototype.handleResize=function(e){this.currentSize!==e.currentSize&&(this.currentSize=e.currentSize,(!this.isCollapsed()&&("small"===e.currentSize&&this.settings.isCollapsed.small||"medium"===e.currentSize&&this.settings.isCollapsed.medium)||("large"===e.currentSize||"jumbo"===e.currentSize)&&this.isCollapsed())&&this.toggle())},e.prototype.handleCollapse=function(e,i){var t=i.detail.gizmo.viewModel.isCollapsed;i.detail.gizmo.guid===this.gizmo.guid||t||this.gizmo.viewModel.toggle(!1)},e.prototype.addButton=function(){t.ViewModel.Expandable.BaseButton.prototype.addButton.call(this),this.$button.addClass("gizmo-expandable-button-facetlist"),this.$subButtonWrapper=t.$('<div class="gizmo-expandable-subbutton-wrapper">').appendTo(this.$button),this.$subButton=t.$('<div class="gizmo-expandable-subbutton">').appendTo(this.$subButtonWrapper),void 0!==this.$header&&this.$header.append(this.$button)},t.ViewModel.Expandable.ScrollingListButton=e}(Kobo);
"use strict";Kobo.ViewModel.FitListToContainer=function(i,e,t){var s=this;Kobo.ViewModel.Base.apply(s,[i,e]),this.options=e,this.$gizmo=t.$el,this.$nav=s.$gizmo.find(".nav"),this.items=s.$gizmo.find("li"),this.listEl=s.$gizmo.find(".list:first"),this.getMaxDesiredHeight=function(){var t,i,e=s.$gizmo.outerHeight(),o=s.$gizmo.parent().outerHeight();return s.options.heightCue&&(i=Kobo.$body.find(s.options.heightCue)).length&&0<i.height()&&((i=i.height())<s.listItemHeightWithPadding()||i<=o?Kobo.log("[FitListtoContainer] warning! heightCue container is too small to show any items"):t=i),(t=o===e?s.options.defaultHeight:t)?(s.$gizmo.height(t),parseInt(t)):e},this.getHeightOfNav=this.getListOffset=function(){return s.listEl.offset().top-s.$gizmo.offset().top},this.listItemHeightWithPadding=function(){return s.items.first().outerHeight(!0)},this.getListContainerHeight=this.setListViewPortHeight=function(){var t=s.listItemHeightWithPadding()*s.numberOfItemsToDisplayPerPage();s.listEl.parent().height(t)},this.isActivated=ko.observable(!0),this.scrollPositionIndex=ko.observable(0),this.totalNumberOfItems=ko.observable(),this.totalPages=ko.observable(0),this.numberOfItemsToDisplayPerPage=ko.computed(function(){var t=s.getMaxDesiredHeight(),i=s.getHeightOfNav(),e=s.getListOffset(),o=s.listItemHeightWithPadding(),n=s.getListContainerHeight();return Math.floor((t-i-e-n)/o)}),this.getOffsetOfAListItem=function(t){return-s.items.eq(t).position().top},this.animate=function(){if(e&&e.animationMixin){var t=Kobo.Mixin[e.animationMixin];return t?(s.animationMixin="function"==typeof t?new Kobo.Mixin[s.options.animationMixin](i,s.settings.animationMixinOptions):t,function(t){t.newTop=s.getOffsetOfAListItem(t.scrollPositionIndex),s.animationMixin.animate(t)}):void s.gizmo.error("MixinWrongClassName","Kobo.ViewModel.FitListToContainer",s,"Cannot find mixin "+s.options.animationMixin)}return function(){Kobo.log("[Kobo.ViewModel.List]: NO ANIMATION DEFINED")}}(),this.showNewPage=function(){s.animate({scrollPositionIndex:s.scrollPositionIndex(),itemFullHeight:s.listItemHeightWithPadding(),totalNumberOfItems:this.totalNumberOfItems})},this.scrollPositionIndex.subscribe(function(t){s.showNewPage()}),this.addNewItems=function(t){for(var i=0;i<t.length;i++)s.items.push(new s.ItemViewModelClass(t[i]))},this.onhover=function(t){},this.onclick=function(t){},function(){var t;s.setListViewPortHeight(),0<(t=s.numberOfItemsToDisplayPerPage())&&(s.totalNumberOfItems(s.items.length),s.totalPages(Math.ceil(s.totalNumberOfItems()/t)),s.applyBindings())}()},Kobo.ViewModel.FitListToContainer.prototype=Kobo.chainPrototype(Kobo.ViewModel.Base.prototype),Kobo.ViewModel.Dummy=
"use strict";Kobo.ViewModel.Expandable.HeaderAccountButton=function(o,e){var t=this;t.$header=o.$innerContent.find("> .facet-list-header"),o.$gizmo.prepend(t.$header),Kobo.ViewModel.Expandable.BaseButton.apply(t,arguments)},Kobo.ViewModel.Expandable.HeaderAccountButton.prototype=Kobo.chainPrototype(Kobo.ViewModel.Expandable.BaseButton.prototype),Kobo.ViewModel.Expandable.HeaderAccountButton.prototype.addButton=function(){Kobo.ViewModel.Expandable.BaseButton.prototype.addButton.call(this),this.$button.addClass("gizmo-expandable-button-chevron")};
"use strict";!function(n){function i(i){var t=this;n.ViewModel.Expandable.apply(this,arguments),this.marginTop="-"+i.$innerContent.css("height"),this.gizmo=i,this.isCollapsed()?(i.$innerMasker.css({height:0}),i.$innerContent.css({"margin-top":this.marginTop})):(i.$innerMasker.css({height:i.$innerContent.outerHeight()+"px"}),i.$innerContent.css({"margin-top":0})),this.toggle=this.toggle.bind(this),setTimeout(600)}(i.prototype=n.chainPrototype(n.ViewModel.Expandable.prototype))._superToggle=i.prototype.toggle,i.prototype.toggle=function(i,t){this.marginTop="-"+this.gizmo.$innerContent.css("height"),"boolean"===n.Object.typeOf(i)?this._superToggle(i,t):this._superToggle(this.isCollapsed()?this.gizmo.$innerContent.outerHeight()+"px":0,t),this.isCollapsed()?(Modernizr.csstransitions?this.gizmo.$innerMasker.css({height:0}):this.gizmo.$innerMasker.animate({height:0}),Modernizr.csstransitions?this.gizmo.$innerContent.css({"margin-top":this.marginTop}):this.gizmo.$innerContent.animate({marginTop:this.marginTop})):Modernizr.csstransitions?this.gizmo.$innerContent.css({"margin-top":0}):this.gizmo.$innerContent.animate({marginTop:0})},i.prototype.applyTransitions=function(){Modernizr.csstransitions&&this.gizmo.$innerContent.css(Modernizr.prefixed("transition",this.gizmo.$innerContent.prop("style"),!1),"margin-top "+this.settings.duration)},n.ViewModel.Expandable.Drawer=i}(Kobo);
"use strict";!function(i){function e(e,t){var s,o=this;i.ViewModel.Base.apply(this,[e,t]),this.setType("Search.AutoComplete"),this.autocompleteCategories=["author","book","series"],this.autocompleteURL=t.autoCompleteUrl,this.searchURL=t.itemResultSearchUrl,this.query=ko.observable(),this.items=ko.observableArray(),this.active=ko.observable(!1),this.hover=ko.observable(!1),this.currentSelected=null,this.isActive=ko.computed(function(){return(o.active()||o.hover())&&0<o.items().length}),this.getResults=ko.computed(function(){var r=o;r.options.query=r.query(),window.clearTimeout(s),s=window.setTimeout(function(){var t;i.Object.isNullOrEmpty(r.options.query)?(r.items.removeAll(),r.currentSelected=null):(t=r.query(),i.Ajax({url:r.autocompleteURL+"?query="+encodeURIComponent(t),success:function(e){t===r.query()?r.newResults(e):(i.log("There was a discrepancy: "+t+" !== "+r.query()),o.getResults())}}))},250)}),this.applyBindings()}function t(e,s){var o=this;this.result=ko.observable(e),this.isSelected=ko.observable(!1),this.url=ko.computed(function(){if(o.endsWith(o.result().Type,"Header"))return null;if(o.endsWith(o.result().Type,"Bar")){var e=o.result().Type.replace("Bar",""),t=encodeURIComponent(s.query),r=s.itemResultSearchUrl+"?query="+t+"&ac=1&ac.morein=true";return null!==o.result().Provider&&void 0!==o.result().Provider&&(r=r+"&ac.provider="+encodeURIComponent(o.result().Provider)),r+="book"===e?"&ac.title="+t:"author"===e?"&fcsearchfield="+e+"&ac."+e+"="+t+(s.authorRelevancyTestEnabled?"":"&sort=PublicationDateDesc"):"&fcsearchfield="+e+"&ac."+e+"="+t}r=s.itemResultSearchUrl+"?query="+encodeURIComponent(o.result().Query)+"&ac=1&acp="+encodeURIComponent(s.query);return null!==o.result().Provider&&void 0!==o.result().Provider&&(r=r+"&ac.provider="+encodeURIComponent(o.result().Provider)),null!==o.result().Title&&void 0!==o.result().Title&&""!==o.result().Title&&(r=r+"&ac.title="+encodeURIComponent(o.result().Title)),null!==o.result().Series&&void 0!==o.result().Series&&""!==o.result().Series&&(r=r+"&ac.series="+encodeURIComponent(o.result().Series)),null!==o.result().Authors&&void 0!==o.result().Authors&&0<o.result().Authors.length&&o.result().Authors.forEach(function(e){null!==e&&""!==e&&(r=r+"&ac.author="+encodeURIComponent(e)+(s.authorRelevancyTestEnabled?"":"&sort=PublicationDateDesc"))}),r}),this.attrs=ko.computed(function(){return null===o.result()||0===o.result().length?"":o.endsWith(o.result().Type,"Header")?{class:"header"}:o.endsWith(o.result().Type,"Bar")?{class:"more-in"}:{"data-track-info":'{"description": "'+o.result().Description+'"}',class:"result"}}),this.itemHtml=ko.computed(function(){var e=24<s.query.length?s.query.substr(0,24)+"...":s.query,t=o.result().Type.replace("Header","").replace("Bar",""),r="s"===t[t.length-1]?t:t+"s",t=new RegExp("(?!<[^<>]*)("+s.query.replace(/[\^\$\(\)\[\]\{\}\*\.\+\?\;\|\\]/gi,"\\$1")+")(?![^<>]*>)","gi");return null===o.result()||0===o.result().length?o.result():o.endsWith(o.result().Type,"Header")?"<text>"+r.toUpperCase()+"</text>":o.endsWith(o.result().Type,"Bar")?'<a href="'+o.url()+'"><p class="'+o.result().Type+'">'+i.Utilities.stringFormat(DynamicConfiguration.resourceStrings.autoCompleteSearchIn,e,r.toLowerCase())+'</p><svg class="moreInIcon" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><defs><style>.cls-1{fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:3px;}</style></defs><title>advanced_search_asset_exploration</title><rect class="cls-1" x="-38.25" y="-309.83" width="4221.08" height="1931.21"/><path class="cls-2" d="M13,13.68A6.67,6.67,0,1,1,13.68,13L18,17.37,17.37,18ZM8.67,2.9a5.77,5.77,0,1,0,4.08,1.69A5.73,5.73,0,0,0,8.67,2.9Z"/></svg></a>':'<a href="'+o.url()+'"><div class="ellipsis-100 '+o.result().Type+'"><text>'+o.result().Display.replace(t,'</text><text class="autocomplete-result-matched">$1</text><text>')+"</text></div></a>"})}(e.prototype=i.chainPrototype(i.ViewModel.Base.prototype)).unSelectAll=function(e){e&&(this.currentSelected=null),this.items().forEach(function(e){e.unfocus()})},e.prototype.goToCurrentActive=function(){i.$(document).attr("location").href=this.items()[this.currentSelected].url()},e.prototype.moveUp=function(){var e;0<this.items().length&&(this.unSelectAll(),this.currentSelected&&0!==this.currentSelected?this.currentSelected&&0<this.currentSelected&&--this.currentSelected:this.currentSelected=this.items().length-1,(e=this.items()[this.currentSelected]).focus(),e.endsWith(e.result().Type,"Header")&&this.moveUp())},e.prototype.moveDown=function(){var e;0<this.items().length&&(this.unSelectAll(),null===this.currentSelected||this.currentSelected===this.items().length-1?this.currentSelected=0:this.currentSelected+=1,(e=this.items()[this.currentSelected]).focus(),e.endsWith(e.result().Type,"Header")&&this.moveDown())},e.prototype.newResults=function(r){var s,o,i,t=this;this.currentSelected=null,this.items.removeAll(),0<r.length&&(s=r.some(,o=[],i=[],this.autocompleteCategories.forEach(function(t){var e=r.filter(;e.forEach(,0<e.length&&o.push({Type:t+"Header"}),o=o.concat(e),(0<e.length?o:i).push({Type:t+"Bar",Provider:s?"gsp":null})}),o.forEach(function(e){t.items.push(new t.settings.ItemViewModelClass(e,t.options))}),i.forEach()},e.prototype.clearResults=(t.prototype={}).focus=function(){this.isSelected(!0)},t.prototype.unfocus=t.prototype.endsWith=function(e,t,r){return void 0!==e&&((void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t)},i.ViewModel.Search={},i.ViewModel.Search.AutoComplete=e,i.ViewModel.Search.AutoComplete.Item=t}(Kobo);
"use strict";Kobo.ViewModel.UserRewardSelector=function(o,c){var s=this;Kobo.ViewModel.Base.apply(s,[o,c]),s.setType("UserRewardSelector"),s.selectedRewardIDs=[],s.MAX_SELECTIONS_ALLOWED=1,s.updateCtaState=function(e){var t=Kobo.$(e),r=t.find("."+c.btnSelector),o=DynamicConfiguration.resourceStrings[c.selectedCtaResourceString],e=DynamicConfiguration.resourceStrings[c.unselectedCtaResourceString];r.text()===e?r.text(o):r.text(e),t.toggleClass(c.selectedSelector)},s.updateSelectedRewardIDs=function(){var e,t=o.find("."+c.selectedSelector),r=t?t.length:0;if(s.selectedRewardIDs=[],t&&0<r)for(e=0;e<r;e++)s.selectedRewardIDs.push(parseInt(Kobo.$(t[e]).find("."+c.btnSelector).attr("id"),10))},s.countSelectedItems=function(){return o.find("."+c.selectedSelector).length},s.selectReward=function(e,t){var r=Kobo.$(this).closest("."+c.rewardItemSelector);(r=t&&t.detail&&t.detail.selectItem?t.detail.selectItem.closest("."+c.rewardItemSelector):r)&&(((t=s.countSelectedItems())<s.MAX_SELECTIONS_ALLOWED||r.hasClass(c.selectedSelector))&&(s.updateCtaState(r),s.updateSelectedRewardIDs()),t=s.countSelectedItems(),s.fire("UserRewardSelector::updateClaimBox",{canInputVoucherCode:0<t,claimRewardSet:s.selectedRewardIDs}))},s.destroy=s.setupHandlers=function(){s.register("UserRewardSelector::toggleSelect"),s.subscribe("UserRewardSelector::toggleSelect",s.selectReward),o.find("."+c.btnSelector).on("click",s.selectReward),o.find("."+c.rewardItemDetailsSelector).on("click",function(e){var t=s.countSelectedItems(),r=Kobo.$(this).closest("."+c.rewardItemSelector),r=!(t===s.MAX_SELECTIONS_ALLOWED&&!r.hasClass(c.selectedSelector));Kobo._mediator.fire("userRewardSelectorPopup::loadSynopsis",{target:e.target,canSelectItem:r})})},function(){s.MAX_SELECTIONS_ALLOWED=parseInt(c.userSelectionLimit,10),s.setupHandlers()}()},Kobo.ViewModel.UserRewardSelector.prototype=Kobo.chainPrototype(Kobo.ViewModel.Base.prototype);
"use strict";Kobo.ViewModel.UserRewardSelectorClaim=function(e,l){var t=this;Kobo.ViewModel.Base.apply(t,[e,l]),t.setType("UserRewardSelectorClaim"),t.toggleClaimBox=function(e){t.$targetInputSelector.prop("disabled",!e),t.$claimRewardCtaSelector.prop("disabled",!e)},t.updateState=function(e,r){var o=!0;r&&r.detail&&"undefined"!==r.detail.canInputVoucherCode&&r.detail.claimRewardSet&&(o=r.detail.canInputVoucherCode,t.selectedRewardIds=r.detail.claimRewardSet),t.toggleClaimBox(o)},t.showSpinner=function(){Kobo._modal.open('<div class="ajax-spinner"></div>',{theme:Kobo._modal.themes.LIGHT})},t.hideSpinner=function(){Kobo._modal.close()},t.showError=t.claimReward=function(){t.showSpinner();var e=t.$targetInputSelector;"undefined"!==e&&""!==(e=e.val().trim())?(t.claimAll&&(t.selectedRewardIds=[]),Kobo.Ajax({url:l.claimRewardUrl,method:"POST",traditional:!0,dataType:"json",data:{voucherCode:e,claimingRewardIds:t.selectedRewardIds},success:function(e){"undefined"===e||e.isInvalidCode&&""===e.redirectTo?t.showError():""!==e.redirectTo&&(window.location.href=e.redirectTo)},error:function(){t.showError()}})):t.showError()},t.iePlaceholder=function(){if(!Modernizr.input.placeholder)for(var e=Kobo.$.find("#"+l.targetInputSelector+"[placeholder]"),r=0,o=function(){var e=this;e.value===e.getAttribute("placeholder")&&(e.value="")},t=function(){var e=this;""!==e.value&&e.value!==e.getAttribute("placeholder")||(e.value=e.getAttribute("placeholder"))},a=null;r<e.length;r++)a=e[r],Kobo.$(a).focus(o),Kobo.$(a).blur(t),a.value=a.getAttribute("placeholder")},t.destroy=t.setupHandlers=function(){t.register("UserRewardSelector::error"),t.register("UserRewardSelector::claimReward"),t.register("UserRewardSelector::updateClaimBox"),t.subscribe("UserRewardSelector::error",t.showError),t.subscribe("UserRewardSelector::claimReward",t.claimReward),t.subscribe("UserRewardSelector::updateClaimBox",t.updateState),t.$targetInputSelector.keypress(,t.$claimRewardCtaSelector.on("click",t.claimReward)},function(){t.claimAll=l.claimAll,t.$errorBoxElement=e.find("."+l.errorSelector),t.$targetInputSelector=e.find("#"+l.targetInputSelector),t.$claimRewardCtaSelector=e.find("#"+l.eventTriggerId),t.iePlaceholder(),t.setupHandlers(),t.claimAll?t.toggleClaimBox(!0):t.toggleClaimBox(!1)}()},Kobo.ViewModel.UserRewardSelectorClaim.prototype=Kobo.chainPrototype(Kobo.ViewModel.Base.prototype);
"use strict";Kobo.ViewModel.UserRewardProductInfo=function(){var s=this;s.title=ko.observable(""),s.subtitle=ko.observable(""),s.imageurl=ko.observable(""),s.synopsis=ko.observable(""),s.update=function(e){e&&(s.title(e.title),s.subtitle(e.subtitle),s.imageurl(e.imageurl),e=Kobo.$.parseHTML(e.synopsis),s.synopsis(e&&0<e.length?e[0].data:""))}};
window.Kobo=window.Kobo||{},window.Kobo.PerformanceMonitor=window.Kobo.PerformanceMonitor||function(e,t,r){function o(){if(null==window.performance)return null;var n=($("body").data("track-info")||{}).pageName||null,e=document.getElementsByTagName("*").length,o=performance.getEntriesByType("resource").length;return{viewName:n,timestamp:new Date(performance.timing.navigationStart).toISOString(),timing:performance.timing,user:{status:r},navigation:{redirectCount:performance.navigation.redirectCount,type:performance.navigation.type},page:{domElementCount:e,resourceCount:o},machineName:t}}this.submit=function(){if(e){var n=o();return null==n?$.Deferred.reject(null,"Error","Cannot collect performance stats because the navigation timing api is not supported on this browser").promise():$.ajax({url:e,data:JSON.stringify(n),type:"POST",contentType:"application/json"})}}},Kobo.$(function(){setTimeout(function(){var n,e,o;DynamicConfiguration&&DynamicConfiguration.features&&DynamicConfiguration.features.performance&&(n=DynamicConfiguration.features.performance.statsServerUrl,e=DynamicConfiguration.features.performance.serverId,o=null,DynamicConfiguration.user&&(o=DynamicConfiguration.user.isLoggedIn?"Authenticated":DynamicConfiguration.user.hasPreviouslyAuthenticated?"KnownUser":null),new Kobo.PerformanceMonitor(n,e,o).submit())},0)});
"use strict";!function(){var e;document.body.classList.contains("Store-HomePage")&&-1<document.cookie.indexOf("platformid=00000000-0000-0000-0000-ffffffff0000")&&(e=new CustomEvent("kwp_skinny_after_state_loaded",{detail:{},bubbles:!0,cancelable:!0}),window.dispatchEvent(e))}();
"use strict";!function(){if(document.body.classList.contains("Store-Browse-Recommendations")&&-1<document.cookie.indexOf("platformid=00000000-0000-0000-0000-ffffffff0000")){document.getElementsByTagName("body")[0].classList.add("sp_optly_recommendations");var o="Get Better Recommendations.",a="You can now click the",n="to remove books you’ve already read, or aren’t interested in.",s="Okay, got it.",t="Already Read",i="Not Interested",r="Thanks!",c="We'll update your recommendations.",l="We'll update this page with new recommendations for you soon.",d=" For now, try the next page.",p=" Go to next page > ",e=document.cookie;if(null===e.match(/language_locale=[e][n]-[a-zA-Z]{2}/g)){var u="en";switch(-1<e.toLowerCase().indexOf("language_locale=")&&(u=e.split("language_locale=")[1].split("&")[0].toLowerCase()),document.getElementsByTagName("body")[0].classList.add(u),u){case"de-de":o="Erhalten Sie bessere Empfehlungen.",a="Sie können nun auf das",n=" klicken, um Bücher zu entfernen, die Sie bereits gelesen haben oder die Sie nicht interessieren. ",s="Okay, alles klar.",t="Bereits gelesen",i="Kein Interesse",r="Vielen Dank!",c="Wir werden Ihre Empfehlungen aktualisieren.",l="Wir werden diese Seite bald mit neuen Empfehlungen für Sie aktualisieren.",d=" Probieren Sie erst einmal die nächste Seite.",p=" Zur nächten Seite > ";break;case"fr-fr":o="Obtenez des recommandations plus pertinentes.",a="Vous pouvez désormais cliquer sur",n=" pour supprimer les livres que vous avez déjà lus ou qui ne vous intéressent pas.",s="Ok, j'ai compris.",t="Déjà lu",i="Pas intéressé(e)",r="Merci!",c="Nous mettrons à jour vos recommandations.",l="Cette page sera bientôt mise à jour avec de nouvelles recommandations pour vous.",d=" Pour le moment, rendez-vous sur la page suivante.",p="Allez vers la page suivante > ";break;case"fr-ca":o="Obtenez des recommandations plus pertinentes.",a="Vous pouvez désormais cliquer sur",n=" pour supprimer les livres que vous avez déjà lus ou qui ne vous intéressent pas.",s="Ok, j'ai compris.",t="Déjà lu",i="Pas intéressé(e)",r="Merci!",c="Nous mettrons à jour vos recommandations.",l="Cette page sera bientôt mise à jour avec de nouvelles recommandations pour vous.",d=" Pour le moment, rendez-vous sur la page suivante.",p="Allez vers la page suivante. > ";break;case"it-it":o="Non perdere i suggerimenti migliori.",a="Puoi cliccare sulla ",n="per rimuovere i libri già letti o quelli che non ti interessano.",s="OK, ricevuto.",t="Già letto",i="Non mi interessa",r="Grazie!",c="Aggiorneremo i suggerimenti.",l="Tra poco aggiorneremo questa pagina con nuovi suggerimenti per te.",d=" Per il momento, passa alla pagina successiva.",p=" Vai alla pagina successiva > ";break;case"nl-nl":o="Krijg betere aanbevelingen.",a="Je kunt nu op de ",n="klikken om boeken te verwijderen die je al hebt gelezen of waar je niet in bent geïnteresseerd.",s="Oké, ik snap het.",t="Al gelezen",i="Geen interesse",r="Hartelijk dank!",c="We zullen je aanbevelingen bijwerken.",l="We zullen deze pagina binnenkort bijwerken met nieuwe aanbevelingen.",d=" Voor nu kun je de volgende pagina bekijken.",p=" Ga naar de volgende pagina > ";break;case"es-es":o="Obtén mejores recomendaciones.",a="Ahora puedes hacer clic en la ",n=" para eliminar libros que ya has leído, o que no te interesan.",s="Vale, entendido.",t="Ya lo he leído",i="No me interesa",r="¡Gracias!",c="Actualizaremos tus recomendaciones.",l="Pronto actualizaremos esta página con nuevas recomendaciones para ti.",d=" Por ahora, prueba la siguiente página.",p=" Ir a la siguiente página > ";break;case"es-mx":o="Obtén mejores recomendaciones.",a="Ahora puedes hacer clic en la ",n=" para borrar libros que ya has leído o que no te interesan.",s="Bien, lo tengo.",t="Leído",i="No me interesa",r="¡Gracias!",c="Actualizaremos tus recomendaciones.",l="Pronto actualizaremos esta página con nuevas recomendaciones para ti.",d=" Por ahora, prueba la siguiente página.",p=" Ir a la siguiente página > ";break;case"pt-pt":o="Obter melhores recomendações.",a="Pode agora clicar no ",n="para remover livros que já leu ou pelos quais não tem interesse.",s="OK, percebido.",t="Já lido",i="Não estou interessado",r="Obrigado!",c="Vamos atualizar as suas recomendações.",l="Em breve, atualizaremos esta página com novas recomendações para si.",d=" Por agora, tente a página seguinte.",p=" Vá para a página seguinte > ";break;case"pt-br":o="Receba recomendações melhores.",a="Agora, você pode clicar no ",n="para remover livros que já leu ou nos quais não está interessado. ",s="Ok, entendi.",t="Já li",i="Não estou interessado",r="Obrigado!",c="Atualizaremos suas recomendações.",l="Em breve, atualizaremos esta página com novas recomendações para você.",d=" Por enquanto, experimente a próxima página.",p=" Vá para a próxima página > ";break;case"tr-tr":o="Daha İyi Tavsiyeler Alın.",a="Zaten okumuş olduğunuz kitapları veya ilgilenmediklerinizi kaldırmak için ",n="düğmesine tıklayabilirsiniz.",s="Tamam, anladım.",t="Okunanlar",i="İlgilenmiyorum",r="Teşekkürler!",c="Tavsiyelerinizi güncelleyeceğiz.",l="Bu sayfayı yakında sizin için yeni tavsiyelerle güncelleyeceğiz.",d=" Şimdilik, sonraki sayfayı deneyin.",p=" Sonraki sayfaya gidin > ";break;case"jp-jp":o="おすすめ商品の精度を上げる",a="すでに読んだ本や興味のない本は、",n="をクリックして削除できます。",s="OK",t="読書済み",i="興味なし",r="ありがとうございます！",c="おすすめを更新します。",l="まもなく新しいおすすめを表示します。",d=" 更新されるまで、次ページをご覧ください。",p=" 次ページへ > "}}else document.getElementsByTagName("body")[0].classList.add("en"),o="Get Better Recommendations.",a="We'll update this page with new recommendations for you soon.",d="For now, try the next page.",p=" Go to next page > ";var m={loadScripts:function(){var e=document.createElement("script");e.setAttribute("src","https://cdn.kobo.com/merch-assets/magento/store_performance/user_recommendations/velocity.min.js"),document.head.appendChild(e)},bakeItemCookie:function(e,o,a,n){var s=new Date;s.setTime(s.getTime()+60*n*60*1e3);s="expires="+s.toUTCString();document.cookie=e+o+a+"; "+s+"; path=/"},modifyPageHTML:function(){var e;Kobo.$(".page-link.active.final").length||0==Kobo.$(".pagination").length?Kobo.$(".result-items").addClass("sp_final_page"):e=Kobo.$(".pagination .next").attr("href"),Kobo.$(".result-items").prepend('<div class="sp_no_items_banner" style="display: none;">'+l+"<span> "+d+'</span> <a href="'+e+'">'+p+"</a></div>"),Kobo.$(".item-wrapper").append('<div class="item-overlay" style="display: none;"></div>'),Kobo.$("<div class='sp_recos_feedback-close'><button class='sp_recos_feedback-close-button' aria-label='"+window.DynamicConfiguration.resourceStrings.close+"' aria-expanded='false'></button><div class='sp_recos_feedback_options_container'><div class='sp_recos_arrow'></div><ul data-force-track='' data-track-info='{&quot;section&quot;:&quot;recommendationsFeedback&quot;}'><li data-force-track='' data-track-info='{&quot;description&quot;:&quot;RecommendationsFeedbackAlreadyRead&quot;}'><button>"+t+"</button></li><li class='sp_recos_not_interested_feedback' data-force-track='' data-track-info='{&quot;description&quot;:&quot;RecommendationsFeedbackNotInterested&quot;}'><button>"+i+"</button></li></ul> </div></div>").prependTo(".item-info"),-1<document.cookie.toLowerCase().indexOf("_sp-recos-banner-close")&&document.getElementsByTagName("body")[0].classList.add("sp_hide_recos_banner"),Kobo.$(".kwp-notable-recos.kwp-bg-green.kwp-recos-stars").after("<div data-step='1' data-intro='This is a tooltip!' class='sp_recos_banner inner-wrap'><div class='sp_recos_banner_inner'><h1>"+o+"</h1><p>"+a+" <span></span> "+n+"</p><a class='sp_recos_banner_close'> "+s+" </a></div></div>"),Kobo.$(".kwp-notable-recos.kwp-bg-green.kwp-recos-stars").remove()},storeItem:function(e){var o="";-1<document.cookie.toLowerCase().indexOf("sprecos_removal")&&(o=document.cookie.toLowerCase().split("_sprecos_removal=")[1].split(";")[0]+"&"),m.bakeItemCookie("_spRecos_Removal=",o,e,8)},notInterestedFeedBackMessage:function(e){Kobo.$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"/TrackRecommendationNotInterestedFeedback",data:JSON.stringify({productId:e}),headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()}})},noBooksCheck:function(){0===Kobo.$(".item-wrapper:visible:not(.item-wrapper.sp_recos_removed)").length&&Kobo.$(".sp_no_items_banner").show()},removeItems:function(){var e;(e=-1<document.cookie.toLowerCase().indexOf("sprecos_removal")?document.cookie.toLowerCase().split("_sprecos_removal=")[1].split(";")[0].split("&"):e)&&Kobo.$.each(e,function(e,o){Kobo.$("[data-track-info*="+o+"] .item-overlay").show(),Kobo.$("[data-track-info*="+o+"]").addClass("sp_recos_removed").hide()}),Kobo.$(".sp_recos_removed").detach().appendTo(".result-items"),this.noBooksCheck()},setEvents:function(){Kobo.$(".sp_recos_feedback-close-button").on("click",function(){Kobo.$(".sp_recos_feedback_options_container").not($(this).siblings(".sp_recos_feedback_options_container")).hide(),Kobo.$(this).siblings(".sp_recos_feedback_options_container").toggle(),Kobo.$(this).toggleClass("selected"),Kobo.$(this).attr("aria-expanded",Kobo.$(this).hasClass("selected"))});for(var e=Kobo.$(".sp_recos_feedback-close"),o=0;o<e.length;o++){var a="reco-action-list-"+jQuery.parseJSON(jQuery(e[o]).closest(".item-wrapper").attr("data-track-info")).productId;Ka),Kobo.$(e[o]).find(".sp_recos_feedback-close-button").attr("aria-control",a)}Kobo.$("body").on("click",function(){Kobo.$(".sp_recos_feedback_options_container").hide(),Kobo.$(".sp_recos_feedback-close-button").removeClass("selected").attr("aria-expanded",!1)}).on("click",".sp_recos_feedback-close-button",function(e){e.stopPropagation()});var n=this.bakeItemCookie;Kobo.$(".sp_recos_banner_close").on("click",function(){Kobo.$(".sp_recos_banner.inner-wrap").addClass("collapse_recos_banner"),n("_sp-recos-banner-close=","true","",720),document.getElementsByTagName("body")[0].classList.add("sp_hide_recos_banner"),Kobo.$(".kobo-main .two-column-left-full-aside .inner-wrap .columns-wrapper").addClass("sp_margin_20_slide")});var s=this.storeItem,t=this.notry.parseJSON(jQuery(this).closest(".item-wrapper").attr("data-track-info")).productId,o=jQuery(this).parents(".detail-flipper").siblings(".item-image");s(e),Kobo.$(this).parents(".detail-flipper").fadeOut(400,function(){o.after('<h1 class="sp_recos_thank_you" style="padding-top: 60px;">'+r+'</h1> <p class="sp_recos_thank_you">'+c+"</p>")}),o.addClass("sp_scale_down"),window.setTimeout(function(e){Kobo.$(e).parents(".item-wrapper:eq(0)").fadeOut(500,function(){Kobo.$(e).closest(".item-wrapper").next(".item-wrapper").css("marginTop","179px"),Kobo.$(e).closest(".item-wrapper").next(".item-wrapper").velocity({marginTop:"0px"},{duration:200,easing:"easeOutSine"}),i(),0===Kobo.$(".item-wrapper:visible:not(.item-wrapper.sp_recos_removed)").length&&dataLayer.push({ecommerce:void 0,event:"kobo.gaEvent",eventCategory:"A/B Testing",eventAction:"Feedback Recommendation",eventLabel:"Removed All Item),Kobo.$("body").on("click",".sp_recos_not_interested_feedback",function(){var e=jQuery.parseJSON(jQuery(this).closest(".item-wrapper").attr("data-track-info")).productId;-1<document.cookie.toLowerCase().indexOf("feature.recommendation")&&t(e)})},init:function(){this.loadScripts(),this.modifyPageHTML(),this.removeItems(),this.setEvents()}};m.init()}}();
"use strict";!function(){function e(){this.arr_primary=["AU","CA","GB","IE","IT","NZ","US"],this.arr_row=["AD","AE","AF","AG","AI","AL","AM","AN","AO","AQ","AR","AS","AW","AX","AZ","BA","BB","BD","BF","BG","BH","BI","BJ","BL","BM","BN","BO","BS","BT","BV","BW","BY","BZ","CC","CD","CF","CG","CI","CK","CL","CM","CN","CO","CR","CS","CU","CV","CX","CZ","DJ","DM","DO","DZ","EC","EG","EH","ER","ET","FJ","FK","FM","FO","GA","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GS","GT","GU","GW","GY","HM","HN","HR","HT","HU","ID","IL","IM","IO","IQ","IR","IS","JE","JM","JO","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LY","MA","MC","MD","ME","MF","MG","MH","MK","ML","MM","MN","MO","MP","MQ","MR","MS","MU","MV","MW","MY","MZ","NA","NC","NE","NF","NG","NI","NP","NR","NU","OM","PA","PE","PF","PG","PK","PL","PM","PN","PR","PS","PW","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SG","SH","SJ","SL","SM","SN","SO","SR","ST","SV","SY","SZ","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TT","TV","TZ","UA","UG","UM","UY","UZ","VA","VC","VE","VG","VI","VN","VU","WF","WS","YE","YT","ZM","ZW"]}e.prototype.getUserMerchCountry=function(){var e,o="";return(o=document.cookie&&-1<document.cookie.indexOf("session=")&&-1<(e=document.cookie.split("session=")[1].split("; ")[0]).toLowerCase().indexOf("merchcountry=")?e.toLowerCase().split("merchcountry=")[1].split("&")[0]:o).trim()},e.prototype.isWalmartAffiliate=function(){var e=!1;return e=-1<document.cookie.indexOf("partnerid=00000000-0000-0000-0000-000000000020")&&-1<document.cookie.indexOf("affiliateid=4aab9ec4-1c76-44a4-8eec-26f94869acbd")?!0:e},e.prototype.isPlatformDesktopApp=function(){var e,o=!1;return-1<document.cookie.indexOf("platformid")&&(e=document.cookie.split("platformid=")[1].split("&")[0],o=["00000000-0000-0000-0000-000000000001","00000000-0000-0000-0000-000000000002","00000000-0000-0000-0000-000000000003","00000000-0000-0000-0000-000000000004","00000000-0000-0000-0000-000000000005","00000000-0000-0000-0000-000000000010","00000000-0000-0000-0000-000000000011","00000000-0000-0000-0000-000000000012"].includes(e)),o},e.prototype.getTalkableCampaignCountryID=function(){var e="",o=this.getUserMerchCountry().toUpperCase(),r=Cookies.get("persistent");return-1<this.arr_primary.indexOf(o)?"CA"===(e=o)&&r&&-1<r.toLowerCase().indexOf("language_locale=fr-ca")&&(e="QC"):-1<this.arr_row.indexOf(o)&&(e="ROW"),e},e.prototype.build=function(e){var o=$(".user-name span").text().trim();!o&&$("#userNameId")[0]&&(o=$("#userNameId")[0].value);var r="",t="";"QC"===e?(r="https://www.kobo.com/ca/fr/p/share",t="Soyez récompensé"):"IE"===e?(r="https://www.kobo.com/ie/en/p/share",t="Earn Rewards"):"IT"===e?(r="https://www.kobo.com/it/it/p/share",t="Guadagna Premi"):"GB"===e?(r="https://www.kobo.com/gb/en/p/share",t="Earn Rewards"):e.match(/^(AU|CA|NZ|US|ROW)$/)&&(r="https://www.kobo.com/p/share",t="Earn Rewards"),-1===document.cookie.indexOf("uid=cC00ppxFsPRpF7DxNSjqB6Tb5EQ")&&0<o.length&&o.length<=7&&(t+=", "+o+"!"),this.isPlatformDesktopApp()||$('<a aria-label="'+t+'" class="sp-referral rich-header-referral" alt="Referral" href="'+r+'"ferral referrallink" data-track-info="{"description":"Referral"}" href="'+r+'">'+t+"</a></li>";$(".rich-header-main-nav").append(t)},e.prototype.gaTracking=function(){$(".sp-referral").on("mousedown",function(){dataLayer.push({event:"kobo.gaEvent",eventCategory:"Acquisitions",eventAction:"Talkable",eventLabel:"Click Get Credit in Header"})})},window.Kobo_SP=window.Kobo_SP||{},window.Kobo_SP.Optimizely=window.Kobo_SP.Optimizely||{},window.Kobo_SP.Optimizely.Talkable=window.Kobo_SP.Optimizely.Talkable||e,$(document).ready(function(){var e,o;document.querySelector("body").classListckout")||""!==(o=(e=new window.Kobo_SP.Optimizely.Talkable).getTalkableCampaalmartAffiliate()&&(e.build(o),e.gaTracking())})}();
"use strict";Kobo.Utilities.assignToNamespace("Kobo.AgeVerification.ViewModels.AgeVerificationVM",function(){this.closeDialog=ko.observable(),this.confirmAgeVerification=ko.observable()});
"use strict";Kobo._AgeVerification=function(){var i=!1,e=Kobo._mediattail)},n=function(o){var i=new Kobo.AgeVerification.ViewModels.AgeVerificationVM,e=Kobo.$("#age-verification-template"),n=Kobo.$(e.html());function t(){Kobo._modal.close(),n.remove()}Kobo._modal.open(n,{theme:Kobo._modal.themes.PITCH_BLACK}),i.closeDialfu=!1,e.fire(o.caller,o)},a=function(){Kobo.$.ajax({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:"/AgeVerification/Confirm"}).done(function(){t()})},t=function(){document.body.classList.remove("hide-adult-content")},r=function(){e.subscribe("ageVerificationCheck",o),e.register("ageVerificationDialog::open",n)};return function(){r()}(),{isRequired:function(o){return!(void 0===o||"false"===o||!o)&&!i},completeConfirmation:c}}();
"use strict";Kobo.Gizmo.SavePaymentMethodCreditCard=function(e,a){var t,o,n,r,i,s,d,c,l,h,u,b,y,m,p,v,g=this,f={},M=window.DynamicConfiguration.resourceStrings.paymentInformation,w=e.querySelector("#error-message-box");Kobo.Gizmo.apply(this,arguments),this.setType("SavePaymentMethodCreditCard"),o=function(o){Kobo.Spinner.showSpinnerOverlay(Kobo.$("body")),Kobo.$.ajax({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:a.RemovePaymentMethodUrl,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:JSON.stringify({id:o}),success:function(e){"success"===e.result?(f.showMsgBox(!1),Kobo.Utilities.reload()):(f.isSaveSuccess(!1),f.showMsgBox(!0),f.paymentMethodMsg(a.RemovalError),Kobo.Spinner.hideSpinnerOverlay(Kobo.$("body")))},error:function(e){throw Kobo.Spinner.hideSpinnerOverlay(Kobo.$("body")),y(a.RemovalError),new Error("Error removing payment method: "+e+" with PaymentMethodId "+o)}})},m=function(e,o){e={paymentNonce:-1!==a.BraintreeClientToken.indexOf("sandbox_")?e.details.bin+"-"+e.details.lastFour+"-"+e.details.cardType+"-"+e.details.expirationMonth+"-"+e.details.expirationYear:e.paymentNonce,cardholderName:e.cardholderName,deviceData:v,source:a.Source,improperRecaptcha:a.ImproperRecaptcha,billingAddressRequired:a.BillingAddressRequired,paymentIssue_ChooseAnotherPaymentMethod:a.PaymentIssue_ChooseAnotherPaymentMethod,notAbleToAcceptAmexErrorMessage:a.NotAbleToAcceptAmexErrorMessage,savedSuccessfullyMsg:a.SavedSuccessfullyMsg};f.isNewUser()?y(a.BillingAddressRequired):(Kobo.Spinner.showSpinnerOverlay(Kobo.$("body")),Kobo.$.ajax({type:"POST",headers:{"g-recaptcha-response":o,__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},dataType:"json",contentType:"application/json; charset=utf-8",url:a.SavePaymentMethodUrl+a.AdditionalQueryParameter,data:JSON.stringify(e),success:function(e){e.Message&&f.paymentMethodMsg(e.Message),e.IsSuccess?(f.isSaveSuccess(!0),setTimeout(function(){null!=l&&0<l.length?Kobo.Utilities.navigateToue_ChooseAnotherPaymentMethod),f.showMsgBox(!0),Kobo.Spinner.hideSpinnerOverlay(Kobo.$("body"))},error:function(e){throw y(M.PaymentIssue_ChooseAnotherPaymentMethod),Kobo.Spinner.hideSpinnerOverlay(Kobo.$("body")),new Error("Error saving payment method: "+e)}})),window.grecaptcha.reset()},h=function(){return window.grecaptcha.getResponse()},n=function(){Kobo._mediator.fire("braintreeHostedFields::validate",{validatedCallback:function(){f.braintreeValidationVM().isPaymentValid()?(Kobo._mediator.fire("braintreeCard::validate"),f.isChangingPaymentInfo(!1)):(Kobo._mediator.fire("tionVM().creditCardInvalidMsg()))}})},u=function(){return 0<a.PaymentMethods.length},y=function(e){w.classList.remove("error-msg-disappear"),f.isSaveSuccess(!1),f.showMsgBox(!0),f.paymentMethodMsg(e),setTimeout(function(){w.classList.add("error-msg-disappear"),setTimeout(function(){f.showMsgBox(!1),w.classList.remove("error-msg-disappear")},1e3)},2e3)},b=function(e){var o=e.field,a=e.isValid,t=e.setErrorMessageForScreenReader;switch(o){case"number":f.braintreeValidationVM().isCreditCardValid(a),t(f.braintreeValidationVM().creditCardInvalidLengthMsg());break;case"cvv":f.braintreeValidationVM().isCVVValid(a),t(f.braintreeValidationVM().cvvInvalidMsg());break;case"expirationMonth":case"expirationYear":f.braintreeValidationVM().isExpirationDateValid(a),t(f.braintreeValidationVM().expiryDateInvalidMsg());break;default:throw new Error("Error field type: "+o)}},t=function(){f.savePaymentInfo=function(e,o){return o.preventDefaultlBtnHandler=function(e,o){o.preventDefault(),Kobo._mediator.fire("braintreeCard::refreshIframe"),f.isChangingPaymentInfo()&&(f.isChangingPaymentInfo(!1),f.showSavePayments(!1),f.showChangeButton(!0))},f.showMsgBox=ko.observable(!1),f.paymentMethodMsg=ko.observable(""),f.isSaveSuccess=ko.observable(!1),f.removePaymentMethod=function(e){o(e)},f.cardHolderName=ko.observable(""),f.creditCardType=ko.observable(""),f.showSavePayments=ko.observable(!u()),f.showChaInfo=ko.observable(!1),f.showChangePayment=function(){f.isChangingPaymentInfo(!0),f.showSavePayments(!0),f.showChangeButton(!1),f.cardHolderName(a.PaymentMethods[0].Name)},f.showActionContainer=ko.observable(!1),f.openActionMenu=function(){return f.showActionContainer(!0),!1},f.closeActionMenu=function(){return f.showActionContainer(!1),!1},f.isNewUser=ko.observable(a.IsNewUser),f.braintreeValidationVM=ko.observable(new Kobo.PurchasePath.ViewModels.BraintreeValidationVM)},r=function(){Kobo.$(e).find("#savePaymentMethodCreditCardSaveButton").on("click",function(e){e.preventDefault(),l=e.target.value,n()})},i=function(){window.innerWidth<=568.2?c.addClass("captchaWithMargin"):c.addClass("captchaNoMargin")},s=function(){d=$("#save-card-note"),c=$(".captcha-margin"),0==d.length&&c.length&&(i(),$(window).resize(function(){i()}))},function(){var e=g.el;t(),r()ymentMethods.length&&(o=["","visa","master-card","discover","american-express","jcb","diners"][a.PaymentMethods[lientToken,isOldPP:!1,createFields:!0,collectDeviceData:!0,triggerBraintreeLocalPayment:!1},(p=new Kobo.Purchasing.BraintreePayments(p)).collectDeviceDataEvent.subscribe(function(e){v=e}),p.saveRequestEvent.subscribe(function(e){try{var o=h();m(e,o)}catch(e){Kobo.log(e)}}),p.isValidEvent.subscribe(function(e){try{b(e)}catch(e){Kobo.log(e)}}),new Kobo.PurchasePath.Behaviors.Braintree.ValidateBraintreeFieldsBehavior(f.braintreeValidationVM()),g.viewModel=f,ko.applyBindinewPurchase=function(e,o){var r,s=this,t=e.querySelector("#reviewpurchase-complete-purchase"),a=0,i=e.querySelector("#error-message-box");Kobo.Gizmo.apply(this,arguments),this.setType("ReviewPurchase"),s.destroy=function(){s.unSubscribe("Revie)},s.setupHaniewPurchase::error"),s.register("ReviewPurchase::completePurchase"),s.subscribe("ReviewPurchase::error",s.showError),s.subscribe("ReviewcompletePurchase)},s.showSpinner=function(){Kobo._modal.open('<div class="ajax-spinner"></div>',{theme:Kobo._modal.themes.LIGHT})},s.hideSpinner=function(){Kobo._modal.close()},s.showError=function(e){i.innerHTML=e,s.hideSpinner(),r.addClass("reviewpurchase-error-box-display").hide().fadeIn("slow")},s.hideError=function(){r.fadeOut("fast")},s.completePurchase=function(){s.hideError(),s.showSpinner(),0!=o.paymentMethods.length?Kobo.Ajax({url:o.completePurchaseUrl,method:"POST",traditional:!0,dataType:"json",dunction(e){e?function r(){Kobo.Ajax({url:o.checkPurchaseStatusUrl,method:"POST",traditional:!0,dataType:"json",data:{},success:function(e){e?href=o.thankYouUrl,s.hideError()):e.status==o.failureStatus?s.showError(e.Message):setTimeout(function(){r()},1e3):s.showError(o.genericErrorMessage)},error:function(){s.showError(o.genericErrorMessage)}})}():s.showError(o.genericErrorMessage)},error:function(){s.showError(o.genericErrorMessage)}}):s.showError(o.noPaymentMethodErrorMessage,!0)},s.hasSavedPaymentMethods=function(){return 0<o.paymentMethods.length},function(){var e=s.el;r=$("#voucher-error-claim"),ko.applyBindings(s,e),s.setupHandlers(),t.addEventListener("click",s.completePurchase)}()},Kobo.Gizmo.ReviewPurchase.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Utilities.assignToNamespace("Kobo.EGiftingCustomization.EGiftingCustomizationVM",function(e){var a=this,i=window.DynamicConfiguration.resourceStrings.egiftingCustomization,t=e.rules;a.amount=ko.observable(e.amount||t.MinAmount).extend({required:{params:!0,message:i.amountRequired}}).extend({min:{params:t.MinAmount,message:Kobo.Utilities.stringFormat(i.amountMustBeGreaterThan,t.FormattedMinAmount)}}).extend({max:{params:t.MaxAmount,message:Kobo.Utilities.stringFormat(i.amountMustBeLessThan,t.FormattedMaxAmount)}}),a.amount.subscribe(function(){a.updateFormValidity()}),a.email=ko.observable(e.email).extend({required:{params:!0,message:i.emailRequired}}).extend({email:{params:!0,message:i.emailInvalid}}).extend({maxLength:{params:t.EmailMaxLength,message:Kobo.Utilities.stringFormat(i.emailExceedsMaxLength,t.EmailMaxLength)}}),a.email.subscribe(function(){a.updateFormValidity()}),a.confirmEmail=ko.observable(e.confirmEmail).extend({required:{params:!0,message:i.confirmEmailRequired}}).extend({email:{params:!0,message:i.confirmEmailInvalid}}).extend({maxLength:{params:t.EmailMaxLength,message:Kobo.Utilities.stringFormat(i.confirmEmailExceedsMaxLength,t.EmailMaxLength)}}).extend({equal:{params:a.email,message:i.emailMismatch}}),a.confirmEmail.subscribe(function(){a.updateFormValidity()}),a.recipientName=ko.observable(e.recipientName).extend({required:{params:!0,message:i.recipientNameRequired}}).extend({maxLength:{params:t.RecipientMaxLength,message:Kobo.Utilities.stringFormat(i.recipientNameExceedsMaxLength,t.RecipientMaxLength)}}),a.recipientName.subscribe(function(){a.updateFormValidity()}),a.senderName=ko.observable(e.senderName).extend({required:{params:!0,message:i.senderNameRequired}}).extend({maxLength:{params:t.SenderMaxLength,message:Kobo.Utilities.stringFormat(i.senderNameExceedsMaxLength,t.SenderMaxLength)}}),a.senderName.subscribe(function(){a.updateFormValidity()}),a.message=ko.observable(e.messageText).extend({maxLength:{params:t.MessageCharacterLimit,message:Kobo.Utilities.stringFormat(i.messageExceedsMaxLength,t.MessageCharacterLimit)}}),a.messageCount=ko.computed(function(){return null==a.message()?0:a.message().length}),a.message.subscribe(function(){a.updateFormValidity()}),a.delivery=ko.observable(e.delivery).extend({required:{throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,n,r){return n&&_defineProperties(e.prototype,n),r&&_defineProperespace("Kobo.EGiftingCustomization.FailureReason",Kobo.Enum.define({Unknown:["unknown",0],InvalidInput:["invalidInput",1],InvalidCaptcha:["invalidCaptcha",2],CreatePurchaseError:["createPurchaseError",3]})),Kobo.Utilities.assignToNamespace("Kobo.EGiftingCustomization.FailureReason.Extensions",function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"mapToMessageBoxErrorContent",value:function(e){var n=Kobo.EGiftingCustomization.FailureReason,r=window.DynamicConfiguration.giftingCustomization.resourceStrings,i=(_defineProperty(i={},n.Unknown,{body:r.genericError}),_defineProperty(i,n.InvalidInput,{body:r.invalidInput}),_defineProperty(i,n.InvalidCaptcha,{body:r.invalidCaptchents.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Kobo.Gizmo.EGiftingCustomization=function(){Kobo.Gizmo.apply(this,arguments),this.setType("EGiftingCustomization");var t,n,o,i,e,s,r,a=this,c=a.$gizmo.find(".email-template"),d=a.$gizmo.find("#egifting-collapsible-section"),u=a.$gizmo.find(".toggle-button-hitbox"),l=a.$gizmo.find("#"+a.settings.formId),m=a.$gizmo.find("#"+a.settings.buyNowButtonId),g=a.$gizmo.find("#"+a.settings.updateButtonId),f=a.settings.isCaptchaEnabled,p=Kobo.Controls.MessageBox.MessageBoxType,b=Kobo.EGiftingCustomization.FailureReason;function y(e){var t=b.Extensions.mapToMessageBoxErrorContent;Kobo._mediator.fire("kobo-message-box::clearAll",{recipientMessageBoxName:"egifting-customization"});e=_objectSpread(_objectSpread({messageType:p.Error},t(e)),{},{recipientMessageBoxName:"egifting-customization",messageBoxTemplate:"kobo-icon-message-template"});Kobo._mediator.fire("kobo-message-box::add",{mes{var e=$(this);c.removeClass("selected"),e.addClass("selected"),e.find("input").attr("checked","checked")}),0===m.length&&1!==g.length?s(a.settings.buyNowButtonId,document.getElementById("gifting-customization-container-mfe-container"),e):e(m),e(g),a.events.onResize(i)},e=function(e){e.on("click",function(e){e.preventDefault(),n($(this),l)})},s=function(t,e,n){e=e||document;var o=new MutationObserver(function(e){e.forEach(function(e){0<e.addedNodes.length&&e.addedNodes.forEach(function(e){!e||(e=e.id===t?e:e.querySelector("#".concat(t)))&&(n($(e)),o.disconnect())})})});o.observe(e,{childList:!0,subtree:!0})},n=function(n,t){var e,o;if(Kobo._mediator.fire("kobo-message-box::clearAll",{recipientMessageBoxName:"egifting-customization"}),r.canSubmit())return e=n,o=new CustomEvent("gifting::loading"),window.dispatchEvent(o),e.attr("disabled",!0),e.find(".button-content").addClass("loading"),new Promise(function(e,t){if(!f)return e({response:null});Kobo._mediator.fire("hcaptcha::executeAsync",{containerId:"egifting-customization-captcha",successCallback:e,failureCallback:t})}).then(function(e){e=e.response;e&&t.append('<input type="hidden" name="captchaToken" value="'.concat(e,'" />')),t.submit()}).catch(function(e){var t;console.error(e),y(b.InvalidCaptcha),t=n,e=new CustomEvent("gifting::loaded"),window.dispatchEvent(e),t.attr("disabled",!1),t.find(".button-content").removeClass("loading")});y(b.InvalidInput)},o=function(){var e={amount:a.settings.amount,email:a.settings.email,confirmEmail:a.settings.confirmEmail,recipientName:a.settings.recipientName,senderName:a.settings.senderName,messageText:a.settings.messageText,delivery:a.settings.delivery,rules:a.settings.rules};r=new Kobo.EGiftingCustomization.EGiftingCustomizationVM(e),ko.validation.init({errorElementClass:"has-error",decorateInputElement:!0},!0),ko.applyBindings(r,a.el)},i=function(){880<window.innerWidth?(d.css("border-bottom-width","0"),u.css("display","none")):(d.removeAttr("style"),u.removeAttr("style"))},a.init=function(){var e;o(),t(),i(),!a.settings.failureReason||(e=b.parseFromServer(a.settings.failureReason))&&window.addEventListener("load",function(){y(e)})},a.init()},Kobo.Gizmo.EGiftingCustomization.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.EGiftingRedemption=function(e){Kobo.Gizmo.apply(thir o,i,t,n,r=this,s=window.DynamicConfiguration.resourceStrings.eGiftingRedemption,a=window.DynamicConfiguration.resourceStrings.GenericErrorMessage;o=function(e,i){return{summaryVisible:e.summaryVisible,redeemable:e.redeemable,redeemed:e.redeemed,title:i.title,body:i.body,ctas:e.ctaLinks.map(funct{r.viewModel.error(""),Kobo.Spinner.showSpinnerOverlay(Kobo.$("body")),Kobo.Ajax({type:"POST",url:r.settings.redemptionUrl,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},dataType:"json"}).done(function(e){(e.IsSuccess?t:n)()}).fail(function(){n()}).always(function(){Kobo.Spinner.hideSpinnerOverlay(Kobo.$("body"))})},t=function(){r.viewModel.template(o(r.settings.postRedemption,s.postRedemption))},n=function(){r.viewModel.error(a);var e=document.querySelectorAll("section[data-bind='visible: error']")[0];e.setAttribute("tabindex","0"),e.focus(),window.scrollTo({top:0,behavior:"smooth"})},r.viewModel={template:ko.observable(o(r.settings.initial,s.initial)),redeem:i,error:ko.observable("")},ko.applyBindings(r.viewModel,e)},Kobo.Gizmo.EGiftingRedemption.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.PurchaseHistory=function(o){Kobo.Gizmo.apply(this,arguments),this.setType("PurchaseHistory");var i,t=this;i=t.settings,t.viewModel={items:ko.observable(i.items)},ko.applyBindings(t.viewModel,o)},Kobo.Gizmo.PurchaseHistory.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.PurchaseHistoryControl=function(){Kobo.Gizmo.apply(this,arguments),this.setType("PurchaseHistoryControl"),this.defaults={filterChip:null,filterButton:null,filterList:null,filterItem:null};var t,e,s=this;function o(t,e){var o=1<arguments.length&&void 0!==e&&e,e=t.closest("."+s.settings.filterChip),e=$(e.find(st));e.hasClass("open")||o?(t.removeClass("selected"),e.removeClass("open"),t.attr("aria-expanded","false"),e.attr("aria-hidden","true")):(t.addClass("selected"),e.addClass("open"),t.attr("aria-expanded","true"),e.attr("aria-hidden","false"))}t=$("."+s.settings.filterButton),e=$("."+s.settings.filterList),t.on("click",function(){o($(this))}),t.on("focusout",function(t){null!==t.relatedTarget&&$(t.relatedTarget).hasClass(s.settings.filterItem)||o($(this),!0)}),t.on("keydown",function(t){var e=$(this);t.keyCode===Kobo.KeyCodes.ESC&&o(e,!0)}),e.on("focusout keydown",function(t){$(this).prevAll("."+s.settings.filterButton).first().trigger(t)})},Kobo.Gizmo.PurchaseHistoryControl.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.PurchaseHistoryActions=function(o){Kobo.Gizmo.apply(this,arguments),this.setType("PurchaseHistoryActions");var e,t=this;e=t.settings,t.viewModel={id:e.id,submitUrl:e.submitUrl,replace:e.replace,successMessageKey:e.successMessageKey,dialogId:e.dialogId,dialogItemTitle:e.dialogItemTitle,dialogItemAuthor:e.dialogItemAuthor,dialogItemAvailableDate:e.dialogItemAvailableDate,dialogItemImgUrl:e.dialogItemImgUrl,dialogItemImgAlt:e.dialogItemImgAlt,openModal:function(){var o=t.viewModel.dialogId,o=Kobo.$("#"+o),o=Kobo.$(o.html());Kobo._modal.open(o),o.closest("#modal-content").addClass("purchase-history-modal").addClass("purchase-history-dialog"),ko.applyBindings(t.viewModel,o[0])},closeModal:function(){Kobo._modal.close(),ko.cleanNode(this.$modalView[0])},submitForm:function(o){Kobo.Ajax({type:"POST",url:t.viewModel.submitUrl,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:new FormData(o),contentType:!1,processData:!1,dataType:"json"}).done(function(o){var e;Kobo._modal.close(),o.IsSuccess&&(e=window.DynamicConfiguration.resourceStrings.purchaseHistory[t.viewModel.successMessageKey],(o=document.getElementById("purchase-history-alert-success")).textContent=Kobo.Utilities.stringFormat(e,t.viewModel.replace),o.style.display="block",window.scrollTo({top:0,behavior:"smooth"}),setTimeout(function(){window.location.reload()},5e3))}).fail(function(){Kobo._modal.close()})}},ko.applyBindings(t.viewModel,o)},Kobo.Gizmo.PurchaseHistoryActions.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Gizmo.PaymentMethodsDisplay=function(t,i){Kobo.Gizmo.apply(this,arguments),this.setType("PaymentMethodsDisplay");var o,n=this;this.removePaymentMethod=function(e){var o={paymentMethodId:e.paymentMethodId,paymentMethodType:e.paymentMethodType};return new Promise(function(e,t){Kobo.$.ajax({type:"POST",contentType:"application/json",url:i.DeletePaymentMethodUrl,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:JSON.stringify(o),success:e,error:t})})},this.init=function(){var e={paymentMethods:i.PaymentMethods,removePaymentMethod:n.removePaymentMethod,messageBoxName:i.MessageBoxName};o=new Kobo.PaymentMethodsDisplay.ViewModels.PaymentMethodsDisplayVM(e),ko.applyBindings(o,t)},this.init()},Kobo.Gizmo.PaymentMethodsDisplay.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";function ownKeys(t,e){var o,a=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,o)),a}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Kobo.Utilities.assignToNamespace("Kobo.PaymentMethodsDisplay.ViewModels.PaymentMethodsDisplayVM",function(t){var e,o=this,a=t.removePaymentMethod,s=t.messageBoxName,n=Kobo.PaymentMethodsDisplay.ViewModels,r=Kobo.PurchasePath.Enums.PaymentMethodType,i=Kobo.Controls.MessageBox.MessageBoxType,m=window.DynamicConfiguration.paymentMethodsDisplay.resourceStrings,c=Kobo.$("#confirm-action-modal-template"),d=(_defineProperty(e={},r.BraintreeCreditCard,{template:"payment-methods-display-braintree-credit-card-template",viewModel:n.BraintreeCreditCardDisplayItemVM}),_defineProperty(e,r.BraintreePayPal,{template:"payment-methods-display-braintree-paypal-tem{template:"payment-methods-display-sepa-bank-account-template",viewModel:n.SepaBankAccountDisplayItemVM}),e);this.removePaymentMethod=function(e){o.closeModal();var t={paymentMethodId:e.paymentMethodId(),paymentMethodType:e.paymentMethodType()};return a(t).then(function(){o.paymentMethods.remove(e),o.sendRemovePaymentMethodSuccessMessage()}).catch(function(e){console.error(e);e={headline:m.removePaymentMethodError};o.sendErrorMessageToMessageBox(e)})},this.confirmRemovePaymentMethod=function(e){e={title:m.removePaymentMethodConfirmationHeading,message:m.removePaymentMethodConfirmationMessage,cancelText:m.removePaymentMethodCancel,cancelAction:o.closeModal,confirmText:m.removePaymentMethodConfirm,confirmAction:o.removePaymentMethod.bind(o,e)};Kobo._modal.open(c.html()),ko.applyBindings(e,Kobo.$("#confirm-action-modal")[0])},this.closeModal=function(){Kobo._modal.destroy()},this.getContentTemplate=function(){var e="payment-methods-display-no-payment-method-template",t="payment-methods-display-items-template";return o.hasSavedPaymentMethod()?t:e},this.getPaymentMethodDisplayTemplate=function(e){var t=e.paymentMethodType(),e=d[t].template;if(!e)throw new Error("Missing template mapping for payment method of type ".concat(t,"."));return e},this.sendRemovePaymentMethodSuccessMessage=function(){Kobo._mediator.fire("kobo-message-box::clearAll",{recipientMessageBoxName:s});var e={messageType:i.Success,headline:m.removePaymentMethodSuccess,recipientMessageBoxName:s,messageBoxTemplate:"kobo-icon-close-message-template"};Kobo._mediator.fire("kobo-message-box::add",{message:e})},this.sendErrorMessageToMessageBox=function(e){Kobo._mediator.fire("kobo-message-box::clearAll",{recipientMessageBoxName:s});e=_objectSpread(_objectSpread({messageType:i.Error},e),{},{recipientMessageBoxName:s,messageBoxTemplate:"kobo-icon-close-message-template"});Kobo._mediator.fire("kobo-message-box::add",{message:e})},this.setSuccessMessageAfterRedirect=function(){if(Cookies.get("SavePaymentMethodSuccess")){var e="true"===Cookies.get("SavePaymentMethodSuccess").toLowerCase();if(Cookies.remove("SavePaymentMethodSuccess"),e){Kobo._mediator.fire("kobo-message-box::clearAll",{recipientMessageBoxName:s});var o={messageType:i.Success,headline:m.savePaymentMethodSuccess,recipientMessageBoxName:s,messageBoxTemplate:"kobo-icon-close-message-template"};return new Promise(function(t){setTimeout(function e(){return Kobo._mediator&&Kobo._events["kobo-message-box::add"]&&"registered"===Kobo._events["kobo-message-box::add"]?(Kobo._mediator.fire("kobo-message-box::add",{message:o}),t()):void setTimeout(e,100)},0)})ap(function(e){var t=d[e.PaymentMethodType].viewModel;if(!t)throw new Error("Missing view model mapping for payment method of type ".concat(e.paymentMethodType,"."));return new t(e)});o.setSuccessMessageAfterRedirect(),o.paymentMethods=ko.observableArray(e),o.hasSavedPaymentMethod=ko.computed(function(){return 0!==o.paymentMethods().length})},this.init()});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.PaymentMethodsDisplay.ViewModels.BraintreeCreditCardDisplayItemVM",function(e){var a=this,o=e.PaymentMethodId,t=e.PaymentMethodType,s=e.IconClassName,i=e.DisplayText,e=e.Expiration;a.paymentMethodId=ko.observable(o),a.paymentMethodType=ko.observable(t),a.iconClassName=ko.observable(s),a.displayText=ko.observable(i),a.expiration=ko.observable(e)});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.PaymentMethodsDisplay.ViewModels.BraintreePayPalDisplayItemVM",function(e){var a=this,o=e.PaymentMethodId,s=e.PaymentMethodType,t=e.IconClassName,e=e.DisplayText;a.paymentMethodId=ko.observable(o),a.paymentMethodType=ko.observable(s),a.iconClassName=ko.observable(t),a.displayText=ko.observable(e)});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.PaymentMethodsDisplay.ViewModels.SepaBankAccountDisplayItemVM",function(e){var a=this,o=e.PaymentMethodId,s=e.PaymentMethodType,t=e.IconClassName,e=e.DisplayText;a.paymentMethodId=ko.observable(o),a.paymentMethodType=ko.observable(s),a.iconClassName=ko.observable(t),a.displayText=ko.observable(e)});
"use strict";Kobo.Gizmo.PaymentMethodDisplayUpdate=function(t,e){var a;Kobo.Gizmo.apply(this,arguments),this.setType("PaymentMethodDisplayUpdate"),this.init=function(){var o={messageBoxName:e.MessageBoxName,paymentMethods:e.PaymentMethods};a=new Kobo.PaymentMethodsDisplay.ViewModels.PaymentMethodDisplayUpdateVM(o),ko.applyBindings(a,t)},this.init()},Kobo.Gizmo.PaymentMethodDisplayUpdate.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Kobo.Utilities.assignToNamespace("Kobo.PaymentMethodsDisplay.ViewModels.PaymentMethodDisplayUpdateVM",function(t){var e,o=this,a=t.messageBoxName,s=Kobo.Controls.MessageBox.MessageBoxType,i=window.DynamicConfiguration.paymentMethodsDisplay.resourceStrings,n=Kobo.PaymentMethodsDisplay.ViewModels,r=Kobo.PurchasePath.Enums.PaymentMethodType,m=(_defineProperty(e={},r.BraintreeCreditCard,{template:"payment-methods-display-braintree-credit-card-inline-template",viewModel:n.BraintreeCreditCardDisplayItemVM}),_defineProperty(e,r.BraintreePayPal,{template:"payment-methods-display-braintree-paypal-template",viewModel:n.BraintreePayPalDisplayItemVM}),_defineProperty(e,r.SepaStripe,{template:"payment-methods-display-sepa-bank-account-template",viewModel:n.SepaBankAccountDisplayItemVM}),e);this.setSuccessMessageAfterRedirect=function(){if(Cookies.get("SavePaymentMethodSuccess")){var e="true"===Cookies.get("SavePaymentMethodSuccess").toLowerCase();if(Cookies.remove("SavePaymentMethodSuccess"),e){Kobo._mediator.fire("kobo-message-box::clearAll",{recipientMessageBoxName:a});var o={messageType:s.Success,headline:i.savePaymentMethodSuccess,recipientMessageBoxName:a,messageBoxTemplate:"kobo-icon-close-message-template"};return new Promise(function(t){setTimeout(function e(){return Kobo._mediator&&Kobo._events["kobo-message-box::add"]&&"registered"===Kobo._events["kobo-message-box::add"]?(Kobo._mediator.fire("kobo-message-box::add",{message:o}),t()):void setTimeout(e,100)},0)})}}},this.getPaymentMethodDisplayTemplate=function(e){var t=e.paymentMethodType(),e=m[t].template;if(!e)throw new Error("Missing template mapping for payment method of type ".concat(t,"."));return e},this.init=function(){var e=t.paymentMethods.map(function(e){var t=m[e.PaymentMethodType].viewModel;if(!t)throw new Error("Missing view model mapping for payment method of type ".concat(e.paymentMethodType,"."));return new t(e)});o.setSuccessMessageAfterRedirect(),o.paymentMethods=ko.observableArray(e)},this.init()});
"use strict";function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Kobo.Gizmo.SavePaymentMethod=function(t,o){var r=this,n=Kobo.SavePaymentMethod.FailureReason,a=o.IsCaptchaEnabled,i=o.Caller;this.savePaymentMethod=function(e){return new Promise(function(t,r){Kobo.$.ajax({type:"POST",contentType:"application/json",url:o.SavePaymentMethodUrl,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:JSON.stringify(_objectSpread(_objectSpread({},e),{},{caller:i})),success:function(e){if(!e.IsSuccess)return e.NextStepUrl?void t({nextStepUrl:e.NextStepUrl}):void r(n.parseFromServer(e.FailureReason));t()},error:r})})},this.executeHCaptcha=function(){return new Promise(function(e,t){if(!a)return e({response:""});Kobo._mediator.fire("hcaptcha::executeAsync",{containerId:"save-payment-method-captcha",successCallback:e,failureCallback:t})})},this.init=function(){var e={paymentMethods:o.PaymentMethods,braintreeClientToken:o.BraintreeClientToken,savePaymentMethod:r.savePaymentMethod,returnUrl:o.ReturnUrl,messageBoxName:o.MessageBoxName,recordVerifyCardMetricsUrl:o.RecordVerifyCardMetricsUrl,stripeRedirectUrl:o.StripeRedirectUrl,executeHCaptcha:r.executeHCaptcha,caller:o.Caller},e=new Kobo.SavePaymentMethod.ViewModels.SavePaymentMethodVM(e);ko.applyBindings(e,t)},this.init()},Kobo.Gizmo.SavePaymentMethod.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";function _defineProperty(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var a=0;a<r.length;a++){var i=r[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,r,a){return r&&_defineProperties(e.prototype,r),a&&_defineProperties(e,a),e}Kobo.Utilities.assignToNamespace("Kobo.SavePaymentMethod.FailureReason",Kobo.Enum.define({Unknown:["unknown",0],InvalidExpirationDate:["invalidExpirationDate",1],InvalidCreditCardType:["invalidCreditCardType",2],InvalidCreditCardNumber:["invalidCreditCardNumber",3],InvalidSecurityCode:["invalidSecurityCode",4],AmexNotAllowed:["amexNotAllowed",5],VerificationError:["verificationError",6],OtherFailure:["otherFailure",7],VaultFailure:["vaultFailure",8],VaultThreeDSecureRequired:["vaultThreeDSecureRequired",9],RequiresAuthorization:["requiresAuthorization",10],AuthorizationFailure:["authorizationFailure",11],MissingPaymentMethod:["missingPaymentMethod",12],SetupIntentCreationFailure:["setupIntentCreationFailure",13],InvalidCaptcha:["invalidCaptcha",14],UnsupportedBank:["unsupportedBank",15],ParameterMissing:["parameterMissing",16],FraudActionDetected:["fraudActionDetected",17],CreditCardGenericIssue:["creditCardGenericIssue",999],CreditCardInvalid:["creditCardInvalid",998],CancelledCardholderAuthentication:["cancelledCardHolderAuthentication",997],CardholderAuthenticationFailed:["cardholderAuthenticationFailed",996],IdealAccountInvalid:["idealAccountInvalid",995],MissingNextStepUrl:["missingNextStepUrl",994],CaptchaError:["captchaError",993],PayPalClientSetupError:["paypalClientSetupError",992],PayPalTokenizeError:["paypalTokenizeError",991],PayPalAuthorizeError:["paypalAuthorizeError",990]})),Kobo.Utilities.assignToNamespace("Kobo.SavePaymentMethod.FailureReason.Extensions",function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fromPayPalCheckout",value:function(e){var r,a=Kobo.PurchasePath.Enums.PayPalCheckoutFailureReason;return(_defineProperty(r={},a.ClientSetupError,Kobo.SavePaymentMethod.FailureReason.PayPalClientSetupError),_defineProperty(r,a.AuthorizeError,Kobo.SavePaymentMethod.FailureReason.PayPalAuthorizeError),_defineProperty(r,a.TokenizeError,Kobo.SavePaymentMethod.FailureReason.PayPalTokenizeError),r)[e]}},{key:"mapToMessageBoxErrorContent",value:function(e){var r=Kobo.SavePaymentMethod.FailureReason,a=window.DynamicConfiguration.savePaymentMethod.resourceStrings,i=(_defineProperty(i={},r.Unknown,{headline:a.issueWithPaymentMethod,body:a.unableToSaveError}),_defineProperty(i,r.InvalidExpirationDate,{headline:a.invalidExpirationDate,messageName:"invalidHostedField"}),_defineProperty(i,r.InvalidCreditCardType,{headline:a.issueWithCard,body:a.unableToSaveError}),_defineProperty(i,r.InvalidCreditCardNumber,{headline:a.invalidCreditCardNumber,messageName:"invalidHostedField"}),_defineProperty(i,r.InvalidSecurityCode,{headline:a.InvalidSecurityCode,messageName:"invalidHostedField"}),_defineProperty(i,r.AmexNotAllowed,{headline:a.issueWithCard,body:a.amexNotAllowed}),_defineProperty(i,r.VerificationError,{headline:a.issueWithPaymentMethod,body:a.unableToSaveError}),_defineProperty(i,r.OtherFailure,{headline:a.issueWithPaymentMethod,body:a.unableToSaveError}),_defineProperty(i,r.VaultFailure,{headline:a.issueWithPaymentMethod,body:a.unableToSaveError}),_defineProperty(i,r.CreditCardGenericIssue,{headline:a.issueWithCard,body:a.unableToSaveError}),_defineProperty(i,r.CreditCardInvalid,{headline:a.invalidCreditCard,body:a.enterValidCreditCard,messageName:"invalidHostedField"}),_defineProperty(i,r.VaultThreeDSecureRequired,{headline:a.issueWithPaymentMethod,body:a.unableToSaveError}),_defineProperty(i,r.CancelledCardholderAuthentication,{headline:a.needToVerifyCardholder,body:a.pleaseAuthenticateError}),_defineProperty(i,r.CardholderAuthenticationFailed,{headline:a.issueWithCard,body:a.changePaymentMethodOrContactBank}),_defineProperty(i,r.CaptchaError,{headline:a.issueWithPaymentMethod,body:a.unableToSaveError}),_defineProperty(i,r.InvalidCaptcha,{headline:a.issueWithPaymentMethod,body:a.unableToSaveError}),_defineProperty(i,r.IdealAccountInvalid,{headline:a.invalidIdealAccount,body:a.enterValidIdealAccount}),_defineProperty(i,r.UnsupportedBank,{headline:a.unsupportedBank,body:a.changeBankOrPaymentMethod}),_defineProperty(i,r.ParameterMissing,{headline:a.emailIsRequired,body:a.accountDoesNotHaveEmail,htmlBody:!0}),_defineProperty(i,r.FraudActionDetected,{headline:a.genericErrorTitle,body:a.genericErrorContent,htmlBody:!0,GetHelpRedirection:!0}),i);return i[e]||i[r.Unknown]}}]),e}());
"use strict";function ownKeys(t,e){var o,r=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Kobo.Utilities.assignToNamespace("Kobo.SavePaymentMethod.ViewModels.SavePaymentMethodVM",function(e){var o=this,t=Kobo.SavePaymentMethod.ViewModels,r=Kobo.PurchasePath.Enums.PaymentMethodType,a=Kobo.Controls.MessageBox.MessageBoxType,n=Kobo.SavePaymentMethod.FailureReason,s=window.DynamicConfiguration.savePaymentMethod.resourceStrings,i="savePaymentMethod",c="savePaymentMethodButton",d=e.paymentMethods,m=e.braintreeClientToken,u=e.returnUrl,b=e.stripeRedirectUrl,l=e.messageBoxName,p=e.recordVerifyCardMetricsUrl,y=e.savePaymeaymentMethod=function(t){Kobo._mediator.fire("kobo-message-box::clearAll",{recipientMessageBoxName:i}),Kobo._mediator.fire("kobo-loading-submit-button::loading",{recipientButtonName:c});return v().then(function(e){e=e.response;return y(_objectSpread(_objectSpread({},t),{},{captchaToken:e}))},function(){return Promise.reject(n.CaptchaError)})};var M=(_defineProperty(e={},r.BraintreeCreditCard,function(e){return new t.SaveBraintreeCreditCardVM(_objectSpread({braintreeClientToken:m,recordVerifyCardMetricsUrl:p},e))}),_defineProperty(e,r.BraintreePayPal,function(e){return new t.SaveBraintreePayPalVM(_objectSpread({braintreeClientToken:m},e))}),_defineProperty(e,r.SepaStripe,function(e){return new t.SaveIdealSepaVM(_objectSpread({stripeRedirectUrl:b},e))}),e);this.handleItemSelected=function(e){Kobo._mediator.fire("kobo-message-box::clearAll",{recipientMessageBoxName:i});e=e.content.viewModel.button;o.saveButton(e)},this.setErrorForFailureReason=function(e){var t=Kobo.SavePaymentMethod.FailureReason.Extensions.mapToMessageBoxErrorContent;Kobo._mediator.fire("kobo-loading-submit-button::loaded",{recipientButtonName:c}),Kobo._mediator.fire("kobo-message-box::clearAll",{recipientMessageBoxName:i});e=_objectSpread(_objectSpread({messageType:a.Error},t(e)),{},{recipientMessageBoxName:i,messageBoxTemplate:"kobo-icon-message-template"});Kobo._mediator.fire("kobo-message-box::add",{messagection(){var e={messageKey:"paymentMethodAdded",message:{messageType:a.Success,headline:s.savePaymentMethodSuccess,recipientMessageBoxName:l,messageBoxTemplate:"kobo-icon-close-message-template"}};Kobo._mediator.fire("kobo-message-box::storeMessage",e),o.navigateToReturnUrl()},this.navigateToReturnUrl=function(){Kobo.Utilities.navigateTo(u)},this.setErrorForFailureReasonAfterRedirect=function(){var e;Cookies.get("SavePaymentMethodFailureReason")&&(e=Cookies.get("SavePaymentMethodFailureReason"),Cookies.remove("SavePaymentMethodFailureReason"),window.addEventListener("load",function(){o.setErrorForFailureReason(e)}))},this.init=function(){o.savePaymentMethodSuccessEvent=new ko.subscribable,o.savePaymentMethodSuccessEvent.subscribe(o.onSavePaymentMethodSuccess),o.savePaymentMethodFailureEvent=new ko.subscribable,o.savePaymentMethodFailureEvent.subscribe(o.setErrorForFailureReason),o.setErrorForFailureReasonAfterRedirect(),o.paymentMethods=d.map(function(e){var t=M[e.PaymentMethodType];if(!t)throw new Error("Missing view model mapping for payment method of type ".concat(e.paymentMethodType,"."));return t(_objectSpread(_objectSpread({},e),{},{caller:h,savePaymentMethod:o.savePaymentMethod,savePaymentMethodSuccessEvent:o.savePaymentMethodSuccessEvent,savePaymentMethodFailureEvent:o.savePaymentMethodFailureEvent}))}),o.saveButton=ko.observable()},this.init()});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.SavePaymentMethod.ViewModels.SaveBraintreeCreditCardVM",function(d){var c=this,i=Kobo.SavePaymentMethod.FailureReason,l=Kobo.SavePaymentMethod.ViewModels.SaveButtonVM,e=Kobo.PurchasePath.Enums,n=e.PaymentType,t=e.ConvertPaymentTypeToServer,a=e.ConvertCardTypeToServer,r=e.ThreeDSecure;this.handleSubmit=function(){return c.validateHostedFields().then(c.tokenizePaymentMethod).then(function(e){e={paymentMethodType:c.paymentMethodType,paymentDetails:{PaymentType:t(n.CreditCard),BraintreeCreditCardToken:e.nonce,ExpiryMonth:e.details.expirationMonth,ExpiryYear:e.details.expirationYear,CardType:a(e.details.cardType.toLowerCase()),DeviceData:c.deviceData}};return c.savePaymentMethod(e)}).then(c.handleSavePaymentMethodSuccess).catch(c.handleSavePaymentMethodFailure)},this.submitWithThreeDSecureVerification=function(){return c.validateHostedFields().then(c.tokenizePaymentMethod).then(function(e){return new Promise(function(t,a){Kobo._mediator.fire("threeDSecure::verifyCard",{nonce:e.nonce,bin:e.details.bin,paymentType:n.BraintreeCreditCard,amount:"1.00",verifyAction:Kobo.PurchasePath.Ener,successCallback:function(e){return e.challengeStatus===r.ChallengeStatus.ChallengeSuccess||e.challengeStatus===r.ChallengeStatus.NoChallengeSuccess?t(e.nonce):a(i.CardholderAuthenticationFailed)},canceledCallback:function(){return a(i.CancelledCardholderAuthentication)},errorCallback:function(){return a(i.CardholderAuthenticationFailed)}})})}).then(function(e){e={paymentMethodType:c.paymentMethodType,paymentDetails:{PaymentType:t(n.CreditCard),BraintreeCreditCardToken:e,DeviceData:c.deviceData}};return c.savePaymentMethod(e)}).then(c.handleSavePaymentMethodSuccess).catch(c.handleSavePaymentMethodFailure)},this.validateHostedFields=function(){return new Promise(function(t,a){Kobo._mediator.fire("braintreeHostedFields::validate",{validatedCallback:function(e){if(!e)return Kobo._mediator.fire("braintreeHostedFields::submittedWithInvalidFields"),void a(i.CreditCardInvalid);t()}})})},this.tokenizePaymentMethod=function(){return new Promise(function(a,n){c.submitFormEvent.notifySubscribers({callback:function(e,t){e?n(i.CreditCardGenericIssue):a(t)}})})},this.hndleSavePaymentMethodFailure=function(e){e!==i.VaultThethodFailureEvent.notifySubscribers(e):c.submitWithThreeDSecureVerification()},this.clearInvalidErrorMessageIfAllFieldsValid=function(){return new Promise(function(e){Kobo._mediator.fire("braintreeHostedFields::fetchFormState",{formStateReadyCallback:e})}).then(function(e){var t=e.fields;Object.keys(t).every(function(e){return t[e].isValid})&&Kobo._mediator.fire("kobo-message-box::clearMessageByName",{recipientMessageBoxName:"savePaymentMethod",messageName:"invalidHostedField"})})},this.setupEvents=function(){c.isValidEvent=new ko.subscribable,c.submitFormEvent=new ko.subvent=new ko.subscribable,c.teardownFormEvent=new ko.subscribable,Kobo._mediator.register("braintreeHostedFields::submitRequested"),Kobo._mediator.subscribe("braintreeHostedFields::submitRequested",c.handleSubmit),c.isValidEvent.subscribe(c.clearInvalidErrorMessageIfAllFieldsValid),c.deviceDataReadyEvent.subscribe(function(e){c.deviceData=e})},this.init=function(){var e=d.PaymentMethodType,t=d.Icons,a=d.braintreeClientToken,n=d.recordVerifyCardMetricsUrl,i=d.savePaymentMethod,r=d.savePaymentMethodSuccessEvent,o=d.savePaymentMethodFailureEvent,s=d.caller;c.key=a,c.recordVerifyCardMetricsUrl=n,c.deviceData=null,c.label=window.DynamicConfiguration.savePaymentMethod.resourceStrings.creditDebitLabel,c.paymentMethodType=e,c.icons=t,c.caller=s,c.template="save-payment-method-braintree-credit-card-template",c.button=new l("save-payment-method-braintree-credit-card-button-template"),c.savePaymentMethod=i,c.savePaymentMethodSuccessEvent=r,c.savePaymentMethodFailureEvent=o,c.setupEvents()},this.init()});
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,a,t){return a&&_defineProperties(e.prototype,a),t&&_defineProperties(e,t),e}var SaveBraintreePayPalViewModel=function(){function r(e){_classCallCheck(this,r);var a=e.PaymentMethodType,t=e.Icons,n=e.Label,s=e.braintreeClientToken,i=e.savePaymentMethod,o=e.savePaymentMethodSuccessEvent,e=e.savePaymentMethodFailureEvent;Kobo.PurchasePath.Components.BraintreePayPalCheckout.create({key:s}),this.key=s,this.label=n,this.paymentMethodType=a,this.icons=t,this.button=new Kobo.SavePaymentMethod.ViewModels.SaveButtonVM("save-payment-method-braintree-paypal-save-button-template",{key:this.key}),this.spinnerModalTemplate=Kobo.$("#spinner-modal-template").html(),this.savePaymentMethodCallback=i,this.savePaymentMethodSuccessEvent=o,this.savePaymentMethodFailureEvent=e,this.setupEvents()}return _createClass(r,[{key:"savePaymentMethod",value:function(e){return Kobo._modal.open(this.spinnerModalTemplate),this.savePaymentMethodCallback(e)}},{key:"handleSuccess",value:function(e,a){var t=a.detail,n=t.payload,s=t.deviceData,a=Kobo.PurchasePath.Enums,t=a.ConvertPaymentTypeToServer,a=a.PaymentType,s={paymentMethodType:this.paymentMethodType,paymentDetails:{PaymentType:t(a.BraintreePaypal),Nonce:n.nonce,DeviceData:s}};return this.savePaymentMethod(s).then(this.handleSavePaymentMethodSuccess.bind(this)).catch(this.handleSavePaymentMethodFailure.bind(this))}},{key:"handleCancel",value:function(){this.sendTrackingMessage(Kobo.PurchasePath.Enums.AlternativePaymentMethod.Status.Canceled)}},{key:"handleFailure",value:function(e,a){a=Kobo.SavePaymentMethod.FailureReason.Extensions.fromPayPalCheckout(a.detail.failureReason);this.handleSavePaymentMethodFailure(a)}},{key:"handleClick",value:function(){this.sendTrackingMessage(Kobo.PurchasePath.Enums.AlternativePaymentMethod.Status.Started)}},{key:"sendTrackingMessage",value:function(e){var a=Kobo.PurchasePath.Enums,t=a.AlternativePaymentMethod,a=a.PaymentType,a={type:t.Name,trackables:{status:e,paymentType:a.BraintreePaypal}};Kobo._mediator.fire("webEventTracker::sendTrackingMessage",a)}},{key:"handleSavePaymentMethodSuccess",value:function(){this.sendTrackingMessage(Kobo.PurchasePath.Enums.AlternativePaymentMethod.Status.Success),this.savePaymentMethodSuccessEvent.notifySubscribers()}},{key:"handleSavePaymentMethodFailure",value:function(e){Kobo._modal.destroy(),this.sendTrackingMessage(Kobo.PurchasePath.Enums.AlternativePaymentMethod.Status.Failure),this.savePaymentMethodFailureEvent.notifySubscribers(e)}},{key:"setupEvents",value:function(){Kobo._mediator.subscribe("braintreePayPalCheckout::onSuccess",this.handleSuccess.bind(this)),Kobo._mediator.subscribe("braintreePayPalCheckout::onFailure",this.handleFailure.bind(this)),Kobo._mediator.subscribe("braintreePayPalCheckout::onClick",this.handleClick.bind(this)),Kobo._mediator.subscribe("braintreePayPalCheckout::onCancel",this.handleCancel.bind(this))}}]),r}();Kobo.Utilities.assignToNamespace("Kobo.SavePaymentMethod.ViewModels.SaveBraintreePayPalVM",SaveBraintreePayPalViewModel);
"use strict";Kobo.Utilities.assignToNamespace("Kobo.SavePaymentMethod.ViewModels.SaveIdealSepaVM",function(e){var a=this,t=this,n=Kobo.SavePaymentMethod.FailureReason,i=Kobo.SavePaymentMethod.ViewModels.SaveButtonVM,o=Kobo.PurchasePath.Enums,s=o.PaymentType,l=o.ConvertPaymentTypeToServer,r=e.PaymentMethodType,m=e.Label,u=e.Icons,d=e.AvailableBanks,o=e.InputRules,h=e.FullName,v=e.stripeRedirectUrl,y=e.savePaymentMethod,p=e.savePaymentMethodFailureEvent;this.paymentMethodType=r,this.fullName=ko.observable().extend({required:{params:!0,message:window.DynamicConfiguration.savePaymentMethod.resourceStrings.fullNaullNameMinLength,message:window.DynamicConfiguratioameIsTooShort}}).exte:window.DynamicConfiguration.savePaymentMethod.resourceStrings.fullNameIsTooLong}}),this.bank=ko.observable(),this.availableBanks=d.map(function(e){return{code:e.Code,name:e.Name}}),this.errors=ko.validation.group(t),this.canSubmit=function(){return 0===a.errors().length},this.fieldIsInvalid=function(e){return e.isModified()&&!e.isValid()},this.handleSubmit=function(){if(!a.canSubmit())return a.errors.showAllMessages(),void t.handleSavePaymentMethodFailure(n.IdealAccountInvalid);var e={paymentMethodType:t.paymenme(),Bank:t.bank(),SuccessUrl:v}};return t.savePaymentMethod(e).then(function(e){e.nextStepUrl?Kobo.Utilities.navigateTo(e.nextStepUrl):t.handleSavePaymentMethodFailure(n.MissingNextStepUrl)}).catch(t.handleSavePaymentMethodFailure)},this.handleSavePaymentMethodFailure=function(e){return t.savePaymentMethodFailureEvent.notifySubscribers(e)},this.init=function(){t.label=m,t.icons=ul-sepa-template",t.button=new i("save-payment-method-ideal-sepa-save-button-template"),t.savePaymentMethod=y,t.savePaymentMethodFailureEvent=p,h&&t.fullName(h)},this.init()});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.SavePaymentMethod.ViewModels.SaveButtonVM",function(t,i){var e=this;this.init=function(){e.template=t,e.options=i},this.init()});
"use strict";Kobo.Gizmo.BillingAddressDisplay=function(s,o){var t;Kobo.Gizmo.apply(this,arguments),this.setType("BillingAddressDisplay"),this.init=function(){var i={hasSavedBillingAddress:o.HasSavedBillingAddress,country:o.Country,state:o.State,postalCode:o.PostalCode,vatNumber:o.VatNumber};t=new Kobo.BillingAddressDisplay.ViewModels.BillingAddressDisplayVM(i),ko.applyBindings(t,s)},this.init()},Kobo.Gizmo.BillingAddressDisplay.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Utilities.assignToNamespace("Kobo.BillingAddressDisplay.ViewModels.BillingAddressDisplayVM",function(i){var l=this,a=Kobo.BillingAddressDisplay.ViewModels;this.getContentTemplate=function(){var s="billing-address-display-no-billing-address-template",t="billing-address-display-template";return l.hasSavedBillingAddress()?t:s},this.getBillingAddressTemplate=function(){var s=l.billingAddress.displayType,t={CountryOnly:"billing-address-display-country-only-template",CountryStatePostalCode:"billing-address-display-country-state-postal-code-template",CountryVat:"billing-address-display-country-vat-template"}[s];if(!t)throw new Error("Missing template mapping for billing address of type ".concat(s,"."));return t},this.init=function(){var s,t,e={country:i.country,state:i.state,postalCode:i.postalCode,vatNumber:i.vatNumber};l.billingAddress=(t=(s=e).country&&s.state&&s.postalCode,e=s.country&&!s.state&&!s.postalCode&&s.vatNumber,new(t?a.CountryStatePostalCodeBillingAddressVM:e?a.CountryVatBillingAddressVM:a.CountryOnlyBillingAddressVM)(s)),l.hasSavedBillingAddress=ko.observable(i.hasSavedBillingAddress)},this.init()});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.BillingAddressDisplay.ViewModels.CountryOnlyBillingAddressVM",function(s){s=s.country;this.displayType="CountryOnly",this.country=ko.observable(s)});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.BillingAddressDisplay.ViewModels.CountryStatePostalCodeBillingAddressVM",function(o){var e=this,s=o.country,t=o.state,o=o.postalCode;e.displayType="CountryStatePostalCode",e.country=ko.observable(s),e.state=ko.observable(t),e.postalCode=ko.observable(o)});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.BillingAddressDisplay.ViewModels.CountryVatBillingAddressVM",function(s){var e=this,o=s.country,s=s.vatNumber;e.displayType="CountryVat",e.country=ko.observable(o),e.vatNumber=ko.observable(s)});
"use strict";function _defineProperty(e,i,n){return i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,i){for(var n=0;n<i.length;n++){var o=i[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,i,n){return i&&_defineProperties(e.prototype,i),n&&_defineProperties(e,n),e}Kobo.Utilities.assignToNamespace("Kobo.SaveBillingAddress.FailureReason",Kobo.Enum.define({Unknown:["unknown",0],InvalidDaytimePhoneNumber:["invalidDaytimePhoneNumber",1],InvalidCountryAndPostalCode:["invalidCountryAndPostalCode",2],InvalidCountryAndDivision:["invalidCountryAndDivision",3],MissingAddress:["missingAddress",4],MissingCity:["missingCity",5],UnknownError:["unknownError",6],MissingVatNumber:["missingVatNumber",7],InvalidVatNumber:["invalidVatNumber",8],InvalidPostalCode:["invalidPostalCode",9],InvalidPostalCodeLength:["invalidPostalCodeLength",10],GenericIssue:["genericIssue",999],PostalCodeError:["postalCodeError",998],ZipCodeError:["zipCodeError",997],VATError:["vatError",996]})),Kobo.Utilities.assignToNamespace("Kobo.SaveBillingAddress.FailureReason.Extensions",function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"mapToMessageBoxErrorContent",value:function(e){var i=Kobo.SaveBillingAddress.FailureReason,n=window.DynamicConfiguration.billingAddress.resourceStrings,o=(_defineProperty(o={},i.Unknown,{headline:n.unableToSaveBillingAddress,body:n.unableToSaveBillingAddressMessage}),_defineProperty(o,i.InvalidCountryAndPostalCode,{headline:n.invalidPostalCode,body:n.invalidPostalCodeMessage}),_defineProperty(o,i.MissingVatNumber,{headline:n.invalidVATNumber,body:n.invalidVATNumberMessage}),_defineProperty(o,i.InvalidVatNumber,{headline:n.invalidVATNumber,body:n.invalidVATNumberMessage}),_defineProperty(o,i.InvalidPostalCode,{headline:n.invalidPostalCode,body:n.invalidPostalCodeMessage}),_defineProperty(o,i.InvalidPostalCodeLength,{headline:n.invalidPostalCode,body:n.invalidPostalCodeMessage}),_defineProperty(o,i.GenericIssue,{headline:n.unableToSaveBillingAddress,body:n.unableToSaveBillingAddressMessage}),_defineProperty(o,i.PostalCodeError,{headline:n.invalidPostalCode,body:n.invalidPostalCodeMessage}),_defineProperty(o,i.ZipCodeError,{headline:n.invalidZipCode,body:n.invalidZipCodeMessage}),_defineProperty(o,i.VATError,{headline:n.invalidVATNumber,body:n.invalidVATNumberMessage}),o);return o[e]||o[i.Unknown]}}]),e}());
"use strict";Kobo.Gizmo.LottiePlayer=function(){Kobo.Gizmo.apply(this,arguments),this.setType("LottiePlayer");var t=this,o={container:t.$gizmo.find("#"+t.settings.containerId)[0],renderer:"svg",loop:!0,autoplay:!0};t.settings.dataPath?o.path=t.settings.dataPath:o.animationData=Kobo.LottiePlayer.AnimationObject[t.settings.AnimationName],function(){bodymovin.loadAnimation(o)}()},Kobo.Gizmo.LottiePlayer.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
"use strict";Kobo.Utilities.assignToNamespace("Kobo.LottiePlayer.AnimationObject",{"red-loading-spinner":{v:"5.6.5",fr:24,ip:0,op:24,w:1e3,h:1e3,nm:"Loading loop",ddd:0,assets:[],layers:[{ddd:0,ind:1,ty:4,nm:"loading Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.667],y:[1]},o:{x:[.989],y:[0]},t:0,s:[0]},{t:24,s:[360]}],ix:10},p:{a:0,k:[500,500,0],ix:2},a:{a:0,k:[500,500,0],ix:1},s:{a:0,k:[122.2,122.2,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,-199.025]],o:[[199.025,0],[0,0]],v:[[-180.183,-180.184],[180.184,180.184]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.749019607843,0,0,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:110,ix:5},lc:1,lj:1,ml:10,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[680.183,319.816],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[96.448,96.448],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:24,st:0,bm:0}],markers:[]}});
"use strict";function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}Kobo._mediator.register("braintreeCard::validate"),Kobo._mediator.register("braintreeCard::validated"),Kobo._mediator.register("braintreeCard::refreshIframe"),Kobo._mediator.register("braintreeCard::triggerBraintreeLocalPaymentMethods"),Kobo._mediator.register("braintreeCard::startThreeDSecure"),Kobo._mediator.register("braintreeCard::reGenerateNonce"),Kobo.Utilities.assignToNamespace("Kobo.Purchasing.BraintreePayments",function(o,e){var t,a,i,n,s,d=this,c=o.isOldPP?"#FullName":"#card_username",l=$("#card-image"),u=o.isDoNotCaptureCreditCardHolderNameEnabled,b="... ...";this.saveRequestEvent=new ko.subscribable,this.isValidEvent=new ko.subscribable,this.collectDeviceDataEvent=new ko.subscribable,this.braintreeClientReadyEvent=new ko.subscribable,this.submitFormEvent=new ko.subscribable,this.teardownFormEvent=new ko.subscribable,t=e||window.braintree,Kobo._mediator.subscribe("braintreeCard::validate",function(e,t){var a=!1===u?document.querySelector(c).value:b,r={cardholderName:a};d.submitFormEvent.notifySubscribers({options:r,callback:function(e,r){e?console.error(e):(r.cardholderName=a,e=-1!==o.key.indexOf("sandbox_"),r=o.isOldPP?{creditCardToken:e?r.details.bin+"-"+r.details.lastFour+"-"+r.details.cardType+"-"+r.details.expirationMonth+"-"+r.details.expirationYear:r.nonce,lastFourCardDigits:r.details.lastFour,expiryMonth:r.details.expirationMonth,expiryYear:r.details.expirationYear,isSuccess:!0}:{payload:r,deferred:t},Kobo._mediator.fire("braintreeCard::validated",r))}})}),Kobo._mediator.subscribe("braintreeCard::reGenerateNonce",function(e,r){var t={cardholderName:!1===u?document.querySelector(c).value:b};d.submitFormEvent.notifySubscribers({options:t,callback:r.detail.onTokenizedPayloadReGenerated})}),o.triggerBraintreeLocalPayment&&Kobo._mediator.subscribe("braintreeCard::triggerBraintreeLocalPaymentMethods",function(e,t){e.preventDefault(),n.startPayment({paymentType:t.detail.type,amount:t.detail.amount,fallback:{url:DynamicConfiguration.resourceStrings.braintreeLocalPaymentMethodsFallbackUrl,buttonText:DynamicConfiguration.resourceStringse:t.detail.countryCode},onPaymentStart:function(e,r){s=e.paymentId;e={localPaymentId:e.paymentId};Kobo.$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:t.detail.urls.storeLocalPaymentIdUrl,data:JSON.stringify(e),error:function(e){Kobo._mediator.fire("PurchasePath::showErrorMessageForPurchasePath",{message:e.errorMsg})}}),y(Kobo.PurchasePath.Enums.AlternativePaymentMethod.Status.Started,t.detail.type),r()}},function(e,r){e?(y(Kobo.PurchasePath.Enums.AlternativePaymentMethod.Status.Failure,t.detail.type),"LOCAL_PAYMENT_trings.CustomerClosedLocalPaymentPopup):console.error("Error!",e)):(r={local_payment:{paT",dataType:"json",contentType:"application/json",url:t.detail.urls.localPaymentCompleteUrl,data:JSON.stringify(r),complete:function(e){Kobo.Utilities.navigateTo(e.responseJSON.RedirectUrl)}}),y(Kobo.PurchasePath.Enums.AlternativePaymentMethod.Status.Success,t.detail.type))})});function m(e){d.braintreeClientReadyEvent.notifySubscribers(e)}function y(e,r){r={type:Kobo.PurchasePath.Enums.AlternativePaymentMethod.Name,trackables:{status:e,paymentType:r}};Kobo._mediator.fire("webEventTracker::sendTrackingMessage",r)}Kobo._mediator.subscribe("braintreeCard::validated",function(e,r){r=o.isOldPP?{details:{isSuccess:r.detail.isSuccess,creditCardToken:r.detail.creditCardToken,lastFourCardDigits:r.detail.lastFourCardDigits},nonce:r.detail.creditCardToken}:{details:r.detail.payload.details,cardholderName:r.detail.payload.cardholderName,nonce:r.detail.payload.nonce,deferred:r.detail.deferred.detail};a(r)}),Kobo._mediator.subscribe("braintreeCard::refreshIframe",function(){d.teardownFormEvent.notifySubscribers()}),t.client.create({authorization:o.key},function(e,r){e?console.error(e):(t.threeDSecure.create({version:2,client:r},function(e,r){e?console.error(e):Kobo._mediator.fire("threeDSecure::setupClientInstance",{clientInstance:r,readyCallback:m})}),o.createFields&&(e=r,t.hostedFields.create({client:e,styles:o.isOldPP?Kobo.PurchasePath.BraintreeHostedFieldStyles.oldPPStyles:Kobo.PurchasePath.BraintreeHostedFieldStyles.newPPStyles,fields:(_defineProperty(e={},Kobo.PurchasePath.Enums.BraintreeHostedFields.CreditCard.Number,{selector:"#ccNum",placeholder:o.isOldPP?resources.getString("CardNumber"):""}),_defineProperty(e,Kobo.PurchasePath.Enums.BraintreeHostedFields.CreditCard.Cvv,{selector:"#ccCVV",placeholder:o.isOldPP?resources.getString("CvvToken"):""}),_defineProperty(e,Kobo.PurchasePath.Enums.BraintreeHostedFields.CreditCard.ExpirationMonth,{selector:"#expiry-date-month",select:{options:["01","02","03","04","05","06","07","08","09","10","11","12"]},placeholder:"MM",internalLabel:DynamicConfiguration.resourceStrings.expiryDateMonth}),_defineProperty(e,Kobo.PurchasePath.Enums.BraintreeHostedFields.CreditCard.ExpirationYear,{selector:"#expiry-date-year",select:!0,placeholder:"YYYY",internalLabel:DynamicConfiguration.resourceStrings.expiryDateYear}),e)},function(e,r){e?console.error(e):(r={hostedFieldsInstance:r,isValidEvent:d.isValidEvent,submitFormEvent:d.submitFormEvent,teardownFormEvent:d.teardownFormEvent,cardType:o.cardType,iconContainer:l},new Kobo.PurchasePath.Behaviors.Braintree.HandleHostedFieldEventsBehavior(r))})),o.collectDeviceData&&t.dataCollector.create({client:r,kount:!0},function(e,r){e?console.error(e):(i=r.deviceData,d.collectDeviceDataEvent.notifySubscribers(i))}),o.triggerBraintreeLocalPayment&&o.merchantAccountId&&t.localPayment.create({client:r,merchantAccountId:o.merchantAccountId},function(e,r){e?Kobo._mediator.fire("PurchasePath::showErrorMessageForPurchasePath",{message:e}):n=r}))}),a=function(e){e=o.isnce:e.nonce}:{details:e.details,cardholderName:e.cardholdeferred:e.deferred};d.saveRequestEvent.notifySubscribers(e)}});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.PurchasePath.Behaviors.Braintree.HandleHostedFieldEventsBehavior",function(e){var a,t,i,s,r,o,d,n,l,b=this;function c(){return a.getState()}function u(e){var t=e.options,e=e.callback;a.tokenize(t,e)}function m(e){a.teardown(e)}function f(e,t){(0,t.detail.formStateReadyCallback)(c())}function F(e){t.removeClass(),1===e.cards.length?t.addClass(e.cards[0].type):e.fields.number.isEmpty&&t.addClass(i)}function h(e){var t=e.emittedBy,e=e.fields[e.emittedBy].isValid;$(Kobo.PurchasePath.Enums.BraintreeFieldsElementIdMapper[t]).attr("aria-hidden",e),v(t,e)}function H(e){v(e.emittedBy,e.fields[e.emittedBy].isValid)}function v(e,t){var i;function r(t,i){d.notifySubscribers({field:t,isValid:i,setErrorMessageForScreenReader:function(e){e=e=i?"":e,a.setMessagetCard.Expiratio.fire("braintreeHostedFields::validateExpiry",{expirationMonth:t,expirationYear:i,emittedBy:e,dateValidityCallback:r}))}function p(){var t=c(),e=Object.keys(t.fields).filter(function(e){return!t.fields[e].isValid})[0];a.focus(e)}function K(){Kobo._mediator.fire("braintreeHostedFields::submitRequested")}function y(){n.dispose(),l.dispose()}b.clearHandlers=function(){Kobo._mediator.unSubscribe("braintreeHostedFields::fetchFormState",f),Kobo._mediator.unSubscribe("braintreeHostedFi),Kobo._mediator.unSubscribe("braintreeHostedFields::clearHandlers",b.clearHandlers),Kobo._mediator.unRegister("braintreeHostedFields::fetchFormState"),Kobo._mediator.unRegister("braintreeHostedFields::submittedWithInvalidFields"),Kobo._mediator.unRegister("braintreeHostedFields::clearHandlers")},b.destroy=function(){b.clearHandlers(),m(y)},s=Kobo.PurchasePath.Enums.BraintreeHostedFields,t=e.iconContainer,i=e.cardType,t.removeClass(),t.addClass(i),a=e.hostedFieldsInstance,Kobo._mediator.register("braintreeHostedFields::fetchFormState"),Kobo._mediator.subscribe("braintreeHostedFields::fetchFormState",f),Kobo._mediator.register("braintreeHostedFields::submittedWithInvalidFields"),Kobo._mediator.subscribe("braintreeHostedFields::submittedWithInvalidFields",p),Kobo._mediator.register("braintreeHostedFields::clearHandlers"),Kobo._mediator.subscribe("braintreeHostedFields:a.on("cardTypeChange",F),a.on("validityChange",h),a.on("blur",H),a.on("inputSubmitRequest",K),d=e.isValidEvent,r=e.submitFormEvent,o=e.teardownFormEvent,l=o.subscribe(function(){m(y)}),n=r.subscribe(u),Object.values(s.CreditCard).forEach(function(e){a.setAttribute({field:e,attribute:"aria-required",value:!0},function(e){e&&console.error(e)})})});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.PurchasePath.BraintreeHostedFieldStyles",{oldPPStyles:{input:{width:"91%",padding:".4em .8em","padding-top":"8px","padding-bottom":"8px","box-shadow":"none",outline:"none","line-height":"normal","font-family":'"Trebuchet MS", "Trebuchet", Arial, Helvetica, sans-serif',"font-size":"14",margin:"0","background-color":"#FFF"},"input::-ms-clear":{opacity:"0"},"input::-ms-reveal":{opacity:"0"},expirationMonth:{padding:"0 15px"},expirationYear:{padding:"0 15px"},":focus":{color:"black"},select:{padding:"0 15px","-moz-appearance":"none","-webkit-appearance":"none","font-family":'"Trebuchet MS", "Trebuchet", Arial, Helvetica, sans-serif',color:"#595959"},"select::-ms-expand":{opacity:"0"},"input::placeholder":{"background-color":"#FFF",color:"#000","font-family":'"Trebuchet MS", "Trebuchet", Arial, Helvetica, sans-serif',"font-size":"14px"}},newPPStyles:{input:{color:"black"},"input::-ms-clear":{opacity:"0"},"input::-ms-reveal":{opacity:"0"},expirationMonth:{padding:"0 15px"},expirationYear:{padding:"0 15px"},":focus":{color:"black"},select:{padding:"0 15px","-moz-appearance":"none","-webkit-appearance":"none"},"select::-ms-expand":{opacity:"0"}},hostedFieldStyles:{input:{color:"black","font-size":"16px"},"input::-ms-clear":{opacity:"0"},"input::-ms-reveal":{opacity:"0"},expirationMonth:{padding:"0 15px"},expirationYear:{padding:"0 15px"},":focus":{color:"black"},select:{padding:"0 15px","font-size":"16px","-moz-appearance":"none","-webkit-appearance":"none",color:"black"},"select::-ms-expand":{opacity:"0"}}});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.PurchasePath.ViewModels.BraintreeValidationVM",function(){this.savePaymentInfoErrorMsg=ko.observable(DynamicConfiguration.resourceStrings.genericSavePaymentInfoErrorMsg),this.creditCardInvalidMsg=ko.observable(DynamicConfiguration.resourceStrings.creditCard.creditCardInvalidMsg),this.creditCardInvalidLengthMsg=ko.observable(DynamicConfiguration.resourceStrings.creditCard.creditCardInvalidLengthMsg),this.cvvInvalidMsg=ko.observable(DynamicConfiguration.resourceStrings.creditCard.cvvInvalidMsg),this.expiryDateInvalidMsg=ko.observable(DynamicConfiguration.resourceStrings.creditCard.expiryDateInvalidMsg),this.isCreditCardValid=ko.observable(!0),this.isCVVValid=ko.observable(!0),this.isExpirationDateValid=ko.observable(!0),this.isPaymentValid=ko.observable(!1),this.showSavePaymentErrorMsg=ko.observable(!1),this.showTooltipContent=ko.observable(!1),this.isTotrict";Kobo.Utilities.assignToNamespace("Kobo.PurchasePath.Behaviors.Braintree.ValidateBraintreeFieldsBehavior",function(r){function e(e,i){var a=i.detail.validatedCallback;Kobo._mediator.fire("braintreeHostedFields::fetchFormState",{formStateReadyCallback:function(i){var e=Object.keys(i.fields).every(function(e){return i.fields[e].isValid});r.isPaymentValid(e),r.isCreditCardValid(i.fields.number.isValid),r.isExpiratelds.expirationYear.isValid),r.isCVVValid(i.fields.cvv.isValid),a(e)}})}function a.expirationYear,i=a.emittedBy;(0,a.dateValidityCallback)(i,r.isValid&&t.isValid)}function a(e,i){r.isCreditCardValid(i.detail)}function t(e,i){r.isCVVValid(i.detail)}function o(e,i){r.isExpirationDateValid(i.detail)}function s(e,i){r.savePaymentInfoErrorMsg(i.detail),r.showSavePaymentErrorMsg(!0)}function d(){r.showSavePaymentErrorMsg(!1)}this.destroy=function(){Kobo._mediator.unSubscribe("BraintreeForPurchasePath::updateCreditCardValidStatus",a),Kobo._mediator.unSubscribe("BraintreeForPurchasePath::updateCvvValidStatus",t),Kobo._mediator.unSubscribe("BraintreeForPurchasePath::updateExpiryDateValidStatus",o),Kobo._mediator.unSubscribe("BraintreeForPurchasePath::setErrorMessage",s),Kobo._mediator.unSubscribe("BraintreeForPurchasePath::hideErrorMessage",d),Kobo._mediator.unSubscribe("braintreeHostedFields::validate",e),Kobo._mediator.unRegister("braintreeHostedFields::validate")},Kobo._mediator.subscribe("BraintreeForPurchasePath::updateCreditCardValidStatus",a),Kobo._mediator.subscribe("BraintreeForPurchasePath::updateCvvValidStatus",t),Kobo._mediator.subscribe("BraintreeForPurchasePath::updateExpiryDateValidStatus",o),Kobo._mediator.subscribe("BraintreeForPurchasePath::setErrorMessage",s),Kobo._mediator.subscribe("BraintreeForPurchasePath::hideErrorMessage",d),Kobo._mediator.register("braintreeHostedFields::validate"),Kobo._mediator.subscribe("braintreeHostedFields::validate",e),Kobo._mediator.register("braintreeHostedFields::validateExpiry"),Kobo._mediator.subscribe("braintreeHostedFields::validateExpiry",i)});
"use strict";function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Kobo.Utilitiesavior",function(y){var f,p,d;function e(e,t){var r=t.detail,t=r.clientInstance,r=r.readyCallback;t.on("authentication-modal-render",a),t.on("customer-canceled",n),t.on("lookup-complete",o),r({clientInstance:d=t})}function n(){f=!0,r(p.ChallengeStatus.ChallengeCanceled)}function a(){r(p.ChallengeStatus.ChallengeStarted)}function o(e,t){t()}function t(e,t){var r=t.detail,n=r.amount,a=r.nonce,o=r.bin,i=r.paymentType,c=r.successCallback,s=r.errorCallback,u=r.canceledCallback,l=r.captchaToken,b=r.verifyAction,h=r.verifyCaller;(t.detail.threeDSecureInstance||d).verifyCard({amount:n,nonce:a,bin:o},function(e,t){if(e)throw e.ErrorMessage=resources.getString("threeDSecureFrontError"),s(e),e;if(f)return f=!1,void u();var r=function(e){var t=null!=e.rawCardinalSDKVerificationData;t=e.threeDSecureInfo.liabilityShifted?t?p.ChallengeStatus.ChallengeSuccess:p.ChallengeStatus.NoChallengeSuccess:t?p.ChallengeStatus.ChallengeFailure:p.ChallengeStatus.NoChallengeFailure;return t}(t),e=t.nonce,t=t.binData.issuingBank;!function(e){e=_objectSpread(_objectSpread({},e),{},{paymentType:Kobo.PurchasePath.Enums.ConvertPaymentTypeToServer(e.paymentType)});return Kobo.$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:y.recordVerifyCardMetricsUrl,headers:{__RequestVerificationToken:Kobo.Utilities.getAntiForgeryToken()},data:JSON.stringify(e)})}({paymentType:i,challengeStatus:r,issuingBank:t,verifyAction:b,verifyCaller:h}).catch(console.error),c({challengeStatus:r,issuingBank:t,nonce:e,captchaToken:l})})}function r(e){e={type:p.Name,trackables:{challengeStatus:e}};Kobo._mediator.fire("webEventTracker::sendTrackingMessage",e)}this.destroy=function(){Kobo._mediator.unSubscribe("threeDSecure::setupClientInstance",e),Kobo._mediator.unRegister("threeDSecure::setupClientInstance"),Kobo._mediator.unSubscribe("threeDSecure::verifyCard",t),Kobo._mediator.unRegister("threeDSecure::verifyCard")},f=!1,p=Kobo.PurchasePath.Enums.ThreeDSecure,Kobo._mediator.register("threeDSecure::setupClientInstance"),Kobo._mediator.subscribe("threeDSecure::setupClientInstance",e),Kobo._mediator.register("threeDSecure::verifyCard"),Kobo._mediator.subscribe("threeDSecure::verifyCard",t)});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.RAT.BrowserDetailsHelper",function(){this.browserWidth=function(){var t=void 0!==window.innerWidth?window.innerWidth:(void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?document.documentElement:document.getElementsByTagName("body")[0]).clientWidth;return t},this.getPageLayout=function(){var t=this.browserWidth();return t.toString().match(/^([0-4][0-9][0-9]|5[0-5][0-9]|56[0-8])$/g)?"SP":t.toString().match(/^(569|5[7-9][0-9]|[6-7][0-9][0-9]|8[0-7][0-9]|880)$/g)?"TB":"PC"}});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.RAT.CheckoutHelper",function(){this.pageHelper=new Kobo.RAT.PageHelper,this.getItemIds=function(t){for(var e=[],r=t,o=0;o<r.length;o++)e.push(r[o].Id.replace(/(['])/g,"$1"));return"["+e.join(", ")+"]"},this.getItemCount=function(t){for(var e=[],r=t,o=0;o<r.length;o++)e.push("1");return e.join(", ")},this.getItemPrices=function(t){for(var e=[],r=t,o=$("#ratCountryCode")[0].value,i=0;i<r.length;i++){var n=r[i].PriceDetails[0].Amount;"IN"===o&&(n=n.replace("RS.","")),e.push(this.pageHelper.convertToNumber(n.replace(/[^0-9.,-]+/g,"").trim()))}return e.join(", ")},this.getTotalPrice=function(){var t=document.querySelector(".regular-checkout"),e=ko.dataFor(t),t=$("#ratCountryCode")[0].value,e=e.paymentSummaryVM().priceSummaryVM.total().value;return"IN"===t&&(e=e.replace("RS.","")),this.pageHelper.convertToNumber(e.replace(/[^0-9.,-]+/g,""))},this.getShoppingCartProductIds=function(){for(var t=Kobo._gizmo.gizmoList.ShoppingCartItems[0].shoppingCartList.items(),e=[],r=0;r<t.length;r++)e.push(t[r].id);return e},this.getShoppingCartQtyArray=function(){for(var t=Kobo._gizmo.gizmoList.ShoppingCartItems[0].shoppingCartList.items(),e=[],r=0;r<t.length;r++)e.push(1);return e},this.getShoppingCartType=function(){return 1===Kobo._gizmo.gizmoList.ShoppingCartItems[0].shoppingCartList.CartList.items(),e=[],r=/([0-9,]+(\.[0-9]+)?)/g,o=0;o<t.length;o++){var i=r.exec(t[o].priceDetails()[0].amount.trim());r.lastIndex=0,e.push(this.pageHelper.convertToNumber(i[0]))}return e}});
"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototypee?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],s=!0,u=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){u=!0,a=e}finally{try{s||null==r.return||r.return()}finally{if(u)throw a}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}Kobo.Utilities.assignToNamespace("Kobo.RAT.PageHelper",function(){var a=this;this.getPageLanguageFilter=function(){var e=new URL(window.location.href);return new URLSearchParams(e.search).get("fclanguages")},this.getRequestId=function(){var e=Kobo.$("#ratRequestId"),t=null;return t=null!=e&&0<e.length&&"0"!==e[0].value?e[0].value:t},this.getLanguageLocale=function(){var e=$("#ratCountryCode")[0].value;return"IN"===e||"CA"===e||"ZA"===e||"SI"===e||"SE"===e?e="en-"+e:"AT"===e||"LU"===e?e="de-"+e:"CY"===e||"GR"===e?e="el-"+e:"DK"===e?e="da-"+e:"EE"===e?e="et-"+e:"BR"===e?e="pt-"+e:"WW"===e&&(e="en-CA"),e},this.convertToNumber=function(e){var t=a.getLanguageLocale(),t=new Intl.NumberFormat(t).format,t=_slicedToArray(/^0(.)1$/.exec(t(.1)),2)[1];return+e.replace(new RegExp("[^".concat(t,"\\d]"),"g"),"").replace(t,".")},this.getSearchPageNumber=function(){return-1<window.location.href.indexOf("pageNumber=")?parseInt(window.location.href.split("&pageNumber=")[1].split("&")[0]):null!==document.querySelector(".pagination .page-link.active")?parseInt(document.querySelector(".pagination .page-link.active").innerText):1},this.getSearchProductIdList=function(){var t=[];return document.querySelectorAll(".item-wrapper:not(#sponsored-ad)").forEach(function(e){t.push(JSON.parse(e.dataset.trackInfo).productId)}),t.join(",")},this.getSearchPriceList=function(){var r=[],n=/([0-9,]+(\.[0-9]+)?)/g;return document.querySelectorAll(".item-wrapper:not(#sponsored-ad) .item-detail .price").forEach(function(e){var t=e.querySelector("span span span span:not(.currency)");e.classList.contains("free")||null===t?r.push(0):(e=n.exec(e.querySelector("span span span span:not(.currency)").innerText.trim().replace(/\s/g,"")),n.lastIndex=0,e=parseFloat(a.convertToNumber(e[0])),r.push(e))}),r.join(",")},this.getTotalSearchResults=function(){var e=document.querySelectorAll(".search-results-summary .show-page-numbers .figures");return 3===e.length?parseInt(e[2].innerText):0<document.querySelectorAll(".search-results-summary .summary .figures:nth-of-type(3)").length?parseInt(document.querySelectorAll(".search-results-summary .summary .figures:nth-of-type(3)")[0].innerText):0<document.querySelectorAll(".search-results-summary .summary-page-numbers .figures:nth-of-type(3)").length?parseInt(document.querySelectorAll(".search-results-summary .summary-page-numbers .figures:nth-of-type(3)")[0].innerText):0},this.getSearchSortBy=function(){if(!(-1<window.location.href.indexOf("sort=")))return 1;switch(window.location.href.split("sort=")[1].split("&")[0].toLowerCase()){case"temperature":return 1;case"priceasc":return 2;case"pricedesc":return 3;case"publicationdatedesc":return 4;case"averagerating":return 5;case"publicationdateasc":return 6;case"titleasc":return 7;case"titledesc":return 8;default:return 1}},this.getSubCategoryTotalResults=function(){return document.querySelector('.facet-list[data-field-name="fcCategories"] .facet-list-view-widget[data-field-selected="True"] a em').innerText.replace(/[()]/g,"").trim()},this.getOtherPageName=function(){var e=window.location.pathname;switch(!0){case/..\/..\/library/.test(e):return"library";case/(\/ebooks((\?|#)(.*))?|\/ebooks\/((\?|#)(.*))?)$/.test(e):return"ebooks";case/(\/audiobooks((\?|#)(.*))?|\/audiobooks\/((\?|#)(.*))?)$/.test(e):return"audiobooks";case/..\/..\/ebooks\/[^?][a-zA-Z]*/.test(e):return"ebooks/"+e.split("ebooks/")[1];case/..\/..\/audiobooks\/[^?][a-zA-Z]*/.test(e):return"audiobooks/"+e.split("audiobooks/")[1];default:return null}},this.getPageName=function(){var e=window.location.href,t=window.location.hostname;switch(!0){case new RegExp("(.*"+t+"(/|/../..|/../../)?$)","g").test(e):return"home";case new RegExp("(.*"+t+"(/|/../../audiobook.*|#.*)?$)","g").test(e):return"item";case new RegExp("(.*"+t+"(/|/../../audiobooks.*|#.*)?$)","g").test(e):return"category";case new RegExp("(.*"+t+"(/|/../../ebook.*|#.*)?$)","g").test(e):returnfunction(){this.getCookie=f(2===e.length)return e.pop().split(";").shift()},this.getParameterByName=function(e,i){i=i||window.location.href,e=e.replace(/[[\]]/g,"\\$&");i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(i);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},this.getPermissionsCookie=function(){return this.getCookie("PrivacyPermissions")}});
"use strict";Kobo.Utilities.assignToNamespace("Kobo.RAT.RatTagHelper",function(){this.checkoutHelper=new Kobo.RAT.CheckoutHelper,this.pageHelper=new Kobo.RAT.PageHelper,this.itemScript=function(t,e){var n=t,a="success";return"add"===t&&(n=this.checkoutHelper.getShoppingCartType()),"already"===t&&(n=this.checkoutHelper.getShoppingCartType(),a="already"),"<script>(function () {if (window.RAT && typeof RAT.addCustomEvent == 'function') {var eventData = { };eventData.accountId = 1055;eventData.serviceId = 1;eventData.eventType = 'click';eventData.pData = {'pgt': 'cart_modify','pgn': '"+this.pageHelper.getPageName()+"','country': '"+e.storeFront+"','cycode': '"+e.currency+"','lang': '"+e.language+"','itemid': '"+thitry': '").concat(t.storeFront,"',\n                'cycode': '").concat(t.currency,"',\n                'lang': '").concat(t.language,"',\n                'itemid': ['").concat(t.itemId,"'],\n            };\n            eventData.options = ['url', 'ua', 'ref'];\n            RAT.addCustomEvent(eventData);\n        }\n    })();\n<\/script>")}});
"use strict";Kobo.Gizmo.RakutenTracking=function(c,l){var t=[];function a(){var e=$(".regular-checkout"),e=ko.dataFor(e[0]);return e?(t=e.shoppingCartVM().cartItems(),e.stageSelectionVM().currentStage()):""}function d(){var e;"review"===a()&&"30"!==$("#ratCheckout").prop("defaultValue")&&(e=new Kobo.RAT.CheckoutHelper,Kobo.$("#ratCheckout")[0].value="30",Kobo.$("#ratItemId")[0].value=e.getItemIds(t),Kobo.$("#ratItemPrice")[0].value=e.getItemPrices(t),Kobo.$("#ratItemCount")[0].value=e.getItemCount(t),$(c).append('<input type="hidden" name="rat" id="ratTotalPrice" value="'+e.getTotalPrice()+'">'),Kobo.$("#ratPageName")[0].value="review")}function p(){var e;"payment"===a()&&"40"!==$("#ratCheckout").prop("defaultValue")&&(e=new Kobo.RAT.CheckoutHelper,Kobo.$("#ratCheckout")[0].value="40",Kobo.$("#ratPageName")[0].value="payment",Kobo.$("#ratItemId")[0].value=e.getItemIds(t),Kobo.$("#ratItemPrice")[0].value=e.getItemPrices(t),Kobo.$("#ratItemCount")[0].value=e.getItemt.location.href.match(/(\/search\?.*query=)/gi)}function g(){return!!document.location.href.match(/(\/search\?.*thema=)/gi)}function b(){return!!document.location.pathname.match(/(\/[a-zA-Z]{2}\/[a-zA-Z]{2}\/author\/|^\/author\/)/g)}function h(){return!!document.location.pathname.match(/(\/[a-zA-Z]{2}\/[a-zA-Z]{2}\/series\/|^\/series\/)/g)}function f(e,t,a){return-1!==e.indexOf("/itemdetailprimarymetadatawidget/addtolibraryundersubscription")&&200===t&&"success"===a.result}function K(e,t,a){var o=Kobo.$(".pricing-title").attr("data-book-state");return-1!==e.indexOf("/ebook/AddToLibrary/")&&"Free"===o&&200===t&&"success"===a.result}function v(e,t,a){return-1!==e.indexOf("/checkout/redeemcredit")&&200===t&&5===a.ResponseCode}function S(e,t,a){return-1!==e.indexOf("/product/addtowishlist")&&200===t&&"success"===a.result}function y(e,t,a,o){var r=Kobo.$("#ratItemId")[0].value,a=f(e=e,t=t,a=a)?"library/koboplus":v(e,t,a)?"library/audiobook":K(e,t,a)?"library/free":S(e,t,a)?"library/wishlist":null;return{itemId:r,storeFront:o.storeFront,currency:o.currency,language:o.language,pageName:a}}!function(){if(l.featureEnabled&&l.CheckStoreFront){var o=new Kobo.RAT.RatTagHelper;$(document).ajaxComplete(function(e,t,a){-1!==a.url.indexOf("shoppingcartwidget/remove")&&200===t.status&&Kobo.$(c).prepend(o.itemScript("remove",l)),-1!==a.url.indexOf("shoppingcartwidget/add")&&200===t.status&&(t.responseJSON.IsSuccess?Kobo.$(c).prepend(o.itemScript("add",l)):Kobo.$(c).prepend(o.itemScript("already",l))),(f(a.url,t.status,t.responseJSON)||K(a.url,t.status,t.responseJSON)||v(a.url,t.status,t.responseJSON)||S(a.url,t.status,t.responseJSON))&&(t=y(a.url,t.status,t.responseJSON,l),Kobo.$(c).prepend(o.itemDetailScript(t))),p(),d()}),$(document).ready(function(){p(),d(),(m()||g()||b()||h())&&$(c).append('<script>    (function () {      document.querySelectorAll(\'.item-wrapper\').forEach(function (el) {      var _productId = JSON.parse(el.dataset.trackInfo).pr;         el.setAttribute("data-ratid", _productId);     }); }) (); <\/script>'),0<$(c).has('script[src$="//r.r10s.jp/com/rat/js/rat-main.js"]').length||$(c).append('<script type="text/javascript" src="//r.r10s.jp/com/rat/js/rat-main.js"><\/script>')}),document.cookie.split(";").filter(function(e){return 0===e.trim().indexOf("_mall_uuid=")}).length||(u=Math.random().toString(36).substr(2,20)+"-"+Math.random().toString(36).substr(2,20)+"-"+Math.random().toString(36).substr(2,20),(r=new Date).setTime(r.getTime()+922752e5),s=r.toUTCString(),document.cookie="_mall_uuid="+u+";expires="+s+";path=/"),0<Kobo.$("#ratPageLayout").length&&(n=new Kobo.RAT.BrowserDetailsHelper,Kobo.$("#ratPageLayout")[0].value=n.getPageLayout());var e=new Kobo.RAT.PageHelper,t=m(),a=g(),r=b(),u=h(),n=(s=document.location.href.match(/(\/[a-zA-Z]{2}\/[a-zA-Z]{2}\/ebooks\/|\/[a-zA-Z]{2}\/[a-zA-Z]{2}\/audiobooks\/)/g),!!(Kobo.$body&&s&&Kobo.$body.hasClass("Store-Browse-SubCategory")));if(t||n||a||r||u){Kobo.$("#ratItemId")[0].value=e.getSearchProductIdList(),Kobo.$("#ratPrice")[0].value=e.getSearchPriceList();var s=["{"];t&&(i=e.getTotalSearchResults(),Kobo.$("#ratPageName")[0].value="search"),a&&(i=e.getTotalSearchResults(),Kobo.$("#ratPageName")[0].value="thema"),r&&(i=e.getTotalSearchResults(),Kobo.$("#ratPageName")[0].value="author"),u&&(i=e.getTotalSearchResults(),Kobo.$("#ratPageName")[0].value="series"),n&&(i=e.getSubCategoryTotalResults(),Kobo.$("#ratPageName")[0].value=e.getOtherPageName()),s.push('"totalresults":'+i),s.push(',"hits":12,"sort":'+e.getSearchSortBy()),s.push(',"rpgn":'+e.getSearchPageNumber());var i=e.getRequestId();null!==i&&s.push(',"queryId":"'+i+'"');i=e.getPageLanguageFilter();return null!=i&&s.push(',"filteredLang":"'+i+'"'),s.push("}"),Kobo.$("#ratCustomParameters")[0].value=s.join("")}!function(){var e=window.location.pathname;if(Kobo.$body&&0<$('body[class*="Store-Browse-CategoryStore"]').length)switch(!0){case/\/[a-zA-Z]{2}\/[a-zA-Z]{2}\/ebooks\//.test(e):case/\/[a-zA-Z]{2}\/[a-zA-Z]{2}\/audiobooks\//.test(e):return 1;default:return}return/\/library/.test(e)||(/(\/[a-zA-Z]{2}\/[a-zA-Z]{2oid 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Kobo.Gizmo.FeaturedListCarousel=function(e,t){Kobo.Gizmo.apply(this,arguments),this.setType("FeaturedListCarousel");var r,o,n,i,a,s=Kobo.$.extend({isNavigationButtonsEnabled:!1,navButtonScrollSpeed:400},t),c=Kobo.$(e),l=".button-container",utical-buffer, .cta-vertical-buffer",b=c.find(".next"),d=c.find(".previous"),y=c.find(".card-container"),p=c.find(".carousel-items"),g=!1,h=3,v=p.find("a, button"),m=c.find(".primary-heading").text().trim(),w=null,A=null;function K(e){var t=e.closest(l),r=e.closest(u),e=r.find(f),r=r.height(),o=0;e.each(function(){o+=$(this).outerHeight(!0)});r-=o;t.css("height",r+"px")}!function(){for(var e=y,t=[{r:0,g:101,b:189},{r:0,g:191,b:224},{r:99,g:29,b:118},{r:191,g:34,b:150},{r:0,g:98,b:101},{r:0,g:178,b:169},{r:210,g:73,b:42},{r:255,g:109,b:34},{r:145,g:0,b:75},{r:198,g:1:95},{r:105,g:190,b:40},{r:99,g:29,b:118},{r:164,g:77,b:196}],r=0;r<e.length;r++){var o=t[Math.floor(Math.random()*t.length)];e[r].querySelector(".featuredin-book-covers").style.backgroundColor="rgb(".concat(o.r,",").concat(o.g,",").concat(o.b,", 0.1)")}}(),b.on("keypress click",function(e){O(e,S)}),d.on("keypress click",function(e){O(e,E)}),k(),r=Kobo.Utilities.Events.debounce(k,50),p.on("scroll",r),o=Kobo.Utilities.Events.debounce(k,200),Kobo.$window.on("resize",o),s.isNavigationButtonsEnabled&&!1===Modernizr.flexbox&&(K(d),K(b)),i=p[0],w=new IntersectionObserver(function(e){[].slice.call(e).forEach(function(e){e.isIntersecting&&.9<e.intersectionRatio?(e.target.setAttribute("aria-hidden",!1),e.target.setAttribute("tabindex",0)):(e.target.setAttribute("aria-hidden",!0),e.target.setAttribute("tabindex",-1))})},_objectSpread(_objectSpread({},{rootMargin:"0px",threshold:.9}),{},{root:i})),A=new IntersectionObserver(function(e){e.forEach(function(e){var t;e.isIntersecting&&.8<=e.intersectionRatio&&(a=Date.now(),t=e.target,setTimeout(function(){var e;2e3<=Date.now()-a&&(e=new CustomEvent("impression",{bubbles:!0,detail:{event:"impression",carouselName:m}}),t.dispatchEvent(e)v.toArray().forEach(function(e){w.observe(e)}),A.observe(p[0]),s.isAutoMarginsEnabled&&(x(),n=Kobo.Utilities.Events.debounce(x,200),Kobo.$window.on("resize",n)),this.destroy=d.off("click",E),p.off("scroll",r),Kobo.$window.off("resize",o),Kobo.$window.off("resize",n),v.toArray().forEach(function(e){w.unobserve(e)}),A.unobserve(p[0])};var O=function(e,t){"click"!==e.type&&("keypress"!==e.type||e.keyCode!=Kobo.KeyCodes.RETURN&&e.keyCode!=Kobo.KeyCodes.SPACE)||t()};function S(){_("next")}function E(){_("previous")}function _(e){if(!g){var t=j();if(t.length){var r,o=t.length,t=t.eq(0),t=y.index(t);if("next"===e)r=Math.min(t+o,y.length-1);else{if("previous"!==e)throw nee.outerWidth(!0)-e.width();p.animate({scrollLeft:p.scrollLeft()+e-h},{duration:s.navButtonScrollSpeed,always:function(ConsumableArray(Kobo.Utilities.findAllFocusableElements(p)).filter(function(e){return"false"===e.ariaHidden&&e.classList.contains("carousel-tab-navigation-target")}),"next"===e?t[0].focus():"previous"===e&&t[t.length-1].focus()}})}(y.eq(r),e)}}}function j(){var e=y.toArray().filter(function(e){return e.querySelector("a[aria-hidden=false]")});return $(e)}function k(){var e=0<p.scrollLeft();d.prop("disabled",!e);e=p.scrollLeft()+p.innerWidth()<p[0].scrollWidth;b.prop("disabled",!e)}function x(){p.scrollLeft(0);var e=y.slice(1);e.css("marginLeft","");var t,r,o=j();o.length&&(t=o.eq(o.length-1),(r=y.index(t)+1)>=y.length?k():(r=y.eq(r),r=p.width()-r.position().left,o=o.length-1,o=t.outerWidth(!0)-t.width()+Math.ceil(r/o),e.css("marginLeft",o+"px")))}},Kobo.Gizmo.FeaturedListCarousel.prototype=Kobo.chainPrototype(Kobo.Gizmo.prototype);
//# sourceMappingURL=maps/kobo.gizmo-core.min.js.map
