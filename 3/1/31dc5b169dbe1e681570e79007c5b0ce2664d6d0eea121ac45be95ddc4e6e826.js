(self.webpackChunk=self.webpackChunk||[]).push([["CommentBox"],{"./components/articleshow/CommentBox.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:);var o=n("../node_modules/fetch-jsonp/build/fetch-jsonp.js"),a=n.n(o),r=n("../node_modules/prop-types/index.js"),s=n.n(r),c=n("../node_modules/react/index.js"),m=n("../node_modules/react-dom/index.js"),i=n("../node_modules/react-redux/es/index.js"),l=n("./utils/fetch/fetch.js"),u=n("./utils/util.js"),d=n("./components/common/AdCard.js"),p=n("./components/common/ImageCard/ImageCard.js"),f=n("./components/common/SvgIcon.js"),y=n("./components/common/ssoLogin.js");ents/articleshow/commentBox.scss");var N=(0,u.pR)(),S=function(e){function t(e){var n;return this,t),j(x(n=_(this,t,[e])),"fetchComments",(function(e,t){var o,a=Object.assign({},N.Comments.allComments);a.size=10,a.pagenum=t,(0,l.ZP)("".concat(process.env.API_BASEPOINT,"/commentsdata.cms?").concat((o=a,o&&"object"===v(o)&&o.constructor===Object?Object.keys(o).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(o[e]))})).join("&"):""),"&msid=").concat(e)).then((function(e){if(e&&0==e.length)n.setState({totalComments:"no comment"});else{var o=g(e);o.shift();var a=n.getAllComments(o,[]);n.setState((function(n){return{commentsData:e,pageno:t,totalComments:[].concat(g(n.totalComments),g(a))}}))}})).catch(()})),j(x(n),"onExpand",(),j(x(n),"onChange",(function(e,t){t.target.value&&t.target.value.trim()&&(e?O(e,".status-message").innerText="":document.querySelector("#parent-form-msg").innerText="")})),j(x(n),"formSubmitHandler",(function(e){e.preventDefault(),console.log("thisss",n.props);var t=n.props,o=t.msid,a=t.authentication,r=a&&a.userData,s=e.target.comment.value;(s=s&&s.trim())?r?(document.querySelector("#parent-form-msg").innerText="",n.postComment({userComment:s,userInfo:r,msid:o})):n.loginClick():document.querySelector("#parent-form-msg").innerText="Please enter your comment"})),j(x(n),"replyFormSubmitHandler",(function(e,t){t.preventDefault();var o=n.props,a=o.authentication,r=o.msid,s=a&&a.userData,c=t.target.comment.value;c=c&&c.trim(),O(e,".status-message").classList.remove("sucussmsg"),c?s?(O(e,".status-message").innerText="",n.postComment({userComment:c,userInfo:s,parentId:e,msid:r})):n.loginClick():O(e,".status-message").innerText="Please enter your comment"})),j(x(n),"closeCommentBox",(function(e){O(e,".form-area").style.display="none",O(e,".reply").style.display="block"})),j(x(n),"userActionOnOffensiveForm",(function(e,t,o){var a=n.props,r=a.authentication,s=a.msid,c=r&&r.userData;if("close"!=t)if("other"!=t)if("submit"==t&&c&&c.uid==o)O(e,".error").innerText="You can't mark your own comment offensive";else if(c){var m=O(e,".flag_comment_box input[name='radiotype']:checked"),i=m&&m.value;if("Others"==i&&(i=(i=O(e,".offensive_popup_reason").value).trim()),i){var d={ofusername:c.FL_N,ofreason:i,ofcommenteroid:e,ofcommenthostid:N.hostid,ofcommentchannelid:N.siteid,ofcommentid:s,ofuserisloggedin:1,ofuserssoid:c.EMAIL,ofuseremail:c.EMAIL,medium:"WAP"};(0,l.ZP)("".concat(process.env.WEBSITE_URL,"ratecomment_new.cms?rateid=0&opinionid=").concat(e,"&typeid=103")),(0,l.ZP)("".concat(process.env.WEBSITE_URL,"offensive/mark?").concat(T(d))).then((function(t){(0,u.sh)("votec_".concat(e),"".concat(e,":flagged"),30),O(e,".error").innerText="",O(e,".flag_comment_box .reasons").style.display="none",O(e,".flag_comment_box .submit").style.display="none",O(e,".flag_comment_box h6").style.display="none",O(e,".success-message").innerText="Your objection has been sent to moderator"}))}else O(e,".error").innerText="Please select reason"}else n.loginClick();else O(e,".offensive_popup_reason").style.display="block";else O(e,".flag_comment_box").style.display="none"})),j(x(n),"userActionOnComment",(function(e,t,o){var r=n.props,s=r.authentication,c=(r.msid,s&&s.userData);if(c&&c.uid==o)O(e,".status-message").innerText="You Can't react on your own comment";else if("reply"==t||"offensive"==t||c){if("reply"!=t&&!n.validateAction(e,t))return;if("reply"==t)O(e,".form-area").style.display="block",O(e,".reply").style.display="none";else if("agree"==t||"disagree"==t){var m="agree"==t?"Agreed":"Disagreed",i={appKey:N.Comments.appkey,parentCommentId:e,activityType:m,baseEntityType:"ARTICLE",objectType:"A",url:"".concat(process.env.WEBSITE_URL.slice(0,-1)).concat(document.location.pathname)},d="agree"==t?"100":"101";if("agree"==t){var p=O(e,".comment-agree"),f=parseInt(p.innerText);p.innerText=f+1}else if("disagree"==t){var y=O(e,".comment-disagree"),g=parseInt(y.innerText);y.innerText=g+1}(0,l.ZP)("".concat(process.env.WEBSITE_URL,"ratecomment_new.cms?rateid=0&opinionid=").concat(e,"&typeid=").concat(d));var b="https://myt.indiatimes.com/mytimes/addActivity?".concat(T(i));a()(b).then(().then((function(){(0,u.sh)("votec_".concat(e),"".concat(e,":").concat(t),30)})).catch(()}else if("offensive"==t){var v=O(e,".comment-disagree"),h=parseInt(v.innerText);v.innerText=h+1,O(e,".flag_comment_box").style.display="block"}}else n.loginClick()})),j(x(n),"loadMoreComments",(function(e){var t=n.state.pageno;console.log("Load more.."),n.fetchComments(e,t+1)})),j(x(n),"loginClick",(),n.state={IsExpanded:!1,commentsData:null,totalComments:[],pageno:1,commentposted:!1,isRepliedCliked:!1},n}var n,o;return t,e),n=t,(o=[{key:"userLoginSuccess",value:,{key:"componentDidMount",value:function(){var e=this.props.msid,t=this.state.pageno;("undefined"==typeof document||v(document))&&document.addEventListener("user_comment",this.userLoginSuccess),this.fetchComments(e,t)}},{key:"componentDidUpdate",value:function(e){var t=this.props.showCommentsPopup,n=document.querySelector("body");!e.showCommentsPopup&&t?n.classList.add("disable-scroll"):e.showCommentsPopup&&!t&&n.classList.remove("disable-scroll")}},{key:"postComment",value:function(e){var t=this,n=e.userComment,o=e.userInfo,a=e.parentId,r=e.msid,s={fromname:o.FL_N,fromaddress:o.EMAIL,userid:o.uid,loggedstatus:1,message:n,roaltdetails:1,ArticleID:r,article_id:r,msid:r,rchid:N.siteid,langid:2,medium:"WAP",imageurl:o.thumb,parentid:a||0,rootid:0,pcode:N.sso.SSO_CHANNEL,rotype:3},c={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"post",data:T(s)};(0,l.ZP)("".concat(process.env.WEBSITE_URL,"/pwafeeds/postro.cms"),c).then((function(e){t.setState({commentposted:!0}),a?(O(a,".status-message").innerHTML="Your comment has been successfully submitted",O(a,".status-message").style.display="block",O(a,".status-message").classList.add("sucussmsg"),t.closeCommentBox(a)):document.querySelector("#comment").value=""})).catch(()}},{key:"validateAction",value:function(e,t){var n=(0,u.CD)("votec_".concat(e));if(n){n=n.split(":")[1];var o=O(e,".status-message");if("agree"==n&&"agree"==t)o.innerText="You have already agreed this";else if("disagree"==n&&"disagree"==t)o.innerText="You have already disagreed this";else if("agree"==n&&"disagree"==t||"disagree"==n&&"agree"==t)o.innerText="You Can't mark the same review agree and disagree";else if("agree"==n&&"offensive"==t)o.innerText="You Can't mark the same review agree and then offensive";else{if("flagged"!=n)return!0;o.innerText="You have already Flagged this"}return!1}return!0}},{key:"getAllComments",value:function(e,t){var n=this;if(Array.isArray(e)&&e.length>0)return e.forEach((function(e){t.push(e),e.CHILD&&Array.isArray(e.CHILD)&&n.getAllComments(e.CHILD,t)})),t}},{key:"render",value:function(){var e=this,t=this.state,n=t.commentsData,o=t.pageno,a=t.commentposted,r=(t.isRepliedCliked,t.totalComments),s=this.props,i=s.closeCommentsBox,l=s.msid,y=s.authentication,g=s.headline,b=s.hideAd,v=y&&y.loggedIn,h=y&&y.userData&&y.userData.F_N,_=y&&y.userData&&y.userData.thumb,E="",C="";a&&(E="Your comment has been successfully submitted",C="sucussmsg");var x=0;n&&Array.isArray(n)&&n.length>0&&(x=parseInt(n[0].totalcount));var I=x>10*o;return(0,u.G9)()?m.createPortal(c.createElement("div",{className:"commentsWap"},c.createElement("div",{className:"comments-body"},c.createElement("div",{className:"container"},c.createElement("div",{className:"bottom-comments-btns"},c.createElement("div",{className:"cmntheading"},c.createElement("span",{className:"closebutton",onClick:i}),c.createElement("div",{className:"headofcmnt"},0!=x?c.createElement("h3",null,c.createElement("b",null,"Comments(",x,")")):"",c.createElement("h2",{className:"text_ellipsis"},g)))),c.createElement("span",{className:C,id:"parent-form-msg"},E),h&&c.createElement("div",{className:"user-info"},c.createElement("img",{width:"22",height:"22",src:_,alt:"userName",title:"userName"}),c.createElement("span",{className:"name"}," ",h)),c.createElement("form",{onSubmit:this.formSubmitHandler},c.createElement("textarea",{className:"commentbox",placeholder:"Write Comment",name:"comment",id:"comment",onChange:this.onChange.bind(this,"")}),c.createElement("div",{className:"actions"},c.createElement("button",{type:"submit"},v?"Submit":"Login to Comment")))),"no comment"==r&&c.createElement("div",{className:"no-comment-text"},"Be the first one to review"),!b&&c.createElement("div",null,c.createElement(d.Z,{mstype:"mrec1",adtype:"dfp"})),c.createElement("div",{className:"comments-wrapper",role:"button",tabIndex:0},r&&Array.isArray(r)&&r.length>0?c.createElement("div",{className:"bottom-comments-popup"},r.map((function(t){var n=[];null!=t.C_R_EROID&&n.push("color-gray"),t&&t.C_A_ID&&n.push("authorComment");var o=t.user_detail&&t.user_detail.uid;return c.createElement("div",{className:"comment-box ".concat(n.join(" ")),key:t.C_T},c.createElement("div",{className:"user-thumbnail"},c.createElement(p.Z,{type:"absoluteImgSrc",src:t.user_detail&&t.user_detail.thumb||"".concat(process.env.WEBSITE_URL,"/photo/11834507.cms"),className:"bg_poster"}),c.createElement("a",{to:t.A_ID?"".concat(N.sso.PROFILE_URL,"/").concat(t.A_ID):"",className:"name",target:"_blank"},t.user_detail&&t.user_detail.FL_N?t.user_detail.FL_N:t.A_D_N),c.createElement("span",{className:"commented-at"},t.C_D)),c.createElement("p",{className:"short_comment",dangerouslySetInnerHTML:{__html:t.C_T}}),c.createElement("div",{className:"footbar clearfix",id:"comment_block_".concat(t._id)},c.createElement("div",{className:"status-message"}),c.createElement("div",{className:"cmt_actionbar"},c.createElement("div",{id:"comment_form_".concat(t._id),style:{display:"none"},className:"form-area replybox"},c.createElement("form",{onSubmit:e.replyFormSubmitHandler.bind(e,t._id),name:"comment_form_".concat(t._id)},c.createElement("textarea",{className:"commentbox",placeholder:"Write Comment",name:"comment",onChange:e.onChange.bind(e,t._id)}),c.createElement("div",{className:"actions"},v?c.createElement("button",{type:"submit"},"Submit"):c.createElement("button",{type:"submit"},"Login to Comment"))),c.createElement("span",{className:"closebutton",onClick:)),c.createElement("span",{"commentsdata-action":"comment-reply",onClick:function(){return e.userActionOnComment(t._id,"reply",o)},className:"reply"},"reply"),c.createElement("span",{onClick:function(){return e.userActionOnComment(t._id,"agree",o)},className:"comment-agree",title:"Agreed"},c.createElement(f.Z,{name:"thumbsup",className:"thumbsup"})," ",t.AC_A_C),c.createElement("span",{onClick:function(){return e.userActionOnComment(t._id,"disagree",o)},className:"comment-disagree",title:"DisAgreed"},c.createElement(f.Z,{name:"thumbsup",className:"thumbsdown"})," ",t.AC_D_C),c.createElement("span",{onClick:className:"offensive comment-offensive",title:"Offensive"},"offensive"),c.createElement(k,{commentId:t._id,userActionOnOffensiveForm:e.userActionOnOffensiveForm,closeOffensivePopup:e.userActionOnOffensiveForm,offensiveOtherClick:e.userActionOnOffensiveForm,userId:o}))))})),I&&c.createElement("div",{className:"loadmore"},c.createElement("button",{type:"button",className:"button",onClick:,"More Comments"))):"no comment"!=r?c.createElement("div",{className:"loadinggif"},c.createElement("img",{alt:"Loading...",src:"".concat(process.env.IMG_URL,"/photo/29439462.cms")})):""))),document.getElementById("position-fixed-floater")):""}}])&&h(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),t}(c.Component);S.propTypes={msid:s().oneOfType([s().string,s().number]),showCommentsPopup:s().bool,authentication:s().object,closeCommentsBox:s().func,headline:s().string,hideAd:s().bool};var O=T=k=function(e){var t=e.commentId,n=e.userActionOnOffensiveForm,o=e.userId;return c.createElement("div",{className:"popup_badge popup_above flag_comment_box",style:{display:"none"}},c.createElement("div",{className:"content clearfix flagcontainer"},c.createElement("span",{className:"success-message"}),c.createElement("h6",null,N.locale.comment.offensiveReason||"Reason for reporting"),c.createElement("ul",{className:"reasons","data-action":"option_list"},c.createElement("li",null,c.createElement("label",{"data-val":"fl"},c.createElement("input",{name:"radiotype",value:"Foul language",type:"radio"}),c.createElement("b",null,N.locale.comment.offLang||"Foul language"))),c.createElement("li",null,c.createElement("label",{"data-val":"dfame"},c.createElement("input",{name:"radiotype",value:"Defamatory",type:"radio"}),c.createElement("b",null,N.locale.comment.defame||"Defamatory"))),c.createElement("li",null,c.createElement("label",{"data-val":"community"},c.createElement("input",{name:"radiotype",value:"Inciting hatred against a certain community",type:"radio"}),c.createElement("b",null,N.locale.comment.community||"Inciting hatred against a certain community"))),c.createElement("li",null,c.createElement("label",{"data-val":"other"},c.createElement("input",{name:"radiotype",value:"Others",type:"radio",onClick:function(){return n(t,"other")}}),c.createElement("b",null,"Others"))),c.createElement("li",null,c.createElement("textarea",{className:"offensive_popup_reason commentbox",style:{display:"none"}}))),c.createElement("div",{className:"error"}),c.createElement("div",{className:"buttons"},c.createElement("button",{type:"button",className:"button submit",onClick:,N.locale.comment.objection||"Report this!"),c.createElement("button",{type:"button",className:"button close_popup",onClick:,N.locale.comment.close||"Close"))))};k.propTypes={commentId:s().string,userActionOnOffensiveForm:s().func,userId:s().string};const w=(0,i.$j)(()(S)},"../node_modules/mini-css-extract-plugin/dist/loader.js??ruleSet[1].rules[2].use[1]!../node_modules/css-loader/index.js??ruleSet[1].rules[2].use[2]!../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../node_modules/postcss-loader/lib/index.js??ruleSet[1].rules[2].use[4]!./components/articleshow/commentBox.scss":"./components/articleshow/commentBox.scss":(e,t,n)=>{"use strict";var o=n("../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),a=n.n(o),r=n("../node_modules/mini-css-extract-plugin/dist/loader.js??ruleSet[1].rules[2].use[1]!../node_modules/css-loader/index.js??ruleSet[1].rules[2].use[2]!../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../node_modules/postcss-loader/lib/index.js??ruleSet[1].rules[2].use[4]!./components/articleshow/commentBox.scss"),s=n.n(r);a()(s(),{insert:"head",singleton:!1}),s().locals}}]);