"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[913],{913:function(t,e,n){n.r(e),n.d(e,{default:);var s=n(5121),i=n(629),r=n(4487),a=n(7347); u={name:"ContentPurchaseModal",emit:["success"],datacomputed:c(c(c({},(0,i.Se)("tokens",["tokenBalance"])),(0,i.Se)("modal",["activeModal","modalOptions"])),{},{visibleid(){return this.attachment?this.attachment.id:null},contentType(){return this.attachment?this.attachment.type:null},pricethumbnailUrl(){if(!this.attachment)return null;const t=this.attachment.blur_filename||this.attachment.thumbnail;return this.processImage({url:t,width:{mobile:320,desktop:960}})},textpriceInEuro(){return`~&euro;${(Math.floor(this.$shared.tokenPrice*this.price*100)/100).toFixed(2)}`}}),watch:{visible:{immediate:!0,handler},methods:c(c(c(c(c({},(0,i.nv)("tokens",["refreshTokenBalance"])),(0,i.nv)("modal",["openModal","closeModal"])),(0,i.nv)("pictureOverlay",{setPictureSrc:"setSrc",setPictureThumbnail:"setThumbnail",setPictureId:"setId",togglePicture:"toggle"})),(0,i.nv)("videoOverlay",{setVideoSrc:"setSrc",setVideoId:"setId",setVideoThumbnail:"setThumbnail",toggleVideo:"toggle"})),{},{open(t){this.attachment=t.attachment,this.creator=t.creator,posthog.capture("modal.unlock_confirm",{type:this.contentType})},close(t){this.closeModal({name:a.Z.CONTENT_PURCHASE,closeArgument:t}),this.submitting=!1,this.creator=null,this.attachment=null,posthog.capture("content-purchase.dismiss",{userId:this.$shared.user.id,mediaId:this.id,price:this.price})},async submit(){if(!this.submitting){this.submitting=!0;try{if(await this.refreshTokenBalance(),this.tokenBalance<this.price)return this.submitting=!1,void await this.openModal({name:a.Z.ADD_TOKENS,options:{invoker:"content-purchase-modal",creator:this.creator,content:this.attachment}});const t=await s.Z.post(route(`purchase_content.${this.contentType}`,{id:this.id}));if("success"!==t.data.status)throw new Error(t.data.message);this.attachment=t.data.content,this.success(),posthog.capture("content-purchase.completed",{type:this.contentType})}catch(t){this.submitting=!1,window.$toast.add({message:this.__("content.purchase.error"),type:"error",timeout:!1}),r.Tb(t)}}},successopenContent(){const t=this.attachment;"picture"===t.type?(this.setPictureId(t.id),this.setPictureSrc(this.processImage({url:t.filename,width:{mobile:768,desktop:1920}})),this.setPictureThumbnail(t.thumbnail),this.togglePicture()):(this.setVideoId(t.id),this.setVideoSrc(t.filename),this.setVideoThumbnail(t.thumbnail),this.toggleVideo())}})},h=(0,n(1900).Z)(u,(function(){var t=this,e=t._self._c;return t.visible&&t.creator?e("v-modal",{attrs:{id:"content-purchase-modal",classes:{content:"lg:!max-w-xl"}},on:{close:t.close}},[e("v-card",{attrs:{modal:""},on:{dismiss:t.close},scopedSlots:t._u([{key:"header",fn:function(){return[e("v-text",{attrs:{tag:"h3"}},[t._v(t._s(t.__("content.purchase.title")))])]},proxy:!0},{key:"footer",fn:function(){return[e("v-button",{staticClass:"w-full",attrs:{variant:"primary"},on:{click:t.submit}},[e("v-icon",{staticClass:"h-5 w-5",attrs:{name:"unlock",loading:t.submitting}}),t._v("\n        "+t._s(t.__("content.unlock"))+"\n      ")],1)]},proxy:!0}],null,!1,972316943)},[t._v(" "),e("v-text",{staticClass:"flex w-full flex-wrap items-center gap-x-1 gap-y-2 leading-none",attrs:{tag:"p"}},[e("span",{domProps:{innerHTML:t._s(t.text)}}),t._v(" "),e("v-icon",{staticClass:"h-5 w-5 shrink-0",attrs:{name:"tokens"}}),t._v(" "),e("span",{staticClass:"font-semibold leading-none"},[t._v(t._s(t.price))]),t._v(" "),e("span",{staticClass:"font-medium leading-none text-gray-light-caption dark:text-gray-caption",domProps:{innerHTML:t._s(t.priceInEuro)}}),t._v(" "),e("span",[t._v("?")])],1),t._v(" "),e("v-text",{staticClass:"mb-3 mt-5 md:mt-8",attrs:{tag:"p",styling:"strong"}},[t._v("\n      "+t._s(t.attachment.description)+"\n    ")]),t._v(" "),e("div",{staticClass:"relative mb-5 flex cursor-pointer flex-col gap-4 md:mb-8",on:{click:t.submit}},[e("v-icon",{staticClass:"absolute left-1/2 top-1/2 flex h-12 w-12 -translate-x-1/2 -translate-y-1/2 text-gray-title",attrs:{name:"lock"}}),t._v(" "),e("img",{staticClass:"mx-auto h-96 w-96 rounded-3xl object-cover",attrs:{src:t.thumbnailUrl,alt:t.contentType}})],1)],1)],1):t._e()}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=913.js.map?id=8245176a9b9408e6