"use strict";n){n=n!=null?n:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))}else{h(Object(n)).forEach(}return t}nction y(t,n){var e,r,i,o,a={label:0,sent:trys:[],ops:[]};return o={next:u(0),"throw":u(1),"return":u(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=,o;function(){var t=function t(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:encodeURIComponent;return"?".concat(Object.entries(t).map(.join("&"))};var n=var e=function t(t){return q.apply(this,arguments)};var o=function t(t){return G.apply(this,arguments)};var u=function t(t){return tt.apply(this,arguments)};var s=function t(t){return tn.apply(this,arguments)};var l=function t(){return tc.apply(this,arguments)};var h=function t(t,n){var e={},r={},i=0,o=t.length;for(;i<o;)r[t[i]]=1,i+=1;for(var a in n)Object.prototype.hasOwnProperty.call(r,a)||(e[a]=n[a]);return e};var d=function t(t){return t?btoa(String.fromCharCode.apply(null,new Uint8Array(t))):null};var b=function t(){var t=new Date().getTimezoneOffset()*-1;return"".concat(tw(t)).concat(tm(t),":").concat(tS(t))};var g=function t(t){return tO.apply(this,arguments)};var w="PUSH_JS_WINDOW",m="PUSH_JS_SW";var S=var O={host:"https://api.tinkoff.ru/v1/",subscribe:"register_for_push_notification",unsubscribe:"",status:"set_push_notification_status",store:"store",log:"log",fetchRequestInit:{}},k=O;var P=/*#__PURE__*/function(){function t(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=n.appKey;i(this,t);this.storeName="tinkoff-push".concat(e?"--".concat(e):""),this.db=null}a(t,[{key:"get",value:function t(t){var n=this;return r(function(){var e;return y(this,function(r){switch(r.label){case 0:return[4,n._withStore("readonly",];case 1:return[2,(r.sent(),e.result)]}})})()}},{key:"set",value:function t(t,n){var e=this;return r(function(){return y(this,function(r){switch(r.label){case 0:return[4,e._withStore("readwrite",];case 1:r.sent();return[2]}})})()}},{key:"_getDB",value:function t(){var t=this;return this.db||(this.db=new Promise(function(n,e){var r=indexedDB.open(t.storeName,1);r.onerror=function(){return e(r.error)},r.onupgradeneeded=r.onsuccess=function(){return n(r.result)}})),this.db}},{key:"_withStore",value:function t(t,n){var e=this;return r(function(){var r;return y(this,function(i){switch(i.label){case 0:return[4,e._getDB()];case 1:r=i.sent();return[2,new Promise(function(e,i){var o=r.transaction("keyval",t);o.oncomplete=o.onerror=n(o.objectStore("keyval"))})]}})})()}}]);return t}();var j=new P({appKey:self._appKey});var I=function(){return j.get("api").catch(n).then(},D=I;var _=function(n,e){return e?D().then(function(r){return fetch(r.host+r.status+t({status:n,messageId:e}),r.fetchRequestInit)}):Promise.resolve()},E=_;var A=U=function(t){return function n(){return A()?t.apply(null,arguments):};var N=R=N;var C=function(t){return t&&t.stack&&t.stack.split&&t.stack.split("\n")||["No stack"]},L=C;var K="https://www.tinkoff.ru/api/front/pwtm/event",M=function(t,n){return function(){var e=r(function(e){var r,i,o,a;return y(this,function(u){switch(u.label){case 0:u.trys.push([0,3,,4]);r=[],i=null;e&&c(e,Error)&&(i=e.message,r=L(e));return[4,R()];case 1:o=u.sent();return[4,fetch(K,{method:"POST",body:JSON.stringify({level:e?"ERROR":"INFO",event:t,wuid:o.wuid,error:i||void 0,stack:(r===null||r===void 0?void 0:r.length)?r:void 0,additional:n}),headers:{"Content-Type":"application/json"}})];case 2:u.sent();return[3,4];case 3:a=u.sent();return[3,4];case 4:return[2,Promise.resolve()]}})});return function(t){return e.apply(this,arguments)}}()},W=M,x=U(M);function q(){q=r(function(t){var n;return y(this,function(e){switch(e.label){case 0:return[4,clients.matchAll({type:"window",includeUncontrolled:!0})];case 1:n=e.sent().find(function(n){return n.url===t&&"focus"in n});return[2,n?n.focus():clients.openWindow(t)]}})});return q.apply(this,arguments)}var T=function(t){var n=t.notification;var r=n.data||{},i=r.RedirectURL,o=i===void 0?"".concat(self.location.origin,"/"):i;return n.close(),E("read",n.tag),o?e(o).catch(W("notification-click")):Promise.resolve()},F=T;var J=function(t){var n=t.notification;return E("close",n.tag)},B=J;function z(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";var e=Math.random().toString(36).slice(2);return e.length>=10?n+e:z(t,n)}var H=new MessageChannel,V=function(t){return function(n){n.postMessage("".concat(t),[H.port2])}};function G(){G=r(function(t){var n,e,r,i,o;return y(this,function(a){switch(a.label){case 0:a.trys.push([0,2,,3]);n={source:m,messageId:z(),data:t},e=V(JSON.stringify(n)),r=[];return[4,clients.matchAll({includeUncontrolled:!0})];case 1:i=a.sent();i.forEach(,x("notifyAll",{length:i.length})();return[3,3];case 2:o=a.sent();x("notifyAll-error")(o);return[3,3];case 3:return[2]}})});return G.apply(this,arguments)}var $=o;var Q=X=Q;var Y=Z=Y;function tt(){tt=r(function(t){var n,e;return y(this,function(r){switch(r.label){case 0:if(!t.data.focusOnClick)return[2];return[4,clients.matchAll({type:"window",includeUncontrolled:!0})];case 1:n=p.apply(void 0,[r.sent(),1]),e=n[0];if(e)return[2,e.focus()];return[2]}})});return tt.apply(this,arguments)}function tn(){tn=r(function(t){return y(this,function(n){if(t.data.closeOnClick)return[2,t.close()];return[2]})});return tn.apply(this,arguments)}var te=function(t){var n=t.notification;return Promise.all([X(n.tag,"click"),u(n),s(n)])},tr=te;var ti=function(n,e){return n?D().then(function(r){return fetch(r.host+r.store+t(f({group:n},e)),r.fetchRequestInit)}):Promise.resolve()},to=ti;var ta="actionLink",tu=["actionContinue","actionLogout","actionChatSuggestAccept","actionChatSuggestDecline"];function tc(){tc=r(function(){var t,n;return y(this,function(e){switch(e.label){case 0:return[4,j.get("settings")];case 1:t=e.sent(),n=t.wuid;return[2,n]}})});return tc.apply(this,arguments)}var ts=function(t){var n=t.action,e=t.notification;var r=tu.indexOf(n)!==-1?n:ta,i="id-graph",o=[s(e)];return r===ta?o.push(l().then(function(t){return to(i,{action:n,wuid:t,webpushId:e.tag})}),E("read",e.tag)):o.push(X(e.tag,r)),Promise.all(o).then(function(){return r===ta?clients.openWindow(n):u(e)})},tl=ts;var tf=function(t){var n=null;try{n=t?t.json():null}catch(t){W("push-data-error")(t),n=null}return n};var th={title:"Tinkoff.ru",lang:"RU",body:"",icon:"https://www.tinkoff.ru/apple-touch-icon-180x180.png",requireInteraction:!0};var tv=function(t){var n=t!==null&&t!==void 0?t:{},e=n.data,r=e===void 0?{}:e,i=n.notification,o=i===void 0?{}:i;var a;return v(f({},th,o),{data:r,tag:(a=r.messageId)!==null&&a!==void 0?a:Date.now().toString()})};var tp={markDeliveredFailed:"MARK_DELIVERED_FAILED"},td=function(){var t=r(function(t){var n,e,i,o,a,u,c,s,l,f,h,v,p,d,b,g,w;return y(this,function(m){switch(m.label){case 0:x("pushDefault-received-push")();i=tf(t.data),o=tv(i),a=i===null||i===void 0?void 0:(n=i.data)===null||n===void 0?void 0:n.messageId;x("pushDefault-push-info",{timeout:(u=i===null||i===void 0?void 0:(e=i.notification)===null||e===void 0?void 0:e.timeout)!==null&&u!==void 0?u:"empty",messageId:a})();m.label=1;case 1:m.trys.push([1,3,,11]);return[4,self.registration.showNotification((s=i===null||i===void 0?void 0:(c=i.notification)===null||c===void 0?void 0:c.title)!==null&&s!==void 0?s:"",o).then(/*#__PURE__*/r(function(){var t;return y(this,function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);return[4,E("delivered",a)];case 1:n.sent(),x("pushDefaultDelivered")();return[3,3];case 2:t=n.sent();W("showNotification-promise-error",{errorCode:tp.markDeliveredFailed})(t);return[3,3];case 3:return[2]}})})).catch(W("showNotification-promise-error"))];case 2:m.sent();return[3,11];case 3:l=m.sent();f="unknown",h="unknown",v="unknown",p="unknown";m.label=4;case 4:m.trys.push([4,8,,9]);if(!self.registration.pushManager)return[3,6];return[4,(d=self.registration.pushManager)===null||d===void 0?void 0:d.permissionState()];case 5:b=f=m.sent()||"noPermissionState";return[3,7];case 6:b=f="noPushManager";m.label=7;case 7:b;return[3,9];case 8:g=m.sent();return[3,9];case 9:try{;h=((w=self.registration.active)===null||w===void 0?void 0:w.state)||"noActiveState"}catch(t){}try{v=self.registration.waiting?"true":"false"}catch(t){}try{p=self.serviceWorker.state||"noState"}catch(t){}return[4,x("showNotification-error",{permission:f,activeSWStatus:h,hasWaitingSW:v,currentSWStatus:p})(l)];case 10:m.sent();return[3,11];case 11:return[2]}})});return (),ty=td;var tb=function(){var t=r(function(){var t,n;return y(this,function(e){switch(e.label){case 0:return[4,j.get("settings")];case 1:t=e.sent(),n=t.applicationServerKey;return[2,(x("createNewSubscription")(),self.registration.pushManager.subscribe({applicationServerKey:n,userVisibleOnly:!0}))]}})});return (),tg=tb;var tw=tm=function(t){var n=Math.floor(Math.abs(t/60));return n>9?n.toString():"0".concat(n.toString())},tS=function(t){var n=Math.abs(t%60);return n>9?n.toString():"0".concat(n.toString())};function tO(){tO=r(function(n){var e,r,i,o,a,u;return y(this,function(c){switch(c.label){case 0:return[4,j.get("subscription")];case 1:e=c.sent();return[4,j.get("settings")];case 2:r=c.sent();if(x("saveSubscription init",{oldSubId:e,newSubId:r.endpoint,equal:e===n.endpoint})(),e===n.endpoint)return[2];return[4,D()];case 3:i=c.sent(),o=d(n.getKey("auth")),a=d(n.getKey("p256dh")),u=v(f({},r),{newNotificationId:n.endpoint,oldNotificationId:e,publicKey:a,timezone:b(),auth:o});return[4,j.set("subscription",n.endpoint)];case 4:c.sent();return[4,j.set("settings",u)];case 5:return[2,(c.sent(),x("saveSubscription request",{newSettings:u})(),fetch(i.host+i.subscribe+t(h(["safari","applicationServerKey"],u)),i.fetchRequestInit))]}})});return tO.apply(this,arguments)}var tk=g;var tP=function(){return tg().then(tk).catch(W("subscription-change"))},tj=tP;var tI;self._appKey=(tI=new URL(self.location.href).searchParams.get("webPushAppKey"))!==null&&tI!==void 0?tI:void 0;var tD=t_=function(t){try{var n=Date.now();t.waitUntil(ty(t)),t.waitUntil(x("pushListenerPerf",{duration:Date.now()-n})())}catch(n){t.waitUntil(x("pushListenerError")(n))}},tE=function(t){var n;t.action?n=tl:n=S(t)?tr:F,t.waitUntil(n(t))},tA=function(t){var n;switch(!0){case S(t):n=Z;break;default:n=B;break}t.waitUntil(n(t))},tU=function(t){x("pushsubscriptionchange")(),t.waitUntil(tj())};self.addEventListener("install",tD);self.addEventListener("push",t_);self.addEventListener("notificationclick",tE);self.addEventListener("notificationclose",tA);self.addEventListener("pushsubscriptionchange",tU)})();