/*! For license information please see dmp-main-template.js.LICENSE.txt */
(()=>{var a={784:pped__,this.__actions__)},Mo.prototype.first=Mo.prototype.head,Ya107:(a,e,o)=>ion(a){retudRule=function(a){var e=n.toASCII(a);return t.rules.reduce((function(a,o){return-1===o.punySuffix&&(o.punySuffix=n.toASCII(o.suffix)),t.endsWith(e,"."+o.punySuffix)||e===o.punySuffix?o:a}),null)},e.errorCodes={DOMAIN_TOO_SHORT:"Domain name too short.",DOMAIN_TOO_LONG:"Domain name too long. It should be no more than 255 chars.",LABEL_STARTS_WITH_DASH:"Domain name label can not start with a dash.",LABEL_ENDS_WITH_DASH:"Domain name label can not end with a dash.",LABEL_TOO_LONG:"Domain name label should be at mo>63)retushift(nshift(l.pr.tld].join("."),l.length&&(r.subdomain=l.join(".")),u()):u()):u()},e.get=function(a){return a&&e.parse(a).domain||null},e.isValid=function(a){var o=e.parse(a);return Boolean(o.domain&&o.listed)}},770:(a,e,o)=>{"use strict";o.r(e),o.d(e,{decode:()=>k,default:()=>y,encode:()=>j,toASCII:()=>v,toUnicode:()=>b,ucs2decode:()=>g,ucs2encode:()=>d});const n=2147483647,t=36,i=/^xn--/,r=/[^\0-\x7F]/,s=/[\x2E\u3002\uFF0E\uFF6lengteACo e26),n,=0,++p}++r,++i}return e.join("")},b=function(a){return p(a,(function(a){return i.test(a)?k.de","on.k.or8.io",mentto.gt".kg","uk.kg","us.kg","de.ls","at.md","de.md","jp.md","to.md","indie.porn","vxl.sh","ch.tc","me.tc","we.tc","nyan.to","at.vg","blog.vu","dev.vu","me.vu","v.ua","*.vultrobjects.com","wafflecell.com","*.webhare.dev","reserve-online.net","reserve-online.com","bookonline.app","hotelwithflight.com","wedeploy.io","wedeploy.me","wedeploy.sh","remotewd.com","pages.wiardweb.com","wmflabs.org","toolforge.org","wmcloud.org","panel.gg","daemon.panel.gg","messwithdns.com","woltlab-demo.cenginepowered.com","js.wpenginepowered.com","wixsite.com","editorx.io","half.host","xnbay.com","u2.xnbay.com","u2-local.xnbay.com","cistron.nl","demon.nl","xs4all.space","yandexcloud.net","storage.yandexcloud.net","website.yandexcloud.net","official.academy","yolasite.com","ybo.faith","yombo.me","homelink.one","ybo.party","ybo.review","ybo.science","ybo.trade","ynh.fr","nohost.me","noho.st","za.net","za.org","bss.design","basicserver.io","virtualserver.io","enterprisecloud.nu"]')}},e={};function o(n){var t=e[n];if(void 0!==t)return t.exports;var i=e[n]={id:n,loaded:!1,exports:{}};return a[n].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.d=(a,e)=try{return this||new Function("return this")()}catch(a){if("object"==typeof window)return window}}(),o.o=(a,e)=>Object.prototype.hasOwnProperty.call(a,e),o.r=a=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},o.nmd=a=>(a.paths=[],a.children||(a.children=[]),a),(()=>{"use strict";const a="https://event.dxmdp.com/rest/api/v1/events",e="https://event.dxmdp.com/rest/api/v1/sync",n="https://event.dxmdp.com/rest/api/v1/report-error",t="DMP_COMMON_FRAME_NAME",i="dmp-publisher-";var r,s,u,c,m,l,p,g,d,h,f,k,j,b,v,y,w,z,_;(z=r||(r={})).INIT="INIT",z.READY="READY",z.ERROR="ERROR",(w=s||(s={})).EMPTRY_USER_ID="EMPTRY_USER_ID",w.UNKNOWN_ERROR="UNKNOWN_ERROR",(u||(u={})).VERIFICATION="VerificationMessage",(c||(c={})).UPDATE_DATA="UPDATE_DATA",function(a){a.PAGE_VIEW="PAGE_VIEW",a.LINK_CLICK="LINK_CLICK",a.VIDEO_EVENT="VIDEO_EVENT",a.NATIVE_OCLICK="NATIVE_OCLICK",a.SLOT_CLICK="SLOT_CLICK",a.CONVERSION="CONVERSION"}(m||(m={})),function(a){a.AUDIENCE_ENTER="AUDIENCE_ENTER",a.AUDIENCE_EXIT="AUDIENCE_EXI),function(a){a.UPDATE="UPDATE",a.REPLACE="REPLACE"}(p||(p={})),function(a){a.STANDARD="STANDARD",a.CURRENT_PAGE="CURRENT_PAGE"}(g||(g={})),function(a){a.INDEXING="INDEXING",a.ACTIVATED="ACTIVATED"}(d||(d={})),function(a){a.MAIN="MAIN",a.CURRENT_PAGE="CURRENT_PAGE"}(h||(h={})),function(a){a.ALL="ALL",a.LAST="LAST",a.AFTER="AFTER",a.BEFORE="BEFORE",a.BETWEEN="BETWEEN"}(f||(f={})),function(a){a.EXACTLY="EXACTLY",a.BETWEEN="BETWEEN",a.AT_MOST="AT_MOST",a.AT_LEAST="AT_LEAST",a.NOT_DEFINED="NOT_DEFINED"}(k||(k={})),function(a){a.OR="OR",a.AND="AND"}(j||(j={})),function(a){a.URL_REGEX="URL_REGEX",a.GLOBAL_VARIABLE="GLOBAL_VARIABLE",a.META_NAME="META_NAME",a.META_PROPERTY="META_PROPERTY",a.JAVASCRIPT="JAVASCRIPT"}(b||(b={})),function(a){a.STRING="STRING",a.DOUBLE="DOUBLE",a.LONG="LONG",a.ARRAY_OF_STRING="ARRAY_OF_STRING"}(v||(v={})),function(a){a.URL_CONTAINS="URL_CONTAINS",a.URL_EXACTLY_MATCH="URL_EXACTLY_MATCH",a.CATEGORY_EQUALS="CATEGORY_EQUALS"}(y||(y={})),function(a){a.MOBILE_WEB="MOBILE_WEB",a.MOBILE_APP="MOBILE_APP",a.DESKTOP="DESKTOP"}(_||(_={}));var E=o(784);consrySelectorAll(".tags-container a");return Array.from(a).map((a=>a.text))}return[]ject.getOwnPropertyDescriptor(o,a).enumerable})))),n.forEach((function(e){I(a,e,o[e])}))}return a}const O=(a,e)=>{if(a)switch(e){case v.LONG:case v.DOUBLE:return Number(a);case v.STRING:return String(a);case v.ARRAY_OF_STRING:return Array.isArray(a)?a.map((a=>String(a))):String(a).split(",");default:return}},S=a=>{const e=(a=>{const e=a.navigator.standalone,o=a.navigator.userAgent.toLowerCase(),n=/safari/.test(o),t=/iphone|WEB;case t&&!e&&!n:case!t&&o.includes("wv"):return _.MOBILE_APP;case"ontouchstart"in document.documentElemenonly screen and (max-width: 768px)").matches:case window.matchMedia("(pointer:coarse)").matches:case Boolean(a.navigator.userAgent.match(/Android/i)):case Boolean(a.navigator.userAgent.match(/iPhone/i)):return _.MOBILE_WEB;default:return _.DESKTOP}})(a);return{devicePlatform:e}};function D(a,e,o){return e in a?Object.defineProperty(a,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[e]=o,a}function C(a){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter((function(a){return Object.getOwnPropertyDescriptor(o,a).enumerable})))),n.forEach((function(e){D(a,e,o[e])}))}return a}var L;!function(a){a.GET="GET",a.POST="POST"}(L||(L={}));const T=(a,e,o={})=>{const{pathParams:n,query:t,headers:i,body:r}=o,s=function(a,e){if(null==a)return{};var o,n,t=function(a,e){if(null==a)return{};var o,n,t={},i=Object.keys(a);for(n=0;n<i.length;n++)o=i[n],e.indexOf(o)>=0||(t[o]=a[o]);return t}(a,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(n=0;n<i.length;n++)o=i[n],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(a,o)&&(t[o]=a[o])}return t}(o,["pathParams","query","headers","body"]);n&&Object.keys(n).forEach((e=>{const o=String(n[e]);a=a.replace(new RegExp(`:${e}[?]{0,1}`),o)}));const u=new URL(a);t&&Object.keys(t).forEach((a=>{var e;const o=String(null!==(e=t[a])&&void 0!=onst c=C({method:e,query:t,headers:C({"Content-Type":"application/json"},i),body:r?JSON.stringify(r):void 0},s);return fetch(u.toString(),c).then((a=>{if(!a.ok)throw .statusText);return a.text()})).then((a=>a?"application/json"===c.headers["Content-Type"]?JSON.parse(a):a:null))},R=(a,e)=>T(a,"GET",e),P=(a,e)=>T(a,"POST",e),N=(a,e)=>{try{new Function(a).call(void 0)}catch(a){null==e||e(a)}};function M(a,e,o,n,t,i,r){try{var s=a[i](r),u=s.value}catch(a){return void o(a)}s.done?e(u):Promise.resolve(u).then(n,t)}function U(a){return function(){var e=this,o=arguments;return new Promise((function(n,t){var i=a.apply(e,o);function r(a){M(i,n,t,r,s,"next",a)}function s(a){M(i,n,t,r,s,"throw",a)}r(void 0)}))}}function q(a,e,o){return e in a?Object.defineProperty(a,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[e]=o,a}function B(a){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter((function(a){return Object.getOwnPropertyDescriptor(o,a).enumerable})))),n.forEach((function(e){q(a,e,o[e])}))}return a}const $=(e,o,n,t,i)=>{return P(a,{credentials:"include",query:{ts:t,dmpid:i},body:(r=B({},n),s={event:e,userId:i,providerId:o},s=null!=s?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):function(a,e){var o=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);o.push.apply(o,n)}return o}(Object(s)).forEach((function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})),r)});var r,s},W=(e,o)=>P(a,{credentials:"include",query:{ts:o,dmpid:e.userId},body:e}),F=(V=U((function*(){return(yield R(e,{credentials:"include"})).audids})),function(){return V.apply(this,arguments)});var V;U((function*(a,e,o){const n=yield R(`https://tags.dxmdp.com/tags/${a}/snippets/${e}`,{credentials:"include",headers:{"Content-Type":"text/javascript"}});return()=>N(n,o)}));const Ge){const o=yield R(a,{credentials:"include",headers:{"Content-Type":"text/javascript"}});N(o,e)}));return function(e,o){return a.apply(this,arguments)}}();var H,K,Y;(K=H||(H={})).ICE="788e0fee-a9f4-4c49-a8d6-307539424b2e",K.MAARIV="b515cf7f-ac23-4ab4-9418-37d78db1b935",K.BIZPORTAL="8668c7e1-ed8b-4584-9218-ecae2b358bc3",K.TV9="8738e5c5-03f6-492a-ba8a-397b43474f3b",K.ISRAELHAYOM="d4608a30-40f1-46e4-8b52-71cc29c2dc1a",K.VESTY="1ff70d9b-ba5c-4c4b-9759-4bd97f511c8d",K.CALCALIST="0b41b6f0-1d53-4017-a72b-33a759568873",K.SPORT1="f1d7026f-040a-43f8-9600-bfc39b9251fc",K.SPORT5="2422f7d8-4719-4d25-8d91-af822eeb3e1c",K.TV13="41e37d4d-43fb-40d7-9762-8ae91252c1e2",K.WALLA="bc8a7a32-7d98-4226-8af9-d2a43a8621cc",K.GLOBES="e3f93e9e-8756-457c-addc-3d76aa5b5582",K.YNET="a5beb245-2949-4a76-95f5-bddfc2ec171c",K.ONeae5-0554-4499-8221-28880465ceae",K.HAARETZ="973e193f-6f00-46d3-bae9-e84870287ae2",K.MAKO="36699dd9-d954e6a-4bbfce1f3652",K.MAKORRISHON="e2c597a2-fb13-44de-9adb-1e1390708f6d",K.TMI="0accac7d-a6bd-4899-a8ac-54f1962"f9ee75d4-540d-4be9-a9c7-3fc2c070a53b",K.FM103="9ce6ead9-6698-4f70-bcc6-2cc8646d2cb2",K.HAMAL="0354db52-501b-4843-bbbe-f1d50aa8d3f6",K.CHANEL14="1c04541d-67b4-47ea-a76c-a05bfb699d03",K.INVESTING="79c86a60-3a28-440e-896e-0c1c1073d8f4",K.ROTTER="e26b14d0-56b1-4137-99b4-744e82a664df",function(a){a.HOURS="HOURS",a.DAYS="DAYS",a.WEEKS="WEEKS",a.MONTHS="MONTHS"}(Y||(Y={}));const J=(a,e)=>new Date(a).setHours(new Date(a).getHours()-e),X=(a,e)=>J(a,24*e),Z=(a,e)=>e.filter((e=>{const o=a.filter((a=>a.defId===e.defId));if(!o.length)return!1;const{behaviourOperators:n,behaviours:t}=e;if(n.length!==t.length-1)throw`[DMP publisher frame]: Defenition with audienceId: ${e.uuid} and defId: ${e.defId} has wrong operators`;let i=!0;return e.type!==g.CURRENT_PAGE&&t.sort(((a,e)=>a.ordinalNum-e.ordinalNum)).forEach(((a,e)=>{const t=e>0?n(i&&t===j.OR)return;if(!i&&t===j.AND)return;const r=o..code&&e.push(...o.timestamps),e)),[]),s=((a,e)=>{const{durationValue:o,durationMaxDate:n,durationMinDnUnir=t?aakMap,ta=new WeakMap,ia=new WeakMap,ra=new WeakMap,sa=new WeakMap;let ua={get(a,e,o){if(a instanceof IDBTransactionr.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...a){return e.apply(la(this),a),ma(na.get(this))}:function(...a){return ma(e.apply(la(this),a))}:function(a,...o){const n=e.call(la(this),a,...o);return ia.set(n,a.sort?a.sort():[a]),ma(n)}:(a instanceof IDBTransaction&&function(a){if(ta.has(a))return;const e=new Promise(((e,o)=>{const n=()=>{a.removeEventListener("complete",t),a.removeEventListener("error",i),a.removeEventListener("abort",i)},t=()=>{e(),n()},i=()=>{o(a.error||new DOMException("AbortError","AbortError")),n()};a.addEventListener("complete",t),a.addEventListener("error",i),a.addEventListener("abort",i)}));ta.set(a,e)}(a),aa(a,ea||(ea=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTa.set(e,a)})).catch((()=>{}))retuurn e!==a&sa.get(a),pa=["get","getKey","getAll","getAllKeys","count"],ga=["put","add","delete","clear"],da=new Map;function ha(a,e){if(!(a instanceof IDBDatabase)||e in a||"string"!=typeof e)return;if(da.get(e))return da.get(e);const o=e.replace(/FromIndex$/,""),n=e!==o,t=ga.includes(o);if(!(o in(n?IDBIndex:IDBObjectStore).prototype)||!t&&!pa.includes(o))return;cons function(a,...e){const i=this.transaction(a,t?"readwrite":(e.shift())),(await Promise.all([r[o](...e),t&&i.done]))[0]};res=a[i](r),u=s.value}catch(a){return void o(a)}s.done?e(u):Promise.resolve(u).then(n,t)}function ka(a){return function(,n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter((function(a){return Object.getOwnPropertyDescriptor(o,a).enumerable})))),n.forEach((function(e){ja(a,e,o[e])}))}return a}function va(a,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):function(a,e){var o=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);o.push.apply(o,n)}return o}(Object(e)).forEach((function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(e,o))})),a}var ya,wt(a,e,o),has:(a,e)=>!!ha(a,e)||ya.has(){return!!this.database}constructor(a={}){ja(this,"config",{prefixName:""}),ja(this,"database",void 0);var e=this;ja(this,"getDataFromStore",function(){var a=ka((function*(a,o){if(!e.database)return[];if(!o)return yield e.database.getAll(a);const n=[];let t=[...o],i=yield e.database.transaction(a).store.openCursorgth;){const{key:a}=i;i&&t.includes(a)&&(t=t.filter((e=>e!==a)),n.push(i.value)),i=yield i.continue()}return n}));return function(e,o){return a.apply(this,arguments)}}()),ja(this,"convertResponseEventsToDatabaseEvents",(a=>a.map((a=>va(ba({},a),{computedId:za.getEventComputedId(a)})))));var o=this;ja(this,"createConnect",ka((function*(){const a=`${o.config.prefixName}-dmp-database`;o.database=yield function(a,e,{blocked:o,upgrade:n,blocking:t,terminated:i}={}){const r=indexedDB.open(a,e),s=ma(r);return n&&r.addEventListener("upgradeneeded",(a=>{n(ma(r.result),a.oldVersion,a.newVersion,ma(r.transaction))})),o&&r.addEventListener("blocked",(()=>o())),s.then((a=>{i&&a.addEventListener("close",(()=>i())),t&&a.addEventListener("versionchange",(()=>t()))})).catch((()=>{})),s}(a,1,{upgrade:(a,e)=>{e<1&&(a.createObjectStore("definitions",{keyPath:"defId"}),a.createObjectStore("events",{keyPath:"computedId"}))}})})));var n=this;ja(this,"getEvents",function(){var a=ka((function*(a){return yield n.getDataFromStore("events",a)}));return function(e){return a.apply(this,arguments)}}());var t=this;ja(thon(){var a=ka((function*(a){if(!t.database)return;const e=t.database.transaction("events","readwrite");yield Promise.all([...a.map((a=>e.store.put(a))),e.done])}));return function(e){return a.apply(this,arguments)}}()),ja(this,"getMergedEvents",((a,e)=>{const o=e.filter((e=>!a.some((a=>a.computedId===e.computedId)))),n=a.reduce(((a,o)=>{const n=e.find((a=>a.computedId===o.computedId)),t=[...new Set([...(null==n?void 0:n.timestamps)||[],...o.timestamps])].sort().slice(-50);return a.push(va(ba({},n,o),{timestamps:t})),a}),[]);return{allEvents:[...n,...o],updatedEvents:n}}));var i=this;ja(this,"mergeEvents",function(){var a=ka((function*(a){if(!i.database)return;const e=yield i.getEvents(a.map((a=>a.computedId))),{updatedEvents:o}=i.getMergedEvents(a,e);yield i.setEvents(o)}));return functionr=this;ja(this,"removeEvents",ka((function*(a=[]){if(!r.database)rn(.done])})));var s=this;ja(this,"removeAllEvents",ka((function*(){if(!s.database)return;const a=s.database.transaction("events","readwrite");yield Promise.all([a.store.clear(),a.done])})));var u=this;ja(this,"getDefinitions",function(){var a=ka((function*(a){return yield u.getDataFromStore("definitions",a)}));return function(e){return a.apply(this,arguments)}}());var c=this;ja(this,"setDefinitions",function(){var a=ka((function*(a){if(!c.database)return;const e=c.database.transaction("definitions","readwrite");yield Promise.all([...a.map((a=>e.store.put(a))),e.done])}));return fu(e){return a.apply(this,arguments)}}());var m=this;ja(this,"removeDefinitions",ka((function*(a=[]){if(!m.database)return;const e=m.database.transaction("definitions","readwrite");yield Promise.all([...a.map((a=>e.store.delete(a))),e.done])})));var l=this;ja(this,"removeAllDefinitions",ka((function*(){if(!l.database)return;const a=l.database.transaction("definitions","readwrite");yield Promise.all([a.store.clear(),a.done])})));var g=this;ja(ld Pr o(a)}eturn row",a)}r(void 0)}))}}function Sa(a,e,o){return e in a?Object.defineProperty(a,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[e]=o,a}function Da(a){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{ct.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter((function(a){return Object.getOwnPropertyDescriptor(o,a).enumerable})))),n.forEach((function(e){Sa(a,e,o[e])}))}return a}function Ca(a){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)a[n]=o[n]}return a}var La=function a(e,o){function n(a,n,t){if("undefined"!=typeof document){"number"==typeof(t=Ca({},o,t)).expires&&(t.expires=new Date(Date.now()+864e5*t.expires)),t.expires&&(t.expires=t.expires.toUTCString()),a=encodeURIComponent(a).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var r in t)t[r]&&(i+="; "+r,!0!==t[r]&&(i+="="+t[r].split(";")[0]));return document.cookie=a+"="+e.write(n,a)+i}}return Object.create({set:n,get:function(a){if("undefined"!=typeof document&&(!arguments.length||a)){for(var o=document.document.cookie.split("; "):[],n={},t=0;t<o.length;t++n("=");try{var s=decodeURIComponent(i[0]);if(n[s]=e.read(r,s),a===s)break}catch(a){}}return a?n[a]:n}},remove:function(a,e){n(a,"",Ca({},e,{expires:-1}))},withAttributes:function(e){return a(this.converter,Ca({},this.attributes,e))},withConverter:function(e){return a(Ca({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(o)},converter:{value:Object.freeze(e)}})}({read:function(a){return'"'===a[0]&&(a=a.slice(1,-1)),a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(a){return encodeURIComponent(a).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),Ta=o(107);const Ra=()=>{try{var a,e;return nulltion.host))||void 0===a?void 0:a.domain)&&void 0!==e?e:void 0}catch(a){return}},Pa=(a="")=>({get:e=>localStorage.getItem(`${a}${e}`),set:(e,o)=>localStorage.setItem(`${a}${e}`,o),remove:e=>localStorage.removeItem(`${a}${e}`)});function Na(a,e,o){return e in a?Object.defineProperty(a,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[e]=o,a}function Ma(a,e,o,n,t,i,r){try{var s=a[i](r),u=s.value}catch(a){return void o(a)}s.done?e(u):Promise.resolve(u).then(n,t)}function Ua(a,e,o){return e in a?Object.defineProperty(a,e,{value:o,enumerable:Ba(this,"fulfilledConditions",new Set),Ba(this,"fulfillCos.events[a])||void 0===e||e.forEach((a=>a())),this){return e in a?Object.defineProperty(a,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[e]=o,a}function Va(a,e,o){return e in a?Object.defineProperty(a,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[e]=o,a}const Ga={status:"auto",enableKey:"enableTagDebug",prefix:"",withTimestamp:!1};class Ha{get enabled(){return this._enabled}constructor(a={}){Va(this,"props",Ga),Va(this,"_enabled",!1),Va(this,"isEnabled",(()=>{const{status:a,enableKey:e}=this.props;if("enabled"===a)return!0;if("disabled"===a)return!1;if("auto"===a&&e){const{search:a}=window.location;return!!new URLSearchParams(a).get(e)}return!1})),Va(this,"log",((...a)=>{this._enabled&&console.log(this.props.withTimestamp?Date.now().toString():"",this.props.prefix,...a)})),Va(this,"error",((...a)=>{this._enabled&&console.error(this.props.withTimestamp?Date.now().toString():"",this.props.prefix,...a)})),this.props=function(a){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?argumentsn.concat(Object.getOwnPropertySymbols(nction(a){return Object.getOwnPropertyDescriptor(o,a).enumerable})))),n.forEach((function(e){Va(a,e,o[e])}))}return a}({},this.props,a),this._enabled=this.isEnabled()}}varLL",a.WARNINGS="WARNINGS",a.ERRORS="ERRORS"}(Ka||(Ka={}));const Ya={ALL:1,WARNINGS:2,ERRORS:3};function Ja(a,e,o,n,t,i,r){try{var s=a[i](r),u=s.value}catch(a){return void o(a)}s.done?e(u):Promise.resolve(u).then(n,t)}function Xa(a){return function(){var e=this,o=arguments;return new Promise((function(n,t){var i=a.apply(e,o);function r(a){Ja(i,n,t,r,s,"next",a)}function s(a){Ja(i,n,t,r,s,"throw",a)}r(void 0)}))}}function Za(a,e,o){return e in a?Object.defineProperty(a,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[e]=o,a}const Qa=new class{constructor(){Na(this,"cookieConnect",void 0),Na(this,"localStorageConnect",void 0),Na(this,"getUserId",(()=>{var a,e;return null!==(e=null!==(a=this.localStorageConnect.get("dmpid"))&&void 0!==a?a:this.cookieConnect.get("dmpid"))&&void 0!==e?e:void 0})),Na(this,"getTimestamp",(()=>{var a,e;return null!==(e=null!==(a=this.localStorageConnect.get("ts"))&&void 0!==a?a:this.cookieConnect.get("ts"))&&void 0!==e?e:void 0})),Na(this,"getUserState",(()=>({dmpid:this.getUserId(),ts:this.getTimestamp()}))),Na(this,"setUserState",(a=>{this.cookieConnect.set("dmpid",a.userId),this.cookieConnect.set("ts",String(a.lastModifiedTimestamp)),this.localStorageConnect.set("dmpid",a.userId),this.localStorageConnect.set("ts",String(a.lastModifiedTimestamp))})),Na(this,"clearUserState",(()=>{this.cookieConnect.remove("dmpid"),this.cookieConnect.remove("ts"),this.localStorageConnect.remove("dmpid"),this.localStorageConnect.remove("ts")})),Na(this,"clearUserLastTimestamp",(()=>{this.cookieConnect.remove("ts"),this.localStorageConnect.remove("ts")})),this.cookieConnect=((a="",e)=>({get:a=>La.get(a),set:(o,n)=>{var t;const i={domain:(null==e?void 0:e.forRootDomain)?Ra():void 0,expires:null!==(t=null==e?void 0:e.expires)&&void 0!==t?t:7};La.set(`${a}${o}`,n,i)},remove:e=>La.remove(`${a}${e}`)}))("dmp-FE-cookie-",{forRootDomain:!0}),this.localStorageConnect=Pa(i)}},ae=new class{constructor(){Ua(this,"localStorageConnect",void 0),Ua(this,"getArgsList",(()=>{try{var a;return JSON.parse(null!==(a=this.localStorageConnect.get("resendingEventArgs"))&&void 0!==a?a:"[]")}catch(a){return[]}})),Ua(this,"setArgsList",(a=>{try{this.localStorageConnect.set("resendingEventArgs",JSON.stringify(a))}catch(a){return}})),Ua(this,"addArgs",(a=>{try{const e=this.getArgsList();e.push(a),this.setArgsList(e)}catch(a){return}}));var a=this;Ua(this,"send",function(){var e,o=(e=function*(e,...o){try{rhrow a.addArgs(o),e}},function(){var a=this,o=arguments;return new Promise((function(n,t){var i=e.apply(a,o);function r(a){Ma(i,n,t,r,s,"next",a)}function s(a){Ma(i,n,t,r,s,"throw",a)}r(void 0)}))});return function(a){return o.apply(this,arguments)}}()),Ua(this,"resend",(a=>{const e=[],o=this.getArgsList();try{for(;o.length>0;){const n=o.shift();if(!n)break;e.push(a(...n))}return Ia(e)} za,oe=new class{constructor(){qa(this,"localStorageConnect",void 0),qa(this,"getDefinitionIds",(()=>{const a=this.localStorageConnect.get("prevDefinitionsIds"),e=a&&a.length?a.split(";"):[],o=a&&a.length?a.split(","):[];return e.length>o.length?e:o})),qa(this,"setDefinitionIds",(a=>{this.localStorageConnect.set("prevDefinitionsIds",a.join(","))})),this.localStorageConnect=Pa(i)}},ne=new class{constructor(a={}){Fa(this,"config",{hosts:[],targets:[]}),Fa(this,"listeners",{}),Fa(this,"deferredMessages",new $a),Fa(his.logger.enabled}get databaseConnect(){var a;return null===(a=this.getDatabase)||void 0===a?void 0:a.call(this)}get rawConfigJson(){return this.externalConfigJson||'{"uuid":"bc8a7a32-7d98-4226-8af9-d2a43a8621cc","fieldExtractions":[{"uuid":"554e1711-910b-473c-ae03-9f7044d59996","field":{"name":"Author","path":"properties.author","type":"STRING"},"type":"JAVASCRIPT","expression":"const all = document.querySelectorAll(\\\"script[type=\\\\\\\"application\\/ld+json\\\\\\\"]\\\");const r = JSON.parse(all[1].innerHTML);return r.author.name;"},{"uuid":"43719d3b-ee5c-4155-b56b-8dd5f640d850","field":{"name":"Category","path":"properties.category","type":"STRING"},"type":"JAVASCRIPT","expression":"const { vertical_eng_name, categoryName } = window.dataLayer.find(i => i.vertical_eng_name || i.categoryName);return `${vertical_eng_name}\\/${categoryName}`;"},{"uuid":"373cec89-3d2e-4513-8c4f-040d4011b096","field":{"name":"Tags","path":"properties.tags","type":"ARRAY_OF_STRING"},"type":"JAVASCRIPT","expression":"const { tags } = window.dataLayer.find(i => i.tags); return tags.slice(17,tags.length);"}],"p9-cd6ea4404816","type":"CATEGORY_EQUALS","expression":"homepage/"},{"uuid":"062339fa-62a7-4301-9138-54425266333e","type":"URL_CONTAINS","expression":"news.walla"},{"uuid":"09c23630-ddea-42f8-aaa3-254afaa9d75f","type":"URL_EXACTLY_MATCH","expression":"https://www.walla.co.il/"},{"uuid":"28ac311c-2692-4283-a05a-982c992c1513","type":"URL_EXACTLY_MATCH","expression":"https://www.walla.co.il"}],"isDataCollectionEnabled":true,"isDFPActivationEnabled":true,"providerMonitoring":{"uuid":"bc8a7a32-7d98-4226-8af9-d2a43a8621cc","enabled":false,"verboseMode":"ERRORS","sampling":null,"observedUserId":null,"includeDatabase":false,"includeLocalStorage":false,"includeLoggerState":false}}'}constructor(a={}){Za(this,"logger",void 0),Za(this,"config",void 0),Za(this,"getUser",void 0),Za(this,"getDatabase",void 0),Za(this,"getDefinition",void 0),Za(this,"logHistory",[]),Za(this,"verbose",Ka.ALL),Za(this,"observedId",void 0),Za(this,"externalConfigJson",void 0),Za(this,"setAndValidateConfig",(()=>{try{const{providerMonitoring:a}=JSON.parse(this.rawConfigJson);if(!a)return this.logger.log("Config is empty");const e=isFinite(a.sampling)&&a.sampling>=0&&a.sampling<=100,o=Object.values(Ka).includes(a.verboseMode);if(!(e&&o&&(0,E.isBoolean)(a.enabled)&&(0,E.isBoolean)(a.includeDatabase)&&(0,E.isBoolean)(a.includeLoggerState)&&(0,E.isBoolean)(a.includeLocalStorage)))return this.logger.error("DMP monitoring config has wrong params:",`isValidSampling: ${e}`,`isValidVerboseMode: ${o}`,`config.enabled: ${a.enabled}`,`config.includeDatabase: ${a.includeDatabase}`,`config.includeLoggerState: ${a.includeLoggerState}`,`config.includeLocalStorage: ${a.includeLocalStorage}`);this.config=a}catch(a){this.logger.error("DMP mog",this.rawConfigJson)}})),Za(this,"getVerboseLevel",(a=>{var e;return null!==(e=Ya[a])&&void 0!==e?e:0})),Za(this,"setVerbose",(a=>{this.getVerboseLevel(a)>this.getVerboseLevel(this.verbose)&&(this.verbose=a)})),Za(this,"matchd",(()=>!(!this.observedId||!this.config)&&(this.config.observedUserId?this.config.observedUserId===this.observedId:!this.config.sampling||((a,e)=>{const o=(a=>BigInt("0x"+a.replace(/-/g,"")))(a)%BigInt(e);return Number(o.toString())})(this.observedId,100)<=this.config.sampling))),Za(this,"addToLogHistory",((...a)=>{try{const e=a.map((a=>JSON.stringify(a))).join(" ");this.logHistory.push(e)}catch(a){this.logger.error("addToLogHistory error",a)}}));var e=this;Za(this,"getDatabaseState",Xa((function*(){try{if(!e.databaseConnect)return"Database connect is wrong";const a=yield e.databaseConnect.getEvents(),o=yield e.databaseConnect.getDefinitions();return{events:JSON.stringify(a),definitions:JSON.stringify(o)}}catch(a){return`getDatabaseState error: ${a}`}}))),Za(this,"getLocalstorageState",(()=>{try{var a,e,o,n,t;const{dmpid:r="",ts:s=""}=null!==(t=null===(e=this.getUser)||void 0===e||null===(a=e.call(this))||void 0===a?void 0:a.getUserState())&&void 0!==t?t:{};var i;return{userId:r,lastModifiedDate:s,prevDefinitionsIds:null!==(i=null===(n=this.getDefinition)||void 0===n||null===(o=n.call(this))||void 0===o?void 0:o.getDefinitionIds().join(","))&&void 0!==i?i:""}}catch(a){return`getLocalstorageState error: ${a}`}})),Za(this,"log",((....a),this.setVerbose(Ka.WARNINGS),this.addToLogHistory(...a)})),Za(this,"error",((...a)=>{this.logger.error(...a),this.setVerbose(Ka.ERRORS),this.addToLogHistory(...a)})),Za(this,"setObservedId",(a=>{this.observedId=a})),Za(this,"sendData",Xa((function*(a={}){try{((a,e,o)=>{if(navigator.sendBeacon&&"undefined"!=typeof Blob){const o=new Blob([JSON.stringify(e)],{type:"application/json"});if(navigator.sendBeacon(a,o))return}null==o||o()})(n,a,(()=>P(n,{body:a})))}catch(a){return}})));var o=this;Za(this,"complete",Xa((function*(a={}){if(!o.config)return o.logger.error("DMP monitoring config is missing");if(!o.config.enabled)return o.logger.log("!enabled");if(o.getVerboseLevel(o.config.verboseMode)>o.getVerboseLevel(o.verbose))return o.logger.log("!verbose level");if(!o.matchBySamplingAndUserId())return;const e={additionalData:a};return o.config.includeDatabase&&(e.database=yield o.getDatabaseState()),o.config.includeLocalStorage&&(e.localstorage=o.getLocalstorageState()),o.config.includeLoggerState&&(e.loggerLog=o.logHistory),o.sendData(e)}))),this.logger=new Ha({enableKey:a.enableKey,prefix:a.loggerPrefix,withTimestamp:!0}),this.getUser=a.getUser,this.getDatabase=a.getDatabase,this.getDefinition=a.getDefinition,this.externalConfeConfig()}}({enableKey:"enableDmpPublisherDebug",loggerPrefix:"[DMP monitoring, platform: Web, version: 2.0.1, label: Publisher]",getUser:()=>Qa,getDatabase:()=>ee,getDefinition:()=>oe}),ie=new class{get user(){return this.config.user}get resender(){return this.config.resender}get database(){return this.config.database}get definition(){return this.config.definition}get frameConnector(){return this.config.frameConnector}get monitoring(){return this.config.monitoring}get dmpProviderUuid(){return this.providerConfig.uuid||window.dmpProviderUuid}constructor(a){Sa(this,"config",void 0),Sa(this,"providerConfig",void 0),Sa(this,"events",void 0),Sa(this,"definitions",void 0),Sa(this,"fallbackEventIds",void 0),Sa(this,"keepedEvents",void 0),Sa(this,"initFrameConnectorListeners",void 0),Sa(this,"initLinkClickListener",void 0),Sa(this,"initSlotClickListener",void 0),Sa(this,"getDeletedEventIds",void 0),Sa(this,"sendStatisticEvents",void 0),Sa(this,"setEventsAndDefinitions",void 0),Sa(this,"setGoogleTagDefinitions",void 0),Sa(this,"mergeData",void 0),Sa(this,"runDefinitionActivations",void 0),Sa(this,"updateMatchedData",void 0),Sa(this,"preparingEvents",void 0),Sa(this,"sendEvent",void 0),Sa(this,"processEvent",void 0),Sa(this,"resendFailedEvents",void 0),Sa(this,"initCommonDMP",void 0),Sa(this,"init",void 0),Sa(this,"runPageViewEvent",void 0),Sa(this,"runLinkClickEvent",void 0),Sa(this,"runNativeClickEvent",void 0),Sa(this,"runSlotClickEvent",void 0),this.config=a,this.events=[],this.definitions=[],this.fallbackEventIds=[],this.keepedEvents=[],this.initFrameConnectorListeners=()=>{var a=this;this.frameConnector.addListener({type:r.READY,callback:function(){var e=Oa((function*(e){a.monitoring.log("start merge events from common database"),yield a.database.mergeEvents(e.filter((e=>!a.fallbackEventIds.includes(e.computedId)))),a.monitoring.log("end merge events from common database")}));return function(a){return e.apply(this,arguments)}}()})},this.initLinkClickListener=()=>{document.addEventListener("click",(a=>{try{var e;const o=null===(e=a.target)||void 0===e?void 0:e.closest("a");if(!o)return;const n=(a=>{var e,o,n;const t=null!==(n=null!==(o=null!==(e=(a=>{var e;if(a&&_a(a))return null===(e=a.querySelector(".branding"))||void 0===e?void 0:e.textContent})(a))&&void 0!==e?e:(a=>{var e;return null==a||null===(e=a.querySelector(".ob-rec-source"))||void 0===e?void 0:e.textContent})(a))&&void 0!==o?o:null==a?void 0:a.getAttribute(wa.USRC))&&void 0!==n?n:void 0;var i,r,s;const u=null!==(s=null!==(r=null!==(i=(a=>{if(a&&_a(a))return a.getAttribute(wa.TITLE)})(a))&&void 0!==i?i:(a=>{var e;return null==a||null===(e=a.querySelector(".ob-rec-text"))||void 0===e?void 0:e.textContent})(a))&&void 0!==r?r:null==a?void 0:a.getAttribute(wa.UTITLE))&&void 0!==s?s:void 0;return{unitSource:t,unitTitle:u,clickUrl:null==a?void 0:a.href}})(o);return this.monitoring.log("click on link",o,n),((a,e)=>!!(e.unitTitle||e.unitSourcosest(".trc_rbox .trc_rbox_outer .trc_rbox_div .trc_spotlight_item"))||(null==a?void 0:a.closest(".OUTBRAIN ul.ob-widget-items-container > li"))))(o,n)?this.runNativeClickEvent(n):this.runLinkClickEvent(n)}catch(a){this.monitoring.error("click listener error",a)}}),!1)},this.initSlotClickListener=()=>{var a,e;null===(e=window.googletag)||void 0===e||null===(a=e.pubads)||void 0===a||a.call(e).addEventListener("slotRenderEnded",(a=>{try{var e;const o=a.slot.getSlotId().getId(),n=document.querySelector(`iframe[id*="${o}"]`);this.monitoring.log("slotRenderEnded",o,n),null==n||null===(e=n.contentDocument)||void 0===e||e.addEventListener("click",(()=>{return this.monitoring.log("click on slot",a),this.runSlotClickEvent({advertiserId:null!==(c=null==(e=a)||null===(o=e.advertiserId)||void 0===o?void 0:o.toString())&&void 0!==c?c:void 0,campaignId:null!==(m=null==e?void 0:e.campaignId)&&void 0!==m?m:void 0,creativeId:null!==(l=null==e?void 0:e.creativeId)&&void 0!==l?l:void 0,width:null!==(p=null==e||null===(n=e.size)||void 0===n?void 0:n[0])&&void 0!==p?p:void 0,height:null!==(g=null==e||null===(t=e.size)||void 0===t?void 0:t[1])&&void 0!==g?g:void 0,lineItemId:null!==(d=null==e||null===(i=e.lineItemId)||void 0===i?void 0:i.toString())&&void 0!==d?d:void 0,serviceName:null!==(h=null==e||null===(r=e.serviceName)||void 0===r?void 0:r.toString())&&void 0!==h?h:void 0,slot:{adUnitPath:null!==(f=null==e||null===(s=e.slot.getAdUnitPath())||void 0===s?void 0:s.toString())&&void 0!==f?f:void 0,slotElementId:null!==(k=null==e||null===(u=e.slot.getSlotElementId())||void 0===u?void 0:u.toString())&&void 0!==k?k:void 0}});var e,o,n,t,i,r,s,u,c,m,l,p,g,d,h,f,k}),!1)}catch(e){this.monitoring.error(`initSlotClickListener error for slot ${a}`)}}))},this.getDeletedEventIds=(a=[])=>{try{return this.events.filter((e=>a.includes(e.defId))).map((a=>a.computedId))}catch(a){return this.monitoring.error("getDeletedEventIds",a),[]}};var o=this;this.sendStatisticEvents=function(){var a=Oa((function*(a,e){try{if(!o.dmpProviderUuid)return void o.monitoring.error("No required event params: dmpProviderUuid");const{dmpid:n,ts:t}=o.user.getUserState(),i=o.definition.getDefinitionIds(),r=a.filter((a=>a.debugEnabled)).map((a=>a.code)),s=e.filter((a=>a.debugEnabled)).map((a=>a.code));o.monitoring.log("Enter debug definitions:",r),o.monitoring.log("Exit debug definitions:",s);const u={userId:n,providerId:o.dmpProviderUuid,actualAudienceCodes:i,properties:S(window)};r.forEach((a=>W(Da({event:l.AUDIENCE_ENTER,audienceCode:a},u),t))),s.forEach((a=>W(Da({event:l.AUDIENCE_EXIT,audienceCode:a},u),t)))}catch(a){o.monitoring.error(`Event statistic requests rejected with error ${a}`)}}));return function(e,o){return a.apply(this,arguments)}}();var n=this;this.setEventsAndDefinitions=Oa((function*(){if(!n.database)return;const[a,e]=yield Promise.all([n.database.getEvents(),n.database.getDefinitions()]);n.events=a,n.definitions=e,n.definitions.length||n.user.clearUserState()})),this.setGoogleTagDefinitions=a=>{if(!0!==this.providerConfig.isDFPActivationEnabled)return this.monitoring.warning("send data to GTM is disabled");((a,e)=>{window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[];const o=function(){var o,n;null===(o=(n=window.googletag).pubads)||void 0===o||o.call(n).setTargeting("dxseg",a),null==e||e(a)};"function"!=typeof window.googletag.cmd.unshift?window.googletag.cmd.push(o):window.googletag.cmd.unshift(o)})(a,(a=>{var e,o;this.monitoring.log("send data to GTM",a,null===(o=window.googletag)||void 0===o||null===(e=o.pubads)||void 0===e?void 0:e.call(o).getTargetingKeys())}))},this.mergeData=a=>{this.monitoring.log("start merge data"),this.events=this.database.getMergedEvents(this.database.convertResponseEventsToDatabaseEvents(a.events),this.events).allEvents,this.definitions=[...(0,E.differenceBy)(this.definitions,a.definitions,(a=>a.defId)),...a.definitions],this.monitoring.log("end merge data")},this.runDefinitionActivations=a=>{a.forEach((a=>{var e;null===(e=a.activations)||void 0===e||e.forEach((e=>{G(e.scriptUrl,(o=>{this.monitoring.warning(`Run user activation is failed, def: ${a.uuid}, defCode: ${a.code}, activation: ${e}`,o)}))}))}))},this.updateMatchedData=a=>{this.definition.setDefinitionIds(a),this.setGoogleTagDefinitions(a),R(`${e}?audids=${a.join(",")}`,{credentials:"include"})},this.preparingEvents=()=>{const{fallbackEventIds:a,keepedEvents:e}=this.events.reduce(((a,e)=>{const o=this.definitions.find((a=>a.defId===e.defId));return o?o.type!==g.CURRENT_PAGE&&a.keepedEvents.push(e):a.fallbackEventIds.push(e.computedId),a}),{fallbackEventIds:[],keepedEvents:[]});this.keepedEvents=e,this.fallbackEventIds=a};var i=this;this.sendEvent=function(){var a=Oa((function*(a,e){try{if(i.monitoring.log("start event"),!i.dmpProviderUuid)return void i.monitoring.error("No required event params: dmpProviderUuid");const{dmpid:o,ts:n}=i.user.getUserState();i.monitoring.setObservedId(o),i.monitoring.log("start collection page data");const t=((a,e={})=>{const o=(a=>{const e=a.document.getElementsByTagName("meta"),o=e.namedItem("author"),n=e.namedItem("category"),t=e.namedItem("description");return{url:a.location.href,title:a.document.title,domain:a.location.origin,author:o?o.content:"",category:n?n.content:"",description:t?t.content:"",tags:x(a.siteId,a.document)}})(window)||{},n=((a,e)=>(null==e?void 0:e.length)?e.reduce(((e,o)=>{let n;try{switch(o.type){case b.URL_REGEX:var t;n=O(null===(t=a.location.href.match(new RegExp(o.expression,"g")))||void 0===t?void 0:t.join(","),o.field.type);break;case b.GLOBAL_VARIABLE:n=O((0,E.get)(a,o.expression),o.field.type);break;case b.META_NAME:var i,r;n=O(null!==(r=null===(i=a.document.querySelector(`meta[name=${o.expression}]`))||void 0===i?void 0:i.getAttribute("content"))&&void 0!==r?r:"",o.field.type);break;case b.META_PROPERTY:var s,u;n=O(null!==(u=null===(s=a.document.querySelector(`meta[property=${o.expression}]`))||void 0===s?void 0:s.getAttribute("content"))&&void 0!==u?u:"",o.field.type);break;case b.JAVASCRIPT:var c;n=O(null!==(c=new Function(o.expression).call(a))&&void 0!==c?c:"",o.field.type)}(0,E.set)(e,o.field.path,n)}catch(a){}return e}),{}):{})(window,a),t=S(window);return(0,E.merge)({properties:A({},o,t,e)},n)})(i.providerConfig.fieldExtractions,e),r=a===m.PAGE_VIEW&&(a=>{try{const{pageData:e,providerExclusions:o=[],location:n=`${window.location.origin}${window.location.pathname}`}=a;return o.some((a=>{switch(a.type){case y.URL_CONTAINS:var o;return!!(null===(o=n.match(new RegExp(a.expression)))||void 0===o?void 0:o.length);case y.URL_EXACTLY_MATCH:return n.toLowerCase().trim()===a.expression.toLowerCase().trim();case y.CATEGORY_EQUALS:var t;return(null===(t=e.properties.category)||void 0===t?void 0:t.toLowerCase().trim())===a.expression.toLowerCase().trim()}}))}catch(o){var e;return null===(e=a.logger)||void 0===e||e.error("isIgnoreEvents function error",o),!1}})({pageData:t,providerExclusions:i.providerConfig.providerExclusions});if(r){i.monitoring.log("send event is disabled for this page",window.location);const a={userId:null!=o?o:"",action:p.UPDATE,events:[],definitions:[],deletedDefinitionIds:[],lastModifiedTimestamp:n?Number(n):0};return i.monitoring.log("skipped send event mock response",a),a}i.monitoring.log(`start event request: ${a}`);const s=yield i.resender.send($,a,i.dmpProviderUuid,t,n,o);return i.monitoring.log(`end event request: ${a}`),s}catch(e){i.monitoring.error(`Event ${a} rejected with error ${e}`)}}));return function(e,o){return a.apply(this,arguments)}}();var s=this;this.processEvent=function(){var a=Oa((function*(a){try{const{dmpid:u,ts:m}=s.user.getUserState();if(!a)return s.monitoring.error(`Server response is wrong: providerId - ${s.dmpProviderUuid}, userId - ${u}`);s.mergeData(a),s.monitoring.log("start matching definitions");const l=Z(s.events,s.definitions).map((a=>a.code));s.monitoring.warning(`Matched definitions ids: ${l}`);const{enterDefinitions:p,exitDefinitions:g}=(n=s.definition.getDefinitionIds(),t=l,i=s.definitions,{enterDefinitions:Q(n,t,i),exitDefinitions:Q(t,n,i)});s.runDefinitionActivations(p),s.sendStatisticEvents(p,g),s.updateMatchedData(l),s.preparingEvents();const d=(e=Da({},a),o=null!=(o={events:s.keepedEvents,deletedEventIds:s.getDeletedEventIds(a.deletedDefinitionIds),fallbackEventIds:s.fallbackEventIds})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):function(a,e){var o=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);o.push.apply(o,n)}return o}(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})),e);s.monitoring.log("start update database"),yield s.database.updateData(d),s.monitoring.log("end update database"),s.monitoring.log("start set user state to local storage"),s.user.setUserState(d),s.monitoring.setObservedId(d.userId),s.monitoring.log("end set user state to local storage"),s.fallbackEventIds.length&&(s.user.clearUserLastTimestamp(),s.monitoring.warning(`Fallback definitions ids: ${s.fallbackEventIds}`),s.monitoring.sendData({fallbackEventIds:s.fallbackEventIds,buildVersionTime:1706259754320,currentDefinitionIds:s.definitions.map((a=>a.defId)),currentEventsIds:s.events.map((a=>a.computedId)),requestUserId:u,requestLastModifiedTimestamp:m,responseUserId:a.userId,responseLastModifiedTimestamp:a.lastModifiedTimestamp,responseDefinitionIds:a.definitions.map((a=>a.defId)),responseDeletedDefinitionIds:a.deletedDefinitionIds,responseEventIds:a.events.map((a=>za.getEventComputedId(a)))})),s.monitoring.log("end event"),s.frameConnector.sendMessage({type:c.UPDATE_DATA,payload:{events:yield s.database.getEvents(),definitions:yield s.database.getDefinitions(),deletedDefinitionIds:d.deletedDefinitionIds,deletedEventIds:d.deletedEventIds,fallbackEventIds:d.fallbackEvion:d.action}},r.READY),s.monitoring.complete()}catch(a){s.monitoring.error(`Event proccess failed with error ${a}`),s.monitoring.complete()}var e,o,n,t,i}));return function(e){return a.apply(this,arguments)}}();var u=this;this.resendFailedEvents=Oa((function*(){try{u.monitoring.log("Start resend failed events");const a=yield u.resender.resend($);return u.monitoring.log("End resend failed events"),a}catch(a){return u.monitoring.error(`Resend events proccess failed with error ${a}`),u.monitoring.complete(),[]}})),this.initCommonDMP=()=>{this.monitoring.log("start create common frame");const a=document.createElement("iframe");a.name=t;const{dmpid:e=""}=this.user.getUserState(),o=new URL("https://cf.dxmcdn.com/dta/dmp-common-iframe.html");o.searchParams.append("dmpid",e),o.searchParams.append("monitoringConfig",this.monitoring.rawConfigJson),this.monitoring.isLoggerEnabled&&o.searchParams.append("enableDmpCommonDebug","true"),a.src=o.href,((a,e)=>{for(const n in e){var o;a&&(a.style[n]=null!==(o=e[n])&&void 0!==o?o:"")}})(a,{position:"fixed",width:"0px",height:"0px",left:"-9999px"}),document.body.appendChild(a),this.monitoring.log("end create common frame")};var d=this;this.init=Oa((function*(){try{const e=yield d.resendFailedEvents(),[o]=yield Promise.all([d.sendEvent(m.PAGE_VIEW),F().then((a=>{a&&a.length&&(d.setGoogleTagDefinitions(a),d.monitoring.log("defaultAudiences",a))})).catch((a=>(d.monitoring.error("getDefaultAudiences failed",a),[]))),d.database.createConnect().then(d.setEventsAndDefinitions)]);yield Ia([...e.map((a=>d.processEvent(a))),d.processEvent(o)]),d.initLinkClickListener(),d.initSlotClickListener(),d.initFrameConnectorListeners(),d.monitoring.log("document.readyState",document.readyState),a=d.initCommonDMP,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{a()}),{once:!0}):a(),d.monitoring.complete()}catch(a){d.monitoring.error(`init error: ${a}`),d.monitoring.complete()}var a}));var h=this;this.runPageViewEvent=Oa((function*(){const a=yield h.sendEvent(m.PAGE_VIEW);yield h.processEvent(a)}));var f=this;this.runLinkClickEvent=function(){var a=Oa((function*(a){const e=yield f.sendEvent(m.LINK_CLICK,Da({},a));yield f.processEvent(e)}));return function(e){return a.apply(this,arguments)}}();var k=this;this.runNativeClickEvent=function(){var a=Oa((function*(a){const e=yield k.sendEvent(m.NATIVE_OCLICK,Da({},a));yield k.processEvent(e)}));return function(e){return a.apply(this,arguments)}}();var j=this;this.runSlotClickEvent=function(){var a=Oa((function*(a){const e=yield j.sendEvent(m.SLOT_CLICK,Da({},a));yield j.processEvent(e)}));return function(e){return a.apply(this,arguments)}}(),this.monitoring.log("getProviderConfig called"),this.providerConfig=(a=>{a.log("[DMP injected]: Parse activation config start");try{const e=JSON.parse('{"uuid":"bc8a7a32-7d98-4226-8af9-d2a43a8621cc","fieldExtractions":[{"uuid":"554e1711-910b-473c-ae03-9f7044d59996","field":{"name":"Author","path":"properties.author","type":"STRING"},"type":"JAVASCRIPT","expression":"const all = document.querySelectorAll(\\\"script[type=\\\\\\\"application\\/ld+json\\\\\\\"]\\\");const r = JSON.parse(all[1].innerHTML);return r.author.name;"},{"uuid":"43719d3b-ee5c-4155-b56b-8dd5f640d850","field":{"name":"Category","path":"properties.category","type":"STRING"},"type":"JAVASCRIPT","expression":"const { vertical_eng_name, categoryName } = window.dataLayer.find(i => i.vertical_eng_name || i.categoryName);return `${vertical_eng_name}\\/${categoryName}`;"},{"uuid":"373cec89-3d2e-4513-8c4f-040d4011b096","field":{"name":"Tags","path":"properties.tags","type":"ARRAY_OF_STRING"},"type":"JAVASCRIPT","expression":"const { tags } = window.dataLayer.find(i => i.tags); return tags.slice(17,tags.length);"}],"providerExclusions":[{"uuid":"a6d254f6-7403-4210-b1b9-cd6ea4404816","type":"CATEGORY_EQUALS","expression":"homepage/"},{"uuid":"062339fa-62a7-4301-9138-54425266333e","type":"URL_CONTAINS","expression":"news.walla"},{"uuid":"09c23630-ddea-42f8-aaa3-254afaa9d75f","type":"URL_EXACTLY_MATCH","expression":"https://www.walla.co.il/"},{"uuid":"28ac311c-2692-4283-a05a-982c992c1513","type":"URL_EXACTLY_MATCH","expression":"https://www.walla.co.il"}],"isDataCollectionEnabled":true,"isDFPActivationEnabled":true,"providerMonitoring":{"uuid":"bc8a7a32-7d98-4226-8af9-d2a43a8621cc","enabled":false,"verboseMode":"ERRORS","sampling":null,"observedUserId":null,"includeDatabase":false,"includeLocalStorage":false,"includeLoggerState":false}}');return a.log("[DMP injected]: Activation config is valid",e),e}catch(e){return a.error("[DMP injected]: Activation config is broken",e),{}}})(this.config.monitoring)}}({user:Qa,resender:ae,database:ee,definition:oe,frameConnector:ne,monitoring:te});window.dmp?window.dmp.setPublisherDMP(ie):(te.error("dmpGlobalState is missing"),te.complete())})()})();