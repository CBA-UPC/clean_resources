/*! For license information please see rai-trailer-player.js.LICENSE.txt */
!{0:1:function(t,e,i){"use strict";i.d(e,"h",(function(){return u})),i.d(e,"a",(function(){return c})),i.d(e,"b",(function(){return h})),i.d(e,"e",(function(){return p})),i.d(e,"c",(function(){return g})),i.d(e,"f",(function(){return y})),i.d(e,"g",(function(){return _})),i.d(e,"d",(function(){return f}));var r=i(10),s=i(7),a=i(2),n=i(14),o=i(13),l=i(0);const u=d=!1;(();onst M=,10:102:103:11:12:123:function(t,e,i){"use strict";i.r(e);var r=i(4);const s=100,a=2,n=2e3,o=500,l=3,u={style:"dark",text:"Vuoi riattivare l’autoplay delle anteprime su questo dispositivo?",buttons:[{label:"Solo per questo contenuto",event:"trailer:play-content",style:"default"},{label:"Sì, su tutti i contenuti",event:"trailer:allow-autoplay",style:"primary"}],close:{label:"Chiudi la finestra"}};i(102);class d extends r.a{static get propert}}constructor(){super(),this.src="",this.imagesrc="",this.images={},this.active=!1,this.is_hero=!1,this._manageEndedTrailer=this._manageEndedTrailer.bind(this),this._manageEndingTrailer=this._manageEndingTrailer.bind(this),this._startPlayback=this._startPlayback.bind(this),this._allowPlayAndStartPlayback=this._allowPlayAndStartPlayback.bind(this),this._allowAutoplayAndStartPlayback=this._allowAutoplayAndStartPlayback.bind(this),this._refreshUserSettings=this._refreshUserSettings.bind(this),this._status="stopped",this._isMuted=!0,this._isPlaying=!1,this._isListenerAdded=!1,this._userSettings={autoplay_preview:!0,audio:!0},this._trailerID="TP"+Math.floor(1e4*Math.random())}get player(){return this.querySelector(".trailer__video video")}get image(){return this.querySelector(".trailer__image")}get audioToggler(){return this.querySelector(".trailer__toggler")}get audioTogglerTooltip(){return this.querySelector(".trailer__tooltip--toggler)}get trailerButton(){return this.querySelector(".trailer__buttons)}get profileManager(){return window.Rai.ProfileManager}get settingsManager(){return window.Rai.SettingsManage}get userID(){const t=this.profileManager.getUserProfile();return(null==t?void 0:t.uid)||"unknows}connectedCallback(){super.connectedCallback(),document.addEventListener("trailer:play-content",this._allowPlayAndStartPlayback),document.addEventListener("trailer:allow-autoplay",this._allowAutoplayAndStartPlayback),document.addEventListener("raissoUserLogin",this._refreshUserSettings)}disconnectedCallback(){var t,e;super.disconnectedCallback(),null===(t=this.player)||void 0===t||t.removeEventListener("ended",this._manageEndedTrailer),null===(e=this.player)||void 0===e||e.removeEventListener("timeupdate",this._manageEndingTrailer),document.removeEventListener("trailer:play-content",this._allowPlayAndStartPlayback),document.removeEventListener("trailer:allow-autoplay",this._allowAutoplayAndStartPlayback),document.removeEventListener("raissoUserLogin",this._refreshUserSettings)}firstUpdated(t){super.firstUpdated(t),this._updateClassStatus("stopped"),this.is_hero&&this._heroTrailerObserver()}attributeChangedCallback(t,e,i){if(e!==i)switch(super.attributeChangedCallback(t,e,i),t){case"src":null!==i&&this._setNewSource(i);break;case"imagesrc":null!==i&&this._setNewImage(i);break;case"active":"false"===i?this._stopPlaying(!1):"true"===i&&this._setPlayer();break;case"paused":"true"===i?this._pausePlaying():"false"===i&&this._resumePlaying()}}updated(t){super.updated(t),this.is_hero&&this._heroTrailerObserver)}async _getUserSettings(){var t;let e=await(null===(t=this.settingsManager)||void 0===t?void 0:t.getUser(this.userID));return e=e||await this._createUserSettings(),e}async _createUserSettings(){var t,e;return await(null===(t=this.settingsManager)||void 0===t?void 0:t.addUser(this.userID)),await(null===(e=this.settingsManager)||void 0===e?void 0:e.getUser(this.userID))}async _setPlayer(){const t=await this._isAutoplayDisabled();setTimeo)},2e3),this.trailerPlayablePromise.then(async()=>{t||this._isPlaying||this._checkSrcAndStartPlayback()})}async _isAutoplayDisabled(){return this._userSettings=await this._getUserSettings(),!this._userSettings.autoplay_preview}_checkSrcAndStartPlayback(){var t,e,i;const r=null===(t=this.player)||void 0===t?void 0:t.getAttribute("data-src");if(r){var s,a;if(null===(e=this.player)||void 0===e||e.setAttribute("src",r),!this._isListenerAdded)null===(s=this.player)||void 0===s||s.addEventListener("ended",this._manageEndedTrailer),null===(a=this.player)||void 0===a||a.addEventListener("timeupdate",this._manageEndingTrailer),this._isListenerAdded=!0;if(0===(null===(i=this.player)||void 0===i?void 0:i.readyState)){const t=()=>{var e,i,r;(null!==(e=null===(i=this.player)||void 0===i?void 0:i.readyState)&&void 0!==e?e:0)>=2&&(null===(r=this.player)||void 0===r||r.removeEventListener("loadeddata",t),this._startPlayback())};this.player.addEventListener("loadeddata",t)}else this._startPlayback()}}_onLoadingProgress(){this.player.buffered.end(this.player.buffered.length-1)/this.player.duration*100>=10&&(this.player.removeEventListener("progress",this._onLoadingProgress),this._startPlayback())}_hideImage(t){var e;null===(e=this.image)||void 0===e||e.classList.toggle("faded--out",t)}_handleStartPlayback(t){t.stopPropagation(),t.preventDefault(),document.dispatchEvent(new CustomEvent("rai:floorad-close-request")),this._checkAutoplayAndStartPlayback()}async _checkAutoplayAndStartPlayback(){if(await this._isAutoplayDisabled()){if(this._getPlayedCounter()>=l){u.buttons.mD});const t=new CustomEvent("dialog-config",{detail:{config:u}});await import("/assets/js/wecomponents/rai-dialog.js").then(()=>{let e=document.querySelector("rai-dialog");e||(e=document.createElement("rai-dialog"),document.body.append(e)),document.dispatchEvent(t)})}else this._checkSrcAndStartPlayback()}else this._checkSrcAndStartPlayback()}_setNewSou}_updatePlayedCounter(){let t=this._getPlayedCounter();const e="trailer:trailers_played:"+this.userID;sessionStorage.setItem(e,(++t).toString())}_getPlayedCounter(){const t="trailer:trailers_played:"+this.userID;return sessionStorage.getItem(t)?parseInt(sessionStorage.getItem(t)):(sessionStorage.setItem(t,"0"),0)}async _startPlayback(){var t,e;if(!this.player||this._isPlaying)return;this._updateClassStatus("stopped");const i=await this._isAutoplayDisabled(),r=await this._getMutedStatus();this._isPlaying=!0;const s=i?o:n;null===(t=this.player)||void 0===t||t.addEventListener("waiting",this._handleBufferingPlayer.bind(this)),null===(e=this.player)||void 0===e||e.addEventListener("playing",this._handlePlayingPlayer.bind(this)),setTimeout(async()=>{this.player&&(this.player.currentTime=0,this._isMuted=r,this._setPlayerMutedStatus(r),this._changeAudioIcon(r),this._playVideo(),r&&this._incresePlayerVolume(),this._updateClassStatus("playing"),i&&this._updatePlayedCounter())},s)}_allowPlayAndStartPlayback(t){var e;(null==t||null===(e=t.detail)||void 0===e?void 0:e.content_id)===this._trailerID&&this._checkSrcAndStartPlayback()}_allowAutoplayAndStartPlayback(){this.settingsManager.editUser({uid_utente:this.userID,autoplay_preview:!0}),this._checkSrcAndStartPlayback()}async _playVideo(){if(this.player)try{await this.player.play()}catch(t){this._isMuted=!0,this.player.muted=!0,this._changeAudioIcon(this._isMuted),this.player.play()}}_handleRestartPlayback(t){t.stopPropagation(),t.preventDefault(),this._updateClassStatus("stopped"),this._startPlayback()}async _resumePlaying(){if(!this.player||"stopped"!==this._status)return;const t=await this._getMutedStatus();this._isMuted=t,this._setPlayerMutedStatus(t),this._changeAudioIcon(t),this._playVideo(),this._updateClassStatus("playing"),t||this._incresePlayerVolume()}_stopPlaying(t){var e,i;this.player&&(this._isPlaying=!1,null===(e=this.player)||void 0===e||e.removeEventListener("waiting",this._handleBufferingPlayer.bind(this)),null===(i=this.player)||void 0===i||i.removeEventListener("playing",this._handlePlayingPlayer.bind(this)),t?(this.player.pause(),this.player.currentTime=0,this._updateClassStatus("paused")):(this._decreasePlayerVolume().th)}),this._updateClassStatus("stopped")))}_fadeAndStopPlaying(){this._decreasePlayerVolume().then(()=>{this.player&&(this.player.pause(),this.player.currentTime=0,this._updateClassStatus("paused"),this._isPlaying=!1)})}_pausePlaying(){this._isPlaying&&(this._updateClassStatus("stopped"),this._decreasePlayerVolume().th)})}_manageEndingTrailer(){this.player&&this.player.currentTime>=this.player.duration-a&&this._fadeAndStopPlaying()}_handleBufferingPlayer(){this.classList.add("trailer--buffering"),this.classList.remove("trailer--playing)}async _getMutedStatus(){return this._userSettings=await this._getUserSettings(),!this._userSettings.audio}_setMutedStatus(t){this.settingsManager.editUser({uid_utente:this.userID,audio:!t})}_setPlayerMutedStatus(t){this.player&&(this.player.muted!==t&&(this.player.muted=t),this._isMuted||0!==this.player.volume||(this.player.volume=1))}_handleToggleAudio(t){t.stopPropagation(),t.preventDefault(),this._isMuted=!this._isMuted,this._setPlayerMutedStatus(this._isMuted),this._setMutedStatus(this._isMuted),this._changeAudioIcon(this._isMuted)}_changeAudioIcon(t){this.player&&this.audioToggler&&(this.audioToggler.classList.toggle("trailer__toggler--muted",t),this.audioToggler.setAttribute("aria-label",t?"Attiva audio":"Disattiva audio"),this.audioToggler.innerText=t?"Attiva audio":"Disattiva audio")}_updateClassSta)}_incresePlayerVolume(){if(!this.player)return;this.player.volume=0;const t=setInterval(()=>{this.player&&(this.player.volume<1?(this.player.volume+=.1,this.player.volume=Math.round(100*this.player.volume)/100):clearInterval(t))},s)}_decreasePlayerVolume(){return new Promise(t=>{const e=setInterval(()=>{if(this.player)return this.player.volume>0?void(this.player.volume=Math.round(100*(this.player.volume-.1))/100):(clearInterval(e),t(!0))},s)})}_heroTrailerObserver(){const t=this.herobox;if(!t&&!this.trailerHeroButton)return;new IntersectionObserver(t=>{t.forEach(t=>{t.rootBounds.height>400&&t.boundingClientRect.bottom>t.rootBounds.bottom-30?this.trailerHeroButton&&(this.trailerHeroButton.style.position="fixed"):this.trailerHeroButton&&(this.trailerHeroButton.style.position="relative")})},{rootMargin:"0px 0px -30px 0px",threshold:[.4,.45,.5,.55,.6,.65,.7,.75,.8,.85,.9,.95,1]}).observe(t)}_renderRestartButton(){return r.c` <div class="trailer__button-group trailer__button-group--restart"> <button @click="${this._handleRestartPlayback}" aria-label="Restart" type="button" class="button trailer__restart">Restart anteprima</button> </div> `}_renderPlayButton(){return r.c` <div class="trailer__button-group trailer__button-group--play"> <button @click="${this._handleStartPlayback}" aria-label="Trailer" type="button" class="button trailer__play">Mostra anteprima</button> </div> `}_renderToggleAudioButton(){return r.c` <div class="trailer__button-group trailer__button-group--toggler"> <button @click="${this._handleToggleAudio}" arial-label="Gestisci audio" type="button" class="button trailer__toggler">Attiva audio</button> </div> `}_renderImage(){return r.c`<img class="trailer__image faded" src="${this.imagesrc}" alt="RaiPlay">`}_renderHeroImage(){const t=this.images||{};return t.landscape=t.landscape||t.landscape43||defaultLandscapeImg,r.c` <div class="trailer__image faded"> <picture> ${t.square?r.c` <source media="(max-width:1023px)" srcset="/cropgd/768x768${t.square}"> `:""} ${t.landscape43?r.c` <source media="(min-width:1024px) and (max-width:1439px)" srcset="/cropgd/1024x768${t.landscape43}"> `:""} ${t.landscape?r.c` <source media="(min-width:1440px)" srcset="/cropgd/1440x810${t.landscape}"> `:""} <img class="highlight--parallax" style="transform: translate3d(0px, 0px, 0px);" src="/cropgd/1440x810${t.landscape}" alt="RaiPlay"> </picture> </div>`}render(){return r.c` <div class="trailer__video" id="${this._trailerID}"> ${this.active?this._renderVideo():""} </div> ${this.is_hero?this._renderHeroImage():this._renderImage()} <div class="trailer__buttons ${this.is_hero?"trailer__buttons--hero":""}"> <div class="trailer__waiting"></div> ${this._renderPlayButton()} ${this._renderRestartButton()} ${this._renderToggleAudioButton()} </div> `}}customElements.define("rai-trailer-player",d),(new class{constructor(){this._isVideo=!1,this._isPlaybackAvailable=!1,this._isTrailerPlayable=!1,this._manageValue=this._manageValue.bind(this),this._setIntervalObserver=this._setSubscribe.bind(this)}startListen(){["flooradtype","AdStartVideo","AdEndVideo","AdError","flooradClosed","flooradDisabled","rai:adv:ad-block-detected"].forEa)}),this._setIntervalObserver=setInterval(()=>{var t,e;null!==(t=window.Rai)&&void 0!==t&&null!==(e=t.raiAdv)&&void 0!==e&&e.events$&&this._setSubscribe()},1e3),window.Rai.trailerPlayablePromise=new Promise(t=>{const e=setInterval(()=>{this._isTrailerPlayable&&(clearInterval(e),t(!0))},1e3)})}_manageValue(t){if(!t.detail)return;const e=t.detail;switch(Object.keys(t.detail)[0]){case"type":this._isVideo="video"===e.type;break;case"playback":this._isPlaybackAvailable=["end","error"].includes(e.playback);break;case"floorad":this._isPlaybackAvailable=["closed","disabled"].includes(e.floorad)}this._isTrailerPlayable=!this._isVideo||this._isVideo&&this._isPlaybackAvailable}_setSubscribe(){const t=this;window.Rai.raiAdv.events$.subscribe((function(e){const{event:i}=e;new Set(["rai:adv:ad-block-detected","flooradDisabled","flooradClosed"]).has(i)&&(t._isTrailerPlayable=!0)})),clearInterval(this._setIntervalObserver)}}).startListen()},}},}}}},3:function(t,e,i){"use strict";i.d(e,"d",(function(){return n.a})),i.d(e,"a",(function(){return r.b})),i.d(e,"b",(function(){return r.e})),i.d(e,"c",(function(){return r.g})),i.d(e,"f",(function(){return o.b})),i.d(e,"e",(function(){return l})),i.d(e,"g",(function(){return u}));var r=i(1);const s=n}};var a=i(13),n=i(10),o=(i(7),i(2),i(12));i(11),i(14),i(0);"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const l=(t,...e)=>new a.b(t,e,"html",s)s)},4:function(t,e,i){"use strict";i.d(e,"ce})),i.d(e,"d",(function(){return x})),i.d(e,"b",(function(){return C})),i.d(e,"aN}));var r=i(7),s=i()}conste}1};var l=i(12),u=i(11),d=i(14),c=i(3);const}`;let p=!0;void 0===window.ShadyCSS?p=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),p=!1);consta},y=["html","svg"],_=new Set}};window.JSCompiler_renameProper>t;const f={toAttribt},fromAttribt}}t),b={attribute:!0,type:String,converter:f,reflect:!1,hasChanged:}}S.finalized=!0;const v=Element.prototype;v.msMatchesSelector||v.webkitMatchesSelector;const A=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,w=Symbol}}constw))};(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");const D=}}N.finalized=!0,N.rend)},N.shadowRootOptions={mode:"open"}},}},}}}}});
//# sourceMappingURL=rai-trailer-player.js.map