=t.data,generate_qa(t.data)),$(".typing").remove(),showloading=!1})):"showMessage"===e.act?setTimeout(function(){reciv_newpm({sender:"a",type:"t",text:e.data,auto:!0,qaClass:1})},1e3):"assignOp"===e.act&&(asi=e.data,qaAssign=!0)),needStartForm&&"next"!==e.act&&(qaStarted=!0,setTimeout(checkStartForm,1500)),needStartForm||!onoff&&gData.hidetypingbox?$(".box-footer").hide():$("#send_form_start").length||$("#send_form_offline").length||$(".box-footer").show(),parent.window.dispatchEvent(new CustomEvent("goftino_sendMessage",{detail:{type:"answer",content:e.label}})))})}),t.on("click","#qa_goback",function(){$(this).parent().hasClass("box-qa")?$(this).remove():($(this).parent().find("br,span").remove(),qaAssign&&(asi="",qaAssign=!1)),$('[data-pmtype="qa"]').remove(),qa_log.pop(),qa_active=qaHistory[qaHistory.length-1],qaHistory.pop(),generate_qa(qa_active.qa),$(".typing").remove(),showloading=!1}),t.on("click",".uploader-box",function(){var u=$(this).parent().parent().data("uploadid");u&&($(this).hasClass("reupload")?do_uploadfile(u):uploadList.forEach(function(t,e){t[3]===u&&(uploadList.splice(e,1),$('[data-uploadid="'+u+'"]').find(".loader_spin").length&&(upload_action.abort(),resetupload()),$('[data-uploadid="'+u+'"]').remove())}))}),window.onbeforeunload=function(t){socket.close()},(lm<4||!navigator.mediaDevices||"function"!=typeof MediaRecorder)&&($("#mic").hide(),$("#box-send").removeClass("hasmic")),t.on("click",".mic_perm",function(){return avoid_send||($("#mic").removeClass("mic_perm"),navigator.mediaDevices.getUserMedia({audio:!0}).then(setupmic).catch(function(t){console.log(t),$("#mic").hide(),$("#box-send").removeClass("hasmic")})),!1}),3<lm?16e5:6e5);setInterval(function(){check_expireChat(D)},D),is_ios&&isSafari&&$(".goftino_field,#m").css({"font-size":"16px"})}),parent.window.addEventListener("click",function(){setTimeout(function(){urlMainPage!==goftino_getUrl()&&(refer=urlMainPage,checkWidgetLoader())},1e3)},!0),isSafari&&document.addEventListener("play",function(t){for(var e=document.getElementsByClassName("sfplayer"),u=0;u<e.length;u++)e[u]!==t.target&&e[u].pause()},!0),is_ios&&($(".title-name").css({"letter-spacing":"-1px"}),parent.window.addEventListener("resize",function(){$("#box-chat").is(":visible")&&(parent.document.getElementById("goftino_w").style.maxHeight=null,parent.document.getElementById("goftino_w").style.height=parent.window.innerHeight+"px")})),jQuery.event.special.touchstart={setup:function(t,e,u){this.addEventListener("touchstart",u,{passive:!e.includes("noPreventDefault")})}};