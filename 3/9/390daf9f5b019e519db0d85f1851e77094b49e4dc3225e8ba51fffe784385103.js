!this,function(Ze){"use strict";try{(function(){Ze=Ze&&Ze.hasOwnProperty("default")?Ze.default:Ze;var r=ar s=i,h=(e(a,i=Error),a);ar c=(t.prototype.create=t);ar p=/\{\$([^}]+)}/g;ar f=(v.prototype.next=v.prototype.error=v.prototype.complete=v.prototype.subscribe=v.prototype.unsubscribeOne=v.prototype.forEachObserver=v.prototype.sendOne=v.prototype.close=v); S(e){this._index=e}unction I(e){this._store=e},"_index",["name","keyPath","multiEntry","unique"]),m(S,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),T(S,"_index",IDBIndex,["openCursor","openKeyCursor"]),w(_,"_cursor",["direction","key","primaryKey","value"]),m(_,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(,I.prototype.createIndex=function(){return new S(this._store.createIndex.apply(this._store,arguments))},I.prototype.index=function(){return new S(this._store.index.apply(this._store,arguments))},w(I,"_store",["name","keyPath","indexNames","autoIncrement"]),m(I,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),T(I,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),k(I,"_store",IDBObjectStore,["deleteIndex"]),P.prototype.objectStore=function(){return new I(this._tx.objectStore.apply(this._tx,arguments))},w(P,"_tx",["objectStoreNames","mode"]),k(P,"_tx",IDBTransaction,["abort"]),D.prototype.createObjectStore=function(){return new I(this._db.createObjectStore.apply(this._db,arguments))},w(D,"_db",["name","version","objectStoreNames"]),k(D,"_db",IDBDatabase,["deleteObjectStore","close"]),M.prototype.transaction=w(M,"_db",["name","version","objectStoreNames"]),k(M,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(,[S,I].forEach(;var C,E=1e4,N="w:0.3.1",x="FIS_v2",j="https://firebaseinstallations.googleapis.com/v1",O=36e5,K=((C={})["missing-app-config-values"]="Missing App configuration values.",C["create-installation-failed"]="Could not register Firebase Installation.",C["generate-token-failed"]="Could not generate Auth Token.",C["not-registered"]="Firebase Installation is not registered.",C["installation-not-found"]="Firebase Installation not found.",C["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',C["app-offline"]="Could not process request. Application offline.",C["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",C),A=new c("installations","Installations",K);cdef][\w-]{21}$/,G="";ar J,Y="firebase-installations-database",Q=1,X="firebase-installations-store",Z=null;ction re(a,c){return l(this,void 0,void 0,function(){var t,n,r,o,i,s;return d(this,function(e){switch(e.label){case 0:return t=oe(a),[4,ee()];case 1:return n=e.sent(),r=n.transaction(X,"readwrite"),[4,(o=r.objectStore(X)).get(t)];case 2:return i=e.sent(),void 0!==(s=c(i))?[3,4]:[4,o.delete(t)];case 3:return e.sent(),[3,6];case 4:return[4,o.put(s,t)];case 5:e.sent(),e.label=6;case 6:return[4,r.complete];case 7:return e.sent(),[2,s]}})})}unction ie(o){return l(this,void 0,void 0,function(){var r,t,n;return d(this,function(e){switch(e.label){case 0:return[4,re(o,function(e){var t=e),n=o,t);return r=n.registrationPromise,n.installationEntry})];case 1:return(t=e.sent()).fid!==G?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=e.sent(),n)];case 3:return[2,{installationEntry:t,registrationPromise:r}]}})})}unction ae(e){return e)?{fid:e.fid,registrationStatus:0}:e}unction ue(o,i){return void 0===i&&(i=!1),l(this,void 0,void 0,function(){var r,t,n;return d(this,function(e){switch(e.label){case 0:return[4,re(o,function(e){if(!le(e))throw A.create("not-registered");var t=e.authToken;if(!i&&t))return e;if(1===t.requestStatus)return r=o),e;if(!navigator.onLine)throw A.create("app-offline");var n=e);return r=function(o,i){return l(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,8]),[4,ce(o,i)];case 1:return t=e.sent(),r=s(s({},i),{authToken:t}),[4,te(o,r)];case 2:return e.sent(),[2,t];case 3:return!V(n=e.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,ne(o)];case 4:return e.sent(),[3,7];case 5:return r=s(s({},i),{authToken:{requestStatus:0}}),[4,te(o,r)];case 6:e.sent(),e.label=7;case 7:throw n;case 8:return[2]}})})}(o,n),n})];case 1:return t=e.sent(),r?[4,r]:[3,3];case 2:return n=e.sent(),[3,4];case 3:n=t.authToken,e.label=4;case 4:return[2,n.token]}})})}function fe(e){return re(e,function(e){if(!le(e))throw A.create("not-registered");return function(e){return 1===e.requestStatus&&e.requestTime+E<Date.now()}(e.authToken)?s(s({},e),{authToken:{requestStatus:0}}):e})}unction de(n,r){return void 0===r&&(r=!1),l(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,t=q(n))];case 1:return e.sent(),[2,ue(t,r)]}})})}e.INTERNAL.registerService("installations",function(t){return q(t),{app:t,getId:getToken:delete:});var pe,ve,be=((J={})["only-available-in-window"]="This method is available in a Window context.",J["only-available-in-sw"]="This method is available in a service worker context.",J["should-be-overriden"]="This method should be overriden by extended classes.",J["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",J["permission-default"]="The required permissions were not granted and dismissed instead.",J["permission-blocked"]="The required permissions were not granted and blocked instead.",J["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",J["notifications-blocked"]="Notifications have been blocked.",J["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",J["sw-registration-expected"]="A service worker registration was the expected input.",J["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",J["invalid-saved-token"]="Unable to access details of the saved token.",J["sw-reg-redundant"]="The service worker being used for push was made redundant.",J["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",J["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",J["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",J["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",J["token-update-no-token"]="FCM returned no token when updating the user to push.",J["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",J["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",J["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",J["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",J["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",J["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",J["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",J["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",J["failed-to-delete-token"]="Unable to delete the currently saved token.",J["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",J["bad-scope"]="The service worker scope must be a string with at least one character.",J["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",J["bad-subscription"]="The subscription must be a valid PushSubscription.",J["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",J["failed-delete-vapid-key"]="The VAPID key could not be deleted.",J["invalid-public-vapid-key"]="The public VAPID key must be a string.",J["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",J["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",J),ge=new c("messaging","Messaging",be),ye=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),we="google.c.a.c_id";unction ke(e){return function(e){var t=new Uint8Array(e);return btoa(String.fromCharCode.apply(String,o(t)))}(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(ve=pe=pe||{}).PUSH_MSG_RECEIVED="push-msg-received",ve.NOTIFICATION_CLICKED="notification-clicked";var Te=(Se.prototype.getToken=function(a,c,u){return l(this,void 0,void 0,function(){var t,n,r,o,i,s;return d(this,function(e){switch(e.label){case 0:return[4,Ie(a)];case 1:t=e.sent(),n=Pe(c,u),r={method:"POST",headers:t,body:JSON.stringify(n)},e.label=2;case 2:return e.trys.push([2,5,,6]),[4,fetch(_e(a),r)];case 3:return[4,e.sent().json()];case 4:return o=e.sent(),[3,6];case 5:throw i=e.sent(),ge.create("token-subscribe-failed",{errorInfo:i});case 6:if(o.error)throw s=o.error.message,ge.create("token-subscribe-failed",{errorInfo:s});if(!o.token)throw ge.create("token-subscribe-no-token");return[2,o.token]}})})},Se.prototype.updateToken=function(a,c,u,f){return l(this,void 0,void 0,function(){var t,n,r,o,i,s;return d(this,function(e){switch(e.label){case 0:return[4,Ie(c)];case 1:t=e.sent(),n=Pe(u,f),r={method:"PATCH",headers:t,body:JSON.stringify(n)},e.label=2;case 2:return e.trys.push([2,5,,6]),[4,fetch(_e(c)+"/"+a.fcmToken,r)];case 3:return[4,e.sent().json()];case 4:return o=e.sent(),[3,6];case 5:throw i=e.sent(),ge.create("token-update-failed",{errorInfo:i});case 6:if(o.error)throw s=o.error.message,ge.create("token-update-failed",{errorInfo:s});if(!o.token)throw ge.create("token-update-no-token");return[2,o.token]}})})},Se.prototype.deleteToken=function(s,a){return l(this,void 0,void 0,function(){var t,n,r,o,i;return d(this,function(e){switch(e.label){case 0:return[4,Ie(s)];case 1:t=e.sent(),n={method:"DELETE",headers:t},e.label=2;case 2:return e.trys.push([2,5,,6]),[4,fetch(_e(s)+"/"+a.fcmToken,n)];case 3:return[4,e.sent().json()];case 4:if((r=e.sent()).error)throw o=r.error.message,ge.create("token-unsubscribe-failed",{errorInfo:o});return[3,6];case 5:throw i=e.sent(),ge.create("token-unsubscribe-failed",{errorInfo:i});case 6:return[2]}})})},Se);function Se(){}unction Ie(n){return l(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,n.installations().getToken()];case 1:return t=e.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.options.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})]}})})}function Pe(e,t){var n=ke(e.getKey("p256dh")),r=ke(e.getKey("auth")),o={web:{endpoint:e.endpoint,p256dh:n,auth:r}};return me(t.buffer,ye.buffer)||(o.web.applicationPubKey=ke(t)),o}ar Me="undefined",Ce="fcm_token_object_Store";function Ee(t){var n=indexedDB.open(Me);n.onerror=n.onsuccess=function(e){!function(n,r){if(n.objectStoreNames.contains(Ce)){var e=n.transaction(Ce).objectStore(Ce),o=new Te,i=e.openCursor();i.onerror=i.onsuccess=function(){var e=i.result;if(e){var t=e.value;o.deleteToken(r,t),e.continue()}else n.close(),indexedDB.deleteDatabase(Me)}}}(n.result,t)}}var Ne=(xe.prototype.get=xe.prototype.getIndex=xe.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},xe.prototype.delete=xe.prototype.closeDatabase=xe.prototype.createTransaction=xe.prototype.getDb=xe);ar je,Oe=(e(Ke,je=Ne),Ke.prototype.onDbUpgrade=function(e,t){var n=e.result;switch(t.oldVersion){case 0:(o=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),o.createIndex("fcmToken","fcmToken",{unique:!0});case 1:Ee(this.app);case 2:var r=(o=e.transaction.objectStore(this.objectStoreName)).openCursor();r.onsuccess=function(){var e=r.result;if(e){var t=e.value,n=s({},t);t.createTime||(n.createTime=Date.now()),"string"==typeof t.vapidKey&&(n.vapidKey=De(t.vapidKey)),"string"==typeof t.auth&&(n.auth=De(t.auth).buffer),"string"==typeof t.auth&&(n.p256dh=De(t.p256dh).buffer),"string"==typeof t.fcmPushSet&&delete n.fcmPushSet,e.update(n),e.continue()}};break;case 3:var o,i=(o=e.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var e=i.result;if(e){var t=e.value,n=s({},t);"string"==typeof t.fcmPushSet&&delete n.fcmPushSet,e.update(n),e.continue()}}}},Ke.prototype.getTokenDetailsFromToken=Ke.prototype.getTokenDetailsFromSWScope=Ke.prototype.saveTokenDetails=function(t){return l(this,void 0,void 0,function(){return d(this,function(e){if(!t.swScope)throw ge.create("bad-scope");if(!t.vapidKey)throw ge.create("bad-vapid-key");if(!t.endpoint||!t.auth||!t.p256dh)throw ge.create("bad-subscription");if(!t.fcmSenderId)throw ge.create("bad-sender-id");if(!t.fcmToken)throw ge.create("bad-token");return Ae(t),[2,this.put(t)]})})},Ke.prototype.deleteToken=Ke);unction Ae(e){if(e.fcmToken&&("string"!=typeof e.fcmToken||0===e.fcmToken.length))throw ge.create("bad-token");if(e.swScope&&("string"!=typeof e.swScope||0===e.swScope.length))throw ge.create("bad-scope");if(e.vapidKey&&(!(e.vapidKey instanceof Uint8Array)||65!==e.vapidKey.length))throw ge.create("bad-vapid-key");if(e.endpoint&&("string"!=typeof e.endpoint||0===e.endpoint.length))throw ge.create("bad-subscription");if(e.auth&&!(e.auth instanceof ArrayBuffer))throw ge.create("bad-subscription");if(e.p256dh&&!(e.p256dh instanceof ArrayBuffer))throw ge.create("bad-subscription");if(e.fcmSenderId&&("string"!=typeof e.fcmSenderId||0===e.fcmSenderId.length))throw ge.create("bad-sender-id")}var Ve,qe=(e(We,Ve=Ne),We.prototype.onDbUpgrade=We.prototype.getVapidFromSWScope=We.prototype.saveVapidDetails=We.prototype.deleteVapidDetails=We);ar Ue=(Fe.prototype.getToken=Fe.prototype.manageExistingToken=function(t,n,r,o){return l(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return n,r,o)?Date.now()<o.createTime+6048e5?[2,o.fcmToken]:[2,this.updateToken(t,n,r,o)]:[3,1];case 1:return[4,this.deleteTokenFromDB(o.fcmToken)];case 2:return e.sent(),[2,this.getNewToken(t,n,r)];case 3:return[2]}})})},Fe.prototype.updateToken=function(o,i,s,a){return l(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,6]),[4,this.subscriptionManager.updateToken(a,this.app,i,s)];case 1:return t=e.sent(),n={swScope:o.scope,vapidKey:s,fcmSenderId:this.app.options.messagingSenderId,fcmToken:t,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return e.sent(),[4,this.vapidDetailsModel.saveVapidDetails(o.scope,s)];case 3:return e.sent(),[2,t];case 4:return r=e.sent(),[4,this.deleteToken(a.fcmToken)];case 5:throw e.sent(),r;case 6:return[2]}})})},Fe.prototype.getNewToken=function(r,o,i){return l(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return[4,this.subscriptionManager.getToken(this.app,o,i)];case 1:return t=e.sent(),n={swScope:r.scope,vapidKey:i,fcmSenderId:this.app.options.messagingSenderId,fcmToken:t,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return e.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,i)];case 3:return e.sent(),[2,t]}})})},Fe.prototype.deleteToken=Fe.prototype.deleteTokenFromDB=function(n){return l(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return t=e.sent(),[4,this.subscriptionManager.deleteToken(this.app,t)];case 2:return e.sent(),[2]}})})},Fe.prototype.getPushSubscription=function(n,r){return l(this,void 0,void 0,},Fe.prototype.requestPermission=Fe.prototype.useServiceWorker=function(e){throw ge.create("only-available-in-window")},Fe.prototype.usePublicVapidKey=function(e){throw ge.create("only-available-in-window")},Fe.prototype.onMessage=function(e,t,n){throw ge.create("only-available-in-window")},Fe.prototype.onTokenRefresh=Fe.prototype.setBackgroundMessageHandler=Fe.prototype.delete=Fe.prototype.getNotificationPermission_=Fe.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},Fe.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},Fe.prototype.getSubscriptionManager=Fe);function Fe(e){var t=this;if(this.app=e,this.vapidDetailsModel=new qe,this.subscriptionManager=new Te,!e.options.messagingSenderId||"string"!=typeof e.options.messagingSenderId)throw ge.create("bad-sender-id");this.INTERNAL={delete:,this.tokenDetailsModel=new Oe(e)}var Re,Le="FCM_MSG",Be=(e(He,Re=Ue),He.prototype.onPush=function(e){e.waitUntil(this.onPush_(e))},He.prototype.onSubChange=function(e){e.waitUntil(this.onSubChange_(e))},He.prototype.onNotificationClick=He.prototype.onPush_=He.prototype.onSubChange_=He.prototype.onNotificationClick_=function(i){return l(this,void 0,void 0,function(){var t,n,r,o;return d(this,function(e){switch(e.label){case 0:if(!(i.notification&&i.notification.data&&i.notification.data[Le]))return[2];if(i.action)return[2];if(i.stopImmediatePropagation(),i.notification.close(),!(t=i.notification.data[Le]).notification)return[2];if(!(n=t.fcmOptions&&t.fcmOptions.link||t.notification.click_action)){if(!(t.data&&we in t.data))return[2];n=self.location.origin}return[4,this.getWindowClient_(n)];case 1:return(r=e.sent())?[3,4]:[4,self.clients.openWindow(n)];case 2:return r=e.sent(),[4,3e3)];case 3:return e.sent(),[3,6];case 4:return[4,r.focus()];case 5:r=e.sent(),e.label=6;case 6:return r?(delete t.notification,delete t.fcmOptions,o=Ge(pe.NOTIFICATION_CLICKED,t),[2,this.attemptToMessageClient_(r,o)]):[2]}})})},He.prototype.getNotificationData_=He.prototype.setBackgroundMessageHandler=He.prototype.getWindowClient_=He.prototype.attemptToMessageClient_=He.prototype.hasVisibleClients_=He.prototype.sendMessageToWindowClients_=He.prototype.getSWRegistration_=He.prototype.getPublicVapidKey_=He); ze,Je,Ye=(e(Qe,ze=Ue),Qe.prototype.requestPermission=Qe.prototype.useServiceWorker=Qe.prototype.usePublicVapidKey=Qe.prototype.onMessage=function(e,t,n){return"function"==typeof e?this.onMessageInternal(e,t,n):this.onMessageInternal(e)},Qe.prototype.onTokenRefresh=Qe.prototype.waitForRegistrationToActivate_=Qe.prototype.getSWRegistration_=Qe.prototype.getPublicVapidKey_=Qe.prototype.setupSWMessageListener_=function(){var s=this;navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data.firebaseMessagingType&&e.data.firebaseMessagingData){var t=e.data,n=t.firebaseMessagingType,r=t.firebaseMessagingData;s.messageObserver&&s.messageObserver.next(r);var o=r.data;if(o&&we in o&&"1"===o["google.c.a.e"]){var i=n);s.app.INTERNAL.analytics.logEvent(i,{message_name:o["google.c.a.c_l"],message_id:o[we],message_time:o["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}}},!1)},Qe);={isSupported:Xe},Ze.INTERNAL.registerService("messaging",Je)}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-messaging - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-messaging.js.map
