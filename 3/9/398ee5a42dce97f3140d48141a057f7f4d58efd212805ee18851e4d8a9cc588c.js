onent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null}function setCookie(e,t,o){var s=new Date;s.setTime(s.getTime()+864e5*o),"https:"===document.location.protocol?document.cookie=e+"="+t+";SameSite=None;Secure;path=/;expires="+s.toGMTString():document.cookie=e+"="+t+";SameSite=None;path=/;expires="+s.toGMTString()}function isCookieStorageEnabled(){try{return setCookie("test","test",1),"test"===getCookie("test")}catch(e){return!1}}function isWebStorageEnabled(){try{return sessionStorage.setItem("test","test"),localStorage.setItem("test","test"),"test"===sessionStorage.getItem("test")&&"test"===localStorage.getItem("test")}catch(e){return!1}}function getItems(e){var o={};return e.forEach(function(t){try{o[t]="rl_campaign"===t?sessionStorage.getItem(t)||getCookie(t):localStorage.getItem(t)||getCookie(t)}catch(e){console.warn(e),o[t]=null}}),o}function removeItems(e){e.forEach(function(e){try{("rl_campaign"===e?sessionStorage:localStorage).removeItem(e),setCookie(e,"",-1)}catch(e){console.warn(e)}})}function setItems(t){Object.keys(t).forEach(function(e){try{"rl_campaign"===e?(sessionStorage.setItem(e,t[e]),setCookie(e,t[e],.1)le.warn(e)}})}function parseJson(e){try{return JSON.parse(e)}catch(e){return null}}function receiveMessage(e){var t,o,s;e.data&&(t=parseJson(e.data))&&("GET"===(o=t.method)?s=getItems(t.keys):"REMOVE"===o?removeItems(t.keys):"SET"===o&&setItems(t.items),e.source.postMessage(JSON.stringify({id:t.id,result:s}),e.origin))}isCookieStorageEnabled()||window.parent.postMessage("cookie_disabled","*"),isWebStorageEnabled()||window.parent.postMessage("web_storage_disabled","*"),window.addEventListener("message",receiveMessage)</script></head><body>OK<script>window.parent.postMessage("loaded","*")</script></body></html>props;i||this.analyticsFired||(this.fireAnalytics(e),t(),s(),this.analyticsFired=!0),e.dismissed&&this.closeSurvey()})),(0,i.Z)(this,"isDismissed",!1),(0,i.Z)(this,"closeSurvey",(()=>{this.isDismissed||(this.props.closeSurvey(),this.setState({shouldShowSurvey:!1}),this.isDismissed=!0)})),(0,i.Z)(this,"fireAnalytics",(e=>{let{reaction:t,feedback:s=""}=e,i=(0,h.Z)(e,P);const{isFabricPage:a,contentType:n,blueprintType:r,createAnalyticsEvent:o,testCohorts:u,experimentFeatures:d}=this.props,l=S.o.indexOf(t)+1,y={contentType:(0,b.Q4)("page","blogpost")(n),editorVersion:(0,b.Q4)("fabric","tinymce")(a?"fabric":"tinymce"),reaction:l,feedback:(0,b.rs)(s)};r&&(y.blueprintType=(0,b.Q4)(...k)(r)),i.cohorts||(i.cohorts=u),i.experiments||(i.experiments=d),Object.keys(i).forEach((e=>{y[e]=(0,b.rs)(i[e])})),o({type:"sendUIEvent",data:{source:"viewPageScreen",action:"submit",actionSubject:"confluence.spa.editor.fabric.satisfaction",attributes:(0,c.Z)({},y)}}).fire()}))}componentDidUpdate(e){const{shouldShowSurvey:t,wasTinyMCEPageJustPublished:s}=this.props,{contentId:i,openSurvey:a}=e;e.shouldShowSurvey!==t&&!0===t&&(this.isDismissed=!1,this.analyticsFired=!1),e.wasTinyMCEPageJustPublished!==s&&!0===s&&(g.LT.removeItem(_.keys.TINYMCE_PAGE_JUST_PUBLISHED),a(i))}componentWillUnmount(){this.props.closeSurvey()}render(){const{shouldShowSurvey:e,hasBeenSubmitted:t,intl:{formatMessage:s}}=this.props;if(!e)return null;const i=s(E.questionBad),n=s(E.questionGood),r=[i,i,n,n,n],o=S.o.map((e=>s(E[`reaction_${e.name}`])));return a.createElement(f.cP,{title:s(E.surveyTitle),description:a.createElement(m.Z,{id:"editor-satisfaction-survey.description",defaultMessage:"How was your editing experience?"}),finalTitle:s(E.surveyFinalTitle),finalDescription:a.createElement(m.Z,{id:"editor-satisfaction-survey.final.description",defaultMessage:"Your feedback has been submitted"}),reactionTitles:o,formQuestions:r,isOnFinalStage:t,onInteraction:this.handleAction,submitButtonText:s(E.buttonSubmit),closeButtonText:s(E.buttonClose)})}}));const Z=s(779076).ZP`query EditorSatisfactionSurveyQuery($contentId:ID){content(id:$contentId){nodes{id type metadata{labels{id name}}}}}`;var w=s(126543);class M extends a.PureComponent{constructor(...e){super(...e),(0,i.Z)(this,"lastSubmitted",Date.now()),(0,i.Z)(this,"wasTinyMCEPageJustPublished",!1)}componentDidMount(){const e=function(){const e=g.LT.getItem(_.keys.EDITOR_SURVEY_LAST_SUBMITTED);return e?parseInt(e,10):0}(),t="true"===g.LT.getItem(_.keys.TINYMCE_PAGE_JUST_PUBLISHED);this.lastSubmitted=e,this.wasTinyMCEPageJustPublished=t}render(){const{contentId:e,isFabricPage:t}=this.props;if(!e)return null;const s=[{query:Z,variables:{contentId:e}}];return a.createElement(u.k,{attribution:d.x.CONTENT_EXPERIENCE},a.createElement(l.wu.Consumer,null,(({experimentFeatures:i,abTestCohorts:u})=>a.createElement(r.D,{queryProps:s},(({results:[s],loading:r})=>{var d;const l=null!=(d=s.data)&&null!=(d=d.content)&&null!=(d=d.nodes)?d[0]:d;if(s.error||r||!l)return null;const c=l.metadata&&l.metadata.labels||[],h=l.type,y=c.find((e=>{if(e&&e.name)return v[e.name]}));let m="";return y&&y.name&&(m=y.name),a.createElement(n.xs,{to:[w.V]},(s=>a.createElement(o.e,null,(({featureFlags:n})=>{let r=28;(!r||r<1)&&(r=1);const o=24*r*60*60*1e3;if(this.lastSubmitted<Date.now()-o){const{contentId:r,hasBeenSubmitted:o}=s.state,d=Boolean(n["confluence.frontend.fabric.editor.satisfaction.survey"]),l=t||function(e){try{return"control"===JSON.parse(e)["fabric.editor.blank.blogpost"]}catch(t){return!1}}(i),c=Boolean(r)&&r===e&&d&&l;return a.createElement(I,{contentType:h,contentId:e,blueprintType:m,hasBeenSubmitted:o,isFabricPage:t,shouldShowSurvey:c,wasTinyMCEPageJustPublished:this.wasTinyMCEPageJustPublished,markSubmitted:s.markSurveySubmitted,markLastSubmitted:T,openSurvey:s.setContentId,closeSurvey:s.resetState,testCohorts:u,experimentFeatures:i})}return null}))))})))))}}M.displayName="EditorSatisfactionSurvey"},126543:(e,t,s)=>{s.d(t,{V:()=>r});var i=s(199009),a=s(822464);const n={contentId:null,hasBeenSubmitted:!1};class r extends a.W2{constructor(...e){super(...e),(0,i.Z)(this,"state",n),(0,i.Z)(this,"setContentId",(e=>{e&&this.setState({contentId:e})})),(0,i.Z)(this,"markSurveySubmitted",(()=>{this.setState({hasBeenSubmitted:!0})})),(0,i.Z)(this,"resetState",(()=>{this.setState(n)}))}}},387628:(e,t,s)=>{s.d(t,{D:()=>d});var i=s(615919),a=s(872342),n=s(199009),r=s(840506),o=s(911492);const u=["data","loading","error"];class d extends r.Component{constructor(...e){super(...e),(0,n.Z)(this,"_queryResults",[]),(0,n.Z)(this,"_queryProperties",[]),(0,n.Z)(this,"_anyLoading",(()=>this._queryResults.some((e=>!0===e.loading)))),(0,n.Z)(this,"_renderQueryComponent",((e,t,s)=>e.length?r.createElement(o.AE,(0,i.Z)({errorPolicy:"all"},e[s]),(i=>{let{data:n,loading:r,error:o}=i,d=(0,a.Z)(i,u);this._queryResults[s]={data:n,loading:r,error:o},this._queryProperties[s]=d;const l=s+1;return e.length>l?this._renderQueryComponent(e,t,l):t({results:this._queryResults,loading:this._anyLoading(),properties:this._queryProperties})})):t({results:[],loading:!1})))}render(){const{queryProps:e,children:t}=this.props;return this._renderQueryComponent(e,t,0)}}d.displayName="QueryGroup"},912638:(e,t,s)=>{s.d(t,{Q4:()=>n,rs:()=>a});class i{constructor(e){this.value=e,this.valueOf=this.toString=this.toJSON=()=>this.value}}const a=e=>new i(e),n=(...e)=>t=>e.includes(t)?Object.freeze(new i(t)):t},303574:(e,t,s)=>{s.d(t,{Yn:()=>n,cP:()=>a,qJ:()=>r});var i=s(728589);const a=(0,i.ZR)({__loadable_id__:"hVpSE",name:"SatisfactionSurveyFlag",loader:async()=>(await Promise.all([s.e(12705),s.e(11216),s.e(32072),s.e(45159),s.e(92336),s.e(39599)]).then(s.bind(s,290448))).SatisfactionSurveyFlag}),n=(0,i.ZR)({__loadable_id__:"8ItNp",name:"SatisfactionSurveyComponent",loader:async()=>(await Promise.all([s.e(12705),s.e(11216),s.e(32072),s.e(45159),s.e(92336)]).then(s.bind(s,842539))).SatisfactionSurveyComponent}),r=(0,i.ZR)({__loadable_id__:"-D1ZP",name:"SatisfactionSurveyModal",loader:async()=>(await Promise.all([s.e(12705),s.e(11216),s.e(14248),s.e(21488),s.e(84185),s.e(32072),s.e(45159),s.e(92336),s.e(74190)]).then(s.bind(s,548454))).SatisfactionSurveyModal})},124142:(e,t,s)=>{s.d(t,{o:()=>i});const i=[{name:"terrible",id:0,value:1},{name:"bad",id:1,value:2},{name:"okay",id:2,value:3},{name:"great",id:3,value:4},{name:"amazing",id:4,value:5}]}}]);
//# sourceMappingURL=79150.Hg2j7Bi5rP.js.map