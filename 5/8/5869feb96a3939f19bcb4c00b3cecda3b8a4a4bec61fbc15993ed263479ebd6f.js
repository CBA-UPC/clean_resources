"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7966],{99512:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var n=i(56287),s=i(17930),a=i(27641),o=function(){eturn(0,s.Z)(e,[{key:"dispose",value:function(){this.$_all.clear()}},{key:"$on",value:,{key:"$off",value:function(e,t){var i=this.$_all.get(e)||[],n=t?i.filter(():[];n.length>0?this.$_all.set(e,n):this.$_all.delete(e)}},{key:"$once",value:function(e,t){var i=this;this.$on(e,()}},{key:"$emit",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];(this.$_all.get(e)||[]).forEach(()}}]),e}();const r=var u=i(76366),c=function(){function e(t){var i=this;(0,n.Z)(this,e),(0,a.Z)(this,"connected",!1),(0,a.Z)(this,"playingLive",!1),(0,a.Z)(this,"castSession",void 0),(0,a.Z)(this,"activeDebug",!1),(0,a.Z)(this,"brand",void 0),(0,a.Z)(this,"castDevice",void 0),(0,a.Z)(this,"castContext",void 0),(0,a.Z)(this,"deviceAvailable",!1),(0,a.Z)(this,"player",void 0),(0,a.Z)(this,"controller",void 0),(0,a.Z)(this,"nbRefreshBySecond",10),(0,a.Z)(this,"startTime",0),(0,a.Z)(this,"queues",void 0),(0,a.Z)(this,"_currentTime",void 0),(0,a.Z)(this,"_millisecondTimer",void 0),(0,a.Z)(this,"onCastStateChanged",(function(){i.debug("CAST_STATE_CHANGED",i.castContext.getCastState()),i.deviceAvailable=i.castContext.getCastState()!==window.cast.framework.CastState.NO_DEVICES_AVAILABLE})),(0,a.Z)(this,"onSessionStateChanged",(function(e){i.debug("SESSION_RESUMED",e),"SESSION_RESUMED"===e.sessionState&&i.session.media&&window.PubSub.publish("RESUME_PLAYER_FROM_CAST",{mediaId:i.session.media[0].media.contentId,currentTime:i.castSession.getMediaSession().getEstimatedTime()})})),(0,a.Z)(this,"onCustomMessagesQueueList",(function(e,t){var n=JSON.parse(t);if(i.debug("custom-messages-queue-list",{parsedMessage:n,namespace:e,message:t}),!n.type)throw new Error("Message type required");window.PubSub.publish("custom-messages.".concat(n.type.toLowerCase()),n.data)})),(0,a.Z)(this,"onIsConnectedChanged",(function(){i.debug(" IS_CONNECTED_CHANGED",i.player.isConnected),i.player.isConnected?(i.emit("CAST_STATE_CONNECTED"),i.connected=!0,window.castSession=i.castContext.getCurrentSession(),i.castSession=window.castSession,window.session=i.castSession.getSessionObj(),i.session=window.session,i.session.addMessageListener("urn:x-cast:custom-messages",i.onCustomMessagesQueueList)):(i.session.removeMessageListener("urn:x-cast:custom-messages"),i.connected=!1,i.resetSession(),i.emit("CAST_STATE_DISCONNECTED"),window.PubSub.publish("CAST_DISCONNECTED"))})),(0,a.Z)(this,"onPlayerStateChanged",(function(){i.debug("PLAYER_STATE_CHANGED",i.player.playerState),i.player.playerState===window.chrome.cast.media.PlayerState.PLAYING&&(i.emit("STATE_PLAYING"),window.store.player.isPlayerPlaying=!0,window.store.player.mediaId=i.media().media.contentId,i.debug("EVENT PLAYER_STATE_CHANGED : STATE_PLAYING with start time ".concat(i.player.currentTime))),i.player.playerState===window.chrome.cast.media.PlayerState.PAUSED&&(i.emit("STATE_PAUSED"),i.debug("PLAYER_STATE_CHANGED",i.player.playerState),i.clearMillisecondTimer())})),(0,a.Z)(this,"onCurrentTimeChanged",(function(){i._currentTime=i.player.currentTime,i.emit("TIME_IS_UPDATED"),i.clearMillisecondTimer(),i.refreshMilliseconds()})),(0,a.Z)(this,"resetSession",(),(0,a.Z)(this,"onIsMediaLoadedChanged",(),(0,a.Z)(this,"onDurationChanged",(function(){i.debug("DURATION_CHANGED"),i.emit("METADATA_IS_LOADED")})),(0,a.Z)(this,"onVolumeLevelChanged",(function(){i.debug("VOLUME_LEVEL_CHANGED"),i.emit("VOLUME_LEVEL_CHANGED")})),(0,a.Z)(this,"onIsMutedChanged",(function(){i.debug("IS_MUTED_CHANGED"),i.emit("IS_MUTED_CHANGED")})),this.brand=t,this.eventBus=r()}return(0,s.Z)(e,[{key:"isCasting",get:function(){return this.connected}},{key:"isMediaLoaded",get:,{key:"isPlaying",get:function(){return this.player.playerState===window.chrome.cast.media.PlayerState.PLAYING}},{key:"isPaused",get:function(){return this.player.playerState===window.chrome.cast.media.PlayerState.PAUSED}},{key:"startInit",value:function(){var e=this;window.__onGCastApiAvailable=},{key:"init",value:function(){window.chrome.cast&&window.cast&&(this.castContext=window.cast.framework.CastContext.getInstance(),this.castContext.setOptions({receiverApplicationId:this.receiverApplicationId||window.chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:window.chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),this.player=new window.cast.framework.RemotePlayer,window.player=this.player,this.controller=new window.cast.framework.RemotePlayerController(this.player),this.castContext.addEventListener(window.cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.onCastStateChanged),this.castContext.addEventListener(window.cast.framework.CastContextEventType.SESSION_STATE_CHANGED,this.onSessionStateChanged),this.controller.addEventListener(window.cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,this.onIsConnectedChanged),this.controller.addEventListener(window.cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,this.onPlayerStateChanged),this.controller.addEventListener(window.cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,this.onCurrentTimeChanged),this.controller.addEventListener(window.cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED,this.onIsMediaLoadedChanged),this.controller.addEventListener(window.cast.framework.RemotePlayerEventType.DURATION_CHANGED,this.onDurationChanged),this.controller.addEventListener(window.cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,this.onVolumeLevelChanged),this.controller.addEventListener(window.cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,this.onIsMutedChanged))}},{key:"clearMillisecondTimer",value:function(){this._millisecondTimer&&clearTimeout(this._millisecondTimer),this._currentTime=this.player.currentTime}},{key:"refreshMilliseconds",value:function(){var e=this;if(this.player.playerState===window.chrome.cast.media.PlayerState.PLAYING){var t=1/this.nbRefreshBySecond;this._currentTime+=t,this._millisecondTimer=setTimeout((,1e3/this.nbRefreshBySecond),this.emit("TIME_IS_UPDATED")}}},{key:"cast",value:function(){var t=this;return new Promise((function(i,n){!t.connected&&e.isAvailable?window.cast.framework.CastContext.getInstance().requestSession().then(().catch(():(t.emit("ready"),i(t))}))}},{key:"syncCastedMediaToDom",value:function(){var e=this.getMedia();if(e.mediaId&&!document.querySelector("#".concat(e.mediaId))){var t=document.createElement("script");t.setAttribute("type","application/json"),t.dataset.mediaId=e.mediaId,t.textContent=JSON.stringify(e),document.body.append(t)}return{mediaId:e.mediaId,time:this.getCurrentTime()}}},{key:"moveItem",value:function(e,t){var i=this;this.castSession.sendMessage("urn:x-cast:custom-messages",{type:"QUEUE_REQUEST"}).then((function(){window.PubSub.unsubscribe("custom-messages.queue_list"),window.PubSub.subscribe("custom-messages.queue_list",(function(n,s){var a=s.findIndex((function(t){return t.media.contentId===e})),o=s.splice(a,1);s.splice(t,0,o[0]);var r=[];s.forEach((),i.media().queueReorderItems(new window.chrome.cast.media.QueueReorderItemsRequest(r)),window.PubSub.unsubscribe("custom-messages.queue_list")}))}))}},{key:"removeItem",value:function(e){var t=this;return this.castSession.sendMessage("urn:x-cast:custom-messages",{type:"QUEUE_REQUEST"}).then((function(){window.PubSub.unsubscribe("custom-messages.queue_list"),window.PubSub.subscribe("custom-messages.queue_list",(function(i,n){var s=n.find(();t.media().media.contentId!==e&&t.media().queueRemoveItem(s.itemId),window.PubSub.unsubscribe("custom-messages.queue_list")}))}))}},{key:"addItem",value:function(e){var t=this;this.castSession.sendMessage("urn:x-cast:custom-messages",{type:"QUEUE_REQUEST"}).then((function(){window.PubSub.unsubscribe("custom-messages.queue_list"),window.PubSub.subscribe("custom-messages.queue_list",(function(i,n){if(n.some((function(t){return t.media.contentId===e.mediaId}))){var s=n.length-1;t.moveItem(e.mediaId,s)}else{var a=t.mediaInfo(e),o=new window.chrome.cast.media.QueueItem(a);t.media().queueAppendItem(o)}window.PubSub.unsubscribe("custom-messages.queue_list")}))}))}},{key:"mediaQueueAppendItems",value:function(e){var t=this,i=[],n=(0,u.Z)().playlist;return(null==n?void 0:n.length)>0?(n.some(()||i.push(this.createFirstQueueItemFromMedia(e)),n.forEach((function(e){var n=t.mediaInfo(e),s=new window.chrome.cast.media.QueueItem(n);i.push(s)}))):i.push(this.createFirstQueueItemFromMedia(e)),i}},{key:"createFirstQueueItemFromMedia",value:function(e){var t=this.mediaInfo(e);return new window.chrome.cast.media.QueueItem(t)}},{key:"loadMedia",value:function(e){var t=this;this.cast().then((function(){var i=new window.chrome.cast.media.LoadRequest(t.mediaInfo(e)),n=Math.round(t.startTime);if(!t.playingLive){var s=t.mediaQueueAppendItems(e),a=s.findIndex(();i.queueData=new window.chrome.cast.media.QueueData("audio-playlist","player playlist","Playlist of the player","REPEAT_OFF",s,a),i.currentTime=n}t.castSession.loadMedia(i).then(().catch(()})).catch(()}},{key:"mediaMetadata",value:function(e){var t=new window.chrome.cast.media.MusicTrackMediaMetadata;return t.title=e.diffusion.title,t.albumName=e.emission.title,t.artist=this.brand.toUpperCase(),t.images=[new window.chrome.cast.Image(e.diffusion.image)],t}},{key:"mediaInfo",value:function(e){var t=new window.chrome.cast.media.MediaInfo(e.mediaId,"audio/mp3");return t.contentUrl=e.sources[0].url,t.metadata=this.mediaMetadata(e),t.streamType=this.playingLive?window.chrome.cast.media.StreamType.LIVE:window.chrome.cast.media.StreamType.BUFFERED,t}},{key:"play",value:,{key:"playOrPause",value:function(){if(!this.isCasting)throw new Error("No cast connected");if(!this.isMediaLoaded)throw new Error("No media loaded");this.controller.playOrPause()}},{key:"stop",value:function(){if(!this.isCasting)throw new Error("No cast connected");this.castSession.endSession(!0)}},{key:"media",value:function(){var e,t;return this.isCasting&&null!==(e=this.player)&&void 0!==e&&e.isMediaLoaded?null===(t=this.castSession)||void 0===t?void 0:t.getMediaSession():""}},{key:"getCurrentTime",value:,{key:"getDuration",value:,{key:"addEventListener",value:function(e,t){this.eventBus.$on(e,t)}},{key:"removeEventListener",value:function(e,t){this.eventBus.$off(e,t)}},{key:"getStatus",value:function(){var e="STATE_UNREADY";switch(this.player.playerState){case window.chrome.cast.media.PlayerState.BUFFERING:e="STATE_READY";break;case window.chrome.cast.media.PlayerState.PLAYING:e="STATE_PLAYING";break;case window.chrome.cast.media.PlayerState.PAUSED:e="STATE_PAUSED"}return{state:e,muted:this.player.isMuted,currentTime:this._currentTime||0}}},{key:"pause",value:,{key:"loadNewMedia",value:function(e,t){var i=t.initTime;this._currentMedia=e,this.startTime=i,this.loadMedia(e,"audio/mp3")}},{key:"getMedia",value:function(){if(!this.castSession.getMediaSession())return{mediaId:void 0,sources:[],broadcastType:void 0};var e=this.castSession.getMediaSession().media,t=e.contentUrl,i=e.contentId,n=null==e?void 0:e.metadata.title,s=null==e?void 0:e.metadata.albumName,a=e.metadata.images.length>0?e.metadata.images[0].url:"".concat(window.location.origin,"/mstile-70x70.png");return{mediaId:e.contentId,sources:[{name:i,url:t}],broadcastType:void 0,emission:{title:s},diffusion:{title:n,image:a}}}},{key:"getOption",value:function(e){var t;return null!==(t={isAdvertisement:!1}[e])&&void 0!==t?t:void 0}},{key:"setCurrentTime",value:function(e){var t=this.castSession.getMediaSession(),i=new window.chrome.cast.media.SeekRequest;i.currentTime=e,t.seek(i)}},{key:"emit",value:,{key:"debug",value:],[{key:"isAvailable",get:,{key:"receiverApplicationId",get:]),e}()},99440:(e,t,i)=>{i.d(t,{Z:()=>n});const n=(0,i(20771).Q_)("currentNotifications",{state:actions:{showNotify:function(e){var t=this;if(e.text){var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=Math.trunc(16*Math.random());return("x"===e?t:3&t|8).toString(16)}));e.type&&!["success","error","warning","info"].includes(e.type)||(e.type="info"),Object.keys(this.notifications).length>0&&(this.notifications={}),this.notifications[i]=e,setTimeout((,e.timeout||5e3)}},removeNotify:})},76366:(e,t,i)=>{i.d(t,{Z:);var n=i(27641),s=i(62559),a=i(20771),o=i(99440),r=i(19565),u=i(75712),c=i(19327);r m=const h=(0,a.Q_)("playlist",{state:function(){return{isOpen:!1,manualPlaylist:(0,r._aR)("manualPlaylist",[]),automaticPlaylist:(0,r._aR)("automaticPlaylist",[]),shouldPlayFirstElement:!1}},getters:{playlist:function(e){return[].concat((0,s.Z)(e.manualPlaylist),(0,s.Z)(e.automaticPlaylist))}},actions:l(l({},(0,a.nv)(o.Z,["showNotify"])),{},{togglePlaylist:openPlaylist:function(){this.isOpen=!0,window.addEventListener("click",this.maybeClose),c.Z.publish("player.playlist.show")},closePlaylist:maybeClose:function(e){var t=new Set(document.querySelectorAll("[data-open-playlist-area]"));!e.composedPath().some(()&&this.closePlaylist()},listToUse:addToPlaylist:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.isInPlaylist=!0,this.listToUse(e.isInAutomaticPlaylist).push(e),t&&this.showNotify({text:(0,u.Z)("playlist.added.confirmation").replace("%start_u%",'<span class="t-td-und">').replace("%end_u%","</span>"),onClick:this.openPlaylist,icon:"picto-check"})},removeFromPlaylist:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.getMediaInPlaylist(e),n=this.listToUse(null==i?void 0:i.isInAutomaticPlaylist),s=n.findIndex((function(t){return m(t,e)}));n.splice(s,1),t&&this.showNotify({text:(0,u.Z)("playlist.removed.confirmation").replace("%start_u%",'<span class="t-td-und">').replace("%end_u%","</span>"),onClick:this.openPlaylist,icon:"picto-close-red"})},removeAllAutoFromPlaylist:function(){var e=this;(0,s.Z)(this.automaticPlaylist).forEach(()},rewritePlaylist:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this.listToUse(n);s.length=0,e.forEach(()},getMediaInPlaylist:function(e){return(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.manualPlaylist:this.playlist).find(()},isMediaInPlaylist:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!!this.getMediaInPlaylist(e,t)},shouldPlayFirstElementInPlaylist:)})}}]);