/*!
* @license EaselJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2015 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
this.createjs=this.createjs||{},createjs.extend=this.createjs=this.createjs||{},createjs.promote=this.createjs=this.createjs||{},createjs.indexOf=this.createjs=this.createjs||{},),this.createjs=this.createjs||{},createjs.deprecate=this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},function(){"use strict";ar b=a.prototype;b.setValues=b.offset=a.polar=function(b,c,d){return d=d||new a,d.x=b*Math.cos(c),d.y=b*Math.sin(c),d},a.interpolate=function(b,c,d,e){return e=e||new a,e.x=c.x+d*(b.x-c.x),e.y=c.y+d*(b.y-c.y),e},b.copy=b.clone=b.toString=createjs.Point=a}(),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},function(){"use strict";function a(){this.EventDispatcher_constructor(),this.alpha=1,this.cacheCanvas=null,this.bitmapCache=null,this.id=createjs.UID.get(),this.mouseEnabled=!0,this.tickEnabled=!0,this.name=null,this.parent=null,this.regX=0,this.regY=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.shadow=null,this.visible=!0,this.x=0,this.y=0,this.transformMatrix=null,this.compositeOperation=null,this.snapToPixel=!0,this.filters=null,this.mask=null,this.hitArea=null,this.cursor=null,this._props=new createjs.DisplayProps,this._rectangle=new createjs.Rectangle,this._bounds=null,this._webGLRenderStyle=a._StageGL_NONE,this._glMtx=new createjs.Matrix2D}var b=createjs.extend(a,createjs.EventDispatcher);a._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"],a.suppressCrossDomainErrors=!1,a._snapToPixelEnabled=!1,a._StageGL_NONE=0,a._StageGL_SPRITE=1,a._StageGL_BITMAP=2;var c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");c.getContext&&(a._hitTestCanvas=c,a._hitTestContext=c.getContext("2d"),c.width=c.height=1),b._getStage=b.getStage=createjs.deprecate(b._getStage,"DisplayObject.getStage");try{Object.defineProperties(b,{stage:{get:b._getStage},cacheID:{get:set:,scale:{get:function(){return this.scaleX},set:})}catch(d){}b.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},b.draw=b.updateContext=b.cache=function(a,b,c,d,e,f){this.bitmapCache?this.bitmapCache._autoGenerated=!1:this.bitmapCache=new createjs.BitmapCache,this.bitmapCache.define(this,a,b,c,d,e,f)},b.updateCache=b.uncache=b.getCacheDataURL=b.localToGlobal=b.globalToLocal=b.localToLocal=b.setTransform=b.getMatrix=function(a){var b=this,c=a||new createjs.Matrix2D;return b.transformMatrix?c.copy(b.transformMatrix):c.identity()&&c.appendTransform(b.x,b.y,b.scaleX,b.scaleY,b.rotation,b.skewX,b.skewY,b.regX,b.regY)},b.getConcatenatedMatrix=b.getConcatenatedDisplayProps=b.hitTest=b.set=b.getBounds=function(){if(this._bounds)return this._rectangle.copy(this._bounds);var a=this.bitmapCache;return a&&this.cacheCanvas?a.getBounds():null},b.getTransformedBounds=function(){return this._getBounds()},b.setBounds=b.clone=b.toString=function(){return"[DisplayObject (name="+this.name+")]"},b._updateState=null,b._cloneProps=function(a){return a.alpha=this.alpha,a.mouseEnabled=this.mouseEnabled,a.tickEnabled=this.tickEnabled,a.name=this.name,a.regX=this.regX,a.regY=this.regY,a.rotation=this.rotation,a.scaleX=this.scaleX,a.scaleY=this.scaleY,a.shadow=this.shadow,a.skewX=this.skewX,a.skewY=this.skewY,a.visible=this.visible,a.x=this.x,a.y=this.y,a.compositeOperation=this.compositeOperation,a.snapToPixel=this.snapToPixel,a.filters=null==this.filters?null:this.filters.slice(0),a.mask=this.mask,a.hitArea=this.hitArea,a.cursor=this.cursor,a._bounds=this._bounds,a._webGLRenderStyle=this._webGLRenderStyle,a},b._applyShadow=b._tick=b._testHit=b._getBounds=b._transformBounds=b._hasMouseEventListener=createjs.DisplayObject=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},function(){"use strict";ar b=createjs.extend(a,createjs.Container);b._get_nextStage=function(){return this._nextStage},b._set_nextStage=try{Object.defineProperties(b,{nextStage:{get:b._get_nextStage,set:b._set_nextStage}})}catch(c){}b.update=b.draw=function(a,b){var c=this.Container_draw(a,b);return this.canvas._invalid=!0,c},b.tick=b.handleEvent=b.clear=b.toDataURL=b.enableMouseOver=b.enableDOMEvents=b.clone=function(){throw"Stage cannot be cloned."},b.toString=function(){return"[Stage (name="+this.name+")]"},b._getElementRect=b._getPointerData=b._handleMouseMove=b._handlePointerMove=b._updatePointerPosition=b._handleMouseUp=b._handlePointerUp=b._handleMouseDown=b._handlePointerDown=b._testMouseOver=b._handleDoubleClick=b._dispatchMouseEvent=createjs.Stage=createjs.promote(a,"Container")}(),this.createjs=this.createjs||{},function(){"use strict";function a(b,c){this.Stage_constructor(b);var d,e,f,g,h;if(void 0!==c){if("object"!=typeof c)throw"Invalid options object";d=c.transparent,e=c.antialias,f=c.preserveBuffer,g=c.autoPurge,h=c.directDraw}this.vocalDebug=!1,this.isCacheControlled=!1,this._preserveBuffer=f||!1,this._antialias=e||!1,this._transparent=d||!1,this._autoPurge=void 0,this.autoPurge=g,this._directDraw=void 0===h?!0:!!h,this._viewportWidth=0,this._viewportHeight=0,this._projectionMatrix=null,this._webGLContext=null,this._frameBuffer=null,this._clearColor={r:.5,g:.5,b:.5,a:0},this._maxBatchVertexCount=a.DEFAULT_MAX_BATCH_SIZE*a.INDICIES_PER_CARD,this._activeShader=null,this._mainShader=null,this._vertices=null,this._vertexPositionBuffer=null,this._uvs=null,this._uvPositionBuffer=null,this._indices=null,this._textureIndexBuffer=null,this._alphas=null,this._alphaBuffer=null,this._bufferTextureOutput=null,this._bufferTextureConcat=null,this._bufferTextureTemp=null,this._batchTextureOutput=this,this._batchTextureConcat=null,this._batchTextureTemp=null,this._builtShaders={},this._textureDictionary=[],this._textureIDs={},this._batchTextures=[],this._baseTextures=[],this._gpuTextureCount=8,this._gpuTextureMax=8,this._batchTextureCount=0,this._lastTextureInsert=-1,this._renderMode="",this._immediateRender=!1,this._batchVertexCount=0,this._batchID=0,this._drawID=0,this._slotBlacklist=[],this._lastTrackedCanvas=-1,this._cacheContainer=new createjs.Container,this._initializeWebGL(),void 0!==c&&(void 0!==c.clearColor&&this.setClearColor(c.clearColor),void 0!==c.premultiply&&createjs.deprecate(null,"options.premultiply")())}var b=createjs.extend(a,createjs.Stage);a.buildUVRects=function(a,b,c){if(!a||!a._frames)return null;void 0===b&&(b=-1),void 0===c&&(c=!1);for(var d=-1!==b&&c?b:0,e=-1!==b&&c?b+1:a._frames.length,f=d;e>f;f++){var g=a._frames[f];if(!(g.uvRect||g.image.width<=0||g.image.height<=0)){var h=g.rect;g.uvRect={t:1-h.y/g.image.height,l:h.x/g.image.width,b:1-(h.y+h.height)/g.image.height,r:(h.x+h.width)/g.image.width}}}return a._frames[-1!==b?b:0].uvRect||{t:0,l:0,b:1,r:1}},a.isWebGLActive=a.colorToObj=function(a){var b,c,d,e;if("string"==typeof a){if(0===a.indexOf("#"))4===a.length&&(a="#"+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)+a.charAt(3)+a.charAt(3)),b=Number("0x"+a.slice(1,3))/255,c=Number("0x"+a.slice(3,5))/255,d=Number("0x"+a.slice(5,7))/255,e=a.length>7?Number("0x"+a.slice(7,9))/255:1;else if(0===a.indexOf("rgba(")){var f=a.slice(5,-1).split(",");b=Number(f[0])/255,c=Number(f[1])/255,d=Number(f[2])/255,e=Number(f[3])}}else b=((4278190080&a)>>>24)/255,c=((16711680&a)>>>16)/255,d=((65280&a)>>>8)/255,e=(255&a)/255;return{r:Math.min(Math.max(0,b),1),g:Math.min(Math.max(0,c),1),b:Math.min(Math.max(0,d),1),a:Math.min(Math.max(0,e),1)}},a.VERTEX_PROPERTY_COUNT=6,a.INDICIES_PER_CARD=6,a.DEFAULT_MAX_BATCH_SIZE=10920,a.WEBGL_MAX_INDEX_NUM=Math.pow(2,16),a.UV_RECT={t:1,l:0,b:0,r:1};try{a.COVER_VERT=new Float32Array([-1,1,1,1,-1,-1,1,1,1,-1,-1,-1]),a.COVER_UV=new Float32Array([0,1,1,1,0,0,1,1,1,0,0,0])}catch(c){}a.REGULAR_VARYING_HEADER="precision highp float;varying vec2 vTextureCoord;varying lowp float indexPicker;varying lowp float alphaValue;",a.REGULAR_VERTEX_HEADER=a.REGULAR_VARYING_HEADER+"attribute vec2 vertexPosition;attribute vec2 uvPosition;attribute lowp float textureIndex;attribute lowp float objectAlpha;uniform mat4 pMatrix;",a.REGULAR_FRAGMENT_HEADER=a.REGULAR_VARYING_HEADER+"uniform sampler2D uSampler[{{count}}];",a.REGULAR_VERTEX_BODY="void main(void) {gl_Position = pMatrix * vec4(vertexPosition.x, vertexPosition.y, 0.0, 1.0);alphaValue = objectAlpha;indexPicker = textureIndex;vTextureCoord = uvPosition;}",a.REGULAR_FRAGMENT_BODY="void main(void) {vec4 color = vec4(1.0, 0.0, 0.0, 1.0);if (indexPicker <= 0.5) {color = texture2D(uSampler[0], vTextureCoord);{{alternates}}}gl_FragColor = vec4(color.rgb * alphaValue, color.a * alphaValue);}",a.COVER_VARYING_HEADER="precision highp float;varying vec2 vTextureCoord;",a.COVER_VERTEX_HEADER=a.COVER_VARYING_HEADER+"attribute vec2 vertexPosition;attribute vec2 uvPosition;",a.COVER_FRAGMENT_HEADER=a.COVER_VARYING_HEADER+"uniform sampler2D uSampler;",a.COVER_VERTEX_BODY="void main(void) {gl_Position = vec4(vertexPosition.x, vertexPosition.y, 0.0, 1.0);vTextureCoord = uvPosition;}",a.COVER_FRAGMENT_BODY="void main(void) {gl_FragColor = texture2D(uSampler, vTextureCoord);}",a.BLEND_FRAGMENT_SIMPLE="uniform sampler2D uMixSampler;void main(void) {vec4 src = texture2D(uMixSampler, vTextureCoord);vec4 dst = texture2D(uSampler, vTextureCoord);",a.BLEND_FRAGMENT_COMPLEX=a.BLEND_FRAGMENT_SIMPLE+"vec3 srcClr = min(src.rgb/src.a, 1.0);vec3 dstClr = min(dst.rgb/dst.a, 1.0);float totalAlpha = min(1.0 - (1.0-dst.a) * (1.0-src.a), 1.0);float srcFactor = min(max(src.a - dst.a, 0.0) / totalAlpha, 1.0);float dstFactor = min(max(dst.a - src.a, 0.0) / totalAlpha, 1.0);float mixFactor = max(max(1.0 - srcFactor, 0.0) - dstFactor, 0.0);gl_FragColor = vec4((srcFactor * srcClr +dstFactor * dstClr +mixFactor * vec3(",a.BLEND_FRAGMENT_COMPLEX_CAP=")) * totalAlpha, totalAlpha);}",a.BLEND_FRAGMENT_OVERLAY_UTIL="float overlay(float a, float b) {if(a < 0.5) { return 2.0 * a * b; }return 1.0 - 2.0 * (1.0-a) * (1.0-b);}",a.BLEND_FRAGMENT_HSL_UTIL="float getLum(vec3 c) { return 0.299*c.r + 0.589*c.g + 0.109*c.b; }float getSat(vec3 c) { return max(max(c.r, c.g), c.b) - min(min(c.r, c.g), c.b); }vec3 clipHSL(vec3 c) {float lum = getLum(c);float n = min(min(c.r, c.g), c.b);float x = max(max(c.r, c.g), c.b);if(n < 0.0){ c = lum + (((c - lum) * lum) / (lum - n)); }if(x > 1.0){ c = lum + (((c - lum) * (1.0 - lum)) / (x - lum)); }return clamp(c, 0.0, 1.0);}vec3 setLum(vec3 c, float lum) {return clipHSL(c + (lum - getLum(c)));}vec3 setSat(vec3 c, float val) {vec3 result = vec3(0.0);float minVal = min(min(c.r, c.g), c.b);float maxVal = max(max(c.r, c.g), c.b);vec3 minMask = vec3(c.r == minVal, c.g == minVal, c.b == minVal);vec3 maxMask = vec3(c.r == maxVal, c.g == maxVal, c.b == maxVal);vec3 midMask = 1.0 - min(minMask+maxMask, 1.0);float midVal = (c*midMask).r + (c*midMask).g + (c*midMask).b;if(maxVal > minVal) {result = midMask * min( ((midVal - minVal) * val) / (maxVal - minVal), 1.0);result += maxMask * val;}return result;}",a.BLEND_SOURCES={"source-over":{},"source-in":{shader:a.BLEND_FRAGMENT_SIMPLE+"gl_FragColor = vec4(src.rgb * dst.a, src.a * dst.a);}"},"source-in_cheap":{srcRGB:"DST_ALPHA",srcA:"ZERO",dstRGB:"ZERO",dstA:"SRC_ALPHA"},"source-out":{shader:a.BLEND_FRAGMENT_SIMPLE+"gl_FragColor = vec4(src.rgb * (1.0 - dst.a), src.a - dst.a);}"},"source-out_cheap":{eqA:"FUNC_SUBTRACT",srcRGB:"ONE_MINUS_DST_ALPHA",srcA:"ONE",dstRGB:"ZERO",dstA:"SRC_ALPHA"},"source-atop":{srcRGB:"DST_ALPHA",srcA:"ZERO",dstRGB:"ONE_MINUS_SRC_ALPHA",dstA:"ONE"},"destination-over":{srcRGB:"ONE_MINUS_DST_ALPHA",srcA:"ONE_MINUS_DST_ALPHA",dstRGB:"ONE",dstA:"ONE"},"destination-in":{shader:a.BLEND_FRAGMENT_SIMPLE+"gl_FragColor = vec4(dst.rgb * src.a, src.a * dst.a);}"},"destination-in_cheap":{srcRGB:"ZERO",srcA:"DST_ALPHA",dstRGB:"SRC_ALPHA",dstA:"ZERO"},"destination-out":{eqA:"FUNC_REVERSE_SUBTRACT",srcRGB:"ZERO",srcA:"DST_ALPHA",dstRGB:"ONE_MINUS_SRC_ALPHA",dstA:"ONE"},"destination-atop":{shader:a.BLEND_FRAGMENT_SIMPLE+"gl_FragColor = vec4(dst.rgb * src.a + src.rgb * (1.0 - dst.a), src.a);}"},"destination-atop_cheap":{srcRGB:"ONE_MINUS_DST_ALPHA",srcA:"ONE",dstRGB:"SRC_ALPHA",dstA:"ZERO"},copy:{shader:a.BLEND_FRAGMENT_SIMPLE+"gl_FragColor = vec4(src.rgb, src.a);}"},copy_cheap:{dstRGB:"ZERO",dstA:"ZERO"},xor:{shader:a.BLEND_FRAGMENT_SIMPLE+"float omSRC = (1.0 - src.a);float omDST = (1.0 - dst.a);gl_FragColor = vec4(src.rgb * omDST + dst.rgb * omSRC, src.a * omDST + dst.a * omSRC);}"},multiply:{shader:a.BLEND_FRAGMENT_COMPLEX+"srcClr * dstClr"+a.BLEND_FRAGMENT_COMPLEX_CAP},multiply_cheap:{srcRGB:"ONE_MINUS_DST_ALPHA",srcA:"ONE",dstRGB:"SRC_COLOR",dstA:"ONE"},screen:{srcRGB:"ONE",srcA:"ONE",dstRGB:"ONE_MINUS_SRC_COLOR",dstA:"ONE_MINUS_SRC_ALPHA"},lighter:{dstRGB:"ONE",dstA:"ONE"},lighten:{shader:a.BLEND_FRAGMENT_COMPLEX+"max(srcClr, dstClr)"+a.BLEND_FRAGMENT_COMPLEX_CAP},darken:{shader:a.BLEND_FRAGMENT_COMPLEX+"min(srcClr, dstClr)"+a.BLEND_FRAGMENT_COMPLEX_CAP},overlay:{shader:a.BLEND_FRAGMENT_OVERLAY_UTIL+a.BLEND_FRAGMENT_COMPLEX+"overlay(dstClr.r,srcClr.r), overlay(dstClr.g,srcClr.g), overlay(dstClr.b,srcClr.b)"+a.BLEND_FRAGMENT_COMPLEX_CAP},"hard-light":{shader:a.BLEND_FRAGMENT_OVERLAY_UTIL+a.BLEND_FRAGMENT_COMPLEX+"overlay(srcClr.r,dstClr.r), overlay(srcClr.g,dstClr.g), overlay(srcClr.b,dstClr.b)"+a.BLEND_FRAGMENT_COMPLEX_CAP},"soft-light":{shader:"float softcurve(float a) {if(a > 0.25) { return sqrt(a); }return ((16.0 * a - 12.0) * a + 4.0) * a;}float softmix(float a, float b) {if(b <= 0.5) { return a - (1.0 - 2.0*b) * a * (1.0 - a); }return a + (2.0 * b - 1.0) * (softcurve(a) - a);}"+a.BLEND_FRAGMENT_COMPLEX+"softmix(dstClr.r,srcClr.r), softmix(dstClr.g,srcClr.g), softmix(dstClr.b,srcClr.b)"+a.BLEND_FRAGMENT_COMPLEX_CAP},"color-dodge":{shader:a.BLEND_FRAGMENT_COMPLEX+"clamp(dstClr / (1.0 - srcClr), 0.0, 1.0)"+a.BLEND_FRAGMENT_COMPLEX_CAP},"color-burn":{shader:a.BLEND_FRAGMENT_COMPLEX+"1.0 - clamp((1.0 - smoothstep(0.0035, 0.9955, dstClr)) / smoothstep(0.0035, 0.9955, srcClr), 0.0, 1.0)"+a.BLEND_FRAGMENT_COMPLEX_CAP},difference:{shader:a.BLEND_FRAGMENT_COMPLEX+"abs(src.rgb - dstClr)"+a.BLEND_FRAGMENT_COMPLEX_CAP},exclusion:{shader:a.BLEND_FRAGMENT_COMPLEX+"dstClr + src.rgb - 2.0 * src.rgb * dstClr"+a.BLEND_FRAGMENT_COMPLEX_CAP},hue:{shader:a.BLEND_FRAGMENT_HSL_UTIL+a.BLEND_FRAGMENT_COMPLEX+"setLum(setSat(srcClr, getSat(dstClr)), getLum(dstClr))"+a.BLEND_FRAGMENT_COMPLEX_CAP},saturation:{shader:a.BLEND_FRAGMENT_HSL_UTIL+a.BLEND_FRAGMENT_COMPLEX+"setLum(setSat(dstClr, getSat(srcClr)), getLum(dstClr))"+a.BLEND_FRAGMENT_COMPLEX_CAP},color:{shader:a.BLEND_FRAGMENT_HSL_UTIL+a.BLEND_FRAGMENT_COMPLEX+"setLum(srcClr, getLum(dstClr))"+a.BLEND_FRAGMENT_COMPLEX_CAP},luminosity:{shader:a.BLEND_FRAGMENT_HSL_UTIL+a.BLEND_FRAGMENT_COMPLEX+"setLum(dstClr, getLum(srcClr))"+a.BLEND_FRAGMENT_COMPLEX_CAP}},b._get_isWebGL=b._set_autoPurge=function(a){a=isNaN(a)?1200:a,-1!==a&&(a=10>a?10:a),this._autoPurge=a},b._get_autoPurge=try{Object.defineProperties(b,{isWebGL:{get:b._get_isWebGL},autoPurge:{get:b._get_autoPurge,set:b._set_autoPurge}})}catch(c){}b._initializeWebGL=function(){if(this.canvas){if(!this._webGLContext||this._webGLContext.canvas!==this.canvas){var a={depth:!1,stencil:!1,premultipliedAlpha:this._transparent,alpha:this._transparent,antialias:this._antialias,preserveDrawingBuffer:this._preserveBuffer},b=this._webGLContext=this._fetchWebGLContext(this.canvas,a);if(!b)return null;b.disable(b.DEPTH_TEST),b.depthMask(!1),b.enable(b.BLEND),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0),b.clearColor(0,0,0,0),b.blendEquationSeparate(b.FUNC_ADD,b.FUNC_ADD),b.blendFuncSeparate(b.ONE,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA),this._createBuffers(),this._initMaterials(),this._updateRenderMode("source-over"),this.updateViewport(this.canvas.width,this.canvas.height),this._directDraw||(this._bufferTextureOutput=this.getRenderBufferTexture(this._viewportWidth,this._viewportHeight)),this.canvas._invalid=!0
}}else this._webGLContext=null;return this._webGLContext},b.update=function(a){if(this.canvas){if(this.tickOnUpdate&&this.tick(a),this.dispatchEvent("drawstart"),this._webGLContext)this.draw(this._webGLContext,!1);else{this.autoClear&&this.clear();var b=this.canvas.getContext("2d");b.save(),this.updateContext(b),this.draw(b,!1),b.restore()}this.dispatchEvent("drawend")}},b.clear=function(){if(this.canvas){var b=this._webGLContext;if(!a.isWebGLActive(b))return void this.Stage_clear();b.bindFramebuffer(b.FRAMEBUFFER,null),this._clearFrameBuffer(this._transparent?this._clearColor.a:1)}},b.draw=function(b,c){var d=this._webGLContext;if(b!==this._webGLContext||!a.isWebGLActive(d))return this.Stage_draw(b,c);var e=this._batchTextureOutput,f=this._batchTextureConcat,g=this._batchTextureTemp;return this._batchVertexCount=0,this._drawID++,this._directDraw?(this._batchTextureOutput=this,this.autoClear&&this.clear()):(this._batchTextureOutput=this._bufferTextureOutput,this._batchTextureConcat=this._bufferTextureConcat,this._batchTextureTemp=this._bufferTextureTemp),this._updateRenderMode("source-over"),this._drawContent(this,c),this._directDraw||(this.autoClear&&this.clear(),this.batchReason="finalOutput",this._drawCover(null,this._batchTextureOutput)),this._bufferTextureOutput=this._batchTextureOutput,this._bufferTextureConcat=this._batchTextureConcat,this._bufferTextureTemp=this._batchTextureTemp,this._batchTextureOutput=e,this._batchTextureConcat=f,this._batchTextureTemp=g,-1===this._autoPurge||this._drawID%(this._autoPurge/2|0)||this.purgeTextures(this._autoPurge),!0},b.cacheDraw=function(b,c){if(!a.isWebGLActive(this._webGLContext))return!1;for(var d=0;d<this._gpuTextureCount;d++)this._batchTextures[d]._frameBuffer&&(this._batchTextures[d]=this._baseTextures[d]);var e=this._batchTextureOutput,f=this._batchTextureConcat,g=this._batchTextureTemp,h=c._filterCount,i=h,j=this._viewportWidth,k=this._viewportHeight;this._updateDrawingSurface(c._drawWidth,c._drawHeight),this._batchTextureOutput=c._filterCount%2?c._bufferTextureConcat:c._bufferTextureOutput,this._batchTextureConcat=c._filterCount%2?c._bufferTextureOutput:c._bufferTextureConcat,this._batchTextureTemp=c._bufferTextureTemp;var l=this._cacheContainer;for(l.children=[b],l.transformMatrix=this._alignTargetToCache(b,c),this._updateRenderMode("source-over"),this._drawContent(l,!0),this.isCacheControlled?(h++,i++):c._cacheCanvas!==(c._filterCount%2?this._batchTextureConcat:this._batchTextureOutput)&&i++;i;){var m=c._getGLFilter(h-i--),n=this._batchTextureConcat;this._batchTextureConcat=this._batchTextureOutput,this._batchTextureOutput=this.isCacheControlled&&0===i?this:n,this.batchReason="filterPass",this._drawCover(this._batchTextureOutput._frameBuffer,this._batchTextureConcat,m)}return c._bufferTextureOutput=this._batchTextureOutput,c._bufferTextureConcat=this._batchTextureConcat,c._bufferTextureTemp=this._batchTextureTemp,this._batchTextureOutput=e,this._batchTextureConcat=f,this._batchTextureTemp=g,this._updateDrawingSurface(j,k),!0},b.releaseTexture=function(a,b){var c,d;if(a){if(a.children)for(c=0,d=a.children.length;d>c;c++)this.releaseTexture(a.children[c],b);a.cacheCanvas&&a.uncache();var e=void 0;if(void 0!==a._storeID){if(a===this._textureDictionary[a._storeID])return this._killTextureObject(a),void(a._storeID=void 0);e=a}else if(2===a._webGLRenderStyle)e=a.image;else if(1===a._webGLRenderStyle){for(c=0,d=a.spriteSheet._images.length;d>c;c++)this.releaseTexture(a.spriteSheet._images[c],b);return}if(void 0===e)return void(this.vocalDebug&&console.log("No associated texture found on release"));var f=this._textureDictionary[e._storeID];if(b){var g=f._imageData,h=g.indexOf(e);h>=0&&g.splice(h,1),e._storeID=void 0,0===g.length&&this._killTextureObject(f)}else this._killTextureObject(f)}},b.purgeTextures=function(a){a>=0||(a=100);for(var b=this._textureDictionary,c=b.length,d=0;c>d;d++){var e,f=b[d];if(f&&(e=f._imageData)){for(var g=0;g<e.length;g++){var h=e[g];h._drawID+a<=this._drawID&&(h._storeID=void 0,e.splice(g,1),g--)}e.length||this._killTextureObject(f)}}},b.updateViewport=function(a,b){a=Math.abs(0|a)||1,b=Math.abs(0|b)||1,this._updateDrawingSurface(a,b),this._bufferTextureOutput!==this&&null!==this._bufferTextureOutput&&this.resizeTexture(this._bufferTextureOutput,this._viewportWidth,this._viewportHeight),null!==this._bufferTextureConcat&&this.resizeTexture(this._bufferTextureConcat,this._viewportWidth,this._viewportHeight),null!==this._bufferTextureTemp&&this.resizeTexture(this._bufferTextureTemp,this._viewportWidth,this._viewportHeight)},b.getFilterShader=function(a){a||(a=this);var b=this._webGLContext,c=this._activeShader;if(a._builtShader)c=a._builtShader,a.shaderParamSetup&&(b.useProgram(c),a.shaderParamSetup(b,this,c));else try{c=this._fetchShaderProgram(!0,a.VTX_SHADER_BODY,a.FRAG_SHADER_BODY,a.shaderParamSetup&&a.shaderParamSetup.bind(a)),a._builtShader=c,c._name=a.toString()}catch(d){console&&console.log("SHADER SWITCH FAILURE",d)}return c},b.getBaseTexture=b.resizeTexture=function(a,b,c){if(a.width!==b||a.height!==c){var d=this._webGLContext;d.bindTexture(d.TEXTURE_2D,a),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b,c,0,d.RGBA,d.UNSIGNED_BYTE,null),a.width=b,a.height=c}},b.getRenderBufferTexture=b.setTextureParams=b.setClearColor=b.toDataURL=function(b,c){var d,e=this._webGLContext;this.batchReason="dataURL";var f=this._clearColor;if(this.canvas)return a.isWebGLActive(e)?(this._preserveBuffer&&void 0===b||(void 0!==b&&(this._clearColor=a.colorToObj(b)),this.clear(),this._directDraw?(console.log("No stored/useable gl render info, result may be incorrect if content was changed since render"),this.draw(e)):this._drawCover(null,this._bufferTextureOutput)),d=this.canvas.toDataURL(c||"image/png"),this._preserveBuffer&&void 0===b||(void 0!==b&&(this._clearColor=f),this.clear(),this._directDraw?this.draw(e):this._drawCover(null,this._bufferTextureOutput)),d):this.Stage_toDataURL(b,c)},b.toString=function(){return"[StageGL (name="+this.name+")]"},b._updateDrawingSurface=function(a,b){this._viewportWidth=a,this._viewportHeight=b,this._webGLContext.viewport(0,0,this._viewportWidth,this._viewportHeight),this._projectionMatrix=new Float32Array([2/a,0,0,0,0,-2/b,0,0,0,0,1,0,-1,1,0,1])},b._getSafeTexture=function(a,b){var c=this.getBaseTexture(a,b);if(!c){var d="Problem creating texture, possible cause: using too much VRAM, please try releasing texture memory";console.error&&console.error(d)||console.log(d),c=this._baseTextures[0]}return c},b._clearFrameBuffer=function(a){var b=this._webGLContext,c=this._clearColor;a>0&&(a=1),0>a&&(a=0),b.clearColor(c.r*a,c.g*a,c.b*a,a),b.clear(b.COLOR_BUFFER_BIT),b.clearColor(0,0,0,0)},b._fetchWebGLContext=b._fetchShaderProgram=function(b,c,d,e){var f=this._webGLContext;f.useProgram(null);var g,h;b?(h=a.COVER_VERTEX_HEADER+(c||a.COVER_VERTEX_BODY),g=a.COVER_FRAGMENT_HEADER+(d||a.COVER_FRAGMENT_BODY)):(h=a.REGULAR_VERTEX_HEADER+(c||a.REGULAR_VERTEX_BODY),g=a.REGULAR_FRAGMENT_HEADER+(d||a.REGULAR_FRAGMENT_BODY));var i=this._createShader(f,f.VERTEX_SHADER,h),j=this._createShader(f,f.FRAGMENT_SHADER,g),k=f.createProgram();if(f.attachShader(k,i),f.attachShader(k,j),f.linkProgram(k),!f.getProgramParameter(k,f.LINK_STATUS))throw f.useProgram(this._activeShader),f.getProgramInfoLog(k);if(f.useProgram(k),k.vertexPositionAttribute=f.getAttribLocation(k,"vertexPosition"),f.enableVertexAttribArray(k.vertexPositionAttribute),k.uvPositionAttribute=f.getAttribLocation(k,"uvPosition"),f.enableVertexAttribArray(k.uvPositionAttribute),b)k.samplerUniform=f.getUniformLocation(k,"uSampler"),f.uniform1i(k.samplerUniform,0),e&&e(f,this,k);else{k.textureIndexAttribute=f.getAttribLocation(k,"textureIndex"),f.enableVertexAttribArray(k.textureIndexAttribute),k.alphaAttribute=f.getAttribLocation(k,"objectAlpha"),f.enableVertexAttribArray(k.alphaAttribute);for(var l=[],m=0;m<this._gpuTextureCount;m++)l[m]=m;k.samplerData=l,k.samplerUniform=f.getUniformLocation(k,"uSampler"),f.uniform1iv(k.samplerUniform,k.samplerData),k.pMatrixUniform=f.getUniformLocation(k,"pMatrix")}return k._type=b?"cover":"batch",f.useProgram(this._activeShader),k},b._createShader=function(a,b,c){var d=this._batchTextureCount;if(c=c.replace(/\{\{count}}/g,d),b===a.FRAGMENT_SHADER){for(var e="",f=1;d>f;f++)e+="} else if (indexPicker <= "+f+".5) { color = texture2D(uSampler["+f+"], vTextureCoord);";c=c.replace(/\{\{alternates}}/g,e)}var g=a.createShader(b);if(a.shaderSource(g,c),a.compileShader(g),!a.getShaderParameter(g,a.COMPILE_STATUS))throw a.getShaderInfoLog(g);return g},b._createBuffers=function(){var a,b,c,d=this._webGLContext,e=this._maxBatchVertexCount,f=this._vertexPositionBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,f),a=2;var g=this._vertices=new Float32Array(e*a);for(b=0,c=g.length;c>b;b+=a)g[b]=g[b+1]=0;d.bufferData(d.ARRAY_BUFFER,g,d.DYNAMIC_DRAW),f.itemSize=a,f.numItems=e;var h=this._uvPositionBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,h),a=2;var i=this._uvs=new Float32Array(e*a);for(b=0,c=i.length;c>b;b+=a)i[b]=i[b+1]=0;d.bufferData(d.ARRAY_BUFFER,i,d.DYNAMIC_DRAW),h.itemSize=a,h.numItems=e;var j=this._textureIndexBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,j),a=1;var k=this._indices=new Float32Array(e*a);for(b=0,c=k.length;c>b;b++)k[b]=0;d.bufferData(d.ARRAY_BUFFER,k,d.DYNAMIC_DRAW),j.itemSize=a,j.numItems=e;var l=this._alphaBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,l),a=1;var m=this._alphas=new Float32Array(e*a);for(b=0,c=m.length;c>b;b++)m[b]=1;d.bufferData(d.ARRAY_BUFFER,m,d.DYNAMIC_DRAW),l.itemSize=a,l.numItems=e},b._initMaterials=function(){var a=this._webGLContext;this._lastTextureInsert=-1,this._textureDictionary=[],this._textureIDs={},this._baseTextures=[],this._batchTextures=[],this._gpuTextureCount=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),this._gpuTextureMax=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._batchTextureCount=this._gpuTextureCount;for(var b=!1;!b;)try{this._activeShader=this._fetchShaderProgram(!1),b=!0}catch(c){if(this._batchTextureCount<=1)throw"Cannot compile shader "+c;this._batchTextureCount=this._batchTextureCount/2|0,this.vocalDebug&&console.log("Reducing possible texture count due to errors: "+this._batchTextureCount)}this._mainShader=this._activeShader,this._mainShader._name="main";var d=this.getBaseTexture();if(!d)throw"Problems creating basic textures, known causes include using too much VRAM by not releasing WebGL texture instances";d._storeID=-1;for(var e=0;e<this._batchTextureCount;e++)this._baseTextures[e]=this._batchTextures[e]=d},b._loadTextureImage=function(a,b){var c,d,e;if(b instanceof Image&&b.src)c=b.src;else{if(!(b instanceof HTMLCanvasElement))return e="Invalid image provided as source. Please ensure source is a correct DOM element.",void(console.error&&console.error(e,b)||console.log(e,b));b._isCanvas=!0,c="canvas_"+ ++this._lastTrackedCanvas}var f=this._textureIDs[c];return void 0===f?(this._textureIDs[c]=f=this._textureDictionary.length,b._storeID=f,b._invalid=!0,d=this._getSafeTexture(),this._textureDictionary[f]=d):(b._storeID=f,d=this._textureDictionary[f]),-1!==d._storeID&&(d._storeID=f,d._imageData?d._imageData.push(b):d._imageData=[b]),this._insertTextureInBatch(a,d),d},b._updateTextureImageData=function(a,b){if(b.complete||b._isCanvas||b.naturalWidth){var c=b.width&b.width-1||b.height&b.height-1,d=this._textureDictionary[b._storeID];a.activeTexture(a.TEXTURE0+d._activeIndex),a.bindTexture(a.TEXTURE_2D,d),d.isPOT=!c,this.setTextureParams(a,d.isPOT);try{a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b)}catch(e){var f="\nAn error has occurred. This is most likely due to security restrictions on WebGL images with local or cross-domain origins";console.error?(console.error(f),console.error(e)):console&&(console.log(f),console.log(e))}a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),void 0!==b._invalid&&(b._invalid=!1),d.width=b.width,d.height=b.height,this.vocalDebug&&(c&&this._antialias&&console.warn("NPOT(Non Power of Two) Texture w/ antialias on: "+b.src),(b.width>a.MAX_TEXTURE_SIZE||b.height>a.MAX_TEXTURE_SIZE)&&console&&console.error("Oversized Texture: "+b.width+"x"+b.height+" vs "+a.MAX_TEXTURE_SIZE+"max"))}},b._insertTextureInBatch=function(a,b){var c;if(this._batchTextures[b._activeIndex]!==b){var d=-1,e=(this._lastTextureInsert+1)%this._batchTextureCount,f=e;do{if(this._batchTextures[f]._batchID!==this._batchID&&!this._slotBlacklist[f]){d=f;break}f=(f+1)%this._batchTextureCount}while(f!==e);-1===d&&(this.batchReason="textureOverflow",this._renderBatch(),d=e),this._batchTextures[d]=b,b._activeIndex=d,c=b._imageData&&b._imageData[0],c&&(void 0===c._invalid&&c._isCanvas||c._invalid)&&this._updateTextureImageData(a,c),this._lastTextureInsert=d}else b._drawID!==this._drawID&&(c=b._imageData&&b._imageData[0],c&&(void 0===c._invalid&&c._isCanvas||c._invalid)&&this._updateTextureImageData(a,c));b._drawID=this._drawID,b._batchID=this._batchID},b._killTextureObject=function(a){if(a){var b=this._webGLContext;if(void 0!==a._storeID&&a._storeID>=0){this._textureDictionary[a._storeID]=void 0;for(var c in this._textureIDs)this._textureIDs[c]===a._storeID&&delete this._textureIDs[c];var d=a._imageData;if(d)for(var e=d.length-1;e>=0;e--)d[e]._storeID=void 0;a._imageData=a._storeID=void 0}void 0!==a._activeIndex&&this._batchTextures[a._activeIndex]===a&&(this._batchTextures[a._activeIndex]=this._baseTextures[a._activeIndex]);try{a._frameBuffer&&b.deleteFramebuffer(a._frameBuffer),a._frameBuffer=void 0}catch(f){this.vocalDebug&&console.log(f)}try{b.deleteTexture(a)}catch(f){this.vocalDebug&&console.log(f)}}},b._setCoverMixShaderParams=function(a,b,c){a.uniform1i(a.getUniformLocation(c,"uMixSampler"),1)},b._updateRenderMode=function(b){(null===b||void 0===b)&&(b="source-over");var c=a.BLEND_SOURCES[b];if(void 0===c&&(this.vocalDebug&&console.log("Unknown compositeOperation ["+b+"], reverting to default"),c=a.BLEND_SOURCES[b="source-over"]),this._renderMode!==b){var d=this._webGLContext,e=this._builtShaders[b];if(void 0===e)try{e=this._builtShaders[b]={eqRGB:d[c.eqRGB||"FUNC_ADD"],srcRGB:d[c.srcRGB||"ONE"],dstRGB:d[c.dstRGB||"ONE_MINUS_SRC_ALPHA"],eqA:d[c.eqA||"FUNC_ADD"],srcA:d[c.srcA||"ONE"],dstA:d[c.dstA||"ONE_MINUS_SRC_ALPHA"],immediate:void 0!==c.shader,shader:c.shader||void 0===this._builtShaders["source-over"]?this._fetchShaderProgram(!0,void 0,c.shader,this._setCoverMixShaderParams):this._builtShaders["source-over"].shader},c.shader&&(e.shader._name=b)}catch(f){return this._builtShaders[b]=void 0,void(console&&console.log("SHADER SWITCH FAILURE",f))}if(e.immediate&&this._directDraw)return void(this.vocalDebug&&console.log("Illegal compositeOperation ["+b+"] due to StageGL.directDraw = true, reverting to default"));d.bindFramebuffer(d.FRAMEBUFFER,this._batchTextureOutput._frameBuffer),this.batchReason="shaderSwap",this._renderBatch(),this._renderMode=b,this._immediateRender=e.immediate,d.blendEquationSeparate(e.eqRGB,e.eqA),d.blendFuncSeparate(e.srcRGB,e.dstRGB,e.srcA,e.dstA)}},b._drawContent=function(a,b){var c=this._webGLContext;this._activeShader=this._mainShader,c.bindFramebuffer(c.FRAMEBUFFER,this._batchTextureOutput._frameBuffer),null!==this._batchTextureOutput._frameBuffer&&c.clear(c.COLOR_BUFFER_BIT),this._appendToBatch(a,new createjs.Matrix2D,this.alpha,b),this.batchReason="contentEnd",this._renderBatch()},b._drawCover=function(a,b,c){var d=this._webGLContext;d.bindFramebuffer(d.FRAMEBUFFER,a),null!==a&&d.clear(d.COLOR_BUFFER_BIT),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,b),this.setTextureParams(d),c instanceof createjs.Filter?this._activeShader=this.getFilterShader(c):(c instanceof WebGLTexture?(d.activeTexture(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,c),this.setTextureParams(d)):void 0!==c&&this.vocalDebug&&console.log("Unknown data handed to function: ",c),this._activeShader=this._builtShaders[this._renderMode].shader),this._renderCover()},b._alignTargetToCache=function(a,b){null===b._counterMatrix?b._counterMatrix=a.getMatrix():a.getMatrix(b._counterMatrix);var c=b._counterMatrix;return c.scale(1/b.scale,1/b.scale),c=c.invert(),c.translate(-b.offX/b.scale*a.scaleX,-b.offY/b.scale*a.scaleY),c},b._appendToBatch=function(b,c,d,e){var f=this._webGLContext,g=b._glMtx;g.copy(c),null!==b.transformMatrix?g.appendMatrix(b.transformMatrix):g.appendTransform(b.x,b.y,b.scaleX,b.scaleY,b.rotation,b.skewX,b.skewY,b.regX,b.regY);var h=this._renderMode;b.compositeOperation&&this._updateRenderMode(b.compositeOperation);for(var i,j,k,l,m=b.children.length,n=0;m>n;n++){var o=b.children[n],p=!e&&o.cacheCanvas||!1;if(o.visible&&d>.0035){var q=o.alpha;if(p===!1&&(o._updateState&&o._updateState(),!this._directDraw&&!e&&null===o.cacheCanvas&&null!==o.filters&&o.filters.length)){var r;if(null===o.bitmapCache&&(r=o.getBounds(),o.bitmapCache=new createjs.BitmapCache,o.bitmapCache._autoGenerated=!0),o.bitmapCache._autoGenerated){this.batchReason="cachelessFilterInterupt",this._renderBatch(),o.alpha=1;var s=this._activeShader;r=r||o.getBounds(),o.bitmapCache.define(o,r.x,r.y,r.width,r.height,1,{useGL:this}),p=o.bitmapCache._cacheCanvas,o.alpha=q,this._activeShader=s,f.bindFramebuffer(f.FRAMEBUFFER,this._batchTextureOutput._frameBuffer)}}if(p===!1&&o.children)this._appendToBatch(o,g,q*d);else{var t=this._renderMode;o.compositeOperation&&this._updateRenderMode(o.compositeOperation),this._batchVertexCount+a.INDICIES_PER_CARD>this._maxBatchVertexCount&&(this.batchReason="vertexOverflow",this._renderBatch());var u=o._glMtx;u.copy(g),o.transformMatrix?u.appendMatrix(o.transformMatrix):u.appendTransform(o.x,o.y,o.scaleX,o.scaleY,o.rotation,o.skewX,o.skewY,o.regX,o.regY);var v,w,x,y,z,A;if(2===o._webGLRenderStyle||p!==!1)x=p===!1?o.image:p;else{if(1!==o._webGLRenderStyle)continue;if(y=o.spriteSheet.getFrame(o.currentFrame),null===y)continue;x=y.image}if(x){var B=this._uvs,C=this._vertices,D=this._indices,E=this._alphas;if(void 0===x._storeID)z=this._loadTextureImage(f,x);else{if(z=this._textureDictionary[x._storeID],!z){this.vocalDebug&&console.log("Image source should not be lookup a non existent texture, please report a bug.");continue}z._batchID!==this._batchID&&this._insertTextureInBatch(f,z)}if(w=z._activeIndex,x._drawID=this._drawID,2===o._webGLRenderStyle||p!==!1)p===!1&&o.sourceRect?(o._uvRect||(o._uvRect={}),A=o.sourceRect,v=o._uvRect,v.t=1-A.y/x.height,v.l=A.x/x.width,v.b=1-(A.y+A.height)/x.height,v.r=(A.x+A.width)/x.width,i=0,j=0,k=A.width+i,l=A.height+j):(v=a.UV_RECT,p===!1?(i=0,j=0,k=x.width+i,l=x.height+j):(A=o.bitmapCache,i=A.x+A._filterOffX/A.scale,j=A.y+A._filterOffY/A.scale,k=A._drawWidth/A.scale+i,l=A._drawHeight/A.scale+j));else if(1===o._webGLRenderStyle){var F=y.rect;v=y.uvRect,v||(v=a.buildUVRects(o.spriteSheet,o.currentFrame,!1)),i=-y.regX,j=-y.regY,k=F.width-y.regX,l=F.height-y.regY}var G=this._batchVertexCount,H=2*G;C[H]=i*u.a+j*u.c+u.tx,C[H+1]=i*u.b+j*u.d+u.ty,C[H+2]=i*u.a+l*u.c+u.tx,C[H+3]=i*u.b+l*u.d+u.ty,C[H+4]=k*u.a+j*u.c+u.tx,C[H+5]=k*u.b+j*u.d+u.ty,C[H+6]=C[H+2],C[H+7]=C[H+3],C[H+8]=C[H+4],C[H+9]=C[H+5],C[H+10]=k*u.a+l*u.c+u.tx,C[H+11]=k*u.b+l*u.d+u.ty,B[H]=v.l,B[H+1]=v.t,B[H+2]=v.l,B[H+3]=v.b,B[H+4]=v.r,B[H+5]=v.t,B[H+6]=v.l,B[H+7]=v.b,B[H+8]=v.r,B[H+9]=v.t,B[H+10]=v.r,B[H+11]=v.b,D[G]=D[G+1]=D[G+2]=D[G+3]=D[G+4]=D[G+5]=w,E[G]=E[G+1]=E[G+2]=E[G+3]=E[G+4]=E[G+5]=q*d,this._batchVertexCount+=a.INDICIES_PER_CARD,this._immediateRender&&this._immediateBatchRender(),this._renderMode!==t&&this._updateRenderMode(t)}}}}this._renderMode!==h&&this._updateRenderMode(h)},b._immediateBatchRender=function(){var a=this._webGLContext;null===this._batchTextureConcat?this._batchTextureConcat=this.getRenderBufferTexture(this._viewportWidth,this._viewportHeight):(this.resizeTexture(this._batchTextureConcat,this._viewportWidth,this._viewportHeight),a.bindFramebuffer(a.FRAMEBUFFER,this._batchTextureConcat._frameBuffer),a.clear(a.COLOR_BUFFER_BIT)),null===this._batchTextureTemp?(this._batchTextureTemp=this.getRenderBufferTexture(this._viewportWidth,this._viewportHeight),a.bindFramebuffer(a.FRAMEBUFFER,this._batchTextureTemp._frameBuffer)):(this.resizeTexture(this._batchTextureTemp,this._viewportWidth,this._viewportHeight),a.bindFramebuffer(a.FRAMEBUFFER,this._batchTextureTemp._frameBuffer),a.clear(a.COLOR_BUFFER_BIT));var b=this._batchTextureOutput;this._batchTextureOutput=this._batchTextureConcat,this._batchTextureConcat=b,this._activeShader=this._mainShader,this.batchReason="immediatePrep",this._renderBatch(),this.batchReason="immediateResults",this._drawCover(this._batchTextureOutput._frameBuffer,this._batchTextureConcat,this._batchTextureTemp),a.bindFramebuffer(a.FRAMEBUFFER,this._batchTextureOutput._frameBuffer)},b._renderBatch=function(){if(!(this._batchVertexCount<=0)){var a=this._webGLContext;this.vocalDebug&&console.log("Batch["+this._drawID+":"+this._batchID+"] : "+this.batchReason);var b=this._activeShader,c=this._vertexPositionBuffer,d=this._textureIndexBuffer,e=this._uvPositionBuffer,f=this._alphaBuffer;a.useProgram(b),a.bindBuffer(a.ARRAY_BUFFER,c),a.vertexAttribPointer(b.vertexPositionAttribute,c.itemSize,a.FLOAT,!1,0,0),a.bufferSubData(a.ARRAY_BUFFER,0,this._vertices),a.bindBuffer(a.ARRAY_BUFFER,d),a.vertexAttribPointer(b.textureIndexAttribute,d.itemSize,a.FLOAT,!1,0,0),a.bufferSubData(a.ARRAY_BUFFER,0,this._indices),a.bindBuffer(a.ARRAY_BUFFER,e),a.vertexAttribPointer(b.uvPositionAttribute,e.itemSize,a.FLOAT,!1,0,0),a.bufferSubData(a.ARRAY_BUFFER,0,this._uvs),a.bindBuffer(a.ARRAY_BUFFER,f),a.vertexAttribPointer(b.alphaAttribute,f.itemSize,a.FLOAT,!1,0,0),a.bufferSubData(a.ARRAY_BUFFER,0,this._alphas),a.uniformMatrix4fv(b.pMatrixUniform,a.FALSE,this._projectionMatrix);for(var g=0;g<this._batchTextureCount;g++)a.activeTexture(a.TEXTURE0+g),a.bindTexture(a.TEXTURE_2D,this._batchTextures[g]);a.drawArrays(a.TRIANGLES,0,this._batchVertexCount),this._batchVertexCount=0,this._batchID++}},b._renderCover=function(){var b=this._webGLContext;this.vocalDebug&&console.log("Cover["+this._drawID+":"+this._batchID+"] : "+this.batchReason);var c=this._activeShader,d=this._vertexPositionBuffer,e=this._uvPositionBuffer;b.useProgram(c),b.bindBuffer(b.ARRAY_BUFFER,d),b.vertexAttribPointer(c.vertexPositionAttribute,d.itemSize,b.FLOAT,!1,0,0),b.bufferSubData(b.ARRAY_BUFFER,0,a.COVER_VERT),b.bindBuffer(b.ARRAY_BUFFER,e),b.vertexAttribPointer(c.uvPositionAttribute,e.itemSize,b.FLOAT,!1,0,0),b.bufferSubData(b.ARRAY_BUFFER,0,a.COVER_UV),b.uniform1i(c.samplerUniform,0),b.drawArrays(b.TRIANGLES,0,a.INDICIES_PER_CARD),this._batchID++},createjs.StageGL=createjs.promote(a,"Stage")}(),this.createjs=this.createjs||{},function(){ar b=createjs.extend(a,createjs.DisplayObject);b.initialize=a,b.isVisible=b.draw=b.getBounds=b.clone=function(b){var c=this.image;c&&b&&(c=c.cloneNode(),c.src=c.src);var d=new a(c);return this.sourceRect&&(d.sourceRect=this.sourceRect.clone()),this._cloneProps(d),d},b.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},function(){"use strict";ar b=a.prototype;a.isValidImageSource=function(a){return Boolean(a)&&(a instanceof Image||a instanceof WebGLTexture||a instanceof HTMLCanvasElement)},b.getBounds=b.shaderParamSetup=b.applyFilter=function(a,b,c,d,e,f){f=f||a;try{var g=a.getImageData(b,c,d,e)}catch(h){return!1}return this._applyFilter(g)?(f.putImageData(g,b,c),!0):!1},b.toString=function(){return"[Filter]"},b.clone=b._applyFilter=createjs.Filter=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.width=void 0,this.height=void 0,this.x=void 0,this.y=void 0,this.scale=1,this.offX=0,this.offY=0,this.cacheID=0,this._filterCount=0,this._filterOffX=0,this._filterOffY=0,this._disabled=!1,this._autoGenerated=!1,this._cacheCanvas=null,this._stageGL=null,this._cacheDataURLID=0,this._cacheDataURL=null,this._drawWidth=0,this._drawHeight=0,this._boundRect=new createjs.Rectangle,this._counterMatrix=null,this._bufferTextureOutput=null,this._bufferTextureConcat=null,this._bufferTextureTemp=null}var b=a.prototype;b._get_disabled=function(){return this._disabled},b._set_disabled=function(a){this._disabled=!!a,this.target&&(this.target.cacheCanvas=this._disabled||this._autoGenerated?null:this._cacheCanvas)};try{Object.defineProperties(b,{disabled:{get:b._get_disabled,set:b._set_disabled}})}catch(c){}a.getFilterBounds=function(a,b){b||(b=new createjs.Rectangle);var c=a.filters,d=c&&c.length;if(0>=!!d)return b;for(var e=0;d>e;e++){var f=c[e];if(f&&f.getBounds){var g=f.getBounds();g&&(0===e?b.setValues(g.x,g.y,g.width,g.height):b.extend(g.x,g.y,g.width,g.height))}}return b},a.filterCounter=function(a,b){for(var c=1;b._multiPass;)b=b._multiPass,c++;return a+c},b.toString=function(){return"[BitmapCache]"},b.define=b.update=function(b){if(!this.target)throw"define() must be called before update()";var c=a.getFilterBounds(this.target),d=this._cacheCanvas;this._drawWidth=Math.ceil(this.width*this.scale)+c.width,this._drawHeight=Math.ceil(this.height*this.scale)+c.height,this._filterCount=this.target.filters&&this.target.filters.reduce(a.filterCounter,0),d&&this._drawWidth===d.width&&this._drawHeight===d.height||this._updateSurface(),this._stageGL&&(null===this._bufferTextureOutput?this._bufferTextureOutput=this._stageGL.getRenderBufferTexture(this._drawWidth,this._drawHeight):this._stageGL.resizeTexture(this._bufferTextureOutput,this._drawWidth,this._drawHeight),null===this._cacheCanvas&&(this._cacheCanvas=this._bufferTextureOutput,this.disabled=this._disabled),this._filterCount>=1&&(null===this._bufferTextureConcat?this._bufferTextureConcat=this._stageGL.getRenderBufferTexture(this._drawWidth,this._drawHeight):this._stageGL.resizeTexture(this._bufferTextureConcat,this._drawWidth,this._drawHeight))),this._filterOffX=c.x,this._filterOffY=c.y,this.offX=this.x*this.scale+this._filterOffX,this.offY=this.y*this.scale+this._filterOffY,this._drawToCache(b),this.cacheID=this.cacheID?this.cacheID+1:1},b.release=function(){if(this._stageGL)null!==this._bufferTextureOutput&&this._stageGL._killTextureObject(this._bufferTextureOutput),null!==this._bufferTextureConcat&&this._stageGL._killTextureObject(this._bufferTextureConcat),null!==this._bufferTextureTemp&&this._stageGL._killTextureObject(this._bufferTextureTemp),this._stageGL=!1;else{var a=this.target.stage;a instanceof createjs.StageGL&&a.releaseTexture(this._cacheCanvas)}this.disabled=!0,this.target=this._cacheCanvas=null,this.cacheID=this._cacheDataURLID=this._cacheDataURL=void 0,this.width=this.height=this.x=this.y=this.offX=this.offY=0,this.scale=1},b.getCacheDataURL=function(){var a=this.target&&this._cacheCanvas;return a?(this.cacheID!==this._cacheDataURLID&&(this._cacheDataURLID=this.cacheID,this._cacheDataURL=a.toDataURL?a.toDataURL():null),this._cacheDataURL):null},b.draw=function(a){return this.target?(a.drawImage(this._cacheCanvas,this.x+this._filterOffX/this.scale,this.y+this._filterOffY/this.scale,this._drawWidth/this.scale,this._drawHeight/this.scale),!0):!1},b.getBounds=function(){var a=this.scale;return this._boundRect.setValues(this.x,this.y,this.width/a,this.height/a)},b._getGLFilter=function(a){if(null===this.target.filters||0>a)return void 0;for(var b=0,c=this.target.filters[b];c&&--a>=0;)c=c._multiPass?c._multiPass:this.target.filters[++b];return c},b._updateSurface=function(){var a;if(!this._options||!this._options.useGL)return a=this._cacheCanvas,a||(a=this._cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),this.disabled=this._disabled),a.width=this._drawWidth,void(a.height=this._drawHeight);if(!this._stageGL)if("stage"===this._options.useGL){var b=this.target.stage;if(!b||!b.isWebGL){var c="Cannot use 'stage' for cache because the object's parent stage is ";throw c+=b?"non WebGL.":"not set, please addChild to the correct stage."}this._stageGL=b}else if("new"===this._options.useGL){if(this._cacheCanvas=document.createElement("canvas"),this._stageGL=new createjs.StageGL(this._cacheCanvas,{antialias:!0,transparent:!0,autoPurge:10}),!this._stageGL._webGLContext)throw"GL Cache asked for but unavailable";this._stageGL.isCacheControlled=!0}else{if(!(this._options.useGL instanceof createjs.StageGL))throw"Invalid option provided to useGL, expected ['stage', 'new', StageGL, undefined], got "+this._options.useGL;this._stageGL=this._options.useGL}this.disabled=this._disabled;var d=this._stageGL;d.isCacheControlled&&(a=this._cacheCanvas,a.width=this._drawWidth,a.height=this._drawHeight,d.updateViewport(this._drawWidth,this._drawHeight))},b._drawToCache=function(a){var b=this._cacheCanvas,c=this.target,d=this._stageGL;if(d)d.cacheDraw(c,this);else{var e=b.getContext("2d");a||e.clearRect(0,0,this._drawWidth+1,this._drawHeight+1),e.save(),e.globalCompositeOperation=a,e.setTransform(this.scale,0,0,this.scale,-this._filterOffX,-this._filterOffY),e.translate(-this.x,-this.y),c.draw(e,!0),e.restore(),c.filters&&c.filters.length&&this._applyFilters(e)}b._invalid=!0},b._applyFilters=createjs.BitmapCache=a}(),this.createjs=this.createjs||{},function(){"use strict";ar b=createjs.extend(a,createjs.Filter);b.getBlurX=function(){return this._blurX},b.getBlurY=function(){return this._blurY},b.setBlurX=function(a){(isNaN(a)||0>a)&&(a=0),this._blurX=a},b.setBlurY=b.getQuality=b.setQuality=b._getShader=b._setShader=try{Object.defineProperties(b,{blurX:{get:b.getBlurX,set:b.setBlurX},blurY:{get:b.getBlurY,set:b.setBlurY},quality:{get:b.getQuality,set:b.setQuality},_builtShader:{get:b._getShader,set:b._setShader}})}catch(c){console.log(c)}b._getTable=b._updateShader=b.shaderParamSetup=a.MUL_TABLE=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],a.SHG_TABLE=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9],b.getBounds=b.clone=b.toString=function(){return"[BlurFilter]"},b._applyFilter=createjs.BlurFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){if(this.Filter_constructor(),!createjs.Filter.isValidImageSource(a))throw"Must provide valid image source for alpha map, see Filter.isValidImageSource";this.alphaMap=a,this._map=null,this._mapCtx=null,this._mapTexture=null,this.FRAG_SHADER_BODY="uniform sampler2D uAlphaSampler;void main(void) {vec4 color = texture2D(uSampler, vTextureCoord);vec4 alphaMap = texture2D(uAlphaSampler, vTextureCoord);float newAlpha = alphaMap.r * ceil(alphaMap.a);gl_FragColor = vec4(clamp(color.rgb/color.a, 0.0, 1.0) * newAlpha, newAlpha);}",a instanceof WebGLTexture&&(this._mapTexture=a)}var b=createjs.extend(a,createjs.Filter);b.shaderParamSetup=function(a,b,c){null===this._mapTexture&&(this._mapTexture=a.createTexture()),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._mapTexture),b.setTextureParams(a),this.alphaMap!==this._mapTexture&&a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.alphaMap),a.uniform1i(a.getUniformLocation(c,"uAlphaSampler"),1)},b.clone=function(){var b=new a(this.alphaMap);return b},b.toString=function(){return"[AlphaMapFilter]"},b._applyFilter=function(a){if(!this._prepAlphaMap())return!1;for(var b,c,d,e,f=a.data,g=a.width,h=a.height,i=this._mapCtx.getImageData(0,0,this._map.width,this._map.height),j=i.data,k=i.width,l=i.height,m=k/g,n=l/h,o=0;h>o;o++){b=o*g,d=(o*n|0)*k;for(var p=0;g>p;p++)c=4*(b+p),e=4*(d+(p*m|0)),f[c]=f[c],f[c+1]=f[c+1],f[c+2]=f[c+2],f[c+3]=j[e]}return!0},b._prepAlphaMap=function(){if(!this.alphaMap)return!1;if(this.alphaMap===this._map&&this._mapCtx)return!0;var a,b=this._map=this.alphaMap,c=b;return b instanceof HTMLCanvasElement?a=c.getContext("2d"):(c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),c.width=b.width,c.height=b.height,a=c.getContext("2d"),a.drawImage(b,0,0)),this._mapCtx=a,!0},createjs.AlphaMapFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){if(this.Filter_constructor(),!createjs.Filter.isValidImageSource(a))throw"Must provide valid image source for alpha mask, see Filter.isValidImageSource";this.mask=a,this.usesContext=!0,this.FRAG_SHADER_BODY="uniform sampler2D uAlphaSampler;void main(void) {vec4 color = texture2D(uSampler, vTextureCoord);vec4 alphaMap = texture2D(uAlphaSampler, vTextureCoord);gl_FragColor = vec4(color.rgb * alphaMap.a, color.a * alphaMap.a);}"}var b=createjs.extend(a,createjs.Filter);b.shaderParamSetup=function(a,b,c){this._mapTexture||(this._mapTexture=a.createTexture()),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._mapTexture),b.setTextureParams(a),this.mask!==this._mapTexture&&a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.mask),a.uniform1i(a.getUniformLocation(c,"uAlphaSampler"),1)},b.applyFilter=function(a,b,c,d,e,f){return this.mask?(void 0===f&&(f=a),f!==a&&f.drawImage(a.canvas,0,0,a.canvas.width,a.canvas.height,0,0,f.canvas.width,f.canvas.height),f.save(),f.globalCompositeOperation="destination-in",f.drawImage(this.mask,0,0,this.mask.width,this.mask.height,b,c,d,e),f.restore(),!0):!0},b.clone=function(){return new a(this.mask)},b.toString=function(){return"[AlphaMaskFilter]"
},createjs.AlphaMaskFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},function(){"use strict";ar b=a.prototype;a.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],a.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],a.LENGTH=a.IDENTITY_MATRIX.length,a.createSepiaPreset=function(){return(new a).copy([.4977,.9828,.1322,0,14,.4977,.9828,.1322,0,-14,.4977,.9828,.1322,0,-47,0,0,0,1,0,0,0,0,0,1])},a.createInvertPreset=function(){return(new a).copy([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0,0,0,0,0,1])},a.createGreyscalePreset=function(){return(new a).copy([.3333,.3334,.3333,0,0,.3333,.3334,.3333,0,0,.3333,.3334,.3333,0,0,0,0,0,1,0,0,0,0,0,1])},b.setColor=b.reset=b.adjustColor=b.adjustBrightness=b.adjustOffset=function(a,b,c){return isNaN(a)||isNaN(b)||isNaN(c)?this:(this[4]=this._cleanValue(this[4]+a,255),this[9]=this._cleanValue(this[9]+b,255),this[14]=this._cleanValue(this[14]+c,255),this)},b.adjustContrast=b.adjustSaturation=b.adjustHue=b.concat=b.clone=b.toArray=b.copy=b.toString=function(){var a="";return a+="    "+this[0].toFixed(4)+", "+this[1].toFixed(4)+", "+this[2].toFixed(4)+", "+this[3].toFixed(4)+", "+(0|this[4])+",\n",a+="    "+this[5].toFixed(4)+", "+this[6].toFixed(4)+", "+this[7].toFixed(4)+", "+this[8].toFixed(4)+", "+(0|this[9])+",\n",a+="    "+this[10].toFixed(4)+", "+this[11].toFixed(4)+", "+this[12].toFixed(4)+", "+this[13].toFixed(4)+", "+(0|this[14])+",\n",a+="    "+this[15].toFixed(4)+", "+this[16].toFixed(4)+", "+this[17].toFixed(4)+", "+this[18].toFixed(4)+", "+(0|this[19])+",\n",a+="    "+(0|this[20])+", "+(0|this[21])+", "+(0|this[22])+", "+(0|this[23])+", "+(0|this[24])+"\n","[ColorMatrix] {\n"+a+"}"},b._multiplyMatrix=b._cleanValue=b._fixMatrix=createjs.ColorMatrix=a}(),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},),this.createjs=this.createjs||{},);