(self.webpackChunkWPS_Drive=self.webpackChunkWPS_Drive||[]).push([[8409],{8409:function(t,e,n){"use strict";n.d(e,{Z:function(){return Xe}});var r=n(37311),i=n(2406),o=n.n(i),s=n(18487),u=n(31240),a=n(49200),c=n(54813),l=n.n(c),f=n(80589),d=n(16548),p=n(45578),h=n.n(p),v=r m=!1,g={Promise:void 0,set useDeprecatedSynchronousErrorHandlingget useDeprecatedSynchronousErrorHandling(){return m}};ar _={closed:!0,next:error:complete:function(){}},x=);ar T=),C=);ar S=),O=C),j=O);var I=);r P=);r D=new P($);ar B=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new V(t,this.project,this.thisArg))},t}(),V=O);r H=),R=C),K=O),q=P),z=q);function Y(t){return t&&"function"==typeof t.schedule}var U=ar X=W(),G=ar Q= rt=O),it=O);r ut=),at=it);pt=),ht=O),vt=P),bt=),yt=K);var mt=); xt=),kt=O),Tt=C)),Ct=),Et=new(Ct))(Tt);ar Ot=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new jt(t,this.dueTime,this.scheduler))},t}(),jt=O);ar Lt=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new Nt(t,this.compare,this.keySelector))},t}(),Nt=O);ar At=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new $t(t,this.project))},t}(),$t=it);ar Mt=),Bt=it);function Vt(t,e){return e?function(e){return e.lift(new Zt(t))}}var Zt=),Ft=function(t){eturn b(e,t),e.prototype._next=e.prototype.tryNext=e.prototype._innerSub=e.prototype._complete=e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=e.prototype.notifyComplete=e}(it);ar Rt=),Kt=it);ar zt,Yt=),Ut=O),Wt=n(20144),Xt=n(87936),Gt=n(7626),Jt=n.n(Gt),Qt=n(86107),te=n(45821),ee=n(47189),ne=n(26426),re=n.n(ne),ie=(null===Wt.default||void 0===Wt.default||null===(zt=Wt.default.util)||void 0===zt?void 0:zt.warn)||function(){};nction ue(t){var e=this,n=Array.isArray(t)?t:[t];return new P((function(t){var r=n.map((function(n){var r=return e.$on(n,r),{name:n,callback:r}}));return function(){r.forEach(()}}))}var ae={directives:{stream:{bind:function(t,e,n){var r=e.value,i=e.arg,o=e.expression,s=e.modifiers;if(oe(r))r={subject:r};else if(!r||!oe(r.subject))return void ie('Invalid Subject found in directive with key "'+o+'".'+o+" should be an instance of Subject or have the type { subject: Subject, data: any }.",n.context);var u={stop:function(t){return t.stopPropagation()},prevent:,a=Object.keys(u).filter((function(t){return s[t]})),c=r.subject,l=(c.next||c.onNext).bind(c);if(!s.native&&n.componentInstance)r.subscription=ue.call(n.componentInstance,[i]).subscribe((function(t){a.forEach((function(e){return u[e](t)})),l({event:t,data:r.data})}));else{var f=r.options?[t,i,r.options]:[t,i];r.subscription=Z.apply(void 0,f).subscribe((function(t){a.forEach((function(e){return u[e](t)})),l({event:t,data:r.data})}))}(t._rxHandles||(t._rxHandles={}))[se(e)]=r},update:unbind:function(t,e){var n=se(e),r=t._rxHandles&&t._rxHandles[n];r&&(r.subscription&&r.subscription.unsubscribe(),t._rxHandles[n]=null)}}},created:function(){var t=this,e=t.$options.domStreams;e&&e.forEach(();var n=t.$options.observableMethods;n&&(Array.isArray(n)?n.forEach((function(e){t[e+"$"]=t.$createObservableMethod(e)})):Object.keys(n).forEach(());var r=t.$options.subscriptions;"function"==typeof r&&(r=r.call(t)),r&&(t.$observables={},t._subscription=new C,Object.keys(r).forEach((function(e){!function(t,e,n){var r;e in t?t[e]=n:null===Wt.default||void 0===Wt.default||null===(r=Wt.default.util)||void 0===r||r.defineReactive(t,e,n)}(t,e,void 0),t.$observables[e]=r[e])?t._subscription.add(r[e].subscribe((function(n){t[e]=n}),()):ie('Invalid Observable found in subscriptions option with key "'+e+'".',t)})))},serverPrefetch:function(){this._subscription&&this._subscription.unsubscribe()},beforeDestroy:methods:{$createObservableMethod:function(t,e){var n=this;return void 0!==n[t]&&ie("Potential bug: "+"Method ".concat(t," already defined on vm and has been overwritten by $createObservableMethod.")+String(n[t]),n),new P((function(r){return n[t]=function(){var t=Array.from(arguments);e?(t.push(this),r.next(t)):t.length<=1?r.next(t[0]):r.next(t)},)).pipe(wt())},$watchAsObservable:function(t,e){var n=this;return new P((function(r){var i,o=return n._data?o():n.$once("hook:created",o),new C(()}))},$fromDOMEvent:function(t,e){if("undefined"==typeof window)return D;var n=this,r=document.documentElement;return new P((function(i){eturn r.addEventListener(e,o),new C(()}))},$subscribeTo:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=t.subscribe.apply(t,n);return(this._subscription||(this._subscription=new C)).add(i),i},$eventToObservable:ue}},ce={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-history-version-confirm-dialog"},[n("div",{staticClass:"k-history-version-confirm-dialog-container"},[n("div",{staticClass:"k-history-version-confirm-dialog-content"},[t._v("\n      "+t._s(t.tip)+"\n    ")]),t._v(" "),n("div",{staticClass:"k-history-version-confirm-dialog-footer"},[n("div",{staticClass:"k-history-version-confirm-dialog-footer-buttons"},[n("el-button",{staticClass:"k-history-version-confirm-dialog-footer-cancel",attrs:{size:"small"},on:{click:t.handleCancel}},[t._v(t._s(t.cancelButtonText))]),t._v(" "),n("el-button",{staticClass:"k-history-version-confirm-dialog-footer-confirm",attrs:{size:"small",type:"primary"},on:{click:t.handleConfirm}},[t._v(t._s(t.confirmButtonText))])],1)])])])},staticRenderFns:[],name:"ConfirmLabelClose",components:{ElButton:re()},props:{tip:{type:String,require:!0},title:{type:String,require:!0},confirmButtonText:{type:String,require:!0},cancelButtonText:{type:String,require:!0},onConfirmFunc:{type:Function,default:function(){}},onCancelFunc:{type:Function,default:function(){}}},methods:{handleConfirm:function(){var t=this;return(0,r.Z)(o().mark((function e(){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(n=t.onConfirmFunc)||void 0===n?void 0:n.call(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),null===(r=t.$message)||void 0===r||null===(i=r.error)||void 0===i||i.call(r,(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"");case 8:t.handleCancel();case 9:case"end":return e.stop()}}),e,null,[[0,5]])})))()},handleCancel:function(){var t=this;return(0,r.Z)(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=t.onCancelFunc)||void 0===n?void 0:n.call(t);case 2:t.$emit("close");case 3:case"end":return e.stop()}}),e)})))()},customDialogClose:function(t){var e=this;return(0,r.Z)(o().mark((function n(){var r;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,null===(r=e.onCancelFunc)||void 0===r?void 0:r.call(e);case 2:t();case 3:case"end":return n.stop()}}),n)})))()}}},le=(0,s.Z)({entry:ce,pages:[{width:"450px",body:ce,className:"k-history-version-confirm-dialog-layout",footer:null,customClose:!0}]}),fe=function(t,e,n){var r=n.confirmButtonText,i=n.cancelButtonText;return new Promise((function(n,o){le.show({tip:t,title:e,confirmButtonText:r,cancelButtonText:i,onConfirmFunc:function(t){n(t)},onCancelFunc:)}))};function de(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function pe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?de(Object(n),!0).forEach((function(e){(0,a.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var he={NORMAL:"normal",EDIT:"edit",CREATE:"create"},ve="add",be="update",ye="remove",me=1,ge=3,we=1027,_e={OWNER:"owner",ADMIN:"admin",MEMBER:"member",NOMEMBER:"non-member"},xe=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return(0,te.t)(e||"logic.HistoryVersionLabelManager.".concat(t),r)},ke=30,Te=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke;return{start:0,size:t,last_rank:0,nomore:!1}},Ce=function(t){var e,n,r;console.log(t,t.message,null==t||null===(e=t.response)||void 0===e?void 0:e.status);var i,o="";null!=t&&null!==(n=t.response)&&void 0!==n&&null!==(n=n.data)&&void 0!==n&&n.msg?o=null==t||null===(i=t.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.msg:o=502===(null==t||null===(r=t.response)||void 0===r?void 0:r.status)||"Network Error"===t.message?xe("netError"):t.message;o&&d.Z.error(o)},Ee=function(){var t=(0,r.Z)(o().mark((function t(){var e,n,r,i,s,u,a,c,l,f,d,p,h,v,b,y,m,g,w,_,x=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=x.length>0&&void 0!==x[0]?x[0]:{},i=r.reqFunc,s=void 0===i?function(){}:i,u=r.params,a=void 0===u?{}:u,c=r.pagination,l=void 0===c?Te(ke):c,f=l.start,d=void 0===f?0:f,p=l.size,h=void 0===p?ke:p,v=l.last_rank,b=void 0===v?0:v,y=l.nomore,!(m=void 0!==y&&y)){t.next=5;break}return t.abrupt("return",{nextPagination:l,result:[],res:null});case 5:return g=null,t.next=8,s(pe({start:d,size:h,last_rank:b},a));case 8:return g=t.sent,w=(null===(e=g)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.result)||[],_=pe(pe({},l),{},{start:d,size:h,last_rank:b,nomore:m}),(null==w?void 0:w.length)===ke?(_.start+=ke,_.nomore=!1):(_.start+=w.length,_.nomore=!0),_.last_rank=null===(n=g)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.last_rank,t.abrupt("return",{nextPagination:_,result:w,res:g});case 14:case"end":return t.stop()}}),t)})));return ();function Se(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.res,n=e||[],r=n.map(();return r}function Oe(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i="&history_id=".concat(e.join("&history_id="));return new Promise((function(e){(0,ee.nXq)(t,i,n).then((function(t){var n;null!=t&&null!==(n=t.data)&&void 0!==n&&n.accept?e(!0):(r&&d.Z.error(xe("permissionDefault")),e(!1))})).catch((function(t){r&&Ce(t),e(!1)}))}))}function je(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r="file_id=".concat(e.join("&file_id="));return new Promise((function(e){(0,ee.sEz)(t,r).then((function(t){var r;null!=t&&null!==(r=t.data)&&void 0!==r&&r.accept?e(!0):(n&&d.Z.error(xe("permissionDefault")),e(!1))})).catch((function(t){n&&Ce(t),e(!1)}))}))}unction Le(t){var e=t.label,n=t.tip,i=t.confirmButtonText,s=t.cancelButtonText;return new Promise((function(t,u){(0,ee.hP$)(e.tag_id,{start:0,size:30,tag_id:e.tag_id}).then(function(){var e=(0,r.Z)(o().mark((function e(r){var u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null==r||null===(u=r.data)||void 0===u?void 0:u.total)>0)){e.next=6;break}return e.next=3,Ie(200);case 3:fe(n,xe("txt115"),{confirmButtonText:i,cancelButtonText:s}).then((function(){t(!0)})).catch((),e.next=7;break;case 6:t(!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch(()}))}function Ne(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Pe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ne(Object(n),!0).forEach((function(e){(0,a.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ae={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-Label-management"},[n("div",{staticClass:"k-Label-management-container"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"k-Label-management-input"},[n("el-input",{directives:[{name:"stream",rawName:"v-stream:input",value:t.onInputValueChange$,expression:"onInputValueChange$",arg:"input"}],attrs:{size:"small",placeholder:t.tt("txt0")},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[n("div",{staticClass:"k-Label-management-icon-box",attrs:{slot:"prefix"},slot:"prefix"},[n("KIcon",{attrs:{type:"search"}})],1)])],1),t._v(" "),t.tagList.length>0?n("div",{staticClass:"k-Label-management-tag"},[n("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.clickOutside,expression:"clickOutside"},{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"k-Label-management-tag-scroller",attrs:{"infinite-scroll-immediate":"false","infinite-scroll-distance":"50"}},t._l(t.tagList,(function(e){return n("div",{key:e.tag_id,staticClass:"k-Label-management-tag-tagitem",class:{actived:e.tag_id===t.currentTag.tag_id,"is-tag-edit":e.action===t.ACTION.EDIT,"is-tag-create":e.action===t.ACTION.CREATE,"is-tag-normal":e.action===t.ACTION.NORMAL}},[n("div",{staticClass:"k-Label-management-tag-left"},[n("div",{staticClass:"k-Label-management-tag-prefix"},[n("KIcon",{attrs:{type:"tag_manage_label"}})],1),t._v(" "),n("el-input",{directives:[{name:"stream",rawName:"v-stream:keydown.native",value:{subject:t.onKeydown$,data:Object.assign({},e)},expression:"{\n                subject: onKeydown$,\n                data: { ...item },\n              }",arg:"keydown",modifiers:{native:!0}},{name:"show",rawName:"v-show",value:e.action===t.ACTION.EDIT||e.action===t.ACTION.CREATE,expression:"\n                item.action === ACTION.EDIT || item.action === ACTION.CREATE\n              "}],ref:"tagInput"+e.tag_id,refInFor:!0,staticClass:"k-Label-management-tag-edit-input",attrs:{size:"small",maxlength:t.maxlength},model:{value:e._title,callback:expression:"item._title"}}),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.action===t.ACTION.NORMAL,expression:"item.action === ACTION.NORMAL"},{name:"dompurify-html",rawName:"v-dompurify-html",value:t.getHighlight(e),expression:"getHighlight(item)"}],staticClass:"k-Label-management-tag-text"})],1),t._v(" "),n("div",{staticClass:"k-Label-management-tag-right"},[n("span",{staticClass:"k-Label-management-tag-right-icon",on:{click:function(n){return t.onEdit(e)}}},[n("KIcon",{attrs:{type:"tag_manage_edit"}})],1),t._v(" "),n("span",{staticClass:"k-Label-management-tag-right-icon",on:{click:function(n){return t.onDelete(e)}}},[n("KIcon",{staticClass:"tag_manage_del",attrs:{type:"tag_manage_del"}})],1)])])})),0)]):n("div",{staticClass:"k-Label-management-empty-wrapper"},[n("div",[t._v(t._s(t.tt("txt13")))])]),t._v(" "),n("div",{staticClass:"k-Label-management-create"},[n("div",{staticClass:"k-Label-management-create-icon"},[n("KIcon",{attrs:{type:"add_label"}})],1),t._v(" "),n("div",{staticClass:"k-Label-management-create-text",on:{mouseup:click:t.onCreate}},[t._v("\n        新建标签\n      ")])])])])},staticRenderFns:[],name:"KLabelManagement",components:{KIcon:f.default,ElInput:Jt()},mixins:[ae],directives:{"infinite-scroll":l(),"dompurify-html":Xt.Z,clickoutside:Qt.Z},domStreams:["onInputValueChange$","onKeydown$"],props:{ownId:{type:Number,require:!0},ownType:{type:Number,require:!0},onCloseFunc:Function,beforeCreate:{type:Function,default:function(){return Promise.resolve(!0)}},beforeEdit:{type:Function,default:function(){return Promise.resolve(!0)}},beforeUpdate:{type:Function,default:function(){return Promise.resolve(!0)}},beforeDelete:{type:Function,ve(!0)}},maxlength:{type:Number,default:30}},data:function(){return{ACTION:he,pagination:Te(),keyword:"",tagList:[],currentTag:{},inputSearchLoading:!1,scorllToBottom$:new q,clickoutside$:new q,isActivated:!1}},methods:{tt:xe,(this)},getHighlight:function(t){var e;return(null==t||null===(e=t.highlight)||void 0===e||null===(e=e.title)||void 0===e?void 0:e[0])||t.title},loadMore:function(){this.pagination.nomore||this.inputSearchLoading||this.scorllToBottom$.next({keyword:this.keyword,pagination:Pe({},this.pagination)})},loadData:function(t){var e=this;return(0,r.Z)(o().mark((function n(){var r,i,s,u;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.keyword,i=void 0===r?"":r,s=t.pagination,n.prev=1,u=i?ee.huu:ee.wiy,n.next=5,Ee({reqFunc:u,pagination:Pe({},s),params:{own_type:e.ownType,own_id:e.ownId,keyword:i}});case 5:return n.abrupt("return",n.sent);case 8:throw n.prev=8,n.t0=n.catch(1),Ce(n.t0),console.error(n.t0),n.t0;case 13:case"end":return n.stop()}}),n,null,[[1,8]])})))()},resetActionStatus:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tagList;t.fNORMAL}))},onCreate:function(){var t=this;return(0,r.Z)(o().mark((function e(){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.beforeCreate(t.ownId);case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:0===t.filterTagListByAction([he.CREATE]).length&&(n=t.filterTagListByAction([he.EDIT]),t.resetActionStatus(n),r=(new Date).getTime(),t.tagList.unshift({title:"新标签",tag_id:r,_title:"新标签",action:he.CREATE}),t.$nextTick((function(){var e,n;null===(e=t.$refs)||void 0===e||e["tagInput"+r][0].focus(),null===(n=t.$refs)||void 0===n||n["tagInput"+r][0].select()})));case 6:case"end":return e.stop()}}),e)})))()},onEdit:function(t){var e=this;return(0,r.Z)(o().mark((function n(){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.beforeEdit(e.ownId,t);case 2:if(n.sent){n.next=5;break}return n.abrupt("return");case 5:e.tagList=e.filterTagListByAction([he.EDIT,he.NORMAL]),e.resetActionStatus(),t.action=he.EDIT,e.currentTag=t,e.$nextTick((function(){var n;null===(n=e.$refs)||void 0===n||n["tagInput"+t.tag_id][0].focus()}));case 10:case"end":return n.stop()}}),n)})))()},onDelete:function(t){var e=this;return(0,r.Z)(o().mark((function n(){var r,i,s,u,a;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.beforeDelete(e.ownId,t);case 3:if(n.sent){n.next=6;break}return n.abrupt("return");case 6:return r=ye,i=xe("txt117"),s=xe("txt118"),u=xe("txt120"),n.next=12,Le({label:t,operation:r,tip:i,confirmButtonText:s,cancelButtonText:u});case 12:if(n.sent){n.next=15;break}return n.abrupt("return");case 15:return n.next=17,(0,ee.YZH)(t.tag_id);case 17:e.delTagInList(t.tag_id),d.Z.success(xe("txt16")),n.next=26;break;case 21:n.prev=21,n.t0=n.catch(0),"tagNotExists"===(null===n.t0||void 0===n.t0||null===(a=n.t0.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.result)&&e.delTagInList(t.tag_id),Ce(n.t0),console.error(n.t0);case 26:case"end":return n.stop()}}),n,null,[[0,21]])})))()},onKeyDownEnter:function(t){var e=this;return(0,r.Z)(o().mark((function n(){var r,i,s,u,a,c,l,f,d,p;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,i=(r=t||{})._title,s=r.action,n.next=4,e.beforeUpdate(e.ownId,t,s);case 4:if(n.sent){n.next=9;break}return s===he.EDIT&&(u=e.findTagById(t.tag_id))&&(u._title=u.title,u.action=he.NORMAL),e.tagList=e.filterTagListByAction([he.NORMAL]),n.abrupt("return");case 9:if(s!==he.EDIT){n.next=19;break}return a=xe("txt116"),c=be,l=xe("txt119"),f=xe("txt120"),n.next=16,Le({label:t,operation:c,tip:a,confirmButtonText:l,cancelButtonText:f});case 16:if(n.sent){n.next=19;break}return n.abrupt("return");case 19:if(""===(null==i?void 0:i.trim())){n.next=31;break}if(s!==he.EDIT){n.next=26;break}return n.next=23,(0,ee.Cn4)(t.tag_id,{title:i});case 23:n.t0=n.sent,n.next=29;break;case 26:return n.next=28,(0,ee.lnY)({own_type:e.ownType,own_id:e.ownId,title:i});case 28:n.t0=n.sent;case 29:return d=n.t0,n.abrupt("return",{res:d,label:t});case 31:n.next=39;break;case 33:throw n.prev=33,n.t1=n.catch(0),"tagNotExists"===(null===n.t1||void 0===n.t1||null===(p=n.t1.response)||void 0===p||null===(p=p.data)||void 0===p?void 0:p.result)&&e.delTagInList(t.tag_id),Ce(n.t1),console.error(n.t1),n.t1;case 39:case"end":return n.stop()}}),n,null,[[0,33]])})))()},filudes(e.action)}))},findTagsById:function(t){return this.tagList.filter((function(e){return e.tag_id=rn e.tag_id===t}))},clickOutside:function(t){if(this.isActivated){var e=["el-dialog__close"],n=["k-dialog-history-version-label-manager-layout"],r=t.path,i=null==r?void 0:r.some((function(t){return n.some((function(e){var n;return(null==t||null===(n=t.classList)||void 0===n?void 0:n.length)>0&&Array.from(t.classList).includes(e)}))}));if(!(null==r?void 0:r.some((function(t){return e.some((function(e){var n;return(null==t||null===(n=t.classList)||void 0===n?void 0:n.length)>0&&Array.from(t.classList).includes(e)}))})))){var o=this.filterTagListByAction([he.CREATE,he.EDIT]);i&&o.length>0&&this.clickoutside$.next({data:o[0rn e.tag_id!==t}))}},activated:function(){this.isActivahis.isActivated=!1},mounted:function(){var t,e,n=this,r=this.onInputValueChange$.pipe(_t((function(){n.inputSearchLoadi.lift(new Lt(t,e))}),M((function(t){return{keyword:t.event.msg,pagination:Te()}}))),i=this.$eventToObservable("init").pipe(_t((function(){n.inputSearchLoading=!0})),M((function(){return{keyword:"",pagination:Te()}})));this.$subscribeTo(ft(r,i).pipe(Pt((function(t){return n.loadData(t)})),Dt((function(t,e){return e}))),(function(t){var e=t.result,r=t.nextPagination;n.pagination=r;var i=Se({res:e});n.inputSearchLoading=!1,n.tagList=h()((0,u.Z)(i),"tag_id")}),(function(){n.inputSearchLoading=!1})),this.$emit("init"),this.$subscribeTo(this.scorllToBottom$.pipe(Vt((function(t){return nt(n.loadData(t)).pipe(Ht(ft(r,i)))})),Dt((function(t,e){return e}))),(function(t){var e=t.result,r=t.nextPagination;n.pagination=r;var i=Se({res:e});n.tagList=h()([].concat((0,u.Z)(n.tagList),(0,u.Z)(i)),"tag_id")}),(function(){})),this.$subscribeTo(ft(this.clickoutside$,this.onKeydown$.pipe(qt((function(t){return 13===t.event.keyCode})))).pipe(_t((function(t){var e,n=t.data;0===(null==n||null===(e=n._title)||void 0===e?void 0:e.trim().length)&&d.Z.warning(xe("txt12"))})),qt((function(t){var e,n=t.data;return(null==n||null===(e=n._title)||void 0===e?void 0:e.trim().length)>0})),M((function(t){return t.data})),Vt((function(t){return n.onKeynction(t){return t})),Dt((function(t,e){return e}))),(function(t){var e,r=t.res,i=t.label,o=null==r||null===(e=r.data)||void 0===e||null===(e=e.result)||void 0===e?void 0:e.title;""!==o&&n.findTagsById(i.tag_id).forEach((function(t){var e;t.title=o,t._title=o,t.tag_id=null==r||null===(e=r.data)||void 0===e||null===(e=e.result)||void 0===e?void 0:e.tag_id,t.action=he.NORMAL})),d.Z.succesn,e))}))}return t}var Me={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-history-version-label-setting"},[n("div",{staticClass:"k-history-version-label-setting-container"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.showSubTitle,expression:"showSubTitle"}],staticClass:"k-history-version-label-setting-header"},[n("span",{directives:[{name:"show",rawName:"v-show",value:t.subTitle1,expression:"subTitle1"}],staticClass:"k-history-version-label-setting-header-span setting-header-span1",style:t.subTitle1Style},[t._v(t._s(t.subTitle1)+"\n      ")]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.subTitle2,expression:"subTitle2"}],staticClass:"k-history-version-label-setting-header-span setting-header-span2",style:t.subTitle2Style},[t._v(t._s(t.subTitle2)+"\n      ")]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.subTitle3,expression:"subTitle3"}],staticClass:"k-history-version-label-setting-header-span setting-header-span3",style:t.subTitle3Style},[t._v(t._s(t.subTitle3)+"\n      ")])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"k-history-version-label-setting-input"},[n("el-input",{directives:[{name:"stream",rawName:"v-stream:input",value:t.onInputValueChange$,expression:"onInputValueChange$",arg:"input"},{name:"stream",rawName:"v-stream:keydown.native",value:t.onKeydown$,expression:"onKeydown$",arg:"keydown",modifiers:{native:!0}}],attrs:{placeholder:t.tt("txt101")},model:{valueion(e){t.keyword=e},expression:"keyword"}},[n("div",{staticClass:"k-history-version-label-setting-icon-box",attrs:{slot:"prefix"},slot:"prefix"},[n("KIcon",{attrs:{type:"label-search-input-add"}})],1)])],1),t._v(" "),n("div",{staticClass:"k-history-version-label-setting-subtitle"},[n("span",[t._v(t._s(t.keyword.length>0?t.tt("txt107"):t.tt("txt102")))]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.showManagerBtn,expression:"showManagerBtn"}],staticClass:"k-history-version-label-setting-manage",on:{click:t.onManage}},[t._v(t._s(t.tt("txt103"))),n("KIcon",{attrs:{type:"chevronright"}})],1)]),t._v(" "),t.isTagListEmpty?n("div",{staticClass:"k-history-version-label-setting-empty-wrapper"},[t.keyword.length>0?n("div",[t._v(t._s(t.tt("txt113")))]):n("div",[t._v(t._s(t.tt("txt114")))])]):n("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"k-history-version-label-setting-tag-container",attrs:{"infinite-scroll-immediate":"false","infinite-scroll-distance":"50"}},t._l(t.tagList,(function(e){return n("div",{key:e.tag_id,class:{"k-history-version-label-setting-tag":!0,"k-history-version-label-setting-tag-avtive":t.activeItem.tag_id===e.tag_id},on:{click:function(n){return t.onItemClick(e)}}},[t._v("\n        "+t._s(e.title)+"\n      ")])})),0),t._v(" "),n("div",{staticClass:"k-history-version-label-setting-footer"},[n("div",{staticClass:"k-history-version-label-setting-footer-buttons"},[n("el-button",{staticClass:"k-history-version-label-setting-footer-cancel",attrs:{size:"small"},on:{click:t.onCancel}},[t._v(t._s(t.tt("txt104")))]),t._v(" "),t.isAllowCreateTag?n("el-button",{directives:[{name:"stream",rawName:"v-stream:click",value:t.onCreateTagClick$,expression:"onCreateTagClick$",arg:"click"}],staticClass:"k-history-version-label-setting-footer-confirm",attrs:{size:"small",type:"primary",disabled:!t.isAllowCreateTag}},[t._v(t._s(t.tt("txt111")))]):n("el-button",{staticClass:"k-history-version-label-setting-footer-confirm",attrs:{size:"small",type:"primary",loading:t.submitLoading,disabled:!t.hasChange},on:{click:t.onSubmit}},[t._v(t._s(t.tt("txt105")))])],1)])])])},staticRenderFns:[],name:"KHistoryVersionLabelSetting",directives:{"infinite-scroll":l()},components:{KIcon:f.default,ElButton:re(),ElInput:Jt()},props:{groupid:{type:Number,require:!0},rolePermission:{type:Object,require:!0},showSubTitle:{type:Boolean,default:!0},subTitle1:{type:String,default:""},subTitle2:{type:String,default:""},subTitle3:{type:String,default:""},subTitle1Style:{type:Object,default:function(){return{}}},subTitle2Style:{type:Object,default:function(){return{}}},subTitle3Style:{type:Object,default:function(){return{}}},onSuccess:{type:Function,default:function(){}},historyVersion:{unction(){return{}}},isCurrentVersion:{type:Boolean,default:!1},currentVersion:unction(){return[]}}},mixins:[ae],domStreams:["onInputValueChange$","onKeydown$","onCreateTagClick$"],data:function(){return{submitLoading:!1,activeItem:{title:"",tag_id:void 0},pagination:Te(),keyword:"",tagList:[],didTagList:[],inputSearchLoading:!1,scorllToBottom$:new===t?void 0:t.role},didTag:function(){var t;return(null===(t=this.didTagList)||void 0===t?void 0:t[0])||{tag_id.activeItem.tag_id},isAllowCreateTag:function(){var t=this;return.title===t.keyword}))&&this.keyword.trim().lengthis.tagList.length},showManagerBtn:function(){return 0===this.keyword.length&&[_e.OWNER,_e.ADMIN].includes(return t.fileid}))}},methods:{tt:xe,getDidTags:function(){var t=this;return(0,r.Z)(o().mark((function e(){var n,r,i,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],t.isCurrentVersion?t.currleid,obj_type:me})})):r.push({obj_id:t.historyVersion.id,obj_type:ge}),e.next=4,(0,ee.nsE)({objs:r,owns:[{own_id:t.groupid,own_type:we}]});case 4:return i=e.sent,s=(null==i||null===(n=i.data)||void 0===n?void 0:n.resureturn t.concat(e)}),[]),e.abrupt("return",u);case 8:case"end":return e.stop()}}),e)})))()},getCreateTags:function(){var t,e=this,n=[];return null!==(t=this.activeItem)&&void 0!==t&&t.tag_id&&(this.isCurrentVersion?this.currentVersion.forEach((function(t){n.push({obj_id:t.fileid,obj_type:me,tag_id:e.activeItem.tag_id})})):n.push({obj_id:this.historyVersion.id,obj_type:ge,tag_id:this.activeItem.tag_id})),n},loadData:function(t){var e=this;return(0,r.Z)(o().mark((function n(){var r,i,s,u,a;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.keyword,i=void 0===r?"":r,s=t.pagination,n.prev=1,u=i?ee.huu:ee.wiy,n.next=5,Ee({reqFunc:u,pagination:De({},s),params:{own_type:we,own_id:e.groupid,keyword:i}});case 5:return a=n.sent,n.abrupt("return",a);case 9:throw n.prev=9,n.t0=n.catch(1),Ce(n.t0),console.error(n.t0),n.t0;case 14:case"end":return n.stop()}}),n,null,[[1,9]])})))()},onKeyDownEnter:function(t){var e=this;return(0,r.Z)(o().mark((function n(){var r,i,s;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,""===t){n.next=11;break}if(oid 0:e.title)===t})))){n.next=7;break}return n.abrupt("return",{label:r});case 7:return n.next=9,(0,ee.lnY)({own_type:we,own_id:e.groupid,title:t});case 9:return s=n.sent,n.abrupt("return",{label:null==s||null===(i=s.data)||void 0===i?void 0:i.result});case 11:n.next=18;break;case 13:throw n.prev=13,n.t0=n.catch(0),Ce(n.t0),console.error(n.t0),n.t0;case 18:case"end":return n.stop()}}),n,null,[[0,13]])})))()},loadMore:function(){this.pagination.nomore||this.inputSearchLoading||this.scorllToBottom$.next({keyword:this.keyword,pagination:De({},this.pagihis.$emit("close")},onManage:function(){var t=this;this.$emit("change","KLabelManagement",{ownId:this.groupid,owntion(){t.refresh()}})},onItemClick:function(t){this.activeItem.tag_id===t.tag_id?this.activeItem={title:"",tag_id:void 0}:this.acthis.$emit("init")},getOperation:function(t,e){return 0===t.length?ve:0===e?ye:be},checkPermission:function(t,e){var n=this;return(0,r.Z)(o().mark((function r(){var i,s;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=n.getOperation(t,e),!(n.isCurrentVersion&&n.currentVersion.length>1)){r.next=11;break}ifrn t.obj_type===me})),"obj_id")).length>0)){r.next=6;break}return d.Z.error(s.length+xe("txt122")),r.abrupt("return",!1);case 6:return r.next=8,je(n.groupid,n.fileids,i);case 8:case 13:return r.abrupt("return",r.sent);case 11:return r.next=13,Oe(n.groupid,[n.isCurrentVersion?0:n.historyVersion.id],i);case 14:case"end":return r.stop()}}),r)})))()},onSubmit:function(){var t=this;return(0,r.Z)(o().mark((function e(){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getDidTags();case 3:return n=e.sent,r=t.getCreateTags(),console.log("didTags：",n,"createTags：",r),e.next=8,t.checkPermission(n,r);case 8:if(e.sent){e.next=11;break}return e.abrupt("return");case 11:if(!(n.length>0)){e.next=14;break}return e.next=14,(0,ee.yPK)({delete:n});case 14:if(!(r.length>0)){e.next=22;break}if(1!==r.length){e.next=20;break}return e.next=18,(0,ee.jHD)(r[0]);case 18:e.next=22;break;case 20:return e.next=22,(0,ee.yPK)({create:r});case 22:t.$emit("close","ok"),t.onSuccess(),t.submitLoading=!1,d.Z.success(xe("txt121")),e.next=33;break;case 28:e.prev=28,e.t0=e.catch(0),Ce(e.t0),console.error(e.t0),t.submitLoading=!1;case 33:case"end":return e.stop()}}),e,null,[[0,28]])})))()}},mounted:function(){var t=this;,t.activeItem=t.didTag}));var e=this.onInputValueChange$.pipe(_t((function(){t.inputSearchLoading=!0})),St(200),M((function(t){return{keyword:t.event.msg,pagination:Te()}}))),n=this.$eventToObservable("init").pipe(_t((function(){t.inpurd:"",pagination:Te()}})));this.$subscribeTo(ft(e,n).pipe(Pt((function(e){return t.loadData(e)})),Dt((function(t,e){return e}))),(function(e){var n=e.result,r=e.nextPagination;t.pagination=r;var i=Se({res:n});t.inputSearchLoading=!1,t.tagList=h()(.inputSearchLoading=!1})),this.$emit("init"),this.$subscribeTo(this.scorllToBottom$.pipe(Vt((function(r){return nt(t.loadData(r)).pipe(Ht(ft(e,n)))})),Dt((function(t,e){return e}))),(function(e){var n=e.result,r=e.nextPagination;t.pagination=r;var i=Se({res:n});t.tagList=h()([].concat((0,u.Z)(t.tagList),(0,u.Z)(i)),"tag_id")}));var r=tn 13=n t.event.target.value}))),i=this.onCreateTagClick$.pipe(M((function(){return t.keyword})));this.$subscribeTo(ft(i,r).pipe(_t((function(t){0===t.trim().length&&d.Z.warning(xe("txt112"))})),qt((function(t){return(null==t?void 0:t.rn t.ofunction(t,e){return e}))),(function(e){var n=e.label,r=void 0===n?{}:n;t.activeItem=De({},r),t.keyword="",t.$emit("init")}))}};Ae.install=function(t){t.component(Ae.name,Ae)},Me.install=function(t){t.component(Me.name,Me)};var Be={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-history-version-confirm-dialog"},[n("div",{staticClass:"k-history-version-confirm-dialog-container"},[n("div",{staticClass:"k-history-version-confirm-dialog-content"},[t._v("\n      "+t._s(t.tip)+"\n    ")]),t._v(" "),n("div",{staticClass:"k-history-version-confirm-dialog-footer"},[n("div",{staticClass:"k-history-version-confirm-dialog-footer-buttons"},[n("el-button",{staticClass:"k-history-version-confirm-dialog-footer-cancel",attrs:{size:"small"},on:{click:t.handleCancel}},[t._v(t._s(t.cancelButtonText))]),t._v(" "),n("el-button",{staticClass:"k-history-version-confirm-dialog-footer-confirm",attrs:{size:"small",type:"primary"},on:{click:t.handleConfirm}},[t._v(t._s(t.confirmButtonText))])],1)])])])},staticRenderFns:[],name:"ConfirmLabelClose",components:{ElButton:re()},props:{tip:{type:String,require:!0},title:{type:String,require:!0},confirmButtonText:{type:String,require:!0},cancelButtonText:{type:String,require:!0},onConfirmFunc:{type:Function,default:function(){}},onCancelFuncon,default:function(){}}},methods:{handleConfirm:function(){var t=this;return(0,r.Z)(o().mark((function e(){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(n=t.onConfirmFunc)||void 0===n?void 0:n.call(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),null===(r=t.$message)||void 0===r||null===(i=r.error)||void 0===i||i.call(r,(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"");case 8:t.handleCancel();case 9:case"end":return e.stop()}}),e,null,[[0,5]])})))()},handleCancel:function(){var t=this;return(0,r.Z)(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=t.onCancelFunc)||void 0===n?void 0:n.call(t);case 2:t.$emit("close");case 3:case"end":return e.stop()}}),e)})))()},customDialogClose:function(t){var e=this;return(0,r.Z)(o().mark((function n(){var r;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,null===(r=e.onCancelFunc)||void 0===r?void 0:r.call(e);case 2:t();case 3:case"end":return n.stop()}}),n)})))()}}},Ve=((0,s.Z)({entry:Be,pages:[{width:"450px",body:Be,className:"k-history-version-confirm-dialog-layout",footer:null,customClose:!0}]}),"edit"),Ze="create",Fe="add",He="update",Re="remove",Ke=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return(0,te.t)(e||"logic.HistoryVersionLabelManager.".concat(t),r)},qe=function(t){var e,n,r;console.log(t,t.message,null==t||null===(e=t.response)||void 0===e?void 0:e.status);var i,o="";null!=t&&null!==(n=t.response)&&void 0!==n&&null!==(n=n.data)&&void 0!==n&&n.msg?o=null==t||null===(i=t.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.msg:o=502===(null==t||null===(r=t.response)||void 0===r?void 0:r.status)||"Network Error"===t.message?Ke("netError"):t.message;o&&d.Z.error(o)};function ze(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise((function(r){(0,ee.dT1)(t,e).then((function(t){var e;null!=t&&null!==(e=t.data)&&void 0!==e&&e.accept?r(!0):(n&&d.Z.error(Ke("permissionDefation(t){n&&qe(t),r(!1)}))}))}var Ye,Ue,We=(0,s.Z)({entry:Me,pages:[{title:Ke("dialogTitle2"),width:"600px",className:"k-dialog-history-version-label-manager-layout",body:Me,beforeVisiable:function(t){var e;return["admin","owner","member"].includes(null==t||null===(e=t.rolePermission)||void 0===e?void 0:e.role)?t.isCurrentVersion&&t.currentVersion.length>20?(d.Z.error(Ke("dialogTex2")),!1):t:(d.Z.info(Ke("dialogTex1")),!1)},footer:null,closeOnClickModal:!1},{title:Ke("dialogTitle1"),className:"k-dialog-history-version-label-manager-layout",width:"600px",body:Ae,beforeCreate:function(t){retuion(t){return ze(t,He)},beforeUpdate:(Ue=(0,r.Z)(o().mark((function t(e,n,r){var i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r!==Ze){t.next=4;break}return t.abrupt("return",ze(e,Fe));case 4:if(r!==Ve){t.next=9;break}return t.next=7,ze(e,He);case 7:return i=t.sent,t.abrupt("return",i);case 9:case"end":re.apply(this,arguments)}),beforeDelete:(Ye=(0,r.Z)(o().mark((function t(e){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ze(e,Re);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":re.apply(this,arguments)}),footer:null,closeOnClickModal:!1}]}),Xe=We},86107:function(t,e,n){"use strict";var r,i=n(20144),o=n(34594),s=[],u="@@clickoutsideContext",a={down:["touchstart","mousedown"],up:["touchend","mouseup"]};i.default.prototype.$isServer||(a.down.forEach((function(function(t){return r=t}))})),a.up.forEach((function(ocumentHandler(t,r)}))}))})));var c={bind:function(t,e,n){s.push(t),t.id||t.setAttribute("id","".concat(u,"_").concat(Math.floor(1e6*Math.random())));var r=t.id;t[u]={id:r,documentHandler:function(r,i){!n.context||t.contains(r.target)||n.context.popperElm&&(n.context.popperElm.contains(r.target)||n.context.popperElm.contains(i.target))||(e.expression&&t[u].methodName&&n.context[t[u].methodName]?n.context[t[u].methodName](r):t[u].bindingFn&&t[u].bindingFn(r))},methodName:e.expression,bint[u].bindingFn=e.value},unbind:function(t){for(var e=s.length,n=0;n<e;n++)if(s[n][u].id===t[u].id){s.splice(n,1),t[u]=null;break}}};e.Z=c},54813:fu.p="/dist/",n(n.s=133)}({133:function(t,e,n){"use strict";n.r(e);var r=n(17),i=ocumentElement[e]:t[e]},a=function(t){return u(t,"offsetHeight")},c="ElInfiniteScroll",l={delay:{type:Number,default:200},distance:{type:Number,default:0},disabled:{type:Boolean,default:!1},immediate:{type[iunis[c].observer=null)}}},h={name:"I:!0,subntListen{t.directive(h.name,h)}};e.default=h},17:function(t,e){t.exports=n(42823)},19:function(t,,e){t.exports=n(34594)}})}}]);
