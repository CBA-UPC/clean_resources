/*! 20240131-7-RELEASE */

class ArticleAndFeedAreaScanner{static initScanner(){const e=TRC.util.retry(ArticleAndFeedAreaScanner.scanAndReportContainers,2e3,2);e()}static scanAndReportContainers(){if(!ArticleAndFeedAreaScanner.shouldSearch())return;const{articleElement:e,taboolaContainers:t}=ArticleAndFeedAreaScanner.getArticleInfo();if(!e||!t)return;const n=ArticleAndFeedAreaScanner.getClosestContainer(e,t);if(!n)return;const r=ArticleAndFeedAreaScanner.getAreaYBorders(e,n.container);return ArticleAndFeedAreaScanner.searchContainerTypes(r),!0}static shouldSearch(){return ArticleAndFeedAreaScanner.containerTypesMapKeys.some(e=>!ArticleAndFeedAreaScanner.containerTypesMap[e].isReported)}static searchContainerTypes(e){ArticleAndFeedAreaScanner.containerTypesMapKeys.forEach(t=>{const n=ArticleAndFeedAreaScanner.containerTypesMap[t],{isReported:r}=n;if(r)return;const a=ArticleAndFeedAreaScanner.getContainers(n);ArticleAndFeedAreaScanner.handleRequestedContainers(a,e,t)})}static getContainers(e){const{containers:t,selector:n}=e;if(t&&t.length)return t;const r=TRC.util.toArray(document.querySelectorAll(n));return e.containers=r,r}static handleRequestedContainers(e,t,n){for(let a=0;a<e.length;a++){const c=e[a],i=ArticleAndFeedAreaScanner.getElementYBorders(c);if(ArticleAndFeedAreaScanner.isInArea(t,i)&&!r(c)){const e=c.offsetHeight;TRC.util.sendSupplyFeature("article_area_scanner","reported",`found ${n}`,`${e}`),ArticleAndFeedAreaScanner.containerTypesMap[n].isReported=!0;break}}function r(e){return n(e)||r(e)||t(e);function t(e){const t=e.className;return["item-label-href","item-thumbnail-href","tbl-rtl-label","tbl-ltr-label","video-label"].some(e=>t.indexOf(e)>-1)}function n(e){return e.offsetHeight&&e.offsetHeight>200}function r(e){let t=e;for(;null!==t;){const e=window.getComputedStyle(t).getPropertyValue("position");if("fixed"===e||"sticky"===e)return!0;t=t.parentElement}return!1}}}static getAreaYBorders(e,t){const n=ArticleAndFeedAreaScanner.getAbsoluteTopPosition(e)+e.offsetHeight,r=ArticleAndFeedAreaScanner.getAbsoluteTopPosition(t);return{areaTopY:n,areaBottomY:r}}static getElementYBorders(e){const t=ArticleAndFeedAreaScanner.getAbsoluteTopPosition(e);return{elTopY:t,elBottomY:t+e.offsetHeight}}static isInArea({areaTopY:e,areaBottomY:t},{elTopY:n,elBottomY:r}){return n>=e&&n<=t||r>=e&&r<=t}static getArticleInfo(){const e=TRC.ArticleDetection&&TRC.ArticleDetection.detectArticle&&TRC.ArticleDetection.detectArticle();return e&&e.articleElement?e:{}}static getAbsoluteTopPosition(e){return e.getBoundingClientRect().top+window.pageYOffset}static calculateDistance(e,t){const n=ArticleAndFeedAreaScanner.getAbsoluteTopPosition(e);return n-t}static getClosestContainer(e,t){const n=ArticleAndFeedAreaScanner.getAbsoluteTopPosition(e)+e.offsetHeight;return t.map(e=>({container:e,distance:ArticleAndFeedAreaScanner.calculateDistance(e,n)})).filter(e=>e.distance>=0).sort((e,t)=>e.distance-t.distance).shift()}}ArticleAndFeedAreaScanner.containerTypesMap={share_container:{selector:'[class*="share"], [class*="sharing"], [class*="social"]',isReported:!1,containers:null},tags_container:{selector:'[class*="tag"], [class*="label"]',isReported:!1,containers:null}},ArticleAndFeedAreaScanner.containerTypesMapKeys=Object.keys(ArticleAndFeedAreaScanner.containerTypesMap),TRC.ArticleAndFeedAreaScanner=ArticleAndFeedAreaScanner;" style="display: block;">'+m.guides[n]+g("help",t)+"</p>");!function(e){return!("nothing"===e.guidepos||(!e.guidepos||"left"!=e.guidepos)&&h("guidepos",e.guidepos))}(t)||(o+='<p class="nhksns-guide" style="display: inline-block; margin-right: 12px;">'+m.guides[n]+g("help",t)+"</p>");for(e.attributes.class.value+=" nhksns-icon-"+t.iconsize,o+='<ul class="nhksns">',i=0;i<m.SNS.defaults.length;i++)"line"==(r=m.SNS.defaults[i])&&("function"!=typeof u||"iphone"!==u()[1]&&"androidmobile"!==u()[1])||t.disable.match(new RegExp(r))&&h("disable",r)||(o+=g(r,t));o+="</ul>",function(e){return!("nothing"===e.guidepos||!e.guidepos||"bottom"!=e.guidepos)}(t)&&(o+='<p class="nhksns-guide">'+m.guides[n]+g("help",t)+"</p>");!function(e){return!("nothing"===e.guidepos||!e.guidepos||"right"!=e.guidepos)}(t)||(o+='<p class="nhksns-guide" style="display:inline-block; margin-left: 12px;">'+m.guides[n]+g("help",t)+"</p>");return o}(l[t],o)}}function g(e,t){var n='<li class="nhksns-{name}"><a href="{href}" {sendMetrics} target="_blank"><img  src="{img}" alt="{name}"></img></a>',i=m.SNS.resources[e];switch(e){case"twitter":case"x":return o(n,{href:o(i.link,{url:t.url,text:t.title,description:t.description}),name:e,img:i.image,sendMetrics:r(e)});case"facebook":return o(n,{href:o(i.link,{app_id:i.appId,url:t.url,description:t.description,text:t.title,image:t.image,redirects:i.redirects}),name:e,img:i.image,sendMetrics:r(e)});case"line":return o(n,{href:o(i.link,{url:t.url,text:t.title}),name:e,img:i.image,sendMetrics:r(e)});case"help":return o('<a class="nhksns-help" href="{href}" target="_blank"><img src="{img}" alt="help"></img></a>',{href:i.link[t.lang],img:i.image})}return""}function h(e,t){var n,i=m.separatableOptions[e];if(void 0!==i){if(null===i)return 1;if("function"==typeof Array.prototype.indexOf)return-1!=i.indexOf(t);for(n=0;n<i.length;n++)if(i[n]===t)return 1}}function r(e){return o("onClick=\"if ('function' == typeof _tc_onClick) {_tc_onClick(s_omni,{},'SNS_Button_{service}')} \"",{service:e})}function f(e){for(var t=document.getElementsByTagName("meta"),n=0;n<t.length;n++){if(t[n].hasAttribute("property")&&t[n].attributes.property.value==e)return t[n].content;if(t[n].hasAttribute("name")&&t[n].attributes.name.value==e)return t[n].content}}function k(e){return encodeURI(e)}function o(e,t){for(var n in t){if("object"==typeof t[n])throw new TypeError("param is not to be Object");var i=new RegExp("{"+n+"}","g");e=e.replace(i,t[n])}return e}return window.addEventListener("DOMContentLoaded",function(){u=window.nol_getDeviceType||null},!0),m.baseDir=o("{protocol}//www.nhk.or.jp/common/sns/",{protocol:location.protocol}),m.needleClassName="nhk-snsbtn",m.baseClaasName="nhk-snsbtn",m.SNS={},m.SNS.resources={twitter:{link:"https://x.com/intent/tweet?text={text}%20{description}&url={url}",image:m.baseDir+"img/x.png"},x:{link:"https://x.com/intent/tweet?text={text}%20{description}&url={url}",image:m.baseDir+"img/x.png"},facebook:{link:"https://www.facebook.com/dialog/share?app_id={app_id}&display=popup&href={url}&redirect_uri={redirects}",image:m.baseDir+"img/facebook.png",appId:"1480146385671692",redirects:"https://www.facebook.com"},line:{link:"line://msg/text/{text}%20{url}",image:m.baseDir+"img/line.png"},help:{link:{ja:"https://www.nhk.or.jp/rules/socialmediabutton/",en:"https://www3.nhk.or.jp/nhkworld/common/sns/help_en.html"},image:m.baseDir+"img/help.png"}},m.SNS.defaults=["x","facebook","line"],m.guides={ja:"シェアする",en:"Share"},m.separatableOptions={disable:["line"],lang:["ja","en"],guidepos:["left","bottom","right","top","nothing"],iconsize:["s","m","l"],description:null,title:null,url:null},m.defaultOptions={lang:"ja",iconsize:"m"},m.satisfiedOptions={},m.defaultUrl="http://www.nhk.or.jp/",m.defaultTitle="NHKオンライン",m.defaultDesciption="",{initSNSOnLoad:function(e){window.addEventListener("DOMContentLoaded",function(){t(e)})},initSNS:t}}();
