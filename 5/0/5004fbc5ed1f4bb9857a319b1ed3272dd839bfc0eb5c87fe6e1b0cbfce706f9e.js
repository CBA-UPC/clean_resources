![function(e,t,r){"use strict";var i=r(14);r.d(t,"DRMAgentEvent",(function(){return i.a})),r.d(t,"ManifestEvent",(function(){return i.b})),r.d(t,"MediaEngineEvent",(function(){return i.c})),r.d(t,"PlayerEvent",(function(){return i.d})),r.d(t,"RequestEvent",(function(){return i.e})),r.d(t,"StockEvent",(function(){return i.f})),r.d(t,"TrackEvent",(function(){return i.g}));var n=r(23);r.o(n,"BufferRange")&&r.d(t,"BufferRange",(function(){return n.BufferRange})),r.o(n,"Codecs")&&r.d(t,"Codecs",(function(){return n.Codecs})),r.o(n,"ContainerFormat")&&r.d(t,"ContainerFormat",(function(){return n.ContainerFormat})),r.o(n,"DataType")&&r.d(t,"DataType",(function(){return n.DataType})),r.o(n,"EncryptMethodType")&&r.d(t,"EncryptMethodType",(function(){return n.EncryptMethodType})),r.o(n,"EventBus")&&r.d(t,"EventBus",(function(){return n.EventBus})),r.o(n,"MediaType")&&r.d(t,"MediaType",(function(){return n.MediaType})),r.o(n,"PlayerFeature")&&r.d(t,"PlayerFeature",(function(){return n.PlayerFeature}));var o=r(8);r.d(t,"BufferRange",(function(){return o.a})),r.d(t,"EventBus",(function(){return o.b}));var a=r(16);r.d(t,"ContainerFormat",(function(){return a.a})),r.d(t,"DataType",(function(){return a.b})),r.d(t,"EncryptMethodType",(function(){return a.c})),r.d(t,"MediaType",(function(){return a.d})),r.d(t,"PlayerFeature",(function(){return a.e}));var s=r(24);r.d(t,"Codecs",(function(){return s.a}))},function(e,t,r){"use strict";var i,n;r.d(t,"a",(function(){return i})),function(e){e.AUDIO="audio",e.VIDEO="video",e.MIXED="mixed",e.CLOSED_CAPTION="caption",e.SUBTITLE="subtitle",e.METADATA="metadata",e.TEXT="text",e.UNKNOWN="unknown"}(i||(i={})),n||(n={})},function(e,t,r){"use strict";var i;!function(e){e.DATA="data",e.META="meta",e.ERROR="error",e.FINISH="finish",e.START="start",e.PROGRESS="progress",e.DESTROY="destroy",e.CONCURRENT="concurrent",e.ABORT="abort"}(i||(i={})),t.a=i},function(e,t,r){"use strict";var i,n;r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return n})),function(e){e.M2TS="m2ts",e.FLV="flv",e.MP4="mp4",e.WEBM="webm",e.MOV="mov",e.MKV="mkv",e.UNKNOWN="unknown",e.ANY="any"}(i||(i={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.ANNEX_B=1]="ANNEX_B",e[e.AVC=2]="AVC",e[e.HEVC=3]="HEVC",e[e.ADTS=4]="ADTS",e[e.AAC=5]="AAC",e[e.RAW=6]="RAW"}(n||(n={}))},function(e,t,r){"use strict";var i;!function(e){e.LOADED_MEDIA_RESOURCE="loadedmediaresource",e.TIME_UPDATE="timeupdate",e.DURATION_CHANGE="durationchange",e.VOLUME_CHANGE="volumechange",e.RATE_CHANGE="ratechange",e.PLAYING="playing",e.PROGRESS="progress",e.WAITING="waiting",e.SEEKING="seeking",e.SEEKED="seeked",e.CANPLAY="canplay",e.CANPLAY_THROUGH="canplaythrough",e.LOAD_START="loadstart",e.LOADED_MANIFEST="loadedmanifest",e.LOADED_METADATA="loadedmetadata",e.LOADED_DATA="loadeddata",e.PAUSE="pause",e.PLAY="play",e.ENDED="ended",e.ERROR="error",e.SEGMENT_UPDATE="segmentupdate",e.LEVEL_CHANGE="levelchange",e.LOADED_SEGMENT="loadedsegment",e.APPENDED_SEGMENT="appendedsegment",e.BUFFER_CHANGE="bufferchange",e.CUSTOM_EVENT="customevent"}(i||(i={})),t.a=i},function(e,t,r){"use strict";var i;r.d(t,"a",(function(){return i})),i||(i={}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o}));var i,n=/(Version\/[\d.]+\s*Safari\/[\d.]+)|Web0S/i.test(navigator.userAgent),o=(i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0),256===new Int16Array(i)[0])},function(e,t,r){"use strict";var i,n;r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return n})),function(e){e.HTTP="http://",e.WEBSOCKET="websocket://",e.WEBRTC="webrtc://",e.LITERAL="literal://",e.BLOB="blob://"}(i||(i={})),function(e){e.ARRAYBUFFER="arrayBuffer",e.JSON="json",e.TEXT="text",e.BLOB="blob"}(n||(n={}))},function(e,t,r){"use strict";var i;r.d(t,"a",(function(){return i})),function(e){e[e.NONE=0]="NONE",e[e.WIDEVINE=1]="WIDEVINE",e[e.FAIRPLAY=2]="FAIRPLAY",e[e.PLAYREADY=3]="PLAYREADY",e[e.CLEARKEY=4]="CLEARKEY",e[e.CHINADRM=5]="CHINADRM",e[e.AES_128=6]="AES_128",e[e.SAMPLE_AES=7]="SAMPLE_AES",e[e.CUSTOMIZED=8]="CUSTOMIZED",e[e.UNKNOWN=9]="UNKNOWN"}(i||(i={}))},function(e,t,r){"use strict";var i=function(){function e(){this.handlers={},this.onceMap={}}return e.prototype.off=function(e,t){return t?this.handlers[e]&&(this.handlers[e]=this.handlers[e].filter((function(e){return e!==t}))):e?(this.handlers[e]=[],this.onceMap[e]={}):(this.handlers={},this.onceMap={}),this},e.prototype.once=function(e,t,r){var i=this,n=!1,o=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];i.off(e,o),i.onceMap[e]&&i.onceMap[e][r]&&delete i.onceMap[e][r],n||(n=!0,t.apply(void 0,a))};return r&&(this.onceMap[e]?this.onceMap[e][r]&&this.off(e,this.onceMap[e][r]):this.onceMap[e]={},this.onceMap[e][r]=o),this.on(e,o)},e.prototype.addEventListener=function(e,t){return this.on(e,t)},e.prototype.removeEventListener=function(e,t){return this.off(e,t)},e.prototype.on=function(e,t,r){return this.handlers[e]?isFinite(r)?this.handlers[e].splice(r,0,t):this.handlers[e].push(t):this.handlers[e]=[t],this},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=this.handlers[e];if(i&&i.length>0){var n=i.concat();n.forEach((function(e){e.apply(void 0,t)}))}},e}();t.a=i},function(e,t,r){"use strict";var i;r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"g",(function(){return c})),r.d(t,"e",(function(){return l.a})),r.d(t,"d",(function(){return p.a})),r.d(t,"a",(function(){return h})),r.d(t,"f",(function(){return y})),function(e){e[e.MEDIA_APPENDED=0]="MEDIA_APPENDED",e[e.BUFFER_REMOVED=1]="BUFFER_REMOVED",e[e.BUFFER_FULL=2]="BUFFER_FULL",e[e.RESET=3]="RESET",e[e.CHUNK_REMOVED=4]="CHUNK_REMOVED"}(i||(i={}));var n,o=i;!function(e){e.READY="ManifestReady",e.ERROR="ManifestError",e.TrackLevelSwitched="TrackLevelSwitched"}(n||(n={}));var a,s=n;!function(e){e.SWITCHING="switching",e.SWITCHED="switched",e.SEGMENT_UPDATE="segment_update",e.ERROR="error"}(a||(a={}));var u,c=a,l=r(2),p=r(4);!function(e){e.ERROR="error"}(u||(u={}));var d,h=u;!function(e){e.READY="ready",e.DATA="data",e.FLUSHED="ended",e.ERROR="error",e.OVERFLOW="overflow"}(d||(d={}));var f;!function(e){e.CANPLAY="canplay",e.SEEKED="seeked",e.PLAYING="playing",e.WAITING="waiting",e.DRAIN="drain",e.TIMEUPDATE="timeupdate",e.SYNC="sync",e.SYNC_DONE="syncdone"}(f||(f={}));var m;!function(e){e.CHUNK_UPDATE="chunkupdate",e.ERROR="error",e.FINISH="finish",e.BUFFER_HUNGER="bufferhunger",e.STOCK_ABORT="stockabort",e.STOCK_COMPLETE="stockcomplete",e.META_INFO="metainfo"}(m||(m={}));var y=m},function(e,t,r){"use strict";r.d(t,"b",(function(){return w})),r.d(t,"a",(function(){return S}));var i=r(3),n=r(21),o=r(6),a=r(22),s={stsd:8,avc1:78,mp4a:28,hev1:78,hvc1:78,stpp:[9,11],sbtt:[9,10],dref:8,encv:78,enca:28,schm:4},u=function(){function e(){}return e.register=function(t,r){e.boxHandlers[t]||(e.boxHandlers[t]=[]),e.boxHandlers[t].push(r)},e.dispatch=function(t,r){var i=[];return e.boxHandlers[t]&&e.boxHandlers[t].forEach((function(e){i.push(e(r))})),1===i.length?i[0]:i.length>1?Object.assign.apply(Object,i):void 0},e.boxHandlers={},e}();function c(e,t,r){void 0===r&&(r=0);var i,n,o="string"==typeof t?t.split("").map((function(e){return e.charCodeAt(0)})):t;for(i=r;i<e.length-o.length;i++){for(n=0;n<o.length&&o[n]==e[i+n];n++);if(n===o.length)return i}}u.register("tkhd",(function(e){})),u.register("hvcC",(function(e){var t=new DataView(e);t.getInt8(1),t.getInt8(2),t.getInt8(3);return{videoStream:{codecId:o.a.HEVC,description:new Uint8Array(e)}}})),u.register("avcC",(function(e){var t=new DataView(e);return{videoCodec:{profile:t.getInt8(1),profileCompatibility:t.getInt8(2),levelIdc:t.getInt8(3)},videoStream:{codecId:o.a.AVC,description:new Uint8Array(e)}}})),u.register("mvhd",(function(e){return{timescale:new DataView(e).getUint32(12)}})),u.register("mp4a",(function(e){var t=new DataView(e),r=(t.getInt16(16),t.getInt16(18),t.getUint16(24)),i=new Uint8Array(e),n=c(new Uint8Array(e),"esds");n=c(i,[5,128,128,128],n+8);var s=i.subarray(n+5,n+7),u=new a.a(s);return{audioCodec:{audioObjectType:u.audioObjectType,samplingFrequencyIndex:u.samplingFrequencyIndex,sampleRate:r},audioStream:{codecId:o.a.AAC,description:s}}}));var l=Math.pow(2,32);function p(e){return function e(t,r,i,n){void 0===i&&(i=0);void 0===n&&(n=t.byteLength);var o,a;if(r>=t.byteLength)return{};var c=t.getInt32(r),l=d(t.buffer.slice(r+4,r+8)),p=u.dispatch(l,t.buffer.slice(r+8,r+c)),h=r+c,f=0;s[l]&&(f=s[l]);c>f+16&&/[a-zA-Z0-9]{4}/.test(d(t.buffer.slice(r+12+f,r+16+f)))&&(o=e(t,r+8+f,i+1,r+c));c>0&&h<n&&(a=e(t,h,i,n));return Object.assign({},p,o,a)}(new DataView(e),0)}function d(e){for(var t=new Uint8Array(e),r="",i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r}u.register("tfdt",(function(e){var t=new DataView(e),r=t.getUint8(0),i=0;if(0==r)i=t.getUint32(4);else if(1===r){var n=t.getUint32(4),o=t.getUint32(8);i=n*l+o}return{baseMediaDecodeTime:i}}));var h=r(19),f=function(){function e(t){this.key=e.coerceArray(t,!0),this._prepare()}return e.createArray=function(e){return new Uint8Array(e)},e.checkInt=function(e){return parseInt(e)===e},e.checkInts=function(t){if(!e.checkInt(t.length))return!1;for(var r=0;r<t.length;r++)if(!e.checkInt(t[r])||t[r]<0||t[r]>255)return!1;return!0},e.convertToInt32=function(e){for(var t=[],r=0;r<e.length;r+=4)t.push(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]);return t},e.coerceArray=function(t,r){if(void 0===r&&(r=!1),t.buffer&&"Uint8Array"===t.name)return r&&(t=t.slice?t.slice():Array.prototype.slice.call(t)),t;if(Array.isArray(t)){if(!e.checkInts(t))throw new Error("Array contains invalid value: "+t);return new Uint8Array(t)}if(e.checkInt(t.length)&&e.checkInts(t))return new Uint8Array(t);throw new Error("unsupported array-like object")},e.prototype._prepare=function(){var t=e.numberOfRounds[this.key.length];if(null==t)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var r=0;r<=t;r++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);var i,n=4*(t+1),o=this.key.length/4,a=e.convertToInt32(this.key);for(r=0;r<o;r++)i=r>>2,this._Ke[i][r%4]=a[r],this._Kd[t-i][r%4]=a[r];for(var s,u=0,c=o;c<n;){if(s=a[o-1],a[0]^=e.S[s>>16&255]<<24^e.S[s>>8&255]<<16^e.S[255&s]<<8^e.S[s>>24&255]^e.rcon[u]<<24,u+=1,8!=o)for(r=1;r<o;r++)a[r]^=a[r-1];else{for(r=1;r<o/2;r++)a[r]^=a[r-1];s=a[o/2-1],a[o/2]^=e.S[255&s]^e.S[s>>8&255]<<8^e.S[s>>16&255]<<16^e.S[s>>24&255]<<24;for(r=o/2+1;r<o;r++)a[r]^=a[r-1]}var l,p;for(r=0;r<o&&c<n;)l=c>>2,p=c%4,this._Ke[l][p]=a[r],this._Kd[t-l][p]=a[r++],c++}for(var d=1;d<t;d++)for(var h=0;h<4;h++)s=this._Kd[d][h],this._Kd[d][h]=e.U1[s>>24&255]^e.U2[s>>16&255]^e.U3[s>>8&255]^e.U4[255&s]},e.prototype.encrypt=function(t){if(16!=t.length)throw new Error("invalid plaintext size (must be 16 bytes)");for(var r=this._Ke.length-1,i=[0,0,0,0],n=e.convertToInt32(t),o=0;o<4;o++)n[o]^=this._Ke[0][o];for(var a=1;a<r;a++){for(o=0;o<4;o++)i[o]=e.T1[n[o]>>24&255]^e.T2[n[(o+1)%4]>>16&255]^e.T3[n[(o+2)%4]>>8&255]^e.T4[255&n[(o+3)%4]]^this._Ke[a][o];n=i.slice()}var s,u=e.createArray(16);for(o=0;o<4;o++)s=this._Ke[r][o],u[4*o]=255&(e.S[n[o]>>24&255]^s>>24),u[4*o+1]=255&(e.S[n[(o+1)%4]>>16&255]^s>>16),u[4*o+2]=255&(e.S[n[(o+2)%4]>>8&255]^s>>8),u[4*o+3]=255&(e.S[255&n[(o+3)%4]]^s);return u},e.prototype.decrypt=function(t){if(16!=t.length)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var r=this._Kd.length-1,i=[0,0,0,0],n=e.convertToInt32(t),o=0;o<4;o++)n[o]^=this._Kd[0][o];for(var a=1;a<r;a++){for(o=0;o<4;o++)i[o]=e.T5[n[o]>>24&255]^e.T6[n[(o+3)%4]>>16&255]^e.T7[n[(o+2)%4]>>8&255]^e.T8[255&n[(o+1)%4]]^this._Kd[a][o];n=i.slice()}var s,u=e.createArray(16);for(o=0;o<4;o++)s=this._Kd[r][o],u[4*o]=255&(e.Si[n[o]>>24&255]^s>>24),u[4*o+1]=255&(e.Si[n[(o+3)%4]>>16&255]^s>>16),u[4*o+2]=255&(e.Si[n[(o+2)%4]>>8&255]^s>>8),u[4*o+3]=255&(e.Si[255&n[(o+1)%4]]^s);return u},e.numberOfRounds={16:10,24:12,32:14},e.rcon=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],e.S=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],e.Si=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],e.T1=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],e.T2=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],e.T3=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],e.T4=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],e.T5=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],e.T6=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],e.T7=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],e.T8=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],e.U1=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],e.U2=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],e.U3=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],e.U4=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925],e}(),m=function(){function e(){}return e.copyArray=function(e,t,r,i,n){null==i&&null==n||(e=e.slice?e.slice(i,n):Array.prototype.slice.call(e,i,n)),t.set(e,r)},e.prototype.encrypt=function(t){var r=f.coerceArray(t);if(r.length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var i=f.createArray(r.length),n=f.createArray(16),o=0;o<r.length;o+=16)e.copyArray(r,n,0,o,o+16),n=this._aes.encrypt(n),e.copyArray(n,i,o);return i},e.prototype.decrypt=function(t){var r=f.coerceArray(t);if(r.length%16!=0)throw new Error("invalid cipherText size (must be multiple of 16 bytes)");for(var i=f.createArray(r.length),n=f.createArray(16),o=0;o<r.length;o+=16)e.copyArray(r,n,0,o,o+16),n=this._aes.decrypt(n),e.copyArray(n,i,o);return i},e.prototype.decryptAES128ECB=function(e,t){this._key!=t&&(this._aes=new f(t)),this._aes||(this._aes=new f(t));var r=e.length,i=r%16;if(i){var n=this.decrypt(e.subarray(0,r-i)),o=e.subarray(r-i),a=new Uint8Array(n.length+o.length);return a.set(n,0),a.set(o,n.length),a}return this.decrypt(e)},e}(),y=function(){function e(){}return e.copyArray=function(e,t,r,i,n){null==i&&null==n||(e=e.slice?e.slice(i,n):Array.prototype.slice.call(e,i,n)),t.set(e,r)},e.prototype.encrypt=function(t){var r=f.coerceArray(t);if(r.length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var i=f.createArray(r.length),n=f.createArray(16),o=0;o<r.length;o+=16)e.copyArray(r,n,0,o,o+16),n=this._aes.encrypt(n),e.copyArray(n,i,o);return i},e.prototype.decrypt=function(t,r){this._lastCipherblock||(this._lastCipherblock=f.coerceArray(r,!0));var i=f.coerceArray(t);if(i.length%16!=0)throw new Error("invalid cipherText size (must be multiple of 16 bytes)");for(var n=f.createArray(i.length),o=f.createArray(16),a=0;a<i.length;a+=16){e.copyArray(i,o,0,a,a+16),o=this._aes.decrypt(o);for(var s=0;s<16;s++)n[a+s]=o[s]^this._lastCipherblock[s];e.copyArray(i,this._lastCipherblock,0,a,a+16)}return n},e.prototype.decryptAESCBC=function(t,r,i,n){this._key!=r&&(this._aes=new f(r),this._key=r);var o=t.data,a=n.default_crypt_byte_block,s=n.default_constant_IV,u=n.default_skip_byte_block;if(i&&i.subsample_count){for(var c=i.subsample_count,l=i.bytes_of_clear_data_list,p=i.bytes_of_protected_data_list,d=(L=i.iv,f.createArray(o.length)),h=0,m=0;m<c;m++){this._lastCipherblock=void 0,e.copyArray(o,d,h,h,h+l[m]),h+=l[m];var y=o.subarray(h,h+p[m]);R=y.length%16,T=y.subarray(y.length-R);if(y=y.subarray(0,y.length-R),a>0&&u>0)for(var g=0;g+16*a<=y.length;g+=16*(a+u)){var v=y.subarray(g,g+16*a),b=new Uint8Array(L||s),E=this.decrypt(v,b);e.copyArray(E,d,h),h+=E.length;var _=void 0;_=g+16*(a+u)>y.length?y.subarray(g+16*a):y.subarray(g+16*a,g+16*(a+u)),e.copyArray(_,d,h),h+=_.length}e.copyArray(T,d,h),h+=R}return d}this._lastCipherblock=void 0;var R,S=o.length;if(R=S%16){var A=this.decrypt(o.subarray(0,S-R),s),T=o.subarray(S-R),w=new Uint8Array(A.length+T.length);return w.set(A,0),w.set(T,A.length),w}var L=new Uint8Array(s);return this.decrypt(o,L)},e}(),g=new m,v=new y;var b,E,_,R=r(0);!function(e){e[e.MUX=0]="MUX",e[e.INIT=1]="INIT",e[e.DESTROY=2]="DESTROY",e[e.RESET=3]="RESET",e[e.RESULT_RETURN=4]="RESULT_RETURN",e[e.ERROR=5]="ERROR",e[e.FLUSH=6]="FLUSH",e[e.GET_OUTPUT=7]="GET_OUTPUT",e[e.INIT_ALIGNER=8]="INIT_ALIGNER",e[e.SET_ALIGNER=9]="SET_ALIGNER",e[e.SET_DECRYPTION=10]="SET_DECRYPTION",e[e.PARSE=11]="PARSE",e[e.GET_STREAMS=12]="GET_STREAMS",e[e.END_OF_STREAM=13]="END_OF_STREAM",e[e.ABORT=14]="ABORT"}(b||(b={})),function(e){e[e.NONE=0]="NONE",e[e.WIDEVINE=1]="WIDEVINE",e[e.FAIRPLAY=2]="FAIRPLAY",e[e.PLAYREADY=3]="PLAYREADY",e[e.CLEARKEY=4]="CLEARKEY",e[e.CHINADRM=5]="CHINADRM",e[e.AES_128=6]="AES_128",e[e.SAMPLE_AES=7]="SAMPLE_AES",e[e.CUSTOMIZED=8]="CUSTOMIZED",e[e.UNKNOWN=9]="UNKNOWN"}(E||(E={})),function(e){e.DecodedFail="decodedfail"}(_||(_={}));var S,A,T=function(){eturn e.prototype.getSupportRemuxer=function(e){return e.filter((function(e){return h.a.isSupportRemuxer(e)}))[0]},e.prototype.init=function(e,t){if(this.demuxer&&this.demuxer.format==e||(this.demuxer=new h.a(e)),t){var r=this.getSupportRemuxer(t);this.remuxer&&this.remuxer.format==r||(this.remuxer=new h.a(r)),this.demuxer.pipe(this.remuxer)}},e.prototype.setAligner=function(e){this.aligner=e},e.prototype.flush=function(){this.cashed=!1,this.demuxer&&this.demuxer.flush()},e.prototype.destroy=function(){this.reset()},e.prototype.findAllStreams=function(){if(!this.demuxer)throw new Error("must pushData at first!");var e=this.demuxer.findAllStream();e.forEach((function(e){e.serialize()}));var t=[];return e.forEach((function(e){var r={meta:e.codec.getMetaData(),type:e.type,id:e.id,index:e.index,timescale:e.timescale,duration:e.duration};t.push(r)})),t},e.prototype.getOutput=function(e){if(this.remuxer){var t=this.remuxer.getStreams(),r=t&&t.filter((function(e){return e.type==R.MediaType.VIDEO}))[0];if(e.forceAlign&&2==t.length&&r.packetsCount>0||t.length>0&&t.every(())return this.cashed=!1,this.remuxer.getOutput(e,this.aligner);throw this.cashed=!0,Error(_.DecodedFail)}},e.prototype.setDecryption=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.demuxer&&e&&this.demuxer.setPacketFilter((function(r){return function(e,t,r){if("AES-ECB"===e.name)return g.decryptAES128ECB(t.data,r);if("AES-CBC"===e.name)return t.encrypted?v.decryptAESCBC(t,r,t.encryptionInfo,t.default_encryption):t.data;throw new Error("unsupported crypto algorithm:"+e.name)}({name:t},r,e)}))},e.prototype.push=e.prototype.endOfStream=function(){this.demuxer&&this.demuxer.reset(),this.remuxer&&this.remuxer.reset()},e.prototype.abort=function(){this.cashed=!1,this.demuxer&&this.demuxer.abort()},e.prototype.reset=function(){this.cashed=!1,this.discontinuity=!1,this.sequential=!1,this.demuxer&&this.demuxer.reset(),this.remuxer&&this.remuxer.reset(),this.demuxer=null,this.remuxer=null,this.aligner&&this.aligner.reset()},e}();!function(e){e.DecodedFail="decodedfail"}(S||(S={})),function(e){e[e.NONE=0]="NONE",e[e.WIDEVINE=1]="WIDEVINE",e[e.FAIRPLAY=2]="FAIRPLAY",e[e.PLAYREADY=3]="PLAYREADY",e[e.CLEARKEY=4]="CLEARKEY",e[e.CHINADRM=5]="CHINADRM",e[e.AES_128=6]="AES_128",e[e.SAMPLE_AES=7]="SAMPLE_AES",e[e.CUSTOMIZED=8]="CUSTOMIZED",e[e.UNKNOWN=9]="UNKNOWN"}(A||(A={}));var w=function(){eturn e.parse=function(e,t){if(e&&e.buffer&&t===i.b.MP4)return p(e.buffer)},e.prototype.init=function(e,t,r){if(this.transmuxerCollection.get(e))this.currentTransmuxer.type!=e&&(this.currentTransmuxer=this.transmuxerCollection.get(e));else{var i=new T(e);i.init(t,r),this.transmuxerCollection.set(e,i),this.aligner&&i.setAligner(this.aligner),this.currentTransmuxer=i}},e.prototype.initAligner=function(){this.aligner||(this.aligner=new n.a)},e.prototype.destroyAligner=e.prototype.setAligner=function(e){if(this.aligner){var t=e.timestampOffset,r=e.discontinuity,i=e.sequential;r=this.currentTransmuxer.cashed?this.currentTransmuxer.discontinuity:r,i=this.currentTransmuxer.cashed?this.currentTransmuxer.sequential:i,this.aligner.timestampOffset=t,r&&this.aligner.discontinuity(),this.aligner.sequential=i}},e.prototype.flush=function(){this.currentTransmuxer.flush()},e.prototype.destroy=e.prototype.findAllStreams=function(){return this.currentTransmuxer.findAllStreams()},e.prototype.getOutput=function(e){return this.currentTransmuxer.getOutput(e)},e.prototype.setDecryption=e.prototype.push=function(e){this.currentTransmuxer.push(e)},e.prototype.endOfStream=function(){this.currentTransmuxer.endOfStream()},e.prototype.abort=function(){this.currentTransmuxer.abort()},e.prototype.reset=function(){this.transmuxerCollection.forEach((function(e){e.reset()})),this.transmuxerCollection.clear()},e}()},function(e,t,r){"use strict";"undefined"!=typeof TimeRanges&&(TimeRanges.prototype.dump=function(e){for(var t=[],r=0;r<this.length;r++)t.push(this.start(r)+"~"+this.end(r));if(e)return t.join(" , ");console.log(t.join(" , "))});var i=function(){function e(e){this.ranges=e.reduce((function(e,t){var r=e[e.length-1];return!r||r[1]<t[0]?e.push(t):(r[1]===t[0]||console.warn("range overlap!"),r[1]=t[1]),e}),[])}return e.fromTimeRanges=function(t){var r=[];if(t instanceof TimeRanges)for(var i=0;i<t.length;i++)r.push([t.start(i),t.end(i)]);return new e(r)},e.pushRange=function(e,t,r){0===e.length||t>=e[e.length-1][1]?e.push([t,r]):r>=e[e.length-1][1]&&(e[e.length-1][1]=r)},e.unionTwoTimeRanges=function(t,r){for(var i=0,n=0,o=[];i<t.length&&n<r.length;)t.start(i)<=r.start(n)?t.end(i)<=r.start(n)?(e.pushRange(o,t.start(i),t.end(i)),i++):t.end(i)<=r.end(n)?(e.pushRange(o,t.start(i),r.end(n)),i++,n++):t.end(i)>r.end(n)?n++:console.error(""):t.start(i)>r.start(n)&&t.start(i)<r.end(n)?t.end(i)<r.end(n)?i++:t.end(i)>=r.end(n)?(e.pushRange(o,r.start(n),t.end(i)),n++,i++):console.error(""):(e.pushRange(o,r.start(n),r.end(n)),n++);for(;i<t.length;)(0===o.length||t.start(i)>=o[o.length-1][1])&&o.push([t.start(i),t.end(i)]),i++;for(;n<r.length;)(0===o.length||r.start(n)>=o[o.length-1][1])&&o.push([r.start(n),r.end(n)]),n++;return new e(o)},e.joinTwoTimeRanges=function(t,r){for(var i=0,n=0,o=[];i<t.length&&n<r.length;)t.start(i)<=r.start(n)?(t.end(i)<=r.start(n)||o.push([r.start(n),t.end(i)]),i++):t.start(i)>=r.end(n)?n++:t.end(i)<=r.end(n)?(o.push([t.start(i),t.end(i)]),i++):(o.push([t.start(i),r.end(n)]),n++);return new e(o)},e.fromSegments=function(t){return 0===t.length?e.Empty:new e(t.map((function(e){return[e.start,e.end]})))},e.prototype.indexOf=function(e,t){void 0===t&&(t=0);for(var r=0;r<this.ranges.length;r++)if(e>=this.ranges[r][0]-t&&e<=this.ranges[r][1])return r;return-1},e.prototype.findRange=function(e,t){return this.ranges[this.indexOf(e,t)]},Object.defineProperty(e.prototype,"Length",{get:function(){return this.ranges.reduce((function(e,t){return e+t[1]-t[0]}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.ranges.length},enumerable:!1,configurable:!0}),e.prototype.start=function(e){return this.ranges[e][0]},e.prototype.dump=function(e){var t=this.ranges.map((function(e){return e.join("-")})).join(",");return e&&console.log(t),t},e.prototype.end=function(e){return this.ranges[e][1]},e.prototype.setRanges=function(e){return this.ranges=e,this},e.prototype.toGap=function(){var e=[];if(this.ranges.length>0&&this.ranges[0][0]>0&&e.push([0,this.ranges[0][0]]),this.ranges.length>1)for(var t=1;t<this.ranges.length;t++)e.push([this.ranges[t-1][1],this.ranges[t][0]]);return this.setRanges(e)},e.prototype.getBufferInfo=function(e,t){t=t||0;for(var r=0;r<this.ranges.length;r++){if(e<this.ranges[r][0]-t)return{bufferLength:0,bufferEnd:e,bufferStart:e};if(e>=this.ranges[r][0]-t&&e<=this.ranges[r][1])return{bufferLength:this.ranges[r][1]-e,bufferEnd:this.ranges[r][1],bufferStart:this.ranges[r][0]}}return{bufferLength:0,bufferEnd:e,bufferStart:e}},Object.defineProperty(e.prototype,"Last",{get:function(){return this.ranges[this.ranges.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Start",{get:function(){return this.ranges[0]},enumerable:!1,configurable:!0}),e.START=0,e.END=1,e.Empty=new e([]),e}();t.a=i},function(e,t,r){"use st.set(t,e.byteLength),r}function a(e,t,r){for(var i=0,n=r;n>0;n--)i+=e[t+r-n]<<8*(n-1);return i}function s(e,t,r,i){for(var n=i;n>0;n--)e[t+n-1]=(r&255<<8*(i-n))>>8*(i-n)}function u(e){return e&&e.buffer instanceof ArrayBuffer}var c,l=r(6),p=function(){function e(e){this._workingData=e,this._workingBytesAvailable=e.byteLength,this._workingBitsAvailable=0,this._workingWord=0,this.loadWord()}re_workingBytesAvailable},e.._workingBitsAvailablrkingBytesAvailable-=r},e.prototype.skipBits=function(e){var t;this._workingBitsAvailable>e?(this._workingWord<<=e,this._workingBitsAvailable-=e):(e-=this._workingBitsAvailable,e-=8*(t=Math.floor(e/8)),this._workingBytesAvailable-=t,this.loadWord(),this._workingWord<<=e,this._workingBitsAvailable-=e)},e.prototype.readBits=function(e){if(this._workingBitsAvailable<=0)throw new Error("no bits available");var t=Math.min(this._workingBitsAvailable,e),r=this._workingWord>>>32-t;return this._workingBitsAvailable-=t,this._workingBitsAvailable>0?this._workingWord<<=t:this._workingBytesAvailable>0&&this.loadWord(),(t=e-t)>0?r<<t|this.readBits(t):r},e.prototype.skipLeadingZeros=function(){var e;for(e=0;e<this._workingBitsAvailable;++e)if(0!=(this._workingWord&2147483648>>>e))return this._workingWord<<=e,this._workingBitsAvailable-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},e.prototype.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},e.prototype.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},e.prototype.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},e.prototype.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUnsignedByte=function(){return this.readBits(8)},e.prototype.destroy=function(){this._workingData=null},e}(),d=function(){function e(){}r+256)%256),i=0===n?i:n},e.discardEmulationPreventionBytes=function(e){for(var t=e.byteLength,r=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;var n=t-r.length,o=new Uint8Array(n),a=0;for(i=0;i<n;a++,i++)a===r[0]&&(a++,r.shift()),o[i]=e[a];return o},e.readSequenceParameterSet=function(t){var r,i,n,o,a,s,u,c,l,d,f,m,y=0,g=0,v=0,b=0,E=0,_=[1,1];try{if(i=(r=new p(t)).readUnsignedByte(),o=r.readUnsignedByte(),n=r.readUnsignedByte(),r.skipUnsignedExpGolomb(),h[i]&&(3===(a=r.readUnsignedExpGolomb())&&r.skipBits(1),r.skipUnsignedExpGolomb(),r.skipUnsignedExpGolomb(),r.skipBits(1),r.readBoolean()))for(f=3!==a?8:12,m=0;m<f;m++)r.readBoolean()&&(m<6?e.skipScalingList(16,r):e.skipScalingList(64,r));if(r.skipUnsignedExpGolomb(),0===(s=r.readUnsignedExpGolomb()))r.readUnsignedExpGolomb();else if(1===s)for(r.skipBits(1),r.skipExpGolomb(),r.skipExpGolomb(),u=r.readUnsignedExpGolomb(),m=0;m<u;m++)r.skipExpGolomb();if(r.skipUnsignedExpGolomb(),r.skipBits(1),c=r.readUnsignedExpGolomb(),l=r.readUnsignedExpGolomb(),0===(d=r.readBits(1))&&r.skipBits(1),r.skipBits(1),r.readBoolean()&&(y=r.readUnsignedExpGolomb(),v=r.readUnsignedExpGolomb(),b=r.readUnsignedExpGolomb(),E=r.readUnsignedExpGolomb()),r.readBoolean()&&r.readBoolean()){switch(r.readUnsignedByte()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[r.readUnsignedByte()<<8|r.readUnsignedByte(),r.readUnsignedByte()<<8|r.readUnsignedByte()]}if(r.readBoolean()&&r.readBoolean(),r.readBoolean()&&(r.readBits(4),r.readBoolean()&&r.readBits(24)),r.readBoolean()&&(r.readUnsignedExpGolomb(),r.readUnsignedExpGolomb()),r.readBoolean()){var R=r.readBits(32),S=r.readBits(32);r.readBoolean()&&0!==R&&0!==S&&(g=2*R/S*1e3)}_&&_[0]/_[1]}}catch(e){if(this.lastSPSConfig)return this.lastSPSConfig;throw e}var A={profile:i,level:n,sarRatio:_,profileCompatibility:o,width:Math.ceil(16*(c+1)-2*y-2*v),height:(2-d)*(l+1)*16-2*b-2*E};return g>0&&(A.sampleDuration=g),this.lastSPSConfig=A,A},e.lastSPSConfig=null,e}(),h={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0",e[e.OTHER=7]="OTHER"}(c||(c={}));var f,m=function(e){switch(31&e[0]){case 1:this.type=c.NDR;break;case 5:this.type=c.IDR;break;case 6:this.type=c.SEI,this.escapedRBSP=d.discardEmulationPreventionBytes(e.subarray(1));break;case 7:this.type=c.SPS,this.escapedRBSP=d.discardEmulationPreventionBytes(e.subarray(1)),this.config=d.readSequenceParameterSet(this.escapedRBSP);break;case 8:this.type=c.PPS;break;case 9:this.type=c.ACCESS_UNIT_DELIMITER;break;default:return}this.data=e},y=new Uint8Array([0,0,0,1]),g=function(){function e(e){this.codec=e,this.naluList=[],this.pendingFrames=[]}return e.prototype.parseAnnexB=function(e,t){var r,n,a=this;void 0===t&&(t=i.a.ANNEX_B),n=this.buffer?o(this.buffer,e.data):e.data;for(var s=0;s<n.byteLength-3;s++)if(1===n[s+2]){r=s+5;break}for(;r<n.byteLength;)switch(n[r]){case 0:if(0!==n[r-1]){r+=2;break}if(0!==n[r-2]){r++;break}s+3!==r-2&&this.collectNALU(n.subarray(s+3,r-2));do{r++}while(1!==n[r]&&r<n.length);s=r-2,r+=3;break;case 1:if(0!==n[r-1]||0!==n[r-2]){r+=3;break}s+3!==r-2&&this.collectNALU(n.subarray(s+3,r-2)),s=r-2,r+=3;break;default:r+=3}this.buffer=n.subarray(s),this.pendingFrames.push({pts:e.pts,dts:e.dts,timestamp:e.timestamp,data:null,streamIndex:e.streamIndex,units:[],size:0,hasCodecFrame:0,done:0}),this.fillFrame();var u=this.pendingFrames.filter((function(e){return e.done}));if(u.length>0){var c=u.map((function(e){return a.convertBsf(e,t)}));return this.pendingFrames=this.pendingFrames.slice(c.length),c.length>1?c:c[0]}return null},e.prototype.convertBsf=function(e,t){if(t===i.a.ANNEX_B){e.data=new Uint8Array(4*e.units.length+e.size);var r=0;e.bsf=t;for(var n=0;n<e.units.length;n++)e.data.set(y,r),e.data.set(e.units[n].data,r+4),r+=4+e.units[n].data.byteLength}else{if(t!==i.a.AVC)throw new Error("unsupported target BitstreamFormat:"+t);var o=this.codec.getMetaData().naluLengthSize||4,a=new Uint8Array(e.units.length*o+e.size),u=0;for(n=0;n<e.units.length;n++){var c=e.units[n];s(a,u,c.data.byteLength,o),u+=o,a.set(c.data,u),u+=c.data.byteLength}e.data=a,e.bsf=t}return e},e.prototype.flush=function(){var e=this;if(this.buffer&&this.buffer.byteLength>3){if(this.collectNALU(this.buffer.subarray(3)),this.fillFrame(),this.buffer=null,!this.pendingFrames.filter((function(e){return e.units.length})).length)return this.pendingFrames.length,null;var t=this.pendingFrames.map((function(t){return e.convertBsf(t,e.lastTargetBsf)}));return this.pendingFrames=[],t}return null},e.prototype.hasAUD=function(e){return e.filter((function(e){return e.type==c.ACCESS_UNIT_DELIMITER})).length>0},e.prototype.fillFrame=function(){for(var e,t=0,r=this.pendingFrames[t];e=this.naluList.shift();){var i=r&&r.units.length&&this.hasAUD(r.units);switch(e.type){case c.ACCESS_UNIT_DELIMITER:r&&r.units.length>0&&i&&(r.done=1,r=this.pendingFrames[++t]);break;case c.SEI:case c.PPS:case c.SPS:case c.VPS:case c.IDR:case c.NDR:if(r&&r.units.length>0&&r.hasCodecFrame){var n=r.units[r.units.length-1].type;i||n!=c.IDR&&n!=c.NDR||(r.done=1,r=this.pendingFrames[++t])}}if(!r){this.naluList.unshift(e);break}r.units.push(e),r.size+=e.data.byteLength,e.type===c.IDR&&(r.hasCodecFrame=1,r.key=!0),e.type===c.NDR&&(r.hasCodecFrame=1)}},e.prototype.parseAVC=function(e,t){var r=0,i=this.codec.getMetaData(),n=i&&i.naluLengthSize||4;for(e.size=0,e.units=[];r<e.data.byteLength;){var o=a(e.data,r,n);this.collectNALU(e.data.subarray(r+n,r+n+o)),r+=n+o}return e},e.prototype.parse=function(e,t){if(void 0===t&&(t=e.bsf),this.lastTargetBsf=t,e.bsf===i.a.ANNEX_B)return this.parseAnnexB(e,t);if(e.bsf===i.a.AVC)return this.parseAVC(e,t);throw new Error("unknown bitstream format :"+e.bsf)},e.prototype.collectNALU=function(e){var t=new m(e);t.data&&(this.naluList.push(t),t.type===c.SPS?(this.codec.setMetadata(t.config),this.codec.setMetadata({sps:[t.data]})):t.type===c.PPS&&this.codec.setMetadata({pps:[t.data]}))},e}(),v=function(){function e(){this.handlers={},this.onceMap={}}return e.prototype.off=function(e,t){return t?this.handlers[e]&&(this.handlers[e]=this.handlers[e].filter((function(e){return e!==t}))):e?(this.handlers[e]=[],this.onceMap[e]={}):(this.handlers={},this.onceMap={}),this},e.prototype.once=function(e,t,r){var i=this,n=!1,o=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];i.off(e,o),i.onceMap[e]&&i.onceMap[e][r]&&delete i.onceMap[e][r],n||(n=!0,t.apply(void 0,a))};return r&&(this.onceMap[e]?this.onceMap[e][r]&&this.off(e,this.onceMap[e][r]):this.onceMap[e]={},this.onceMap[e][r]=o),this.on(e,o)},e.prototype.addEventListener=function(e,t){return this.on(e,t)},e.prototype.removeEventListener=function(e,t){return this.off(e,t)},e.prototype.on=function(e,t,r){return this.handlers[e]?isFinite(r)?this.handlers[e].splice(r,0,t):this.handlers[e].push(t):this.handlers[e]=[t],this},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=this.handlers[e];if(i&&i.length>0){var n=i.concat();n.forEach((function(e){e.apply(void 0,t)}))}},e}(),b=r(11),E=(f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),_=function(e){function t(){var t=e.call(this)||this;return t._flushed=!1,t.decoder=new VideoDecoder({output:function(e){t.emit(b.a.DATA,e)},error:function(e){console.error(e),t.emit(b.a.ERROR,e)}}),t.emit(b.a.READY),t}return E(t,e),Object.defineProperty(t.prototype,"Flushed",{get:function(){return this._flushed},enumerable:!1,configurable:!0}),t.prototype.configure=function(e,t,r,i){this._flushed=!1;var n={codec:t,description:i};Object.assign(n,r),this.decoder.configure(n)},t.prototype.decode=function(e,t){void 0===t&&(t=1),this._flushed=!1;var r=new EncodedVideoChunk({data:e.data,timestamp:e.timestamp,type:e.key?"key":"delta",duration:e.durationTime});this.decoder.decode(r),this.decoder.decodeQueueSize>10&&this.emit(b.a.OVERFLOW,this.decoder.decodeQueueSize)},t.prototype.flush=function(){var e=this;return console.log("flushing!"),this.decoder.flush().then((function(){e._flushed=!0,console.log("flushed!",e.decoder.decodeQueueSize),e.emit(b.a.FLUSHED)}))},t.prototype.reset=function(){},t.prototype.destroy=function(){},t}(v);function R(e){for(var t=new Uint8Array(e.reduce((function(e,t){return e+t.byteLength}),2*e.length)),r=0,i=0;i<e.length;i++)t[r]=(65280&e[i].byteLength)>>>8,t[r+1]=255&e[i].byteLength,t.set(e[i],r+2),r+=2+e[i].byteLength;return t}function S(e,t,r){for(var i=[],n=0;n<r;n++){var o=w(e,t.offset,2);i.push(e.subarray(t.offset+2,t.offset+2+o)),t.offset+=o+2}return i}function A(e){return e.length<2?"0"+e:e}var T=function(){function e(){this.id=l.a.AVC,this.fourCC="avc1",this.configName="avcC"}return e.prototype.createDescription=function(){if(this.description)return this.description;if(this.metadata){var e=R(this.metadata.sps),t=R(this.metadata.pps);return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.reduce((function(e,t){return e+(t.byteLength||t.length||1)}),0),i=new Uint8Array(r),n=0;return e.forEach((function(e){e instanceof Uint8Array?(i.set(e,n),n+=e.byteLength):Array.isArray(e)?(i.set(new Uint8Array(e),n),n+=e.length):"number"==typeof e?(i[n]=e,n++):"string"==typeof e&&(i.set(new Uint8Array(e.split("").map((function(e){return e.charCodeAt(0)}))),n),n+=e.length)})),i}([1,this.metadata.profile,this.metadata.profileCompatibility,this.metadata.level,255,224|this.metadata.sps.length],e,this.metadata.pps.length,t)}return null},e.prototype.getParser=function(){return this.parser||(this.parser=new g(this)),this.parser},e.prototype.getDecoder=function(){return this.decoder||(this.decoder=new _,this.metadata&&this.decoder.configure(l.a.AVC,this.getCodecString(),this.getMetaData(),this.description)),this.decoder},e.prototype.getBitstreamFormat=function(e){return 0==e[0]&&0===e[1]&&(1==e[2]||0==e[2]&&1==e[3])?i.a.ANNEX_B:i.a.AVC},e.prototype.getCodecString=function(){if(this.metadata){var e="avc1.";return e+=Number(this.metadata.profile).toString(16)+A(Number(this.metadata.profileCompatibility).toString(16))+A(Number(this.metadata.level).toString(16))}return"avc1"},e.prototype.getMetaData=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata||(this.metadata={id:this.id,width:0,height:0,profile:0,level:0}),Object.assign(this.metadata,e)},e.prototype.init=function(e){this.metadata||(this.metadata={id:this.id,width:0,height:0,profile:0,level:0}),this.metadata=Object.assign(this.metadata,{profile:e[1],profileCompatibility:e[2],level:e[3]}),this.description=e,this.metadata.naluLengthSize=4&e[4];var t=31&e[5],r={offset:6};this.metadata.sps=S(e,r,t);var i=e[r.offset++];this.metadata.pps=S(e,r,i);var n=d.discardEmulationPreventionBytes(this.metadata.sps[0].subarray(1)),o=d.readSequenceParameterSet(n);Object.assign(this.metadata,o)},e.prototype.transBitstream=function(e,t){if(t===i.a.AVC){var r=this.metadata.naluLengthSize||4;e.units||this.getParser().parse(e);for(var n=e.units.reduce((function(e,t){return e+t.data.byteLength}),0),o=new Uint8Array(n+r*e.units.length),a=0,u=0;u<e.units.length;u++){var c=e.units[u];s(o,a,c.data.byteLength,r),a+=r,o.set(c.data,a),a+=c.data.byteLength}return{pts:e.pts,dts:e.dts,timestamp:e.timestamp,duration:e.duration,key:e.key,streamIndex:e.streamIndex,data:o,bsf:i.a.HEVC}}i.a.ANNEX_B},e}();function w(e,t,r){for(var i=0,n=r;n>0;n--)i+=e[t+r-n]<<8*(n-1);return i}var L,O,x=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],P=function(){function e(e){this.codec=e,this.buffer=null}return e.prototype.parse=function(e,t){return void 0===t&&(t=i.a.AAC),this.lastTargetBsf=t,e.bsf===i.a.ADTS?this.parseADTS(e,t):e.bsf===i.a.AAC?this.parseAAC(e,t):void 0},e.prototype.parseAAC=function(e,t){return e},e.prototype.parseADTS=function(e,t){var r=[];this.buffer?this.buffer=o(this.buffer,e.data):this.buffer=e.data;for(var n,a,s,u,c=0;c+5<this.buffer.length;)if(255===this.buffer[c]&&240==(246&this.buffer[c+1])){a=2*(1&~this.buffer[c+1]),n=(3&this.buffer[c+3])<<11|this.buffer[c+4]<<3|(224&this.buffer[c+5])>>5;var l=1+((192&this.buffer[c+2])>>>6),p=(60&this.buffer[c+2])>>>2;if(9e4*(u=1024*(1+(3&this.buffer[c+6])))/x[(60&this.buffer[c+2])>>>2],s=c+n,this.buffer.byteLength<s)break;var d={sampleCount:u,channelCount:(1&this.buffer[c+2])<<2|(192&this.buffer[c+3])>>>6,audioObjectType:l,samplingFrequencyIndex:p,sampleSize:16,sampleRate:x[p]};if(this.codec.setMetadata(d),r.push({bsf:t,streamIndex:e.streamIndex,pts:e.pts+r.length*u*9e4/d.sampleRate,dts:e.dts+r.length*u*9e4/d.sampleRate,timestamp:Math.round(1e6*(e.pts/9e4+r.length*u/d.sampleRate)),data:t===i.a.AAC?this.buffer.subarray(c+7+a,s):this.buffer.subarray(c,s),duration:u,durationTime:Math.round(1e6*u/d.sampleRate)}),this.lastPts=r[r.length-1].pts+9e4*u/d.sampleRate,this.lastTimestamp=Math.round(1e6*this.lastPts/9e4),this.buffer.byteLength===s){this.buffer=void 0;break}this.buffer=this.buffer.subarray(s)}else c++;return r.length<=1?r.shift():r},e.prototype.flush=function(){return this.buffer&&this.buffer.byteLength>0?this.parseADTS({pts:this.lastPts,dts:this.lastPts,timestamp:this.lastTimestamp,data:new Uint8Array(0)},this.lastTargetBsf):null},e}(),D=r(22),k=r(7),I=Math.pow(2,32)-1;function M(e){return[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]}!function(e){e[e.avc1=0]="avc1",e[e.avcC=1]="avcC",e[e.hev1=2]="hev1",e[e.hvc1=3]="hvc1",e[e.hvcC=4]="hvcC",e[e.btrt=5]="btrt",e[e.pasp=6]="pasp",e[e.dinf=7]="dinf",e[e.dref=8]="dref",e[e.esds=9]="esds",e[e.ftyp=10]="ftyp",e[e.hdlr=11]="hdlr",e[e.mdat=12]="mdat",e[e.mdhd=13]="mdhd",e[e.mdia=14]="mdia",e[e.mfhd=15]="mfhd",e[e.minf=16]="minf",e[e.moof=17]="moof",e[e.moov=18]="moov",e[e.mp4a=19]="mp4a",e[e.mvex=20]="mvex",e[e.mvhd=21]="mvhd",e[e.sdtp=22]="sdtp",e[e.smhd=23]="smhd",e[e.stbl=24]="stbl",e[e.stco=25]="stco",e[e.stsc=26]="stsc",e[e.stsd=27]="stsd",e[e.stsz=28]="stsz",e[e.stts=29]="stts",e[e.ctts=30]="ctts",e[e.stss=31]="stss",e[e.styp=32]="styp",e[e.tfdt=33]="tfdt",e[e.tfhd=34]="tfhd",e[e.traf=35]="traf",e[e.trak=36]="trak",e[e.trun=37]="trun",e[e.trex=38]="trex",e[e.tkhd=39]="tkhd",e[e.vmhd=40]="vmhd"}(O||(O={}));var C=Object.keys(O).reduce((function(e,t){return isNaN(+t)&&(e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]),e}),{}),N=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),U=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),B=new Uint8Array([0,0,0,1]),F=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),j=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),G=((L={})[n.a.VIDEO]=F,L[n.a.AUDIO]=j,L),V=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),q=new Uint8Array([0,0,0,0,0,0,0,0]),H=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);function $(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=t.reduce((function(e,t){return e+t.byteLength}),0),n=new Uint8Array(i+8),o=new DataView(n.buffer,n.byteOffset,n.byteLength);o.setUint32(0,n.byteLength),n.set(e,4),i=8;for(var a=0;a<t.length;a++)n.set(t[a],i),i+=t[a].byteLength;return n}function W(){return $(C.ftyp,N,B,N,U)}function z(e,t,r){return void 0===r&&(r=!1),$(C.mdia,function(e,t){void 0===t&&(t=!1);var r=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,e.timescale>>>24&255,e.timescale>>>16&255,e.timescale>>>8&255,255&e.timescale,255&(t?0:e.duration>>>24),255&(t?0:e.duration>>>16),255&(t?0:e.duration>>>8),255&(t?0:e.duration),85,196,0,0]),i=e.codec.getMetaData();if(i.sampleRate){r[12]=i.sampleRate>>>24&255,r[13]=i.sampleRate>>>16&255,r[14]=i.sampleRate>>>8&255,r[15]=255&i.sampleRate;var n=i.sampleRate/e.timescale*e.duration;n=Math.floor(n),r[16]=255&(t?0:n>>>24),r[17]=255&(t?0:n>>>16),r[18]=255&(t?0:n>>>8),r[19]=255&(t?0:n)}return $(C.mdhd,r)}(e,r),(i=e.type,$(C.hdlr,G[i])),function(e,t){return $(C.minf,e.type===n.a.VIDEO?$(C.vmhd,H):$(C.smhd,q),$(C.dinf,$(C.dref,V)),function(e,t){if(-1===t)return $(C.stbl,te(e),$(C.stts,ee),$(C.stsc,J),$(C.stsz,Z),$(C.stco,Q));var r=[C.stbl,te(e),re(e)];return e.type===n.a.VIDEO&&(r.push(function(e){for(var t=[0,0,0,0,(4278190080&e.samples.length)>>24,(16711680&e.samples.length)>>16,(65280&e.samples.length)>>8,255&e.samples.length],r=0;r<e.samples.length;r++){var i=e.samples[r];t.push(0,0,0,1),t.push((4278190080&i.compositionTimeOffset)>>24,(16711680&i.compositionTimeOffset)>>16,(65280&i.compositionTimeOffset)>>8,255&i.compositionTimeOffset)}return $(C.ctts,new Uint8Array(t))}(e)),r.push(function(e){for(var t=[],r=0;r<e.samples.length;r++)1===e.samples[r].isKeyFrame&&t.push(r+1);for(var i=[0,0,0,0,(4278190080&t.length)>>24,(16711680&t.length)>>16,(65280&t.length)>>8,255&t.length],n=0,o=t;n<o.length;n++){var a=o[n];i.push((4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a)}return $(C.stss,new Uint8Array(i))}(e))),r.push(function(e){return $(C.stsc,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,1,(4278190080&e.samples.length)>>24,(16711680&e.samples.length)>>16,(65280&e.samples.length)>>8,255&e.samples.length,0,0,0,1]))}(e),function(e){for(var t=[0,0,0,0,0,0,0,0,(4278190080&e.samples.length)>>24,(16711680&e.samples.length)>>16,(65280&e.samples.length)>>8,255&e.samples.length],r=0,i=e.samples;r<i.length;r++){var n=i[r];t.push((4278190080&n.size)>>24,(16711680&n.size)>>16,(65280&n.size)>>8,255&n.size)}return $(C.stsz,new Uint8Array(t))}(e),function(e){return $(C.stco,new Uint8Array([0,0,0,0,0,0,0,1,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))}(t)),$.apply(null,r)}(e,t))}(e,t));var i}function K(e){var t=e.map((function(e){return function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);e.type!==n.a.VIDEO&&(t[t.length-1]=0);return $(C.trex,t)}(e)}));return $.apply(null,[C.mvex].concat(t))}function Y(e,t){void 0===t&&(t=!1);var r=0,i=e.map((function(e,i){return Math.floor(e.duration)>r&&(r=Math.floor(e.duration)),e.type,n.a.VIDEO,ie(e,i,t?-1:32+e.dataOffset,t)})),o=[C.moov,X(t?0:r,e[0].timescale)];return o=o.concat(i),t&&o.push(K(e)),$.apply(null,o)}function X(e,t){var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>>24&255,t>>>16&255,t>>>8&255,255&t,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return $(C.mvhd,r)}var Q=new Uint8Array([0,0,0,0,0,0,0,0]),J=Q,Z=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),ee=Q;function te(e){return $(C.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),e.type===n.a.VIDEO?function(e){var t=e.codec.getMetaData(),r=t.width,i=t.height,n=[M(e.codec.fourCC),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&r)>>8,255&r,(65280&i)>>8,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,121,111,117,107,117,45,107,109,117,120,45,109,112,52,45,103,101,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),$(M(e.codec.configName),e.codec.createDescription()),$(C.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))];if(t.sarRatio){var o=t.sarRatio[0],a=t.sarRatio[1];n.push($(C.pasp,new Uint8Array([o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])))}return $.apply(null,n)}(e):function(e){var t=e.codec.getMetaData();return $(M(e.codec.fourCC),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelCount)>>8,255&t.channelCount,0,16,0,0,0,0,(65280&t.sampleRate)>>8,255&t.sampleRate,0,0]),function(e){e.codec.getMetaData();var t=e.codec.createDescription();return $(C.esds,new Uint8Array([0,0,0,0,3,23+t.byteLength,0,0,0,4,15+t.byteLength,64,21,0,6,0,0,0,218,192,0,0,218,192,5,t.byteLength]),t,new Uint8Array([6,1,2]))}(e))}(e))}function re(e){for(var t=[0,0,0,0,(4278190080&e.samples.length)>>24,(16711680&e.samples.length)>>16,(65280&e.samples.length)>>8,255&e.samples.length],r=0,i=e.samples;r<i.length;r++){var n=i[r];t.push(0,0,0,1),t.push((4278190080&n.duration)>>24,(16711680&n.duration)>>16,(65280&n.duration)>>8,255&n.duration)}return $(C.stts,new Uint8Array(t))}function ie(e,t,r,i){return void 0===i&&(i=!1),e.duration=Math.floor(e.duration)||4294967295,$(C.trak,function(e,t){void 0===t&&(t=!1);var r=e.codec.getMetaData(),i=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(t?0:4278190080&e.duration)>>24,(t?0:16711680&e.duration)>>16,(t?0:65280&e.duration)>>8,255&(t?0:e.duration),0,0,0,0,0,0,0,0,0,0,0,0,e.type===n.a.AUDIO?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&r.width)>>8,255&r.width,0,0,(65280&r.height)>>8,255&r.height,0,0]);return $(C.tkhd,i)}(e,i),z(e,r,i))}function ne(e){var t=$(C.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),r=Math.floor(e.baseMediaDecodeTime/(I+1)),i=Math.floor(e.baseMediaDecodeTime%(I+1)),o=$(C.tfdt,new Uint8Array([1,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i]));if(e.type===n.a.AUDIO){var a=ae(e,92);return $(C.traf,t,o,a)}var s=function(e){for(var t=e.samples||[],r=new Uint8Array(4+t.length),i=0;i<t.length;i++){var n=t[i].flags;r[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy}return $(C.sdtp,r)}(e),u=ae(e,s.length+92);return $(C.traf,t,o,u,s)}function oe(e,t){var r=0,i=0,n=0,o=0;return e.length&&(void 0!==e[0].duration&&(r=1),void 0!==e[0].size&&(i=2),void 0!==e[0].flags&&(n=4),void 0!==e[0].compositionTimeOffset&&(o=8)),[0,0,r|i|n|o,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]}function ae(e,t){return e.type===n.a.AUDIO?function(e,t){for(var r=e.samples||[],i=oe(r,t+=20+8*r.length),n=0;n<r.length;n++){var o=r[n];i=i.concat([(4278190080&o.duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size])}return $(C.trun,new Uint8Array(i))}(e,t):function(e,t){for(var r=e.samples||[],i=oe(r,t+=20+16*r.length),n=0;n<r.length;n++){var o=r[n];i=i.concat([(4278190080&o.duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size,o.flags.isLeading<<2|o.flags.dependsOn,o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,61440&o.flags.degradationPriority,15&o.flags.degradationPriority,(4278190080&o.compositionTimeOffset)>>>24,(16711680&o.compositionTimeOffset)>>>16,(65280&o.compositionTimeOffset)>>>8,255&o.compositionTimeOffset])}return $(C.trun,new Uint8Array(i))}(e,t)}function se(e){return $(C.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))}function ue(e){e.some((function(e){return 0==e.id}))&&e.forEach((function(e){e.id+=1}))}var ce={mdat:function(e){return $(C.mdat,e)},generateMP4File:function(e,t,r){ue(e);var i=W(),n=Y(e),o=new Uint8Array(i.byteLength+n.byteLength+r);o.set(i);var a=i.byteLength;return t.forEach((function(e){o.set(e,a),a+=e.byteLength})),o.set(n,a),o},generateFMP4File:function(e,t,r,i){ue(t);var n=W(),o=Y(t,!0),a=new Uint8Array(n.byteLength+o.byteLength);a.set(n),a.set(o,n.byteLength);var s=0,u=t.map((function(t){var r=function(e,t){var r=t.map((function(e){return ne(e)}));return $.apply(null,[C.moof,se(e)].concat(r))}(e,[t]);return s+=r.byteLength,r})),c=new Uint8Array(s+i),l=0;return u.forEach((function(e,t){c.set(e,l),l+=e.byteLength,c.set(r[t],l),l+=r[t].byteLength})),[a,c]}},le=function(){return(le=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,ars.streamIndexCounter=0}return e.prototype.clean=function(){this.packetsMap=this.streams.reduce((function(e,t){return e[t.index]={packets:[],size:0,type:t.type},e}),{}),this.sequenceNumber++,delete this.output},e.prototype.reset=function(){this.clean()}streams[t];return null},e.prototype.getAllStreams=function(){return this.streams},e.prototype.setStream=function(e){this.streams=e,this.reset()},e.prototype.convertVideoPacket=function(e,t){var r=t.codec.getMetaData().naluLengthSize||4;e.units||t.codec.getParser().parse(e);for(var n=e.units.reduce((function(e,t){return e+t.data.byteLength}),0),o=new Uint8Array(n+r*e.units.length),a=0,u=0;u<e.units.length;u++){var c=e.units[u];s(o,a,c.data.byteLength,r),a+=r,o.set(c.data,a),a+=c.data.byteLength}return{pts:e.pts,dts:e.dts,timestamp:e.timestamp,duration:e.duration,durationTime:e.durationTime,key:e.key,streamIndex:e.streamIndex,data:o,bsf:i.a.AVC}},e.prototype.convertAudioPacket=function(e,t){e.units||t.codec.getParser().parse(e);var r=t.codec.getMetaData(),n=t.timescale/r.sampleRate;return e.units.map((function(t,o){return{bsf:i.a.AAC,pts:e.pts+o*r.sampleCount*n,dts:e.dts+o*r.sampleCount*n,duration:e.duration,durationTime:e.durationTime,streamIndex:e.streamIndex,data:t}}))},e.prototype.write=function(e){var t=this;this.output&&this.reset();var r=this.streams&&this.streams.filter((function(t){return t.index==e.streamIndex}))[0];if(!r)throw new Error("stream list is empty");if(r.type===n.a.VIDEO)e.bsf===i.a.ANNEX_B&&(e=this.convertVideoPacket(e,r)),this.packetsMap[e.streamIndex].packets.push(e),this.packetsMap[e.streamIndex].size+=e.data.byteLength;else{if(r.type!==n.a.AUDIO)throw new Error('stream type "'+r.type+'"not support yet!');e.bsf!==i.a.AAC?this.convertAudioPacket(e,r).forEach((function(e){t.packetsMap[e.streamIndex].packets.push(e),t.packetsMap[e.streamIndex].size+=e.data.byteLength})):(this.packetsMap[e.streamIndex].packets.push(e),this.packetsMap[e.streamIndex].size+=e.data.byteLength)}},e.prototype.resolveAudioDuration=function(){var e=this.streams&&this.streams.filter((function(e){return e.type===n.a.AUDIO}))[0];if(e){var t=e.codec.getMetaData();e.duration=0;var r=this.packetsMap[edts-t.dts||e.pts-t.pts}));for(var i=0;i<r.length;i++){var o=r[i];o.duration=t.sampleCount*e.timescale/t.sampleRate,o.durationTime=Math.round(1e6*o.duration/e.timescale),e.duration+=o.duration}}},e.prototype.resolveVideoDuration=function(){var e=this.streams&&this.streams.filter((function(e){return e.type===n.a.VIDEO}))[0];if(e){e.duration=0;var t=this.packetsMap[e.index].packets;if(t.sort((function(e,t){return e.dts-t.dts})),k.a){var r=Math.floor((t[t.length-1].dts-t[0].dts)/(t.length-1));this.packetsMap[e.index].packets.forEach((function(t){t.duration=r,t.durationTime=Math.round(1e6*r/e.timescale),e.duration+=t.duration}))}else for(var i=0;i<t.length;i++){var o=t[i],a=t[i+1],s=t[i-1];a?o.duration=a.dts-o.dts:s?o.duration=s.duration:e.codec.getMetaData().sampleDuration&&(o.duration=e.codec.getMetaData().sampleDuration),o.durationTime=Math.round(1e6*o.duration/e.timescale),e.duration+=o.duration}}},e.prototta.byteLength;return r},e.prototype.seal=function(){var e=this,t=[],r=0;Object.keys(this.packetsMap).forEach((function(t){e.packetsMap[t].packets.sort((function(e,t){return e.dts-t.dts}))}));var i=this.streams.map((function(i){var o=ce.mdat(e.assembleMediaData(i)),a=e.packetsMap[i.index].packets[0],s=0;if(i.type===n.a.VIDEO)s=a.dts;else if(i.type===n.a.AUDIO){var u=i.timescale/i.codec.getMetaData().sampleRate;s=a.dts/u}var c=le({baseMediaDecodeTime:s,dataOffset:e.separate?0:r,samples:e.generateSampleTable(i)},i);return r+=o.byteLength,t.push(o),c}));this.separate?this.output={streams:this.streams.map((function(e){return e.serialize()})),data:i.map((function(r,i){return e.generateMP4File([r],[t[i]],t[i].byteLength)}))}:this.output={streams:[this.mergeStreamsInfo()],data:[this.generateMP4File(i,t,r)]}},e.prototype.mergeStreamsInfo=function(){var e,t,r,i;return{type:n.a.MIXED,codecScodec.getCodecString()})).join(","),timescale:this.streams[0].timescale,duration:this.streams[0].duration,metadat.codec.getMetaData())}),{}),timeline:{pts:null===(e=this.streams[0].timeline)||void 0===e?void 0:e.pts,dts:null===(t=this.streams[0].timeline)||void 0===t?void 0:t.dts,maxPts:null===(r=this.streams[0].timeline)||void 0===r?void 0:r.maxPts,maxDts:null===(i=this.streams[0].timeline)||void 0===i?void 0:i.maxDts}}},e.prototype.alignPackets=function(e,t){var r=this;e.setStream(this.streams),Object.keys(this.packetsMap).forEach((function(t){var i=r.packetsMap[t];r.packetsMap[t]={size:i.size,type:i.type,packets:e.alignPackets(i.packets,i.type)}})),t&&Object.keys(this.packetsMap).forEach((function(t){var i=r.packetsMap[t];i.type===n.a.AUDIO&&0==i.packets.length&&e.addAudioFrame(i.packets)})),this.resolveVideoDuration(),this.resolveAudioDuration()},e.prototype.getOutput=function(e,t){return void 0===e&&(e={}),this.output&&e.separate===this.separate&&e.fmp4===this.fmp4||(this.resolveVideoDuration(),this.resolveAudioDuration(),this.separate=e.separate,this.fmp4=e.fmp4,t&&this.alignPackets(t,e.forceAlign),this.seal()),this.output},e.prototype.generateMP4File=function(e,t,r){return this.fmp4?ce.generateFMP4File(this.sequenceNumber,e,t,r):ce.generateMP4File(e,t,r)},e.prototype.concatMediaData=function(e){for(var t=new Uint8Array(this[e+"PacketsSize"]),r=0,i=this[e+"Packets"],n=0;n<i.length;n++)t.set(i[n].data,r),r+=i[n].data.byteLength;return t},e.prototype.assembleMediaData=function(e){for(var t=0,r=this.packetsMap[e.index].packets,i=this.sumFrameByteLengths(r),n=new Uint8Array(i),o=0;o<r.length;o++)n.set(r[o].data,t),t+=r[o].data.byteLength;return n},e.prototype.generateSampleTable=function(e){if(e.type===n.a.VIDEO)return this.packetsMap[e.index].packets.map((function(e){return function(e){var t={size:0,compositionTimeOffset:0,duration:0,isKeyFrame:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};k.a?t.compositionTimeOffset=Math.max(0,e.duration*Math.round((e.pts-e.dts)/e.duration)):t.compositionTimeOffset=Math.round(e.pts-e.dts);t.duration=e.duration,t.size=e.data.byteLength,e.key&&(t.flags.dependsOn=2,t.flags.isNonSyncSample=0,t.isKeyFrame=1);return t}(e)}));if(e.type===n.a.AUDIO){var t=e.codec.getMetaData();return this.packetsMaize:e.data.byteLength}}))}return null},e.prototype.createStream=function(e,t,r,i){var n=new Pe(e,t,r,i);return n.index=this.streamIndexCounter++,this.setStream(this.streams.concat([n])),n},e.InputVideoBitstreamFormat=i.a.AVC,e.InputAudioBitstreamFormat=i.a.AAC,e}();var de=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),he=function(e){function t(t){var r=e.call(this)||this;return r._flushed=!1,r.audioContext=t,r.firstTimestamp=null,r.remuxer=new pe,"function"!=typeof window.AudioDecoder?r.decoder=new AudioDecoder({output:function(e){r.emit(b.a.DATA,e),0==r.decoder.decodeQueueSize&&(r._flushed=!0,r.emit(b.a.FLUSHED))},error:function(e){console.error(e),r.emit(b.a.ERROR,e)}}):r.audioContext||(r.audioContext=new AudioContext),r}return de(t,e),t.prototype.configure=function(e,t,r,i){if(this.decoder)this.decoder.configure({codec:t,numberOfChannels:r.channelCount,sampleRate:r.sampleRate});else{this.meta=r;var o=new Pe(n.a.AUDIO,e,1e3,256);o.index=1,o.codec.setMetadata(r),this.remuxer.setStream([o]),this.stream=o,this.sampleCount=0}},t.prototype.decode=function(e){this._flushed=!1,this.sampleCount++,this.lastPacket=e,this.decoder?this.decoder.decode(new EncodedAudioChunk({data:e.data,timestamp:e.timestamp,type:"key"})):(null===this.firstTimestamp&&(this.firstTimestamp=e.timestamp),this.stream.index!==e.streamIndex&&(this.stream.index=e.streamIndex,this.remuxer.reset()),this.remuxer.write(e))},Object.defineProperty(t.prototype,"Flushed",{get:function(){return this._flushed},enumerable:!1,configurable:!0}),t.prototype.flush=function(){var e=this;if(!this.decoder)return new Promise((function(t,r){var i=e.remuxer.getOutput().data[0];e.audioContext.decodeAudioData(i.buffer).then((function(r){if(e.flag){var i=new AudioBuffer({sampleRate:r.sampleRate,length:r.length-e.meta.sampleCount,numberOfChannels:r.numberOfChannels});i.copyToChannel(r.getChannelData(0).slice(e.meta.sampleCount),0),i.copyToChannel(r.getChannelData(1).slice(e.meta.sampleCount),1),r=i}e.emit(b.a.DATA,{timestamp:Math.round(e.firstTimestamp),data:r,format:"f32-planar",sampleRate:r.sampleRate,channelCount:r.numberOfChannels}),e._flushed=!0,e.firstTimestamp=null,e.emit(b.a.FLUSHED),t(),e.remuxer.reset(),e.remuxer.write(e.lastPacket),e.flag=!0}))}))},t.prototype.reset=function(){},t.prototype.destroy=function(){},t}(v),fe=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],me=function(){function e(){this.id=l.a.AAC,this.fourCC="mp4a"}return e.prototype.createDescription=function(){return this.description?this.description:new Uint8Array([this.metadata.audioObjectType<<3|this.metadata.samplingFrequencyIndex>>>1,this.metadata.samplingFrequencyIndex<<7|this.metadata.channelCount<<3,6,1,2])},e.prototype.getCodecString=function(){return null!=this.metadata?this.metadata.samplingFrequencyIndex>=6?"mp4a.40.5":"mp4a.40."+this.metadata.audioObjectType:"mp4a.40.2"},e.prototype.getBitstreamFormat=function(e){return 255===e[0]&&240==(246&e[1])?i.a.ADTS:i.a.AAC},e.prototype.setMetadata=function(e){this.metadata||(this.metadata={id:this.id}),Object.assign(this.metadata,e)},e.prototype.getMetaData=function(){return this.metadata},e.prototype.getParser=function(){return this.parser||(this.parser=new P(this)),this.parser},e.prototype.getDecoder=function(){return this.decoder||(this.decoder=new he,this.metadata&&this.decoder.configure(l.a.AAC,this.getCodecString(),this.getMetaData(),this.description)),this.decoder},e.prototype.init=function(e){this.metadata||(this.metadata={id:this.id}),this.description=e;var t=new D.a(e),r={audioObjectType:t.extensionAudioObjectType||t.audioObjectType,sampleCount:1==t.frameLengthFlag?960:1024,sampleRate:t.extensionSamplingFrequency||t.samplingFrequency||fe[t.extensionSamplingFrequencyIndex||t.samplingFrequencyIndex],channelCount:t.extensionChannelConfiguration||t.channelConfiguration,samplingFrequencyIndex:t.samplingFrequencyIndex||t.extensionSamplingFrequencyIndex,asc:t};t.sbr&&fe[t.extensionSamplingFrequencyIndex]>fe[t.samplingFrequencyIndex]&&(r.sampleCount*=2),Object.assign(this.metadata,r)},e.prototype.flush=function(){},e.prototype.transBitstream=function(e,t){return e},e}(),ye=function(){function e(){}return e.discardE()),o[i]=e[a];return o},e.readPicParameterSet=function(e){var t=new p(e),r={};try{var i,n;t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readBits(7),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readBits(2),t.readBoolean()&&t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readBits(4),i=t.readBoolean(),n=t.readBoolean();var o=void 0;void 0!==(o=n&&i?0:n?3:i?2:1)&&(r.parallelismType=o)}catch(e){if(this.lastConfig)return this.lastConfig;throw e}return r},e.readVideoParameterSet=function(e){var t=new p(e),r={};try{t.readBits(12);var i=t.readBits(3);r.numTemporalLayers=r.numTemporalLayers?Math.max(r.numTemporalLayers,i+1):i}catch(e){console.log(e)}return r},e.readSequenceParameterSet=function(e){var t=new p(e),r={};try{t.skipBits(4);var i=t.readBits(3),n=t.readBits(1),o=this.profile_tier_level(!0,i,t),a=o.general_profile_space,s=o.general_profile_idc,u=o.general_profile_compatibility_flag,c=o.general_constraint_indicator_flags,l=o.general_level_idc;(r={profileSpace:a,profileTierFlag:o.general_tier_flag,profileIdc:s,compatibilityFlag:[].concat(u),constraintFlag:[].concat(c),levelIdc:l,temporalIdNested:n}).numTemporalLayers=r.numTemporalLayers?Math.max(r.numTemporalLayers,i):i,t.skipUnsignedExpGolomb();var d=t.readUnsignedExpGolomb();r.chromaFormat=d,3===d&&t.skipBits(1),r.width=t.readUnsignedExpGolomb(),r.height=t.readUnsignedExpGolomb(),t.readBoolean()&&(t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb());var h=t.readUnsignedExpGolomb(),f=t.readUnsignedExpGolomb();r.bitDepthLumaMinus8=h,r.bitDepthChromaMinus8=f,t.skipUnsignedExpGolomb();for(var m=t.readBits(1)?0:i;m<i;m++)t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb();t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.readBoolean()&&t.readBoolean()&&this.scaling_list_data(t),t.skipBits(2),t.readBoolean()&&(t.skipBits(8),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1));var y=t.readUnsignedExpGolomb(),g=[];for(m=0;m<y;m++)g.push({delta_poc_s0:[],delta_poc_s1:[],used_by_curr_pic_s0:[],used_by_curr_pic_s1:[],num_negative_pics:0,num_positive_pics:0,num_delta_pocs:0}),this.st_ref_pic_set(y,m,t,g,g[m]);if(t.readBoolean())for(m=0;m<t.readUnsignedExpGolomb();m++)t.readUnsignedByte(),t.readBits(1);if(t.skipBits(2),t.readBoolean()){var v=this.vui_parameters(i,t),b=v.aspect_ratio_info_present_flag,E=255===b?[v.sar_width,v.sar_height]:this.get_sar_ration(b);r.sarRatio=E,r.min_spatial_segmentation_idc=v.min_spatial_segmentation_idc}}catch(e){}return r},e.profile_tier_level=function(e,t,r){if(e){for(var i=r.readBits(2),n=r.readBits(1),o=r.readBits(5),a=[],s=0;s<32;s++)a.push(""+r.readBits(1));var u=[];for(s=0;s<48;s++)u.push(""+r.readBits(1));var c=r.readBits(8),l=[],p=[];for(s=0;s<t;s++)l[s]=r.readBoolean(),p[s]=r.readBoolean();t>0&&r.skipBits(2*(8-t));for(s=0;s<t;s++)l[s]&&r.skipBits(88),p[s]&&r.skipBits(8);return{general_profile_space:i,general_profile_idc:o,general_profile_compatibility_flag:a,general_constraint_indicator_flags:u,general_level_idc:c,general_tier_flag:n}}},e.scaling_list_data=function(e){for(var t=0;t<4;t++)for(var r=0;r<6;r+=3==t?3:1)if(e.readBoolean){var i=Math.min(64,4+(t<<1));t>1&&e.skipExpGolomb();for(var n=0;n<i;n++)e.skipExpGolomb()}else e.skipUnsignedExpGolomb()},e.st_ref_pic_set=function(e,t,r,i,n){var o=!1;if(0!=t&&(o=r.readBoolean()),o){var a=1;t===e&&(a=r.readUnsignedExpGolomb(),a++);for(var s=t-a,u=r.readBoolean(),c=r.readUnsignedExpGolomb(),l=u?-(c+1):c+1,p=i[s].num_delta_pocs,d=[],h=[],f=0;f<=p;f++){var m=r.readBoolean();d.push(m),d[f]?h[f]=!0:(m=r.readBoolean(),h[f]=m)}var y=i[s].num_positive_pics,g=i[s].num_negative_pics,v=void 0;v=0;for(var b=y-1;b>=0;b--){(E=i[s].delta_poc_s1[b]+l)<0&&h[g+b]&&(n.delta_poc_s0[v]=E,n.used_by_curr_pic_s0[v]=d[g+b],v++)}l<0&&h[p]&&(n.delta_poc_s0[v]=l,n.used_by_curr_pic_s0[v]=d[p],v++);for(b=0;b<g;b++){var E;(E=i[s].delta_poc_s0[b]+l)<0&&h[b]&&(n.delta_poc_s0[v]=E,n.used_by_curr_pic_s0[v]=d[b],v++)}n.num_negative_pics=v}else{n.num_negative_pics=r.readUnsignedExpGolomb(),n.num_positive_pics=r.readUnsignedExpGolomb();var _=0;for(v=0;v<n.num_negative_pics;v++){var R=r.readUnsignedExpGolomb();n.delta_poc_s0[v]=_-(R+1),_=n.delta_poc_s0[v],n.used_by_curr_pic_s0[v]=r.readBoolean()}_=0;for(v=0;v<n.num_positive_pics;v++){var S=r.readUnsignedExpGolomb();n.delta_poc_s1[v]=_+S+1,_=n.delta_poc_s1[v],n.used_by_curr_pic_s1[v]=r.readBoolean()}}n.num_delta_pocs=n.num_positive_pics+n.num_negative_pics},e.vui_parameters=function(e,t){var r,i,n,o;return t.readBoolean()&&255===(r=t.readUnsignedByte())&&(i=t.readUnsignedByte()<<8|t.readUnsignedByte(),n=t.readUnsignedByte()<<8|t.readUnsignedByte()),t.readBoolean()&&t.readBits(1),t.readBoolean()&&(t.readBits(3),t.readBits(1),t.readBoolean()&&(t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte())),t.readBoolean()&&(t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb()),t.readBits(3),t.readBoolean()&&(t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb()),t.readBoolean()&&(t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readBoolean()&&t.readUnsignedExpGolomb(),t.readBoolean()&&this.skip_hrd_parameters(e,t)),t.readBoolean()&&(t.readBits(3),o=t.readUnsignedExpGolomb(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte()),{min_spatial_segmentation_idc:void 0===o?0:o,aspect_ratio_info_present_flag:r,sar_height:n,sar_width:i}},e.get_sar_ration=function(e){var t;switch(e){case 1:t=[1,1];break;case 2:t=[12,11];break;case 3:t=[10,11];break;case 4:t=[16,11];break;case 5:t=[40,33];break;case 6:t=[24,11];break;case 7:t=[20,11];break;case 8:t=[32,11];break;case 9:t=[80,33];break;case 10:t=[18,11];break;case 11:t=[15,11];break;case 12:t=[64,33];break;case 13:t=[160,99];break;case 14:t=[4,3];break;case 15:t=[3,2];break;case 16:t=[2,1]}return t},e.skip_hrd_parameters=function(e,t){var r,i,n=!1;r=t.readBoolean(),i=t.readBoolean(),(r||i)&&((n=t.readBoolean())&&(t.readUnsignedByte(),t.readUnsignedByte(),t.readBits(3)),t.readBits(8),n&&t.readBits(4),t.readBits(8),t.readBits(7));for(var o=0;o<=e;o++){var a=!0,s=!1,u=0;t.readBoolean()||(a=t.readBoolean()),a?t.readUnsignedExpGolomb():s=t.readBoolean(),s||(u=t.readUnsignedExpGolomb()),r&&ge(u,n,t),i&&ge(u,n,t)}},e.lastConfig=null,e}();function ge(e,t,r){for(var i=0;i<=e;i++)r.readUnsignedExpGolomb(),r.readUnsignedExpGolomb(),t&&(r.readUnsignedExpGolomb(),r.readUnsignedExpGolomb()),r.readBits(1)}var ve=function(e,t){var r;switch((126&t[0])>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:this.type=c.NDR;break;case 19:case 20:this.type=c.IDR;break;case 32:this.type=c.VPS,r=ye.discardEmulationPreventionBytes(t.subarray(1)),this.config=ye.readVideoParameterSet(r.subarray(1));break;case 33:this.type=c.SPS,r=ye.discardEmulationPreventionBytes(t.subarray(1)),this.config=ye.readSequenceParameterSet(r.subarray(1));break;case 34:this.type=c.PPS,this.escapedRBSP=ye.discardEmulationPreventionBytes(t.subarray(1)),this.config=ye.readPicParameterSet(this.escapedRBSP.subarray(1));break;case 35:this.type=c.ACCESS_UNIT_DELIMITER;break;case 39:case 40:this.type=c.SEI;break;default:this.type=c.OTHER}this.pts=e.pts,this.dts=e.dts,this.data=t},be=function(){function e(e){this.hostCodec=e}return e.prototype.parse=function(e){if(e.units=[],e.size=0,e.bsf===i.a.ANNEX_B)return this.parseAnnexB(e);if(e.bsf===i.a.AVC)return this.parseAVC(e);if(e.bsf===i.a.HEVC)return this.parseHEVC(e);throw new Error("unknown bitstream format :"+e.bsf)},e.prototype.parseAnnexB=function(e){for(var t,r=e.data,i=0;i<r.byteLength-3;i++)if(1===r[i+2]){t=i+5;break}for(;t<r.byteLength;)switch(r[t]){case 0:if(0!==r[t-1]){t+=2;break}if(0!==r[t-2]){t++;break}i+3!==t-2&&this.collectNalu(e,r.subarray(i+3,t-2));do{t++}while(1!==r[t]&&t<r.length);i=t-2,t+=3;break;case 1:if(0!==r[t-1]||0!==r[t-2]){t+=3;break}i+3!==t-2&&this.collectNalu(e,r.subarray(i+3,t-2)),i=t-2,t+=3;break;default:t+=3}return this.collectNalu(e,r.subarray(i+3)),e},e.prototype.parseHEVC=function(e){var t=0,r=this.hostCodec.getMetaData(),i=r&&r.naluLengthSize||4;for(e.size=0,e.units=[];t<e.data.byteLength;){var n=a(e.data,t,i);this.collectNalu(e,e.data.subarray(t+i,t+i+n)),t+=i+n}return e},e.prototype.parseAVC=function(e){return e},e.prototype.collectNalu=function(e,t){var r=new ve(e,t);r.data&&(e.units.push(r),e.size+=r.data.byteLength,r.type===c.SPS?(this.hostCodec.setMetadata(r.config),this.hostCodec.setMetadata({sps:[r.data]})):r.type===c.PPS?(this.hostCodec.setMetadata(r.config),this.hostCodec.setMetadata({pps:[r.data]})):r.type===c.VPS?(this.hostCodec.setMetadata(r.config),this.hostCodec.setMetadata({vps:[r.data]})):r.type===c.IDR&&(e.key=!0))},e.prototype.flush=function(){return null},e}();function Ee(e){for(;"0"==e[e.length-1];)e.pop();return 0===(e=e.reverse()).length?"0":function(e){for(var t=[];e.length>8;)t.unshift(e.splice(e.length-8,8).join(""));return t.unshift(e.join("")),t.map((function(e){return Number(parseInt(e,2)).toString(16)})).join("")}(e)}var _e=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i};function Re(e,t,r){for(var i=[],n=0;n<r;n++){var o=Ae(e,t.offset,2);i.push(e.subarray(t.offset+2,t.offset+2+o)),t.offset+=o+2}return i}var Se=function(){function e(){this.id=l.a.HEVC,this.fourCC="hvc1",this.configName="hvcC"}return e.prototype.createDescription=function(){if(this.description)return this.description;if(this.metadata){var e=this.metadata,t=e.sps||[],r=e.pps||[],i=e.vps||[],n=t.length+r.length+i.length,o=[];o.push(63&(126&t[0][0])>>1),o.push(0),o.push(1),o.push(t[0].length>>8&255),o.push(255&t[0].length);for(var a=0;a<t[0].length;a++)o.push(t[0][a]);var s=[];s.push(63&(126&i[0][0])>>1),s.push(0),s.push(1),s.push(i[0].length>>8&255),s.push(255&i[0].length);for(a=0;a<i[0].length;a++)s.push(i[0][a]);var u=[];u.push(63&(126&r[0][0])>>1),u.push(0),u.push(1),u.push(r[0].length>>8&255),u.push(255&r[0].length);for(a=0;a<r[0].length;a++)u.push(r[0][a]);var c=e.compatibilityFlag,l=e.constraintFlag,p=e.parallelismType,d=e.min_spatial_segmentation_idc;return d||(p=0),new Uint8Array(_e([1,255&(e.profileIdc|e.profileSpace<<6|e.profileTierFlag<<5),parseInt(c.slice(0,8).join(""),2),parseInt(c.slice(8,16).join(""),2),parseInt(c.slice(16,24).join(""),2),parseInt(c.slice(24,32).join(""),2),parseInt(l.slice(0,8).join(""),2),parseInt(l.slice(16,24).join(""),2),parseInt(l.slice(32,40).join(""),2),parseInt(l.slice(40,48).join(""),2),parseInt(l.slice(48,56).join(""),2),parseInt(l.slice(56,64).join(""),2),e.levelIdc,240|d>>8,255&d,252|p,252|e.chromaFormat,248|e.bitDepthLumaMinus8,248|e.bitDepthChromaMinus8,0,0,0|56&e.numTemporalLayers<<3|e.temporalIdNested<<2|this.metadata.naluLengthSize-1,n],s,o,u))}return null},e.prototype.getBitstreamFormat=function(e){return 0==e[0]&&0===e[1]&&(1==e[2]||0==e[2]&&1==e[3])?i.a.ANNEX_B:i.a.HEVC be(this)),this.parser},e.prototype.getDecoder=function(){return this.decoder||(this.decoder=new _,this.metadata&&this.decoder.configure(l.a.HEVC,this.getCodecString(),this.getMetaData(),this.description)),this.decoder},e.prototype.getCodecString=function(){return function(e){var t=[n"C";default:return""}}(e.profileSpace)+e.profileIdc);var r=Ee(e.compatibilityFlag);t.push(r),t.push((e.profileTierFlag?"H":"L")+e.levelIdc);var i=Ee(e.constraintFlag);return t.push(i),t.join(".")}return"hev1"}(this.metadata)},e.prototype.getMetaData=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata||(this.metadata={id:this.id,width:0,height:0,profile:0,level:0,naluLengthSize:4}),Object.assign(this.metadata,e)},e.prototype.init=function(e){this.description=e,this.metadata||(this.metadata={id:this.id,width:0,height:0,profile:0,level:0,naluLengthSize:4}),this.metadata=Object.assign(this.metadata,{profile:e[1],profileCompatibility:e[2],level:e[12]}),this.metadata.naluLengthSize=4&e[21];e[22];var t=255*e[24]+e[25],r={offset:26};this.metadata.vps=Re(e,r,t);var i=255*e[r.offset+1]+e[r.offset+2];r.offset+=3,this.metadata.sps=Re(e,r,i);var n=255*e[r.offset+1]+e[r.offset+2];r.offset+=3,this.metadata.pps=Re(e,r,n);var o=ye.discardEmulationPreventionBytes(this.metadata.sps[0].subarray(1)),a=ye.readSequenceParameterSet(o.subarray(1));Object.assign(this.metadata,a)},e.prototype.transBitstream=function(e,t){if(t===i.a.HEVC){var r=this.metadata.naluLengthSize||4;e.units||this.getParser().parse(e);for(var n=e.units.reduce((function(e,t){return e+t.data.byteLength}),0),o=new Uint8Array(n+r*e.units.length),a=0,u=0;u<e.units.length;u++){var c=e.units[u];s(o,a,c.data.byteLength,r),a+=r,o.set(c.data,a),a+=c.data.byteLength}return{pts:e.pts,dts:e.dts,duration:e.duration,timestamp:e.timestamp,key:e.key,streamIndex:e.streamIndex,data:o,bsf:i.a.HEVC}}i.a.ANNEX_B},e}();function Ae(e,t,r){for(var i=0,n=r;n>0;n--)i+=e[t+r-n]<<8*(n-1);return i}var Te=[],we=function(){function e(){}return e.from=function(e){var t=Te.filter((function(t){var r=t[0],i=t[1];return e===r||i&&i.test(e)}))[0];if(t)return new t[2];throw new Error("Codec["+e+"] not found!")},e.registerCodec=function(e,t,r){Te.push([t,r,e])},e}(),Le=we;we.registerCodec(T,l.a.AVC,/^avc1\./),we.registerCodec(me,l.a.AAC,/^mp4a\./),we.registerCodec(Se,l.a.HEVC,/^(hvc1|hev1)\./);var Oe,xe=0,Pe=function(){function e(e,t,r,i){this.type=e,this.codec=Le.from(t),this.timescale=r,this.id=void 0!==i?i:256+xe++,this.duration=0,this.packetsCount=0,this.timeline={pts:-1,dts:-1,maxPts:0,maxDts:0}}return e.prototype.serialize=function(){return{type:this.type,codecString:this.codec.getCodecString(),duration:this.duration,timescale:this.timescale,timeline:this.timeline,metadata:this.codec.getMetaData()}},Object.defineProperty(e.prototype,"encryption",{get:function(){return this._encryption},set:function(e){this._encryption=e},enumerable:!1,configurable:!0}),{this.codec=Le.fro0,this.prevPacket=null},e.prototype.getBitstreamFormat=function(e){return this.bsf||(this.bsf=this.codec.getBitstreamFormat(e)),this.bsf},e.prototype.updatePacket=function(e){if(this.packetsCount++,void 0===e.streamIndex&&(e.streamIndex=this.index),this.prevPacket){var t=e.dts-this.prevPacket.dts;e.duration=t,e.durationTime=Math.round(1e6*t/this.timescale),this.prevPacket.duration!==t&&(this.prevPacket.duration=t,this.prevPacket.durationTime=Math.round(1e6*t/this.timescale))}if(this.prevPacket=e,void 0===this.index)throw new Error("stream must be in a demuxer.streams or remuxer.streams");-1===this.timeline.pts&&(this.timeline.pts=e.pts),-1===this.timeline.dts&&(this.timeline.dts=e.dts),e.pts>this.timeline.maxPts&&(this.timeline.maxPts=e.pts),e.dts>this.timeline.maxDts&&(this.timeline.maxDts=e.dts)},e}(),De=function(){function e(){}return e.parsePAT=function(e,t,r){return r&&(t+=e[t]+1),{section_number:e[t+7],last_section_number:e[t+8],pmtPid:(31&e[t+10])<<8|e[t+11]}.pmtPid},e.parsePMT=function(e,t,r){var i,o;if(r&&(t+=e[t]+1),!(1&e[t+5]))throw Error;var a={timedMetadata:{}};for(i=3+((15&e[t+1])<<8|e[t+2])-4,o=12+((15&e[t+10])<<8|e[t+11]);o<i;){var s=e[t+o],u=this.getStreamInfo(s),c=(31&e[t+o+1])<<8|e[t+o+2];if(u===n.a.VIDEO)a.video=+c,a.videoStreamType=s;else if(u===n.a.AUDIO)a.audio=+c,a.audioStreamType=s;else{if(u!==n.a.METADATA)throw Error("[TSParsedPacket]unknown stream type:"+s);a.timedMetadata[c]=s}o+=5+((15&e[t+o+3])<<8|e[t+o+4])}return a},e.getStreamInfo=function(e){var t;switch(e){case 3:case 4:case 17:case 15:t=n.a.AUDIO;break;case 27:case 28:case 36:t=n.a.VIDEO;break;case 21:t=n.a.METADATA;break;default:t=n.a.UNKNOWN}return t},e.assembleESData=function(e){var t,r={pts:0,dts:0,timestamp:0,data:null,streamIndex:0};return 192&(t=e[7])&&(r.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,r.pts*=4,r.pts+=(6&e[13])>>>1,r.dts=r.pts,64&t&&(r.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,r.dts*=4,r.dts+=(6&e[18])>>>1)),r.data=e.subarray(9+e[8]),r},e.StreamType2CodecID={15:l.a.AAC,27:l.a.AVC,36:l.a.Hist=[],this.initData()}return e.probe=function(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),!!u(e)&&function(e){var t=Math.min(1e3,e.length-564),r=0;for(;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1}(e)>=0},e.prototype.initData=function(){this.Flushed=!1,this.streams=[],this.pmtFinding=!1,this.packetsWaitingForPmt=[],this.programMapTable=void 0,this.lastPesType=null,this.clean()},e.prototype.createStream=function(e,t,r){if(!this.streams.filter((function(t){return t.type===e}))[0]){var i=new Pe(e,t,9e4,r);i.NeedParse=!0,i.index=this.streams.length,this.streams.push(i)}},e.prototype.write=function(e){this.data=e,this.streams.forEach((function(e){return e.reset()})),this.Flushed=!1},e.prototype.startDemux=function(){var e;for(0!=this.remainBuffer.byteLength?((e=new Uint8Array(this.data.byteLength+this.remainBuffer.byteLength)).set(this.remainBuffer),e.set(this.data,this.remainBuffer.byteLength),this.remainBuffer=new Uint8Array(0),this.data=e):e=this.data;this.endIndex<e.byteLength&&!this.pmtFinding&&0===this.packetList.length;)71!==e[this.startIndex]||71!==e[this.endIndex]?(this.startIndex++,this.endIndex++):(this.parsePacket(e.subarray(this.startIndex,this.endIndex)),this.startIndex+=188,this.endIndex+=188);this.startIndex<e.byteLength&&this.endIndex>=e.byteLength&&(this.remainBuffer=new Uint8Array(e.byteLength-this.startIndex),this.remainBuffer.set(e.subarray(this.startIndex),0),this.data=new Uint8Array(0),this.startIndex=0,this.endIndex=188)},e.prototype.parsePacket=function(e){var t=4,r=!!(64&e[1]),i=31&e[1];if(i<<=8,i|=e[2],(48&e[3])>>>4>1&&(t+=e[t]+1),0===i)this.pmtPid=De.parsePAT(e,t,r);else if(i===this.pmtPid){0===this.streams.length&&(this.pmtFinding=!0);var o=this.programMapTable=De.parsePMT(e,t,r);for(o&&null!=o.video&&this.createStream(n.a.VIDEO,De.StreamType2CodecID[o.videoStreamType],o.video),o&&null!=o.audio&&this.createStream(n.a.AUDIO,De.StreamType2CodecID[o.audioStreamType],o.audio);this.packetsWaitingForPmt.length;)this.processPes.apply(this,this.packetsWaitingForPmt.shift())}else void 0===this.programMapTable?this.packetsWaitingForPmt.push([e,t,i,r]):this.processPes(e,t,i,r)},e.prototype.processPes=function(e,t,r,i){var n={PUSI:i};r===this.programMapTable.video?n.streamType=this.programMapTable.videoStreamType:r===this.programMapTable.audio?n.streamType=this.programMapTable.audioStreamType:n.streamType=this.programMapTable.timedMetadata[r],n.data=e.subarray(t),this.writePes(n)},e.prototype.writePes=function(e){var t=De.getStreamInfo(e.streamType),r=this.streamBuffer[t];r&&(e.PUSI&&(this.writePacket(r,t,!0),this.lastPesType=t),r.data.push(e),r.size+=e.data.byteLength)},e.prototype.writePacket=function(e,t,r,o){var a;if(e.data.length&&!(e.size<9)){var s=function(e,t){for(var r=new Uint8Array(t),i=0,n=0;n<e.length;n++)r.set(e[n],i),i+=e[n].byteLength;return r}(e.data.map((function(e){return e.data})),e.size),u=De.assembleESData(s);a=t===n.a.VIDEO||this.getPacketLength(s)<=e.size,(r||a)&&(e.size=0,e.data=[]),t===n.a.VIDEO?u.bsf=i.a.ANNEX_B:u.bsf=i.a.ADTS;var c=this.streams&&this.streams.filter((function(e){return e.type===t}))[0];c&&(u.streamIndex=c.index,u.timestamp=Math.round(1e6*u.pts/c.timescale),u.isLast=o,a&&this.packetList.push(u))}},e.prototype.getPacketLength=function(e){return 6+(e[4]<<8|e[5])},e.prototype.flushPacket=function(){var e=this;this.lastPesType=null,Object.keys(this.streamBuffer).forEach((function(t){e.writePacket(e.streamBuffer[t],t,!1,!0)}))},e.prototype.findAllStream=function(){return this.startDemux(),this.pmtFinding=!1,this.streams},e.prototype.findStream=function(e){return this.streams&&this.streams.filter((function(t){return t.type===e}))[0]},e.prototype.readPacket=function(){return 0===this.packetList.length&&this.startDemux(),this.packetList.shift()},e.prototype.seek=function(e,t){throw new Error("Method not implemented.")},e.prototype.reset=function(){this.initData()},e.prototype.clean=function(){var e;this.remainBuffer=new Uint8Array(0),this.streamBuffer=((e={})[n.a.VIDEO]={data:[],size:0},e[n.a.AUDIO]={data:[],size:0},e[n.a.METADATA]={data:[],size:0},e),this.pmtPid=void 0,this.packetList=[],this.endIndex=188,this.startIndex=0},e.prototype.flush=function(){var e;188===this.remainBuffer.byteLength&&71===this.remainBuffer[0]&&this.parsePacket(this.remainBuffer),this.flushPacket(),this.remainBuffer=new Uint8Array(0),this.streamBuffer=((e={})[n.a.VIDEO]={data:[],size:0},e[n.a.AUDIO]={data:[],size:0},e[n.a.METADATA]={data:[],size:0},e),this.Flushed=!0},e}();!function(e){e[e.HEAD=0]="HEAD",e[e.BODY=1]="BODY"}(Oe||(Oe={}));var Ie=function(){function e(){}retrn!1;return!0}return!1},e.decode=function(t){for(var r=[],i=t,n=0,o=t.length;n<o;)if(i[n]<128)r.push(String.fromCharCode(i[n])),++n;else{if(i[n]<192);else if(i[n]<224){if(e.checkContinuation(i,n,1))if((a=(31&i[n])<<6|63&i[n+1])>=128){r.push(String.fromCharCode(65535&a)),n+=2;continue}}else if(i[n]<240){if(e.checkContinuation(i,n,2))if((a=(15&i[n])<<12|(63&i[n+1])<<6|63&i[n+2])>=2048&&55296!=(63488&a)){r.push(String.fromCharCode(65535&a)),n+=3;continue}}else if(i[n]<248){var a;if(e.checkContinuation(i,n,3))if((a=(7&i[n])<<18|(63&i[n+1])<<12|(63&i[n+2])<<6|63&i[n+3])>65536&&a<1114112){a-=65536,r.push(String.fromCharCode(a>>>10|55296)),r.push(String.fromCharCode(1023&a|56320)),n+=4;continue}}r.push(String.fromCharCode(65533)),++n}return r.join("")},e}(),Me=function(){function e(){}return e.parseScriptData=function(t,r,i){var n={};try{var o=e.parseValue(t,r,i),a=e.parseValue(t,r+o.size,i-o.size);n[o.data]=a.data}catch(e){console.error("AMF",e.toString())}return n},e.parseObject=function(t,r,i){i<3&&console.log("Data not enough when parse ScriptDataObject");var n=e.parseString(t,r,i),o=e.parseValue(t,r+n.size,i-n.size),a=o.objectEnd;return{data:{name:n.data,value:o.data},size:n.size+o.size,objectEnd:a}},e.parseString=function(e,t,r){r<2&&console.log("Data not enough when parse String");var i,n=new DataView(e.buffer,t,r).getUint16(0,!k.b);if(n>0){var o=e.subarray(t+2,t+2+n);i=Ie.decode(o)}else i="";return{data:i,size:2+n}},e.parseDate=function(e,t,r){r<10&&console.log("Data size invalid when parse Date");var i=new DataView(e.buffer,t,r),n=i.getFloat64(0,!k.b),o=i.getInt16(8,!k.b);return{data:new Date(n+=60*o*1e3),size:10}},e.parseValue=function(t,r,i){i<1&&console.log("Data not enough when parse Value");var n,o=new DataView(t.buffer,r,i),a=1,s=o.getUint8(0),u=!1;try{switch(s){case 0:n=o.getFloat64(1,!k.b),a+=8;break;case 1:n=!!o.getUint8(1),a+=1;break;case 2:var c=e.parseString(t,r+1,i-1);n=c.data,a+=c.size;break;case 3:n={};var l=0;for(9==(16777215&o.getUint32(i-4,!k.b))&&(l=3);a<i-4;){var p=e.parseObject(t,r+a,i-a-l);if(p.objectEnd)break;n[p.data.name]=p.data.value,a+=p.size}if(a<=i-3)9===(16777215&o.getUint32(a-1,!k.b))&&(a+=3);break;case 8:n={},a+=4;l=0;for(9==(16777215&o.getUint32(i-4,!k.b))&&(l=3);a<i-8;){var d=e.parseObject(t,r+a,i-a-l);if(d.objectEnd)break;n[d.data.name]=d.data.value,a+=d.size}if(a<=i-3)9===(16777215&o.getUint32(a-1,!k.b))&&(a+=3);break;case 9:n=void 0,a=1,u=!0;break;case 10:n=[];var h=o.getUint32(1,!k.b);a+=4;for(var f=0;f<h;f++){var m=e.parseValue(t,r+a,i-a);n.push(m.data),a+=m.size}break;case 11:var y=e.parseDate(t,r+1,i-1);n=y.data,a+=y.size;break;case 12:var g=e.parseString(t,r+1,i-1);n=g.data,a+=g.size;break;default:a=i,console.warn("AMF","Unsupported AMF value type "+s)}}catch(e){console.error("AMF",e.toString())}return{data:n,si]<<16|e[t+2]<<8|e[t+3]}var Ne=function(){function e(){this.packetList=[],this.timescale=1e3,this.streams=[],this.streamId=0,this.packetList=[],this.packetsWaiting=[],this.startIndex=0,this.remainBuffer=new Uint8Array(0),this.state=Oe.HEAD,this.metaFinding=!1,this.streamFinding=!1;this.streamMetaData={meta:{data:{hasAudio:!1,hasVideo:!1,duration:0},complete:!1,exist:!1},audio:{data:{},complete:!1,exist:!1},video:{data:{},complete:!1,exist:!1}}}return e.probe=function(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),!!u(e)&&function(e){var t=!0;70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||(t=!1);Ce(e,5)<9&&(t=!1);return t}(e)},e.prototype.createStream=function(e,t){var r=this.streams.filter((function(t){return t.type===e}))[0];if(r)return r;var i=this.streamId,n=new Pe(e,t,this.timescale,i);return this.streamId++,n.index=this.streams.length,this.streams.push(n),n},e.prototype.write=function(e){this.data=e,this.streams.forEach((function(e){return e.reset()})),this.Flushed=!1},e.prototype.startDemux=function(){var t;if(0!=this.remainBuffer.byteLength?((t=new Uint8Array(this.data.byteLength+this.remainBuffer.byteLength)).set(this.remainBuffer),t.set(this.data,this.remainBuffer.byteLength),this.remainBuffer=new Uint8Array(0),this.data=t):t=this.data,this.state===Oe.HEAD&&t.byteLength>13){var r=e.findHead(t);if(r.match){this.state=Oe.BODY,this.startIndex=r.offset,this.startIndex+=4;var i=this.streamMetaData.meta.data;r.hasVideo&&(i.hasVideo=r.hasVideo,this.streamMetaData.video.exist=r.hasVideo),r.hasAudio&&(i.hasAudio=r.hasAudio,this.streamMetaData.audio.exist=r.hasAudio)}else this.startIndex=t.byteLength}if(this.state===Oe.BODY)for(;this.startIndex<t.byteLength&&!this.metaFinding&&0===this.packetList.length;){var n=new DataView(t.buffer,this.startIndex);if(this.startIndex+11+4>t.byteLength)break;var o=n.getUint8(0),a=16777215&n.getUint32(0,!k.b);if(this.startIndex+11+a+4>t.byteLength)break;if(8===o||9===o||18===o){var s=n.getUint8(4),u=n.getUint8(5),c=n.getUint8(6)|u<<8|s<<16|n.getUint8(7)<<24;0!==(16777215&n.getUint32(7,!k.b))&&console.warn("Meet tag which has StreamID != 0!");var l=this.startIndex+11;switch(o){case 8:this.parseAudioData(t,l,a,c);break;case 9:this.parseVideoData(t,l,a,c);break;case 18:this.parseScriptData(t,l,a)}var p=n.getUint32(11+a,!k.b);p!==11+a&&console.warn("Invalid PrevTagSize "+p),this.startIndex+=11+a+4}else console.warn("Unsupported tag type "+o+", skipped"),this.startIndex+=11+a+4}this.startIndex<=t.byteLength&&(this.remainBuffer=new Uint8Array(t.byteLength-this.startIndex),this.remainBuffer.set(t.subarray(this.startIndex),0),this.data=new Uint8Array(0),this.startIndex=0)},e.prototype.parseScriptData=function(e,t,r){var i=this,n=Me.parseScriptData(e,t,r);if(n.hasOwnProperty("onMetaData")){var o=n.onMetaData,a=this.streamMetaData.meta.data,s=this.streamMetaData.audio.data,u=this.streamMetaData.video.data;if(["hasAudio","hasVideo"].forEach((function(e){if("boolean"==typeof o[e]){a[e]=o[e];var t="hasAudio"===e?"audio":"video";i.streamMetaData[t].exist=o[e]}})),"number"==typeof o.duration){var c=Math.floor(o.duration*this.timescale);a.duration=c}if("object"==typeof o.keyframes){var l=o.keyframes;a.keyframesIndex=this.parseKeyframesIndex(l),u.keyframes=a.keyframesIndex,o.keyframes=null}switch(this.streamMetaData.meta.exist=!0,this.streamMetaData.meta.complete=!0,o.audiodatarate,"number"==typeof o.audiosamplerate&&(s.sampleRate=o.audiosamplerate),"number"==typeof o.audiosamplesize&&(s.sampleSize=o.audiosamplesize),o.audiochannels&&(s.channelCount=o.audiochannels),o.audiosamplerate){case 44100:s.samplingFrequencyIndex=4;break;case 22050:s.samplingFrequencyIndex=7;break;case 11025:s.samplingFrequencyIndex=10}return["wipeof o[e]&&(u[e]=o[e])})),"number"==typeof o.framerate&&(u.frameRate=o.framerate,o.framerate>0?u.sampleDuration=this.timescale/o.framerate:u.sampleDuration=this.timescale/23.976),this.checkMetaFinding(),a}},e.prototype.parseKeyframesIndex=function(e){for(var t=[],r=[],i=1;i<e.times.length;i++)if(e.filepositions[i]){var n=Math.floor(1e3*e.times[i]);t.push(n),r.push(e.filepositions[i])}return{times:t,filePositions:r}},e.prototype.parseAudioData=function(e,t,r,i){if(r<=1)console.log("Flv: Invalid audio packet, missing SoundData payload!");else{var o=new DataView(e.buffer,t,r).getUint8(0),a=o>>>4;if(this.setAudioMeta(o),10===a){var s=e.subarray(t+1,t+r);if(s.byteLength<=1)return void console.warn("Flv: Invalid AAC packet, missing AACPacketType or/and Data!");var u=s[0];if(0===u){var c=this.createStream(n.a.AUDIO,l.a.AAC);c.codec.setMetadata(this.streamMetaData.audio.data);var p=this.streamMetaData.meta.data;p&&p.duration&&(c.duration=p.duration),c.codec.init(s.subarray(1)),this.streamMetaData.audio.complete=!0,this.checkMetaFinding()}else if(1===u){var d=this.findStream(n.a.AUDIO),h={data:s.subarray(1),streamIndex:d.index,dts:i,pts:i,timestamp:Math.round(1e6*i/d.timescale),bsf:d.getBitstreamFormat(s.subarray(1))};this.getMetaFinding()?(h.isLast=!1,this.packetList.push(h)):this.packetsWaiting.push(h)}else console.log("FLV: Unsupported AAC data type "+s[0])}}},e.prototype.setAudioMeta=function(e){var t=0,r=(12&e)>>>2;if(r>=0&&r<=4){t=[5500,11025,22050,44100,48e3][r];var i=(2&e)>>>1,n=1&e,o=this.streamMetaData.audio.data;o.sampleSize=1===i?16:8,o.sampleRate=t,o.channelCount=0===n?1:2}else console.error("Flv: Invalid audio sample rate idx: "+r)},e.prototype.parseVideoData=function(e,t,r,i){if(!(r<=1)){var o=e[t],a=(240&o)>>>4,s=15&o,u=e.subarray(t+1,t+r);if(7===s||12===s){if(u.byteLength<4)return;var c=u[0],p=u.subarray(4);if(0===c){var d=7===s?l.a.AVC:l.a.HEVC,h=this.createStream(n.a.VIDEO,d);h.codec.setMetadata(this.streamMetaData.video.data),h.codec.init(p);var f=this.streamMetaData.meta.data;f&&f.duration&&(h.duration=f.duration),this.streamMetaData.video.complete=!0,this.checkMetaFinding()}else if(1===c){var m=(16777215&new DataView(u.buffer,u.byteOffset,u.byteLength).getUint32(0,!k.b))<<8>>8,y=1===a,g=this.findStream(n.a.VIDEO),v={key:y,streamIndex:g.index,data:p,dts:i,pts:i+m,timestamp:Math.round(1e6*(i+m)/g.timescale),bsf:g.getBitstreamFormat(p)};this.getMetaFinding()?(v.isLast=!1,this.packetList.push(v)):this.packetsWaiting.push(v)}}}},e.findHead=function(e){var t=e,r={match:!1,offset:0,hasAudio:!1,hasVideo:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return r;var i=(4&t[4])>>>2!=0,n=0!=(1&t[4]),o=Ce(t,5);return o<9?r:{match:!0,offset:o,hasAudio:i,hasVideo:n}},e.prothis.getMetaFinding())},e.prototype.getMetaFinding=function(){var e=!0;for(var t in this.streamMetaData)if(this.streamMetaData.hasOwnProperty(t)){var r=this.streamMetaData[t];if(!r.complete&&r.exist){e=!1;break}}return e},e.prototype.findAllStream=function(){return this.streamFinding=!0,this.startDemux(),this.metaFinding=!1,this.streams},e.prototype.findStream=function(e){return this.streams&&this.streams.filter((function(t){return t.type===e}))[0]},e.prototype.readPacket=function(){return this.streamFinding=!1,0===this.packetList.length&&this.startDemux(),this.packetList.shhod not implemented.")},e.prototype.reset=function(){this.streams=[],this.streamId=0,this.packetList=[],this.packetsWaiting=[],this.startIndex=0,this.remainBuffer=new Uint8Array(0),this.state=Oe.HEAD,this.metaFinding=!1;this.streamMetaData={meta:{data:{hasAudio:!1,hasVideo:!1,duration:0},complete:!1,exist:!0},audio:{data:{},complete:!1,exist:!1},video:{data:{},complete:!1,exist:!1}}},e.prototype.clean=function(){this.packetList=[],this.packetsWaiting=[],this.startIndex=0,this.remainBuffer=new Uint8Array(0);this.streamMetaData={meta:{data:{hasAudio:!1,hasVideo:!1,duration:0},complete:!1,exist:!0},audio:{data:{},complete:!1,exist:!1},video:{data:{},complete:!1,exist:!1}}},e.prototype.flush=function(){this.remainBuffer=new Uint8Array(0),this.Flushed=!0},e}();var Ue,Be,Fe=function(){function e(){}return e.install=function(){var e,t,r,i;"function"!=typeof Object.assign&&Object.defineProperty&&(r[o]=n[o])}return r},writable:!0,configurable:!0}),Object.setPrototypeOfrn r.prototype=t,new r},Object.values=Object.values||function(e){if(e!==Object(e))throw new TypeError("Object.values called on a non-object");var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(e[t]);return r},Object.keys=Object.keys||(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),i=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable"&o.push(c",e.UNKNOWN="unknown"}(Ue||(Ue={})),function(e){e.avc1="h264",e.hvc1="h265",e.hev1="h265",e.UNKNOWN="unknown"}(Be||(Be={}));var je,Ge,Ve=function(){return(Ve=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function qe(e,t,r){if(r||2===arguments.length)for(var i,n=0,o=t.length;n<o;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.IF="__IF__",e.ELSE="__ELSE__",e.ENDIF="__ENDIF__",e.LOOP="__LOOP__",e.ENDLOOP="__ENDLOOP__",e.ASSIGNMENT="__ASSIGNMENT__",e.READ="__READ__",e.BINARY="__BINARY__",e.UPDATE="__UPDATE__",e.DECLARATION="__DECLARATION__",e.IDENTIFIER="__IDENTIFIER__",e.THREE="_ODEL="%",e.BIT_AND="&"}(Ge||(Ge={}));var He=je.IDENTIFIER,$e=je.IF,We=je.ELSE,ze=je.ENDIF,Ke=je.LOOP,Ye=je.ENDLOOP,Xe=je.ASSIGNMENT,Qe=je.READ,Je=je.BINARY,Ze=je.DECLARATION,et=je.UPDATE,tt=je.THREE,rt=Ge.TIMES,it=Ge.UNEQUAL,nt=Ge.DIVISION,ot=Ge.EQUAL,at=Ge.AND,st=Ge.OR,ut=Ge.UNARY_DOUBLE_PLUS,ct=Ge.PLUS,lt=Ge.MINUS,pt=Ge.LESS_EQUAL,dt=Ge.MODEL,ht=Ge.MORE,ft=Ge.BIT_AND,mt=function(e){return e===$e||e===Ke},yt=function(e){return e===We},gt=function(){function e(e,t){this.contextStack=[],this.reader=e,this.result={},this.program=[],this.ifStatementMap={},this.loopStatementMap={},this.isProgrammeScanned=!1,this.isProgramRan=!1,this.globalContext=t||[]}return e.prototype.setProgram=function(e){this.contextStack=this.globalContext,this.result={},this.ifStatementMap={},this.loopStatementMap={},this.program=[];for(var t=0,r=e;t<r.length;t++){var i=r[t];this.program.push(qe([],i,!0))}this.isProgrammeScanned=!1,this.isProgramRan=!1},e.prototype.setReader=function(e){this.reader=e,this.contextStack=[],this.result={}},e.prototype.getResult=function(){return this.run(),Ve({},this.result)},e.prototype.getContextValue=function(e){for(var t=e[1],r=this.contextStack.length-1;r>=0&&!this.contextStack[r].hasOwnProperty(t);)r--;if(-1!==r)return this.contextStack[r][t];var i=this.result[t];return Array.isArray(i)?i[i.length-1]:i},e.prototype.getContext=function(e){for(var t=e[1],r=this.contextStack.length-1;r>=0&&!this.contextStack[r].hasOwnProperty(t);)r--;return-1!==r?this.contextStack[r]:this.result.hasOwnProperty(t)?this.result:void 0},e.prototype.run=function(){this.isProgrammeScanned||(this.scanProgram(),this.isProgrammeScanned=!0),this.isProgramRan||(this.walkProgram(this.program),this.isProgramRan=!0)},e.prototype.scanProgram=function(){for(var e,t,r=[],i={},n={},o={},a=0;a<this.program.length;a++){var s=this.program[a];if(s.push(a),(t=s[0])===ze||t===Ye){var u=r.pop(),c=u[u.length-1],l=s[s.length-1];if(i[c]=[c,l],u[0]===$e){var p=[];p.push(u);for(var d=c+1;d<l;d++){if(i[d])d=i[d][1];yt(this.program[d][0])&&p.push(this.program[d])}p.push(s),n[c]=p}if(u[0]===Ke){var h=[];h.push(u),h.push(s),o[c]=h}}else mt(s[0])&&r.push(s)}e=[n,o],this.ifStatementMap=e[0],this.loopStatementMap=e[1]},e.prototype.walkProgram=function(e){this.contextStack.push({});for(var t=0;t<e.length;t++){var r=e[t];switch(r[0]){case Qe:this.solveReadNode(r);break;case $e:var i=this.ifStatementMap[r[r.length-1]];if(void 0===i)throw new Error("didn't scan if statement.");var n=i[0],o=i[i.length-1];this.solveIfBlock(i),t+=o[o.length-1]-n[n.length-1];break;case Ke:var a=this.loopStatementMap[r[r.length-1]];if(void 0===a)throw new Error("didn't scan loop statement.");var s=a[0],u=a[1];this.contextStack.push({}),this.solveLoopBlock(a),this.contextStack.pop(),t+=u[u.length-1]-s[s.length-1];break;case Je:case He:case Xe:case et:case Ze:this.solveExpression(r);break;default:console.log("unknown statement.")}}this.contextStack.pop()},e.prototype.solveExpression=function(e){if(!Array.isArray(e))return e;var t=e[0];switch(t){case Je:return this.solveBinaryNode(e);case He:return this.getContextValue(e);case et:return this.solveUpdateNode(e);case Ze:return void this.solveDeclarationNode(e);case tt:return this.solveThreeNode(e);case Xe:return void this.solveAssignmentNode(e);default:throw new Error("cant get ".concat(t," statement value."))}},e.prototype.solveDeclarationNode=function(e){this.contextStack[this.contextStack.length-1][e[1]]=this.solveExpression(e[2])},e.prototype.solveThreeNode=function(e){var t=e[1],r=e[2],i=e[3];return this.solveExpression(t)?this.solveExpression(r):this.solveExpression(i)},e.prototype.solveBinaryNode=function(e){var t=this.solveExpression(e[2]),r=this.solveExpression(e[3]);switch(e[1]){case ot:return t==r;case it:return t!=r;case at:return t&&r;case st:return t||r;case nt:return t/r;case ct:return t+r;case lt:return t-r;case rt:return t*r;case pt:return t<=r;case dt:return t%r;case ht:return t>r;case ft:return t&r;default:throw new Error("cant solve ".concat(e[1]," operator."))}},e.prototype.solveUpdateNode=function(e){var t=e[2],r=e[1],i=e[3],n=this.getContext(t);if(!n)throw new Error("cant find context.");switch(r){case ut:return i?++n[t[1]]:n[t[1]]++;default:throw new Error("cant solve ".concat(r," operator."))}},e.prototype.solveAssignmentNode=function(e){var t=e[1],r=this.solveExpression(e[2]),i=this.getContext(t);if(!i)throw new Error("cant find context.");i[t[1]]=r},e.prototype.solveReadNode=function(e){for(var t,r=this,i=e[1],n=[],o=0,a=e.slice(2,e.length-1);o<a.length;o++){var s=a[o];n.push(this.solveExpression(s))}var u=(t=this.readr.solveExpression(e):e})));this.result.hasOwnProperty(i)?Array.isArray(this.result[i])?this.result[i].push(u):this.result[i]=[this.result[i],u]:this.result[i]=u},e.prototype.solveIfBlock=function(e){for(var t=0;t<e.length-1;t++){var r=e[t];if(2==r.length||this.solveExpression(r[1])){var i=e[t],n=e[t+1],o=i[i.length-1],a=n[n.length-1];this.walkProgram(this.program.slice(o+1,a));break}}},e.prototype.solveLoopBlock=function(e){var t=e[0],r=e[1],i=t[t.length-1],n=r[r.length-1],o=t[1],a=t[2],s=t[3];if("number"==typeof o)for(var u=this.solveExpression(o);u<=this.solveExpression(a);u+=this.solveExpression(s))this.walkProgram(this.program.slice(i+1,n));else for(this.solveExpression(o);this.solveExpression(a);)this.walkProgram(this.program.slice(i+1,n)),this.solveExpression(s)},e}(),vt=je.IDENTIFIER,bt=je.IF,Et=je.ELSE,_t=je.ENDIF,Rt=je.LOOP,St=je.ENDLOOP,At=je.READ,Tt=je.BINARY,wt=Ge.EQUAL,Lt=Ge.BIT_AND,Ot={moov:[],moof:[],trak:[],traf:[],mdia:[],minf:[],stbl:[],box:[[At,"size","uint",32],[At,"boxtype","string",32],[bt,[Tt,wt,[vt,"size"],1]],[At,"largesize","uint",64],[Et,[Tt,wt,[vt,"size"],0]],[_t],[bt,[Tt,wt,"boxtype","uuid"]],[At,"extendType","uint",8,16],[_t]],ftyp:[[At,"major_brand","uint",32],[At,"minor_version","uint",32],[At,"compatible_brands","uint",32,"BoxEnd"]],mvhd:[[At,"version","uint",8],[At,"flags","uint",24],[bt,[Tt,wt,[vt,"version"],1]],[At,"create_time","uint",64],[At,"modification_time","uint",64],[At,"timescale","uint",32],[At,"duration","uint",64],[Et],[At,"create_time","uint",32],[At,"modification_time","uint",32],[At,"timescale","uint",32],[At,"duration","uint",32],[_t],[At,"rate","uint",32],[At,"volume","uint",16],[At,"reversed","uint",16],[At,"reversed","uint",32,2],[At,"matrix","uint",32,9],[At,"pre_defined","uint",32,6],[At,"next_track","uint",32]],tkhd:[[At,"version","uint",8],[At,"flags","uint",24],[bt,[Tt,wt,[vt,"version"],1]],[At,"create_time","uint",64],[At,"modification_time","uint",64],[At,"track_ID","uint",32],[At,"reversed","uint",32],[At,"duration","uint",64],[Et],[At,"create_time","uint",32],[At,"modification_time","uint",32],[At,"track_ID","uint",32],[At,"reversed","uint",32],[At,"duration","uint",32],[_t],[At,"reversed","uint",32,2],[At,"layer","int",16],[At,"alternate_group","int",16],[At,"volume","int",16],[At,"reversed","uint",16],[At,"matrix","uint",32,9],[At,"width","uint",32],[At,"height","uint",32]],mdhd:[[At,"version","uint",8],[At,"flags","uint",24],[bt,[Tt,wt,[vt,"version"],1]],[At,"create_time","uint",64],[At,"modification_time","uint",64],[At,"timescale","uint",32],[At,"duration","uint",64],[Et],[At,"create_time","uint",32],[At,"modification_time","uint",32],[At,"timescale","uint",32],[At,"duration","uint",32],[_t],[At,"reversed","uint",1],[At,"language","uint",5,3],[At,"reversed","uint",16]],hdlr:[[At,"version","uint",8],[At,"flags","uint",24],[At,"pre_defined","uint",32],[At,"handler_type","string",32],[At,"reversed","uint",32,3],[At,"name","string",8,"StringEnd"]],stsd:[[At,"version","uint",8],[At,"flags","uint",24],[At,"entry_count","uint",32]],stsz:[[At,"version","uint",8],[At,"flags","uint",24],[At,"sample_size","uint",32],[At,"sample_count","uint",32],[bt,[Tt,wt,[vt,"sample_size"],0]],[Rt,1,[vt,"sample_count"],1],[At,"entry_size","uint",32],[St],[_t]],ctts:[[At,"version","uint",8],[At,"flags","uint",24],[At,"entry_count","uint",32],[bt,[Tt,wt,[vt,"version"],0]],[Rt,1,[vt,"entry_count"],1],[At,"sample_count","uint",32],[At,"sample_offset","uint",32],[St],[Et,[Tt,wt,[vt,"version"],1]],[Rt,1,[vt,"entry_count"],1],[At,"sample_count","uint",32],[At,"sample_offset","int",32],[St],[_t]],stco:[[At,"version","uint",8],[At,"flags","uint",24],[At,"entry_count","uint",32],[Rt,1,[vt,"entry_count"],1],[At,"chunk_offset","uint",32],[St]],stsc:[[At,"version","uint",8],[At,"flags","uint",24],[At,"entry_count","uint",32],[Rt,1,[vt,"entry_count"],1],[At,"first_chunk","uint",32],[At,"samples_per_chunk","uint",32],[At,"sample_description_index","uint",32],[St]],stts:[[At,"version","uint",8],[At,"flags","uint",24],[At,"entry_count","uint",32],[Rt,1,[vt,"entry_count"],1],[At,"sample_count","uint",32],[At,"sample_delta","uint",32],[St]],avc1:[[At,"reverse","uint",8,6],[At,"data_reference_ID","uint",16],[At,"code_stream_version","uint",16],[At,"reverse","uint",8,14],[At,"width","uint",16],[At,"height","uint",16],[At,"horizontal_resolution","uint",32],[At,"vertical_resolution","uint",32],[At,"reverse","uint",8,4],[At,"frame_count","uint",16],[At,"compressorname","string",256],[At,"depth","uint",16],[At,"reverse","uint",8,2]],mp4a:[[At,"reverse","uint",8,6],[At,"data_reference_ID","uint",16],[At,"reverse","uint",8,8],[At,"cnannelcount","uint",16],[At,"samplesize","uint",16],[At,"reverse","uint",8,4],[At,"samplerate","uint",32]],tfhd:[[At,"version","uint",8],[At,"flags","uint",24],[At,"track_ID","uint",32],[bt,[Tt,Lt,[vt,"flags"],1]],[At,"base_data_offset","uint",64],[_t],[bt,[Tt,Lt,[vt,"flags"],2]],[At,"sample_description_index","uint",32],[_t],[bt,[Tt,Lt,[vt,"flags"],8]],[At,"default_sample_duration","uint",32],[_t],[bt,[Tt,Lt,[vt,"flags"],16]],[At,"default_sample_size","uint",32],[_t],[bt,[Tt,Lt,[vt,"flags"],32]],[At,"default_sample_flags","uint",32],[_t]],tfdt:[[At,"version","uint",8],[At,"flags","uint",24],[bt,[Tt,wt,[vt,"version"],1]],[At,"baseMediaDecodeTime","uint",64],[Et],[At,"baseMediaDecodeTime","uint",32],[_t]],trun:[[At,"version","uint",8],[At,"flags","uint",24],[At,"sample_count","uint",32],[bt,[Tt,Lt,[vt,"flags"],1]],[At,"data_offset","int",32],[_t],[bt,[Tt,Lt,[vt,"flags"],4]],[At,"first_sample_flags","uint",32],[_t],[Rt,1,[vt,"sample_count"],1],[bt,[Tt,Lt,[vt,"flags"],256]],[At,"sample_duration","uint",32],[_t],[bt,[Tt,Lt,[vt,"flags"],512]],[At,"sample_size","uint",32],[_t],[bt,[Tt,Lt,[vt,"flags"],1024]],[At,"sample_flags","uint",32],[_t],[bt,[Tt,wt,[vt,"version"],0]],[bt,[Tt,Lt,[vt,"flags"],2048]],[At,"sample_composition_time_offset","uint",32],[_t],[Et],[bt,[Tt,Lt,[vt,"flags"],2048]],[At,"sample_composition_time_offset","int",32],[_t],[_t],[St]]},xt=je.IDENTIFIER,Pt=je.IF,Dt=je.ELSE,kt=je.ENDIF,It=je.LOOP,Mt=je.ENDLOOP,Ct=je.READ,Nt=je.BINARY,Ut=je.THREE,Bt=je.DECLARATION,Ft=je.UPDATE,jt=je.ASSIGNMENT,Gt=Ge.PLUS,Vt=Ge.EQUAL,qt=Ge.OR,Ht=Ge.UNARY_DOUBLE_PLUS,$t=Ge.LESS_EQUAL,Wt=Ge.UNEQUAL,zt=Ge.MODEL,Kt=Ge.MORE,Yt={sps:[[Ct,"profile_idc","u",8],[Ct,"profile_compatibility","u",8],[Ct,"level_idc","u",8],[Ct,"seq_parameter_set_id","ue"],[Pt,[Nt,qt,[Nt,Vt,[xt,"profile_idc"],44],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],83],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],86],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],100],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],110],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],118],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],122],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],128],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],134],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],138],[Nt,qt,[Nt,Vt,[xt,"profile_idc"],139],[Nt,Vt,[xt,"profile_idc"],244]]]]]]]]]]]]],[Ct,"chroma_format_idc","ue"],[Pt,[Nt,Vt,[xt,"chroma_format_idc"],3]],[Ct,"separate_colour_plane_flag","u",1],[kt],[Ct,"bit_depth_luma_minus8","ue"],[Ct,"bit_depth_chroma_minus8","ue"],[Ct,"qpprime_y_zero_transform_bypass_flag","u",1],[Ct,"seq_scaling_matrix_present_flag","u",1],[Pt,[Nt,Vt,[xt,"seq_scaling_matrix_present_flag"],1]],[It,[Bt,"i",1],[Nt,Vt,[xt,"i"],[Ut,[Nt,Vt,[xt,"chroma_format_idc"],3],12,3]],[Ft,Ht,[xt,"i"],!0]],[Ct,"seq_scaling_list_present_flag","u",1],[Pt,[Nt,Vt,[xt,"seq_scaling_list_present_flag"],1]],[Pt,[Nt,$t,[xt,"i"],6]],[Bt,"lastScale",8],[Bt,"nextScale",8],[It,[Bt,"j",1],[Nt,Vt,[xt,"j"],16],[Ft,Ht,[xt,"j"],!0]],[Pt,[Nt,Wt,[xt,"nextScale"],0]],[Ct,"delta_scale","se"],[jt,[xt,"nextScale"],[Nt,zt,[Nt,Gt,[xt,"lastScale"],[Nt,Gt,[xt,"lastScale"],256]],256]],[kt],[jt,[xt,"lastScale"],[Ut,[Nt,Vt,[xt,"nextScale"],0],[xt,"lastScale"],[xt,"nextScale"]]],[Mt],[Dt],[Bt,"lastScale",8],[Bt,"nextScale",8],[It,[Bt,"j",1],[Nt,Vt,[xt,"j"],64],[Ft,Ht,[xt,"j"],!0]],[Pt,[Nt,Wt,[xt,"nextScale"],0]],[Ct,"delta_scale","se"],[jt,[xt,"nextScale"],[Nt,zt,[Nt,Gt,[xt,"lastScale"],[Nt,Gt,[xt,"lastScale"],256]],256]],[kt],[jt,[xt,"lastScale"],[Ut,[Nt,Vt,[xt,"nextScale"],0],[xt,"lastScale"],[xt,"nextScale"]]],[Mt],[kt],[kt],[Mt],[kt],[kt],[Ct,"log2_max_frame_num_minus4","ue"],[Ct,"pic_order_cnt_type","ue"],[Pt,[Nt,Vt,[xt,"pic_order_cnt_type"],0]],[Ct,"log2_max_pic_order_cnt_lsb_minus4","ue"],[Dt,[Nt,Vt,[xt,"pic_order_cnt_type"],1]],[Ct,"delta_pic_order_always_zero_flag","u",1],[Ct,"offset_for_non_ref_pic","se"],[Ct,"offset_for_top_to_bottom_field","se"],[Ct,"num_ref_frames_in_pic_order_cnt_cycle","ue"],[It,1,[xt,"num_ref_frames_in_pic_order_cnt_cycle"],[Ct,"offset_for_ref_frame","se"],1],[Mt],[kt],[Ct,"max_num_ref_frames","ue"],[Ct,"gaps_in_frame_num_value_allowed_flag","u",1],[Ct,"pic_width_in_mbs_minus1","ue"],[Ct,"pic_height_in_map_units_minus1","ue"],[Ct,"frame_mbs_only_flag","u",1],[Pt,[Nt,Vt,[xt,"frame_mbs_only_flag"],0]],[Ct,"mb_adaptive_frame_field_flag","u",1],[kt],[Ct,"direct_8x8_inference_flag","u",1],[Ct,"frame_cropping_flag","u",1],[Pt,[Nt,Vt,[xt,"frame_cropping_flag"],1]],[Ct,"frame_crop_left_offset","ue"],[Ct,"frame_crop_right_offset","ue"],[Ct,"frame_crop_top_offset","ue"],[Ct,"frame_crop_bottom_offset","ue"],[kt],[Ct,"vui_parameters_present_flag","u",1],[Pt,[Nt,Vt,[xt,"vui_parameters_present_flag"],1]],[Ct,"aspect_ratio_info_present_flag","u",1],[Pt,[Nt,Vt,[xt,"aspect_ratio_info_present_flag"],1]],[Ct,"aspect_ratio_idc","u",8],[Pt,[Nt,Vt,[xt,"aspect_ratio_idc"],255]],[Ct,"sar_width","u",16],[Ct,"sar_height","u",16],[kt],[kt],[kt]],pps:[[Ct,"pic_parameter_set_id","ue"],[Ct,"seq_parameter_set_id","ue"],[Ct,"entropy_coding_mode_flag","u",1],[Ct,"bottom_field_pic_order_in_frame_present_flag","u",1],[Ct,"num_slice_groups_minus1","ue"],[Pt,[Nt,Kt,[xt,"num_slice_groups_minus1"],0]],[Ct,"slice_group_map_type","ue"],[Pt,[Nt,Vt,[xt,"slice_group_map_type"],0]],[It,[Bt,"iGroup",0],[Nt,$t,[xt,"iGroup"],[xt,"num_slice_groups_minus1"]],[Ft,Ht,[xt,"iGroup"],!0]],[Ct,"run_length_minus1","ue"],[Mt],[Dt,[Nt,Vt,[xt,"slice_group_map_type"],2]],[It,[Bt,"iGroup",1],[Nt,$t,[xt,"iGroup"],[xt,"num_slice_groups_minus1"]],[Ft,Ht,[xt,"iGroup"],!0]],[Ct,"top_left","ue"],[Ct,"bottom_right","ue"],[Mt],[Dt,[Nt,qt,[Nt,Vt,[xt,"slice_group_map_type"],3],[Nt,qt,[Nt,Vt,[xt,"slice_group_map_type"],4],[Nt,Vt,[xt,"slice_group_map_type"],5]]]],[Ct,"slice_group_change_direction_flag","u",1],[Ct,"slice_group_change_rate_minus1","ue"],[Dt,[Nt,Vt,[xt,"slice_group_map_type"],6]],[Bt,"read_bits",1],[Pt,[Nt,Kt,[Nt,Gt,[xt,"num_slice_groups_minus1"],1],4]],[jt,[xt,"read_bits"],3],[Dt,[Nt,Kt,[Nt,Gt,[xt,"num_slice_groups_minus1"],1],2]],[jt,[xt,"read_bits"],2],[kt],[Ct,"pic_size_in_map_units_minus1","ue"],[It,[Bt,"i",0],[Nt,$t,[xt,"i"],[xt,"pic_size_in_map_units_minus1"]],[Ft,Ht,[xt,"i"],!0]],[Ct,"slice_group_id","u",[xt,"read_bits"]],[Mt],[kt],[kt],[Ct,"num_ref_idx_l0_default_active_minus1","ue"],[Ct,"num_ref_idx_l1_default_active_minus1","ue"],[Ct,"weighted_pred_flag","u",1],[Ct,"weighted_bipred_idc","u",2],[Ct,"pic_init_qp_minus26","se"],[Ct,"pic_init_qs_minus26","se"],[Ct,"chroma_qp_index_offset","se"],[Ct,"deblocking_filter_control_present_flag","u",1],[Ct,"constrained_intra_pred_flag","u",1],[Ct,"redundant_pic_cnt_present_flag","u",1]]},Xt=function(){function e(e){this.streamReader=e,this.clearContext()}return e.prototype.read=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(e.length<2)throw new Error("wrong num of read params.");var r=e[0],i=e[1],n=e[2],o=typeof n;switch(o){case"undefined":switch(r){case"uint":return this.streamReader.readUintByBits(i);case"int":return this.streamReader.readIntByBits(i);case"string":return this.streamReader.readString(Math.floor(i/8));default:throw new Error("wrong read type")}case"number":switch(r){case"uint":for(var a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"string":switch(n){case"BoxEnd":switch(r){case"uint":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"FileEnd":switch(r){case"uint":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"StringEnd":s="";for(var c=this.streamReader.readString(1);"\0"!==c;)s+=c,c=this.streamReader.readString(1);return s;default:throw new Error("wrong read flag")}default:throw new Error("wrong read flag type")}},e.prototype.get=function(e){return this.context[e]},e.prototype.set=function(e,t){this.context[e]=t},e.prototype.clearContext=function(){this.context={}},e}(),Qt=function(){function e(e){this.golombReader=e}return e.prototype.read=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],i=e[1];switch(r){case"u":return this.golombReader.readBits(i);case"se":return this.golombReader.readEG();case"ue":return this.golombReader.readUEG();default:throw new Error("wrong read type")}},e.prototype.get=function(e){return this.conte,t){this.context[e]=t},e.prototype.clearContext=function(){this.context={}},e}(),Jt=(function(){function e(e){this.boxQueue=[],this.boxMap={},this.streamReader=e,this.mp4Reader=new Xt(e),this.parser=new gt(this.mp4Reader)}e.prototype.parse=function(){for(;!this.streamReader.isEos();){this.parser.setProgram(Ot.box),this.mp4Reader.set("boxBegin",this.streamReader.getPosition());try{var e=this.parser.getResult();if(1===e.size?this.mp4Reader.set("boxEnd",this.mp4Reader.get("boxBegin")+e.largesize):0===e.size?this.mp4Reader.set("boxEnd",this.streamReader.getEndPosition()):this.mp4Reader.set("boxEnd",this.mp4Reader.get("boxBegin")+e.size),void 0===Ot[e.boxtype]){this.streamReader.setPosition(this.mp4Reader.get("boxEnd"));var t=Ve(Ve({},e),{boxBegin:this.mp4Reader.get("boxBegin"),boxEnd:this.mp4Reader.get("boxEnd"),children:[],parent:null});this.push(t);continue}this.parser.setProgram(Ot[e.boxtype]);var r=this.parser.getResult(),i=Ve(Ve(Ve(Ve({},e),{boxBegin:this.mp4Reader.get("boxBegin"),boxEnd:this.mp4Reader.get("boxEnd")}),r),{children:[],parent:null});this.push(i)}catch(e){this.streamReader.setPosition(this.mp4Reader.get("boxBegin"));break}}},e.prototype.getBoxTree=function(){return this.boxQueue.filter((function(e){return null===e.parent}))},e.prototype.getBoxMap=function(){return this.boxMap},e.prototype.write=function(e){this.streamReader.append(e)},e.prototype.push=function(e){if(e.boxEnd>this.streamReader.getEndPosition())throw new Error("box ".concat(e.boxtype," length is too long."));var t=e.boxtype;if(this.boxMap[t]){var r=this.boxMap[t];Array.isArray(r)?r.push(e):this.boxMap[t]=[r,e]}else this.boxMap[t]=e;if(0!==this.boxQueue.length){var i=this.boxQueue[this.boxQueue.length-1];if(i.boxEnd>=e.boxEnd)i.children.push(e),e.parent=i,this.boxQueue.push(e);else{for(;i&&i.boxEnd<e.boxEnd;)i=i.parent;i&&i.children.push(e),e.parent=i,this.boxQueue.push(e)}}else this.boxQueue.push(e)}}(),function(e,t){switch(t){case 0:return 0;case 1:return 1&e;case 2:return 3&e;case 3:return 7&e;case 4:return 15&e;case 5:return 31&e;case 6:return 63&e;case 7:return 127&e;case 8:return e;default:throw new Error("wrong length.")}}),Zt=function(){function e(e){this.position=0,this.bitPosition=0,this.buffer=e,this.dataview=new DataView(e)}return e.prototype.append=function(e){var t=this.buffer,r=new Uint8Array(t.byteLength+e.byteLength);r.set(new Uint8Array(t)),r.set(new Uint8Array(e),t.byteLength),this.buffer=r.buffer,this.dataview=new DataView(this.buffer)},e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(e,t){this.position=e,this.bitPosition=void 0===t?0:t},e.prototype.getEndPosition=function(){return this.buffer.byteLength},e.prototype.getLength=function(){return this.buffer.byteLe=this.getEndPosition()},e.prototype.readUintByBits=function(e){if(e<=0)throw new Error("error size when reading uint by bits.");var t=this.dataview.getUint8(this.position),r=8-this.bitPosition,i=0;if(!(e>=r))return i=Jt(i=t>>r-e,e),this.bitPosition+=e,i;for(i=Jt(t,r),this.position++,this.bitPosition=0,e-=r;!this.isEos()&&e>=8;)i=i<<8|this.dataview.getUint8(this.position),e-=8,this.position++;return!this.isEos()&&e>0&&(i=i<<e|(t=this.dataview.getUint8(this.position))>>8-e,this.bitPosition+=e),i>>>0},e.prototype.readIntByBits=function(e){var t=e;if(e<=1)throw new Error("error size when reading int by bits.");var r=this.dataview.getUint8(this.position),i=!0,n=8-this.bitPosition,o=0;if(!(e>=n))return i=(o=Jt(o=r>>n-e,e))>>e-1==0,this.bitPosition+=e,i||(o=~(o-=1)&(1<<e)-1),i?Jt(o,e-1):-Jt(o,e-1);for(i=(o=Jt(r,n))>>n-1==0,o=Jt(o,n-1),this.position++,this.bitPosition=0,e-=n;!this.isEos()&&e>=8;)o=o<<8|this.dataview.getUint8(this.position),e-=8,this.position++;return!this.isEos()&&e>0&&(o=o<<e|(r=this.dataview.getUint8(this.position))>>8-e,this.bitPosition+=e),i||(o=~(o=o-1&(1<<t-1)-1)&(1<<t-1)-1),i?o:-o},e.prototype.readAnyInt=function(e,t){if(0!==this.bitPosition)return t?this.readIntByBits(8*e):this.readUintByBits(8*e);var r=0;if(this.position+e<=this.buffer.byteLength){switch(e){case 1:r=t?this.dataview.getInt8(this.position):this.dataview.getUint8(this.position);break;case 2:r=t?this.dataview.getInt16(this.position):this.dataview.getUint16(this.position);break;case 3:if(t)throw new Error("No method for reading signed 24 bits values");r=this.dataview.getUint8(this.position)<<16,r|=this.dataview.getUint8(this.position+1)<<8,r|=this.dataview.getUint8(this.position+2);break;case 4:r=t?this.dataview.getInt32(this.position):this.dataview.getUint32(this.position);break;case 8:if(t)throw new Error("No method for reading signed 64 bits values");r=this.dataview.getUint32(this.position)<<32,r|=this.dataview.getUint32(this.position+4);break;default:throw new Error("readInt method not implemented for size: ".concat(e))}return this.position+=e,r}throw new Error("Not enough bytes in buffer")},e.prototype.readUint8=function(){return this.readAnyInt(1,!1)},e.prototype.readUint16=function(){return this.readAnyInt(2,!1)},e.prototype.readUint24=function(){return this.readAnyInt(3,!1)},e.prototype.readUint32=function(){return this.readAnyInt(4,!1)},e.prototype.readUint64=function(){return this.readAnyInt(8,!1)},e.prototype.readString=function(e){if(this.position+e<=this.buffer.byteLength){for(var t="",r=0;r<e;r++)t+=String.fromCharCode(this.readUint8());return t}throw new Error("Not enough bytes in buffer")},e.prototype.readCString=function(){for(var e=[];;){var t=this.readUint8();if(0===t)break;e.push(t)}return String.fromCharCode.apply(null,e)},e.prototype.readInt8=function(){return this.readAnyInt(1,!0)},e.prototype.readInt16=function(){return this.readAnyInt(2,!0)},e.prototype.readInt32=function(){return this.readAnyInt(4,!0) this.readAnyInt(8,!1)},e.prototype.readUint8Array=function(e){for(var t=new Uint8Array(e),r=0;r<e;r++)t[r]=this.readUint8();return t},e.prototype.readInt16Array=function(e){for(var t=new Int16Array(e),r=0;r<e;r++)t[r]=this.readInt16();return t},e.prototype.readUint16Array=function(e){for(var t=new Int16Array(e),r=0;r<e;r++)t[r]=this.readUint16();return t},e.prototype.readUint32Array=function(e){for(var t=new Uint32Array(e),r=0;r<e;r++)t[r]=this.readUint32();return t},e.ps.readInt32();retur0,this.bitsAvailable=0}retuthis.bytesAvailable-=this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(tWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZpBits(1+this.skipLZ(n this.readBits(e+11&e?1+e>>>1:-1*(e>>>1)},n 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16turn this.readBits(32)},e.adUEG(),this.readUEG()},e}(),tr=(function(){function e(e){this.streamReader=e instanceof Uint8Array?new er(e):e,this.xpsReader=new Qt(this.streamReader),this.parser=new gt(this.xpsReader)}e.prototype.parse=function(e){if(void 0===Yt[e])throw new Error("dont support this type.");return this.parser.setProgram(Yt[e]),this.parser.getResult()}}(),je.IDENTIFIER),rr=je.IF,ir=je.ELSE,nr=je.ENDIF,or=je.LOOP,ar=je.ENDLOOP,sr=je.READ,ur=je.BINARY,cr=Ge.EQUAL,lr=Ge.BIT_AND,pr={moov:[],moof:[],trak:[],traf:[],mdia:[],minf:[],stbl:[],mvex:[],sinf:[],schi:[],box:[[sr,"size","uint",32],[sr,"boxtype","string",32],[rr,[ur,cr,[tr,"size"],1]],[sr,"largesize","uint",64],[ir,[ur,cr,[tr,"size"],0]],[nr],[rr,[ur,cr,"boxtype","uuid"]],[sr,"extendType","uint",8,16],[nr]],ftyp:[[sr,"major_brand","uint",32],[sr,"minor_version","uint",32],[sr,"compatible_brands","uint",32,"BoxEnd"]],mvhd:[[sr,"version","uint",8],[sr,"flags","uint",24],[rr,[ur,cr,[tr,"version"],1]],[sr,"create_time","uint",64],[sr,"modification_time","uint",64],[sr,"timescale","uint",32],[sr,"duration","uint",64],[ir],[sr,"create_time","uint",32],[sr,"modification_time","uint",32],[sr,"timescale","uint",32],[sr,"duration","uint",32],[nr],[sr,"rate","uint",32],[sr,"volume","uint",16],[sr,"reversed","uint",16],[sr,"reversed","uint",32,2],[sr,"matrix","uint",32,9],[sr,"pre_defined","uint",32,6],[sr,"next_track","uint",32]],tkhd:[[sr,"version","uint",8],[sr,"flags","uint",24],[rr,[ur,cr,[tr,"version"],1]],[sr,"create_time","uint",64],[sr,"modification_time","uint",64],[sr,"track_ID","uint",32],[sr,"reversed","uint",32],[sr,"duration","uint",64],[ir],[sr,"create_time","uint",32],[sr,"modification_time","uint",32],[sr,"track_ID","uint",32],[sr,"reversed","uint",32],[sr,"duration","uint",32],[nr],[sr,"reversed","uint",32,2],[sr,"layer","int",16],[sr,"alternate_group","int",16],[sr,"volume","int",16],[sr,"reversed","uint",16],[sr,"matrix","uint",32,9],[sr,"width","uint",32],[sr,"height","uint",32]],trex:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"track_ID","uint",32],[sr,"default_sample_description_index","uint",32],[sr,"default_sample_duration","uint",32],[sr,"default_sample_size","uint",32],[sr,"default_sample_flags","uint",32]],mdhd:[[sr,"version","uint",8],[sr,"flags","uint",24],[rr,[ur,cr,[tr,"version"],1]],[sr,"create_time","uint",64],[sr,"modification_time","uint",64],[sr,"timescale","uint",32],[sr,"duration","uint",64],[ir],[sr,"create_time","uint",32],[sr,"modification_time","uint",32],[sr,"timescale","uint",32],[sr,"duration","uint",32],[nr],[sr,"reversed","uint",1],[sr,"language","uint",5,3],[sr,"reversed","uint",16]],hdlr:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"pre_defined","uint",32],[sr,"handler_type","string",32],[sr,"reversed","uint",32,3],[sr,"name","string",8,"BoxEnd"]],stsd:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"entry_count","uint",32]],stsz:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"sample_size","uint",32],[sr,"sample_count","uint",32],[rr,[ur,cr,[tr,"sample_size"],0]],[or,1,[tr,"sample_count"],1],[sr,"entry_size","uint",32],[ar],[nr]],schm:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"scheme_type","string",32],[sr,"scheme_version","uint",32],[rr,[ur,lr,[tr,"flags"],1]],[sr,"scheme_uri","uint",8],[nr]],ctts:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"entry_count","uint",32],[rr,[ur,cr,[tr,"version"],0]],[or,1,[tr,"entry_count"],1],[sr,"sample_count","uint",32],[sr,"sample_offset","uint",32],[ar],[ir,[ur,cr,[tr,"version"],1]],[or,1,[tr,"entry_count"],1],[sr,"sample_count","uint",32],[sr,"sample_offset","int",32],[ar],[nr]],stco:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"entry_count","uint",32],[or,1,[tr,"entry_count"],1],[sr,"chunk_offset","uint",32],[ar]],stsc:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"entry_count","uint",32],[or,1,[tr,"entry_count"],1],[sr,"first_chunk","uint",32],[sr,"samples_per_chunk","uint",32],[sr,"sample_description_index","uint",32],[ar]],stts:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"entry_count","uint",32],[or,1,[tr,"entry_count"],1],[sr,"sample_count","uint",32],[sr,"sample_delta","uint",32],[ar]],stss:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"entry_count","uint",32],[or,1,[tr,"entry_count"],1],[sr,"sample_number","uint",32],[ar]],tenc:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"reserved","uint",8],[rr,[ur,cr,[tr,"version"],0]],[sr,"reserved","uint",64],[ir],[sr,"default_crypt_byte_block","uint",4],[sr,"default_skip_byte_block","uint",4],[nr],[sr,"default_isProtected","uint",8],[sr,"default_Per_Sample_IV_Size","uint",8],[sr,"default_KID","uint",8,16],[rr,[ur,Ge.AND,[ur,cr,[tr,"default_isProtected"],1],[ur,cr,[tr,"default_Per_Sample_IV_Size"],0]]],[sr,"default_constant_IV_size","uint",8],[sr,"default_constant_IV","uint",8,[tr,"default_constant_IV_size"]],[nr]],senc:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"sample_count","uint",32],[or,1,[tr,"sample_count"],1],[sr,"initialization_vector","uint",8,[tr,"default_Per_Sample_IV_Size"]],[rr,[ur,lr,[tr,"flags"],2]],[sr,"subsample_count","uint",16],[or,1,[tr,"subsample_count"],1],[sr,"bytes_of_clear_data","uint",16],[sr,"bytes_of_protected_data","uint",32],[ar],[nr],[ar]],encv:[[sr,"reverse","uint",8,6],[sr,"data_reference_ID","uint",16],[sr,"code_stream_version","uint",16],[sr,"reverse","uint",8,14],[sr,"width","uint",16],[sr,"height","uint",16],[sr,"horizontal_resolution","uint",32],[sr,"vertical_resolution","uint",32],[sr,"reverse","uint",8,4],[sr,"frame_count","uint",16],[sr,"compressorname","string",256],[sr,"depth","uint",16],[sr,"reverse","uint",8,2]],avc1:[[sr,"reverse","uint",8,6],[sr,"data_reference_ID","uint",16],[sr,"code_stream_version","uint",16],[sr,"reverse","uint",8,14],[sr,"width","uint",16],[sr,"height","uint",16],[sr,"horizontal_resolution","uint",32],[sr,"vertical_resolution","uint",32],[sr,"reverse","uint",8,4],[sr,"frame_count","uint",16],[sr,"compressorname","string",256],[sr,"depth","uint",16],[sr,"reverse","uint",8,2]],hvc1:[[sr,"reverse","uint",8,6],[sr,"data_reference_ID","uint",16],[sr,"reverse","uint",16],[sr,"reverse","uint",16],[sr,"reverse","uint",32,3],[sr,"width","uint",16],[sr,"height","uint",16],[sr,"horizontal_resolution","uint",32],[sr,"vertical_resolution","uint",32],[sr,"reverse","uint",8,4],[sr,"frame_count","uint",16],[sr,"compressorname","string",256],[sr,"depth","uint",16],[sr,"reverse","uint",8,2]],hev1:[[sr,"reverse","uint",8,6],[sr,"data_reference_ID","uint",16],[sr,"reverse","uint",16],[sr,"reverse","uint",16],[sr,"reverse","uint",32,3],[sr,"width","uint",16],[sr,"height","uint",16],[sr,"horizontal_resolution","uint",32],[sr,"vertical_resolution","uint",32],[sr,"reverse","uint",8,4],[sr,"frame_count","uint",16],[sr,"compressorname","string",256],[sr,"depth","uint",16],[sr,"reverse","uint",8,2]],enca:[[sr,"reverse","uint",8,6],[sr,"data_reference_ID","uint",16],[sr,"reverse","uint",8,8],[sr,"cnannelcount","uint",16],[sr,"samplesize","uint",16],[sr,"reverse","uint",8,4],[sr,"samplerate","uint",32]],mp4a:[[sr,"reverse","uint",8,6],[sr,"data_reference_ID","uint",16],[sr,"reverse","uint",8,8],[sr,"cnannelcount","uint",16],[sr,"samplesize","uint",16],[sr,"reverse","uint",8,4],[sr,"samplerate","uint",32]],tfhd:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"track_ID","uint",32],[rr,[ur,lr,[tr,"flags"],1]],[sr,"base_data_offset","uint",64],[nr],[rr,[ur,lr,[tr,"flags"],2]],[sr,"sample_description_index","uint",32],[nr],[rr,[ur,lr,[tr,"flags"],8]],[sr,"default_sample_duration","uint",32],[nr],[rr,[ur,lr,[tr,"flags"],16]],[sr,"default_sample_size","uint",32],[nr],[rr,[ur,lr,[tr,"flags"],32]],[sr,"default_sample_flags","uint",32],[nr]],tfdt:[[sr,"version","uint",8],[sr,"flags","uint",24],[rr,[ur,cr,[tr,"version"],1]],[sr,"baseMediaDecodeTime","uint",64],[ir],[sr,"baseMediaDecodeTime","uint",32],[nr]],trun:[[sr,"version","uint",8],[sr,"flags","uint",24],[sr,"sample_count","uint",32],[rr,[ur,lr,[tr,"flags"],1]],[sr,"data_offset","int",32],[nr],[rr,[ur,lr,[tr,"flags"],4]],[sr,"first_sample_flags","uint",32],[nr],[or,1,[tr,"sample_count"],1],[rr,[ur,lr,[tr,"flags"],256]],[sr,"sample_duration","uint",32],[nr],[rr,[ur,lr,[tr,"flags"],512]],[sr,"sample_size","uint",32],[nr],[rr,[ur,lr,[tr,"flags"],1024]],[sr,"sample_flags","uint",32],[nr],[rr,[ur,cr,[tr,"version"],0]],[rr,[ur,lr,[tr,"flags"],2048]],[sr,"sample_composition_time_offset","uint",32],[nr],[ir],[rr,[ur,lr,[tr,"flags"],2048]],[sr,"sample_composition_time_offset","int",32],[nr],[nr],[ar]]},dr=je.IDENTIFIER,hr=je.IF,fr=je.ELSE,mr=je.ENDIF,yr=je.LOOP,gr=je.ENDLOOP,vr=je.READ,br=je.BINARY,Er=je.THREE,_r=je.DECLARATION,Rr=je.UPDATE,Sr=je.ASSIGNMENT,Ar=Ge.PLUS,Tr=Ge.EQUAL,wr=Ge.OR,Lr=Ge.UNARY_DOUBLE_PLUS,Or=Ge.LESS_EQUAL,xr=Ge.UNEQUAL,Pr=Ge.MODEL,Dr=Ge.MORE,kr={sps:[[vr,"profile_idc","u",8],[vr,"profile_compatibility","u",8],[vr,"level_idc","u",8],[vr,"seq_parameter_set_id","ue"],[hr,[br,wr,[br,Tr,[dr,"profile_idc"],44],[br,wr,[br,Tr,[dr,"profile_idc"],83],[br,wr,[br,Tr,[dr,"profile_idc"],86],[br,wr,[br,Tr,[dr,"profile_idc"],100],[br,wr,[br,Tr,[dr,"profile_idc"],110],[br,wr,[br,Tr,[dr,"profile_idc"],118],[br,wr,[br,Tr,[dr,"profile_idc"],122],[br,wr,[br,Tr,[dr,"profile_idc"],128],[br,wr,[br,Tr,[dr,"profile_idc"],134],[br,wr,[br,Tr,[dr,"profile_idc"],138],[br,wr,[br,Tr,[dr,"profile_idc"],139],[br,Tr,[dr,"profile_idc"],244]]]]]]]]]]]]],[vr,"chroma_format_idc","ue"],[hr,[br,Tr,[dr,"chroma_format_idc"],3]],[vr,"separate_colour_plane_flag","u",1],[mr],[vr,"bit_depth_luma_minus8","ue"],[vr,"bit_depth_chroma_minus8","ue"],[vr,"qpprime_y_zero_transform_bypass_flag","u",1],[vr,"seq_scaling_matrix_present_flag","u",1],[hr,[br,Tr,[dr,"seq_scaling_matrix_present_flag"],1]],[yr,[_r,"i",1],[br,Tr,[dr,"i"],[Er,[br,Tr,[dr,"chroma_format_idc"],3],12,3]],[Rr,Lr,[dr,"i"],!0]],[vr,"seq_scaling_list_present_flag","u",1],[hr,[br,Tr,[dr,"seq_scaling_list_present_flag"],1]],[hr,[br,Or,[dr,"i"],6]],[_r,"lastScale",8],[_r,"nextScale",8],[yr,[_r,"j",1],[br,Tr,[dr,"j"],16],[Rr,Lr,[dr,"j"],!0]],[hr,[br,xr,[dr,"nextScale"],0]],[vr,"delta_scale","se"],[Sr,[dr,"nextScale"],[br,Pr,[br,Ar,[dr,"lastScale"],[br,Ar,[dr,"lastScale"],256]],256]],[mr],[Sr,[dr,"lastScale"],[Er,[br,Tr,[dr,"nextScale"],0],[dr,"lastScale"],[dr,"nextScale"]]],[gr],[fr],[_r,"lastScale",8],[_r,"nextScale",8],[yr,[_r,"j",1],[br,Tr,[dr,"j"],64],[Rr,Lr,[dr,"j"],!0]],[hr,[br,xr,[dr,"nextScale"],0]],[vr,"delta_scale","se"],[Sr,[dr,"nextScale"],[br,Pr,[br,Ar,[dr,"lastScale"],[br,Ar,[dr,"lastScale"],256]],256]],[mr],[Sr,[dr,"lastScale"],[Er,[br,Tr,[dr,"nextScale"],0],[dr,"lastScale"],[dr,"nextScale"]]],[gr],[mr],[mr],[gr],[mr],[mr],[vr,"log2_max_frame_num_minus4","ue"],[vr,"pic_order_cnt_type","ue"],[hr,[br,Tr,[dr,"pic_order_cnt_type"],0]],[vr,"log2_max_pic_order_cnt_lsb_minus4","ue"],[fr,[br,Tr,[dr,"pic_order_cnt_type"],1]],[vr,"delta_pic_order_always_zero_flag","u",1],[vr,"offset_for_non_ref_pic","se"],[vr,"offset_for_top_to_bottom_field","se"],[vr,"num_ref_frames_in_pic_order_cnt_cycle","ue"],[yr,1,[dr,"num_ref_frames_in_pic_order_cnt_cycle"],[vr,"offset_for_ref_frame","se"],1],[gr],[mr],[vr,"max_num_ref_frames","ue"],[vr,"gaps_in_frame_num_value_allowed_flag","u",1],[vr,"pic_width_in_mbs_minus1","ue"],[vr,"pic_height_in_map_units_minus1","ue"],[vr,"frame_mbs_only_flag","u",1],[hr,[br,Tr,[dr,"frame_mbs_only_flag"],0]],[vr,"mb_adaptive_frame_field_flag","u",1],[mr],[vr,"direct_8x8_inference_flag","u",1],[vr,"frame_cropping_flag","u",1],[hr,[br,Tr,[dr,"frame_cropping_flag"],1]],[vr,"frame_crop_left_offset","ue"],[vr,"frame_crop_right_offset","ue"],[vr,"frame_crop_top_offset","ue"],[vr,"frame_crop_bottom_offset","ue"],[mr],[vr,"vui_parameters_present_flag","u",1],[hr,[br,Tr,[dr,"vui_parameters_present_flag"],1]],[vr,"aspect_ratio_info_present_flag","u",1],[hr,[br,Tr,[dr,"aspect_ratio_info_present_flag"],1]],[vr,"aspect_ratio_idc","u",8],[hr,[br,Tr,[dr,"aspect_ratio_idc"],255]],[vr,"sar_width","u",16],[vr,"sar_height","u",16],[mr],[mr],[mr]],pps:[[vr,"pic_parameter_set_id","ue"],[vr,"seq_parameter_set_id","ue"],[vr,"entropy_coding_mode_flag","u",1],[vr,"bottom_field_pic_order_in_frame_present_flag","u",1],[vr,"num_slice_groups_minus1","ue"],[hr,[br,Dr,[dr,"num_slice_groups_minus1"],0]],[vr,"slice_group_map_type","ue"],[hr,[br,Tr,[dr,"slice_group_map_type"],0]],[yr,[_r,"iGroup",0],[br,Or,[dr,"iGroup"],[dr,"num_slice_groups_minus1"]],[Rr,Lr,[dr,"iGroup"],!0]],[vr,"run_length_minus1","ue"],[gr],[fr,[br,Tr,[dr,"slice_group_map_type"],2]],[yr,[_r,"iGroup",1],[br,Or,[dr,"iGroup"],[dr,"num_slice_groups_minus1"]],[Rr,Lr,[dr,"iGroup"],!0]],[vr,"top_left","ue"],[vr,"bottom_right","ue"],[gr],[fr,[br,wr,[br,Tr,[dr,"slice_group_map_type"],3],[br,wr,[br,Tr,[dr,"slice_group_map_type"],4],[br,Tr,[dr,"slice_group_map_type"],5]]]],[vr,"slice_group_change_direction_flag","u",1],[vr,"slice_group_change_rate_minus1","ue"],[fr,[br,Tr,[dr,"slice_group_map_type"],6]],[_r,"read_bits",1],[hr,[br,Dr,[br,Ar,[dr,"num_slice_groups_minus1"],1],4]],[Sr,[dr,"read_bits"],3],[fr,[br,Dr,[br,Ar,[dr,"num_slice_groups_minus1"],1],2]],[Sr,[dr,"read_bits"],2],[mr],[vr,"pic_size_in_map_units_minus1","ue"],[yr,[_r,"i",0],[br,Or,[dr,"i"],[dr,"pic_size_in_map_units_minus1"]],[Rr,Lr,[dr,"i"],!0]],[vr,"slice_group_id","u",[dr,"read_bits"]],[gr],[mr],[mr],[vr,"num_ref_idx_l0_default_active_minus1","ue"],[vr,"num_ref_idx_l1_default_active_minus1","ue"],[vr,"weighted_pred_flag","u",1],[vr,"weighted_bipred_idc","u",2],[vr,"pic_init_qp_minus26","se"],[vr,"pic_init_qs_minus26","se"],[vr,"chroma_qp_index_offset","se"],[vr,"deblocking_filter_control_present_flag","u",1],[vr,"constrained_intra_pred_flag","u",1],[vr,"redundant_pic_cnt_present_flag","u",1]]},Ir=function(){return(Ir=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,ar=e,this.clearContext()}return e.prototype.read=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(e.length<2)throw new Error("wrong num of read params.");var r=e[0],i=e[1],n=e[2],o=typeof n;switch(o){case"undefined":switch(r){case"uint":return this.streamReader.readUintByBits(i);case"int":return this.streamReader.readIntByBits(i);case"string":return this.streamReader.readString(Math.floor(i/8));default:throw new Error("wrong read type")}case"number":switch(r){case"uint":for(var a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"string":switch(n){case"BoxEnd":switch(r){case"uint":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"FileEnd":switch(r){case"uint":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"StringEnd":s="";for(var c=this.streamReader.readString(1);"\0"!==c;)s+=c,c=this.streamReader.readString(1);return s;default:throw new Error("wrong read flag")}default:throw new Error("wrong read flag type")}},e.prototype.get=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.context[e]},e.prototype.set=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];this.context[e]=t},e.prototype.clearContext=function(){this.context={}},e}(),Cr=function(){function e(e,t){this.boxQueue=[],this.boxMap={},this.streamReader=e,this.mp4Reader=new Mr(e),this.parser=new gt(this.mp4Reader,t)}return e.prototype.parse=function(){for(;!this.streamReader.isEos();){if(this.boxQueue.length>0&&("avcC"===this.boxQueue[this.boxQueue.length-1].boxtype||"hvcC"===this.boxQueue[this.boxQueue.length-1].boxtype)){var e=this.boxMap.avcC||this.boxMap.hvcC,t=void 0;if("encv"!==(t=Array.isArray(e)?e[0]:e).parent.boxtype){this.streamReader.setPosition(t.parent.boxEnd);var r={boxBegin:-1,boxEnd:-1,boxtype:"self_placeholder",children:[],parent:null};this.push(r);continue}}this.parser.setProgram(pr.box),this.mp4Reader.set("boxBegin",this.streamReader.getPosition());try{var i=this.parser.getResult();if(1===i.size?this.mp4Reader.set("boxEnd",this.mp4Reader.get("boxBegin")+i.largesize):0===i.size?this.mp4Reader.set("boxEnd",this.streamReader.getEndPosition()):this.mp4Reader.set("boxEnd",this.mp4Reader.get("boxBegin")+i.size),void 0===pr[i.boxtype]){this.streamReader.setPosition(this.mp4Reader.get("boxEnd"));var n=Ir(Ir({},i),{boxBegin:this.mp4Reader.get("boxBegin"),boxEnd:this.mp4Reader.get("boxEnd"),children:[],parent:null});this.push(n);continue}this.parser.setProgram(pr[i.boxtype]);var o=this.parser.getResult();r=Ir(Ir(Ir(Ir({},i),{boxBegin:this.mp4Reader.get("boxBegin"),boxEnd:this.mp4Reader.get("boxEnd")}),o),{children:[],parent:null});this.push(r)}catch(e){this.streamReader.setPosition(this.mp4Reader.get("boxBegin"));break}}}urn null===e.parent}))},e.prototype.getBoxMap=function(){return this.boxMap},e.prototype.write=function(e){this.streamReader.append(e)},e.prototype.push=function(e){if(e.boxEnd>this.streamReader.getEndPosition())throw new Error("box "+e.boxtype+" length is too long.");var t=e.boxtype;if(this.boxMap[t]){var r=this.boxMap[t];Array.isArray(r)?r.push(e):this.boxMap[t]=[r,e]}else this.boxMap[t]=e;if(0!==this.boxQueue.length){var i=this.boxQueue[this.boxQueue.length-1];if(i.boxEnd>=e.boxEnd)i.children.push(e),e.parent=i,this.boxQueue.push(e);else{for(;i&&i.boxEnd<e.boxEnd;)i=i.parent;i&&i.children.push(e),e.parent=i,this.boxQueue.push(e)}}else this.boxQueue.push(e)},e}(),Nr=function(){function e(e){this.golombReader=e}return e.prototype.read=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],i=e[1];switch(r){case"u":return this.golombReader.readBits(i);case"se":return this.golombReader.readEG();case"ue":return this.golombReader.readUEG();default:throw new Error("wrong read type")}},e.prototype.get=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.context[e]},e.prototype.set=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];this.context[e]=t},e.prototype.clearContext=function(){this.context={}},e}(),Ur=(function(){function e(e){this.streamReader=e instanceof Uint8Array?new er(e):e,this.xpsReader=new Nr(this.streamReader),this.parser=new gt(this.xpsReader)}e.prototype.parse=function(e){if(void 0===kr[e])throw new Error("dont support this type.");return this.parser.setProgram(kr[e]),this.parser.getResult()}}(),function(){return(Ur=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}),Br=function(e,t){if(t.ES_ID=e.readUint16(),t.flags=e.readUint8(),128&t.flags?t.dependsOn_ES_ID=e.readUint16():t.dependsOn_ES_ID=0,64&t.flags){var r=e.readUint8();t.URL=e.readString(r)}else t.URL="";32&t.flags?t.OCR_ES_ID=e.readUint16():t.OCR_ES_ID=0;for(var i=e.readUint8(),n=0,o=e.readUint8();128&o;)n=127&o,o=e.readUint8();for(n+=127&o;4!==i&&e.getPosition()!==e.getEndPosition();){for(e.readUint8Array(n),i=e.readUint8(),n=0,o=e.readUint8();128&o;)n=127&o,o=e.readUint8();n+=127&o}4===i&&Fr(e,t)},Fr=function(e,t){t.oefault:return"unknow"}}(t.oti),t.streamType=e.readUint8(),t.bufferSize=e.readUint24(),t.maxBitrate=e.readUint32(),t.avgBitrate=e.readUint32();for(var r=0,i=e.readUint8(),n=e.readUint8();128&n;)r=127&n,n=e.readUint8();for(r+=127&n;5!==i&&e.getPosition()!==e.getEndPosition();){for(e.readUint8Array(r),i=e.readUint8(),r=0,n=e.readUint8();128&n;)r=127&n,n=e.readUint8();r+=127&n}5===i&&(t.DSIData=e.readUint8Array(r))},jr=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];ction e(){this.reset()}return e.probe=function(e){return function(e){if(!(e instanceof Uint8Array))throw new Error("mp4 demuxer's write function only accepts Uint8Array type param.");for(var t={moov:!0,moof:!0,mdat:!0},r=0,i=new Zt(e.buffer),n=new Mr(i),o=new gt(n),a=[],s=0;!i.isEos();){o.setProgram(pr.box),n.set("boxBegin",i.getPosition());try{var u=o.getResult();1===u.size?n.set("boxEnd",n.get("boxBegin")+u.largesize):0===u.size?n.set("boxEnd",i.getEndPosition()):n.set("boxEnd",n.get("boxBegin")+u.size),i.setPosition(n.get("boxEnd"));var c=Ur(Ur({},u),{boxBegin:n.get("boxBegin"),boxEnd:n.get("boxEnd"),children:[],parent:null});(0===s&&"ftyp"===c.boxtype||t[c.boxtype])&&(r+=1),a.push(c),s++;continue}catch(e){i.setPosition(n.get("boxBegin"));break}}return r>=2}(e)},e.parse=function(e){var t=new Cr(new Zt(e));return t.parse(),{boxMap:t.getBoxMap(),boxTree:t.getBoxTreunction(){this.clean()},e.prototype.clean=function(){this.Flushed=!0,this.data=new Uint8Array(0),this.boxMap={},this.samples=[],this.readedSamples=[],this.write_num=0,this.parse_num=-1},e.prototype.reset=function(){this.Flushed=!0,this.data=new Uint8Array(0),this.boxMap={},this.streams=[],this.samples=[],this.readedSamples=[],this.videoDescription=new Uint8Array(0),this.audioDescription=new Uint8Array(0),this.initDate=new Uint8Array(0),this.videoCodec=Be.UNKNOWN,this.audioCodec=Ue.UNKNOWN,this.write_num=0,this.parse_num=-1,this.originAudioTimescale=-1,this.trexs=[]},e.prototype.findAllStream=function(){return this.write_num!==this.parse_num&&Yr(this),this.streams},e.prototype.findStream=function(e){this.streams||this.findAllStream();var t=this.streams.find((function(t){return t.type===e}));if(void 0===t)throw new Error("have no "+e+" stream.");return t},e.prototype.write=function(e){if(!(e instanceof Uint8Array))throw new Error("mp4 demuxer's write function only accepts Uint8Array type param.");if(this.write_num++,function(e){for(var t=new Zt(e.buffer),r=new Mr(t),i=new gt(r),n=[],o={};!t.isEos();){i.setProgram(pr.box),r.set("boxBegin",t.getPosition());try{1===(l=i.getResult()).size?r.set("boxEnd",r.get("boxBegin")+l.largesize):0===l.size?r.set("boxEnd",t.getEndPosition()):r.set("boxEnd",r.get("boxBegin")+l.size),t.setPosition(r.get("boxEnd"));var a=Ur(Ur({},l),{boxBegin:r.get("boxBegin"),boxEnd:r.get("boxEnd"),children:[],parent:null});n.push(a),o[l.boxtype]=a}catch(e){t.setPosition(r.get("boxBegin"));break}}if(o.moov)for(var s=new Zt(e.slice(o.moov.boxBegin+8,o.moov.boxEnd).buffer),u=new Mr(s),c=new gt(u);!s.isEos();){c.setProgram(pr.box),u.set("boxBegin",s.getPosition());try{var l;1===(l=c.getResult()).size?u.set("boxEnd",u.get("boxBegin")+l.largesize):0===l.size?u.set("boxEnd",s.getEndPosition()):u.set("boxEnd",u.get("boxBegin")+l.size),s.setPosition(u.get("boxEnd"));a=Ur(Ur({},l),{boxBegin:u.get("boxBegin"),boxEnd:u.get("boxEnd"),children:[],parent:null});n.push(a),o[l.boxtype]=a}catch(e){s.setPosition(u.get("boxBegin"));break}}return!!o.mvex&&!o.moof}(e))return this.initDate=e,void(this.Flushed=!1);if(this.Flushed)this.data=e,this.Flushed=!1;else{var t=new Uint8Array(this.data.byteLength+e.byteLength);t.set(this.data),t.set(e,this.data.byteLength),this.data=t}},e.prototype.readPacket=function(){if(this.write_num!==this.parse_num&&Yr(this),this.samples.length<=0)return null;var e=this.samples[0],t=this.data.byteLength,r=e.offset,i=e.size+r;if(i<=t){var n=this.data.slice(r,i);this.readedSamples.push(this.samples.shift());var o=void 0;return"audio"===e.type?o=this.readAudioPacket(e,n):"video"===e.type&&(o=this.readVideoPacket(e,n)),o}return null},e.prototype.createVideoStream=function(e,t,r){var i=this.streams.findIndex((function(t){return t.type===e}));if(!("number"==typeof i&&i>=0&&this.streams[i].id===r.id)){var n=new Pe(e,t,r.timescale,r.id);if(n.NeedParse=!0,n.index=r.index,n.duration=r.duration,n.packetsCount=r.packetsCount,n.encryption=r.encryptionInfo,-1===i){if(this.streams.push(n),void 0===this.videoDescription)throw new Error("have no video description.");n.codec.init(this.videoDescription)}else{if(this.streams[i]=n,void 0===this.videoDescription)throw new Error("have no video description.");n.codec.init(this.videoDescription)}}},e.prototype.createAudioStream=function(e,t,r){var i=this.streams.findIndex((function(t){return t.type===e}));if(!("number"==typeof i&&i>=0&&this.streams[i].id===r.id)){var n=new Pe(e,t,r.timescale,r.id);if(-1===i){if(this.streams.push(n),void 0===this.audioDescription)throw new Error("have no video description.");n.codec.init(this.audioDescription)}else{if(this.streams[i]=n,void 0===this.audioDescription)throw new Error("have no video description.");n.codec.init(this.audioDescription)}n.codec.getMetaData().sampleRate;n.NeedParse=!0,n.index=r.index,this.originAudioTimescale=r.timescale,n.timescale=1*r.timescale,n.duration=1*r.duration,n.packetsCount=r.packetsCount,n.encryption=r.encryptionInfo}},e.prototype.readVideoPacket=function(e,t){var r=this.streams[e.streamIndex];if(void 0===r)throw new Error("have no video stream.");if("avc1"===r.codec.fourCC||"hvc1"===r.codec.fourCC)return this.readNaluVideoPacket(e,t);throw new Error("dont support video bit stream format.")},e.prototype.readNaluVideoPacket=function(e,t){if(void 0===this.streams[e.streamIndex])throw new Error("have no video stream.");for(var r=[],n=new Zt(t.buffer);n.getPosition()<n.getEndPosition();){var o=n.readUint32(),a=n.readUint8Array(o),s=new Uint8Array(4+a.length);s.set([(4278190080&o)>>24,(16711680&o)>>16,(65280&o)>>8,255&o]),s.set(a,4),r.push(s)}var u=function(e){if(0===e.length)return new Uint8Array(0);if(1===e.length)return e[0]ion(e){r+=e.byteLength}));for(var i=new Uint8Array(r),n=0,o=e;n<o.length;n++){var a=o[n];i.set(a,t),t+=a.byteLength}return i}(r);return{key:e.key,data:u,encrypted:e.encrypted,pts:e.pts,dts:e.dts,duration:e.duration,timestamp:Math.round(1e3*e.ptsMs),bsf:this.videoCodec===Be.avc1?i.a.AVC:i.a.HEVC,isLast:e.isLast,streamIndex:e.streamIndex,encryptionInfo:e.encryptionInfo}},e.prototype.readAudioPacket=function(e,t){var r=this.streams[e.streamIndex];if(void 0===r)throw new Error("have no video stream.");if("mp4a"===r.codec.fourCC)return this.readAACAudioPacket(e,t);throw new Error("dont support audio bit stream format.")},e.prototype.readAACAudioPacket=function(e,t){return{data:t,pts:e.pts,dts:e.dts,encrypted:e.encrypted,encryptionInfo:e.encryptionInfo,duration:e.duration,timestamp:Math.round(1e3*e.ptsMs),bsf:i.a.AAC,isLast:e.isLast,streamIndex:e.streamIndex}},e}(),Vr=function(e,t,r){var i;if(i=Array.isArray(t.esds)?t.esds[0]:t.esds){var n=function(e){for(var t=e.byteLength,r=new Zt(e.slice(0,t)),i={version:r.readUint8(),flags:r.readUint24()},n=r.readUint8(),o=0,a=r.readUint8();128&a;)o=127&a,a=r.readUint8();for(o+=127&a;3!==n&&r.getPosition()!==r.getEndPosition();){for(r.readUint8Array(o),n=r.readUint8(),o=0,a=r.readUint8();128&a;)o=127&a,a=r.readUint8();o+=127&a}return 3===n&&Br(r,i),{type:"esds",data:i,restInterval:[t,t]}}(r.slice(i.boxBegin+8,i.boxEnd).buffer).data;e.audioDescription=n.DSIData,e.audioCodec=n.type}var o=t.avc1,a=t.hvc1,s=t.hev1,u=null;void 0!==o?(e.videoCodec=Be.avc1,u=Array.isArray(t.avcC)?t.avcC[0]:t.avcC):void 0!==a||void 0!==s?(e.videoCodec=Be.hev1,u=Array.isArray(t.hvcC)?t.hvcC[0]:t.hvcC):e.videoCodec=Be.UNKNOWN,u&&(e.videoDescription=r.slice(u.boxBegin+8,u.boxEnd));var c=t.trex;if(c){var l=Array.isArray(c)?c:[c];e.trexs=l}},qr=function(e){var t=e.boxMap.traf;if(void 0===t)throw new Error("moov box has no traf box.");for(var r=function(t){var r,i,o,a,s=t.parent;if(t.children.forEach((function(e){switch(e.boxtype){case"tfhd":r=e;break;case"tfdt":i=e;break;case"trun":o=e;break;case"senc":a=e}})),void 0===r)throw new Error("some track has no tfhd box.");if(void 0===o)throw new Error("some track has no trun box.");if(void 0===i)throw new Error("some track has no tfdt box.");var u=r,c=u.track_ID,l=u.default_sample_duration,p=void 0===l?0:l,d=u.default_sample_size,h=void 0===d?null:d,f=e.streams.find((function(e){return e.id===c}));if(!f)return{value:void 0};for(var m=f.timescale,y=f.index,g=f.type,v=i.baseMediaDecodeTime,b=void 0===v?0:v,E=e.trexs.find((function(e){return e.track_ID===f.id})),_=o,R=_.sample_count,S=_.data_offset,A=void 0===S?0:S,T=_.sample_duration,w=void 0===T?[]:T,L=_.sample_size,O=void 0===L?[]:L,x=_.sample_composition_time_offset,P=void 0===x?[]:x,D=_.first_sample_flags,k=[],I=A+s.boxBegin,M=b,C=0,N=0;N<R;N++){var U=1*(P.length>0?M+P[N]:M),B=1*M,F=void 0,j=a;if(j&&(null===(u=j.subsample_count)||void 0===u?void 0:u.length)>0&&j.subsample_count.length==R){var G=j.subsample_count[N],V=(null===(l=j.initialization_vector)||void 0===l?void 0:l.length)>=R&&j.initialization_vector[N]||void 0,q=j.bytes_of_clear_data.slice(C,C+G),H=j.bytes_of_protected_data.slice(C,C+G);C+=G,F={subsample_count:G,iv:V,bytes_of_clear_data_list:q,bytes_of_protected_data_list:H}}var $={size:O[N]||h,offset:I,dts:B,pts:U,ptsMs:1e3*U/m,dtsMs:1e3*B/m,duration:w.length>0?w[N]:p||(E?E.default_sample_duration:0),type:g,streamIndex:y,isLast:!1,encrypted:!!a,encryptionInfo:F};I+=$.size,M+=$.duration,k.push($),f.packetsCount++,f.duration+=$.duration,f.timeline.maxDts=Math.max($.dts,f.timeline.maxDts),f.timeline.maxPts=Math.max($.pts,f.timeline.maxPts)}if(f.type===n.a.VIDEO){var W=511&D;k[0].key=!W}e.samples=jr(e.samples,k),e.samples.sort((function(e,t){return e.dtsMs-t.dtsMs})),e.samples[e.samples.length-1].isLast=!0},i=0,o=Array.isArray(t)?t:[t];i<o.length;i++){var a=r(o[i]);if("object"==typeof a)return a.value}e.samples.length&&(e.samples[e.samples.length-1].isLast=!0)},Hr=function(e,t,r,i){var o=$r(e,e.boxMap,e.streams,t,r,i,n.a.AUDIO);if(e.audioCodec===Ue.UNKNOWN)throw new Error("dont support audio bit stream format");e.audioCodec===Ue.AAC&&function(e,t){if(e.audioDescription&&e.audioDescription.length<=0)throw new Error("have no esds box.");e.createAudioStream(n.a.AUDIO,l.a.AAC,t)}(e,o)},$r=function(e,t,r,i,o,a,s){var u,c,l,p,d,h,f=i.track_ID,m=a.duration,y=a.timescale,g=o.children.find((function(e){return"stbl"===e.boxtype}));if(void 0===g)throw new Error("have no stbl box.");if(g.children.forEach((function(e){switch(e.boxtype){case"stsz":u=e;break;case"stsd":c=e;break;case"stsc":l=e;break;case"stco":p=e;break;case"stts":d=e;break;case"ctts":h=e}})),void 0===c)throw new Error("have no stsd box.");if(void 0===p)throw new Error("have no stco box.");if(void 0===u)throw new Error("have no stsz box.");if(void 0===l)throw new Error("have no stsc box.");if(void 0===d)throw new Error("have no stts box.");var v,b,E,_,R=p,S=u,A=lype||"encv"==e.boxtype}));if(w){var L=w.children.find((function(e){return"sinf"==e.boxtype}));L&&L.children.forEach((function(e){switch(e.boxtype){case"schm":v=e;break;case"schi":b=e}})),b&&(E=b.children.find((function(e){return"tenc"==e.boxtype})))}if(E&&v&&(_=Kr(E,v)),t.moof||t.mvex||i.parenturn"mvex"===e.boxtype})))return{id:f,index:r.length,duration:0,timescale:y,packetsCount:0,encryptionInfo:_};for(var O=new Array(Array.isArray(R.chunk_offset)?R.chunk_offset.length:1),x=new Array(S.entry_size.length),P=new Array(x.length),D=Array.isArray(A.first_chunk)?A.first_chunk.map((function(e,t){return{firstChunk:e,sampleDescriptionIndex:A.sample_description_index[t],samplesPerChunk:A.samples_per_chunk[t]}})):[{firstChunk:A.first_chunk,sampleDescriptionIndex:A.sample_description_index,samplesPerChunk:A.samples_per_chunk}],k=new Array(O.length),I=Array.isArray(R.chunk_offset)?R.chunk_offset:[R.chunk_offset],M=Array.isArray(T.sample_count)?T.sample_count.map((function(e,t){return{sampleCount:e,sampleDelta:T.sample_delta[t]}})):[{sampleCount:T.sample_count,sampleDelta:T.sample_delta}],C=0;C<D.length;C++){var N=D[C];if(C!==D.length-1)for(var U=D[C+1],B=N.firstChunk-1;B<U.firstChunk-1;B++)k[B]=N.samplesPerChunk;else for(B=N.firstChunk-1;B<O.length;B++)k[B]=N.samplesPerChunk}var F=0;for(C=0;C<O.length;C++){var j={samples:k[C],offset:I[C]};O[C]=j;for(var G=F+j.samples;F<G;F++)P[F]=C}for(C=0;C<x.length;C++){var V={size:S.sample_size||S.entry_size[C],offset:-1,dts:-1,pts:-1,ptsMs:-1,dtsMs:-1,duration:-1,type:s,streamIndex:r.length,isLast:!1};s===n.a.VIDEO&&(V.key=!t.stss),V.offset=I[P[C]],I[P[C]]+=V.size,x[C]=V}var q=t.stss;if(q)for(var H=0,$=Array.isArray(q.sample_numbefunction(e){return e-1})):[q.sample_number-1];H<$.length;H++){x[$[H]].key=!0}F=0;var W=0,z=-1,K=-1;for(C=0;C<M.length;C++)for(var Y=M[C],X=F+Y.sampleCount;F<X;F++)x[F].dts=W,z=Math.max(z,x[F].dts),x[F].pts=W,K=Math.max(K,x[F].pts),x[F].duration=Y.sampleDelta,W+=Y.sampleDelta,x[F].ptsMs=1e3*x[F].pts/y,x[F].dtsMs=1e3*x[F].dts/y;if(h){var Q=h;F=0;var J=Array.isArray(Q.sample_couet:Q.sample_offset[t]}})):[{sampleCount:Q.sample_count,cttsOffset:Q.sample_offset}];for(C=0;C<J.length;C++){var Z=J[C];for(X=F+Z.sampleCount;F<X;F++)x[F].pts=x[F].dts+Z.cttsOffset,K=Math.max(K,x[F]){return e+=t.duration}),0);return e.samples.length>0&&(e.samples[e.samples.length-1].isLast=!1),e.samples=jr(e.samples,x),e.samples.sort((function(e,t){return e.dtsMs-t.dtsMs})),e.samples[e.samples.length-1].isLast=!0,{id:f,index:e.streams.length,duration:m||ee,timescale:y,packetsCount:S.entry_size.length,encryptionInfo:_}},Wr=function(e,t,r,i){var o=$r(e,e.boxMap,e.streams,t,r,i,n.a.VIDEO);switch(e.videoCodec){case Be.avc1:!function(e,t){if(e.videoDescription&&e.videoDescription.length<=0)throw new Error("have no avcC box.");e.createVideoStream(n.a.VIDEO,l.a.AVC,t)}(e,o);break;case Be.hev1:case Be.hvc1:!function(e,t){if(e.videoDescription&&e.videoDescription.length<=0)throw new Error("have no hvcC box.");e.createVideoStream(n.a.VIDEO,l.a.HEVC,t)}(e,o);break;default:throw new Error("Demuxer only supoort avc1 hev1 hvc1 box now.")}},zr=function(e,t){for(var r=function(t){var r,i,n,o,a;if(t.children.forEach((function(e){switch(e.boxtype){case"mdia":r=e;break;case"tkhd":i=e}})),void 0===r)throw new Error("some track has no mdia box.");if(void 0===i)throw new Error("some track has no tkhd box.");if(r.children.forEach((function(e){switch(e.boxtype){case"hdlr":n=e;break;case"mdhd":a=e;break;case"minf":o=e}})),void 0===n)throw new Error("some track has no hdlr box.");if(void 0===o)throw new Error("some track has no minf box.");if(void 0===a)throw new Error("some track has no mdhd box.");var s=n.handler_type;switch(s){case"vide":Wr(e,i,o,a);break;case"soun":Hr(e,i,o,a);break;default:console.warn("Demuxer dont support "+s+" track now. Please connect author.")}},i=0,n=t;i<n.length;i++){r(n[i])}},Kr=function(e,t){var r=t.scheme_type,i=e.default_crypt_byte_block;return{scheme_type:r,default_Per_Sample_IV_Size:e.default_Per_Sample_IV_Size,default_crypt_byte_block:i,default_skip_byte_block:e.default_skip_byte_block,default_constant_IV:e.default_constant_IV}},Yr=function(e){try{if(e.initDate.byteLength>0){var t=new Cr(new Zt(e.initDate.buffer));t.parse();var r=t.getBoxMap();if(Vr(e,r,e.initDate),void 0===(c=r.trak))throw new Error("moov box has no trak box.");var i=Array.isArray(c)?c:[c];zr(e,i)}var n=e.streams[0],o=[];if(n&&n.encryption){var a={default_Per_Sample_IV_Size:n.encryption.default_Per_Sample_IV_Size};o.push(a)}var s=new Cr(new Zt(e.data.buffer),o);if(s.parse(),e.boxMap=s.getBoxMap(),e.boxMap.moov){if(void 0===(c=e.boxMap.trak))throw new Error("moov box has no trak box.");i=Array.isArray(c)?c:[c];Vr(e,e.boxMap,e.data),zr(e,i),e.boxMap.moof&&qr(e)}else if(e.boxMap.moof)if(e.streams.length>0)qr(e);else if(e.initDate.byteLength>0){var u=new Cr(new Zt(e.initDate.buffer));u.parse();var c,l=u.getBoxMap();if(Vr(e,l,e.initDate),void 0===(c=l.trak))throw new Error("moov box has no trak box.");i=Array.isArray(c)?c:[c];zr(e,i),qr(e)}e.parse_num=++e.write_num}catch(t){throw e.reset(),t}};Fe.install();var Xr={},Qr={},Jr=function(){function e(t){var r;if("string"==typeof t){if(this.format=t,!Xr[this.format]&&!Qr[this.format])throw new Error("unsupported format:"+this.format)}else if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{if(!u(t))throw new Error("invalid argument!must be ArrayBuffer|TypedArray|ContainerFormat");r=t}if(this.format||(this.format=e.probe(r)),!Xr[this.format]&&!Qr[this.format])throw Error("initialize XFormat Failed:can not found any remuxer or demuxer for "+this.format+"!");this.demuxer=new Xr[this.format],r&&(this.demuxer.write(r),this.dataPushed=!0),this.outPacketBuffer=[],this.bsfDefined={}}return e.probe=function(e){return Object.keys(Xr).filter((function(t){return Xr[t].probe(e)}))[0]||i.b.UNKNOWN},e.registerDemuxer=function(e,t){Xr[e]=t},e.registerRemuxer=function(e,t){Qr[e]=t},e.isSupportRemuxer=function(e){return!!Qrction(e){return!!Xr[e]},e.splitPacketsMap=function(e){var t={};return e.forEach((function(e){e.stream.type===n.a.AUDIO?t.audioStream=Object.setPrototypeOf({packets:e.packets},e.stream):e.stream.type===n.a.VIDEO&&(t.videoStream=Object.setPrototypeOf({packets:e.packets},e.stream))})),t},Object.defineProperty(e.prototype,"InputVideoBitstreamFormat",{get:function(){return Qr[this.format]?Qr[this.format].InputVideoBitstreamFormat:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"InputAudioBitstreamFormat",{get:function(){return Qr[this.format]?Qr[this.format].InputAudioBitstreamFormat:null},enumerable:!1,configurable:!0}),e.prototype.pushData=function(e){if(this.dataPushed=!0,!this.demuxer){if(!Xr[this.format])throw new Error("unsupported demuxer: "+this.format);this.demuxer=new Xr[this.format]}this.demuxer.write(u(e)?e:new Uint8Array(e)),this.targetXFormat&&this._transmux()},e.prototype._transmux=function(){var e;for(this.streams&&0!=this.streams.length?0===this.targetXFormat.getStreams().length&&this.targetXFormat.setStream(this.streams):(this.streams=this.demuxer.findAllStream(),this.targetXFormat.setStream(this.streams));e=this.readPacket();)this.streams[e.streamIndex].updatePacket(e),this.targetXFormat.writePacket(e)},e.prototype.findAllStream=function(){if(!this.demuxer)throw new Error("must pushData at first!");return this.streams=this.demuxer.findAllStream(),this.streams},e.prototype.readAllPacket=function(e,t){var r;this.streams&&0!=this.streams.length||this.findAllStream();for(n{stream:e,packets:[]}}));r=this.readPacket();)t&&(r.ext=t),this.streams[r.streamIndex].updatePacket(r),i[r.streamIndex].packets.push(r);if(e)for(this.flush();r=this.readPacket();)t&&(r.ext=t),this.streams[r.streamIndex].updatePacket(r),i[r.streamIndex].packets.push(r);return i},e.prototype.setBitstreamFilter=function(e){this.bsfDefined=e},e.prototyn(){this.bsfDefined={}return this.streams[e]},e.prototype.readPacket=function(){if(this.streams&&0!==this.streams.length||this.findAllStream(),this.outPacketBuffer.length>0)return this.outPacketBuffer.shift();for(var e,t;e=this.demuxer.readPacket();){if(t=this.streams[e.streamIndex],"function"==typeof this.packetFilter&&(t.encryption&&(e.default_encryption=t.encryption),e.data=this.packetFilter(e)),!e||!(t.NeedParse||this.bsfDefined[t.type]&&this.bsfDefined[t.type]!==e.bsf))return e;var r=t.codec.getParser().parse(e,this.bsfDefined[t.type]);if(r)return Array.isArray(r)?(this.outPacketBuffer=r.slice(1),r[0]):r}return this.demuxer.Flushed?(this.outPacketBuffer=t?t.codec.getParser().flush():function(e){for(var t=[],r=0;r<e.length;r++)Array.isArray(e[r])?t=t.concat(e[r]):t.push(e[r]);retuec.getParser().flush()})).filter(Boolean)),this.outPacketBuffer&&this.outPacketBuffer.shift()):null}er.getAllStreams()||[]},e.prototype.flush=function(){if(!this.demuxer)throw new Error("must pushData at first!");this.demuxer.flush(),this.targetXFormat&&this._transmux()},e.prototype.setPacketFilter=function(e){this.packetFilter=e},e.prototype.pipe=function(t){var r;if(!e.isSupportRemuxer(t.format))throw new Error("unsupported remuxer format "+t.format);this.targetXFormat=t,this.setBitstreamFilter(((r={})[n.a.VIDEO]=t.InputVideoBitstreamFormat,r[n.a.AUDIO]=t.InputAudioBitstreamFormat,r)),this.dataPushed&&this._transmuete this.targetXFormat},e.prototype.setStream=function(e){if(!this.remuxer){if(!Qr[this.format])throw new Error("unsupported remuxer:"+this.format);this.remuxer=new Qr[this.format]}this.remuxer.setStream(e)},;this.remuxer.write(e)},e.prototype.getOutput=function(e,t){if(!this.remuxer)throw new Error("must setStream at first!");return this.remuxer.getOutput(e,er,delete this.remuxer},e.prototype.reset=function(){delete this.streams,this.packetFilter=null,this.outPacketBuffer=[],this.demuxer&&this.demuxer.reset(),this.remuxer&&this.remuxer.reset(),this.dataPushe&&this.remuxer.clean()},e.prototype.resetDemuxer=function(){this.demuxer&&this.demuxer.reset()},e&&this.remuxer.reset()},e}();t.a=Jr;Jr.registerDemuxer(i.b.M2TS,ke),Jr.registerDemuxer(i.b.FLV,Ne),Jr.registerRemuxer(i.b.MP4,pe),Jr.registerDemuxer(i.b.MP4,Gr)},function(e,tTER=3]="RENDER_FILTER"}(i||(i={})),t.a=i},function(e,t,r){"use strict";var i=r(7),n=r(1),o=function(e,t,r){switch(t>=6&&(e=5),"mp4a.40."+(e||2)){case"mp4a.40.2":if(1===r)return new Uint8Array([0,200,0,128,35,128]);if(2===r)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===r)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},a=r(3);function s(e,t,r,i,n,s,u){var c;c=n>1&&new o(s.audioObjectType,s.samplingFrequencyIndex,s.channelCount)||e[t].data;for(var l=0;l<n;l++)e.splice(t+l,0,{bsf:a.a.AAC,streamIndex:u,dts:r+i*l,pts:r+i*l,timestamp:Math.floor(r+i*l*1e6/9e4),data:c,duration:s.sampleCount})}var u=function(){function e(){this.reset(),this.sequential=!1,this.timestampOffset=0,this.encrypted=!1,this.idiscontinuity=!1,this.accurateTimeOffset=!0}return e.prototype.reset=function(){this.audioVideoShift=0,this.videoBasePts=-1,this.videoBaseDts=-1,this.audioBasePts=-1,this.nextVideoDts=0,this.nextAudioDts=0,this.nextVideoPts=0,this.audioStream=null,this.videoStream=null},e.prototype.setStream=function(e){for(var t=0;t<e.length;t++)e[t].type===n.a.VIDEO?this.videoStream=e[t]:e[t].type===n.a.AUDIO&&(this.audioStream=e[t]);this.audioStream&&-1===this.audioStream.timeline.pts&&(this.audioStream.timeline.pts=this.audioStream.timeline.dts=this.nextAudioDts);var r=this.audioStream&&1!==this.audioStream.timeline.pts?this.audioStream.timeline.pts:1/0,i=this.videoStream&&-1!=this.videoStream.timeline.pts?this.videoStream.timeline.pts:1/0,o=this.videoStream&&-1!=this.videoStream.timeline.dts?this.videoStream.timeline.dts:1/0,a=0===this.timestampOffset?Math.min(r,i):i!==1/0?i:r,s=0===this.timestampOffset?Math.min(r,o):o!==1/0?o:r;if(!this.audioVideoShift&&this.videoStream&&this.audioStream&&(this.audioVideoShift=r-i),-1===this.videoBasePts&&(this.videoBasePts=a-(this.timestampOffset*(this.videoStream||this.audioStream).timescale||0)),-1===this.videoBaseDts&&(this.videoBaseDts=s-(this.timestampOffset*(this.videoStream||this.audioStream).timescale||0)),-1===this.audioBasePts&&this.audioStream){var u=this.videoStream&&this.videoStream.timescale===this.audioStream.timescale?a:r;this.audioBasePts=u-(this.timestampOffset*this.audioStream.timescale||0)}},e.prototype.discontinuity=function(){this.videoBasePts=-1,this.videoBaseDts=-1,this.audioBasePts=-1,this.idiscontinuity=!0},e.prototype.alignPackets=function(e,t){return t===n.a.AUDIO?this.alignAudio(e):t===n.a.VIDEO?this.alignVideo(e):e},e.prototype.alignVideo=function(e){var t=this,r=this.nextVideoDts;this.sequential||(r=this.timestampOffset*this.videoStream.timescale+e[0e.pts-t.pts||e.id-t.id}));var n=0,o=this.videoBasePts;i.a&&(o=this.videoBaseDts),e.forEach((function(e,r){e.dts=Math.max(0,e.dts-o),e.pts=Math.max(0,e.pts-o),e.pts+e.duration>n&&(n=e.pts+e.duration),e.timestamp=Math.round(1e6*e.pts/t.videoStream.timescale)}));var a=Math.max(0,e[0].dts),s=Math.max(0,e[0].pts),u=Math.round(1e3*(a-r)/this.videoStream.timescale);if(this.sequential&&Math.abs(u)>1){a=r,s=Math.max(a,Math.max(s-u,this.nextVideoPts)),e[0].pts=s,e[0].dts=a,e[0].timestamp=Math.round(1e6*e[0].pts/this.videoStream.timescale);for(var c=1;c<e.length;c++){if(!(e[c].dts<a||e[c].pts<s)){if(e[c].dts===a&&e[c].keyFrame){e=e.slice(c);break}break}e[c].dts=Math.max(a,e[c].dts),e[c].pts=Math.max(s,e[c].pts),e[0].timestamp=Math.round(1e6*e[0].pts/this.videoStream.timescale)}}s+e[0].duration>n&&(n=s+e[0].duration),this.nextVideoPts=n;var l=e[e.length-1];return this.nextVideoDts=l.dts+l.duration,e},e.prototype.addAudioFrame=function(e){var t=this.nextAudioDts,r=this.nextVideoDts,i=this.audioMetaData.sampleCount*this.audioStream.timescale/this.audioMetaData.sampleRate,n=Math.ceil((r-t)/i);s(e,0,t+this.audioBasePts,i,n,this.audioMetaData,this.audioStream.index),this.alignAudio(e)},e.prototype.alignAudio=function(e){var t=this;if(0===e.length)return e;var r=this.nextAudioDts,i=this.audioStream.codec.getMetaData();if(this.audioMetaData=i,e=e.filter((function(e){return e.pts=e.dts=Math.max(0,e.pts-t.audioBasePts),e.timestamp=Math.round(1e6*e.pts/t.audioStream.timescale),e.pts>=0})),this.sequential||(r=this.accurateTimeOffset&&this.idiscontinuity?this.timestampOffset*this.audioStream.timescale+this.audioVideoShift:e[0].dts),Math.abs(r-e[0].pts)>.001*this.audioStream.timescale&&function(e,t,r,i){for(var n=r/i.sampleRate,o=i.sampleCount*n,a=0;a<e.length;a++){var u=e[a],c=u.pts-t,l=1e3*c/r;if(c<=-o)e.length>1?(e.splice(a,1),a--):(e[0].pts=t,e[0].dts=t);else if(c>=o&&l<1e4&&t){var p=Math.round(c/o);s(e,a,t,o,p,i,e[0]&&e[0].streamIndex),t+=p*o,a+=p,u.pts=u.dts=t,t+=o}else u.pts=u.dts=t,t+=o}}(e,r,this.audioStream.timescale,i),e.length>0){var n=e[e.length-1];this.nextAudioDts=n.dts+n.duration}return this.idiscontinuity=!1,e},e}();t.a=u},function(e,t,r){"use strict";var i=Maththis.data=e,this.pos=0}r===e&&(e=0),this.pos=e},e.prototype.remainBit=function(){return Math.max(0,8*this.data.byteLength-this.pos)},e.prototype.read=function(e){var t=Math.floor(this.pos/8),r=this.pos%8;if(t>this.data.length-1)return NaN;var n=[];for(this.pos+=e;e>0;){var o=8-r,a=this.data[t],s=Math.pow(2,Math.min(o,e))-1<<Math.max(0,o-e),u=void 0;(u=o>=e?(a&s)>>o-e:(a&s)<<e-o)<0&&(u+=i),n.push(u),e-=o,tnction(e,t){return e|t}))},e}();function o(e){var t=e.read(5);return 31==t&&(t=32+e.read(6)),t}var a=function(e){var t,r,i,a,u,c=new n(e),l=o(c),p=c.read(4);15===p&&(t=c.read(24));var d=c.read(4),h=-1,f=-1;switch(5==l||29==l?(r=5,h=1,29==l&&(f=1),15==(i=c.read(4))&&(a=c.read(24)),22==(l=o(c))&&(u=c.read(4))):r=0,l){case 1:case 2:case 3:case 4:case 6:case 7:case 17:case 19:case 20:case 21:case 22:case 23:var m=function(e,t,r,i){var n=i.read(1);i.read(1)&&i.read(14);var o=i.read(1);return t||function(e){e.read(4),e.read(2),e.read(4);var t=e.read(4),r=e.read(4),i=e.read(4),n=e.read(2),o=e.read(3),a=e.read(4);1==e.read(1)&&e.read(4),1==e.read(1)&&e.read(4),1==e.read(1)&&(e.read(2),e.read(1));for(var s=[],u=[],c=0;c<t;c++)s[c]=e.read(1),u[c]=e.read(4);var l=[],p=[];for(c=0;c<r;c++)l[c]=e.read(1),p[c]=e.read(4);var d=[],h=[];for(c=0;c<i;c++)d[c]=e.read(1),h[c]=e.read(4);var f=[];for(c=0;c<n;c++){f[c]=e.read(4);for(var m=[],y=0;y<o;y++)m[y]=e.read(4);var g=[],v=[];for(c=0;c<a;c++)g[c]=e.read(1),v[c]=e.read(4);var b=e.read(8),E=[];for(c=0;c<b;c++)E[c]=e.read(8)}}(i),(6==r||20==r)&&i.read(3),o&&(22==r&&(i.read(5),i.read(11)),17!=r&&19!=r&&20!=r&&23!=r||(i.read(1),i.read(1),i.read(1)),i.read(1)),{frameLengthFlag:n}}(0,d,l,c);this.frameLengthFlag=m.frameLengthFlag}5!=r&&s(c)>=16&&695==c.read(11)&&(5==(r=o(c))&&1==(h=c.read(1))&&(15==(i=c.read(4))&&(a=c.read(24)),s(c)>=12&&1352==c.read(11)&&(f=c.read(1))),22==r&&(1==(h=c.read(1))&&15==(i=c.read(4))&&(a=c.read(24)),u=c.read(4)));this.sbr=h,this.ps=f,this.audioObjectType=l,this.samplingFrequencyIndex=p,this.samplingFrequency=t,this.channelConfiguration=d,this.extensionAudioObjectType=r,this.extensionSamplingFrequencyIndex=i,this.extensionSamplingFrequency=a,this.extensionChanne){return e.remainBit()}},function(e,t){},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i,n=r(12),o=r(2),a=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototypffer=[],r.callback=t,r}a(t,e),t.prototype.write=function(e,t){t===o.a.DATA&&this.buffer.push(e)writeMeta=function(e){},t.prototype.getResult=function(){var e,t;return this.promise=(e={},(t=new Promise((function(t,r){e.resolve=t,e.reject=r}))).defer=e,t),this.promise},t.prototype.end=function(){var e=this.buffer[0];if(e){var t=void 0;"string"==typeof e?t=this.buffer.reduce((function(e,t){return e+t}),""):"number"==typeof nction(e,t){return e+t}),0):e instanceof ArrayBuffer?t=function(e){if(1==e.length)return e[0];var t=e.reduce((function(e,t){return e+t.byteLength}),0),r=new Uint8Array(t(e),i),i+=e.byteLength})),r.buffer}(this.buffer):ArrayBuffer.isView(e)&&(t=function(e){if(1===e.length)retu{return e+t.byteLength}),0),r=new e[0].constructor(tt(e,i),i+=e.byteLength})),r}(this.buffer)),this.callback&&this.callback(t),this.promise&&this.promise.defer.resolve(t)}else this.callback&&this.callback(),this.promise&&this.promise.defer.resolve()}}(n.a);var s=r(15),u=function(){function e(){}return e.generateCodec=function(t,r){return"video"===t?e.generateVideoCodec(r):"audio"===t?e.generateAudioCodec(r):void 0},e.generateAudioCodec=function(e){var t=e.id,r=void 0===t?"aac":t,i=e.audioObjectType;return e.samplingFrequencyIndex>=6&&(i=5),{name:"AAC-"+(2===i?"LC":"SBR")+"@"+(e.sampleRate/1e3).toFixed(1)+"KHz",id:r,type:s.a.AUDIO,mime:"mp4a.40."+i}},e.generateVideoCodec=function(e){var t=e.id,r=void 0===t?"avc1":t,i=e.profileIdc,n=e.levelIdc,o=(e.sarRatio,e.profileCompatibility),a=r+".",u=c[i];return a+=Number(i).toString(16)+l(Number(o).toString(16))+l(Number(n).toString(16)),{type:s.a.VIDEO,mime:a,name:"H264 "+u+"@L"+(n/10).toFixed(1),id:r}},e}(),c={66:"Base",77:"Main",100:"High",110:"High 10",122:"High 4:2:2",244:"High 4:4:4"};function l(e){return((""+eturn p.objectURL=l,p}},fue,t)},r.p="",r(r.s=41)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitstreamFormat=t.ContainerFormat=void 0,function(e){e.M2TS="m2ts",e.FLV="flv",e.MP4="mp4",e.WEBM="webm",e.MOV="mov",e.MKV="mkv",e.UNKNOWN="unknown",e.ANY="any"}(t.ContainerFormat||(t.ContainerFormat={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.ANNEX_B=1]="ANNEX_B",e[e.AVC=2]="AVC",e[e.HEVC=3]="HEVC",e[e.ADTS=4]="ADTS",e[e.AAC=5]="AAC",e[e.RAW=6]="RAW"}(t.BitstreamFormat||(,n(r(22),t),n(r(60),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SeekType=t.MediaType=void 0,function(e){e.AUDIO="audio",e.VIDEO="video",e.MIXED="mixed",e.CLOSED_CAPTION="caption",e.SUBTITLE="subtitle",e.METADATA="metadata",e.TEXT="text",e.UNKNOWN="unknown"}(t.MediaType||(t.MediaType={})),t.SeekType||(t.SeekType={})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isArrayBufferView=t.writeIntByByte=t.readIntByByte=t.mergeBuffer=t.mergeBuffers=void 0,t.mergeBuffers=function(e,t){for(var r=new Uint8Array(t),i=0,n=0;n<e.length;n++)r.set(e[n],i),i+=e[n].byteLength;.set(t,e.byteLength),r},t.readIntByByte=function(e,t,r){for(var i=0,n=r;n>0;n--)i+=e[t+r-n]<<8*(n-1);return i},t.writeIntByByte=function(e,t,r,i){for(var n=i;n>0;n--)e[t+n-1]=(r&255<<8*(i-n))>>8*(i-instanceof ArrayBuffer}},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{valu",e[e.AAC=86018]="AAC"}(i||(i={})),t.CodecID=i},function(e,t,r){"use strict";var i;Object.defineProperty(t,"rrent",e.ABORT="abort"}(i||(i={})),t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,n=/^([^\/?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s=function(){function e(){}return e.resolveURL=function(t,r,i){var n=r;return/^[a-z]+:/i.test(r)?n=r:(i||(t=e.buildAbsoluteURL(window.location&&window.location.href||"",t||"")),n=e.buildAbsoluteURL(t,r)),e.protocolRevised&&"file:"!==location.protocol&&(n=0===n.indexOf("http")?n.replace(/http:|https:/,location.protocol):ne.buildURLFragment:t[6]||""}:null},e.addParams=function(e,t,r){if(-1!=e.indexOf("?")){for(var i=e.split("?"),n=i[0],o=i[1].split("&"),a=[],s=0,u=0;u<o.length;u++)o[u]&&t==o[u].split("=")[0]&&(s=1,o[u]=t+"="+r);s||a.push(t+"="+r),o.length>0&&(e=n+"?"+o.join("&")),a.length>0&&(e=e+"&"+a.join("&"))}else e=e+"?"+t+"="+r;re"").reverse().join("ams+e.query+e.fragment},e.protocolRevised=!0,e}();t.default=s},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.LOG=void 0;var n=function(){function e(){}return e.error=function(t,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];e.FORCE_GLOBAL_TAG&&(t=e.GLOBAL_TAG+": "+t);var a="["+t+"] > "+r;e.ENABLE_ERROR&&(console.error?console.error.apply(console,i([a],n)):console.warn?console.warn.apply(console,i([a],n)):console.log.apply(console,i([a],n)))},e.warn=function(t,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];e.FORCE_GLOBAL_TAG&&(t=e.GLOBAL_TAG+": "+t);var a="["+t+"] > "+r;e.ENABLE_WARN&&(console.warn?console.warn.apply(console,i([a],n)):console.log.apply(console,i([a],n)))},e.debug=function(t,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];e.FORCE_GLOBAL_TAG&&(t=e.GLOBAL_TAG+": "+t);var a="["+t+"] > "+r;e.ENABLE_DEBUG&&(console.debug?console.debug.apply(console,i([a],n)):console.log.apply(console,i([a],n)))},e.trace=function(t,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];if(!e.MODULE||location.href.indexOf("log_module="+t)>-1){e.FORCE_GLOBAL_TAG&&(t=e.GLOBAL_TAG+": "+t);var a="["+t+"] > "+r;if(!e.ENABLE_VERBOSE)return;console.log.apply(console,i([a],n))}},e.GLOBAL_TAG="XCore",e.FORCE_GLOBAL_TAG=!0,e.ENABLE_ERROR=!0,e.ENABLE_WARN=window.location.href.indexOf("player_debug=true")>-1,e.ENABLE_DEBUG=window.location.href.indexOf("player_debug=true")>-1,e.ENABLE_VERBOSE=window.location.href.indexOf("player_debug=true")>-1,e.MODULE=window.location.href.indexOf("log_module=")>-1,e}();t.default=n,t.LOG=function(e){return function(e,t,r){var i=r.value;r.value=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];performance.now(),console.log("["+e.constructor.name+"]"+t),i.apply(this,r)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{valuers={},this.onceMap={}}return e.prototype.off=function(e,t){return t?this.handlers[e]&&(this.handlers[e]=this.handlers[e].filter((function(e){return e!==t}))):e?(this.handlers[e]=[],this.onceMap[e]={}):(this.handlers={},this.onceMap={}),this},e.prototype.once=function(e,t,r){var i=this,n=!1,o=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];i.off(e,o),i.onceMap[e]&&i.onceMap[e][r]&&delete i.onceMap[e][r],n||(n=!0,t.apply(void 0,a))};return r&&(this.onceMap[e]?this.onceMap[e][r]&&this.off(e,this.onceMap[e][r]):this.onceMap[e]={},this.onceMap[e][r]=o),this.on(e,o)},e.prototype.addEventListener=function(e,t){return this.on(e,t)},e.protot){return this.off(e,t)},e.prototype.on=function(e,t,r){return this.handlers[e]?isFinite(r)?this.handlers[e].splice(r,0,t):this.handlers[e].push(t):this.handlers[e]=[t],this},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=this.handlers[e];if(i&&i.length>0){var n=i.concat();n.forEach((function(e){e.apply(void 0,t)}))}},e}();t.default=i},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var n=i(r(64)),o=0,a=function(){function e(e,t,r,i){this.type=e,this.codec=n.default.from(t),this.timescale=r,this.id=void 0!==i?i:256+o++,this.duration=0,this.packetsCount=0,this.framePtsList=[],this.timeline={pts:-1,dts:-1,maxPts:0,maxDts:0}}return e.prototype.serialize=function(){return{type:this.type,codecString:this.codec.getCodecString(),duration:this.duration,timescale:this.timescale,timeline:this.timeline,framePtsList:this.framePtsList,metadata:this.codec.getMetaData()}},odec=n.default.frol,this.framePtsList=[]},e.prototype.getBitstreamFormat=function(e){return this.bsf||(this.bsf=this.codec.getBitstreamFormat(e)),this.bsf},e.prototype.updatePacket=function(e){if(this.framePtsList.push(e.pts/9e4),this.packetsCount++,void 0===e.streamIndex&&(e.streamIndex=this.index),this.prevPacket){var t=e.dts-this.prevPacket.dts;e.duration=t,e.durationTime=Math.round(1e6*t/this.timescale),this.prevPacket.duration!==t&&(this.prevPacket.duration=t,this.prevPacket.durationTime=Math.round(1e6*t/this.timescale))}if(this.prevPacket=e,void 0===this.index)throw new Error("stream must be in a demuxer.streams or remuxer.streams");-1===this.timeline.pts&&(this.timeline.pts=e.pts),-1===this.timeline.dts&&(this.timeline.dts=e.dts),e.pts>this.timeline.maxPts&&(this.timeline.maxPts=e.pts),e.dts>this.timeline.maxDts&&(this.timeline.maxDts=e.dts)},e}();t.Stream=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=thisesModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(8)),s=o(r(81)),u=function(e){function t(){var t=e.call(this)||this;return t._flushed=!0,t._filters=[],t._piped=!1,t}return {this.emit("data",e,t)},t.prototype.push=function(e,t){var r=this;if(null===e)this.emit("finish",t);else{var e.tags||e.tags.test(t)})).map((function(e){return e.filter}));s.,t){r.emit("data",e,t){this.emit("finish",e)},t.prototype.write=function(e,t){if(!t)return this._write(e,t);var r,i="_write"+((r=t)[0].toUpperCase()+r.slice(1));if("function"==typeof this[i])return this[i].call(this,e);this.pass(etion(e,t){this.pion(){this.emit("end")filter:e,tags:t}),this},t.prototype.pipe=function(e){var t=e;return this._ption(e,r){t.write(e,r)})),this.on("finish",(function(e){t.flush(e)})),this.on("end",(function(){t.end()})),this.on("error",(function(e){t.emit("error",e)})),t},t}(a.default);t.default=u},function(e,t,r){"use strict";r.r(t),r.d(t,"GolombReader",(function(){return ge})),r.d(t,"H264XpsDSL",(function(){return pe})),r.d(t,"Mp4DSL",(function(){return H})),r.d(t,"Mp4Parser",(function(){return fe})),r.d(t,"Mp4Reader",(function(){return de})),r.d(t,"Operator",(function(){return n})),r.d(t,"Parser",(function(){return I})),r.d(t,"StatementType",(function(){return i})),r.d(t,"StreamReader",(function(){return ye})),r.d(t,"XpsParser",(function(){return v,(function(){return he}));var i,n,o=function(){return(o=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e})ototype.slice.call(t))}!function(e){e.IF="__IF__",e.ELSE="__ELSE__",e.ENDIF="__ENDIF__",e.LOOP="__LOOP__",e.ENDLOOP="__ENDLOOP__",e.ASSIGNMENT="__ASSIGNMENT__",e.READ="__READ__",e.BINARY="__BINARY__",e.UPDATE="__UPDATE__",e.DECLARATION="__DECLARATION__",e.IDENTIFIER="__IDENTIFIER__",e.THREE=ODEL="%",e.BIT_AND="&"}(n||(n={}));var s=i.IDENTIFIER,u=i.IF,c=i.ELSE,l=i.ENDIF,p=i.LOOP,d=i.ENDLOOP,h=i.ASSIGNMENT,f=i.READ,m=i.BINARY,y=i.DECLARATION,g=i.UPDATE,v=i.THREE,b=n.TIMES,E=n.UNEQUAL,_=n.DIVISION,R=n.EQUAL,S=n.OR,A=n.UNARY_DOUBLE_PLUS,T=n.PLUS,w=n.MINUS,L=n.LESS_EQUAL,O=n.MODELe)nction(e){return e===c},I=function(){function e(e){this.contextStack=[],this.reader=e,this.result={},this.program=[],this.ifStatementMap={},this.loopStatementMap={},this.isProgrammeScanned=!1,this.isProgramRan=!1}return e.prototype.setProgram=function(e){this.contextStack=[],this.result={},this.ifStatementMap={},this.loopStatementMap={},this.program=[];for(var t=0,r=e;t<r.length;t++){var i=r[t];this.program.push(a([],i,!0))}this.isProgrammeScanned=!1,this.isProgramRan=!1tack=[],this.result={}},e.prototype.getResult=function(){return this.run(),o({},this.result)},e.prototype.getContextValue=function(e){for(var t=e[1],r=this.contextStack.length-1;r>=0&&!this.contextStack[r].hasOwnProperty(t);)r--;if(-1!==r)return this.contextStack[r][t];var i=this.result[t];return Array.isArray(i)?i[i.length-1]:i},e.prototype.getContext=function(e){for(var t=e[1],r=this.contextStack.length-1;r>=0&&!this.contextStack[r].hasOwnProperty(t);)r--;return-1!==r?this.contextStack[r]:this.result.hasOwnProperty(t)?this.result:void 0},e.prototype.run=function(){this.isProgrammeScanned||(this.scanProgram(),this.isProgrammeScanned=!0),this.isProgramRan||(this.walkProgram(this.program),this.isProgramRan=!0)},e.prototype.scanProgram=function(){for(var e,t,r=[],i={},n={},o={},a=0;a<this.program.length;a++){var s=this.program[a];if(s.push(a),(t=s[0])===l||t===d){var c=r.pop(),h=c[c.length-1],f=s[s.length-1];if(i[h]=[h,f],c[0]===u){var m=[];m.push(c);for(var y=h+1;y<f;y++)i[y]&&(y=i[y][1]),k(this.program[y][0])&&m.push(this.program[y]);m.push(s),n[h]=m}if(c[0]===p){var g=[];g.push(c),g.push(s),o[h]=g}}else D(s[0])&&r.push(s)}e=[n,o],this.ifStatementMap=e[0],this.loopStatementMap=e[1]},e.prototype.walkProgram=function(e){this.contextStack.push({});for(var t=0;t<e.length;t++){var r=e[t];switch(r[0]){case f:this.solveReadNode(r);break;case u:var i=this.ifStatementMap[r[r.length-1]];if(void 0===i)throw new Error("didn't scan if statement.");var n=i[0],o=i[i.length-1];this.solveIfBlock(i),t+=o[o.length-1]-n[n.length-1];break;case p:var a=this.loopStatementMap[r[r.length-1]];if(void 0===a)throw new Error("didn't scan loop statement.");var c=a[0],l=a[1];this.contextStack.push({}),this.solveLoopBlock(a),this.contextStack.pop(),t+=l[l.length-1]-c[c.length-1];break;case m:case s:case h:case g:case y:this.solveExpression(r);break;default:console.log("unknown statement.")}}this.contextStack.pop()},e.prototype.solveExpression=function(e){if(!Array.isArray(e))return e;var t=e[0];switch(t){case m:return this.solveBinaryNode(e);case s:return this.getContextValue(e);case g:return this.solveUpdateNode(e);case y:return void this.solveDeclarationNode(e);case v:return this.solveThreeNode(e);case h:return void this.solveAssignmentNode(e);default:throw new Error("cant get ".concat(t," statement value."))}},e.prototype.solveDeclarationNode=function(e){this.contextStack[this.contextStack.length-1][e[1]]=this.solveExpression(e[2])},e.prototype.solveThreeNode=function(e){var t=e[1],r=e[2],i=e[3];return this.solveExpression(t)?this.solveExpression(r):this.solveExpression(i)},e.prototype.solveBinaryNode=function(e){var t=this.solveExpression(e[2]),r=this.solveExpression(e[3]);switch(e[1]){case R:return t==r;case E:return t!=r;case S:return t||r;case _:return t/r;case T:return t+r;case w:return t-r;case b:return t*r;case L:return t<=r;case O:return t%r;case x:return t>r;case P:return t&r;default:throw new Error("cant solve ".concat(e[1]," operator."))}},e.prototype.solveUpdateNode=function(e){var t=e[2],r=e[1],i=e[3],n=this.getContext(t);if(!n)throw new Error("cant find context.");switch(r){case A:return i?++n[t[1]]:n[t[1]]++;default:throw new Error("cant solve ".concat(r," operator."))}},e.prototype.solveAssignmentNode=function(e){var t=e[1],r=this.solveExpression(e[2]),i=this.getContext(t);if(!i)throw new Error("cant find context.");i[t[1]]=r},e.prototype.solveReadNode=function(e){for(var t,r=this,i=e[1],n=[],o=0,a=e.slice(2,e.length-1);o<a.length;o++){var s=a[o];n.push(this.solveExpression(s))}var u=(t=this.reader).read.apply(t,n.map((function(e){return Array.isArray(e)?r.solveExpression(e):e})));this.result.hasOwnProperty(i)?Array.isArray(this.result[i])?this.result[i].push(u):this.result[i]=[this.result[i],u]:this.result[i]=u},e.prototype.solveIfBlock=function(e){for(var t=0;t<e.length-1;t++){var r=e[t];if(2==r.length||this.solveExpression(r[1])){var i=e[t],n=e[t+1],o=i[i.length-1],a=n[n.length-1];this.walkProgram(this.program.slice(o+1,a));break}}},e.prototype.solveLoopBlock=function(e){var t=e[0],r=e[1],i=t[t.length-1],n=r[r.length-1],o=t[1],a=t[2],s=t[3];if("number"==typeof o)for(var u=this.solveExpression(o);u<=this.solveExpression(a);u+=this.solveExpression(s))this.walkProgram(this.program.slice(i+1,n));else for(this.solveExpression(o);this.solveExpression(a);)this.walkProgram(this.program.slice(i+1,n)),this.solveExpression(s)},e}(),M=i.IDENTIFIER,C=i.IF,N=i.ELSE,U=i.ENDIF,B=i.LOOP,F=i.ENDLOOP,j=i.READ,G=i.BINARY,V=n.EQUAL,q=n.BIT_AND,H={moov:[],moof:[],trak:[],traf:[],mdia:[],minf:[],stbl:[],box:[[j,"size","uint",32],[j,"boxtype","string",32],[C,[G,V,[M,"size"],1]],[j,"largesize","uint",64],[N,[G,V,[M,"size"],0]],[U],[C,[G,V,"boxtype","uuid"]],[j,"extendType","uint",8,16],[U]],ftyp:[[j,"major_brand","uint",32],[j,"minor_version","uint",32],[j,"compatible_brands","uint",32,"BoxEnd"]],mvhd:[[j,"version","uint",8],[j,"flags","uint",24],[C,[G,V,[M,"version"],1]],[j,"create_time","uint",64],[j,"modification_time","uint",64],[j,"timescale","uint",32],[j,"duration","uint",64],[N],[j,"create_time","uint",32],[j,"modification_time","uint",32],[j,"timescale","uint",32],[j,"duration","uint",32],[U],[j,"rate","uint",32],[j,"volume","uint",16],[j,"reversed","uint",16],[j,"reversed","uint",32,2],[j,"matrix","uint",32,9],[j,"pre_defined","uint",32,6],[j,"next_track","uint",32]],tkhd:[[j,"version","uint",8],[j,"flags","uint",24],[C,[G,V,[M,"version"],1]],[j,"create_time","uint",64],[j,"modification_time","uint",64],[j,"track_ID","uint",32],[j,"reversed","uint",32],[j,"duration","uint",64],[N],[j,"create_time","uint",32],[j,"modification_time","uint",32],[j,"track_ID","uint",32],[j,"reversed","uint",32],[j,"duration","uint",32],[U],[j,"reversed","uint",32,2],[j,"layer","int",16],[j,"alternate_group","int",16],[j,"volume","int",16],[j,"reversed","uint",16],[j,"matrix","uint",32,9],[j,"width","uint",32],[j,"height","uint",32]],mdhd:[[j,"version","uint",8],[j,"flags","uint",24],[C,[G,V,[M,"version"],1]],[j,"create_time","uint",64],[j,"modification_time","uint",64],[j,"timescale","uint",32],[j,"duration","uint",64],[N],[j,"create_time","uint",32],[j,"modification_time","uint",32],[j,"timescale","uint",32],[j,"duration","uint",32],[U],[j,"reversed","uint",1],[j,"language","uint",5,3],[j,"reversed","uint",16]],hdlr:[[j,"version","uint",8],[j,"flags","uint",24],[j,"pre_defined","uint",32],[j,"handler_type","string",32],[j,"reversed","uint",32,3],[j,"name","string",8,"StringEnd"]],stsd:[[j,"version","uint",8],[j,"flags","uint",24],[j,"entry_count","uint",32]],stsz:[[j,"version","uint",8],[j,"flags","uint",24],[j,"sample_size","uint",32],[j,"sample_count","uint",32],[C,[G,V,[M,"sample_size"],0]],[B,1,[M,"sample_count"],1],[j,"entry_size","uint",32],[F],[U]],ctts:[[j,"version","uint",8],[j,"flags","uint",24],[j,"entry_count","uint",32],[C,[G,V,[M,"version"],0]],[B,1,[M,"entry_count"],1],[j,"sample_count","uint",32],[j,"sample_offset","uint",32],[F],[N,[G,V,[M,"version"],1]],[B,1,[M,"entry_count"],1],[j,"sample_count","uint",32],[j,"sample_offset","int",32],[F],[U]],stco:[[j,"version","uint",8],[j,"flags","uint",24],[j,"entry_count","uint",32],[B,1,[M,"entry_count"],1],[j,"chunk_offset","uint",32],[F]],stsc:[[j,"version","uint",8],[j,"flags","uint",24],[j,"entry_count","uint",32],[B,1,[M,"entry_count"],1],[j,"first_chunk","uint",32],[j,"samples_per_chunk","uint",32],[j,"sample_description_index","uint",32],[F]],stts:[[j,"version","uint",8],[j,"flags","uint",24],[j,"entry_count","uint",32],[B,1,[M,"entry_count"],1],[j,"sample_count","uint",32],[j,"sample_delta","uint",32],[F]],avc1:[[j,"reverse","uint",8,6],[j,"data_reference_ID","uint",16],[j,"code_stream_version","uint",16],[j,"reverse","uint",8,14],[j,"width","uint",16],[j,"height","uint",16],[j,"horizontal_resolution","uint",32],[j,"vertical_resolution","uint",32],[j,"reverse","uint",8,4],[j,"frame_count","uint",16],[j,"compressorname","string",256],[j,"depth","uint",16],[j,"reverse","uint",8,2]],mp4a:[[j,"reverse","uint",8,6],[j,"data_reference_ID","uint",16],[j,"reverse","uint",8,8],[j,"cnannelcount","uint",16],[j,"samplesize","uint",16],[j,"reverse","uint",8,4],[j,"samplerate","uint",32]],tfhd:[[j,"version","uint",8],[j,"flags","uint",24],[j,"track_ID","uint",32],[C,[G,q,[M,"flags"],1]],[j,"base_data_offset","uint",64],[U],[C,[G,q,[M,"flags"],2]],[j,"sample_description_index","uint",32],[U],[C,[G,q,[M,"flags"],8]],[j,"default_sample_duration","uint",32],[U],[C,[G,q,[M,"flags"],16]],[j,"default_sample_size","uint",32],[U],[C,[G,q,[M,"flags"],32]],[j,"default_sample_flags","uint",32],[U]],tfdt:[[j,"version","uint",8],[j,"flags","uint",24],[C,[G,V,[M,"version"],1]],[j,"baseMediaDecodeTime","uint",64],[N],[j,"baseMediaDecodeTime","uint",32],[U]],trun:[[j,"version","uint",8],[j,"flags","uint",24],[j,"sample_count","uint",32],[C,[G,q,[M,"flags"],1]],[j,"data_offset","int",32],[U],[C,[G,q,[M,"flags"],4]],[j,"first_sample_flags","uint",32],[U],[B,1,[M,"sample_count"],1],[C,[G,q,[M,"flags"],256]],[j,"sample_duration","uint",32],[U],[C,[G,q,[M,"flags"],512]],[j,"sample_size","uint",32],[U],[C,[G,q,[M,"flags"],1024]],[j,"sample_flags","uint",32],[U],[C,[G,V,[M,"version"],0]],[C,[G,q,[M,"flags"],2048]],[j,"sample_composition_time_offset","uint",32],[U],[N],[C,[G,q,[M,"flags"],2048]],[j,"sample_composition_time_offset","int",32],[U],[U],[F]]},$=i.IDENTIFIER,W=i.IF,z=i.ELSE,K=i.ENDIF,Y=i.LOOP,X=i.ENDLOOP,Q=i.READ,J=i.BINARY,Z=i.THREE,ee=i.DECLARATION,te=i.UPDATE,re=i.ASSIGNMENT,ie=n.PLUS,ne=n.EQUAL,oe=n.OR,ae=n.UNARY_DOUBLE_PLUS,se=n.LESS_EQUAL,ue=n.UNEQUAL,ce=n.MODEL,le=n.MORE,pe={sps:[[Q,"profile_idc","u",8],[Q,"profile_compatibility","u",8],[Q,"level_idc","u",8],[Q,"seq_parameter_set_id","ue"],[W,[J,oe,[J,ne,[$,"profile_idc"],44],[J,oe,[J,ne,[$,"profile_idc"],83],[J,oe,[J,ne,[$,"profile_idc"],86],[J,oe,[J,ne,[$,"profile_idc"],100],[J,oe,[J,ne,[$,"profile_idc"],110],[J,oe,[J,ne,[$,"profile_idc"],118],[J,oe,[J,ne,[$,"profile_idc"],122],[J,oe,[J,ne,[$,"profile_idc"],128],[J,oe,[J,ne,[$,"profile_idc"],134],[J,oe,[J,ne,[$,"profile_idc"],138],[J,oe,[J,ne,[$,"profile_idc"],139],[J,ne,[$,"profile_idc"],244]]]]]]]]]]]]],[Q,"chroma_format_idc","ue"],[W,[J,ne,[$,"chroma_format_idc"],3]],[Q,"separate_colour_plane_flag","u",1],[K],[Q,"bit_depth_luma_minus8","ue"],[Q,"bit_depth_chroma_minus8","ue"],[Q,"qpprime_y_zero_transform_bypass_flag","u",1],[Q,"seq_scaling_matrix_present_flag","u",1],[W,[J,ne,[$,"seq_scaling_matrix_present_flag"],1]],[Y,[ee,"i",1],[J,ne,[$,"i"],[Z,[J,ne,[$,"chroma_format_idc"],3],12,3]],[te,ae,[$,"i"],!0]],[Q,"seq_scaling_list_present_flag","u",1],[W,[J,ne,[$,"seq_scaling_list_present_flag"],1]],[W,[J,se,[$,"i"],6]],[ee,"lastScale",8],[ee,"nextScale",8],[Y,[ee,"j",1],[J,ne,[$,"j"],16],[te,ae,[$,"j"],!0]],[W,[J,ue,[$,"nextScale"],0]],[Q,"delta_scale","se"],[re,[$,"nextScale"],[J,ce,[J,ie,[$,"lastScale"],[J,ie,[$,"lastScale"],256]],256]],[K],[re,[$,"lastScale"],[Z,[J,ne,[$,"nextScale"],0],[$,"lastScale"],[$,"nextScale"]]],[X],[z],[ee,"lastScale",8],[ee,"nextScale",8],[Y,[ee,"j",1],[J,ne,[$,"j"],64],[te,ae,[$,"j"],!0]],[W,[J,ue,[$,"nextScale"],0]],[Q,"delta_scale","se"],[re,[$,"nextScale"],[J,ce,[J,ie,[$,"lastScale"],[J,ie,[$,"lastScale"],256]],256]],[K],[re,[$,"lastScale"],[Z,[J,ne,[$,"nextScale"],0],[$,"lastScale"],[$,"nextScale"]]],[X],[K],[K],[X],[K],[K],[Q,"log2_max_frame_num_minus4","ue"],[Q,"pic_order_cnt_type","ue"],[W,[J,ne,[$,"pic_order_cnt_type"],0]],[Q,"log2_max_pic_order_cnt_lsb_minus4","ue"],[z,[J,ne,[$,"pic_order_cnt_type"],1]],[Q,"delta_pic_order_always_zero_flag","u",1],[Q,"offset_for_non_ref_pic","se"],[Q,"offset_for_top_to_bottom_field","se"],[Q,"num_ref_frames_in_pic_order_cnt_cycle","ue"],[Y,1,[$,"num_ref_frames_in_pic_order_cnt_cycle"],[Q,"offset_for_ref_frame","se"],1],[X],[K],[Q,"max_num_ref_frames","ue"],[Q,"gaps_in_frame_num_value_allowed_flag","u",1],[Q,"pic_width_in_mbs_minus1","ue"],[Q,"pic_height_in_map_units_minus1","ue"],[Q,"frame_mbs_only_flag","u",1],[W,[J,ne,[$,"frame_mbs_only_flag"],0]],[Q,"mb_adaptive_frame_field_flag","u",1],[K],[Q,"direct_8x8_inference_flag","u",1],[Q,"frame_cropping_flag","u",1],[W,[J,ne,[$,"frame_cropping_flag"],1]],[Q,"frame_crop_left_offset","ue"],[Q,"frame_crop_right_offset","ue"],[Q,"frame_crop_top_offset","ue"],[Q,"frame_crop_bottom_offset","ue"],[K],[Q,"vui_parameters_present_flag","u",1],[W,[J,ne,[$,"vui_parameters_present_flag"],1]],[Q,"aspect_ratio_info_present_flag","u",1],[W,[J,ne,[$,"aspect_ratio_info_present_flag"],1]],[Q,"aspect_ratio_idc","u",8],[W,[J,ne,[$,"aspect_ratio_idc"],255]],[Q,"sar_width","u",16],[Q,"sar_height","u",16],[K],[K],[K]],pps:[[Q,"pic_parameter_set_id","ue"],[Q,"seq_parameter_set_id","ue"],[Q,"entropy_coding_mode_flag","u",1],[Q,"bottom_field_pic_order_in_frame_present_flag","u",1],[Q,"num_slice_groups_minus1","ue"],[W,[J,le,[$,"num_slice_groups_minus1"],0]],[Q,"slice_group_map_type","ue"],[W,[J,ne,[$,"slice_group_map_type"],0]],[Y,[ee,"iGroup",0],[J,se,[$,"iGroup"],[$,"num_slice_groups_minus1"]],[te,ae,[$,"iGroup"],!0]],[Q,"run_length_minus1","ue"],[X],[z,[J,ne,[$,"slice_group_map_type"],2]],[Y,[ee,"iGroup",1],[J,se,[$,"iGroup"],[$,"num_slice_groups_minus1"]],[te,ae,[$,"iGroup"],!0]],[Q,"top_left","ue"],[Q,"bottom_right","ue"],[X],[z,[J,oe,[J,ne,[$,"slice_group_map_type"],3],[J,oe,[J,ne,[$,"slice_group_map_type"],4],[J,ne,[$,"slice_group_map_type"],5]]]],[Q,"slice_group_change_direction_flag","u",1],[Q,"slice_group_change_rate_minus1","ue"],[z,[J,ne,[$,"slice_group_map_type"],6]],[ee,"read_bits",1],[W,[J,le,[J,ie,[$,"num_slice_groups_minus1"],1],4]],[re,[$,"read_bits"],3],[z,[J,le,[J,ie,[$,"num_slice_groups_minus1"],1],2]],[re,[$,"read_bits"],2],[K],[Q,"pic_size_in_map_units_minus1","ue"],[Y,[ee,"i",0],[J,se,[$,"i"],[$,"pic_size_in_map_units_minus1"]],[te,ae,[$,"i"],!0]],[Q,"slice_group_id","u",[$,"read_bits"]],[X],[K],[K],[Q,"num_ref_idx_l0_default_active_minus1","ue"],[Q,"num_ref_idx_l1_default_active_minus1","ue"],[Q,"weighted_pred_flag","u",1],[Q,"weighted_bipred_idc","u",2],[Q,"pic_init_qp_minus26","se"],[Q,"pic_init_qs_minus26","se"],[Q,"chroma_qp_index_offset","se"],[Q,"deblocking_filter_control_present_flag","u",1],[Q,"constrained_intra_pred_flag","u",1],[Q,"redundant_pic_cnt_present_flag","u",1]]},de=function(){function e(e){this.streamReader=e,this.clearContext()}return e.prototype.read=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(e.length<2)throw new Error("wrong num of read params.");var r=e[0],i=e[1],n=e[2],o=typeof n;switch(o){case"undefined":switch(r){case"uint":return this.streamReader.readUintByBits(i);case"int":return this.streamReader.readIntByBits(i);case"string":return this.streamReader.readString(Math.floor(i/8));default:throw new Error("wrong read type")}case"number":switch(r){case"uint":for(var a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"string":switch(n){case"BoxEnd":switch(r){case"uint":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"FileEnd":switch(r){case"uint":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"StringEnd":s="";for(var c=this.streamReader.readString(1);"\0"!==c;)s+=c,c=this.streamReader.readString(1);return s;default:throw new Error("wrong read flag")}default:throw new Error("wrong read flag type")}},e.prototype.get=function(e){return this.context[e]},e.prototype.set=function(e,t){this.context[e]=t},e.prototype.clearContext=function(){this.context={}},e}(),he=function(){function e(e){this.golombReader=e}return e.prototype.read=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],i=e[1];switch(r){case"u":return this.golombReader.readBits(i);case"se":return this.golombReader.readEG();case"ue":return this.golombReader.readUEG();default:throw new Error("wrong read type")}},e.prototype.get=function(e){return this.context[e]},e.prototype.set=function(e,t){this.context[e]=t},e.prototype.clearContext=function(){this.context={}},e}(),fe=function(){function e(e){this.boxQueue=[],this.boxMap={},this.streamReader=e,this.mp4Reader=new de(e),this.parser=new I(this.mp4Reader)}return e.prototype.parse=function(){for(;!this.streamReader.isEos();){this.parser.setProgram(H.box),this.mp4Reader.set("boxBegin",this.streamReader.getPosition());try{var e=this.parser.getResult();if(1===e.size?this.mp4Reader.set("boxEnd",this.mp4Reader.get("boxBegin")+e.largesize):0===e.size?this.mp4Reader.set("boxEnd",this.streamReader.getEndPosition()):this.mp4Reader.set("boxEnd",this.mp4Reader.get("boxBegin")+e.size),void 0===H[e.boxtype]){this.streamReader.setPosition(this.mp4Reader.get("boxEnd"));var t=o(o({},e),{boxBegin:this.mp4Reader.get("boxBegin"),boxEnd:this.mp4Reader.get("boxEnd"),children:[],parent:null});this.push(t);continue}this.parser.setProgram(H[e.boxtype]);var r=this.parser.getResult(),i=o(o(o(o({},e),{boxBegin:this.mp4Reader.get("boxBegin"),boxEnd:this.mp4Reader.get("boxEnd")}),r),{children:[],parent:null});this.push(i)}catch(e){this.streamReader.setPosition(this.mp4Reader.get("boxBegin"));break}}},e.prototype.getBoxTree=function(){return this.boxQueue.filter((function(e){return null===e.parent}))},e.prototype.getBoxMap=function(){return this.boxMap},e.prototype.write=function(e){this.streamReader.append(e)},e.prototype.push=function(e){if(e.boxEnd>this.streamReader.getEndPosition())throw new Error("box ".concat(e.boxtype," length is too long."));var t=e.boxtype;if(this.boxMap[t]){var r=this.boxMap[t];Array.isArray(r)?r.push(e):this.boxMap[t]=[r,e]}else this.boxMap[t]=e;if(0!==this.boxQueue.length){var i=this.boxQueue[this.boxQueue.length-1];if(i.boxEnd>=e.boxEnd)i.children.push(e),e.parent=i,this.boxQueue.push(e);else{for(;i&&i.boxEnd<e.boxEnd;)i=i.parent;i&&i.children.push(e),e.parent=i,this.boxQueue.push(e)}}else this.boxQueue.push(e)},e}(),me=function(e,t){switch(t){case 0:return 0;case 1:return 1&e;case 2:return 3&e;case 3:return 7&e;case 4:return 15&e;case 5:return 31&e;case 6:return 63&e;case 7:return 127&e;case 8:return e;default:throw new Error("wrong length.")}},ye=function(){function e(e){this.position=0,this.bitPosition=0,this.buffer=e,this.dataview=new DataView(e)}return e.prototype.append=function(e){var t=this.buffer,r=new Uint8Array(t.byteLength+e.byteLength);r.set(new Uint8Array(t)),r.set(new Uint8Array(e),t.byteLength),this.buffer=r.buffer,this.dataview=new DataView(this.buffer)},e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(e,t){this.position=e,this.bitPosition=void 0===t?0:t},e.prototype.getEndPosition=function(){return this.buffer.byteLength},e.prototype.getLength=function(){return this.buffer.byteLength},e.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},e.prototype.readUintByBits=function(e){if(e<=0)throw new Error("error size when reading uint by bits.");var t=this.dataview.getUint8(this.position),r=8-this.bitPosition,i=0;if(!(e>=r))return i=me(i=t>>r-e,e),this.bitPosition+=e,i;for(i=me(t,r),this.position++,this.bitPosition=0,e-=r;!this.isEos()&&e>=8;)i=i<<8|this.dataview.getUint8(this.position),e-=8,this.position++;return!this.isEos()&&e>0&&(i=i<<e|(t=this.dataview.getUint8(this.position))>>8-e,this.bitPosition+=e),i>>>0},e.prototype.readIntByBits=function(e){var t=e;if(e<=1)throw new Error("error size when reading int by bits.");var r=this.dataview.getUint8(this.position),i=!0,n=8-this.bitPosition,o=0;if(!(e>=n))return i=(o=me(o=r>>n-e,e))>>e-1==0,this.bitPosition+=e,i||(o=~(o-=1)&(1<<e)-1),i?me(o,e-1):-me(o,e-1);for(i=(o=me(r,n))>>n-1==0,o=me(o,n-1),this.position++,this.bitPosition=0,e-=n;!this.isEos()&&e>=8;)o=o<<8|this.dataview.getUint8(this.position),e-=8,this.position++;return!this.isEos()&&e>0&&(o=o<<e|(r=this.dataview.getUint8(this.position))>>8-e,this.bitPosition+=e),i||(o=~(o=o-1&(1<<t-1)-1)&(1<<t-1)-1),i?o:-o},e.prototype.readAnyInt=function(e,t){if(0!==this.bitPosition)return t?this.readIntByBits(8*e):this.readUintByBits(8*e);var r=0;if(this.position+e<=this.buffer.byteLength){switch(e){case 1:r=t?this.dataview.getInt8(this.position):this.dataview.getUint8(this.position);break;case 2:r=t?this.dataview.getInt16(this.position):this.dataview.getUint16(this.position);break;case 3:if(t)throw new Error("No method for reading signed 24 bits values");r=this.dataview.getUint8(this.position)<<16,r|=this.dataview.getUint8(this.position+1)<<8,r|=this.dataview.getUint8(this.position+2);break;case 4:r=t?this.dataview.getInt32(this.position):this.dataview.getUint32(this.position);break;case 8:if(t)throw new Error("No method for reading signed 64 bits values");r=this.dataview.getUint32(this.position)<<32,r|=this.dataview.getUint32(this.position+4);break;default:throw new Error("readInt method not implemented for size: ".concat(e))}return this.position+=e,r}throw new Error("Not enough bytes in buffer")},e.prototype.readUint8=function(){return this.readAnyInt(1,!1)},e.prototype.readUint16=function(){return this.readAnyInt(2,!1)},e.prototype.readUint24=function(){return this.readAnyInt(3,!1)},e.prototype.readUint32=function(){return this.readAnyInt(4,!1)},e.prototype.readUint64=function(){return this.readAnyInt(8,!1)},e.prototype.readString=function(e){if(this.position+e<=this.buffer.byteLength){for(var t="",r=0;r<e;r++)t+=String.fromCharCode(this.readUint8());return t}throw new Error("Not enough bytes in buffer")},e.prototype.readCString=function(){for(var e=[];;){var t=this.readUint8();if(0===t)break;e.push(t)}return String.fromCharCode.apply(null,e)},e.prototype.readInt8=function(){return this.readAnyInt(1,!0)},e.prototype.readInt16=function(){return this.readAnyInt(2,!0)},e.prototype.readInt32=function(){return this.readAnyInt(4,!0)},e.prototype.readInt64=function(){return this.readAnyInt(8,!1)},e.prototype.readUint8Array=function(e){for(var t=new Uint8Array(e),r=0;r<e;r++)t[r]=this.readUint8();return t},e.prototype.readInt16Array=function(e){for(var t=new Int16Array(e),r=0;r<e;r++)t[r]=this.readInt16();return t},e.prototype.readUint16Array=function(e){for(var t=new Int16Array(e),r=0;r<e;r++)t[r]=this.readUint16();return t},e.prototype.readUint32Array=function(e){for(var t=new Uint32Array(e),r=0;r<e;r++)t[r]=this.readUint32();return t},e.prototype.readInt32Array=function(e){for(var t=new Int32Array(e),r=0;r<e;r++)t[r]=this.readInt32();return t},e}(),ge=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},e.prototype.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},e.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),ve=function(){function e(e){this.streamReader=e instanceof Uint8Array?new ge(e):e,this.xpsReader=new he(this.streamReader),this.parser=new I(this.xpsReader)}return e.prototype.parse=function(e){if(void 0===pe[e])throw new Error("dont support this type.");return this.parser.setProgram(pe[e]),this.parser.getResult()},e}()},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=void 0,function(e){e.AUDIO="audio",e.VIDEO="video",e.MIXED="mixed",e.CLOSED_CAPTION="cc",e.SUBTITLE="subtitle",e.METADATA="meta",e.TEXT="text",e.UNKNOWN="unknown"}(i||(i={})),t.MediaType=i},function(e,t,r){"use strict";var i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.DataType=t.URISchema=void 0,function(e){e.HTTP="http://",e.WEBSOCKET="websocket://",e.WEBRTC="webrtc://",e.LITERAL="literal://",e.BLOB="blob://"}(i||(i={})),t.URISchema=i,function(e){e.ARRAYBUFFER="arrayBuffer",e.JSON="json",e.TEXT="text",e.BLOB="blob"}(ne||(t.NALUnitType={}))},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.littleEndian=t.isSafari=void 0,t.isSafari=/(Version\/[\d.]+\s*Safari\/[\d.]+)|Web0S/i.test(navigator.userAgent),t.littleEndian=(i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0),256===new Int16Array(i)[0])},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DownLoadMode=void 0;var n,o=r(13),a=i(r(5)),s=i(r(84)),u=i(r(86)),c=i(r(87)),l=r(18);!function(e){e.FETCH="FETCH",e.XHR="XHR",e.PROXY="PROXY"}(n=t.DownLoadMode||(t.DownLoadMode={}));var p=function(){function e(e,t){this.loaderConfig=t||{},this.loaderConfig.loaderType=e||"",this.loaderConfig.proxyOn=!(!t||!t.proxy),this.maxLoaderRunning=1,this.segmentsByteLength=0,this.maxConcurrentNum=t.maxConcurrentNum||2,this.loaderWaitingList=[],this.loaderRunningList=[],this.ID="Loader"}return e.prototype.addMonitor=function(e){this.monitor=e},Object.defineProperty(e.prototype,"config",{get:function(){return this.loaderConfig},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this.downloadMode},enumerable:!1,configurable:!0}),e.prototype.setConfig=function(e){this.loaderConfig=Object.assign({},this.loaderConfig,e)},Object.defineProperty(e.prototype,"totalByteLength",{get:function(){return this.segmentsByteLength},enumerable:!1,configurable:!0}),e.prototype.cleanByteLength=function(){this.segmentsByteLength=0},e.prototype.request=function(e,t){var r,i=this;if(!e.schema)throw new Error("invalid schema");if(!e.location)throw new Error("invalid uri");if(!e.dataType)throw new Error("invalid dataType");return t||(t={}),t=Object.setPrototypeOf(t,this.loaderConfig),e.schema===o.URISchema.LITERAL?r=new c.default(e,t):"function"==typeof fetch&&"function"==typeof ReadableStream&&"function"==typeof AbortController?(this.downloadMode=n.FETCH,r=new u.default(e,t,this.monitor)):(this.downloadMode=n.XHR,r=new s.default(e,t,this.monitor)),r.on(a.default.ERROR,(function(e){i.loaderRunningList=i.loaderRunningList.filter((function(e){return e.id!=r.id||e.mediaType!=r.mediaType})),i.setRequest()})),r.on(a.default.START,(function(){r.isDestroy||r.isAbort||r.isRunning||(i.monitor&&i.monitor.recordStep(l.StepType.SEGMENT_LOADING,r.id),r.request())})),r.on(a.default.CONCURRENT,(function(){if(i.loaderWaitingList.length>0&&i.loaderRunningList.length<i.maxConcurrentNum){i.monitor&&i.monitor.recordStep(l.StepType.SEGMENT_DEGRADE,r.id);var e=i.loaderWaitingList.shift();i.loaderRunningList.push(e),e.emit(a.default.START)}})),this.loaderRunningList=this.loaderRunningList.filter((function(e){return!e.isDestroy&&!e.isAbort})),this.loaderWaitingList=this.loaderWaitingList.filter((function(e){return!e.isDestroy&&!e.isAbort})),r.on(a.default.META,(function(e){e.total&&(i.segmentsByteLength+=e.total)})),r.on(a.default.FINISH,(function(e){e&&(i.downloadMode=e),i.monitor&&i.monitor.recordStep(l.StepType.SEGMENT_DOWNLOAD,r.id),i.loaderRunningList=i.loaderRunningList.filter((function(e){return e.id!=r.id||e.mediaType!=r.mediaType})),i.setRequest()})),this.loaderRunningList.length<this.maxLoaderRunning&&0===this.loaderWaitingList.length?(this.loaderRunningList.push(r),r.emit(a.default.START)):this.loaderWaitingList.push(r),r},e.prototype.setRequest=function(){if(this.loaderRunningList=this.loaderRunningList.filter((function(e){return!e.isDestroy&&!e.isAbort})),this.loaderWaitingList=this.loaderWaitingList.filter((function(e){return!e.isDestroy&&!e.isAbort})),this.loaderRunningList.length<this.maxLoaderRunning&&this.loaderWaitingList.length>0){var e=this.loaderWaitingList.shift();this.loaderRunningList.push(e),e.emit(a.default.START)}},e.prototype.cancelProxy=function(){this.loaderConfig.proxy&&(this.loaderConfig.proxyOn=!1,this.loaderConfig.proxy.cancelProxy())},e.prototype.addProxy=function(e){e&&(this.loaderConfig.proxy=e),this.loaderConfig.proxyOn=!0,this.loaderConfig.proxy.addProxy()},e.prototype.sendRequest=function(){if(this.loaderWaitingList=this.loaderWaitingList.filter((function(e){return!e.isDestroy&&!e.isAbort})),this.loaderWaitingList.length>0){var e=this.loaderWaitingList.shift();this.loaderRunningList.push(e),e.emit(a.default.START)}},e.prototype.destroy=function(){this.loaderRunningList.forEach((function(e){e.destroy()})),this.loaderWaitingList.length=0,this.loaderRunningList.length=0,this.segmentsByteLeng||(t.DecoderEvent={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StepType=t.ActionType=void 0;var i=r(85);!function(e){e[e.LOAD_SOURCE=0]="LOAD_SOURCE",e[e.PLAY=1]="PLAY",e[e.PLAYING=2]="PLAYING",e[e.WAITING=3]="WAITING",e[e.SEEK=4]="SEEK",e[e.SEEKED=5]="SEEKED",e[e.CANPLAY=6]="CANPLAY",e[e.PAUSE=7]="PAUSE",e[e.ENDED=8]="ENDED",e[e.ERROR=9]="ERROR"}(t.ActionType||(t.ActionType={})),function(e){e[e.MANIFEST_DOWNLOAD=0]="MANIFEST_DOWNLOAD",e[e.LEVEL_DOWNLOAD=1]="LEVEL_DOWNLOAD",e[e.LEVEL_CHANGE=2]="LEVEL_CHANGE",e[e.CHECK_BUFFER=3]="CHECK_BUFFER",e[e.WAITING_CHECK_BUFFER=4]="WAITING_CHECK_BUFFER",e[e.INIT_CHECK_BUFFER=5]="INIT_CHECK_BUFFER",e[e.TRACK_CHECK_BUFFER=6]="TRACK_CHECK_BUFFER",e[e.IDLE_CHECK_BUFFER=7]="IDLE_CHECK_BUFFER",e[e.RESET_CURRENT_PUMPING=8]="RESET_CURRENT_PUMPING",e[e.SEGMENT_CHECK_BUFFER=9]="SEGMENT_CHECK_BUFFER",e[e.SEGMENT_LOADING=10]="SEGMENT_LOADING",e[e.SEGMENT_DEGRADE=11]="SEGMENT_DEGRADE",e[e.SEGMENT_DOWNLOAD=12]="SEGMENT_DOWNLOAD",e[e.SEGMENT_ERROR=13]="SEGMENT_ERROR",e[e.RESUME_FROM_BREAK_POINT=14]="RESUME_FROM_BREAK_POINT",e[e.SEGMENT_APPENDING=15]="SEGMENT_APPENDING",e[e.SEGMENT_APPENDED=16]="SEGMENT_APPENDED",e[e.SEGMENT_DRAINED=17]="SEGMENT_DRAINED",e[e.SEGMENT_PRELOAD=18]="SEGMENT_PRELOAD",e[e.MEDIA_READY=19]="MEDIA_READY",e[e.SEGMENT_META=20]="SEGMENT_META",e[e.BUFFER_OVERFLOW=21]="BUFFER_OVERFLOW",e[e.P2P_ERROR=22]="P2P_ERROR",e[e.P2P_TIMEOUT=23]="P2P_TIMEOUT",e[e.STOCK_ABORT=24]="STOCK_ABORT",e[e.STOCK_DESTROY=25]="STOCK_DESTROY",e[e.STREAM_REQUEST=26]="STREAM_REQUEST",e[e.STREAM_RETRY=27]="STREAM_RETRY",e[e.HTTP_REQUEST=28]="HTTP_REQUEST",e[e.P2P_REQUEST=29]="P2P_REQUEST",e[e.FATAL_ERROR=30]="FATAL_ERROR",e[e.ABORT_ERROR=31]="ABORT_ERROR",e[e.RANGE_ERROR=32]="RANGE_ERROR"}(t.StepType||(t.StepType={}));var n=function(){function e(){this.store={baseTs:Date.now(),actions:[],steps:[],speeds:[]}}return e.prototype.recordAction=function(e){this.store.actions.push([e,Date.now()-this.store.baseTs]),this.store.actions.length>100&&this.store.actions.shift()},e.prototype.recordStep=function(e,t){var r=this.store.steps[this.store.steps.length-1];r&&r[0]===e&&r[1]===t?(r[3]++,r[2]=Date.now()-this.store.baseTs):this.store.steps.push([e,t,Date.now()-this.store.baseTs,0]),this.store.steps.length>100&&this.store.steps.shift()},e.prototype.recordSpeed=function(e){this.store.speeds.push(e),this.store.speeds.length>50&&this.store.speeds.shift()},e.prototype.decodeMonitor=function(e,t){var r=i.decodeMonitor(e,"action"),n=i.decodeMonitor(t,"step"),o=r.concat(n);return o.sort((function(e,t){return e[2]-t[2]})),o},e.prototype.getActions=function(){return i.decodeSemantic(this.store.actions,"action"is.store.steps,"step")},e.prototype.getSummary=function(){return{actions:this.store.actions.map((function(e){return e.map((function(e){return i.encodeNumber(e)})).join(".")})).join("!"),stepNumber(e)})).join(".")})).join("!"),speeds:o(this.store.speeds).join("!")}},e.prototype.destroy=function(){delete this.store},e}();function o(e,t){void 0===t&&(t=.2);var r=e[0],i=[r],n=[];return e.forEach((function(e){Math.abs(e-r)/r<t||Math.abs(e-r)<5?(r=(r*i.length+e)/(i.length+1),i.push(e)):(n.push(Math.round(r)),i=[e],r=e)})),i.length>0&&n.push(Math.round(r)),n}t.default=n},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(103),t),n(r(104),t)},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=t.XError=t.Signal=void 0;var n=i(r(43));t.Signal=n.default;var o=i(r(21));t.XError=o.default;var a=r(44);Object.defineProperty(t,"Filter",{enumerable:!0,get:function(){return a.Filter}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorSeverity=void 0,void 0===window.__XERROR__&&(window.__XERROR__={}),void 0===window.__XERROR_WORDS__&&(window.__XERROR_WORDS__={});var i,n=window.__XERROR__,o=window.__XERROR_WORDS__,a=0;function s(e){var t=Object.keys(o).length+1;return o[e]||(o[e]=t),c(t=o[e])}!function(e){e[e.RECOVERABLE=0]="RECOVERABLE",e[e.CRITICAL=1]="CRITICAL",e[e.FATAL=2]="FATAL"}(i=t.ErrorSeverity||(t.ErrorSeverity={}));var u=function(){function e(e,t,r,i){var n=this;if(3!==e.length)throw new Error("subjectCode of XError must be a three letter word");if(3!==t.length)throw new Error("subtitleCode of XError must be a three letter word");this.subjectCode=e.toUpperCase(),this.subtitleCode=t.toUpperCase(),this.presetMessages=Object.keys(r).reduce((function(e,t){return r[t]=n.subjectCode+n.subtitleCode+c(r[t]),e[r[t]]="object"==typeof i?i?i[t]:"":(i?i+" ":"")+t.replace(/_/g," ").toLowerCase()+"${status}",e}),{})}return e.registerError=function(t,r,i,a){var s,u,c,l=new e(t,r,i,a);if(n[t]&&n[r])throw new Error("XError ["+t+"-"+r+" has existed!");return s=t,u=r,c=Object.keys(o).length+1,o[s]||(o[s]=c++),o[u]||(o[u]=c),n[t]||(n[t]={}),n[t][t]||(n[t][t]={}),n[t][t]=l,l},e.is=function(e,t){return e.error==t},e.prototype.is=function(e,t){},e.prototype.getMessage=function(e,t,r,i){return t||this.presetMessages[e].replace(/\${([\w\d]+)}/g,(function(e,t){return new Function("status,traceInfo","try{return ':'+"+t+"||''}catch(e){return ''}")(r,i)}))},e.create=function(e,t,r,i,n,o,s){var u=new Error(i);return u.name=e+"Error",u.code=e+t+"00",u.no=1e6+a++,u.status=n,u.traceInfo=o,u.severity=r,u.extension=s,u},e.prototype.of=function(e,t,r,i,n,o){var a=new Error(this.getMessage(e,r,i,n));return a.name=this.subjectCode+"Error",a.code=e,a.no=Number(s(this.subjectCode)+s(this.subtitleCode)+e.slice(-2)),a.status=i,a.traceInfo=n,a.severity=t,a.extension=o,a},e.Severity=i,e}();function c(e){return e<10?"0"+e:""+e}t.default=u},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataType=t.EncryptMethodType=t.URISchema=t.MediaType=t.PlayerFeature=t.ContainerFormat=void 0;var n=i(r(57));t.ContainerFormat=n.default;var o=i(r(58));t.PlayerFeature=o.default;var a=r(12);Object.defineProperty(t,"MediaType",{enumerable:!0,get:function(){return a.MediaType}});var s=r(13);Object.defineProperty(t,"URISchema",{enumerable:!0,get:function(){return s.URISchema}}),Object.defineProperty(t,"DataType",{enumerable:!0,get:function(){return s.DataType}});var u=r(59);Object.defineProperty(t,"EncryptMethodType",{enumerable:!0,get:function(){return u.EncryptMethodType}})},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),o=r(3),a=r(9),s=r(0),u=i(r(77)),c=function(){function e(){this.packetList=[],this.initData()}return e.probe=function(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),!!o.isArrayBufferView(e)&&function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1}(e)>=0},e.prototype.initData=function(){this.Flushed=!1,this.streams=[],this.pmtFinding=!1,this.packetsWaitingForPmt=[],this.programMapTable=void 0,this.lastPesType=null,this.clean()},e.prototype.createStream=function(e,t,r){if(!this.streams.filter((function(t){return t.type===e}))[0]){var i=new a.Stream(e,t,9e4,r);i.NeedParse=!0,i.index=this.streams.length,this.streams.push(i)}},e.prototype.write=function(e){this.data=e,this.streams.forEach((function(e){return e.reset()})),this.Flushed=!1},e.prototype.startDemux=function(){var e;for(0!=this.remainBuffer.byteLength?((e=new Uint8Array(this.data.byteLength+this.remainBuffer.byteLength)).set(this.remainBuffer),e.set(this.data,this.remainBuffer.byteLength),this.remainBuffer=new Uint8Array(0),this.data=e):e=this.data;this.endIndex<e.byteLength&&!this.pmtFinding&&0===this.packetList.length;)71!==e[this.startIndex]||71!==e[this.endIndex]?(this.startIndex++,this.endIndex++):(this.parsePacket(e.subarray(this.startIndex,this.endIndex)),this.startIndex+=188,this.endIndex+=188);this.startIndex<e.byteLength&&this.endIndex>=e.byteLength&&(this.remainBuffer=new Uint8Array(e.byteLength-this.startIndex),this.remainBuffer.set(e.subarray(this.startIndex),0),this.data=new Uint8Array(0),this.startIndex=0,this.endIndex=188)},e.prototype.parsePacket=function(e){var t=4,r=!!(64&e[1]),i=31&e[1];if(i<<=8,i|=e[2],(48&e[3])>>>4>1&&(t+=e[t]+1),0===i)this.pmtPid=u.default.parsePAT(e,t,r);else if(i===this.pmtPid){0===this.streams.length&&(this.pmtFinding=!0);var o=this.programMapTable=u.default.parsePMT(e,t,r);for(o&&null!=o.video&&this.createStream(n.MediaType.VIDEO,u.default.StreamType2CodecID[o.videoStreamType],o.video),o&&null!=o.audio&&this.createStream(n.MediaType.AUDIO,u.default.StreamType2CodecID[o.audioStreamType],o.audio);this.packetsWaitingForPmt.length;)this.processPes.apply(this,this.packetsWaitingForPmt.shift())}else void 0===this.programMapTable?this.packetsWaitingForPmt.push([e,t,i,r]):this.processPes(e,t,i,r)},e.prototype.processPes=function(e,t,r,i){var n={PUSI:i};r===this.programMapTable.video?n.streamType=this.programMapTable.videoStreamType:r===this.programMapTable.audio?n.streamType=this.programMapTable.audioStreamType:n.streamType=this.programMapTable.timedMetadata[r],n.data=e.subarray(t),this.writePes(n)},e.prototype.writePes=function(e){var t=u.default.getStreamInfo(e.streamType),r=this.streamBuffer[t];r&&(e.PUSI&&(this.writePacket(r,t,!0),this.lastPesType=t),r.data.push(e),r.size+=e.data.byteLength)},e.prototype.writePacket=function(e,t,r,i){var a;if(e.data.length&&!(e.size<9)){var c=o.mergeBuffers(e.data.map((function(e){return e.data})),e.size),l=u.default.assembleESData(c);a=t===n.MediaType.VIDEO||this.getPacketLength(c)<=e.size,(r||a)&&(e.size=0,e.data=[]),t===n.MediaType.VIDEO?l.bsf=s.BitstreamFormat.ANNEX_B:l.bsf=s.BitstreamFormat.ADTS;var p=this.streams&&this.streams.filter((function(e){return e.type===t}))[0];p&&(l.streamIndex=p.index,l.timestamp=Math.round(1e6*l.pts/p.timescale),l.isLast=i,a&&this.packetList.push(l))}},e.prototype.getPacketLength=function(e){return 6+(e[4]<<8|e[5])},e.prototype.flushPacket=function(){var e=this;this.lastPesType=null,Object.keys(this.streamBuffer).forEach((function(t){e.writePacket(e.streamBuffer[t],t,!1,!0)}))},e.prototype.findAllStream=function(){return this.startDemux(),this.pmtFinding=!1,this.streams},e.prototype.findStream=function(e){return this.streams&&this.streams.filter((function(t){return t.type===e}))[0]},e.prototype.readPacket=function(){return 0===this.packetList.length&&this.startDemux(),this.packetList.shift()},e.prototype.seek=function(e,t){throw new Error("Method not implemented.")},e.prototype.reset=function(){this.initData()},e.prototype.clean=function(){var e;this.remainBuffer=new Uint8Array(0),this.streamBuffer=((e={})[n.MediaType.VIDEO]={data:[],size:0},e[n.MediaType.AUDIO]={data:[],size:0},e[n.MediaType.METADATA]={data:[],size:0},e),this.pmtPid=void 0,this.packetList=[],this.endIndex=188,this.startIndex=0},e.prototype.flush=function(){var e;188===this.remainBuffer.byteLength&&71===this.remainBuffer[0]&&this.parsePacket(this.remainBuffer),this.flushPacket(),this.remainBuffer=new Uint8Array(0),this.streamBuffer=((e={})[n.MediaType.VIDEO]={data:[],size:0},e[n.MediaType.AUDIO]={data:[],size:0},e[n.MediaType.METADATA]={data:[],size:0},e),this.Flushed=!0},e}();t.default=c},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(25)),o=function(){function e(){}return e.skipScalingList=function(e,t){var r,i=8,n=8;for(r=0;r<e;r++)0!==n&&(n=(i+t.readExpGolomb()+256)%256),i=0===n?i:n},e.discardEmulationPreventionBytes=function(e){for(var t=e.byteLength,r=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;var n=t-r.length,o=new Uint8Array(n),a=0;for(i=0;i<n;a++,i++)a===r[0]&&(a++,r.shift()),o[i]=e[a];return o},e.readSequenceParameterSet=function(t){var r,i,o,s,u,c,l,p,d,h,f,m,y=0,g=0,v=0,b=0,E=0,_=[1,1];try{if(i=(r=new n.default(t)).readUnsignedByte(),s=r.readUnsignedByte(),o=r.readUnsignedByte(),r.skipUnsignedExpGolomb(),a[i]&&(3===(u=r.readUnsignedExpGolomb())&&r.skipBits(1),r.skipUnsignedExpGolomb(),r.skipUnsignedExpGolomb(),r.skipBits(1),r.readBoolean()))for(f=3!==u?8:12,m=0;m<f;m++)r.readBoolean()&&(m<6?e.skipScalingList(16,r):e.skipScalingList(64,r));if(r.skipUnsignedExpGolomb(),0===(c=r.readUnsignedExpGolomb()))r.readUnsignedExpGolomb();else if(1===c)for(r.skipBits(1),r.skipExpGolomb(),r.skipExpGolomb(),l=r.readUnsignedExpGolomb(),m=0;m<l;m++)r.skipExpGolomb();if(r.skipUnsignedExpGolomb(),r.skipBits(1),p=r.readUnsignedExpGolomb(),d=r.readUnsignedExpGolomb(),0===(h=r.readBits(1))&&r.skipBits(1),r.skipBits(1),r.readBoolean()&&(y=r.readUnsignedExpGolomb(),v=r.readUnsignedExpGolomb(),b=r.readUnsignedExpGolomb(),E=r.readUnsignedExpGolomb()),r.readBoolean()&&r.readBoolean()){switch(r.readUnsignedByte()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[r.readUnsignedByte()<<8|r.readUnsignedByte(),r.readUnsignedByte()<<8|r.readUnsignedByte()]}if(r.readBoolean()&&r.readBoolean(),r.readBoolean()&&(r.readBits(4),r.readBoolean()&&r.readBits(24)),r.readBoolean()&&(r.readUEG(),r.readUEG()),r.readBoolean()){var R=r.readBits(32),S=r.readBits(32);r.readBoolean()&&0!==R&&0!==S&&(g=2*R/S*1e3)}_&&(_[0],_[1])}}catch(e){if(this.lastSPSConfig)return this.lastSPSConfig;throw e}var A={profile:i,level:o,sarRatio:_,profileCompatibility:s,width:Math.ceil(16*(p+1)-2*y-2*v),height:(2-h)*(d+1)*16-2*b-2*E};return g>0&&(A.sampleDuration=g),this.lastSPSConfig=A,A},e.lastSPSConfig=null,e}();t.default=o;var a={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._workingData=e,this._workingBytesAvailable=e.byteLength,this._workingBitsAvailable=0,this._workingWord=0,this.loadWord()}return e.prototype.length=function(){return 8*this._workingBytesAvailable},e.prototype.bitsAvailable=function(){return 8*this._workingBytesAvailable+this._workingBitsAvailable},e.prototype.loadWord=function(){var e=this._workingData.byteLength-this._workingBytesAvailable,t=new Uint8Array(4),r=Math.min(4,this._workingBytesAvailable);if(0===r)throw new Error("no bytes available");t.set(this._workingData.subarray(e,e+r)),this._workingWord=new DataView(t.buffer).getUint32(0),this._workingBitsAvailable=8*r,this._workingBytesAvailable-=r},e.prototype.skipBits=function(e){var t;this._workingBitsAvailable>e?(this._workingWord<<=e,this._workingBitsAvailable-=e):(e-=this._workingBitsAvailable,e-=8*(t=Math.floor(e/8)),this._workingBytesAvailable-=t,this.loadWord(),this._workingWord<<=e,this._workingBitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this._workingBitsAvailable,e),r=this._workingWord>>>32-t;return this._workingBitsAvailable-=t,this._workingBitsAvailable>0?this._workingWord<<=t:this._workingBytesAvailable>0&&this.loadWord(),(t=e-t)>0?r<<t|this.readBits(t):r},e.prototype.skipLeadingZeros=function(){var e;for(e=0;e<this._workingBitsAvailable;++e)if(0!=(this._workingWord&2147483648>>>e))return this._workingWord<<=e,this._workingBitsAvailable-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},e.prototype.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},e.prototype.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},e.prototype.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},e.prototype.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUnsignedByte=function(){return this.readBits(8)},e.prototype.destroy=function(){this._workingData=null},e}();t.default=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(27),a=r(17),s=function(e){function t(){var t=e.call(this)||this;return t._flushed=!1,t.decoder=new VideoDecoder({output:function(e){t.emit(a.DecoderEvent.DATA,e)},error:function(e){console.error(e),t.emit(a.DecoderEvent.ERROR,e)}}),t.emit(a.DecoderEvent.READY),t}return n(t,e),Object.defineProperty(t.prototype,"Flushed",{get:function(){return this._flushed},enumerable:!1,configurable:!0}),t.prototype.configure=function(e,t,r,i){this._flushed=!1;var n={codec:t,description:i};Object.assign(n,r),this.decoder.configure(n)},t.prototype.decode=function(e,t){void 0===t&&(t=1),this._flushed=!1;var r=new EncodedVideoChunk({data:e.data,timestamp:e.timestamp,type:e.key?"key":"delta",duration:e.durationTime});this.decoder.decode(r),this.decoder.decodeQueueSize>10&&this.emit(a.DecoderEvent.OVERFLOW,this.decoder.decodeQueueSize)},t.prototype.flush=function(){var e=this;return console.log("flushing!"),this.decoder.flush().then((function(){e._flushed=!0,console.log("flushed!",e.decoder.decodeQueueSize),e.emit(a.DecoderEvent.FLUSHED)}))},t.prototype.reset=function(){},t.prototype.destroy=function(){},t}(o.EventBus);t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventBus=void 0;var i=function(){function e(){this.handlers={},this.onceMap={}}return e.prototype.off=function(e,t){return t?this.handlers[e]&&(this.handlers[e]=this.handlers[e].filter((function(e){return e!==t}))):e?(this.handlers[e]=[],this.onceMap[e]={}):(this.handlers={},this.onceMap={}),this},e.prototype.once=function(e,t,r){var i=this,n=!1,o=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];i.off(e,o),i.onceMap[e]&&i.onceMap[e][r]&&delete i.onceMap[e][r],n||(n=!0,t.apply(void 0,a))};return r&&(this.onceMap[e]?this.onceMap[e][r]&&this.off(e,this.onceMap[e][r]):this.onceMap[e]={},this.onceMap[e][r]=o),this.on(e,o)},e.prototype.addEventListener=function(e,t){return this.on(e,t)},e.prototype.removeEventListener=function(e,t){return this.off(e,t)},e.prototype.on=function(e,t,r){return this.handlers[e]?isFinite(r)?this.handlers[e].splice(r,0,t):this.handlers[e].push(t):this.handlers[e]=[t],this},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=this.handlers[e];if(i&&i.length>0){var n=i.concat();n.forEach((function(e){e.apply(void 0,t)}))}},e}();t.EventBus=i},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(70));function o(e){var t=e.read(5);return 31==t&&(t=32+e.read(6)),t}function a(e){return e.remainBit()}t.default=function(e){var t,r,i,s,u,c=new n.default(e),l=o(c),p=c.read(4);15===p&&(t=c.read(24));var d=c.read(4),h=-1,f=-1;switch(5==l||29==l?(r=5,h=1,29==l&&(f=1),15==(i=c.read(4))&&(s=c.read(24)),22==(l=o(c))&&(u=c.read(4))):r=0,l){case 1:case 2:case 3:case 4:case 6:case 7:case 17:case 19:case 20:case 21:case 22:case 23:var m=function(e,t,r,i){var n=i.read(1);i.read(1)&&i.read(14);var o=i.read(1);return t||function(e){e.read(4),e.read(2),e.read(4);var t=e.read(4),r=e.read(4),i=e.read(4),n=e.read(2),o=e.read(3),a=e.read(4);1==e.read(1)&&e.read(4),1==e.read(1)&&e.read(4),1==e.read(1)&&(e.read(2),e.read(1));for(var s=[],u=[],c=0;c<t;c++)s[c]=e.read(1),u[c]=e.read(4);var l=[],p=[];for(c=0;c<r;c++)l[c]=e.read(1),p[c]=e.read(4);var d=[],h=[];for(c=0;c<i;c++)d[c]=e.read(1),h[c]=e.read(4);var f=[];for(c=0;c<n;c++){f[c]=e.read(4);for(var m=[],y=0;y<o;y++)m[y]=e.read(4);var g=[],v=[];for(c=0;c<a;c++)g[c]=e.read(1),v[c]=e.read(4);var b=e.read(8),E=[];for(c=0;c<b;c++)E[c]=e.read(8)}}(i),(6==r||20==r)&&i.read(3),o&&(22==r&&(i.read(5),i.read(11)),17!=r&&19!=r&&20!=r&&23!=r||(i.read(1),i.read(1),i.read(1)),i.read(1)),{frameLengthFlag:n}}(0,d,l,c);this.frameLengthFlag=m.frameLengthFlag}5!=r&&a(c)>=16&&695==c.read(11)&&(5==(r=o(c))&&1==(h=c.read(1))&&(15==(i=c.read(4))&&(s=c.read(24)),a(c)>=12&&1352==c.read(11)&&(f=c.read(1))),22==r&&(1==(h=c.read(1))&&15==(i=c.read(4))&&(s=c.read(24)),u=c.read(4))),this.sbr=h,this.ps=f,this.audioObjectType=l,this.samplingFrequencyIndex=p,this.samplingFrequency=t,this.channelConfiguration=d,this.extensionAudioObjectType=r,this.extensionSamplingFrequencyIndex=i,this.extensionSamplingFrequency=s,this.extensionChannelConfiguration=u}},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),o=r(15),a=r(72),s=r(0),u=r(3),c=r(9),l=function(){function e(){this.packetsMap=[],this.streams=[],this.sequenceNumber=0,this.streamIndexCounter=0}return e.prototype.clean=function(){this.packetsMap=this.streams.reduce((function(e,t){return e[t.index]={packets:[],size:0,type:t.type},e}),{}),this.sequenceNumber++,delete this.output},e.prototype.reset=function(){this.clean()},e.prototype.findStream=function(e){for(var t=0;t<this.streams.length;t++)if(this.streams[t].id===e)return this.streams[t];return null},e.prototype.getAllStreams=function(){return this.streams},e.prototype.setStream=function(e){this.streams=e,this.reset()},e.prototype.convertVideoPacket=function(e,t){var r=t.codec.getMetaData().naluLengthSize||4;e.units||t.codec.getParser().parse(e);for(var i=e.units.reduce((function(e,t){return e+t.data.byteLength}),0),n=new Uint8Array(i+r*e.units.length),o=0,a=0;a<e.units.length;a++){var c=e.units[a];u.writeIntByByte(n,o,c.data.byteLength,r),o+=r,n.set(c.data,o),o+=c.data.byteLength}return{pts:e.pts,dts:e.dts,timestamp:e.timestamp,duration:e.duration,durationTime:e.durationTime,key:e.key,streamIndex:e.streamIndex,data:n,bsf:s.BitstreamFormat.AVC}},e.prototype.convertAudioPacket=function(e,t){e.units||t.codec.getParser().parse(e);var r=t.codec.getMetaData(),i=t.timescale/r.sampleRate;return e.units.map((function(t,n){return{bsf:s.BitstreamFormat.AAC,pts:e.pts+n*r.sampleCount*i,dts:e.dts+n*r.sampleCount*i,duration:e.duration,durationTime:e.durationTime,streamIndex:e.streamIndex,data:t}}))},e.prototype.write=function(e){var t=this;this.output&&this.reset();var r=this.streams&&this.streams.filter((function(t){return t.index==e.streamIndex}))[0];if(!r)throw new Error("stream list is empty");if(r.type===n.MediaType.VIDEO)e.bsf===s.BitstreamFormat.ANNEX_B&&(e=this.convertVideoPacket(e,r)),this.packetsMap[e.streamIndex].packets.push(e),this.packetsMap[e.streamIndex].size+=e.data.byteLength;else{if(r.type!==n.MediaType.AUDIO)throw new Error('stream type "'+r.type+'"not support yet!');e.bsf!==s.BitstreamFormat.AAC?this.convertAudioPacket(e,r).forEach((function(e){t.packetsMap[e.streamIndex].packets.push(e),t.packetsMap[e.streamIndex].size+=e.data.byteLength})):(this.packetsMap[e.streamIndex].packets.push(e),this.packetsMap[e.streamIndex].size+=e.data.byteLength)}},e.prototype.resolveAudioDuration=function(){var e=this.streams&&this.streams.filter((function(e){return e.type===n.MediaType.AUDIO}))[0];if(e){var t=e.codec.getMetaData();e.duration=0;var r=this.packetsMap[e.index].packets;r.sort((function(e,t){return e.dts-t.dts||e.pts-t.pts}));for(var i=0;i<r.length;i++){var o=r[i];o.duration=t.sampleCount*e.timescale/t.sampleRate,o.durationTime=Math.round(1e6*o.duration/e.timescale),e.duration+=o.duration}}},e.prototype.resolveVideoDuration=function(){var e=this.streams&&this.streams.filter((function(e){return e.type===n.MediaType.VIDEO}))[0];if(e){e.duration=0;var t=this.packetsMap[e.index].packets;if(t.sort((function(e,t){return e.dts-t.dts})),o.isSafari){var r=Math.floor((t[t.length-1].dts-t[0].dts)/(t.length-1));this.packetsMap[e.index].packets.forEach((function(t){t.duration=r,t.durationTime=Math.round(1e6*r/e.timescale),e.duration+=t.duration}))}else for(var i=0;i<t.length;i++){var a=t[i],s=t[i+1],u=t[i-1];s?a.duration=s.dts-a.dts:u?a.duration=u.duration:e.codec.getMetaData().sampleDuration&&(a.duration=e.codec.getMetaData().sampleDuration),a.durationTime=Math.round(1e6*a.duration/e.timescale),e.duration+=a.duration}}},e.prototype.sumFrameByteLengths=function(e){var t,r=0;for(t=0;t<e.length;t++)r+=e[t].data.byteLength;return r},e.prototype.seal=function(){var e=this,t=[],r=0;Object.keys(this.packetsMap).forEach((function(t){e.packetsMap[t].packets.sort((function(e,t){return e.dts-t.dts}))}));var o=this.streams.map((function(o){var s=a.MP4Box.mdat(e.assembleMediaData(o)),u=e.packetsMap[o.index].packets[0],c=0;if(o.type===n.MediaType.VIDEO)c=u.dts;else if(o.type===n.MediaType.AUDIO){var l=o.timescale/o.codec.getMetaData().sampleRate;c=u.dts/l}var p=i({baseMediaDecodeTime:c,dataOffset:e.separate?0:r,samples:e.generateSampleTable(o)},o);return r+=s.byteLength,t.push(s),p}));this.separate?this.output={streams:this.streams.map((function(e){return e.serialize()})),data:o.map((function(r,i){return e.generateMP4File([r],[t[i]],t[i].byteLength)}))}:this.output={streams:[this.mergeStreamsInfo()],data:[this.generateMP4File(o,t,r)]}},e.prototype.mergeStreamsInfo=function(){var e,t,r,i;return{type:n.MediaType.MIXED,codecString:this.streams.map((function(e){return e.codec.getCodecString()})).join(","),timescale:this.streams[0].timescale,duration:this.streams[0].duration,metadata:this.streams.reduce((function(e,t){return Object.assign(e,t.codec.getMetaData())}),{}),timeline:{pts:null===(e=this.streams[0].timeline)||void 0===e?void 0:e.pts,dts:null===(t=this.streams[0].timeline)||void 0===t?void 0:t.dts,maxPts:null===(r=this.streams[0].timeline)||void 0===r?void 0:r.maxPts,maxDts:null===(i=this.streams[0].timeline)||void 0===i?void 0:i.maxDts},framePtsList:this.streams[0].framePtsList}},e.prototype.alignPackets=function(e,t){var r=this;e.setStream(this.streams),Object.keys(this.packetsMap).forEach((function(t){var i=r.packetsMap[t];r.packetsMap[t]={size:i.size,type:i.type,packets:e.alignPackets(i.packets,i.type)}})),t&&Object.keys(this.packetsMap).forEach((function(t){var i=r.packetsMap[t];i.type===n.MediaType.AUDIO&&0==i.packets.length&&e.addAudioFrame(i.packets)})),this.resolveVideoDuration(),this.resolveAudioDuration()},e.prototype.getOutput=function(e,t){return void 0===e&&(e={}),this.output&&e.separate===this.separate&&e.fmp4===this.fmp4||(this.resolveVideoDuration(),this.resolveAudioDuration(),this.separate=e.separate,this.fmp4=e.fmp4,t&&this.alignPackets(t,e.forceAlign),this.seal()),this.output},e.prototype.generateMP4File=function(e,t,r){return this.fmp4?a.MP4Box.generateFMP4File(this.sequenceNumber,e,t,r):a.MP4Box.generateMP4File(e,t,r)},e.prototype.concatMediaData=function(e){for(var t=new Uint8Array(this[e+"PacketsSize"]),r=0,i=this[e+"Packets"],n=0;n<i.length;n++)t.set(i[n].data,r),r+=i[n].data.byteLength;return t},e.prototype.assembleMediaData=function(e){for(var t=0,r=this.packetsMap[e.index].packets,i=this.sumFrameByteLengths(r),n=new Uint8Array(i),o=0;o<r.length;o++)n.set(r[o].data,t),t+=r[o].data.byteLength;return n},e.prototype.generateSampleTable=function(e){if(e.type===n.MediaType.VIDEO)return this.packetsMap[e.index].packets.map((function(e){return function(e){var t={size:0,compositionTimeOffset:0,duration:0,isKeyFrame:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return o.isSafari?t.compositionTimeOffset=Math.max(0,e.duration*Math.round((e.pts-e.dts)/e.duration)):t.compositionTimeOffset=Math.round(e.pts-e.dts),t.duration=e.duration,t.size=e.data.byteLength,e.key&&(t.flags.dependsOn=2,t.flags.isNonSyncSample=0,t.isKeyFrame=1),t}(e)}));if(e.type===n.MediaType.AUDIO){var t=e.codec.getMetaData();return this.packetsMap[e.index].packets.map((function(e){return{duration:t.sampleCount,size:e.data.byteLength}}))}return null},e.prototype.createStream=function(e,t,r,i){var n=new c.Stream(e,t,r,i);return n.index=this.streamIndexCounter++,this.setStream(this.streams.concat([n])),n},e.InputVideoBitstreamFormat=s.BitstreamFormat.AVC,e.InputAudioBitstreamFormat=s.BitstreamFormat.AAC,e}();t.default=l},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(25)),o=function(){function e(){}return e.discardEmulationPreventionBytes=function(e){for(var t=e.byteLength,r=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;var n=t-r.length,o=new Uint8Array(n),a=0;for(i=0;i<n;a++,i++)a===r[0]&&(a++,r.shift()),o[i]=e[a];return o},e.readPicParameterSet=function(e){var t=new n.default(e),r={};try{var i,o,a;t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readBits(7),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readBits(2),t.readBoolean()&&t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readBits(4),i=t.readBoolean(),o=t.readBoolean(),void 0!==(a=o&&i?0:o?3:i?2:1)&&(r.parallelismType=a)}catch(e){if(this.lastConfig)return this.lastConfig;throw e}return r},e.readVideoParameterSet=function(e){var t=new n.default(e),r={};try{t.readBits(12);var i=t.readBits(3);r.numTemporalLayers=r.numTemporalLayers?Math.max(r.numTemporalLayers,i+1):i}catch(e){console.log(e)}return r},e.readSequenceParameterSet=function(e){var t=new n.default(e),r={};try{t.skipBits(4);var i=t.readBits(3)+1,o=t.readBits(1),a=this.profile_tier_level(!0,i,t),s=a.general_profile_space,u=a.general_profile_idc,c=a.general_profile_compatibility_flag,l=a.general_constraint_indicator_flags,p=a.general_level_idc;(r={profileSpace:s,profileTierFlag:a.general_tier_flag,profileIdc:u,compatibilityFlag:Array.from(c),constraintFlag:Array.from(l),levelIdc:p,temporalIdNested:o}).numTemporalLayers=r.numTemporalLayers?Math.max(r.numTemporalLayers,i):i,t.skipUnsignedExpGolomb();var d=t.readUnsignedExpGolomb();r.chromaFormat=d,3===d&&t.skipBits(1),r.width=t.readUnsignedExpGolomb(),r.height=t.readUnsignedExpGolomb(),t.readBoolean()&&(t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb());var h=t.readUnsignedExpGolomb(),f=t.readUnsignedExpGolomb();r.bitDepthLumaMinus8=h,r.bitDepthChromaMinus8=f,t.skipUnsignedExpGolomb();for(var m=t.readBits(1)?0:i;m<i;m++)t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb();t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.readBoolean()&&t.readBoolean()&&this.scaling_list_data(t),t.skipBits(2),t.readBoolean()&&(t.skipBits(8),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1));var y=t.readUnsignedExpGolomb(),g=[];for(m=0;m<y;m++)g.push({delta_poc_s0:[],delta_poc_s1:[],used_by_curr_pic_s0:[],used_by_curr_pic_s1:[],num_negative_pics:0,num_positive_pics:0,num_delta_pocs:0}),this.st_ref_pic_set(y,m,t,g,g[m]);if(t.readBoolean())for(m=0;m<t.readUnsignedExpGolomb();m++)t.readUnsignedByte(),t.readBits(1);if(t.skipBits(2),t.readBoolean()){var v=this.vui_parameters(i,t),b=v.aspect_ratio_info_present_flag,E=255===b?[v.sar_width,v.sar_height]:this.get_sar_ration(b);r.sarRatio=E,r.min_spatial_segmentation_idc=v.min_spatial_segmentation_idc}}catch(e){console.log(e)}return r},e.profile_tier_level=function(e,t,r){if(e){for(var i=r.readBits(2),n=r.readBits(1),o=r.readBits(5),a=[],s=0;s<32;s++)a.push(""+r.readBits(1));var u=[];for(s=0;s<48;s++)u.push(""+r.readBits(1));var c=r.readBits(8),l=[],p=[];for(s=0;s<t-1;s++)l[s]=r.readBoolean(),p[s]=r.readBoolean();if(t-1>0)for(s=t;s<8;s++)r.skipBits(2);for(s=0;s<t-1;s++)l[s]&&r.skipBits(88),p[s]&&r.skipBits(8);return{general_profile_space:i,general_profile_idc:o,general_profile_compatibility_flag:a,general_constraint_indicator_flags:u,general_level_idc:c,general_tier_flag:n}}},e.scaling_list_data=function(e){for(var t=0;t<4;t++)for(var r=0;r<6;r+=3==t?3:1)if(e.readBoolean){var i=Math.min(64,4+(t<<1));t>1&&e.skipExpGolomb();for(var n=0;n<i;n++)e.skipExpGolomb()}else e.skipUnsignedExpGolomb()},e.st_ref_pic_set=function(e,t,r,i,n){var o=!1;if(0!=t&&(o=r.readBoolean()),o){var a=1;t===e&&(a=r.readUnsignedExpGolomb(),a++);for(var s=t-a,u=r.readBoolean(),c=r.readUnsignedExpGolomb(),l=u?-(c+1):c+1,p=i[s].num_delta_pocs,d=[],h=[],f=0;f<=p;f++){var m=r.readBoolean();d.push(m),d[f]?h[f]=!0:(m=r.readBoolean(),h[f]=m)}var y=i[s].num_positive_pics,g=i[s].num_negative_pics,v=void 0;v=0;for(var b=y-1;b>=0;b--)(E=i[s].delta_poc_s1[b]+l)<0&&h[g+b]&&(n.delta_poc_s0[v]=E,n.used_by_curr_pic_s0[v]=d[g+b],v++);for(l<0&&h[p]&&(n.delta_poc_s0[v]=l,n.used_by_curr_pic_s0[v]=d[p],v++),b=0;b<g;b++){var E;(E=i[s].delta_poc_s0[b]+l)<0&&h[b]&&(n.delta_poc_s0[v]=E,n.used_by_curr_pic_s0[v]=d[b],v++)}n.num_negative_pics=v}else{n.num_negative_pics=r.readUnsignedExpGolomb(),n.num_positive_pics=r.readUnsignedExpGolomb();var _=0;for(v=0;v<n.num_negative_pics;v++){var R=r.readUnsignedExpGolomb();n.delta_poc_s0[v]=_-(R+1),_=n.delta_poc_s0[v],n.used_by_curr_pic_s0[v]=r.readBoolean()}for(_=0,v=0;v<n.num_positive_pics;v++){var S=r.readUnsignedExpGolomb();n.delta_poc_s1[v]=_+S+1,_=n.delta_poc_s1[v],n.used_by_curr_pic_s1[v]=r.readBoolean()}}n.num_delta_pocs=n.num_positive_pics+n.num_negative_pics},e.vui_parameters=function(e,t){var r,i,n,o;return t.readBoolean()&&255===(r=t.readUnsignedByte())&&(i=t.readUnsignedByte()<<8|t.readUnsignedByte(),n=t.readUnsignedByte()<<8|t.readUnsignedByte()),t.readBoolean()&&t.readBits(1),t.readBoolean()&&(t.readBits(3),t.readBits(1),t.readBoolean()&&(t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte())),t.readBoolean()&&(t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb()),t.readBits(3),t.readBoolean()&&(t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb(),t.readUnsignedExpGolomb()),t.readBoolean()&&(t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readBoolean()&&t.readUnsignedExpGolomb(),t.readBoolean()&&this.skip_hrd_parameters(e,t)),t.readBoolean()&&(t.readBits(3),o=t.readUnsignedExpGolomb(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte()),{min_spatial_segmentation_idc:void 0===o?0:o,aspect_ratio_info_present_flag:r,sar_height:n,sar_width:i}},e.get_sar_ration=function(e){var t;switch(e){case 1:t=[1,1];break;case 2:t=[12,11];break;case 3:t=[10,11];break;case 4:t=[16,11];break;case 5:t=[40,33];break;case 6:t=[24,11];break;case 7:t=[20,11];break;case 8:t=[32,11];break;case 9:t=[80,33];break;case 10:t=[18,11];break;case 11:t=[15,11];break;case 12:t=[64,33];break;case 13:t=[160,99];break;case 14:t=[4,3];break;case 15:t=[3,2];break;case 16:t=[2,1]}return t},e.skip_hrd_parameters=function(e,t){var r,i,n=!1;r=t.readBoolean(),i=t.readBoolean(),(r||i)&&((n=t.readBoolean())&&(t.readUnsignedByte(),t.readUnsignedByte(),t.readBits(3)),t.readBits(8),n&&t.readBits(4),t.readBits(8),t.readBits(7));for(var o=0;o<=e;o++){var s=!0,u=!1,c=0;t.readBoolean()||(s=t.readBoolean()),s?t.readUnsignedExpGolomb():u=t.readBoolean(),u||(c=t.readUnsignedExpGolomb()),r&&a(c,n,t),i&&a(c,n,t)}},e.lastConfig=null,e}();function a(e,t,r){for(var i=0;i<=e;i++)r.readUnsignedExpGolomb(),r.readUnsignedExpGolomb(),t&&(r.readUnsignedExpGolomb(),r.readUnsignedExpGolomb()),r.readBits(1)}t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCodecSupportedInMp4=t.isCodecType=void 0;var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,&&!0===r[e.slice(0,4)]},t.isCodecSupportedInMp4=function(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.add=function(e,t){var r,i,n,o;try{r=e.toString().split(".")[1].length}catch(e){r=0}try{i=t.toString().split(".")[1].length}catch(e){i=0}if(o=Math.abs(r-i),n=Math.pow(10,Math.max(r,i)),o>0){var a=Math.pow(10,o);r>i?(e=Number(e.toString().replace(".","")),t=Number(t.toString().replace(".",""))*a):(e=Number(e.toString().replace(".",""))*a,t=Number(t.toString().replace(".","")))}else e=Number(e.toString().replace(".","")),t=Number(t.toString().replace(".",""));return(e+t)/n},e.subtract=function(e,t){var r,i,n;try{r=e.toString().split(".")[1].length}catch(e){r=0}try{i=t.toString().split(".")[1].length}catch(e){i=0}return((e*(n=Math.pow(10,Math.max(r,i)))-t*n)/n).toFixed(r>=i?r:i)},e.multiply=function(e,t){var r=0,i=e.toString(),n=t.toString();try{r+=i.split(".")[1].length}catch(e){}try{r+=n.split(".")[1].length}catch(e){}return Number(i.replace(".",""))*Number(n.replace(".",""))/Math.pow(10,r)},e.division=function(e,t){var r=0,i=0;try{r=e.toString().split(".")[1].length}catch(e){}try{i=t.toString().split(".")[1].length}catch(e){}return Number(e.toString().replace(".",""))/Number(t.toString().replace(".",""))*Math.pow(10,3));t.Parser=s.default},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{values;return t.buffer="",t}return n(t,e),t.prototype._write=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n")){var r=this.buffer.substring(0,t);0!==(r=(r=r.trim()).replace(/\r/g,"")).length&&this.push(r),this.buffer=this.buffer.substring(t+1)}},t.prototype.flush=function(){this.buffer=this.buffer.trim().replace(/\r/g,""),this.buffer&&this.push(this.buffer),this.push(null)},t}(o(r(10)).default);t.default=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a,s=o(r(10));!function(e){e[e.TAG=0]="TAG",e[e.COMMENT=1]="COMMENT",e[e.URL=2]="URL"}(a||(a={}));var u=[{test:/^(?!#)/,type:a.URL,process:[{handler:function(e){var t={type:"URL",data:{}};return t.data.cont(/^(http|https|\/\/)/)}(e),t}}]},{test:/^#EXT(?:-?)([^:]*):?(.*)$/,type:a.TAG,process:[{handler:function(e,t){var r={type:"TAG",data:{}};return e=e.replace(/-|X-/g,""),r.data.tagName=e,r.data.attrs=function(e){e||(e="");var t=[];return(e=e.replace(/"([^"]+)"|""/g,(function(e,r){return null==r&&(r=" "),t.push(r),"#&"+t.length}))).split(",").map((function(e){var r=e.split("=");return 1===r.length&&r.unshift("$content"),r[1]=r[1].replace(new ion(e,r){return t[r-1]})),r})).reduce((function(e,t){var r;return t[0]=(r=t[0],-1!==r.indexOf("-")?r.split("-").map((function(e,t){return 0===t?e.toLowerCase():e[0]+e.slice(1).toLowerCase()})).join(""):r.toLowerCase()).trim(),t[1]=/^[0-9]*[0-9][0-9]*$/.test(t[1])?t[1]-0:t[1].trim(),"string"==typeof t[1]&&("YES"==t[1].toUpperCase()?t[1]=!0:"NO"==t[1].toUpperCase()&&(t[1]=!1)),"$content"===t[0]?e.hasOwnProperty(t[0])?e[t[0]].push(t[1]):e[t[0]]=[t[1]]:e[t[0]]=t[1],e}),{})}(t),r.data.content=[],r.data.attrs.$content&&(r.data.content=r.data.attrs.$content,delete r.data.attrs.$content),r}}]}],c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype._write=function(e){for(var t,r=0;r<u.length;r++){var i=u[r],n=e.match(i.test);if(n){t=n[0].length>0?i.process[0].handler(n[1],n[2]):i.process[0].handler(e),this.push(t,t.type);break}}},t.prototype.flush=function(){this.push(null)},t}(s.default);t.default=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(10)),s=r(82),u="modifier",c="entire",l="entiregroup",p="splitter",d="individualmodifier";function h(e){return/^[0-9]+([.]{1}[0-9]+){0,1}$/.test(e)||!isNaN(e)}var f=[{tagName:"INF",scope:{type:u,key:"segments[]"},resolve:function(e,t,r){var i=e.data.content,n=i[0],o=i[1];n=h(n)?parseFloat(n):0,r.disCounter||(r.disCounter=0);var a={duration:n};return o&&(a.title=o),Object.assign(a,r),t.curSegment&&(t.segments=t.segments.filter((function(e){return!e.temp})),a.partList=t.curSegment.partList,t.curSegment=null),t.programDateTime&&(a.programDateTime=t.programDateTime,delete t.programDateTime),a}},{tagName:"PART",scope:{type:l,key:"partList[]"},resolve:function(e,t,r){null==t.curSegment&&(t.curSegment={partList:[],temp:!0},Object.assign(t.curSegment,r),t.segments||(t.segments=[]),t.segments.push(t.curSegment));var i=e.data.attrs;return i.duration&&(i.duration=parseFloat(i.duration)),t.curSegment.partList.push(i),i}},{tagName:"VERSION",scope:{type:c,key:"."},resolve:function(e,t){return e.data.content[0]=h(e.data.content[0])?parseInt(e.data.content[0]):0,{version:e.data.content[0]}}},{tagName:"PRIVINF",scope:{type:d,key:"segments[]"},resolve:function(e,t,r){var i=e.data.attrs;return tion(e){return i[e]=!0})),i}},{tagName:"SERVERCONTROL",scope:{type:c,key:"."},resolve:function(e,t,r){var i=e.data.attrs;return i.partHoldBack&&(i.partHoldBack=parseFloat(i.partHoldBack)),Object.assign(i,r),i}},{tagName:"MEDIASEQUENCE",scope:{type:c,key:"."},resolve:function(e,t,r){return e.data.content[0]=h(e.data.content[0])?e.data.content[0]:0,{mediaSequence:e.data.content[0]}}},{tagName:"TARGETDURATION",scope:{type:c,key:"."},resolve:function(e,t,r){return e.data.content[0]=h(e.data.content[0])?parseInt(e.data.content[0]):0,{targetDuration:e.data.content[0]}}},{tagName:"PLAYLISTTYPE",scope:{type:c,key:"."},resolve:function(e,t,r){return{playListType:e.data.content[0]}}},{tagName:"ALLOWCACHE",scope:{type:c,key:"."},resolve:function(e,t,r){return{allowCache:e.data.content[0]}}},{tagName:"MEDIA",scope:{type:l,key:"media[]"},resolve:function(e,t,r){return e.data.attrs}},{tagName:"STREAMINF",scope:{type:u,key:"levels[]"},resolve:function(e,t,r){return Object.assign(e.data.attrs,r),e.data.attrs}},{tagName:"PARTINF",scope:{type:c,key:"."},resolve:function(e,t,r){var i=e.data.attrs;return i.partTarget&&(i.partTarget=parseFloat(i.partTarget)),Object.assign(i,r),i}},{tagName:"SKIP",scope:{type:c,key:"."},resolve:function(e,t,r){return Object.assign(e.data.attrs,r),e.data.attrs}},{tagName:"DISCONTINUITY",scope:{type:p,key:"."},resolve:function(e,t,r){return{disCounter:r.disCounter+1}}},{tagName:"DISCONTINUITYSEQUENCE",scope:{type:c,key:"."},resolve:function(e,t,r){return e.data.content[0]=h(e.data.content[0])?parseInt(e.data.content[0]):0,{discontinuitySequence:e.data.content[0]}}},{tagName:"MAP",scope:{type:l,key:"map[]"},resolve:function(e,t,r){return r.hasOwnProperty("mapIndex")?r.mapIndex+=1:r.mapIndex=0,e.data.attrs}},{tagName:"PRELOADHINT",scope:{type:l,key:"preloadHint[]"},resolve:function(e,t,r){null==t.curSegment&&(t.curSegment={partList:[],temp:!0},Object.assign(t.curSegment,r),t.segments||(t.segments=[]),t.segments.push(t.curSegment));var i=e.data.attrs;return"PART"==i.type?t.curSegment.partList.push(i):"MAP"==i.type&&(r.hasOwnProperty("mapIndex")?r.mapIndex+=1:r.mapIndex=0,t.map||(t.map=[]),t.map.push(i)),i.preload=!0,i}},{tagName:"RENDITIONREPORT",scope:{type:l,key:"renditionReports[]"},resolve:function(e,t,r){return e.data.attrs}},{tagName:"KEY",scope:{type:l,key:"key[]"},resolve:function(e,t,r){return r.hasOwnProperty("keyIndex")?r.keyIndex+=1:r.keyIndex=0,e.data.attrs}},{tagName:"BYTERANGE",scope:{type:d,key:"segments[]"},resolve:function(e,t,r){return{byterange:e.data.content[0]}}},{tagName:"START",scope:{r){return e.data.attrs}},{tagName:"PROGRAMDATETIME",scope:{type:l,key:"."},resolve:function(e,t,r){return{programDateTime:e.data.content[0]}}},{tagName:"ENDLIST",scope:{e,t,r){return{live:!1}}}];function m(e,t,r,i,n,o){var a,s;return"."===e.scope.key?a=r:e.scope.key.match(/\[\]/)&&(s=e.scope.key.match(/.+(?=\[\])/)[0],r.hasOwnProperty(s)?(o&&t.data.tagName==n||e.scope.type==i||e.scope.type==l||e.scope.type==u)&&r[s].push({}):r[s]=[{}],a=r[s][r[s].length-1]),a}var y=function(e){function t(){var t=e.call(this)||this;return t.result={live:!0,curSegment:null},t.context={},t.customList=[],t.scope=null,t.contextScope=t.context,t.lastScope=null,t.playListType="",t.lastTag=null,t}return n(t,e),t.prototype._writeURL=function(e){if("URL"==this.lastTag)this.emit("WARNING","");else if(this.scope&&(this.result.segments||this.result.levels)){var t=this.customUrlResolver(e.data.content);"LEVEL"==this.playListType?s.manageCustom(t.custom,this.result.segments[this.result.segments.length-1],t.url,t.tag):s.manageCustom(t.custom,this.result.levels[this.result.levels.length-1],t.url,t.tag),this.scope=null,this.lastTag="URL"}},t.prototype._writeTAG=function(e){for(var t=0;t<f.length;t++){var r=f[t];if("MEDIA"===e.data.tagName||"STREAMINF"===e.data.tagName?this.playListType="MASTER":this.playListType="LEVEL",e.data.tagName===r.tagName){if(r.scope.type==p){this.contextScope=m(r,e,this.context,this.lastScope,this.lastTag,!0);var i=r.resolve(e,this.result,this.context);s.manageCustom(i.custom,this.contextScope,i),this.lastTag=e.data.tagName;break}if(null==this.scope&&r.scope.type!=u&&"ENDLIST"!=r.tagName&&null==this.scope&&r.scope.type!=l&&null==this.scope&&r.scope.type!=c)break;null!=this.scope&&r.scope.type==this.lastScope&&r.scope.type!=l||(this.scope=m(r,e,this.result,this.lastScope,this.lastTag,!1)),i=r.resolve(e,this.result,this.context),s.manageCustom(i.custom,this.scope,i),this.lastScope=r.scope.type,this.lastTag=e.data.tagName;break}}},t.prototype.customUrlResolver=function(e){return ction(e,t){return t(e)}),{url:e,tag:"url"})},t.prototype.getCustomTag=function(e){f.concat(e)},t.prototype.customUrl=function(e){this.customLiesult),this.push(null)},t}(.TransmuxerAction={}))},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(2),a=i(r(23)),s=i(r(95)),u=i(r(29)),c=i(r(99)),l=i(r(100)),p=r(3);c.default.install();var d={},h={},f=function(){function e(t){var r;if("string"==typeof t){if(this.format=t,!d[this.format]&&!h[this.format])throw new Error("unsupported format:"+this.format)}else if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{if(!p.isArrayBufferView(t))throw new Error("invalid argument!must be ArrayBuffer|TypedArray|ContainerFormat");r=t}if(this.format||(this.format=e.probe(r)),!d[this.format]&&!h[this.format])throw Error("initialize XFormat Failed:can not found any remuxer or demuxer for "+this.format+"!");this.demuxer=new d[this.format],r&&(this.demuxer.write(r),this.dataPushed=!0),this.outPacketBuffer=[],this.bsfDefined={}}return e.probe=function(e){return Object.keys(d).filter((function(t){return d[t].probe(e)}))[0]||n.ContainerFormat.UNKNOWN},e.registerDemuxer=function(e,t){d[e]=t},e.registerRemuxer=function(e,t){h[e]=t},e.isSupportRemuxer=function(e){return!!h[e]},e.isSupportDemuxer=function(e){return!!d[e]},e.splitPacketsMap=function(e){var t={};return e.forEach((function(e){e.stream.type===o.MediaType.AUDIO?t.audioStream=Object.setPrototypeOf({packets:e.packets},e.stream):e.stream.type===o.MediaType.VIDEO&&(t.videoStream=Object.setPrototypeOf({packets:e.packets},e.stream))})),t},Object.defineProperty(e.prototype,"InputVideoBitstreamFormat",{get:function(){return h[this.format]?h[this.format].InputVideoBitstreamFormat:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"InputAudioBitstreamFormat",{get:function(){return h[this.format]?h[this.format].InputAudioBitstreamFormat:null},enumerable:!1,configurable:!0}),e.prototype.pushData=function(e){if(this.dataPushed=!0,!this.demuxer){if(!d[this.format])throw new Error("unsupported demuxer: "+this.format);this.demuxer=new d[this.format]}this.demuxer.write(p.isArrayBufferView(e)?e:new Uint8Array(e)),this.targetXFormat&&this._transmux()},e.prototype._transmux=function(){var e;for(this.streams&&0!=this.streams.length?0===this.targetXFormat.getStreams().length&&this.targetXFormat.setStream(this.streams):(this.streams=this.demuxer.findAllStream(),this.targetXFormat.setStream(this.streams));e=this.readPacket();)this.streams[e.streamIndex].updatePacket(e),this.targetXFormat.writePacket(e)},e.prototype.findAllStream=function(){if(!this.demuxer)throw new Error("must pushData at first!");return this.streams=this.demuxer.findAllStream(),this.streams},e.prototype.readAllPacket=function(e,t){var r;this.streams&&0!=this.streams.length||this.findAllStream();for(var i=this.streams.map((function(e){return{stream:e,packets:[]}}));r=this.readPacket();)t&&(r.ext=t),this.streams[r.streamIndex].updatePacket(r),i[r.streamIndex].packets.push(r);if(e)for(this.flush();r=this.readPacket();)t&&(r.ext=t),this.streams[r.streamIndex].updatePacket(r),i[r.streamIndex].packets.push(r);return i},e.prototype.setBitstreamFilter=function(e){this.bsfDefined=e},e.prototype.resetBitstreamFilter=function(){this.bsfDefined={}},e.prototype.getStream=function(e){return this.streams[e]},e.prototype.readPacket=function(){if(this.streams&&0!==this.streams.length||this.findAllStream(),this.outPacketBuffer.length>0)return this.outPacketBuffer.shift();for(var e,t;e=this.demuxer.readPacket();){if(t=this.streams[e.streamIndex],"function"==typeof this.packetFilter&&(e.data=this.packetFilter(e.data)),!e||!(t.NeedParse||this.bsfDefined[t.type]&&this.bsfDefined[t.type]!==e.bsf))return e;var r=t.codec.getParser().parse(e,this.bsfDefined[t.type]);if(r)return Array.isArray(r)?(this.outPacketBuffer=r.slice(1),r[0]):r}return this.demuxer.Flushed?t?t.codec.getParser().flush():(this.outPacketBuffer=function(e){for(var t=[],r=0;r<e.length;r++)Array.isArray(e[r])?t=t.concat(e[r]):t.push(e[r]);return t}(this.streams.map((function(e){return e.codec.getParser().flush()})).filter(Boolean)),this.outPacketBuffer.shift()):null},e.prototype.getStreams=function(){return this.remuxer.getAllStreams()||[]},e.prototype.flush=function(){if(!this.demuxer)throw new Error("must pushData at first!");this.demuxer.flush(),this.targetXFormat&&this._transmux()},e.prototype.setPacketFilter=function(e){this.packetFilter=e},e.prototype.pipe=function(t){var r;if(!e.isSupportRemuxer(t.format))throw new Error("unsupported remuxer format "+t.format);this.targetXFormat=t,this.setBitstreamFilter(((r={})[o.MediaType.VIDEO]=t.InputVideoBitstreamFormat,r[o.MediaType.AUDIO]=t.InputAudioBitstreamFormat,r)),this.dataPushed&&this._transmux()},e.prototype.unpipe=function(){delete this.targetXFormat},e.prototype.setStream=function(e){if(!this.remuxer){if(!h[this.format])throw new Error("unsupported remuxer:"+this.format);this.remuxer=new h[this.format]}this.remuxer.setStream(e)},e.prototype.writePacket=function(e){if(!this.remuxer)throw new Error("must setStream at first!");this.remuxer.write(e)},e.prototype.getOutput=function(e,t){if(!this.remuxer)throw new Error("must setStream at first!");return this.remuxer.getOutput(e,t)},e.prototype.destroy=function(){this.reset(),delete this.demuxer,delete this.remuxer},e.prototype.reset=function(){delete this.streams,this.packetFilter=null,this.outPacketBuffer=[],this.demuxer&&this.demuxer.reset(),this.remuxer&&this.remuxer.reset(),this.dataPushed=!1},e.prototype.abort=function(){this.demuxer&&this.demuxer.clean(),this.remuxer&&this.remuxer.clean()},e.prototype.resetDemuxer=function(){this.demuxer&&this.demuxer.reset()},e.prototype.resetRemuxer=function(){this.remuxer&&this.remuxer.reset()},e}();t.default=f,f.registerDemuxer(n.ContainerFormat.M2TS,a.default),f.registerDemuxer(n.ContainerFormat.FLV,s.default),f.registerRemuxer(n.ContainerFormat.MP4,u.default),f.registerDemuxer(n.ContainerFormat.MP4,l.default)},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.StreamReader=t.Mp4Parser=t.Mp4Reader=void 0;var n=r(11);Object.defineProperty(t,"StreamReader",{enumerable:!0,get:function(){return n.StreamReader}});var o=r(19),a=function(){function e(e){this.streamReader=e,this.clearContext()}return e.prototype.read=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(e.length<2)throw new Error("wrong num of read params.");var r=e[0],i=e[1],n=e[2],o=typeof n;switch(o){case"undefined":switch(r){case"uint":return this.streamReader.readUintByBits(i);case"int":return this.streamReader.readIntByBits(i);case"string":return this.streamReader.readString(Math.floor(i/8));default:throw new Error("wrong read type")}case"number":switch(r){case"uint":for(var a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=n,s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"string":switch(n){case"BoxEnd":switch(r){case"uint":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=Math.floor(8*(this.get("boxEnd")-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"FileEnd":switch(r){case"uint":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readUintByBits(i));return s;case"int":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readIntByBits(i));return s;case"string":for(a=Math.floor(8*(this.streamReader.getEndPosition()-this.streamReader.getPosition())/i),s=[],u=0;u<a;u++)s.push(this.streamReader.readString(Math.floor(i/8)));return s;default:throw new Error("wrong read type")}case"StringEnd":s="";for(var c=this.streamReader.readString(1);"\0"!==c;)s+=c,c=this.streamReader.readString(1);return s;default:throw new Error("wrong read flag")}default:throw new Error("wrong read flag type")}},e.prototype.get=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.context[e]},e.prototype.set=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];this.context[e]=t},e.prototype.clearContext=function(){this.context={}},e}();t.Mp4Reader=a;var s=function(){function e(e){this.boxQueue=[],this.boxMap={},this.streamReader=e,this.mp4Reader=new a(e),this.parser=new n.Parser(this.mp4Reader)}return e.prototype.parse=function(){for(;!this.streamReader.isEos();)if(this.boxQueue.length>0&&("avcC"===this.boxQueue[this.boxQueue.length-1].boxtype||"hvcC"===this.boxQueue[this.boxQueue.length-1].boxtype)){var e=this.boxMap.avcC||this.boxMap.hvcC;if(!e)throw new Error("have no avcC or hvcC");this.streamReader.setPosition(e.parent.boxEnd);var t={boxBegin:-1,boxEnd:-1,boxtype:"self_placeholder",children:[],parent:null};this.push(t)}else{this.parser.setProgram(o.Mp4DSL.box),this.mp4Reader.set("boxBegin",this.streamReader.getPosition());try{var r=this.parser.getResult();if(1===r.size?this.mp4Reader.set("boxEnd",this.mp4Reader.get("boxBegin")+r.largesize):0===r.size?this.mp4Reader.set("boxEnd",this.streamReader.getEndPosition()):this.mp4Reader.set("boxEnd",this.mp4Reader.get("boxBegin")+r.size),void 0===o.Mp4DSL[r.boxtype]){this.streamReader.setPosition(this.mp4Reader.get("boxEnd"));var n=i(i({},r),{boxBegin:this.mp4Reader.get("boxBegin"),boxEnd:this.mp4Reader.get("boxEnd"),children:[],parent:null});this.push(n);continue}this.parser.setProgram(o.Mp4DSL[r.boxtype]);var a=this.parser.getResult();t=i(i(i(i({},r),{boxBegin:this.mp4Reader.get("boxBegin"),boxEnd:this.mp4Reader.get("boxEnd")}),a),{children:[],parent:null}),this.push(t)}catch(e){this.streamReader.setPosition(this.mp4Reader.get("boxBegin"));break}}},e.prototype.getBoxTree=function(){return this.boxQueue.filter((function(e){return null===e.parent}))},e.prototype.getBoxMap=function(){return this.boxMap},e.prototype.write=function(e){this.streamReader.append(e)},e.prototype.push=function(e){if(e.boxEnd>this.streamReader.getEndPosition())throw new Error("box "+e.boxtype+" length is too long.");var t=e.boxtype;if(this.boxMap[t]){var r=this.boxMap[t];Array.isArray(r)?r.push(e):this.boxMap[t]=[r,e]}else this.boxMap[t]=e;if(0!==this.boxQueue.length){var i=this.boxQueue[this.boxQueue.length-1];if(i.boxEnd>=e.boxEnd)i.children.push(e),e.parent=i,this.boxQueue.push(e);else{for(;i&&i.boxEnd<e.boxEnd;)i=i.parent;i&&i.children.push(e),e.parent=i,this.boxQueue.push(e)}}else this.boxQueue.push(e)},e}();t.Mp4Parser=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(15),n=r(2),o=r(107),a=function(){function e(){this.reset(),this.sequential=!1,this.timestampOffset=0,this.encrypted=!1,this.idiscontinuity=!1,this.accurateTimeOffset=!0}return e.prototype.reset=function(){this.audioVideoShift=0,this.videoBasePts=-1,this.videoBaseDts=-1,this.audioBasePts=-1,this.nextVideoDts=0,this.nextAudioDts=0,this.nextVideoPts=0},e.prototype.setStream=function(e){for(var t=1/0,r=1/0,i=0;i<e.length;i++)e[i].type===n.MediaType.VIDEO?this.videoStream=e[i]:e[i].type===n.MediaType.AUDIO&&(this.audioStream=e[i]);this.audioStream&&-1===this.audioStream.timeline.pts&&(this.audioStream.timeline.pts=this.audioStream.timeline.dts=this.nextAudioDts),!this.timestampOffset&&this.videoStream&&this.audioStream?(t=Math.min(this.videoStream.timeline.pts,this.audioStream.timeline.pts),r=Math.min(this.videoStream.timeline.dts,this.audioStream.timeline.dts)):(t=(this.videoStream||this.audioStream).timeline.pts,r=(this.videoStream||this.audioStream).timeline.dts),!this.audioVideoShift&&this.videoStream&&this.audioStream&&(this.audioVideoShift=this.audioStream.timeline.pts-this.videoStream.timeline.pts),-1===this.videoBasePts&&(this.videoBasePts=t-(this.timestampOffset*(this.videoStream||this.audioStream).timescale||0)),-1===this.videoBaseDts&&(this.videoBaseDts=r-(this.timestampOffset*(this.videoStream||this.audioStream).timescale||0)),-1===this.audioBasePts&&this.audioStream&&(this.audioBasePts=t-(this.timestampOffset*(this.audioStream||this.videoStream).timescale||0))},e.prototype.discontinuity=function(){this.videoBasePts=-1,this.videoBaseDts=-1,this.audioBasePts=-1,this.idiscontinuity=!0},e.prototype.alignPackets=function(e,t){return t===n.MediaType.AUDIO?this.alignAudio(e):t===n.MediaType.VIDEO?this.alignVideo(e):e},e.prototype.alignVideo=function(e){var t=this,r=this.nextVideoDts;this.sequential||(r=this.timestampOffset*this.videoStream.timescale+e[0].dts-e[0].pts),e.sort((function(e,t){return e.dts-t.dts||e.pts-t.pts||e.id-t.id}));var n=0,o=this.videoBasePts;(i.isSafari||this.dtsBaseEnabled)&&(o=this.videoBaseDts),e.forEach((function(e,r){e.dts=Math.max(0,e.dts-o),e.pts=Math.max(0,e.pts-o),e.pts+e.duration>n&&(n=e.pts+e.duration),e.timestamp=Math.round(1e6*e.pts/t.videoStream.timescale)}));var a=Math.max(0,e[0].dts),s=Math.max(0,e[0].pts),u=Math.round(1e3*(a-r)/this.videoStream.timescale);if(this.sequential&&Math.abs(u)>1){a=r,s=Math.max(a,Math.max(s-u,this.nextVideoPts)),e[0].pts=s,e[0].dts=a,e[0].timestamp=Math.round(1e6*e[0].pts/this.videoStream.timescale);for(var c=1;c<e.length;c++){if(!(e[c].dts<a||e[c].pts<s)){if(e[c].dts===a&&e[c].keyFrame){e=e.slice(c);break}break}e[c].dts=Math.max(a,e[c].dts),e[c].pts=Math.max(s,e[c].pts),e[0].timestamp=Math.round(1e6*e[0].pts/this.videoStream.timescale)}}s+e[0].duration>n&&(n=s+e[0].duration),this.nextVideoPts=n;var l=e[e.length-1];return this.nextVideoDts=l.dts+l.duration,e},e.prototype.addAudioFrame=function(e){var t=this.nextAudioDts,r=this.nextVideoDts,i=this.audioMetaData.sampleCount*this.audioStream.timescale/this.audioMetaData.sampleRate,n=Math.ceil((r-t)/i);o.addFrames(e,0,t+this.audioBasePts,i,n,this.audioMetaData,this.audioStream.index),this.alignAudio(e)},e.prototype.alignAudio=function(e){var t=this;if(0===e.length)return e;var r=this.nextAudioDts,i=this.audioStream.codec.getMetaData();if(this.audioMetaData=i,e=e.filter((function(e){return e.pts=e.dts=Math.max(0,e.pts-t.audioBasePts),e.timestamp=Math.round(1e6*e.pts/t.audioStream.timescale),e.pts>=0})),this.sequential||(r=this.accurateTimeOffset&&this.idiscontinuity?this.timestampOffset*this.audioStream.timescale+this.audioVideoShift:e[0].dts),Math.abs(r-e[0].pts)>.001*this.audioStream.timescale&&o.fixAudioFrames(e,r,this.audioStream.timescale,i),e.length>0){var n=e[e.length-1];this.nextAudioDts=n.dts+n.duration}return this.idiscontinuity=!1,e},e}();t.default=a},function(e,t,r){"use strict";var i,n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(42)),a=n(r(88)),s=n(r(115)),u=n(r(116)),c=((i={})[s.default.HLS]=o.default,i[s.default.FLV]=a.default,i[s.default.MMP4]=u.default,i);t.default=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,u,c=a(r(7)),l=r(20),p=r(1),d=a(r(63)),h=a(r(6)),f=a(r(16)),m=r(33);!function(e){e[e.EMPTY_PLAYLIST=0]="EMPTY_PLAYLIST",e[e.REQUEST_ERROR=1]="REQUEST_ERROR"}(s||(s={})),function(e){e[e.PARSER_ERROR=0]="PARSER_ERROR"}(u||(u={}));var y=l.XError.registerError("NET","MNF",s),g=l.XError.registerError("PAS","MNF",u),v={loader:{config:{maxConcurrentNum:2}}},b=function(e){function t(t){void 0===t&&(t={});var r=e.call(this)||this;return r.ID="HLSManifest",r.trackList=[],r.config=o(o({},v),t),r.config.hasOwnProperty("forceHttps")&&(h.default.protocolRevised=r.config.forceHttps),r.config.maxNoUpdateFlushCount||(r.config.maxNoUpdateFlushCount=1/0),t.chunkEnabled=!1,r.loader=new f.default("MANIFEST",t),null==r.config.startLevel&&(r.config.startLevel=0),r}return nhod not implemented.")},t.prototype.setConfig=function(e){this.config=Object.assign(this.config,e),this.config.hasOwnProperty("forceHttps")&&(h.default.protocolRevised=this.config.forceHttps)},Object.defineProperty(t.prototype,"defaultConfig",{get:function(){return v},enumerable:!1,configurable:!0}),t.prototype.getAllTrack=function(){return this.trackList},t.prototype.load=function(e,t){var r=this;return new Promise((function(t,i){r.reset(),r.baseURI=h.default.resolveURL(r.baseURI,e);var n=r.loader.request({schema:p.URISchema.HTTP,location:r.baseURI,dataType:p.DataType.TEXT});n.on(p.RequestEvent.ERROR,(function(e){r.onError(y.of(s.REQUEST_ERROR,l.XError.Severity.FATAL,"manifest request failed",e.code,r.baseURI,e.responseHeaders))})),n.pipe(new m.Parser).on("finish",(function(e){e?(e.baseURI&&(r.baseURI=e.baseURI),r.setTracks(e),0===r.trackList.length?(r.onError(y.of(s.EMPTY_PLAYLIST,l.XError.Severity.FATAL,"track list is empty",0,r.baseURI)),i(y.of(s.EMPTY_PLAYLIST,l.XError.Severity.FATAL,"track list is empty",0,r.baseURI))):(r.addTrackEvent(),t(r.trackList))):(r.onError(y.of(s.EMPTY_PLAYLIST,l.XError.Severity.FATAL,"manifest is empty",0,r.baseURI)),i(y.of(s.EMPTY_PLAYLIST,l.XError.Severity.FATAL,"manifest is empty",0,r.baseURI)))})).catch((function(e){r.onError(g.of(u.PARSER_ERROR,l.XError.Severity.FATAL,"manifest parse error:"+e.message,0,r.baseURI)),i(g.of(u.PARSER_ERROR,l.XError.Severity.FATAL,"manifest parse error:"+e.message,0,r.baseURI))})),r.request=n}))},t.prototype.destroy=function(){this.reset(),this.loader.destroy(),delete this.loader,this.config={}},t.prototype.onError=function(e){this.emit(p.ManifestEvent.ERROR,e)},Object.defineProperty(t.prototyp.config.lowLatencyMode},enumerable:!1,configurable:!0}),t.prototype.setTracks=function(e){if(e.segments&&e.segments.length>0){var t=new d.default([e],{baseURL:this.baseURI,type:p.MediaType.MIXED,trackLevelsFilter:this.config.trackLevelsFilter,loader:this.loader,maxNoUpdateFlushCount:this.config.maxNoUpdateFlushCount,lowLatencyMode:this.config.lowLatencyMode,preloadOn:this.config.preloadOn});this.trackList.push(t)}else{var r,i=this.setVideoTracks(e);r=i&&i.getAllTrackLevel().map((function(e){return{groupId:e.programTable&&e.programTable[0]&&e.programTable[0].audio,audioCodec:e.audioCodec}})),this.setMediaGroup(e,r),i&&i.type===p.MediaType.MIXED&&this.hasAudio&&(i.type=p.MediaType.VIDEO)}this.trackList.forEach((function(e,t){e.id=t}))},Object.defineProperty(t.prototype,"advancedDateTime",{get:function(){var e=this.trackList.filter((function(e){return e.type===p.MediaType.VIDEO||e.type===p.MediaType.MIXED}))[0];return e&&e.advancedDateTime||0},enumerable:!1,configurable:!0}),t.prototype.setVideoTracks=function(e){if(!e.levels||0===e.levels.length)return null;var t=new d.default(e.levels,{baseURL:e.baseURI||this.baseURI,type:p.MediaType.MIXED,trackLevelsFilter:this.config.trackLevelsFilter,loader:this.loader,maxNoUpdateFlushCount:this.config.maxNoUpdateFlushCount,lowLatencyMode:this.config.lowLatencyMode});return this.trackList.push(t),t},t.prototype.setMediaGroup=function(e,t){var r=this;if(e.media&&0!==e.media.length){var i=e.media;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((function(n){var o=i.filter((function(e){return e.type===n}));if(o&&o.length>0){var a=new d.default(o,{baseURL:e.baseURI||r.baseURI,type:p.MediaType[n.replace(/S$/,"")],trackLevelsFilter:r.config.trackLevelsFilter,loader:r.loader});"AUDIO"===n&&(r.hasAudio=!0,t&&(a.audioCodecs=t)),r.trackList.push(a)}}))}},t.prototype.addTrackEvent=function(){var e=this;this.trackList.forEach((function(t){var r;t.on(p.TrackEvent.SWITCHED,e.onTrackSwitched.bind(e)),t.on(p.TrackEvent.ERROR,e.onError.bind(e)),(t.type===p.MediaType.MIXED||t.type===p.MediaType.VIDEO)&&(r="function"==typeof e.config.startLevel?e.config.startLevel(t.getAllTrackLevel()):"number"==typeof e.config.startLevel?t.getAllTrackLevel().length>=e.config.startLevel?e.config.startLevel:t.getAllTrackLevel().length-1:0,t.selectLevel(r))}))},t.prototype.onTrackSwitched=function(e){var t=e.trackLevel,r=e.trackId,i=t;if(this.emit(p.ManifestEvent.TrackLevelSwitched,t,this.trackList[r]),this.isReady||this.trackList.filter((function(e){return e.ready})).length===this.trackList.length&&(this.isReady=!0,this.emit(p.ManifestEvent.READY)),i.type===p.MediaType.MIXED||i.type===p.MediaType.VIDEO){var n=this.trackList.filter((function(e){return e.type===p.MediaType.AUDIO}))[0];if(n){var o=n.getAllTrackLevel();if(i.current&&i.current.programTable&&i.current.programTable[0]&&i.current.programTable[0].audio){var a=i.current.programTable[0].audio;o=o.filter((function(e){return e.info.groupId===a}))}for(var s=0,u=0;u<o.length;u++){var c=o[u];c.info&&c.info.default&&(s=c.id)}n.selectLevel(s)}var l=this.trackList.filter((function(e){return e.type===p.MediaType.SUBTITLE}))[0];if(l){var d=l.getAllTrackLevel(),h=0;for(u=0;u<d.length;u++){var f=d[u];f.info&&f.info.default&&(h=f.id)}l.selectLevel(h)}}},t.prototype.reset=function(){c.default.trace(this.ID,"Manifest reset"),this.hasAudio=!1,this.isReady=!1,e){e.off(),e.destroy()})),this.trackList=[],this.request&&(this.request.abort(),delete this.request)},Object.defineProperty(t.prototype,"isLive",{get:function(){var e=this.trackList.filter((function(e){return e.type===p.MediaType.VIDEO||e.type===p.MediaType.MIXED}))[0];return!!e&&e.current&&e.current.live},enumerable:!1,configurable:!0}),t.prototype.getTotalDuration=function(){var e=this.trackList.filter((function(e){return e.type===p.MediaType.VIDEO||e.type===p.MediaType.MIXED}))[0];return e&&e.current?e.current.live?1/0:e.current.segmentList.reduce((function(e,t){return e+t.duration}),0):0},t}(p.EventBus);t.default=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=new WeakMap,n=0,o=function(){function e(){}return e.prototype.then=function(e){e()},e.prototype.when=function(e){e()},e.prototype.clear=function(){},e}(),a=function(){function e(e){this.flag=e,this.id=n++,this.handlers=[]}return e.of=function(t,r){var n=i.get(t);n||(n={},i.set(t,n));var a=n[r];if(!a){if("boolean"!=typeof t[r])throw new Error(t.constructor.name+"."+r+"  must be a boolean type!");if(void 0===t[r])return a=new o,n[r]=a,a;a=new e(t[r]),Object.defineProperty(t,r,{get:function(){return a.flag},set:function(e){a.set(e)}})}return n[r]=a,a},e.prototype.when=function(e){this.flag&&Promise.resolve(!0).then(e),this.handlers.push([e,!1])},e.prototype.clear=function(){this.handlers=[]},e.prototype.then=function(e){this.flag&&Promise.resolve(!0).then(e),this.handlers.push([e,!0])},e.prototype.set=function(e){!this.flag&&e&&(this.handlers=this.handlers.filter((function(e){var t=e[0],r=e[1];return t(!0),!r}))),this.flag=e},e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=void 0;var i={};function n(e,t,r,i,o){return void 0===o&&(o=0),new Promise((function(a,s){e.length>0?e[o].doFilter.apply(e[o],[function(){for(var i=[],u=0;u<arguments.length;u++)i[u]=arguments[u];o<e.length-1?n(e,t,r,i,o+1).then((function(e){a(e)})).catch((function(e){s(e)})):a(t.apply(r,i))},function(e){return s(e)}].concat(i)):a(t.apply(r,i))}))}t.Filter=function(e){return function(t,r,o){var a=o.value;o.value=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n("@"===e[0]?i[e.slice(1)t.StockEvent=d.default},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.MEDIA_APPENDED=0]="MEDIA_APPENDED",e[e.BUFFER_REMOVED=1]="BUFFER_REMOVED",e[e.BUFFER_FULL=2]="BUFFER_FULL",e[e.RESET=3]="RESET",e[e.CHUNK_REMOVED=4]="CHUNK_REMOVED"}(i||(i={})),t.default=i},function(e,t,r){"use strict";var i;Object.defineProperty(t,"OM_EVENT="customevent"}(i||(i={})),t.default=i},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ERROR="error"}(i||(i={})),t.default=i},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CANPLAY="canplay",e.SEEKED="seeked",e.PLAYING="playing",e.WAITING="waiting",e.DRAIN="drain",e.TIMEUPDATE="timeupdate",e.SYNC="sync",e.SYNC_DONE="syncdone"}(i||(i={})),t.default=i},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CHUNK_UPDATE="chunkupdate",e.ERROR="error",e.FINISH="finish",e.BUFFER_HUNGER="bufferhunger",e.STOCK_ABORT="stockabort",e.STOCK_COMPLETE="stockcomplete",e.META_INFO="metainfo"}(_esModule",{value:!0})},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferRange=t.EventBus=void 0;var n=i(r(8));t.EventBus=n.default;var o=i(r(56));t.BufferRange=o.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof TimeRanges&&(TimeRanges.prototype.dump=function(e){for(var t=[],r=0;r<this.length;r++)t.push(this.start(r)+"~"+this.end(r));if(e)return t.join(" , ");console.log(t.join(" , "))});var i=function(){function e(e){this.ranges=e.reduce((function(e,t){var r=e[e.length-1];return!r||r[1]<t[0]?e.push(t):(r[1]===t[0]||console.warn("range overlap!"),r[1]=t[1]),e}),[])}return e.fromTimeRanges=function(t){var r=[];if(t instanceof TimeRanges)for(var i=0;i<t.length;i++)r.push([t.start(i),t.end(i)]);return new e(r)},e.pushRange=function(e,t,r){0===e.length||t>=e[e.length-1][1]?e.push([t,r]):r>=e[e.length-1][1]&&(e[e.length-1][1]=r)},e.unionTwoTimeRanges=function(t,r){for(var i=0,n=0,o=[];i<t.length&&n<r.length;)t.start(i)<=r.start(n)?t.end(i)<=r.start(n)?(e.pushRange(o,t.start(i),t.end(i)),i++):t.end(i)<=r.end(n)?(e.pushRange(o,t.start(i),r.end(n)),i++,n++):t.end(i)>r.end(n)?n++:console.error(""):t.start(i)>r.start(n)&&t.start(i)<r.end(n)?t.end(i)<r.end(n)?i++:t.end(i)>=r.end(n)?(e.pushRange(o,r.start(n),t.end(i)),n++,i++):console.error(""):(e.pushRange(o,r.start(n),r.end(n)),n++);for(;i<t.length;)(0===o.length||t.start(i)>=o[o.length-1][1])&&o.push([t.start(i),t.end(i)]),i++;for(;n<r.length;)(0===o.length||r.start(n)>=o[o.length-1][1])&&o.push([r.start(n),r.end(n)]),n++;return new e(o)},e.joinTwoTimeRanges=function(t,r){for(var i=0,n=0,o=[];i<t.length&&n<r.length;)t.start(i)<=r.start(n)?(t.end(i)<=r.start(n)||o.push([r.start(n),t.end(i)]),i++):t.start(i)>=r.end(n)?n++:t.end(i)<=r.end(n)?(o.push([t.start(i),t.end(i)]),i++):(o.push([t.start(i),r.end(n)]),n++);return new e(o)},e.fromSegments=functnew e(t.map((function(e){return[e.start,e.end]})))},e.prototype.indexOf=function(e,t){void 0===t&&(t=0);for(var r=0;r<this.ranges.length;r++)if(e>=this.ranges[r][0]-t&&e<=this.rangesion(e,t){return this.ranges[this.indexOf(e,t)]},Object.defineProperty(e.prototype,"Lenanges.reduce((function(e,t){return e+t[1]-t[0]}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.ranges.length},enumerable:!1,configurable:!0}),e.prototype.start=function(e){return this.ranges[e][0]},e.prototype.dump=function(e){var t=this.ranges.map((function(e){return e.join("-")})).join("otype.end=function(e){etRanges=function(e){return this.ranges=e,this},e.prototype.toGap=function(){var e=[];if(this.ranges.length>0&&this.ranges[0][0]>0&&e.push([0,this.ranges[0][0]]),this.ranges.length>1)for(var t=1;t<this.ranges.length;t++)e.push([this.ranges[t-1][1],this.ranges[t][0]]);return this.setRanges(e)},e.prototype.getBufferInfo=function(e,t){t=t||0;for(var r=0;r<this.ranges.length;r++){if(e<this.ranges[r][0]-t)return{bufferLength:0,bufferEnd:e,bufferStart:e};if(e>=this.ranges[r][0]-t&&e<=this.ranges[r][1])return{bufferLength:this.ranges[r][1]-e,bufferEnd:this.ranges[r][1],bufferStart:this.ranges[r][0]}}return{bufferLength:0,bufferEnd:e,bufferStart:e}ion(){return this.ranges[this.ranges.length-1]},enumerable:!1,configurable:!0}),"Start",{get:function(){return this.ranges[0]},enumerable:!1,configurable:!0}),e.START=0,e.END=1,e.Empty=new e([]),e}();t.default=i},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.M2TS="m2ts",e.FLV="flv",e.MP4="mp4",e.WEBM="webm",e.MOV="mov",e.MKV="mkv",e.UNKNOWNTER=3]="RENDER_FILTER"}(i||(i={})),t.default=i},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptMethodType=void 0,function(e){e[e.NONE=0]="NONE",e[e.WIDEVINE=1]="WIDEVINE",e[e.FAIRPLAY=2]="FAIRPLAY",e[e.PLAYREADY=3]="PLAYREADY",e[e.CLEARKEY=4]="CLEARKEY",e[e.CHINADRM=5]="CHINADRM",e[e.AES_128=6]="AES_128",e[e.SAMPLE_AES=7]="SAMPLE_AES",e[e.CUSTOMIZED=8]="CUSTOMIZED",e[e.UNKNOWN=er=n.default;var o=i(r(62));t.Codecs=o.default},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(8)),s=o(r(5)),u=function(e){function t(t){var r=e.call(this)||this;return r.buffer=[],r.callback=t,r}return n(t,e),t.prototype.write=function(e,t){t===s.default.DATA&&this.buffer.push(e)},t.prototype.writeMeta=function(e){},t.prototype.getResult=function(){var e,t;return this.promise=(e={},(t=new Promise((function(t,r){e.resolve=t,e.reject=r}))).defer=e,t),this.promise},t.prototype.end=function(){var e=this.buffer[0];if(e){var t=void 0;"string"==typeof e?t=this.buffer.reduce((function(e,t){return e+t}),""):"number"==typeof e?t=this.buffer.reduce((function(e,t){return e+t}),0):e instanceof ArrayBuffer?t=function(e){if(1==e.length)return e[0];var t=e.reduce((function(e,t){return e+t.byteLength}),0),r=new Uint8Array(t),i=0;return e.forEach((function(e){r.set(new Uint8Array(e),i),i+=e.byteLength})),r.buffer}(this.buffer):ArrayBuffer.isView(e)&&(t=function(e){if(1===e.length)return e[0];var t=e.reduce((function(e,t){return e+t.byteLength}),0),r=new e[0].constructor(t),i=0;return e.forEach((function(e){r.set(e,i),i+=e.byteLength})),r}(this.buffer)),this.callback&&this.callback(t),this.promise&&this.promise.defer.resolve(t)}else this.callback&&this.callback(),this.promise&&this.promise.defer.resolve()},t}(a.default);t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(12),n=function(){function e(){}return e.generateCodec=function(t,r){return"video"===t?e.generateVideoCodec(r):"audio"===t?e.generateAudioCodec(r):void 0},e.generateAudioCodec=function(e){var t=e.id,r=void 0===t?"aac":t,n=e.audioObjectType;return e.samplingFrequencyIndex>=6&&(n=5),{name:"AAC-"+(2===n?"LC":"SBR")+"@"+(e.sampleRate/1e3).toFixed(1)+"KHz",id:r,type:i.MediaType.AUDIO,mime:"mp4a.40."+n}},e.generateVideoCodec=function(e){var t=e.id,r=void 0===t?"avc1":t,n=e.profileIdc,s=e.levelIdc,u=(e.sarRatio,e.profileCompatibility),c=r+".",l=o[n];return c+=Number(n).toString(16)+a(Number(u).toString(16))+a(Number(s).toString(16)),{type:i.MediaType.VIDEO,mime:c,name:"H264 "+l+"@L"+(s/10).toFixed(1),id:r}},e}();t.default=n;var o={66:"Base",77:"Main",100:"High",110:"High 10",122:"High 4:2:2",244:"High 4:4:4"};function a(e){return((""+e).length<2?"0":"")+e}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a,s=o(r(7)),u=o(r(23)),c=r(20),l=r(1),p=r(31),d=o(r(78)),h=r(33),f=o(r(6));!function(e){e.No="",e.Yes="YES",e.v2="v2"}(a||(a={}));var m,y,g=/chrome|firefox/.test(navigator.userAgent.toLowerCase());!function(e){e[e.EMPTY_PLAYLIST=0]="EMPTY_PLAYLIST",e[e.LIVE_SEGMENT_STALLED=1]="LIVE_SEGMENT_STALLED",e[e.REQUEST_ERROR=2]="REQUEST_ERROR",e[e.INIT_SEGMENT_ERROR=3]="INIT_SEGMENT_ERROR"}(m||(m={})),function(e){e[e.PARSER_ERROR=0]="PARSER_ERROR"}(y||(y={}));var v=c.XError.registerError("NET","MNF",m),b=c.XError.registerError("PAS","MNF",y),E=function(e){function t(t,r){var i=e.call(this)||this;return i.checkCodecSupported=!1,i.ID="TRACK",r.baseURL?i.baseURL=r.baseURL:i.baseURL=window.location.href,r.trackLevelsFilter&&(i.trackLevelsFilter=r.trackLevelsFilter),i.type=r.type,i.loader=r.loader,i.config=r,i.prevLevelInfo={},i.levels=[],i.oldLevels=[],i.ready=!1,i.mediaTypeChecked=!1,t?(i.initLevels(t),i):i}return n(t,e),t.prototype.initLevels=function(e){var t=this;if(e.length){var r=[],i=!1,n=!1;(e=e.sort((function(e,t){return e.bandwidth-t.bandwidth}))).forEach((function(e){var o=new d.default(e,t.baseURL,{type:t.type,lowLatencyMode:t.config.lowLatencyMode,preloadOn:t.config.preloadOn});i=i||!!o.videoCodec,n=n||!!o.audioCodec,g&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(o.audioCodec=null),r.push(o)})),i&&n&&(r=r.filter((function(e){return!!e.videoCodec}))),[l.MediaType.AUDIO,l.MediaType.VIDEO,l.MediaType.MIXED].indexOf(this.type)>0&&(this.checkCodecSupported?r=r.filter((function(e){var t=!e.audioCodec||p.isCodecSupportedInMp4(e.audioCodec,"audio"),r=!e.videoCodec||p.isCodecSupportedInMp4(e.videoCodec,"video");return t&&r})):r.forEach((function(e){e.audioCodec&&!p.isCodecSupportedInMp4(e.audioCodec,"audio")&&(e.audioCodec=""),e.videoCodec&&!p.isCodecSupportedInMp4(e.videoCodec,"video")&&(e.videoCodec="")})));var o=!1;if(r.forEach((function(e,t){e.info.default&&(o=!0),e.id=t})),this.type===l.MediaType.AUDIO&&!o&&r.length&&(r[0].info.default=!0),this.oldLevels=r,r.length>0&&(this.levels=r),"function"==typeof this.trackLevelsFilter){var a=this.trackLea.then?a.then((function(e){t.updateLevels(r,e)})):this.updateLevels(r,a)}}},t.prototype.updateLevels=function(e,t){(e=t&&t.length>0?t:e).forEach((function(e,t){e.id=t})),this.levels=e},t.prototype.loadPlayList=function(e){var t=this;return new Promise((function(r,i){if(e){t.clearTimer();var n=!1,o=e.url;if((0===e.segmentList.length||e.live)&&(n=!!o),n){var a=t.loader.request({schema:l.URISchema.HTTP,location:e.url,dataType:l.DataType.TEXT});a.on(l.RequestEvent.ERROR,(function(t){i(v.of(m.REQUEST_ERROR,c.XError.Severity.FATAL,"manifest request fail(l.RequestEvent.META,(function(e){t.metaInfo=e})),a.pipe(new h.Parser).on("fin{t.onPlayListLoaded(n,e).then((function(){r(e)})).catch((function(e){i(e)}))})).catch((function(e){i(b.of(y.PARSER_ERROR,c.XError.Severity.FATAL,"manifest parse error"))})),t.request=a}else t.loadInitMaps(e).then((function(t){r(e)})).catch((function(e){i(e)}))}else i()}))},t.prototype.onPlayListLoaded=function(e,t){var r=this,i=performance.now(),n=this.metaInfo.firstLoadingTime?Math.max(0,i-this.metaInfo.firstLoadingTime):0;return this._advancedDateTime=Date.now()-n,new Promise((function(i,n){if(null==r.changingId||t.id===r.changingId){if(t.update(e,r.initProgramDate)&&r.emit(l.TrackEvent.SEGMENT_UPDATE,t.segmentList),t.live){if(t.countUpdated>3)return void n(v.of(m.LIVE_SEGMENT_STALLED,c.XError.Severity.FATAL,"live update stalled!"));r.config.lowLatencyMode&&(r.prevLevelInfo.partTarget=e.partTarget,r.prevLevelInfo.targetDuration=e.targetDuration,r.prevLevelInfo.renditionReports=e.renditionReports),r.prevLevelInfo.live=!0}else r.prevLevelInfo.live=!1;r.loadInitMaps(t).then((function(o){if(null==r.changingId||t.id===r.changingId){if(t.live)if(r.changeLevelURL(e,t),r.config.lowLatencyMode)r._load(t);else{var a=r.timer=window.setTimeout((function(){r._load(t)}),a)}i(t)}else n()})).catch((function(e){n(e)}))}else n()}))},t.prototype.changeLevelURL=function(e,t){if(e.canBlockReload&&this.config.lowLatencyMode){var r=void 0,i=void 0,n=t.segments[t.segments.length-1];if(e.partList.length>0){var o=e.partList.filter((function(e){return!e.preload})),a=o[o.length-1].lastPart;r=a?n.id+1:n.id,i=a?0:n.partList.filter((function(e){return!e.preload})).length}else r=n.id+1;var u=Math.max(Date.now()-this._advancedDateTime,0)/1e3,c=this.metaInfo&&this.metaInfo.headers&&this.metaInfo.headers.age?Number(this.metaInfo.headers.age):0,l=u+c,p=Math.min(l-e.partTarget,1.5*e.targetDuration);if(p>0){if(this.prevLevelInfo&&this.prevLevelInfo.prevTuneInGoal){var d=this.prevLevelInfo.prevTuneInGoal;s.default.warn(this.ID,"CDN Tune-in goal increased from: "+d+" to: "+p+" with playlist age: "+u),p=0}else{var h=Math.floor(p/e.targetDuration);r+=h,null!=i&&(i+=Math.round(p%e.targetDuration/e.partTarget)),s.default.trace(this.ID,"CDN Tune-in age: "+c+"s last advanced "+u.toFixed(2)+"s goal: "+p+" skip sn "+h+" to part "+i)}this.prevLevelInfo.prevTuneInGoal=p}var f=this.skipValue(e,r,n.id);t.url=this.addDirectivesToUrl(r,i,f,t.url)}},t.prototype.loadInitMaps=function(e){var t=this;return reduce((function(e,t){return e[t.location]=t,e}),{});e.programTable&&e.programTable.forEach((function(e,r){e.initURI&&e.initSegment&&n[e.initURI.location]&&(s.default.trace(t.ID,t._type+" trackId:"+t.id,"init segment ",e.initURI.location),delete n[e.initURI.location])}));var o=Object.keys(n),a=o.map((function(e){return t.loader.request(n[e]).pipe(new l.LoaderReader).getResult()}));Promise.all(a).then((function(i){i&&i.length>0&&(i.forEach((function(e,r){"string"==typeof e?(t.mediaTypeChecked=!0,t.type=e,s.default.trace(t.ID,t._type+" trackId:"+t.id,"loaded segment check type",t.type)):n[o[r]]=new Uint8Array(e)})),e.programTable&&e.programTable.forEach((function(e,t){e.initURI&&(e.initSegment=n[e.initURI.location])}))),r(!0)})).catch((function(e){var t=v.of(m.INIT_SEGMENT_ERROR,c.XError.Severity.FATAL,"",e.code,e.url);i(t)}))}))},t.prototype.getTracksType=function(e){var t=this;return new Promise((function(r,i){var n,o=t.loader.request({schema:e.schema,location:e.location,dataType:e.dataType});o.on(l.RequestEvent.DATA,(function(e){var t=new u.default;t.write(new Uint8Array(e));var i=t.findAllStream(),o=i.find((function(e){return e.type===l.MediaType.VIDEO})),a=i.find((function(e){return e.type===l.MediaType.AUDIO}));n=o&&a?l.MediaType.MIXED:a?l.MediaType.AUDl.RequestEvent.ERROR,(function(e){r(l.MediaType.MIXED)}))}))},t.prototype.getIntervalTime=function(e,t){var r=5,i=performance.now(),n=this.metaInfo.firstLoadingTime?Math.max(0,i-this.metaInfo.firstLoadingTime):0;return 1e3*(r=this.config.lowLatencyMode&&e.partTarget?e.partTarget/2:t.countUpdated>0?t.targetDuration/2:Math.max(1,t.targetDuration-n))>2147483647&&(r=2147483.647),1e3*r},t.prototype.skipValue=function(e,t,r){var i=a.No,n=e.canSkipUntil,o=e.canSkipDateRanges;return n&&t-r<n&&(i=o?a.v2:a.Yes),i},t.prototype.addDirectivesToUrl=function(e,t,r,i){return null!=e&&(i=f.default.addParams(i,"_HLS_msn",e.toString())),null!=t&&(i=f.default.addParams(i,"_HLS_part",t.toString())),r&&(i=f.default.addParams(i,"_HLS_skip",r)),i},t.prototype._load=function(e){var ton(e){})).catch((function(mer&&(window.clearTimeout(this.timer),this.timer=null)},t.prototype.handleLoadError=function(e,t){s.default.trace(this.ID,this._type+" Track Loaded error,"+t+", track "+e.id+" disable it"),e.enabled=!1;for(var r=e.id,i=r,n=this.levels.length-1;n>=0;n--)if(this.levels[n].enabled){i=n;break}if(i===r)return s.default.warn(this._type+" Track "+this.id+" No fallback "),void this.onError(t);s.default.trace(this.ID,this._type+" Find new Tracpe.onError=function(e){this.ekLevel=function(e){return e?s&&this.levels.filter((function(e){return e.enabled}))},t.prototype.switchParams=function(e,t){for(var r=0;r<t.length;r++){var i=t[r],n=""+i.uri;if(n===e.slice(-n.length)){var o=parseInt(i.lastMsn),s=parseInt(i.lastPart),u=Math.max(Date.now()-this.advancedDateTime,0)/1e3||0,c=Math.min(u-this.prevLevelInfo.partTarget,this.prevLevelInfo.targetDuration);return void 0!==s&&c>this.prevLevelInfo.partTarget&&(s+=1),this.addDirectivesToUrl(o,s,a.No,e)}}},t.prototype.selectLevel=function(e){var t=this;if(this.changingId!==e||!this.levels[this.changingId])if(e<0||e>=this.levels.length)s.default.warn("Invalid id passed to track controller");else{this.changingId=e,this.current&&this.current.live&&this.current.segmentList[0]&&!this.current.segmentList[0].programDateTime&&this.levels[e].inherit(this.current);var r=this.levels[e];s.default.trace(this.ID,this._type+" Track switching trackId:",this.id,"levelId:",e),this.emit(l.TrackEvent.SWITCHING,{trackId:this.id,trackLevel:r}),this.config.lowLatencyMode&&this.prevLevelInfo&&this.prevLevelInfo.renditionReports&&this.prevLevelInfo.live&&(r.url=this.switchParams(r.url,this.prevLevelInfo.renditionReports)||r.url),this.loadPlayList(r).then((function(i){t.levelId=e,t.ready=!0,!t.initProgramDate&&r.segmentList.length>0&&r.segmentList[0].programDateTime&&(t.initProgramDate=r.segmentList[0].programDateTime),t.emit(l.TrackEvent.SWITCHED,{trackId:t.id,trackLevel:r})})).catch((function(r){r&&t.handleLoadError(t.levels[e],r)}))}},t.prototype.update=function(e){for(var t=!1,r=0;r<e.length;r++){var i=e[r];this.levels[r]&&(t=this.levels[r].update(i)||t)}return t},t.prototype.setLevels=function(e){e.forEach((function(e,t){e.id=t})),this.levels=e},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:funls&&this.levels.forEach((function(t){return t.type=e,t}))},enumerable:!1,configurablrent",{get:function(){return this.levels[this.levelId]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"advancedDateTime",{get:function(){return this._advancedDateTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"audioCodecs",{set:function(e){this.type===l.MediaType.AUDIO&&e&&e.length&&this.levels.len.filter((function(e){return e.groupId===t.info.groupId}));!t.audioCodec&&r.length>0&&(t.audioCodec=r[0].audioCodec),t.audioCodec||(t.audioCodec=e[0].audioCodec)}))},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.request&&this.request.destroy(),this.clearTimer(),this.off(),this.levels.forEach((function(e){return e.destroy()})),this.levels=[],this.oldLevels=[]},t}(l.EventBus);t.default=E},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=i(r(65)),a=i(r(68)),s=i(r(73)),u=[],c=function(){function e(){}return e.from=function(e){var t=u.filter((function(t){var r=t[0],i=t[1];return e===r||i&&i.test(e)}))[0];if(t)return new t[2];thrond!")},e.registerCodec=function(e,t,r){u.push([t,r,e])},e}();t.default=c,c.registerCodec(o.default,n.CodecID.AVC,/^avc1\./),c.registerCodec(a.default,n.CodecID.AAC,/^mp4a\./),c.registerCodec(s.default,n.CodecID.HEVC,/^(hvc1|hev1)\./)},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=i(r(24)),a=i(r(66)),s=r(0),u=r(3),c=i(r(26));function l(e){for(var t=new Uint8Array(e.reduce((function(e,t){return e+t.byteLength}),2*e.length)),r=0,i=0;i<e.length;i++)t[r]=(65280&e[i].byteLength)>>>8,t[r+1]=255&e[i].byteLength,t.set(e[i],r+2),r+=2+e[i].byteLength;return t}function p(e,t,r){for(var i=[],n=0;n<r;n++){var o=f(e,t.offset,2);i.push(e.subarray(t.offset+2,t.offset+2+o)),t.offset+=o+2}return i}function d(e){return e.length<2?"0"+e:e}var h=function(){function e(){this.id=n.CodecID.AVC,this.fourCC="avc1",this.configName="avcC"}return e.prototype.createDescription=function(){if(this.description)return this.description;if(this.metadata){var e=l(this.metadata.sps),t=l(this.metadata.pps);return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.reduce((function(e,t){return e+(t.byteLength||t.length||1)}),0),i=new Uint8Array(r),n=0;return e.forEach((function(e){e instanceof Uint8Array?(i.set(e,n),n+=e.byteLength):Array.isArray(e)?(i.set(new Uint8Array(e),n),n+=e.length):"number"==typeof e?(i[n]=e,n++):"string"==typeof e&&(i.set(new Uint8Array(e.split("").map((function(e){return e.charCodeAt(0)}))),n),n+=e.length)})),i}([1,this.metadata.profile,this.metadata.profileCompatibility,this.metadata.level,255,224|this.metadata.sps.length],e,this.metadata.pps.length,t)}return null},e.prototype.getParser=function(){return this.parser||(this.parser=new a.default(this)),this.parser},e.prototype.getDecoder=function(){return this.decoder||(this.decoder=new c.default,this.metadata&&this.decoder.configure(n.CodecID.AVC,this.getCodecString(),this.getMetaData(),this.description)),this.decoder},e.prototype.getBitstreamFormat=function(e){return 0==e[0]&&0===e[1]&&(1==e[2]||0==e[2]&&1==e[3])?s.BitstreamFormat.ANNEX_B:s.BitstreamFormat.AVC},e.prototype.getCodecString=function(){return this.metadata?"avc1."+(Number(this.metadata.profile).toString(16)+d(Number(this.metadata.profileCompatibility).toString(16))+d(Number(this.metadata.level).toString(16))):"avc1"},e.prototype.getMetaData=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata||(this.metadata={id:this.id,width:0,height:0,profile:0,level:0}),Object.assign(this.metadata,e)},e.prototype.init=function(e){this.metadata||(this.metadata={id:this.id,width:0,height:0,profile:0,level:0}),this.metadata=Object.assign(this.metadata,{width:0,height:0,profile:e[1],profileCompatibility:e[2],level:e[3]}),this.description=e,this.metadata.naluLengthSize=4&e[4];var t=31&e[5],r={offset:6};this.metadata.sps=p(e,r,t);var i=e[r.offset++];this.metadata.pps=p(e,r,i);var n=o.default.discardEmulationPreventionBytes(this.metadata.sps[0].subarray(1)),a=o.default.readSequenceParameterSet(n);Object.assign(this.metadata,a)},e.prototype.transBitstream=function(e,t){if(t===s.BitstreamFormat.AVC){var r=this.metadata.naluLengthSize||4;e.units||this.getParser().parse(e);for(var i=e.units.reduce((function(e,t){return e+t.data.byteLength}),0),n=new Uint8Array(i+r*e.units.length),o=0,a=0;a<e.units.length;a++){var c=e.units[a];u.writeIntByByte(n,o,c.data.byteLength,r),o+=r,n.set(c.data,o),o+=c.data.byteLength}return{pts:e.pts,dts:e.dts,timestamp:e.timestamp,duration:e.duration,key:e.key,streamIndex:e.streamIndex,data:n,bsf:s.BitstreamFormat.HEVC}}s.BitstreamFormat.ANNEX_B},e}();function f(e,t,r){for(var i=0,n=r;n>0;n--)i+=e[t+r-n]<<8*(n-1);return i}t.default=h},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(67)),o=r(14)e){this.codec=e,this.naluList=[],this.pendingFrames=[]}return e.prototype.parseAnnexB=function(e,t){var r,i,n=this;void 0===t&&(t=a.BitstreamFormat.ANNEX_B),i=this.buffer?s.mergeBuffer(this.buffer,e.data):e.data;for(var o=0;o<i.byteLength-3;o++)if(1===i[o+2]){r=o+5;break}for(;r<i.byteLength;)switch(i[r]){case 0:if(0!==i[r-1]){r+=2;break}if(0!==i[r-2]){r++;break}o+3!==r-2&&this.collectNALU(i.subarray(o+3,r-2));do{r++}while(1!==i[r]&&r<i.length);o=r-2,r+=3;break;case 1:if(0!==i[r-1]||0!==i[r-2]){r+=3;break}o+3!==r-2&&this.collectNALU(i.subarray(o+3,r-2)),o=r-2,r+=3;break;default:r+=3}this.buffer=i.subarray(o),this.pendingFrames.push({pts:e.pts,dts:e.dts,timestamp:e.timestamp,data:null,streamIndex:e.streamIndex,units:[],size:0,hasCodecFrame:0,done:0}),this.fillFrame();var u=this.pendingFrames.filter((function(e){return e.done}));if(u.length>0){var c=u.map((function(e){return n.convertBsf(e,t)}));return this.pendingFrames=this.pendingFrames.slice(c.length),c.length>1?c:c[0]}return null},e.prototype.convertBsf=function(e,t){if(t===a.BitstreamFormat.ANNEX_B){e.data=new Uint8Array(4*e.units.length+e.size);var r=0;e.bsf=t;for(var i=0;i<e.units.length;i++)e.data.set(u,r),e.data.set(e.units[i].data,r+4),r+=4+e.units[i].data.byteLength}else{if(t!==a.BitstreamFormat.AVC)throw new Error("unsupported target BitstreamFormat:"+t);var n=this.codec.getMetaData().naluLengthSize||4,o=new Uint8Array(e.units.length*n+e.size),c=0;for(i=0;i<e.units.length;i++){var l=e.units[i];s.writeIntByByte(o,c,l.data.byteLength,n),c+=n,o.set(l.data,c),c+=l.data.byteLength}e.data=o,e.bsf=t}return e},e.prototype.flush=function(){var e=this;if(this.buffer&&this.buffer.byteLength>3){if(this.collectNALU(this.buffer.subarray(3)),this.fendingFrames.filter((function(e){return e.units.length})).length)return this.pendingFrames.length,null;var t=this.pendingFrames.map((function(t){return e.convertBsf(t,e.lastTargetBsf)}));return this.pendingFrames=[],t}retur(e){return e.type==o.NALUnitType.ACCESS_UNIT_DELIMITER})).length>0},e.prototype.fillFrame=function(){for(var e,t=0,r=this.pendingFrames[t];e=this.naluList.shift();){var i=r&&r.units.length&&this.hasAUD(r.units);switch(e.type){case o.NALUnitType.ACCESS_UNIT_DELIMITER:r&&r.units.length>0&&i&&(r.done=1,r=this.pendingFrames[++t]);break;case o.NALUnitType.SEI:case o.NALUnitType.PPS:case o.NALUnitType.SPS:case o.NALUnitType.VPS:case o.NALUnitType.IDR:case o.NALUnitType.NDR:if(r&&r.units.length>0&&r.hasCodecFrame){var n=r.units[r.units.length-1].type;i||n!=o.NALUnitType.IDR&&n!=o.NALUnitType.NDR||(r.done=1,r=this.pendingFrames[++t])}}if(!r){this.naluList.unshift(e);break}r.units.push(e),r.size+=e.data.byteLength,e.type===o.NALUnitType.IDR&&(r.hasCodecFrame=1,r.key=!0),e.type===o.NALUnitType.NDR&&(r.hasCodecFrame=1)}},e.prototype.parseAVC=function(e,t){var r=0,i=this.codec.getMetaData(),n=i&&i.naluLengthSize||4;for(e.size=0,e.units=[];r<e.data.byteLength;){var o=s.readIntByByte(e.data,r,n);this.collectNALU(e.data.subarray(r+n,r+n+o)),r+=n+o}return e},e.prototype.parse=function(e,t){if(void 0===t&&(t=e.bsf),this.lastTargetBsf=t,e.bsf===a.BitstreamFormat.ANNEX_B)return this.parseAnnexB(e,t);if(e.bsf===a.BitstreamFormat.AVC)return this.parseAVC(e,t);throw new Error("unknown bitstream format :"+e.bsf)},e.prototype.collectNALU=function(e){var t=new n.default(e);t.data&&(this.naluList.push(t),t.type===o.NALUnitType.SPS?(this.codec.setMetadata(t.config),this.codec.setMetadata({sps:[t.data]})):t.type===o.NALUnitType.PPS&&this.codec.setMetadata({pps:[t.data]}))},e}();t.default=c},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(14),o=i(r(24));t.default=function(e){switch(31&e[0]){case 1:this.type=n.NALUnitType.NDR;break;case 5:this.type=n.NALUnitType.IDR;break;case 6:this.type=n.NALUnitType.SEI,this.escapedRBSP=o.default.discardEmulationPreventionBytes(e.subarray(1));break;case 7:this.type=n.NALUnitType.SPS,this.escapedRBSP=o.default.discardEmulationPreventionBytes(e.subarray(1)),this.config=o.default.readSequenceParameterSet(this.escapedRBSP);break;case 8:this.type=n.NALUnitType.PPS;break;case 9:this.type=n.NALUnitType.ACCESS_UNIT_DELIMITER;break;default:return}this.data=e}},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=i(r(69)),a=i(r(28)),s=r(0),u=i(r(71)),c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=function(){function e(){this.id=n.CodecID.AAC,this.fourCC="mp4a"}return e.prototype.createDescription=function(){return this.description?this.description:new Uint8Array([this.metadata.audioObjectType<<3|this.metadata.samplingFrequencyIndex>>>1,this.metadata.samplingFrequencyIndex<<7|this.metadata.channelCount<<3,6,1,2])},e.prototype.getCodecString=function(){return null!=this.metadata?this.metadata.samplingFrequencyIndex>=6?"mp4a.40.5":"mp4a.40."+this.metadata.audioObjectType:"mp4a.40.2"},e.prototype.getBitstreamFormat=function(e){return 255===e[0]&&240==(246&e[1])?s.BitstreamFormat.ADTS:s.BitstreamFormat.AAC},e.prototype.setMetadata=function(e){this.metadata||(this.metadata={id:this.id}),Object.assign(this.metadata,e)},e.prototype.getMetaData=function(){return this.metadata},e.prototype.getParser=function(){return this.parser||(this.parser=new o.default(this)),this.parser},e.prototype.getDecoder=function(){return this.decoder||(this.decoder=new u.default,this.metadata&&this.decoder.configure(n.CodecID.AAC,this.getCodecString(),this.getMetaData(),this.description)),this.decoder},e.prototype.init=function(e){this.metadata||(this.metadata={id:this.id}),this.description=e;var t=new a.default(e),r={audioObjectType:t.extensionAudioObjectType||t.audioObjectType,sampleCount:1==t.frameLengthFlag?960:1024,sampleRate:t.extensionSamplingFrequency||t.samplingFrequency||c[t.extensionSamplingFrequencyIndex||t.samplingFrequencyIndex],channelCount:t.extensionChannelConfiguration||t.channelConfiguration,samplingFrequencyIndex:t.samplingFrequencyIndex||t.extensionSamplingFrequencyIndex,asc:t};t.sbr&&c[t.extensionSamplingFrequencyIndex]>c[t.samplingFrequencyIndex]&&(r.sampleCount*=2),Object.assign(this.metadata,r)},e.prototype.flush=function(){},e.prototype.transBitstream=function(e,t){return e},e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),n=r(0),o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=function(){function e(e){this.codec=e,this.buffer=null}return e.prototype.parse=function(e,t){return void 0===t&&(t=n.BitstreamFormat.AAC),this.lastTargetBsf=t,e.bsf===n.BitstreamFormat.ADTS?this.parseADTS(e,t):e.bsf===n.BitstreamFort):void 0},e.prototype.parseAAC=function(e,t){return e},e.prototype.parseADTS=function(e,t){var r=[];this.buffer?this.buffer=i.mergeBuffer(this.buffer,e.data):this.buffer=e.data;for(var a,s,u,c,l=0;l+5<this.buffer.length;)if(255===this.buffer[l]&&240==(246&this.buffer[l+1])){s=2*(1&~this.buffer[l+1]),a=(3&this.buffer[l+3])<<11|this.buffer[l+4]<<3|(224&this.buffer[l+5])>>5;var p=1+((192&this.buffer[l+2])>>>6),d=(60&this.buffer[l+2])>>>2;if(c=1024*(1+(3&this.buffer[l+6])),this.buffer[l+2],u=l+a,this.buffer.byteLength<u)break;var h={sampleCount:c,channelCount:(1&this.buffer[l+2])<<2|(192&this.buffer[l+3])>>>6,audioObjectType:p,samplingFrequencyIndex:d,sampleSize:16,sampleRate:o[d]};if(this.codec.setMetadata(h),r.push({bsf:t,streamIndex:e.streamIndex,pts:e.pts+r.length*c*9e4/h.sampleRate,dts:e.dts+r.length*c*9e4/h.sampleRate,timestamp:Math.round(1e6*(e.pts/9e4+r.length*c/h.sampleRate)),data:t===n.BitstreamFormat.AAC?this.buffer.subarray(l+7+s,u):this.buffer.subarray(l,u),duration:c,durationTime:Math.round(1e6*c/h.sampleRate)}),this.lastPts=r[r.length-1].pts+9e4*c/h.sampleRate,this.lastTimestamp=Math.round(1e6*this.lastPts/9e4),this.buffer.byteLength===u){this.buffer=void 0;break}this.buffer=this.buffer.subarray(u)}else l++;return r.length<=1?r.shift():r},e.prototype.flush=function(){return this.buffer&&this.buffer.byteLength>0?this.parseADTS({pts:this.lastPts,dts:this.lastPts,timestamp:this.lastTimestamp,data:new Uint8Array(0)},this.lastTargetBsf):null},e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Math.pow(2,32),n=function(){function e(e){this.data=e,this.pos=0}return e.prototype.reset=function(e){void 0===e&&(e=0),this.pos=e},e.prototype.remainBit=function(){return Math.max(0,8*this.data.byteLength-this.pos)},e.prototype.read=function(e){var t=Math.floor(this.pos/8),r=this.pos%8;if(t>this.data.length-1)return NaN;var n=[];for(this.pos+=e;e>0;){var o=8-r,a=this.data[t],s=Math.pow(2,Math.min(o,e))-1<<Math.max(0,o-e),u=void 0;(u=o>=e?(a&s)>>o-e:(a&s)<<e-o)<0&&(u+=i),n.push(u),e-=o,t++,r=0}return n.reduce((function(e,t){return e|t}))},e}();t.default=n},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(9),s=r(2),u=o(r(29)),c=r(27),l=r(17),p=function(e){function t(t){var r=e.call(this)||this;return r._flushed=!1,r.audioContext=t,r.firstTimestamp=null,r.remuxer=new u.default,"function"!=typeof window.AudioDecoder?r.decoder=new AudioDecoder({output:function(e){r.emit(l.DecoderEvent.DATA,e),0==r.decoder.decodeQueueSizeion(e){console.error(e),r.emit(l.DecoderEvent.ERROR,e)}}):r.audioContext||(r.audioContext=new AudioContext),r}return n(t,e),t.prototype.configure=function(e,t,r,i){if(this.decoder)this.decoder.configure({codec:t,numberOfChannels:r.channelCount,sampleRate:r.sampleRate});else{this.meta=r;var n=new a.Stream(s.MediaType.AUDIO,e,1e3,256);n.index=1,n.codec.setMetadata(r),this.remuxer.setStream([n]),this.stream=n,this.sampleCount=0}},t.prototype.decode=function(e){this._flushed=!1,this.sampleCount++,this.lastPacket=e,this.decoder?this.decoder.decode(new EncodedAudioChunk({data:e.data,timestamp:e.timestamp,type:"key"})):(null===this.firstTimestamp&&(this.firstTimestamp=e.timestamp),this.stream.index!==e.streamIndex&&(this.stream.index=e.streamIndex,this.remuxer.reset()),this.remuxer.write(e))},Object.defineProperty(t.prototype,"Flushed",{get:function(){return this._flushed},enumerable:!1,configurable:!0}),t.prototype.flush=function(){var e=this;if(!this.decoder)return new Promise((function(t,r){var i=e.remuxer.getOutput().data[0];e.audioContext.decodeAudioData(i.buffer).then((function(r){if(e.flag){var i=new AudioBuffer({sampleRate:r.sampleRate,length:r.length-e.meta.sampleCount,numberOfChannels:r.numberOfChannels});i.copyToChannel(r.getChannelData(0).slice(e.meta.sampleCount),0),i.copyToChannel(r.getChannelData(1).slice(e.meta.sampleCount),1),r=i}e.emit(l.DecoderEvent.DATA,{timestamp:Math.round(e.firstTimestamp),data:r,format:"f32-planar",sampleRate:r.sampleRate,channelCount:r.numberOfChannels}),e._flushed=!0,e.firstTimestamp=null,e.emit(l.DecoderEvent.FLUSHED),t(),e.remuxer.reset(),e.remuxer.write(e.lastPacket),e.flag=!0}))}))},t.prototype.reset=function(){},t.prototype.destroy=function(){},t}(c.EventBus);t.default=p},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.MP4Box=t.generateMP4File=t.rex=38]="trex",e[e.tkhd=39]="tkhd",e[e.vmhd=40]="vmhd"}(n||(n={}));var u=Object.keys(n).reduce((function(e,t){return isNaN(+t)&&(e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]),e}),{}),c=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),l=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),p=new Uint8Array([0,0,0,1]),d=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),h=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),f=((i={})[o.MediaType.VIDEO]=d,i[o.MediaType.AUDIO]=h,i),m=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),y=new Uint8Array([0,0,0,0,0,0,0,0]),g=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);function v(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=t.reduce((function(e,t){return e+t.byteLength}),0),n=new Uint8Array(i+8),o=new DataView(n.buffer,n.byteOffset,n.byteLength);o.setUint32(0,n.byteLength),n.set(e,4),i=8;for(var a=0;a<t.length;a++)n.set(t[a],i),i+=t[a].byteLength;return n}function b(){return v(u.ftyp,c,p,c,l)}function E(e,t){void 0===t&&(t=!1);var r=0,i=e.map((function(e,i){return Math.floor(e.duration)>r&&(r=Math.floor(e.duration)),e.type,o.MediaType.VIDEO,function(e,t,r,i){return void 0===i&&(i=!1),e.duration=Math.floor(e.duration)||4294967295,v(u.trak,function(e,t){void 0===t&&(t=!1);var r=e.codec.getMetaData(),i=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(t?0:4278190080&e.duration)>>24,(t?0:16711680&e.duration)>>16,(t?0:65280&e.duration)>>8,255&(t?0:e.duration),0,0,0,0,0,0,0,0,0,0,0,0,e.type===o.MediaType.AUDIO?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&r.width)>>8,255&r.width,0,0,(65280&r.height)>>8,255&r.height,0,0]);return v(u.tkhd,i)}(e,i),function(e,t,r){return void 0===r&&(r=!1),v(u.mdia,function(e,t){void 0===t&&(t=!1);var r=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,e.timescale>>>24&255,e.timescale>>>16&255,e.timescale>>>8&255,255&e.timescale,255&(t?0:e.duration>>>24),255&(t?0:e.duration>>>16),255&(t?0:e.duration>>>8),255&(t?0:e.duration),85,196,0,0]),i=e.codec.getMetaData();if(i.sampleRate){r[12]=i.sampleRate>>>24&255,r[13]=i.sampleRate>>>16&255,r[14]=i.sampleRate>>>8&255,r[15]=255&i.sampleRate;var n=i.sampleRate/e.timescale*e.duration;n=Math.floor(n),r[16]=255&(t?0:n>>>24),r[17]=255&(t?0:n>>>16),r[18]=255&(t?0:n>>>8),r[19]=255&(t?0:n)}return v(u.mdhd,r)}(e,r),(i=e.type,v(u.hdlr,f[i])),function(e,t){return v(u.minf,e.type===o.MediaType.VIDEO?v(u.vmhd,g):v(u.smhd,y),v(u.dinf,v(u.dref,m)),function(e,t){if(-1===t)return v(u.stbl,w(e),v(u.stts,T),v(u.stsc,S),v(u.stsz,A),v(u.stco,R));var r=[u.stbl,w(e),L(e)];return e.type===o.MediaType.VIDEO&&(r.push(function(e){for(var t=[0,0,0,0,(4278190080&e.samples.length)>>24,(16711680&e.samples.length)>>16,(65280&e.samples.length)>>8,255&e.samples.length],r=0;r<e.samples.length;r++){var i=e.samples[r];t.push(0,0,0,1),t.push((4278190080&i.compositionTimeOffset)>>24,(16711680&i.compositionTimeOffset)>>16,(65280&i.compositionTimeOffset)>>8,255&i.compositionTimeOffset)}return v(u.ctts,new Uint8Array(t))}(e)),r.push(function(e){for(var t=[],r=0;r<e.samples.length;r++)1===e.samples[r].isKeyFrame&&t.push(r+1);for(var i=[0,0,0,0,(4278190080&t.length)>>24,(16711680&t.length)>>16,(65280&t.length)>>8,255&t.length],n=0,o=t;n<o.length;n++){var a=o[n];i.push((4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a)}return v(u.stss,new Uint8Array(i))}(e))),r.push(function(e){return v(u.stsc,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,1,(4278190080&e.samples.length)>>24,(16711680&e.samples.length)>>16,(65280&e.samples.length)>>8,255&e.samples.length,0,0,0,1]))}(e),function(e){for(var t=[0,0,0,0,0,0,0,0,(4278190080&e.samples.length)>>24,(16711680&e.samples.length)>>16,(65280&e.samples.length)>>8,255&e.samples.length],r=0,i=e.samples;r<i.length;r++){var n=i[r];t.push((4278190080&n.size)>>24,(16711680&n.size)>>16,(65280&n.size)>>8,255&n.size)}return v(u.stsz,new Uint8Array(t))}(e),function(e){return v(u.stco,new Uint8Array([0,0,0,0,0,0,0,1,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))}(t)),v.apply(null,r)}(e,t))}(e,t));var i}(e,r,i))}(e,0,t?-1:32+e.dataOffset,t)})),n=[u.moov,_(t?0:r,e[0].timescale)];return n=n.concat(i),t&&n.push(function(e){var t=e.map((function(e){return function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.type!==o.MediaType.VIDEO&&(t[t.length-1]=0),v(u.trex,t)}(e)}));return v.apply(null,[u.mvex].concat(t))}(e)),v.apply(null,n)}function _(e,t){var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>>24&255,t>>>16&255,t>>>8&255,255&t,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return v(u.mvhd,r)}var R=new Uint8Array([0,0,0,0,0,0,0,0]),S=R,A=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),T=R;function w(e){return v(u.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),e.type===o.MediaType.VIDEO?function(e){var t=e.codec.getMetaData(),r=t.width,i=t.height,n=[s(e.codec.fourCC),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&r)>>8,255&r,(65280&i)>>8,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,121,111,117,107,117,45,107,109,117,120,45,109,112,52,45,103,101,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),v(s(e.codec.configName),e.codec.createDescription()),v(u.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))];if(t.sarRatio){var o=t.sarRatio[0],a=t.sarRatio[1];n.push(v(u.pasp,new Uint8Array([o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])))}return v.apply(null,n)}(e):function(e){var t=e.codec.getMetaData();return v(s(e.codec.fourCC),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelCount)>>8,255&t.channelCount,0,16,0,0,0,0,(65280&t.sampleRate)>>8,255&t.sampleRate,0,0]),function(e){e.codec.getMetaData();var t=e.codec.createDescription();return v(u.esds,new Uint8Array([0,0,0,0,3,23+t.byteLength,0,0,0,4,15+t.byteLength,64,21,0,6,0,0,0,218,192,0,0,218,192,5,t.byteLength]),t,new Uint8Array([6,1,2]))}(e))}(e))}function L(e){for(var t=[0,0,0,0,(4278190080&e.samples.length)>>24,(16711680&e.samples.length)>>16,(65280&e.samples.length)>>8,255&e.samples.length],r=0,i=e.samples;r<i.length;r++){var n=i[r];t.push(0,0,0,1),t.push((4278190080&n.duration)>>24,(16711680&n.duration)>>16,(65280&n.duration)>>8,255&n.duration)}return v(u.stts,new Uint8Array(t))}function O(e){var t=v(u.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),r=Math.floor(e.baseMediaDecodeTime/(a+1)),i=Math.floor(e.baseMediaDecodeTime%(a+1)),n=v(u.tfdt,new Uint8Array([1,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i]));if(e.type===o.MediaType.AUDIO){var s=P(e,92);return v(u.traf,t,n,s)}var c=function(e){for(var t=e.samples||[],r=new Uint8Array(4+t.length),i=0;i<t.length;i++){var n=t[i].flags;r[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy}return v(u.sdtp,r)}(e),l=P(e,c.length+92);return v(u.traf,t,n,l,c)}function x(e,t){var r=0,i=0,n=0,o=0;return e.length&&(void 0!==e[0].duration&&(r=1),void 0!==e[0].size&&(i=2),void 0!==e[0].flags&&(n=4),void 0!==e[0].compositionTimeOffset&&(o=8)),[0,0,r|i|n|o,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]}function P(e,t){return e.type===o.MediaType.AUDIO?function(e,t){for(var r=e.samples||[],i=x(r,t+=20+8*r.length),n=0;n<r.length;n++){var o=r[n];i=i.concat([(4278190080&o.duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size])}return v(u.trun,new Uint8Array(i))}(e,t):function(e,t){for(var r=e.samples||[],i=x(r,t+=20+16*r.length),n=0;n<r.length;n++){var o=r[n];i=i.concat([(4278190080&o.duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size,o.flags.isLeading<<2|o.flags.dependsOn,o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,61440&o.flags.degradationPriority,15&o.flags.degradationPriority,(4278190080&o.compositionTimeOffset)>>>24,(16711680&o.compositionTimeOffset)>>>16,(65280&o.compositionTimeOffset)>>>8,255&o.compositionTimeOffset])}return v(u.trun,new Uint8Array(i))}(e,t)}function D(e){return v(u.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(1671&e]))}functionn(e){return 0==e.id}))&&e.forEach((function(e){e.id+=1}))}function I(e,t,r,i){k(t);var n=b(),o=E(t,!0),a=new Uint8Array(n.byteLength+o.byteLength);a.set(n),a.set(o,n.byteLength);var s=0,c=t.map((function(t){var r=function(e,t){var r=t.map((function(e){return O(e)}));return v.apply(null,[u.moof,D(e)].concat(r))}(e,[t]);return s+=r.byteLength,r})),l=new Uint8Array(s+i),p=0;return c.forEach((function(e,t){l.set(e,p),p+=e.byteLength,l.set(r[t],p),p+=r[t].byteLength})),[a,l]}function M(e,t,r){k(e);var i=b(),n=E(e),o=new Uint8Array(i.byteLength+n.byteLength+r);o.set(i);var a=i.byteLength;return t.forEach((function(e){o.set(e,a),a+=e.byteLength})),o.set(n,a),o}P4File=M,t.MP4Box={mdat:function(e){return v(u.mdat,e)},generateMP4File:M,generateFMP4File:I}},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),a=n(r(74)),s=n(r(76)),u=n(r(30)),c=r(0),l=r(3),p=n(r(26));function d(e,t,r){for(var i=[],n=0;n<r;n++){var o=f(e,t.offset,2);i.push(e.subarray(t.offset+2,t.offset+2+o)),t.offset+=o+2}return i}var h=function(){function e(){this.id=o.CodecID.HEVC,this.fourCC="hvc1",this.configName="hvcC"}return e.prototype.createDescription=function(){if(this.description)return this.description;if(this.metadata){var e=this.metadata,t=e.sps||[],r=e.pps||[],n=e.vps||[],o=t.length+r.length+n.length,a=[];a.push(63&(126&t[0][0])>>1),a.push(0),a.push(1),a.push(t[0].length>>8&255),a.push(255&t[0].length),a.push.apply(a,Array.from(t[0]));var s=[];s.push(63&(126&n[0][0])>>1),s.push(0),s.push(1),s.push(n[0].length>>8&255),s.push(255&n[0].length),s.push.apply(s,Array.from(n[0]));var u=[];u.push(63&(126&r[0][0])>>1),u.push(0),u.push(1),u.push(r[0].length>>8&255),u.push(255&r[0].length),u.push.apply(u,Array.from(r[0]));var c=e.compatibilityFlag,l=e.constraintFlag,p=e.parallelismType,d=e.min_spatial_segmentation_idc;return d||(p=0),new Uint8Array(i([1,255&(e.profileIdc|e.profileSpace<<6|e.profileTierFlag<<5),parseInt(c.slice(0,8).join(""),2),parseInt(c.slice(8,16).join(""),2),parseInt(c.slice(16,24).join(""),2),parseInt(c.slice(24,32).join(""),2),parseInt(l.slice(0,8).join(""),2),parseInt(l.slice(16,24).join(""),2),parseInt(l.slice(32,40).join(""),2),parseInt(l.slice(40,48).join(""),2),parseInt(l.slice(48,56).join(""),2),parseInt(l.slice(56,64).join(""),2),e.levelIdc,240|d>>8,255&d,252|p,252|e.chromaFormat,248|e.bitDepthLumaMinus8,248|e.bitDepthChromaMinus8,0,0,0|56&e.numTemporalLayers<<3|e.temporalIdNested<<2|this.metadata.naluLengthSize-1,o],s,a,u))}return null},e.prototype.getBitstreamFormat=function(e){return 0==e[0]&&0===e[1]&&(1==e[2]||0==e[2]&&1==e[3])?c.BitstreamForma.parser||(this.parser=new a.default(this)),this.parser},e.prototype.getDecoder=function(){return this.decoder||(this.decoder=new p.default,this.metadata&&this.decoder.configure(o.CodecID.HEVC,this.getCodecString(),this.getMetaData(),thisCodecString=function(){return s.default(this.metadata)},e.prototype.getMetaData=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata||(this.metadata={id:this.id,width:0,height:0,profile:0,level:0,naluLengthSize:4}),Object.assign(this.metadata,e)},e.prototype.init=function(e){this.description=e,this.metadata={id:this.id,width:0,height:0,profile:e[1],profileCompatibility:e[2],level:e[12],naluLengthSize:4},this.metadata.naluLengthSize=4&e[21],e[22];var t=255*e[24]+e[25],r={offset:26};this.metadata.vps=d(e,r,t);var i=255*e[r.offset+1]+e[r.offset+2];r.offset+=3,this.metadata.sps=d(e,r,i);var n=255*e[r.offset+1]+e[r.offset+2];r.offset+=3,this.metadata.pps=d(e,r,n);var o=u.default.discardEmulationPreventionBytes(this.metadata.sps[0].subarray(1)),a=u.default.readSequenceParameterSet(o.subarray(1));Object.assign(this.metadata,a)},e.prototype.transBitstream=function(e,t){if(t===c.BitstreamFormat.HEVC){var r=this.metadata.naluLengthSize||4;e.units||this.getParser().parse(e);for(var i=e.units.reduce((function(e,t){return e+t.data.byteLength}),0),n=new Uint8Array(i+r*e.units.length),o=0,a=0;a<e.units.length;a++){var s=e.units[a];l.writeIntByByte(n,o,s.data.byteLength,r),o+=r,n.set(s.data,o),o+=s.data.byteLength}return{pts:e.pts,dts:e.dts,duration:e.duration,timestamp:e.timestamp,key:e.key,streamIndex:e.streamIndex,data:n,bsf:c.BitstreamFormat.HEVC}}c.BitstreamFormat.ANNEX_B},e}();function f(e,t,r){for(var i=0,n=r;n>0;n--)i+=e[t+r-n]<<8*(n-1);return i}t.default=h},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=i(r(75)),a=r(14),s=function(){function e(e){this.hostCodec=e}return e.prototype.parse=function(e){if(e.units=[],e.size=0,e.bsf===n.BitstreamFormat.ANNEX_B)return this.parseAnnexB(e);if(e.bsf===n.BitstreamFormat.AVC)return this.parseAVC(e);throw new Error("unknown bitstream format :"+e.bsf)},e.prototype.parseAnnexB=function(e){for(var t,r=e.data,i=0;i<r.byteLength-3;i++)if(1===r[i+2]){t=i+5;break}for(;t<r.byteLength;)switch(r[t]){case 0:if(0!==r[t-1]){t+=2;break}if(0!==r[t-2]){t++;break}i+3!==t-2&&this.collectNalu(e,r.subarray(i+3,t-2));do{t++}while(1!==r[t]&&t<r.length);i=t-2,t+=3;break;case 1:if(0!==r[t-1]||0!==r[t-2]){t+=3;break}i+3!==t-2&&this.collectNalu(e,r.subarray(i+3,t-2)),i=t-2,t+=3;break;default:t+=3}return this.collectNalu(e,r.subarray(i+3)),e},e.prototype.parseAVC=function(e){return e},e.prototype.collectNalu=function(e,t){var r=new o.default(e,t);r.data&&(e.units.push(r),e.size+=r.data.byteLength,r.type===a.NALUnitType.SPS?(this.hostCodec.setMetadata(r.config),this.hostCodec.setMetadata({sps:[r.data]})):r.type===a.NALUnitType.PPS?(this.hostCodec.setMetadata(r.config),this.hostCodec.setMetadata({pps:[r.data]})):r.type===a.NALUnitType.VPS?(this.hostCodec.setMetadata(r.config),this.hostCodec.setMetadata({vps:[r.data]})):r.type===a.NALUnitType.IDR&&(e.key=!0))},e.prototype.flush=function(){return null},e}();t.default=s},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(14),o=i(r(30));t.default=function(e,t){var r;switch((126&t[0])>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:this.type=n.NALUnitType.NDR;break;case 19:case 20:this.type=n.NALUnitType.IDR;break;case 32:this.type=n.NALUnitType.VPS,r=o.default.discardEmulationPreventionBytes(t.subarray(1)),this.config=o.default.readVideoParameterSet(r.subarray(1));break;case 33:this.type=n.NALUnitType.SPS,r=o.default.discardEmulationPreventionBytes(t.subarray(1)),this.config=o.default.readSequenceParameterSet(r.subarray(1));break;case 34:this.type=n.NALUnitType.PPS,this.escapedRBSP=o.default.discardEmulationPreventionBytes(t.subarray(1)),this.config=o.default.readPicParameterSet(this.escapedRBSP.subarray(1));break;case 35:this.type=n.NALUnitType.ACCESS_UNIT_DELIMITER;break;case 39:case 40:this.type=n.NALUnitType.SEI;break;default:this.type=n.NALUnitType.OTHER}this.pts=e.pts,this.dts=e.dts,this.data=t}},function(e,t,r){"use strict";function i(e){for(;"0"==e[e.length-1];)e.pop();return 0===(e=e.reverse()).length?"0":function(e){for(var t=[];e.length>8;)t.unshift(e.splice(e.le,t.map((function(e){return Number("0b"+e).toString(16)})).join("")}(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=["hev1"];if(e){t.push(""+function(e){switch(e){case 0:return"";case 1:return"A";case 2:return"B";case 3:return"C";default:return""}}(e.profileSpace)+e.profileIdc);var r=i(e.compatibilityFlag);t.push(r),t.push((e.profileTierFlag?"H":"L")+e.levelIdc);var n=i(e.constraintFlag);return t.push(n),t.join(".")}return"hev1"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),n=r(4),o=function(){function e(){}return e.parsePAT=function(e,t,r){return r&&(t+=e[t]+1),e[t+7],e[t+8],(31&e[t+10])<<8|e[t+11]},e.parsePMT=function(e,t,r){var n,o;if(r&&(t+=e[t]+1),!(1&e[t+5]))throw Error;var a={timedMetadata:{}};for(n=3+((15&e[t+1])<<8|e[t+2])-4,o=12+((15&e[t+10])<<8|e[t+11]);o<n;){var s=e[t+o],u=this.getStreamInfo(s),c=(31&e[t+o+1])<<8|e[t+o+2];if(u===i.MediaType.VIDEO)a.video=+c,a.videoStreamType=s;else if(u===i.MediaType.AUDIO)a.audio=+c,a.audioStreamType=s;else{if(u!==i.MediaType.METADATA)throw Error("[TSParsedPacket]unknown stream type:"+s);a.timedMetadata[c]=s}o+=5+((15&e[t+o+3])<<8|e[t+o+4])}return a},e.getStreamInfo=function(e){var t;switch(e){case 3:case 4:case 17:case 15:t=i.MediaType.AUDIO;break;case 27:case 28:case 36:t=i.MediaType.VIDEO;break;case 21:t=i.MediaType.METADATA;break;default:t=i.MediaType.UNKNOWN}return t},e.assembleESData=function(e){var t,r={pts:0,dts:0,timestamp:0,data:null,streamIndex:0};return 192&(t=e[7])&&(r.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,r.pts*=4,r.pts+=(6&e[13])>>>1,r.dts=r.pts,64&t&&(r.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,r.dts*=4,r.dts+=(6&e[18])>>>1)),r.data=e.subarray(9+e[8]),r},e.StreamType2CodecID={15:n.CodecID.AAC,27:n.CodecID.AVC,36:n.CodecID.HEVC},e}();t.default=o},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=i(r(7)),a=i(r(6)),s=r(31),u=i(r(79)),c=i(r(32)),l={"com.apple.streamingkeydelivery":n.EncryptMethodType.FAIRPLAY,"com.microsoft.playready":n.EncryptMethodType.PLAYREADY,"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":n.EncryptMethodType.WIDEVINE,"com.widevine":n.EncryptMethodType.WIDEVINE},p=function(){function e(e,t,r){this.baseURL=null,this.resolveUri=null,this._uri=null,this.mediaSequence=0,this._endSequence=0,this.targetDuration=1,this.enabled=!0,this.ID="TRACK_LEVEL",this.baseURL=t||window.location.href,this.info={},this._uri=this.baseURL,(e.url||e.uri)&&(this._uri=e.url||e.uri),this.type=r.type,this.lowLatencyMode=r.lowLatencyMode,this.preloadOn=0==r.preloadOn?r.preloadOn:this.lowLatencyMode,this.segmentNum=10,this.setData(e),this.countUpdated=0}return e.prototype.setData=function(e,t){var r=this;["targetDuration","live","name","audio","subtitles"].forEach((function(t){e.hasOwnProperty(t)&&(r[t]=e[t])})),e.partTarget&&(this.partTargetDuration=e.partTarget),e.segments&&e.segments.length>0&&(this.segmentNum=Math.floor(30*(e.partList&&e.partList.length>0?e.partList.length:e.segments.length)/e.targetDuration)),e.hasOwnProperty("mediaSequence")&&(this.mediaSequence=parseInt(e.mediaSequence,10),this.partSequence=e.mediaSequence),this.initInfo(e),this.initCodecs(e),this.maps=[],this.initMaps(e),this.initKeys(e),this.programTable=[],this.segments=[],e.segments&&this.buildSegmentList(e.segments,t),this._endSequence=this.mediaSequence+this.segments.length,this.info=Object.assign({},e,this.info),this.info.segments&&delete this.info.segments},e.prototype.initInfo=function(e){var t=this;if(["autoselect","default","forced","groupId","instreamId","languaach((function(r){e.hasOwnProperty(r)&&(t.info[r]=e[r])})),e.bandwidth&&(this.info.bandwidth=parseInt(e.bandwidth,10)),e.resolution){var r=e.resolution.split("x"),i={};r[0]&&(i.width=parseInt(r[0],10)),r[1]&&(i.height=parseInt(r[1],10)),this.info.resolution=i}},e.prototype.initCodecs=function(e){var t=this;if(e.codecs){var r=[].concat((e0],r=r.filter((function(e){return-1===i.indexOf(e)}))}})),this.videoCodec&&-1!==this.videoCodec.indexOf("avc1")&&(this.videoCodec=this.convertAVC1ToAVCOTI(this.videoCodec))}},e.prototype.initMaps=function(e){if(this.maps=this.maps||[],e.map&&e.map.length>0)for(var t=0;t<e.map.length;t++){var r=e.map[t],i="",o=void 0;if(r.byterange){o={};var s=r.byterange.split("@",2);s.length>1?o.offset=parseInt(s[1],10):o.offset=0,o.length=parseInt(s[0],10),o.start=o.offset,o.end=o.start+o.length}r.uri&&(i=r.uri);var u={schema:n.URISchema.HTTP,location:a.default.resolveURL(this.baseURL,i),dataType:n.DataType.ARRAYBUFFER};o&&(u.byteRange=[o.start,o.end]),this.maps.push(u)}},e.prototype.initKeys=function(e){if(this.keys=this.keys||[],e.key&&e.key.length>0)for(var t=0;t<e.key.length;t++){var r=e.key[t],i={type:n.EncryptMethodType.NONE};if(r&&r.method&&r.uri){var o=["AES-128","SAMPLE-AES"].indexOf(r.method);i.type=1===o?n.EncryptMethodType.SAMPLE_AES:n.EncryptMethodType.AES_128,l[r.keyformat]&&(i.type=l[r.keyformat]),i.url=a.default.resolveURL(this.baseURL,r.uri),i.iv=this.hexadecimalInteger(r]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},e.prototype.convertAVC1ToAVCOTI=function(e){var t,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift(),10).toString(16),t+=("000"+parseInt(r.shift(),10).toString(16)).substr(-4)):t=e,t},e.prototype.addProgramInfo=function(e){var t={codec:this.codec,format:n.ContainerFormat.UNKNOWN,info:{}};this.maps[e.mapIndex]&&(t.initURI=this.maps[e.mapIndex]),this.audio&&(t.audio=this.audio),this.subtitles&&(t.subtitles=this.subtitles),this.programTable.push(t)},e.prototype.buildSegment=function(e,t,r){void 0===r&&(r=!0),this.partTargetDuration&&(e.partTargetDuration=this.partTargetDuration);var i=new u.default(e,this.url),n=t?t.end:0,o=t?t.programId:0;i.id=t?t.id+1:this.mediaSequence+this.segments.length,i.start=n,i.duration=i.duration?i.duration:this.targetDuration,i.end=c.default.add(n,i.duration);var a=o;return t&&(t.disCounter!==i.disCounter||i.mapIndex!==t.mapIndex)&&a++,i.programId=a,this.programTable[a]||this.addProgramInfo(i),this.keys[i.keyIndex]?i.encrypted=this.keys[i.keyIndex]:i.encrypted=!1,r?this.initProgramDateTime(i,t):this.initProgramDateTime(i),e.byterange&&(t?i.setByteRange(e.byterange,t):i.setByteRange(e.byterange)),i.rawProgramDateTime&&null===this.programDateTimeIndex&&(this.programDateTimeIndex=i.id),i},e.prototype.initProgramDateTime=function(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):(null==t?void 0:t.programDateTime)&&(e.programDateTime=t.endProgramDateTime),Number.isFinite(e.programDateTime)||(e.programDateTime=null,e.rawProg.programDateTime=r.programDateTime-1e3*n.duration,r=n}},e.prototype.getMine=function(){var e="";switch(this.type){case n.MediaType.MIXED:e=this.audioCodec+","+this.videoCodec;break;case n.MediaType.AUDIO:e=this.audioCodec;break;case n.MediaTypation=e.targetDuration,this._endSequence=e.endSequence},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e,this.segments.forEach((function(t){t.levelId=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return!this.resolveUri&&this._uri&&(this.resolveUri=a.default.resolveURL(this.baseURL,this._uri)),this.resolveUri},set:function(e){this.resolveUri=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"segmentList",{get:function(){var e=this;if(this.lowLatencyMode&&this.partTargetDuration){for(var t=[],r=function(r){var n=i.segments[r];n.partList?n.partList.forEach((function(r){if(e.preloadOn||!e.preloadOn&&!r.preload){var i={id:e.partSequence+t.length,msn:n.id,levelId:n.levelId,programId:n.programId,encrypted:n.encrypted,uri:r.uri,start:r.start,end:r.end,duration:r.duration,preload:r.preload,isPart:!0,independent:r.independent,lastPart:r.lastPart};n.programDateTime&&(i.programDateTime=n.programDateTime),t.push(i)}})):t.push(n)},i=this,n=0;n<this.segments.length;n++)r(n);return t}return this.segments.filter((function(e){return e.uri.location}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"codec",{get:function(){var e="";return(this.audioCodec||this.videoCodec)&&(e=this.getMine()),{name:"",mime:e,id:"",type:this.type}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endSequence",{get:function(){return this._endSequence},enumerable:!1,configurable:!0}),e.prototype.update=function(e,t){var r=e.mediaSequence,i=e.segments,n=e.skippedSegments;if(!i||0===i.length)return this.countUpdated++,!1;if(n&&(e.mediaSequence=parseInt(r,10)+parseInt(n,10)),0===this.segments.length)return this.setData(e,t),!0;this.initMaps(e),this.initKeys(e);var a=this.checkSegmentUpdate(r,i);if(!a)return this.countUpdated++,!1;this.countUpdated=0;var s=this.endSequence-r;if(this._endSequence=r+i.length,i=i.slice(Math.max(s,0)),this.resetSegmentList(i,s),s<0)this.buildSegmentList(i,t);else for(var u=0;u<i.length;u++){var c=this.segments[this.segments.length-1],l=i[u],p=this.buildSegment(l,c);p.levelId=this.id,this.segments.push(p)}if(o.default.trace(this.ID,"after update media playlist",this.segmentList[this.segmentList.length-1].id,this.endSequence),e.targetDuration&&(this.targetDuration=e.targetDuration),e.hasOwnProperty("live")&&(this.live=e.live),this.live&&this.segmentList.length>this.segmentNum)for(var d=this.segments.splice(0,this.segments.length-5),h=0;h<d.length;h++){var f=d[h];this.partSequence+=f.partList.length}return a},e.prototype.resetSegmentList=function(e,t){for(var r=this.segments[this.segments.length-1],i=0;i<e.length;i++){var n=e[i];n.disCounter?n.disCounter=r.disCounter+n.disCounter:n.disCounter=t<0?r.disCounter+1:r.disCounter,n.hasOwnProperty("mapIndex")?n.mapIndex=r.mapIndex+n.mapIndex+1:n.mapIndex=r.mapIndex,n.hasOwnProperty("keyIndex")?n.keyIndex=r.keyIndex+n.keyIndex+1:n.keyIndex=r.keyIndex}return e},e.prototype.buildSegmentList=function(e,t){var r=this.segments[this.segments.length-1];this.programDateTimeIndex=0;for(var i=[],n=0;n<e.length;n++){var o=!!i[i.length-1],a=i[i.length-1]||r||null,s=e[n],u=this.buildSegment(s,a,o);u.levelId=this.id,i.push(u)}if(this.programDateTimeIndex&&this.backfillProgramDateTimes(i,this.programDateTimeIndex),t)for(var l=0;l<i.length;l++){var p=i[l],d=p.programDateTime-t;p.start=d/1e3,p.end=c.default.add(d/1e3,p.duration)}this.segments=this.segments.concat(i)},e.prototype.checkSegmentUpdate=function(e,t){var r=this.segments[this.segments.length-1],i=r.id-e,n=!0,o=!1;if(t[i]){o=r.update(t[i]);var a=r.start;r.start=a,r.duration=r.duration?r.duration:this.targetDuration,r.end=c.default.add(a,r.duration)}return(e=e||0)+t.lenghis.segments=[],this.maps=[],this.keys=[],this.info={}},e}();t.default=p},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(6)),o=i(r(80)),a=r(1),s=i(r(32)),u=function(){function e(e,t){this._uri=null,this.resolveUri=null,this.byteRange=null,this.rawProgramDateTime=null,this.id=0,this.end=0,this.levelId=0,this.baseURL=t||window.location.href,this.info={},this.initData(e),this.initPartList(e)}return Object.defineProperty(e.prototype,"start",{get:function(){return this._start},set:function(e){this._start=e;for(var t=0;t<this.partList.length;t++){var r=this.partList[t-1];this.partList[t].start=r?r.end:this._start,this.partList[t].end=s.default.add(this.partList[t].start,this.partList[t].duration)}},enumerable:!1,configurable:!0}),e.prototype.initData=function(e){var t=this;(e.url||e.uri)&&(this._uri=e.url||e.uri,this.resolveUri=n.default.resolveURL(this.baseURL,this._uri));var r=Object.keys(e),i=["programDateTime","duration","disCounter","mapIndex","keyIndex","partTargetDuration"];r.forEach((function(r){-1!==i.indexOf(r)?"programDateTime"===r?t.rawProgramDateTime=e[r]:t[r]=e[r]:t.info[r]=e[r]}))},e.prototype.initPartList=function(e){if(this.partList=[],e.partList){for(var t=0,r=0;r<e.partList.length;r++){var i=this.partList[this.partList.length-1],n=this.buildPart(e.partList[r],i);n.duration&&(t+=n.duration),n.id=this.partList.length,this.partList.push(n)}e.temp||(this.partList[this.partList.length-1].lastPart=!0),this.duration=t}},e.prototype.buildPart=function(e,t){var r=new o.default(e,this.baseURL);return!r.duration&&this.partTargetDuration&&(r.duration=this.partTargetDuration),e.byterange&&(t?r.setByteRange(e.byterange,t):r.setByteRange(e.byterange)),r},e.prototype.setByteRange=function(e,t){if("string"==typeof e){var r=e.split("@",2),i={};1===r.length?i.offset=t&&t.uri.byteRange?t.uri.byteRange[1]:0:i.offset=parseInt(r[1],10),i.length=parseInt(r[0],10),i.start=i.offset,i.end=i.start+i.length,this.byteRange=i}else this.byteRange=e,this.byteRange.start=this.byteRange.offset,this.byteRange.end=this.byteRange.start+this.byteRange.length},e.prototype.update=function(e){this.initData(e);var t=this.partList.length;return this.initPartList(e),t!=this.partList.length},Object.defineProperty(e.prototype,"uri",{get:function(){var e={schema:a.URISchema.HTTP,location:this.resolveUri,dataType:a.DataType.ARRAYBUFFER};return this.byteRange&&(e.byteRange=[this.byteRange.start,this.byteRange.end]),e},enumerable:!1,configurable:!0}),Objeion)?this.duration:0;return this.programDateTime+1e3*e},enumerable:!1,configurable:!0}),e.prototype.destroyed=function(){this.info=null,this.byteRange=null},e}();t.default=u},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(6)),o=r(22),a=function(){function e(e,t){var r=this;this.baseURL=null,this._uri=null,this.resolveUri=null,this.byteRange=null,this.id=0,this.start=0,this.end=0,this.preload=!1,this.lastPart=!1,this.independent=!1,this.baseURL=t||window.location.href,(e.url||e.uri)&&(this._uri=e.url||e.uri,this.resolveUri=n.default.resolveURL(this.baseURL,this._uri)),["duration","preload","independent"].forEach((function(t){e.hasOwnProperty(t)&&(r[t]=e[t])}))}return e.prototype.setByteRange=function(e,t){if("string"==typeof e){var r=e.split("@",2),i={};1===r.length?i.offset=t&&t.uri.byteRange?t.uri.byteRange[1]:0:i.offset=parseInt(r[1],10),i.length=parseInt(r[0],10),i.start=i.offset,i.end=i.start+i.length,this.byteRange=i}else this.byteRange=e,this.byteRange.start=this.byteRange.offset,this.byteRange.end=this.byteRange.start+this.byteRange.length},Object.defineProperty(e.prototype,"uri",{get:function(){var e={schema:o.URISchema.HTTP,location:this.resolveUri,dataType:o.DataType.ARRAYBUFFER};return this.byteRange&&(e.byteRange=[this.byteRange.start,this.byteRange.end]),e},enumerable:!1,configurable:!0}),e.prototype.destroyed=function(){},e}();t.default=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defil(this)||this;return r._statePrototype=t,r._scope={},r}return n(t,e),t.doFilter=function(e,r,i,n,o){if(void 0===o&&(o=0),0===e.length)return n(r,i);var a=e[o];o<e.length-1?a.pus.doFilter(e,i,n,o++)})):a.push(r,i,(function(e){n(e,i)}))},t.prototype._setScope=fope).forEach((function(r){t._scope[r]=e(t._scope[r],r)}))},t.prototype.push=function(e,t,r){!this._scope[t]&&this._statePrototype&&(this._scope[t]=function e(t){return Array.isArray(t)?t.map((function(t){return e(t)})):t&&"object"==typeof t?Object.keys(t).reduce((function(r,i){return r[i]=e(t[i]),r}),{}):t}(this._statePrototype)),"function"!=typeof this._filter&&this.emit("data",e,t),this._scope[t]?this._filter.call(this._scope[t],e,r):this._filter.call(this,e,r)},t.prototype.flush=function(){},t}(r(1).EventBus);t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.manageCustom=void 0,t.manageCustom=function(e,t,r,i){var n,o;e?t.custom?i?t.custom.push(((n={})[i]=r,n)):t.custom.push(r.data):t.custom=i?[(o={},o[i]=r,o)]:[r.data]:i?t[i]=r:Object.assign(t,r)}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(10)),s=o(r(34)),u=o(r(35)),c=o(r(36)),l=o(r(5)),p=function(e){function t(){var t=e.call(this)||this;return t.lineStream=new s.default,t.parseStream=new u.default,t.resolver=new c.default,t.lineStream.pipsolver.on("data",(function(e){t._manifest=e,t.flush(e)})),t}return n(t,e),t.prototype.write=function(e,t){t===l.default.DATA&&this.lineStream.write(e)},t.prototype.catch=function(e){return this.on("error",e),this},t.prototype.end=function(){this.lineStream.flush()},t.prototype.customTag=function(e){this.resolver.getCustomTag(e)},t.prototype.customUrl=function(e){this.resolver.customUrl(e)},t.prototype.clear=function(){},Object.defineProperty(t.prototype,"manifest",{get:function(){return this._manifest},enumerable:!1,configurable:!0}),t}(a.default);t.default=p},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=a(r(8)),u=r(13),c=r(12),l=a(r(5)),p=r(18),d=r(16),h=a(r(7)),f=a(r(21)),m=function(e){function t(t,r,i){var n=e.call(this)||this;return n.errorFunc=function(e){var t=n.getHeaders();n.code||(n.code=555);var r={code:n.code},i=o(o(o({},e),r),{responseHeaders:t});n.emit(l.default.ERROR,i)},n.id=r.id,n.retryNum=0,n.config=r,n.uri=t,n.isAbort=!1,n.proxyOn=r.proxyOn,n.mediaType=r.mediaType||c.MediaType.MIXED,n.isDestroy=!1,n.running=!1,n.monitor=i,n.ID="Loader",n}return n(t,e),t.prototype.initRequest=function(){this.xhr=new XMLHttpRequest,this.addEvent(),this.retryDelay=this.config.retryDelay?this.config.retryDelay:500,this.getResponseType(this.uri.dataType),this.config.timeout?this.xhr.timeout=this.config.timeout:this.config.timeout=this.xhr.timeout=7e3,this.config.maxRetryNum=this.config.maxRetryNum?this.config.maxRetryNum:3,this.config.maxRetryDelay=this.config.maxRetryDelay?this.config.maxRetryDelay:2e3,this._request()},t.prototype.getResponseType=function(e){switch(e){case u.DataType.ARRAYBUFFER:this.xhr.responseType="arraybuffer";break;case u.DataType.BLOB:this.xhr.responseType="blob";break;case u.DataType.JSON:this.xhr.responseType="json";break;case u.DataType.TEXT:this.xhr.responseType="text"}},t.prototype.getHeaders=function(){var e={};return this.xhr&&this.xhr.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(t){var r=t.split(": "),i=r.shift(),n=r.join(": ");i&&(e[i]=n)})),e},t.prototype.addEvent=function(){var e=this;this.xhr.onload=function(){e.clearTimer();var t=e.xhr,r=t.response,i=t.status;if(e.code=i,i>=200&&i<=299&&202!=i){e.firstLoadingTime=performance.now();var n=e.getHeaders(),o={url:e.xhr.responseURL,headers:n,uri:e.uri,startTime:e.startTime,firstLoadingTime:e.firstLoadingTime,total:e.xhr.getResponseHeader("Content-Length")};e.emit(l.default.META,o);var a=void 0;e.xhr.response?a=e.xhr.response:"text"===e.xhr.responseType?a=e.xhr.responseText:"document"===e.xhr.responseType&&(a=e.xhr.responseXML),e.config.responseFilter?(r=e.config.responseFilter(a,e.uri,e.config,e.config.loaderType))&&"function"==typeof r.then?r.then((function(t){e.emit(l.default.DATA,t),e.emit(l.default.FINISH,e.downloadMode)})):(e.emit(l.default.DATA,r),e.emit(l.default.FINISH,e.downloadMode)):(e.emit(l.default.DATA,a),e.emit(l.default.FINISH,e.downloadMode))}else e.retry(Error(""+i))},this.xhr.onabort=function(t){e.config.abortFunction&&e.config.abortFunction(t)retry(t)},this.xhr.ontimeout=function(){e.abort(),e.retry(Error(""))},this.xhr.onprogress=function(t){e.emit(l.default.PROGRESS,{loaded:t.loaded,total:t.total}),e.config.progressFunction&&e.config.progressFunction(t)}},t.prototype.abort=function(){this.isDestroy||(h.default.trace(this.ID,"abort",this.uri.location),this.proxyOn?this.cancelProxy():this.xhr.abort(),this.running=!1,this.isAbort=!0,this.clearTimer())},t.prototype.cancelProxy=function(){this.proxy&&(this.config.proxy.abort(this.proxy),this.proxy.off(),this.proxy=null)},t.prototype.destroy=function(){this.abort(),this.off(),this.isDestroy=!0,this.uri=null,this.config=null},t.prototype.clearTimer=function(){this.requestTimeout&&(clearTimeout(this.requestTimeout),this.requestTimeout=null),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=null)},t.prototype.reload=function(){this.isDestroy||(this.clearTimer(),h.default.trace(this.ID,"",this.id),this.abort(),this.initRequest())},t.prototype.retry=function(e){var t=this;if(h.default.trace(this.ID,"",this.retryNum,this.id),!this.isDestroy){if(this.clearTimer(),this.retryNum>=this.config.maxRetryNum)return this.errorFunc(e),this.retryNum;if(h.default.trace(this.ID,"",this.id),this.config.retryFilter){var r=this.getHeaders(),i=this.config.retryFilter(this.uri,this.config,this.config.loaderType,{responseHeaders:r});"function"==typeof i.then?i.then((function(e){t.setConfig(e),t.retryRequest()})):(this.setConfig(i),this.retryRequest())}else this.retryRequest();return this.retryNum}},t.prototype.retryRequest=function(){var e=this;this.retryTimeout=window.setTimeout((function(){e.initRequest(),e.retryNum+=1,e.retryDelay=Math.min(2*e.retryDelay,e.config.maxRetryDelay)}),this.retryDelay)},t.prototype.request=function(){var e=this;if(this.running=!0,this.isAbort=!1,this.config.requestFilter){var t=this.config.requestFilter(this.uri,this.config,this.config.loaderType);"function"==typeof t.then?t.then((function(t){e.setConfig(t),e.initRequest()})):(this.setConfig(t),this.initRequest())}else this.initRequest()},t.prototype.setConfig=function(e){this.uri=e.uri,e.config&&(this.config=Object.assign({},this.config,e.config))},t.prototype.changeConfig=function(e){this.config=Object.assign({},this.config,e)},t.prototype._request=function(){this.id&&h.default.trace(this.ID,"",this.uri.location,this.mediaType),this.config&&this.config.proxy&&this.proxyOn?(this.proxy=this.config.proxy.request(this.uri.location,this.mediaType,this.id),this.proxy?this.addProxyEvent():(this.proxyOn=!1,this.xhrRequest(),this.emit(l.default.CONCURRENT))):this.xhrRequest()},t.prototype.addProxyEvent=function(){var e=this;this.downloadMode=d.DownLoadMode.PROXY,this.proxy.on(l.default.DATA,(function(t){var r={startTime:t.startTime,headers:{},url:"",uri:e.uri,total:t.data.byteLength};e.emit(l.default.META,r),e.emit(l.default.DATA,t.data),e.emit(l.default.FINISH)})),this.proxy.on(l.default.ERROR,(function(t){t&&t.severity===f.default.Severity.FATAL&&(e.proxy.off(),e.config.proxy.p2pStatus=!1),h.default.trace(e.ID,"proxy",e.id,t),e.monitor&&e.monitor.recordStep(p.StepType.P2P_ERROR,e.id),e.proxyOn=!1,e.retry("proxy")})),this.proxy.on(l.default.PROGRESS,(function(t){e.config.progressFunction&&e.config.progressFunction(t),e.emit(l.default.PROGRESS,t)}))},Object.defineProperty(t.prototype,"isRunning",{get:function(){return this.running},enumerable:!1,configurable:!0}),t.prototype.xhrRequest=function(){var e=this;this.downloadMode=d.DownLoadMode.XHR,this.monitor&&this.monitor.recordStep(p.StepType.HTTP_REQUEST,this.id);var t=this.config.method?this.config.method:"GET",r=!this.config.sync||this.config.sync;if(this.xhr.open(t,this.uri.location),this.config.headers)for(var i in this.config.headers)if(this.config.headers.hasOwnProperty(i)){var n="Authorization"===i?i:i.toLowerCase();this.xhr.setRequestHeader(n,this.config.headers[i])}!r&&this.xhr.timeout>0&&(this.requestTimeout=window.setTimeout((function(){e.abort()}),this.config.timeout)),this.startTime=performance.now(),this.xhr.send()},t.prototype.pipe=function(e){var t=this;return this.on(l.default.DATA,(function(t){e.write(t,l.default.DATA)})),this.on(l.default.META,(function(t){e.write(t,l.default.META)})),this.on(l.default.FINISH,(function(){t.running=!1,e.end()})),this.on(l.default.ERROR,(function(r){r&&r.code&&(t.running=!1,e.write(r,l.default.ERROR))})),this.on(l.default.PROGRESS,(function(t){e.write(t,l.default.PROGRESS)})),e},t}(s.default);t.default=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeSemantic=t.decodeMonitor=t.decodeNumber=t.encodeNumber=void 0;var i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","_","-","*","(",")"],n=i.reduce((function(e,t,r){return e[t]=r,e}),{}),o=i.length;function a(e,t){return void 0===t&&(t=0),e.length>1?a(e.slice(0,-1),t+1)+n[e[e.length-1]]*Math.pow(o,t):n[e]*Math.pow(o,t)}t.encodeNumber=function e(t){return void 0===t&&(t=0),t>=o?e(Math.floor(t/o))+i[t%o]:i[t]},t.decodeNumber=a;var s=["LOAD_SOURCE","PLAY","PLAYING","WAITING","SEEK","SEEKED","CANPLAY","PAUSE","ENDED","ERROR"],u=["MANIFEST_DOWNLOAD","LEVEL_DOWNLOAD","LEVEL_CHANGE","CHECK_BUFFER","WAITING_CHECK_BUFFER","INIT_CHECK_BUFFER","TRACK_CHECK_BUFFER","IDLE_CHECK_BUFFER","RESET_CURRENT_PUMPING","SEGMENT_CHECK_BUFFER","SEGMENT_LOADING","SEGMENT_DEGRADE","SEGMENT_DOWNLOAD","SEGMENT_ERROR","RESUME_FROM_BREAK_POINT","SEGMENT_APPENDING","SEGMENT_APPENDED","SEGMENT_DRAINED","SEGMENT_PRELOAD","MEDIA_READY","SEGMENT_META","BUFFER_OVERFLOW","P2P_ERROR","P2P_TIMEOUT","STOCK_ABORT","STOCK_DESTROY","STREAM_REQUEST","STREAM_RETRY","HTTP_REQUEST","P2P_REQUEST","FATAL_ERROR","ABORT_ERROR","RANGE_ERROR"];t.decodeMonitor=function(e,t){var r=[],i="action"===t?s:u;return e.split("!").forEach((function(e){var t=e.split(".");(t=t.map((function(e,t){var r=a(e);return 0===t?i[r]:r}))).length<3&&t.splice(1,0,"0"),r.push(t)})),r},t.decodeSemantic=function(e,t){void 0===t&&(t="action");var r=[],i="action"===t?s:u;return e.forEach((function(e){var t=[].concat(e);t[0]=i[e[0]],r.push(t)})),r}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=a(r(8)),u=r(13),c=r(12),l=r(16),p=a(r(5)),d=r(18),h=a(r(7)),f=function(e){function t(t,r,i){var n=e.call(this)||this;return n.retry=function(e){if(h.default.trace(n.ID,"",n.retryNum,n.id,e),n.clearTimer(),!n.isDestroy){if(n.retryNum>=n.config.maxRetryNum)return e&&"string"==typeof e?n.errorFunc({message:e}):e&&n.errorFunc(e),n.retryNum;if(n.config.retryFilter){var t={};e&&e.headers&&e.headers.forEach((function(e,r){t[r]=e}));var r=n.config.retryFilter(n.uri,n.config,n.config.loaderType,{responseHeaders:t,code:n.code});"function"==typeof r.then?r.then((function(e){n.initRequest(e),n.retryRequest()})):(n.initRequest(r),n.retryRequest())}else n.retryRequest();return n.retryNum}},n.errorFunc=function(e){if(!(e&&"AbortError"===e.name&&n.retryNum<n.config.maxRetryNum)){n.code||(n.code=555);var t={code:n.code},r={};e.headers&&e.headers.forEach((function(e,t){r[t]=e}));var i=o(o(o({},e),t),{responseHeaders:r});n.emit(p.default.ERROR,i)}},n.processResponse=function(e){if(e.ok)if(n.firstLoadingTime=performance.now(),n.sendMetaInfo(e),n.config&&n.config.isSupportEtag&&(e.headers.get("Etag")||e.headers.get("Last-modified"))&&(n.config.headers["If-Range"]=e.headers.get("Etag")?e.headers.get("Etag"):e.headers.get("Last-modified")),n.monitor&&n.monitor.recordStep(d.StepType.STREAM_REQUEST,""+n.id+(n.chunkEnabled?1:0)),n.chunkEnabled){var t=e.body.getReader();n.reader=t,n.sendStreamData()}else n.sendNonStreamData(e);else n.code=e.status,n.retry(e)},n.id=r.id,n.retryNum=0,n.length=0,n.config=r||{},n.retryDelay=n.config.retryDelay?n.config.retryDelay:100,n.config.maxRetryNum=n.config.maxRetryNum?n.config.maxRetryNum:3,n.config.timeout=n.config.timeout?n.config.timeout:7e3,n.config.maxRetryDelay=n.config.maxRetryDelay?n.config.maxRetryDelay:500,n.uri=t,n.retryRangeAllowed=!1,n.isRange=!1,n.init=!0,n.proxyOn=r.proxyOn,n.chunkEnabled=null==r.chunkEnabled||r.chunkEnabled,n.isAbort=!1,n.isDestroy=!1,n.running=!1,n.monitor=i,n.ID="Loader",n.mediaType=n.config.mediaType||c.MediaType.MIXED,n}return n(t,e),t.prototype.changeConfig=function(e){this.config=Object.assign({},this.config,e)||{}},t.prototype.calculateRange=function(){return this.myRange?(this.length||(this.length=0),void 0===this.myRange[1]?this.myRange[0]+this.length+"-":this.myRange[0]+this.length+"-"+this.myRange[1]):(this.myRange=[tAbort=function(){var e=this;this.reader&&(this.reader.cancel(),this.reader.closed.then((function(){e.clearStreamTimhis.abortController&&(this.abortSignal.addEventListener("abort",(function(){e.config&&e.config.abortFunction&&e.config.abortFunction()})),this.abortController.abort())},t.prototype.cancelProxy=function(){this.proxy&&this.config.proxy&&(this.config.proxy.abort(this.proxy),this.proxy.off(),this.proxy=null)},t.prototype.abort=function(){this.clearTimer(),this.isDestroy||(h.default.trace(this.ID,"abort",this.id,this.proxyOn,this.chunkEnabled),this.running&&(this.running=!1,this.proxyOn&&this.proxy?this.cancelProxy():this.chunkEnabled?this.streamAbort():this.fetchAbort()),this.isAbort=!0)},t.prototype.destroy=function(){this.abort(),this.off(),this.isDestroy=!0,this.uri=null,this.init=!0},t.prototype.pipe=function(e){var t=this;return this.on(p.default.DAlt.DATA)})),this.on(p.default.META,(function(t){e.write(t,p.default.META)})),this.on(p.default.FINISH,(function(){t.running=!1,e.end()})),this.on(p.default.PROGRESS,(function(t){e.write(t,p.default.PROGRESS)})),this.on(p.default.ERROR,(function(r){r&&r.code&&(t.running=!1,r.url=t.uri.location,e.write(r,p.default.ERROR))})),e},t.prototype.reload=function(){this.clearTimer(),this.isDestroy||(h.default.trace(this.ID,"",this.id),this.abort(),this._request())},t.prototype.retryRequest=function(){var e=this;!this.retryRangeAllowed&&this.chunkEnabled&&this.length>0?(this.monitor&&this.monitor.recordStep(d.StepType.STREAM_RETRY,this.id+"00"),this.retryRangeAllowed=!0,this.retryTimeout=window.setTimeout((function(){e._request()}),this.retryDelay)):(this.monitor&&this.monitor.recordStep(d.StepType.STREAM_RETRY,this.id),this.retryTimeout=window.setTimeout((function(){e._request()}),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,this.config.maxRetryDelay),this.retryNum+=1)},t.prototype.initRequest=function(e){this.uri=e.uri,e.config&&this.config&&Object.assign(this.config,e.config)},t.prototype.request=function(){var e=this;if(this.config.requestFilter){var t=this.config.requestFilter(this.uri,this.config,this.config.loaderType);"function"==typeof t.then?t.then((function(t){e.initRequest(t),e._request()})):(this.initRequest(t),this._request())}else this._request()},t.prototype.getTypeResponse=function(e){switch(this.uri.dataType){case u.DataType.ARRAYBUFFER:return e.arrayBuffer();case u.DataType.BLOB:return e.blob();case u.DataType.JSON:return e.json();case u.DataType.TEXT:return e.text()}},t.prototype.initConfig=function(){this.init=!1,this.uri&&this.uri.byteRange&&(this.isRange=!0,this.myRange=this.uri.byteRange)},t.prototype.sendMetaInfo=function(e){var t;e.headers.get("Content-Range")?t=e.headers.get("Content-Range").split("/")[1]:e.headers.get("Content-Length")&&(t=e.headers.get("Content-Length")),this.total=t=parseInt(t);var r={};e.headers.forEach((function(e,t){r[t]=e}));var i={complete:200==e.status,startTime:this.startT.default.META,i)},t.prototype.sendNonStreamData=function(e){var t=this;this.getTypeResponse(e).then((function(e){t.processResponseFilter(e)}))},t.prototype.sendStreamData=function(){var e=this;this.startStreamTimer(),this.reader.read().then((function(t){var r=t.value,i=t.done;e.startStreamTimer(),i?e.isAbort||(e.clearStreamTimer(),e.emit(p.default.FINISH,e.downloadMode)):(e.length+=r.length,e.emit(p.default.PROGRESS,{loaded:e.length,total:e.total}),e.processResponseFilter(r))}))},t.prototype.startStreamTimer=function(){var e=this;this.clearStreamTimer(),this.streamTime,name:"StreamError"})}),1e4)},t.prototype.clearStreamTimer=function(){this.streamTimer&&(clearTimeout(this.streamTimer),this.streamTimer=null)},t.prototype.processResult=function(){this.chunkEnabled?this.sendStreamData():this.emit(p.default.FINISH,this.downloadMode)},t.prototype.clearTimer=function(){this.requestTimeout&&(clearTimeout(this.requestTimeout),this.requestTimeout=null),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=null)},t.prototype.processResponseFilter=function(e){var t=this;if(this.clearTimer(),this.config&&this.config.responseFilter){var r=this.config.responseFilter(e,this.uri,this.config,this.config.loaderType);r&&"function"==typeof r.then?r.then((function(e){t.emit(p.default.DATA,e),t.processResult()})):(this.emit(p.default.DATA,r),this.processResult())}else this.emit(p.default.DATA,e),this.processResult()},t.prototype.setRange=function(){if(this.myRange||this.length){var e=this.calculateRange();this.config&&this.config.rangeArgs?(this.uriRange&&(this.uri.location=this.uri.location.replace(this.uriRange,"")),this.uriRange="&xrange="+e,this.uri.location+=this.uriRange):this.config&&(this.config.headers||(this.config.headers={}),this.config.headers.Range="bytes="+e)}},t.prototype._request=function(){this.running=!0,this.isAbort=!1,this.init&&this.initConfig(),this.config?(this.id&&h.default.trace(this.ID,"",this.id,this.mediaType,this.uri.location),this.config&&this.config.proxy&&this.proxyOn?(this.proxy=this.config.proxy.request(this.uri.location,this.mediaType,this.id),this.proxy?(h.default.trace(this.ID,"proxy",this.id),this.monitor&&this.monitor.recordStep(d.StepType.P2P_REQUEST,this.id),this.addProxyEvent()):(this.proxyOn=!1,this.fetchRequest(),this.emit(p.default.CONCURRENT))):this.fetchRequest()):this.isDestroy=!0},t.prototype.addProxyEvent=function(){var e=this;this.downloadMode=l.DownLoadMode.PROXY,this.proxy.on(p.default.DATA,(function(t){var r={startTime:t.startTime?t.startTime:e.startTime,headers:{},url:"",uri:e.uri,total:t.data.byteLength,complete:!0,full:!0};e.emit(p.default.META,r),e.emit(p.default.DATA,t.data),e.emit(p.default.FINISH,e.downloadMode)})),this.proxy.on(p.default.ERROR,(function(t){e.monitor&&e.monitor.recordStep(d.StepType.P2P_ERROR,e.id),h.default.trace(e.ID,"proxy",e.id,t),e.proxyOn=!1,e.retry("proxy")})),this.proxy.on(p.default.PROGRESS,(function(t){e.config&&e.config.progressFunction&&e.config.progressFunction(t),e.emit(p.default.PROGRESS,t)}))},Object.defineProperty(t.prototype,"isRunning",{get:function(){return this.running},enumerable:!1,configurable:!0}),t.prototype.fetchRequest=function(){var e=this;(this.myRange||this.chunkEnabled&&(this.isRange||this.retryRangeAllowed))&&this.setRange(),this.monitor&&this.monitor.recordStep(d.StepType.STREAM_REQUEST,this.id),"function"==typeof AbortController&&(this.abortContr.abortController.signal,this.config.signal=this.abortSignal),this.startTime=performance.now(),this.requestTimeout=window.setTimeout((function(){e.code=408,e.abort(),e.retry("")}),this.config.timeout||7e3),fetch(this.uri.location,this.config).then(this.processResponse).catch(this.retry)},t}(s.default);t.default=f},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=function(e){function t(t,r){var i=e.call(this)||this;return i.config=r,i.uri=t,i.isAbort=!1,i.isDestroy=!1,i}return n(t,e),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this.isDestroy},enumerable:!1,configurable:!0}),t.prototype.retry=function(){var e=this;if(!this.isDestroy)return this.timer=window.setTimeout((function(){e.emit(o.RequestEvent.META,{uri:RequestEvent.DATA,e.uri&&e.uri.location||""),e.emit(o.RequestEvent.FINISH)}),0),0},t.prototype.abort=function(){this.isAbort=!0,this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.destroy=function(){this.isDestroy=!0,this.abort(),this.off(),this.timer&&(clearTimeout(this.timer),this.timer=null),this.uri=null,this.config=null},t.prototype.reqg.requestFilter){var t=this.config.requestFilter(this.uri,this.config,this.config.loaderType);"function"==typeof t.then?t.then((function(t){e.uri=t.uri,e.config=t.config,e._request()})):(this.uri=t.uri,this.config=t.config,this._request())}else this._request()},t.prototype._request=function(){var e=this;this.timer=window.setTimeout((function(){e.emit(o.RequestEvent.META,{uri:e.uri,startTime:performance.now(),total:0,url:e.uri&&e.uri.location||""}),e.emit(o.RequestEvent.DATA,e.uri&&e.uri.location||""),e.emit(o.RequestEvent.FINISH)}),0)},t.prototype.pipe=function(e){return this.on(o.RequestEvent.DATA,(function(t){e.write(t,oTA,(function(t){e.write(t,o.RequestEvent.META)})),this.on(o.RequestEvent.FINISH,(function(){e.end()})),this.on(o.RequestEvent.PROGRESS,(function(t){e.write(t,o.RequestEvent.PROGRESS)})),e},t}(o.EventBus);t.default=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentParseState=void 0;var u,c=r(1),l=s(r(16)),p=s(r(6)),d=s(r(89));!function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.PARSING=2]="PARSING",e[e.PARSED=3]="PARSED",e[e.ERROR=4]="ERROR"}(u=t.SegmentParseState||(t.SegmentParseState={}));var h={loader:{config:{chunkEnabled:!0}},lowLatencyMode:!1,timeline:{mergeChunk:!1,autoCleanupChunk:!0,minChunkLength:10240},transmuxerConfig:{aligner:!1}},f=function(e){function t(t,r){var i=e.call(this)||this;i.type=c.MediaType.MIXED,i.config=r,i.programTable=[];var n=[];if(Array.isArray(t)){var o=0;n=t.map((function(e,t){var r={id:t,levelId:0,programId:t,encrypted:!1,state:u.NONE,uri:{schema:c.URISchema.HTTP,location:p.default.resolveURL("",e.url),dataType:c.DataType.ARRAYBUFFER},start:o,end:e.duration?o+e.duration:Number.POSITIVE_INFINITY,duration:e.duration?e.duration:Number.POSITIVE_INFINITY};return o+=e.duration?e.duration:Number.POSITIVE_INFINITY,r}))}else if("string"==typeof t){var a={id:0,levelId:0,programId:0,encrypted:!1,state:u.NONE,uri:{schema:c.URISchema.HTTP,location:p.default.resolveURL("",t),dataType:c.DataType.ARRAYBUFFER},start:0,end:Number.POSITIVE_INFINITY,duration:Number.POSITIVE_INFINITY};n.push(a)}else console.log("error flv url",t);var s=!!r.isLive;return i.emit(c.TrackEvent.SWITCHING),s?(i.current={id:0,live:s,name:"",programTable:[{format:c.ContainerFormat.FLV,info:{}}],url:"",segmentList:n},setTimeout((function(){i.emit(c.TrackEvent.SWITCHED,{trackListId:0,track:i.current}),i.emit(c.TrackEvent.SEGMENT_UPDATE)}),0)):(i.segmentList=n,r.chunkEnabled=!0,i.loader=new l.default("SEGMENT",r),i.load(n[0])),i}return n(t,e),t.prototype.load=function(e,t){var r=this;return e.state=u.LOADING,new Promise((function(t,i){var n=o(o({},e.uri),{byteRange:[0,102400]}),a=r.loader.request(n);a.on(c.RequestEvent.ERROR,(function(t){e.state=u.ERROR})),a.pipe(new d.default).on("finish",(function(t){e.state=u.PARSED,t.meta&&t.meta.keyframes&&t.meta.keyframes.times.length>0&&r.modifySegmentList(e,t.meta.keyframes,t.chunk);var i=r.segmentList.filter((function(e){return e.state===u.NONE}))[0];i?r.load(i):(r.current={id:0,live:!!r.config.isLive,name:"",programTable:r.programTable,url:"",segmentList:r.segmentList},r.emit(c.TrackEvent.SWITCHED,{trackListId:0,track:r.current}),r.emit(c.TrackEvent.SEGMENT_UPDATE))})).catch((function(t){e.state=u.ERROR})),r.request=a}))},t.prototype.modifySegmentList=function(e,t,r){var i=this.segmentList,n=[],s=e.id;if(0!==t.filePositions[0]){var l=r.slice(0,t.filePositions[0]);this.programTable.push({format:c.ContainerFormat.FLV,info:{},initURI:o(o({},e.uri),{byteRange:[0,t.filePositions[0]-1]}),initSegment:new Uint8Array(l)})}for(var p=0;p<t.times.length;p++){var d=e.start+t.times[p]/1e3,h=[0];h[0]=t.filePositions[p],t.filePositions[p+1]&&(h[1]=t.filePositions[p+1]-1);var f=e.end;t.times[p+1]&&(f=e.start+t.times[p+1]/1e3);var m={id:s+p,levelId:e.levelId,programId:e.programId,encrypted:e.encrypted,state:u.PARSED,uri:o(o({},e.uri),{byteRange:h}),start:d,end:f,duration:f-d};n.push(m)}i.splice(s,1),i.splice.apply(i,a([s,0],n)),i=i.map((function(e,t){return e.id=t,e}))},t.prototype.destroy=function(){},t.prototype.getAllTrackLevel=function(){return[this.current]},t.prototype.selectLevel=function(e){this.emit(c.TrackEvent.SEGMENT_UPDATE,2)},t}(c.EventBus),m=function(e){function t(t){var r=e.call(this)||this;return r.config=o(o({},h),t),r}return n(t,e),Object.defineProperty(t.prototype,"isLive",{get:function(){return!!this.config.isLive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultConfig",{get:function(){return h},enumerable:!1,configurable:!0}),t.prototype.getTotalDuration=function(){return this.tracks?this.tracks[0].current.segmentList.reduce((function(e,t){return e+t.duration}),0):0},t.prototype.catch=function(e){throw new Error("Method not implemented.")},t.prototype.destroy=function(){this.tracks=[],this.source=null},t.prototype.getAllTrack=function(){return this.tracks},t.prototype.load=function(e,t){var r=this;return this.source=e,this.config=Object.assign(this.config,t),Promise.resolve(void 0).then((function(){var e=new f(r.source,r.config);e.on(c.TrackEvent.SWITCHED,(function(){r.emit(c.ManifestEvent.READY),r.emit(c.ManifestEvent.TrackLevelSwitched,r.tracks[0].current,r.tracks[0])})),r.tracks=[e]}))},t.prototype.setConfig=function(e){this.config=Object.assign(this.config,e)},t}(c.EventBus);t.default=m},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new rct.defineProperty(t,"__esModule",{value:!0});var a=o(r(10)),s=r(1),u=r(90),c=r(2),l=function(e){function t(){var t=e.call(this)||this;return t.transmuxer=new u.TransmuxerController,t}return n(t,e),t.prototype.reset=function(){this.transmuxer.reset()},t.prototype.write=function(e,t){var r=this,i=this.transmuxer;if(t===s.RequestEvent.DATA){var n=e.slice(0);i.init(s.ContainerFormat.FLV),i.push(e),i.getStreams().threturn e.type===c.MediaType.VIDEO}))[0];t&&t.meta&&(r.flush({meta:t.meta,chunk:n}),i.reset())})).catch((function(e){}))}},t.prototype.catch=function(e){return this.on("error",e),this},t.prototype.end=function(){},t.prototype.clear=function(){},t}(a.default);t.default=l},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerProbe=t.TransmuxerController=void 0;var a=o(r(91)),s=r(113);function u(){var e={},t=new Promise((function(t,r){e.resolve=t,e.reject=r}));return t.defer=e,t}Object.defineProperty(t,"ContainerProbe",{enumerable:!0,get:function(){return s.ContainerProbe}});var c=function(){function e(){var e=this;this.transmuxer=new a.default,this.transmuxer.on(a.TransmuxEvent.DATA,(function(t){var r=e.pendingPromise.shift();r&&!r.aborted&&r.defer.resolve(t)})),this.transmuxer.on(a.TransmuxEvent.ERROR,(function(t){var r=e.pendingPromise.shift();r&&!r.aborted&&r.defer.reject(t)})),this.pendingPromise=[]}return e.prototype.abort=function(){this.transmuxer.abort()},e.prototype.endOfStream=function(){this.transmuxer.endOfStream()},e.prototype.abortAll=function(){this.pendingPromise.forEach((function(e){e.aborted=!0}))},e.prototype.getOutput=function(e){var t=u();try{this.transmuxer.getOutput(e),this.pendingPromise.push(t)}catch(e){t.defer.reject(e)}return t},e.prototype.getStreams=function(){var e=u();try{this.transmuxer.getStreams(),this.pendingPromise.push(e)}catch(t){e.defer.reject(t)}return e},e.prototype.initAligner=function(){this.transmuxer.initAligner()},e.prototype.setAligner=function(e){this.transmuxer.setAligner(e)},e.prototype.reset=function(){this.transmuxer.reset(),this.abortAll()},e.prototype.destroy=function(){this.reset(),this.transmuxer.destroyWorker()},e.prototype.init=function(e,t){this.transmuxer.init(e,t)},e.prototype.push=function(e){this.transmuxer.push(e)},e.prototype.flush=function(){this.transmuxer.flush()},e.prototype.setDecryption=function(e,t){this.transmuxer.setDecryption(e,t)},e}();t.TransmuxerController=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TransmuxEvent=void 0;var a,s=o(r(92)),u=r(1),c=r(37);!function(e){e.MESSAGE="message",e.DATA="data",e.ERROR="error"}(a=t.TransmuxEvent||(t.TransmuxEvent={}));var l=function(e){function t(){var t=e.call(this)||this;try{t.worker=s.default(93),t.onWorkermsg=t.onMessage.bind(t),t.worker.addEventListener(a.MESSAGE,t.onWorkermsg)}catch(e){t.emit(a.ERROR,"worker init failed!")}return t}return n(t,e),t.prototype.onMessage=function(e){var t=e.data;switch(t.type){case c.TransmuxerAction.RESULT_RETURN:case c.TransmuxerAction.GET_STREAMS:this.emit(a.DATA,t.payload);break;case c.TransmuxerAction.ERROR:this.emit(a.ERROR,t.error)}},t.prototype.destroyWorker=function(){var e=this.worker;e&&(e.objectURL&&self.URL.revokeObjectURL(e.objectURL),e.removeEventListener(a.MESSAGE,this.onWorkermsg),e.terminate(),this.worker=null)},t.prototype.endOfStream=function(){this.worker&&this.worker.postMessage({type:c.TransmuxerAction.END_OF_STREAM,data:{}})},t.prototype.push=function(e){this.worker&&this.worker.postMessage({type:c.TransmuxerAction.MUX,data:{segmentData:e}},e instanceof ArrayBuffer?[e]:[])},t.prototype.flush=function(){this.worker&&this.worker.postMessage({type:c.TransmuxerAction.FLUSH,data:{}})},t.prototype.abort=function(){this.worker&&this.worker.postMessage({type:c.TransmuxerAction.ABORT,data:{}})},t.prototype.reset=function(){this.worker.postMessage({type:c.TransmuxerAction.RESET})},t.prototype.init=function(e,t){this.worker.postMessage({type:c.TransmuxerAction.INIT,data:{demuxer:e,remuxers:t}})},t.prototype.initAligner=function(){this.worker.postMessage({type:c.TransmuxerAction.INIT_ALIGNER,data:{}})},t.prototype.getStreams=function(){this.worker.postMessage({type:c.TransmuxerAction.GET_STREAMS})},t.prototype.getOutput=function(e){this.worker.postMessage({type:c.TransmuxerAction.GET_OUTPUT,data:{config:e}})},t.prototype.setAligner=function(e){this.worker.postMessage({type:c.TransmuxerAction.SET_ALIGNER,data:{config:e}})},t.prototype.setDecryption=function(e,t){this.worker.postMessage({type:c.TransmuxerAction.SET_DECRYPTION,data:{method:e,key:t}})},t}(u.EventBus);t.default=l},function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var i=r(r.s=ENTRY_MODULE);return i.default||i}function n(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,i){var o={};o[i]=[];var a=t.toString(),s=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!s)return o;for(var u,c=s[1],l=new RegExp("(\\\\n|\\W)"+n(c)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");u=l.exec(a);)"dll-reference"!==u[3]&&o[i].push(u[3]);for(l=new RegExp("\\("+n(c)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");u=l.exec(a);)e[u[2]]||(o[i].push(u[1]),e[u[2]]=r(u[1]).m),o[u[2]]=o[u[2]]||[],o[u[2]].push(u[4]);for(var p,d=Object.keys(o),h=0;h<d.length;h++)for(var f=0;f<o[d[h]].length;f++)p=o[d[h]][f],isNaN(1*p)||(o[d[h]][f]=1*o[d[h]][f]);return o}function a(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:r.m},s=t.all?{main:Object.keys(n.main)}:function(e,t){for(var r={main:[t]},i={main:[]},n={main:{}};a(r);)for(var s=Object.keys(r),u=0;u<s.length;u++){var c=s[u],l=r[c].pop();if(n[c]=n[c]||{},!n[c][l]&&e[c][l]){n[c][l]=!0,i[c]=i[c]||[],i[c].push(l);for(var p=o(e,e[c][l],c),d=Object.keys(p),h=0;h<d.length;h++)r[d[h]]=r[d[h]]||[],r[d[h]]=r[d[h]].concat(p[d[h]])}}return i}(n,e),u="";Object.keys(s).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;s[e][t];)t++;s[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),u=u+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+s.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var c=new window.Blob([u],{type:"text/javascript"});if(t.bare)return c;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),p=new window.Worker(l);return p.objectURL=l,p}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(37),n=r(94);t.default=function(e){var t=new n.Transmuxer;e.addEventListener("message",(function(r){var n=r.data;switch(n.type){case i.TransmuxerAction.GET_STREAMS:try{var o=t.findAllStreams();e.postMessage({type:i.TransmuxerAction.GET_STREAMS,payload:o})}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.END_OF_STREAM:try{t.endOfStream()}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.MUX:try{t.push(n.data.segmentData)}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.FLUSH:try{t.flush()}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.ABORT:try{t.abort()}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.INIT_ALIGNER:try{t.initAligner()}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.SET_ALIGNER:try{t.setAligner(n.data.config)}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.GET_OUTPUT:try{var a=n.data.config,s=t.getOutput(a),u={type:i.TransmuxerAction.RESULT_RETURN,payload:{streams:s.streams,data:s.data}};e.postMessage(u)}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.INIT:try{t.init(n.data.demuxer,n.data.remuxers)}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.SET_DECRYPTION:try{t.setDecryption(n.data.method,n.data.key)}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.TransmuxerAction.RESET:try{t.reset()}catch(r){e.postMessage({type:i.TransmuxerAction.ERROR,error:{message:r.message,stack:r.stack}})}}}))}},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){voturn t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=ult=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorMessage=t.Transmuxer=t.TransmuxerAction=void 0;var s,u,c=a(r(38)),l=r(0),p=a(r(40)),d=o(r(109)),h=r(1),f=r(112);!function(e){e[e.MUX=0]="MUX",e[e.INIT=1]="INIT",e[e.DESTROY=2]="DESTROY",e[e.RESET=3]="RESET",e[e.RESULT_RETURN=4]="RESULT_RETURN",e[e.ERROR=5]="ERROR",e[e.FLUSH=6]="FLUSH",e[e.GET_OUTPUT=7]="GET_OUTPUT",e[e.INIT_ALIGNER=8]="INIT_ALIGNER",e[e.SET_ALIGNER=9]="SET_ALIGNER",e[e.SET_DECRYPTION=10]="SET_DECRYPTION",e[e.PARSE=11]="PARSE",e[e.GET_STREAMS=12]="GET_STREAMS",e[e.END_OF_STREAM=13]="END_OF_STREAM",e[e.ABORT=14]="ABORT"}(t.TransmuxerAction||(t.TransmuxerAction={})),function(e){e[e.NONE=0]="NONE",e[e.WIDEVINE=1]="WIDEVINE",e[e.FAIRPLAY=2]="FAIRPLAY",e[e.PLAYREADY=3]="PLAYREADY",e[e.CLEARKEY=4]="CLEARKEY",e[e.CHINADRM=5]="CHINADRM",e[e.AES_128=6]="AES_128",eWN=9]="UNKNOWN"}(s||(s={})),function(e){e.DecodedFail="decodedfail"}(u||(u={})),t.ErrorMessage=u;var m=function(){function e(){this.cashed=!1,this.discontinuity=!1,this.sequential=!1}return e.parse=function(e,t){if(e&&e.buffer&&t===l.ContainerFormat.MP4)return f.parseMP4Info(e.buffer)},e.prototype.getSupportRemuxer=function(e){return e.filter((function(e){return c.default.isSupportRemuxer(e)}))[0]},e.prototype.init=function(e,t){if(this.demuxer&&this.demuxer.format==e||(this.demuxupportRemuxer(t);this.remuxer&&this.remuxer.format==r||(this.remuxer=new c.default(r)),this.demuxer.pipe(this.remuxer)}},e.prototype.initAligner=function(){this.aligner=new p.default},e.prototype.setAligner=function(e){var t=e.timestampOffset,r=e.discontinuity,i=e.sequential;this.discontinuity=this.cashed?this.discontinuity:r,this.sequential=this.cashed?this.sequential:i,this.aligner.timestampOffset=t,this.discontinuity&&this.aligner.discontinuity(),this.aligner.sequential=this.sequential},e.prototype.flush=function(){this.cashed=!1,this.demuxer&&this.demuxer.flush()},e.prototype.destroy=function(){this.reset()},e.prototype.findAllStreams=function(){if(!this.demuxer)throw new Error("must pushData at first!");var e=this.demuxer.findAllStream();e.forEach((function(e){e.serialize()}));var t=[];return e.forEach((function(e){var r={meta:e.codec.getMetaData(),type:e.type,id:e.id,index:e.index,timescale:e.timescale,duration:e.duration};t.push(r)})),t},e.prototype.getOutput=function(e){var t=this.remuxer.getStreams(),r=t&&t.filter((function(e){return e.type==h.MediaType.VIDEO}))[0];if(e.forceAlign&&2==t.length&&r.packetsCount>0||t.length>0&&t.every((function(e){return e.packetsCount>0})))return this.cashed=!1,this.remuxer.getOutput(e,this.aligner);throw this.cashed=!0,Error(u.DecodedFail)},e.prototype.setDecryption=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),e&&this.demuxer.setPacketFilter((function(r){return d.decrypt({name:t},r,e)}))},e.prototype.push=function(e){this.demuxer&&this.demuxer.pushData(e)},e.prototype.endOfStream=function(){this.demuxer&&this.demuxer.reset(),this.remuxer&&this.remuxer.reset()},e.prototype.abort=function(){this.cashed=!1,this.demuxer&&this.demuxer.abort()},e.prototype.reset=function(){this.cashed=!1,this.discontinuity=!1,this.sequential=!1,this.demuxer&&this.demuxer.reset(),this.remuxer&&this.remuxer.reset(),this.demuxer=null,this.remuxer=null},e}();t.Transmuxer=m},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),o=r(96),a=r(9),s=r(4),u=i(r(97)),c=r(15),l=r(3);function p(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}var d=function(){function e(){this.packetList=[],this.timescale=1e3,this.streams=[],this.streamId=0,this.packetList=[],this.packetsWaiting=[],this.startIndex=0,this.remainBuffer=new Uint8Array(0),this.state=o.FLVParseState.HEAD,this.metaFinding=!1,this.streamFinding=!1,this.streamMetaData={meta:{data:{hasAudio:!1,hasVideo:!1,duration:0},complete:!1,exist:!1},audio:{data:{},complete:!1,exist:!1},video:{data:{},complete:!1,exist:!1}}}return e.probe=function(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),!!l.isArrayBufferView(e)&&function(e){var t=!0;return 70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||(t=!1),p(e,5)<9&&(t=!1),t}(e)},e.prototype.createStream=function(e,t){var r=this.streams.filter((function(t){return t.type===e}))[0];if(r)return r;var i=this.streamId,n=new a.Stream(e,t,this.timescale,i);return this.streamId++,n.index=this.streams.length,this.streams.push(n),n},e.prototype.write=function(e){this.data=e,this.streams.forEach((function(e){return e.reset()})),this.Flushed=!1},e.prototype.startDemux=function(){var t;if(0!=this.remainBuffer.byteLength?((t=new Uint8Array(this.data.byteLength+this.remainBuffer.byteLength)).set(this.remainBuffer),t.set(this.data,this.remainBuffer.byteLength),this.remainBuffer=new Uint8Array(0),this.data=t):t=this.data,this.state===o.FLVParseState.HEAD&&t.byteLength>13){var r=e.findHead(t);if(r.match){this.state=o.FLVParseState.BODY,this.startIndex=r.offset,this.startIndex+=4;var i=this.streamMetaData.meta.data;r.hasVideo&&(i.hasVideo=r.hasVideo,this.streamMetaData.video.exist=r.hasVideo),r.hasAudio&&(i.hasAudio=r.hasAudio,this.streamMetaData.audio.exist=r.hasAudio)}else this.startIndex=t.byteLength}if(this.state===o.FLVParseState.BODY)for(;this.startIndex<t.byteLength&&!this.metaFinding&&0===this.packetList.length;){var n=new DataView(t.buffer,this.startIndex);if(this.startIndex+11+4>t.byteLength)break;var a=n.getUint8(0),s=16777215&n.getUint32(0,!c.littleEndian);if(this.startIndex+11+s+4>t.byteLength)break;if(8===a||9===a||18===a){var u=n.getUint8(4),l=n.getUint8(5),p=n.getUint8(6)|l<<8|u<<16|n.getUint8(7)<<24;0!=(16777215&n.getUint32(7,!c.littleEndian))&&console.warn("Meet tag which has StreamID != 0!");var d=this.startIndex+11;switch(a){case 8:this.parseAudioData(t,d,s,p);break;case 9:this.parseVideoData(t,d,s,p);break;case 18:this.parseScriptData(t,d,s)}var h=n.getUint32(11+s,!c.littleEndian);h!==11+s&&console.warn("Invalid PrevTagSize "+h),this.startIndex+=11+s+4}else console.warn("Unsupported tag type "+a+", skipped"),this.startIndex+=11+s+4}this.startIndex<=t.byteLength&&(this.remainBuffer=new Uint8Array(t.byteLength-this.startIndex),this.remainBuffer.set(t.subarray(this.startIndex),0),this.data=new Uint8Array(0),this.startIndex=0)},e.prototype.parseScriptData=function(e,t,r){var i=this,n=u.default.parseScriptData(e,t,r);if(n.hasOwnProperty("onMetaData")){var o=n.onMetaData,a=this.streamMetaData.meta.data,s=this.streamMetaData.audio.data,c=this.streamMetaData.video.data;if(["hasAudio","hasVideo"].forEach((function(e){if("boolean"==typeof o[e]){a[e]=o[e];var t="hasAudio"===e?"audio":"video";i.streamMetaData[t].exist=o[e]}})),"number"==typeof o.duration){var l=Math.floor(o.duration*this.timescale);a.duration=l}if("object"==typeof o.keyframes){var p=o.keyframes;a.keyframesIndex=this.parseKeyframesIndex(p),c.keyframes=a.keyframesIndex,o.keyframes=null}switch(this.streamMetaData.meta.exist=!0,this.streamMetaData.meta.complete=!0,o.audiodatarate,"number"==typeof o.audiosamplerate&&(s.sampleRate=o.audiosamplerate),"number"==typeof o.audiosamplesize&&(s.sampleSize=o.audiosamplesize),o.audiochannels&&(s.channelCount=o.audiochannels),o.audiosamplerate){case 44100:s.samplingFrequencyIndex=4;break;case 22050:s.samplingFrequencyIndex=7;break;case 11025:s.samplingFrequencyIndex=10}return["width","height"].forEach((function(e){"number"==typeof o[e]&&(c[e]=o[e])})),"number"==typeof o.framerate&&(c.frameRate=o.framerate,o.framerate>0?c.sampleDuration=this.timescale/o.framerate:c.sampleDuration=this.timescale/23.976),this.checkMetaFinding(),a}},e.prototype.parseKeyframesIndex=function(e){for(var t=[],r=[],i=1;i<e.times.length;i++)if(e.filepositions[i]){var n=Math.floor(1e3*e.times[i]);t.push(n),r.push(e.filepositions[i])}return{times:t,filePositions:r}},e.prototype.parseAudioData=function(e,t,r,i){if(r<=1)console.log("Flv: Invalid audio packet, missing SoundData payload!");else{var o=new DataView(e.buffer,t,r).getUint8(0),a=o>>>4;if(this.setAudioMeta(o),10===a){var u=e.subarray(t+1,t+r);if(u.byteLength<=1)return void console.warn("Flv: Invalid AAC packet, missing AACPacketType or/and Data!");var c=u[0];if(0===c){var l=this.createStream(n.MediaType.AUDIO,s.CodecID.AAC);l.codec.setMetadata(this.streamMetaData.audio.data),l.codec.init(u.subarray(1)),this.streamMetaData.audio.complete=!0,this.checkMetaFinding()}else if(1===c){var p=this.findStream(n.MediaType.AUDIO),d={data:u.subarray(1),streamIndex:p.index,dts:i,pts:i,timestamp:Math.round(1e6*i/p.timescale),bsf:p.getBitstreamFormat(u.subarray(1))};this.getMetaFinding()?(d.isLast=!1,this.packetList.push(d)):this.packetsWaiting.push(d)}else console.log("FLV: Unsupported AAC data type "+u[0])}}},e.prototype.setAudioMeta=function(e){var t=0,r=(12&e)>>>2;if(r>=0&&r<=4){t=[5500,11025,22050,44100,48e3][r];var i=(2&e)>>>1,n=1&e,o=this.streamMetaData.audio.data;o.sampleSize=1===i?16:8,o.sampleRate=t,o.channelCount=0===n?1:2}else console.error("Flv: Invalid audio sample rate idx: "+r)},e.prototype.parseVideoData=function(e,t,r,i){if(!(r<=1)){var o=e[t],a=(240&o)>>>4,u=15&o,l=e.subarray(t+1,t+r);if(7===u||12===u){if(l.byteLength<4)return;var p=l[0],d=l.subarray(4);if(0===p){var h=7===u?s.CodecID.AVC:s.CodecID.HEVC,f=this.createStream(n.MediaType.VIDEO,h);f.codec.setMetadata(this.streamMetaData.video.data),f.codec.init(d),this.streamMetaData.video.complete=!0,this.checkMetaFinding()}else if(1===p){var m=(16777215&new DataView(l.buffer,l.byteOffset,l.byteLength).getUint32(0,!c.littleEndian))<<8>>8,y=1===a,g=this.findStream(n.MediaType.VIDEO),v={key:y,streamIndex:g.index,data:d,dts:i,pts:i+m,timestamp:Math.round(1e6*(i+m)/g.timescale),bsf:g.getBitstreamFormat(d)};this.getMetaFinding()?(v.isLast=!1,this.packetList.push(v)):this.packetsWaiting.push(v)}}}},e.findHead=function(e){var t=e,r={match:!1,offset:0,hasAudio:!1,hasVideo:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return r;var i=(4&t[4])>>>2!=0,n=0!=(1&t[4]),o=p(t,5);return o<9?r:{match:!0,offset:o,hasAudio:i,hasVideo:n}},e.prototype.checkMetaFinding=function(){this.streamFinding&&(this.metaFinding=this.getMetaFinding())},e.prototype.getMetaFinding=function(){var e=!0;for(var t in this.streamMetaData)if(this.streamMetaData.hasOwnProperty(t)){var r=this.streamMetaData[t];if(!r.complete&&r.exist){e=!1;break}}return e},e.prototype.findAllStream=function(){return this.streamFinding=!0,this.startDemux(),console.log("findAllStream",!1),this.metaFinding=!1,this.streams},e.prototype.findStream=function(e){return this.streams&&this.streams.filter((function(t){return t.type===e}))[0]},e.prototype.readPacket=function(){return this.streamFinding=!1,0===this.packetList.length&&this.startDemux(),this.packetList.shift()},e.prototype.seek=function(e,t){throw new Error("Method not implemented.")},e.prototype.reset=function(){this.streams=[],this.streamId=0,this.packetList=[],this.packetsWaiting=[],this.startIndex=0,this.remainBuffer=new Uint8Array(0),this.state=o.FLVParseState.HEAD,this.metaFinding=!1,this.streamMetaData={meta:{data:{hasAudio:!1,hasVideo:!1,duration:0},complete:!1,exist:!0},audio:{data:{},complete:!1,exist:!1},video:{data:{},complete:!1,exist:!1}}},e.prototype.clean=function(){this.packetList=[],this.packetsWaiting=[],this.startIndex=0,this.remainBuffer=new Uint8Array(0),this.streamMetaData={meta:{data:{hasAudio:!1,hasVideo:!1,duration:0},complete:!1,ex(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FLVParseState=void 0,function(e){e[e.HEAD=0]="HEAD",e[e.BODY=1]="BODY"}(t.FLVParseState||(t.FLVParseState={}))},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(98)),o=r(15),a=function(){function e(){}return e.parseScriptData=function(t,r,i){var n={};try{var o=e.parseValue(t,r,i),a=e.parseValue(t,r+o.size,i-o.size);n[o.data]=a.data}catch(e){console.error("AMF",e.toString())}return n},e.parseObject=function(t,r,i){i<3&&console.log("Data not enough when parse ScriptDataObject");var n=e.parseString(t,r,i),o=e.parseValue(t,r+n.size,i-n.size),a=o.objectEnd;return{data:{name:n.data,value:o.data},size:n.size+o.size,objectEnd:a}},e.parseString=function(e,t,r){r<2&&console.log("Data not enough when parse String");var i,a=new DataView(e.buffer,t,r).getUint16(0,!o.littleEndian);if(a>0){var s=e.subarray(t+2,t+2+a);i=n.default.decode(s)}else i="";return{data:i,size:2+a}},e.parseDate=function(e,t,r){r<10&&console.log("Data size invalid when parse Date");var i=new DataView(e.buffer,t,r),n=i.getFloat64(0,!o.littleEndian),a=i.getInt16(8,!o.littleEndian);return{data:new Date(n+=60*a*1e3),size:10}},e.parseValue=function(t,r,i){i<1&&console.log("Data not enough when parse Value");var n,a=new DataView(t.buffer,r,i),s=1,u=a.getUint8(0),c=!1;try{switch(u){case 0:n=a.getFloat64(1,!o.littleEndian),s+=8;break;case 1:n=!!a.getUint8(1),s+=1;break;case 2:var l=e.parseString(t,r+1,i-1);n=l.data,s+=l.size;break;case 3:n={};var p=0;for(9==(16777215&a.getUint32(i-4,!o.littleEndian))&&(p=3);s<i-4;){var d=e.parseObject(t,r+s,i-s-p);if(d.objectEnd)break;n[d.data.name]=d.data.value,s+=d.size}s<=i-3&&9==(16777215&a.getUint32(s-1,!o.littleEndian))&&(s+=3);break;case 8:for(n={},s+=4,p=0,9==(16777215&a.getUint32(i-4,!o.littleEndian))&&(p=3);s<i-8;){var h=e.parseObject(t,r+s,i-s-p);if(h.objectEnd)break;n[h.data.name]=h.data.value,s+=h.size}s<=i-3&&9==(16777215&a.getUint32(s-1,!o.littleEndian))&&(s+=3);break;case 9:n=void 0,s=1,c=!0;break;case 10:n=[];var f=a.getUint32(1,!o.littleEndian);s+=4;for(var m=0;m<f;m++){var y=e.parseValue(t,r+s,i-s);n.push(y.data),s+=y.size}break;case 11:var g=e.parseDate(t,r+1,i-1);n=g.data,s+=g.size;break;case 12:var v=e.parseString(t,r+1,i-1);n=v.data,s+=v.size;break;default:s=i,console.warn("AMF","Unsupported AMF value type "+u)}}catch(e){console.error("AMF",e.toString())}return{data:n,size:s,objectEnd:c}},e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.checkContinuation=function(e,t,r){var i=e;if(t+r<i.length){for(;r--;)if(128!=(192&i[++t]))return!1;return!0}return!1},e.decode=function(t){for(var r=[],i=t,n=0,o=t.length;n<o;)if(i[n]<128)r.push(String.fromCharCode(i[n])),++n;else{if(i[n]<192);else if(i[n]<224){if(e.checkContinuation(i,n,1)&&(a=(31&i[n])<<6|63&i[n+1])>=128){r.push(String.fromCharCode(65535&a)),n+=2;continue}}else if(i[n]<240){if(e.checkContinuation(i,n,2)&&(a=(15&i[n])<<12|(63&i[n+1])<<6|63&i[n+2])>=2048&&55296!=(63488&a)){r.push(String.fromCharCode(65535&a)),n+=3;continue}}else if(i[n]<248){var a;if(e.checkContinuation(i,n,3)&&(a=(7&i[n])<<18|(63&i[n+1])<<12|(63&i[n+2])<<6|63&i[n+3])>65536&&a<1114112){a-=65536,r.push(String.fromCharCode(a>>>10|55296)),r.push(String.fromCharCode(1023&a|56320)),n+=4;continue}}r.push(String.fromCharCode(65533)),++n}return r.join("")},e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.install=function(){var e,t,r,i;"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},writable:!0,configurable:!0}),Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){if(e.__proto__)return e.__proto__=t,e;var r=function(){for(var t in e)Object.defineProperty(this,t,{value:e[t]})};return r.prototype=t,new r},Object.values=Object.values||function(e){if(e!==Object(e))throw new TypeError("Object.values called on a non-object");var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(e[t]);return r},Object.keys=Object.keys||(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),i=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(n){if("object"!=typeof n&&"function"!=typeof n||null===n)throw new TypeError("Object.keys called on non-object");var o=[];for(var a in n)e.call(n,a)&&o.push(a);if(t)for(var s=0;s<i;s++)e.call(n,r[s])&&o.push(r[s]);return o})},e}();t.default=i},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var n=r(101),o=r(2),a=r(9),s=r(4),u=r(102),c=r(0),l=function(){function e(){this.reset()}return e.probe=function(e){return u.probe_mp4(e)},e.parse=function(e){var t=new u.Mp4Parser(new u.StreamReader(e));return t.parse(),{boxMap:t.getBoxMap(),boxTree:t.getBoxTree()}},e.prototype.flush=function(){this.clean()},e.prototype.clean=function(){this.Flushed=!0,this.data=new Uint8Array(0),this.boxMap={},this.samples=[],this.readedSamples=[],this.write_num=0,this.parse_num=-1},e.prototype.reset=function(){this.Flushed=!0,this.data=new Uint8Array(0),this.boxMap={},this.streams=[],this.samples=[],this.readedSamples=[],this.videoDescription=new Uint8Array(0),this.audioDescription=new Uint8Array(0),this.initDate=new Uint8Array(0),this.videoCodec=n.Mp4VideoCodec.UNKNOWN,this.audioCodec=n.Mp4AudioCodec.UNKNOWN,this.write_num=0,this.parse_num=-1,this.originAudioTimescale=-1,this.trexs=[]},e.prototype.findAllStream=function(){return this.write_num!==this.parse_num&&g(this),this.streams},e.prototype.findStream=function(e){this.streams||this.findAllStream();var t=this.streams.find((function(t){return t.type===e}));if(void 0===t)throw new Error("have no "+e+" stream.");return t},e.prototype.write=function(e){if(!(e instanceof Uint8Array))throw new Error("mp4 demuxer's write function only accepts Uint8Array type param.");if(this.write_num++,u.is_fmp4_init_segment(e))return this.initDate=e,void(this.Flushed=!1);if(this.Flushed)this.data=e,this.Flushed=!1;else{var t=new Uint8Array(this.data.byteLength+e.byteLength);t.set(this.data),t.set(e,this.data.byteLength),this.data=t}},e.prototype.readPacket=function(){if(this.write_num!==this.parse_num&&g(this),this.samples.length<=0)return null;var e=this.samples[0],t=this.data.byteLength,r=e.offset,i=e.size+r;if(i<=t){var n=this.data.slice(r,i);this.readedSamples.push(this.samples.shift());var o=void 0;return"audio"===e.type?o=this.readAudioPacket(e,n):"video"===e.type&&(o=this.readVideoPacket(e,n)),o}return null},e.prototype.createVideoStream=function(e,t,r){var i=this.streams.findIndex((function(t){return t.type===e}));if(!("number"==typeof i&&i>=0&&this.streams[i].id===r.id)){var n=new a.Stream(e,t,r.timescale,r.id);if(n.NeedParse=!0,n.index=r.index,n.duration=r.duration,n.packetsCount=r.packetsCount,-1===i){if(this.streams.push(n),void 0===this.videoDescription)throw new Error("have no video description.");n.codec.init(this.videoDescription)}else{if(this.streams[i]=n,void 0===this.videoDescription)throw new Error("have no video description.");n.codec.init(this.videoDescription)}}},e.prototype.createAudioStream=function(e,t,r){var i=this.streams.findIndex((function(t){return t.type===e}));if(!("number"==typeof i&&i>=0&&this.streams[i].id===r.id)){var n=new a.Stream(e,t,r.timescale,r.id);if(-1===i){if(this.streams.push(n),void 0===this.audioDescription)throw new Error("have no video description.");n.codec.init(this.audioDescription)}else{if(this.streams[i]=n,void 0===this.audioDescription)throw new Error("have no video description.");n.codec.init(this.audioDescription)}n.codec.getMetaData().sampleRate,n.NeedParse=!0,n.index=r.index,this.originAudioTimescale=r.timescale,n.timescale=1*r.timescale,n.duration=1*r.duration,n.packetsCount=r.packetsCount}},e.prototype.readVideoPacket=function(e,t){var r=this.streams[e.streamIndex];if(void 0===r)throw new Error("have no video stream.");if("avc1"===r.codec.fourCC||"hvc1"===r.codec.fourCC)return this.readNaluVideoPacket(e,t);throw new Error("dont support video bit stream format.")},e.prototype.readNaluVideoPacket=function(e,t){if(void 0===this.streams[e.streamIndex])throw new Error("have no video stream.");for(var r=[],i=new u.StreamReader(t.buffer);i.getPosition()<i.getEndPosition();){var o=i.readUint32(),a=i.readUint8Array(o),s=new Uint8Array(4+a.length);s.set([(4278190080&o)>>24,(16711680&o)>>16,(65280&o)>>8,255&o]),s.set(a,4),r.push(s)}var l=u.mergeUint8Array(r);return{key:e.key,data:l,pts:e.pts,dts:e.dts,duration:e.duration,timestamp:Math.round(1e3*e.ptsMs),bsf:this.videoCodec===n.Mp4VideoCodec.avc1?c.BitstreamFormat.AVC:c.BitstreamFormat.HEVC,isLast:e.isLast,streamIndex:e.streamIndex}},e.prototype.readAudioPacket=function(e,t){var r=this.streams[e.streamIndex];if(void 0===r)throw new Error("have no video stream.");if("mp4a"===r.codec.fourCC)return this.readAACAudioPacket(e,t);throw new Error("dont support audio bit stream format.")},e.prototype.readAACAudioPacket=function(e,t){return{data:t,pts:e.pts,dts:e.dts,duration:e.duration,timestamp:Math.round(1e3*e.ptsMs),bsf:c.BitstreamFormat.AAC,isLast:e.isLast,streamIndex:e.streamIndex}},e}();t.default=l;var p=function(e,t,r){var i=t.esds;if(i){var o=u.esdsParser(r.slice(i.boxBegin+8,i.boxEnd).buffer).data;e.audioDescription=o.DSIData,e.audioCodec=o.type}var a=t.avc1,s=t.hvc1,c=t.hev1,l=null;void 0!==a?(e.videoCodec=n.Mp4VideoCodec.avc1,l=t.avcC):void 0!==s||void 0!==c?(e.videoCodec=n.Mp4VideoCodec.hev1,l=t.hvcC):e.videoCodec=n.Mp4VideoCodec.UNKNOWN,l&&(e.videoDescription=r.slice(l.boxBegin+8,l.boxEnd));var p=t.trex;if(p){var d=Array.isArray(p)?p:[p];e.trexs=d}},d=function(e){var t=e.boxMap.traf;if(void 0===t)throw new Error("moov box has no traf box.");for(var r=function(t){var r,n,a,s=t.parent;if(t.children.forEach((function(e){switch(e.boxtype){case"tfhd":r=e;break;case"tfdt":n=e;break;case"trun":a=e}})),void 0===r)throw new Error("some track has no tfhd box.");if(void 0===a)throw new Error("some track has no trun box.");if(void 0===n)throw new Error("some track has no tfdt box.");var u=r,c=u.track_ID,l=u.default_sample_duration,p=void 0===l?0:l,d=u.default_sample_size,h=void 0===d?null:d,f=e.streams.find((function(e){return e.id===c}));if(!f)return{value:void 0};for(var m=f.timescale,y=f.index,g=f.type,v=n.baseMediaDecodeTime,b=void 0===v?0:v,E=e.trexs.find((function(e){return e.track_ID===f.id})),_=a,R=_.sample_count,S=_.data_offset,A=void 0===S?0:S,T=_.sample_duration,w=void 0===T?[]:T,L=_.sample_size,O=void 0===L?[]:L,x=_.sample_composition_time_offset,P=void 0===x?[]:x,D=_.first_sample_flags,k=[],I=A+s.boxBegin,M=b,C=0;C<R;C++){var N=1*(P.length>0?M+P[C]:M),U=1*M,B={size:O[C]||h,offset:I,dts:U,pts:N,ptsMs:1e3*N/m,dtsMs:1e3*U/m,duration:w.length>0?w[C]:p||(E?E.default_sample_duration:0),type:g,streamIndex:y,isLast:!1};I+=B.size,M+=B.duration,k.push(B),f.packetsCount++,f.duration+=B.duration,f.timeline.maxDts=Math.max(B.dts,f.timeline.maxDts),f.timeline.maxPts=Math.max(B.pts,f.timeline.maxPts)}if(f.type===o.MediaType.VIDEO){var F=511&D;k[0].key=!F}e.samples=i(e.samples,k),e.samples.sort((function(e,t){return e.dtsMs-t.dtsMs})),e.samples[e.samples.length-1].isLast=!0},n=0,a=Array.isArray(t)?t:[t];n<a.length;n++){var s=r(a[n]);if("object"==typeof s)return s.value}e.samples.length&&(e.samples[e.samples.length-1].isLast=!0)},h=function(e,t,r,i){var a=f(e,e.boxMap,e.streams,t,r,i,o.MediaType.AUDIO);if(e.audioCodec===n.Mp4AudioCodec.UNKNOWN)throw new Error("dont support audio bit stream format");e.audioCodec===n.Mp4AudioCodec.AAC&&function(e,t){if(e.audioDescription&&e.audioDescription.length<=0)throw new Error("have no esds box.");e.createAudioStream(o.MediaType.AUDIO,s.CodecID.AAC,t)}(e,a)},f=function(e,t,r,n,a,s,u){var c=n.track_ID,l=s.duration,p=s.timescale;if(t.moof||t.mvex||n.parent.parent.children.some((function(e){return"mvex"===e.boxtype})))return{id:c,index:r.length,duration:0,timescale:p,packetsCount:0};var d,h,f,m,y,g,v=a.children.find((function(e){return"stbl"===e.boxtype}));if(void 0===v)throw new Error("have no stbl box.");if(v.children.forEach((function(e){switch(e.boxtype){case"stsz":d=e;break;case"stsd":h=e;break;case"stsc":f=e;break;case"stco":m=e;break;case"stts":y=e;break;case"ctts":g=e}})),void 0===h)throw new Error("have no stsd box.");if(void 0===m)throw new Error("have no stco box.");if(void 0===d)throw new Error("have no stsz box.");if(void 0===f)throw new Error("have no stsc box.");if(void 0===y)throw new Error("have no stts box.");for(var b=m,E=d,_=f,R=y,S=new Array(Array.isArray(b.chunk_offset)?b.chunk_offset.length:1),A=new Array(E.entry_size.length),T=new Array(A.length),w=Array.isArray(_.first_chunk)?_.first_chunk.map((function(e,t){return{firstChunk:e,sampleDescriptionIndex:_.sample_description_index[t],samplesPerChunk:_.samples_per_chunk[t]}})):[{firstChunk:_.first_chunk,sampleDescriptionIndex:_.sample_description_index,samplesPerChunk:_.samples_per_chunk}],L=new Array(S.length),O=Array.isArray(b.chunk_offset)?b.chunk_offset:[b.chunk_offset],x=Array.isArray(R.sample_count)?R.sample_count.map((function(e,t){return{sampleCount:e,sampleDelta:R.sample_delta[t]}})):[{sampleCount:R.sample_count,sampleDelta:R.sample_delta}],P=0;P<w.length;P++){var D=w[P];if(P!==w.length-1)for(var k=w[P+1],I=D.firstChunk-1;I<k.firstChunk-1;I++)L[I]=D.samplesPerChunk;else for(I=D.firstChunk-1;I<S.length;I++)L[I]=D.samplesPerChunk}var M=0;for(P=0;P<S.length;P++){var C={samples:L[P],offset:O[P]};S[P]=C;for(var N=M+C.samples;M<N;M++)T[M]=P}for(P=0;P<A.length;P++){var U={size:E.sample_size||E.entry_size[P],offset:-1,dts:-1,pts:-1,ptsMs:-1,dtsMs:-1,duration:-1,type:u,streamIndex:r.length,isLast:!1};u===o.MediaType.VIDEO&&(U.key=!t.stss),U.offset=O[T[P]],O[T[P]]+=U.size,A[P]=U}var B=t.stss;if(B)for(var F=0,j=Array.isArray(B.sample_number)?B.sample_number.map((function(e){return e-1})):[B.sample_number-1];F<j.length;F++)A[j[F]].key=!0;M=0;var G=0,V=-1,q=-1;for(P=0;P<x.length;P++)for(var H=x[P],$=M+H.sampleCount;M<$;M++)A[M].dts=G,V=Math.max(V,A[M].dts),A[M].pts=G,q=Math.max(q,A[M].pts),A[M].duration=H.sampleDelta,G+=H.sampleDelta,A[M].ptsMs=1e3*A[M].pts/p,A[M].dtsMs=1e3*A[M].dts/p;if(g){var W=g;M=0;var z=Array.isArray(W.sample_count)?W.sample_count.map((function(e,t){return{sampleCount:e,cttsOffset:W.sample_offset[t]}})):[{sampleCount:W.sample_count,cttsOffset:W.sample_offset}];for(P=0;P<z.length;P++){var K=z[P];for($=M+K.sampleCount;M<$;M++)A[M].pts=A[M].dts+K.cttsOffset,q=Math.max(q,A[M].pts)}}var Y=A.reduce((function(e,t){return e+t.duration}),0);return e.samples.length>0&&(e.samples[e.samples.length-1].isLast=!1),e.samples=i(e.samples,A),e.samples.sort((function(e,t){return e.dtsMs-t.dtsMs})),e.samples[e.samples.length-1].isLast=!0,{id:c,index:e.streams.length,duration:l||Y,timescale:p,packetsCount:E.entry_size.length}},m=function(e,t,r,i){var a=f(e,e.boxMap,e.streams,t,r,i,o.MediaType.VIDEO);switch(e.videoCodec){case n.Mp4VideoCodec.avc1:!function(e,t){if(e.videoDescription&&e.videoDescription.length<=0)throw new Error("have no avcC box.");e.createVideoStream(o.MediaType.VIDEO,s.CodecID.AVC,t)}(e,a);break;case n.Mp4VideoCodec.hev1:case n.Mp4VideoCodec.hvc1:!function(e,t){if(e.videoDescription&&e.videoDescription.length<=0)throw new Error("have no hvcC box.");e.createVideoStream(o.MediaType.VIDEO,s.CodecID.HEVC,t)}(e,a);break;default:throw new Error("Demuxer only supoort avc1 hev1 hvc1 box now.")}},y=function(e,t){for(var r=function(t){var r,i,n,o,a;if(t.children.forEach((function(e){switch(e.boxtype){case"mdia":r=e;break;case"tkhd":i=e}})),void 0===r)throw new Error("some track has no mdia box.");if(void 0===i)throw new Error("some track has no tkhd box.");if(r.children.forEach((function(e){switch(e.boxtype){case"hdlr":n=e;break;case"mdhd":a=e;break;case"minf":o=e}})),void 0===n)throw new Error("some track has no hdlr box.");if(void 0===o)throw new Error("some track has no minf box.");if(void 0===a)throw new Error("some track has no mdhd box.");var s=n.handler_type;switch(s){case"vide":m(e,i,o,a);break;case"soun":h(e,i,o,a);break;default:console.warn("Demuxer dont support "+s+" track now. Please connect author.")}},i=0,n=t;i<n.length;i++)r(n[i])},g=function(e){try{if(e.initDate.byteLength>0){var t=new u.Mp4Parser(new u.StreamReader(e.initDate.buffer));t.parse();var r=t.getBoxMap();if(p(e,r,e.initDate),void 0===(a=r.trak))throw new Error("moov box has no trak box.");var i=Array.isArray(a)?a:[a];y(e,i)}var n=new u.Mp4Parser(new u.StreamReader(e.data.buffer));if(n.parse(),e.boxMap=n.getBoxMap(),e.boxMap.moov){if(void 0===(a=e.boxMap.trak))throw new Error("moov box has no trak box.");i=Array.isArray(a)?a:[a],p(e,e.boxMap,e.data),y(e,i),e.boxMap.moof&&d(e)}else if(e.boxMap.moof)if(e.streams.length>0)d(e);else if(e.initDate.byteLength>0){var o=new u.Mp4Parser(new u.StreamReader(e.initDate.buffer));o.parse();var a,s=o.getBoxMap();if(p(e,s,e.initDate),void 0===(a=s.trak))throw new Error("moov box has no trak box.");i=Array.isArray(a)?a:[a],y(e,i),d(e)}e.parse_num=++e.write_num}catch(t){throw e.reset(),t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mp4VideoCodec=t.Mp4AudioCodec=void 0,function(e){e.AAC="aac",e.UNKNOWN="unknown"}(t.Mp4AudioCodec||(t.Mp4AudioCodec={})),function(e){e.avc1="h264",e.hvc1="h265",e.hev1="h265",e.UNKNOWN="unknown"}(t.Mp4VideoCodec||(t.Mp4VideoCodec={}))},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.probe_mp4=t.is_fmp4_init_segment=t.esdsParser=t.mergeUint8Array=void 0;var a=r(11),s=r(39),u=r(19);t.mergeUint8Array=function(e){if(0===e.length)return new Uint8Array(0);if(1===e.length)return e[0];var t=0,r=0;e.forEach((function(e){r+=e.byteLength}));for(var i=new Uint8Array(r),n=0,o=e;n<o.length;n++){var a=o[n];i.set(a,t),t+=a.byteLength}return i},t.esdsParser=function(e){for(var t=e.byteLength,r=new a.StreamReader(e.slice(0,t)),i={version:r.readUint8(),flags:r.readUint24()},n=r.readUint8(),o=0,s=r.readUint8();128&s;)o=127&s,s=r.readUint8();for(o+=127&s;3!==n&&r.getPosition()!==r.getEndPosition();){for(r.readUint8Array(o),n=r.readUint8(),o=0,s=r.readUint8();128&s;)o=127&s,s=r.readUint8();o+=127&s}return 3===n&&c(r,i),{type:"esds",data:i,restInterval:[t,t]}};var c=function(e,t){if(t.ES_ID=e.readUint16(),t.flags=e.readUint8(),128&t.flags?t.dependsOn_ES_ID=e.readUint16():t.dependsOn_ES_ID=0,64&t.flags){var r=e.readUint8();t.URL=e.readString(r)}else t.URL="";32&t.flags?t.OCR_ES_ID=e.readUint16():t.OCR_ES_ID=0;for(var i=e.readUint8(),n=0,o=e.readUint8();128&o;)n=127&o,o=e.readUint8();for(n+=127&o;4!==i&&e.getPosition()!==e.getEndPosition();){for(e.readUint8Array(n),i=e.readUint8(),n=0,o=e.readUint8();128&o;)n=127&o,o=e.readUint8();n+=127&o}4===i&&l(e,t)},l=function(e,t){t.oti=e.readUint8(),t.type=function(e){switch(e){case 64:case 102:case 103:case 104:return"aac";default:return"unknow"}}(t.oti),t.streamType=e.readUint8(),t.bufferSize=e.readUint24(),t.maxBitrate=e.readUint32(),t.avgBitrate=e.readUint32();for(var r=0,i=e.readUint8(),n=e.readUint8();128&n;)r=127&n,n=e.readUint8();for(r+=127&n;5!==i&&e.getPosition()!==e.getEndPosition();){for(e.readUint8Array(r),i=e.readUint8(),r=0,n=e.readUint8();128&n;)r=127&n,n=e.readUint8();r+=127&n}5===i&&(t.DSIData=e.readUint8Array(r))};t.is_fmp4_init_segment=function(e){for(var t=new a.StreamReader(e.buffer),r=new s.Mp4Reader(t),n=new a.Parser(r),o=[],c={};!t.isEos();){n.setProgram(u.Mp4DSL.box),r.set("boxBegin",t.getPosition());try{1===(f=n.getResult()).size?r.set("boxEnd",r.get("boxBegin")+f.largesize):0===f.size?r.set("boxEnd",t.getEndPosition()):r.set("boxEnd",r.get("boxBegin")+f.size),t.setPosition(r.get("boxEnd"));var l=i(i({},f),{boxBegin:r.get("boxBegin"),boxEnd:r.get("boxEnd"),children:[],parent:null});o.push(l),c[f.boxtype]=l}catch(e){t.setPosition(r.get("boxBegin"));break}}if(c.moov)for(var p=new a.StreamReader(e.slice(c.moov.boxBegin+8,c.moov.boxEnd).buffer),d=new s.Mp4Reader(p),h=new a.Parser(d);!p.isEos();){h.setProgram(u.Mp4DSL.box),d.set("boxBegin",p.getPosition());try{var f;1===(f=h.getResult()).size?d.set("boxEnd",d.get("boxBegin")+f.largesize):0===f.size?d.set("boxEnd",p.getEndPosition()):d.set("boxEnd",d.get("boxBegin")+f.size),p.setPosition(d.get("boxEnd")),l=i(i({},f),{boxBegin:d.get("boxBegin"),boxEnd:d.get("boxEnd"),children:[],parent:null}),o.push(l),c[f.boxtype]=l}catch(e){p.setPosition(d.get("boxBegin"));break}}return!!c.mvex&&!c.moof},t.probe_mp4=function(e){if(!(e instanceof Uint8Array))throw new Error("mp4 demuxer's write function only accepts Uint8Array type param.");for(var t={moov:!0,moof:!0,mdat:!0},r=0,n=new a.StreamReader(e.buffer),o=new s.Mp4Reader(n),c=new a.Parser(o),l=[],p=0;!n.isEos();){c.setProgram(u.Mp4DSL.box),o.set("boxBegin",n.getPosition());try{var d=c.getResult();1===d.size?o.set("boxEnd",o.get("boxBegin")+d.largesize):0===d.size?o.set("boxEnd",n.getEndPosition()):o.set("boxEnd",o.get("boxBegin")+d.size),n.setPosition(o.get("boxEnd"));var h=i(i({},d),{boxBegin:o.get("boxBegin"),boxEnd:o.get("boxEnd"),children:[],parent:null});(0===p&&"ftyp"===h.boxtype||t[h.boxtype])&&(r+=1),l.push(h),p++;continue}catch(e){n.setPosition(o.get("boxBegin"));break}}return r>=2},o(r(105),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mp4DSL=void 0;var i=r(11),n=i.StatementType.IDENTIFIER,o=i.StatementType.IF,a=i.StatementType.ELSE,s=i.StatementType.ENDIF,u=i.StatementType.LOOP,c=i.StatementType.ENDLOOP,l=i.StatementType.READ,p=i.StatementType.BINARY,d=i.Operator.EQUAL,h=i.Operator.BIT_AND;t.Mp4DSL={moov:[],moof:[],trak:[],traf:[],mdia:[],minf:[],stbl:[],mvex:[],box:[[l,"size","uint",32],[l,"boxtype","string",32],[o,[p,d,[n,"size"],1]],[l,"largesize","uint",64],[a,[p,d,[n,"size"],0]],[s],[o,[p,d,"boxtype","uuid"]],[l,"extendType","uint",8,16],[s]],ftyp:[[l,"major_brand","uint",32],[l,"minor_version","uint",32],[l,"compatible_brands","uint",32,"BoxEnd"]],mvhd:[[l,"version","uint",8],[l,"flags","uint",24],[o,[p,d,[n,"version"],1]],[l,"create_time","uint",64],[l,"modification_time","uint",64],[l,"timescale","uint",32],[l,"duration","uint",64],[a],[l,"create_time","uint",32],[l,"modification_time","uint",32],[l,"timescale","uint",32],[l,"duration","uint",32],[s],[l,"rate","uint",32],[l,"volume","uint",16],[l,"reversed","uint",16],[l,"reversed","uint",32,2],[l,"matrix","uint",32,9],[l,"pre_defined","uint",32,6],[l,"next_track","uint",32]],tkhd:[[l,"version","uint",8],[l,"flags","uint",24],[o,[p,d,[n,"version"],1]],[l,"create_time","uint",64],[l,"modification_time","uint",64],[l,"track_ID","uint",32],[l,"reversed","uint",32],[l,"duration","uint",64],[a],[l,"create_time","uint",32],[l,"modification_time","uint",32],[l,"track_ID","uint",32],[l,"reversed","uint",32],[l,"duration","uint",32],[s],[l,"reversed","uint",32,2],[l,"layer","int",16],[l,"alternate_group","int",16],[l,"volume","int",16],[l,"reversed","uint",16],[l,"matrix","uint",32,9],[l,"width","uint",32],[l,"height","uint",32]],trex:[[l,"version","uint",8],[l,"flags","uint",24],[l,"track_ID","uint",32],[l,"default_sample_description_index","uint",32],[l,"default_sample_duration","uint",32],[l,"default_sample_size","uint",32],[l,"default_sample_flags","uint",32]],mdhd:[[l,"version","uint",8],[l,"flags","uint",24],[o,[p,d,[n,"version"],1]],[l,"create_time","uint",64],[l,"modification_time","uint",64],[l,"timescale","uint",32],[l,"duration","uint",64],[a],[l,"create_time","uint",32],[l,"modification_time","uint",32],[l,"timescale","uint",32],[l,"duration","uint",32],[s],[l,"reversed","uint",1],[l,"language","uint",5,3],[l,"reversed","uint",16]],hdlr:[[l,"version","uint",8],[l,"flags","uint",24],[l,"pre_defined","uint",32],[l,"handler_type","string",32],[l,"reversed","uint",32,3],[l,"name","string",8,"BoxEnd"]],stsd:[[l,"version","uint",8],[l,"flags","uint",24],[l,"entry_count","uint",32]],stsz:[[l,"version","uint",8],[l,"flags","uint",24],[l,"sample_size","uint",32],[l,"sample_count","uint",32],[o,[p,d,[n,"sample_size"],0]],[u,1,[n,"sample_count"],1],[l,"entry_size","uint",32],[c],[s]],ctts:[[l,"version","uint",8],[l,"flags","uint",24],[l,"entry_count","uint",32],[o,[p,d,[n,"version"],0]],[u,1,[n,"entry_count"],1],[l,"sample_count","uint",32],[l,"sample_offset","uint",32],[c],[a,[p,d,[n,"version"],1]],[u,1,[n,"entry_count"],1],[l,"sample_count","uint",32],[l,"sample_offset","int",32],[c],[s]],stco:[[l,"version","uint",8],[l,"flags","uint",24],[l,"entry_count","uint",32],[u,1,[n,"entry_count"],1],[l,"chunk_offset","uint",32],[c]],stsc:[[l,"version","uint",8],[l,"flags","uint",24],[l,"entry_count","uint",32],[u,1,[n,"entry_count"],1],[l,"first_chunk","uint",32],[l,"samples_per_chunk","uint",32],[l,"sample_description_index","uint",32],[c]],stts:[[l,"version","uint",8],[l,"flags","uint",24],[l,"entry_count","uint",32],[u,1,[n,"entry_count"],1],[l,"sample_count","uint",32],[l,"sample_delta","uint",32],[c]],stss:[[l,"version","uint",8],[l,"flags","uint",24],[l,"entry_count","uint",32],[u,1,[n,"entry_count"],1],[l,"sample_number","uint",32],[c]],avc1:[[l,"reverse","uint",8,6],[l,"data_reference_ID","uint",16],[l,"code_stream_version","uint",16],[l,"reverse","uint",8,14],[l,"width","uint",16],[l,"height","uint",16],[l,"horizontal_resolution","uint",32],[l,"vertical_resolution","uint",32],[l,"reverse","uint",8,4],[l,"frame_count","uint",16],[l,"compressorname","string",256],[l,"depth","uint",16],[l,"reverse","uint",8,2]],hvc1:[[l,"reverse","uint",8,6],[l,"data_reference_ID","uint",16],[l,"reverse","uint",16],[l,"reverse","uint",16],[l,"reverse","uint",32,3],[l,"width","uint",16],[l,"height","uint",16],[l,"horizontal_resolution","uint",32],[l,"vertical_resolution","uint",32],[l,"reverse","uint",8,4],[l,"frame_count","uint",16],[l,"compressorname","string",256],[l,"depth","uint",16],[l,"reverse","uint",8,2]],hev1:[[l,"reverse","uint",8,6],[l,"data_reference_ID","uint",16],[l,"reverse","uint",16],[l,"reverse","uint",16],[l,"reverse","uint",32,3],[l,"width","uint",16],[l,"height","uint",16],[l,"horizontal_resolution","uint",32],[l,"vertical_resolution","uint",32],[l,"reverse","uint",8,4],[l,"frame_count","uint",16],[l,"compressorname","string",256],[l,"depth","uint",16],[l,"reverse","uint",8,2]],mp4a:[[l,"reverse","uint",8,6],[l,"data_reference_ID","uint",16],[l,"reverse","uint",8,8],[l,"cnannelcount","uint",16],[l,"samplesize","uint",16],[l,"reverse","uint",8,4],[l,"samplerate","uint",32]],tfhd:[[l,"version","uint",8],[l,"flags","uint",24],[l,"track_ID","uint",32],[o,[p,h,[n,"flags"],1]],[l,"base_data_offset","uint",64],[s],[o,[p,h,[n,"flags"],2]],[l,"sample_description_index","uint",32],[s],[o,[p,h,[n,"flags"],8]],[l,"default_sample_duration","uint",32],[s],[o,[p,h,[n,"flags"],16]],[l,"default_sample_size","uint",32],[s],[o,[p,h,[n,"flags"],32]],[l,"default_sample_flags","uint",32],[s]],tfdt:[[l,"version","uint",8],[l,"flags","uint",24],[o,[p,d,[n,"version"],1]],[l,"baseMediaDecodeTime","uint",64],[a],[l,"baseMediaDecodeTime","uint",32],[s]],trun:[[l,"version","uint",8],[l,"flags","uint",24],[l,"sample_count","uint",32],[o,[p,h,[n,"flags"],1]],[l,"data_offset","int",32],[s],[o,[p,h,[n,"flags"],4]],[l,"first_sample_flags","uint",32],[s],[u,1,[n,"sample_count"],1],[o,[p,h,[n,"flags"],256]],[l,"sample_duration","uint",32],[s],[o,[p,h,[n,"flags"],512]],[l,"sample_size","uint",32],[s],[o,[p,h,[n,"flags"],1024]],[l,"sample_flags","uint",32],[s],[o,[p,d,[n,"version"],0]],[o,[p,h,[n,"flags"],2048]],[l,"sample_composition_time_offset","uint",32],[s],[a],[o,[p,h,[n,"flags"],2048]],[l,"sample_composition_time_offset","int",32],[s],[s],[c]]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.H264XpsDSL=void 0;var i=r(11),n=i.StatementType.IDENTIFIER,o=i.StatementType.IF,a=i.StatementType.ELSE,s=i.StatementType.ENDIF,u=i.StatementType.LOOP,c=i.StatementType.ENDLOOP,l=i.StatementType.READ,p=i.StatementType.BINARY,d=i.StatementType.THREE,h=i.StatementType.DECLARATION,f=i.StatementType.UPDATE,m=i.StatementType.ASSIGNMENT,y=i.Operator.PLUS,g=i.Operator.EQUAL,v=i.Operator.OR,b=i.Operator.UNARY_DOUBLE_PLUS,E=i.Operator.LESS_EQUAL,_=i.Operator.UNEQUAL,R=i.Operator.MODEL,S=i.Operator.MORE;t.H264XpsDSL={sps:[[l,"profile_idc","u",8],[l,"profile_compatibility","u",8],[l,"level_idc","u",8],[l,"seq_parameter_set_id","ue"],[o,[p,v,[p,g,[n,"profile_idc"],44],[p,v,[p,g,[n,"profile_idc"],83],[p,v,[p,g,[n,"profile_idc"],86],[p,v,[p,g,[n,"profile_idc"],100],[p,v,[p,g,[n,"profile_idc"],110],[p,v,[p,g,[n,"profile_idc"],118],[p,v,[p,g,[n,"profile_idc"],122],[p,v,[p,g,[n,"profile_idc"],128],[p,v,[p,g,[n,"profile_idc"],134],[p,v,[p,g,[n,"profile_idc"],138],[p,v,[p,g,[n,"profile_idc"],139],[p,g,[n,"profile_idc"],244]]]]]]]]]]]]],[l,"chroma_format_idc","ue"],[o,[p,g,[n,"chroma_format_idc"],3]],[l,"separate_colour_plane_flag","u",1],[s],[l,"bit_depth_luma_minus8","ue"],[l,"bit_depth_chroma_minus8","ue"],[l,"qpprime_y_zero_transform_bypass_flag","u",1],[l,"seq_scaling_matrix_present_flag","u",1],[o,[p,g,[n,"seq_scaling_matrix_present_flag"],1]],[u,[h,"i",1],[p,g,[n,"i"],[d,[p,g,[n,"chroma_format_idc"],3],12,3]],[f,b,[n,"i"],!0]],[l,"seq_scaling_list_present_flag","u",1],[o,[p,g,[n,"seq_scaling_list_present_flag"],1]],[o,[p,E,[n,"i"],6]],[h,"lastScale",8],[h,"nextScale",8],[u,[h,"j",1],[p,g,[n,"j"],16],[f,b,[n,"j"],!0]],[o,[p,_,[n,"nextScale"],0]],[l,"delta_scale","se"],[m,[n,"nextScale"],[p,R,[p,y,[n,"lastScale"],[p,y,[n,"lastScale"],256]],256]],[s],[m,[n,"lastScale"],[d,[p,g,[n,"nextScale"],0],[n,"lastScale"],[n,"nextScale"]]],[c],[a],[h,"lastScale",8],[h,"nextScale",8],[u,[h,"j",1],[p,g,[n,"j"],64],[f,b,[n,"j"],!0]],[o,[p,_,[n,"nextScale"],0]],[l,"delta_scale","se"],[m,[n,"nextScale"],[p,R,[p,y,[n,"lastScale"],[p,y,[n,"lastScale"],256]],256]],[s],[m,[n,"lastScale"],[d,[p,g,[n,"nextScale"],0],[n,"lastScale"],[n,"nextScale"]]],[c],[s],[s],[c],[s],[s],[l,"log2_max_frame_num_minus4","ue"],[l,"pic_order_cnt_type","ue"],[o,[p,g,[n,"pic_order_cnt_type"],0]],[l,"log2_max_pic_order_cnt_lsb_minus4","ue"],[a,[p,g,[n,"pic_order_cnt_type"],1]],[l,"delta_pic_order_always_zero_flag","u",1],[l,"offset_for_non_ref_pic","se"],[l,"offset_for_top_to_bottom_field","se"],[l,"num_ref_frames_in_pic_order_cnt_cycle","ue"],[u,1,[n,"num_ref_frames_in_pic_order_cnt_cycle"],[l,"offset_for_ref_frame","se"],1],[c],[s],[l,"max_num_ref_frames","ue"],[l,"gaps_in_frame_num_value_allowed_flag","u",1],[l,"pic_width_in_mbs_minus1","ue"],[l,"pic_height_in_map_units_minus1","ue"],[l,"frame_mbs_only_flag","u",1],[o,[p,g,[n,"frame_mbs_only_flag"],0]],[l,"mb_adaptive_frame_field_flag","u",1],[s],[l,"direct_8x8_inference_flag","u",1],[l,"frame_cropping_flag","u",1],[o,[p,g,[n,"frame_cropping_flag"],1]],[l,"frame_crop_left_offset","ue"],[l,"frame_crop_right_offset","ue"],[l,"frame_crop_top_offset","ue"],[l,"frame_crop_bottom_offset","ue"],[s],[l,"vui_parameters_present_flag","u",1],[o,[p,g,[n,"vui_parameters_present_flag"],1]],[l,"aspect_ratio_info_present_flag","u",1],[o,[p,g,[n,"aspect_ratio_info_present_flag"],1]],[l,"aspect_ratio_idc","u",8],[o,[p,g,[n,"aspect_ratio_idc"],255]],[l,"sar_width","u",16],[l,"sar_height","u",16],[s],[s],[s]],pps:[[l,"pic_parameter_set_id","ue"],[l,"seq_parameter_set_id","ue"],[l,"entropy_coding_mode_flag","u",1],[l,"bottom_field_pic_order_in_frame_present_flag","u",1],[l,"num_slice_groups_minus1","ue"],[o,[p,S,[n,"num_slice_groups_minus1"],0]],[l,"slice_group_map_type","ue"],[o,[p,g,[n,"slice_group_map_type"],0]],[u,[h,"iGroup",0],[p,E,[n,"iGroup"],[n,"num_slice_groups_minus1"]],[f,b,[n,"iGroup"],!0]],[l,"run_length_minus1","ue"],[c],[a,[p,g,[n,"slice_group_map_type"],2]],[u,[h,"iGroup",1],[p,E,[n,"iGroup"],[n,"num_slice_groups_minus1"]],[f,b,[n,"iGroup"],!0]],[l,"top_left","ue"],[l,"bottom_right","ue"],[c],[a,[p,v,[p,g,[n,"slice_group_map_type"],3],[p,v,[p,g,[n,"slice_group_map_type"],4],[p,g,[n,"slice_group_map_type"],5]]]],[l,"slice_group_change_direction_flag","u",1],[l,"slice_group_change_rate_minus1","ue"],[a,[p,g,[n,"slice_group_map_type"],6]],[h,"read_bits",1],[o,[p,S,[p,y,[n,"num_slice_groups_minus1"],1],4]],[m,[n,"read_bits"],3],[a,[p,S,[p,y,[n,"num_slice_groups_minus1"],1],2]],[m,[n,"read_bits"],2],[s],[l,"pic_size_in_map_units_minus1","ue"],[u,[h,"i",0],[p,E,[n,"i"],[n,"pic_size_in_map_units_minus1"]],[f,b,[n,"i"],!0]],[l,"slice_group_id","u",[n,"read_bits"]],[c],[s],[s],[l,"num_ref_idx_l0_default_active_minus1","ue"],[l,"num_ref_idx_l1_default_active_minus1","ue"],[l,"weighted_pred_flag","u",1],[l,"weighted_bipred_idc","u",2],[l,"pic_init_qp_minus26","se"],[l,"pic_init_qs_mi]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(39),t),n(r(106),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XpsParser=void 0;var i=r(11),n=r(19),o=function(){function e(e){this.golombReader=e}return e.prototype.read=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],i=e[1];switch(r){case"u":return this.golombReader.readBits(i);case"se":return this.golombReader.readEG();case"ue":return this.golombReader.readUEG();default:throw new Error("wrong read type")}},e.prototype.get=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.context[e]},e.prototype.set=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];this.context[e]=t},e.prototype.clearContext=function(){this.context={}},e}(),a=function(){function e(e){this.streamReader=e instanceof Uint8Array?new i.GolombReader(e):e,this.xpsReader=new o(this.streamReader),this.parser=new i.Parser(this.xpsReader)}return e.prototype.parse=function(e){if(void 0===n.H264XpsDSL[e])throw new Error("dont support this type.");return this.parser.setProgram(n.H264XpsDSL[e]),this.parser.getResult()},e}();t.XpsParser=a},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addFrames=t.fixAudioFrames=void 0;var n=i(r(108)),o=r(0);function a(e,t,r,i,a,s,u){var c;c=a>1&&new n.default(s.audioObjectType,s.samplingFrequencyIndex,s.channelCount)||e[t].data;for(var l=0;l<a;l++)e.splice(t+l,0,{bsf:o.BitstreamFormat.AAC,streamIndex:u,dts:r+i*l,pts:r+i*l,timestamp:Math.floor(r+i*l*1e6/9e4),data:c,duration:s.sampleCount})}t.fixAudioFrames=function(e,t,r,i){for(var n=r/i.sampleRate,o=i.sampleCount*n,s=0;s<e.length;s++){var u=e[s],c=u.pts-t,l=1e3*c/r;if(c<=-o)e.length>1?(e.splice(s,1),s--):(e[0].pts=t,e[0].dts=t);else if(c>=o&&l<1e4&&t){var p=Math.round(c/o);a(e,s,t,o,p,i,e[0]&&e[0].streamIndex),t+=p*o,s+=p,u.pts=u.dts=t,t+=o}else u.pts=u.dts=t,t+=o}return t},t.addFrames=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){switch(t>=6&&(e=5),"mp4a.40."+(e||2)){case"mp4a.40.2":if(1===r)return new Uint8Array([0,200,0,128,35,128]);if(2===r)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===r)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=void 0;var n=new(i(r(110)).default);t.decrypt=function(e,t,r){if("AES-ECB"===e.name)return n.decryptAES128ECB(t,r);throw new Error("unsupported crypto algorithm:"+e.name)}},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(111)),o=function(){function e(){}return e.copyArray=function(e,t,r,i,n){null==i&&null==n||(e=e.slice?e.slice(i,n):Array.prototype.slice.call(e,i,n)),t.set(e,r)},e.prototype.encrypt=function(t){var r=n.default.coerceArray(t);if(r.length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var i=n.default.createArray(r.length),o=n.default.createArray(16),a=0;a<r.length;a+=16)e.copyArray(r,o,0,a,a+16),o=this._aes.encrypt(o),e.copyArray(o,i,a);return i},e.prototype.decrypt=function(t){var r=n.default.coerceArray(t);if(r.length%16!=0)throw new Error("invalid cipherText size (must be multiple of 16 bytes)");for(var i=n.default.createArray(r.length),o=n.default.createArray(16),a=0;a<r.length;a+=16)e.copyArray(r,o,0,a,a+16),o=this._aes.decrypt(o),e.copyArray(o,i,a);return i},e.prototype.decryptAES128ECB=function(e,t){this._key!=t&&(this._aes=new n.default(t)),this._aes||(this._aes=new n.default(t));var r=e.length,i=r%16;if(i){var o=this.decrypt(e.subarray(0,r-i)),a=e.subarray(r-i),s=new Uint8Array(o.length+a.length);return s.set(o,0),s.set(a,o.length),s}return this.decrypt(e)},e}();t.default=o},function(e,t,r){"use strict";Object.defi);var i=function(){function e(t){this.key=e.coerceArray(t,!0),this._prepare()}return e.createArray=function(e){return new Uint8Array(e)},e.checkInt=function(e){return parseInt(e)===e},e.checkInts=function(t){if(!e.checkInt(t.length))return!1;for(var r=0;r<t.length;r++)if(!e.checkInt(t[r])||t[r]<0||t[r]>255)return!1;return!0},e.convertToInt32=function(e){for(var t=[],r=0;r<e.length;r+=4)t.push(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]);return t},e.coerceArray=function(t,r){if(void 0===r&&(r=!1),t.buffer&&"Uint8Array"===t.name)return r&&(t=t.slice?t.slice():Array.prototype.slice.call(t)),t;if(Array.isArray(t)){if(!e.checkInts(t))throw new Error("Array contains invalid value: "+t);return new Uint8Array(t)}if(e.checkInt(t.length)&&e.checkInts(t))return new Uint8Array(t);throw new Error("unsupported array-like object")},e.prototype._prepare=function(){var t=e.numberOfRounds[this.key.length];if(null==t)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var r=0;r<=t;r++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);var i,n=4*(t+1),o=this.key.length/4,a=e.convertToInt32(this.key);for(r=0;r<o;r++)i=r>>2,this._Ke[i][r%4]=a[r],this._Kd[t-i][r%4]=a[r];for(var s,u=0,c=o;c<n;){if(s=a[o-1],a[0]^=e.S[s>>16&255]<<24^e.S[s>>8&255]<<16^e.S[255&s]<<8^e.S[s>>24&255]^e.rcon[u]<<24,u+=1,8!=o)for(r=1;r<o;r++)a[r]^=a[r-1];else{for(r=1;r<o/2;r++)a[r]^=a[r-1];for(s=a[o/2-1],a[o/2]^=e.S[255&s]^e.S[s>>8&255]<<8^e.S[s>>16&255]<<16^e.S[s>>24&255]<<24,r=o/2+1;r<o;r++)a[r]^=a[r-1]}var l,p;for(r=0;r<o&&c<n;)l=c>>2,p=c%4,this._Ke[l][p]=a[r],this._Kd[t-l][p]=a[r++],c++}for(var d=1;d<t;d++)for(var h=0;h<4;h++)s=this._Kd[d][h],this._Kd[d][h]=e.U1[s>>24&255]^e.U2[s>>16&255]^e.U3[s>>8&255]^e.U4[255&s]},e.prototype.encrypt=function(t){if(16!=t.length)throw new Error("invalid plaintext size (must be 16 bytes)");for(var r=this._Ke.length-1,i=[0,0,0,0],n=e.convertToInt32(t),o=0;o<4;o++)n[o]^=this._Ke[0][o];for(var a=1;a<r;a++){for(o=0;o<4;o++)i[o]=e.T1[n[o]>>24&255]^e.T2[n[(o+1)%4]>>16&255]^e.T3[n[(o+2)%4]>>8&255]^e.T4[255&n[(o+3)%4]]^this._Ke[a][o];n=i.slice()}var s,u=e.createArray(16);for(o=0;o<4;o++)s=this._Ke[r][o],u[4*o]=255&(e.S[n[o]>>24&255]^s>>24),u[4*o+1]=255&(e.S[n[(o+1)%4]>>16&255]^s>>16),u[4*o+2]=255&(e.S[n[(o+2)%4]>>8&255]^s>>8),u[4*o+3]=255&(e.S[255&n[(o+3)%4]]^s);return u},e.prototype.decrypt=function(t){if(16!=t.length)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var r=this._Kd.length-1,i=[0,0,0,0],n=e.convertToInt32(t),o=0;o<4;o++)n[o]^=this._Kd[0][o];for(var a=1;a<r;a++){for(o=0;o<4;o++)i[o]=e.T5[n[o]>>24&255]^e.T6[n[(o+3)%4]>>16&255]^e.T7[n[(o+2)%4]>>8&255]^e.T8[255&n[(o+1)%4]]^this._Kd[a][o];n=i.slice()}var s,u=e.createArray(16);for(o=0;o<4;o++)s=this._Kd[r][o],u[4*o]=255&(e.Si[n[o]>>24&255]^s>>24),u[4*o+1]=255&(e.Si[n[(o+3)%4]>>16&255]^s>>16),u[4*o+2]=255&(e.Si[n[(o+2)%4]>>8&255]^s>>8),u[4*o+3]=255&(e.Si[255&n[(o+1)%4]]^s);return u},e.numberOfRounds={16:10,24:12,32:14},e.rcon=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],e.S=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],e.Si=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],e.T1=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],e.T2=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],e.T3=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],e.T4=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],e.T5=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],e.T6=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],e.T7=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],e.T8=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],e.U1=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],e.U2=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],e.U3=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],e.U4=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925],e}();t.default=i},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.:78,stpp:[9,11],sbtt:[9,10],dref:8,encv:78,enca:28,schm:4},s=function(){function e(){n(t,r){e.boxHandlers[t]||(e.boxHandlers[t]=[]),e.boxHandlers[t].push(r)},e.dispatch=function(t,r){var i=[];return e.boxHandlers[t]&&e.boxHandlers[t].forEach((function(e){i.push(e(r))})),1===i.length?i[0]:i.length>1?Object.assign.apply(Object,i):void 0},e.boxHandlers={},e}();function u(e,t,r){void 0===r&&(r=0);var i,n,o="string"==typeof t?t.split("").map((function(e){return e.charCodeAt(0)})):t;for(i=r;i<e.length-o.length;i++){for(n=0;n<o.length&&o[n]==e[i+n];n++);if(n===o.length)return i}}s.register("tkhd",(function(e){})),s.register("hvcC",(function(e){var t=new DataView(e);return t.getInt8(1),t.getInt8(2),t.getInt8(3),{videoStream:{codecId:n.CodecID.HEVC,description:new Uint8Array(e)}}})),s.register("avcC",(function(e){var t=new DataView(e);return{videoCodec:{profile:t.getInt8(1),profileCompatibility:t.getInt8(2),levelIdc:t.getInt8(3)},videoStream:{codecId:n.CodecID.AVC,description:new Uint8Array(e)}}})),s.register("mvhd",(function(e){return{timescale:new DataView(e).getUint32(12)}})),s.register("mp4a",(function(e){var t=new DataView(e),r=(t.getInt16(16),t.getInt16(18),t.getUint16(24)),i=new Uint8Array(e),a=u(new Uint8Array(e),"esds");a=u(i,[5,128,128,128],a+8);var s=i.subarray(a+5,a+7),c=new o.default(s);return{audioCodec:{audioObjectType:c.audioObjectType,samplingFrequencyIndex:c.samplingFrequencyIndex,sampleRate:r},audioStream:{codecId:n.CodecID.AAC,description:s}}}));var c=Math.pow(2,32);function l(e){for(var t=new Uint8Array(e),r="",i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r}s.register("tfdt",(function(e){var t=new DataView(e),r=t.getUint8(0),i=0;if(0==r)i=t.getUint32(4);else if(1===r){var n=t.getUint32(4),o=t.getUint32(8);i=n*c+o}return{baseMediaDecodeTime:i}})),t.parseMP4Info=function(e){return function e(t,r,i,n){var o,u;if(void 0===i&&(i=0),void 0===n&&(n=t.byteLength),r>=t.byteLength)return{};var c=t.getInt32(r),p=l(t.buffer.slice(r+4,r+8)),d=s.dispatch(p,t.buffer.slice(r+8,r+c)),h=r+c,f=0;return a[p]&&(f=a[p]),c>f+16&&/[a-zA-Z0-9]{4}/.test(l(t.buffer.slice(r+12+f,r+16+f)))&&(o=e(t,r+8+f,i+1,r+c)),c>0&&h<n&&(u=e(t,h,i,n)),Object.assign({},d,o,u)}(new DataView(e),0)}},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=t.DecoderEvent=t.BitstreamFormat=t.ContainerProbe=t.ContainerFormat=t.TimelineAligner=t.XFormat=void 0;var n=r(0);Object.defineProperty(t,"BitstreamFormat",{enumerable:!0,get:function(){return n.BitstreamFormat}}),Object.defineProperty(t,"ContainerFormat",{enumerable:!0,get:function(){return n.ContainerFormat}});var o=i(r(40));t.TimelineAligner=o.default;var a=i(r(114));t.ContainerProbe=a.default;var s=i(r(38));t.XFormat=s.default;var u=r(17);Object.defineProperty(t,"DecoderEvent",{enumerable:!0,get:function(){return u.DecoderEvent}});var c=r(2);Object.defineProperty(t,"MediaType",{enumerable:!0,get:function(){return c.MediaType}})},function(e,t,r){"use strict";Object.defineProp&(e=new Uint8Array(e)),e.buffer instanceof ArrayBuffer){if(function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1}(e)>=0)return i.ContainerFormat.M2TS;if(function e(t,r){var i,n,s,u,c,l,p=[];if(t.data?(c=t.start,s=t.end,t=t.data):(c=0,s=t.byteLength),!r.length)return null;for(i=c;i<s;)l=(n=o(t,i))>1?i+n:s,a(t.subarray(i+4,i+8))===r[0]&&(1===r.length?p.push({data:t,start:i+8,end:l}):(u=e({data:t,start:i+8,end:l},r.slice(1))).length&&(p=p.concat(u))),i=l;return p}({data:e,start:0,end:Math.min(e.byteLength,16384)},["moof"]).length>0)return i.ContainerFormat.MP4;if(function(e){var t,r=!0;return 70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||(r=!1),((t=e)[5]<<24|t[6]<<16|t[7]<<8|t[8])<9&&(r=!1),r}(e))return i.ContainerFormat.FLV}return i.ContainerFormat.UNKNOWN},e}(){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.MP4="MP4",e.HLS="HLS",e.DASH="DASH",e.FLV="FLV",e.MMP4="MMP4",e.BLOB="BLOB"}(i||(i={})),t.default=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=function(e){function t(t){var r=e.call(this)||this;r.type=o.MediaType.MIXED;var i=0;return r.current={id:0,live:!1,name:"",programTable:[{format:o.ContainerFormat.UNKNOWN,info:{}}],segmentList:t.map((function(e,t){var r={id:t,levelId:0,programId:0,encrypted:!1,uri:{schema:o.URISchema.LITERAL,location:e.url,dataType:o.DataType.TEXT},start:i,end:e.duration?i+e.duration:Number.POSITIVE_INFINITY,duration:e.duration?e.duration:Number.POSITIVE_INFINITY};return i+=e.duration?e.duration:Number.POSITIVE_INFINITY,r})),url:""},r.emit(o.TrackEvent.SWIHED,{trackListId:0,trackurn n(t,e),t.prototype.destrois.current]},t.prototype.selectLevel=function(e){this.emit(o.TrackEvent.SEGMENT_UPDATE,2)},t}(o.EventBus),s=function(e){function t(t){var r=e.call(this)||this;return r.config=t||{},r}return n(t,e),Object.defineProperty(t.prototype,"isLive",{get:function(){return!!this.config.isLive},enumerable:!1,configurable:!0}),t.prototype.getTotalDuration=function(){return this.trce((function(e,t){return e+t.duration}),0):0},t.prototype.catch=function(e){throw new Error("Method not implemented.")},t.prototype.destroy=function(){this.tracks=[],this.source=null},t.prototype.getAllTrack=function(){return this.tracks},t.prototype.load=function(e,t){var r=this;return this.source=e,this.config=Object.assign(this.config,t),Promise.resolve.emit(o.ManifestEvent.READY),r.emit(o.ManifestEvent.TrackLevelSwitched,r.tracks[0].current,r.tracks[0])}))},t.prototype.setConfig=function(e){this.config=Object.assign(this.config,e)},t}(o.EventBus);t.default=s}])},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o}));var i=r(5),n=r(17);function o(e){var t=new n.b;e.addEventListener("message",(function(r){var n=r.data;switch(n.type){case i.a.GET_STREAMS:try{var o=t.findAllStreams();e.postMessage({type:i.a.GET_STREAMS,payload:o})}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.END_OF_STREAM:try{t.endOfStream()}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.MUX:try{t.push(n.data.segmentData)}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.FLUSH:try{t.flush()}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.ABORT:try{t.abort()}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.INIT_ALIGNER:try{t.initAligner()}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.DESTROY_ALIGNER:try{t.destroyAligner()}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.SET_ALIGNER:try{t.setAligner(n.data.config)}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.GET_OUTPUT:try{var a=n.data.config,s=t.getOutput(a),u={type:i.a.RESULT_RETURN,payload:{streams:s.streams,data:s.data}};e.postMessage(u)}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.INIT:try{t.init(n.data.type,n.data.demuxer,n.data.remuxers)}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.SET_DECRYPTION:try{t.setDecryption(n.data.method,n.data.key)}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}break;case i.a.RESET:try{t.reset()}catch(r){e.postMessage({type:i.a.ERROR,error:{message:r.message,stack:r.stack}})}}}))}},function(e,t){"undefined"==typeof window&&(window=ype:"jsonp"}),this.params.type=this.params.type.toLowerCase(),"object"==typeof this.params.dataslice(0)}var l=e.Promise,p=(l||{resolve:function(){}}).resolve();String.prototype.trim||(String.prototype.trim=function(){return thim"=;var i=t.match(/AliApp\(([^\/]+)\/([\d\.\_]+)\)/i);i&&(d.AliAppName=i[1],d.AliAppVersion=i[2]);var n=t.match(/AMapClient\/([\d\.\_]+)/i);n&&(d.AliAppName="AMAP",d.AliAppVersion=n[1])}();var m=/[Android|Adr]/.test(e.navigator.userAgent),62")>=0||m&&"AMAP"===d.AliAppName&&p"===t.dataType?r.getJSONP=!0:"gessRequestUrl,i.middlewares,i.__processRequest]);void 0===a.reteturn!0===i.useAlipayJSBridge&&!n.resolve()})):t.resolve(),t.promistoken&&(e.token=e.token.splsor,t.constructor.__cookieProces="jsonp":(i.getJSON||i.postJSON)&&(c.type="json"))),!0===i.useJsonpResultType&&"orig=function(){a.results=Arrastdata)),c.open(d,f,!0),c.withCredentials=on/json"),c.setRequestHeader("Content-type","application/x-www-form-urlencoded");var m=s.ext_headers||s.headers;if(m)for(var y in m)c.setRequestHeader(y,m[y]);return c.send(h),o.promise},c.prototype.__requestWindVane=function(e){function i(e){a.results=[e],n.resolve()}var n=r(),o=this.params,a=this.options,s=o.data,u=o.api,c=o.v,l=a.postJSON?1:0,p=a.getJSON||a.postJSON||a.getOriginalJSONP?"originaljson":"";void 0!==o.valueType&&("original"===o.valueType?p="originaljson":"string"===o.valueType&&(p="")),!0===a.useJsonpResultType&&(p="");var d,h,f="https"===location.protocol?1:0,m=o.isSec||0,y=o.sessionOption||"AutoLoginOnly",g=o.ecode||0,v=o.ext_headers||{},b=o.ext_querys||{};d=2*(h=void 0!==o.timer?parseInt(o.timer):void 0!==o.timeout?parseInt(o.timeout):2e4),!0===o.needLogin&&void 0===o.sessionOption&&(y="AutoLoginAndManualLogin"),void 0!==o.secType&&void 0===o.isSec&&(m=o.secType);var E={api:u,v:c,post:String(l),type:p,isHttps:String(f),ecode:String(g),isSec:String(m),param:JSON.parse(s),timer:h,needLogin:!!o.needLogin,sessionOption:y,ext_headers:v,ext_querys:b};o.ttid&&!0===a.dangerouslySetWVTtid&&(E.ttid=o.ttid)s.type,Object.assign&&n.dangei.domain:"")+(i.path?";,(a=o.call(t,(function(e){return s.resolve(e),u.promise}),(fune.lastIndexOf("."))?(e.split(".")||[]).length<=3?e:ryTimes=4,r.CDR=!0)),this.__requestProcessor=a,a},t.mtop=function(e){return new c(e)},t.mtop.request=function(e,t,r){var i={H5Request:e.H5Request,WindVaneRequest:e.WindVaneRequest,LoginRequest:e.LoginRequest,AntiCreep:e.AntiCreep,AntiFlood:e.AntiFremoveEventListener=function(){a.removeEventListener.apply(a,arguments)},this.show=function(){document.addEventListener("touchmove",r,!1),a.style.displayin||!c||"taobao.com"==l,r.__processUnitPrefix,r.middlewares,r.__processRequest])})).catch((function(e){throw"CANCEL"===e?new Error("LOGIN_CANCEL::"):new Erroar t=this.options;return ttJson,r=e.ret;r instanceo]=d[h];!0===o.saveAntiCreepToken?(document.cookie=u+"="+JSON.stringify(d)+";",e.location.reload()):r.__sequence([r.__processToken,r.__processRequestUrl,r.__processUnitPrefix,r.middlewares,r.__processRequest]).then(n)}catch(e){a("USER_INPUT_FAILURE::")}}}var p=new i("",t.data.url);p.addEventListener("close",c,!1),e.addEventListener("message",l,!1),p.show()}))}}))}))}(window,window.lib||(window.lib={})),e.exports=window.lib.mtop},function(e,t,r){"use strict";r.r(t),r.d(t,"IndexPlayerEvent",(function(){return Bc}));var i,n=r(4),o=r(8),a=r(12),s=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(econstructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});function u(){var e={},t=new window.Promise((function(t,r){e.resolve=t,e.reject=r}));return t.defer=e,t}var c;!function(e){e[e.INIT=0]="INIT",e[e.PENDING=1]="PENDING",e[e.RUNNING=2]="RUNNING",e[e.DONE=3]="DONE"}(c||(c={}));var l,p=function(){function e(){this.ready=0,this.pendingPromise=[]}return e.prototype.get=function(){if(this.ready)return this.value;var e=u();return this.pendingPromise.push(e),e},e.prototype.reset=function(){this.ready=0},e.prototype.set=function(e){this.value=e,this.pendingPromise.forEach((function(t){t.defer.resolve(e)})),this.pendingPromise=[],this.ready=1},e}();!functio"}(l||(l={}));var d,h,f,m,y=function(e){function t(){var t=e.call(this)||this;return t.dependencies=[],t.state=c.INIT,t.dependents=[],t.errorCount=0,t.states=[],t.deferredList=[],t.main.length&&(t.inputState=new p,t.dependencies.push([t.inputState])),t}return s(t,e),Object.defineProperty(t.prototype,"ServiceName",{get:function(){return this.con,enurototype.import=function(e,t){return this.dependencies.push([e,t]),0},t.prototype.error=function(e){this.state=c.INIT,this.errorCount++,e.from||(e.from=this.constructor),this.emit(l.ERROR,e)},t.prototype.loadState=function(e,t){var r=this,i=e[0],n=e[1];this.states.push([i,n]),Object.defineProperty(this,t,{get:function(){return r.states[n].get()},set:function(e){r.states[n].set(e)}})},t.prototype.reset=function(){this.abort(),this.state=c.INIT,delete this.output,this.deferredList=[]},t.reset=function(e){e.reset(),e.dependents.forEach((function(e){returon(){},t.prototype.start=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r]tate===c.RUNNING&&(this.abort(),e.length>0?this.main.apply(this,e):this.main()),t.reset(this),this.state!==c.PENDING&&this.run()},t.prototype.restart=function(e){var t=this;void 0===e&&(e=0),setTimeout((function(){t.state!==c.PENDING&&t.run()}),e)},t.prototype.run=function(){var e=this;this.state=c.PENDING;var t=this.dependencies.map((function(e){var t=e[0],r=e[1];return t.get(r)}));window.Promise.all(t).then((function(t){var r=[];e.dependencies.forEach((function(i,n){void 0===i[1]?r=t[n]:e[i[1]]=t[n]})),e.state=c.RUNNING,r.length>0?(e.main.apply(e,r),e.runningArgs=r):(e.main(),delete e.runningArgs)})).catch((function(t){console.error(t),t.from=e.constructor,e.emit(l.ERROR,t,e)}))},t.prototype.get=function(){if(this.state===c.DONE)return window.Promise.resolve(this.output);var e=u();return this.deferredList.push(e),this.state===c.INIT&&this.run(),e},t.prototype.take=function(){return this.output},t.prototype.put=function(e){this.state=c.DONE,this.output=e,this.errorCount=0,this.deferredList.forEach((function(t){t.defer.resolve(e)}))},t.Event=l,t.MediaResource="mediaResource",t.StreamSelect="streamSelect",t.StartPoint="startPoint",t.Features="features",t.Ad="Ad",t.Prefer="prefer",t}(a.a),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.state===c.INIT&&(this.inputState&&this.inputState.set(e),this.run())},t.prototype.reset=function(){},t}(y),v=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),b=function(){function e(){this.states={}}return e.prototype.register=function(e,t){return this.states[t]||(this.states[t]=new e(t)),this.states[t]},e}(),E=function(e){function t(){var t=e.call(this)||this;return t.serviceMap={},t.stateManager=new b,t}return v(t,e),t.prototype.autoRegister=function(e){var t=this;e.dependencies.forEach((function(e){var r=e[0];"function"==typeof r&&t.register(r)}))},t.prototype.of=function(e){return"string"==typeof e?this.serviceMap[e]:this.serviceMap[e.Name||e.name]},t.prototype.getService=function(e,t){void 0===t&&(t=!0);var r,i=typeof e;"string"===i?r=e:"function"===i&&(r=e.Name||e.name);var n=r&&this.serviceMap[r];if(!n&&t)throw new Error("Service["+r+"] not found!");return n},t.prototype.start=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=this.getService(e);this.autoRegister(i),i.start.apply(i,t)},t.prototype.serviceGet=function(e){var r=this.getService(e);return r?(this.autoRegister(r),r.get()):this!==t.Global?t.Global.serviceGet(e):(console.warn('Service "'+(e.name||e)+'" not found when call serviceManager.get(...)'),Promise.resolve(null))},t.prototype.take=function(e){var t=this.getService(e,!1);return t&&t.take()},t.prototype.get=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(0===t.length)throw new Error("Expected at least 1 arguments, but got 0.");if(1===t.length)return this.serviceGet(t[0]);var i=t.map((function(t){return e.seise.all(i)},t.prototype.prepareServiceAndName=function(e,t,r){var i=this;void 0===r&&(r=!1);var n="function"==typeof e?new e(t):e,o=n.constructor,a="function"==typeof e&&"string"==typeof t?t:o.Name||o.name;return r&&this.serviceMap[a]?[]:(n.states.forEach((function(e){var t=e[0],r=e[1];n.states[r]=i.stateManager.register(t,r)})),n.on(y.Event.ERROR,(function(e){i.emit("error",e,n)})),[n,a])},t.prototype.replace=function(e,t){var r=this.prepareServiceAndName(e,t),i=r[0],n=r[1];this.serviceMap[n]?(this.reAssociateDependency(this.serviceMap[n],i),this.serviceMap[n]=i):(this.serviceMap[n]=i,this.associateDependency())},t.prototype.register=function(e,t){var r=this.prepareServiceAndName(e,t,!0),i=r[0],n=r[1];return!!i&&(this.serviceMap[n]=i,this.associateDependency(),!0)},t.prototype.reAssociateDependency=function(e,t){var r=this;Object.keys(this.serviceMap).forEach((function(i){var n=r.serviceMap[i];if(n!=e)for(var o=0;o<n.dependencies.length;o++)n.dependencies[o][0]===e&&(n.dependencies[o][0]=t);else{y.reset(n);for(o=0;o<n.dependencies.length;o++){var a=n.dependencies[o];"function"==typeof a[0].main&&(a[0].dependents=a[0].dependents.filter((function(e){return e!==n})))}t.dependents=n.dependents,r.resolveDependencies(t)}}))},t.prototype.resolveDependencies=function(e){for(var r=0;rct"!=typeof i[0]){var n=this.getService(i[0],!1);if(n)i[0]=n,n.dependents.push(e);else if(this!==t.Global){var o=t.Global.getService(i[0],!1);o&&(i[0]=o,o.dependents.push(e))}}else"function"==typeof i[0].main&&this.register(i[0])}},t.prototype.associateDependency=function(){var e=this;Object.keys(this.serviceMap).forEach((function(t){var r=e.serviceMap[t];e.resolveDependencies(r)}))},t.Global=new t,t}(a.a),_=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e[e.LOW=0]="LOW",e[e.MEDIAN=1]="MEDIAN",e[e.HIGH=2]="HIGH"}(d||(d={})),function(e){e[e.LT=0]="LT",e[e.RT=1]="RT",e[e.RB=2]="RB",e[e.LB=3]="LB"}(h||(h={})),function(e){e[e.ALL=0]="ALL",e[e.NORMAL_SCREEN=1]="NORMAL_SCREEN",e[e.FULL_SCREEN=2]="FULL_SCREEN"}(f||(f={})),function(e){e[e.ASS=0]="ASS",e[e.WEBVTT=1]="WEBVTT"}(m||(m={}));!function(e){function t(t,r,i){var n=e.call(this,"["+t+"]"+r)||this;return n.code=t,n.name="MediaResourceError",n.info=i,n}_(t,e)}(Error);var R={id:"N/A",title:"",trial:null,duration:0,poster:"",sceneId:"",timeline:{opening:0,ending:1/0,placement:[]},error:null,streamList:[],wa:{thumb:[],timespan:0,width:0,height:0,nh:0,nv:0,point:[]},placementPreview:[],raw:{}},S=function(){function e(e){var t=this;e.streamLiunction(e){void 0===e.ngName&&(e.langName="default")})),Object.keys(R).forEach((function(r){Object.defineProperty(t,r,{get:function(){return e[r]||R[r]}})}))}return e.prototype.getLanguageList=function(){var e={};return this.streamList&&this.streamList.length>0?(this.streamList.forEach((function(t){e[t.langCode]=t.langName||t.langCode})),Object.keys(e).map((function(t){return{langCode:t,langName:e[t]}}))):[]},e.prototype.findPreview=function(e){},e.prototype.getPreview=function(e){if(this.preview){var t=void 0;this.placementPreview&&this.placementPreview.length>0&&(t=this.placementPreview.filter((function(t){return e>t.range[0]&&e<t.r=t.nv,n=t.width,o=t.height,a=t.timespan,s=t.thumb;a/=1e3;var u=t.range?t.range[0]:0,c=r*i*a,l=(e-u)/c|0,p=Math.floor((e-u)%c/a),d=p%r,h=Math.floor(p/r),f=this.preview.point.filter((function(t){return e>t.at/1e3-5&&e<t.at/1e3+5}))[0];return{url:s[l],width:n,height:o,x:d,y:h,nh:r,nv:i,title:f?f.title:""}}},e.prototype.getAllPreviewThumb=function(){return this.preview.thumb.concat()},e.prototype.getDefaultStream=function(e,t,r){if(0===this.streamList.length)return null;var i;e instanceof Regt())[0].langCode):-1===(i=this.getLanguageList().map((function(e){return e.langCode}))).indexOf(e)&&(e=i[0]);var n=this.getStreamList(e,t);return n?(n.sort((function(e,t){return e.fileSize-t.fileSize})),r===d.HIGH?n[n.length-1]:n[0]):void 0},e.prototype.getStream=function(e,t){return 0===this.streamList.length?null:this.streamList.find((function(r){reamList=function(e,t,r){if(0===this.streamList.length)return[];var i=this.streamList.filter((function(r){return r.langCode===e&&(!t||void 0===r.type||t.test(r.type))}));return 1===r?i.sort((function(eturn t.fileSize-e.fileSize})),i.concat([])},e.prototype.getStreamListBy=function(e,t){return new A(this.getStreamList(e,t))},e.prototype.getSubtitle=function(e){if(this.subtitle)return this.subtitle[e.langCode]},e}(),A=function(){function e(e){this._list=e}return e.prototype.groupBy=function(e,t){var r=this._list.reduce((function(t,r){return t[r[e]]?t[r[e]].push(r):t[r[e]]=[r],t}),{});return this._list=Object.keys(r).map((function(e){if(r[e].length>1){if("function"==typeof t)return r[e].filter((function(e){return t(e)}))[0];if(Array.isArray(t)){var i;if("string"==typeof t[1])i=new RegExp("^"+i+"$");else{if(!(t[1]instanceof RegExp))throw new Error("selectFilter must be string or regexp");i=t[1]}return r[e].filter((function(e){return i.test(e[t[0]])}))[0]}return r[e][0]}return r[e][0]})).filter(Boolean),this},e.prototype.List=function(){return this._list},e}(),T=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return T(t,e),t.prototype.main=function(e){var t;if(Array.isArray(e))t=new S({streamList:e});else if(e.streamList&&e.streamList.length>0)t=new S(e);else{var r={streamList:[{uri:e,duration:{video:0,audio:0},id:"de",langCode:"default",langName:""}]};e.subtitle&&(Array.isArray(e.subtitle)?r.subtitle=e.subtitle:(e.subtitle.lang||(e.subtitle.lang="default"),e.subtitleLang=e.subtitle.lang,r.subtitle=[e.subtitle])),t=new S(r)}this.put(t)},t.Name=y.MediaResource,t}(y),L=r(0);var O=new WeakMap,x=0,P=function(){function e(){}return e.prototype.then=function(e){e()},e.prototype.when=function(e){e()},e.prototype.clear=function(){},e}(),D=function(){function e(e){this.flag=e,this.id=x++,this.handlers=[]}return e.of=function(t,r){var i=O.get(t);i||(i={},O.set(t,i));var n=i[r];if(!n){if("boolean"!=typeof t[r])throw new Error(t.constructor.name+"."+r+"  must be a boolean type!");if(void 0===t[r])return n=new P,i[r]=n,n;n=new e(t[r]),Object.defineProperty(t,r,{get:function(){return n.flag},set:function(e){n.set(e)}})}return i[r]=n,n},e.prototype.when=function(e){this.flag&&Promise.resolve(!0).then(e),this.handlers.push([e,!1])},e.prototype.clear=function(){this.handlers=[]},e.prototype.then=function(e){this.flag&&Promise.resolve(!0).then(e),this.handlers.push([e,!0])},e.prototype.set=function(e){!this.flag&&e&&(this.handlers=this.handlers.filter((function(e){var t=e[0],r=e[1];return t(!0),!r}))),this.flag=e},e}();void 0===window.__XERROR__&&(window.__XERROR__={}),void 0===window.__XERROR_WORDS__&&(window.__XERROR_WORDS__={});var k,I=window.__XERROR__,M=window.__XERROR_WORDS__,C=0;function N(e){var t=Object.keys(M).length+1;return M[e]||(M[e]=t),B(t=M[e])}!function(e){e[e.RECOVERABLE=0]="RECOVERABLE",e[e.CRITICAL=1]="CRITICAL",e[e.FATAL=2]="FATAL"}(k||(k={}));var U=function(){function e(e,t,r,i){var n=this;if(3!==e.length)throw new Error("subjectCode of XError must be a three letter word");if(3!==t.length)throw new Error("subtitleCode of XError must be a three letter word");this.subjectCode=e.toUpperCase(),this.subtitleCode=t.toUpperCase(),this.presetMessages=Object.keys(r).reduce((function(e,t){return r[t]=n.subjectCod"object"==typeof i?i?i[t]:"":(i?i+" ":"")+t.replace(/_/g," ").toLowerCase()+"${status}",e}),{})}return e.registerError=function(t,r,i,n){var o,a,s,u=new e(t,r,i,n);if(I[t]&&I[r])throw new Error("XError ["+t+"-"+r+" has existed!");return o=t,a=r,s=Object.keys(M).length+1,M[o]||(M[o]=s++),M[a]||(M[a]=s),I[t]||(I[t]={}),I[t][t]||(I[t][t]={}),I[t][t]=u,u},e.is=function(e,t){return e.error==t},e.prototype.is=function(e,t){},e.prototype.getMessage=function(e,t,r,i){return t||this.presetMessages[e].replace(/\${([\w\d]+)}/g,(function(e,t){return new Function("status,traceInfo","try{return ':'+"+t+"||''}catch(e){return ''}")(r,i)}))},e.create=function(e,t,r,i,n,o,a){var s=new Error(i);return s.name=e+"Error",s.code=e+t+"00",s.no=1e6+C++,s.status=n,s.traceInfo=o,s.severity=r,s.extension=a,s},e.prototype.of=function(e,t,r,i,n,o){var a=new Error(this.getMessage(e,r,i,n));return a.name=this.subjectCode+"Error",a.code=e,a.no=Number(N(this.subjectCode)+N(this.subtitleCode)+e.slice(-2)),a.status=i,a.traceInfo=n,a.severity=t,a.extension=o,a},e.Severity=k,e}();function B(e){return e<10?"0"+e:""+e}var F={};function j(e){return function(t,r,i){var n=i.value;i.value=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return G("@"===e[0(.5)/e):0,this._estimate=0,this._totalWeight=0}return e.prototype.sample=function(e,t){var r=Math.pow(this._alpha,e);this._estimate=t*(1-r)+r*this._estimate,this._t){if(this._alpha){var e=is._estimate},e}(),$=funt=new H(t)}return e.prototype.sample=function(e,t){var r=(e=Math.max(e,this._minDelayMs))/1e3,i=8*t/r;this._fast.sample(r,i),this._slow.sample(r,i)},e.prototype.canEstimate=function(){var e=this._fast;return e&&e.getTotalWeight()>=this._minWeight},e.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this._fast.getEstimate(),this._slow.getEstimate()):this._defaultEstimate},e.prototype.destroy=function(){},e}(),W=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i},z=function(){function e(){}return e.error=function(t,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e.FORCE_GLOBAL_TAG&&(t=e.GLOBAL_TAG+": "+t);var o="["+t+"] > "+r;e.ENABLE_ERROR&&(console.error?console.error.apply(console,W([o],i)):console.warn?console.warn.apply(console,W([o],i)):console.log.apply(console,W([o],i)))},e.warn=function(t,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e.FORCE_GLOBAL_TAG&&(t=e.GLOBAL_TAG+": "+t);var o="["+t+"] > "+r;e.ENABLE_WARN&&(console.warn?console.warn.apply(console,W([o],i)):console.log.apply(console,W([o],i)))},e.debug=function(t,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e.FORCE_GLOBAL_TAG&&(t=e.GLOBAL_TAG+": "+t);var o="["+t+"] > "+r;e.ENABLE_DEBUG&&(console.debug?console.debug.apply(console,W([o],i)):console.log.apply(console,W([o],i)))},e.trace=function(t,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];if(!e.MODULE||location.href.indexOf("log_module="+t)>-1){e.FORCE_GLOBAL_TAG&&(t=e.GLOBAL_TAG+": "+t);var o="["+t+"] > "+r;if(!e.ENABLE_VERBOSE)return;console.log.apply(console,W([o],i))}},e.GLOBAL_TAG="XCore",e.FORCE_GLOBAL_TAG=!0,e.ENABLE_ERROR=!0,e.ENABLE_WARN=window.location.href.indexOf("player_debug=true")>-1,e.ENABLE_DEBUG=window.location.href.indexOf("player_debug=true")>-1,e.ENABLE_VERBOSE=window.location.href.indexOf("player_debug=true")>-1,e.MODULE=window.location.href.indexOf("log_module=")>-1,e}();var K,Y,X=function(){return(X=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Q={abrEwmaFwmaSloate:5e5,g:4,maxLoadingDelay:4,delayRate:.8,liveDelayRate:.6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrLiveBandWidthUpFactor:1.2,maxLevel:6,minLevel:0,levelDownCount:1.5,levelRiseCount:4,liveLevelDownCount:1.5,liveLevelRiseCount:4},J=function(){function e(){}return e.on=function(t,r){e.event.on(t,(function(e){r(e)}))},e.off=function(){e.event.off()},e.notify=function(t,r){e.event.emit(t,r)},e.event=new L.EventBus,e}(),Z=new $(Q.abrEwmaSlowVoD,Q.abrEwmaFastVoD,Q.abrEwmaDefaultEstimate),ee=function(){function e(e,t){this.abrConfig=X(X({},Q),t),this.video=e,this.currentLevelId=4,this.duration=0,this.ID="ABR",this.waitingCount=0,this.playbackRate=Math.abs(this.video.playbackRate),this.bwEstimator=null,this.isLive=!1}return e.startAutoLevel=function(t){if(t.length>1&&null!=e.startLevel)return e.startLevel=e.startLevel>t.length-1?t.length-1:e.startLevel,e.startLevel;if(1==t.length)return 0;if("function"==typeof window.performance.getEntriesByType){for(var r=window.performance.getEntriesByType("resource").filter((function(e){return 0!=e.transferSize&&null!=e.transferSize&&0!=e.duration&&e.duration<70})),i=Math.min(10,r.length);i>0;){var n=r.pop();Z.sample(n.responseEnd-n.requestStart,n.transferSize),i-=1}var o=Z.getEstimate(),a=t.length-1,s=void 0;return s=r.length>15?e.findBestLevelBasedOnSpeed(o,t.length-1,t,t.length-1,Q.minLevel):a,e.startLevel=s,s}return e.startLevel=t.length-1,t.length-1},e.findBestLevelBasedOnSpeed=fun[u];if(c){var l=void 0;l=u<=t?Q.abrBandWidthFactor*e:(s?Q.abrLiveBandWidthUpFactor:Q.abrBandWidthUpFactor)*e;var p=c.info.bandwidth?c.info.bandwidth:0;if(!o)return t;var d=p*a/l;if(l>p&&(0===d||!Number.isFinite(d)||d<o))return u}}return n},e.prototype.setBestLevel=function(t){var r,i=this.manifest.getAllTrack().find((function(e){return e.type==L.MediaType.MIXED||e.type==L.MediaType.VIDEO}));if(i&&i.current&&this.mediaEngine&&(this.levels=i.getEnabledLevel()||i.getAllTrackLevel(),!(this.levels.length<=1))){var n=i.current;this.currentLevelId=n.id,this.manifest.lowLatencyMode?this.bwEstimator.sample(t.processingMs,5*t.loaded):this.bwEstimator.sample(t.processingMs,t.loaded);var o=this.bwEstimator.getEstimate();if(t.total==t.loaded&&this.levels.length>1){var a,s=(null===(r=this.mediaEngine.buffered.getBufferInfo(this.mediaEngine.currentTime))||void 0===r?void 0:r.bufferLength)||0,u=s/this.mediaEngine.playbackRate,c=this.currentLevelId;c=e.findBestLevelBasedOnSpeed(o,this.currentLevelId,this.levels,this.abrConfig.maxLevel,this.abrConfig.minLevel,u,t.duration,this.isLive);var l=void 0;l=-1!=(a=this.findBestLevelBasedOnBuffer(t))?Math.min(c,a):c;var p=this.isLive?(t.duration||5)*this.abrConfig.liveLevelDownCount:(t.duration||10)*this.abrConfig.levelDownCount,d=this.isLive?(t.duration||5)*this.abrConfig.liveLevelRiseCount:(t.duration||10)*this.abrConfig.levelRiseCount,h=Date.now();this.lastTime||(this.lastTime=h),z.trace(this.ID,"levelBasedOnSpeed, levelBasedOnBuffer",c,a,this.mediaEngine.bufferLength,p,d),(h-this.lastTime>1e3*t.duration&&l<this.currentLevelId&&this.mediaEngine.bufferLength<p||l>this.currentLevelId&&this.mediaEngine.bufferLength>d)&&(this.lastTime=h,z.trace(this.ID,"switch level",l,d,p,s,this.duration,this.waitingCount),this.waitingCount=0,this.selectLevel(l))}}},e.prototype.selectLevel=function(e){this.manifest.getAllTrack().forEach((function(t){t.type!=L.MediaType.MIXED&&t.type!=L.MediaType.VIDEO||t.selectLevel(e)}))},e.prototype.findBestLevelBasedOnBuffer=function(e){var t=e.total,r=e.loaded,i=e.startTime,n=e.duration;if(this.duration=n,this.video&&this.video.currentTime&&!this.video.seeking&&0!=this.playbackRate&&0!=this.currentLevelId){var o=performance.now()-i,a=Math.max(1,1e3*e.loaded/o),s=(t-r)/a,u=this.mediaEngine.getBufferInfo(L.MediaType.VIDEO).bufferLength/this.playbackRate,c=void 0,l=void 0;if(s&&(s>u||!this.isLive&&u<2*this.duration/this.playbackRate)){for(z.warn(this.ID,"loadRate: "+a+"B/s, : "+s+",buffer: "+u),c=this.currentLevelId-1;c>this.abrConfig.minLevel;c--){var p=this.levels[c].info.bandwidth;if((l=this.duration*p/(8*(this.isLive?this.abrConfig.liveDelayRate:this.abrConfig.delayRate)*a))/u<=(this.isLive?this.abrConfig.liveDelayRate:this.abrConfig.delayRate))break}return l<u&&c||this.abrConfig.minLevel}this.bwEstimator.sample(o,r)}return-1},e.prototype.setup=fun=this;this.manifest=e,this.mediaEngine=t,this.loader=r,J.on("speed_update",(function(e){n.setBestLevel(e)})),this.manifest.on(L.ManifestEvent.TrackLevelSwitched,(function(e){if(!n.bwEstimator){n.isLive=e.live;var t=e.isLive?Q.abrEwmaFastLive:Q.abrEwmSlowLive:Q.abrEwmaSlowVoD;n.bwEstimator=new $(r,t,Q.abrEwmaDefaultEstimate)}}))},e.prototype.reset=function(){},e.prototype.update=function(e,t,r,i){},e.prototype.destroy=function(){J.off(),this.abrConfig={},this.bwEstimator=null,delete this.mediaEngine,delete this.manifest,delete this.loader},e.prototype.off=function(e,t,r){return this},e.prototype.on=function(e,t,r){return this},e.prototype.once=function(e,t,r){return this},e.startLevel=void 0,e}(),te=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e[e.INIT=0]="INIT",e[e.FRESH=1]="FRESH",e[e.APPENDED=2]="APPENDED"}(K||(K={})),function(e){e[e.INIT=0]="INIT",e[e.PENDING=1]="PENDING",e[e.LOADING=2]="LOADING",e[e.FINISHED=3]="FINISHED"}(Y||(Y={}));var re=function(e){function t(t,r){var i=e.call(this)||this;return i.segmentId=t,i.total=-1,i.chunkId=0,i.state=Y.PENDING,i.loaded=0,i.finished=!1,i.chunks=[],i.duration=r,i}return te(t,e),Object.defineProperty(t.prototype,"Watermark",{get:function(){return this.chunks.reduce((function(e,t){return e+(t.state===K.FRESH?t.size:0)}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ChunkId",{get:function(){return this.chunkId},set:function(e){this.chunkId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLast",{get:function(){return this.isLastChunk},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Total",{get:function(){return this.total},enuroperty(t.prototype,"Loaded",{get:function(){return this.loaded},t){if(t===L.DataType.ARRAYBUFFER){for(var r=e.reduce((function(e,t){return e+t.byteLength}),0),i=new Uint8Array(r),n=void 0,o=0;n=e.shift();)n.strn i}return t===L.DataType.TEXT?e.join(""):t===L.DataType.JSON?e.reduce((function(e,t){return Object.assign(e,t),e}),{}):t===L.DataType.BLOB?function(e){var t=[];return e.forEach((function(e){Array.isArray(e)?t.push.apply(t,e):t.push(e)})),t}(e):void 0},t.prototype.groupChunks=function(){var e=this.chunks.filter((function(e){return e.state===K.FRESH}));return t.concatChunks(e.map((function(e){return e.state=K.APPENDED,e.data})),this.dataType)},t.prototype.write=function(e,t){if(t===L.RequestEvent.META)-1===this.total&&(this.total=e.total,this.startTime=e.startTime),this.dataType=e.uri.dataType,e.full&&(this.isLastChunk=!0),this.emit(L.StockEvent.META_INFO,e.complete);else if(t===L.RequestEvent.DATA){var r=function(e,t){if(!e)return 0;switch(t){case L.DataType.ARRAYBUFFER:return e.byteLength;case L.DataType.BLOB:return e.size;case L.DataType.TEXT:return e.length;case L.DataType.JSON:return JSON.stringify(e).length;default:return e.byteLength||e.length||0}}(e,this.dataType);this.chunks.push({state:K.FRESH,size:r,data:this.dataType===L.DataType.ARRAYBUFFER?new Uint8Array(e):e}),this.loaded+=r;var i=void 0;this.startTime&&(i=performance.now()-this.startTime,J.notify("speed_update",{processingMs:i,loaded:this.loaded,startTime:this.startTime,total:this.total,duration:this.duration})),this.emit(L.StockEvent.CHUNK_UPDATE,i/r)}elsal),e.loaded&&e.loaded!=this.total&&(-1===this.total&&(this.total=e.total,this.startTime=e.startTime),this.startTime)){i=performance.now()-this.startTime;J.notify("speed_updattTime,total:this.totis.emit(L.StockEvent.ERROR,e)},t.prototype.setConfig=function(e){this.request.isRunning||this.request.changeConfig(e)},t.prototype.setRequest=function(e){this.request=e,this.state=Y.LOADING,e.pipe(this)},t.prototype.abort=function(){this.state=Y.PENDING,this.request.abort()},t.prototype.retry=function(){this.state=Y.LOADING,this.request.retry()},t.prototype.destroy=function(){this.request.abort(),this.off(),this.request=null},t.prototype.end=function(){this.finished=!0,this.state=Y.FINISHED,this.emit(L.StockEvent.FINISH)},t}(L.EventBus),ie=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ne=function(){return(ne=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)oe=[{speed:.9,chunkNum:5},{speed:3,chunkNum:7},{speed:5,chunkNum:9},{speed:9,chunkNum:11},{speed:1/0,chunkNum:13}],ae=function(e){function t(t,r){var i=e.call(this)||this;return i.loader=t,i.stockList=[],i.speedSamples=[],i.type=r.type,r.hasOwnProperty("minChunkLength")&&(i.minChunkLength=r.minChunkLength),i}return ie(t,e),t.prototype.getBuffer=function(){this.stockList.forEach((function(e){e.emit(L.StockEvent.BUFFER_HUNGER)}))},t.prototype.abort=function(e){var t=this;this.stockList=this.stockList.filter((function(r){return!(0==e.length||e.indexOf(r.segmentId)<0)||(r.destroy(),t.emit(L.StockEvent.STOCK_ABORT,r.segmentId),!1)})),this.loader.setRequest()},t.prototype.reset=function(){},t.prototype.destroy=function(){delete this.loader,this.stockList=[],this.speedSamples=[],this.off()},t.prototype.chunkUpdate=function(e,t,r,i){var n=e.ChunkId+=1;this.emit(L.StockEvent.CHUNK_UPDATE,ne(ne({},r),{data:i,chunkId:r.id+"-"+n,isLastChunk:t,total:e.Total,loaded:e.Loaded})),e.ChunkId=n},t.prototype.getAvgSpeed=function(){return this.speedSamples.length>50&&(this.speedSamples=this.speedSamples.slice(this.speedSamples.length/2)),this.speedSamples.reduce((function(e,t){return e+t}),0)/this.speedSamples.length},t.prototype.calChunkNum=function(e){for(var t,r=0;r<oe.length;r++)if(e<oe[r].speed){t=oe[r].ci=this,n=e.id,o=0,a=0,s=this.stockList.find((function(e){return e.segmentId===n}));if(s)s.request.isRunning||s.request.reload();elsepe,id:n},c=new re(n,e.duration),l=void 0;if(t){c.ChunkId=r;var p=e.uri;l=ne(ne({},e),{uri:ne(ne({},p),{byteRange:[t]})}),u.proxyOn=!1}c.setRequest(this.loader.request((l||e).uri,u)),c.on(L.StockEvent.META_INFO,(function(e){i.emit(L.StockEvent.META_INFO,{complete:e,id:n})})),c.on(L.StockEvent.FINISH,(function(){var t=c.groupChunks();t&&t.length>0&&i.chunkUpdate(c,!0,e,t),i.stockList=i.stockList.filter((function(e){return e!=c})),c.off(),i.emit(L.StockEvent.STOCK_COMPLETE,n)})),c.on(L.StockEvent.BUFFER_HUNGER,(function(){if(!c.finished&&c.Watermark>=7e4){var t=c.groupChunks();i.chunkUpdate(c,c.Total-c.Loaded==0,e,t)}})),c.on(L.StockEvent.CHUNK_UPDATE,(function(t){if(null!=i.minChunkLength)a=i.minChunkLength;else if(!a){i.speedSamples.push(t);var r=i.getAvgSpeed();if(!o&&c.Total){o=i.calChunkNum(r);var n=c.Total/1887436.8;o=Math.floor(n*o)>0?Math.floor(n*o):o,a=c.Total/o}else a=512e3}if(c.Watermark>=a||c.finished){var s=c.groupChunks(),u=!!c.isLast||c.Total-c.Loaded==0;i.chunkUpdate(c,u,e,s)}})),c.on(L.StockEvent.ERROR,(function(t){i.emit(L.StockEvent.ERROR,ne(ne({},e),{uri:e.uri,error:t}))})),this.stockList.push(c)}},t}(L.EventBus),se=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","_","-","*","(",")"],ue=se.reduce((function(e,t,r){return e[t]=r,e}),{}),ce=se.length;function le(e){return void 0===e&&(e=0),e>=ce?le(Math.floor(e/ce))+se[e%ce]:se[e]}var pe,de,he=["LOAD_SOURCE","PLAY","PLAYING","WAITING","SEEK","SEEKED","CANPLAY","PAUSE","ENDED","ERROR"],fe=["MANIFEST_DOWNLOAD","LEVEL_DOWNLOAD","LEVEL_CHANGE","CHECK_BUFFER","WAITING_CHECK_BUFFER","INIT_CHECK_BUFFER","TRACK_CHECK_BUFFER","IDLE_CHECK_BUFFER","RESET_CURRENT_PUMPING","SEGMENT_CHECK_BUFFER","SEGMENT_LOADING","SEGMENT_DEGRADE","SEGMENT_DOWNLOAD","SEGMENT_ERROR","RESUME_FROM_BREAK_POINT","SEGMENT_APPENDING","SEGMENT_APPENDED","SEGMENT_DRAINED","SEGMENT_PRELOAD","MEDIA_READY","SEGMENT_META","BUFFER_OVERFLOW","P2P_ERROR","P2P_TIMEOUT","STOCK_ABORT","STOCK_DESTROY","STREAM_REQUEST","STREAM_RETRY","HTTP_REQUEST","P2P_REQUEST","FATAL_ERROR","ABORT_ERROR","RANGE_ERROR"];function me(e,t){var r=[],i="action"===t?he:fe;return e&&t.splice(1,A",e[e.BUFFER_OVERFLOW=21]="BUFFER_OVERFLOW",e[e.P2P_ERROR=22]="P2P_ERROR",e[e.P2P_TIMEOUT=23]="P2P_TIMEOUT",e[e.STOCK_ABORT=24]="STOCK_ABORT",e[e.STOCK_DESTROY=25]="STOCK_DESTROY",e[e.STREAM_REQUEST=26]="STREAM_REQUEST",e[e.STREAM_RETRY=27]="STREAM_RETRY",e[e.HTTP_REQUEST=28]="HTTP_REQUEST",e[e.P2P_REQUEST=29]="P2P_REQUEST",e[e.FATAL_ERROR=30]="FATAL_ERROR",e[e.ABORT_ERROR=31]="ABORT_ERROR",e[e.RANGE_ERROR=32]="RANGE_ERROR"}(de||(de={}));var ge=function(){function e(){this.store={baseTs:Date.now(),actions:[],steps:[],speeds:[]}}return e.prototype.recordAction=function(e){this.store.actions.push([e,Date.now()-this.store.baseTs]),this.store.actions.length>100&&this.store.actions.shift()},e.prototype.recordStep=function(e,t){var r=this.store.steps[0]===e&&r[1]===t?(r[3]++,r[2]=Date.now()-this.store.baseTs):this.store.steps.push([e,t,Date.now()-th&&this.store.steps.shift()},e.prototype.recordSpeed=function(e){this.store.speeds.push(e),this.store.speeds.length>50&&this.store.speeds.shift()},e.prototype.decodeMonitor=functin.sort((function(e,t){return e[2]-t[2]})),n},e.prototype.getActions=function(){return ye(this.store.actions,"action")},e.prototype.getSteps=function(){return ye(this.store.steps,"step")},e.prototype.getSummary=function(){return{actions:this.store.actions.map((function(e){return e.map((function(e){return le(e)})).join(".")})).join("!"),steps:this.store.steps.map((function(e){return e.map((function(e){return le(e)})).join(".")})).join("!"),speeds:ve(this.store.speeds).join("!")}},e.prototype.destroy=function(){this.store={baseTs:Date.now(),actions:[],steps:[],speeds:[]}},e}();function ve(e,t){void 0===t&&(t=.2);var r=e[0],i=[r],n=[];return e.forEach((function(e){Math.abs(e-r)/r<t||Math.abs(e-r)<5?(r=(r*i.length+e)/(i.length+1),i.push(e)):(n.push(Math.round(r)),i=[e],r=e)})),i.length>0&&n.push(Math.round(r)),n}var be,Ee=r(25),_e=r.n(Ee),Re=r(5),Se=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e.MESSAGE="message",e.DATA="data",e.ERROR="error"}(be||(be={}));var Ae=function(e){function t(){var t=e.call(this)||this;try{t.worker=_e()(27),t.onWorkermsg=t.onMessage.bind(t),t.worker.addEventListener(be.MESSAGE,t.onWorkermsg)}catch(e){t.emit(be.ERROR,"worker init failed!")}return t}return Se(t,e),t.prototype.onMessage=function(e){var t=e.data;switch(t.type){case Re.a.RESULT_RETURN:case Re.a.GET_STREAMS:this.emit(be.DATA,t.payload);break;case Re.a.ERROR:this.emit(be.ERROR,t.error)}},t.prototype.destroyWorker=function(){var e=this.worker;e&&(e.objectURL&&self.URL.revokeObjectURL(e.objectURL),e.removeEventListener(be.MESSAGE,this.onWorkermsg),e.terminate(),this.worker=null)},t.prototype.endOfStream=function(){this.worker&&this.worker.postMessage({type:Re.a.END_OF_STREAM,data:{}})},t.prototype.push=function(e){this.worker&&this.worker.postMessage({type:Re.a.MUX,data:{segmentData:e}},e instanceof ArrayBuffer?[e]:[])},t.prototype.flush=function(){this.worker&&this.worker.postMessage({type:Re.a.FLUSH,data:{}})},t.prototype.abort=function(){this.worker&&this.worker.postMessages.worker.postMessage({type:Re.a.RESET})},t.prototype.init=function(e,t,r){this.worker.postMessage({type:Re.a.INIT,data:{type:e,demuxer:t,remuxers:r}})},t.prototype.initAligner=function(){this.worker.postMessage({type:Re.a.INIT_ALIGNER,data:{}})},t.prototype.destroyAligner=function(){this.worker.postMessage({type:Re.a.DESTROY_ALIGNER,data:{}})},t.prototype.getStreams=function(){this.worker.postMessage({type:Re.a.GET_STREAMS})},t.prototype.getOutput=function(e){this.worker.postMessage({type:Re.a.GET_OUTPUT,data:{config:e}})},t.prototype.setAligner=function(e){this.worker.postMessage({type:Re.a.SET_ALIGNER,data:{config:e}})},t.prototype.setDecryption=function(e,t){this.worker.postMessage({type:Re.a.SET_DECRYPTION,data:{method:e,key:t}})},t}(L.EventBus),Te=r(3),we=(r(21),function(){function e(){}return e.probe=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e.buffer instanceof ArrayBuffer){if(function(e){var t=Math.min(1e3,e.length-564),r=0;for(;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1}(e)>=0)return Te.b.M2TS;if(Le({data:e,start:0,end:Math.min(e.byteLength,16384)},["moof"]).length>0)return Te.b.MP4;if(function(e){var t=!0;70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||(t=!1);r=e,i=5,(r[i]<<24|r[i+1]<<16|r[i+2]<<8|r[i+3])<9&&(t=!1);var r,i;return t}(e))return Te.b.FLV}return Te.b.UNKNOWN},e}());fun=e.end,e=e.datar+8))===t[0]&&(1===t.length?u.push({data:e,start:r+8,end:s}):(o=Le({data:e,start:r+8,end:s},t.slice(1))).length&&(u=u.concat(o))),r=s;return u}function Oe(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r}function xe(e){return String.fromCharCode.apply(null,e)}r(19),r(11),r(1);function Pe(){var e={},t=new Promise((function(t,r){e.resolve=t,e.reject=r}));return t.defer=e,t}var De,ke,Ie,Me,Ce,Ne=function(){func,(function(t){var r=e.pendingPromise.shift();r&&!r.aborted&&r.defer.resolve(t)})),this.transmuxer.on(be.ERROR,(function(t){var r=e.pendingPromise.shift();r&&!r.aborted&&r.defer.reject(t)})),this.pendingPromise=[]}return e.prototype.abort=function(){this.transmuxer.abort()},e.prototype.endOfStream=function(){this.transmuxer.endOfStream()},e.prototype.abortAll=function(){this.pendingPromise.forEach((function(e){e.aborted=!0}))},e.prototype.getOutput=function(e){var t=Pe();try{this.transmuxer.getOutput(e),e)}return t},e.proto.getStreams(),thiect(t)}return e},e.prototype.initAligner=function(){this.transmuxer.initAligner()},e.prototype.destroyAligner=function(){this.transmuxon(e){this.transmuxer.setAligner(e)},e.prototype.reset=function(){this.transmuxer.reset(),this.abortAll()},e.prototype.destroy=function(){this.reset(),this.transmuxer.destroyWorker()},e.prototype.init=function(e,t,r){this.transmuxer.init(e,t,r)},e.prototype.push=function(e){this.transmuxer.push(e)},e.prototype.flush=function(){this.transmuxer.flush()},e.prototype.setDecryption=function(e,t){this.transmuxer.setDecryption(e,t)},e}(),Ue=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Be=function(){return(Be}).apply(thiED",e[e.PUMPING=1]="PUMPING",e[e.DRAINED=2]="DRAINED"}(ke||(ke={})),function(e){e[e.ERROR=0]="ERROR",e[e.MEDIA_READY=1]="MEDIA_READY",e[e.LOADED_SEGMENT=2]="LOADED_SEGMENT",e[e.IDLE=3]="IDLE",e[e.REMOVE_CHUNK=4]="REMOVE_CHUNK"}(Ie||(Ie={})),function(e){e[e.NOT_FOUND=0]="NOT_FOUND",e[e.NONE=1]="NONE",e[e.LOADING=2]="LOADING",e[e.LOADING_APPEND=3]="LOADING_APPEND",e[e.LOADED_APPEND=4]="LOADED_APPEND",e[e.OVERFLOW=5]="OVERFLOW"}(Me||(Me={})),function(e){e[e.SEGMENT_ABORT_ERROR=0]="SEGMENT_ABORT_ERROR",e[e.SEGMENT_REQUEST_ERROR=1]="SEGMENT_REQUEST_ERROR",e[e.STREAM_ERROR=2]="STREAM_ERROR"}(Ce||(Ce={}));var Fe,je=U.registerError("NET","SEG",Ce),Ge={maxBufferLength:90,checkTimeout:3e3,maxDecodeBufferLength:30,mergeChunk:!0,autoCleanupChunk:!1,drmType:V.c.NONE},Ve=function(e){function t(t,r,i,n,o){var a=e.call(this)||this;return a.segmentUpdate=function(e){a.prevSegmentLength=a.segmentList.length,e=a.track.current&&a.track.current.segmentList,a.updateSegmentList(e)},a.trackSwitched=function(e){var t=a.mediaRanges.find((function(e){return e.state==De.PUMPING}));z.trace(a.ID,"!!!!!!!!OrderAbortAll",a.type,t&&t.id),t&&a.type!==V.d.AUDIO?a.order.abort([t.id]):a.order.abort([]),a.mediaRanges.forEach((function(e){(a.type==V.d.AUDIO||e.state!=De.DRAINED&&e.state!=De.PUMPING)&&(e.state=De.INIT,e.completed=!1,e.mediaList.length=0)})),a.waitingList.length=0},a.ID="Timeline",a.loader=r,a.type=t.type,a.config=Be(Be({},Ge),i),a.transmuxer=o,a.track=t,a.monitor=n,a.lastBufferEnd=0,a.cashData=new Uint8Array(0),a.firstLoad=!0,a.order=new ae(a.loader,{type:a.type,minChunkLength:a.config.minChunkLength}),a.waitingList=[],a.mediaRanges=[],a.track.on(q.g.SEGMENT_UPDATE,a.segmentUpdate),a.track.on(q.g.SWITCHED,a.trackSwitched),J.on("speed_update",(function(e){e&&e.processingMs&&a.monitor.recordSpeed(1e3*e.loaded/e.processingMs)})),a.order.on(q.f.META_INFO,(function(e){var t=e.complete,r=e.id;if(t){var i=a.mediaRanges.find((function(e){return e.id===r}));i&&i.mediaList.length>0&&(i.mediaList.length=0)}})),a.order.on(q.f.STOCK_COMPLETE,(function(e){a.emit(Ie.IDLE,!0);var t=a.mediaRanges.find((function(t){return t.id===e}));if(t){t.completed=!0,t.state==De.LOADING&&(t.state=De.LOADED);var r=t.mediaList[t.mediaList.length-1];r&&!r.isLastChunk&&(r.isLastChunk=!0)}else z.trace(a.ID,"chunk MediaRange")})),a.order.on(q.f.STOCK_ABORT,(function(e){z.trace(a.ID,"StockAbort",a.type,e),a.monitor.recordStep(de.STOCK_ABORT,e);var t=a.mediaRanges.find((function(t){return t.id===e}));t&&t.state==De.LOADING&&(t.completed=!1,t.state=De.INIT,t.mediaList.forEach((function(e){e.state=ke.LOADED})))})),a.order.on(q.f.CHUNK_UPDATE,(function(e){if(z.trace(a.ID,"ChunkUpdate",a.type,e.id,e.chunkId,e.isLastChunk,e.total,e.loaded),void 0===a.loader.config.chunkEnabled&&(a.format=we.probe(e.data),a.format===V.a.MP4||void 0===a.format?a.loader.setConfig({chunkEnabled:!1}):a.loader.setConfig({chunkEnabled:!0})),0==a.loader.config.chunkEnabled&&(null==a.format||a.format&&a.format===V.a.MP4)){var t=a.segmentList.find((function(t){return t.id==e.id}));if(!e.isLastChunk)return void(a.cashData=re.concatChunks([a.cashData,e.data],t.uri.dataType));a.cashData&&a.cashData.buffer.byteLength>0&&(e.data=re.concatChunks([a.cashData,e.data],t.uri.dataType),a.cashData=new Uint8Array(0))}var r=a.mediaRanges.find((function(t){return t.id===e.id}));if(r){var i=r.mediaList.filter((function(e){return e.state==ke.LOADED}))[r.mediaList.length-1];if(i&&a.config.mergeChunk){t=a.segmentList.find((function(t){return t.id==e.id}));i.data=re.concatChunks([i.data,e.data],t.uri.dataType),e.isLastChunk&&(i.isLastChunk=!0)}else e.chunkId.split("-")[1]!=r.mediaList.length+1&&a.config.mergeChunk&&(e.chunkId=e.chunkId.split("-")[0]+"-"+(r.mediaList.length+1)),r.mediaList.push(Be(Be({},e),{type:a.type,chunkId:e.chunkId,isLastChunk:!!e.isLastChunk&&e.isLastChunk,state:ke.LOADED}));var n=!1;a.prevAppendingMedia&&e.id==a.prevAppendingMedia.id+1&&!a.prevAppendingMedia.lastPart&&a.prevAppendingMedia.isPart&&(n=!0);var o=a.mediaRanges.find((function(e){return e.state==De.PUMPING}));if(!o&&a.waitingList.length<1||o&&o.id==e.id||n)switch(r.state){case De.INIT:r.state=De.LOADING;break;case De.LOADING:case De.PUMPING:a.appendMedia(r);break;case De.DRAINED:case De.LOADED:}else-1==a.waitingList.indexOf(e.id)&&a.waitingList.push(e.id)}else z.trace(a.ID,"chunk MediaRange")})),a.order.on(q.f.ERROR,(function(e){a.monitor.recordStep(de.SEGMENT_ERROR,e.id);var t=a.mediaRanges.find((function(t){return t.id===e.id}));if(t){t.state===De.PUMPING&&a.transmuxer&&a.transmuxer.abort(),t.completed=!1,t.state=De.INIT,t.mediaList.length=0;var r=Ce.SEGMENT_REQUStreamError":r=Ce.STREAM_ERROR;break;case"AbortError":a.monitor.recordStep(de.ABORT_ERROR,e.id),r=Ce.SEGMENT_ABORT_ERROR,i=U.Severity.RECOVERABLE;break;default:a.monitor.recordStep(de.FATAL_ERROR,e.id),r=Ce.SEGMENT_REQUEST_ERROR}a.emit(Ie.ERROR,je.of(r,i,"",e.error.code,e.uri&&e.uri.location,e.error.responseHeaders))}})),a}return Ue(t,e),t.prototype.setConfig=function(e){var t=this;Object.keys(e).forEach((function(r){t.config[r]=e[r]}))},t.prototype.notifyMediaAppended=function(e){var t;if(e)if(t=this.mediaid})))if(z.trace(this.ID,"notifymediaAppended",e.chunkId,t.state,t.levelId),t&&t.state===De.PUMPING&&t.mediaList.length>0){for(var r=t.mediaList,i=void 0,n=0;n<parseInt(e.chunkId.split("-")[1]);n++)r[n]&&parseInt(r[n].chunkId.split("-")[1])<=parseInt(e.chunkId.split("-")[1])&&r[n].state==ke.PUMPING&&(r[n].isLastChunk&&(i=!0),r[n].state=ke.DRAINED);this.config.autoCleanupChunk?t.mediaList=r.filter((function(e){return e.state!==ke.DRAINED})):(this.monitor.recordStep(de.SEGMENT_APPENDED,e.chunkId),r.every((function(e){return e.state==ke.DRAINED}))&&i&&(zdrained",e.id),this.monitor.recordStep(de.SEGMENT_DRAINED,""+e.id+e.levelId),t.state=De.DRAINED,t.mediaList=[],this.getWaitingMedia()))}else t.state=De.INIT,t.completed=!1,t.mediaList.length=0;else z.trace(this.ID,"targetMediaRange not found")},t.prototype.getWaitingMedia=function(){if(this.waitingList=this.waitingList.filter((function(e){return e.state!=De.DRAINED})),this.waitingList.length>0){this.waitingList.sort((function(e,t){return e-t}));var e=this.waitingList.shift(),t=this.mediaRanges.find((function(t){return t.id===e&&(t.state===De.LOADED||t.state===De.LOADING)}));t?this.appendMedia(t):this.getWaitingMedia()}},t.prototype.notifyMediaRemoved=function(e){if(e.hasOwnProperty("id")){var t=this.mediaRanges.find((function(t){return t.id===e.id}));t.state===De.DRAINED&&(t.completed=!1,t.state=De.INIT)}else for(var r=0;r<this.mediaRanges.length;r++){var i=this.mediaRanges[r];i.end>e.start&&i.start<e.end&&i.stape.getProgramInfo=function(e){return this.track&&this.track.current&&this.track.current.programTable[e.programId]||null},t.prototype.updateSegmentList=function(e){this.prevSegmentLength||(this.prevSegmentLength=e.length),this.segmentList="function"==typeof this.config.segmentFilter?this.config.segmentFilter(e):e,e.length<this.mediaRanges.length&&(this.mediaRanges=this.mediaRanges.filter((function(t){return e.find((function(e){return e.id==t.id}))})));for(var t=function(t){var i,n=e[t];i=r.mediaRanges.find((function(e){return e.id==n.id}));var o=r.mediaRanges[t];o?(i?(o.completed=i.completed,o.state=i.state,o.mediaList=i.mediaList):(o.completed=!1,o.state=De.INIT),o.id=n.id,o.levelId=n.levelId,o.start=n.start,o.end=n.end,o.duration=n.duration,o.lastPart=n.lastPart,o.isPart=n.isPart,o.programId=n.programId):r.mediaRanges[t]={completed:!1,start:n.start,id:n.id,end:n.end,duration:n.duration,index:t,levelId:n.levelId,programId:n.programId,mediaList:[],state:De.INIT,independent:n.independent,lastPart:n.lastPart,isPart:n.isPart}},r=this,i=0;i<e.length;i++)t(i)},t.prototype.destroy=function(){this.order.destroy(),this.track&&(this.track.off(q.g.SEGMENT_UPDATE,this.segmentUpdate),this.track.off(q.g.SWITCHED,this.trackSwitched),delete this.track),this.firstLoad=!0,this.segmentList=[],this.mediaRanges=[],this.waitingList=[],delete this.order,clearTimeout(this.idleTimer),this.off()},t.prototype.appendMedia=function(e){var t=this;if(e.mediaList.filter((function(e){return e.staterevAppendingMedia=e,e.id==t.segmentList.length-1&&!t.track.current.live&&r.isLastChunk&&(r.isLast=!0),r.start=e.start,r.end=e.end,r.duration=e.duration,r.state=ke.PUMPING,e.state!=De.PUMPING&&(e.state=De.PUMPING),z.trace(t.ID,"MediaReady",t.type,r.id,r.levelId,r.chunkId,r.state),t.track&&t.emit(Ie.MEDIA_READY,r,t.track.current&&t.track.current.programTable[r.programId])})),e.completed&&0===e.mediaList.filter((function(e){return e.state!=ke.LOADED})).length){var r=this.segmentList.find((function(t){return t.id==e.id}));this.emit(Ie.LOADED_SEGMENT,r)}},t.prototype.abortWaiting=function(e,t){if(!e.Last||t<e.Last[0]||t>e.Last[1]){var r=this.getSegmentAt(t);if(r){var i=[r.id],n=this.mediaRanges.find((function(e){return e.state===De.PUMPING}));n&&i.push(n.id),this.order.abort(i)}this.waitingList.length=0}},t.prototype.check=function(e,t,r,i){var n=this;clearTimeout(this.idleTimer),this.idleTimer=setTimeout((function(){n.emit(Ie.IDLE)}),this.config.checkTimeout);var o=e.getBufferInfo(t);this.currentBufferLength=o.bufferLength;var a=this.segmentList.filternt&&e.start<=o.bufferEnd})),s=this.segmentList.filter((function(e){return 1==e.independent&&e.start>o.bufferEnd})),u=o.bufferEnd;a.length>0?u=a[a.length-1].start:s.length>0&&(u=s[s.length-1].start);var c=this.getNextMediaRange(u,e),l={state:Me.NONE,id:-1},p=!1;if(this.firstLoad&&this.config.drmType==V.c.WIDEVINE&&!this.segmentList.find((function(e){return e.id==c.id})).encrypted){var d=this.segmentList.findInd>-1&&(c=this.mediaRanges[d],p=!0)}if(c)if(c.start-t<this.config.maxBufferLength||p){var h=this.segmentList.find((function(e){return e.id==c.id}));if(p=!1,h){if(this.firstLoad&&(this.firstLoad=!1),this.loader.config&&this.loader.config.chunkEnabled&&c.mediaList.length>0&&!c.completed&&this.currentBufferLength<5){this.monitor&&this.monitor.recordStep(de.RESUME_FROM_BREAK_POINT,c.id);var f=c.mediaList.reduce((function(e,t){return e+t.data.byte",c.id,c.state),this.order.place(h,f,c.mediaList.length)}else c.mediaList.length=0,this.order.place(h);l={state:Me.LOADING,id:c.id},c.state=De.LOADING}}else l={state:Me.OVERFLOW,id:c.id};if(o.bufferLength<this.config.maxDecodeBufferLength){var m=this.findMediaRange(u,e),y=m?m.id:-1;if(m){if(m.state===De.LOADED||this.loader.config.chunkEnabled&&m.state===De.LOADING&&m.mediaList.length>0){var g=this.mediaRanges.find((function(e){return e.state==De.PUMPING}));g&&g.id!=m.id?-1!==this.waitingList.indexOf(m.id)&&this.waitingList.push(m.id):(this.appendMedia(m),l={state:Me.LOADING_APPEND,id:y})}}else z.trace(this.ID,"mediaRange not found from check"),l={state:Me.NOT_FOUND,id:y}}return l},t.prototype.getNextMediaRange=function(e,t,r){void 0===r&&(r=.001);for(var i=0;i<this.mediaRanges.length;i++){var n=this.mediaRanges[i],o=Math.min(r,n.duration-1e-4);if(e+o>=n.start&&e+o<n.end){if(n.state==De.INIT)return n;if(n.state==De.DRAINED){if((r>.001?t.getBufferInfo(n.start,r):t.getBufferInfo(n.start)).bufferLength<=(n.end-n.start)/2)return n;e=n.end+.001}else e=n.end+.001}}var a=this.mediaRanges[this.mediaRanges.length-1];return a&&e+r>=a.end&&a.state===De.INIT?a:null},t.prototype.findMediaRange=functionve negative timestamp");for(var i=0;i<this.mediaRanges.length;i++){var n=this.mediaRanges[i],o=Math.min(r,n.duration-1e-4);if(e+o>=n.start&&e+o<n.end){if(n.state!=De.DRAINED)return n;if(t.getBufferInfo(n.start).bufferLength<=(n.end-n.start)/2)return n;e=n.end+.001}}var a=this.mediaRanges[this.mediaRanges.length-1];return a&&e+r>=a.end&&a.state===De.INIT?a:null},t.prototype.getSegment=function(e){return this.segmentList.find((function(t){return t.id==e}))},t.prototype.getSegmentState=function(e){var t=this.mediaRanges.find((function(t){return t.id==e}));return t?t.state:-1},t.prototype.getSegmen(var r=0;r<this.segmentList.length;r++){var i=this.segmentList[r];if(r===this.segmentList.length-1){if(e+t>=i.start&&e<=i.end+t)return i}else if(e+t>=i.start&&e+t<i.end)return i}return null},t}(o.b),qe=r(17),He=function(){return(He=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};!function(e){e[e.MUX_ERROR=0]="MUX_ERROR"}(Fe||(Fe={}));var $e,We=U.registerError("DEC","MUX",Fe),ze=function(){function e(e,t){var r;this.config={aligner:!0,transmuxEnabled:!1},this.targetFormat=Arrnew Ne,this.lastMediaColleO]={},r[L.MediaType.VIDEO]={},r),this.aligner=!1,this.setConfig(t)}return e.prototype.destroy=function(){this._transmuxer.destroy()},e.prototype.reset=function(){var e;this._transmuxer.reset(),this.lastMediaCollection=((e={})[L.MediaType.MIXED]={},e[L.MediaType.AUDIO]={},e[L.MediaType.VIDEO]={},e),this.decodeFailedCount=0},e.prototype.abort=function(){this._transmuxer.abort()},e.prototype.setDecryption=function(e,t){this.decryptKey=e,this.decryptMethod=t},e.prototype.setConfig=function(e){this.config=Object.assign(this.config,e),this.aligner=this.config.aligner,this.aligner?this._transmuxer.initAligner():this._transmuxer.destroyAligner()},e.prototype.doFilter=function(e,t,r,i){var n,o=this,a=!0,s=!1;if(Object.keys(this.lastMediaCollection[r.type]).length>0&&(n=this.lastMediaCollection[r.type]),n){a=r.programId!=n.programId||r.levelId!=n.levelId;var u=parseInt(r.chunkId.split("-")[1]),c=parseInt(n.chunkId.split("-")[1]);s=(r.id===n.id+1&&n.isLastChunk||r.id===n.id&&u===c+1)&&r.levelId==n.levelId}if(this._transmuxer&&n&&(a?this._transmuxer.endOfStream():s||this.abort()),-1!==this.targetFormat.indexOf(L.ContainerFormat.ANY))return e(r,i);(i.format===L.ContainerFormat.UNKNOWN&&(i.format=we.probe(r.data)),i.codec&&i.codec.mime||!i.initSegment)||((l=qe.b.parse(i.initSegment,L.ContainerFormat.MP4)).audioCodec?i.codec=L.Codecs.generateAudioCodec(l.audioCodec):l.videoCodec&&(i.codec=L.Codecs.generateVideoCodec(l.videoCodec)));if(i.format===L.ContainerFormat.MP4&&!this.config.transmuxEnabled){var l=qe.b.parse(r.data,L.ContainerFormat.MP4);!i.timescale&&i.initSegment&&(i.timescale=qe.b.parse(i.initSegment,L.ContainerFormat.MP4).timescale),r.pts=l.baseMediaDecodeTime/i.timescale,i.streamNum=r.type!=L.MediaType.MIXED?1:2}if(-1!==this.targetFormat.indexOf(i.format)&&!this.config.transmuxEnabled)return e(r,i);this._transmuxer.init(r.type,i.format,this.targetFormat),this.aligner&&this._transmuxer.setAligner({timestampOffset:r.start,discontinuity:a,sequential:s}),(!0===r.encrypted||r.encrypted&&r.encrypted.type&&r.encrypted.type!==L.EncryptMethodType.WIDEVINE)&&this._transmuxer.setDecryption(this.decryptKey,this.decryptMethod),a&&i.initSegment?(this._transmuxer.push(i.initSegment),this._transmuxer.push(r.data)):this._transmuxer.push(r.data),r.isLastChunk&&this._transmuxer.flush();var p={fmp4:!0,separate:!0,type:r.type};r.isLastChunk&&r.type===L.MediaType.MIXED&&(p.forceAlign=!0),this._transmuxer.getOutput(p).then((function(t){o.decodeFailedCount=0,t&&t.streams&&t.streams.forEach((function(i,n){e({id:r.id,chunkId:r.chunkId,type:i.type,start:i.timeline.pts/i.timescale,duration:i.duration/i.timescale,programId:r.programId,levelId:r.levelId,encrypted:r.encrypted,isLast:r.isLast,data:t.data[n][1]},He(He({streamNum:t.streams.length},i.metadata),{initSegment:t.data[n][0],codec:{mime:i.codecString,id:i.metadata.id}}))}))})).catch((function(e){e.message!=qe.a.DecodedFail||e.message==qe.a.DecodedFail&&r.isLastChunk?t(We.of(Fe.MUX_ERROR,U.Severity.FATAL,e.message+r.chunkId)):(z.trace("TransmuxerFilter","decode fail"+o.decodeFailedCount),o.decodeFailedCount++,o.decodeFailedCount>50&&t(We.of(Fe.MUX_ERROR,U.Severity.FATAL,e.message)))})),r.isLast&&this._transmuxer.endOfStream(),this.lastMediaCollection[r.type]=r},e}(),Ke=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ye=function(){return(Ye=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Xe=function(e){function t(t,r,i,n){var o=e.call(this)||this;return o.onWaiting=function(){o.monitor.rmelineList.forEach((function(e){clearTimeout(o.debounceTimer[e.type]),o.debounceTimer[e.type]=null;var t=e.check(o.mediaEngine.getBuffered(e.type),o.mediaEngine.currentTime,o.mediaEngine.playbackRate,o.mediaEngine.isWaiting);o.monitor.recordStep(de.WAITING_CHECK_BUFFER,t&&t.state)})),o.error&&o.checkBufferEmpty()&&(o.onError(o.error),delete o.error)},o.onError=function(e){o.monitor.recordAction(pe.ERROR),o.timelineList.forEach((function(e){e.off(Ie.IDLE)})),e.severity===U.Severity.FATAL&&o.mediaEngine&&o.mediaEngine.pause(),o.emit(L.PlayerEvent.ERROR,e)},o.ID="MainController",o.recodeEvent=[{event:L.PlayerEvent.PLAYING,value:pe.PLAYING},{event:L.PlayerEvent.PLAY,value:pe.PLAY},{event:L.PlayerEvent.SEEKING,value:pe.SEEK},{event:L.PlayerEvent.SEEKED,value:pe.SEEKED},{event:L.PlayerEvent.PAUSE,value:pe.PAUSE},{event:L.PlayerEvent.ENDED,value:pe.ENDED},{event:L.PlayerEvent.CANPLAY,value:pe.CANPLAY}],o.monitor=new ge,o.loader=i,o.loader.addMonitor(o.monitor),o.config=n,o.lastEnginePlaying=!1,o.timelineList=[],o.childControllers=[],o.eventList={},o.debounceTimer={},o.initMediaEngine(r),o.initManifest(t),o}return Ke(t,e),t.prototype.initMediaEngine=function(e){var t=this;this.transmuxer&&this.transmuxer.destroy(),this.transmuxer=new ze(e.supportFormats,this.config.transmuxerConfig),"function"==typeof e.setMonitor&&e.setMonitor(this.monitor),e.setupInputFilter(this.transmuxer),e.on(L.PlayerEvent.BUFFER_CHANGE,(function(e){t.debounceTimer&&t.debounceTimer[e]||t.debounceTimer&&(t.debounceTimer[e]=window.setTimeout((function(){t.debounceTimer&&(t.debounceTimer[e]&&clearTimeout(t.debounceTimer[e]),t.debounceTimer[e]=null,t.timelineList.filter((function(t){return t.type===e})).forEach((function(e){var r=e.check(t.mediaEngine.getBuffered(e.type),t.mediaEngine.currentTime,t.mediaEngine.playbackRate);r&&r.state===Me.LOADING?t.monitor.recordStep(de.SEGMENT_PRELOAD,r&&r.id):r&&(r.state,Me.OVERFLOW)})))}),500))})),e.on(L.PlayerEvent.SEEKING,(function(){t.timelineList.forEach((function(r){r.abortWaiting(t.mediaEngine.getBuffered(r.type),e.currentTime)}))})),e.on(L.MediaEngineEvent.RESET,(function(){t.loadSource(t.source),t.childControllers.forEach((function(e){e.reset()})),t.lastEnginePlaying&&e.play()})),e.on(L.MediaEngineEvent.BUFFER_FULL,(function(e){e&&e.chunkId&&t.timelineList.filter((function(t){return t.type===e.type})).forEach((function(t){t.notifyMediaAppended(e)}))})),e.on(L.MediaEngineEvent.MEDIA_APPENDED,(function(r){var i=r.id,n=r.media,o=r.type;t.lastEnginePlaying=e.playing,t.timelineList.filter((function(e){return e.type===o})).forEach((function(e){var r=e.getSegment(i),a=n&&e.getProgramInfo(n)||{info:{}};e.notifyMediaAppended(n),t.emit(L.Playetype:o}))}))})),e.on(L.MediaEngineEvent.BUFFER_REMOVED,(function(e){var r=e.data,i=e.type;t.timelineList.filter((function(e){return e.type===i})).forEach((function(e){e.notifyMediaRemoved(r)}))})),e.on(L.PlayerEvent.ERROR,this.onError),e.on(L.PlayerEvent.WAITING,this.onWaiting),e.on(L.PlayerEvent.LEVEL_CHANGE,(function(e){t.emit(L.PlayerEvent.LEVEL_CHANGE,e)})),this.recodeEvent.forEach((function(r){e.on(r.event,(function(){t.monitor.recordAction(r.value)}))})),this.mediaEngine=e},t.prototype.initManifest=function(e){var t=this;this.manifest=e,e.on(L.ManifestEvent.TrackLevelSwitched,(function(r,i){if(z.trace(t.ID,"ManifestTrackLevelSwitched",r.id),t.monitor.recordStep(de.LEVEL_CHANGE,r.id),e.isLive)t.mediaEngine.changeDuration(1/0);else{var n=e.getTotalDuration();n>0&&t.mediaEngine.changeDuration(n)}i.type===L.MediaType.AUDIO&&t.mediaEngine.buffered.length>0&&t.mediaEngine.removeBuffer(L.MediaType.AUDIO,0,1/0),t.emit(L.PlayerEvent.LEVEL_CHANGE,r,i)})),e.on(L.ManifestEvent.READY,(function(){D.of(t.mediaEngine,"ready").then((function(){z.trace(t.ID,"ManifestReady & MediaEngineReady");var r=e.getAllTrack();t.timelineList.length>0&&t.timelineList.forEach((function(e){return e.destroy()})),t.initTimeline(r)})),t.emit(L.PlayerEvent.LOADED_MANIFEST,e)})),e.on(L.ManifestEvent.ERROR,this.onError)},t.prototype.checkBufferEmpty=function(){var e=this.mediaEngine&&this.mediaEngine.buffered.getBufferInfo(this.mediaEngine.currentTime);return e&&e.bufferLength<3},t.prototype.stop=function(){var e=this;D.of(this.mediaEngine,"ready").clear(),this.transmuxer.reset(),this.error=null,this.timelineList.forEach((function(t){e.debounceTimer[t.type]&&(cleartype]=ner(t.type,0,1/0),e})),this.loader&&this.loader.destroy(),this.eventList={},this.timelineList=[],this.debounceTimer={}},t.prototype.getSummary=function(){var e=this,t=this.monitor.getSummary();if(this.mediaEngine&&t){t.currentTime=this.mediaEngine.currentTime;var r=[L.MediaType.AUDIO,L.MediaType.VIDEO].map((function(t){return e.mediaEngine.getBufferInfo(t)})).map((function(e){return[e.bufferStart,e.bufferEnd,e.bufferLength]}));t.buffer=r.m e.join("-")})).join("!");var i=this.timelineList.map((function(t){var r=t.getSegmentAt(e.mediaEngine.currentTime);if(r){var i=r.id;return[t.getSegment(i-1),t.getSegment(i),t.getSegment(i+1)].map((function(e){return e?e.id+"-"+e.start+"-"+e.end+"-"+t.getSegmentState(e.id):null}))}return[]}));this.loader&&this.loader.totalByteLength&&(t.segmentsByteLength=this.loader.totalByteLength),t.segmentList=i.map((function(e){return(e=e.filter((function(e){return e}))).join("!")})).join("!")}return t},t.prototype.destroy=function(){z.trace(this.ID,"destroy"),this.mediaEngine&&(this.stop(),this.manifest&&this.manifest.destroy(),this.transmuxer.destroy(),thisforEach((function(e){e.destroy()})),this.childControllers=[],this.off(),this.config=null,this.source=null,this.monitor.destroy(),this.recodeEvent=null,delete this.debounceTimer,delete this.mediaEngine,delete this.manifest,delete this.loader)},t.prototype.removeTrackEvent=function(e){var t=this.eventList[e.type],r=this.manifest.getAllTrack().filter((function(t){return t.type===e.type}))[0];t&&t.length>0&&r&&t.forEach((function(e){r.off(e.eventName,e.exec)}))},t.prototype.initTimeline=function(e){var t=this;e.forEach((function(e){var r=new Ve(e,t.loader,Ye({drmType:t.config.drmType,segmentFilter:t.config.filters&&t.config.filters.segmentFilter},t.config.timeline),t.monitor,t.trant.codec),t.timelineList.push(r),r.on(Ie.MEDIA_READY,(function(e){t.mediaEngine.appendMedia(Ye({},e),r.getProgramInfo(e)).catch((function(e){t.checkBufferEmpty()?t.onError(e):t.error=e}))})),r.on(Ie.IDLE,(function(e){if(!e||e&&t.manifest.lowLatencyMode){if(t.mediaEngine.ended)return;r.check(t.mediaEngine.getBuffered(r.type),t.mediaEngine.currentTime,t.mediaEngine.playbackRate)}})),r.on(Ie.LOADED_SEGMENT,(function(e){t.emit(L.PlayerEvent.LOADED_SEGMENT,e)})),r.on(Ie.ERROR,(function(e){t.checkBufferEmpty()?t.onError(e):t.error=e})),e.current&&e.current.segmentList.length>0){r.updateSegmentList(e.current.segmentList);var i=r.check(t.mediaEngine.getBuffered(r.type),t.mediaEngine.currentTime,t.mediaEngine.playbackRate);t.monitor.recordStep(de.INIT_CHECK_BUFFER,i&&i.state)}var n=function(){r.updateSegmentList(e.current.segmentList);var i=r.check(t.mediaEngine.getBuffered(r.type),t.mediaEngine.currentTime,t.medCHECK_BUFFER,i&&i.state)},o=function(i){r.check(t.mediaEngine.getBuffered(r.type),t.mediaEngine.currentTime,t.mediaEngine.playbackRate);t.emit(L.PlayerEvent.SEGMENT_UPDATE,i,e.current.url,e.type)};e.on(L.TrackEvent.SWITCHED,n),e.on(L.TrackEvent.SEGMENT_UPDATE,o),t.eventList[e.type]=[{eventName:L.TrackEvent.SWITCHED,exec:n},{eventName:L.TrackEvent.SEGMENT_UPDATE,exec:o}]})),this.childControllers.forEach((function(ist)}))},t.prototype.loadSource=function(e){this.source=e,this.monitor.recordAction(pe.LOAD_SOURCE),this.stop(),this.emit(L.PlayerEvent.LOAD_START),this.manifest.load(e)},t.prototype.setConfig=function(e){this.config=Object.assign(this.config,e),this.config.transmuxerConfig&&this.transmuxer.setConfig(this.config.transmuxerConfig)},t.prototype.setDrmType=function(e){this.timelineList.length>0?this.timelineList.forEach((function(t){t.setConfig({drmn(e){e.setup(this.manifest,this.mediaEngine,this.loader,this.timelineList,trror),this.childControllers.push(e)},t.prototype.unloadChildController=function(e){ey(),this.childControllers=this.childControllers.filter((function(t){return t!==e}))},t.prototype.getSegmentAt=function(e){var t=this.timelineList.filter((function(e){return e.type===L.MediaType.VIDEO||e.type===L.MediaType.MIXED}));return t&&t[0]?t[0].getSegmentAt(e):null},t.prototype.replaceMediaEngine=function(e){this.initMediaEngine(e)},t.prototype.replaceManifest=function(e){this.timelineList=this.timelineList.filter((function(e){return e.destroy(),!1})),this.initManifest(e)},t}(L.EventBus),Qe=r(9),Je=r(2),Ze=r(15),et=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),tt=function(){return(tt=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},rt=function(e){function t(t,r,i){var n=e.call(this)||this;return n.errorFunc=function(e){var t=n.getHeaders();n.code||(n.code=555);var r={code:n.code},i=tt(tt(tt({},e),r),{responseHeaders:t});n.emit(Je.a.ERROR,i)},n.id=r.id,n.retryNum=0,n.config=r,n.uri=t,n.isAbort=!1,n.proxyOn=r.proxyOn,n.mediaType=r.mediaType||Ze.a.MIXED,n.isDestroy=!1,n.running=!1,n.monitor=i,n.ID="Loader",n}return et(t,e),t.prototype.initRequest=function(){this.xhr=new XMLHttpRequest,this.addEvent(),this.retryDelay=this.config.retryDelay?this.config.retryDelay:500,this.getResponseType(this.uri.dataType),this.config.timeout?this.xhr.timeout=this.config.timeout:this.config.timeout=this.xhr.timeout=7e3,this.config.maxRetryNum=this.config.maxRetryNum?this.config.maxRetryNum:3,this.config.maxRetquest()},t.prototype.getResponseType=function(e){switch(e){case Qe.a.ARRAYBUFFER:this.xhr.responseType="arraybuffer";break;case Qe.a.BLOB:this.xhr.responseType="blob";break;case Qe.a.JSON:this.xhr.responseType="json";break;case Qe.a.TEXT:this.xhr.responseType="text"}},t.prototype.getHeaders=function(){var e={};this.xhr&&this.xhr.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(t){var r=t.split(": "),i=r.shift(),n=r.join(": ");i&&(e[i]=n)}));return e},t.prototype.addEvent=function(){var e=this;this.xhr.onload=function(){e.clearTimer();var t=e.xhr,r=t.response,i=t.status;if(e.code=i,i>=200&&i<=299&&202!=i){e.firstLoadingTime=performance.now();var n=e.getHeaders(),o={url:e.xhr.responseURL,headers:n,uri:e.uri,startTime:e.startTime,firstLoadingTime:e.firstLoadingTime,total:e.xhr.getResponseHeader("Content-Length")};e.emit(Je.a.META,o);var a=void 0;e.xhr.response?a=e.xhr.response:"textresponseType&&(a=seFilter?(r=e.config.responseFilter(a,e.uri,e.config,e.config.loaderType))&&"function"==typeof r.then?r.then((function(t){e.emit(Je.a.DATA,t),e.emit(Je.a.FINISH,e.downloadMode)})):(e.emit(Je.a.DATA,r),e.emit(Je.a.FINISH,e.downloadMode)):(e.emit(Je.a.DATA,a),e.emit(Je.a.FINISH,e.downloadMode))}else e.retry(Error(""+i))},this.xhr.onabort=function(t){e.config.abortFunction&&e.config.abortFunction(t)},this.xhr.onerror=function(t){e.abort(),e.retry(t)},this.xhr.ontimeout=function(){e.abort(),e.code=408,e.retry(Error(""))},this.xhr.onprogress=function(t){e.emit(Je.a.PROGRESS,{loaded:t.loaded,total:t.total}),e.config.progressFunctionhr.abort(),this.running=!1,this.isAbort=!0,this.clearTimer())},t.prototype.cancelProxy=function(){this.proxy&&(this.config.proxy.abort(this.proxy),this.proxy.off(),this.proxy=null)},t.prototype.destroy=function(){this.abort(),this.off(),this.isDestroy=!0,this.uri=null,this.config=null},t.prototype.clearTimer=function(){this.requestTimeout&&(clearTimeout(this.requestTimeout),this.requestTimeout=null),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=null)},t.prototype.reload=function(){this.isDestroy||(this.clearTimer(),z.trace(this.ID,"",this.id),this.abort(),this.initRequest())},t.prototype.retry=function(e){var t=this;if(z.trace(this.ID,"",this.retryNum,this.id),!this.isDestroy){if(this.clearTimer(),this.retryNum>=this.config.maxRetryNum)return this.errorFunc(e),this.retryNum;if(z.trace(this.ID,"",this.id),this.config.retryFilter){var r=this.getHeaders(),i=this.config.retryFilter(this.uri,this.config,this.config.loaderType,{responseHeaders:r});"function"==typeof i.then?i.then((function(e){t.setConfig(e),t.retryRequest()})):(this.setryRequest();return this.retryNum}},t.prototype.retryRequest=function(){var e=this;this.retryTimeout=window.setTimeout((function(){e.initRequest(),e.retryNum+=1,e.retryDelay=Math.min(2*e.retryDelay,e.confifunction(){var e=this;if(this.running=!0,this.isAbort=!1,this.config.requestFilter){var t=this.config.requestFilter(this.uri,this.config,this.config.loaderType);"function"==typeof t.then?t.then((function(t){e.setConfig(t),e.initRequest()})):(this.setConfig(t),this.initRequest())}else this.initRequest()},t.prototype.setConfig=function(e){this.uri=e.uri,e.config&&(this.config=Object.assign({},this.config,e.config))},t.prototype.changeConfig=function(e){this.config=Object.assign({},this.config,e)},t.prototype._request=function(){null!=this.id&&z.trace(this.ID,"",this.uri.location,this.mediaType),this.config&&this.config.proxy&&this.proxyOn?(this.proxy=this.config.proxy.request(this.uri.location,this.mediaType,this.id),this.proxy?this.addProxyEvent():(this.proxyOn=!1,this.xhrRequest(),this.emit(Je.a.CONCURRENT,this.type))):this.xhrRequest()},t.prototype.addProxyEvent=function(){var e=this;this.downloadMode=$e.PROXY,this.proxy.on(Je.a.DATA,(function(t){var r={startTime:t.startTime,headers:{},url:"",uri:e.uri,total:t.data.byteLength};e.emit(Je.a.META,r),e.emit(Je.a.DATA,t.data),e.emit(Je.a.FINISH)})),this.proxy.on(Je.a.ERROR,(function(t){t&&t.severity===U.Severity.FATAL&&(e.proxy.off(),e.config.proxy.p2pStatus=!1),z.trace(e.ID,"proxy",e.id,t),e.monitor&&e.monitor.recordStep(de.P2P_ERROR,e.id),e.proxyOn=!1,e.retry("proxy")})),this.proxy.on(Je.a.PROGRESS,(function(t){e.config.progressFunction&&e.config.progressFunction(t),e.emit(Je.a.PROGRESS,t)}))},Object.defineProperty(t.prototype,"isRunning",{get:function(){return this.running},enumerable:!1,configurable:!0}),t.prototype.xhrRequest=function(){var e=this;this.downloadMode=$e.XHR,this.monitor&&this.monitor.recordStep(de.HTTP_REQUEST,this.id);var t=this.config.method?this.config.method:"GET",r=!this.config.sync||this.config.sync;if(this.xhr.open(t,this.uri.location),this.config.headers)for(var i in this.config.headers)if(this.config.headers.hasOwnProperty(i)){var n="Authorization"===i?i:i.toLowerCase();this.xhr.setRequestHeader(n,this.config.headers[i])}!r&&this.xhr.timeout>0&&(this.requestTimeout=window.setTimeout((function(){e.abort()}),this.config.timeout)),this.startTime=performance.now(),this.xhr.send()},t.prototype.pipe=function(e){var t=this;return this.on(Je.a.DATA,(function(t){e.write(t,Je.a.DATA)})),this.on(Je.a.META,(function(t){e.write(t,Je.a.META)})),this.on(Je.a.FINISH,(function(){t.running=!1,e.end()})),this.on(Je.a.ERROR,(function(r){r&&r.code&&(t.running=!1,e.write(r,Je.a.ERROR))})),this.on(Je.a.PROGRESS,(function(t){e.write(t,Je.a.PROGRESS)})),e},t}(a.a),it=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),nt=function(){return(nt=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},ot=function(e){function t(t,r,i){var n=e.call(this)||this;return n.retry=function(e){if(z.trace(n.ID,"",n.retryNum,n.id,e),n.clearTimer(),!n.isDestroy){if(n.retryNum>=n.config.maxRetryNum)return e&&"string"==typeof e?n.errorFunc({message:e}):e&&n.errorFunc(e),n.retryNum;if(n.config.retryFilter){var t={};e&&e.headers&&e.headers.forEach((function(e,r){t[r]=e}));var r=n.config.retryFilter(n.uri,n.config,n.config.loaderType,{responseHeaders:t,code:n.code});"function"==typeof r.then?r.then((function(e){n.initRequest(e),n.retryRequest()})):(n.initRequest(r),n.retryRequest())}else n.retryRequest();return n.retryNum}},n.errorFunc=function(e){if(!(e&&"AbortError"===e.name&&n.retryNum<n.config.maxRetryNum)){n.code||(n.code=555);var t={code:n.code},r={};e.headers&&e.headers.forEach((function(e,t){r[t]=e}));var i=nt(nt(nt({},e),t),{responseHeaders:r});n.emit(Je.a.ERROR,i)}},n.processResponse=function(e){if(e.ok)if(n.firstLoadingTime=performance.now(),n.sendMetaInfo(e),n.config&&n.config.isSupportEtag&&(e.headers.get("Etag")||e.headers.get("Last-modified"))&&(n.config.headers["If-Range"]=e.headers.get("Etag")?e.headers.get("Etag"):e.headers.get("Last-modified")),n.monitor&&n.monitor.recordStep(de.STREAM_REQUEST,""+n.id+(n.chunkEnabled?1:0)),n.chunkEnabled){var t=e.body.getReader();n.reader=t,n.sendStreamData()}else n.sendNonStreamData(e);else n.code=e.status,n.retry(e)},n.id=r.id,n.retryNum=0,n.length=0,n.config=r||{},n.retryDelay=n.config.retryDelay?n.config.retryDelay:100,n.config.maxRetryNum=n.config.maxRetryNum?n.config.maxRetryNum:3,n.config.timeout=n.config.timeout?n.config.timeout:7e3,n.config.maxRetryDelay=n.config.maxRetryDelay?n.config.maxRetryDelay:500,n.uri=t,n.retryRangeAllowed=!1,n.isRange=!1,n.init=!0,n.proxyOn=r.proxyOn,n.chunkEnabled=null==r.chunkEnabled||r.chunkEnabled,n.isAbort=!1,n.isDestroy=!1,n.running=!1,n.monitor=i,n.ID="Loader",n.mediaType=n.config.mediaType||Ze.a.MIXED,n}return it(t,e),t.prototype.changeConfig=function(e){this.config=Object.assign({},this.config,e)||{}},t.prototype.calculateRange=function(){return this.myRange?(this.length||(this.length=0),void 0===this.myRange[1]?this.myRange[0]+this.length+"-":this.myRange[0]+this.length+"-"+this.myRange[1]):(this.myRange=[this.length],this.length+"-")},t.prototype.streamAbort=function(){var e=this;this.reader&&this.reader.cancel().then((function(){e.clearStreamTimer(),e.fetchAbort()}))},t.prototype.fetchAbort=function(){var e=this;this.abortController&&(this.abortSignal.addEventListener("abort",(function(){e.config&&e.config.abortFunction&&e.config.abortFunction()})),this.abortController.abort())},t.prototype.cancelProxy=function(){this.proxy&&this.config.proxy&&(this.config.proxy.abort(this.proxy),this.proxy.off(),this.proxy=null)},t.prototype.abort=function(){this.clearTimer(),this.isDestroy||(z.trace(this.ID,"abort",this.id,this.proxyOn,this.chunkEnabled),this.running&&(this.running=!1,this.proxyOn&&this.proxy?this.cancelProxy():this.chunkEnabled?this.streamAbort():this.fetchAbort()),this.isAbort=!0)},t.prototype.destroy=function(){this.abort(),this.off(),this.isDestroy=!0,this.uri=null,this.init=!0},t.prototype.pipe=function(e){var t=this;return this.on(Je.a.DATA,(function(t){e.write(t,Je.a.DATA)})),this.on(Je.a.META,(function(t){e.write(t,Je.a.META)})),this.on(Je.a.FINISH,(function(){t.running=!1,e.end()})),this.on(Je.a.PROGRESS,(function(t){e.write(t,Je.a.PROGRESS)})),this.on(Je.a.ERROR,(function(r){r&&r.code&&(t.running=!1,r.url=t.uri.location,e.write(r,Je.a.ERROR))})),e},t.prototype.reload=function(){this.clearTimer(),this.isDestroy||(z.trace(this.ID,"",this.id),this.abort(),this._request())},t.prototype.retryRequest=function(){var e=this;!this.retryRangeAllowed&&this.chunkEnabled&&this.length>0?(this.monitor&&this.monitor.recordStep(de.STREAM_RETRY,this.id+"00"),this.retryRangeAllowed=!0,this.retryTimeout=window.setTimeout((function(){e._request()}),this.retryDelay)):(this.monitor&&this.monitor.recordStep(de.STREAM_RETRY,this.id),this.retryTimeout=window.setTimeout((function(){e._request()}),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,this.config.maxRetryDelay),this.retryNum+=1)},t.prototype.initRequest=function(e){this.uri=e.uri,e.config&&this.config&&Object.assign(this.config,e.config)},t.prototype.request=function(){var e=this;if(this.config.requestFilter){var t=this.config.requestFilter(this.uri,this.config,this.config.loaderType);"function"==typeof t.then?t.then((function(t){e.initRequest(t),e._request()})):(this.initRequest(t),this._request())}else this._request()},t.prototype.getTypeResponse=function(e){switch(this.uri.dataType){case Qe.a.ARRAYBUFFER:return e.arrayBuffer();case Qe.a.BLOB:return e.blob();case Qe.a.JSON:return e.json();case Qe.a.TEXT:return e.text()}},t.prototype.initConfig=function(){this.init=!1,this.uri&&this.uri.byteRange&&(this.isRange=!0,this.myRange=this.uri.byteRange)},t.prototype.sendMetaInfo=function(e){var t;e.headers.get("Content-Range")?t=e.headers.get("Content-Range").split("/")[1]:e.headers.get("Content-Length")&&(t=e.headers.get("Content-Length")),this.total=t=parseInt(t);var r={};e.headers.forEach((function(e,t){r[t]=e}));var i={complete:200==e.status,startTime:this.startTime,firstLoadingTime:this.firstLoadingTime,headers:r,url:e.url,uri:this.uri,total:t};this.emit(Je.a.META,i)},t.prototype.sendNonStreamData=function(e){var t=this;this.getTypeResponse(e).then((function(e){t.processResponseFilter(e)}))},t.prototype.sendStreamData=function(){var e=this;this.startStreamTimer(),this.reader.read().then((function(t){var r=t.value,i=t.done;e.startStreamTimer(),i?e.isAbort||(e.clearStreamTimer(),e.emit(Je.a.FINISH,e.downloadMode)):(e.length+=r.length,e.emit(Je.a.PROGRESS,{loaded:e.length,total:e.total}),e.processResponseFilter(r))}))},t.prototype.startStreamTimer=function(){var e=this;this.clearStreamTimer(),this.streamTimer=window.setTimeout((function(){e.abort(),e.errorFunc({code:-1,message:"stream error",name:"StreamError"})}),1e4)},t.prototype.clearStreamTimer=function(){this.streamTimer&&(clearTimeout(this.streamTimer),this.streamTimer=null)},t.prototype.processResult=function(){this.chunkEnabled?this.sendStreamData():this.emit(Je.a.FINISH,this.downloadMode)},t.prototype.clearTimer=function(){this.requestTimeout&&(clearTimeout(this.requestTimeout),this.requestTimeout=null),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=null)},t.prototype.processResponseFilter=function(e){var t=this;if(this.clearTimer(),this.config&&this.config.responseFilter){var r=this.config.responseFilter(e,this.uri,this.config,this.config.loaderType);r&&"function"==typeof r.then?r.then((function(e){t.emit(Je.a.DATA,e),t.processResult()})):(this.emit(Je.a.DATA,r),this.processResult())}else this.emit(Je.a.DATA,e),this.processResult()},t.prototype.setRange=function(){if(this.myRange||this.length){var e=this.calculateRange();this.config&&this.config.rangeArgs?(this.uriRange&&(this.uri.location=this.uri.location.replace(this.uriRange,"")),this.uriRange="&xrange="+e,this.uri.location+=this.uriRange):this.config&&(this.config.headers||(this.config.headers={}),this.config.headers.Range="bytes="+e)}},t.prototype._request=function(){this.running=!0,this.isAbort=!1,this.init&&this.initConfig(),this.config?(void 0!==this.id&&z.trace(this.ID,"",this.id,this.mediaType,this.uri.location),this.config&&this.config.proxy&&this.proxyOn?(this.proxy=this.config.proxy.request(this.uri.location,this.mediaType,this.id),this.proxy?(z.trace(this.ID,"proxy",this.id),this.monitor&&this.monitor.recordStep(de.P2P_REQUEST,this.id),this.addProxyEvent()):(this.proxyOn=!1,this.fetchRequest(),this.emit(Je.a.CONCURRENT,this.type))):this.fetchRequest()):this.isDestroy=!0},t.prototype.addProxyEvent=function(){var e=this;this.downloadMode=$e.PROXY,this.proxy.on(Je.a.DATA,(function(t){var r={startTime:t.startTime?t.startTime:e.startTime,headers:{},url:"",uri:e.uri,total:t.data.byteLength,complete:!0,full:!0};e.emit(Je.a.META,r),e.emit(Je.a.DATA,t.data),e.emit(Je.a.FINISH,e.downloadMode)})),this.proxy.on(Je.a.ERROR,(function(t){e.monitor&&e.monitor.recordStep(de.P2P_ERROR,e.id),z.trace(e.ID,"proxy",e.id,t),e.proxyOn=!1,e.retry("proxy")})),this.proxy.on(Je.a.PROGRESS,(function(t){e.config&&e.config.progressFunction&&e.config.progressFunction(t),e.emit(Je.a.PROGRESS,t)}))},Object.defineProperty(t.prototype,"isRunning",{get:function(){return this.running},enumerable:!1,configurable:!0}),t.prototype.fetchRequest=function(){var e=this;(this.myRange||this.chunkEnabled&&(this.isRange||this.retryRangeAllowed))&&this.setRange(),this.monitor&&this.monitor.recordStep(de.STREAM_REQUEST,this.id),"function"==typeof AbortController&&(this.abortController=new AbortController,this.abortSignal=this.abortController.signal,this.config.signal=this.abortSignal),this.startTime=performance.now(),this.requestTimeout=window.setTimeout((function(){e.code=408,e.abort(),e.retry("")}),this.config.timeout||7e3),fetch(this.uri.location,this.config).then(this.processResponse).catch(this.retry)},t}(a.a),at=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),st=function(e){function t(t,r){var i=e.call(this)||this;return i.config=r,i.uri=t,i.isAbort=!1,i.isDestroy=!1,i}return at(t,e),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this.isDestroy},enumerable:!1,configurable:!0}),t.prototype.retry=function(){var e=this;if(!this.isDestroy)return this.timer=window.setTimeout((function(){e.emit(L.RequestEvent.META,{uri:e.uri,startTime:performance.now(),total:0,url:e.uri&&e.uri.location||""}),e.emit(L.RequestEvent.DATA,e.uri&&e.uri.location||""),e.emit(L.RequestEvent.FINISH)}),0),0},t.prototype.abort=function(){this.isAbort=!0,this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.destroy=function(){this.isDestroy=!0,this.abort(),this.off(),this.timer&&(clearTimeout(this.timer),this.timer=null),this.uri=null,this.config=null},t.prototype.request=function(){var e=this;if(this.isAbort=!1,this.config.requestFilter){var t=this.config.requestFilter(this.uri,this.config,this.config.loaderType);"function"==typeof t.then?t.then((function(t){e.uri=t.uri,e.config=t.config,e._request()})):(this.uri=t.uri,this.config=t.config,this._request())}else this._request()},t.prototype._request=function(){var e=this;this.timer=window.setTimeout((function(){e.emit(L.RequestEvent.META,{uri:e.uri,startTime:performance.now(),total:0,url:e.uri&&e.uri.location||""}),e.emit(L.RequestEvent.DATA,e.uri&&e.uri.location||""),e.emit(L.RequestEvent.FINISH)}),0)},t.prototype.pipe=function(e){return this.on(L.RequestEvent.DATA,(function(t){e.write(t,L.RequestEvent.DATA)})),this.on(L.RequestEvent.META,(function(t){e.write(t,L.RequestEvent.META)})),this.on(L.RequestEvent.FINISH,(function(){e.end()})),this.on(L.RequestEvent.PROGRESS,(function(t){e.write(t,L.RequestEvent.PROGRESS)})),e},t}(L.EventBus);!function(e){e.FETCH="FETCH",e.XHR="XHR",e.PROXY="PROXY"}($e||($e={}));var ut=function(){function e(e,t){this.loaderConfig=t||{},this.loaderConfig.loaderType=e||"",this.loaderConfig.proxyOn=!(!t||!t.proxy),this.maxLoaderRunning=t.maxLoaderRunning||2,this.segmentsByteLength=0,this.maxConcurrentNum=t.maxConcurrentNum||2,this.loaderWaitingList=new Map,this.loaderRunningList=new Map,this.ID="Loader"}return e.prototype.addMonitor=function(e){this.monitor=e},Object.defineProperty(e.prototype,"config",{get:function(){return this.loaderConfig},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this.downloadMode},enumerable:!1,configurable:!0}),e.prototype.setConfig=function(e){this.loaderConfig=Object.assign({},this.loaderConfig,e)},Object.defineProperty(e.prototype,"totalByteLength",{get:function(){return this.segmentsByteLength},enumerable:!1,configurable:!0}),e.prototype.cleanByteLength=function(){this.segmentsByteLength=0},e.prototype.request=function(e,t){var r,i=this;if(!e.schema)throw new Error("invalid schema");if(!e.location)throw new Error("invalid uri");if(!e.dataType)throw new Error("invalid dataType");t||(t={}),t=Object.setPrototypeOf(t,this.loaderConfig),e.schema===Qe.b.LITERAL?r=new st(e,t):"function"==typeof fetch&&"function"==typeof ReadableStream&&"function"==typeof AbortController?(this.downloadMode=$e.FETCH,r=new ot(e,t,this.monitor)):(this.downloadMode=$e.XHR,r=new rt(e,t,this.monitor)),r.on(Je.a.ERROR,(function(e){i.loaderRunningList.forEach((function(e,t){e=e.filter((function(e){return e.id!=r.id||e.mediaType!equest(r.mediaType)})),r.on(Je.a.START,(function(){r.isDestroy||r.isAbort||r.isRunning||(i.monitor&&i.monitor.recordStep(de.SEGMENT_LOADING,r.id),r.request()),i.setRequest(r.mediaType)})),r.on(Je.a.CONCURRENT,(function(e){var t=i.loaderWaitingList.get(e)||[],n=i.loaderRunningList.get(e)||[];if(t.length>0&&n.length<i.maxConcurrentNum){i.monitor&&i.monitor.recordStep(de.SEGMENT_DEGRADE,r.id);var o=t.shift();n.push(o),i.loaderRunningList.set(e,n),i.loaderWaitingList.set(e,t),o.emit(Je.a.START)}})),this.filterList(),r.on(Je.a.META,(function(e){e.total&&(i.segmentsByteLength+=e.total)})),r.on(Je.a.FINISH,(function(e){e&&(i.downloadMode=e),i.monitor&&i.monitor.recordStep(de.SEGMENT_DOWNLOAD,r.id);var t=i.loaderRunningList.get(r.mediaType)||[];t=t.filter((function(e){return e.id!=r.id}setRequest(r.mediaType)}));var n=this.loaderWaitingList.get(r.mediaType)||[],o=this.loaderRunningList.get(r.mediaType)||[];return o.length<this.maxLoaderRunning&&0===n.length?(o.push(r),this.loaderRunningList.set(r.mediaType,o),r.emit(Je.a.START)):(n.push(r),this.loaderWaitingList.set(r.mediaType,n)),r},e.prototype.filterList=function(){var e=this;this.loaderRunningList.fo((function(e){return!e.isDeter((function(e){return!e.isDestroy&&!e.isAbort})),e.loaderWaitingList.set(r,t)}))},e.prototype.setRequest=function(e){var t=this;if(this.filterList(),e){var r=this.loaderRunningList.get(e)||[],i=this.loaderWaitingLi0){var n=i.shift();r.push(n),this.loaderRunningList.set(e,r),this.loaderWaitingList.set(e,i),n.emit(Je.a.START)}}else this.loaderWaitingList.forEach((function(e,r){t.setRequest(r)}))},e.prototype.cancelProxy=function(){this.loaderConfig.proxy&&(this.loaderConfig.proxyOn=!1,this.loaderConfig.proxy.cancelProxy())},e.prototype.addProxy=function(e){e&&(this.loaderConfig.proxy=e),this.loaderConfig.proxyOn=!0,this.loaderConfig.proxy.addProxy()},e.prototype.destroy=function(){this.loaderRunningList&&this.loaderRunningList.forEach((function(e){e.forEach((function(e){return e.destroy()}))})),this.loaderWaitingList=new Map,this.loaderRunningList=new Map,this.segmentsByteLength=0},e}(),ct=function(){function e(){}return e.prototype.request=function(e,t){var r=this;if("function"==typeof t.requestFilter){var i=t.requestFilter(e,t);e=i.uri,t=i.options}this.retryDelay=t.retryDelay;var n=new XMLHttpRequest,o=!!t.sync;return new Promise((function(i,a){for(var s in n.open(t.method||"GET",e,!o),t.responseType&&(n.responseType=t.responseType),t.timeout&&(n.timeout=t.timeout),o||(n.withCredentials=!!t.withCredentials),t.timeout>0&&(n.timeout=t.timeout),n.onabort=function(e){},n.onload=function(){var o=n.status;if(o>=200&&o<=299&&202!=o){var s=void 0;n.response?s=n.response:n.responseText?s=n.responseText:"document"===n.responseType&&(s=n.responseXML);var u={body:s,statusCode:o,url:e,responseURL:n.response&&n.responseURL};t.responseFilter&&(u=t.responseFilter(u)),i(u.body)}else r.retry>=t.maxRetry||o>=400&&o<499?a(new Error("request failed")):(window.clearTimeout(r.retryTimeout),r.retryTimeout=window.setTimeout((function(){r.request(e,t)}),r.retryDelay),r.retryDelay=Math.min(2*r.retryDelay,t.maxRetryDelay),r.retry++)},n.onerror=function(e){a(e)},n.ontimeout=function(){},t.headers)if(t.headers.hasOwnProperty(s)){var u="Authorization"===s?s:s.toLowerCase();n.setRequestHeader(u,t.headers[s])}n.send(t.body||null)}))},e}(),lt=[{name:"YoukuHD",reg:/(youku_hd|youkuhd)\/([\d.]+)/i},{name:"YoukuHD",reg:/(youku_hd|youkuhd);/i},{name:"Youku",reg:/(youku|youku_hd|youkuhd)\/([\d.]+)/i},{name:"Wechat",reg:/(micromessenger)\/([\d.]+)/i},{name:"QQ",reg:/(qq)\/([\d.]+)/i},{name:"Weibo",reg:/(weibo).*weibo__([\d.]+)/i},{name:"QZone",reg:/(qzone)\/.*_qz_([\d.]+)/i},{name:"Baidu",reg:/(baiduboxapp)\/([\d.]+)/i},{name:"DingDing",reg:/(aliapp\(dingtalk)\/([\d.]+)/i},{name:"Taobao",reg:/(aliapp\(tb)\/([\d.]+)/i},{name:"Alipay",reg:/(alipayclient|aliapp\(AP)\/([\d.]+)/i},{name:"AliTrip",reg:/(alitrip|aliapp\(lx)\/([\d.]+)/i},{name:"UC",reg:/(ucbrowser)\/([\d.]+)/i},{name:"WindVane",reg:/(windvane)\/([\d.]+)/i},{name:"Liebao",reg:/(liebao[^/]*)\/([\d.]+)/i},{name:"360",reg:/(qihoobrowser)\/([\d.]+)/i},{name:"360SoSuo",reg:/(mso_app)\s*\(([\d.]+)/i},{name:"QQLive",reg:/(qqlivebrowser)\/([\d.]+)/i},{name:"QQBrowser",reg:/(qqbrowser)\/([\d.]+)/i},{name:"Iqiyi",reg:/(iqiyiversion)\/([\d.]+)/i},{name:"BaiduBrowser",reg:/(baidubrowser)\/([\d.]+)/i},{name:"Sogou",reg:/(sogou[\w]*browser)\/([\d.]+)/i},{name:"Edge",reg:/(edge)\/([\d.]+)/i},{name:"Opera",reg:/(opr)\/([\d.]+)/i,skipIfMatched:!0},{name:"Chrome",reg:/(chrome)\/([\d.]+)/i,skipIfMatched:!0},{name:"Chrome",reg:/(crios)\/([\d.]+)/i,skipIfMatched:!0},{name:"IEMobile",reg:/(iemobile)[/]([\d.]+)/i,skipIfMatched:!0},{name:"Firefox",reg:/(firefox)\/([\d.]+)/i,skipIfMatched:!0},{name:"Opera",reg:/(opera)(?:.*version|)[ /]([\d.]+)/i,skipIfMatched:!0},{name:"Safari",reg:/(version)(applewebkit)[/]([\d.]+).*(safari)[/]([\d.]+)/i,skipIfMatched:!0},{name:"Safari",reg:/(webkit)[ /]([\d.]+).*(version)[/]([\d.]+).*(safari)[/]([\d.]+)/i,skipIfMatched:!0},{name:"IE",reg:/(msie) ([\d.]+)/i},{name:"IE",reg:/trident.*(rv)(?::| )([\d.]+)/i}],pt=[{name:"IPad",reg:/(ipad|iphone.*youku_hd\/[\d.]+)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"IPad",reg:/(ipad|iphone.*youku_hd)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"IPod",reg:/(ipod)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"WindowsPhone",reg:/(windows phone)/i,mobile:!0,breakIfMatched:!0},{name:"IPhone",reg:/(iphone)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"Android",reg:/(android)/i,mobile:!0,breakIfMatched:!0},{name:"Windows",reg:/(win)/i,desktop:!0,breakIfMatched:!0},{name:"Mac",reg:/(mac)/i,desktop:!0,breakIfMatched:!0},{name:"Linux",reg:/(linux)/i,desktop:!0,breakIfMatched:!0}];function dt(e,t){for(var r=[],i=0;i<e.length;i++)if(!r.length||!e[i].skipIfMatched){var n=e[i].reg.exec(t);if(n&&r.push({map:e[i],match:n}),r.length&&e[i].breakIfMatched)break}return r}var ht;ht=function(e){void 0===e&&(e="");var t={ext:{}};e||"object"!=typeof navigator||(e=navigator.userAgent||"");for(var r=dt(lt,e),i=0;i<r.length;i++){var n=r[i],o=n.match,a=n.map,s={browser:o[5]||o[3]||o[1]||"",version:o[4]||o[2]||"0"};if(s.browser){var u=a.name.toLowerCase();void 0===t.name?(t["is"+a.name]=!0,t.version=s.version,t.majorVersion=parseInt(s.version,10),t.name=u):(t["is"+a.name]=!0,t.ext[u]={version:s.version,majorVersion:parseInt(s.version,10)})}}var c=dt(pt,e)[0]||{match:[],map:{}},l=c.match,p=c.map;return l[0]&&(t["is"+p.name]=!0,t.platform=p.name.toLowerCase()),t.isMobile=p.mobile||!1,t.isDesktop=p.desktop||!1,t.isIOS=p.ios||!1,t}();var ft,mt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),yt=function(){return(yt=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(th_SUPPORT_DRM=0]="NOT_SUPPORT_DRM",e[e.REQUEST_KEY_SYSTEM_FAILED=1]="REQUEST_KEY_SYSTEM_FAILED",e[e.GENERATE_REQUEST_FAILED=2]="GENERATE_REQUEST_FAILED",e[e.LICENSE_REQUEST_FAILED=3]="LICENSE_REQUEST_FAILED",e[e.UPDATE_SESSION_FAILED=4]="UPDATE_SESSION_FAILED",e[e.SET_MEDIA_KEY_FAILED=5]="SET_MEDIA_KEY_FAILED",e[e.CDM_DECRYPT_ERROR=6]="CDM_DECRYPT_ERROR"}(ft||(ft={}));var gt,vt={timeout:1e4,maxRetry:2,retryDelay:1e3,maxRetryDelay:64e3,responseType:"arraybuffer",method:"POST",url:"",body:null},bt=U.registerError("DRM","WDV",ft),Et={getLicenseParams:function(e){return{url:"",body:e}},getKeySession:function(e){return e}},_t={drmSystemOptions:{audioRobustness:"SW_SECURE_CRYPTO",videoRobustness:"SW_SECURE_CRYPTO"}},Rt=function(e){function t(t){var r=e.call(this)||this;return r.mediaKeysPromise=null,r.media=null,r.hasSetMediaKeys=!1,r.onKeySessionMessage=function(e){var t=e.target,i=e.message,n=/Tesla\//.test(navigator.userAgent)&&0==r.compareVersion(ht.version,"110.0.5481.177"),o=ht.isChrome&&0===r.compareVersion(ht.version,"113");if(n||o)try{(new TextDecoder).decode(i).includes("4.10.2652.0")&&r.emit(L.DRMAgentEvent.ERROR,bt.of(ft.CDM_DECRYPT_ERROR,U.Severity.FATAL))}catch(e){}r.requestLicense(i).then((function(e){return r.licenseServerConfig.getKeySession(e)})).then((function(e){t.update(e).catch((function(e){r.emit(L.DRMAgentEvent.ERROR,bt.of(ft.UPDATE_SESSION_FAILED,U.Severity.FATAL))}))})).catch((function(e){r.emit(L.DRMAgentEvent.ERROR,bt.of(ft.LICENSE_REQUEST_FAILED,U.Severity.FATAL,e.message))}))},r.oerateRequest(e.initDataType,e.initData))};r.hasSetMediaKeys?t():r.mediaKeysPromise.then(t).catch(t)}},r.config=yt(yt({},_t),t),r.licenseServerConfig=yt(yt({},Et),t.licenseServer),r.loader=new ct,r}return mt(t,e),t.prototype.getMediaKeySystemConfigurations=function(e,t,r){var i={audioCapabilities:[],videoCapabilities:[]};return e.forEach((function(e){i.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:r.audioRobustness||""})})),t.forEach((function(e){i.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:r.videoRobustness||""})})),[i]},t.prototype.attemptKeySystemAccess=function(e){var t,r=this,i=gt.WIDEVINE;"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?t=window.navigator.requestMediaKeySystemAcce '),this.emit(L.DRMAgentEvent.ERROR,bt.of(ft.NOT_SUPPORT_DRM,U.Severity.FATAL))),t&&(this.mediaKeysPromise=t.then((function(e){return r.onMediaKeySysAccess(e)})),t.catch((function(e){console.error('Failed to obtain key-system "'+i+'" access:',e),r.emit(L.DRMAgentEvent.ERROR,bt.of(ft.REQUEST_KEY_SYSTEM_FAILED,U.Severity.FATAL))})))},t.prototype.onMediaKeySysAccess=function(e){var t=this,r={sessionInitialed:!1,mediaKeySystemAccess:e};this.mediaKey=r;var i=Promise.resolve().)})).then((function(e){return r.mediaKeys=e,t.onMediaKeysCreated(),e}));return i.catch((function(e){console.error("Failed to create media-keys:",e),t.emit(L.DRMAgentEvent.ERROR,bt.of(ft.SET_MEDIA_KEY_FAILED,U.Severity.FATAL))})),i},t.prototype.onMediaKeysCreated=function(){var e=this,t=this.mediaKey.mediaKeys.createSession();t.addEventListener("message",this.onKeySessionMessage),this.mediaKey.mediaKeysSession?(this.mediaKey.mediaKeysSession.removeEventListener("message",this.onKeySessionMessage),this.mediaKey.mediaKeysSession.close().then((function(){e.mediaKey.mediaKeysSession=t})).catch((function(t){e.emit(L.DRMAgentEvent.ERROR,bt.of(ft.UPDATE_SESSION_FAILED,U.Severity.FATAL))}))):this.mediaKey.mediaKeysSession=t},t.prototype.compareVersion=function(e,t){e=String(e).split("."),t=String(t).split(".");try{for(var r=0,i=Math.max(e.length,t.length);r<i;r++){var n=isFinite(e[r])&&Number(e[r])||0,o=isFinite(t[r])&&Number(t[r])||0;if(n<o)return-1;if(n>o)return 1}}catch(e){return-1}return 0},t.prototype.attemptSetMediaKeys=function(){if(!this.media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this.hasSetMediaKeys){if(!this.mediaKey||!this.mediaKey.mediaKeys)return console.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.emit(L.DRMAgentEvent.ERROR,bt.of(ft.SET_MEDIA_KEY_FAILED,U.Severity.FATAL));this.media.setMediaKeys(this.mediaKey.mediaKeys),this.hasSetMediaKeys=!0}},t.prototype.generateRequest=function(e,t){var r=this;if(!this.mediaKey)return console.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.emit(L.DRMAgentEvent.ERROR,bt.of(ft.SET_MEDIA_KEY_FAILED,U.Severity.FATAL));if(this.mediaKey.sessionInitialed)console.warn("Key-Session already initialized but requested again");else{var i=this.mediaKey.mediaKeysSession;if(!i)return console.error("Fatal: Media is encrypted but no key-session existing"),void this.emit(L.DRMAgentEvent.ERROR,bt.of(ft.UPDATE_SESSION_FAILED,U.Severity.FATAL));if(!t)return console.warn("Fatal: initData required for generating a key session is null"),void this.emit(L.DRMAgentEvent.ERROR,bt.of(ft.UPDATE_SESSION_FAILED,U.Severity.FATAL));this.mediaKey.sessionInitialed=!0,i.generateRequest(e,t).then((function(){})).catch((function(e){r.emit(L.DRMAgentEvent.ERROR,bt.of(ft.GENERATE_REQUEST_FAILED,U.Severity.FATAL))}))}},t.prototype.requestLicense=function(e){if(!this.mediaKey)return this.emit(L.DRMAgentEvent.ERROR,bt.of(ft.SET_MEDIA_KEY_FAILED,U.Severity.FATAL)),Promise.reject(null);try{var t=this.licenseServerConfig.getLicenseParams(e);return(t=Object.assign({},vt,t)).url?this.loader.request(t.url,t):(console.error("Failure requesting DRM license: URL null"),Promise.reject(null))}catch(e){return console.error("Failure requesting DRM license: "+e),Promise.reject(null)}},t.prototype.setConfig=function(e){this.config=yt(yt({},this.config),e),this.licenseServerConfig=yt(yt({},this.licenseServerConfig),e.licenseServer)},t.prototype.init=function(e){this.media=e,this.media.addEventListener("encrypted",this.onMediaEncrypted)},t.prototype.reset=function(){},t.prototype.start=function(e,t,r){if(this.sessionCreated=!1,this.mediaKey)return this.mediaKey.sessionInitialed=!1,void this.onMediaKeysCreated();var i=this.config.drmSystemOptions,n=this.getMediaKeySystemConfigurations(e,t,i);this.attemptKeySystemAccess(n)},t.prototype.destroy=function(){var e=this,t=this.media;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),this.mediaKey&&this.mediaKey.mediaKeysSession&&this.mediaKey.mediaKeysSession.close().then((function(){e.media.setMediaKeys(null)})).catch((function(e){console.log(e.message)})),this.mediaKey=null,this.loader=null)},t}(L.EventBus);!function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(gt||(gt={}));var St,At,Tt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),wt=function(){return(wt=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments.fps.1_0"}(St||(St={})),function(e){e[e.NOT_SUPPORT_DRM=0]="NOT_SUPPORT_DRM",e[e.REQUEST_KEY_SYSTEM_FAILED=1]="REQUEST_KEY_SYSTEM_FAILED",e[e.GENERATE_REQUEST_FAILED=2]="GENERATE_REQUEST_FAILED",e[e.LICENSE_REQUEST_FAILED=3]="LICENSE_REQUEST_FAILED",e[e.UPDATE_SESSION_FAILED=4]="UPDATE_SESSION_FAILED",e[e.SET_MEDIA_KEY_FAILED=5]="SET_MEDIA_KEY_FAILED"}(At||(At={}));var Lt,Ot=U.registerError("DRM","FRP",At),xt={timeout:1e4,maxRetry:2,retryDelay:1e3,maxRetryDelay:64e3,responseType:"arraybuffer",method:"POST",url:"",body:null},Pt={getLicenseParams:function(e,t){return{url:"",body:e}},getKeySession:function(e){return e}},Dt=function(e){function t(t){var r=e.call(this)||this;return r.media=null,r.onMediaKeysCreated=function(e){var t=St.FAIRPLAY;"undefined"!=typeof window&&window.WebKitMediaKeys&&WebKitMediaKeys.isTypeSupported(t,"video/mp4")?r.onRequest(new Uint8Array([8,4]).buffer,!1).then((function(e){return r.licenseServerConfig.getKeySession(e)})).then((function(t){r.onMediaKeySysAccess(t,e.initData)})).catch((function(e){r.emit(L.DRMAgentEvent.ERROR,Ot.of(At.REQUEST_KEY_SYSTEM_FAILED,U.Severity.FATAL))})):(r.emit(L.DRMAgentEvent.ERROR,Ot.of(At.NOT_SUPPORT_DRM,U.Severity.FATAL)),consolr t=e.target,i=e})).catch((function(e){r.emit(L.DRMAgentEvent.ERROR,Ot.of(At.LICENSE_REQUEST_FAILED,U.Severity.FATAL))}))},r.onKeyAdded=function(){},r.onKeyError=function(){r.emit(L.DRMAgentEvent.ERROR,Ot.of(At.UPDATE_SESSION_FAILED,U.Severity.FATAL))},r.inited=!1,r.config=t,r.licenseServerConfig=wt(wt({},Pt),t.licenseServer),r.loader=new ct,r}return Tt(t,e),t.arrayToString=function(e){var t=new Uint16Array(e.buffer);return String.fromCharCode.apply(null,t)},t.stringToArray=function(e){for(var t=new ArrayBuffer(2*e.length),r=new Uint16Array(t),i=0,n=e.length;i<n;i++)r[i]=e.charCodeAt(i);return r},t.prototype.onMediaKeySysAccess=function(e,t){var r=this.extractContentId(t);if(t=this.concatInitDataIdAndCertificate(t,r,e),this.mediaKey)this.onSessionConnect(t);else{var i={mediaKeysSessionInitialed:!1};this.mediaKey=i,i.mediaKeys=new WebKitMediaKeys(St.FAIRPLAY),this.media.webkitSetMediaKeys(this.mediaKey.mediaKeys),this.onSessionConnect(t)}},t.prototype.onSessionConnect=function(e){var t=this.mediaKey.mediaKeys.createSession("video/mp4",e);t?(t.addEventListener("webkitkeymessage",this.onKeySessionMessage),t.addEventListener("webkitkeyadded",this.onKeyAdded),t.addEventListener("webkitkeyerror",this.onKeyError)):this.emit(L.DRMAgentEvent.ERROR,Ot.of(At.SET_MEDIA_KEY_FAILED,U.Severity.FATAL))},t.prototype.extractContentId=function(e){var r=t.arrayToString(e.slice(4,e.length)),i=document.createElement("a");return i.href=r,i.hostname},t.prototype.concatInitDataIdAndCertificate=function(e,r,i){if("string"==typeof r){var n=t.stringToArray(r),o=0,a=new ArrayBuffer(e.byteLength+4+n.byteLength+4+i.byteLength),s=new DataView(a);new Uint8Array(a,o,e.byteLength).set(e),o+=e.byteLength,s.setUint32(o,n.byteLength,!0),o+=4;var u=new Uint16Array(a,o,n.length);return u.set(n),o+=u.byteLength,s.setUint32(o,i.byteLength,!0),o+=4,new Uint8Array(a,o,i.byteLength).set(i),new Uint8Array(a,0,a.byteLength)}},t.prototype.requestLicense=function(e){return this.mediaKey?this.onRequest(e,!0):(console.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.emit(L.Dototype.onRequest=function(e,t){try{var r=this.licenseServerConfig.getLicenseParams(e,t);return(r=Object.assign({},xt,r)).url?this.loader.request(r.url,r):(console.error("Failure requesting DRM license: URL null"),Promise.reject(null))}catch(e){return console.error("Failure requesting DRM license: "+e),Promise.reject(null)}},t.prototype.setConfig=function(e){this.config=wt(wt({},this.config),e),this.licenseServerConfig=wt(wt({},this.licenseServerConfig),e.licenseServer)},t.prototype.init=function(e){this.media=e,this.media.addEventListener("webkitneedkey",this.onMediaKeysCreated)},t.prototype.reset=function(){},t.prototype.start=function(e,t,r){this.inited||(this.inited=!0)},t.prototype.destroy=function(){var e=this.media;e&&(e.removeEventListener("webkitneedkey",this.onMediaKeysCreated),this.mediaKey&&this.mediaKey.mediaKeysSession&&this.mediaKey.mediaKeysSession.close(),this.mediaKey=null,this.loader=null)},t}(L.EventBus),kt=function(){function e(e,t){this.ID="DRMController",this.media=t,this.drmAgentEvents=[],this.init(e)}return e.prototype.setConfig=function(e){this.init(e)},e.prototype.init=function(e){if(e){switch(this.agent&&(this.config&&thdType.WIDEVINE||(this.agent.destroy(),this.agent=null)),this.config=e,e.type){case L.EncryptMethodType.CUSTOMIZED:e.agent&&(this.agent=e.agent,this.transmuxer&&this.agent.init(this.transmuxer));break;case L.EncryptMethodType.WIDEVINE:this.agent?this.agent.setConfig(e):(this.agent=new Rt(e),this.agent.init(this.media));break;case L.EncryptMethodType.FAIRPLAY:this.agent=new Dt(e),this.agent.init(this.media)}this.addEvent()}},e.prototype.addEvent=function(){var e=this;this.agent&&this.drmAgentEvents.length>0&&this.drmAgentEvents.forEach((function(t){var r=t[0],i=t[1];e.agent.on(r,i)}))},e.prototype.reset=function(){},e.prototype.on=function(e,t){return this.drmAgentEvents.push([e,t]),this.agent&&this.agent.on(e,t),this},e.prototype.once=function(e,t){return this.drmAgentEvents.push([es},e.prototype.off=function(e,t){return e?(this.drmAgentEvents=this.drmAgentEvents.filter((function(r){var i=r[0],n=r[1];return i!==e||n!==t})),this.agent&&this.agent.off(e,t)):(this.drmAgentEvents=[){var o=this;n&&(this.transmuxer=n),e?e.on(L.ManifestEvent.READY,(function(){var t=e.getAllTrack(),r=t.filter((function(e){return e.type===L.MediaType.AUDIO})).map((function(e){return e.current.codec.mime})),i=t.filter((function(e){return e.type===L.MediaType.VIDEO})).map((function(e){return e.current.codec.mime}));o.agent&&o.agent.start(r,i)})):this.agent&&(this.agent.start(ncryptMethodType.CUSTOMIZED&&thype.update=function(e,t,r,i){},e.prototype.destroy=function(){this.off(),this.agent&&(this.agent.destroy(),this.agent=null)},e}(),It={liveSyncDurationCount:3,liveMaxLatencyDurationCount:1.5,playbackRate:1.2,chaseFrameEnabled:!0,pauseChaseFrameEnabled:!1},Mt=function(){function e(e,t){var r=this;this.isWaiting=!1,this.adjustTargetLatency=function(){r.isWaiting=!0,r.playFluentlyTimer&&(clearTimeout(r.playFluentlyTimer),r.playFluentlyTimer=n|(r.stallTimer=window.setTimeout((function(){r.stallCount++}),250))},this.timeupdateHandler=function(){r.isWaiting=!1},this.pauseHandler=function(){!r.config.pauseChaseFrameEnabled&&r.timer&&(clearInterval(r.timer),r.timer=null)},this.playHandler=function(){r.timer&&clearInterval(r.timer),r.timer=window.setInterval((function(){r.timerHandler()}),500)},this.timerHandler=function(){var e=r,t=e.mediaEngine,i=e.trackLevel;if(t&&i&&i.live){r.stallTimer&&(clearTimeout(r.stallTimer),r.stallTimer=null),r.playFluentlyTimer||(r.playFluentlyTimer=window.setTimeout((function(){r.stallCount=0}),6e4));var n=r.expectLatency();if(null!==n){var o=r.currentLatency();if(null!==o){var a=o-n,s=r.maxLatency(),u=Math.min(s,n+(r.trackLevel.targetDuration||0)),c=r.mediaEngine.bufferLength?r.mediaEngine.bufferLength:r.trackLevelEdge-r.mediaEngine.currentTime;if(z.trace(r.ID,"latency,distanceTime,targetLatency,liveMinLatencyDuration,forwardBufferLength: "+o+", "+a+", "+n+", "+u+", "+c+", "+t.playbackRate),r.config.chaseFrameEnabled){var l=void 0,p=void 0;if(t.duration===1/0&&t.buffered&&t.buffered.Last?(l=t.buffered.Last[1],p=t.buffered.Last[0]):l=t.duration,p>t.currentTime&&r.isWaiting)z.trace(r.ID,"Latency buffered discontinuity currentTime "+t.currentTime+",seekTo "+p+",duration "+l),t.currentTime=p;else if(a<u&&a>.05&&c>n/2)t.playbackRate=r.config.playbackRate;else{1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1);var d=t.currentTime+a+.1;r.trackLevelEdge==1/0&&a>u/2&&t.duration>d&&(t.currentTime=d)}}else if(!r.config.chaseFrameEnabled&&r.liveSyncPosition){!(r.mediaEngine.currentTime>=r.trackLevelStart-i.targetDuration&&r.mediaEngine.currentTime<r.trackLevelEdge)&&r.mediaEngine.bufferLength<1&&(r.mediaEngine.currentTime=r.liveSyncPosition)}}}}},this.ID="LatencyController",this.init(e),this.firstSegmentFind=!1,this.lowLatencyMode=!1,this.stallCount=0}return e.prototype.setConfig=function(e){this.init(e)},e.prototype.init=function(e){e&&(this.config=Object.assign({},It,e))},e.prototype.getEstimateLiveEdge=function(){if(null===this.trackLevel)return null;var e=0;return this.trackLevelEdge===Number.POSITIVE_INFINITY?this.mediaEngine.buffered&&this.mediaEngine.buffered.Last?this.mediaEngine.buffered.Last[1]:null:(this.manifest&&this.manifest.advancedDateTime&&(e=Math.max(Date.now()-this.manifest.advancedDateTime,0)/1e3),this.trackLevelEdge+e)},e.prototype.currentLatency=function(){var e=this.getEstimateLiveEdge();return null===e?null:e-this.mediaEngine.currentTime},e.prototype.expectLatency=function(){if(!this.trackLevel)return null;var e,t,r=this.trackLevel.targetDuration;this.trackLevel.info&&(e=this.trackLevel.info.partHoldBack,t=this.trackLevel.info.holdBack);var i=this.config,n=i.liveSyncDuration,o=i.liveSyncDurationCount,a=e||t||2;return void 0!==n?a=n:null!=e||!o&&0!=a||o&&r&&(a=o*r),r?a+Math.min(this.stallCount,r):a},e.prototype.maxLatency=function(){var e=this.config,t=this.trackLevel;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t&&e.liveMaxLatencyDurationCount&&t.targetDuration?e.liveMaxLatencyDurationCount*t.targetDuration:10},e.prototype.on=function(e,t){return this},e.prototype.once=function(e,t){return this},e.prototype.off=function(e,t){return this},e.prototype.setup=function(e,t,r,i){var n=this;this.mediaEngine=t,this.manifest=e,this.loader=r,this.lowLatencyMode=e.lowLatencyMode,t.on(L.PlayerEvent.TIME_UPDATE,this.timeupdateHandler),t.on(L.PlayerEvent.WAITING,this.adjustTargetLatency),t.on(L.PlayerEvent.PAUSE,this.pauseHandler),t.on(L.PlayerEvent.PLAY,this.playHandler),e.on(L.ManifestEvent.READY,(function(){var t=e.getAllTrack().filter((function(e){return e.type===L.MediaType.MIXED||e.type===L.MediaType.VIDEO}))[0];t&&(t.current&&t.current.segmentList.length>0&&n.onSegmentUpdate(t),t.on(L.TrackEvent.SEGMENT_UPDATE,(function(){n.onSegmentUpdate(t)})))}))},Object.defineProperty(e.prototype,"liveSyncPosition",{get:function(){var e=this.getEstimateLiveEdge(),t=this.expectLatency();if(null===e||null==t)return null;var r=e-t-this.stalledTime,i=this.trackLevelEdge-(this.trackLevel.partTargetDuration||this.trackLevel.targetDuration),n=Math.min(i,Math.max(0,r));return this.lowLatencyMode?this.closetIndependentPosition(n):n},enumerable:!1,configurable:!0}),e.prototype.closetIndependentPosition=function(e){var t=this.trackLevel.segmentList;return(t=t.filter((function(t){return 1==t.independent&&t.start<=e}))).length>0&&t[t.length-1].start},Object.defineProperty(e.prototype,"stalledTime",{get:function(){if(!this.manifest.advancedDateTime)return 0;var e=(this.lowLatencyMode&&this.trackLevel.partTargetDuration?this.trackLevel.partTargetDuration:this.trackLevel.targetDuration)*this.config.liveSyncDurationCount,t=Math.max(Date.now()-this.manifest.advancedDateTime,0)/1e3;return Math.max(t-e,0)},enumerable:!1,configurable:!0}),e.prototype.onSegmentUpdate=function(e){if(this.trackLevel=e.current,!this.trackLevel.live||!this.mediaEngine)return this.eventOff(),void this.clearTimer();var t=this.trackLevel.segmentList.filter((function(e){return!e.preload}));this.trackLevelEdge=t.length>0&&t[t.length-1].end,this.trackLevelStart=t.length>0&&t[0].start;var r=this.liveSyncPosition;this.trackLevel&&this.trackLevel.segmentList.length>0&&!this.firstSegmentFind&&null!=r&&(this.firstSegmentFind=!0,z.trace(this.ID,""+r+"edge"+this.trackLevelEdge),this.mediaEngine.currentTime=this.liveSyncPosition);var i=this.maxLatency();r=this.liveSyncPosition;var n=this.mediaEngine.currentTime>=this.trackLevelStart-this.trackLevel.targetDuration&&this.mediaEngine.currentTime<this.trackLevelEdge;this.config.chaseFrameEnabled&&null!=r&&this.mediaEngine.currentTime<r&&!this.mediaEngine.paused&&(this.mediaEngine.bufferLength>3*(this.trackLevel.partTargetDuration||this.trackLevel.targetDuration)&&this.mediaEngine.currentTime<r-i||!n&&this.mediaEngine.mediaState<4)&&(z.trace(this.ItrackLevelEdge+", seek to "+r+","+i+","+this.mediaEngine.mediaState+","+!n),this.mediaEngine.currentTime=r)},e.prototype.update=function(e,t,r,i){},e.prototype.eventOff=function(){this.mediaEngine&&this.mediaEngine.off(L.PlayerEvent.TIME_UPDATE,this.timeupdateHandler),this.mediaEngine&&this.mediaEngine.off(L.PlayerEvent.WAITING,this.adjustTargetLatency),this.mediaEngine&&this.mediaEngine.off(L.PlayerEvent.PAUSE,this.pauseHandler),this.mediaEngine&&this.mediaEngine.off(L.PlayerEvent.PLAY,this.playHandler)},e.prototype.reset=function(){this.firstSegmentFind=!1,this.stallCount=0,this.clearTimer()},e.prototype.clearTimer=function(){this.stallTimer&&(clearTimeout(this.stallTimer),this.stallTimer=null),this.playFlentlyTimer=null),this.timer&&(clearInterval(this.timer),this.timer=null)},e.prototype.destroy=function(){this.eventOff(),this.off(),this.reset(),this.trackLevel=null,this.config=null,delete this.manifest,delete this.mediaEngine,delete this.loader},e}();!function(e){e.RIGHT="right",d"}(Lt||(Lt={}));var Ct=function(){function e(e){var t=this;this.ID="BufferRemoveController",this.config=e||{},this.bufferChangedEvent=function(e){t.timer||e!==L.MediaType.MIXED&&e!==L.MediaType.VIDEO||(t.timer=window.setTimeout((function(){t.cleanBuffer(),clearTimeout(t.timer),t.timer=null}),500))},this.bufferFullEvent=function(e){t.cleanBuffer()}}return e.prototype.reset=function(){},e.prototype.setConfig=function(e){e&&(this.config=Object.assign({},this.config,e))},e.prototype.on=function(e,t){return this},e.prototype.once=function(e,t){return this},e.prototype.off=function(e,t){return this},e.prototype.update=function(e,t,r,i){var n=this;i&&(this.timelineList=i,this.timelineList.forEach((function(e){e.on(Ie.REMOVE_CHUNK,n.cleanChunkBuffer.bind(n))})))},e.prototype.setup=function(e,t,r,i){this.mediaEngine=t,this.timelineList=i,this.manifest=e,t.on(L.PlayerEvent.BUFFER_CHANGE,this.bufferChangedEvent),t.on(L.MediaEngineEvent.BUFFER_FULL,this.bufferFullEvent)},e.prototype.destroy=function(){this.off(),this.timer&&(clearTimeout(this.timer),this.timer=null),this.mediaEngine&&this.mediaEngine.off(L.PlayerEvent.BUFFER_CHANGE,this.bufferChangedEvent),this.mediaEngine&&this.mediaEngine.off(L.MediaEngineEvent.BUFFER_FULL,this.bufferFullEvent),delete this.mediaEngine,delete this.timelineList},e.prototype.cleanChunkBuffer=function(e){var t=this,r=[];[L.MediaType.VIDEO,L.MediaType.AUDIO].forEach((function(i){t.mediaEngine.getBuffered(i).length>0&&(t.isMixed?(L.MediaType.VIDEO,r.push({position:Lt.FIXED,type:i,start:e[0],end:e[1]})):(z.trace(t.ID,"Remove"+i+"Chunk Buffer",i,e[0]+"-"+e[1]),L.MediaType.VIDEO,t.mediaEngine.removeBuffer(i,e[0],e[1])))})),r.length>1&&this.removeMixedBuffer(r)},e.prototype.cleanBuffer=function(){var e=this,t=!1,r=[];[L.MediaType.VIDEO,L.MediaType.AUDIO].forEach((function(i){if(e.mediaEngine.getBuffered(i).length>0){var n=e.getLeftRemoveTime(i);n>0&&(e.isMixed?r.push({position:Lt.LEFT,type:i,start:0,end:n}):(z.trace(e.ID,"Remove"+i+"Buffer",i,"0-"+n),e.mediaEngine.removeBuffer(i,0,n),t=!0));var o=e.getRightRemoveTime(i);-1!==o&&(e.isMixed?r.push({position:Lt.RIGHT,type:i,start:o,end:Number.POSITIVE_INFINITY}):(z.trace(e.ID,"Remove"+i+"Buffer",i,o+"-Infinity"),e.mediaEngine.removeBuffer(i,o,Number.POSITIVE_INFINITY),t=!0))}}));var i=!1;if(this.isMixed&&1==r.length){var n=r[0].type==L.MediaType.VIDEO?L.MediaType.AUDIO:L.MediaType.VIDEO;0==this.mediaEngine.getBuffered(n).length&&(i=this.removeMixedBuffer(r))}else r.length>1&&(i=this.removeMixedBuffer(r));return t||i},e.prototype.getLeftRemoveTime=function(e){var t,r,i=-1,n=this.mediaEngine.currentTime;this.config&&(this.config.maxBackwardDuration&&(r=(t=this.config.maxBackwardDuration||30)/3),this.config.minBackwardDuration&&(r=this.config.minBackwardDuration,t||(t=3*r))),null==t&&this.manifest.isLive&&(r=(t=30)/3);var o=this.mediaEngine.getBuffered(e);if(0==o.length)return i;if(t){(s=Math.max(0,n-t))&&s>o.start(0)&&(i=n-r)}else{var a;a=this.config&&this.config.maxBufferLength/3||90,r||(r=a/3);var s=Math.max(0,n-a),u=this.getSegmentTime(n,e);s&&o.start(0)<u-1&&s>o.start(0)&&(i=this.getSegmentTime(n-r,e)-1)}return i},e.prototype.getRightRemoveTime=function(e){for(var t=-1,r=this.mediaEngine.getBuffered(e),i=this.mediaEngine.currentTime,n=this.config&&this.config.maxBufferLength||90,o=r.toGap(),a=0;a<o.length;a++)if(o.end(a)-o.start(a)>3&&i+n<o.end(a)){t=o.end(a);break}return t},e.prototype.removeMixedBuffer=function(e){var t=this,r=!1;return[Lt.LEFT,Lt.RIGHT,Lt.FIXED].forEach((function(i){var n=i===Lt.LEFT?"end":"start",o=e.filter((function(e){return e.position===i}));(1==o.length||o.length>1&&Math.abs(o[0][n]-o[1][n])<1)&&o.forEach((function(e){r=!0,z.trace(t.ID,"Remove"+e.type+"Buffer",e.start+"-"+e.end),t.mediaEngine.removeBuffer(e.type,e.start,e.end)}))})),r},Object.deneList.filter((function(e){return e.type===L.MediaType.MIXED}))[0]&&(e=!0),e},enumerable:!1,configurable:!0}),e.prototype.getSegmentTime=function(e,t){var r=this.timelineList.filter((function(e){return e.type===t}))[0];if(r||(r=this.timelineList.filter((function(e){return e.type===L.MediaType.MIXED}))[0]),r){var i=r.getSegmentAt(e);i&&(e=i.start)}return e},e}(),Nt=[n.a.ERROR,n.a.CANPLAY_THROUGH,n.a.LOAD_START,n.a.LOADED_SEGMENT,n.a.LEVEL_CHANGE,n.a.SEGMENT_UPDATE,n.a.LOADED_MANIFEST,n.a.APPENDED_SEGMENT],Ut=function(){function e(e,t){this.mediaEngine=e,this.mainController=t,this.eventsCache=[]}return e.prototype.changeMediaEngine=function(e){var t=this;this.mediaEngine=e,this.eventsCache.forEach((function(e){var r=e[0],i=e[1],n=e[2],o=e[3];t.mediaEngine[r](i,n,o)}))},e.prototype.changeMainController=function(e){var t=this;e?this.eventsCache.filter((function(e){e[0];var t=e[1];return Nt.indexOf(t)>=0})).forEach((function(e){var r=e[0],i=e[1],n=e[2],o=e[3];Nt.indexOf(i)<=2&&t.mediaEngine.off(i,n),t.mainController[r](i,n,o)})):this.eventsCache.filter((function(e){return Nt.indexOf(e[1])>=0&&Nt.indexOf(e[1])<=2})).forEach((function(e){var r=e[0],i=e[1],n=e[2],o=e[3];t.mediaEngine[r](i,n,o)}))},e.prototype.clear=function(){var e=this;this.eventsCache.forEach((function(t){t[0];var r=t[1],i=t[2];t[3];Nt.indexOf(r)>=0?e.mainController?e.mainController.off(r,i):Nt.indexOf(r)<=2&&e.mediaEngine.off(r,i):e.mediaEngine.off(r,i)}))},e.prototype.hangUp=function(){this.clear()},e.prototype.resume=function(){var e=this;this.eventsCache.forEach((function(t){var r=t[0],i=t[1],n=t[2],o=t[3];Nt.indexOf(i)>=0?e.mainController?e.mainC):e.mediaEngine[r](i,n,o)}))},e.prototype.destroy=function(){},e.prototype.routeEventAction=funiaEngine.off(),this.eventsCache=[],void(this.mainController&&this.mainController.off());this.mainController&&Nt.indexOf(t)>=0?this.mainController[e](t,r,i):Nt.indexOf(t)<=2&&this.mediaEngine[e](t,r,i),"on"===e?this.eventsCache.push([e,t,r,i]):"off"===e&&(this.eventsCache=this.eventsCache.filter((function(i){var n=i[0],o=i[1],a=i[2];return e!==n||o!==t||a!==r})))},e.prototype.off=function(e,t){return this.routeEventAction("off",e,t),this},e.prototype.on=function(e,t,r){return this.routeEventAction("on",e,t,r),this},e.prototype.once=function(e,t,r){return this.routeEventAction("once",e,t,r),this},e}(),Bt=function(){return(Bt=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Ft=function(){function e(e){this.config=e;var t=this.config.engine;if(this.mediaEngine=new t(this.config.attached,this.config.engineConfig),this.config.manifest){var r=this.config.manifest;this.manifest=new r(this.getManifestConfig(e));var i=this.manifest.defaultConfig||null;this.config=function e(t,r){var i=t;if("object"!=typeof t||"object"!=typeof r)return null==t?r:t;for(var n in r)t.hasOwnProperty(n)?i[n]=e(t[n],r[n]):i[n]=r[n];return i}(this.config,i),this.manifest.lowLatencyMode&&(e.loader.config.maxConcurrentNum=1,e.loader.config.chunkEnabled=!1),this.loader=e.loader&&e.loader.instance||new ut("SEGMENT",Bt({requestFilter:e.filters&&e.filters.requestFilter,responseFilter:e.filters&&e.filters.responseFilter,retryFilter:e.filters&&e.filters.retryFilter,proxy:e.proxy},e.loader&&e.loader.config)),this.mainController=new Xe(this.manifest,this.mediaEngine,this.loader,this.config),this.setupController(e)}this.setDRMConfig(e),this.session=new Ut(this.mediaEngine,this.mainController),this.sessionStack=[]}return e.prototype.resetController=function(){this.latencyController&&this.latencyController.reset()},e.prototype.setupController=function(e){var t=e.attached||this.config.attached;if(e.abr){var r="object"==typeof e.abr?e.abr:null;r&&this.config.timeline.maxBufferLength&&(r.maxBufferLength=this.config.timeline.maxBufferLength),this.abrController||(this.abrController=new ee(t,r),this.mainController.setupChildController(this.abrController))}else this.abrController&&(this.mainController.unloadChildController(this.abrController),this.abrController=null);if(e.drm&&e.drm.type!==L.EncryptMethodType.NONE?(this.drmController?this.drmController.setConfig(e.drm):(this.drmController=new kt(e.drm,e.attached),this.mainController.setupChildController(this.drmController)),this.mainController.setDrmType(e.drm.type)):this.drmController&&(this.mainController.unloadChildController(this.drmController),this.drmController=null,this.mainController.setDrmType(L.EncryptMethodType.NONE)),e.latency||(e.latency={}),this.latencyController||(this.latencyController=new Mt(e.latency,t),this.mainController.setupChildController(this.latencyController)),!this.bufferRemoveController){var i=Bt({},e.bufferRemove);e.timeline&&e.timeline.maxBufferLength&&(i.maxBufferLength=e.timeline.maxBufferLength),this.bufferRemoveController=new Ct(i),this.mainController.setupChildController(this.bufferRemoveController)}},e.prototype.setLoader=function(e,t){},e.prototype.getLoader=function(){return this.loader},e.prototype.setDRMConfig=function(e){e.drm&&e.drm.type!==L.EncryptMethodType.NONE?this.drmController?this.drmController.setConfig(e.drm):(this.drmController=new kt(e.drm,this.config.attached),this.mainController?this.mainController.setupChildController(this.drmController):this.drmController.setup(null)):this.drmController&&(this.drmController.destroy(),this.drmController=null)},e.prototype.replaceRole=function(e,t,r){if(e[t]&&e[t]&&e[t]!==this.config[t])return new e[t](e[r||t+"Config"])},e.prototype.setConfig=function(e){if(e){var t=e.attached||this.config.attached;if(this.manifest){var r=this.getManifestConfig(e);this.manifest.setConfig(r)}var i=!1;if(e.manifest){var n=e.manifest;this.manifest&&this.manifest.destroy();var o=Object.assign({},this.config,e);this.manifest=new n(this.getManifestConfig(o)),this.mainController?this.mainController.replaceManifest(this.manifest):i=!0}else!1===e.manifest&&this.manifest&&(this.manifest.destroy(),delete this.manifest,this.mainController.destroy(),this.loader.destroy(),delete this.mainController,this.session.changeMainController(null));var a={};if(this.config.engineConfig&&(a=Bt({},this.config.engineConfig)),e.engine&&this.config.engine!==e.engine){var s=e.engine;this.mediaEngine.destroy();var u=new s(t,a=Object.assign(a,e.engineConfig));this.mainController&&this.mainController.replaceMediaEngine(u),this.mediaEngine=u,this.session.changeMediaEngine(this.mediaEngine)}else e.engineConfig&&(a=Object.assign(a,e.engineConfig),this.mediaEngine.setConfig(a));i&&(this.loader=this.config.loader&&this.config.loader.instance||new ut("SEGMENT",Bt({requestFilter:this.config.filters&&this.config.filters.requestFilter,responseFilter:this.config.filters&&this.config.filters.responseFilter,retryFilter:this.config.filters&&this.config.filters.retryFilter,proxy:this.config.proxy},this.config.loader&&this.config.loader.config)),this.mainController=new Xe(this.manifest,this.mediaEngine,this.loader,this.config),this.session.changeMainController(this.mainController)),this.loader&&e.loader&&e.loader.config&&this.loader.setConfig(e.loader.config),this.config=Object.assign(this.config,e),this.config.engineConfig=a,this.mainController&&(this.mainController.setConfig(this.config),this.setupController(this.config)),this.setDRMConfig(e)}},e.prototype.createSession=function(){return this.session.hangUp(),this.sessionStack.push(this.session),this.session.currentTime=this.currentTime,this.session.paused=this.paused,this.session.source=this.lastSource,this.session=new Ut(this.mediaEngine,this.mainController),this.session},e.prototype.closeSession=function(){this.sessionStack.length>0&&(this.session.destroy(),this.session=this.sessionStack.pop(),this.session.resume(),this.session.source&&(this.loadSource(this.session.source.source,this.session.source.sourceMeta),this.currentTime=this.session.currentTime),this.session.paused?this.pause():this.play())},e.prototype.loadSource=function(e,t){void 0===t&&(t={}),this.destroyed||(this.lastSource&&this.resetController(),this.lastSource={source:e,sourceMeta:t},this.manifest?this.mainController.loadSource(e):this.mediaEngine.appendMedia({data:e,duration:t.duration||0,encrypted:!!t.encrypted,end:t.duration||0,id:0,levelId:0,programId:0,start:0,type:L.MediaType.MIXED}))},Object.defineProperty(e.prototype,"id 0===e?void 0:e.getBufferInfo(this.currentTime);return t&&t.bufferLength||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this.mediaEngine&&this.mediaEngine.buff(e.prototype,"currentTime",{get:function(){return this.mediaEngine?this.mediaEngine.currentTime:0},set:function(e){isNaN(e)||this.mediaEngine&&(this.mediaEngine.currentTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.mediaEngine?this.mediaEngine.duration:NaN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return!!this.mediaEngine&&this.mediaEngine.ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this.mediaEngine&&this.mediaEngine.loop},set:function(e){this.mediaEngine&&(this.mediaEngine.loop=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return!!this.mediaEngine&&this.mediaEngine.muted},set:function(e){this.mediaEngine&&(this.mediaEngine.muted=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoplay",{get:function(){return!!this.mediaEngine&&this.mediaEngine.autoplay},set:function(e){this.mediaEngine&&(this.mediaEngine.aty(e.prototype,"paused",{get:function(){return!!this.mediaEngine&&this.mediaEngine.paused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this.mediaEngine?this.mediaEngine.playbackRate:1},set:function(e){this.mediaEngine&&(this.mediaEngine.playbackRate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pgineerty(e.prototype,"seeking",{get:function(){return!!this.mediaEngine&&this.mediaEngine.roperty(e.prototype,"videoHeight",{get:function(){return this.mediaEngine?this.mediaEngine.videoHeight:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoWidth",{get:function(){return this.mediaEngine?this.mediaEngine.videoWidth:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this.mediaEngine?this.mediaEngine.volume:1},set:function(e){this.mediaEngine&&(this.mediaEngine.volume=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"downloadMode",{get:function(){return this.loader&&this.loader.mode||null},enumerable:!1,configurable:!0}),e.prototype.getMixedLevels=function(e){var t=this.manifest&&this.manifest.getAllTrack().find((function(e){return e.type===L.MediaType.MIXED}));return t&&t.getAllTrackLevel(e)||[]},Object.defineProperty(e.prototype,"mixedLevels",{set:function(e){var t=this.manifest.getAllTrack().find((function(e){return e.type===L.MediaType.MIXED}));t&&t.setLevels(e)},enumerable:!1,configurable:!0}),e.prototype.getSummary=function(){if(this.mainController)return this.mainController.getSummary()},e.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.config.proxy&&(this.config.proxy.destroy(),delete this.config.proxy),this.mediaEngine.destroy(),this.mainController&&this.mainController.destroy(),delete this.mediaEngine,delete this.manifest,delete this.loader,delete this.mainController,this.config=null,delete this.abrController,delete this.drmController,delete this.latencyController,delete this.bufferRemoveController,this.sessionStack=[])},e.prototype.getVideoPlaediaEngine&&this.mediaEngine.gettype.getManifesturn e.abr&&(t.startLevel=ee.startAutoLevel),e.filters&&e.filters.trackLevelsFilter&&lters&&e.filters.retryFilter&&(t.retryFilter=e.filters.retryFilter),t},e.prototype.dump=function(e){console.info(this.mediaEngine.currentTime),e?console.log(this.mediaEngine.trackList.forEach((function(e){return e.buffered.dump(1)}))):this.mediaEngine.buffered.dums.on(e,t)},e.prototype.removeEventListener=function(e,t,r){this.off(e,t)},e.prototype.off=functiootype.once=function(e,t,r){return this.session.once(e,t,r),this},e.prototype.setInitPlayAutoLevel=function(){},e.prototype.setMaxAu.getP2PStatus=function(){()},e.prototype.play=function(){return this.mediaEngine&&this.mediaEngine.play()},e.prototype.seek=function(e){return this.mediaEngine&&this.mediaEngine.seek(e)},e.prototype.stop=function(){this.pause(),this.mainController&&this.mainController.stop(),this.mediaEngine&&this.mediaEngine.stop()},e.prototype.isSupportFeature=function(e){return this.mediaEngine&&this.mediaEngine.isSupportFeature(e)},e.prototype.requestFeature=function(e){return this.mediaEngine&&this.mediaEngine.requestFeature(e)},e.prototype.getSegmentAt=function(e){if(this.mainController)return this.mainController.getSegmentAt(e)},Object.defineProperty(e.prototype,"audioLevels",{get:function(){if(this.config.engineConfig&&this.config.engineConfig.enableTrack&&void 0!==this.mediaEngine.audioTracks)return this.mediaEngine.audioTracks;if(this.manifest){var e=this.manifest.getAllTrack().find((function(e){return e.type===L.MediaType.AUDIO}));return e&&e.getAllTrackLevel()||[]}return[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioLevel",{get:function(){if(this.config.engineConfig&&this.config.engineConfig.enableTrack&&void 0!==this.mediaEngine.audioTrack)return this.mediaEngine.audioTrack;if(this.manifest){var e=this.manifest.getAllTrack().find((function(e){return e.type===L.MediaType.AUDIO}));if(e&&e.current)return e.current.id}return-1},set:function(e){if(this.config.engineConfig&&this.config.engineConfig.enableTrack&&void 0!==this.mediaEngine.audioTrack)this.mediaEngine.audioTrack=e;else if(this.manifest){var t=this.manifest.getAllTrack().find((function(e){return e.type===L.MediaType.AUDIO}));t&&t.selectLevel(e)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subtitleLevels",{get:function(){if(this.manifest){var e=this.manifest.getAllTrack().find((function(e){return e.type===L.MediaType.SUBTITLE}));return e&&e.getAllTrackLevel()||[]}return[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subtitleLevel",{get:function(){if(this.manifest){var e=this.manifest.getAllTrack().find((function(e){return e.type===L.MediaType.SUBTITLE}));if(e&&e.current)return e.current.id}return-1},set:function(e){if(this.manifest){var t=this.manifest.getAllTrack().find((function(e){return e.type===L.MediaType.SUBTITLE}));t&&t.selectLevel(e)}},enumerable:!1,configurable:!0}),e.DRMType=L.EncryptMethodType,e.RequestEvent=L.RequestEvent,e.Event=L.PlayerEvent,e}(),jt=Ft;window.Kore=Ft;var Gt,Vt,qt,Ht,$t=function(){function e(){}return e.add=function(e,t){var r,i,n,o;try{r=e.toString().split(".")[1].length}catch(e){r=0}try{i=t.toString().split(".")[1].length}catch(e){i=0}if(o=Math.abs(r-i),n=Math.pow(10,Math.max(r,i)),o>0){var a=Math.pow(10,o);r>i?(e=Number(e.toString().replace(".","")),t=Number(t.toString().replace(".",""))*a):(e=Number(e.toString().replace(".",""))*a,t=Number(t.toString().replace(".","")))}else e=Number(e.toString().replace(".","")),t=Number(t.toString().replace(".",""));return(e+t)/n},e.subtract=function(e,t){var r,i,n;try{r=e.toString().split(".")[1].length}catch(e){r=0}try{i=t.toString().split(".")[1].length}catch(e){i=0}return n=Math.pow(10,Math.max(r,i)),parseFloat(((e*n-t*n)/n).toFixed(r>=i?r:i))},e.multiply=function(e,t){var r=0,i=e.toString(),n=t.toString();try{r+=i.split(".")[1].length}catch(e){}try{r+=n.split(".")[1].length}catch(e){}return Number(i.replace(".",""))*Number(n.replace(".",""))/Math.pow(10,r)},e.division=function(e,t){var r=0,i=0;try{r=e.toString().split(".")[1].length}catch(e){}try{i=t.toString().split(".")[1].length}catch(e){}return Number(e.toString().replace(".",""))/Number(t.toString().replace(".",""))*Math.pow(10,i-r)},e}(),Wt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e[e.REMOVE=0]="REMOVE",e[e.APPEND=1]="APPEND",e[e.CHANGE_TYPE=2]="CHANGE_TYPE"}(Gt||(Gt={})),function(e){e[e.MEDIA_APPENDED=0]="MEDIA_APPENDED",e[e.BUFFER_REMOVED=1]="BUFFER_REMOVED",e[e.EOF=2]="EOF",e[e.ERROR=3]="ERROR",e[e.BUFFER_FULL=4]="BUFFER_FULL",e[e.RESET=5]="RESET"}(Vt||(Vt={})),function(e){e[e.SOURCE_BUFFER_ERROR=0]="SOURCE_BUFFER_ERROR",e[e.APPEND_FAILED=1]="APPEND_FAILED"}(qt||(qt={})),function(e){e[e.HEV=0]="HEV",e[e.AVC=1]="AVC",e[e.MP4=2]="MP4",e[e.UNKNOWN=3]="UNKNOWN"}(Ht||(Ht={}));new Map([[Ht.HEV,"hev"],[Ht.AVC,"avc"],[Ht.MP4,"mp4"]]);var zt,Kt=U.registerError("DEC","SBF",qt),Yt=function(e){function t(t,r,i,n){var o=e.call(this)||this;return o.isCleaningBuffer=!1,o.onUpdateEnd=function(){if(o.sourceUpdating=!1,o.currentAction)if(o.currentAction[0]===Gt.APPEND){o.isCleaningBuffer&&(o.isCleaningBuffer=!1);var e=o.currentAction[1].media,t=o.currentAction[1].meta;e.isLast&&!o.eof&&(o.eof=!0,o.emit(Vt.EOF)),o.emit(Vt.MEDIA_APPENDED,e,t)}else if(o.currentAction[0]===Gt.REMOVE){var r=o.currentAction[1];r[1]===1/0&&(o.eof=!1),o.emit(Vt.BUFFER_REMOVED,{start:r[0],end:r[1]})}o.handleAction()},o.sourceBufferError=function(e){e.code===DOMException.QUOTA_EXCEEDED_ERR?o.emit(Vt.BUFFER_FULL):o.emit(Vt.ERROR,Kt.of(qt.SOURCE_BUFFER_ERROR,U.Severity.FATAL,"source buffer error")),o.destroy()},o.mediaSource=t,o.mediaElement=r,o.pendingAction=[],o.appendBuffer=[],o.type=i,o.sourceUpdating=!1,o.eof=!1,o.ID="MediaTrack",n&&n.mime&&(o.codec=n,o.createSourceBuffer(i,n)),o}return Wt(t,e),Object.defineProperty(t.prototype,"buffered",{get:function(){if(!this.sourceBuffer||this.isCleaningBuffer)return L.BufferRange.Empty;try{return L.BufferRange.fromTimeRanges(this.sourceBuffer.buffered)}catch(e){return z.warn(this.ID,e),L.BufferRange.Empty}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"EOF",{get:function(){return this.eof},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){if(this.off(),delete this.pendingAction,delete this.lastAppended,delete this.currentAction,this.sourceBuffer)try{this.sourceBuffer.removeEventListener("updateend",this.onUpdateEndeBufferError);for(var e=0;e<this.mediaSource.sourceBuffers.length;e++)this.mediaSource.sourceBuffers[e]===this.sourceBuffer&&this.mediaSource.removeSourceBuffer(this.sourceBuffer);delete this.sourceBuffer}catch(e){z.error(this.ID,e)}},t.prototype.createSourceBuffer=function(e,t){this.sourceBuffer=this.mediaSource.addSourceBuffer(e+'/mp4;codecs="'+t.mime+'"'),this.sourceBuffer.addEventListener("updateend",this.onUpdateEnd),this.sourceBuffer.addEventListener("error",this.sourceBufferError)},Object.defineProperty(t.prototype,"updating",{get:function(){return this.sourceBuffer&&this.sourceUpdating},enumerable:!1,configurable:!0}),t.prototype.removeBuffer=function(e,t){0===e&&t===1/0&&(this.isCleaningBuffer=!0,delete this.lastAppended,this.pendingAction=[],this.eof=!1),this.pendingAction.push([Gt.REMOVE,[e,t]]),this.updating||this.handleAction()},t.prototype.pushMedia=function(e,t){if(this.codec&&t&&t.codec&&this.codec.id!=t.codec.id){if(!this.sourceBuffer||"function"!=typeof this.sourceBuffer.changeType)return void this.emit(Vt.RESET);this.pendingAction.push([Gt.CHANGE_TYPE,{media:e,meta:t}])}this.pendingAction.find((function(t){var r=t[0],i=t[1];return r===Gt.APPEND&&i.media.id==e.id&&i.media.chunkId==e.chunkId&&i.media.type===e.type}))||this.pendingAction.push([Gt.APPEND,{media:e,meta:t}]),this.updating||this.handleAction()},t.prototype.handleAction=function(){var e=this.pendingAction.shift();if(e){this.sourceUpdating=!0;var t=e[0],r=e[1];this.currentAction=e,t===Gt.APPEND?this.handleAppending(r):t===Gt.REMOVE?this.handleRemove(r):t===Gt.CHANGE_TYPE&&this.handleChangeType(r)}},t.prototype.handleChangeType=function(e){e.media;var t=e.meta;this.sourceBuffer&&this.sourceBuffer.changeType(this.type+'/mp4;codecs="'+t.codec.mime+'"'),this.codec=t.codec,this.lastAppended&&delete this.lastAppended,this.sourceUpdating=!1,this.handleAction()},t.prototype.concatInitSegment=function(e,t){if(!t.initSegment)throw new Error("every programInfo must have initSegment");var r=new Uint8Array(e.data.byteLength+t.initSegment.byteLength);return r.set(new Uint8Array(t.initSegment)),r.set(new Uint8Array(e.data),t.initSegment.byteLength),r},t.prototype.handleRemove=function(e){var t=e[0],r=e[1];if(this.sourceBuffer&&!this.sourceBuffer.updating)for(var i=0;i<this.mediaSource.sourceBuffers.length;i++)this.mediaSource.sourceBuffers[i]===this.sourceBuffer&&this.sourceBuffer.remove(t,r);else z.error(this.ID,"cant remove when source buffer updating")},t.prototype.handleAppending=function(e){var t=e.media,r=e.meta;if(!this.sourceBuffer)try{this.createSourceBuffer(this.type,r.codec),r.codec&&!this.codec&&(this.codec=r.codec)}catch(e){return void this.emit(Vt.ERROR,Kt.of(qt.SOURCE_BUFFER_ERROR,U.Severity.FATAL,e.message))}if(this.sourceBuffer)if(this.sourceBuffer.updating)z.error(this.ID,"cant append when source buffer updating");else try{var i=t.data;this.lastAppended&&this.lastAppended.programId==t.programId&&this.lastAppended.levelId===t.levelId||(i=this.concatInitSegment(t,r)),void 0!==t.pts&&Math.abs(t.pts-t.start)>=.1?this.sourceBuffer.timestampOffset=$t.subtract(t.start,t.pts):0!==this.sourceBuffer.timestampOffset&&(this.sourceBuffer.timestampOffset=0),this.appendBuffer.length<10||this.appendBuffer.shift(),this.appendBuffer.push(i),this.sourceBuffer.appendBuffer(i),this.lastAppended=t}catch(e){if(console.error(e.message,e),this.mediaElement.error)return;e.code===DOMException.QUOTA_EXCEEDED_ERR?this.emit(Vt.BUFFER_FULL,{id:t.id,media:t,type:this.type}):this.emit(Vt.ERROR,Kt.of(qt.APPEND_FAILED,U.Severity.FATAL,"segment append failed"))}},t.Event=Vt,t}(L.EventBus),Xt=function(){return(Xt=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Qt=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Jt=["timeupdate","playing","waiting","seeking","seeked","loadeddata","loadedmetadata","pause","play","canplay","durationchange","volumechange","ratechange"];!function(e){e[e.MEDIA_ERR_UNKNOWN=0]="MEDIA_ERR_UNKNOWN",e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED",e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.VIDEO_DECODE_FAILED=4]="VIDEO_DECODE_FAILED",e[e.MEDIA_SOURCE_ERROR=5]="MEDIA_SOURCE_ERROR"}(zt||(zt={}));var Zt=U.registerError("DEC","ENG",zt);/(version)(applewebkit)[/]([\d.]+).*(safari)[/]([\d.]+)/i.test(navigator.userAgent),/(webkit)[ /]([\d.]+).*(version)[/]([\d.]+).*(safari)[/]([\d.]+)/i.test(navigator.userAgent);var er="loadedmetadata",tr=function(){function e(e){var t=this;this.mediaElement=e,this.eventBus=new L.EventBus,this.lastBufferInfo={},this.mediaElementEvents=[],this.metaEventEmitted=!1,this.endEventThrough=!1,this.ready=!1,this.prevPlaybackRate=this.playbackRate,this._waiting=!1,this.inputFilters=[],this.trackList=[],thonSeeking=function(){t.checkBufferChange()},this.eventBus.on(L.PlayerEvent.BUFFER_CHANGE,(function(){t.jumpGap()})),this.onError=function(e){var r=t.mediaElement.error,i=zt.MEDIA_ERR_UNKNOWN;if(r&&r.code)switch(r.code){case 1:i=zt.MEDIA_ERR_ABORTED;break;case 2:i=zt.MEDIA_ERR_NETWORK;break;case 3:i=zt.MEDIA_ERR_DECODE;break;case 4:i=zt.VIDEO_DECODE_FAILED}t.eventBus.emit(L.PlayerEvent.ERROR,Zt.of(i,U.Severity.FATAL,r&&r.message))},this.onWaiting=function(){t._waiting=!0,t._playing=!1,t.checkBufferChange(),t.checkEndOfStream(),t.jumpGap(!0)},this.onPlaying=function(){t._waiting=!1,t._playing=!0},this.onTimeupdate=function(){t.endEventThrough=!1,Math.abs(t.currentTime-t.duration)<1&&(t.endTimer&&(clearTimeout(t.endTimer),t.endTimer=null),t.endTimer=window.setTimeout((function(){t._playing&&!1===t.endEventThrough&&(t.endEventThrough=!0,t.eventBus.emit(L.PlayerEvent.ENDED))}),1e3))},this.onEnded=function(){t.endTimer&&(clearTimeout(t.endTimer),t.endTimer=null),t.endEvenEvent.ENDED)},this.mediaElement.addEventListener("playing",this.onPlaying),this.mediaElement.addEventListener("seeking",this.onSeeking),this.mediaElement.addEventListener("waiting",this.onWaiting),this.mediaElement.addEventListener("ended",this.onEnded),this.mediaElement.addEventListener("timeupdate",this.onTimeupdate),this.mediaElement.addEventListener("error",this.onError),this.mediaElement.addEventListener("seeked",(function(){}))}return Object.defineProperty(e.prototype,"isSourceBufferUpdating",{get:function(){return this.trackList&&this.trackList.reduce((function(e,t){return e||t.updating}),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWaiting",{get:function(){return this._waiting},enumerable:!1,configurable:!0}),e.prototype.jumpGap=function(e){void 0===e&&(e=!1);var t=this.buffered.toGap().findRange(this.currentTime,.33);if(t){var r=t[1]-this.currentTime;if(r>.05&&r<.66)return void this.seek(t[1]+.05)}else if(!this.mediaElement.seeking&&e&&(t=this.buf1]-3){var i=Math.min(t[1]+.05,this.currentTime+.1);return void this.seek(i)}this.buffered.getBufferInfo(this.currentTime,2).bufferLength>.33&&e&&!this.mediaElement.seeking&&this.seek(this.currentTime+.1)},e.prototype.initMediaSource=function(){var e=this;this.mediaSource=new MediaSource,this.objectUrl=window.URL.createObjectURL(this.mediaSource),this.mediaElement.src=this.objectUrl,this.prevTime&&(this.seek(this.prevTime),this.prevPaused||this.play(),this.playbackRate=this.prevPlaybackRate),this.mediaSource.addEventListener("sourceopen",(function(){e.destroyed||(e.ready=!0,e._changeDuration())})),this.mediaSource.addEventListener("error",(function(t){e.eventBus.emit(L.PlayerEvent.ERROR,Zt.of(zt.MEDIA_SOURCE_ERROR,U.Severity.FATAL))}))},e.prototype.setConfig=function(e){},e.prototype.reset=function(){this.prevTime=this.currentTime,this.prevPaused=this.paused,this.curStreamNum=void 0,this.unloadMediaSource(),this.initMediaSource(),this.trackList.forEach((function(e){return e.destroy()})),this.trackList=[],this.ready=!1,this.endEventThrough=!1,delete this.mi.bufferMonitor&&(clearTimeout(this.bufferMonitor),this.bufferMonitor=null)},Object.defineProperty(e.prototype,"bufferLength",{get:function(){var e;return this.buffered&&(null===(e=this.buffered.getBufferInfo(this.currentTime))||void 0===e?void 0:e.bufferLength)||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this.mediaElement.loop},set:function(e){this.mediaElement.loop=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoplay",{get:function(){return this.mediaElement.autoplay},set:function(e){this.mediaElement.autoplay=e},enumerable:!1,configurable:!0}),e.prototype.seek=function(e){var t=this;if(!isNaN(e))if(e<0&&(e=0),this.mediaElement.duration&&e>this.mediaElement.duration&&(e=this.mediaElement.duration),this.mediaElement.readyState>0)this.mediaElement.currentTime=e;else{var r=!0;this.loadStartTime=e,this._fun&&this.mediaElement.removeEventListener(er,this._fun),this._fun=function(){r&&(r=!1,t.loadStartTime?(t.mediaElement.currentTime=t.loadStartTime,t.loadStartTime=0):t.mediaElement.currentTime=e),t._fun&&(t.mediaElement.removeEventListener(er,t._fun),delete t._fun)},this.mediaElement.addEventListener(er,this._fun)}},e.prototype.getBuffered=function(e,t){if(void 0===t&&(t=0),e===L.MediaType.MIXED){var r=this.getTrack(L.MediaType.AUDIO),i=this.getTrack(L.MediaType.VIDEO);if(r&&i){var n=r.buffered.getBufferInfo(this.currentTime),o=i.buffered.getBufferInfo(this.currentTime);return n.bufferEnd<o.bufferEnd||n.bufferEnd-o.bufferEnd<.32?L.BufferRange.unionTwoTimeRanges(r.buffered,i.buffered):L.BufferRange.fromTimeRanges(this.mediaElement.buffered)}return L.BufferRange.Empty}var a=this.getTrack(e,t);return a?a.buffered:L.BufferRange.Empty},e.prototype.getBufferInfo=function(e,t){return void 0===t&&(t=0),this.getBuffered(e,t).getBufferInfo(this.currentTime)},e.prototype.setMonitor=function(e){this.monitor=e},e.prototype.setupInputFilter=function(e){this.inputFilters.push(e)},e.prototype.removeInputFilter=function(e){this.inputFilters=this.inputFilters.filter((function(t){return t!==e}))},e.prototype.setupRenderFilter=function(e){throw new Error("Method not implemented.")},e.prototype.removeRenderFilter=function(e){throw new Error("Method not implemented.")},e.prototype._changeDuration=function(){this.mediaSource&&(this.mediaSource&&"open"!==this.mediaSource.readyState||this.isSourceBufferUpdating||this._duration&&(!this.mediaSource.duration||this.mediaSource.duration<this._duration)&&(this._duration===1/0&&void 0===this.mediaSource.setLiveSeekableRange&&(this._duration=86400),this.mediaSource.duration=this._duration,this._duration===1/0&&"function"==typeof this.mediaSource.setLiveSeekableRange?this.mediaSource.setLiveSeekableRange(0,864e4):"function"==typeof this.mediaSource.clearLiveSeekableRange&&this.mediaSource.clearLiveSeekableRange()))},e.prototype.checkEndOfStream=function(){this.trackList&&this.trackList.length>0&&this.trackList.reduce((function(e,t){return t.EOF&&e}),!0)&&this.mediaSource&&"open"===this.mediaSource.readyState&&!this.isSourceBufferUpdating&&this.mediaSource.endOfStream()},e.prototype.checkBufferChange=function(){var e=this,t=!1;this.trackList.forEach((function(r){var i,n,o,a=r.buffered,s=a.getBufferInfo(e.currentTime),u=e.lastBufferInfo[r.type];if(r.updating)t=!1;else if(u){i=u,n=s,o=.04,(Math.abs(i.bufferLength-n.bufferLength)>o||Math.abs(i.bufferEnd-n.bufferEnd)>o||0===s.bufferLength&&0===u.bufferLength&&Math.abs(a.Length-u.rangeLength)>.04)&&(e.lastBufferInfo[r.type]={bufferLength:s.bufferLgeLength:a.Length},e.mixedTrack||e.eventBus.emit(L.PlayerEvent.BUFFER_CHANGE,r.type),t=!0)}else e.lastBufferInfo[r.type]={bufferLength:s.bufferLength,bufferEnd:s.bufferEnd,rangeLength:a.Length},(t=a.Length>0)&&!e.mixedTrack&&e.eventBus.emit(L.PlayerEvent.BUFFER_CHANGE,r.type)})),t&&this.mixedTrack&&this.eventBus.emit(L.PlayerEvent.BUFFER_CHANGE,L.MediaType.MIXED),this.monitorBuffer()},e.prototype.newTrack=function(e,t){var r=this;if(this.mediaSource){var i=new Yt(this.mediaSource,this.mediaElemeeduce((function(e,t){return t.EOF&&e}),!0)&&r.mediaSource&&"open"===r.mediaSource.readyState&&!r.isSourceBufferUpdating&&r.mediaSource.endOfStream()})),i.on(Yt.Event.ERROR,(function(e){r.eventBus.emit(L.PlayerEvent.ERROR,e)}));var n=function(e,t,i){r.fatalRemoved&&(r.currentTime+=.01,r.fatalRemoved=!1),r.eventBus.emit(L.MediaEngineEvent.MEDIA_APPENDED,{id:e,media:t,type:i}),r.eventBus.ANGE,i)};i.on(Yt.Event.BUFFER_FULL,(function(e){r.eventBus.emit(L.MediaEngineEvent.BUFFER_FULL,e)})),i.on(Yt.Event.RESET,(function(){r.reset(),r.eventBus.emit(L.MediaEngineEvent.RESET)})),i.on(Yt.Event.BUFFER_REMOVED,(function(t){if(r.mixedRemoveTrack){for(var n=i.type===L.MediaType.VIDEO?L.MediaType.AUDIO:L.MediaType.VIDEO,o=-1,a=0;a<r.mixedRemoveTrack.length;a++){var s=r.mixedRemoveTrack[a],u=s.start===t.start&&Math.abs(s.end-t.end)<1,c=s.end===t.end&&Math.abs(s.start-t.start)<1;if(s.type===n&&(u||c)){o=a;break}}-1!==o?(r.mixedRemoveTrack=r.mixedRemoveTrack.filter((function(e,t){return t!==o})),r.eventBus.emit(L.MediaEngit(L.PlayerEvent.BUFFER_CHANGE,L.MediaType.MIXED)):r.mixedRemoveTrack.push(Xt(Xt({},t),{type:i.type}))}else r.eventBus.emit(L.MediaEngineEvent.BUFFER_REMOVED,{type:i.type,data:t}),r.eventBus.emit(L.PlayerEvent.BUFFER_CHANGE,e);r.checkEndOfStream()})),i.on(Yt.Event.MEDIA_APPENDED,(function(e,t){r.mixedTrack?(r.mixedTrack[e.id]||(r.mixedTrack[e.id]=[]),r.mixedTrack[e.id].push(e),2!=r.mixedTrack[e.id].filter((function(t){return t.chunkId===e.chunkId})).length&&1!=t.streamNum||(r._changeDuration(),n(e.id,r.mixedTrack[e.id].filter((function(t){return t.type===L.MediaType.VIDEO&&t.chunkId===e.chunkId}))[0],L.MediaType.MIXED),r.mixedTrack[e.id]=r.mixedTrack[e.id].filter((function(t){return t.chunkId!==e.chunkId})))):n(e.id,e,i.type);n(e,t,r){e===L.MediaType.MIXED?(this.mixedTrack={},this.mixedRemoveTrack=[],this.getTrack(L.MediaType.AUDIO)||this.newTrack(L.MediaType.AUDIO),this.getTrack(L.MediaType.VIDEO)||this.newTrack(L.MediaType.VIDEO)):e!==L.MediaType.AUDIO&&e!==L.MediaType.VIDEO||this.getTrack(e)||this.newTrack(e,t),this.bufferMonitor||this.monitorBuffer()},e.prototype.monitorBuffer=function(e){var t=this;void 0===e&&(e=1e3),this.bufferMonitor&&(clearTimeout(this.bufferMonitor),this.bufferMonitor=null),this.bufferMonitor=window.setTimeout((function(){t.isSourceBufferUpdating?t.monitorBuffer(200):t.checkBufferChange()}),e)},e.prototype.stop=function(){this.ready&&(this.trackList.forEach((function(e){return e.destroy()})),this.trackList=[],this.ready=!1,this.endEventThrough=!1,delete this.mixedTrack,delete this.mixedRemoveTrack,this.prevTime=0,this.prevPlaybackRate=1,this.prevPaused=!0,this.unloadMediaSource(),this._duration=0,this.mediaElement.removeAttribute("src"),this.mediaElement.load(),this.initMediaSource(),this.bufferMonitor&&(clearTimeout(this.bufferMonitor),this.bufferMonitor=null),this.removeBuffer(L.MediaType.MIXED,0,1/0),this.currentTime=0)},e.prototype.getVideoPlaybackQuality=function(){return this.mediaElement&&"function"==typeof this.mediaElement.getVideoPlaybackQuality?this.mediaElement.getVideoPlaybackQuality():{creationTime:0,droppedVideoFrames:0,totalVideoFrames:1,corruptedVideoFrames:0}},e.prototype.unloadMediaSource=function(){this.mediaSource&&"open"===this.mediaSource.readyState&&!this.isSourceBufferUpdating&&this.mediaSource.endOfStream(),this.objectUrl&&URL.revokeObjectURL(this.objectUrl),this.objectUrl=null,this.mediaSource=null,this.ready=!1},e.prototype.destroy=function(){var e=this;this.destroyed||(this.destroyed=!0,this.trackList.forEach((function(e){return e.destroy()})),this.trackList=[],this.unloadMediaSource(),this.mediaElement.removeAttribute("src"),this.mediaElement.load(),this.mediaElementEvents&&this.mediaElementEvents.forEach((function(t){var r=t[0],i=t[1];e.mediaElement.removeEventListener(r,i)})),this.eventBus.off(),this.mediaElements.endTimer),this.endTimer=null),this.mediaElement.removeEventListener("playing",this.onPlaying),this.mediaElement.removeEventListener("seeking",this.onSeeking),this.mediaElement.removeEventListener("waiting",this.onWaiting),this.mediaElement.removeEventListener("ended",this.onEnded),this.mediaElement.removeEventListener("timeupdate",this.onTimeupdate),this.mediaElement.removeEventListener("error",this.onError),this.inputFilters=[],this.mixedTrack={},this.mixedRemoveTrack=[])},Object.defineProperty(e.prototype,"supportFormats",{get:function(){return[L.ContainerFormat.MP4,L.ContainerFormat.WEBM]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaState",{get:function(){return this.mediaElement.readyState},enumerable:!1,configurable:!0}),e.prototype.isSupportFeature=function(e){switch(e){case L.PlayerFeature.PIP:var t=document.createElement("video"),r=document.pictureInPictureEnabled&&"function"==typeof t.requestPictureInPicture,i=t.webkitSupportsPresentationMode&&"function"==typeof t.webkitSetPresentationMode;return r||i;case L.PlayerFeature.WEB_DRM:return"function"==typeof navigator.requestMediaKeySystemAccess||"function"==typeof window.WebKitMediaKeys;default:return!1}},e.prototype.requestFeature=function(e){switch(e){case L.PlayerFeature.PIP:this.pip()}},e.prototype.pip=function(){var e=this.mediaElement,t=document.pictureInPictureEnabled&&"function"==typeof e.requestPictureInPicture,r=e.webkitSupportsPresentationMode&&"function"==typeof e.webkitSetPresentationMode;t?e!==document.pictureInPictureElement?e.requestPictureInPicture():document.exitPictureInPicture():r&&("picture-in-picture"===e.webkitPresentationMode?e.webkitSetPresentationMode("inline"):e.webkitSetPresentationMode("picture-in-picture"))},e.prototype.proxyEventAction=function(e,t,r){var i=this;if(Jt.indexOf(t)>-1){if("once"===e){var n=r;r=function(e){n(e),i.mediaElement.removeEventListener(t,r),i.mediaElementEvents&&(i.mediaElementEvents=i.mediaElementEvents.filter((function(e){var i=e[0],n=e[1];return i!==t||n!==rdEventListener(t,r)}else this.eventBus[e](t,r)},e.prototype.on=function(e,t){return this.proxyEventAction("on",e,t),this},e.prototype.once=function(e,t){return this.proxyEventAction("once",e,t),this},e.prototype.off=function(e,t){return Jt.indexOf(e)>-1?this.mediaElementEvents&&(this.mediaElementEvents=this.mediaElementEvents.filter((function(r){var i=r[0],n=r[1];return i!==e||n!==t})),this.mediaElement.removeEventListener(e,t)):this.eventBus.off(e,t),this},Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.loadStartTime?this.loadStartTime:this.mediaElement.currentTime},set:function(e){this.seek(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return L.Buffegurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this.mediaElement.paused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return this.mediaElement.ended},enumerable:!1,configurlement.muted},set:function(e){this.mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this.mediaElement.playbackRate},set:function(e){this.prevPlaybackRate=e,this.mediaElement.playbackRate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this.mediaElement.volume},set:function(e){this.mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing&&!this.mediaElement.paused&&!this.mediaElement.ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seeking",{get:function(){return this.mediaElement.seeking},enumerable:!1,configurable:!0}),e.prototype.pause=function(){this.mediaElement.pause()},e.prototype.play=function(){var e=this;if(this.mediaElement&&this.mediaElement.readyState>0)return this.mediaElement.play()||Promise.resolve();var t=!0,r=function(){if(t){t=!1;var i=e.mediaElement.play();i?i.then((function(){e.playPromise&&e.playPromise.defer&&e.playPromise.defer.resolve&&e.playPromise.defer.resolve(),e.playPromise=null})).catch((function(t){e.playPromise&&e.playPromise.defer&&e.playPromise.defer.reject&&e.playPromise.defer.reject(t),e.playPromise=null})):e.playPromise&&(e.playPromise.defer&&e.playPromise.defer.resolve&&e.playPromise.defer.resolve(),e.playPromise=null)}e.mediaElement.removeEventListener(er,r)};return this.mediaElement.addEventListener(er,r),this.playPromise=function(){var e={},t=new Promise((function(t,r){e.resolve=t,e.reject=r}));return t.defer=e,t}(),this.playPromise},e.prototype.changeDuration=function(e){this._duration=e;try{this._changeDuration()}catch(e){z.error(this.ID,"change duration error "+e)}},e.prototype.removeBuffer=function(e,t,r){if(this.bufferLength>0&&0===t&&r===1/0&&(this.fatalRemoved=!0,this.metaEventEmitted=!1),e===L.MediaType.MIXED){var i=this.getTrack(L.MediaType.AUDIO),n=this.getTrack(L.MediaType.VIDEO);i&&n&&(i.removeBuffer(t,r),n.removeBuffer(t,r))}else{var o=this.getTrack(e,0);o&&o.removeBuffer(t,r)}},Object.defineProperty(e.prototype,"videoHeight",{get:function(){return this.mediaElement.videoHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoWidth",{get:function(){return this.mediaElement.videoWidth},enumerable:!1,configurable:!0}),e.prototype.getTrack=function(e,t){return void 0===t&&(t=0),this.trackList&&this.trackList.filter((function(t){return t.type==e}))[t]},e.prototype.appendMedia=function(e,t,r){if(void 0===r&&(r=0),null==this.curStreamNum&&t&&null!=t.streamNum&&(this.curStreamNum=t.streamNum),null!=this.curStreamNum&&t&&t.streamNum!=this.curStreamNum&&t(L.MediaEngineEvent.RESETvar i=this.getTrack(e.type,r);if(i){var n=e&&e.chunkId&&e.chunkId.replace("-","");thtor.recordStep(de.SE}else z.trace(this.ID,e.type+" track not found")},e.prototype.reload=function(){},Qt([j("inputFilters")],e.prototype,"appendMedia",null),e}();var rr,ir,nr,or=function(){function e(e,t){var r=this;this.name=e,this._host=t,["hooks","interceptor","callback"].forEach((function(e){r[e]=[]}))}return e.prototype.addHandler=function(e,t){this[t].push(e)},e.prototype.removeHandler=function(e,t){this[t]=this[t].filter((function(t){return t!==e}))},e.prototype.clear=function(){var e=this;["hooks","interceptor","callback"].forEach((function(t){e[t]=[]}))},e.prototype.emit=function(e){this.dispatcher(e,!0)},e.prototype.dispatch=function(){var e=this;return this.dispatcher=function(t,r){void 0===r&&(r=!1);var i;i=e._host.hooks.concat(e.hooks).reduce((function(e,t){return t(e)}),t)||t;var n=e._host.interceptor.concat(e.interceptor).every((function(e){return e(i)}));if(!r&&!1===n)return!1;e.callback.forEach((function(e){e(i)}))},this.dispatcher},e}(),ar=function(){function e(e){Array.isArray(e)?this.elenterceptor=[]}return e.prototype.on=function(e,t){this.initEventDispatcher(e),this.dispatcherMap[e].addHandler(t,"callback")},e.prototype.emit=function(e,t){this.dispatcherMap[e]&&this.dispatcherMap[e].emit({data:t})},e.prototype.off=function(e,t){var r=this;t?this.dispatcherMap[e]&&this.dispatcherMap[e].removeHandler(t,"callback"):e?(this.elements.forEach((function(t){t.removeEventListener(e,r.dispatcherMap[e].dispatcher)})),delete this.dispatcherMap[e]):(Object.keys(this.dispatcherMap).forEach((function(e){r.elements.forEach((function(t){t.removeEventListener(e,r.dispatcherMap[e].dispatcher)}))})),this.dispatcherMap={})},e.prototype.intercept=function(e,t){this.addHandler("interceptor",e,t)},e.prototype.hook=function(e,t){this.addHandler("hooks",e,t)},e.prototype.removeHook=function(e,t){this.removeHandler("hooks",e,t)},e.prototype.removeIntercept=function(e,t){this.removeHandler("interceptor",e,t)},e.prototype.initEventDispatcher=function(e){var t=this;this.dispatcherMap[e]||(this.dispatcherMap[e]=new or(e,this),this.elements.forEach((function(r){r.addEventListener(e,t.dispatcherMap[e].dispatch())})))},e.prototype.addHandler=function(e,t,r){r?(this.initEventDispatcher(t),this.dispatcherMap[t].addHandler(r,e)):"function"==typeof t&&this[e].push(t)},e.prototype.removeHandler=function(e,t,r){r?this.dispatcherMap[t]&&this.dispatcherMap[t].removeHandler(r,"hooks"):"function"==typeof t&&(this[e]=this[e].filter((function(e){return e!==r})))},e.prototype.clear=function(){for(var e in this.hooks=[],this.interceptor=[],this.dispatcherMap)this.dispatcherMap.hasOwnProperty(e)&&this.dispatcherMap[e].clear()},e}(),sr=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ur=["timeupdate","playing","waiting","seeking","seeked","pause","play","canplay","ended","volumechange","ratechange","loadedmetadata","loadeddata"];!function(e){e[e.INIT=1]="INIT",e[e.LOADING=2]="LOADING",e[e.LOADED=4]="LOADED",e[e.MUXING=8]="MUXING",e[e.MUXED=16]="MUXED",e[e.APPENDING=32]="APPENDING",e[e.APPENDED=64]="APPENDED"}(rr||(rr={})),function(e){e[e.IDLE=0]="IDLE",e[e.FRESH=1]="FRESH",e[e.PLAYED=2]="PLAYED",e[e.PLAYING=3]="PLAYING"}(ir||(ir={})),function(e){e[e.MEDIA_ERR_UNKNOWN=0]="MEDIA_ERR_UNKNOWN",e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED",e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(nr||(nr={}));var cr=U.registerError("DEC","ENG",nr);var lr,pr=function(){function e(e){var t=this;this._currentTime=0,this._isPIP=!1,this._pause=!0,this.mediaDataList=[],this.eventBus=new L.EventBus,this.segmentBuffer=[],this.inputFilters=[],this._loop=ideo:e,start:-1,end:-1,duration:-1,state:ir.IDLE};e.style.display="none",e.autoplay=!1,t.mediaDataList.push(r)})),this.setMediaProperty("preload","auto"),this.addEvent(),this.ready=!0}return e.prototype.setConfig=function(e){},e.prototype.reset=function(){this.removeBuffer(L.MediaType.MIXED,0,1/0)},Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e},enumerable:!1,configurable:!0}),e.prototype.seek=function(e){var t=this;if(!(e<0))if(e<=this.duration){this._currentTime=e;var r=this.mediaDataList.filter((function(t){return t.start<=e&&t.end>e}));1===r.length?(this.switchVideo(r[0],e),this.eventBus.emit(L.PlayerEvent.BUFFER_CHANGE,L.MediaType.MIXED)):0===r.length&&(this.segmentBuffer=[],this.currentMediaItem=null,this.mediaElement=null,this.mediaDataList.forEach((function(e){e.id>-1&&t.eventBus.emit(L.MediaEngineEvent.BUFFER_REMOVED,{type:L.MediaType.MIXED,data:{id:e.id}}),e.id=-1,e.start=-1,e.end=-1,e.state=ir.IDLE,e.video.pause()})),this.eventBus.emit(L.PlayerEvent.BUFFER_CHANGE,L.MediaType.MIXED))}else void 0===this.duration&&(this._currentTime=e)},e.prototype.getBuffered=function(e,t){return void 0===t&&(t=0),this.segmentBuffer?L.BufferRange.fromSegments(this.segmentBuffer):L.BufferRange.Empty},e.prototype.getBufferInfo=function(e,t){return void 0===t&&(t=0),this.getBuffered(e,t).getBufferInfo(this.currentTime)},e.prototype.setupInputFilter=function(e){this.inputFilters.push(e)},e.prototype.removeInputFilter=function(e){this.inputFilters=this.inputFilters.filter((function(t){return t!==e}))},e.prototype.setupRenderFilter=function(e){throw new Error("Method not implemented.")},e.prototype.removeRenderFilter=function(e){throw new Error("Method not implemented.")},e.prototype.createTrack=function(e,t,r){},e.protnted.")},e.prototype.once=function(e,t,r){var i=this,n=!1,o=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];i.off(e,o),n||(n=!0,t.apply(void 0,r))};return this.on(e,o),this},e.prototype.stop=function(){},e.prototype.getVideoPlaybackQuality=function(){return this.mediaElement&&"function"==typeof this.mediaElement.getVideoPlaybackQuality?this.mediaElement.getVideoPlaybackQuality():{creationTime:0,droppedVideoFrames:0,totalVideoFrames:1,corruptedVideoFrames:0}},e.prototype.destroy=function(){this.mediaDataList.forEach((function(e){e.video.removeAttribute("src"),e.video.load()})),this.eventProxy.off(),this.eventBus.off()},Object.defineProperty(e.prototype,"supportFormats",{get:function(){return[L.ContainerFormat.ANY]},enumerable:!1,configurable:!0}),e.prototype.isSupportFeature=function(e){var t=document.createElement("video"),r=document.pictureInPictureEnabled&&"function"==typeof t.requestPictureInPicture,i=t.webkitSupportsPresentationMode&&"function"==typeof t.webkitSetPresentationMode;switch(e){case L.PlayerFeature.PIP:return r||i;case L.PlayerFeature.WEB_DRM:return"function"==typeof navigator.requestMediaKeySystemAccess||"function"==typeof window.WebKitMediaKeys;default:return!1}},e.prototype.requestFeature=function(e){switch(e){case L.PlayerFeature.PIP:this.pip()}},e.prototype.pip=function(e){var t=this;if(this.mediaElement){var r=this.mediaElement,i=document.pictureInPictureEnabled&&"function"==typeof r.requestPictureInPicture,n=r.webkitSupportsPresentationMode&&"function"==typeof r.webkitSetPresentationMode;void 0!==e&&e||!this.isPIP?(t._isPIP=!0,i&&r!==document.pictureInPictureElement?r.requestPictureInPicture():n&&"picture-in-picture"!==r.webkitPresentationMode&&r.webkitSetPresentationMode("picture-in-picture")):(t._isPIP=!1,i&&r===document.pictureInPictureElement?document.exitPictureInPicture():n&&"picture-in-picture"!==r.webkitPresentationMode&&r.webkitSetPresentationMode("picture-in-picture"))}},e.prototype.on=function(e,t){return ur.indexOf(e)>-1?this.eventProxy.on(e,t):this.eventBus.on(e,t),this},e.pthis.eventBus.off(e,t),this},Object.defineProperty(e.prototype,"isPIP",{get:funerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._currentTime},set:function(e){this.seek(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this.segmentBuffer?L.BufferRange.fromSegments(this.segmentBuffer):L.BufferRange.Empty},enumerable:!1,configurmediaElement.paused||this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return!!this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this.mediaElement&&this.mediaElement.muted||!1},set:function(e){this.setMediaProperty("muted",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this.mediaElement&&this.mediaElement.playbackRate||1},set:function(e){this.setMediaProperty("playbackRate",e),this.setMediaProperty("defaultPlaybackRate",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return thitMediaProperty("volume",e)},enumerable:!1,configurturn!(this.mediaElement&&this.mediaElement.paused||this._ended)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoplay",{get:function(){return this._autoplay},set:function(e){this._autoplay=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seeking",{get:function(){return this.mediaElement&&this.mediaElement.seeking||!1},enumerable:!1,configurable:!0}),e.prototype.pause=function(){this._pause=!0,this.mediaElement&&this.mediaElement.pause()},e.prototype.play=function(){return this._pause=!1,this.currentMediaItem&&this.mediaElement&&this.mediaElement.readyState>0?(this.currentMediaItem.state=ir.PLAYING,this.mediaElement.play()||Promise.resolve()):(this.playPromise=function(){var e={},t=new Promise((function(t,r){e.resolve=t,e.reject=r}));return t.defer=e,t}(),this.seek(this.currentTime),this.playPromise)},e.prototype.changeDuration=function(e){e!=this._duration&&(this._duration=e,this.eventBus.emit(L.PlayerEvent.DURATION_CHANGE,e))},e.prototype.removeBuffer=function(e,t,r){0===t&&r===1/0&&(this.segmentBuffer=[],this.mediaDataList.forEach((function(e){e.id=-1,e.start=-1,e.end=-1,e.state=ir.IDLE,e.video.pause(),e.video.removeAttribute("src"),e.video.load()})),this.currentMediaItem=null,this.mediaElement=null,this.eventBus.emit(L.PlayerEvent.BUFFER_CHANGE,L.MediaType.MIXED))},Object.defineProperty(e.prototype,"videoHeight",{get:function(){return this.mediaElement&&this.mediaElement.videoHeight||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoWidth",{get:function(){return this.mediaElement&&this.mediaElement.videoWidth||0},enumerable:!1,configurable:!0}),e.prototype.getTrack=function(e,t){return void 0===t&&(t=0),!1},e.prototype.appendMedia=function(e,t,r){void 0===r&&(r=0);var i={start:e.start,end:e.end,duration:e.duration,id:e.id,data:e.data,isLast:e.isLast};this.segmentBuffer.push(i),this.segmentBuffer.sort((function(e,t){return e.start-t.start})),this.handleAppending(e)},e.prototype.reload=funcon(){var e=this,t=this.mediaDataList.map((function(e){return e.video}));this.eventProxy=new ar(t),this.eventProxy.intercept((function(t){return t.target===e.mediaElement})),this.eventProxy.hook("timeupdate",(function(t){e.currentMediaItem&&e.mediaElement&&e.mediaElement.currentTime>0&&(e._currentTime=e.currentMediaItem.start+e.mediaElement.currentTime)})),this.eventProxy.intercept("durationchange",(function(t){return 1===e.segmentBuffer.length&&e._duration===Number.POSITIVE_INFINITY&&e.changeDuration(t.target.duration),!1})),this.eventProxy.intercept("error",(function(t){return e.onError(t),!1})),this.eventProxy.intercept("ended",(function(t){if(e.currentMediaItem){if(e.currentMediaIn e._ended=!0,!0;e.seek(e.currentMediaItem.end)}else console.error("can not find target video");return!1}))},e.prototype.onError=function(e){var t=this.mediaElement&&this.mediaElement.error,r=nr.MEDIA_ERR_UNKNOWN;if(t&&t.code)switch(t.code){case 1:r=nr.MEDIA_ERR_ABORTED;break;case 2:r=nr.MEDIA_ERR_NETWORK;break;case 3:r=nr.MEDIA_ERR_DECODE;break;case 4:r=nr.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:r=nr.MEDIA_ERR_UNKNOWN}this.eventBus.emit(L.PlayerEvent.ERROR,cr.of(r,U.Severity.FATAL,t&&t.message))},e.prototype.setMediaProperty=function(e,t){this.mediaDataList.forEach((function(r){r.video[e]=t}))},e.prototype.switchVideo=function(e,t){var r=e.video;this.currentMediaItem&&this.currentMediaItem===e||(this.currentMediaItem&&this.mediaElement&&(r!==this.mediaElement&&this.mediaElement.pause(),this.currentMediaItem.state=ir.PLAYED),this.setVideoDisplay(r),this.currentMediaItem=e,this.mediaElement=r,e.state=ir.PLAYING),this.setVideoTime(r,t-e.start),this._pause||this.setVideoPlay(r),this.requestPIP(r)},e.prototype.setVideoDisplay=function(e){this.mediaDataList.forEach((function(t){t.video===e?t.video.style.display="block":t.video.style.display="none"}))},e.prototype.setVideoTime=function(e,t){if(e&&e.readyState>0)e.currentTime=t;else{var r=function(e){e.target.cudEventListener("loadedmetadata",r)}},e.prototype.setVideoPlay=function(e){var t=this,r=function(){var r=e.play();r?r.then((function(){t.playPromis.resolve(),t.playPromise=null})).catch((function(e){t.playPromise&&t.playPromise.defer&&t.playPromise.defer.reject&&t.playPromise.defer.reject(e),t.playPromise=null})):t.playPromise&&(t.playPromise.defer&&t.playPromise.defer.resolve&&t.playPromise.defer.resolve(),t.playPromise=null)};if(e.readyState>0)r();else{var i=function(e){r(),e.target.removeEventListener("loadedmetadata",i)};e.addEventListener("loadedmetadata",i)}},e.prototype.requestPIP=function(e){var t=this;if(this.isPIP)if(e&&e.readyState>0)this.pip(!0);else{var r=function(e){t.pip(!0),e.target.removeEventListener("loadedmetadata",r)};e.addEventListener("loadedmetadata",r)}},e.prototype.findMediaItem=function(e){var t=this,r=this.mediaDataList.filter((function(e){return e.state===ir.IDLE}));if(r.length>0)return r[0];var i=this.mediaDataList.filter((function(e){return e!==t.currentMediaItem&&(e.state===ir.PLAYED||e.state===ir.FRESH)}));return i[0]?(i=i.sort((function(t,r){return r.state-t.state||Math.abs(r.start-e)-Math.abs(t.start-e)})))[0]:this.mediaDataList[is.eventBus.emit(L.MediaEngineEvent.BUFFER_REMOVED,{type:L.MediaType.MIXED,data:{id:t.id}}),this.handleRemoving(t.id)),t.video.src&&t.video.src===e.data||(t.video.src=e.data,t.video.load()),t.id=e.id,t.start=e.start,t.end=e.end,t.duration=e.duration,t.state=ir.FRESH,this.mediaElement||this.switchVideo(t,this.currentTime),this.eventBus.emit(L.MediaEngineEvent.MEDIA_APPENDED,{id:e.id,media:e,type:L.MediaType.MIXED}),this.eventBus.emit(L.PlayerEvent.BUFFER_CHANGE,L.MediaType.MIXED)},e.prototype.handleRemoving=function(e){this.segmentBuffer=this.segmentBuffer.filter((function(t){return t.id!==e}))},sr([j("inputFilters")],e.prototype,"appendMedia",null),e}(),dr=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},hr=["error","levelchange"];!function(e){e[e.MEDIA_ERR_UNKNOWN=0]="MEDIA_ERR_UNKNOWN",e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED",e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(lr||(lr={}));var fr=U.registerError("DEC","ENG",lr);var mr,yr=/(version)(applewebkit)[/]([\d.]+).*(safari)[/]([\d.]+)/i.test(navigator.userAgent),gr=/(webkit)[ /]([\d.]+).*(version)[/]([\d.]+).*(safari)[/]([\d.]+)/i.test(navigator.userAgent),vr=function(){function e(e,t){var r=this;if(this.onCanplay=function(){if(!r._pause&&r.mediaElement.paused&&r.mediaElement.play(),(gr||yr)&&!r.levelChange&&r.audioTracks){var e=void 0;if("function"==typeof r.config.startMediaFilter&&(e=r.config.startMediaFilter(r.audioTracks,L.MediaType.AUDIO)),r.levelChange=!0,null!=e&&e!==r.audioTrack)return void(r.audioTrack=e);var t=r.audioTracks.getTrackById(r.audioTrack);r.eventBus.emit(L.PlayerEvent.LEVEL_CHANGE,{type:L.MediaType.AUDIO,info:{language:t&&t.language}})}},this.onLevelChange=function(e){if(r.audioTracks){var t=r.audioTracks.getTrackById(r.audioTrack);r.eventBus.emit(L.PlayerEvent.LEVEL_CHANGE,{type:L.MediaType.AUDIO,info:{language:t&&t.language}})}},this.onError=function(e){var t=r.mediaElement&&r.mediaElement.error,i=lr.MEDIA_ERR_UNKNOWN;if(t&&t.code)switch(t.code){case 1:i=lr.MEDIA_ERR_ABORTED;break;case 2:i=lr.MEDIA_ERR_NETWORK;break;case 3:i=lr.MEDIA_ERR_DECODE;break;case 4:i=lr.MEDIA_ERR_SRC_NOT_SUPPORTED}r.eventBus.emit(L.PlayerEvent.ERROR,fr.of(i,U.Severity.FATAL,t&&t.message))},this.mediaElementEvents=[],this.inputFilters=[],this.mediaElement=e,this.mediais.levelChange=!1,this._isPIP=!1,this._currentTime=0,this._pause=!0,this.eventBus=new L.EventBus,t&&(this.config=t),this.on(L.PlayerEvent.CANPLAY,this.onCanplay),this.mediaElement.addEventListener("error",this.onError),gr||yr){var i=this.mediaElement.audioTracks;i&&i.addEventListener("change",this.onLevelChange)}}return e.prototype.setConfig=function(e){this.config=Object.assign(this.config,e)},e.prototype.reset=function(){this.removeBuffer(L.MediaType.MIXED,0,1/0)},Object.defineProperty(e.prototype,"loop",{get:function(){return this.mediaElement.loop},set:function(e){this.mediaElement.loop=!0},enumerable:!1,configurable:!0}),e.prototype.seek=function(e){this.setCurrentTime(e)},e.prototype.getBuffered=function(e,t){return void 0===t&&(t=0),L.BufferRange.fromTimeRanges(this.mediaElement.buffered)},e.prototype.getBufferInfo=function(e,t){return void 0===t&&(t=0),this.getBuffered(e,t).getBufferInfo(this.currentTime)},e.prototype.setupInputFilter=function(e){this.inputFilters.push(e)},e.pro t!==e}))},e.prototype.setupRenderFilter=function(e){throw new Error("Method not implemented.")},e.prototype.removeRenderFilter=function(e){throw new Error("Method not implemented.")},e.prototype.createTrack=function(e,t,r){},e.prototype.catch=function(e){throw new Error("Method not implemented.")},e.prototype.once=function(e,t,r){var i=this,n=!1,o=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];i.off(e,o),n||(n=!0,t.apply(void 0,r))};return this.on(e,o),this},e.prototype.stop=function(){this.mediaElement&&(this.mediaElement.removeAttribute("src"),this.mediaElement.load())},e.prototype.getVideoPlaybackQuality=function(){return this.mediaElement&&"function"==typeof this.mediaElement.getVideoPlaybackQuality?this.mediaElement.getVideoPlaybackQuality():{creationTime:0,droppedVideoFrames:0,totalVideoFrames:1,corruptedVideoFrames:0}},e.prototype.destroy=function(){var e=this;if(!this.destroyed){if(this.destroyed=!0,this.mediaElementEvents&&this.mediaElementEvents.forEach((function(t){var r=t[0],i=t[1];e.mediaElement.removeEventListener(r,i)})),gr||yr){var t=this.mediaElement.audioTracks;t&&t.removeEventListener("change",this.onLevelChange)}this.eventBus.off(),this.mediaElement.removeAttribute("src"),this.mediaElement.load(),this.mediaElementEvents=null}},Object.defineProperty(e.prototype,"supportFormats",{get:function(){return[L.ContainerFormat.ANY]},enumerable:!1,configurable:!0}),e.prototype.isSupportFeature=function(e){var t=document.createElement("video"),r=document.pictureInPictureEnabled&&"function"==typeof t.requestPictureInPicture,i=t.webkitSupportsPresentationMode&&"function"==typeof t.webkitSetPresentationMode;switch(e){case L.PlayerFeature.PIP:return r||i;case L.PlayerFeature.WEB_DRM:return"function"==typeof navigator.requestMediaKeySystemAccess||"function"==typeof window.WebKitMediaKeys;default:return!1}},e.prototype.requestFeature=function(e){switch(e){case L.PlayerFeature.PIP:this.pip()}},e.prototype.pip=function(e){var t=this,r=this.mediaElement,i=document.pictureInPictureEnabled&&"function"==typeof r.requestPictureInPicture,n=r.webkitSupportsPresentationMode&&"function"==typeof r.webkitSetPresentationMode;void 0!==e&&e||!this.isPIP?(t._isPIP=!0,i&&r!==document.pictureInPictureElement?r.requestPictureInPicture():n&&"picture-in-picture"!==r.webkitPresentationMode&&r.webkitSetPresentationMode("picture-in-picture")):(t._isPIP=!1,i&&r===document.pictureInPictureElement?document.exitPictureInPicture():n&&"picture-in-picture"!==r.webkitPresentationMode&&r.webkitSetPresentationMode("picture-in-picture"))},e.prototype.on=function(e,t){return hr.indexOf(e)>-1?this.eventBus.on(e,t):(this.mediaElementEvents||(this.mediaElementEvents=[]),this.mediaElementEvents.push([e,t]),this.mediaElement.addEventListener(e,t)),f(e,t):this.mediaElementEvents&&(this.mediaElementEvents=this.mediaElementEvents.filter((function(r){var i=r[0],n=r[1];return i!==e||n!==t})),this.mediaElement.removeEventListener(e,t)),this},Object.defineProperty(e.prototype,"isPIP",{get:function(){return this._isPIP},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.mediaElement.currentTime},set:function(e){this.setCurrentTime(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return L.BufferRange.fromTimeRanges(this.mediaElement.buffered)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this.mediaElement.paused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return this.mediaElement.ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoplay",{get:function(){return this.mediaElement.autoplay},set:function(e){this.mediaElement.autoplay=euted",{get:function(){return this.mediaElement.muted},set:function(e){this.mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this.mediaElement.playbackRate},set:function(e){this.mediaElement.playbackRate=e},enumerable:!1,configu,{get:function(){return this.mediaElement.volume},set:function(e){this.mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return!this.mediaElement.paused&&!this.mediaElement.ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seeking",{get:function(){return this.mediaElement.seeking},enumerable:!1,configurable:!0}),e.prototype.pause=function(){this._pause=!0,this.mediaElement.pause()},e.prototype.play=function(){var e=this;if(this._pause=!1,this.mediaElement&&this.mediaElement.readyState>0)return this.mediaElement.play()||Promise.resolve();var t=!0,r=function(){if(t){t=!1;var i=e.mediaElement.play();i?i.then((function(){e.playPromise&&e.playPromise.defer&&e.playPromise.defer.resolve&&e.playPromise.defer.resolve(),e.playPromise=null})).catch((function(t){e.playPromise&&e.playPromise.defer&&e.playPromise.defer.reject&&e.playPromise.defer.reject(t),e.playPromise=null})):e.playPromise&&(e.playPromise.defer&&e.playPromise.defer.resolve&&e.playPromise.defer.resolve(),e.playPromise=null)}e.mediaElement.removeEventListener("loadedmetadata",r)};return this.mediaElement.addEventListener("loadedmetadata",r),this.playPromise=function(){var e={},t=new Promise((function(t,r){e.resolve=t,e.reject=r}));return t.defer=e,t}(),this.playPromise},e.prototype.changeDuration=function(e){},e.prototype.removeBuffer=function(e,t,r){0===t&&r===1/0&&(this.mediaElement.src&&(this._currentTime=this.mediaElement.currentTime),this.mediaElement.removeAttribute("src"),this.mediaElement.load())},Object.defineProperty(e.prototype,"videoHeight",{get:function(){return this.mediaElement.videoHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoWidth",{get:function(){return this.mediaElement.videoWidth},enumerable:!1,configurable:!0}),e.prototype.getTrack=function(e,t){return void 0===t&&(t=0),!1},e.prototype.appendMedia=function(e,t,r){var i=this;void 0===r&&(r=0),this.mediaElement.currentTime&&(this._currentTime=this.mediaElement.currentTime),this.levelChange=!1,console.log("prev:",this._currentTime),this.mediaElement.src=e.data;var n=function(){i.mediaElement.removeEventListener("loadeddata",n),i.mediaElement.currentTime=i._currentTime,console.log("after:",i._currentTime)};this.mediaElement.addEventListener("loadeddata",n)},e.prototype.reload=function(){},e.prototype.setCurrentTime=function(e){var t=this;if(e<0&&(e=0),this.mediaElement.duration&&e>this.mediaElement.duration&&(e=this.mediaElement.duration),this._currentTime=e,this.mediaElement.src&&this.mediaElement.readyState>0)this.mediaElement.currentTime=e;else{var r=!0,i=function(){r&&(r=!1,t.mediaElement.currentTime=t._currentTime),t.mediaElement.removeEventListener("loadedmetadata",i)};this.mediaElement.addEventListener("loadedmetadata",i)}},Object.defineProperty(e.prototype,"audioTracks",{get:function(){return gr||yr?this.mediaElement.audioTracks:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioTrack",{get:function(){if(gr||yr)for(var e=this.mediaElement.audioTracks||[],t=0;t<e.length;t++){var r=e[t];if(r.enabled)return r.id}return"-1"},set:function(e){if(gr||yr){var t=this.mediaElement.audioTracks;if(t&&t.getTrackById(""+e))for(var r=0;r<t.length;r++){var i=t[r];i.id==e?i.enabled=!0:i.enabled=!1}}},enumerable:!1,configurable:!0}),dr([j("inputFilters")],e.prototype,"appendMedia",null),e}(),br=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Er=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i};!function(e){e[e.MEDIA_ERR_UNKNOWN=0]="MEDIA_ERR_UNKNOWN"}(mr||(mr={}));U.registerError("NAV","ENG",mr);var _r,Rr,Sr,Ar,Tr={MSE:tr,MVideo:pr,Video:vr,Native:function(){function e(e,t){var r=this;this.ID="Native",this.onPlayerEvent=function(e,t){for(var i,n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];switch(t){case"playing":r._playing=!0,r._seeking=!1,r._paused=!1,r._ended=!1,r.eventBus.emit(L.PlayerEvent.CANPLAY),r.eventBus.emit(L.PlayerEvent.PLAYING);break;case"pause":r._playing=!1,r._paused=!0,r.eventBus.emit(L.PlayerEvent.PAUSE);break;case"timeupdate":r._seeking&&!r.seekingTime&&(r.seekingTime=window.setTimeout((function(){r._seeking&&r._playing&&(r._seeking=!1,r.eventBus.emit(L.PlayerEvent.SEEKED),r.eventBus.emit(L.PlayerEvent.PLAYING)),r.seekingTime=null,clearTimeout(r.seekingTime)}),500)),n[0]&&r.eventBus.emit(L.PlayerEvent.TIME_UPDATE,{engine:r.ID,currentTime:n[0]});break;case"waiting":r._playing=!1,r.eventBus.emit(L.PlayerEvent.WAITING);break;case"ended":r._seeking&&(r._seeking=!1,r.eventBus.emit(L.PlayerEvent.SEEKED),r.eventBus.emit(L.PlayerEvent.PLAYING)),r._ended=!0,r._paused=!0,r.eventBus.emit(L.PlayerEvent.ENDED);break;case"canplay":r._seeking&&(r.eventBus.emit(L.PlayerEvent.SEEKED),r.eventBus.emit(L.PlayerEvent.PLAYING)),r._seeking=!1,r.eventBus.emit(L.PlayerEvent.CANPLAY);break;case"error":r.lastSegment=null,r.eventBus.emit(L.PlayerEvent.ERROR,{code:n[0]});break;case"durationchange":r.eventBus.emit(L.PlayerEvent.DURATION_CHANGE,n[0]);break;case"levelchanged":r.eventBus.emit(L.PlayerEvent.LEVEL_CHANGE,{nativeQualityId:n[0]});break;case"seekcompleted":r._seeking&&(r._seeking=!1,r.eventBus.emit(L.PlayerEvent.SEEKED),r.eventBus.emit(L.PlayerEvent.PLAYING));break;case"commonApi":(i=r.eventBus).emit.apply(i,Er([L.PlayerEvent.CUSTOM_EVENT],n))}"timeupdate"!==t&&r.writeTLog.apply(r,Er(["web player receive::"+t],n))},this.inputFilters=[],this.config=t||{},this.ready=!0,this.startLoad=0,this.hostIPC=e,this._ended=!1,this._seeking=!1,this._playbackRate=1,this._muted=!1,this._paused=!0,this._loop=!1,this._playing=!1,this.eventBus=new L.EventBus,this.initEvents()}return e.prototype.initEvents=function(){this.hostIPC?(this.hostIPC.off&&"function"==typeof this.hostIPC.off&&this.hostIPC.off("player-events",vents",this.onPlayerEvent)):this.eventBus.emit(L.PlayerEvent.ERROR,{code:"10103"})},e.prototype.writeTLog=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=["time:"+(new Date).getTime()+","];e.forEach((function(e){switch(typeof e){case"object":r.push(JSON.stringify(e));break;case"undefined":break;default:r.push(e)}}));var i=r.join(",");fetch("http://127.0.0.1:62068/type=write_tlog&module=web&content="+i.length+"&log_level=3",{method:"post",body:i}).catch((function(e){console.log("write tlog error",e)}))},e.prototype.setConfig=function(e){e&&Object.assign(this.config,e)},e.prototype.reset=function(){this.lastSegment=null,this.startLoad=0,this.currentTime=0,this._ended=!1,this.hostIPC.send("stop"),this.writeTLog("web player call native::stop")},Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.hostIPC.send("setLoop",e)},enumerable:!1,configurable:!0}),e.prototype.seek=function(e){e=parseInt(e.toString(),10),isNaN(e)||e<0||e!=this.currentTime&&(this.lastSegment?(this._seeking=!ntBus.emit(L.PlayerEvent.PLAY),this.hostIPC.send("seek",e),this.writeTLog("web player call native::seek",e)):this.startLoad=e)},e.prototype.getBuffered=function(e,t){return void 0===t&&(t=0),!this.s.lastSegment?new L.BufferRange([0,this.lastSegment.duration]):L.BufferRange.Empty},e.prototype.getBufferInfo=function(e,t){return void 0===t&&(t=0),this.getBuffered(e,t).getBufferInfo(this.currentTime)},e.prototype.setupInputFilter=function(e){this.inputFilters.push(e)},e.prototype.removeInputFilter=function(e){this.inputFilters=this.iew Error("Method not implemented.")},e.prototype.removeRenderFilter=function(e){throw new Error("Method not implemented.")},e.prototype.createTrack=function(e,t,r){},e.prototype.catch=function(e){throw new Error("Method not implemented.")},e.prototype.once=function(e,t,r){var i=this,n=!1,o=function(){for(var rnts[a];i.off(e,o),n||(n=!0,t.apply(void 0,r))};return this.one.stop=function(){this.reset()},e.prototype.getVideoPlaybackQuality=function(){return{creationTime:0,droppedVideoFrames:0,totalVideoFrames:1,corruptedVideoFrames:0}},e.prototype.destroy=function(){this.lastSegment=null,this.eventBus.off(),this.hostIPC.send("stop"),this.hostIPC.off&&"function"==typeof this.hostIPC.off&&this.hostIPC.off("player-events",this.onPlayerEvent),this.writeTLog("web player call native::stop")},Object.defineProperty(e.prototype,"supportFormats",{get:function(){return[L.ContainerFormat.ANY]},enumerable:!1,configurable:!0}),e.prototype.isSupportFeature=function(e){return!1},e.prototype.requestFeature=function(e){},e.prototype.pip=function(){},e.prototype.on=function(e,t){return this.eventBus.on(e,t),this},e.prototype.off=function(e,t){return this.eventBus.off(e,t),this},Object.defineProperty(e.prototype,"autoplay",{get:function(){return this._autoplay},set:function(e){this._autoplay=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.hostIPC.sendSync("getCurrentTime")},set:function(e){this.seek(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return!this.config.isLive&&this.lastSegment&&this.lastSegmentrRange.Empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.hostIPC.send("setMute",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this.hostIPC.send("setSpeed",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){var e=this.hostIPC.sendSync("getVolume");rthis._volume=e,this.hostIPC.send("setVolume",e),this.eventBus.emit(L.PlayerEvent.VOLUME_CHANGE,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.hostIPC.sendSync("getDuration")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seeking",{get:function(){return this._seeking},enumerable:!1,configurablse"),this.writeTLog("web player call native::pause")},e.prototype.play=function(){var e=this;return this.hostIPC.send("play"),this.writeTLog("web player call native::play"),Promise.resolve().then((function(){e.eventBus.emit(L.PlayerEvent.PLAY)})),Promise.resolve()},e.prototype.changeDuration=function(e){},e.prototype.removeBuffer=function(e,t){},Object.defineProperty(e.prototype,"videoHeight",{get:function(){return this.hostIPC.sendSync("getVideoHeight")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoWidth",{get:function(){return this.hostIPC.sendSync("getVideoWidth")},enumerable:!1,configurable:!0}),e.prototype.getTrack=function(e,t){return void 0===t&&(t=0),!1},e.prototype.appendMedia=function(e,t,r){var i=this;void 0===r&&(r=0),this.config.filter&&(e=this.config.filter(e));var n=!1;n=e.hasOwnProperty("smartStream")?e.smartStream:0===e.data.indexOf("#EXTM3U")||0===e.data.indexOf("#PLSEXTM3U");var o={url:e.data,smartStream:n};["drmTypey"].forEach((function(t){e.hasOwnProperty(t)&&(o[t]=e[t])}));var a=!0;this.lastSegment&&(["clientR1","serverR2","drmKey"].forEach((function(e){var t=i.lastSegment.hasOwnProperty(e),r=o.hasOwnProperty(e);t||r?t&&r?i.lastSegment[e]!==o[e]&&(a=!1):a=!1:a=!0})),a||(this.startLoad=this.currentTime)),this.lastSegment&&a?(this.hostIPC.send("switchQuality",o),this.writeTLog("web player call native::switchQuality",o)):(o.playType=e.hasOwnProperty("playType")?e.playType:this.config.isLive?2:1,["standbyH264Url","videoEnhance","firstSegUrl","headers"].forEach((function(t){e.hasOwnProperty(t)&&(o[t]=e[t])})),!this.config.isLive&&e.duration&&e.duration!==Number.POSITIVE_INFINITY&&(o.duration=e.duration),this.hostIPC.send("openVideo",o,this.startLoad),this.writeTLog("web plartLoad),this.startLoad=0,this.lastSegment=o,this._autoplay&&this.play())},e.prototype.reload=function(){},br([j("inputFilters")],e.prototype,"appendMedia",null),e}()},wr=r(26),Lr=r.n(wr),Or=r(18),xr={flag:!1,id:0,unload:function(e){}},Pr=Object.keys(n.a).map((function(e){return n.a[e]})),Dr=function(){function e(e){var t,r=this;void 0===e&&(e="core"),this.coreName=e,this.pendingEventRegister=[],this.pendingPropSetter=[],this.bridgeEventList=Pr,Object.defineProperty(this,e,{get:function(){return t},set:function(e){if(e!==t&&(t=e,r.pendingPropSetter.forEach((function(e){var r=e[0],i=e[1];t[r]=i})),r.pendingPropSetter=[],r.pendingEventRegister.forEach((function(e){var r=e[0],i=e[1],n=e[2];t[n||"on"](r,i)})),r.pendingAPI)){var i=function(e,t,r){switch(r.length){case 0:return e[t]();case 1:return e[t](r[0]);case 2:return e[t](r[0],r[1]);default:return e[t].apply(e,r)}}(t,r.pendingAPI[0],r.pendingAPI.slice(1));if(i instanceof Promise&&r.pendingAPI[2]){var n=r.pendingAPI[2].defer;i.then((function(e){return n.resolve(e)}),(function(e){return n.reject(e)}))}r.pendingAPI=null}}})}return Object.defineProperty(e.prototype,"locked",{get:function(){return xr.flag},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){var e=this[this.coreName];return!e||e.paused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){var e=this[this.coreName];return!!e&&e.playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){var e=this[this.coreName];return!!e&&e.ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seeking",{get:function(){var e=this[this.coreName];return!!e&&e.ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){var e=this[this.coreName];return e?e.buffered:Or.a.Empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){var e=this[this.coreName];return e?e.currentTime:0},set:function(e){if(!this.locked){var t=this[this.coreName];t?t.currentTime=e:this.cachePropSet("currentTime",e)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this[this.coreName];return e?e.duration:NaN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){var e=this[this.coreName];return!!e&&e.loop},set:function(e){var t=this[this.coreName];t?t.loop=e:this.cachePropSet("loop",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoplay",{get:function(){var e=this[this.coreName];return!!e&&e.autoplay},set:function(e){var t=this[this.coreName];t?t.autoplay=e:this.cachePropSet("autoplay",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){var e=this[this.coreName];return!!e&&e.muted},set:function(e){var t=this[this.coreName];t?t.muted=e:this.cachePropSet("muted",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){var e=this[this.coreName];return e?e.playbackRate:1},set:function(e){var t=this[this.coreName];t?t.playbackRate=e:this.cachePropSet("playbackRate",e)},enumerable:!1,configurable:!0}),e.prototype.cachePropSet=function(e,t){for(var r=0;r<this.pendingPropSetter.length;r++)if(this.pendingPropSetter[r][0]===e)return void(this.pendingPropSetter[r][1]=t);this.pendingPropSetter.push([e,t])},Object.defineProperty(e.prototype,"videoHeight",{get:function(){var e=this[this.coreName];return e?e.videoHeight:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoWidth",{get:function(){var e=this[this.coreName];return e?e.videoWidth:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){var e=this[this.coreName];return e?e.volume:1},set:function(e){var t=this[this.coreName];t?t.volume=e:this.cachePropSet("volume",e)},enumerable:!1,configurable:!0}),e.prototype.lock=function(e){this.lockedPaused=this.paused,this.pause(),xr.flag=!0,xr.id=e},e.prototype.unlock=function(e){xr.id!==e&&-6!==e||(xr.flag=!1,this.lockedPaused||this.play())},e.prototype.createSession=function(){var e=this[this.coreName];if(e)return e.createSession()},e.prototype.closeSession=f){var e=this[this.coreName];if(e)return e.destroy();this.pendingAPI=["destroy"]},e.prototype.loadSource=function(e,t){var r=this[this.coreName];if(r)return r.loadSource(e,t);this.pendingAPI=["loadSource",[e,t]]},e.prototype.pause=function(){if(this.locked)this.lockedPaused=!0;else{var e=this[this.coreName];if(e)return e.pause();this.pendingAPI=["pause"]}},e.prototype.play=function(){if(this.locked)return this.lockedPaused=!1,Promise.reject("locked");var e=this[this.coreName];if(e)return e.play();var t=function(){var e={},t=new Promise((function(t,r){e.resolve=t,e.reject=r}));return t.defer=e,t}();return this.pendingAPI=["play",null,t],t},e.prototype.seek=function(e){if(!this.locked){var t=this[this.coreName];if(t)return t.seek(e);this.pendingAPI=["seek",e]}},e.prototype.stop=function(){if(!this.locked){var e=this[this.coreName];if(e)return e.stop();this.pendingAPI=["stop"]}},e.prototype.isSupportFeature=function(e){if(this.locked)return!1;var t=this[this.coreName];return t?t.isSupportFeature(e):void 0},e.prototype.requestFeature=function(e){if(!this.locked){var t=this[this.coreName];t&&t.requestFeature(e)}},e.prototype.addEventListener=function(e,t,r){this.on(e,t)},e.prototype.removeEventListener=function(e,t,r){this.off(e,t)},e.prototype.off=function(e,t,r){if(-1!==this.bridgeEventList.indexOf(e)){var i=this[this.coreName];i?i.off(e,t):this.pendingEventRegister=this.pendingEventRegister.filter((function(r){var i=r[0],n=r[1];return i!==e||n!==t}))}else this.eventBus&&this.eventBus.off(e,t)},e.prototype.on=function(e,t,r){if(-1!==this.bridgeEventList.indexOf(e)){var i=this[this.coreName];return i?i.on(e,t):this.pendingEventRegister.push([e,t]),this}this.eventBus&&this.eventBus.on(e,t)},e.prototype.once=function(e,t,r){if(-1!==this.bridgeEventList.indexOf(e)){var i=this[this.coreName];return i?i.once(e,t):this.pendingEventRegister.push([e,t,"once"]),this}this.eventBus&&this.eventBus.once(e,t)},e}();!function(e){e[e.VIDEO=0]="VIDEO",e[e.MVIDEO=1]="MVIDEO",e[e.CANVAS=2]="CANVAS",e[e.NATIVE=3]="NATIVE"}(_r||(_r={})),function(e){e.OPENING="opening",e.ENDING="ending",e.RECORD="record"}(Rr||(Rr={})),function(e){e.MEDIA_RESOURCE="media_resource",e.MANIFEST="manifest",e.SEGMENT="segment",e.LICENSE="license"}(Sr||(Sr={})),function(e){e.MP4="MP4",e.HLS="HLS",e.DASH="DASH",e.FLV="FLV",e.MMP4="MMP4",e.BLOB="BLOB"}(Ar||(Ar={}));var kr=Ar;var Ir,Mr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Cr=function(){return(Cr=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Nr={abr:!0,manifestConfig:{forceHttps:!0}},Ur=function(e){function t(t){var r=e.call(this)||this;return r.config=t,r.currentElements=[],r.elementCache={},r.container=document.createElement("div"),r.container.className="core",r.container.style.height="100%",r.config.container.insertAdjacentElement("beforeend",r.container),r}return Mr(t,e),t.prototype.init=function(){},t.prototype.prepareAttachedElement=function(e){var t=this;_r.NATIVE,this.currentElements.length>0&&(this.currentElements=this.currentElements.filter((function(e){return e instanceof HTMLElement&&e.parentNode.removeChild(e),!1}))),this.elementCache[e]||(this.elementCache[e]=function(e,t){var r=[];switch(e){case _r.CANVAS:var i=document.createElement("canvas");i.style.maxWidth="100%",i.style.maxHeight="100%",i.style.position="relative",i.style.top="50%",i.style.left="50%",i.style["-webkit-transform"]="translate(-50%,-50%)",i.style.transform="translate(-50%,-50%)",Fr(i,t.renderAttr,t.renderStyle),r.push(i);break;case _r.MVIDEO:for(var n=0;n<3;n++){var o=derAttr,t.renderStyle),r.push(o)}break;case _r.VIDEO:var a=document.createElement("video");a.style.width="100%",a.style.height="100%",Fr(a,t.renderAttr,t.renderStyle),r.push(a);break;case _r.NATIVE:if(!t.engine||!t.engine.attached)throw new Error('Native MediaEngine must provide config:"config.engine.attached"');r.push(t.engine.attached)}return r}(e,this.config)),this.currentElements=this.elementCache[e],this.currentElements.forEach((function(e){e instanceof HTMLElement&&t.container.insertBefore(e,t.container.firstElementChild)}))},t.prototype.setConfig=function(e){Object.assign(this.config,e)},t.prototype.loadSource=function(e,t){var r=this;if(void 0===this.currentEngineType)throw new Error("must invoke switchEngine before loadSource");var i=t.drmInfo,n=!1;if(i&&i.type&&i.type!==L.EncryptMethodType.NONE&&(n=!0,i&&this.config.requestFilter&&this.config.requestFilter[Sr.LICENSE])){this.config.requestFilter[Sr.LICENSE];this.core.setConfig(this.transformDRMFilter(i,this.config.requestFilter[Sr.LICENSE]))}if(this.config.mediaFilter){var o=this.config.mediaFilter(i,t);o&&"function"==typeof o.then?o.then((function(i){i&&i.config&&r.core.setConfig(i.config),i&&i.source&&(e=i.source),r.core.loadSource(e,{duration:t.duration,encrypted:n})})).catch(n:t.duration,encrypted:n})})):(o&&o.config&&this.core.setConfig(o.config),o&&o.source&&(e=o.source),this.core.loadSource(e,{duration:t.duration,encrypted:n}))}else this.core.loadSource(e,{duration:t.duration,encrypted:n})},t.prototype.transformDRMFilter=function(e,t){var r,i;return{drm:{type:e.type,licenseServer:{url:e.licenseServer,getLicenseParams:function(n){var o={};return i=t({url:e.licenseServer,body:n,drmType:e.type},(function(e){var t,i;return t={},(i=new window.Promise((function(e,r){t.resolve=e,t.reject=r}))).defer=t,o=e,r=i})),o},getKeySession:function(e){return r.defer.resolve(e),i}}}}},t.prototype.prepareConfig=function(e,t,r){var i={};switch(t===kr.MP4||r?i.manifest=!1:i.manifest=Lr.a[t],e){case _r.VIDEO:i.manifest?i.engine=Tr.MSE:i.engine=Tr.Video;break;case _r.MVIDEO:i.engine=Tr.MVideo;break;case _r.NATIVE:i.manifest=!1,i.engine=Tr.Native;break;case _r.CANVAS:}return i},t.prototype.getLoader=function(){if(this.core)return this.core.getLoader()},t.prototype.switchEngine=function(e,t,r){if(void 0===r&&(r=!1),this.currentEngineType!==e||this.currentSourceType!==t){var i=this.prepareConfig(e,t,r);this.currentEngineType!==e&&(this.prepareAttachedElement(e),i.attached=1===this.currentElements.length?this.currentElements[0]:this.currentElements,"default"===this.config.ui&&this.currentElements.forEach((function(e){e.controls=!0}))),this.currentEngineType=e,this.currentSourceType=t,this.core?this.core.setConfig(i):this.core=new jt(Cr(Cr(Cr({},i),Nr),this.config.core)),this.core.loop=!!this.config.loop}},t}(Dr),Br=Ur;function Fr(e,t,r){t&&Object.keys(t).forEach((function(r){e.setAttribute(r,t[r])})),r&&Object.keys(r).forEach((function(t){e.style[t]=r[t]}))}window.CoreManager=Ur,function(e){e[e.AVC=27]="AVC",e[e.HEVC=173]="HEVC",e[e.VP8=139]="VP8",e[e.VP9=167]="VP9",e[e.AV1=32797]="AV1",e[e.MP3=86017]="MP3",e[e.AAC=86018]="AAC"}(Ir||(Ir={}));var jr,Gr,Vr,qr=function(){function e(){}return e.prototype.get=function(){return this.value},ion(t,r){return(e=Oproto__:[]}instat}||function(e,t){for]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();try{jr=JSON.parse(localStorage.getItem("_xmedia_record"))||{}}catch(e){jr={}}window.onbeforeunload=function(){clearTimeout(Gr);try{localStorage.setItem("_xmedia_record",JSON.stringify(jr))}catch(e){}};var $r,Wr=function(e){function t(t){var r=e.call(this)||this;return r.name=t,r.value=jr[t],r}return Hr(t,e),t.of=function(e){return[t,e]},t.prototype.set=function(e){this.value=e,this.store()},t.prototype.restore=function(){this.value=jr[this.name]},t.prototype.store=function(){jr[this.name]=this.value,clearTimeout(Gr),null==Vr&&(Vr=setTimeout((function(){Vr=null;try{localStorage.setItem("_xmedia_record",JSON.stringify(jr))}catch(e){}}),15e3)),Gr=setTimeout((function(){clearTimeout(Vr),Vr=null;try{localStorage.setItem("_xmedia_record",JSON.stringify(jr))}catch(e){}}),1e3)},t}(qr),zr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Kr=(($r={})[Ir.HEVC]="h265",$ t.import(y.MediaResource,"mediaResource"),t.import(y.Features,"features"),t.loadState(Wr.of("LastStream"),"lastStream"),t.lastStreamSpecs=[],t}return zr(t,e),t.prototype.main=function(){var e;if(this.context,2==this.lastStreamSpecs.length&&(e=this.mediaResource.getStream(this.lastStreamSpecs[0],this.lastStreamSpecs[1])),!e){var t=this.mediaResource.getLanguageList(),r=this.getStreamList(t[0].langCode);this.features.support4K||(r=r.filter((function(e){return"4k"!==e.name}))),e=r[0]}this.put(e)},t.prototype.getStream=function(e,t){return this.mediaResource?this.mediaResource.getStream(e,t):null},t.prototype.selectStream=function(e){var t=this.lastStreamSpecs,r=t[0],i=t[1];return this.lastStreamSpecs=[e.lang,e.id],this.put(e),r!=e.lang||i!=e.id},t.prototype.selectStreamSourceType=function(e){},t.prototype.getStreamList=function(e){if(this.mediaResource){"undefined"==e&&(e=void 0);var t=RegExp(this.features.supportCodecs.map((function(e){return Kr[e]})).join("|")),r=this.features.isSupportCodec(Ir.HEVC)?/h265/:/h264/,i=this.mediaResource.getStreamListBy(e,t).groupBy("name",["type",r]).List();return this.features.support4K||(i=i.filter((function(e){return"4k"!==e.name}))),i}return[]},t.Name=y.StreamSelect,t}(y),Xr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Qr=function(e){function t(t){var r=e.call(this)||this;return r.config=t||{},r.import(y.MediaResource,"PlayPosition"),"playPosition"),r}return Xr(t,e),t.prototype.main=function(){var e=0,t=null,r=this.mediaResource.id;this.config.record&&this.playPosition&&this.playPosition[r]>0&&(t=Rr.RECORD,e=this.playPosition[r]),this.config.opening&&this.mediaResource.timeline.opening>e&&(e=this.mediaResource.timeline.opening,t=Rr.OPENING),this.put([e,t])},t.prototype.setPlayPosition=function(e){var t=this.playPosition||{};0===e?(delete t[this.mediaResource.id],this.playPosition=t):(t[this.mediaResource.id]=e,this.playPosition=t)},t.Name=y.StartPoint,t}(y);var Jr=function(){function e(){this.delegateList=[]}return e.prototype.d){e.target.off("error",e.dispatcher),delete e.handlers,delete e.target,delete e.dispatcher})),this.delegateList=[]},e.prototype.handle=function(e,t,r){var i=this.delegateList.find((function(t){return t.target===e}));i||(i={target:e,handlers:[],dispatcher:function(e,t){i.handlers.forEach((function(r){var i=r[0],n=r[1];(null==n||n===e.from||e.from&&n==e.from.Name)&&i(e,t)}))}},this.delegateList.push(i),e.on("error",i.dispatcher)),i.handlers.push([t,r])},e}(),Zr=r(13),ei=r(10),ti=Object.keys(n.a).map((function(e){return n.a[e]})),ri=function(){function e(e){this.coreName=e,this.bridgeEventList=ti}return Object.defineProperty(e.prototype,"buffered",{get:function(){if(!this.destroyed)return this[this.coreName].buffered||Or.a.Empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.destroyed?0:this[this.coreName].currentTime||0},set:function(e){this.destroyed||(this[this.coreName].currentTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.destroyed)return this[this.coreName].duration||NaN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){if(!this.destroyed)return this[this.coreName]},set:function(e){this.destroyed||(this[this.coreName].loop=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoplay",{get:function(){if(!this.destroyed)return this[this.coreName].autoplay},set:function(e){this.destroyed||(this[this.coreName].autoplay=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){if(!this.destroyed)return this[this.coreName].muted},set:function(e){this.destroyed||(this[this.coreName].muted=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){if(!this.destroyed)return this[this.coreName].playbackRate},set:function(e){this.destroyed||(this[this.coreName].playbackRate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoHeight",{get:function(){return this.destroyed?0:this[this.coreName].videoHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoWidth",{get:function(){return this.destroyed?0:this[this.coreName].videoWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this.destroyed?1:this[this.coreName].volume},set:function(e){this.destroyed||(this[this.coreName].volume=e)},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.eventBus.off(),delete this.bridgeEventList,this[this.coreName].destroy())},e.prototype.loadSource=function(e,t){this.destroyed||this[this.coreName].loadSource(e,t)},e.prototype.pause=function(){this.destroyed||this[this.coreName].pause()},e.prototype.play=function(){return this.destroyed?Promise.reject():this[this.coreName].play()},e.prototype.seek=function(e){this.destroyed||this[this.coreName].seek(e)},e.prototype.stop=function(){this.destroyed||this[this.coreName].stop()},e.prototype.isSupportFeature=function(e){if(!this.destroyed)return this[this.coreName].isSupportFeature(e)},e.prototype.requestFeature=function(e){this.destroyed||this[this.coreName].requestFeature(e)},e.prototype.off=function(e,t,r){this.destroyed||(-1!==this.bridgeEventList.indexOf(e)?this[this.coreName].off(e,t):this.eventBus&&this.eventBus.off(e,t))},e.prototype.on=function(e,t,r){if(!this.destroyed){if(-1!==this.bridgeEventList.indexOf(e))return this[this.coreName].on(e,t),this;this.eventBus&&this.eventBus.on(e,t)}},e.prototype.once=function(e,t,r){if(!this.destroyed){if(-1!==this.bridgeEventList.indexOf(e))return this[this.coreName].once(e,t),this;this.eventBus&&this.eventBus.once(e,t)}},Object.defineProperty(e.prototype,"ended",{get:function(){if(!this.destroyed)return this[this.coreName].ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){if(!this.destroyed)return this[this.coreName].paused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){if(!this.destroyed)return this[this.coreName].playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seeking",{get:function(){if(!this.destroyed)return this[this.coreName].seeking},enumerable:!1,configurable:!0}),e}(),ii=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ni=function(e){function t(t){var r=e.call(this)||this;return r.adSDK=t,r.import(y.MediaResource,"mediaResource"),r}return ii(t,e),t.prototype.setSDK=function(e){this.adSDK=e},t.prototype.main=function(){var e=this;this.adSDK?this.adSDK.load(this.mediaResource.raw).then((function(t){e.put(t)})):this.put(null)},t.Name=y.Ad,t}(y),oi=[{name:"YoukuHD",reg:/(youku_hd|youkuhd)\/([\d.]+)/i},{name:"YoukuHD",reg:/(youku_hd|youkuhd);/i},{name:"Youku",reg:/(youku|youku_hd|youkuhd)\/([\d.]+)/i},{name:"Wechat",reg:/(micromessenger)\/([\d.]+)/i},{name:"QQ",reg:/(qq)\/([\d.]+)/i},{name:"Weibo",reg:/(weibo).*weibo__([\d.]+)/i},{name:"QZone",reg:/(qzone)\/.*_qz_([\d.]+)/i},{name:"Baidu",reg:/(baiduboxapp)\/([\d.]+)/i},{name:"DingDing",reg:/(aliapp\(dingtalk)\/([\d.]+)/i},{name:"Taobao",reg:/(aliapp\(tb)\/([\d.]+)/i},{name:"Alipay",reg:/(alipayclient|aliapp\(AP)\/([\d.]+)/i},{name:"AliTrip",reg:/(alitrip|aliapp\(lx)\/([\d.]+)/i},{name:"UC",reg:/(ucbrowser)\/([\d.]+)/i},{name:"WindVane",reg:/(windvane)\/([\d.]+)/i},{name:"Liebao",reg:/(liebao[^/]*)\/([\d.]+)/i},{name:"360",reg:/(qihoobrowser)\/([\d.]+)/i},{name:"360SoSuo",reg:/(mso_app)\s*\(([\d.]+)/i},{name:"QQLive",reg:/(qqlivebrowser)\/([\d.]+)/i},{name:"QQBrowser",reg:/(qqbrowser)\/([\d.]+)/i},{name:"Iqiyi",reg:/(iqiyiversion)\/([\d.]+)/i},{name:"BaiduBrowser",reg:/(baidubrowser)\/([\d.]+)/i},{name:"Sogou",reg:/(sogou[\w]*browser)\/([\d.]+)/i},{name:"Edge",reg:/(edge)\/([\d.]+)/i},{name:"Opera",reg:/(opr)\/([\d.]+)/i,skipIfMatched:!0},{name:"Chrome",reg:/(chrome)\/([\d.]+)/i,skipIfMatched:!0},{name:"Chrome",reg:/(crios)\/([\d.]+)/i,skipIfMatched:!0},{name:"IEMobile",reg:/(iemobile)[/]([\d.]+)/i,skipIfMatched:!0},{name:"Firefox",reg:/(firefox)\/([\d.]+)/i,skipIfMatched:!0},{name:"Opera",reg:/(opera)(?:.*version|)[ /]([\d.]+)/i,skipIfMatched:!0},{name:"Safari",reg:/(version)(applewebkit)[/]([\d.]+).*(safari)[/]([\d.]+)/i,skipIfMatched:!0},{name:"Safari",reg:/(webkit)[ /]([\d.]+).*(version)[/]([\d.]+).*(safari)[/]([\d.]+)/i,skipIfMatched:!0},{name:"IE",reg:/(msie) ([\d.]+)/i},{name:"IE",reg:/trident.*(rv)(?::| )([\d.]+)/i}],ai=[{name:"IPad",reg:/(ipad|iphone.*youku_hd\/[\d.]+)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"IPad",reg:/(ipad|iphone.*youku_hd)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"IPod",reg:/(ipod)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"WindowsPhone",reg:/(windows phone)/i,mobile:!0,breakIfMatched:!0},{name:"IPhone",reg:/(iphone)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"Android",reg:/(android)/i,mobile:!0,breakIfMatched:!0},{name:"Windows",reg:/(win)/i,desktop:!0,breakIfMatched:!0},{name:"Mac",reg:/(mac)/i,desktop:!0,breakIfMatched:!0},{name:"Linux",reg:/(linux)/i,desktop:!0,breakIfMatched:!0}];function si(e,t){for(var r=[],i=0;i<e.length;i++)if(!r.length||!e[i].skipIfMatched){var n=e[i].reg.exec(t);if(n&&r.push({map:e[i],match:n}),r.length&&e[i].breakIfMatched)break}return r}var ui;ui=function(e){void 0===e&&(e="");var t={ext:{}};e||"object"!=typeof navigator||(e=navigator.userAgent||"");for(var r=si(oi,e),i=0;i<r.length;i++){var n=r[i],o=n.match,a=n.map,s={browser:o[5]||o[3]||o[1]||"",version:o[4]||o[2]||"0"};if(s.browser){var u=a.name.toLowerCase();void 0===t.name?(t["is"+a.name]=!0,t.version=s.version,t.majorVersion=parseInt(s.version,10),t.name=u):(t["is"+a.name]=!0,t.ext[uar c=si{}},l=c.match,p=c.map;return l[0]&&(t["is"+p.name]=!0,t.platform=p.name.toLowerCase()),t.isMobile=p.mobile||!1,t.isDesktop=p.desktop||!1,t.isIOS=p.ios||!1,t}();var ci,li,pi=[["video/mp4",Zr.a.MP4],["video/m2ts",Zr.a.M2TS],["video/webm",Zr.a.WEBM]],di=[['video/mp4;codecs="avc1.64001f"',Ir.AVC],['video/mp4;codecs="hvc1.1.6.L63.90"',Ir.HEVC]],hi=document.createElement("video"),fi=pi.filter((function(e){return""!=hi.canPlayType(e[0])})).map((function(e){return e[1]}));window.MediaSource?(ci=!0,li=di.filter((function(e){return window.MediaSource.isTypeSupported(e[0])})).map((function(e){return e[1]}ar mi,yi,gi=[],vi=function(){function e(){this.supportFormats=fi,this.suppoupport4K=!0,this.supportDRMList=gi}return Object.defineProperty(e,"supportFormats",{get:function(){return fi},enumerable:!1,configurable:!0}),Object.defineProperty(e,"supportCodecs",{get:Object.defineProperty(e,"supportMSE",{get:function(){return ci},enumerable:!1,configurable:!0}),Object.defineProperty(e,"support4K",{get:function(){return!0},enumerable:!1,configurable:!0}),e.init=function(){return Ei.then((function(){return new e}))},e.isSupportFormat=function(e){return fi.indexOf(e)>=0},e.isSupportCodec=function(e){return li.indexOf(e)>=0},e.prototype.isSormats.indexOf(e)>=0},e.prototype.isSupportCodec=function(e){return this.supportCodecs.indexOf(e)>=0},e.prototype.isSupportDRM=function(e){return this.supportDRMList.indexOf(e)>=0},e.prototype.isSupportWebDRM=function(e){var t={};return~this.supportDRMList.indexOf(ei.a.FAIRPLAY)?t.cbcs=1:~this.supportDRMList.indexOf(ei.a.WIDEVINE)&&(ui.isChrome&&parseInt(ui.version,10)>70&&(t.cbcs=1),t.cenc=1),e?!!t[e]:Object.keys(t).length>0},e.prototype.update=function(e,t){var r=this;Array.isArray(t)?"@@"===t[0]?this[e]=t.slice(1):(this[e]||(this[e]=[]),t.forEach((function(t){r[e].indexOf(t)<0&&r[e].push(t)}))):this[e]=t},e.fairplayCheck=function(){var e=navigator.userAgent.match(/Version\/([\d.]+)\s*Safari\/[\d.]+/);return e&&parseInt(e[1])>10&&window.WebKitMediaKeys&&window.WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4")},e.widevineSupportCheck=function(){return navigator.requestMediaKeySystemAccess?navigator.requestMediaKeySystemAccess("com.widevine.alpha",[{initDataTypes:[],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.64001e"',robustness:"SW_SECURE_CRYPTO"}],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}]}]).then((function(){return!0})).catch((function(){return!1})):window.PromirplayCheck()&&gi.push(ei.a.FAIRPLAY),vi.widevineSupportCheck().then((function(t)e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&functi(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ri=(Zr.a.MP4,Zr.a.M2TS,Zr.a.WEBM,Ir.AVC,Ir.HEVC,document.createElement("video"),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}retution(e){var t=this,r=Object.keys(e),i=r.map((function(t){return"function"==typeof e[t]?e[t]():e[t]}));Promise.all([bi.init()].concat(i)).then((function(e){var i=e[0];e.slice(1).forEach((function(e,t){i.update(r[t],e)})),t.put(i)}))},t.prototype.update=function(e){var t=this.take();Object.keys(e).forEach((function(e){e[e.Text=0]="Text",e[e.Expression=1]="Expression"}(mi||(mi={})),function(e){e[e.Element=0]="Element",e[e.Text=1]="Text"}(yi||(yi={}));"Math,true,false,instanceof,new,null".split(",").reduce((function(e,t){return e[t]=!0,e}),{});function Ai(e){if(e.type===mi.Expression){var t=e.debug?"debugger;":"",r={};e.ids.forEach((function(e){var i=e.split(".")[0];r[i]||(r[i]=1,t+="$signals"===i?"var $signals=signals.reduce(function(a,b){a[b]=true;return a;},{})\n":"var "+i+"=state."+i+";\n")})),e.filters&&e.filters.length>0&&e.filters.forEach((funcers.___;\n"}));var i=e.value,n=e.value.replace(/'/g,"\\'");try{return new Function("state,signals,filters",t+"try{ return "+i+";}catch(e){console.warn('express resolve error :"+n+"  :-> '+e.message);return '';}")}catch(e){throw new Error('expression "'+i+'" has SyntaxError:'+e.message)}}else if(e.type===mi.Text)return e.value}var Ti,wi=function(){return(wi=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Li=function(){function e(e){this.matrix=e,this.clones=[]}return e.prototype.clone=function(){var e=new this.matrix.constructor(this.matrix);return e.dna=this,this.clones.push(e),e},e.prototype.findClone=function(e){if(this.matrix.indexs.every((function(t,r){return t[0]===e[r]})))return this.matrix;var t=this.clones.filter((function(t){return t.indexs.every((function(t,r){return t[0]===e[r]}))}));return t.length>1&&console.error("indexs",e,this),t[0]},e.prototype.findAllClone=function(){return this.clones},e.prototype.decay=function(e){return e===this.matrix?(delete e.dna,!1):(this.clones=this.clones.filter((function(t){return t!==e})),!0)},e.prototype.isMatrix=function(e){return this.matrix===e},e.getScope=function(e,t,r){for(var i=r,n=0,o=wi({},r),a=t.split("."),s=0;s<a.length;s++){if("$"===a[s]){var u=e.indexs[n++];if(i=i[u[0]],o[u[1]||"$each"]=i&&"object"==typeof i?wi(wi({},i),{$index:u[0]}):i,o.$ine i=i[a[s]];if(void 0===i){console.error("state");break}}return o},e}();!function(e){e[e.INIT=0]="INIT",e[e.OR=1]="OR",e[e.AND=2]="AND",e[e.JOINT=3]="JOINT"}(Ti||(Ti={}));var Oi,xi,Pi={"|":Ti.OR,"&":Ti.AND,"+":Ti.JOINT},Di=["*"," | "," & "," + "],ki=/(?=[+&|])/,Ii=function(){function e(){}return e.parseFromString=function(t,r){var i=new e;return t.split(ki).forEach((function(e,t){var n=0===t?void 0:Pi[e[0]],o=r(e.slice(t>0?1:0));i.parse(n,o)})),i},e.prototype.parse=function(t,r){if(void 0===t&&(t=Ti.INIT),r instanceof e){if((i=r).tree[1]!==Ti.OR||!i.tree.slice(2).every((function(e){return!Array.isArray(e)})))throw new Error("SubjectOR");r=r.tree.slice(2)}var i;if(t===Ti.INIT){if(this.tree||this.currentRule)throw new Error("");return this.tree=this.currentRule=[null,Ti.INIT,r],tht)this.currentRule[1]=t,this.currentRule.push(r);else if(n<t){var o=[this.currentRule,t,this.currentRule.pop(),r];thihis.currentRule[0])this.currentRule=this.currentRule[0];else{o=[null,Ti.INIT,this.currentRule];this.currentRule[0]=o,this.currentRule=o,this.tree=o}this.parse(t,r)}return this},e.prototype.dump=function(e,t){var r=this;return void 0===t&&(t=this.tree),("number"==typeof t[1]?t.slice(2):t).map((function(t){return Array.isArray(t)?"number"==typeof t[1]?r.dump(e,t):"("+t.map((function(t){return e?e(t):t})).join(" | ")+")":e?e(t):t})).join(Di[t[1]])},e.prototype.clean=function(){this.tree=null,this.currentRule=null},e.prototype.forEach=function(e,t){var r=this;void 0===t&&(t=this.tree),("number"==typeof t[1]?t.slice(2):t).forEach((function(t){Array.isArray(t)?r.forEach(e,t):e(t)}))},e.prototype.match=function(e,t,r,i,n){var o=this;it[1])return n===Ti.AND&&r<i-1?e.has(t):e.hasLast(t);switch(t[1]){case Ti.OR:return t.slice(2).some((function(r,i){return o.match(e,r,i,t.length,t[1])}));case Ti.AND:return t.slice(2).every((function(r,i){return o.match(e,r,i,t.length,t[1])}));case Ti.JOINT:return e.match(t.slice(2));case Ti.INIT:return e.hasLast(t[2]);default:throw new Error("invalid rule relation Type:"+t[1])}},e.RelationType=Ti,e}();!function(e){e.Debounce="^",e.Throttle="-",e.Delay="+",e.ElapseAbove=">",e.ElapseBelow="<",e.Count="*"}(Oi||(Oi={})),function(e){e[e.Active=0]="Active",e[e.Clear=1]="Clear"Oi[e].replace("-","\\-").replace("^","\\^")})).join(""),Ci=new RegExp("(["+Mi+"])"),Ni=new RegExp("^-?[^"+Mion e(e){var t;void 0===e&&(e={}),this.scope=e,this.dependents=((t={}).$=[],t)}return e.prototype.addSignal=function(e,t){var r=Fi.of(t||this.scope,e);r.signalManager=this,this.dependents[r.depSignal]||(this.dependents[r.depSignal]=[]),this.dependents[r.depSignal].push(r),this.autoClearFlag&&r.type===xi.Active&&"$"===r.depSignal&&r.depType===xi.Active&&this.addSignal("-"+r.name+"=-$",r.scope)},e.prototype.autoClear=function(){var e=this;this.dependents.$.filter((function(e){return e.depType===xi.Active&&e.type===xi.Active})).forEach((function(t){e.addSignal("-"+t.name+"=-$",t.scope)})),this.autoClearFlag=!0},e.prototype.trigger=function(e,t,r){e.trigger(t,r,this.dependents)},e.prototype.get=function(e,t){var r=(t||this.scope)[e];return!!r&&r.state},e.prototype.getAll=function(){return this.dependents.$},e.DefaultSignal="$",e}(),Fi=function(){function e(e,t){if(this.throttleTs=0,e){-1===e.indexOf("=")&&(e=e.replace(Ni,"$&=$"));var r=e.split("=").filter((function(e){return e.trim()})),i=r[0],n=r[1];this.name=i,"-"===n[0]?(n=n.slice(1),this.depType=xi.Clear):this.depType=xi.Active;var o=n.split(Ci).filter((function(e){return e.trim()}));if(this.depSignal=o[0],this.operator=o[1],this.operand=o.slice(2).join(""),"-"===this.name[0]?(this.type=xi.Clear,this.name=this.name.slice(1)):this.type=xi.Active,"!"===this.name[0]&&(this.pulse=1,this.name=this.name.slice(1)),"$"===this.name&&(this.depSignal=null),/[<>]/.test(this.operator)&&(this.depType=xi.Clear),"*"===this.operator&&!Ui.test(this.operand))throw new Error('unsupported operand "'+this.operand+'" expect like 2 or 2n+1')}this.setScope(t||{})}return e.of=function(t,r){return new e(r,t)},Object.defineProperty(e.prototype,"signalName",{get:function(){return(this.type===xi.Active?"":"-")+this.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ID",{get:functhis.operator||"")+(thisurable:!0}),e.prototype.setScope=function(e){var t=this;this.scope&&this.scope[this.name]&&(this.scope[this.name].signals=this.scope[this.name].signals.filter((function(e){return e!==t}))),this.scope=e,this.scope[this.name]||(this.scope[this.name]={signals:[],ct:0}),this.scope[this.name].signals.find((function(e){return e.ID===t.ID}))||(this.scope[this.name].signals.push(this),this.depSignal&&!this.scope[this.depSignal]&&(this.scope[this.depSignal]={signals:[],ct:0}))},e.prototype.clearSignal=function(){clearTimeout(this.delayTimers),this.delayTimers=null,clearTimeout(this.debounceTimers),this.debounceTimers=null},e.prototype.isDependOn=function(e){return this.depSignal===e},e.prototype.isBaseSignal=function(){return this.isDependOn("$")&&this.type==xi.Active},e.triggerSignalInScope=function(e,t,r,i){e[t]&&e[t].signals.filter((function(e){return e.type===xi.Active})).forEach((function(e){e._trigger({emitSignal:i},r,e.signalManager.dependents)}))},e.clearSignalInScope=function(e,t,r,i){e[t]&&e[t].signals.filter((function(e){return e.type===xi.Clear})).forEach((function(e){e._trigger({emitSignal:i},r,e.signalManager.dependents)}))},e.prototype._trigger=function(e,t,r){var i=this.scope,n=this.name,o=this.type;this.depSignal;if(o===xi.Clear)i[n].signals.forEach((function(e){e.clearSignal()})),void 0===i[n].state||!0===i[n].state||this.pulse||!i[n].signals.some((function(e){return e.type==xi.Active}))?(i[n].state=!1,i[n].elapsed=Date.now()-i[n].ts,e.emitSignal("-"+n,t),r[n]&&r[n].length>0&&r[n].filter((function(e){return e.depType===o})).forEach((function(o){o.trigger(e,t,r,{elapsed:i[n].elapsed})}))):"$"===n&&r[n]&&r[n].length>0&&r[n].filter((function(e){return e.depType===o})).fort,r,{ct:i[n]})}));else{var a=!i[n].state;i[n].state=!0,delete i[n].elapsed,i[n].ct++,a||this.pulse||!i[n].signals.some((function(e){return e.type==xi.Clear}))?(e.emitSignal(n,t),i[n].ts=Date.now(),r[n]&&r[n].length>0&&r[n].filter((function(e){return et,r,{ct:i[n]})}))):"$"===n&&r[n]&&r[n].length>0&&r[n].filter((function(e){return e.depType===o})).forEach((function(o){o.trigger(e,t,r,{ct:i[n]})}))}},e.prototype.trigger=function(e,t,r,i){var n,o,a,s=this;if(void 0===i&&(i={}),this.operator)switch(this.operator){case Oi.Debounce:clearTimeout(this.debounceTimers),this.debounceTimers=window.setTimeout((function(){s._trigger(e,t,r)}),+this.operand||1e3);break;case Oi.Throttle:var u=Date.now();u-this.throttleTs>(+this.operand||1e3)&&(this._trigger(e,t,r),this.throttleTs=u);break;case Oi.Delay:null!==this.delayTimers&&void 0!==this.delayTimers||(this.delayTimers=window.setTimeout((function(){s._trigger(e,t,r),s.delayTimers=null}),+this.operand||1e3));break;case Oi.ElapseAbove:i.elapsed&&+this.operand<=i.elapsed&&this._trigger(e,t,this.scope);break;case Oi.ElapseBelow:i.elapsed&&+this.operand>=i.elapsed&&this._trigger(e,t,r);break;case Oi.Count:n=this.operand,o=i.ct,((a=n.match(ji))&&(o-parseInt(a[2]||0))%+a[1]==0||o===parseInt(n))&&this._trigger(e,t,r);break;default:this._trigger(e,t,r)}else this._trigger(e,t,r)},e.Default="$",e.Type=xi,e}(),ji=/(\d+)n([+-]\d+)?/;var Gi=function(){function e(){this._handlers={}}return e.prototype.off=function(e,t){t?this._handlers[e]=this._handlers[e].filter((function(e){return e!==t})):e?this._handlers[e]=[]:this._handlers={}},e.prototype.once=function(e,t){var r=this,i=!1,n=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];r.off(e,n),i||(i=!0,t.apply(void 0,o))};this.on(e,n)},e.prototype.addEventListener=function(e,t){this.on(e,t)},e.prototype.removeEventListener=function(e,t){this.off(e,t)},e.prototype.on=function(e,t,r){return this._handlers[e]?isFinite(r)?this._handlers[e].sps._handlers[e]=[t],this},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!e)return!1;var i=this._handlers[e];if(i&&i.length>0){var n=i.concat();n.forEach((function(e){e.apply(void 0,t)}))}},e}(),Vi=function(){function e(e,t){void 0===t&&(t=10),this.keyList=e,this.maxCount=t,this.list=[]}return e.prototype.equal=function(e,t){return this[r]===t[r]})):e===t},e.prototype.match=function(e){for(var t=this,r=0,i=!1;r<=this.list.length-e.length&&!i;)i=e.every((function(i,n){var o=t.list[t.list.length-e.length+n-r];return!!o&&(Array.isArray(i)?i.some((function(e){return t.equal(e,o.subject)})):o&&t.equal(prototype.add=function(e,t){var r=this.r&&this.equal(r.subject,e)?(r.ft||(r.ft=r.ts,r.c=1),r.ts=Date.now(),r.c++):(this.list.push({subject:e,ts:Date.now(),eventData:t}),this.list.length>this.maxCount&&this.list.shift())},e.prototype.has=function(e){for(var t=this,r=function(r){return Array.isArray(e)&&e.some((function(e){return t.equal(e,t.list[r].subject)}))||i.equal(i.list[r].subject,e)?{valuf o)return o.value}return!1},e.prototype.hasLast=function(e){var t=this,r=this.list[this.list.length-1].subject;return!(!Array.isArray(e)||!e.some((function(e){return t.equal(e,r)})))||this.equal(r,e)},e.prototype.clean=function(){this.list=[]},e}(),qi=function(setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Hi=[],$i=function(e){function t(t,r,i){var n=e.call(this)||this;return n.name=t,n.init=r,n.clean=i,n}return qi(t,e),t.add=function(e,r,i,n){var o=new t(e,i,n);return Hi.push({R:new RegExp("^("+r.join("|")+")$"),plugin:o}),o},t.findByEventName=function(e){var t=Hi.find((function(t){return t.R.test(e)}));return t&&t.plugin},t.findByName=function(e){var t=Hi.find((function(t){return t.plugin.name===e}));return t&&t.plugin},t.clean=function(e,t,r){var i=Hi.find((function(e){return e.R.test(r)}));return!(!i||!t[i.plugin.name])&&(i.plugin.clean.call(t[i.plugin.name].inst,e),!0)},t}(Gi),Wi=[],zi=new WeakMap,Ki=function(){function e(){}return e.bind=function(e,t,r){zi.has(e)||(zi.set(e,{events:{},plugins:{}}),Wi.push(e));var i=zi.get(e);if(!i.eventsion(r){for(var i=zi.get(e).events[t].concerns,n=0;n<i.length;n++)i[n].triggerEvent(t,e,r)}},o=$i.findByEventName(t);if(o){if(i.plugins[o.name])i.plugins[o.name].setup||(i.plugins[o.name].setup=!0,o.init.call(i.plugins[o.name].inst,e,i.plugins[o.name].params));else{var a=i.plugins[o.name]={setup:!0,inst:new Gi,params:{}};o.init.call(a.inst,e,a.params)}i.plugins[o.name].inst.on(t,n.dispatcher)}else in.dispatcher);else{if("function"!=typeof e.addEventListener)throw new Error("event source must has addEventListener or On");e.addEventListener(t,n.dispatcher)}}i.events[t].concerns.push(r)},e.clean=function(){Wi.forEach((function(t){e.release(t)}))},e.setPluginParams=function(e,t,r){zi.has(e)||(zi.set(e,{events:{},plugins:{}}),Wi.push(eins[t].setup){var n=$i.findByName(t);n.clean.call(i.plugins[t].inst,e),n.init.call(i.plugins[t].inst,e,r)}}else i.plugins[t]={ins(e);t?(Yi(e,i,t),Xi(i,t,r)):Object.keys(i.events).forEach((function(t){Yi(e,i,t),Xi(i,t,r)}))},e}();function Yi(e,t,r){$i.clean(e,t.plugins,r)||("function"==typeof e.off?e.off(r,t.events[r].dispatcher):"function"==typeof e.removeEventListener&&e.removeEventListener(r,t.events[r].dispatcher))}function Xi(e,t,r){e.events[t].concerns=e.events[t].concerns.filter((function(e){return!!r&&(e!==r||(e.clean(),!1))}))}var Qi=function(){function e(e,t){this.interval=e,this.handlers=[],this.autoStart=t}return e.prototype.start=function(e){var t=this;return clearInterval(this.timer),this.isRunning=!0,this.timer=window.setInterval((function(){t.handlers.forEach((function(e){return e()}))}),e||this.interval),this},e.prrt()),this},e.prototype.off=function(e,t){return 0===arguments.length?this.handlers=[]:t&&(this.handlers=this.handlers.filter((function(e){return e!==t}))),this},e}(),Ji=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])n i(){the=null===r?Object.create(r):(i.prototype=r.protonction(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i},en=/[+&|]/,tn=0,rn=function(e){function t(t,r,i){void 0===r&&(r=Fi.Default);var n=e.call(this)||this;return n.source=t,n.rootSignal=Fi.of(i,r),n.id=tn++,n.mappers={},n.eventHistory=new Vi(["source","event"]),n}return Ji(t,e),t.when=function(e,r){for(var i,n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return(i=new t).when.apply(i,Zi([e,r],n))},t.of=function(e,r,i){return new t(e,r,i)},t.waker=function(e,t){return new Qi(e,t)},t.True=function(e){return null==e||[e]},t.False=function(){return!1},t.prototype.clean=function(){this.cleaned&&(this.cleaned=!0,this.rule.clean(),this.eventHistory.clean(),delete this.signalManager,delete this.eventHistory,this.endConcern&&(this.endConcern.clean(),delete this.endConcern))},t.prototype.when=function(e,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];if(!e)throw new Error("when() expect 1 arguments at lease,but got 0");if(1===arguments.length&&(e instanceof t||"function"==typeof e.on)&&(r=Fi.Default),"string"==typeof e&&"string"!=typeof r){if(i=[r].concat(i),r=e,!this.source)throw new Error("Concern.of(source)when");e=this.source}if(this.rule)throw new Error("Concern.when must be invoked just once!");return en.test(r)?this.rule=Ii.parseFromString(r,nn(e,i)):this.rule=(new Ii).parse(Ii.RelationType.INIT,{source:e,event:r}),this.source=e,this},t.prototype.addRule=function(e,r,i,n){if((e instanceof t||"function"==typeof e.on)&&!r&&(r=Fi.Default),"string"==typeof e&&"string"!=typeof r){if(i=(r?[r]:[]).concat(i),r=e,!this.source)throw new Error(""+Ii.RelationType[n].toLowerCase()+"(source)");e=this.source}var o;o=en.test(r)?Ii.parseFromString(r,nn(e,i)):{source:e,event:r},this.rule.parse(n,o),this.source=e},t.prototype.and=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return this.addRule(e,t,r,Ii.RelationType.AND),this},t.prototype.or=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return this.addRule(e,t,r,Ii.RelationType.OR),this},t.prototype.joint=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return this.addRule(e,t,r,Ii.RelationType.JOINT),this},t.prototype.toString=function(){return this.linkedTo?on(e){return(e.source.name||"N/A")+"."+e.event})):this.rule.dump((function(e){return(e.source.name||"N/A")+"."+e.event}))},t.prototype.triggerEvent=function(e,t,r){var i=this;if(this.eventHistory.add({event:e,source:t},r),this.rule.match(this.eventHistory))if(this.checker){var n=this.checker(r);n&&"fun&i._triggerEvent(Array.isArray(e)?e[0]:r)})):n&&this._triggerEvent(Array.isArray(n)?n[0]:r)}riggerEvent=function(e){this.signalManager.trigger(this.rootSignal,this.linkedTo||this,e)},t.prototype.bind=function(){var e=this;this.signalManager||(this.signalManager=new Bi),!this.isBind&&this.rule&&(this.endConcern&&this.endConcern.bind()},t.prototype.signal=function(e,t){var r=this;return this.linkedTo?(this.linkedTo.signal(e,t),this.linkedTo):(this.signalManager||(this.signalManager=new Bi),"string"==typeof e||Array.isArray(e)&&"string"==typeof e[0]?(Array.isArray(e)?e:e.split(",")).forEach((function(e){r.signalManager.addSignal(e,t)})):(e instanceof Fi||Array.isArray(e)&&e[0]instanceof Fi)&&(Array.isArray(e)?e:[e]).forEach((function(e){r.signalManager.addSignal(e)})),this)},t.prototype.get=function(e,t){return void 0===e&&(e=Fi.Default),this.linkedTo?this.linkedTo.get(e,t):this.signalManager.get(e,t||e==Fi.Default?this.rootSignal.scope:void 0)},t.prototype.getAllSignal=function(){return this.linkedTo?this.linkedTo.getAllSignal():this.signalManager.getAll()},t.prototype.emitSignal=function(e,r){e!==Fi.Defauit("$signal",e,r);var i="-"===e[0]?e.slice(1):e;void 0!==this.mappers[i]&&(r="function"==typeof this.mappers[i]?this.mappers[i](r,this):this.mappers[i]===t.Flag?this.get(i):this.mappers[i]),this.emit(e,r),this.linkedTo&&(this.linkedTo.emit("$signal",e,r),this.linkedTo.emit(e,r))},t.prototype.until=function(e){for(var r,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=(r=t.of(this.source,"-"+Fi.Default,this.rootSignal.scope)).when.apply(r,Zi([e],i)).linkTo(this);return this.signalManager||(this.signalManager=new Bi),o.signalManager=this.signalManager,this.signalManager.autoClear(),this.endConcern=o,o},t.prototype.linkTo=function(e){return this.linkedTo=e,this.rootSignal.setScope(e.rootSignal.scope),this},t.prototype.unlink=function(){this.linkedTo=null},t.prototype.check=function(e){if(this.linkedTo)return this.linkedTo.check(e),this.linkedTo;if("function"!=typeof e)throw new Error("checker must be a function!");return this.checker=e,this},t.prototype.map=function(e,t){1===arguments.length&&(t=e,e="$"),this.mappers[e]=t},t.prototype.on=function(t,r,i){return this.linkedTo?(this.linkedTo.on(t,r,i),this.linkedTo):(this.bind(),"function"==typeof t&&(r=t,t=Fi.Default,e.prototype.on.calpe.on.call(this,t,r,i),this)},t.prototype.once=function(t,r){return this.linkedTo?(this.linkedTo.once(t,r),this.linkedTo):(this.bind(),1===arguments.length&&"function"==te.on.call(this,"-"+Fi.Default,r)),e.prototype.once.call(this,t,r))},t.Flag=Symbol("Flag"),t}(Gi);function nn(e,t){var n=i.split("."),o=n[0],a=n[1];if(!a)return{source:e,event:o};if("$"===o[0]){if(t[0]&&t[0][o.slice(1)])return{source:t[0][o.slice(1)],event:a};throw new Errlice(1))}return"%"===o?{source:t[r++],event:a}:void 0}}var on=Symbol("watcher"),an=function(){function e(){}return e.exist=function(e,t,r){return!(null==r||!e[on]||!e[on][t])&&e[on][t].handlers.filter((function(e){return e.uniqueId===r})).length>0},e.add=function(t,r,i){t[on]||(t[on]={}),t[on][r]?e.exist(t,r,i)||t[on][r].handlers.push(i):(t[on][r]={handlers:[i],value:t[r]},Object.defineProperty(t,r,{get:function(){return this[on][r].value},set:function(e){var t=this[on][r].value;e!==t&&(this[on][r].value=e,this[on][r].handlers=this[on][r].handlers.filter((function(r){return r(e,t)})))}}))},e}(),sn=1;!function(){function e(e){var t=this;this.queue=[],this.id=sn++,e.on((function(e){t.queue.length>0?t._execute(e,0):t.cached=e}))}e.when=function(t){return new e(t)},e.waitFor=function(t,r,i){if(void 0===i&&(i=e.currentId),!t)throw new Error("target can not be none");var n=r.split(/(==|!=|>=?|<=?)/),o=n[0],a=new Function("value","return value"+n[1]+'"'+n[2]+'";');return an.exist(t,o,r+i)?e.Abort:new Promise((function(e,n){if(a(t[o]))e(t);else{var s=function(r,i){return!a(r)||(e(t),!1)};void 0!==i&&(s.uniqueId=r+i),an.add(t,o,s)}}))},e.once=function(e,t){return{count:0,items:[{target:e,event:t}],followed:!1,sync:function(e,t){if(this.followed)throw new Error("sync can not exist after follow");return this.items.push({target:e,event:t}),this},follow:function(e){var t=this;this.followed=!0,this.items.forEach((function(r){if(null==r.target.once)if("function"==typeof r.target.on)r.target.once=function(e,i){var n=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];if(i.apply(t,o),"function"!=typeof r.target.off)throw new Error("once function does not exist on target");r.target.off(e,n)};r.target.on(e,n)};else{if("function"!=typeof r.target.addEventListener)throw new Error("target is not a EventEmitter");r.target.once=f{for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];i.apply(t,o),r.target.removeEventListener(e,n)};r.target.addEventListener(e,n)}}if("function"!=typeof r.target.once)throw new Error("once function does not exist on target");r.target.once(r.event,(function(){r.finish=!0,t.count+=1,t.count==t.items.length&&t.items.every((function(e){return e.finish}))&&e()}))}))}}},e.on=function(e,t){return{count:0,items:[{target:e,event:t}],followed:!1,sync:function(e,t){if(this.followed)throw new Error("sync can not exist after follow");return this.items.push({targction(e){var t=this;this.followed=!0,this.items.forEach((function(r){var i=function(){r.finish=!0,t.count+=1,t.count==t.items.length&&t.items.every((function(e){return e.finish}))&&e()};if("function"==typeof r.target.on)r.target.on(r.event,i);else{if("function"!=typeof r.target.addEventListener)throw new Error("target is not a EventEmitter");r.target.addEventListener(r.event,i())}}))}}},e.prototype.then=function(e){return this.queue.push(e),this.cached&&(this._execute(this.cached),delete this.cached),this},e.prototype._execute=function(t,r){var i=this;void 0===r&&(r=0);var n=this.queue[r];e.currentId=this.id;var o=n&&n(t,this);delete e.currentId,r!==this.queue.length-1&&o!==e.End&&o!==e.Abort&&(o&&"function"==typeof o.then?o.then((function(e){i._execute(e,r+1)})):this._execute(o,r+1))},e.End=Symbol("end"),e.Abort={then:function(){}}}();function un(){}$i.add("drag",["dragMove","dragStop"],(function(e,t){var r=this;this.mousedown=function(e,t,r,i){var n,o,a,s,u,c;return n=function(e){var r="touchmove"===e.type?e.touches[0]:e;t&&t({shiftX:r.clientX-u.x,shiftY:r.clientY-u.y,totalX:r.clientX-c.x,totalY:r.clientY-c.y,event:e}),u={x:r.clientX,y:r.clientY},e.preventDefault(),e.stopPropagation()},o=function(e){var r="touchstart"===e.type?e.touches[0]:e;u={x:r.clientX,y:r.clientY},c={x:r.clientX,y:r.clientY},document.addEventListener("mousemove",n),document.addEventListener("touchmove",n),document.addEventListener("mouseup",a),document.addEventListener("touchend",a),i&&i.addEventListener("mouseleave",a),t&&t({shiftX:0,shiftY:0,totalX:0,totalY:0,event:e})},a=function(t){document.removeEventListener("mousemove",n),document.removeEventListener(tListener("mouseup",a),document.e.removeEventListener("mouseout",s);var o="touchend"===t.type?t.changedTouches[0]:t;r&&r({shiftX:o.clientX-u.x,shiftY:o.clientY-u.y,totalX:o.clientX-c.x,totalY:o.clientY-c.y,event:t})},s=function(t){e.removeEventListener("mousemove",n),e.removeEventListener("touchmove",n),e.removeEventListener("mouseup",a),e.removeEventListener("touchend",a),e.removeEientX-u.x,shiftY:t.clientY-u.y,totalX:t.clientX-c.x,totalY:t.clientY-c.y,event:t})},e.addEventListener(}(e,(function(e){r.emit("dragMove",e)}),(function(e){r.emit("dragStop",e)}),t.container||document.body)}),(function(e){e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.mousedown)}));var cn=function(){function e(e,t,r){var i=this;if(this.host=e,this.driver=t,e instanceof Rn)this.signalScope=t.getComponentOf(e).signalScope,Object.keys(r).forEach((function(e){i.bindSignals(e,r[e])}));else{if(!(e instanceof Fn))throw new Error("signalManager host must be a block or component");this.signalScope=e.signalScope,Object.keys(r).forEach((function(e){i.bindComponentSignals(e,r[e])}))}}return e.clearSignalInScope=function(e,t,r){Fi,e.triggerSignalInScope=function(e,t,r){Fi.triggerSignalInScope(e,t,r,un)},e.prototype.trigger=function(e,t){"-"===e[0]?this.driver.clearSignal(this.host,e.slice(1),t):this.driver.signal(this.host,e,t)},e.prototype.bindComponentSignals=function(e,t){rn.of(this.host).when(e).until("-"+e).signal(t,this.signalScope).on("$signal",this.trigger.bind(this))},e.prototype.bindSignals=function(e,t){var r=this.host.el;ifragMove").signal(t,this.signalScope).on("$signal",this.trigger.bind(this));var i=t[0];"-"!==i[0]&&rn.of(r).when("dragStop").signal("-"+i,this.signalScope).on("$signal",this.trigger.bind(this))}else).signal(t,this.signalScope).on("$signal",this.trigger.bind(this))},e}(),ln=function(){function e(){this.records={}}return e.prototype.start=function(e){this.records[e]||(this.records[e]={time:0}),this.records[e].t1=performance.now()},e.prototype.record=function(e){this.records[e].time+=performance.now()-this.records[e].t1},e}(),pn=[function(e,t){return yn[e]&&mn.test(t)?t+"px":t},function(e,t){if(null==t)return"";if("content"===e&&'"'!==t[0]&&'"'!==t[t.length-1])return'"'+t+'"';return t}];function dn(e,t){return pn.reduce((function(t,r){return r(e,t)}),t)}var hn=function(){function e(){var e=document.createElement("style");document.head.appendChild(e),this.styleSheet=e.sheet}return e.addFilter=function(e){pn.push(e)},e.prototype.modifyStyleRule=function(e,t){},e.prototype.insertPureRule=function(e,t){var r=this.styleSheet.insertRule(e+"{"+t+"}",this.styleSheet.cssRules.length);return this.styleSheet.cssRules[r].index=r,this.styleSheet.cssRules[r]},e.prototype.insertRule=function(e,t){var r=this.styleSheet.insertRule(e+"{"+this.genCssText(t)+"}",this.styleSheet.cssRules.length);return this.styleSheet.cssRules[r].index=r,this.styleSheet.cssRules[r]},e.prototype.modifyRule=function(e,t,r){t=En(t),e.style[t]=dn(t,r)},e.prototype.genCssText=function(e){return Object.keys(e).reduce((function(t,r){var i=r.replace(/[A-Z]/g,"-$&"),n=dn(En(i),e[r]);return t+=i+":"+n+";",t+=function(e,t){if(fn[e])return fn[e].map((function(r){return r+e+":"+t}(),fn={"use-select":["-ms","-o"]},mn=/^-?\d+(\.\d+)?$/;var yn={backgroundPositionX:1,backgroundPositionY:1,backgroundSize:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderLeftWidth:1,borderRadius:1,borderRightWidth:1,borderSpacing:1,borderTopLeftRadius:1,borderTopRightRadiusWidth:1,bottom:1,flexBasis:1,fontSize:1,height:1,inlineSize:1,left:1,letterSpacing:1,marginBottom:1,marginLeft:1,marginRight:1,marginTop:1,maxHeight:1,maxWidth:1,minHeight:1,minWidth:1,outline:1,paddingBottom:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,size:1,top:1,width:1,wordSpacing:1};var gn=new hn,vn=/-([a-zA-Z]|$)/g,bn=function(e,t,r){return 0==r?t:t?t.toUpperCase():""};function En(e){return e.replace(vn,bn)}var _n=0;window.t1=new ln;var Rn=function(){function e(t,r,i){this.children=[],this._id=_n++,1===arguments.length&&t instat+"."+r.name,this.componentName=i,"#text"===r.name?this.type=yi.Text:this.type=yi.Element,this.ids=[],r.classList?this.classList=r.classList.map((function(e){return Ai(e)})):this.classList=[],r.attributes&&(this.attributes=Object.keys(r.attributes).map((function(e){return[e,"string"==typeof r.attributes[e]?r.attributes[e]:Ai(r.attributes[e])]}))),r.signalMap&&(this.signt&&(this.content=Ai(r.content)),r.signals&&(this.signals=r.signals),r.ref&&(this.ref=r.ref),this.initSignals())}return e.renderAll=function(t,r,i){t.component&&(t.component.refreshAttributes(r,i,!0),r=t.component.state,i=t.component.signals),t.render(r,i),r.$indexs&&(t.indexs=r.$indexs,t.scope=r),t instanceof e&&t.children.forEach((function(t){return e.renderAll(t,r,i)}))},e.prototype.copyFromDNA=function(e){this.classList=e.classListdna=e.dna,this.signals=e.signals,this.signalMap=e.signalMap,this.driver=e.driver,this.type=e.type,this.componentName=e.componentName,e.attributes&&(this.attributes=e.attributes)},e.prototype.addClass=function(e){this.classList.push(e)},e.prototype.initSignals=function(){this.signalMap},e.prototype.addChild=function(e){this.children.push(e)},e.prototype.matrix=function(){return this.dna||(this.dna=new Li(this)),this.children.map((function(e){return e.matrix()})),this},e.prototype.clone=function(){this.dna||(this.dna=new Li(this));var e=this.dna.clone();return this.component&&(e.component=this.component),e.children=this.children.map((function(e){return e.clone()})),e},Object.defineProperty(e.prototype,"ShortName",{get:function(){return this.name.split(",Object.defineProperty(e.prototype,"ShortNamespace",{get:functio.slice(0,-1).pop()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Namespace",{get:function(){return this.name.split(".").slice(0,-1).join(".").toLowerCase()},enumerable:!1,configurable:!0}),e.prototype._create=function(){var e=this;if(!this.el)if(this.type===yi.Text)this.el=document.createTextNode("");else{if(this.el=doc);t[t.length-1]=this.ref,t.unshift("kui"),this.el.id=t.join("_")}this.component&&this.el.setAttribute("com",this.componentName),this.attributes&&this.attributes.filter((function(eute(t[0],t[1])}))}},e.mountAll=function(t,r,i){t.mount(r,i),t.children.forEach((function(r){e.mountAll(r,t,i)}))},e.prototype.mount=functioiver=t,e&&!this.mounted&&(this.mounted=!0,this.signalMap&&(this.signalManager=new cn(this,this.driver,this.signalMap)),e instanceof HTMLElement||e instanceof DocumentFragment?r?e.insertBefore(this.el,r):e.appendChild(this.el):e.appendChild(this,r))},e.prototype.getBoundingClientRect=function(){return this.el?this.el,e.prototype.appendChild=function(e,t){this._create(),t?this.el.insertBefore(e.el,t):this.el.appendChild(e.el)},e.prototype.addIds=function(e){this.ids.push(e)},e.prototype.detach=function(){this.mounted=!1,this.el.parentNode.removeChild(this.el)},e.prototype.remove=function(){return this.mounted&&this.detach(),!(!t)&&(this.children=this.children.filter((function(e){return!e.remove()})),this.children=[],delete this.signalMap,delete this.indexs,delete this.content,!0)},e.prototype.render=function(e,t){var r,i=this;if(!ttypeof this.content?r=this.content(e,t,{}):this.content&&(r=this.content),this.type===yi.Element){var n=this.signals?this.signals.filter((function(e){return-1!==t.indexOf(e)})):[],o=this.classList.reduce((function(r,i){if("string"==typeof i)r.push(i);else if("function"==typeof i){var n=i(e,t);if(Array.isArray(n))return r.concat(n);r.push(n)}return r}),[]);(o=o.map((function(e){return"!"===e[0]?e.slice(1):0===e.indexOf("kui-")?e:"kui-"+i.componentName.toLowerCase()+"-"+e})).concat(n.map((function(e){return"kui-s-"+er((function(e){return"function"==typeof e[1]})).forEach((function(r){var n=r[0],a=(0,r[1])(e,t);if("css"===n){var s="kui-"+i.componentName+"-"+i._id+"-"+(e.$index||0);if(i.el.className+=" "+s,i.styleRule){if(a!==i.styleRuleText)try{i.styleRule.style.cssText=a,i.styleRuleText=a}catch(e){}}else{var u=".kui-"+i.ShortNamespace+"-"+i.driver.uid;i.styleRule=gn.insertPureRule(u+" ."+o.join(".").replace(/.kui-s-[^.]+/g,"")+"."+s,a),i.styleRuleText=a}}else!0===a?i.el.setAttribute(n,""):!1!==a&&i.el.setAttribute(n,a)}))}else void 0!==r&&(this.el.textContent=r)},e}(),Sn=function(){return(Sn=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};window.t=new ln;var An=function(){function e(t,r,i){t instanceof e?this.copyFrom(t):(this.elements=[],this.detached=[],this.ids=[],this.name=t+"."+r.name,this.reat),this.iterName=r.iterName,this.block=new Rn(t,r,i))}return e.prototype.getBoundingClientRect=function(){var e=this.elements.reduce((function(e,t){var r=t.getBoundingClientRect();return e.left=Math.min(e.left,r.x),e.top=Math.min(e.top,r.y),e.bottom=Math.max(e.bottom,r.bottom),e.right=Math.max(e.bottom,r.right),e}),{left:0,top:0,rige.top,e.right-e.left,e.bottom-e.top)},e.prototype.copyFrom=function(e){this.elements=[],this.detached=[],this.ids=[],this.name=e.name,this.repeat=e.repeat,this.getList=e.getList,this.iterName=e.iterName,this.block=e.block.clone()},e.prototype.addClass=function(e){this.block.addClass(e)},e.prototype.addIds=function(e){this.ids.push(e)},e.prototype.addChild=function(e){this.block..mount=function(e,t){this._create(),this.driver=t,e&&!this.mounted&&(this.mounted=!0,e instanceof HTMLElement?e.appendChild(this.el):e.appendChild(this))},e.prototype._create=function(){this.el||(this.el=document.createComment(this.name+"-placeholder"),this.buffer=document.createDocumentFragment())},e.prototype.appendChild=function(e){this.block.appendChild(e.el)},e.prototype.remove=function(){return this.mounted&&this.detach(),this.elements.forEach((function(e){return e.remove()})),this.detached.forEach((function(e){return e.remove()})),this.elements=[],this.detached=[],!(!this.dna||!this.dna.decay(this))&&(delete this.block,!0)},e.prototype.detach=function(){this.mounted=!1,this.el.parentNode.removeChild(this.el),this.elements.forEach((function(e){e.detach()}))},e.prototype.render=function(e,t,r){var i,n=this;void 0===r&&(r=!1);var o=this.getList(e,t)||[];if(r||this.elements.forEach((function(r,i){var a;if(!(i>=o.length)){var s="$each"!==n.iterName?[i,n.iterName]:[i];Rn.renderAll(r,Sn(Sn({},e),((=i,a.$indexs=e.$indexs?e.$indexs.concat([s]):[s],a)),t)}})),o.length>this.elements.length){for(;this.elements.length<o.length;){var a=this.detached.shift();a||(a=0===this.elements.length?this.block.matrix():th)),Rn.mountAll(a,this.buffer,this!==this.iterName?[s,this.iterName]:[s];Rn.renderAll(a,Sn(Sn({},e),((i={})[this.iterName]=o[s],i.$index=s,i]):[u],i)),t),this.elemehis.el.parentNode.insertBefore(this.buffer,this.el)}else o.length<this.elements.length&&(this.detached=this.elements.slice(o.length),this.elements=this.elements.slice(0,o.length),this.detached.forEach((function(e){return e.detach()})),this.detached.forEach((function(e){return e.remove()})),this.detached=[])},e.prototype.matrix=function(){return this.dna||(this.dna=new Li(this)),this},e.prototype.clone=function(){return this.dna||(this.dna=new Li(this)),this.dna.clone()},e}(),Tn=new(function(){function e(){}return e.prototype.addGlobalStyle=function(e,t){return gn.insertPureRule(e,t)},e.prototype.addStyle=function(e,t){var r=t.computed||t.main;return gn.insertRule(e,r)},e.prototype.modify=function(e,t,r){gn.modifyRule(e,t,r)},e.prototype.updateStyle=function(){},e}());function wn(e,t,r,i){void 0===r&&(r=[]);var n=[];return Object.keys(t).forEach((function(o){var a=r.concat(o);if(Array.isArray(t[o]))if(Array.isArray(e[o])){if(e[o].leng;i&&i[s]||(n.push(s),e[o]=e[o].slice(0,t[o].length))}n=n.concat(wn(e[o],t[o],a,i))}else{s=a.join(".");i&&i[s]||(n.push(s),e[o]=t[o])}else if(t[o]&&"object"==typeof t[o])e[o]?n=n.concat(wn(e[o],t[o],a,i)):(e[o]={},n.push(a.join(".")),n=n.concat(function e(t,r,i,n){var o=[];return Object.keys(t).forEach((function(a){if("object"==typeof t[a])i[a]=Array.isArray(t[a])?[]:{},o=o.concat(e(t[a],r.concat(a),i[a]));else{var s=r.conci[a]=t[a],o.push(s))}})),o}(t[o],a,e[o],i)));else if(e[o]!==t[o]){s=a.join(".");i&&i[s]||(n.push(s),e[o]=t[o])}})),n}function Ln(e,t){for(var r,i=t.split("."),n=e;r=i.shift();)if(null==(n=n[r]))return n;return n}function On(e,t,r){var i=Object.keys(t);return r&&r.length>0&&(i=i.filter((functi,i.forEach((function(r){Array.isArray(t[r])?e[r]=function e(t){return t.map((function(t){return Array.isArray(t)?e(t):t&&"object"==typeof t?On({},t):t}))}(t[r]):t[r]&&"object"==typeof t[r]?e[r]=On({},t[r]):e[r]=t[r]})),e}var xn="function"==typeof Symbol?Symbol("handlers"):"_handlers",Pn=function(){functirs"),this[xn]={}}return e.prototype.off=function(e,t){t?this[xn][e]=this[xn][e].filter((function(e){return e!==t})):e?this[xn][e]=[]:this[xn]={}},e.prototype.once=function(e,t){var r=this,i=!1,n=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];r.off(e,n),i||(i=!0,t.apply(void 0,o))};this.on(e,n)},e.prototype.addEventListener=function(e,t){this.on(e,t)},e.prototype.removeEventListener=function(e,t){this.off(e,t)},e.prototype.on=function(e,t,r){return this[xn][e]?isFinite(r)?this[xn][e].splice(r,0,t):this[xn][e].push(t):this[xn][e]=[t],this},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!e)return!1;var i=this[xn][e];if(i&&i.length>0){var n=i.concat();return n.forEach((function(e){e.apply(void 0,t)})),!0}return!1},e}();var Dn="$connects",kn="$attentions",In="$imports",Mn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Cn=function(){return(Cn=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Nn=/\.(\d+)(?=\.|$)/g,Un=/\.?\$([a-zA-Z0-9._-]+)\$/g,Bn=/%([a-zA-Z._-]+)%/g,Fn=function(e){function t(t){var r=e.call(this)||this;return r.name=t,r.signals=[],r.refs={},r.idDependents={},r.signalDependents={},r.childComponents={},r.styeturn Mn(t,e),Object.defineProperty(t.prototype,"ComponentName",{get:function(){return this.constructor.$name.toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Namespace",{get:function(){return this.name.split(".").slice(0,-1).join(".").toLowerCase()},enumerable:!1,configurable:!0}),t.prototype.addConcepts=function(){var e=this;this.constructor[Dn]&&this.constructor[Dn].forEach((function(t){var r=t.name,i=t.signals,n=t.flushSignals,o=t.funcName,a=e.driver.onConcept(r,(function(t){var i;e.setState(((i={})[r]=e[o](t),i))}));e.state[r]=e[o](a),i&&rn.of(e).when(i).on((function(t){var i,a=e[o](e.state[r],t);n||e.driver.setConcept(r,a),e.setState(((i={})[r]=a,i))})),n&&rn.of(e).when(n).on((function(t){e.driver.setConcept(r,e.state[r])}))}));this.constructor[In]&&this.constructor[In].forEach((function(t){var r=t.name,i=t.mapKey,n=t.propFilter,o=t.funcName,a=e.driver.onConcept(r,(function(t){var a,s;if(o&&(t=e[o](t)),"..."===i)if(t&&"object"==typeof t){var u=Array.isArray(t)?[]:{};Object.keys(t).filter((function(e){return!n||~n.indexOf(e)})).forEach((function(e){u[e]=t[e]})),e.setState(u)}else e.setState(((a={})[r.split(".").pop()]=t,a));else e.serray(t)?t.concat():Cn({},t):t,s))}));o&&(a=e[o](a)),"..."===i?a&&"object"==typeof a?On(e.state,a,n):e.state[r.split(".").pop()]=a:e.state[i]=a&&"object"==typeof a?On(Array.isArray(a)?[]:{},a):a}))},t.prototype.refreshAttributes=function(e,t,r){var i=this;void 0===r&&(r=!1);var n={};if(this.attributes&&(n=Object.keys(this.attributes).reduce((function(n,o){return"function"==typeof i.attributes[o]?n[o]=i.attributes[o](e,t):r&&(n[o]=i.attributes[o]),n}),n)),this.prop){var o=this.p[e]}))}r?Object.keys(n).forEach((function(e){i.state[e]=n[e]})):this.setState(n)},t.prototype.applyAttributes=function(e){e.attributes&&(this.attributes=Object.keys(e.attributes).reduce((function(t,r){return t[r]=Ai(e.attributes[r]),t}),{})),e.prop&&(this.prop=Ai(e.prop))},t.prototype.replacePlaceHolder=function(e,t,r){var i=this,n=(e=e.trim()).indexOf(" ");return-1==n&&(n=1/0),e.trim().replace(Un,(function(e,o,a){var s="."===e[0]?".kuiassId:a>n?s+t:i.classId+" "+s+t})).replace(Bn,".kui-$1-"+this.driver.uid)},t.prototype.resolveStyle=function(e,t,r){var i,n=this,o={},a=/:global\(([^)]+)\)/.exec(e);ifap((function(e){return n.replacePlaceHolder(e,s,t.isRoot)})).join(",")}var u={computed:t.main?Object.keys(t.main).reduce((function(e,r){return"string"==typeof t.main[r]?(e[r]=t.main[r],o[r]=t.main[r]):(o[r]=Ai(t.main[r]),e[r]=o[r](n.state,n.signals)),e}),{}):{},main:o},c=Tn.addStyle(i,u);return u.cssRule=c,t.varList.forEach((function(e){n.styleDependents[e]||(n.styleDependents[e]=[]),n.styleDependents[e].push(u)})),c},t.prototype.setupStyles=function(e,t,r){var i=this;e&&Object.keys(e).reduce((function(t,r){return t[r]=i.resolveStyle(r,e[r]),t}),{}),t&&Object.keys(t).reduce((function(e,r){return e[r]=Object.keys(t[r]).reduce((function(e,n){return e[n]=i.resolveStyle(n,t[r][n],r),e}),{}),e}),{}),r&&r.forEach((function(e){var t=e[0],r=e[1];Tn.addGlobalStyle(t,r)}))},t.prototype.setupTemplate=function(e,t){var r,i=this;if(e.repeat)r=new ){var n=new e.component(this.name+"."+e(this.state,this.signals,!0),n.init(t,this.driver),this.childComponents[e.name]=n,(r=n.block).component=n,n.setParent(t),e.signalMap&&new cn(n,this.driver,e.signalMap),e.ids&&e.ids.forEach((function(e){i.idDependents[e]||(i.idDependents[e]=[]),i.idDependents[e].push(n)})),r}r=new Rn(this.name,e,this.ComponentName),e.ref&&(this.refs[e.ref]=r)}return e.ids&&e.ids.forEach((function(e){i.idDependents[e]||(i.idDependents[e]=[]),i.idDependents[e].push(r),r.addIds(e)})),e.signals&&e.signals.forEach((function(e){i.signalDependents[e]||(i.signalDependents[e]=[]),i.signalDependents[e].push(r)})),e.children&&e.children.forEach((function(e){var t=i.setupTemplate(e,r);r.addChild(t)})),r},t.prototype.getBoundingClientRect=function(){return this.block.getBoundingClientRect()},t.prototype.checkSignal=function(e){return e.substring(0,e.lastIndexOf("."))===this.name},t.prototype._mount=function(e,t){var r=this;void 0===e&&(e=this.parentBlock),void 0===t&&(t=this.block),t.mount(e||this.parentBlock,this.driver),t.children&&t.children.forEach((function(e){e.component?(e.component._mount(),"function"==typeof e.component.onMounted&&e.component.onMounted()):r._mount(t,e)}))},t.prototype.addAttentions=function(){var e=this;if(this.constructor[kn]){var t=this.constructor[kn];Object.keys(t).forEach((function(r){"_"===r?(e.driver.addAttention(t[r],e),e.rAttentions=new RegExp("^("+t[r].join("|").replace(/[.$]/g,"\\$&")+")$")):t[r].reduce((function(e,t,r){return 0===r?e.when(t):e.or(t)}),rn.of(e.driver)).on((function(t){e[r](t)}))}))}},t.prototype.init=function(e,t){this.driver=t,t.mount(this),this.classId=(".kui-"+this.name.split(".").slice(-1)[0]+"-"+this.driver.uid).toLowerCase(),this.addConcepts(),this.addAttentions(),this.block=this.setupTemplate(this.constructor.$Template),this.block.addClass(this.classId.slice(1)),this.setupStyles(this.constructor.$Styles,this.constructor.$SignalStyles,this.constructor.$AtRules);var r=Object.keys(this.childComponents);this.rSignalFinder=new RegExp("^"+this.name+"\\.("+r.join("|")+")?","i");new RegExp("^"+this.name+"\\.","i")},t.prototype.resolveSignal=function(e,t,r,i){var n=this;this.signals=this.driver.signals.filter((function(e){return n.rSignalFinder.test(e)||n.rAttentions&&n.rAttentions.test(e)})).map((function(e){return n.rAttentions&&n.rAttentions.test(e)?e.split(".").pop():e.replace(n.rSignalFinder,"").replace(/^\./,"")})),this.signalDependents[e]&&this.signalDependents[e].forEach((function(e){e instanceof An&&(e=e.block),e.render(e.scope||n.state,n.signals),e.d.dna.findAllClone().forEach((function(e){e.render(e.scope||n.state,n.signals)}))}));var o,a="$"+e,s="on"+((o=e)[0].toUpperCase()+o.slice(1));"function"==typeof this[a]&&(r=this[a](r,i)||{}),"function"==typeof this[s]&&this[s](r,i),this.emit(("start"===t?"":"-")+e){this.driver.insertSignal(this.name+"."+e),this.resolveSignal(e,"start",t,this.block),cn.triggerSignalInScope(this.signalScope,e,t)},t.prototype.clearSignal=function(e,t){this.driver.removeSignal(thiis.block),cn.clearSignalInScope(this.signalScope,e,t)},t.prototype.mount=function(e,t){this.init(e,t),this._mount(e),"function"==typeof this.onMounted&&this.onMounted()},t.s.parentBlock=e},t.prototype.render=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=[]),this.refreshAttributes(e,t,!0),this.block.render(this.state,this.signals),this.state.$indexs&&(this.block.scope=e),this.block.children.forEach((function(e){r.renderAll(e,r.state,t)}))},t.prototype.renderAll=function(e,t,r){var i=this;e.component?e.component.render(t,rchildren.forEach((function(e){return i.renderAll(e,t,r)})))},t.prototype.getConfig=function(e){return this.driver.getConfig(e)},t.prototype.setState=function(e){var r=this;this.state=function e(t){return Array.isArray(t)?t.map((function(t){return e(t)})):e((function(r,i){return r[i]=e(t[i]),r}),{}):t}(this.state);var i=wn(this.state,e,[]),n=[],o={},a=[];i.sort((function(e,t){return e.length-t.length})),i=i.reduch(Nn);if(r){var i=t.replace(Nn,".$");if(a.every((function(e){return 0!==t.indexOf(e)}))){if(a.push(t),!o[i]){o[i]=[],e.push(i);for(var n=t.split(/\.\d+(?=\.|$)/g);n.length>1;){n.pop();var s=n.join(".$")+".$";-1===e.indexOf(s)&&e.push(s)}}o[i].push(r.map((function(e){return+e.slice(1)})))}}else e.push(t);return e}),[]);var s=[];i.forEach((function(e){var t=r.styleDependents[e];if(t)t.forEach((function(e){-1===s.indexOf(e)&&s.push(e)}));else{for(var i=e.split(".");i.length>0&&(i.pop(),!(t=r.styleDependents[i.join(".")])););t&&t.forEach((function(e){-1===s.indexOf(e)&&s.push(e)}))}var a=r.idDependents[e]||r.idDependents[e.replace(/\.\$$/,"")];if(a)a[0].dna||(a=r.idDependents[e.replace(/\.\$$/,"")]),a.forEach((function(t){var r=n.find((function(e){return e[0]===t}));if(r){if(r[1].indexOf("$")>=0)if(-1===e.indexOf("$"))r[1]=e;else{if(".$"!==r[1].slice(-2)){var i=r[1].slice(0,r[1].lastIndexOf(".$")+2);o[i]=o[r[1]],r[1]=i}var a=e.slice(0,e.lastIndexOf(".$")+2);o[e].forEach((function(e){o[a]||(o[a]=[]),(0==o[a].length||o[a].every((function(t){return t.join("")!==e.join("")})))&&o[a].push(e)}))}}else n.push([t,e])}));else{for(i=e.split(".");i.length>0;)if(i.pop(),a=r.idDependents[i.join(".")]){e=i.join(".");break}a&&a.forEach((function(t){-1===n.indexOf(t)&&n.push([t,e])}))}})),n.forEach((function(e){var i=e[0],n=e[1],a=r.state;i instanceof t?i.refreshAttributes(r.state,r.signals):o[n]&&(i.dna||i.block&&i.block.dna)?(i instanceof An&&(i.render(a,r.signals,!0),i=i.block),o[n].forEach((function(e){var t=i.dna.findClone(e),o=Li.getScope(t,n,a);t instanceof An&&(o.$indexs=t.indexs),t.scope=o,t.rendurn e.render(Cn(Cn({},e.scope),a),r.signals,r.filters)})):i.render(a,r.signals,r.filters)})),this.renderStyle(s)},t.prototype.renderStyle=fu.keys(e.main).forEach((function(r){"function"==typeof e.main[r]&&Tn.modify(e.cssRule,r,e.main[r](t.state,t.signals))}))}.concepts=e,this.signals=[],this.uid=jn++,this.componentMap={},this.pendingHandler={},this.config={},this.signalDependents={}}return e.prototype.getConfig=function(e){return this.config[e]},e.prototype.setConfig=function(e,t){this.config[e]=t},e.prototype.addAttention=function(e,t){var r=this;e.forEach((function(e){r.signalDependents[e]||(r.signalDependents[e]=[]),r.signalDependents[e].push(t)}))},e.prototype.mount=function(e)this.pendingHandler[t]&&(this.pendingHandler[t].forEach((function(t){var r=t.signal,i=t.handler;e.on(r,i)})),delete this.pendingHandler[t])},e.prototype.setConcept=function(e,t){this.concepts.set(e,t)},e.prototype.insertSignal=function(e){-1===this.signals.indexOf(e)&&gnal=function(e){-1!==this.signals.indexOf(e)&&(this.signals=this.signals.filter((function(t){return t!==e})))},e.prototype.signal=function(e,t,r){var i=e.Namespace,n=i+"."+t;-1===this.signals.indexOf(n)&&this.signals.push(n),this.componentMap[i].resolveSignal(t,"start",r,e),this.signalDependents[n]&&this.signalDependents[n].forEach((function(i){i.resolveSignal(t,"start",r,e)}))},e.prototype.getComponentOf=function(e){return this.componentMap[e.Namespace]},e.prototype.clearSignal=function(e,t,r){var i=e.Namespace,n=i+"."+t;-1!==this.signals.indexOf(n)&&(this.signals=this.signals.filter((function(e){return e!==n})),this.componentMap[i].resolveSignal(t,"end",r,e),this.signalDependents[n]&&this.signalDependents[n].forEach((function(i){i.resolveSignal(t,"end",r,e)})))},e.prototype.on=function(e,t){var r=e.split(".");if(r.length>1){var i=r.slice(0,-1).join("."),n=this.componentMap[i];n?n.on(r.pop(),t):(this.pendingHandler[i]||(this.pendingHandler[i]=[]),this.pendingHandler[i].push({signal:r.pop(),handler:t}))}return!1},e.prototype.onConcept=function(e,t){return this.concepts.on("$."+e,t),this.concepts.get(e)},e}();function Vn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,r,i){var n=t;r&&(n=t.constructor),n].push(e.join("|"))}}function qn(e,t,r){return function(i,n,o){var a=i;n&&(a=i.constructor),a[In]||(a[In]=[]),t||(t=e.split(".").pop()),a[In].push({name:e,mapKey:t,propFilter:r,funcNamnction(i,n,o){i.constructor[Dn]||(i.constructor[Dn]=[]),i.constructor[Dn].push({name:e,signals:t,flushSignals:r,funcName:n})}}var $n=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e{for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Wn=Symbol("state"),zn=function(e){function t(){var t=e.call(this)||this;return t[Wn]={},t}return $n(t,e),t.prototype.set=function(e,t){var r=this,i=wn(this[Wn][e],t);(i=Kn(i)).forEach((function(i){r.emit(e+"."+i,Ln(t,i),r[Wn][e])})),this.emit(e,this[Wn][e])},t.prototype.get=function(e){return Ln(this[Wn],e)},t.add=function(e,t,r){e[Wn][t]=r,Object.getOwnPropertyDescriptor(e,t)||Object.defineProperty(e,t,{set:function(r){var i=wn(e[Wn][t],r);(i=Kn(i)).forEach((function(i){return e.emit("$."+t+"."+i,Ln(r,i),e[Wn][t])})),e.emit("$."+t,e[Wn][t])},get:function(){return e[Wn][t]}})},t}(Pn);function Kn(e){return e.reduce((function(e,t){return t=t..push(t),e}),[])}var Yn=fuject.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Xn=function(e){function t(t){var r=e.call(this)||this;return r.components=Array.isArray(t)?t:[t],r.concept=new zn,r.driver=new Gn(r.concept),r.rootName=1===r.components.length?r.components[0].name:"",r}return Yn(t,e),t.prototype.on=function(t,r){return this.driver.on(t,r)?this:e.prototype.on.call(this,t,r)},t.prototype.mount=function(e){var t=this;this.components.forEach((function(r){r.mount(e,t.driver),r.render()}))},t.prototype.addConcept=function(e,t){zn.add(this.concept,e,t)},t.prototype.setConfig=function(e,t){this.driver.setConfig(e,t)},t}(Pn),Qn=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);reperty(t,r,a),a},Zn=function(e){function t(t){var r=e.call(this,t)||this;return r.state={messageList:[],aname:!1},r.id=0,r}return Qn(t,e),t.prototype.messageShow=function(e){if(void 0!==e){if(e.clear)return this.lastData=null,{messageList:[]};if(e.message){var t=e.message,r=e.time,i=e.key,ntate.messageList;a=Array.isArray(a)?a.filter((function(e){return o-e.start<1e3*e.time})):[],i&&(a=a.filter((function(e){return e.key&&e.key!==i})));var s={message:t,time:r,key:i,close:n};s.start=o,s.id=this.id++,a.push(s);var u=this.state.aname;return(!this.lastData||this.lastData&&o-this.lastData.start>1e3*this.lastData.time/2)&&(u=!u,this.lastData=s),{messageList:a,aname:u}}}},t.prototype.transferInformation=function(e,t){if(t)return t},t.prototype.$onInformation=function(e){var t=e.target.dataset?e.target.dataset.val:e.target.getAttribute("data-val");if(t)return{action:t}},t.prototype.$closeFunction=function(e){var t=e.target.dataset?e.target.dataset.val:e.target.getAttribute("data-val"),r=this.state.messageList.filter((function(e){return e.id!==parseInt(t)}));this.lastData.id===parseInt(t)&&(this.lastData=null),this.setState({messageList:r})},Jn([qn("information","...")],t.prototype,"messageShow",null),Jn([Hn("information","onInformation")],t.prototype,"transferInformation",null),t}(Fn),eo=Zn;function to(e){for(var t=Math.round(e||0),r=[];r.length<3;)r.unshift((""+(r.length<2?t%60:t)).padStart(2,"0")),t=Math.floor(t/60);return r.join(":")}Zn.$Template={name:"message-layer",classList:[],children:[{name:"div",classList:[{type:0,value:"information"}],attributes:{"data-val":{type:0,value:"click-control"}},children:[{ids:["messageList","aname","messageList.$.time"],name:"div",classList:[{type:0,value:"information-item"}],iterName:"$each",repeat:{type:1,value:"(messageList)",debug:!1,ids:["messageList"],filters:[]},attributes:{style:{type:1,value:"\"animation:\"+((aname ? ' InfoDisappear ' : ' InfoDisappear1 '))+\"0.6s ease-in-out;animation-fill-mode: forwards;animation-delay:\"+(($each.time ? $each.time + 's':'3s'))",debug:!1,ids:["aname","$each.time","$each.time"],filters:[]}},children:[{ids:["messageList.$.message"],name:"div",classList:[{type:0,value:"information-text"}],signalMap:{click:["!onInformation"]},content:{type:1,value:"($each.message)",debug:!1,ids:["$each.message"],filters:[]}},{ids:["messageList.$.close","messageList.$.id"],name:"span",classList:[{type:0,value:"inforamtion-close"}],attributes:{style:{type:1,value:"\"display:\"+($each.close?'inline-block':'none')",debug:!1,ids:["$each.close"],filters:[]},"data-val":{type:1,value:"($each.id)",debug:!1,ids:["$each.id"],filters:[]}},signalMap:{click:["!closeFunction"]},children:[]}]}]}]},Zn.$name="Message",Zn.$Styles={"$message-layer$":{main:{display:"flex",height:"100%"},varList:[],isRoot:!0},".$information$":{main:{"margin-left":"16px",display:"flex","flex-direction":"column-reverse","align-items":"flex-start"},varList:[]},".$information-item$":{main:{background:"rgba(0,0,0,0.6)","border-radius":"18px",padding:"0 16px",display:"inline-block",color:"#fff","font-size":"14px",height:"36px","line-height":"36px","margin-bottom":"5px",overflow:"hidden"},varList:[]},".$information-text$":{main:{display:"inline-block","margin-right":"10px"},varList:[]},".$inforamtion-close$:before,.$inforamtion-close$:after":{main:{width:"1px",height:"18px",content:"",position:"absolute","border-left":"2px solid rgb(255, 255, 255)",top:"-1px",left:"6px"},varList:[]},".$inforamtion-close$:before":{main:{transform:"rotate(45deg)","-ms-transform":"rotate(45deg)"},varList:[]},".$inforamtion-close$:after":{main:{transform:"rotate(135deg)","-ms-transform":"rotate(135deg)"},varList:[]},".$inforamtion-close$:hover:before,.$inforamtion-close$:hover:after":{main:{"border-left-color":"rgba(255, 255, 255, 0.8)"},varList:[]},".$inforamtion-close$:hover":{main:{},varList:[]},".$inforamtion-close$":{main:{width:"18px",height:"18px",display:"inline-block",position:"relative",cursor:"pointer","vertical-align":"middle",transform:"scale(0.8)","transform-origin":"center"},varList:[]}},Zn.$SignalStyles={},Zn.$AtRules=[[["@keyframes InfoDisappear"],"0%{height:36px;}\n100%{height:0;}\n"],[["@keyframes InfoDisappear1"],"0%{height:36px;}\n100%{height:0;}\n"]];var ro=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),io=function(){return(io=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},no=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},oo=function(e){function t(t){var r=e.call(this,t)||this;return r.state={width:176,height:99,thumb:[],nh:10,nv:10,left:0,title:""},r}return ro(t,e),t.prototype.load=function(e){return{thumb:e.thumb.map((function(e){return{show:!1,url:e.replace(/^https?:/,""),x:0,y:0}}))}},t.prototype.refresh=function(e,t){var r=e.currentTime,i=e.offsetLeft,n=this.getConfig("mediaResource"),o=n&&n.getPreview(r),a=Math.min(Math.max(0,i-this.state.width/2),1e4);if(o){var s=this.state.thumb.map((function(e){var t=io({},e);return o.url&&e.url===o.url.replace(/^https?:/,"")?(t.show=navigator.onLine,t.x=o.x,t.y=o.y):t.show=!1,t}));this.setState({title:o.title,thumb:s,time:to(r),left:a})}},no([qn("preview","...")],t.prototype,"load",null),no([Vn("dashboard.player-progressbar.hoverAt")],t.prototype,"refresh",null),t=no([Vn("dashboard.player-progressbar.hover")],t)}(Fn),ao=oo;oo.$Template={ids:["left"],name:"preview",classList:[],attributes:{style:{type:1,value:'"left:"+(left)+"px;"',debug:!1,ids:["left"],filters:[]}},signals:["hover"],children:[{ids:["thumb","thumb.$.show","thumb.$.x","width","thumb.$.y","height","thumb.$.url"],name:"div",classList:[{type:0,value:"thumb"}],iterName:"$each",repeat:{type:1,value:"(thumb)",debug:!1,ids:["thumb"],filters:[]},attributes:{style:{type:1,value:'"display:"+($each.show?\'block\':\'none\')+";background-position:-"+($each.x*width)+"px -"+($each.y*height)+"px;"',debug:!1,ids:["$each.show","$each.x","width","$each.y","height"],filters:[]},css:{type:1,value:'"background-image:url("+($each.url)+");"',debug:!1,ids:["$each.url"],filters:[]}},children:[]},{ids:["title"],name:"div",classList:[{type:0,value:"title"}],attributes:{style:{type:1,value:'"padding:"+(title?6:0)+"px;"',debug:!1,ids:["title"],filters:[]}},content:{type:1,value:"(title)",debug:!1,ids:["title"],filters:[]}},{ids:["time"],name:"div",classList:[{type:0,value:"time"}],content:{type:1,value:"(time)",debug:!1,ids:["time"],filters:[]}}]},oo.$name="Preview",oo.$Styles={$preview$:{main:{display:"none","background-color":"black",width:{type:1,value:"(width)",debug:!1,ids:["width"],filters:[]},position:"absolute",bottom:"20px","border-radius":"7px",overflow:"hidden"},varList:["width"],isRoot:!0},".$thumb$":{main:{width:{type:1,value:"(width)",debug:!1,ids:["width"],filters:[]},height:{type:1,value:"(height)",debug:!1,ids:["height"],filters:[]},"background-size":{type:1,value:"(width*nh+'px '+height*nv+'px')",debug:!1,ids:["width","nh","height","nv"],filters:[]},left:"0",top:"0"},varList:["width","height","nh","nv"]},".$title$":{main:{background:"rgba(0, 0, 0, 0.8)"},varList:[]},".$time$":{main:{position:"absolute",top:"76px",width:"100%","text-align":"center","font-size":"12px"},varList:[]}},oo.$SignalStyles={hover:{$preview$:{main:{display:"block"},varList:[],isRoot:!0}}},oo.$AtRules=[];var so=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),uo=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};var co=function(e){function t(t){var r=e.call(this,t)||this;return r.isDrag=!1,r.state={defaultSize:3,hoverSize:9,cursorSize:16,cursorColor:"#61f6ff",cursorOutline:"rgba(97, 246, 255, 0.5)",barBgColor:"rgba(133, 133, 133, 0.3)",bufferBarBgColor:"#cccccc",timeline:{duration:0,played:0,maxTime:0},points:[]},r.on("-cursorDrag",(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.isDrag=!1})),r}return so(t,e),t.prototype.TimelineUpdate=function(e,t){var r=e.played,i=e.buffered,n=e.duration,o=e.maxTime;if(t){var a=100;return o&&(a=o/n*100),{played:Math.min(a,Math.max(0,r+100*t.shift))}}return this.isDrag?{}:{played:r,buffered:i,duration:n,maxTime:o}},t.prototype.importPoint=function(e){var t=this;return e.map((function(e){return e.at/1e3/t.state.timeline.duration*100}))},t.prototype.$toPoint=function(e,t){var r=this.getBoundingClientRect(),i=r.width;return this.state.timeline.maxTime&&(i=this.state.timeline.maxTime/this.state.timeline.duration*r.width),{shift:Math.min(i,Math.max(0,Math.floor(e.clientX)-r.x))/r.width-this.state.timeline.played/100}},t.prototype.$hoverAt=function(e,t){var r=this.getBoundingClientRect(),i=Math.min(r.width,Math.max(0,e.clientX-r.x));return{currentTime:i/r.width*this.state.timeline.duration,offsetLeft:i}},t.prototype.$cursorDrag=function(e,t){this.isDrag=!0;var r=this.getBoundingClientRect();e.shiftX,r.width;return{shift:e.shiftX/r.width,total:e.totalX/r.width}},uo([Hn("timeline","cursorDrag|toPoint","-cursorDrag|toPoint")],t.prototype,"TimelineUpdate",null),uo([qn("preview.points")],t.prototype,"importPoint",null),t}(Fn),lo=co;co.$Template={name:"progressbar",classList:[],signalMap:{mouseover:["hover"],mouseleave:["-hover","-hoverAt+3000"],click:["toPoint"],mousemove:["!hoverAt"]},signals:["hover"],children:[{ids:["points","points.$"],name:"div",classList:[{type:0,value:"points"}],iterName:"$each",repeat:{type:1,value:"(points)",debug:!1,ids:["points"],filters:[]},attributes:{style:{type:1,value:'"left:"+($each)+"%"',debug:!1,ids:["$each"],filters:[]}},signals:["hover"],children:[]},{name:"div",classList:[{type:0,value:"progress-bar"}],signals:["hover"],children:[{ids:["timeline.played"],name:"div",classList:[{type:0,value:"left-bar"}],attributes:{style:{type:1,value:"\"width:\"+(timeline.played+'%')",debug:!1,ids:["timeline.played"],filters:[]}},children:[]},{name:"div",classList:[{type:0,value:"cursor"}],signalMap:{drag:["!cursorDrag"]},signals:["hover"],children:[]},{ids:["timeline.buffered"],name:"div",classList:[{type:0,value:"buffer-bar"}],attributes:{style:{type:1,value:"\"width:\"+(timeline.buffered+'%')",debug:!1,ids:["timeline.buffered"],filters:[]}},children:[]}]},{name:"preview",classList:[],component:ao,children:[]}]},co.$name="ProgressBar",co.$Styles={$progressbar$:{main:{flex:"1",height:"18px","align-items":"center",position:"relative"},varList:[],isRoot:!0},".$points$":{main:{position:"absolute",display:"none",cursor:"pointer",width:"6px",height:"9px",background:"#fff","margin-left":"-3px"},varList:[]},".$progress-bar$":{main:{width:"100%",display:"inline-block","white-space":"nowrap",height:{type:1,value:"(defaultSize)",debug:!1,ids:["defaultSize"],filters:[]},overflow:"hidden",cursor:"pointer","border-radius":"8px",background:{type:1,value:"(barBgColor)",debug:!1,ids:["barBgColor"],filters:[]},transition:"0.3s","text-align":"left"},varList:["defaultSize","barBgColor"]},".$left-bar$":{main:{height:"100%",display:"inline-block","vertical-align":"top","background-color":"#03c8d4"},varList:[]},".$cursor$:before":{main:{content:'""',position:"absolute",left:"-6px",top:"-6px",border:{type:1,value:"('14px solid '+cursorOutline)",debug:!1,ids:["cursorOutline"],filters:[]},"border-radius":"50%"},varList:["cursorOutline"]},".$cursor$":{main:{"border-radius":"50%",cursor:"pointer",width:{type:1,value:"(cursorSize)",debug:!1,ids:["cursorSize"],filters:[]},height:{type:1,value:"(cursorSize)",debug:!1,ids:["cursorSize"],filters:[]},position:"absolute","margin-left":{type:1,value:"(-cursorSize/2)",debug:!1,ids:["cursorSize"],filters:[]},"margin-top":{type:1,value:"(-(cursorSize-hoverSize)/2)",debug:!1,ids:["cursorSize","hoverSize"],filters:[]},display:"inline-block","background-color":{type:1,value:"(cursorColor)",debug:!1,ids:["cursorColor"],filters:[]},opacity:"0",transition:"0.3s opacity"},varList:["cursorSize","hoverSize","cursorColor"]},".$buffer-bar$":{main:{height:"100%",display:"inline-block","border-radius":"0 5px 5px 0","vertical-align":"top",background:{type:1,value:"(bufferBarBgColor)",debug:!1,ids:["bufferBarBgColor"],filters:[]}},varList:["bufferBarBgColor"]}},co.$SignalStyles={hover:{$progressbar$:{main:{},varList:[],isRoot:!0},"$progressbar$ .$points$":{main:{display:"block"},varList:[],isRoot:!0},".$progress-bar$":{main:{height:{type:1,value:"(hoverSize)",debug:!1,ids:["hoverSize"],filters:[]}},varList:["hoverSize"]},".$cursor$":{main:{opacity:"1"},varList:[]}}},co.$AtRules=[];var po=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ho=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},fo=function(e){function t(t){var r=e.call(this,t)||this;return r.ID="Subtitle",r.state={media:{subtitle:"",subtitleList:[]},currentSubtitle:null,iconDisplay:"none",displayContainer:"none"},r.on("-hover",(function(){r.setState({displayContainer:"none"})})),r.on("hover",(function(){r.setState({displayContainer:"block"})})),r}return po(t,e),t.prototype.disableWidget=function(e){var t=!1;return e.hasOwnProperty(this.ID)&&(t=e[this.ID]),{iconDisplay:t?"none":"inline-block"}},t.prototype.SubtitleUpdate=function(e,t){var r,i=e.subtitleList,n=e.subtitle;return this.setState({currentSubtitle:null}),t&&(n=t,this.setState({displayContainer:"none"})),i&&i.length>0&&(r=i.filter((function(e){return e.name===n}))[0]),this.setState({currentSubtitle:r}),{subtitleList:i,subtitle:n}},t.prototype.$changeSubCode=function(e){return e.target.getAttribute("data-val")},ho([qn("disableWidget","...")],t.prototype,"disableWidget",null),ho([Hn("media","changeSubCode")],t.prototype,"SubtitleUpdate",null),t}(Fn),mo=fo;fo.$Template={name:"subtitle",classList:[],signalMap:{mouseover:["hover"],mouseout:["-hover"]},children:[{name:"div",classList:[{type:0,value:"!control-btn"}],children:[{ids:["currentSubtitle.label","currentSubtitle.name"],name:"span",classList:[{type:0,value:"!control-icon"}],content:{type:1,value:"(currentSubtitle.label || currentSubtitle.name)",debug:!1,ids:["currentSubtitle.label","currentSubtitle.name"],filters:[]}},{name:"div",classList:[{type:0,value:"!control-container"},{type:0,value:"subtitle-container"}],children:[{name:"div",classList:[{type:0,value:"subtitle-dashboard"}],children:[{ids:["media.subtitleList","media.subtitleList.$.name","currentSubtitle.name"],name:"div",classList:[{type:0,value:"subtitle-item"}],iterName:"$each",repeat:{type:1,value:"(media.subtitleList)",debug:!1,ids:["media.subtitleList"],filters:[]},attributes:{"data-val":{type:1,value:"($each.name)",debug:!1,ids:["$each.name"],filters:[]},style:{type:1,value:"(($each.name===currentSubtitle.name?'color:#61F6FF;':''))",debug:!1,ids:["$each.name","currentSubtitle.name"],filters:[]}},signalMap:{click:["!changeSubCode"]},content:{type:1,value:"($each.name)",debug:!1,ids:["$each.name"],filters:[]}}]}]}]}]},fo.$name="Subtitle",fo.$Styles={"$subtitle$:hover .control-icon":{main:{color:"#61F6FF"},varList:[],isRoot:!0},$subtitle$:{main:{display:{type:1,value:"(iconDisplay)",debug:!1,ids:["iconDisplay"],filters:[]}},varList:["iconDisplay"],isRoot:!0},".$subtitle-container$":{main:{display:{type:1,value:"(displayContainer)",debug:!1,ids:["displayContainer"],filters:[]}},varList:["displayContainer"]},".$subtitle-dashboard$":{main:{padding:"10px 0",display:"inline-block","background-color":"#000000","border-radius":"4px"},varList:[]},".$subtitle-item$:hover":{main:{color:"#61F6FF"},varList:[]},".$subtitle-item$":{main:{padding:"10px 20px",position:"relative","text-align":"left",display:"block","line-height":"16px","white-space":"nowrap"},varList:[]}},fo.$SignalStyles={},fo.$AtRules=[];var yo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),go=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},vo=function(e){function t(t){var r=e.call(this,t)||this;return r.ID="Language",r.state={media:{language:"",languageList:[]},currentLanguage:null,iconDisplay:"none",displayContainer:"none"},r.on("-hover",(function(){r.setState({displayContainer:"none"})})),r.on("hover",(function(){r.setState({displayContainer:"block"})})),r}return yo(t,e),t.prototype.disableWidget=function(e){var t=!1;return e.hasOwnProperty(this.ID)&&(t=e[this.ID]),{iconDisplay:t?"none":"inline-block"}},t.prototype.LanguageUpdate=function(e,t){var r,i=e.languageList,n=e.language;return this.setState({currentLanguage:null}),t&&(n=t,this.setState({displayContainer:"none"})),i&&i.length>1&&(r=i.filter((function(e){return e.langCode===n}))[0]),this.setState({currentLanguage:r}),{languageList:i,language:n}},t.prototype.$changeLanguage=function(e){return e.target.getAttribute("data-val")},go([qn("disableWidget","...")],t.prototype,"disableWidget",null),go([Hn("media","changeLanguage")],t.prototype,"LanguageUpdate",null),t}(Fn),bo=vo;vo.$Template={name:"language",classList:[],signalMap:{mouseover:["hover"],mouseleave:["-hover"]},children:[{name:"div",classList:[{type:0,value:"!control-btn"}],children:[{ids:["currentLanguage","currentLanguage.label","currentLanguage.langName"],name:"span",classList:[{type:0,value:"!control-icon"}],content:{type:1,value:"(currentLanguage&&(currentLanguage.label || currentLanguage.langName))",debug:!1,ids:["currentLanguage","currentLanguage.label","currentLanguage.langName"],filters:[]}},{name:"div",classList:[{type:0,value:"!control-container"},{type:0,value:"language-container"}],children:[{name:"div",classList:[{type:0,value:"language-dashboard"}],children:[{ids:["media.languageList","media.languageList.$.langName","media.languageList.$.langCode","currentLanguage","currentLanguage.langCode"],name:"div",classList:[{type:0,value:"language-item"}],iterName:"$each",repeat:{type:1,value:"(media.languageList)",debug:!1,ids:["media.languageList"],filters:[]},attributes:{"data-val":{type:1,value:"($each.langCode)",debug:!1,ids:["$each.langCode"],filters:[]},style:{type:1,value:"((currentLanguage&&$each.langCode===currentLanguage.langCode?'color:#61F6FF;':''))",debug:!1,ids:["currentLanguage","$each.langCode","currentLanguage.langCode"],filters:[]}},signalMap:{click:["!changeLanguage"]},content:{type:1,value:"($each.langName)",debug:!1,ids:["$each.langName"],filters:[]}}]}]}]}]},vo.$name="Language",vo.$Styles={"$language$:hover .control-icon":{main:{color:"#61F6FF"},varList:[],isRoot:!0},$language$:{main:{display:{type:1,value:"(iconDisplay)",debug:!1,ids:["iconDisplay"],filters:[]}},varList:["iconDisplay"],isRoot:!0},".$language-container$":{main:{display:{type:1,value:"(displayContainer)",debug:!1,ids:["displayContainer"],filters:[]}},varList:["displayContainer"]},".$language-dashboard$":{main:{padding:"10px 0",display:"inline-block","background-color":"#000000","border-radius":"4px"},varList:[]},".$language-item$:hover":{main:{color:"#61F6FF"},varList:[]},".$language-item$":{main:{padding:"10px 20px",position:"relative","text-align":"left",display:"block","line-height":"16px","white-space":"nowrap"},varList:[]}},vo.$SignalStyles={},vo.$AtRules=[];var Eo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),_o=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3r=e.call(this,t)||this;return r.ID="PlayRate",r.state={media:{rate:0,rateList:[]},currentRate:null,iconDisplay:"none"},r.on("-hover",(function(){r.setState({displayContainer:"none"})})),r.on("hover",(function(){r.setState({displayContainer:"block"})})),r}return Eo(t,e),t.prototype.disableWidget=function(e){var t=!1;return e.hasOwnProperty(this.ID)&&(t=e[this.ID]),{iconDisplay:t?"none":"inline-block"}},t.prototype.rateUpdate=function(e,t){var r,i=e.rate,n=e.rateList;return this.setState({currentRate:null}),t&&(i=t,this.setState({displayContainer:"none"})),n&&n.length>1&&(r=n.filter((function(e){return e.rate===i}))[0]),this.setState({currentRate:r}),{rateList:n,rate:i}},t.prototype.$changeRate=function(e){var t=e.target.getAttribute("data-val");return Number(t)},_o([qn("disableWidget","...")],t.prototype,"disableWidget",null),_o([Hn("media","changeRate")],t.prototype,"rateUpdate",null),t}(Fn),So=Ro;Ro.$Template={name:"play-rate",classList:[],signalMap:{mouseover:["hover"],mouseleave:["-hover"]},children:[{name:"div",classList:[{type:0,value:"!control-btn"}],children:[{ids:["currentRate.label","currentRate.name"],name:"span",classList:[{type:0,value:"!control-icon"}],content:{type:1,value:"(currentRate.label || currentRate.name)",debug:!1,ids:["currentRate.label","currentRate.name"],filters:[]}},{name:"div",classList:[{type:0,value:"!control-container"},{type:0,value:"rate-container"}],children:[{name:"div",classList:[{type:0,value:"rate-dashboard"}],children:[{ids:["media.rateList","media.rateList.$.name","media.rateList.$.rate","currentRate.rate"],name:"div",classList:[{type:0,value:"rate-item"}],iterName:"$each",repeat:{type:1,value:"(media.rateList)",debug:!1,ids:["media.rateList"],filters:[]},attributes:{"data-val":{type:1,value:"($each.rate)",debug:!1,ids:["$each.rate"],filters:[]},style:{type:1,value:"(($each.rate==currentRate.rate?'color:#61F6FF;':''))",debug:!1,ids:["$each.rate","currentRate.rate"],filters:[]}},signalMap:{click:["!changeRate"]},content:{type:1,value:"($each.name)",debug:!1,ids:["$each.name"],filters:[]}}]}]}]}]},Ro.$name="PlayRate",Ro.$Styles={"$play-rate$:hover .control-icon":{main:{color:"#61F6FF"},varList:[],isRoot:!0},"$play-rate$":{main:{display:{type:1,value:"(iconDisplay)",debug:!1,ids:["iconDisplay"],filters:[]}},varList:["iconDisplay"],isRoot:!0},".$rate-container$":{main:{display:{type:1,value:"(displayContainer)",debug:!1,ids:["displayContainer"],filters:[]}},varList:["displayContainer"]},".$rate-dashboard$":{main:{padding:"10px 0",display:"inline-block","background-color":"#000000","border-radius":"4px"},varList:[]},".$rate-item$:hover":{main:{color:"#61F6FF"},varList:[]},".$rate-item$":{main:{padding:"10px 20px",position:"relative","text-align":"left",display:"block","line-height":"16px","white-space":"nowrap"},varList:[]}},Ro.$SignalStyles={},Ro.$AtRules=[];var Ao=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnP){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),To=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},wo=function(e){function t(t){var r=e.call(this,t)||this;retautoLevel:""},currentQuality:null,iconDisplay:"none",displayContainer:"none"},r.on("-hover",(function(){r.setState({displayContainer:"none"})})),r.on("hover",(function(){r.setState({displayContainer:"block"})})),r}return Ao(t,e),t.prototype.disableWidget=function(e){var t=!1;return e.hasOwnProperty(this.ID)&&(t=e[this.ID]),{iconDisplay:t?"none":"inline-block"}},t.prototype.qualityUpdate=function(e,t){var r,i=e.quality,n=e.qualityList,o=e.autoLevel;return this.setState({currentQuality:null}),t&&(i=t,this.setState({displayContainer:"none"})),n&&n.length>0&&(r=n.filter((function(e){return e.code===i}))[0]),this.setState({currentQuality:r}),{quality:i,qualityList:n,autoLevel:o}},t.prototype.$changeQuality=function(e){return e.currentTarget.getAttribute("data-val")},To([qn("disableWidget","...")],t.prototype,"disableWidget",null),To([Hn("media","changeQuality")],t.prototype,"qualityUpdate",null),t}(Fn),Lo=wo;wo.$Template={name:"quality",classList:[],signalMap:{mouseover:["hover"],mouseleave:["-hover"]},children:[{name:"div",classList:[{type:0,value:"!control-btn"}],children:[{ids:["currentQuality.label","currentQuality.name"],name:"span",classList:[{type:0,value:"!control-icon"}],content:{type:1,value:"(currentQuality.label || currentQuality.name)",debug:!1,ids:["currentQuality.label","currentQuality.name"],filters:[]}},{ids:["media.autoLevel","media.quality"],name:"span",classList:[{type:0,value:"auto"}],attributes:{style:{type:1,value:"\"display:\"+((media.quality=='auto'?'inline-block;':'none;'))",debug:!1,ids:["media.quality"],filters:[]}},content:{type:1,value:"(media.autoLevel)",debug:!1,ids:["media.autoLevel"],filters:[]}},{name:"div",classList:[{type:0,value:"quality-container"}],children:[{name:"div",classList:[{type:0,value:"quality-dashboard"}],children:[{ids:["media.qualityList","media.qualityList.$.name","media.qualityList.$.code","media.quality"],name:"div",classList:[{type:0,value:"quality-item"}],iterName:"$each",repeat:{type:1,value:"(media.qualityList)",debug:!1,ids:["media.qualityList"],filters:[]},attributes:{"data-val":{type:1,value:"($each.code)",debug:!1,ids:["$each.code"],filters:[]},style:{type:1,value:"(($each.code==media.quality?'color:#61F6FF':''))+\";\"",debug:!1,ids:["$each.code","media.quality"],filters:[]}},signalMap:{click:["!changeQuality"]},content:{type:1,value:"($each.name)",debug:!1,ids:["$each.name"],filters:[]}}]}]}]}]},wo.$name="Quality",wo.$Styles={"$quality$:hover .control-icon":{main:{color:"#61F6FF"},varList:[],isRoot:!0},$quality$:{main:{display:{type:1,value:"(iconDisplay)",debug:!1,ids:["iconDisplay"],filters:[]}},varList:["iconDisplay"],isRoot:!0},"$quality$ .$auto$":{main:{color:"#9D9FA8","font-size":"11px",position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)"},varList:[],isRoot:!0},".$quality-container$":{main:{display:{type:1,value:"(displayContainer)",debug:!1,ids:["displayContainer"],filters:[]},width:"auto",position:"absolute",bottom:"20px","padding-bottom":"35px","background-color":"rgba(0,0,0,0)",left:"-20px"},varList:["displayContainer"]},".$quality-dashboard$ .tips-text":{main:{"font-size":"10px",opacity:"0.7","text-align":"left",height:"14px","line-height":"14px",width:"100px","margin-top":"4px"},varList:[]},".$quality-dashboard$":{main:{padding:"10px 0",display:"inline-block","background-color":"#000000","border-radius":"4px"},varList:[]},".$quality-item$:not([disabled]):hover":{main:{color:"#61F6FF"},varList:[]},".$quality-item$:not([disabled])":{main:{},varList:[]},".$quality-item$":{main:{padding:"10px 20px",position:"relative","text-align":"left",display:"block","line-height":"16px","white-space":"nowrap"},varList:[]}},wo.$SignalStyles={},wo.$AtRules=[];var Oo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),xo=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Po=function(e){function t(t){var r=e.call(this,t)||this;return r.ID="Settings",r.state={player:{loop:!1,skip:!1,continuePlay:!1,openSetting:!1},iconDisplay:"inline-block",displayContainer:!1},r.on("-hover",(function(){r.setState({displayContainer:!1,player:{openSetting:!1}}),r.signal("closeSetting")})),r.on("hover",(function(){r.setState({displayContainer:!0})})),r}return Oo(t,e),t.prototype.disableWidget=function(e){var t=!1;return e.hasOwnProperty(this.ID)&&(t=e[this.ID]),{iconDisplay:t?"none":"inline-block"}},t.prototype.SettingsUpdate=function(e,t){var r=e.loop,i=e.skip,n=e.continuePlay,o=e.openSetting;return t||{loop:r,skip:i,continuePlay:n,openSetting:o}},t.prototype.$continuePlayClick=function(e){return this.state.player.continuePlay?{continuePlay:!1}:{continuePlay:!0,loop:!1}},t.prototype.$loopPlayClick=function(e,t){return this.state.player.loop?{loop:!1}:{loop:!0,continuePlay:!1}},t.prototype.$skipClick=function(e,t){return this.state.player.skip?{skip:!1}:{skip:!0}},xo([qn("disableWidget","...")],t.prototype,"disableWidget",null),xo([Hn("player","continuePlayClick|loopPlayClick|skipClick")],t.prototype,"SettingsUpdate",null),t}(Fn),Do=Po;Po.$Template={name:"settings",classList:[],signalMap:{mouseover:["hover"],mouseleave:["-hover"]},children:[{name:"div",classList:[{type:0,value:"!control-btn"}],children:[{name:"span",classList:[{type:0,value:"!control-icon"}],content:{type:0,value:""}},{name:"div",classList:[{type:0,value:"!control-container"},{type:0,value:"settings-container"}],children:[{name:"div",classList:[{type:0,value:"settings-dashboard"}],children:[{name:"div",classList:[{type:0,value:"play-way"}],children:[{name:"div",classList:[{type:0,value:"settings-item"}],attributes:{"data-val":{type:0,value:"loop"}},content:{type:0,value:""}},{name:"div",classList:[{type:0,value:"setting-playway"},{type:0,value:"continuePlay"}],signalMap:{click:["!continuePlayClick"]},content:{type:0,value:""}},{name:"div",classList:[{type:0,value:"setting-playway"},{type:0,value:"loop"}],signalMap:{click:["!loopPlayClick"]},content:{type:0,value:""}}]},{name:"div",classList:[{type:0,value:"play-way"}],children:[{name:"div",classList:[{type:0,value:"settings-item"}],attributes:{"data-val":{type:0,value:"skip"}},content:{type:0,value:""}},{name:"div",classList:[{type:0,value:"circle-container"}],signalMap:{click:["!skipClick"]},children:[{name:"div",classList:[{type:0,value:"toggle"}],children:[{name:"div",classList:[{type:0,value:"circle-button"}],children:[]}]}]}]}]}]}]}]},Po.$name="Settings",Po.$Styles={"$settings$:hover setting-icon":{main:{color:"#61F6FF"},varList:[],isRoot:!0},$settings$:{main:{display:{type:1,value:"(iconDisplay)",debug:!1,ids:["iconDisplay"],filters:[]},position:"relative"},varList:["iconDisplay"],isRoot:!0},".$settings-container$":{main:{display:{type:1,value:"(!displayContainer&&!player.openSetting?'none':'block')",debug:!1,ids:["displayContainer","player.openSetting"],filters:[]},left:"-132px"},varList:["displayContainer","player.openSetting"]},".$settings-dashboard$":{main:{width:"264px",height:"90px","font-size":"12px",color:"#FFFFFF",display:"inline-block","background-color":"#000000","border-radius":"4px"},varList:[]},".$play-way$:first-of-type":{main:{"padding-top":"12px","padding-bottom":"8px"},varList:[]},".$play-way$:last-of-type":{main:{"padding-top":"5px","padding-bottom":"20px"},varList:[]},".$play-way$":{main:{display:"flex"},varList:[]},".$settings-item$":{main:{"padding-left":"18px","padding-right":"18px",position:"relative","text-align":"left","line-height":"24px"},varList:[]},".$setting-playway$:focus":{main:{color:"#61F6FF"},varList:[]},".$setting-playway$":{main:{"margin-left":"24px",position:"relative","text-align":"left","line-height":"24px",height:"24px",cursor:"pointer","border-radius":"4px 4px 0 0"},varList:[]},".$continuePlay$":{main:{color:{type:1,value:"(player.continuePlay?'#61F6FF':'#fff')",debug:!1,ids:["player.continuePlay"],filters:[]}},varList:["player.continuePlay"]},".$loop$":{main:{color:{type:1,value:"(player.loop?'#61F6FF':'#fff')",debug:!1,ids:["player.loop"],filters:[]}},varList:["player.loop"]},".$circle-container$":{main:{"padding-left":"84px","padding-right":"18px",cursor:"pointer"},varList:[]},".$toggle$":{main:{position:"relative",height:"20px",width:"36px","border-radius":"36px","background-color":{type:1,value:"(player.skip?'#61F6FF':'#e4e4e440 ')",debug:!1,ids:["player.skip"],filters:[]}},varList:["player.skip"]},".$circle-button$":{main:{position:"absolute",width:"20px",left:{type:1,value:"(player.skip?'auto':'0px')",debug:!1,ids:["player.skip"],filters:[]},right:{type:1,value:"(player.skip?'0px':'auto')",debug:!1,ids:["player.skip"],filters:[]},top:"0px","background-color":"#fff","border-radius":"50%",height:"20px"},varList:["player.skip"]}},Po.$SignalStyles={},Po.$AtRules=[];var ko=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Io="",Mo=document.createElement("style");document.head.appendChild(Mo);var Co=Mo.sheet,No=function(e){function t(t){var r=e.call(this,t)||this;return r.state={family:Io,color:"rgba(255,255,255,0.8)",size:22,code:'"\\e603"',tips:"",hoverColor:"#61F6FF",displayIcon:"inline-block"},r}return ko(t,e),t.addFontFace=function(e,t){t=t.replace(/\.[^.]+$/,""),Co.insertRule("@font-face {\n            font-family: '"+e+"';\n            url('"+t+".woff2') format('woff2'),\n            url('"+t+".woff') format('woff'),\n            url('"+t+".ttf') format('truetype'),\n        }",Co.cssRules.length),Io=e},t}(Fn),Uo=No;No.$Template={name:"icon",classList:[],signalMap:{click:["click"],mouseover:["hover"],mouseleave:["-hover"]},children:[]},No.$name="Icon",No.$Styles={"$icon$::before":{main:{content:{type:1,value:"(code)",debug:!1,ids:["code"],filters:[]}},varList:["code"],isRoot:!0},"$icon$:hover::after":{main:{display:{type:1,value:"(displayIcon)",debug:!1,ids:["displayIcon"],filters:[]},content:{type:1,value:"(tips)",debug:!1,ids:["tips"],filters:[]},position:"absolute","font-size":"12px","border-radius":"4px",color:"rgba(255, 255, 255, 0.6)",bottom:"50px","line-height":"12px",left:"50%",padding:{type:1,value:"(tips?'4px':0)",debug:!1,ids:["tips"],filters:[]},"background-color":"rgba(0, 0, 0, 0.8)",transform:"translateX(-50%)","word-break":"keep-all"},varList:["displayIcon","tips"],isRoot:!0},"$icon$:hover":{main:{color:{type:1,value:"(hoverColor)",debug:!1,ids:["hoverColor"],filters:[]}},varList:["hoverColor"],isRoot:!0},$icon$:{main:{display:{type:1,value:"(displayIcon)",debug:!1,ids:["displayIcon"],filters:[]},"font-family":{type:1,value:"(family)",debug:!1,ids:["family"],filters:[]},"font-size":{type:1,value:"(size)",debug:!1,ids:["size"],filters:[]},"vertical-align":"middle",position:"relative",cursor:"pointer",color:{type:1,value:"(color)",debug:!1,ids:["color"],filters:[]},height:"32px","line-height":"32px",width:{type:1,value:"(size+2+'px')",debug:!1,ids:["size"],filters:[]},"text-align":"center"},varList:["displayIcon","family","size","color"],isRoot:!0}},No.$SignalStyles={},No.$AtRules=[];var Bo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Fo=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},jo=function(e){function t(t){var r=e.call(this,t)||this;return r.ID="VolumeControl",r.state={sliderHeight:136,volumeDisplay:!0,iconDisplay:"inline-block"},r}return Bo(t,e),t.prototype.disableWidget=function(e){var t=!1;return e.hasOwnProperty(this.ID)&&(t=e[this.ID]),{iconDisplay:t?"none":"inline-block"}},t.prototype.VolumeUpdate=function(e,t){var r=e.volume,i=e.muted;if(null!=t){var n=void 0;return(n=i?Math.round(100*t.shift):Math.round(r+100*t.shift))<=0?{volume:0,muted:!0}:{volume:Math.min(100,n),muted:!1}}return{volume:r,muted:i}},t.prototype.$volumeDrag=function(e,t){return{shift:-e.shiftY/this.state.sliderHeight}},Fo([qn("disableWidget","...")],t.prototype,"disableWidget",null),Fo([Hn("player","volumeDrag")],t.prototype,"VolumeUpdate",null),t}(Fn),Go=jo;jo.$Template={name:"volume-control",classList:[],signalMap:{mouseover:["hover"],mouseleave:["-hover"],click:["toPoint"]},children:[{ids:["player.muted"],name:"volume-icon",classList:[],component:Uo,attributes:{code:{type:1,value:"(player.muted?'\\\\e671':'\\\\e672')",debug:!1,ids:["player.muted"],filters:[]}},children:[]},{name:"div",classList:[{type:0,value:"!control-container"},{type:0,value:"volume-container"}],signals:["hover"],children:[{name:"div",classList:[{type:0,value:"volume-dashboard"}],children:[{name:"div",classList:[{type:0,value:"control-volume-slider"}],children:[{name:"div",classList:[{type:0,value:"input-range-container"}],children:[{name:"div",classList:[{type:0,value:"input-range-thumb"}],signalMap:{drag:["!volumeDrag"]},children:[]}]},{name:"div",classList:[{type:0,value:"control-volume-current"}],children:[]}]},{ids:["player.muted","player.volume"],name:"div",classList:[{type:0,value:"volume-tip"}],attributes:{id:{type:0,value:"volume-tip"}},content:{type:1,value:"(player.muted? '0%': player.volume + '%')",debug:!1,ids:["player.muted","player.volume"],filters:[]}}]}]}]},jo.$name="VolumeControl",jo.$Styles={".control-volume-box":{main:{left:"50%"},varList:[]},"$volume-control$":{main:{display:{type:1,value:"(volumeDisplay)",debug:!1,ids:["volumeDisplay"],filters:[]},position:"relative",width:"20px",height:"32px","line-height":"32px"},varList:["volumeDisplay"],isRoot:!0},"$volume-control$:hover %volume-icon%":{main:{color:"#61F6FF"},varList:[],isRoot:!0},".$volume-dashboard$":{main:{width:"60px",height:"200px","font-size":"12px",color:"#FFFFFF",display:"inline-block","background-color":"#000000","border-radius":"7px"},varList:[]},".$control-volume-slider$":{main:{position:"absolute",width:"4px",height:{type:1,value:"(sliderHeight+'px')",debug:!1,ids:["sliderHeight"],filters:[]},top:"48px",left:"28px",background:"rgba(255, 255, 255, 0.3)","border-radius":"4px"},varList:["sliderHeight"]},".$input-range-container$":{main:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%","z-index":"12",opacity:"1"},varList:[]},".$input-range-thumb$:before":{main:{display:"block",content:'""',position:"absolute",top:"-13px",left:"-13px",border:"13px solid  rgba(255, 255, 255, 0.2)",opacity:"0.2","border-radius":"26px",background:"#FFFFFF"},varList:[]},".$input-range-thumb$":{main:{bottom:{type:1,value:"(player.muted?'0%':player.volume > 100?'100%':player.volume +'%')",debug:!1,ids:["player.muted","player.volume","player.volume"],filters:[]},"padding-bottom":"2px","z-index":"111",position:"absolute",top:"auto","background-color":"#fff","margin-bottom":"-7px",left:"0",border:"4px solid #fff","margin-left":"-2px","border-radius":"8px",cursor:"pointer"},varList:["player.muted","player.volume"]},".$control-volume-current$":{main:{"background-color":"#61f6ff",opacity:"1",position:"absolute",bottom:"0",width:"4px",height:{type:1,value:"(player.muted?'0%':player.volume > 100?'100%':player.volume +'%')",debug:!1,ids:["player.muted","player.volume","player.volume"],filters:[]},"border-radius":"4px"},varList:["player.muted","player.volume"]},".$volume-tip$":{main:{position:"relative","font-size":"14px",color:"#FFFFFF","letter-spacing":"0",display:"block",width:"36px",height:"16px",margin:"9px 12px","line-height":"16px","text-align":"center","padding-top":"7px"},varList:[]}},jo.$SignalStyles={hover:{".$volume-container$":{main:{display:"block"},varList:[]}}},jo.$AtRules=[];var Vo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),qo="",Ho=document.createElement("style");document.head.appendChild(Ho);var $o=Ho.sheet,Wo=function(e){function t(t){var r=e.call(this,t)||this;return r.state={family:qo,code:'"\\e603"',size:22,text:"",color:"rgba(255, 255, 255, 0.8)"},r}return Vo(t,e),t.addFontFace=function(e,t){t=t.replace(/\.[^.]+$/,""),$o.insertRule("@font-face {\n            font-family: '"+e+"';\n            src: url('"+t+"');\n            src: url('"+t+".eot?#iefix') format('embedded-opentype'),\n            url('"+t+".woff2') format('woff2'),\n            url('"+t+".woff') format('woff'),\n            url('"+t+".ttf') format('truetype'),\n            url('"+t+".svg') format('svg');\n        }",$o.cssRules.length),qo=e},t}(Fn),zo=Wo;Wo.$Template={name:"div",classList:[{type:0,value:"individual-container"}],signalMap:{click:["click"]},children:[{name:"icon",classList:[],children:[]},{ids:["text"],name:"span",classList:[{type:0,value:"text"}],content:{type:1,value:"(text)",debug:!1,ids:["text"],filters:[]}}]},Wo.$name="IconText",Wo.$Styles={".$individual-container$:hover":{main:{color:"#61F6FF"},varList:[],isRoot:!0},".$individual-container$":{main:{display:"flex","align-items":"center",height:"32px","line-height":"32px",cursor:"pointer",color:{type:1,value:"(color)",debug:!1,ids:["color"],filters:[]}},varList:["color"],isRoot:!0},"$icon$::before":{main:{content:{type:1,value:"(code)",debug:!1,ids:["code"],filters:[]}},varList:["code"]},$icon$:{main:{"font-family":{type:1,value:"(family)",debug:!1,ids:["family"],filters:[]},"font-size":{type:1,value:"(size)",debug:!1,ids:["size"],filters:[]},"line-height":"1",display:"inline-block",position:"relative"},varList:["family","size"]},".$individual-container$ .$text$":{main:{"font-size":"14px","margin-left":"6px","line-height":"1",display:"inline-block"},varList:[],isRoot:!0}},Wo.$SignalStyles={},Wo.$AtRules=[];var Ko=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Yo=function(){return(Yo=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);ro=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Uo.addFontFace("PlayerIconFont","//at.alicdn.com/t/font_2475835_8y0606h28wi.woff2"),zo.addFontFace("PlayerIconFont","//at.alicdn.com/t/font_2475835_8y0606h28wi.eot");var Qo=function(e){function t(t){var r=e.call(this,t)||this;return ,disableWidget:{},showDashboard:!0,cursor:"none",panelCursor:"none"},r.on("-active",(function(){r.dashboardChange(!1)})),r.on("active",(function(){r.dashboardChange(!0)})),r}return Ko(t,e),t.prototype.dashboardChange=function(e){if(-1===this.signals.indexOf("lock")){var t=e||this.signals.indexOf("hold")>=0;this.setState({showDashboard:t}),this.signal("showDashboard",t),this.cursorChange(this.state.player)}},t.prototype.cursorChange=function(e){this.state.showDashboard||e.disableDashboard||!e.fullscreen&&!e.webfullscreen?this.setState({cursor:"default",panelCursor:"pointer"}):this.setState({cursor:"none",panelCursor:"none"})},t.prototype.playerUpdate=function(e){return this.cursorChange(e),Yo({},e)},t.prototype.timeline=function(e){var t=e.currentTime,r=e.duration;return{currentTime:to(t),duration:to(r)}},Xo([qn("player")],t.prototype,"playerUpdate",null),Xo([qn("timeline")],t.prototype,"timeline",null),t=Xo([qn("disableWidget")],t)}(Fn),Jo=Qo;Qo.$Template={name:"dashboard",classList:[],signalMap:{mousemove:["active","-active^4000"],mouseleave:["-active^2000"]},children:[{name:"div",classList:[{type:0,value:"display-panel"}],attributes:{"data-val":{type:0,value:"click-control"}},signalMap:{click:["triggerClick"],dblclick:["fullscreenClick"],contextmenu:["onContextmenu"]},children:[{name:"message-layer",classList:[],component:eo,children:[]}]},{name:"div",classList:[{type:0,value:"bar-container"}],children:[{ids:["player.paused","player.ended"],name:"play-icon",classList:[],component:Uo,attributes:{code:{type:1,value:"(player.paused||player.ended?'\\\\e676':'\\\\e677')",debug:!1,ids:["player.paused","player.ended"],filters:[]}},signalMap:{hover:["hold"]},children:[]},{ids:["timeline.currentTime"],name:"div",classList:[{type:0,value:"timer-panel"}],content:{type:1,value:"(timeline.currentTime)",debug:!1,ids:["timeline.currentTime"],filters:[]}},{name:"player-progressbar",classList:[],component:lo,signalMap:{hover:["hold"]},children:[]},{ids:["timeline.duration"],name:"div",classList:[{type:0,value:"timer-panel"}],content:{type:1,value:"(timeline.duration)",debug:!1,ids:["timeline.duration"],filters:[]}}]},{name:"div",classList:[{type:0,value:"dashboard-buttons"}],children:[{name:"div",classList:[{type:0,value:"!control-center-grid"}],signalMap:{mouseover:["hold"],mouseleave:["-hold"]},children:[]},{name:"div",classList:[{type:0,value:"rear-ctn"}],children:[{name:"subtitle",classList:[],component:mo,signalMap:{hover:["hold"]},children:[]},{name:"language-control",classList:[],component:bo,signalMap:{hover:["hold"]},children:[]},{name:"rate-control",classList:[],component:So,signalMap:{hover:["hold"]},children:[]},{name:"quality",classList:[],component:Lo,signalMap:{hover:["hold"]},children:[]},{name:"settings",classList:[],component:Do,signalMap:{hover:["hold"]},children:[]},{name:"volume-control",classList:[],component:Go,signalMap:{hover:["hold"]},children:[]},{ids:["disableWidget.PIP"],name:"pip-icon",classList:[],component:Uo,attributes:{code:{type:1,value:"('\\\\e66c')",debug:!1,ids:[],filters:[]},tips:{type:1,value:"('')",debug:!1,ids:[],filters:[]},displayIcon:{type:1,value:"(disableWidget.PIP?'none':'inline-block')",debug:!1,ids:["disableWidget.PIP"],filters:[]}},signalMap:{hover:["hold"]},children:[]},{ids:["player.webfullscreen","disableWidget.WebFullscreen"],name:"webfullscreen-icon",classList:[],component:Uo,attributes:{code:{type:1,value:"(player.webfullscreen?'\\\\e67f':'\\\\e679')",debug:!1,ids:["player.webfullscreen"],filters:[]},tips:{type:1,value:"(player.webfullscreen?'':'')",debug:!1,ids:["player.webfullscreen"],filters:[]},displayIcon:{type:1,value:"(disableWidget.WebFullscreen?'none':'inline-block')",debug:!1,ids:["disableWidget.WebFullscreen"],filters:[]}},signalMap:{hover:["hold"]},children:[]},{ids:["player.fullscreen","disableWidget.Fullscreen"],name:"fullscreen-icon",classList:[],component:Uo,attributes:{code:{type:1,value:"(player.fullscreen?'\\\\e67c':'\\\\e67b')",debug:!1,ids:["player.fullscreen"],filters:[]},tips:{type:1,value:"(player.fullscreen?'':'')",debug:!1,ids:["player.fullscreen"],filters:[]},displayIcon:{type:1,value:"(disableWidget.Fullscreen?'none':'inline-block')",debug:!1,ids:["disableWidget.Fullscreen"],filters:[]}},signalMap:{hover:["hold"]},children:[]}]}]}]},Qo.$name="Dashboard",Qo.$Styles={top:{main:{"z-index":"1",display:{type:1,value:"(!player.fullscreen||!showDashboard||disableWidget.TopLayer?'none':'inline-block')",debug:!1,ids:["player.fullscreen","showDashboard","disableWidget.TopLayer"],filters:[]}},varList:["player.fullscreen","showDashboard","disableWidget.TopLayer"]},"minisize-layer":{main:{"z-index":"1",display:{type:1,value:"(showDashboard&&player.minisize?'block':'none')",debug:!1,ids:["showDashboard","player.minisize"],filters:[]}},varList:["showDashboard","player.minisize"]},".right-panel":{main:{"z-index":"2",position:"absolute",padding:"19px 8px",top:"50%",transform:"translateY(-50%)",right:"45px","background-color":"rgba(0,0,0,0.8)","border-radius":"32px","margin-top":"35px",display:{type:1,value:"(!showDashboard||disableWidget.RightLayer?'none':'block')",debug:!1,ids:["showDashboard","disableWidget.RightLayer"],filters:[]}},varList:["showDashboard","disableWidget.RightLayer"]},"next-control":{main:{"margin-left":"18px"},varList:[]},".control-btn":{main:{display:"inline-block",height:"32px","line-height":"32px",cursor:"pointer",position:"relative","background-size":"cover","background-color":"transparent",border:"none","text-shadow":"0 1px 0 rgba(0,0,0,0.24)","vertical-align":"middle",opacity:"0.8","font-size":"14px"},varList:[]},".control-container":{main:{display:"none",width:"auto",position:"absolute",bottom:"20px","padding-bottom":"35px",left:"-20px","background-color":"rgba(0,0,0,0)"},varList:[]},".control-icon:hover":{main:{color:"#61F6FF"},varList:[]},".control-icon":{main:{width:"auto",overflow:"hidden","text-align":"center",display:"inline-block",color:"rgba(255,255,255,0.8)"},varList:[]},$dashboard$:{main:{"z-index":"1100",left:"0",top:"0",display:{type:1,value:"(!player.disableDashboard?'flex':'none')",debug:!1,ids:["player.disableDashboard"],filters:[]},width:"100%",height:"100%",position:"absolute","flex-direction":"column","align-content":"end","justify-content":"flex-end",cursor:{type:1,value:"(cursor)",debug:!1,ids:["cursor"],filters:[]}},varList:["player.disableDashboard","cursor"],isRoot:!0},".$display-panel$":{main:{"z-index":"0","background-color":"rgba(255, 0, 0, 0)",width:"100%",flex:"1",display:"flex",position:"relative",cursor:{type:1,value:"(panelCursor)",debug:!1,ids:["panelCursor"],filters:[]}},varList:["panelCursor"]},".$bar-container$":{main:{"z-index":"2","margin-left":"18px",height:"20px",display:{type:1,value:"(showDashboard?'flex':'none')",debug:!1,ids:["showDashboard"],filters:[]},"align-items":"center","margin-bottom":{type:1,value:"(disableWidget.ControlButton?'10px':'0')",debug:!1,ids:["disableWidget.ControlButton"],filters:[]}},varList:["showDashboard","disableWidget.ControlButton"]},".$timer-panel$:first-of-type":{main:{"margin-left":"15px","margin-right":"13px"},varList:[]},".$timer-panel$:last-of-type":{main:{"margin-left":"9px","margin-right":"18px"},varList:[]},".$timer-panel$":{main:{cursor:"default","vertical-align":"middle","user-select":"none",display:"inline-block","font-size":"11px",color:"#FFFFFF","text-shadow":"0 1px 0 rgba(0,0,0,0.24)"},varList:[]},"%player-progressbar%":{main:{display:{type:1,value:"(showDashboard?'flex':'none')",debug:!1,ids:["showDashboard"],filters:[]}},varList:["showDashboard"]},".$dashboard-buttons$":{main:{"z-index":"2",position:"relative",width:"100%","background-image":"linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.6))",color:"#fff",height:"40px",display:{type:1,value:"(!showDashboard||disableWidget.ControlButton?'none':'flex')",debug:!1,ids:["showDashboard","disableWidget.ControlButton"],filters:[]},padding:"0 20px","flex-direction":"row","justify-content":"space-between","box-sizing":"border-box","align-items":"center"},varList:["showDashboard","disableWidget.ControlButton"]},".$rear-ctn$>*":{main:{"margin-left":"30px"},varList:[]},".$rear-ctn$ [x-com=Icon]":{main:{padding:"0 5px"},varList:[]},".$rear-ctn$":{main:{display:"block","padding-bottom":"10px"},varList:[]}},Qo.$SignalStyles={},Qo.$AtRules=[];var Zo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&feturn function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ea=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ta=function(e){function t(t){var r=e.call(this,t)||this;return r.state={error:{version:"3.0.0",ccode:"0502",code:"10101",description:"",icon:"//img.alicdn.com/tfs/TB17WlKi3vD8KJjy0FlXXagBFXa-42-40.svg"},preLayer:{layer:"",message:["..."]}},r}return Zo(t,e),t.prototype.onError=function(e){return e.icon||(e.icon="//img.alicdn.com/tfs/TB17WlKi3vD8KJjy0FlXXagBFXa-42-40.svg"),e},t.prototype.onMounted=function(){},ea([qn("error")],t.prototype,"onError",null),t=ea([qn("preLayer"),qn("error")],t)}(Fn),ra=ta;ta.$Template={name:"error-layer",classList:[{type:0,value:"!preplay-panel-container"}],children:[{name:"div",classList:[{type:0,value:"!preLayer-panel"}],children:[{name:"div",classList:[{type:0,value:"!preLayer-icon"},{type:0,value:"icon-private"}],children:[]},{name:"div",classList:[{type:0,value:"!preLayer-title"}],children:[{ids:["preLayer.message","preLayer.message.$"],name:"div",classList:[],iterName:"$each",repeat:{type:1,value:"(preLayer.message)",debug:!1,ids:["preLayer.message"],filters:[]},content:{type:1,value:"($each)",debug:!1,ids:["$each"],filters:[]}}]},{ids:["error.version","error.ccode","error.code"],name:"div",classList:[{type:0,value:"!preLayer-desc"}],content:{type:1,value:'"["+(error.version)+"]"+(error.ccode)+"-"+(error.code)',debug:!1,ids:["error.version","error.ccode","error.code"],filters:[]}},{ids:["error.description"],name:"div",classList:[{type:0,value:"layer-userinfo"}],content:{type:1,value:"(error.description)",debug:!1,ids:["error.description"],filters:[]}},{name:"div",classList:[{type:0,value:"!preLayer-button"},{type:0,value:"error-button"}],signalMap:{click:["reload"]},content:{type:0,value:""}}]}]},ta.$name="ErrorLayer",ta.$Styles={"$error-layer$":{main:{display:{type:1,value:"(preLayer.layer === 'ErrorLayer' ? 'block' : 'none')",debug:!1,ids:["preLayer.layer"],filters:[]}},varList:["preLayer.layer"],isRoot:!0},".$icon-private$":{main:{"background-image":{type:1,value:"('url(' + error.icon + ')')",debug:!1,ids:["error.icon"],filters:[]}},varList:["error.icon"]},".$layer-userinfo$":{main:{padding:"2px 0",color:"#aaaaaa","font-size":"12px"},varList:[]},".$error-button$":{main:{"margin-top":"20px"},varList:[]}},ta.$SignalStyles={},ta.$AtRules=[];var ia=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),na=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},oa=function(e){function t(t){var r=e.call(this,t)||this;return r.state={preLayer:{layer:"",message:[""]}},r}return ia(t,e),t=na([qn("preLayer")],t)}(Fn),aa=oa;oa.$Template={name:"notice-layer",classList:[{type:0,value:"!preplay-panel-container"}],children:[{name:"div",classList:[{type:0,value:"!preLayer-panel"}],children:[{name:"div",classList:[{type:0,value:"!preLayer-icon"},{type:0,value:"icon-notice"}],children:[]},{name:"div",classList:[{type:0,value:"!preLayer-title"}],children:[{ids:["preLayer.message","preLayer.message.$"],name:"div",classList:[],iterName:"$each",repeat:{type:1,value:"(preLayer.message)",debug:!1,ids:["preLayer.message"],filters:[]},content:{type:1,value:"($each)",debug:!1,ids:["$each"],filters:[]}}]}]}]},oa.$name="NoticeLayer",oa.$Styles={"$notice-layer$":{main:{display:{type:1,value:"(preLayer.layer === 'NoticeLayer' ? 'block' : 'none')",debug:!1,ids:["preLayer.layer"],filters:[]}},varList:["preLayer.layer"],isRoot:!0},".$icon-notice$":{main:{width:"246px",height:"148px","background-image":"url('//img.alicdn.com/tfs/TB15DOWCXT7gK0jSZFpXXaTkpXa-492-296.png')"},varList:[]}},oa.$SignalStyles={},oa.$AtRules=[];var sa=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ua=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ca=function(e){function t(t){var r=e.call(this,t)||this;return r.state={preLayer:{layer:"",logo:"//img.alicdn.com/tfs/TB1QSJTXeL2gK0jSZPhXXahvXXa-680-133.svg"}},r}return sa(t,e),t=ua([qn("preLayer")],t)}(Fn),la=ca;ca.$Template={name:"preloading-layer",classList:[{type:0,value:"!preplay-panel-container"}],children:[{name:"div",classList:[{type:0,value:"!preLayer-panel"}],children:[{ids:["preLayer.logo"],name:"img",classList:[{type:0,value:"preloading-logo"}],attributes:{src:{type:1,value:"(preLayer.logo)",debug:!1,ids:["preLayer.logo"],filters:[]}},children:[]},{name:"div",classList:[{type:0,value:"preloading-animation"}],children:[{name:"div",classList:[{type:0,value:"spinner"}],children:[{name:"div",classList:[{type:0,value:"bounce1"}],children:[]},{name:"div",classList:[{type:0,value:"bounce2"}],children:[]},{name:"div",classList:[{type:0,value:"bounce3"}],children:[]}]}]}]}]},ca.$name="PreloadingLayer",ca.$Styles={"$preloading-layer$":{main:{display:{type:1,value:"(preLayer.layer === 'PreloadingLayer' ? 'block' : 'none')",debug:!1,ids:["preLayer.layer"],filters:[]}},varList:["preLayer.layer"],isRoot:!0},".$preloading-logo$":{main:{width:"148px",margin:"auto"},varList:[]},".$preloading-animation$":{main:{position:"relative",width:"150px",height:"60px",margin:"0 auto"},varList:[]},".$spinner$":{main:{margin:"20px auto 0",width:"150px","text-align":"center"},varList:[]},".$spinner$ > $div$":{main:{width:"20px",height:"20px","background-color":"#3EB0FF","border-radius":"100%",display:"inline-block","-webkit-animation":"bouncedelay 1.4s infinite ease-in-out",animation:"bouncedelay 1.4s infinite ease-in-out","-webkit-animation-fill-mode":"both","animation-fill-mode":"both","margin-right":"5px"},varList:[]},".$bounce1$":{main:{"-webkit-animation-delay":"-0.32s !important","animation-delay":"-0.32s !important"},varList:[]},".$bounce2$":{main:{"-webkit-animation-delay":"-0.16s !important","animation-delay":"-0.16s !important"},varList:[]}},ca.$SignalStyles={},ca.$AtRules=[[["@-webkit-keyframes bouncedelay"],"0%, 80%, 100% {-webkit-transform: scale(0.0)}\n40% {-webkit-transform: scale(1.0)}\n"],[["@keyframes bouncedelay"]  -webkit-transform: scale(0.0);}\n40% {transform: scale(1.0);\n    -webkit-transform: scale(1.0);}\n"]];var pa=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),da=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ha=function(e){function t(t){var r=e.call(this,t)||this;return r.state={preLayer:{layer:""}},r}return pa(t,e),t.prototype.updateNext=function(e){return{nextVideo:e.nextVideo}},da([qn("timeline","...")],t.prototype,"updateNext",null),t=da([qn("preLayer")],t)}(Fn),fa=ha;ha.$Template={name:"end-layer",classList:[{type:0,value:"!preplay-panel-container"}],children:[{name:"div",classList:[{type:0,value:"!preLayer-panel"}],children:[{name:"div",classList:[{type:0,value:"end-icons"}],children:[{name:"div",classList:[{type:0,value:"recommend-replay"}],signalMap:{click:["replay"]},children:[{name:"end-replay",classList:[],component:Uo,attributes:{code:{type:1,value:"('\\\\e628')",debug:!1,ids:[],filters:[]},size:{type:0,value:32},color:{type:0,value:""},hoverColor:{type:0,value:""}},children:[]},{name:"span",classList:[{type:0,value:"text"}],content:{type:0,value:""}}]},{name:"div",classList:[{type:0,value:"recommend-next"}],signalMap:{click:["next"]},children:[{name:"end-next",classList:[],component:Uo,attributes:{code:{type:1,value:"('\\\\e67a')",debug:!1,ids:[],filters:[]},size:{type:0,value:32},color:{type:0,value:""},hoverColor:{type:0,value:""}},children:[]},{name:"span",classList:[{type:0,value:"text"}],content:{type:0,value:""}}]}]},{name:"div",classList:[{type:0,value:"end-tips"}],content:{type:0,value:"\n        \n      "}}]}]},ha.$name="EndLayer",ha.$Styles={".back-button":{main:{color:"#61F6FF",cursor:"pointer"},varList:[]},"$end-layer$":{main:{display:{type:1,value:"(preLayer.layer === 'EndLayer' ? 'block' : 'none')",debug:!1,ids:["preLayer.layer"],filters:[]}},varList:["preLayer.layer"],isRoot:!0},".$end-icons$":{main:{position:"relative",width:"210px",height:"60px",margin:"auto",overflow:"hidden"},varList:[]},".$recommend-replay$:hover":{main:{color:"#61F6FF"},varList:[]},".$recommend-replay$":{main:{width:"40px","text-align":"center",display:"inline-block",color:"#ffffff",cursor:"pointer"},varList:[]},".$text$":{main:{display:"block","margin-top":"5px"},varList:[]},".$recommend-next$:hover":{main:{color:"#61F6FF"},varList:[]},".$recommend-next$":{main:{display:{type:1,value:"(nextVideo?'inline-block':'none')",debug:!1,ids:["nextVideo"],filters:[]},"margin-left":"100px",color:"#ffffff",cursor:"pointer"},varList:["nextVideo"]},".$end-tips$":{main:{position:"relative",width:"100%","margin-top":"48px",color:"rgba(255, 255, 255, 0.6)","text-align":"center"},varList:[]}},ha.$SignalStyles={},ha.$AtRules=[];var ma=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ya=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};var ga=function(e){function t(t){var r=e.call(this,t)||this;return r.state={preLayer:{show:!1,backgroundImage:"https://r1.ykimg.com/material/0A03/A1/202104/0417/3063067/1618659463481/0D010000607AD6004792082440343031.jpg"}},r}return ma(t,e),t.prototype.preLayer=function(e){var t,r=e.show,i=e.backgroundImage;return{show:r,backgroundImage:(t=i,t&&t.replace(/http:|https:/,""))}},ya([qn("preLayer")],t.prototype,"preLayer",null),t}(Fn),va=ga;ga.$Template={name:"preplay-layer",classList:[],children:[{ids:["preLayer.backgroundImage"],name:"img",classList:[{type:0,value:"preplay-background"}],attributes:{src:{type:1,value:"(preLayer.backgroundImage)",debug:!1,ids:["preLayer.backgroundImage"],filters:[]}},children:[]},{name:"error-layer",classList:[],component:ra,children:[]},{name:"notice-layer",classList:[],component:aa,children:[]},{name:"preloading-layer",classList:[],component:la,children:[]},{ids:["disable.NextControl"],name:"end-layer",classList:[],component:fa,attributes:{disableNext:{type:1,value:"(disable.NextControl)",debug:!1,ids:["disable.NextControl"],filters:[]}},children:[]}]},ga.$name="PrePlayLayer",ga.$Styles={".preplay-panel-container":{main:{position:"absolute",width:"100%",top:"50%",left:"0",transform:"translateY(-50%)",display:"none"},varList:[]},".preLayer-panel":{main:{"text-align":"center",color:"#fff","font-size":"14px","z-index":"19"},varList:[]},".preLayer-icon":{main:{width:"42px",height:"40px","background-repeat":"no-repeat","background-size":"100% 100%",margin:"auto",cursor:"pointer"},varList:[]},".preLayer-title":{main:{padding:"20px 0 10px","font-size":"18px",overflow:"hidden","white-space":"nowrap"},varList:[]},".preLayer-desc":{main:{padding:"2px 0",color:"#aaaaaa","font-size":"16px"},varList:[]},".preLayer-button":{main:{display:"inline-block",padding:"5px 15px","font-size":"14px","background-image":"linear-gradient(-44deg, #00D3FF 0%, #00B7FF 100%)","border-radius":"100px",cursor:"pointer"},varList:[]},".preLayer-button:hover":{main:{"background-image":"linear-gradient(135deg, #4CCCFE 0%, #4DE0FF 100%)"},varList:[]},".preLayer-link":{main:{padding:"0 5px",color:"#008FFF",cursor:"pointer","text-decoration":"none",display:"inline-block"},varList:[]},"$preplay-layer$":{main:{display:{type:1,value:"(preLayer.show ? 'block' : 'none')",debug:!1,ids:["preLayer.show"],filters:[]},position:"absolute",top:"0",bottom:"0",left:"0",right:"0","background-color":"#101010","text-align":"center","z-index":"1110"},varList:["preLayer.show"],isRoot:!0},".$preplay-background$":{main:{width:"100%",height:"100%",opacity:"0.3",filter:"progid:DXImageTransform.Microsoft.Blur(PixelRadius=10, MakeShadow=false)","-webkit-filter":"blur(10px)","-moz-filter":"blur(10px)","-ms-filter":"blur(10px)"},varList:[]}},ga.$SignalStyles={},ga.$AtRules=[];var ba=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ea=function(e){function t(t){var r=e.call(this,t)||this;return r.state={},r}return ba(t,e),t}(Fn),_a=Eadren:[]},Ea.$name="SubtitleLayer",Ea.$Styles={".$subtitle-ctn$":{main:{"z-index":"2",position:"absolute",top:"0",left:"0",right:"0",bottom:"0","pointer-events":"none"},varList:[],isRoot:!0}},Ea.$SignalStyles={},Ea.$AtRules=[];var Ra=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Sa=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Aa=function(e){function t(t){var r=e.call(this,t)||this;return r.state={loading:!0},r}return Ra(t,e),t=Sa([qn("pop.loading")],t)}(Fn),Ta=Aa;Aa.$Template={name:"loading-layer",classList:[],children:[{name:"div",classList:[{type:0,value:"preloading-container"}],children:[{name:"p",classList:[],content:{type:0,value:"..."}},{name:"div",classList:[{type:0,value:"preloading-animation"}],children:[{name:"div",classList:[{type:0,value:"spinner"}],children:[{name:"div",classList:[{type:0,value:"bounce1"}],children:[]},{name:"div",classList:[{type:0,value:"bounce2"}],children:[]},{name:"div",classList:[{type:0,value:"bounce3"}],children:[]}]}]}]}]},Aa.$name="Loading",Aa.$Styles={"$loading-layer$":{main:{display:{type:1,value:"(loading ? 'flex' : 'none')",debug:!1,ids:["loading"],filters:[]},"background-color":"rgba(0,0,0,0.2)",color:"#fff",position:"absolute",top:"0",bottom:"0",left:"0",right:"0","text-align":"center","align-items":"center","justify-content":"center","pointer-events":"none"},varList:["loading"],isRoot:!0},".$preloading-container$ img":{main:{width:"100%"},varList:[]},".$preloading-container$":{main:{position:"absolute",top:"50%",left:"50%",width:"150px",height:"75px","margin-left":"-75px","margin-top":"-40px"},varList:[]},".$preloading-animation$":{main:{position:"relative",width:"150px",height:"60px",margin:"0 auto"},varList:[]},".$spinner$":{main:{margin:"20px auto 0",width:"150px","text-align":"center"},varList:[]},".$spinner$ > $div$":{main:{width:"20px",height:"20px","background-color":"#3EB0FF","border-radius":"100%",display:"inline-block","-webkit-animation":"bouncedelay 1.4s infinite ease-in-out",animation:"bouncedelay 1.4s infinite ease-in-out","-webkit-animation-fill-mode":"both","animation-fill-mode":"both","margin-right":"5px"},varList:[]},".$bounce1$":{main:{"-webkit-animation-delay":"-0.32s !important","animation-delay":"-0.32s !important"},varList:[]},".$bounce2$":{main:{"-webkit-animation-delay":"-0.16s !important","animation-delay":"-0.16s !important"},varList:[]}},Aa.$SignalStyles={},Aa.$AtRules=[[["@-webkit-keyframes bouncedelay"],"0%, 80%, 100% {-webkit-transform: scale(0.0)}\n40% {-webkit-transform: scale(1.0)}\n"],[["@keyframes bouncedelay"],"0%, 80%, 100% {transform: scale(0.0);\n    -webkit-transform: scale(0.0);}\n40% {transform: scale(1.0);\n    -webkit-transform: scale(1.0);}\n"]];var wa,La=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Oa=function(){return(Oa=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},xa=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};!function(e){e[e.LOGO=0]="LOGO",e[e.REGISTER=1]="REGISTER",e[e.LICENSE=2]="LICENSE"}(wa||(wa={}));var Pa=function(e){function t(t){var r=e.call(this,t)||this;return r.state={scale:1,fullscreen:!1,webfullscreen:!1,hasWatermark:!0,width:1024,height:576,proportion:16/9,watermark:[],displayWidth:1024,displayHeight:576,layerTransform:"translate(-50%, -50%) scale(1)",renderData:[]},r.watermarkArray=[],r}return La(t,e),t.prototype.getDisplay=function(e){var t=e.width,r=e.height,i=e.proportion,n=0,o=0;return i>t/r?(n=t,o=t/i):(o=r,n=r*i),{hasWatermark:e.hasWatermark,width:t,height:r,displayWidth:n,displayHeight:o,layerTransform:"translate(-50%, -50%) scale("+e.scale+")"}},t.prototype.getRenderData=function(e){for(var t=(e.displayHeight/459).toFixed(3),r=e.fullscreen||e.webfullscreen,i=[],n=0;n<this.watermarkArray.length;n++){var o=this.watermarkArray[n],a=o.normal;r&&o.fullscreen&&(t=(e.displayHeight/1e3).toFixed(2),a=o.fullscreen);var s={id:o.id};s.content=a.content;var u=o.display;s.id===wa.LOGO&&!1===this.state.hasWatermark&&(u="none");var c=Object.assign({},a.style,{transform:"scale("+t+")"},{display:u});s.styleObject=c;var l="";for(var p in c)Object.hasOwnProperty.call(c,p)&&(l+=p+": "+c[p]+";");s.style=l,i.push(s)}return{renderData:i}},t.prototype.changeDisplay=function(e,t,r){for(var i=[],n=0;n<r.length;n++){var o=Object.assign({},r[n]);if(o.id===e){var a=Object.assign(o.styleObject,{display:t}),s="";for(var u in a)Object.hasOwnProperty.call(a,u)&&(s+=u+": "+a[u]+";");o.style=s}i.push(o)}return i},t.prototype.player=function(e){if(e){var t={};return Object.assign(t,this.getDisplay(e)),Object.assign(t,this.getRenderData(t)),Oa({},t)}},t.prototype.watermark=function(e){this.watermarkArray=e;var t={};return Object.assign(t,this.getDisplay(this.state)),Object.assign(t,this.getRenderData(this.state)),Oa({},t)},t.prototype.timelineUpdate=function(e){var t=this,r=e.adPlaying,i=e.actualTime,n=this.state.renderData;this.watermarkArray.forEach((function(e){var o="block";e.normal&&e.normal.end-e.normal.start>0&&(r||i<e.normal.start||i>e.normal.end)&&(o="none"),e.display!==o&&(e.display=o,n=t.changeDisplay(e.id,o,n))})),this.setState({renderData:n})},xa([qn("player","...")],t.prototype,"player",null),xa([qn("watermark")],t.prototype,"watermark",null),xa([qn("timeline")],t.prototype,"timelineUpdate",null),t}(Fn),Da=Pa;Pa.$Template={name:"watermark-layer",classList:[],children:[{name:"div",classList:[{type:0,value:"logo-layer"}],children:[{ids:["renderData","renderData.$.content","renderData.$.style"],name:"div",classList:[{type:0,value:"youku-watermark"}],iterName:"$each",repeat:{type:1,value:"(renderData)",debug:!1,ids:["renderData"],filters:[]},attributes:{style:{type:1,value:"($each.style)",debug:!1,ids:["$each.style"],filters:[]}},content:{type:1,value:"($each.content)",debug:!1,ids:["$each.content"],filters:[]}}]}]},Pa.$name="Watermark",Pa.$Styles={"$watermark-layer$":{main:{position:"absolute",top:"50%",left:"50%",width:{type:1,value:"]},height:{type:1,value:"(displayHeight + 'px')",debug:!1,ids:["displayHeight"],filters:[]},transform:{type:1,value:"(layerTransform)",debug:!1,ids:["layerTransform"],filters:[]}},varList:["displayWidth","displayHeight","layerTransform"],isRoot:!0},".$logo-layer$":{main:{"pointer-events":"none"},varList:[]},".$youku-watermark$":{main:{position:"absolute","background-repeat":"no-repeat","font-size":"16px","-webkit-text-shadow":"2px 2px 1px #000","-moz-text-shadow":"2px 2px 1px #000","text-shadow":"2px 2px 1px #000"},varList:[]}},Pa.$SignalStyles={},Pa.$AtRules=[];var ka=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ia=function(e){function t(t){var r=e.call(this,t)||this;return r.state={},r}return ka(t,e),t}(Fn),Ma=Ia;Ia.$Template={name:"pop-layer",classList:[],children:[{name:"loading",classList:[],component:Ta,children:[]},{name:"watermark",classList:[],component:Da,children:[]}]},Ia.$name="PopLayer",Ia.$Styles={"$pop-layer$":{main:{position:"absolute",top:"0",bottom:"0",left:"0",right:"0","z-index":"1000"},varList:[],isRoot:!0}},Ia.$SignalStyles={},Ia.$AtRules=[];var Ca,Na=function(){function e(){}return e.setSettings=function(t,r,i){if(void 0===i&&(i="web"),window.NPlayerIPC&&"iku"===i)try{var n=e.getSettings(i);n=e.mergeStorage(t,r,n),window.NPlayerIPC.sendFunction("LocalStorageSet","YK_PSL_SETTINGS",JSON.stringify(n))}catch(e){console.log("set LocalStorage error")}else e.set(t,r,"YK_PSL_SETTINGS")},e.getSettings=function(t){var r;if(void 0===t&&(t="web"),window.NPlayerIPC&&"iku"===t)if(e.get("YK_PSL_SYNC_SETTINGS"))r=e.getIkuSettings();else try{var i=e.getIkuSettings(),n=e.getObject("YK_PSL_SETTINGS");r=Object.assign({},n,i),window.NPlayerIPC.sendFunction("LocalStorageSet","YK_PSL_SETTINGS",JSON.stringify(r)),e.save("YK_PSL_SYNC_SETTINGS",!0)}catch(e){console.log("set LocalStorage error")}else r=e.getObject("YK_PSL_SETTINGS");return r||{}},e.getIkuSettings=function(){var e;try{var t=window.NPlayerIPC.sendSyncFunction("LocalStorageGet","YK_PSL_SETTINGS");e=JSON.parse(t)}catch(e){console.log("set LocalStorage error")}return e||{}},e.set=function(t,r,i){var n={};null!=localStorage.getItem(i)&&(n=JSON.parse(localStorage.getItem(i))),n=e.mergeStorage(t,r,n);try{localStorage.setItem(i,JSON.stringify(n))}catch(e){console.log("localStorage is not support")}},e.mergeStorage=function(e,t,r){var i;if(Array.isArray(e))for(var n=0;n<e.length;n++){var o=e[n];i="object"==typeof t[n]||Array.isArray(t[n])?JSON.stringify(t[n]):t[n],r[o]=i}else i="object"==typeof t||Array.isArray(t)?JSON.stringify(t):t,r[e]=i;return r},e.save=function(e,t){try{"object"==typeof t||Array.isArray(t)?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,String(t))}catch(e){console.log("localStorage is not support")}},e.remove=function(e){localStorage.removeItem(e)},e.getObject=function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):{}},e.get=function(e){return localStorage.getItem(e)},e}();!function(e){e.Hint="hint",e.Error="error",e.Note="note"}(Ca||(Ca={}));var Ua,Ba={error:{default:["~ ~"," T_T","~","","","","","","..."],E10101:"COOKIE",E23102:"",E10103:"",E23306:["","2"],E23408:"DRM",E23204:"",E35618:"Adblock",E22501:"sorry~~ ~"},hint:{H0001:'<font color=" #03c8d4 ">{0}%</font>',H0002:"",H0003:'<font color=" #03c8d4 "> {0} </font>',H0004:'<font color=" #03c8d4 ">{0}</font>,...',H0005:'<b style="color: #ffdd9a ;"> VIP HDR </b>,...',H0006:'<font color=" #03c8d4 "> {0}</font>...',H0007:' <font color=" #ffdd9a ">VIP</font> 1080P',H0008:' <font color=" #ffdd9a ">VIP</font> 1080P',H0009:' <font color=" #03c8d4 "> {0} </font> ',H0010:' <font color=" #ffdd9a ">VIP</font> 1080P',H0011:' <font color=" #ffdd9a ">VIP</font> 1080P',H0012:"",H0013:"100% "},note:{N0001:' <font data-val="settings" style="display: inline-block;color:  #03c8d4 ;cursor: pointer;text-decoration: none;"></font>',N0002:' <font data-val="settings" style="display: inline-block;color:  #03c8d4 ;cursor: pointer;text-decoration: none;"></font>',N0003:' <font data-val="settings" style="display: inline-block;color:  #03c8d4 ;cursor: pointer;text-decoration: none;"></font>',N0004:' {0} <font data-val="restart" style="display: inline-block;color:  #03c8d4 ;cursor: pointer;text-decoration: none;"></font>',N0005:'or: pointer;text-decoration: none;"></font>',N0006:'{0}   <font data-val="subscribe" style="display: inline-block;color:  #03c8d4 ;cursor: pointer;text-decoration: none;">+</font>',N0007:'<b style="font-size:18px;color:#3895e2;" style="display: inline-block;color:  #03c8d4 ;cursor: pointer;text-decoration: none;" data-val="auto">  </b>',N0008:'<font color=" #03c8d4 "> 720P</font><font data-val="login" style="display: inline-block;color:  #03c8d4 ;cursor: pointer;text-decoration: none;"> </font>',N0009:'<font data-val="hardware" style="display: inline-block;color:  #03c8d4 ;cursor: pointer;text-decoration: none;"> </font>'}},Fa=function(){function e(){}return e.hasString=function(e,t){return void 0===t&&(t=Ca.Hint),Ba[t].hasOwnProperty(e)},e.getString=function(t,r,i){var n;void 0===r&&(r=Ca.Hint),void 0===i&&(i=null);var o=Ba;switch(r){case Ca.Error:n=o.error.hasOwnProperty(t)?o.error[t]:null;break;case Ca.Hint:n=o.hint.hasOwnProperty(t)?"<%>"+o.hint[t]+"</%>":null;break;case Ca.Note:n=o.note.hasOwnProperty(t)?"<%>"+o.note[t]+"</%>":null}if((r===Ca.Hint||r===Ca.Note)&&!n)return"";if(!n){var a=o.error.default;n=a[Math.round(Math.random()*a.length)]}return i&&(n=e.substitute(n,i)),n},e.substitute=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i="";if(e){i=e;var n=t.length,o=[];1===n&&t[0]instanceof Aa=0;a<n;a++)i=i.replace(new RegExp("\\{"+a+"\\}","g"),o[a])}return i},e}(),ja=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnPropertstructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e.FullScreenEnd="fullScreenEnd"}(Ua||(Ua={}));var Ga,Va,qa=function(e){function t(){var t=e.call(this)||this;return t._isFullScreen=!1,t.addEvent(),t}return ja(t,e),t.prototype.addEvent=function(){document.addEventListener("webkitfullscreenchange",this.fullScreenChange.bind(this),!1),document.addEventListener("mozfullscreenchange",this.fullScreenChange.bind(this),!1),document.addEventListener("fullscreenchange",this.fullScreenChange.bind(this),!1),document.addEventListener("MSFullscreenChange",this.fullScreenChange.bind(this),!1)},t.prototype.fullScreenChange=function(){var e=document,t=e.webkitIsFullScreen||e.mozFullScreen||e.msFullscreenElement||e.fullscreen;this._isFullScreen=t,this.emit(Ua.FullScreenEnd,this._isFullScreen)},Object.defineProperty(t.prototype,"isFullscreen",{get:function(){return this._isFullScreen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){},t}(o.b),Ha=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e.WatermarkChanged="watermarkChanged"}(Ga||(Ga={})),function(e){e[e.LOGO=0]="LOGO",e[e.REGISTERykimg.alicdn.com/product/image/2020-06-11/1b2e4b4ee80327d2d41d6a74fd705643.png)","background-position":"0 0","background-size":"157px 24px","transform-origin":"right top",height:"24px",width:"157px",right:"28px",top:"28px"},t}return Ha(t,e),t.prototype.reset=function(e){this.watermarkList=[]},Object.defineProperty(t.prototype,"watermarkList",{get:function(){var e=this;return navigator.onLine?this._watermarkList:this._watermarkList.map((function(t){return t.id===Va.LOGO&&(t.normal.style=e.defaultLogoStyle,delete t.fullscreen),t}))},set:function(e){this._watermarkList=e,this.emit(Ga.WatermarkChanged,e)},enumerable:!1,configurable:!0}),t.prototype.filtrate=function(e,t){this.resetWatermark(e,t)},t.prototype.resetWatermark=function(e,t){if(e){for(var r=[],i=function(i){var o=e[i],a={};a.style=n.getStyle(o),o.text&&o.text.content?a.content=o.text.content:a.content="",o.text&&o.text.duration?(a.start=t,a.end=a.start+Number(o.text.duration/1e3)):(a.start=0,a.end=0);var s=3===o.type?Va.LICENSE:2===o.type||8===o.type?Va.REGISTER:Va.LOGO,u=r.filter((function(e){return e.id===s}))[0];u||(u={id:s,display:"block"},r.push(u)),3!==o.displayMode&&0!==o.displayMode||(u.normal=a),1===o.displayMode&&(u.fullscreen=a)},n=this,o=0;o<e.length;o++)i(o);this.watermarkList=r}},t.prototype.getStyle=function(e){var t={},r=0===e.ref||3===e.ref?"left":"right",i=0===e.ref||1===e.ref?"top":"bottom";return e.hasOwnProperty("x")&&(t[r]=parseInt(e.x,10)+"px"),e.hasOwnProperty("y")&&(t[i]=parseInt(e.y,10)+"px"),t["transform-origin"]=r+" "+i,e.text&&e.text.content&&(e.text.hasOwnProperty("size")&&(t["font-size"]=e.text.size+"px"),e.text.hasOwnProperty("color")&&(t.color=e.text.color)),e.img&&e.img.url&&(t["background-image"]="url("+e.img.url+")",t.width=parseInt(e.img.width,10)+"px",t.height=parseInt(e.img.height,10)+"px",e.img.width&&e.img.height&&(t["background-size"]=parseInt(e.img.width,10)+"px "+parseInt(e.img.height,10)+"px",t["background-position"]="0 0")),e.hasOwnProperty("opacity")&&(t.opacity=e.opacity),t},t.Event="PlayerWatermark.Change",t}(o.b);!function(e){e.Tudou="tudou",e.PCWeb="pcweb",e.UosYouku="uosYouku",e.ElectronIku="eleAndIku",e.SimpleMode="SimpleMode",e.ElectronIkuOffline="ElectronIkuOffline",e.ElectronLocal="ElectronLocal"}($a||($a={}));var za,Ka,Ya=function(){function e(e){this.volume=1,this.muted=!1,this.loop=!1,this.continuePlay=!0,this.skip=!0,this.rate=1,e=e||{},e=this.getSettings(e),this.reset(e)}return e.prototype.getSettings=function(e){var t=Na.getSettings("web");return["skip","continuePlay","volume","muted","rate"].forEach((function(r){!e.hasOwnProperty(r)&&t.hasOwnProperty(r)&&(e[r]=t[r])})),e},e.prototype.reset=function(e){if(e)for(var t in e)e.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(this[t]=e[t])},e.prototype.dispatchPropertyChangeEvent=function(e){},e}(),Xa={guoyu:{num:1,name:"",alias:""},yue:{num:2,name:""},chua""},min:{num:5,name:""},en:{num:6,name:""},ja:{num:7,name:""},kr:{num:8,name:""},in:{num:9,name:""},ru:{num:10,name:""},fr:{num:11,name:""},de:{num:12,name:""},it:{num:13,name:""},es:{num:14,name:""},mn:{num:15,name:""},th:{num:16,name:""},baby:{num:17,name:""},man:{num:18,name:""},tspl:{num:19,name:""},dir:{num:20,name:""},dbh:{num:21,name:""},bo:{num:22,name:""},ug:{num:23,name:""},ar:{num:24,name:""},uk:{num:25,name:""},pt:{num:26,name:""},nl:{num:27,name:""},hu:{num:28,name:""},is:{num:29,name:""},af:{num:30,name:""},da:{num:31,name:""},ku:{num:32,name:""},lv:{num:33,name:""},vi:{num:34,name:""},fi:{num:35,name:""},pl:{num:36,name:""},sv:{num:37,name:""},cs:{num:38,name:""},no:{num:39,name:""},sr:{num:40,name:""},bg:{num:41,name:""},fa:{num:42,name:""},ro:{num:43,name:""},ka:{num:44,name:""},tr:{num:45,name:""},ca:{num:46,name:""},kk:{num:47,name:""},et:{num:48,name:""},tl:{num:49,name:""},el:{num:50,name:""},gsw:{num:51,name:""},rw:{num:52,name:""},bn:{num:53,name:""},id:{num:54,name:""},mi:{num:55,name:""},he:{num:56,name:""},ga:{num:57,name:""},hr:{num:58,name:""},tjh:{num:59,name:""},hah:{num:60,name:""},snh:{num:61,name:""},sxh:{num:62,name:""},lzh:{num:63,name:""},sdh:{num:64,name:""},heh:{num:65,name:""},hnh:{num:66,name:""},jxh:{num:67,name:""},kjh:{num:68,name:""},fyan:{num:69,name:""}},Qa=function(){function e(){}return e.langCodeToName=function(e){var t="default";return Xa[e]&&(t=Xa[e].name),t},e.langCodeToId=function(e){var t=0;return Xa[e]&&(t=Xa[e].num),t},e.langNamreturn e;for(var t in Xa)if(Xa[t].name===e||Xa[t].alias===e)return t;return"default"},e}(),Ja=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e.Event="MediaData.Change"}(za||(za={})),function(e){e[e.Useable=0]="Useable",e[e.Maybe=1]="Maybe",e[e.Disable=2]="Disable"}(Ka||(Ka={}));var Za,es={auto:{label:"",name:"",index:0,auto:""},"270p":{label:"",name:" 360P",index:1,auto:"320P"},"320p":{label:"",name:" 360P",index:1,auto:"320P"},"540p":{label:"",name:" 540P",index:2,auto:"540P"},"720p":{label:"",name:" 720P",index:3,auto:"720P"},"1080p":{label:"",name:" 1080P",index:4,auto:"1080P"},"1080p_hdr":{label:"HDR",name:"HDR",index:5,auto:"HDR"},"1080p_frame":{label:"",name:"",index:6,auto:""},"4k":{label:"4K",name:"4K",index:7,auto:"4K"}};!function(e){e.NONE="none",e.VIP="vip",e.QUALITY="quality",e.LOGIN="login",e.CLIENT="client"}(Za||(Za={}));var ts,rs=function(e){function t(){var t=e.call(this)||this;return t.reset({}),t}retuon(e){this._language="",this._quality="auto",this._multiQuality=[],this._autoLevel="",this._languageList=[],this._subtitle="default",this._multiSubtitle=[],this._currentVidSubtitle=[],this._subtitleEnabled=!0,this._hasWatermark=!0,this._originWidth=1024,this._originHeight=579,e.hasOwnProperty("quality")&&(this._quality=e.quality),e.hasOwnProperty("language")&&(this._language=Qa.langNameToCode(e.language)),e.hasOwnProperty("subtitle")&&(this._subtitle=e.subtitle),e.hasOwnProperty("hasWatermark")&&(this._hasWatermark=e.hasWa t;try{t=JSON.parse(localStorage.getItem("YK_SHOW_PREFER"))||{}}catch(e){t={}}return t[e]},t.prototype.filtrate=function(e,t){this.player=t;e.raw&&(this._multiSubtitle=e.subtitle,this.languageList=t.getLanguageList())},Object.defineProperty(t.p_originWidth},set:function(e){this._originWidth=e,this.dispatchPropertyChangeEvent("originWidth")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"originHeight",{get:function(){return this._originHeight},set:function(e){this._originHeight=e,this.dispatchPropertyChangeEvent("originHeight")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasWatermark",{get:function(){return this._hasWatermark},set:function(e){this._hasWatermark=e,this.dispatchPropertyChangeEvent("hasWatermark")},enumerable:!1,configurabt",{get:function(){return this._languageList},set:function(e){var t=this;this._languageList=e,this.dispatchPropertyChangeEvent("languageList");var r=this._languageList.filter((function(e){return e.langCode===t._language}));r[0]?this.language=r[0].langCode:this.language=this._languageList[0].langCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"language",{get:function(){return this._language},set:function(e){for(var t=0,r=this._langu[t].langCode===e){this._language=e,this.setMultiQuality(this.player.getStreamList(e)),this.currentVidSubtitle=this._multiSubtitle,this.dispatchPropertyChangeEvent("language");break}},enumerable:!e,"multiQuality",{get:function(){return this._multiQuality},enumerable:!1,configurable:!0}),t.prototype.setMultiQuality=function(e){var t=this,r=[];if((e=e.filter((function(e){return e.name}))).forEach((function(e){var t={id:e.id,code:e.id,name:e.name,label:e.name,enableStasQuality("270p",r)&&(r=p",r)&&(r=r.filter((function(e){return"320p"!==e.code}))),this._multiQuality=r,r.length>0){var i=this._multiQuality.filter((function(e){return e.code=.quality=i[0].code:this.quality=this._getPerQuality(this._quality)}this.dispatchPropertyChangeEvent("multiQuality")},t.prototype.hasQuality=function(e,t){return t||(t=this._multiQuality),t.filter((function(t){return t.code===e})).length>0},Object.defineProperty(t.prototype,"quality",{get:function(){return this._quality},set:function(e){this._quality!==e&&(this._multiQuality.filter((function(t){return t.code===e&&t.action===Za.QUALITY}))[0]?this._quality=e:this._quality=this._getPerQuality(e),this.dispatchPropertyChangeEvent("quality"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"qualityList",{get:function(){var e=[];return this._multiQuality.forEach((function(t){t.action===Za.QUALITY&&e.push(t.code)})),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoLevel",{get:function(){return es[this._autoLevel]&&es[this._autoLevel].auto||""},set:function(e){"270p"===e&&(e="320p"),this._autoLevel=e,this.dispatchPropertyChangeEvent("autoLevel")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVidSubtitle",{get:function(){return this._currentVidSubtitle},set:function(e){var t=this;this._currentVidSubtitle=e,this.dispatchPropertyChangeEvent("currentVidSubtitle");var r=this._currentVidSubtitle.filter((function(e){return e.name===t._subtitle&&!e.disabled}));r[0]?this.subtitle=r[0].figurable:!0}),Object.defineProperty(t.prototype,"subtitleEnabled",{get:function(){return this._subtitleEnis.dispatchPropertyChangeEvent("subtitleEnabled")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subtitle",{get:function(){return this._subtitle},set:function(e){this._currentVidSubtitle.filter((function(t){return t.name===e&&!t.disabled}))[0]?this._subtitle=e:this._subtitle=this._getPerSubtitle(),this.dispatchPropertyChangeEvent("subtitle")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSubtitle",{get:functbtitle)},enumerable:!1,configurable:!0}),t.prototype.getLanguage=function(e){return this._languageList.filter((function(t){return t.langCode===e}))[0]},t.prototype.getQuality=function(e){return this._multiQuality.filter((function(t){return t.code===e}))[0]},t.prototype.getSubtitle=function(e){return this._currentVidSubtitle.filter((function(t){return t.name===e}))[0]},t.prototype.hasSubtitle=function(e){return this._currentVidSubtitle.filter((function(t){return t.name===e})).length>0},t.prototype._getPerQuality=function(e){var t=this,r=["1080p_hdr","1080p_frame"];if(-1===this.qualityList.indexOf(e)&&r.indexOf(e)>-1){var i=r.filter((function(e){return t.qualityList.indexOf(e)>-1}));if(i.length>0)return i[0]}for(var n=Object.keys(es),o=n.indexOf(e),a=n.length;o<a;o++)if(this.qualityList.indexOf(n[o])>-1)return n[o];return this.qualityList[0]},t.prototype._getPerSubtitle=function(){var e=this,t="";if(["default","chs"].every((function(r){return!e.hasSubtitle(r)||(t=r,!1)})),!t){var r=this._currentVidSubtitle.filter((function(e){return!e.disabled}));t=r[0]&&r[0].name}return t},t.prototype.dispatchPropertyChangeEvent=function(e){this.emit(za.Event,{key:e,value:this["_"+e]})},t.Event="MediaData.Change",t}(o.b);!function(e){e.TOP="top",e.OTHER="other",e.TIMELINE="timeline",e.BOTTOM="bottom",e.RIGHT="right"}(ts||(ts={}));var is,ns={ControlButton:function(e,t,r){return{position:ts.OTHER,display:!0}},Quality:function(e){var t=e.mediaData.multiQuality&&e.mediaData.multiQuality.length>0;return{position:ts.BOTTOM,display:t}},VolumeControl:function(e){return{position:ts.BOTTOM,display:!0,width:24}},Settings:function(e){return{position:ts.BOTTOM,display:!1}},Language:function(e){var t=e.mediaData.languageList&&e.mediaData.languageList.length>1;return{position:ts.BOTTOM,display:t}},Subtitle:function(e){var t=e.mediaData.currentVidSubtitle&&e.mediaData.subtitleEnabled&&e.mediaData.currentVidSubtitle.length>1;return{position:ts.BOTTOM,display:t}},Fullscreen:functunction(e){return{position:ts.BOTTOM,display:!1,width:24}},PIP:function(e){return{position:ts.BOTTOM,display:e.player.isSupportFeature(Si.a.PIP),width:24}},PlayRate:function(e){return{position:ts.BOTTOM,display:!0}}},os=function(){function e(e,t){this.ikuStorage=!1,this.config=e,this.container=e.container,this.player=t,this.localVolume=100,this.initModels(),this.init(),this.addEvent(),this.addAdEvent(),this.addWindowEvent(),this.resize()}return e.prototype.initModels=function(){var e=this;this.fullscreen=new qa,this.fullen:t},e.resize()})),this.watermark=new Wa,this.watermark.on(Ga.WatermarkChanged,(function(t){e.ui.concept.watermark=t})),this.settings=new Ya,this.mediaData=new rs,this.mediaData.on(za.Event,(function(t){var r=e.mediaData.originWidth/e.mediaData.originHeight;switch(t.key){case"languageList":e.ui.concept.media={languageList:t.value},e.resize();break;case"language":e.ui.concept.media={language:t.value};break;case"hasWatermark":e.ui.concept.player={hasWatermark:e.mediaData.hasWatermark};break;case"quality":e.ui.concept.media={quality:t.value};break;case"multiQuality":e.ui.concept.media={qualityList:t.value},e.resize();break;case"currentVidSubtitle":e.ui.concept.media={subtitleList:t.value},e.resize();break;case"subtitle":e.ui.concept.media={subtitle:e.mediaData.subtitle};break;case"subtitleEnabled":e.ui.concept.media={subtitleEnabled:e.mediaData.subtitleEnabled},e.resize();break;case"originHeight":case"originWidth":e.ui.concept.player={proportion:r}}}))},e.prototype.addEvent=function(){var e=this;this.player.on(n.a.PAUSE,(function(){e.ui.concept.player={paused:!0}})),this.player.on(n.a.PLAY,(function(){e.ui.concept.player={paused:!1},e.ui.concept.preLayer={show:!1},e.checkQualityChanged()})),this.player.on(n.a.PLAYING,(function(){e.hideLoading(),e.ui.concept.player={paused:!1},e.ui.concept.preLayer={show:!1},e.checkQualityChanged()})),this.player.on(n.a.VOLUME_CHANGE,(function(){e.ui.concept.player={volume:Math.round(100*e.player.volume),muted:!e.player.vunction(t){e.ui.concept.timeline={duration:e.player.duration}})),this.player.on(n.a.TIME_UPDATE,(function(t){var r=e.player.currentTime/e.player.duration*100,i=e.playerurrentTime).bufferEnd/e.player.duration*100-r;e.ui.concept.timeline={adPlaying:!1,currentTime:e.player.currentTime,played:r,buffered:i,actualTime:e.player.currentTime}})),this.player.on(n.a.SEEKED,(function(){e.hideLoading()})),this.player.on(n.a.WAITING,(function(){e.showLoading()})),this.player.on(n.a.SEEKING,(function(){e.showLoading()})),this.player.on(n.a.CANPLAY,(function(){e.hideLoading(),e.player.playing&&e.checkQualityChanged()})),this.player.on(n.a.ENDED,this.onEnd.bind(this)),this.player.on(n.a.ERROR,this.onError.bind(this)),this.player.on(n.a.LOADED_MEDIA_RESOURCE,this.onServiceComplete.bind(this)),this.player.on(ls.STREAM_SWITCHED,this.setMediaData.bind(this))},e.prototype.addAdEvent=function(){var e=this;this.player.on(ls.AD_START,(function(t){console.log(11111})),this.player.on(ls.AD_END,(function(t){console.log(111111,t),e.ui.concept.player={disableDashboard:!1}}))},e.prototype.addWindowEvent=function(){window.addEventListener("resize",this.resize.bind(this))},e.prototype.showLoading=function(){var e=this;this.loadingTimer||(this.loadingTimer=window.setTimeout((function(){e.ui.concept.pop={loading:!0},clearTimeout(e.loadingTimer),e.loadingTimer=null}),500))},e.prototype.hideLoading=function(){this.loadingTimer&&(clearTimeout(this.loadingTimer),this.loadingTimer=null),this.ui.concept.pop={loading:!1}},e.prototype.init=function(){var e=this;this.dashboard=new Jo("dashboard"),this.ui=new Xn([new _a("subtitleLayer"),this.dashboard,new va("layer"),new Ma("pop")]);var t=this.ui;window.ui=t,t.addConcept("disableWidget",{}),t.addConcept("player",{}),t.addConcept("video",{title:"",vid:"",show:""}),t.addConcept("media",{}),t.addConcept("information",{}),t.addConcept("timeline",{adPlaying:!1,played:0,buffered:0,currentTime:this.player.currentTime,duration:this.player.duration}),t.addConcept("preview",{thumb:[],points:[]}),this.initLayerData(),this.addLayerEvent(),this.initPopData(),t.concept.on("timeline.played",(function(r,i){var n=Math.min(i.played/100*i.duration,i.duration-.5);t.concept.timeline={currentTime:n},e.player.seek(n)})),t.concept.on("media.rate",(function(t,r){t&&(t=parseFloat(t),e.setSettings("rate",t))})),t.concept.on("player.volume",(function(t,r){r&&(e.localVolume=r.volume,e.setVolume(r.volume))})),t.concept.on("player.continuePlay",(function(t,r){r&&e.setSettings("continuePlay",r.continuePlay)})),t.concept.on("player.loop",(function(t,r){r&&e.setSettings("loop",r.loop)})),t.concept.on("player.skip",(function(t,r){r&&e.setSettings("skip",r.skip)})),t.concept.on("media.language",(function(t,r){t&&e.setLanguage(t)})),t.concept.on("media.subtitle",(function(t,r){t&&e.setSubtitle(t)})),t.concept.on("media.quality",(function(t,r){t&&e.setQuality(t)})),t.on("dashboard.triggerClick",(function(t){"click-control"==t.target.getAttribute("data-val")&&(clearTimeout(e.clickTimer),e.clickTimer=window.setTimeout((function(){e.setPlayStatus()}),300))})),t.on("dashboard.fullscreenClick",(function(t){"click-control"==t.target.getAttribute("data-val")&&(clearTimeout(e.clickTimer),e.setFullscreen())})),t.on("dashboard.volume-control.volume-icon.click",(function(){t.concept.player.muted?(t.concept.player={muted:!1,volume:e.localVolume},e.setVolume(e.localVolume)):(t.concept.player={muted:!0},e.setVolume(0))})),t.on("dashboard.play-icon.click",(function(){e.setPlayStatus()})),t.on("dashboard.fullscreen-icon.click",(function(){e.setFullscreen()})),t.on("dashboard.webfullscreen-icon.click",(function(){})),t.on("dashboard.pip-icon.click",(function(){e.player.requestFeature(Si.a.PIP)})),t.on("dashboard.next-control.next-icon.click",(function(){})),t.on("dashboard.settings.closeSetting",(function(){e.ui.concept.player={openSetting:!1}})),t.mount(this.container),this.ui.concept.player={paused:!0,disableDashboard:!1,muted:this.settings.muted,volume:this.settings.volume,loop:this.settings.loop,continuePlay:this.settings.continuePlay,skip:this.settings.skip,hasWatermark:this.mediaData.hasWatermark,ended:!1,fullscreen:this.fullscreen.isFullscreen,webfullscreen:!1,openSetting:!1},this.ui.concept.timeline={duration:this.player.duration},this.ui.concept.preLayer={show:!1},this.ui.concept.media={rate:1,rateList:[{rate:2,name:"2.0X"},{rate:1.5,name:"1.5X"},{rate:1.25,name:"1.25X"},{rate:1,name:"1.0X",label:""},{rate:.5,name:"0.5X"}]},this.activeDashboard(2500)},e.prototype.initLayerData=function(){this.ui.addConcept("preLayer",{show:!0,backgroundImage:"//img.alicdn.com/tfs/TB1kZ5kx3HqK1RjSZJnXXbNLpXa-750-710.png",logo:"//img.alicdn.com/tfs/TB1QSJTXeL2gK0jSZPhXXahvXXa-680-133.svg",layer:"PreloadingLayer",description:"",password:"",wait:5,message:[""]}),this.ui.addConcept("error",{code:"10000"})},e.prototype.addLayerEvent=function(){this.ui.on("layer.end-layer.replay",this.onReplayClick.bind(this)),this.ui.on("layer.end-layer.next",(function(){})),this.ui.on("layer.error-layer.reload",this.reload.bind(this)),this.ui.on("layer.abort-layer.play",this.onPlay.bind(this))},e.prototype.initPopData=function(){var e=this.container,t=e.offsetWidth,r=e.offsetHeight;this.ui.concept.player={width:t,height:r,proportion:16/9,scale:1},this.ui.addConcept("pop",{loading:!1,frameAnimation:!1,hdrAnimation:!1,fastForward:!1}),this.ui.addConcept("watermark",[])},e.prototype.onServiceComplete=function(e){var t=this.player.MediaResource;if(t){this.mediaResource=t;var r=t.raw;if(r){var i=r.video&&r.video.logo;r.show&&r.show.show_thumburl_big_jpg&&(i=r.show.show_thumburl_big_jpg),this.ui.concept.preLayer={backgroundImage:i};var n={};r.video&&r.video.title&&(n.title=r.video.title),r.trial&&(this.ui.concept.timeline={maxTime:r.trial.time}),n.vid=r.video&&r.video.encodeid,n.showid=r.show&&r.show.encodeid||"",this.ui.concept.video=n}var o=t.timeline,a=o.opening&&Math.round(o.opening/1e3)||0;this.mediaData.filtrate(t,this.player),this.watermark.filtrate(t.watermark,a),this.player.volume=this.settings.volume,this.player.muted=this.settings.muted,this.setMediaData(e),this.ui.concept.timeline={duration:this.player.duration},this.ui.setConfig("mediaResource",t),this.ui.concept.preview={thumb:t.getAllPreviewThumb(),points:t.preview.point}}this.resize()},e.prototype.setMediaData=function(e){if(this.mediaData.language=e.lang,this.mediaData.quality=e.id,this.mediaData.hasWatermark=e.logo&&"none"===e.logo,this.mediaData.originWidth=e.width,this.mediaData.originHeight=e.height,e.subtitleLang){var t=this.mediaData.currentVidSubtitle.filter((function(t){return t.lang===e.subtitleLang}))[0];this.mediaData.subtitle=t.name}},e.prototype.onErro={ccode:"0514",code:e.code||"10000",version:"0.0.1",description:e.message}},e.prototype.checkQualityChanged=function(){if(this.qualityChange){var e=this.mediaData.getQuality(this.qualityChange).name,t=void 0;switch(this.ui.concept.pop={frameAnimation:!1,hdrAnimation:!1},this.qualityChange){case"1080p_hdr":if(this.config.ignores&&this.config.ignores.indexOf("HDRAnimation")>-1)return;this.ui.concept.pop={hdrAnimation:!0};break;case"1080p_frame":if(this.config.ignores&&this.config.ignores.indexOf("FrameAnimation")>-1)return;this.ui.concept.pop={frameAnimation:!0};break;case"1080p":t=this.mediaResource.user&&this.mediaResource.user.relaxVip?"H0010":"H0011";break;default:t="H0009"}if(t&&e){var r=Fa.getString(t,Ca.Hint,[e]);this.ui.concept.information={message:r,time:3,rand:Math.random(),key:"information",close:!1}}this.qualityChange=null}},e.prototype.onEnd=function(){this.ui.concept.player={ended:!0,loading:!1},this.ui.concept.preLayer={show:!0,layer:"EndLayer",message:""}},e.prototype.onReset=function(){this.ui.concept.playerStatus={start:!1},this.ui.concept.timeline={currentTime:0,played:0},this.ui.concept.player={ended:!1},this.showLoading(),this.ui.concept.watermark=[]},e.prototype.reload=function(){this.ui.concept.preLayer={show:!1},this.ui.concept.playerStatus={start:!1},this.ui.concept.player={ended:!1},this.showLoading(),this.ui.concept.watermark=[],this.player.reload()},e.prototype.onReplayClick=function(){this.ui.concept.preLayer={show:!1},this.ui.concept.playerStatus={start:!1},this.ui.concept.timeline={currentTime:0,played:0},this.ui.concept.player={ended:!1},this.showLoading(),this.player.seek(0),this.player.play()},e.prototype.onPlay=function(e){this.ui.concept.preLayer={show:!1},this.player.play()},e.prototype.setVolume=function(e){this.ui.concept.information={message:Fa.getString("H0001",Ca.Hint,[Math.round(e)]),key:"hint",rand:Math.random(),close:!1},e/=100,this.player.volume=e,e?(this.player.muted=!1,Na.setSettings(["volume","muted"],[e,!1],this.ikuStorage?"iku":"web")):(this.player.muted=!0,Na.setSfunction(e,t){var r=!0;switch(e){case"rate":this.player.playbackRate=t;break;case"skip":this.settings[e]=t;break;case"loop":r=!1,this.settings[e]=t;break;default:this.settings[e]=t}r&&Na.setSettings(e,t,this.ikuStorage?"iku":"web"),this.ui.concept.information={message:Fa.getString("H0002",Ca.Hint),key:"hint",rand:Math.ranction(){this.ui.concept.player={paused:!this.ui.concept.player.paused},this.player.paused?this.player.play():this.player.ended||this.player.pause()},e.prototype.setFullscreen=function(){this.fullscreen.isFullscreen?this.player.exitFullscreen():this.player.enterFullscreen()},e.prototype.setQuality=function(e){this.mediaData.quality=e;var t=this.mediaData.getQr r="H0004";"1080p_hdr"===e&&(r="H0005"),"1080p"===e&&(r=this.mediaResource.user&&this.mediaResource.user.relaxVip?"H0007":"H0008");var i=this.mediaData.getQuality(e).name;if(i){var n=Fa.getString(r,Ca.Hint,[i]);this.ui.concept.information={message:n,time:5,rand:Math.random(),key:"information",close:!1}}Na.setSettings("quality",e,this.ikuStorage?"iku":"web")},e.prototype.setLanguage=function(e){this.mediaData.language=e;var t,r=this.mediaData.getQuality(this.mediaData.quality);r&&this.player.switchStream(this.mediaData.language,r.id),t=this.mediaResource.show.id?this.meubteDashboard=function(e){var t=this;void 0===e&&(e=!0),e&&(this.dashboard.signal("active"),window.setTimeout((function(){tTimeout((function(){t.dashboard.clearSignal("active")}),e)},e.prototype.destroy=function(){},e}();function as(e){return new Promise((function(t,r){var i=function(n){var o=e.next(n),a=o.value;o.done?t(a):a instanceof Promise||"function"==typeof a.then?a.then(i,r):i(a)};i()}))}function ss(e,t,r){var i=r.value;r.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return as(i.apply(this,e))}}!function(e){e.STERROR="error",e.ABORT="abort",e.CHANGE="change"}(is||(is={}));var us,cs,ls,ps=is,ds=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),hs=function(){return(hs=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},fs=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.l3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ms=function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return functr is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continu1]<n[3])){a.label=o[1];break}if(6=,n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();cont,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};E.Global.register(Ri),function(e){e[e.LOWEST=0]="LOWEST",e[e.MEDIAN=1]="MEDIAN",e[e.HIGHEST=2]="HIGHEST"}(cs||(cs={})),function(e){e.SKIP="skip",e.AD_START="adstart",e.AD_END="adend",e.STREAM_SWITCHING="streamSwitching",e.STREAM_SWITCHED="streamswitched",e.SUBTITLE_SWITCHED="subtitleswitched"}(ls||(ls={}));var ys,gs={autoplay:!0,ui:!0},vs=((us={})[n.a.ERROR]=1,us[n.a.LOAD_START]=1,us[n.a.LOADED_MEDIA_RESOURCE]=1,us);!function(e){e[e.INIT=0]="INIT",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.AD=3]="AD",e[e.PLAYING=4]="PLAYING",e[e.STOPPED=5]="STOPPED",e[e.DESTROYED=6]="DESTROYED"}(ys||(ys={}));var bs=function(e){function t(t){var r=e.call(this,"cventList=r.bridgeEventList.filter((function(e){return!vs[e]})),r.config=hs(hs({},gs),t),r.service=new E,r.MRService=w,r.config..config.service[y.MediaResource],"function"!=typeof r.MRService||r.MRService.Name||(r.MRSerr(r.MRService,r.config),r.service.register(Yr),r.service.register(Qr,r.config.skip),r.service.register(ni),r.initAdSDK(r.config.adSDK),r.context={},r.control=new Br(r.config),r.eventBus=new o.b,r.errorManager=new Jr,r.initErrorHandles(),r.initControl(),r.service.start(Ri,r.config.features||{}),r.state=ys.INIT,!0===r.config.ui&&(r.ui=new os(r.config,r)),r}return ds(t,e),ts;this.adSDK&&(this.adSDK.destroy(),this.adSDK=null),e&&(this.adSDK=etion(e){t.eventBus.emit(ls.AD_START,e)})),this.adSDK.on(ps.END,(function(e){t.eventBus.emit(ls.AD_END,e)}))),this.service.of(y.Ad).setSDK(this.adSDK)},t.prototype.updateFeatures=function(){this.config.features&&void 0!==this.config.features["4K"]&&E.Global.of(y.Features).update({isSupport4K:!!this.config.features["4K"]})},t.prototype.install=function(e){var r=e.install(this,y,t);r&&this.setConfig(r)},t.prototype.getLoader=function(){if(this.control)return this.control.getLoader()},t.prototype.switchControlEngine=function(e){var t=[kr.MP4],r=E.Global.of(y.Features).take();r.supportMSE&&(t.push(kr.FLV),t.push(kr.DASH),t.push(kr.HLS)),r.isSupportFormat(Zr.a.M2TS)&&t.push(kr.HLS),e.drmInfo&&e.drmInfo.type===ei.a.WIDEVINE&&(t=[kr.DASH,kr.HLS]);var i=!1;e.drmInfo&&e.drmInfo.type===ei.a.FAIRPLAY&&(t=[kr.HLS],i=!0),this.config.features&&this.config.features.M3U8_CONTENT&&t.push("m3u8_content");var n=t.reduce((function(e,t,r){return e[t]=r,e}),{}),o=Object.keys(e.uri).filter((function(e){return void 0!==n[e]}));if(!o.length)throw new Error("Stream must have a uri of ["+Object.keys(n).join(",")+"]");o.sort((function(e,t){return n[t]-n[e]})),this.sourceType=this.getSourceType(o),this.control.switchEngine(this.config.engine?this.config.engine.type:_r.VIDEO,this.sourceType,i)},t.prototype.getSourceType=function(e){if(!this.config.prefer||!this.config.prefer.sourceType)return e[0];var t=[];t=Array.isArray(this.config.prefer.sourceType)?this.config.prefer.sourceType:[this.config.p++){var i=e[r];if(t.indexOf(i)>-1)return i}},t.prototypd=!1,this.control.on(n.a.TIME_UPDATE,(function(){if(e.config.skip&&e.config.skip.ending&&!e.alreadySkipEnd&&e.MediaResource&&e.control.currentTime>e.MediaResource.timeline.ending-1)return e.eventBus.emit(ls.SKIP,Rr.ENDING),e.alreadySkipEnd=!0,void sece.of(y.StartPoint).setPlayPosition(e.control.currentTime)})),this.control.on(n.a.ENDED,(function(){e.service.of(y.StartPoint).setPlayPosition(0)}))},t.prototype.setConfig=function(e){var t=this;e.service&&Object.keys(e.service).forEach((function(r){t.service.replace(e.service[r])})),Object.assign(this.config,e),this.control.setConfig(this.config),void 0!==this.config.adSDK&&this.initAdSDK(this.config.adSDK),this.updateFeatures()},t.prototype.initErrorHandles=function(){var e=this;this.errorManager.handle(this.service,(function(t,r){r.errorCount<3?r.restart(1e3):e.eventBus.emit(n.a.ERROR,t)}),y.MediaResource),this.errorManager.handle(this.control,(function(t){e.eventBus.emit(n.a.ERROR,t)}))},t.prototype.startPlayUntil=function(e,t,r,i){var n=this;e.once(t,(function(){n.startPlay(r,i)}))},t.prototype.startPlay=function(e,t){var r=this;this.state=ys.PLAontrol.seek(e),this.alreadySkipEnd=!1,this.control.once(n.a.PLAYING,(function(){t&&r.eventBus.emit(ls.SKIP,t,e)}))},t.prototype.load=function(e){var t,r,i,o,a,s,u;return ms(this,(function(c){switch(c.label){case 0:return this.control.stop(),this.state=ys.LOADING,this.currentResourceId=e,this.service.start(y.MediaResource,e),this.eventBus.emit(n.a.LOAD_START),[4,this.service.get(Yr,Qr,ni)];case 1:return t=c.sent(),r=t[0],i=t[1],o=i[0],a=i[1],s=t[2],this.state=ys.LOADED,this.switchControlEngine(r),u=0,o>0&&0===this.control.currentTime&&(u=o),this.eventBus.emit(n.a.LOADED_MEDIA_RESOURCE,r),r=this.service.of(y.StreamSelect).take(),s?(this.state=ys.AD,this.startPlayUntil(this.adSDK,ps.END,u,a),[4,this.adSDK.start(s)]):[3,3];case 2:return c.sent(),[3,4];case 3:this.startPlay(u,a),c.label=4;case 4:return this.eventBus.emit(ls.STREAM_SWITCHING,r),this.control.loadSource(r.uri[this.sourceType],r),this.eventBus.emit(ls.STREAM_SWITCHED,r),this.MediaResource.subtitle&&this.eventBus.emit(ls.SUBTITLE_SWITCHED,this.selectSubtitle(r)),[2]}}))},t.prototype.selectSubtitle=function(e){var t,r=this.MediaResource.subtitle;return e.subtitleLang&&(t=r.filter((function(t){return t.lang===e.subtitleLang}))[0]),t||(t=this.MediaResource.subtitle[0]),t},t.prototype.play=function(){if(this.state!==ys.AD)return this.control.play();this.adSDK.play()},t.prototype.getContainer=function(){return this.control.container},Object.defineProperty(t.prototype,"MediaResource",{get:function(){return this.service.take(y.MediaResource)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.MediaResource&&this.e():this.control.pause()},t.prototype.stop=function(){this.state===ys.AD?this.adSDK.stop():this.control.stop(),this.state=ys.STOPPED},t.prototype.getLanguageList=function(){var e=this.service.take(y.MediaResource);return e?e.getLanguageList():[]},t.prototype.getStreamList=function(e){return this.service.of(y.StreamSelect).getStreamList(e)},t.prototype.switchStream=function(e,t){var r=this.service.of(y.StreamSelect),i=r.getStream(e,t);return!(!i||!t(ls.STREis.switchControlEngine(i),this.control.loadSource(i.uri[this.sourceType],i)),this.eventBus.emit(ls.STREAM_SWITCHED,i),this.MediaResource&&this.eventBus.emit(ls.SUBTITLE_SWITCHED,this.selectSubtitle(i)),!0)},t.prototype.switchSubtitle=function(e){this.eventBus.emit(ls.SUBTITLE_SWITCHED,e)},t.prototype.enterFullscreen=function(){var e;(e=this.config.container).requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.oRequestFullscreen&&e.oRequestFullscreen()},t.prototype.exitFullscreen=function(){var e;(e=document).exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.oRequestFullscreen?e.oCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()},t.RequestType=Sr,t.SourceType=kr,t.Service=y,t.MediaEngine=_r,t.SimpleMediaResource=w,t.Event=hs(hs({},n.a),ls),fs([ss],t.prototype,"load",null),t}(ri);window.XMP=bs;var Es=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,teturn function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),_s=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();function Rs(e,t,r){return function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var o=e-i.length;return o<=0?r.apply(null,t.concat(i)):Rs(o,t.concat(i),r)}}"function"!=typeof Array.prototype.find&&(Array.prototype.find=function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if("function"!=typeof e)thrunction");for(var i=arguments[1],n=0;n<r;){var o=t[n];if(e.call(i,o,n,t))return o;n++}});var Ss=function(e){function t(t,r,i){var n=e.call(this,"["+t+"]"+r)||this;return n.code=t,n.name="MediaResourceError",n.info=i,n}return _s(t,e),t}(Error),As=0;function Ts(){}var ws=function(){function e(e){this.config=e}return e.prototype.request=function(e){var t=this;return new Promise((function(r,i){var n,o=t.config.name||(t.config.prefix||"__jsonpcallbacks")+As++,a=document.getElementsByTagName("script")[0],s=document.createElement("script");function u(){s.parentNode&&s.parentNode.removeChild(s),window[o]=Ts,n&&clearTimeout(n)}window[o]=function(e){r(e)},e[t.config.param||"callback"]=o,e._t=(new Date).getTime();var c=t.config.url,l=Object.keys(e).reduce((function(t,r){return t+"&"+r+"="+encodeURIComponent(e[r])}),"");c=(c+=(~c.indexOf("?")?"":"?")+l).replace("?&","?"),n=setTimeout((function(){u(),i(new Ss(-2,"timeout",{url:c}))}),t.config.timeout||3e4),s.src=c,s.onerror=function(){u(),i(new Ss(-1,"error",{url:c}))},a?a.parentNode.insertBefore(s,a):document.head.appendChild(s)}))},e}(),Ls=function(){function e(e){this._config=e}return e.prototype.request=function(e){var t=this,r=new XMLHttpRequest;return new Promise((function(i,n){for(var o in t._config.responseType&&(r.responseType=t._config.responseType),t._config.timeout&&(r.timeout=t._config.timeout),r.withCredentials=t._config.withCredentials,r.onload=function(e){var t=e.target,r=t.response,o=t.status;o>=200&&o<=299&&202!=o?i(r):n(o)},r.onerror=function(e){n(new Ss(-1,"XHR Request Error"))},r.ontimeout=function(){n(new Ss(-2,"XHR Request Timeout"))},t._config.headers)if(t._config.headers.hasOwnProperty(o)){var a="Authorization"===o?o:o.toLowerCase();r.setRequestHeader(a,t._config.headers[o])}var s,u;"formdata"===t._config.type?(s=Object.keys(e).reduce((function(t,r){return t+"&"+r+"="+encodeURIComponent(e[r])}),"").slice(1),u="application/x-www-form-urlencoded"):(s=JSON.stringify(e),u="application/json");var c=t._config.method||"GET",l=t._config.url;"GET"===c||"HEAD"===c?(s&&(l=~l.indexOf("?")?l+"&"+s:l+"?"+s),r.open(c,l,!0),r.send()):(r.open(c,l,!0),r.setRequestHeader("Content-Type",u),r.send(s))}))},e}(),Os=function(){return(Os=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},xs=window&&window.lib&&window.lib.mtop||r(28),Ps=function(){function e(e){xs.config.prefix=e.prefix||"",xs.config.subDomain=e.subDomain||"",xs.config.mainDomain=e.mainDomain||"",this._config=e}return e.prototype.request=function(e){var t=this;this._config.hasOwnProperty("json")&&!0!==this._config.json||Object.keys(e).forEach((function(t){e[t]=JSON.stringify(e[t])}));var r=Os({api:this._config.api,v:this._config.v||"1.1",data:JSON.stringify(e),appKey:this._config.appKey||"24679788",ecode:this._config.ecode||0,timeout:this._config.timeout||3e4,AntiFlood:!0,AntiCreep:!0},this._config.extra);return new Promise((function(i,n){xs.request(r).then((function(t){if(t&&0===t.retType&&t.data)return t.data;throw new Ss(-1,t.ret.join("|"),{api:this._config.api,params:JSON.stringify(e)})}),(function(r){throw new Ss(-1,r.ret.join("|"),{api:t._config.api,params:JSON.stringify(e)})})).then(i,n)}))},e}();function Ds(e,t,r){return function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var o=e-i.length;return o<=0?r.apply(null,t.concat(i)):Ds(o,t.concat(i),r)}}"function"!=typeof window.Symbol&&(window.Symbol=function(e){return"_@"+e+"@_"});var ks=Symbol("Value");function Is(e,t,r){return Array.isArray(t)||"object"!=typeof t?e[ks]=t:"object"==typeof t&&(e=Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)),"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r,e}function Ms(e,t){for(var r=t.split("."),i=e,n=0;n<r.length;n++){if(void 0===i)return i;i=i[r[n]]}return i}function Cs(e,t,r){var i=!0,n=e.split("??");"!"===n[0][0]&&(
//!
i=!1,n[0]=n[0].slice(1));for(var o=0;o<n.length;o++){var a=n[o],s=void 0;if("@"===a[0])s=a.slice(1);else if("#"===a[0])s=Number(a.slice(1));else if("$"===a)s=t.hasOwnProperty(ks)?t[ks]:t;else{var u=void 0;if("+"!==a[0]&&"-"!==a[0]||(u=a[0],a=a.slice(1)),void 0===(s=Ms(t,a.replace(/^\$\./,"")))&&i&&(s=Ms(r,a)),u)return"-"===u?-1*Number(s):Number(s)}if(void 0!==s)return s}}function Ns(e){return e<10?"0"+e:""+e}var Us={formatTime:function(e,t,r){var i=new Date(e);return Ns(i.getHours())+":"+Ns(i.getMinutes())+":"+Ns(i.getSeconds())},ms2s:function(e){return e/1e3},s2ms:function(e){return 1e3*e},isTrue:function(e){return!!e},isFalse:function(e){return!e},exist:function(e){return null!=e},notExit:function(e){return null==e}},Bs=Symbol("Iterator"),Fs=Symbol("KeyIterator"),js=Symbol("ValueIterator"),Gs=Symbol("IteratorMap"),Vs=Symbol("IteratorSort"),qs=Symbol("Spread"),Hs=Symbol("Distinct"),$s=Symbol("Check"),Ws="@FLAT@";function zs(e,t,r,i,n){return t&&t.length>0?t.reduce((function(t,r){var o=e[r]||Us[r];return o?o.call(e,t,i,n):t}),r):r}function Ks(e,t){return"object"==typeof t&&Object.keys(t).forEach((function(r){e[r]=t[r]})),e}var Ys={"^":[1,-1],"!":[-1,1]};function Xs(e,t,r){r&&(r=new Function("data","return function(item){return "+r.split(",").map((function(e){return"item['"+e+"']===data['"+e+"']"})).join("&")+";}")),(Array.isArray(t)?t:[t]).forEach((fu,Zs,eu,tu,r 0===n&&(n=i),Array.isArray(r)){var s,u,c,l=r[0],p=void 0;if("string"==typeof l?(p=(o=l.split("@"))[0],c=o[1]):(p=(a=l[Bs].split("@"))[0],c=a[1]),s=Cs(p,n,i),Array.isArray(s))c&&(s=s.filter((function(e,t){return new Function("scope","with(scope){return "+c+";}")(Is({$index:t},e,n))}))),"string"==typeof l?u=s:(u=[],s.forEach((function(r,o){var a=e(t,l,i,Is({$index:o},r,n)),s=l[Gs];s&&(a=zs(t,s.split("|"),a,r,i)),a[Ws]&&(a=a[Ws]),Xs(u,a,l[Hs])})));else if(s&&"object"==typeof s){var d;if(c)try{d=new Function("scope","with(scope){return "+c+";}")}catch(e){console.error("filter parse error:"+c+" "+e)}u=[],Object.keys(s).filter((function(e){if(d)try{return d(Is({$key:e},s[e],n))}catch(e){return console.error(e),!1}return!0})).forEach((function(r){var o=e(t,l,i,Is({$key:r},s[r],n)),a=l[Gs];a&&(o=zs(t,a.split("|"),o,s[r],i)),o[Ws]&&(o=o[Ws]),Xs(u,o,l[Hs])}))}else{if(null!=s)return;u=[]}return r.length>1&&r.slice(1).forEach((function(r){var n=e(t,r,i,s&&s[s.length-1]||i);n[Ws]&&(n=n[Ws]),Xs(u,n,l[Hs])})),l[Vs]&&function(e,t){if("string"==typeof t){var r=t[0],i=t.slice(1);if("!"!==r&&"^"!==r)throw new Error('IteratorSort must start with "!" or "^"');e.sort((function(e,t){return i&&(e=e[i],t=t[i]),e>t?Ys[r][0]:e<t?Ys[r][1]:0}))}else"function"==typeof t&&e.sort(t)}(u,l[Vs]),u}if("object"==typeof r){var h;if(r[$s]&&!new Function("scope","with(scope){return "+r[$s]+";}")(n))return;h=r[Fs]?Cs(r[Fs],n,i):r;var f=Object.keys(h).reduce((function(o,a){var s;return null!=(s=r[Fs]?e(t,r[js]||Ks({},r),i,Is({$key:a},h[a],n)):e(t,h[a],i,n))&&(s.constructor!==Object||Object.keys(s).length>0)&&(o[a]=s),o}),{})||{};return r[qs]?Ks(f,Cs(r[qs],n,i)):f}if("string"==typeof r){var m=r.lastIndexOf(":"),y=void 0;m>=0&&(y=Number(r.slice(m+1)),r=r.slice(0,m));var g=r.split("|"),v=g[0],b=zs(t,g.slice(1),Cs(v,n,i),n,i);return null==b||!b&&isNaN(b)?y:b}return"function"==typeof r?r(n,i):void 0!==r?r:void 0},Js=3,function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];switch(t.length){case 0:return e;case Js||Qs.length:return Qs.apply(null,t);default:return Ds((Js||Qs.length)-t.length,t,Qs)}}),du=pu({}),hu=function(){return(hu=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},fu=navigator.userAgent.match(/Version\/([\d.]+)\s*Safari\/[\d.]+/),mu=((Zs={biz_params:(eu={app_ver:"version",vid:"vid",h265:"h265",ptoken:"ptoken",extag:"@EXT-X-PRIVINF",client_id:"clientId",drm_level:"drm.level",drm_type:"drm.type",key_index:"drm.keyIndex",play_ability:"playAbility",encryptR_client:"drm.R1",master_m3u8:function(e){return e.enableAutoLevel?1:e.staticM3u8?0:void 0},media_type:function(e){return e.enableSubtitle?"standard,subtitle":"standard"}},eu[qs]="bizParams",eu),steal_params:(tu={ccode:"ccode",utid:"cna",version:"version",ckey:"ckey",client_ip:"@192.168.1.1",client_ts:function(){return(new Date).getTime()/1e3|0}},tu[qs]="stealParams",tu),ad_params:(ru={},ru[qs]="adParams",ru)})[qs]="extParams",Zs),yu={title:"video.title",id:"video.id",duration:"video.seconds",poster:"video.logo",traceId:"ups.psid",subtitle:"subtitle",error:"error|Error",ups:"ups",dvd:"dvd"};yu.preview={thumb:["preview.thumb_hd??preview.thumb"],timespan:"+preview.timespan",point:[(iu={},iu[Bs]='dvd.point@ctype=="story"',iu.title="title",iu.at="start",iu)],nh:10,nv:10,width:352,height:198},yu.placementPreview=[(nu={},nu[Bs]="ad.BFSTREAM",nu.thumb=["!preview.thumb_hd"],nu.timespan="+preview.timespan",nu.nh=10,nu.nv=10,nu.width=352,nu.height=198,nu.range="ad_vid|CutTimeRange",nu)],yu.streamList=[(ou={},ou[Bs]="stream",ou.name="stream_type|StreamName",ou.uri=(au={},au[kr.HLS]="m3u8_url|m3u8Resolve",au[kr.DASH]="mpd_url",au.m3u8_content="m3u8_url|m3u8ContentResolve",au[kr.MMP4]=[(su={},su[Bs]="segs",su.duration="total_milliseconds_video??total_="cdn_url",su)],au),ou.segment={url:"fs.slice_url",time:"fs.slice_pos"},ou.spd="spd",ou.duration="milliseconds_video??milliseconds_audio|ms2s",ou.langCode="audio_lang",ou.langName="audio_lang|LangName",ou.id="stream_type",ou.label="stream_ext|StreamLabel",ou.title="stream_ext|StreamTitle",ou.extra="stream_ext|StreamExtra",ou.type="stream_type|So="stream_ext.hls_logo??logo",ou.fileSize="size",ou.subtitle="subtitle_lang",ou.drmInfo={type:"drm_type|DRMType",method:"drm_type",licenseServer:"stream_ext.uri",customizedLicenseData:{encryptR1:"encryptR1",encryptRServer:"encryptR_server",copyrightKey:"stream_ext.copyright_key"}},ou),[(uu={},uu[Bs]="master",uu[Gs]="autoSplitter",uu.name="@auto",uu.uri={HLS:"h264|resolveMasterM3u8",HLS_h265:"h265|resolveMasterM3u8"},uu.duration="language|fillDurguage|LangName",uu.id="@auto",uu.type="@h264_standard",uu.width=-1,uu.height=-1,uu.fileSize=0,uu.subtitle="subtitle",uu.extra="|autoExtra",uu.logo="|autoExtraLogo",uu.drmInfo="|autoDRM",uu)]],yu.timeline={opening:"dvd.head|ms2s:0",ending:"dvd.tail|ms2s:Infinity",placement:[(cu={},cu[Bs]='dvd.point@ctype==="contentad"||ctype==="cut"',cu.start="start",cu.duration="al",cu)]},yu.watermark=[(lu={},lu[Bs]="watermark",lu.img={url:"rsUrl",width:"displayDTOS.0.width",height:"displayDTOS.0.height"},lu.text={content:"text",size:"textSize",color:"textColor",duration:"displayDTOS.0.duration"},lu.x="displayDTOS.0.posX",lu.y="displayDTOS.0.posY",lu.ref="refCoord",lu.type="type",lu.alpha="alpha",lu.displayMode="displayMode",lu)];var gu={"4k":["cmaf5hd4","mp5hd4"],"1080p_frame":["hls4hd3_sdr_hbr_cingo","cmaf4hd3_sdr_hbr_cingo","hls4hd3_sdr_hfr_hbr_cingo","cmaf4hd3_sdr_hfr_hbr_cingo","hlshd4_hfr120_hbr","hls5hd4_hfr_hbr","hls5hd4_hbr","hls5qd3_hfr120_hbr","hls5qd3_hfr120_hbr",","hls5hd4_hbr_bit10"],"1080p_hdr":["hls4hd3_sdr","cmaf4hd3_sdr","hls5hd3_sdr","cmfv4hd3_sdr"],"1080p":["mp4hd3v2","mp4hd3","cmaf4hd3","mp5hd3","cmaf5hd3","cmfv4hd3"],"720p":["mp4hd2v2","mp4hd2","cmaf4hd2","mp5hd2","cmaf5hd2","cmfv4hd2"],"540p":["mp4hd","cmaf4hd","mp5hd","cmaf5hd","cmfv4hd"],"320p":["mp4sd","flvhd","cmaf4sd","mp5sd","cmaf5sd","cmfv4sd"],"270p":["3gphd","cmaf4ld","cmaf5ld"],auto:["auto"]},vu={auto:{label:"",title:""},"270p":{label:"",title:" 360P"},"320p":{label:"",title:" 360P"},"540p":{label:"",title:" 540P"},"720p":{label:"",title:" 720P"},"1080p":{label:"",title:" 1080P"},"1080p_hdr":{label:"HDR",title:"HDR"},"1080p_frame":{label:"",title:""},"4k":{label:"4K",title:"4K"}},bu=Object.keys(gu).reduce((function(e,t){return gu[t].reduce((function(e,r){return e[r]=t,e}),e),e}),{}),Eu={default:"",guoyu:"",yue:"",en:"",ja:""},_u={isFree:function(e){return!(e&&1==e.paid)},m3u8Resolve:function(e){return e&&0===e.indexOf("#EXTM3U")||0===e.indexOf("#PLSEXTM3U")?URL.createObjectURL(new Blob([e])):e},m3u8ContentResolve:function(e){if(e&&0===e.indexOf("#EXTM3U")||0===e.indexOf("#PLSEXTM3U"))return e},Error:function(e){if(e)return{code:e.code,message:e.note}},autoDRM:function(e,t,r){var i=r.stream.filter((function(e){return e.audio_lang===t.language}))[0];if(i)return{type:this.DRMType(i.drm_type),licenseServer:i.stream_ext.uri,customizedLicenseData:{encryptRServer:i.encryptR_server,copyrightKey:i.stream_ext.copyright_key}}},autoExtra:function(e,t,r){var i=r.stream.filter((function(e){return e.audio_lang===t.language}))[0];if(i)return i.stream_ext},autoExtraLogo:function(e,t,r){var i=r.stream.filter((function(e){return e.audio_lang===t.language}))[0];if(i)return i.stream_ext.hls_,o=[];return e.uri.HLS&&o.push(hu(hu({},e),{id:"auto_h264",type:"h264_standard",uri:(i={},i[kr.HLS]=e.uri.HLS,i.m3u8_65&&o.push(hu(hu({},e),{id:"auto_h265",type:"h265_standard",uri:(n={},n[kr.HLS]=e.uri.HLS_h265,n.m3u8_content=t.h265,n)})),o},DRMType:function(e,t,r,i){switch(e){case"copyrightDRM":return ei.a.CUSTOMIZED;case"cenc":case"cbcs":return fu&&parseInt(fu[1])>=11&&window.WdiaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4")?ei.a.FAIRPLAY:ei.a.WIDEVINE;default:return}},fillDuration:function(e,t,r){var i=r.staudio_lang===e}))[0];if(i){var n=(i.milliseconds_video||i.milliseconds_audio)/1e3;if(n>0)return n}return r.video.seconds},CutTimeRange:function(e,t,r){var i=r.dvd.point.filter((function(t){return t.cut_vid==e}))[0];return i?[i.start/1e3,(Number(i.start)+Number(i.al))/1e3]:[0,0]},LangName:function(e){return Eu[e]||""},StreamName:function(e,t,r){return bu[e]},StreamLabel:function(e,t,r){var i=bu[t.stream_type],n=i&&vu[i]&&vu[i].label,o=r.video.stream_ext;if(o&&o[t.audio_lang]&&o[t.audio_lang][t.stream_type]){var a=o[t.audio_lang][t.stream_type];a&&a.clarity_short_title&&(n=a.clarity_short_title)}return n},StreamTitle:function(e,t,r){i].title,o=r.video.stream_ext;if(o&&o[t.audio_lang]&&o[t.audio_lang][t.stream_type]){var a=o[t.audio_lang][t.stream_type];a&&a.c_titlunctiondeo.streudio_lam_type]ang][t.stream_type],e):i=e,r.ppStreamConfig&&r.ppStreamConfig[t.audio_lang]&&r.ppStreamConfig[t.audio_lang][t.stream_type]&&(i.streamConfig=r.ppStreamConfig[t.audio_lang][t.stream_type]),i},StreamType:function(e,t,r){var i=t&&t.stream_type;return/(mp|cmaf|hls)5/.test(e)?"h265_"+(t.media_type||"standard"):/(mp|cmaf|hls|cmfv|)4|flvhd|3gphd/.test(e)?"h264_"+(t.media_type||"s.codec||"h264")+"_"+(t.media_type||"standard"):t.media_type||"standard"},resolveMasterM3u8:function(e,t,r){if(e){var i=new Blob([e(_u,yu),Au=function(e,t){return function r(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];switch(i.length){case 0:return r;case t||e.length:return e.apply(null,i);default:return Rs((t||e.length)-i.length,i,e)}}}((function(e,t,r,i,n){return i.request(e(n)).then(r).then((function(e){var t=Su(e);return t.raw=e,new S(t)}))}));function Tu(e){if(!e.hasOwnProperty("e")||!e.e.hasOwnProperty("code")||0!==e.e.code||!e.data){if(1111===e.status)throw new Ss(-4,"current limiting");throw new Ss(-3,"data is empty")}return e.data}var wu=Au(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce((function(e,t){return function(r){return e(t(r))}}))}((function(e){var t={};return Object.keys(e).forEach((function(r){"object"==typeof e[r]?Object.keys(e[r]).forEach((function(i){return t[i]=e[r][i]})):t[r]=e[r]})),t}),Ru),Su,Tu),Lu=Au(Ru,Su,Tu);function Ou(e,t,r){return function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var o=e-i.length;return o<=0?r.apply(null,t.concat(i)):Ou(o,t.concat(i),r)}}"function"!=typeof window.Symbol&&(window.Symbol=function(e){return"_@"+e+"@_"});var xu=Symbol("Value");function Pu(e,t,r){return Array.isArray(t)||"object"!=typeof t?e[xu]=t:"object"==typeof t&&(e=Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)),"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r,e}function Du(e,t){for(var r=t.split("."),i=e,n=0;n<r.length;n++){if(void 0===i)return i;i=i[r[n]]}return i}function ku(e,t,r){var i=!0,n=e.split("??");"!"===n[0][0]&&(
//!
i=!1,n[0]=n[0].slice(1));for(var o=0;o<n.length;o++){var a=n[o],s=void 0;if("@"===a[0])s=a.slice(1);else if("#"===a[0])s=Number(a.slice(1));else if("$"===a)s=t.hasOwnProperty(xu)?t[xu]:t;else{var u=void 0;if("+"!==a[0]&&"-"!==a[0]||(u=a[0],a=a.slice(1)),void 0===(s=Du(t,a.replace(/^\$\./,"")))&&i&&(s=Du(r,a)),u)return"-"===u?-1*Number(s):Number(s)}if(void 0!==s)return s}}function Iu(e){return e<10?"0"+e:""+e}var Mu={formatTime:function(e,t,r){var i=new Date(e);return Iu(i.getHours())+":"+Iu(i.getMinutes())+":"+Iu(i.getSeconds())},ms2s:function(e){return e/1e3},s2ms:function(e){return 1e3*e},isTrue:function(e){return!!e},isFalse:function(e){return!e},exist:function(e){return null!=e},notExit:function(e){return null==e}},Cu=Symbol("Iterator"),Nu=Symbol("KeyIterator"),Uu=Symbol("ValueIterator"),Bu=Symbol("IteratorMap"),Fu=Symbol("IteratorSort"),ju=Symbol("Spread"),Gu=Symbol("Distinct"),Vu=Symbol("Check");function qu(e,t,r,i,n){return t&&t.length>0?t.reduce((function(t,r){var o=e[r]||Mu[r];return o?o.call(e,t,i,n):t}),r):r}function Hu(e,t){return]=t[r]})),e}vion(e){returnt]).forEach((function(t){r&&0!==e.filter(r(t)).length||e.push(t)}))}var zu,Ku,Yu,Xu=function(e,t){return function r(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];switch(i.length){case 0:return r;case t||e.length:return e.apply(id 0;if("string"==typeof l?(p=(o=l.split("@"))[0],c=o[1]):(p=(a=l[Cu].split("@"))[0],c=a[1]),s=ku(p,n,i),Array.isArray(s))c&&(s=s.filter((function(e,t){return new Function("scope","with(scope){return "+c+";}")(Pu({$index:t},e,n))}))),"string"==typeof l?u=s:(u=[],s.forEach((function(r,o){var a=e(t,l,i,Pu({$index:o},r,n)),s=l[Bu];s&&(a=qu(t,s.split("|"),a,r,i)),a["@FLAT@"]&&(a=a["@FLAT@"]),Wu(u,a,l[Gu])})));else if(s&&"object"==typeof s){var d;if(c)try{d=new Function("scope","with(scope){return "+c+";}")}catch(e){console.error("filter parse error:"+c+" "+e)}u=[],Object.keys(s).filter((function(e){if(d)try{return d(Pu({$key:e},s[e],n))}catch(e){return console.error(e),!1}return!0})).forEach((function(r){var o=e(t,l,i,Pu({$key:r},s[r],n)),a=l[Bu];a&&(o=qu(t,a.split("|"),o,s[r],i)),o["@FLAT@"]&&(o=o["@FLAT@"]),Wu(u,o,l[Gu])}))}else{if(null!=s)return;u=[]}return r.length>1&&r.slice(1).forEach((function(r){var n=e(t,r,i,s&&s[s.length-1]||i);n["@FLAT@"]&&(n=n["@FLAT@"]),Wu(u,n,l[Gu])})),l[Fu]&&function(e,t){if("string"==typeof t){var r=t[0],i=t.slice(1);if("!"!==r&&"^"!==r)throw new Error('IteratorSort must start with "!" or "^"');e.sort((function(e,t){return i&&(e=e[i],t=t[i]),e>t?$u[r][0]:e<t?$u[r][1]:0}))}else"function"==typeof t&&e.sort(t)}(u,l[Fu]),u}if("object"==typeof r){var h;if(r[Vu]&&!new Function("scope","with(scope){return "+r[Vu]+";}")(n))return;h=r[Nu]?ku(r[Nu],n,i):r;var f=Object.keys(h).reduce((function(o,a){var s;return null!=(s=r[Nu]?e(t,r[Uu]||Hu({},r),i,Pu({$key:a},h[a],n)):e(t,h[a],i,n))&&(s.constructor!==Object||Object.keys(s).length>0)&&(o[a]=s),o}),{})||{};return r[ju]?Hu(f,ku(r[ju],n,i)):f}if("string"==typeof r){var m=r.lastIndexOf(":"),y=void 0;m>=0&&(y=Number(r.slice(m+1)),r=r.slice(0,m));var g=r.split("|"),v=g[0],b=qu(t,g.slice(1),ku(v,n,i),n,i);return null==b||!b&&isNaN(b)?y:b}return"function"==typeof r?r(n,i):void 0!==r?r:void 0}),3)({}),Qu=function(){var e=functrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();!function(e){e.JSONP="jsonp",e.MTOP="mtop",e.FETCH="fetch"}(zu||(zu={})),function(e){e[e.REQUEST_ERROR=0]="REQUEST_ERROR",e[e.REQUEST_FAILED=1]="REQUEST_FAILED",e[e.REQUEST_TIMEOUT=2]="REQUEST_TIMEOUT"}(Ku||(Ku={})),function(e){e[e.BIZ_ERROR=0]="BIZ_ERROR",e[e.BIZ_FAILED=1]="BIZ_FAILED"}(Yu||(Yu={}));var Ju={ccode:"ccode",cna:"cna",ckey:"ckey",version:"version",playAbility:"playAbility",adParams:"adParams"},Zu=U.registerError("NET","MRS",Ku),ec=U.registerError("BIZ","MRS",Yu),tc=function(){function e(){}return e.checkDomain=function(e){return!/(?=(\b|\D))(((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))\.){3}((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))(?=(\b|\D))/.test(e)},e.changeM3U8Domain=function(e){var t=/^https?:\/\/([^/]+)/.exec(e),r=t&&t[1];if(-1!==["valipl.cp31.ott.cibntv.net","v6-valipl.cp31.ott.cibntv.net","valipl-vip.cp31.ott.cibntv.net","v6-valipl-vip.cp31.ott.cibntv.net"].indexOf(r)){var i="v4-"+r.replace("v6-","");return e.replace(/^(https?:\/\/)([^/]+)/,"$1"+i)}return e},e.changeDomain=function(e){for(var t=[["valipl.cp31.ott.cibntv.net","valipl-vip.cp31.ott.cibntv.net"],["vali-ugc.cp31.ott.cibntv.net","ykugc-vip.cp31.ott.cibntv.net"]],r=/^https?:\/\/([^/]+)/.exec(e),i=r&&r[1],n=0;n<t.length;n++){var o=t[n],a=o.indexOf(i);if(-1!==a){var s=o[(a+1)%o.length];return e.replace(/^(https?:\/\/)([^/]+)/,"$1"+s)}}return e},e.changeProtocol=function(e){return/^http:|^https:/.test(e)?e.replace(/http:|https:/,location.protocol):e}rch||location.href;var t={},r=e.split("?"),i=r[0],n=r.slice(1).join("?");return n?(n.split("&").forEach((function(e){var r=e.split("=");t[r[0]]=decodeURIComponent(r.slice(1).join("="))})),{host:i,params:t}):{host:i,params:{}}},e}(),rc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(ereturn function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ic=function(){function e(){}return e.get=function(e){var t=window.document.cookie.match(new RegExp("(?:\\s|^)"+e+"\\=([^;]*)"));return nent(t[1]=r||{}).expires&&(r.expires.constructor===Date?i=r.expires:(i=new Date).setTime(i.getTime()+24*r.expires*60*60*1e3),n="; expires="+i.toGMTString());var o=r.path?"; path="+r.path:"",a=r.domain?"; domain="+r.domain:"",s=r.secure?"; secure":"";window.document.cookie=[e,"=",encodeURIComponent(t),n,o,a,s].join("")},e}();var nc=function(){function e(e){this.config=e}return e.prototype.start=function(){var e,t,r=this;if(this.promise=(e={},(t=new Promise((function(t,r){e.resolve=t,e.reject=r}))).defer=e,t),this.roundCount=0,this.roundTimer=window.setInterval((function(){r.roundCount++,r.roundCount>10?r.onError():r.getCna()}),500),!this.config.cna)return this.getCna(),this.promise;this.onComplete(this.config.cna)},e.prototype.getCna=function(){ic.get("cna")?this.onComplete(ic.get("cna")):window.goldlog&&window.goldlog.Etag?(this.onComplete(decodeURIComponent(window.goldlog.Etag)),ic.set("cna",this.cna,{domain:"youku.com",path:"/",expires:365}),window.goldlog.pvid&&(window.goldlog.pvid="")):(this.addMeta(),this.init())},e.prototype.addMeta=function(){var e=document.location.href;if(e.indexOf("youku.com")<0&&e.indexOf("tudou.com")<0){var t=document.getElementsByTagName("head")[0],r=document.createElement("meta");r.name="aplus-disable-pvid",r.content="true",t.appendChild(r)}},e.prototype.init=function(){var e=this,t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","https://g.alicdn.com/alilog/mlog/aplus_o.js"),t.onerror=function(){e.onError()},document.getElementsByTagName("head")[0].appendChild(t),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.aplus_pubsub.subscribe",arguments:["sendPV",function(t,r,i){i&&i.cna&&e.onComplete(decodeURIComponent(i.cna))}]})},e.prototype.onComplete=function(e){window.clearInterval(this.roundTlve(e)},e.prototype.onError=function(e){window.clearInterval(this.roundTimer),this.promnction(){function e(){}return e.prototype.start=function(){var e,t,r=this;if(this.promise=(e={},(t=new Promise((function(t,r){e.resolve=t,e.reject=r}))).defer=e,t),this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=window.setTimeout((function(){r.onError()}),3e3),window.ikuApi&&window.ikuApi.getCollinaCkey)window.ikuApi.getCollinaCkey((function(e){r.onComplete(e)}));else{var i=this.getLocalKey();i?this.onComplete(i):window.AWSC?this.getUab().then((function(e){r.onComplete(e)})):this.initAWSC().then((function(){r.getUab().then((function(e){r.onComplete(e)}))})).catch((function(){r.onError()}))}return this.promise},e.prototype.initAWSC=function(){return new Promise((function(e,t){var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src","//g.alicdn.com/AWSC/AWSC/awsc.js"),r.onerror=function(){t()},r.onload=function(){window.AWSC?e(window.AWSC):t()},document.getElementsByTagName("head")[0].appendChild(r)}))},e.prototype.getLocalKey=function(){var e=localStorage.getItem("YK_PLAYER_CKEY");if(e)try{var t=JSON.parse(e);if(t&&t.ckey&&t.time&&Date.now()-t.time<6048e5)return t.ckey}catch(e){console.log(e)}return""},e.prototype.setLocalKey=function(){var e=this;window.AWSC?this.getUab().then((function(e){localStorage.setItem("YK_PLAYER_CKEY",JSON.stringify({ckey:e,time:Date.now()}))})):this.initAWSC().then((function(){e.getUab().then((function(e){localStorage.setItem("YK_PLAYER_CKEY",JSON.stringify({ckey:e,time:Date.now()}))}))})).catch((function(){}))},e.prototype.getUab=function(){var e=this;return new Promise((function(t,r){window.fyOBJ?(e.uab=window.fyOBJ,t(e.uab.getUA())):window.AWSC.use("uab",(function(r,i){"loaded"===r&&(e.uab=i,t(e.uab.getUA()))}))}))},e.prototype.onComplete=function(e){this.timer&&(clearTimeout(this.timer),this.timer=null),this.promise.defer.resolve(e),this.setLocalKey()},e.prototype.onError=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.promise.defer.resolve("DIl58SLFxFNndSV1GFNnMQVYkx1PP5tKe1siZu/86PR1u/Wh1Ptd+WOZsHHWxysSfAOhNJpdVWsdVJNsfJ8Sxd8WKVvNfAS8aS8fAOzYARzPyPc3JvtnPHjTdKfESTdnuTW6ZPvk2pNDh4uFzotgdMEFkzQ5wZVXl2Pf1/Y6hLK0OnCNxBj3+nb0v72gZ6b0td+WOZsHHWxysSo/0y9D2K42SaB8Y/+aD2K42SaB8Y/+ahU+WOZsHcrxysooUeND")},e}(),sc=function(){function e(){}return e.set=function(e,t,r){var i={};null!=localStorage.getItem(r)&&""!=localStorage.getItem(r)&&(i=JSON.parse(localStorage.getItem(r))),i[e]=t;try{localStorage.setItem(r,JSON.stringify(i))}catch(e){console.log("localStorage is not support")}},e.save=function(e,t){try{"object"==typeof t||Array.isArray(t)?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,String(t))}catch(e){console.log("localStorage is not support")}},e.remove=function(e){localStorage.removeItem(e)},e.getObject=function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):{}},e.get=function(e){return localStorage.getItem(e)},e}(),uc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),cc=((oc={})[Ir.HEVC]="h265",oc[Ir.AVC]="h264",oc),lc=[{name:"YoukuHD",reg:/(youku_hd|youkuhd)\/([\d.]+)/i},{name:"YoukuHD",reg:/(youku_hd|youkuhd);/i},{name:"Youku",reg:/(youku|youku_hd|youkuhd)\/([\d.]+)/i},{name:"Wechat",reg:/(micromessenger)\/([\d.]+)/i},{name:"QQ",reg:/(qq)\/([\d.]+)/i},{name:"Weibo",reg:/(weibo).*weibo__([\d.]+)/i},{name:"QZone",reg:/(qzone)\/.*_qz_([\d.]+)/i},{name:"Baidu",reg:/(baiduboxapp)\/([\d.]+)/i},{name:"DingDing",reg:/(aliapp\(dingtalk)\/([\d.]+)/i},{name:"Taobao",reg:/(aliapp\(tb)\/([\d.]+)/i},{name:"Alipay",reg:/(alipayclient|aliapp\(AP)\/([\d.]+)/i},{name:"AliTrip",reg:},{name:"UC",reg:/(ucbrowser)\/([\d.]+)/i},{name:"WindVane",reg:/(windvane)\/([\d.]+)/i},{name:"Liebao",reg:/(liebao[^/]*)\/([\d.]+)/i},{name:"360",reg:/(qihoobrowser)\/([\d.]+)/i},{name:"360SoSuo",reg:/(mso_app)\s*\(([\d.]+)/i},{name:"QQLive",reg:/(qqlivebrowser)\/([\d.]+)/i},{name:"QQBrowser",reg:/(qqbrowser)\/([\d.]+)/i},{name:"Iqiyi",reg:/(iqiyiversion)\/([\d.]+)/i},{name:"BaiduBrowser",reg:/(baidubrowseg:/(sogou[\w]*browser)\/([\d.]+)/i},{name:"Edge",reg:/(edge)\/([\d.]+)/i},{name:"Opera",reg:/(opr)\/([\d.]+)/i,skipIfMatched:!0},{name:"Chrome",reg:/(chrome)\/([\d.]+)/i,skipIfMatched:!0(crios)\/([\d.]+)/i,skipIfMatched:!0},{name:"IEMobile",reg:/(iemobile)[/]([\d.]+)/i,skipIfMatched:!0},{name:"Firefox",reg:/(firefox)\/([\d.]+)/i,skipIfMatched:!0},{name:"Opera",reg:/(opera)(?:.*version|)[ /]([\d.]+)/i,skipIfMatched:!0},{name:"Safari",reg:/(version)(applewebkit)[/]([\d.]+).*(safari)[/]([\d.]+)/i,skipIfMatched:!0},{name:"Safari",reg:/(webkit)[ /]([\d.]+).*(version)[/]([\d.]+).*(safari)[/]([\d.]+)/i,skipIfMatched:!0},{name:"IE",reg:/(msie) ([\d.]+)/i},{name:"IE",reg:/trident.*(rv)(?::| )([\d.]+)/i}],pc=[{name:"IPad",reg:/(ipad|iphone.*youku_hd\/[\d.]+)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"IPad",reg:/(ipad|iphone.*youku_hd)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"IPod",regname:"WindowsPhone",reg:/(windows phone)/i,mobile:!0,breakIfMatched:!0},{name:"IPhone",reg:/(iphone)/i,mobile:!0,ios:!0,breakIfMatched:!0},{name:"Android",reg:/(android)/i,mobile:!0,breakIfMatched:!0},{name:"Windows",reg:/(win)/i,desktop:!0,breakIfMatched:!0},{name:"Mac",reg:/(mac)/i,desktop:!0,breakIfMatched:!0},{name:"Linux",reg:/(linux)/i,desktop:!0,breakIfMatched:!0}];function dc(e,t){for(var r=[],i=0;i<e.length;i++)if(!r.length||!e[i].skipIfMatched){var n=e[i].reg.exec(t);if(n&&r.push({mf navigator||(e=navigator.userAgent||"");for(var r=dc(lc,e),i=0;i<r.length;i++){var n=r[i],o=n.match,a=n.map,s={browser:o[5]||o[3]||o[1]||"",version:o[4]||o[2]||"0"};if(s.browser){var u=a.name.toLowerCase();void 0===t.name?(t["is"+a.name]=!0,t.version=s.version,t.majorVersion=parseInt(s.version,10),t.name=u):(t["is"+a.name]=!0,t.ext[u]={version:s.version,majorVersion:parseInt(s.version,10)})}}var c=dc(pc,e)[0]||{match:[],map:{}},l=c.match,p=c.map;return l[0]&&(t["is"+p.name]=!0,t.platform=p.name.toLowerCase()),t.isMobile=p.mobile||!1,t.isDesktop=p.desktop||!1,t.isIOS=p.ios||!1,t}();var fc,mc,yc,gc,vc=function(){function e(e){this.logHost="//yt.mmstat.com",this.logName="",this.id="YoukuLogger",this._enabled=!0,this.context=e,this.ccode=this.context.config.ccode}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.enabled=!0,this._params={},this._params.version=this.context.version,this._params.platform=hc.platform,this._params.browser=hc.name,this._params.browser_version=hc.version,this._params.ccode=this.ccode,this._params.playersid=this.context.playerSid},e.prototype.report=function(){},e.prototype.onServiceComplete=function(e){this.resetParams()},e.prototype.resetParamsData=null},Object.defineProperty(e.prototype,"fullscreen",{get:function(){return"0"},enumerable:!1,configurable:!0}),e.prototype.sendGoldLog=function(e){if(1===e.type)this.sendLog(e);else try{window.goldlog&&(e.code?window.goldlog.record(e.url,e.eventType,e.format?e.params:this.formatParams(e.params,!0),e.code):window.goldlog.record(e.url,e.eventType,e.format?e.params:this.formatParams(e.params,!0),"GET"))}catch(t){this.sendLog(e)}},e.prototype.sendLog=function(e){var t="";e.hasOwnProperty("protocolRevised")||(e.protocolRevised=!0),t=e.protocolRevised&&e.domain.indexOf("http:")<0&&e.domain.indexOf("https:")<0?this.getProtocol()+e.domain:e.domain,t+=e.url,t+=(-1===t.indexOf("?")?"?":"&")+(e.format?e.params:this.formatParams(e.params,!0));var r=document.createElement("img");r.onload=function(){r.onload=null,r.onerror=null,r=null},r.src=t},e.prototype.getProtocol=function(){return document.location&&document.location.protocol?document.location.protocol:document.location&&document.location.href&&document.location.href.indexOf("https:")>-1?"https:":"http:"},e.prototype.formatParams=function(e,t){var r=[];for(var i in e)e.hasOwnProperty(i)&&r.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));if(!t){var n=Math.random().toString();n=n.toString().replace(".",""),r.push("_t="+n)}return r.join("&")},e.prototype.destroy=function(){this.context=null,this._params=null,this._playlistData=null,this.ccode=null,this.id=null,this.logHost=null,this.logName=null},e}(),bc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ec={winType:"@30",ev:"@1",ikuflag:"@n",source:"@video",Tid:"@0",format:"@0",tk:"@",pid:"@",topHdVideo:"@",playWay:"@net",videoid:"config.vid",ctype:"config.ccode"},_c={playComplete:"@0",videoid:"video.id",videoOwnerId:"video.userid",drmtype:"video.drm_type",ct:"video.category_id",cs:"video.cs",videotype:"video.ctype",sid:"ups.psid",oip:"ups.ups_client_netip",showid_v2:_type",stg:"show.stagabel:"",name:"",index",name:" 360P",index:1,auto:"320P"},"320p":{label:"",name:" 360P",index:1,auto:"320P"},"540p":{label:"",name:" 540P",index:2,auto:"540P"},"720p":{label:"",name:" 720P",index:3,auto:"720P"},"1080p":{label:"",name:" 1080P",index:4,auto:"1080P"},"1080p_hdr":{label:"HDR",name:"HDR",index:5,auto:"HDR"},"1080p_frame":{label:"",name:"",index:6,auto:""},"4k":{label:"4K",name:"4K",index:7,auto:"4K"}},Sc=function(e){function t(t){var r=e.call(this,t)||this;return r.id="vvlog",r.logName="/yt/vp.vdoview",r.reset(),r}return bc(t,e),t.prototype.resetParams=function(){if(e.prototype.resetParams.call(this),this._playlistData){var t=Xu(_c,this._playlistData);this._params=Object.assign(this._params,t),this._params.viewUserId=this._playlistData.user&&(this._playlistData.user.ytid||this._playlistData.user.uid),this._params.isvip=this._playlistData.user&&this._playlistData.user.vip?1:0,this._params.playstate=this._playlistData.trial?2:1,this._params.Type=this._playlistData.controller&&3===parseInt(this._playlistData.controller.play_mode,10)?1:0;var r=0;this._playlistData.show&&this._playlistData.show.pay_type&&("vod"===this._playlistData.show.pay_type[0]&&(r=1),"mon"===this._playlistData.show.pay_type[0]&&(r=2)),this._params.paystate=r,this._params.totalsec="0",this.context&&this.context.core&&this.context.core.duration&&(this._params.totalsec=this.context.core.duration),this._params.isdrm=this.context.config&&this.context.config.isSupportDRM?1:0,this._firstSend60=!0}},t.prototype._checkVVlogSend=function(e){void 0===e&&(e=!1);var t=(new Date).getTime();if(e)return this.actualDiffTime=0,this._lastCountedTime=t,this._lastSentVideoReportTime=t,void this.report();this._isPause&&(this._isPause=!1,this.actualDiffTime+=t-this._lastCountedTime),t-this._lastSentVideoReportTime-this.actualDiffTime>6e4&&(this.actualDiffTime=0,this._lastCountedTime=t,this._lastSentVideoReportTime=t,this.report())},t.prototype.onServiceComplete=function(t){e.prototype.onServiceComplete.call(this,t),this._number=58,this.report(),this.onBeforeSourceChange(t)},t.prototype.onAdPlay=function(e){this._isFirst&&(this._number=59,this._isFirst=!1,this.report())},t.prototype.onTimeUpdate=function(){this._number=60,this._checkVVlogSend(this._firstSend60),this._firstSend60=!1},t.prototype.onPause=function(){this._isPause||(this._isPause=!0,this._lastCountedTime=(new Date).getTime())},t.prototype.onWaiting=function(){this._isPause||(this._isPause=!0,this._lastCountedTime=(new Date).getTime())},t.prototype.onEnd=function(){this._number=61,this._params.playComplete="1",this.report()},t.prototype.onPlayerRealStart=function(){this._isFirst&&(this._number=59,this._isFirst=!1,this.report())},t.prototype.onReplay=function(){this._number=62,this.vvExtra.pb="2",this.report()},t.prototype.onReload=function(){this._number=63,this.report()},t.prototype.onBeforeSourceChange=function(e){this.stream=e},t.prototype.report=function(){if(this.enabled){this._params.cna=this.context.cna||"";var e="";try{e=window.UrchinAplus._yVvlogInfo()||""}catch(e){}var t=this._params,r=0;if(this.context.currentStream&&this.context.currentStream.name&&Rc[this.context.currentStream.name]&&(r=Rc[this.context.currentStream.name].index-1),t.hd=r,this.stream&&this.stream.uri&&this.stream.uri[kr.HLS]){var i=this.stream.uri[kr.HLS],n=/^https?:\/\/([^/]+)/.exec(i);if(n&&n[1]&&(t.cdn=n&&n[1]),!/pl-ali\.youku\.com/.test(i)){var o=i.match(/([^/]+)\.m3u8/);o&&o[1]&&(t.file_id=o[1])}}if(t.xcdn=this.context.xcdn,this.context&&this.context.getLoader()&&this.context.getLoader().totalByteLength&&(t.totalByteLength=this.context.getLoader().totalByteLength,this.context.getLoader().cleanByteLength()),t.env="webPreview",navigator.userAgent.indexOf("BUILDVER")>-1){var a=navigator.userAgent.match(/(BUILDVER) ([\d.]+)/i);(a&&a[2]||"")&&(t.env="ikuPreview")}t.danmu=0,t.p2p=0,t.currentPlayTime=Math.round(this.context.core.currentTime)||"0",t.timestamp=(new Date).getTime(),t.number=this._number,t.fullflag=this.fullscreen,t.continuationPlay=this.context.config.continuePlay?"1":"0",t.is_pread=1,59!==t.number&&62!==t.number||(t.is_pread=null),t.droppedPercent=0,t.decodeLagCount=0,t.videoRenderLagCount=0,Object.assign(t,e,this.vvExtra);var s=this.formatParams(t,!0),u={format:!0};u.domain=this.logHost,60==t.number||61===t.number?(this.logHost="//yt.mmstat.com",this.logName="/yt/vp.vdoview"):(this.logHost="//gm.mmstat.com",this.logName="/yt/youkuplayer.fdl.previewdoview"),u.url=this.logName,u.params=s,u.eventType="EXP",u.code="",u.type=1,this.sendGoldLog(u)}},t.prototype.reset=function(){e.prototype.reset.call(this),this._isFirst=!0,this._firstSend60=!0,this._number=59,this.actualDiffTime=0,this.stream=null;var t=Xu(Ec,this.context);this._params.url=location.href,this._params.referUrl=document.referrer;var r="oth",i=hc.platform;["ipad","ipod","iphone"].forEach((function(e){i===e&&(r=i.slice(0,3))})),"android"===i&&(r="adr"),this._params.mtype=r,this._params=Object.assign(this._params,t),this.vvExtra={},this._isPause=!1,this.resetParams()},t}(vc),Ac=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Tc=function(e){function t(t){var r=e.call(this,t)||this;return r.id="ErrorLogger",r.logHost="//gm.mmstat.com",r.logName="/yt/yer.fdl.ykcollina",r.reset(),r(this.enabled&&e.code&&e.fatal){this._data={},this._data.track_view_code=e.trackViewCode?e.trackViewCode:"H"+(1e3*(new Date).getTime()+Math.floor(1e3*Math.random())),this._data.error_code=e.code,e.originCode&&(this._data.originCode=e.originCode),e.originMessage&&(this._data.originMessage=e.originMessage),e.errorURL&&(this._data.errorURL=e.errorURL),this._data.error_type=e.code.toString().slice(0,2);var t=this.context.core.currentTime;this._data.error_position=t?Math.round(t):0,this._data.user_timestamp=Math.ceil((new Date).getTime()/1e3);var r=(new Date).getTime();this._data.staytime=r-this._startTime,e.summary&&Object.assign(this._data,e.summary),this.report()}},t.prototype.report=function(){var e={};this._params.utid=this.context.cna||"";var t=Object.assign(this._data,this._params,this.vvExtra);if(t.isdrm=this.context.config&&this.context.config.isSupportDRM?1:0,e.format=!1,e.domain=this.logHost,e.url=this.logName,e.params=t,e.eventType="EXP",e.code="H1481495508","ideoid=this.contersion="H5",this.vvExtra={},this.resetParams()},t.prototype.resetParams=function(){e.prototype.resetParams.call(this),this._startTime=(new Date).getTime(),this._playlistData&&(this._playlistData.video&&(this._params.videoid=this._playlistData.video.id,this._params.videotype=this._playlistData.video.ctype,this._params.drmtype=this._playlistData.video.drm_type),this._playlistData.user&&(this._playlistData.user.ytid?this._params.userid=this._playlistData.user.ytid:this._params.userid=this._playlistData.user.uid,this._params.vip=this._playlistData.user.vip),this._playlistData.ups&&(this._params.psid=this._playlistData.ups.psid||""),this._playlistData.show?(this._params.showid=this._playlistData.show.id,this._params.showencodeid=this._playlistData.show.encodeid):(this._params.showid=0,this._params.showencodeid=""))},t}(vc),wc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Lc=function(e){function t(t){var r=e.call(this,t)||this;return r.id="HotLinkLogger",r.l},t.prototypedomain=this.l},t.prototypeis._params.ups_client_netip=this._playlistData.ups.ups_client_netip),this._playlistData.video&&(this._params.vid=this._playlistData.video.id,this._params.title=this._playlistData.video.title),this._playlistData.user&&(this._playlistData.user.ytid?this._params.uid=this._playlistData.user.ytid:this._params.uid=this._playlistData.user.uid,this._params.vip=this._playlistData.user.vip?"1":"0"))},t}(vc),Oc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),xc=function(e){function t(t){var r=e.call(this,t)||this;return r.id="ScountLogger",r.reset(),r}renError=function(e){if(this.enabled&&e.code&&e.fatal){var t=e.code;e.originCode&&(t+="-"+e.originCode),e.originMessage&&(t+="-"+e.originMessage),this._data={alarm_ent_msg:{message:t}},e.errorURL&&(this._params.errorURL=e.errorURL),this.report()}},t.prototype.report=function(){var e=this._params,t=this.context.core.currentTime;this._params.currentTime=t?Math.round(t):0,Object.assign(this._data.client_msg,e),"23605"!==this._data.alarm_coototype.reset=function(){this.enabled=!0,this._params={},this._paramhis.ccode,this._params.vid=this.context.config.vid||"",this._params.vip=0,this._params.alarm_type="YoukuPlayerError",this.resetParams()},t.prototype.resetParams=function(){e.prototype.resetParams.call(this),this._playlistData&&(this._playlistData.video&&(this._params.vid=this._playlistData.video.id),this._playlistData.user&&(this._params.vip=this._playlistData.user.vip),this._playlistData.ups&&(this._params.psid=this._playlistData.ups.psid||""),this._playlistData.show?this._params.showid=this._playlistData.show.id:this._params.showid=0)},t}(vc);!function(e){e.FRONT="frontad",e.END="endad",e.CONTENT="contentad",e.STAND="streviouslyad",e.TAIL="tailad"}(fc||(fc={})),function(e){e.None="AdNotReady",e.Ready="AdPluginReady",e.Init="AdInitialized",e.Abort="AdAbort",e.Freeze="freeze",e.Play="adplay",e.Pause="a"}(mc||(mc={})),function(e){e.abort="abort",e.cutStart="cutStartplay",e.cutEnd="cutStartend",e.indexChange="indexChange"}(yc||(yc={})),function(e){e.onAdReady="onAdReady",e.abort="adAbort",e.onAdPlay="onadplay",e.onAdEnd="onadend",e.onCutAdPlay="oncutadplay",e.onCutAdEnd="oncutadend",e.onAdIndexChange="onAdIndexChange",e.onFullScreen="onAdFullScreen",e.onWakeUpLoading="onAdWakeUpLoading",e.enableProgress="onAdEnableProgress",e.onYoukuTips="onYoukuTips",e.onRequestError="onRequestError"}(gc||(gc={}));var Pc=function(){function e(e){this.context=e,this.contetions(),this.addEvent(),this.addAdEvent()}return e.prototype.addEvent=function(){var e=this;this.context.core.on(L.PlayerEvent.LOADED_MEDIA_RESOURCE,this.onServiceComplete.bind(this)),this.context.eventBus.on(Bc.PlayVideo,this.reset.bind(this)),this.context.core.on(L.PlayerEvent.ERROR,this.onError.bind(this)),this.context.core.on(ls.STREAM_SWITCHED,this.onBeforeSourceChange.bind(this)),this.context.core.on(L.PlayerEvent.ENDED,this.onEnd.bind(this)),this.context.core.on(L.PlayerEvent.TIME_UPDATE,this.onTimeUpdate.bind(this)),this.context.core.on(L.PlayerEvrototype.addAdEvent=function(){var e=this;this.context.core.on(ls.AD_START,(functin(t){t.type===fc.FRONT&&e.onAdEnd(t)}))},e.prototype.replace=function(){this.env!==this.context.config.envis._loggers.forEach((function(e){"function"==typeof e.reset&&e.reset()}))},e.prototype.onTimeUpdate=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isFirst&&(this.isFirst=!1,this._loggers.forEach((function(t){"function"==typeof t.onPlayerRealStart&&t.onPlayerRealStart.apply(t,e)}))),this._loggers.forEach((function(t){"function"==typeof t.onTimeUpdate&&t.onTimeUpdate.apply(t,e)}))},e.prototype.addFunctions=function(){var e=this;["onServiceComplete","onError","onAdPlay","onAdEnd","onPause","onReplay","onWaiting","onEnd","onBeforeSourceChange","onPlaying"].forEach((function(t){e[t]=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];e._loggers.forEach((function(e){"function"==typeof e[t]&&e[t].apply(e,r)}))}}))},e.prototype._initialize=function(){this._loggers=new Map;var e=this.context;this.put(new Sc(e)),this.put(new Tc(e)),this.put(new xc(e)),this.put(new Lc(e))},e.prototype.destroy=function(){this._loggers.forEach((function(e){e.destroy()})),this._loggers.clear()},e}(),Dc={MRG32k3a:function(){var e=this;return function(t){var r=4294967087,i=4294944443,n=12345,o=12345,a=123,s=12345,u=12345,c=123;0===t.length&&(t=[+new Date]);for(var l=e.Mash(),p=0;p<t.length;p++)n+=4294967296*l(t[p]),o+=4294967296*l(t[p]),a+=4294967296*l(t[p]),s+=4294967296*l(t[p]),u+=4294967296*l(t[p]),c+=4294967296*l(t[p]);n%=r,o%=r,a%=r,s%=i,u%=i,c%=i,l=null;var d=function(){var e,t,r=4294967087,i=4294944443;return e=1403580*o-810728*n,(e-=(e/r|0)*r)<0&&(e+=r),n=o,o=a,a=e,t=527612*c-1370589*s,(t-=(t/i|0)*i)<0&&(t+=i),s=u,u=c,c=t,e<=t?e-t+r:e-t},h=function(){return 2.3283064365386963e-10*d()};return h.uint32=d,h.fract53=function(){return h()+11102230246251565e-32*(2097151&d())},h.version="MRG32k3a 0.9",h.args=t,h}(Array.prototype.slice.call(arguments))},rand:function(e,t){t=void 0===t?"":t;var r=this.MRG32k3a(e||0,location.href,Date.now());return t+(+new Date).toString(32)+Math.round(1e5*r()).toString(32)},randomString:function(e){var t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");e=e||3,e=isNaN(e)?3:e;for(var r=t.length,i="";e>=0;)i+=t[Math.floor(Math.random()*r)],e--;return i},Mash:function(){var e=4022871197,t=function(t){t=t.toString();for(var r=0;r<t.length;r++){var i=.02519603282416938*(e+=t.charCodeAt(r));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t},S:function(e){function t(e,t){return e<<t|e>>>32-t}function r(e){var t,r="";for(t=7;t>=0;t--)r+=(e>>>4*t&15).toString(16);return r}var i,n,o,a,s,u,c,l,p,d=new Array(80),h=1732584193,f=4023233417,m=2562383102,y=271733878,g=3285377520,v=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t+=String..fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}(e)).length,b=[];for(n=0;n<v-3;n+=4)o=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(o);switch(v%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(v-1)<<24|8388608;break;case 2:n=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:n=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(v>>>29),b.push(v<<3&4294967295),i=0;i<b.length;i+=16){for(n=0;n<16;n++)d[n]=b[i+n];for(n=16;n<=79;n++)d[n]=t(d[n-3]^d[n-8]^d[n-14]^d[n-16],1);for(a=h,s=f,u=m,c=y,l=g,n=0;n<=19;n++)p=t(a,5)+(s&u|~s&c)+l+d[n]+1518500249&4294967295,l=c,c=u,u=t(s,30),s=a,a=p;for(n=20;n<=39;n++)p=t(a,5)+(s^u^c)+l+d[n]+1859775393&4294967295,l=c,c=u,u=t(s,30),s=a,a=p;for(n=40;n<=59;n++)p=t(a,5)+(s&u|s&c|u&c)+l+d[n]+2400959708&4294967295,l=c,c=u,u=t(s,30),s=a,a=p;for(n=60;n<=79;n++)p=t(a,5)+(s^u^c)+l+d[n]+3395469782&4294967295,l=c,c=u,u=t(s,30),s=a,a=p;h=h+a&4294967295,f=f+s&4294967295,m=m+u&4294967295,y=y+c&4294967295,g=g+l&4294967295}return(p=r(h)+r(f)+r(m)+r(y)+r(g)).toLowerCase()}},kc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Ic=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i};var Mc,Cc=function(e){function t(t){var r=e.call(this)||this;return r.isError=!1,r.enabled=!0,r.onPlay=function(){r.state!==mc.Ready&&r.state!==mc.Nne,r.context=t,r.enabled=!1,r.supported=[],r.initContainer(),r}return kc(t,e),t.prototype.setSupported=function(e){this.supported=e},t.prototype.start=function(){var e,t;return this.promise=(e={},(t=new Promise((function(t,r){e.resolve=t,e.reject=r}))).defer=e,t),window.adPlayerSDK||window.ykSDK?this.adPluginLoaded():this.loadAdResource(),this.promise},t.prototype.initContainer=function(){this.container=document.createElement("div"),this.container.className="advertise-layer",this.context.container.insertAdjacentElement("beforeend",this.container)},t.prototype.getInitConfig=function(){var e={};return e.version=this.context.version,e.quality="540p",e.ccode=this.context..context.config.autoplay,e},t.prototype.loadAdResource=function(){var e=this,t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","//g.alicdn.com/xmedia/yksdk/0.0.7/playersdk.js"),t.onload=function(){e.adPluginLoaded()},t.onerror=function(){e.promise.defer.resolve(!1)},document.getElementsByTagName("head")[0].appendChild(t)},t.prototype.adPluginLoaded=function(){var e=window.adPlayerSDK||window.ykSDK;if(e){this.enabled=!0,this.state=mc.Ready;var t=this.getInitConfig();this.ad=new e(t),this.promise.defer.resolve(!0)}else this.promise.defer.rection(){var e=this;this.context.core.on(L.PlayerEvent.TIME_UPDATE,this.onTimeUpdate.bind(this)),this.context.core.on(L.PlayerEvent.ERROR,this.onError.bind(this)),this.context.core.on(L.PlayerEvent.ENDED,(function(){if(e.context.originResource.trial&&e.context.originResource.trial.time>0)e.adFreeze({type:fc.END}),e.adThaw({type:fc.END});else{if(!e.enabled||-1===e.supported.indexOf(fc.END))return e.adFreeze({type:fc.END}),void e.adThaw({type:fc.END});e.invoke("behindStart",{continuePlay:!1,isSkip:!1})}})),this.context.core.on(L.PlayerEvent.PAUSE,(function(){e.state!==mc.Ready&&e.state!==mc.None&&e.supported.indexOf(fc.PAUSE)>-1&&e.invoke("pause")})),this.context.core.on(L.PlayerEvent.VOLUME_CHANGE,(function(t){e.invoke("volumechange",{volume:e.context.core.volume,muted:e.context.core.muted})})),this.context.core.on(L.PlayerEvent.PLAYING,this.onPlay),this.context.core.on(L.PlayerEvent.PLAY,this.onPlay),this.context.core.on(L.PlayerEvent.SEEKED,(function(t){e.state!==mc.Ready&&e.state!==mc.None&&e.invoke("seeked",t)})),this.context.core.on(L.PlayerEvent.SEEKING,(function(t){e.state!==mc.Ready&&e.state!==mc.None&&e.invoke("seeking",t)}))},t.prototype.onError=function(e){e.fatal&&(this.isError=!0,this.invoke("error"))},t.prototype.onTimeUpdate=function(e){this.state!==mc.Ready&&this.state!==mc.None&&this.invoke("timeUpdate",e)},t.prototype.onCUTAdPlay=function(e){this.state=mc.CUTPlay,this.emit(ps.START,e)},t.prototype.onCUTAdEnd=function(e){this.state=mc.END,this.emit(ps.END,e)},t.prototype.onAdAbort=function(e){this.state=mc.Abort,this.emit(ps.ABORT)},t.prototype.onAdChangeIndex=function(e){this.emit(ps.CHANGE,e)},t.prototype.load=function(e){if(!e)return Promise.resolve(null);var t=this.context.originResource;if(!this.enabled||!t.ad||!t.ad.VAL||0===t.ad.VAL.length)return this.adFreeze({type:fc.FRONT}),this.adThaw({type:fc.FRONT}),Promise.resolve(null);var r={player:this,container:this.container,upsData:t,fullscreen:!1};return this.state=mc.Init,this.invoke("init",r),Promise.resolve(t.ad)},t.prototype.stop=function(){},t.prototype.play=function(){return!(!this.enabled||this.state!==mc.Freeze)&&(this.state=mc.Play,this.invoke("thaw"),!0)},t.prototype.pause=function(){return!(!this.enabled||this.state!==mc.Play)&&(this.state=mc.Freeze,this.invoke("freeze"),!0)},t.prototype.reset=function(){this.isError=!1},t.prototype.invoke=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];if(this.enabled)return(t=this.ad).invoke.apply(t,Ic([e],r))},t.prototype.getAdParams=function(){var e={};return this.supported.indexOf(fc.FRONT)>-1&&((e=this.invoke("getRequestParam")||{}).vs&&(e.avs=e.vs),this.context.config.isElectron&&window.ElectronDevice&&(e.osv=window.ElectronDevice.osVersion&&window.ElectronDevice.osVersion.data,e.mdl=window.ElectronDevice.deviceType)),e},t.prototype.destroy=function(){this.enabled&&(this.ad.destroy(),this.state=mc.Destroy)},t.prototype.getPlayerConfig=function(){return{quality:"540p"}},t.prototype.wakeUpLoading=function(e,t){},t.prototype.adThaw=function(e){this.state!==mc.Play&&this.adFreeze({type:e.type}),this.state=mc.END,this.isError||this.emit(ps.END,e)},t.prototype.adFreeze=function(e){this.state=mc.Play,this.isErrorART,e)},t.prototype.fullScreen=function(){},t.prototype.exitFullscreen=function(){},t.prototype.enableProgress=function(){},t.prototype.disableProgress=function(){},t.prototype.adMessage=function(e,t){switch(e){case yc.abort:this.onAdAbort(c.cutEnd:this.onCUTAdEnd(t);break;case yc.indexChange:this.onAdChangeIndex(t)}},t}(o.b),Nc=function(){function e(){}return e.compareVersion=function(e,t){e=String(e).split("."),t=String(t).split(".");try{for(var r=0,i=Math.max(e.length,t.length);r<i;r++){var n=isFinite(e[r])&&Number(e[r])||0,o=isFinite(t[r])&&Number(t[r])||0;if(n<o)return-1;if(n>o)return 1}}catch(e){return-1}return 0},e}();!function(e){e[e.kSetdatasource=0]="kSetdatasource",e[e.kPrepare=1]="kPrepare",e[e.kStart=2]="kStart",e[e.kPause=3]="kPause",e[e.kOnPrepared=4]="kOnPrepared",e[e.kOnSeekComplete=6]="kOnSeekComplete",e[e.kOnCompletion=7]="kOnCompletion",e[e.kOnBufferLoadingStart=10]="kOnBufferLoadingStart",e[e.kOnBufferLoadingEnd=11]="kOnBufferLoadingEnd",e[e.kSeek=12]="kSeek"}(Mc||(Mc={}));var Uc,Bc,Fc=function(){function e(e){var t=this;this.onCoreEvent=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];if("commonApi"===e&&r[0]&&"OpenSource_DoAction_Result"===r[0]){if(t.timer&&clearTimeout(t.timer),t.streamResult&&r[1]){t.core.debugger&&console.log(t.core.playerSid,"----\x3e OpenSource_DoAction_Result",r[1]);var n=r[1].split(";");if(n[0]&&n[1]){var o=JSON.parse(n[0]);t.core.debugger&&console.log(1111,t.streamResult.originURL,o.url,n[1]),t.streamResult.originURL===o.url&&(t.streamResult.proxyURL=n[1],t.core.xcdn=!0)}}t.streamResult&&t._deferred&&t._deferred.resolve(t.streamResult.proxyURL||t.streamResult.url)}},this.onError=function(){t.streamResult&&t.streamResult.proxyURL&&(t.error=!0,t.streamResult=null)},this.onBeforeSourceChange=function(){t.enabled&&(t.streamResult&&t.streamResult.proxyURL&&(t.core.debugger&&console.log(2222,"multiOsDoAction remove source",t.streamResult.proxyURL),window.ikuApi.nPlayerFunc("multiOsDoAction",1,t.streamResult.proxyURL)),t.streamResult=null)},this.onSourceChange=function(){t.enabled&&(t.isFirstPlaying=!1,t.state=Mc.kSetdatasource,t.updatePlayerState())},this.onPause=function(){t.enabled&&(t.isPause=!0,t.state=Mc.kPause,t.updatePlayerState())},this.onSeeking=function(){t.enabled&&t.isFirstPlaying&&(t.state=Mc.kSeek,t.updatePlayerState())},this.onSeeked=function(){t.enabled&&t.isFirstPlaying&&(t.state=Mc.kOnSeekComplete,t.updatePlayerState())},this.onPlay=function(){},this.onWaiting=function(){t.enabled&&t.isFirstPlaying&&(t.isWaiting=!0,t.state=Mc.kOnBufferLoadingStart,t.updatePlayerState())},this.onPlaying=function(){t.enabled&&(t.isWaiting&&(t.isWaiting=!1,t.state=Mc.kOnBufferLoadingEnd,t.updatePlayerState()),t.isFirstPlaying&&!t.isPause||(t.isFirstPlaying=!0,t.isPause=!1,t.state=Mc.kStart,t.updatePlayerState()))},this.onEnd=function(){t.enabled&&(t.state=Mc.kOnCompletion,t.updatePlayerState())},this.onCanPlay=function(){t.enabled&&(t.isFirstPlaying||(t.state=Mc.kOnPrepared,t.updatePlayerState()))},this.doFilter=function(e){t.timer&&clearTimeout(t.timer),t.core.xcdn=!1;if(t.enabled&&!t.error){t._deferred={},t._promise=new Promise((function(e,r){t._deferred.resolve=e,t._deferred.reject=r})),t.timer=window.setTimeout((function(){t.timer&&clearTimeout(t.timer),t.core.debugger&&console.log("----\x3e multiOsDoAction timeout",JSON.stringify(r)),t._deferred&&t._deferred.resolve(t.streamResult&&t.streamResult.url)}),3e3);var r={url:e.uri.HLSCONTENT||e.uri.HLS,isLive:0,force_xcdn:"1"};return window.ikuApi&&window.ikuApi.nPlayerFunc("multiOsDoAction",0,JSON.stringify(r)),t.core.debugger&&console.log("----\x3e multiOsDoAction","addSource",JSON.stringify(r)),t.streamResult={originURL:r.url,url:e.uri.HLS},t._promise}return{}},this.core=e}return e.prototype.addEvent=function(){this.core.on(L.PlayerEvent.PAUSE,this.onPause),this.core.on(L.PlayerEvent.SEEKING,this.onSeeking),this.core.on(L.PlayerEvent.SEEKED,this.onSeeked),this.core.on(L.PlayerEvent.PLAYING,this.onPlaying),this.core.on(L.PlayerEvent.PLAY,this.onPlay),this.core.on(L.PlayerEvent.WAITING,this.onWaiting),this.core.on(L.PlayerEvent.ENDED,this.onEnd),this.core.on(L.PlayerEvent.CANPLAY,this.onCanPlay),this.core.on(L.PlayerEvent.ERROR,this.onError),this.core.on(ls.STREAM_SWITCHED,this.onSourceChange),this.core.on(ls.STREAM_SWITCHING,this.onBeforeSourceChange),window.ikuApi&&(this.core.debugger&&console.log(this.core.playerSid,window.ikuApi.removeEventListener),window.ikuApi.removeEventListener&&"function"==typeof window.ikuApi.removeEventListener&&this.playerEvent&&(window.ikuApi.removeEventListener("player-events",this.playerEvent),this.playerEvent=null),this.core.debugger&&console.log(this.core.playerSid,"add player-events"),this.playerEvent=window.ikuApi.addEventListener("player-events",this.onCoreEvent))},e.prototype.updatePlayerState=function(){this.streamResult&&this.streamResult.proxyURL&&(this.core.debugger&&console.log("---\x3e osUpdatePlayerStatus",this.state,this.streamResult.proxyURL),window.ikuApi.nPlayerFunc("osUpdatePlayerStatus",this.state,this.streamResult.proxyURL,""))},e.prototype.removeEvent=function(){this.core.off(L.PlayerEvent.PAUSE,this.onPause),this.core.off(L.PlayerEvent.SEEKING,this.onSeeking),this.core.off(L.PlayerEvent.SEEKED,this.onSeeked),this.core.oe.off(L.PlayerEvent.PLAY,this.onPlay),this.core.off(L.PlayerEvent.WAITING,this.onWaiting),this.core.off(L.PlayerEvent.ENDED,this.onEnd),this.core.off(L.PlayerEvent.CANPLAY,this.onCanPlay),this.core.off(L.PlayerEvent.ERROR,this.onError),this.core.off(ls.STREAM_SWITCHED,this.onSourceChange),this.core.off(ls.STREAM_SWITCHING,this.onBeforeSourceChange),window.ikuApi&&window.ikuApi.removeEventListener&&"function"==typeof window.ikuApi.removeEventListener&&this.playerEvent&&(this.core.debugger&&console.log(this.core.playerSid,"remove player-events"),window.ikuApi.removeEventListener("player-events",this.playerEvent),this.playerEvent=null)},e.prototype.reset=function(){if(this.isWaiting=!1,this.isPause=!1,this.isFirstPlaying=!1,this.error=!1,window.ikuApi){var e=void 0;if(navigator.userAgent.indexOf("BUILDVER")>-1){var t=navigator.userAgent.match(/(BUILDVER) ([\d.]+)/i);e=t&&t[2]||""}e&&Nc.compareVersion(e,"9.2.15.1002")>0&&(this.enabled=!0)}this.enabled&&this.addEvent()},e.prototype.stop=function(){this.removeEvent(),this.streamResult&&this.streamResult.proxyURL&&(this.core.debugger&&console.log(this.core.playerSid,"multiOsDoAction remove source",this.streamResult.proxyURL),this.enabled&&window.ikuApi.nPlayerFunc("multiOsDoAction",1,this.streamResult.proxyURL)),this.enabled=!1,this._deferred=null,this._promise=null,this.core.xcdn=!1,this.streamResult=null},e.prototype.destroy=function(){this.stop()},e}();!function(e){e.Init="init",e.Ready="ready",e.Loading="loading",e.Playing="playing"}(Uc||(Uc={})),function(e){e.PlayVideo="Player.Play.Video"}(Bc||(Bc={}));var jc={playAbility:16782592,preferClarity:3,reload:1},Gc=function(){function e(e){var t=this;if(this.version="9.0.9",this.debugger=location.href.indexOf("preview_debug")>-1,this.xcdn=!1,this.getPcdnConfig=function(e,r){return new Promise((function(e,i){var n;if(navigator.userAgent.indexOf("BUILDVER")>-1){var o=navigator.userAgent.match(/(BUILDVER) ([\d.]+)/i);nr.doFilter(r);"function"==typeof u.then?u.then((function(r){t.xcdn&&(s=!1),a.manifestConfig={forceHttps:s},t.debugger&&console.log("player pcdn source",r),e({config:a,source:r})})).catch((function(r){t.xcdn&&(s=!1),a.manifestConfig={forceHttps:s},e({config:a})})):(t.xcdn&&(s=!1),a.manifestConfig={forceHttps:s},e({config:a}))}else t.xcdn&&(s=!1),a.manifestConfig={forceHttps:s},e({config:a})}))},e.container){this.playerSid=""+(new Date).getTime()+Dc.rand()+Dc.randomString(10),this.debugger&&console.log("init player",this.playerSid),this.state=Uc.Init,this.eventBus=new o.b,this.isWaiting=!1,this.container=e.container,this.debugger&&console.log("init player",this.playerSid,this.container.id),this.config=e,this.ad=new Cc(this),this.ad.setSupported([fc.FRONT]);var r=Object.assign({},e,{container:this.container,ui:!1,adSDK:this.ad});this.config.maxDuration&&(r.core={filters:{segmentFilter:function(e){return e=e.filter((function(e){return e.start<t.config.maxDuration}))}}}),this.core=new bs(r),this.ad.addEvent(),this.sourceFilter=new Fc(this);var i=new nc(this.config);this.collinaService=new ac,Promise.all([i.start(),this.collinaService.start(),this.ad.start()]).then((function(e){t.state=Uc.Ready,t.cna=e[0],t.ckey=e[1],t.isWaiting&&(t.isWaiting=!1,t.core.install(t),t.core.load(t.stream?t.stream:t.config.vid))})).catch((function(e){console.log(e)})),this.logger=new Pc(this)}}return e.prototype.install=function(e,t){this.core=e;var r,i,n=Object.assign({adParams:this.ad.getAdParams(),cna:this.cna,ckey:this.ckey,version:this.version},jc,this.config),o=this.stream?new((i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rc(t,e),t.prototype.main=function(e){var t,r=tc.parse(e.uri.hls).params||{};t=new S({streamList:[{uri:e.uri,duration:r.duration,id:"default",name:"540p",label:"",title:"",langCode:"default",langName:""}],raw:{playlog:{lastpoint:"0"},ups:{psid:r.psid,ups_client_netip:r.ups_client_netip,ups_ts:r.ups_ts},user:{ytid:r.ups_userid},show:{encodeid:r.s},video:{stream_types:{default:[r.r.vid,playTypes:"local"},stream:[{milliseconds_audio:1e3*r.duration,milliseconds_video:1e3*r.duration,encryptR_server:"",encryptR1:"",segs:e.uri.mmp4,stream_ext:{hls_subtitle:"default",copyright_key:"",subtitle_lang:"default",hls_logo:"none"},size:56417008,subtitle_lang:"default",audio_lang:"default",media_type:"standard",drm_type:"default",stream_type:r.type,width:640,logo:"none",height:360,m3u8_url:e.uri.hls}],ad:{VAL:[],P:1,VER:"3.0",SKIP:1,REQID:"210599e6000008ba6017961400000b36"},ykad:{VAL:[],P:7,VER:"3.0",SKIP:1,REQID:"21047282000005b76017961400005f3d"}}}),this.put(t)},t}(r=t)).Name=r.MediaResource,i):function(e,t){var r;return new((r=function(t){function r(r){var i=t.call(this)||this;return i.timeout=[15e3,2e4,2e3,8e3],i.config=r,i.import(e.Features,"features"),i}return Qu(r,t),r.prototype.main=function(e){this.retry=0,this.vid=e,this.request()},r.prototype.request=function(){var e=this;this.config.requestTg.requestType:this.requestType||(this.requestType=zu.MTOP);var t,r,i=this.getUpsParams(this.vid);switch(this.requestType){case zu.MTOP:r=new Ps({prefix:this.config.env||"acs",mainDomain:"youku.com",api:"mtop.youku.play.ups.appinfo.get",timeout:this.timeout[this.retry]}),t=Lu(r,i);break;case zu.JSONP:r=new ws({prefix:"_JSONPCallback",url:this.config.url||"https://ups.youku.com/ups/get.json",timeout:this.timeout[this.retry]}),t=wu(r,i);break;case zu.FETCH:r=new Ls({method:"POST",url:this.config.url||"https://ups.youku.com/ups/get.json",responseType:"json",type:"formdata"}),t=wu(r,i)}return t.then((function(t){e.onComplete(t)}),(function(t){var r=t.info||{};r.code=t.code,e.onError(r)}))},r.prototype.getUpsParams=function(e){var t=this.config,r={enableAutoLevel:!1,staticM3u8:!0,enableSubtitle:!1,vid:e};if(t){var i=Xu(Ju,t);r=Object.assign(r,i)}return r.bizParams={reload:1,preferClarity:t.preferClarity||-1},r},r.prototype.onComplete=function(e){e.error&&e.error.code?this.onFatal(e.error):this.put(e)},r.prototype.onError=function(e){e&&e.code&&-1===["-1","-2","-3"].indexOf(e.code)||this.retry>=3?this.onFatal(e):(this.retry++,this.requestType===zu.MTOP&&this.retry>1&&(this.requestType=zu.JSONP),this.request())},r.prototype.onFatal=function(e){if(this.errorCount=3,"-1"==e.code)this.error(Zu.of(Ku.REQUEST_ERROR,U.Severity.FATAL));else if("-2"==e.code)this.error(Zu.of(Ku.REQUEST_TIMEOUT,U.Severity.FATAL));else{var t=ec.of(Yu.BIZ_ERROR,U.Severity.FATAL,e.message);t.status=e.code,this.error(t)}},r}(e)).Name=e.MediaResource,r)(t)}(t,n);e.service.replace(o);var a=function(e,t){var r;return new((r=function(t){function r(r){var i=t.call(this)||this;return iures"),i}return uc(r,t),r.prototype.main=function(){var e=this,t=this.mediaResource.getLanguageList(),r=this.getStreamList(t[0].langCode),i=r[0],n=[];(n=this.config&&this.config.prefer&&this.config.prefer.quality?r.filter((function(t){return t.name===e.config.prefer.quality})):r.filter((function(e){return"540p"===e.name}))).length>0&&(i=n[0]);var o=this.config.vid;if(this.mediaResource.raw){var a=this.mediaResource.raw,s=a.video&&a.video.playTypes;s&&"local"===s||sc.set(o,{time:Date.now(),uri:i.uri},"YK_PREVIEW_STREAM")}this.put(i)},r.prototype.getStream=function(e,t){return this.mediaResource?this.mediaResource.getStream(e,t):null},r.prototype.getStreamList=function(e){if(this.mediaResource){"undefined"==e&&(e=void 0);var t=RegExp(this.features.supportCodecs.map((function(e){return cc[e]})).join("|")),r=this.features.isSupportCodec(Ir.HEVC)?/h265/:/h264/;return this.mediaResource.getStreamListBy(e,t).groupBy("name",["type",r]).List()}return[]},r}(e)).Name=e.StreamSelect,r)(t)}(t,this.config);e.service.replace(a);var s=function(e,t){var r;return new((r=function(t){function r(r){var i=t.call(this)||this;return i.import(e.MediaResource,"mediaResource"),i}return Es(r,t),r.prototype.main=function(){this.put([0,null])},r.prototype.setPlayPosition=function(e){},r}(e)).Name=e.StartPoint,r)(t)}(t,this.config);return e.service.replace(s),{mediaFilter:this.getPcdnConfig,adSDK:void 0}},e.prototype.load=function(e){var t=this;if(e){this.debugger&&console.log("player load",this.container.id,e),this.sourceFilter&&this.sourceFilter.stop(),this.sourceFilter&&this.sourceFilter.reset(),this.config.vid=e,this.stream=null;var r=sc.getObject("YK_PREVIEW_STREAM");if(r&&r[this.config.vid]){var i=r[this.config.vid];i.time&&i.uri&&Date.now()-i.time<18e6&&(this.stream=i)}this.state===Uc.Ready?this.collinaService.start().then((function(r){t.ckey=r,t.core.install(t),t.core.load(t.stream?t.stream:e)})):this.isWaiting=!0,this.eventBus.emit(Bc.PlayVideo,{vid:e})}},e.prototype.play=function(){this.debugger&&console.log("player play",this.container.id),this.core.play()},e.prototype.pause=function(){this.debugger&&console.log("player pause",this.container.id),this.core.pause()},e.prototype.seek=function(e){this.debugger&&console.log("player time",this.container.id),this.core.seek(e)},e.prototype.stop=function(){this.debugger&&console.log("player stop",this.container.id),this.core.stop(),this.sourceFilter&&this.sourceFilter.stop()},Object.defineProperty(e.prototype,"muted",{get:function(){return this.core.muted},set:function(e){this.debugger&&console.log("player set muted",this.container.id,e),this.core.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originResource",{get:function(){if(this.core.MediaResource&&this.core.MediaResource.raw)return this.core.MediaResource.raw},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentStream",{get:function(){return this.core.service&&this.core.service.take("streamSelect")},enumerable:!1,configurable:!0}),e.prototype.getLoader=function(){if(this.core)return this.core.getLoader()},e.prototype.on=function(e,t){return this.core.on(e,t),this},e.prototype.once=function(e,t){return this.core.once(e,t),this},e.prototype.off=function(e,t){return this.core.off(e,t),this},e.prototype.destroy=function(){this.off(),this.core.destroy(),this.ad.destroy(),this.sourceFilter&&this.sourceFilter.destroy()},e.PlayerEvent=n.a,e}();t.default=Gc;window.IndexPlayer=Gc}]);