!);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"redpop@b474a6ad4354f4ba5fde672fa4e9c2c267684761"};"use strict";(self.webpackChunk_tumblr_redpop=self.webpackChunk_tumblr_redpop||[]).push([[7203],{44238:(e,t,n)=>{n.d(t,{Z:()=>p});var i=n(50209),s=n.n(i),o=n(5754),a=n.n(o),r=n(95004),l=n(60612),c=n(61792),h=n(78093),d=n(2629);class u extends r.Component{constructor(){super(...arguments),s()(this,"transitionNodeRef",(0,r.createRef)()),s()(this,"prevCount",0),s()(this,"renderContentFromTransitionStatus",e=>{var t=this.props,n=t.count,i=t.showNumber,s=t.isCircle,o=t.className,r=t.style,h=this.prevCount>n&&0===n,u=[l.d0,l.cn,l.Ix].includes(e),p=h&&u?this.prevCount:n;return(0,d.jsx)("div",{ref:this.transitionNodeRef,className:a()("jpu7k",o,{D0OOd:[l.d0,l.cn].includes(e),e2EeC:s,XnKJk:!s}),style:r,role:"status",children:i&&(0,c.Z)(p,99)})})}componentDidUpdate(e){this.prevCount=(null==e?void 0:e.count)||0}render(){var e=this.props.count;return(0,d.jsx)(l.ZP,{nodeRef:this.transitionNodeRef,in:e>0,timeout:h.notificationBadgeTransitionDurationMs,children:this.renderContentFromTransitionStatus})}}s()(u,"defaultProps",{count:0,showNumber:!0});let p=u},29824:(e,t,n)=>{n.d(t,{Z:()=>d});var i=n(54138),s=n.n(i),o=n(88203),a=n.n(o),r=n(63415),l=n(70505),c=(e,t)=>(0,l.sW)(null==e?void 0:e.backgroundColor,null==e?void 0:e.linkColor,!!t&&(null==e?void 0:e.showHeaderImage)),h=e=>a()(c(e)).alpha(.1).string();let d={getThemedButtonColor:(e,t)=>{var n=(0,r.II)(t.white);return e&&(0,l.hY)(n,e)?e:(0,r.II)(t.black)},getFullyThemedButtonColor:e=>{var t=e.linkColor,n=e.backgroundColor;return(0,l.hY)(n,t)?t:(0,l.ps)(n)},parseConversationInfoFromResponse:(e,t)=>{var n=e.response,i=n.participants[0],s=n.participants[1];return n.participants.map(e=>{e.name===t?i=e:s=e}),{selectedBlog:i,otherParticipant:s,conversation:n,token:n.token}},conversationWindowDividerHeightPx:1,getConversationWindowThemeTextColor:c,getConversationWindowThemedBorderCssString:(e,t)=>`solid 1px ${h(s()(s()({},e),{},{showHeaderImage:!!t&&e.showHeaderImage}))}`}},11780:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var i=n(54138),s=n.n(i),o=n(17276),a=n.n(o),r=n(50209),l=n.n(r),c=n(5754),h=n.n(c),d=n(95004),u=n(45222),p=n(44009),g=n(44238),v=n(29824),m=n(37236),f=n(85795),C=n(1308),b=n(59215),I=n(54967),w=n(73125),S=n(50869),A=n(86033),y=n(45051),E=n(78093),W=n(96467),N=n(20318),x=n(2629);class F extends d.Component{constructor(){var e;super(...arguments),e=this,l()(this,"state",{isOnline:!1,shouldWiggle:!1}),l()(this,"apiHelper",(0,f.ZP)(this.props.appContext.apiFetch)),l()(this,"unsetWiggleAnimationTimeout",null),l()(this,"channel",null),l()(this,"userInfoFetch",null),l()(this,"blogInfoFetch",null),l()(this,"conversationFetch",null),l()(this,"getConversationResponseAndInitializeTelegraph",()=>{var e;return null===(e=this.conversationFetch)||void 0===e||e.cancel(),this.conversationFetch=(0,A.Z)(this.apiHelper.getConversation(this.props.conversationWindowObject,{after:new Date().getTime().toString()}).fetch()),this.conversationFetch.then(e=>{var t=this.props.conversationWindowObject.selectedBlogName;if(e.response){var n=v.Z.parseConversationInfoFromResponse(e,t);this.setState({token:n.token},this.initializeTelegraph)}}).catch(y.Z)}),l()(this,"initializeTelegraph",function(){var t,n,i,s,o,r,l;return a()().async(function(c){for(;;)switch(c.prev=c.next){case 0:if(t=e.state.token,i=(n=e.props).messagingContext.getPusherConnection,o=(s=n.conversationWindowObject).conversationId,r=s.selectedBlogName,!(t&&r&&!e.channel)){c.next=8;break}return c.next=5,a()().awrap(i(t));case 5:l=c.sent,e.channel=l.subscribe(`private-messaging-${o}-${(0,w.Z)(r)}`),e.channel.bind("message:new",e.onChannelNewMessage);case 8:case"end":return c.stop()}},null,null,null,Promise)}),l()(this,"onChannelNewMessage",()=>{var e,t=this.props,n=t.appContext.getUserInfo,i=t.messagingContext.incrementMinimizedMessageCount,s=t.conversationWindowObject.conversationId,o=this.state.blogMentionKey;s&&o&&(null===(e=this.userInfoFetch)||void 0===e||e.cancel(),this.userInfoFetch=(0,A.Z)(n()),this.userInfoFetch.then(e=>{N.ZP.play(e,N.gO.MESSAGE_RECEIVED),i(s.toString(),o)}))}),l()(this,"onClick",()=>{var e=this.props,t=e.conversationWindowObject;(0,e.messagingContext.openConversationWindow)(t)}),l()(this,"getNotificationCount",function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props,i=n.conversationWindowObject.conversationId,s=n.messagingContext.unreadMessages.unreadMessagesByBlogAndConversationId,o=e.state.blogMentionKey;return o&&i&&(null==s||null===(t=s[o])||void 0===t?void 0:t[i])||0}),l()(this,"getBlogMentionKey",()=>{var e,t=this.props,n=t.conversationWindowObject.selectedBlogName,i=t.appContext.getUserInfo;return null===(e=this.userInfoFetch)||void 0===e||e.cancel(),this.userInfoFetch=(0,A.Z)(i()),this.userInfoFetch.then(e=>this.setState({blogMentionKey:(0,I.Z)(e,n)}))}),l()(this,"getAdditionalOtherParticipantInfo",()=>{var e,t=this.props,n=t.conversationWindowObject,i=t.messagingContext.onMinimizedConversationLoaded,o=n.avatar,a=n.otherParticipantName,r=["secondsSinceLastActivity"];return o||r.push("avatar"),null===(e=this.blogInfoFetch)||void 0===e||e.cancel(),this.blogInfoFetch=(0,A.Z)(this.apiHelper.getBlogInfo(a,(0,C.n9)(r)).fetch()),this.blogInfoFetch.then(e=>{var t=e.response.blog,o=t.secondsSinceLastActivity,a=t.avatar;a&&i(s()(s()({},n),{},{avatar:a})),this.setState({isOnline:(0,S.k)(o)})})}),l()(this,"setShouldWiggleAndUnsetTimeout",()=>{this.unsetWiggleAnimationTimeout&&(clearTimeout(this.unsetWiggleAnimationTimeout),this.unsetWiggleAnimationTimeout=null),this.setState({shouldWiggle:!0},()=>{this.unsetWiggleAnimationTimeout=setTimeout(E.minimizedConversationWiggleDurationMs)})}),l()(this,"cancelFetchesIfNecessary",()=>{var e,t,n;null===(e=this.userInfoFetch)||void 0===e||e.cancel(),null===(t=this.blogInfoFetch)||void 0===t||t.cancel(),null===(n=this.conversationFetch)||void 0===n||n.cancel()})}componentDidMount(){Promise.all([this.getBlogMentionKey(),this.getAdditionalOtherParticipantInfo(),this.getConversationResponseAndInitializeTelegraph()]).then(.catch(y.Z)}componentDidUpdate(e){var t=this.state.shouldWiggle,n=e&&e.messagingContext&&e.conversationWindowObject&&this.getNotificationCount(e)||0;this.getNotificationCount()>n&&(t?this.setState({shouldWiggle:!1},this.setShouldWiggleAndUnsetTimeout):this.setShouldWiggleAndUnsetTimeout())}componentWillUnmountender(){var e=this.props,t=e.conversationWindowObject,n=t.avatar,i=t.otherParticipantName,s=e.appContext._c,o=this.state,a=o.isOnline,r=o.shouldWiggle;return(0,x.jsxs)(p.Z,{wrapperClassName:h()("_EEXO",{FzZA0:r}),label:s("Label for conversation where %1$s is the other participant's name","Conversation with %1$s",[i]),onClick:this.onClick,title:i,children:[(0,x.jsx)(u.Z,{avatarShape:m.o.Circle,imageResponse:n,isOnline:a,dimension:W.minimizedConversationSizePx,wrapperClassName:"_QSie",statusIndicatorWrapperClassName:"yiffz"}),(0,x.jsx)("div",{className:"VsyKw",children:(0,x.jsx)(g.Z,{count:this.getNotificationCount()})})]})}}let T=(0,b.X9)(F,{appContext:!0,pollerContext:!0,messagingContext:!0})},20318:(e,t,n)=>{n.d(t,{ZP:()=>h,gO:);var i=n(17276),s=n.n(i),o=n(50209),a=n.n(o),r=n(45051),l=l||{});function c(e){return new Audio(new URL(e,"https://assets.tumblr.com/sounds/notifications/messaging/").toString())}let h=new class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;a()(this,"cachedAudioElements",{}),this.fetch=e}play(e,t){var n,i=this;return s()().async(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(e.sounds&&e.sounds.global.web)){s.next=3;break}return n=i.cachedAudioElements[t]||i.fetchAndCacheAudio(t),s.abrupt("return",null==n?void 0:n.play().catch(r.Z));case 3:case"end":return s.stop()}},null,null,null,Promise)}fetchAndCacheAudio(e){return this.cachedAudioElements[e]=this.fetch(e)}}}}]);