/* v:'7.0' - build date : '2021-01-28T14:46:57+0100'*/
!function(t,e){for(var i in e)t[i]=e[i]}(window,function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e),i.d(e,"eStatTag",(function(){return Z}));var n,s,o,r="INFO: Request sent : ",a="INFO: probe mode enabled",h="ERROR: the probe mode is not available for a timeshifting stream",u="WARNING: the maximum number of characters is limited to 256, the sent data will be truncated",c="WARNING: the notifyPlayer() cannot be called with play or pause in an automatic mode",p="ERROR: Invalid for support, you must use\n\nvar confStreamingAnalyticsMediametrie= {\n\tadInfos:{\n\t\tsupport:'banner||blog||email||link||search||social'...\n\t}\n}",l="ERROR: you must pass a JSON object as a parameter to the contructor \n\n1 - you have to create a JSON object \n\nvar mySettings = {\n\tserial:'monSerial',\n\t...,\n\tlevels:{\n\t\tlevel_1:'mon niveau1'\n\t}\n\t... \n}\n\n2 - Instantiate the measure object with your JSON object as parameter\n\n var monTag = new eStatTag(mySettings);",f="ERROR: you must specify the type of measure you want {measure:'streaming|page'}",g="ERROR: you must specify the serial number in which you want to send the measure {serial:XXXXXXX}",m="ERROR: you must specify the position callback",d="ERROR: you must specify the state callback",y="ERROR: you must specify the streaming informations\n\nvar confStreamingAnalyticsMediametrie = {\n\tstreaming:{\n\t\tdatas...\n\t}\n}",v="ERROR: you must specify the diffusion mode\n\nvar confStreamingAnalyticsMediametrie = {\n\tstreaming:{\n\t\tdiffusion:'live||replay||timeShift'...\n\t}\n}",b="ERROR: you must specify a name for your player\n\nvar confStreamingAnalyticsMediametrie= {\n\tstreaming{\n\t\tplayerName:'jwplayer|html5...'\n\t}\n}",w="ERROR: you must specify a name for your stream\n\nvar confStreamingAnalyticsMediametrie= {\n\tstreaming{\n\t\tstreamName:'myStream'\n\t}\n}",S="ERROR: your account is not allowed to send requests to our servers. Please contact our client service to change its rights",P="ERROR: the notifyPlayer() function only accept values play, pause or stop as first parameter",R="Page mode is not supported anymore",O="Origin is not correctly defined",C="ERROR: you must specify the type of measure you want {consentType:'optin|exempted|optout'}",_=new(function(){function t(){this.debugEnabled=!1}return t.prototype.err=function(t){console.error(t)},t.prototype.debug=function(t,e){this.debugEnabled&&(e?console.debug(t,e):console.debug(t))},t.prototype.setDebug=function(t){this.debugEnabled=t},t.prototype.isDebug=function(){return this.debugEnabled},t}());!function(t){t.page="page",t.streaming="streaming"}(n||(n={})),function(t){t.live="live",t.replay="replay",t.timeshifting="timeshifting"}(s||(s={})),function(t){t.optout="optout",t.optin="optin",t.exempted="exempted"}(o||(o={}));var I,N=function(){function t(){this.logger=_,this.schema={serial:{},measure:{},levels:{schema:{level_1:{hitName:"cmsS3"},level_2:{hitName:"cmsS2"},level_3:{hitName:"cmsS1"},level_4:{hitName:"cmsS4"},level_5:{hitName:"cmsS5"}}},streaming:{schema:{diffusion:{},streamName:{hitName:"cmsSN"},streamURL:{hitName:"cmsME"},streamGenre:{hitName:"cmsGR"},streamDuration:{hitName:"cmsDU"},playerName:{hitName:"cmsPL"},playerVersion:{hitName:"cmsPV"},pluginName:{hitName:"pn"},pluginVersion:{hitName:"pv"}}},newLevels:{schema:{newLevel_1:{hitName:"ml1"},newLevel_2:{hitName:"ml2"},newLevel_3:{hitName:"ml3"},newLevel_4:{hitName:"ml4"},newLevel_5:{hitName:"ml5"},newLevel_6:{hitName:"ml6"},newLevel_7:{hitName:"ml7"},newLevel_8:{hitName:"ml8"},newLevel_9:{hitName:"ml9"},newLevel_10:{hitName:"ml10"},newLevel_11:{hitName:"ml11"}}},mediaInfo:{schema:{mediaContentId:{hitName:"msCid"},mediaDiffMode:{hitName:"msDm"},mediaChannel:{hitName:"msCh"}}},netMeasurement:{hitName:"miCh"},firstParty:{hitName:"cfp"},consentType:{hitName:"ct"},consentString:{hitName:"cstr"}}}return t.prototype.validateConfiguration=function(t){var e=!0;return t?(t.hasOwnProperty("serial")&&t.serial||(this.logger.err(g),e=!1),t.hasOwnProperty("consentType")&&t.consentType in o||(this.logger.err(C),e=!1),t.hasOwnProperty("measure")&&t.measure in n||(this.logger.err(f),e=!1),"page"===t.measure&&(this.logger.err(R),e=!1),t.measure===n.streaming&&(t.hasOwnProperty("streaming")&&t.streaming?(t.streaming.hasOwnProperty("diffusion")&&t.streaming.diffusion in s||(this.logger.err(v),e=!1),t.streaming.hasOwnProperty("playerName")&&t.streaming.playerName||(this.logger.err(b),e=!1),t.streaming.hasOwnProperty("streamName")&&t.streaming.streamName||(this.logger.err(w),e=!1),t.streaming.diffusion===s.replay&&(t.streaming.hasOwnProperty("callbackPosition")&&t.streaming.callbackPosition||(this.logger.err(m),e=!1)),t.streaming.diffusion!==s.live||!t.streaming.probe||t.streaming.hasOwnProperty("callbackState")&&t.streaming.callbackState||(this.logger.err(d),e=!1)):(this.logger.err(y),e=!1))):(this.logger.err(l),e=!1),e},t.prototype.buildConfiguration=function(t){var e=this.defaultConfiguration();return this.mergeConfiguration(e,t,!1,!0),e.schema=this.schema,e},t.prototype.defaultConfiguration=function(){var t={firstParty:!1};return t},t.prototype.mergeConfiguration=function(t,e,i,n){for(var s in void 0===n&&(n=!1),e)if(e.hasOwnProperty(s))if(e[s]instanceof Object){for(var o in e[s])if(e[s].hasOwnProperty(o)){if(t[s]||(t[s]={}),i&&"streamName"===o)continue;t[s][o]=e[s][o]}}else(n||"measure"!==s&&"serial"!==s)&&(t[s]=e[s])},t}();!function(t){t[t.PLAY=5]="PLAY",t[t.PAUSE=7]="PAUSE",t[t.STOP=12]="STOP"}(I||(I={}));var L,B=function(){function t(t,e,i,n,s){this.argmap={},this.serial=t.serial,this.contextInfos=e,this.buildParameters(t,t.schema),this.argmap.n=Math.round(1e9*Math.random()),this.argmap.cmsPO=i,this.argmap.cmsPS=n,this.argmap.cmsEV=s,t.streaming&&t.streaming.callbackOffset&&(this.argmap.oft=Math.round(t.streaming.callbackOffset()))}return t.prototype.buildURL=function(){var t=this.contextInfos.getInfos();for(var e in this.argmap)this.argmap.hasOwnProperty(e)&&t.push([e,this.argmap[e]]);t.sort((function(t,e){return t[0].localeCompare(e[0])}));for(var i=this.collectUrl+this.serial,n="",s=0;s<t.length;s++)if("boolean"==typeof t[s][1])!0===t[s][1]&&(n+="&"+t[s][0]+"=1");else{var o=encodeURIComponent(t[s][1]);o.length>256&&_.debug(u),n+="&"+t[s][0]+"="+o.substring(0,256)}return i+(n="?"+n.substring(1))},t.prototype.set=function(t,e){this.argmap[t]=e},t.prototype.setCollectUrl=function(t){this.collectUrl=t},t.prototype.setSessionID=function(t){this.argmap.cmsVI=t},t.prototype.setSessionNumber=function(t){this.argmap.cmsRK=t},t.prototype.setOldPosition=function(t){this.argmap.cmsOP=t},t.prototype.getState=function(){return this.argmap.cmsPS},t.prototype.setState=function(t){this.argmap.cmsPS=t},t.prototype.getPosition=function(){return this.argmap.cmsPO},t.prototype.getLogObject=function(){var t={};return this.argmap.cmsEV===L.POLLING?t.event="polling":(t.event="state",t.eventType=I[this.argmap.cmsPS]),t.position=this.argmap.cmsPO,t.duration=this.argmap.cmsDU,t.casting=this.contextInfos.isCastingEnabled(),t.sessionID=this.argmap.cmsVI,t.rank=this.argmap.cmsRK,t},t.prototype.buildParameters=function(t,e){for(var i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(e[i].hitName?this.argmap[e[i].hitName]=t[i]:e[i].hasOwnProperty("schema")&&this.buildParameters(t[i],e[i].schema))},t}();!function(t){t.POLLING="polling",t.STATE="state"}(L||(L={}));var T,H,E=function(){function t(){this.timeout=[],this.status=I.STOP,this.started=!1}return t.prototype.notify=function(t,e){t!==q.play||this.started?t===q.stop&&this.started&&this.stopPolling():this.startPolling()},t.prototype.setStatus=function(t){this.status=t},t.prototype.configurationChange=function(t){this.info=t},t.prototype.stop=function(){this.stopPolling()},t.prototype.setSessionManager=function(t){this.sessionManager=t},t.prototype.snooze=function(){this.stop()},t.prototype.wakeup=function(){this.status===I.STOP||this.started||this.startPolling()},t.prototype.startPolling=function(){var t=this;this.started=!0,this.timeout[0]=window.setTimeout((function(){t.sendPollingHit()}),1e4),this.timeout[1]=window.setTimeout((function(){t.sendPollingHit()}),2e4),this.timeout[2]=window.setTimeout((function(){t.sendPollingHit()}),4e4),this.timeout[3]=window.setInterval((function(){t.sendPollingHit()}),6e4)},t.prototype.stopPolling=function(){for(var t=0;t<3;t++)window.clearTimeout(this.timeout[t]);window.clearInterval(this.timeout[3]),this.timeout=[],this.started=!1},t.prototype.sendPollingHit=function(){!this.info.streaming.diffusion||"live"!==this.info.streaming.diffusion&&"timeshifting"!==this.info.streaming.diffusion?this.sessionManager.send(this.status,this.info.streaming.callbackPosition(),L.POLLING):this.sessionManager.send(this.status,0,L.POLLING)},t}(),k=function(){function t(){this.status=I.STOP,this.pollingBehavior=new E}return t.prototype.configurationChange=function(t){this.pollingBehavior.configurationChange(t),this.configuration=t},t.prototype.stop=function(){this.pollingBehavior.stop()},t.prototype.setSessionManager=function(t){this.session=t,this.pollingBehavior.setSessionManager(t)},t.prototype.snooze=function(){this.pollingBehavior.snooze()},t.prototype.wakeup=function(){},t}(),M=(T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return M(e,t),e.prototype.notify=function(t,e){switch(this.pollingBehavior.notify(t,e),t){case q.play:if(this.status===I.PLAY)return;this.status=I.PLAY;break;case q.pause:if(this.status===I.PAUSE)return;this.status=I.PAUSE;break;case q.stop:if(this.status===I.STOP)return;this.status=I.STOP}this.pollingBehavior.setStatus(this.status),this.session.send(this.status,0,L.STATE),this.status===I.STOP&&this.session.stopSession()},e.prototype.stop=function(){this.notify(q.stop,0),this.pollingBehavior.stop()},e}(k),D=function(){function t(){this.playing=!1,this.liveBehavior=new U;var t=this;this.probeHandle=window.setInterval((function(){return t.probe()}),1e3)}return t.prototype.setSessionManager=function(t){this.liveBehavior.setSessionManager(t)},t.prototype.notify=function(t,e){t===q.stop?(this.liveBehavior.notify(t,0),this.playing=!1):_.debug(c)},t.prototype.configurationChange=function(t){return this.configuration=t,this.liveBehavior.configurationChange(t),""},t.prototype.stop=function(){this.liveBehavior.stop(),window.clearInterval(this.probeHandle)},t.prototype.snooze=function(){this.liveBehavior.notify(q.stop,0),this.playing=!1,this.liveBehavior.snooze(),window.clearInterval(this.probeHandle)},t.prototype.wakeup=function(){this.liveBehavior.wakeup();var t=this;this.probeHandle=window.setInterval((function(){return t.probe()}),1e3)},t.prototype.probe=function(){if(this.configuration.streaming.callbackState){var t=this.configuration.streaming.callbackState();this.playing&&q.play!==t?(this.playing=!1,this.liveBehavior.notify(q.stop,0)):this.playing||q.play!==t||(this.playing=!0,this.liveBehavior.notify(q.play,0))}},t}(),A=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return A(e,t),e.prototype.notify=function(t,e){switch(this.pollingBehavior.notify(t,e),t){case q.play:if(this.status===I.PLAY)return;this.status=I.PLAY;break;case q.pause:if(this.status===I.PAUSE)return;this.status=I.PAUSE;break;case q.stop:if(this.status===I.STOP)return;this.status=I.STOP}this.pollingBehavior.setStatus(this.status),this.session.send(this.status,e,L.STATE),this.status===I.STOP&&this.session.stopSession()},e.prototype.configurationChange=function(t){this.pollingBehavior.configurationChange(t),this.configuration=t},e.prototype.stop=function(){this.notify(q.stop,this.configuration.streaming.callbackPosition()),this.pollingBehavior.stop()},e.prototype.setSessionManager=function(t){this.session=t,this.pollingBehavior.setSessionManager(t)},e}(k),j=function(){function t(){this.replayBehavior=new x;var t=this;this.playing=!1,this.lastPos=0,this.lastCall=0,this.probeHandle=window.setInterval((function(){return t.probe()}),1e3)}return t.prototype.setSessionManager=function(t){this.sessionManager=t,this.replayBehavior.setSessionManager(t)},t.prototype.notify=function(t,e){t===q.stop?(this.lastPos=e,this.playing=!1,this.replayBehavior.notify(t,e)):_.debug(c)},t.prototype.configurationChange=function(t){this.info=t,this.replayBehavior.configurationChange(t)},t.prototype.stop=function(){window.clearInterval(this.probeHandle),this.replayBehavior.stop()},t.prototype.snooze=function(){this.replayBehavior.notify(q.pause,this.lastPos),this.playing=!1,this.replayBehavior.snooze(),window.clearInterval(this.probeHandle)},t.prototype.wakeup=function(){this.replayBehavior.wakeup();var t=this;this.probeHandle=window.setInterval((function(){return t.probe()}),1e3)},t.prototype.probe=function(){var t=this.lastPos,e=this.lastCall;this.lastPos=this.info.streaming.callbackPosition(),this.lastCall=(new Date).getTime();var i=1,n=0;0!==e&&(n=this.lastPos-t,i=(this.lastCall-e)/1e3),this.playing?n>i+.9||n<0?(this.replayBehavior.notify(q.pause,t),this.replayBehavior.notify(q.play,this.lastPos)):0===n&&(this.replayBehavior.notify(q.pause,this.lastPos),this.playing=!1):n>0&&n<=i+.9&&(this.replayBehavior.notify(q.play,t),this.playing=!0)},t}(),z=function(){function t(){this.liveMode=!0,this.playing=!1,this.liveBehavior=new U,this.replayBehavior=new x}return t.prototype.setSessionManager=function(t){this.liveBehavior.setSessionManager(t),this.replayBehavior.setSessionManager(t)},t.prototype.notify=function(t,e){this.liveMode?t===q.pause?(this.liveMode=!1,this.liveBehavior.notify(q.stop,e)):this.liveBehavior.notify(t,e):(t===q.stop&&(this.liveMode=!0),this.replayBehavior.notify(t,e))},t.prototype.configurationChange=function(t){return this.configuration=t,this.liveBehavior.configurationChange(t),this.replayBehavior.configurationChange(t),""},t.prototype.stop=function(){this.liveBehavior.stop(),this.replayBehavior.stop()},t.prototype.snooze=function(){this.liveBehavior.snooze(),this.replayBehavior.snooze()},t.prototype.wakeup=function(){this.liveBehavior.wakeup(),this.replayBehavior.wakeup()},t}(),V=function(t,e){void 0===e&&(e=null),this.hitname=t,this.value=e};!function(t){t.banner="banner",t.blog="blog",t.email="email",t.link="link",t.search="search",t.social="social"}(H||(H={}));var F,G=function(){function t(t,e,i){void 0===i&&(i=null),this.args={},this.isCasting=!1,this.casting="cs",this.userDomain=i,this.implementation=t,this.consentType=e,this.args.hitFormatVersion=new V("cmsMV","6"),this.args.domain=new V("dom"),this.args.encoding=new V("enc"),this.args.origin=new V("o"),this.args.screenColorDepth=new V("scp"),this.args.screenHeigth=new V("sch"),this.args.screenWidth=new V("scw"),this.args.tagName=new V("tn","TS"),this.args.version=new V("v","7.0.0"),this.args.viewportHeigth=new V("vh"),this.args.viewportWidth=new V("vw"),this.generateParams()}return t.prototype.getInfos=function(){var t=[];for(var e in this.isCasting?t.push([this.casting,"1"]):t.push([this.casting,"0"]),this.args)null!=this.args[e]&&null!==this.args[e].value&&""!==this.args[e].value&&this.args[e]instanceof V&&t.push([this.args[e].hitname,this.args[e].value]);return t},t.prototype.update=function(){return this.args.domain.value=this.getDomain(),this.args.origin.value=this.getOriginIfAllowed(),this.getInfos()},t.prototype.setCast=function(t){this.isCasting=t},t.prototype.isCastingEnabled=function(){return this.isCasting},t.prototype.setImplementation=function(t){this.implementation=t},t.prototype.generateParams=function(){this.args.domain.value=this.getDomain(),this.args.encoding.value=document.characterSet||document.charset,this.args.origin.value=this.getOriginIfAllowed(),this.args.screenColorDepth.value=screen.colorDepth.toString(),this.args.screenHeigth.value=screen.height.toString(),this.args.screenWidth.value=screen.width.toString(),this.args.viewportHeigth.value=String(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0),this.args.viewportWidth.value=String(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0).toString(),this.extractCampaignInformation()},t.prototype.getDomain=function(){return null!=this.userDomain&&""!==this.userDomain?this.userDomain:"frame"===this.implementation?this.getParentDomain():document.domain},t.prototype.getParentDomain=function(){var t="",e=(window.location!==window.parent.location?document.referrer:document.location).toString(),i=e.replace(/^https?:\/\//,"").split("/");e[0].match(/:/g)?t=i[0].split(":")[0]:t=i[0];return t},t.prototype.getOrigin=function(){var t,e=document.URL;switch(this.implementation){case"frame":e.match(/ifrmref=/g)?e.match(/ifrmref=([^&]+)/g)?t=decodeURIComponent(e.match(/ifrmref=([^&]+)/g)[0].split("=")[1]):(_.err(O),t=this.getParentDomain()):t=this.getParentDomain();break;case"redirection":t=this.getOriginRedirected();break;default:t=document.referrer}return this.extractFQDNFromGivenUrl(t)},t.prototype.getOriginIfAllowed=function(){return o.optin===this.consentType?this.getOrigin():null},t.prototype.extractFQDNFromGivenUrl=function(t){if(!t.startsWith("http://")&&!t.startsWith("https://"))return t.toString();var e=document.createElement("a");return e.href=t.toString(),e.hostname},t.prototype.getOriginRedirected=function(){for(var t="",e=document.cookie.split(":"),i=0;i<e.length;i++){var n=e[i].split("=");if("cks"===n[0]&&"-1"!==n[1])return t=e[i].substring(4),document.cookie="cks=-1;",t}var s=document.URL;return s.match(/__cks_=/g)&&(t=s.match(/__cks_=([^&]+)/g)[0].split("=")[1]),t||document.referrer},t.prototype.extractCampaignInformation=function(){var t="";t="frame"===this.implementation?document.referrer.toString():document.URL.toString();var e=this.getURLParameter("cmpsrc",t),i=this.getURLParameter("cmpspt",t),n=this.getURLParameter("cmpid",t);e&&i&&n&&(i in H?(this.args.source=new V("cmpsrc"),this.args.source.value=e,this.args.support=new V("cmpspt"),this.args.support.value=i,this.args.id=new V("cmpid"),this.args.id.value=n):_.err(p))},t.prototype.getURLParameter=function(t,e){var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===i?null:decodeURIComponent(i[1].replace(/\+/g," "))},t}(),W=function(){function t(t){t(this.resolve.bind(this),this.reject.bind(this))}return t.prototype.resolve=function(t){this.thenCb&&this.thenCb(t)},t.prototype.reject=function(t){this.catchCb&&this.catchCb(t)},t.prototype.then=function(t,e){return this.thenCb=t,e&&(this.catchCb=e),this},t.prototype.catch=function(t){return this.catchCb=t,this},t}(),X=function(){function t(e,i,n){this._access=F.FULL,this._cmsVI="0",this._serial=e,this._authURL=null!=i?i:t._DEFAULT_AUTH_URL,this._hitURL=null!=n?n:t._DEFAULT_HIT_URL}return t.prototype.getAccess=function(){return this._access},t.prototype.getEndpoint=function(){return this._hitURL},t.prototype.getCMSVI=function(){return this._cmsVI},t.prototype.authenticate=function(){var t=this,e=new W((function(e,i){t.requestValue(e,i)}));return e.catch((function(i){t._cmsVI=String(Math.floor(1e17*Math.random()%0x8db076000000000)),e.resolve("cmsVI initiliazed")}))},t.prototype.requestValue=function(t,e){var i=new XMLHttpRequest;i.open("GET",this._authURL+this._serial),i.timeout=2e3;var n=this;i.onload=function(){200===i.status?n.parseResponse(i.responseText):401===i.status&&(n._access=F.DENIED,_.err(S)),t("status code "+i.status)},i.ontimeout=function(t){e("Timeout")},i.onerror=function(t){e("Cannot send request to "+n._authURL)},i.send()},t.prototype.parseResponse=function(t){var e=t.split("|");e[0]=e[0].split("=")[1],e[1]=e[1].split("=")[1],e[2]=e[2].split("=")[1],this._access=e[0],this._hitURL=e[1],this._cmsVI=e[2].replace(/"/g,"")},t._DEFAULT_HIT_URL="https://mesure.streaming.estat.com/m/web/",t._DEFAULT_AUTH_URL="https://auth.estat.com/",t}();!function(t){t.FULL="full",t.DENIED="denied",t.RESTRICTED="restricted"}(F||(F={}));var q,Y,J=function(){function t(){}return t.prototype.send=function(t){var e=document.createElement("img"),i=t.buildURL();e.src=i,_.debug(r,t.getLogObject())},t}(),K=function(){function t(t,e){this.previousPosition=0,this.sessionCount=0,this.sessionStarted=!1,this.hitReductionStarted=!1,this.waitingAuth=!0,this.hits=[],this.conf=t,this.hitSender=new J,t.streaming?this.auth=new X(t.serial,t.streaming.authUrl,t.streaming.fallbackCollectUrl):this.auth=new X(t.serial),this.contextInfos=e,this.startSession()}return t.prototype.updateConfiguration=function(t){this.conf=t,this.contextInfos.update()},t.prototype.send=function(t,e,i){if(this.sessionStarted||this.startSession(),e=Math.round(e),i===L.POLLING)this.hitReductionStarted&&(t=this.firstHit.getState()),(n=this.buildHit(t,e,i)).setOldPosition(this.previousPosition),this.sendHit(n),this.previousPosition=e,this.sessionCount++;else if(t===I.STOP)this.sendHit(this.buildHit(t,e,i)),this.hitReductionStarted&&(window.clearTimeout(this.hitReductionCallback),this.hitReductionStarted=!1,this.lastHit=null);else if(this.hitReductionStarted)this.lastHit=new B(this.conf,this.contextInfos,e,t,i);else{var n;this.hitReductionStarted=!0,(n=this.buildHit(t,e,i)).setOldPosition(this.previousPosition),this.sendHit(n),this.previousPosition=e,this.sessionCount++,this.firstHit=n;var s=this;this.hitReductionCallback=window.setTimeout((function(){s.sendHitReduced()}),1e3)}},t.prototype.stopSession=function(){this.hitReductionStarted&&(window.clearTimeout(this.hitReductionCallback),this.hitReductionStarted=!1,this.lastHit=null),this.sessionStarted=!1,this.sessionCount=0},t.prototype.isSessionStarted=function(){return this.sessionStarted},t.prototype.sendHit=function(t){this.waitingAuth?this.hits.push(t):this.auth.getAccess()===F.FULL&&(t.setSessionID(this.auth.getCMSVI()),t.setCollectUrl(this.auth.getEndpoint()),this.hitSender.send(t))},t.prototype.sendRemainingHits=function(){this.waitingAuth=!1;for(var t=0;t<this.hits.length;t++)this.sendHit(this.hits[t]);this.hits=[]},t.prototype.startSession=function(){this.waitingAuth=!0,this.sessionStarted=!0,this.previousPosition=0;var t=this;this.auth.authenticate().then((function(){t.sendRemainingHits()}))},t.prototype.sendHitReduced=function(){this.hitReductionStarted=!1,this.lastHit&&this.lastHit.getState()!==this.firstHit.getState()?(this.lastHit.setOldPosition(this.previousPosition),this.lastHit.setSessionNumber(this.sessionCount),this.sendHit(this.lastHit),this.sessionCount++,this.lastHit=null):this.lastHit=null},t.prototype.buildHit=function(t,e,i){var n=new B(this.conf,this.contextInfos,e,t,i);return n.setSessionNumber(this.sessionCount),n.setOldPosition(this.previousPosition),n},t}(),Q=function(){function t(){this.enabled=!0,this.snoozed=!1}return t.prototype.setHitInfo=function(t){if(this.enabled&&!this.snoozed&&(this.info=t,t.consentType!==o.optout)){this.contextInfosBuilder?this.contextInfosBuilder.setImplementation(t.implementation):this.contextInfosBuilder=new G(t.implementation,t.consentType,t.domain),this.sessionManager?this.sessionManager.updateConfiguration(t):this.sessionManager=new K(t,this.contextInfosBuilder);var e=t.streaming.probe;if(!this.behavior||t.streaming.diffusion!==this.diffusionType||e!==this.probeEnabled)switch(this.behavior&&this.behavior.stop(),this.probeEnabled=e,this.diffusionType=t.streaming.diffusion,t.streaming.diffusion){case"live":e?(this.behavior=new D,_.debug(a)):this.behavior=new U;break;case"replay":e?(this.behavior=new j,_.debug(a)):this.behavior=new x;break;case"timeshifting":this.behavior=new z,e&&_.err(h)}this.behavior.configurationChange(t),this.behavior.setSessionManager(this.sessionManager)}},t.prototype.notify=function(t,e){this.enabled&&this.info.consentType!==o.optout&&(void 0===e&&this.info.streaming.callbackPosition?e=this.info.streaming.callbackPosition():void 0===e&&(e=0),this.behavior.notify(t,e))},t.prototype.isSessionStarted=function(){return!!this.sessionManager&&this.sessionManager.isSessionStarted()},t.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.behavior&&this.behavior.stop())},t.prototype.snooze=function(){this.snoozed=!0,this.behavior&&this.enabled&&this.behavior.snooze()},t.prototype.wakeup=function(){this.snoozed=!1,this.behavior&&this.enabled&&this.behavior.wakeup()},t.prototype.setCast=function(t){this.contextInfosBuilder.setCast(t)},t}();!function(t){t.play="play",t.pause="pause",t.stop="stop"}(q||(q={})),function(t){t.replay="replay",t.live="live",t.timeshifting="timeshifting"}(Y||(Y={}));var Z=function(){function t(t){this.confBuilder=new N,this.orchestrator=new Q,this.configuration=this.confBuilder.buildConfiguration(t),this.valid=this.confBuilder.validateConfiguration(t),this.valid&&(_.setDebug(this.isDebug()),this.orchestrator.setHitInfo(this.configuration))}return t.prototype.set=function(t){this.confBuilder.mergeConfiguration(this.configuration,t,this.orchestrator.isSessionStarted()),this.valid=this.confBuilder.validateConfiguration(this.configuration),this.valid&&(_.setDebug(this.isDebug()),this.orchestrator.setHitInfo(this.configuration))},t.prototype.setDebug=function(t){_.setDebug(t),this.configuration.debug=t},t.prototype.notifyPlayer=function(t,e){this.valid&&(t in q?this.orchestrator.notify(t,e):_.err(P))},t.prototype.disable=function(){this.orchestrator.disable()},t.prototype.snooze=function(){this.orchestrator.snooze()},t.prototype.wakeup=function(){this.orchestrator.wakeup()},t.prototype.setCast=function(t){this.orchestrator.setCast(t)},t.prototype.isDebug=function(){return!!this.configuration.debug&&("true"===this.configuration.debug||!0===this.configuration.debug)},t}()}]));split("?");if(b[1]){b=b[1].split("&");for(var d=0;d<b.length;++d){var e=
b[d].split("=");if(e[0]===c&&!a.Util.isBlank(e[1]))return decodeURIComponent(e[1])}}return null},isParameterInURL:function(a,c){if(!a||!c)return!1;a=a.split("?");if(a[1]){a=a[1].split("&");for(var b=0;b<a.length;++b)if(a[b].split("=")[0]===c)return!0}return!1},flashVersion:function(){var b="0,0,0,0";if(null!=navigator.plugins&&0<navigator.plugins.length){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"])try{var c=navigator.plugins["Shockwave Flash"+(navigator.plugins["Shockwave Flash 2.0"]?
" 2.0":"")].description.split(" "),d=c[2].split("."),e=d[0],f=d[1],k=c[3];""===k&&(k=c[4]);"d"===k[0]?k=k.substring(1):"r"===k[0]&&(k=k.substring(1),0<k.indexOf("d")&&(k=k.substring(0,k.indexOf("d"))));b=e+","+f+","+k+",0"}catch(z){a.warn("Flash detection failed on navigator method")}}else try{var g=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");var n=g.GetVariable("$version").split(" ")[1].split(",");3===n.length?b=n.join(",")+",0":4===n.length&&(b=n.join(","))}catch(z){a.warn("Flash detection failed on ActiveX method")}return b},
xmlToJson:function(b){var c={};if(!b)return null;if(1===b.nodeType){if(0<b.attributes.length){c["@attributes"]={};for(var d=0;d<b.attributes.length;d++){var e=b.attributes.item(d);c["@attributes"][e.nodeName]=e.nodeValue}}}else 3===b.nodeType?c=b.nodeValue:4===b.nodeType&&(c=b.nodeValue);if(b.hasChildNodes()){for(d=0;d<b.childNodes.length;d++){e=b.childNodes.item(d);var f=e.nodeName;if("undefined"===typeof c[f])c[f]=a.Util.xmlToJson(e);else{if("undefined"===typeof c[f].length||"string"===typeof c[f]){var k=
c[f];c[f]=[];c[f].push(k)}c[f].push(a.Util.xmlToJson(e))}}"undefined"!==typeof c["#cdata-section"]?(c.value=c["#cdata-section"],c.value.constructor===Array&&(c.value=c.value.join(""))):c["#text"]&&(c.value=c["#text"])}return c},lazyJavaScriptLoad:function(a,c){var b=document.getElementsByTagName("head")[0]||document.documentElement,e=document.createElement("script");e.type="text/javascript";e.src=a;c&&(e.attachEvent&&!window.opera?e.onreadystatechange=function(){if("loaded"===e.readyState||"complete"===
e.readyState)b.removeChild(e),e.onreadystatechange=null,c()}:e.addEventListener("load",function(){b.removeChild(e);c()},!1));b.insertBefore(e,b.firstChild)},getViewport:function(){var a=0,c=0;"undefined"!==typeof window.innerWidth?(a=window.innerWidth,c=window.innerHeight):"undefined"!==typeof document.documentElement&&"undefined"!==typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(a=document.documentElement.clientWidth,c=document.documentElement.clientHeight):
document.getElementsByTagName("body")&&document.getElementsByTagName("body")[0]&&(a=document.getElementsByTagName("body")[0].clientWidth,c=document.getElementsByTagName("body")[0].clientHeight);return{width:a,height:c,offsetX:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,offsetY:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}},getAbsoluteUrl:function(b,c){b=a.Util.trim(b);c=a.Util.trim(c);if(-1!==c.indexOf("://"))return c;var d=
b.substring(0,b.indexOf("://"));if(0===c.indexOf("//"))return d+":"+c;d=b.indexOf("/",b.indexOf("://")+5);var e=b;-1!==d&&(e=b.substring(0,d));if(0===c.indexOf("/"))return e+c;d=b.lastIndexOf("#");e=b;-1!==d&&(e=b.substring(0,d));if(0===c.indexOf("#"))return e+c;e=b.indexOf("?");d=b;-1!==e&&(d=b.substring(0,e));if(0===c.indexOf("?"))return d+c;e=-1===e?b.lastIndexOf("/"):d.lastIndexOf("/");d=-1!==e?b.substring(0,e+1):d+"/";return d+c},secondsToHms:function(a){a=isNaN(Number(a))?0:Number(a);var b=
Math.floor(a%3600/60),d=Math.round(a%3600%60);return("0"+Math.floor(a/3600)).slice(-2)+":"+("0"+b).slice(-2)+":"+("0"+d).slice(-2)},getFixedDigitRandomNumber:function(a){a=isNaN(Number(a))?0:Number(a);return Math.floor(9*Math.random()*Math.pow(10,a-1)+Math.pow(10,a-1))},getDateStringInISOFormat:function(a){return a instanceof Date&&!isNaN(a.valueOf())?a.toISOString():null},getTopMostWindow:function(){for(var a=window;a!=top;)if(a.parent.location.href.length)a=a.parent;else throw"Cannot access top most window";
return a},getFrameAncestor:function(b){for(var c=window,d;!d;){try{c.frames[b]&&(d=c)}catch(e){a.warn("Error while trying to access window with "+b)}if(c===window.top)break;c=c.parent}return d},isValidProxyUrl:function(a){return a&&"string"===typeof a},compareVersion:function(a,c){if(a===c)return 0;a=a.split(".");c=c.split(".");for(var b=Math.min(a.length,c.length),e=0;e<b;e++){if(parseInt(a[e])>parseInt(c[e]))return 1;if(parseInt(a[e])<parseInt(c[e]))return-1}return a.length>c.length?1:a.length<
c.length?-1:0},validateJSON:function(a,c,d){var b=Object.keys(c).filter(function(b){var d=c[b];if(d.isOptional&&!a.hasOwnProperty(b))return!1;if(d.validationFunction)return!d.validationFunction(a[b]);for(var e=0;e<d.allowedTypes.length;e++)if(typeof a[b]===d.allowedTypes[e])return!1;return!0}).map(function(b){return b in a?b+" is invalid.":b+" is missing."});if(0<b.length)return b=this.arrayToString(b),Error("The "+d+" failed validation:"+b)},arrayToString:function(a){return a.reduce(function(a,b){return a+
" "+b},"")},validateCustomPlayer:function(a){if(!a)return Error("customPlayer is null");if(a=this.validateJSON(a,{open:{allowedTypes:["function"]},getDuration:{allowedTypes:["function"]},getPlayheadTime:{allowedTypes:["function"]},playPause:{allowedTypes:["function"]}},"customPlayer"))return Error(a.message.replace("invalid","not a function"))},getBooleanParameter:function(a,c){a=this._context.getParameter(a);null==a&&(a=c);return this.str2bool(a)},offsetStringToSecond:function(b,c){if("string"!==
typeof b||this.isBlank(b))return-1;var d=/(\d+)(.(\d+))%|(\d+)%/.exec(b);if(d)return b=d[0].substr(0,d[0].length-1),0<c?c*Number(b)/100|0:-1;if(c=/(\d+):(\d+):(\d+)(.(\d+))?/.exec(b))return 3600*c[1]+60*c[2]+1*c[3];a.warn('offset is malformatted with value "',b,' ", the expected format is either HH:MM:SS(:mmm) or percentage%.');return-1},offsetStringToPercentage:function(a){return"string"!==typeof a||this.isBlank(a)?-1:(a=/(\d+)(.(\d+))%|(\d+)%/.exec(a))?a[0].substr(0,a[0].length-1):-1}};a.MediaState=
function(){};a.MediaState.prototype={};a.MediaState.prototype.constructor=a.MediaState;a.Util.mixin(a.MediaState.prototype,{play:function(b){a.debug(this._name+" play("+b+")")},pause:function(b){a.debug(this._name+" pause("+b+")")},complete:function(b){a.debug(this._name+" complete("+b+")")}});a.MediaInitState=function(){this._name="MediaInitState"};a.MediaInitState.prototype=new a.MediaState;a.MediaInitState.prototype.constructor=a.MediaInitState;a.Util.mixin(a.MediaInitState.prototype,{play:function(b){a.debug(this._name+
" play("+b+")");b.setMediaState(a.MediaPlayingState.instance);if("function"===typeof b.onStartPlaying)b.onStartPlaying()}});a.MediaInitState.instance=new a.MediaInitState;a.MediaPlayingState=function(){this._name="MediaPlayingState"};a.MediaPlayingState.prototype=new a.MediaState;a.MediaPlayingState.prototype.constructor=a.MediaPlayingState;a.Util.mixin(a.MediaPlayingState.prototype,{pause:function(b){a.debug(this._name+" pause("+b+")");b.setMediaState(a.MediaPausedState.instance);if("function"===
typeof b.onPausePlaying)b.onPausePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompletePlaying)b.onCompletePlaying()}});a.MediaPlayingState.instance=new a.MediaPlayingState;a.MediaPausedState=function(){this._name="MediaPausedState"};a.MediaPausedState.prototype=new a.MediaState;a.MediaPausedState.prototype.constructor=a.MediaPausedState;a.Util.mixin(a.MediaPausedState.prototype,{play:function(b){a.debug(this._name+
" play("+b+")");b.setMediaState(a.MediaPlayingState.instance);if("function"===typeof b.onResumePlaying)b.onResumePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompletePlaying)b.onCompletePlaying()}});a.MediaPausedState.instance=new a.MediaPausedState;a.MediaReplayingState=function(){this._name="MediaReplayingState"};a.MediaReplayingState.prototype=new a.MediaState;a.MediaReplayingState.prototype.constructor=
a.MediaReplayingState;a.Util.mixin(a.MediaReplayingState.prototype,{pause:function(b){a.debug(this._name+" pause("+b+")");b.setMediaState(a.MediaReplayPausedState.instance);if("function"===typeof b.onPausePlaying)b.onPausePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompleteReplaying)b.onCompleteReplaying()}});a.MediaReplayingState.instance=new a.MediaReplayingState;a.MediaReplayPausedState=function(){this._name=
"MediaReplayPausedState"};a.MediaReplayPausedState.prototype=new a.MediaState;a.MediaReplayPausedState.prototype.constructor=a.MediaReplayPausedState;a.Util.mixin(a.MediaReplayPausedState.prototype,{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaReplayingState.instance);if("function"===typeof b.onResumePlaying)b.onResumePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompleteReplaying)b.onCompleteReplaying()}});
a.MediaReplayPausedState.instance=new a.MediaReplayPausedState;a.MediaEndState=function(){this._name="MediaEndState"};a.MediaEndState.prototype=new a.MediaState;a.MediaEndState.prototype.constructor=a.MediaEndState;a.Util.mixin(a.MediaEndState.prototype,{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaReplayingState.instance);if("function"===typeof b.onStartReplaying)b.onStartReplaying()}});a.MediaEndState.instance=new a.MediaEndState;a.RendererState=function(){};a.RendererState.prototype=
{};a.RendererState.prototype.constructor=a.RendererState;a.Util.mixin(a.RendererState.prototype,{start:function(b){a.debug(this._name+" start() rendererController = "+b)},notifyStarted:function(b){a.debug(this._name+" notifyStarted() rendererController = "+b)},stop:function(b){a.debug(this._name+" stop() rendererController = "+b)},complete:function(b){a.debug(this._name+" complete() rendererController = "+b)},notifyCompleted:function(b){a.debug(this._name+" notifyCompleted() rendererController = "+
b)},fail:function(b){a.debug(this._name+" fail() rendererController = "+b);b.setRendererState(a.RendererFailedState.instance);b.getAdInstance().complete()}});a.RendererInitState=function(){this._name="RendererInitState"};a.RendererInitState.prototype=new a.RendererState;a.RendererInitState.prototype.constructor=a.RendererInitState;a.RendererInitState.instance=new a.RendererInitState;a.Util.mixin(a.RendererInitState.prototype,{start:function(b){a.debug(this._name+" start()");b.setRendererState(a.RendererStartingState.instance);
b.getRenderer().start(b)},stop:function(b){a.debug(this._name+" stop()");b.setRendererState(a.RendererCompletingState.instance);b.getRendererState().notifyCompleted(b)}});a.RendererStartingState=function(){this._name="RendererStartingState"};a.RendererStartingState.prototype=new a.RendererState;a.RendererStartingState.prototype.constructor=a.RendererStartingState;a.RendererStartingState.instance=new a.RendererStartingState;a.Util.mixin(a.RendererStartingState.prototype,{notifyStarted:function(b){a.debug(this._name+
" notifyStarted()");b.setRendererState(a.RendererStartedState.instance);b.getAdInstance().play()},stop:function(b){a.debug(this._name+" stop()");"function"===typeof b.getRenderer().stop&&(b.setRendererState(a.RendererCompletingState.instance),b.getRenderer().stop())}});a.RendererStartedState=function(){this._name="RendererStartedState"};a.RendererStartedState.prototype=new a.RendererState;a.RendererStartedState.prototype.constructor=a.RendererStartedState;a.RendererStartedState.instance=new a.RendererStartedState;
a.Util.mixin(a.RendererStartedState.prototype,{complete:function(b){a.debug(this._name+" complete()");b.setRendererState(a.RendererCompletingState.instance)},stop:function(b){a.debug(this._name+" stop()");"function"===typeof b.getRenderer().stop&&(b.setRendererState(a.RendererCompletingState.instance),!1===b.getRenderer().stop()&&b.getAdInstance().fakeComplete())}});a.RendererCompletingState=function(){this._name="RendererCompletingState"};a.RendererCompletingState.prototype=new a.RendererState;a.RendererCompletingState.prototype.constructor=
a.RendererCompletingState;a.RendererCompletingState.instance=new a.RendererCompletingState;a.Util.mixin(a.RendererCompletingState.prototype,{notifyCompleted:function(b){a.debug(this._name+" notifyCompleted()");b.setRendererState(a.RendererCompletedState.instance);b.getAdInstance().complete()}});a.RendererCompletedState=function(){this._name="RendererCompletedState"};a.RendererCompletedState.prototype=new a.RendererState;a.RendererCompletedState.prototype.constructor=a.RendererCompletedState;a.RendererCompletedState.instance=
new a.RendererCompletedState;a.RendererFailedState=function(){this._name="RendererFailedState"};a.RendererFailedState.prototype=new a.RendererState;a.RendererFailedState.prototype.constructor=a.RendererFailedState;a.RendererFailedState.instance=new a.RendererFailedState;a.HTMLRenderer=function(){this._rendererController=null;this._onVisibilityChange=this._onVisibilityChange.bind(this)};a.HTMLRenderer.prototype={start:function(b){this._rendererController=b;this._rendererController.getAdInstance().getSlot().getBase()?
document.visibilityState&&"visible"!==document.visibilityState?(a.debug("Document was not visible when ad started."),document.addEventListener("visibilitychange",this._onVisibilityChange,!1)):(a.debug("Document was visible when ad started."),this._setupParameters()&&(this._render(),this._rendererController.handleStateTransition(a.RENDERER_STATE_STARTED))):this._onRendererFailed(a.ERROR_INVALID_SLOT,"slot base is empty")},_onVisibilityChange:function(){"visible"===document.visibilityState&&(a.debug("Document is now visible, and ad already tried to start when the document was not visible."),
this._setupParameters()&&(this._render(),this._rendererController.handleStateTransition(a.RENDERER_STATE_STARTED)),document.removeEventListener("visibilitychange",this._onVisibilityChange,!1))},pause:function(){this.log("pause");this.shouldEndAfterDuration&&this.timer&&this.timer.pause()},resume:function(){this.log("resume");this.shouldEndAfterDuration&&this.timer&&this.timer.start()},stop:function(){this.log("stop isMRAIDAd:"+this.isMRAIDAd+" tpc:"+this._tpc+" interstitial:"+this.shouldKeepInterstitial);
return this._stop()},_stop:function(){this.log("_stop isMRAIDAd:"+this.isMRAIDAd+" tpc:"+this._tpc+" interstitial:"+this.shouldKeepInterstitial);if(this.isMRAIDAd||this._tpc!==a.TIME_POSITION_CLASS_DISPLAY||this.shouldKeepInterstitial)this._cleanup(),this._rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED);else return!1},resize:function(){var b=this._rendererController.getAdInstance(),c=b.getSlot().getBase();b.getSlot().getTimePositionClass()===a.TIME_POSITION_CLASS_OVERLAY?!this.isMRAIDAd||
this.isMRAIDAd&&this.mraid.state===this.mraid.STATEDEFAULT?(b="_fw_ad_container_html_"+b.getSlot().getCustomId()+"_",b=document.getElementById(b),b.style.width=c.style.width||"100%",b.style.height=c.style.height||"100%",this._layoutOverlayAd(this.defaultAdElement)):this.log("Cannot resize an MRAID ad that is not in the default state"):this.log("Cannot resize a non-overlay ad")},_cleanup:function(){this.log("_cleanup");document.removeEventListener("visibilitychange",this._onVisibilityChange,!1);this.timer&&
(this.timer.stop(),this.timer=null);this.adLoadTimeoutTimer&&(this.adLoadTimeoutTimer.stop(),this.adLoadTimeoutTimer=null);window.removeEventListener?(document.removeEventListener("touchmove",this.touchMoveDisabler,!1),window.removeEventListener("message",this.messageHandlerFunc,!1),window.removeEventListener("resize",this.viewportChangeFunc,!1),window.removeEventListener("scroll",this.viewportChangeFunc,!1)):window.detachEvent&&(window.detachEvent("onmessage",this.messageHandlerFunc),window.detachEvent("onresize",
this.viewportChangeFunc),window.detachEvent("onscroll",this.viewportChangeFunc));if(this.isMRAIDAd&&(this.mraid.inExpandedState()&&(this.log("stopping with expanded state, invoke close()"),this._mraidClose()),this.mraid.inDefaultState())){this.log("stopping with default state, invoke close()");this._mraidClose();return}if(this.expandedAdElement){var a=this.expandedAdElement.parentNode;this.expandedAdElement._fw_closeButton&&a.removeChild(this.expandedAdElement._fw_closeButton);a.removeChild(this.expandedAdElement);
this.expandedAdElement===this.defaultAdElement&&(this.defaultAdElementContainer===this.defaultAdElement&&(this.defaultAdElementContainer=null),this.defaultAdElement=null);this.expandedAdElement=null}this.expandedLightbox&&(a=this.expandedLightbox.parentNode,a.removeChild(this.expandedLightbox),this.expandedLightbox=null);if(this.defaultAdElement){a=this.defaultAdElement.parentNode;var c=this.defaultAdElement;c.style.display="none";a!==this._rendererController.getAdInstance().getSlot().getBase()&&
window.setTimeout(function(){for(var b=a&&a.childNodes||[],e=0;e<b.length;e++){var f=b[e];f===c&&a.removeChild(f)}},200);this.defaultAdElementContainer===this.defaultAdElement&&(this.defaultAdElementContainer=null);this.defaultAdElement=null}this.defaultAdElementContainer&&(a=this.defaultAdElementContainer.parentNode,a.removeChild(this.defaultAdElementContainer),this.defaultAdElementContainer=null);(this.shouldPauseContentWhenStart||this.isInterstitialNow&&!this.isMRAIDAd)&&this._rendererController.requestContentStateChange(!1)},
_setupParameters:function(){var b=this._rendererController.getAdInstance(),c=b.getSlot().getTimePositionClass();this._tpc=c;var d=b.getActiveCreativeRendition();b=d.getBaseUnit();d=d.getCreativeApi();var e;if(a.PLATFORM_NOT_SUPPORT_OVERLAY_AD&&c===a.TIME_POSITION_CLASS_OVERLAY)return this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"Overlay not supported on this device."),!1;if(a.PLATFORM_NOT_SUPPORT_MIDROLL_AD&&(c===a.TIME_POSITION_CLASS_MIDROLL||c===a.TIME_POSITION_CLASS_PAUSE_MIDROLL))return this._onRendererFailed(a.ERROR_DEVICE_LIMIT,
"Midroll, pause_midroll not supported on this device."),!1;if(a.PLATFORM_IS_IPHONE_IPOD)switch(c){case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_PAUSE_MIDROLL:case a.TIME_POSITION_CLASS_OVERLAY:return this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"Midroll, pause_midroll and overlay ads are not supported on iPod, iPhone."),!1;case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:this._rendererController.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF)}this.adLoadTimeout=
5;if(e=this._rendererController.getParameter(a.PARAMETER_RENDERER_HTML_AD_LOAD_TIMEOUT))this.adLoadTimeout=0<Number(e)?Number(e):this.adLoadTimeout;this.shouldKeepInterstitial=!1;(e=this._rendererController.getParameter(a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE))?this.shouldKeepInterstitial=e===a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INTERSTITIAL:"string"===typeof b&&(this.shouldKeepInterstitial=b.toLowerCase()===a.PARAMETER_RENDERER_HTML_BASEUNIT_INTERSTITIAL);this.isInterstitialNow=this.shouldKeepInterstitial;
this.shouldPauseContentWhenStart=!1;this.shouldPauseContentWhenExpandOrClick=!this.shouldKeepInterstitial&&(c===a.TIME_POSITION_CLASS_DISPLAY||c===a.TIME_POSITION_CLASS_OVERLAY);this.shouldBackgroundTransparent=!1;e=this._rendererController.getParameter(a.PARAMETER_RENDERER_HTML_SHOULD_BACKGROUND_TRANSPARENT);"undefined"!==typeof e&&null!=e&&(this.shouldBackgroundTransparent=a.Util.str2bool(e));this.shouldEndAfterDuration=c!==a.TIME_POSITION_CLASS_DISPLAY||this.shouldKeepInterstitial;e=this._rendererController.getParameter(a.PARAMETER_RENDERER_HTML_SHOULD_END_AFTER_DURATION);
"undefined"!==typeof e&&null!=e&&(this.shouldEndAfterDuration=a.Util.str2bool(e));this.coadScriptName=this._rendererController.getParameter(a.PARAMETER_RENDERER_DISPLAY_COAD_SCRIPT_NAME);this.coadScriptName||(this.coadScriptName=this._rendererController.getParameter("coad_script_name"));this.primaryAnchor=this._rendererController.getParameter(a.PARAMETER_RENDERER_HTML_PRIMARY_ANCHOR)||"bc";this.marginWidth=this._rendererController.getParameter(a.PARAMETER_RENDERER_HTML_MARGIN_WIDTH)||0;this.marginHeight=
this._rendererController.getParameter(a.PARAMETER_RENDERER_HTML_MARGIN_HEIGHT)||0;this.bootstrap=this._rendererController.getParameter(a.PARAMETER_RENDERER_HTML_BOOTSTRAP);b=a.Util.getViewport();this.defaultExpandWidth=b.width;this.defaultExpandHeight=b.height;this.isMRAIDAd="MRAID-1.0"===d;this.mraid=new function(b){this.STATELOADING="loading";this.STATEDEFAULT="default";this.STATEEXPANDED="expanded";this.STATEHIDDEN="hidden";this._renderer=b;this._state=this.STATELOADING;this._useCustomClose=!1;
this.viewable=this.expandIsModal=!0;this._baseUrlExpanded=this._baseUrlDefault="";b=Object.defineProperty||function(a,b,c){c.get&&a.__defineGetter__(b,c.get);c.set&&a.__defineSetter__(b,c.set)};b(this,"baseUrl",{get:function(){return this.inExpandedState()?this._baseUrlExpanded||this._baseUrlDefault:this._baseUrlDefault},set:function(a){this.inExpandedState()?this._baseUrlExpanded=a:(this._baseUrlDefault=a,this._baseUrlExpanded="")}});b(this,"useCustomClose",{get:function(){return this._useCustomClose},
set:function(a){this._useCustomClose===!a&&(this._useCustomClose=!!a,this.pushData())}});b(this,"placementType",{get:function(){return this._renderer.shouldKeepInterstitial?"interstitial":"inline"}});b(this,"expandWidth",{get:function(){return this._renderer.requestedExpandWidth&&this._renderer.requestedExpandWidth<this._renderer.defaultExpandWidth?this._renderer.requestedExpandWidth:this._renderer.defaultExpandWidth}});b(this,"expandHeight",{get:function(){return this._renderer.requestedExpandHeight&&
this._renderer.requestedExpandHeight<this._renderer.defaultExpandHeight?this._renderer.requestedExpandHeight:this._renderer.defaultExpandHeight}});b(this,"state",{get:function(){return this._state},set:function(b){this.log("mraid.state change "+this.state+" => "+b);this.state!==b&&(this._renderer.shouldPauseContentWhenExpandOrClick&&(b===this.STATEEXPANDED?this._renderer._rendererController.requestContentStateChange(!0):this.inExpandedState()&&this._renderer._rendererController.requestContentStateChange(!1)),
b===this.STATEEXPANDED?(this._renderer.expandedAdElement?this._renderer._rendererController.processEvent({name:a.EVENT_AD_ACCEPT_INVITATION}):(this._renderer.expandedAdElement=this._renderer.defaultAdElement,this._renderer._rendererController.processEvent({name:a.EVENT_AD_EXPAND})),this._renderer.presentInterstitial(),this._renderer.shouldEndAfterDuration&&this._renderer.timer.pause()):b===this.STATEDEFAULT&&(this._renderer.shouldKeepInterstitial?(this._renderer.expandedAdElement=this._renderer.defaultAdElement,
this._renderer.presentInterstitial()):(this.inExpandedState()&&(this._renderer.expandedAdElement!==this._renderer.defaultAdElement?this._renderer._rendererController.processEvent({name:a.EVENT_AD_CLOSE}):this._renderer._rendererController.processEvent({name:a.EVENT_AD_COLLAPSE})),this._renderer.expandedAdElement=null,this._renderer.presentInline()),this._renderer.shouldEndAfterDuration&&this._renderer.timer&&this._renderer.timer.start()),this._state=b,this.pushData(),b===this.STATEHIDDEN&&this._renderer.stop())}});
this.inLoadingState=function(){return this.state===this.STATELOADING};this.inDefaultState=function(){return this.state===this.STATEDEFAULT};this.inExpandedState=function(){return this.state===this.STATEEXPANDED};this.inHiddenState=function(){return this.state===this.STATEHIDDEN};this.pushData=function(){var a='mraid._Update("'+this.state+'", '+this.viewable+', "'+this.placementType+'", '+this.expandWidth+", "+this.expandHeight+", "+this.useCustomClose+", "+this.expandIsModal+")";this.log("mraid.pushData: going to invoke on iframe with "+
a);this._renderer.defaultAdElement?(this._renderer.defaultAdElement.contentWindow.postMessage("fwsdk-bounce:"+a,"*"),this._renderer.expandedAdElement&&this._renderer.expandedAdElement!==this._renderer.defaultAdElement&&this._renderer.expandedAdElement.contentWindow.postMessage("fwsdk-bounce:"+a,"*")):this.warn("_mraidPushData: no iframe suitable to send "+a)};this.log=function(a){this._renderer.log(a)};this.warn=function(a){this._renderer.warn(a)}}(this);this.onLoadFunc=a.Util.bind(this,function(){this.adLoadTimeoutTimer&&
(this.adLoadTimeoutTimer.stop(),this.adLoadTimeoutTimer=null);this.timer&&this.shouldEndAfterDuration&&this.timer.start()});this.touchMoveDisabler=function(a){a.preventDefault()};this.log("setting parameters, adLoadTimeout: "+this.adLoadTimeout+", isMRAIDAd: "+this.isMRAIDAd+", shouldKeepInterstitial: "+this.shouldKeepInterstitial+", shouldEndAfterDuration: "+this.shouldEndAfterDuration+", shouldPauseContentWhenStart: "+this.shouldPauseContentWhenStart+", shouldPauseContentWhenExpandOrClick: "+this.shouldPauseContentWhenExpandOrClick+
", shouldBackgroundTransparent: "+this.shouldBackgroundTransparent+", defaultExpandWidth: "+this.defaultExpandWidth+", defaultExpandHeight: "+this.defaultExpandHeight+", coadScriptName: "+this.coadScriptName+", primaryAnchor: "+this.primaryAnchor+", marginWidth: "+this.marginWidth+", marginHeight: "+this.marginHeight+", bootstrap: "+this.bootstrap);if(!this.shouldKeepInterstitial)!this.isMRAIDAd||a.PLATFORM_IS_IPHONE_IPOD&&c!==a.TIME_POSITION_CLASS_DISPLAY||(this._rendererController.setCapability(a.EVENT_AD_ACCEPT_INVITATION,
a.CAPABILITY_STATUS_ON),this._rendererController.setCapability(a.EVENT_AD_CLOSE,a.CAPABILITY_STATUS_ON),this._rendererController.setCapability(a.EVENT_AD_COLLAPSE,a.CAPABILITY_STATUS_ON),this._rendererController.setCapability(a.EVENT_AD_EXPAND,a.CAPABILITY_STATUS_ON));else if(c===a.TIME_POSITION_CLASS_OVERLAY)return this._onRendererFailed(a.ERROR_INVALID_SLOT,"Interstitial ad is not supported in overlay slot."),!1;return!0},_render:function(){this.log("_render");var b=this._rendererController.getAdInstance(),
c=b.getSlot(),d=c.getTimePositionClass(),e=c.getBase(),f=b.getActiveCreativeRendition(),k=f.getDuration(),g=f.getPrimaryCreativeRenditionAsset();b=g.getProxiedUrl();var n=g.getContent();d===a.TIME_POSITION_CLASS_DISPLAY&&(e.innerHTML="");this.timer=new a.Timer(k,a.Util.bind(this,this._stop));if(this.coadScriptName&&"function"===typeof window[this.coadScriptName])this.defaultAdElement=window[this.coadScriptName](n,b,f.getHeight(),f.getWidth(),g.getMimeType(),c.getCustomId()),this.timer&&this.shouldEndAfterDuration&&
this.timer.start();else if(k=document.createElement("span"),k.id="_fw_ad_container_html_"+c.getCustomId()+"_",k.style.position="relative"===e.style.position?"absolute":"relative",k.style.display="inline-block",k.style.margin="0px",k.style.padding="0px",k.style.width=e.style.width||"100%",k.style.height=e.style.height||"100%",k.style.top=k.style.left="0px",e.appendChild(k),this.defaultAdElementContainer=k,b||n){if("text/html_lit_nowrapper"===f.getContentType()||"text/html_lit_js_wc_nw"===f.getContentType()){if(this.isMRAIDAd||
this.isInterstitialNow){this._onRendererFailed(a.ERROR_INVALID_VALUE,"");this._stop();return}if(!n){this._onRendererFailed(a.ERROR_NULL_ASSET,"Empty content");this._stop();return}this.defaultAdElement=k;this.defaultAdElement.innerHTML=n;c=this.defaultAdElement.getElementsByTagName("script");var h=document.getElementsByTagName("head")[0];for(e=0;e<c.length;++e)if(c[e].src){var C=document.createElement("script");C.src=c[e].src;c[e].charset&&(C.charset=c[e].charset);c[e].innerHTML&&(C.innerHTML=c[e].innerHTML);
C.onload=C.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||h.removeChild(C)};h.appendChild(C)}else C=c[e].innerHTML,eval(C);this.presentInline();this.onLoadFunc();return}f=document.createElement("iframe");f.id="_fw_ad_container_iframe_"+c.getCustomId()+"_"+Math.random();f.attachEvent?f.attachEvent("onload",this.onLoadFunc):f.onload=this.onLoadFunc;this.defaultAdElement=f;this.defaultAdElementContainer.appendChild(f);this._fillAdNode(f,b,n);
this.isMRAIDAd&&(this.adLoadTimeoutTimer=new a.Timer(this.adLoadTimeout,a.Util.bind(this,function(){this._onRendererFailed(a.ERROR_TIMEOUT,"Loading MRAID Ad timed out");d!==a.TIME_POSITION_CLASS_DISPLAY?this.isMRAIDAd&&!this.mraid.inLoadingState()?this._mraidClose():this._stop():this._stop()})),this.adLoadTimeoutTimer.start())}else{this._onRendererFailed(a.ERROR_NULL_ASSET,"Empty URL and empty content");this._stop();return}this.defaultAdElement||(c=e.getElementsByTagName("iframe"))&&0<c.length&&(this.defaultAdElement=
c[c.length-1]);this.defaultAdElement?(this.defaultAdElement.frameBorder="0",this.shouldBackgroundTransparent&&(this.defaultAdElement.allowTransparency="true",this.defaultAdElement.style["background-color"]="rgba(255,255,255,0)"),this.isInterstitialNow?(this.expandedAdElement=this.defaultAdElement,this.presentInterstitial()):this.presentInline(),this.messageHandlerFunc=a.Util.bind(this,this._onWindowMessageReceived),this.viewportChangeFunc=a.Util.bind(this,function(){this.viewportChangeFuncTimer&&
window.clearTimeout(this.viewportChangeFuncTimer);this.viewportChangeFuncTimer=window.setTimeout(a.Util.bind(this,this._onViewportResizeScroll),200)}),window.addEventListener?(window.addEventListener("message",this.messageHandlerFunc,!1),window.addEventListener("resize",this.viewportChangeFunc,!1),window.addEventListener("scroll",this.viewportChangeFunc,!1)):window.attachEvent&&(window.attachEvent("onmessage",this.messageHandlerFunc),window.attachEvent("onresize",this.viewportChangeFunc),window.attachEvent("onscroll",
this.viewportChangeFunc))):this.isMRAIDAd&&(this._onRendererFailed(a.ERROR_UNKNOWN,"Failed to find iframe in slotBase for MRAID ad"),this._stop())},_layoutOverlayAd:function(a){this.log("_layoutOverlayAd");var b=this._rendererController.getAdInstance(),d=b.getSlot(),e=d.getVideoDisplaySize().width;d=d.getVideoDisplaySize().height;var f=b.getActiveCreativeRendition();b=f.getWidth()||240;f=f.getHeight()||50;a.style.width=Math.min(b,e)+"px";a.style.height=Math.min(f,d)+"px";a.style.left=a.style.top=
a.style.right=a.style.bottom="";switch(this.primaryAnchor){case "tl":case "lt":a.style.top=this.marginHeight+"px";a.style.left=this.marginWidth+"px";break;case "tr":case "rt":a.style.top=this.marginHeight+"px";a.style.right=this.marginWidth+"px";break;case "bl":case "lb":a.style.bottom=this.marginHeight+"px";a.style.left=this.marginWidth+"px";break;case "br":case "rb":a.style.bottom=this.marginHeight+"px";a.style.right=this.marginWidth+"px";break;case "tc":case "ct":a.style.top=this.marginHeight+
"px";a.style.left=.5*Math.max(0,e-b)+"px";break;case "lm":case "ml":a.style.left=this.marginWidth+"px";a.style.top=.5*Math.max(0,d-f)+"px";break;case "rm":case "mr":a.style.right=this.marginWidth+"px";a.style.top=.5*Math.max(0,d-f)+"px";break;case "mc":case "cm":case "c":case "m":a.style.left=.5*Math.max(0,e-b)+"px";a.style.top=.5*Math.max(0,d-f)+"px";break;default:case "bc":case "cb":a.style.bottom=this.marginHeight+"px",a.style.left=.5*Math.max(0,e-b)+"px"}},_fillAdNode:function(b,c,d){this.log("_fillAdNode, url:"+
c+", content:"+(d?"<omited>":"<empty>"));if(c)b.src=c;else if(d)b=b.contentWindow?b.contentWindow.document:b.contentDocument.document?b.contentDocument.document:b.contentDocument,b.open(),b.write(d),b.close();else return this._onRendererFailed(a.ERROR_NULL_ASSET,"Empty URL and content"),!1;return!0},presentInline:function(){this.log("presentInline");this.isInterstitialNow=!1;var b=this.defaultAdElement;if(b){var c=this._rendererController.getAdInstance(),d=c.getSlot(),e=d.getTimePositionClass(),f=
d.getWidth(),k=d.getHeight(),g=d.getVideoDisplaySize().width;d=d.getVideoDisplaySize().height;var n=c.getActiveCreativeRendition();c=n.getWidth();n=n.getHeight();b.scrolling="no";b.style.overflow="hidden";switch(e){case a.TIME_POSITION_CLASS_DISPLAY:b.style.position="";b.style.background=this.shouldBackgroundTransparent?"transparent":"";b.style.left="0px";b.style.top="0px";b.style.width=(c?c:f)+"px";b.style.height=(n?n:k)+"px";break;case a.TIME_POSITION_CLASS_OVERLAY:b.style.position="absolute";b.style.background=
this.shouldBackgroundTransparent?"transparent":"white";this._layoutOverlayAd(b);break;default:b.style.position="absolute",b.style.background=this.shouldBackgroundTransparent?"transparent":"white",b.style.left="0px",b.style.top="0px",b.style.width=g+"px",b.style.height=d+"px"}}},presentInterstitial:function(){this.log("presentInterstitial, defaultExpandWidth: "+this.defaultExpandWidth+", defaultExpandHeight: "+this.defaultExpandHeight+", this.mraid.expandWidth: "+this.mraid.expandWidth+", this.mraid.expandHeight: "+
this.mraid.expandHeight+", (Math.max(0, this.defaultExpandWidth - this.mraid.expandWidth) / 2) = "+Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+", (Math.max(0, this.defaultExpandHeight - this.mraid.expandHeight) / 2) = "+Math.max(0,this.defaultExpandHeight-this.mraid.expandHeight)/2);if(this.expandedAdElement){this.isInterstitialNow=!0;document.addEventListener&&(document.removeEventListener("touchmove",this.touchMoveDisabler,!1),document.addEventListener("touchmove",this.touchMoveDisabler,
!1));var b=this.expandedAdElement.parentNode;this.expandedLightbox||(this.expandedLightbox=document.createElement("div"),this.expandedLightbox.style.background="black",this.expandedLightbox.style.opacity=.8,this.expandedLightbox.style.position="fixed",this.expandedLightbox.style.top="0px",this.expandedLightbox.style.left="0px",this.expandedLightbox.style.zIndex=this.expandedLightbox.style["z-index"]=9999,b.appendChild(this.expandedLightbox));this.expandedLightbox.style.width=this.defaultExpandWidth+
"px";this.expandedLightbox.style.height=this.defaultExpandHeight+"px";this.expandedAdElement.frameBorder="0";this.expandedAdElement.scrolling="no";this.expandedAdElement.style.position="fixed";this.expandedAdElement.style.overflow="hidden";this.expandedAdElement.style.top=this.expandedAdElement.top=Math.max(0,this.defaultExpandHeight-this.mraid.expandHeight)/2+"px";this.expandedAdElement.style.left=this.expandedAdElement.left=Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+"px";this.expandedAdElement.style.width=
this.expandedAdElement.width=this.mraid.expandWidth+"px";this.expandedAdElement.style.height=this.expandedAdElement.height=this.mraid.expandHeight+"px";this.expandedAdElement.style.zIndex=this.expandedAdElement.style["z-index"]=1E4;this.log("presentInterstitial, expanded ad element size: (top, left, width, height) = ("+this.expandedAdElement.top+", "+this.expandedAdElement.left+", "+this.expandedAdElement.width+", "+this.expandedAdElement.height+")");if(this.isMRAIDAd){var c=this.expandedAdElement._fw_closeButton;
c||(c=document.createElement("div"),c.addEventListener?c.addEventListener("click",a.Util.bind(this,function(){this._mraidClose()})):c.attachEvent&&c.attachEvent("onclick",a.Util.bind(this,function(){this._mraidClose()})),c.style.position="fixed",c.style.margin="0px",c.style.padding="0px",c.style.width="25px",c.style.height="25px",c.style.zIndex=c.style["z-index"]=10001,b.appendChild(c),this.expandedAdElement._fw_closeButton=c);c.style.top=this.expandedAdElement.style.top;c.style.left=Math.max(0,this.defaultExpandWidth-
this.mraid.expandWidth)/2+this.mraid.expandWidth-25+"px";c.innerHTML=this.mraid.useCustomClose?0<a.PLATFORM_ANDROID_VERSION?"   ":"":0<a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION?'<img style="width:25px; height:25px; border:0" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4xJREFUeNrMmjFv2kAUxw/IUAZUw4AqJjIxMAQJ9sIHgDYLUqfSBTowJBudAmOnNCNeAitLyVgxxNlBgk+QTKgb6UQHhr7nniNj8PmM3zk86XQZOPt+ee/e+9+dI4zQms1mGTpsb6EVXH42h/YHmqHrukH17kjAiWvQfYT2gfeH2BjaHfYA9hwqCABkobvik9eI/qkIMYB2A0BPSkG4By44hErrQfvhx0MRn/F/Cy3LwjH0yhfZdRSThOhyCI2FZ/iuRrFYjMxmMyMwCEDc8nB6LSsDTBZg7g4GAYj7ANmI0gpeMDEPTxwDhBRMzAXiGrqv7PgMYTSA+eWZtQACvfCTHbedQzYbu4LwOvHolp3q9TorlUpsuVyyfr/P1us16ezi8TirVqtmP5lMzPcIiuepvc5EHT+4doPIZDImhPV3q9UyX0hl+MxOp2O+I5/Ps1qt5pWat4py1CE7Gm4jnf99Sph9z5Lw9gWf845HhLJjtVqx0WhEDuMGgaElYVdbWYuTDbxGYcwiELreskQiwXK5HFssFmyz2ZBA4PoTrA9nFhtCFnu2PCJdL6bTKYlnCCCYfe4WyGc/I4PCEEK8zD3Cw+rxkPjGDIMp2Rl+otRMDGHZaZRvTQ8yv55RBGEKSwQ5C/IEWRiFEGhnMVj1naCbJa9slk6nVUKg/T2h2iyhZywZ4/RCMplUCWFW+hPBsQ0ZjFMhEEOY9SRKLUv3rRnFEHtFI4nhRPelX1xH2FQYOYjf9EsJ8qQSQqVqth8dkYGI6oQK1awExKvYUQlNL5CFSghq1exiCwQxVEOEAGPEYFPyG2QKniS+CWNTRL05w7DSdf2blX7HYe7siD0ztteRm7B3doQww5c9Ow+vspcKRvHXbrfJBCBBmOH13XdnZe95jcKzJmoVK/KMhPV2JAq/UDG8TgJVCEA3GAlvGG5a61JGpmM4UKtYJ4zEs7fmuu8Qu8vU3xEK12EqlXJV0FZIgTe6QhAOcx/kUEKxYUhVZGX8Oft/sX9sNudz2zHXW13wCm6B71m4F6AiwyuECnhj7mtjxQdUKPcrQdStCELoEZtnNO6ZwiuGU8Xr4wE/HwzgJVDY19T49cOlzA9jsk/EC0iQMQ/cM+9C8MIngOjLDjj0o5oGrzVZBWsBa8TA78Cgnznh3QQe6we9j0cpPnTe1IYG4kgIZR5273mvCdIohg6G6TzI5O32T4ABAPsBS28k7apdAAAAAElFTkSuQmCC">':
'<img style="width:25px; height:25px; border:0" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDAwcHgiIGhlaWdodD0iNDAwcHgiIHZpZXdCb3g9IjAgMCA0MDAgNDAwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA0MDAgNDAwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48Y2lyY2xlIGZpbGw9IiM2NjY2NjYiIGN4PSIyMDAuMTM5IiBjeT0iMTk5Ljg2IiByPSIxOTcuODYiLz48cGF0aCBmaWxsPSIjRjBGMEYwIiBzdHJva2U9IiNGMEYwRjAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTExNC44NjUsMzAzLjY0NGMtNi4yMjYsNi4yMjctMTUuMzYzLDcuMTg2LTIwLjQwNywyLjE0NGwtMC41MjItMC41MjJjLTUuMDQzLTUuMDQzLTQuMDgzLTE0LjE4LDIuMTQ0LTIwLjQwN0wyODQuODYsOTYuMDc4YzYuMjI2LTYuMjI3LDE1LjM2Mi03LjE4NiwyMC40MDUtMi4xNDRsMC41MjIsMC41MjFjNS4wNDMsNS4wNDIsNC4wODMsMTQuMTc5LTIuMTQ0LDIwLjQwOEwxMTQuODY1LDMwMy42NDR6Ii8+PHBhdGggZmlsbD0iI0YwRjBGMCIgc3Ryb2tlPSIjRjBGMEYwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0zMDcuODE5LDI4OC42NjZjNS4xNTMsNS4xNTgsNS4wNDgsMTMuNjI0LTAuMjQxLDE4LjkxMWwwLDBjLTUuMjg4LDUuMjg5LTEzLjc1Miw1LjM5My0xOC45MDksMC4yNEw5MS45MDYsMTExLjA1NWMtNS4xNTYtNS4xNTYtNS4wNDgtMTMuNjIzLDAuMjQtMTguOTFsMCwwYzUuMjktNS4yODksMTMuNzU1LTUuMzk2LDE4LjkxMS0wLjI0MUwzMDcuODE5LDI4OC42NjZ6Ii8+PC9zdmc+">'}this.isMRAIDAd||
this._rendererController.requestContentStateChange(!0)}},_onWindowMessageReceived:function(b){if(this.defaultAdElement&&(b.source===this.defaultAdElement.contentWindow||this.expandedAdElement&&b.source===this.expandedAdElement.contentWindow)){this.log("_onWindowMessageReceived, event.data:"+b.data+", event.origin:"+b.origin);var c=b.data.toString().split(":");if(c&&2<=c.length&&"fwsdk-invoke"===c[0]){var d=c[1];if((c=c.slice(2))&&0<c.length){for(var e=0;e<c.length;e++)c[e]=decodeURIComponent(c[e]);
1===c.length&&(c=c[0])}else c=null;if("iframe_ready"===d){if(this.onLoadFunc&&b.source===this.defaultAdElement.contentWindow&&this.defaultAdElement!==this.expandedAdElement)this.onLoadFunc();c&&(c=a.Util.trim(c))&&this.isMRAIDAd&&(this.mraid.baseUrl=c);this.bootstrap&&b.source.postMessage("fwsdk-bounce:"+this.bootstrap,b.origin);b.source.postMessage('fwsdk-bounce:mraid._messagingModel = "postMessage"',b.origin);this.isMRAIDAd&&(b.source===this.defaultAdElement.contentWindow&&this.shouldPauseContentWhenStart&&
this._rendererController.requestContentStateChange(!0),this.mraid.inLoadingState()?this.mraid.state=this.mraid.STATEDEFAULT:this.expandedAdElement&&b.source===this.expandedAdElement.contentWindow&&this.mraid.pushData())}else this.isMRAIDAd?this._mraidMethods(d,c):"close"===d&&this._stop()}}},_mraidMethods:function(b,c){if(b&&this.isMRAIDAd)switch(this.log("_mraidMethods("+b+", "+c+")"),b){case "open":"string"===typeof c?this._mraidOpen(c):2<=c.length&&this._mraidOpen(c[0],a.Util.str2bool(c[1]));break;
case "close":this._mraidClose();break;case "expand":this._mraidExpand(c);break;case "useCustomClose":c&&0<c.length?this.mraid.useCustomClose=a.Util.str2bool(c):this.warn("Invalid parameter to useCustomClose");break;case "setExpandProperties":if(!c)break;this.requestedExpandWidth=Number(c[0]);this.requestedExpandHeight=Number(c[1]);if(!this.requestedExpandWidth||!this.requestedExpandHeight||this.requestedExpandWidth===this.defaultExpandWidth&&this.requestedExpandHeight===this.defaultExpandHeight)this.requestedExpandHeight=
this.requestedExpandWidth=0;this.mraid.useCustomClose=a.Util.str2bool(c[2]);this.requestedExpandWidth===this.mraid.expandWidth&&this.requestedExpandHeight===this.mraid.expandHeight||this.mraid.pushData();break;case "log":this.log("MRAID log:"+c);break;default:this.warn("Unknown MRAID function call: "+b+" with param:"+c)}},_mraidOpen:function(b,c){this.log("_mraidOpen("+b+"), baseUrl: "+this.mraid.baseUrl+", absolute Url: "+(b=a.Util.getAbsoluteUrl(this.mraid.baseUrl,b)));b&&"string"===typeof b&&0<
b.length?((c||"undefined"===typeof c)&&window.open(b),this._rendererController.processEvent({name:a.EVENT_AD_CLICK,info:{showBrowser:!1}})):this.warn("_mraidOpen: url required for open")},_mraidClose:function(){this.log("_mraidClose, current state: "+this.mraid.state);if(this.mraid.inExpandedState()){window.removeEventListener&&document.removeEventListener("touchmove",this.touchMoveDisabler,!1);var a=this.expandedAdElement,c=this.expandedAdElement._fw_closeButton;this.expandedAdElement._fw_closeButton=
null;var d=this.expandedAdElement.parentNode;this.mraid.state=this.mraid.STATEDEFAULT;this.expandedLightbox&&(d.removeChild(this.expandedLightbox),this.expandedLightbox=null);a!==this.defaultAdElement&&(a.style.display="hidden",window.setTimeout(function(){d.removeChild(a)},50));d.removeChild(c)}else this.mraid.inDefaultState()?this.mraid.state=this.mraid.STATEHIDDEN:this.warn("_mraidClose: close() is only valid when in expanded/default state")},_mraidExpand:function(b){this.log("_mraidExpand, current state: "+
this.mraid.state);if(this.mraid.inDefaultState())if(this.shouldKeepInterstitial)this.warn("_mraidExpand: expand() is only valid for inline ad");else{if(b){var c=document.createElement("iframe"),d=a.Util.getAbsoluteUrl(this.mraid.baseUrl,b);this.shouldBackgroundTransparent&&(c.allowTransparency="true",c.style["background-color"]="rgba(255,255,255,0)");(this.defaultAdElementContainer||this.defaultAdElement.parentNode).appendChild(c);this.expandedAdElement=c;this.log("_mraidExpand("+b+"), baseUrl:"+
this.mraid.baseUrl+", absolute Url"+d);this._fillAdNode(c,d,null)}this.mraid.state=this.mraid.STATEEXPANDED;this.isInterstitialNow=!0;this._onViewportResizeScroll()}else this.warn("_mraidExpand: expand() is only valid when in default state")},_onViewportResizeScroll:function(){var b=a.Util.getViewport();this.defaultExpandWidth=b.width;this.defaultExpandHeight=b.height;this.isInterstitialNow&&this.presentInterstitial()},log:function(b){var c=this._rendererController.getAdInstance().getSlot();a.log("HTMLRenderer["+
c+"]\t"+b)},warn:function(b){var c=this._rendererController.getAdInstance().getSlot();a.warn("HTMLRenderer["+c+"]\t"+b)},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){return this.timer?this.timer.getPlayheadTime():-1},getDuration:function(){return this.timer?this.timer.getDuration():-1},_onRendererFailed:function(b,c,d){var e={};e[a.INFO_KEY_ERROR_MODULE]="HTMLRenderer";e[a.INFO_KEY_ERROR_CODE]=b;this._rendererController.getAdInstance().getSlot().getTimePositionClass()===
a.TIME_POSITION_CLASS_OVERLAY?d||(d=a.ERROR_VAST_NON_LINEAR_GENERAL_ERROR):this._rendererController.getAdInstance().getSlot().getTimePositionClass()!==a.TIME_POSITION_CLASS_DISPLAY||d||(d=a.ERROR_VAST_COMPANION_GENERAL_ERROR);d&&(e[a.INFO_KEY_VAST_ERROR_CODE]=d);c&&(e[a.INFO_KEY_ERROR_INFO]=c);this._rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,e)}};a.HTMLRenderer.prototype.constructor=a.HTMLRenderer;a.PauseAdExtension=function(){this._context=null;this.linearSlotToPauseSlotsMap=
{};this.currentPlayingPauseSlotCustomId=this.toBePlayedPauseSlotCustomId=null;this.needDispatchContentResumeEvent=!1};a.PauseAdExtension.prototype={init:function(b){a.debug("PauseAdExtension.init(context)");this._context=b;this._onRequestComplete=a.Util.bind(this,function(b){a.debug("PauseAdExtension._onRequestComplete");if(a.Util.getBooleanParameter(a.PARAMETER_EXTENSION_PAUSE_AD_ENABLE,!0))if(b.success){b=this._context.getTemporalSlots();for(var c=b.filter(function(a){return a.isPauseSlot()}),e=
0;e<b.length;e++){var f=b[e];if(f.getTimePositionClass()===a.TIME_POSITION_CLASS_PREROLL||f.getTimePositionClass()===a.TIME_POSITION_CLASS_MIDROLL){for(var k=[],g=0;g<c.length;g++){var n=c[g];n.getTimePosition()===f.getTimePosition()&&k.push(n.getCustomId())}0<k.length&&(this.linearSlotToPauseSlotsMap[f.getCustomId()]=k)}}for(e=0;e<c.length;e++)if(f=c[e],0===f.getTimePosition()){this.toBePlayedPauseSlotCustomId=f.getCustomId();break}a.debug("PauseAdExtension: toBePlayedPauseSlotCustomId:"+this.toBePlayedPauseSlotCustomId);
this._context.addEventListener(a.EVENT_SLOT_STARTED,this._onSlotStarted);this._context.addEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded);this._context.addEventListener(a.EVENT_AD,this._onAdEvent)}else a.debug("PauseAdExtension: request complete failed");else a.debug("PauseAdExtension: return since PauseAdExtension is disabled")});this._onSlotStarted=a.Util.bind(this,function(b){a.debug("PauseAdExtension._onSlotStarted");b=b.slot;var c=this.linearSlotToPauseSlotsMap[b.getCustomId()];c?(a.debug("PauseAdExtension: setting pause slot to follow after preroll or midroll"),
this.toBePlayedPauseSlotCustomId=c[Math.floor(Math.random()*Math.floor(Math.pow(2,32)+1))%c.length]):b.getTimePositionClass()===a.TIME_POSITION_CLASS_PAUSE_MIDROLL&&(this.currentPlayingPauseSlotCustomId=b.getCustomId())});this._onSlotEnded=a.Util.bind(this,function(b){a.debug("PauseAdExtension._onSlotEnded");this.needDispatchContentResumeEvent&&this.currentPlayingPauseSlotCustomId===b.slot.getCustomId()&&(this.needDispatchContentResumeEvent=!1,this.currentPlayingPauseSlotCustomId=null,a.debug("PauseAdExtension: _requestContentVideoToResumeBySlot",
b.slot.getCustomId()),this._context._requestContentVideoToResumeBySlot(b.slot))});this._onUserActionNotified=a.Util.bind(this,function(b){a.debug("PauseAdExtension._onUserActionNotified");b=b.action;if(b===a.EVENT_USER_ACTION_PAUSE_BUTTON_CLICKED){if(a.debug("PauseAdExtension: pauseButtonClicked"),b=this._context.getSlotByCustomId(this.toBePlayedPauseSlotCustomId))a.debug("PauseAdExtension: slot.play: "+this.toBePlayedPauseSlotCustomId),b.play()}else if(b===a.EVENT_USER_ACTION_RESUME_BUTTON_CLICKED)if(a.debug("PauseAdExtension: resumeButtonClicked"),
this.currentPlayingPauseSlotCustomId){if(b=this._context.getSlotByCustomId(this.currentPlayingPauseSlotCustomId))a.debug("PauseAdExtension: slot.stop: "+this.currentPlayingPauseSlotCustomId),b.stop(),this.needDispatchContentResumeEvent=!1,this.currentPlayingPauseSlotCustomId=null}else a.debug("PauseAdExtension: Current playing pause slot id was empty. No slot to stop.");else a.debug("PauseAdExtension: No valid user action was provided.")});this._onAdEvent=a.Util.bind(this,function(b){b.subType&&b.subType===
a.EVENT_AD_IMPRESSION?(a.debug("PauseAdExtension._onAdEvent impression fired"),this.currentPlayingPauseSlotCustomId===b.slot.getCustomId()&&(this.needDispatchContentResumeEvent=!0)):b.subType&&b.subType===tv.freewheel.SDK.EVENT_ERROR&&(a.debug("PauseAdExtension._onAdEvent error fired"),this.currentPlayingPauseSlotCustomId===b.slot.getCustomId()&&(this.needDispatchContentResumeEvent=!1))});this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete);this._context.addEventListener(a.EVENT_USER_ACTION_NOTIFIED,
this._onUserActionNotified)},dispose:function(){a.debug("PauseAdExtension.dispose()");this._context&&(this._context.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete),this._context.removeEventListener(a.EVENT_USER_ACTION_NOTIFIED,this._onUserActionNotified),this._context.removeEventListener(a.EVENT_AD,this._onAdEvent),this._context.removeEventListener(a.EVENT_SLOT_STARTED,this._onSlotStarted),this._context.removeEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._context=
null)}};a.PauseAdExtension.prototype.constructor=a.PauseAdExtension;a.CustomPlayerRenderer=function(){this._adListener=this._customPlayer=this._rendererController=null;this._quartileSent=0;this._isPaused=this._isStarted=!1;this._timeoutTracker=null;this._lastPlayheadTime=0;this._timeUpdatePollingIntervalInMs=250};a.CustomPlayerRenderer.prototype={pause:function(){this._isPaused=!0;this._rendererController&&this._rendererController.processEvent({name:a.EVENT_AD_PAUSE});this._customPlayer&&this._customPlayer.playPause(!0)},
resume:function(){this._isPaused=!1;this._rendererController&&this._rendererController.processEvent({name:a.EVENT_AD_RESUME});this._customPlayer&&this._customPlayer.playPause(!1)},start:function(b){this._rendererController=b;if(this._customPlayer=this._rendererController.getCustomPlayer()){b=this._rendererController.getAdInstance();var c=b.getSlot();a.log("CustomPlayerRenderer.start",c.getTimePositionClass(),b);var d=c.getVideoDisplaySize().width,e=c.getVideoDisplaySize().height;c=b.getRenderableCreativeRenditions();
if((e=(d=(new a.RenditionSelector(this._rendererController.getParameter(a.PARAMETER_DESIRED_BITRATE)||1E3,this._rendererController.getParameter("arWeight")||1,this._rendererController.getParameter("pxWeight")||1,.2)).getCustomPlayerBestFitRendition(c,d,e))?d.getPrimaryCreativeRenditionAsset():null)&&c.length)if(c=e.getProxiedUrl()){b.setActiveCreativeRendition(d);a.log("CustomPlayerRenderer.start selected rendition is:",c);this._rendererController.setCapability(a.EVENT_AD_QUARTILE,a.CAPABILITY_STATUS_ON);
this._rendererController.setCapability(a.EVENT_AD_MUTE,a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_PAUSE,a.CAPABILITY_STATUS_ON);b=this._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_CLICK_DETECTION);if(null===b||"undefined"===typeof b)b="false";!1===a.Util.str2bool(b)?this._rendererController.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF):this._rendererController.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_ON);this._adListener=new a.AdListener(this);
b=this._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT)||5E3;this._progressTimeoutInMs=this._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT)||8E3;this._onTimeout=a.Util.bind(this,function(a){this._adListener.onError(a)});this._timeoutTracker=setTimeout(this._onTimeout,b,b+" ms custom player timeout before playing");this._quartileTimerId=setInterval(a.Util.bind(this,this._pollForAdVideoTimeUpdate),this._timeUpdatePollingIntervalInMs);
a.log("CustomPlayerRenderer will play video ad: "+c);this._customPlayer.open(d,this._adListener)}else this._onRendererFailed(a.ERROR_NULL_ASSET);else this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"no compatible asset")}else this._onRendererFailed(a.ERROR_UNKNOWN,"custom player was null")},_pollForAdVideoTimeUpdate:function(){var b=this._customPlayer.getPlayheadTime(),c=this._customPlayer.getDuration();"number"===typeof b&&"number"===typeof c&&(0>=b||0>=c?a.debug("CustomPlayerRenderer._pollForAdVideoTimeUpdate currentTime or duration is less than or 0"):
(this._isStarted||(this._isStarted=!0,this._rendererController.getAdInstance().adjustOffsetAndProgressWithRendererDuration(c),this._rendererController.handleStateTransition(a.RENDERER_STATE_STARTED)),this._rendererController&&(this._rendererController.checkProgress(b),this._rendererController.checkForSkippableStateChange()),b>this._lastPlayheadTime&&(this._clearTimeoutTracker(),this._lastPlayheadTime=b,this._isPaused||(this._timeoutTracker=setTimeout(this._onTimeout,this._progressTimeoutInMs,this._progressTimeoutInMs+
" ms custom player timeout when playing"))),b>=.25*c&&1>this._quartileSent&&(this._quartileSent=1,this._rendererController.processEvent({name:a.EVENT_AD_FIRST_QUARTILE})),b>=.5*c&&2>this._quartileSent&&(this._quartileSent=2,this._rendererController.processEvent({name:a.EVENT_AD_MIDPOINT})),b>=.75*c&&3>this._quartileSent&&(this._quartileSent=3,this._rendererController.processEvent({name:a.EVENT_AD_THIRD_QUARTILE})),b>=c-.5&&4>this._quartileSent&&(this._rendererController.checkProgress(c),this._quartileSent=
4,this._rendererController.processEvent({name:a.EVENT_AD_COMPLETE}))))},_onEnded:function(b){a.debug("CustomPlayerRenderer._onEnded");this._pollForAdVideoTimeUpdate();this._clearTimeoutTracker();this._clearQuartileTimer();this._customPlayer=null;this._adListener=this._adListener._customPlayerRenderer=null;if(b){var c=a.ERROR_CUSTOM_PLAYER;b.includes("timeout")&&(c=a.ERROR_TIMEOUT);this._onRendererFailed(c,b)}else this._rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED);this._rendererController=
null},stop:function(){a.debug("CustomPlayerRenderer.stop");this._customPlayer&&this._customPlayer.playPause(!0);this._onEnded()},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){return this._customPlayer?this._customPlayer.getPlayheadTime():-1},getDuration:function(){return this._customPlayer?this._customPlayer.getDuration():-1},setVolume:function(b){a.warn("setVolume is not supported at this time")},_getClickThroughUrls:function(){var b=this._rendererController.getAdInstance().getEventCallback(a.EVENT_AD_CLICK,
a.EVENT_TYPE_CLICK);return[].concat(b._url,b._trackingUrls)},_clearTimeoutTracker:function(){this._timeoutTracker&&(clearTimeout(this._timeoutTracker),this._timeoutTracker=null)},_clearQuartileTimer:function(){this._quartileTimerId&&(clearInterval(this._quartileTimerId),this._quartileTimerId=null)},_onRendererFailed:function(b,c){var d={};d[a.INFO_KEY_ERROR_MODULE]="CustomPlayerRenderer";d[a.INFO_KEY_ERROR_CODE]=b;c&&(d[a.INFO_KEY_ERROR_INFO]=c);this._rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,
d)}};a.CustomPlayerRenderer.prototype.constructor=a.CustomPlayerRenderer;a.AdListener=function(a){this._customPlayerRenderer=a};a.AdListener.prototype={onEnded:function(){a.debug("AdListener.onEnded");this._customPlayerRenderer._onEnded()},onError:function(b){a.warn("AdListener.onError:",b);this._customPlayerRenderer._onEnded(b)},getClickThroughUrls:function(){return this._customPlayerRenderer._getClickThroughUrls()}};a.AdListener.prototype.constructor=a.AdListener;a.Timer=function(a,c){this._lastTickDate=
new Date;this._duration=a||-1;this._playheadTime=-1;this._callback=c;this._state=-1};a.Timer.prototype={};a.Timer.prototype.constructor=a.Timer;a.Util.mixin(a.Timer.prototype,{tick:function(){var a=new Date,c=Math.round((a.getTime()-this._lastTickDate.getTime())/1E3);this._lastTickDate=a;return c},start:function(){if(0!==this._state){if(2===this._state||-1===this._playheadTime)this._playheadTime=0;this._state=0;this._timeStamp=new Date;this._timeouter&&(window.clearTimeout(this._timeouter),this._timeouter=
null);var a=this,c=1E3*(this._duration-this._playheadTime);0>c||(this._timeouter=window.setTimeout(function(){a.stop();a._playheadTime=a._duration;a._callback&&a._callback()},c))}},pause:function(){0===this._state&&(this._state=1,this._timeouter&&(window.clearTimeout(this._timeouter),this._timeouter=null),this._playheadTime=(new Date-this._timeStamp)/1E3+this._playheadTime)},stop:function(){this._state=2;this._timeouter&&(window.clearTimeout(this._timeouter),this._timeouter=null);this._playheadTime=
(new Date-this._timeStamp)/1E3+this._playheadTime},getPlayheadTime:function(){return 0===this._state?(new Date-this._timeStamp)/1E3+this._playheadTime:this._playheadTime},getCTValue:function(){return(new Date-this._timeStamp)/1E3},getDuration:function(){return this._duration}});a.RendererController=function(b,c){var d=null,e=null,f={},k=a.RendererInitState.instance,g={},n=[],z=0,C=!1,A=!1,q=[];return{getAdInstance:function(){return c},getContext:function(){return b},getRendererState:function(){return k},
processEvent:function(b){var d=b.name;if(d===a.RENDERER_STATE_STARTED||d===a.RENDERER_STATE_COMPLETING||d===a.RENDERER_STATE_COMPLETED||d===a.RENDERER_STATE_FAILED)this.handleStateTransition(d,b.info);else{var e=this._inferEventType(d);if(e&&(e===a.EVENT_TYPE_CLICK&&b.info&&b.info[a.INFO_KEY_CUSTOM_EVENT_NAME]&&(d=b.info[a.INFO_KEY_CUSTOM_EVENT_NAME]),d!==a.EVENT_AD_MEASUREMENT||b.info[a.INFO_KEY_CONCRETE_EVENT_ID])){var f=d===a.EVENT_AD_INITIATED||d===a.EVENT_AD_PREINIT||d===a.EVENT_AD_BUFFERING_START||
d===a.EVENT_AD_BUFFERING_END||d===a.EVENT_AD_VOLUME_CHANGE||d===a.EVENT_AD_SKIPPABLE_STATE_CHANGED||b.info&&b.info.hasOwnProperty("apiOnly")&&b.info.apiOnly;c.processEvent(d,e,b.info,f)}}},checkProgress:function(a){for(;0<q.length&&q[0]<a;)c.processProgressEvent(q.shift())},checkForSkippableStateChange:function(){!A&&c&&c.getAdSkippableState()&&(A=!0,this.processEvent({name:a.EVENT_AD_SKIPPABLE_STATE_CHANGED}))},handleStateTransition:function(b,d){switch(b){case a.RENDERER_STATE_STARTED:q=Object.keys(c._progressEventCallbackUrlsDict||
[]).sort(function(a,b){return a-b});d&&d[a.INFO_KEY_START_TIME_POSITION]&&c.setStartTimePosition(d[a.INFO_KEY_START_TIME_POSITION]);k.notifyStarted(this);break;case a.RENDERER_STATE_COMPLETING:k.complete(this);break;case a.RENDERER_STATE_COMPLETED:k.complete(this);k.notifyCompleted(this);break;case a.RENDERER_STATE_FAILED:c.getSlot()._clearScheduledAdInstance();d||(d={});a.warn("FAIL",", FW ErrorModule:",d[a.INFO_KEY_ERROR_MODULE],", FW ErrorCode:",d[a.INFO_KEY_ERROR_CODE],", FW ErrorInfo:",d[a.INFO_KEY_ERROR_INFO],
", VAST ErrorCode:",d[a.INFO_KEY_VAST_ERROR_CODE]);(b=c.processEvent(a.EVENT_ERROR,a.EVENT_TYPE_ERROR,d))||a.debug("No EVENT_ERROR callback found");if(d)switch(d[a.INFO_KEY_ERROR_CODE]){case a.ERROR_NO_AD_AVAILABLE:case a.ERROR_PARSE:(b=c.processEvent(a.EVENT_RESELLER_NO_AD,a.EVENT_TYPE_IMPRESSION))||a.debug("No EVENT_RESELLER_NO_AD callback found.")}k.fail(this);break;default:a.debug("Unknown event received",b)}},setCapability:function(a,b){c.setMetr(a,b)},getVersion:function(){return b._adManager.getVersion()},
getParameter:function(a){if(!a)return null;if(b._overrideLevelParameterDictionary.hasOwnProperty(a))return b._overrideLevelParameterDictionary[a];if(c.getActiveCreativeRendition()&&"undefined"!==typeof c.getActiveCreativeRendition().getParameter(a))return c.getActiveCreativeRendition().getParameter(a);var d=c._creative;return d&&"undefined"!==typeof d.getParameter(a)?d.getParameter(a):"undefined"!==typeof c.getSlot().getParameter(a)?c.getSlot().getParameter(a):b._adResponse._profileParameters.hasOwnProperty(a)?
b._adResponse._profileParameters[a]:b._globalLevelParameterDictionary.hasOwnProperty(a)?b._globalLevelParameterDictionary[a]:f&&f.hasOwnProperty(a)?f[a]:null},getCompanionSlots:function(){for(var a=[],b=c._companionAdInstances,d=0;d<b.length;d++)b[d].isPlaceholder()&&a.push(b[d].getSlot());return a},createNullDrivingAdInstance:function(){var a=c.getSlot().scheduleAdInstance();a.addCreativeRendition().setContentType("null/null");return a},scheduleAdInstances:function(a){var b,d=[],e=null;a=a||[];if(0===
a.length)return d;for(b=0;b<a.length;b++)a[b].getCustomId()===c.getSlot().getCustomId()&&(e=c.getSlot().scheduleAdInstance());if(!e)if(this.isTranslator())e=this.createNullDrivingAdInstance();else if(this.isRenderer())e=c;else return d;for(var f=0;f<a.length;f++){if(a[f].getCustomId()===c.getSlot().getCustomId())e!==c&&d.push(e);else for(var k=0,I=e._companionAdInstances;k<I.length;k++)if(b=I[k],a[f]===b.getSlot()){if(this.isTranslator())d.push(b);else if(this.isRenderer()&&b.isPlaceholder()){var h=
b.cloneForTranslation();e===c&&(g[h]=b);I[k]=h;d.push(h);n.push(h)}break}d.length<=f&&d.push(null)}return d},commitAdInstance:function(){if(this.isRenderer()&&c.isStarted()){for(var b=0;b<n.length;b++){var d=n[b];d&&d.getSlot().playCompanionAds(d)}n=[]}else a.warn("Skipping RendererController.commitAdInstance when called with driving ad not started or completed.")},isRenderer:function(){return d&&a.MODULE_TYPE_RENDERER===d.info()[a.INFO_KEY_MODULE_TYPE]},isTranslator:function(){return d&&a.MODULE_TYPE_TRANSLATOR===
d.info()[a.INFO_KEY_MODULE_TYPE]},playable:function(){return k===a.RendererInitState.instance},reset:function(){k=a.RendererInitState.instance},play:function(){for(var a=c.getRenderableCreativeRenditions()||[],b=null,d=0;d<a.length;d++){var e=a[d];if(b=this._matchRendererClassName(e)){c.setActiveCreativeRendition(e);break}}0===z&&this._actualPlay(b)},_actualPlay:function(b){(e=a.Util.getObject(b)||a.Util.getObject(h+"."+b))&&(d=new e);d?(C||this.isTranslator()||(C=!0,this.processEvent({name:a.EVENT_AD_PREINIT}),
a.debug("Fired preInit for: "+b)),k.start(this)):this.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_NO_RENDERER,errorInfo:"Renderer class <"+b+"> not found"})},dispatchEvent:function(a,c){b.dispatchEvent(a,c)},requestContentStateChange:function(a){a?b._requestContentVideoToPauseBySlot(c.getSlot()):b._requestContentVideoToResumeBySlot(c.getSlot())},getRenderer:function(){return d},setRenderer:function(a){d=a},setRendererState:function(a){k=a},getContentVideoElement:function(){return b.getContentVideoElement()},
getCustomPlayer:function(){return b.getCustomPlayer()},_restorePlaceholdersForHybrid:function(){if(g&&this.isRenderer()){for(var a=[],b=0;b<c._companionAdInstances.length;b++){var d=c._companionAdInstances[b],e=g[d];e?a.push(e):a.push(d)}c._companionAdInstances=a}0<n.length&&this.isRenderer()&&(n=[])},rendererMatch:function(b){return e?e===a.Util.getObject(this._matchRendererClassName(b)):!0},_matchRendererClassName:function(d){function e(b,c,d){a.debug("matching "+b+" within "+c);if(!c)return!0;
c=c.split(",");c[c.length-1]||c.pop();if(d){b=b.toLowerCase();for(d=0;d<c.length;d++)if(b===c[d].toLowerCase())return!0;a.debug("not match");return!1}(c=0<=c.indexOf(b))||a.debug("not match");return c}var g=d.getPrimaryCreativeRenditionAsset().getContentType(),k=d.getContentType(),n=d.getWrapperType(),I=d.getCreativeApi(),C=d.getBaseUnit(),A=c.getSoAdUnit(),q=c.getSlot(),l=q.getType();q=q.getTimePositionClass();a.debug("match renderer for creativeRendition:"+d.getId());a.debug("slot type:"+l);if(a.Util.isBlank(k)&&
a.Util.isBlank(n))return a.warn("renderer not match due to both contentType and wrapperType are empty"),null;var t=b._rendererManifest["*"];t||(t=b._rendererManifest[n]);t||(t=b._rendererManifest[k]);if(!t){l=b._overriddenAdRenderers.concat(b._adResponse._adRenderers);for(var F=0;F<l.length;F++){var u=l[F],w=!u.contentType;w||(n?w=e(n,u.contentType,!0):(g&&(w=e(g,u.contentType,!0)),w||(w=e(k,u.contentType,!0))));if(w)if((w=!u.creativeApi)||(w=e(I,u.creativeApi)),w)if(u.baseUnit&&!e(C,u.baseUnit))a.debug("can't match renderer "+
u.url+" due to baseUnit not match for creativeRendition:"+d.getId());else if(u.soAdUnit&&!e(A,u.soAdUnit))a.debug("can't match renderer "+u.url+" due to soAdUnit not match for creativeRendition:"+d.getId());else if(u.slotType&&!e(q.toUpperCase(),u.slotType.toUpperCase()))a.debug("can't match renderer "+u.url+" due to slotType not match for creativeRendition:"+d.getId());else if("class://DashRenderer"===u.url&&void 0===window.tv.freewheel.Dashjs)a.debug("can't match renderer "+u.url+" due to missing tv.freewheel.Dash.js for creativeRendition:"+
d.getId());else{if(a.debug("renderer "+u.url+" matched for creativeRendition:"+d.getId()),u.url){t=u.url;d=t.indexOf("?");-1!==d&&(t=t.substring(0,d));d=t.lastIndexOf("/");-1!==d&&(t=t.substring(d+1));d=t.lastIndexOf(".js");-1!==d&&(t=t.substring(0,d));var v={};if(u.parameter)for(d=[].concat(u.parameter),g=0;g<d.length;g++)if(d[g].hasOwnProperty("name"))v[d[g].name]=d[g].value;else for(var G in d[g])d[g].hasOwnProperty(G)&&(v[G]=d[g][G]);a.Util.getObject(h+"."+t)&&(t=h+"."+t);if(a.Util.getObject(t))f=
v,z=0;else{if(0<z)break;var y=this;G=1*this.getContext().getParameter("moduleLoadTimeout")||6E4;z=window.setTimeout(function(){z=-1;y.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_NO_RENDERER,errorInfo:"Load renderer timeout, URL:"+u.url})},G);a.Util.lazyJavaScriptLoad(u.url,function(){a.log("async load renderer successful, URL:"+u.url);-1===z?a.debug("renderer loaded after timeout. WILL NOT PLAY."):(window.clearTimeout(z),z=0,f=v,y._actualPlay(t))})}break}}else a.debug("can't match renderer "+
u.url+" due to creative api not match for creativeRendition:"+d.getId());else a.debug("can't match renderer "+u.url+" due to contentType not match for creativeRendition:"+d.getId())}}return t?t:a.Util.isBlank(n)?"null/null"===k?h+".NullRenderer":null:null},_inferEventType:function(b){return b===a.EVENT_ERROR?a.EVENT_TYPE_ERROR:b===a.EVENT_AD_CLICK?a.EVENT_TYPE_CLICK:b===a.EVENT_AD_IMPRESSION||b===a.EVENT_AD_FIRST_QUARTILE||b===a.EVENT_AD_MIDPOINT||b===a.EVENT_AD_THIRD_QUARTILE||b===a.EVENT_AD_COMPLETE||
b===a.EVENT_RESELLER_NO_AD?a.EVENT_TYPE_IMPRESSION:b===a.EVENT_AD_PAUSE||b===a.EVENT_AD_RESUME||b===a.EVENT_AD_REWIND||b===a.EVENT_AD_MUTE||b===a.EVENT_AD_UNMUTE||b===a.EVENT_AD_COLLAPSE||b===a.EVENT_AD_EXPAND||b===a.EVENT_AD_MINIMIZE||b===a.EVENT_AD_CLOSE||b===a.EVENT_AD_ACCEPT_INVITATION||b===a.EVENT_AD_SKIPPED?a.EVENT_TYPE_STANDARD:b===a.EVENT_AD_MEASUREMENT||b===a.EVENT_AD_VOLUME_CHANGE||b===a.EVENT_AD_BUFFERING_START||b===a.EVENT_AD_BUFFERING_END||b===a.EVENT_AD_INITIATED||b===a.EVENT_AD_PREINIT||
b===a.EVENT_AD_AUTO_PLAY_BLOCKED||b===a.EVENT_AD_SKIPPABLE_STATE_CHANGED?a.EVENT_TYPE_GENERIC:null},pause:function(){a.log("RendererController.pause");d&&"function"===typeof d.pause?d.pause():a.log("Renderer.pause() is not implemented.")},resume:function(){a.log("RendererController.resume");d&&"function"===typeof d.resume?d.resume():a.log("Renderer.resume() is not implemented.")},stop:function(){a.log("RendererController.stop");0<z&&(z=-1);k.stop(this)}}};a.VideoStateExtension=function(){};a.VideoStateExtension.prototype=
{_enabled:function(){if(null==this._context)return!1;var b=this._context.getParameter(a.PARAMETER_EXTENSION_VIDEO_STATE_ENABLED);null==b&&(b="false");return!0===a.Util.str2bool(b)},init:function(b){this._context=b;this._enabled()?this._context.setVideoState(a.VIDEO_STATE_PLAYING):a.log("VideoStateExtension is disabled.")},dispose:function(){this._context=null}};a.VideoStateExtension.prototype.constructor=a.VideoStateExtension;a.AdResponse=function(a){this._context=a};a.AdResponse.prototype={};a.AdResponse.prototype.constructor=
a.AdResponse;a.Util.mixin(a.AdResponse.prototype,{parse:function(b,c){this._data=b;this._temporalSlots=[];this._videoPlayerNonTemporalSlots=[];this._siteSectionNonTemporalSlots=[];this._profileParameters={};this._ads=[];this._siteSectionCustomId=a.Util.getObject("siteSection.customId",b)||"";this._adRenderers=[];var d;var e=a.Util.getObject("parameters",b)||[];for(d=0;d<e.length;++d){var f=e[d];this._profileParameters[f.name]=f.value}this._adRenderers=a.Util.getObject("rendererManifest.adRenderers.adRenderer",
b)||[];for(d=0;d<this._adRenderers.length;d++)"undefined"!==typeof this._adRenderers[d].adUnit&&(this._adRenderers[d].baseUnit=this._adRenderers[d].adUnit,delete this._adRenderers[d].adUnit);e=a.Util.getObject("ads.ads",b)||[];for(d=0;d<e.length;++d)f=new a.Ad(this._context),f.parse(e[d]),this._ads.push(f);e=a.Util.getObject("siteSection.videoPlayer.videoAsset.adSlots",b)||[];for(d=0;d<e.length;++d)f=new a.Slot(this._context),f.setType(a.SLOT_TYPE_TEMPORAL),f.setBase(c),f.parse(e[d]),this._temporalSlots.push(f);
e=a.Util.getObject("siteSection.videoPlayer.adSlots",b)||[];for(d=0;d<e.length;++d)f=new a.Slot(this._context),f.setType(a.SLOT_TYPE_VIDEOPLAYER_NONTEMPORAL),f.setTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),f.parse(e[d]),this._initSlotData(f),this._videoPlayerNonTemporalSlots.push(f);e=a.Util.getObject("siteSection.adSlots",b)||[];for(d=0;d<e.length;++d)f=new a.Slot(this._context),f.setType(a.SLOT_TYPE_SITESECTION_NONTEMPORAL),f.setTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),f.parse(e[d]),
this._initSlotData(f),this._siteSectionNonTemporalSlots.push(f);b=a.Util.getObject("siteSection.videoPlayer.videoAsset",b)||{};this._context._videoAsset.parse(b)},getCreative:function(a,c){return(a=this.getAd(a))?a.getCreative(c):null},getAd:function(a){for(var b=0;b<this._ads.length;b++){var d=this._ads[b];if(d.getId()===a)return d}return null},getTemporalSlots:function(){return this._temporalSlots},getSiteSectionNonTemporalSlots:function(){return this._siteSectionNonTemporalSlots},getVideoPlayerNonTemporalSlots:function(){return this._videoPlayerNonTemporalSlots},
getSiteSectionCustomId:function(){return this._siteSectionCustomId},getSlotByCustomId:function(b){for(var c=0;c<this._temporalSlots.length;++c)if(this._temporalSlots[c].getCustomId()===b)return this._temporalSlots[c];for(c=0;c<this._videoPlayerNonTemporalSlots.length;++c)if(this._videoPlayerNonTemporalSlots[c].getCustomId()===b)return this._videoPlayerNonTemporalSlots[c];for(c=0;c<this._siteSectionNonTemporalSlots.length;++c)if(this._siteSectionNonTemporalSlots[c].getCustomId()===b)return this._siteSectionNonTemporalSlots[c];
a.warn("getSlotByCustomId(): not found",b);return null},_initSlotData:function(b){for(var c=!1,d=0;d<this._context._adRequest._slotScanner._knownSlots.length;d++){var e=this._context._adRequest._slotScanner._knownSlots[d];if(b.getCustomId()===e.id&&e.element){b.setWidth(e.width);b.setHeight(e.height);b.setBase(e.element);b.setAcceptCompanion(e.acceptCompanion);b.setInitialAdOption(e.initialAdOption);c=!0;break}}c||a.warn("Failed to init slot "+b.getCustomId());return c}});a.Slot=function(b){var c=
"",d=null,e=null,f=null,k=null,g=[],n=[],h={},C=null,A=a.MediaInitState.instance,q=0,l=null,m,r,x,L,M,N,Q,U=0,R=0,t=[],F=null,u=0,w=!1,v=!1,G=!0,y=[],D,K,J=!1;return{getAutoPlayBlocked:function(){return J},setAutoPlayBlocked:function(a){J=a},getSlotProfile:function(){return e},setSlotProfile:function(a){e=a},setMediaState:function(a){A=a},setParameter:function(a,b){null==b?delete h[a]:h[a]=b},getParameter:function(a){if(a&&h.hasOwnProperty(a))return h[a]},getAdCount:function(){return g.length},setCustomId:function(a){c=
a},getCustomId:function(){return c},setAdUnit:function(a){N=a},getAdUnit:function(){return N},setType:function(a){d=a},getType:function(){return d},setTimePosition:function(a){r=a},getTimePosition:function(){return r},getEndTimePosition:function(){return x},setTimePositionClass:function(a){l=a&&a.toUpperCase()},getTimePositionClass:function(){return l},setWidth:function(a){L=a},getWidth:function(){return l!==a.TIME_POSITION_CLASS_DISPLAY?L?L:b.getVideoDisplaySize().width:L},setHeight:function(a){M=
1*a},getHeight:function(){return l!==a.TIME_POSITION_CLASS_DISPLAY?M?M:b.getVideoDisplaySize().height:M},setBase:function(a){m=a},getBase:function(){return m},setCuepointSequence:function(a){Q=1*a?1*a:0},getCuepointSequence:function(){return Q},getVideoDisplaySize:function(){return b.getVideoDisplaySize()},setMaxDuration:function(a){U=1*a?1*a:0},getMaxDuration:function(){return U},setMinDuration:function(a){R=1*a?1*a:0},getMinDuration:function(){return R},setAcceptContentType:function(a){if(a&&a.trim()){a=
a.split(",");for(var b=0;b<a.length;b++)t.push(a[b].trim())}},setSignalId:function(a){a&&a.trim()&&(F=a)},getSignalId:function(){return F},setMaxAds:function(a){u=1*a?1*a:0},getMaxAds:function(){return u},getAcceptContentType:function(){return t.join(",")},parse:function(d){if(d){c=d.customId;r=1*d.timePosition;l=d.timePositionClass&&d.timePositionClass.toUpperCase()||l;var e=1*d.endTimePosition||-1;x=e>=r?e:-1;N=d.adUnit;F=d.signalId;if(void 0===F||null===F)F=d.outSignalId;for(var f=0,k=d.eventCallbacks||
[];f<k.length;f++){e=k[f];var h=a.EventCallback.newEventCallback(b,e.name,e.type);h&&(h._slot=this,h.parse(e),n.push(h))}f=0;for(k=d.selectedAds||[];f<k.length;f++)e=k[f],d=[],h=new a.AdInstance(b),d.push(h),h._slot=this,h._slotCustomId=c,h._parentAdInstancesGroup=d,h.parse(e),g.push(d)}},getCurrentAdInstance:function(){return f},isPauseSlot:function(){return l===a.TIME_POSITION_CLASS_PAUSE_MIDROLL},play:function(c){if(J)a.log("Resuming previously blocked video ad now."),J=!1,b.getContentVideoElement()&&
b.getContentVideoElement().play();else{for(var d=this.getAdInstances(),e=0;e<d.length;e++)d[e]._isSkipped=!1;l!==a.TIME_POSITION_CLASS_DISPLAY||G?(a.log("Slot.play",l),w=!1,l===a.TIME_POSITION_CLASS_DISPLAY&&1<g.length&&g.splice(0,g.length-1),this._play(c)):(a.log("Slot is invisible. Push the play operation to the queue."),y.push({operation:this.play,argument:c}))}},stop:function(){a.log("Slot.stop",l);l===a.TIME_POSITION_CLASS_DISPLAY&&(y=[]);A===a.MediaInitState.instance||A===a.MediaEndState.instance?
a.log("Slot.stop, not start or already end, ignore"):(w=!0,f?f.stop():a.warn("Slot.stop, no _currentAdInstance, ignore"))},pause:function(){a.log("Slot.pause");l!==a.TIME_POSITION_CLASS_DISPLAY?f&&f.pause():a.log("Not a temporal slot. Ignore.")},resume:function(){a.log("Slot.resume");l!==a.TIME_POSITION_CLASS_DISPLAY?f&&f.resume():a.log("Not a temporal slot. Ignore.")},skipCurrentAd:function(){a.log("Slot.skipCurrentAd ",f);f?f.skip():a.log("Slot.skipCurrentAd, no _currentAdInstance, ignore")},setVisible:function(b){if(l!==
a.TIME_POSITION_CLASS_DISPLAY)a.log("Slot.setVisible is only for display ads.");else if(a.log("Slot.setVisible",b),G!==b&&(G=b))for(;0<y.length;)b=y.pop(),b.operation&&b.operation.call(this,b.argument)},_play:function(a){C=C||a;A.play(this)},onStartPlaying:function(){this._onStartPlaying()},onStartReplaying:function(){this._onStartPlaying()},onCompletePlaying:function(){this._onCompletePlaying()},onCompleteReplaying:function(){this._onCompletePlaying()},playNextAdInstance:function(){a.log("Slot.playNextAdInstance ",
l);this._playNextAdInstance()||A.complete(this)},scheduleAdInstance:function(){return k=f.cloneForTranslation()},_clearScheduledAdInstance:function(){k=null},_onStartPlaying:function(){l===a.TIME_POSITION_CLASS_MIDROLL&&0<g.length&&b._requestContentVideoToPauseBySlot(this);var c=a.EventCallback.getEventCallback(n,a.EVENT_SLOT_IMPRESSION,a.EVENT_TYPE_IMPRESSION);c&&c.process();this.dispatchSlotEvent(a.EVENT_SLOT_STARTED);this.playNextAdInstance()},dispatchSlotEvent:function(a){v||b.dispatchEvent(a,
{slot:this})},_onCompletePlaying:function(){C&&C();C=null;y=[];var c=a.EventCallback.getEventCallback(n,a.EVENT_SLOT_END,a.EVENT_TYPE_IMPRESSION);c&&c.process();f=null;this.dispatchSlotEvent(a.EVENT_SLOT_ENDED);l===a.TIME_POSITION_CLASS_MIDROLL&&0<g.length&&b._requestContentVideoToResumeBySlot(this)},_playNextAdInstance:function(){if(w||A!==a.MediaPlayingState.instance&&A!==a.MediaReplayingState.instance)return!1;this._commitScheduledAdInstance();f=this._nextPlayableAdInstance();if(!f)return!1;f.reset();
f._isInitiatedSent||(f.getRendererController().processEvent({name:a.EVENT_AD_INITIATED}),f._isInitiatedSent=!0);f.getRendererController().play();return!0},_commitScheduledAdInstance:function(){if(k){var a=f._parentAdInstancesGroup.indexOf(f);0<=a&&(k._parentAdInstancesGroup=f._parentAdInstancesGroup,f._parentAdInstancesGroup.splice(a,1,k),k=null)}},_nextPlayableAdInstance:function(){if(f){var b=f._parentAdInstancesGroup,c=b.indexOf(f);var d=g.indexOf(b);0<=d&&0<=c&&(f._isImpressionSent||f._isSkipped||
c===b.length-1)&&d++}else d=0;if(0>d||d>=g.length)return null;var e;if(A===a.MediaPlayingState.instance)for(b=g[d],e=0;e<b.length;e++){if(c=b[e],c.getRendererController().playable())return c}else if(A===a.MediaReplayingState.instance)for(;d<g.length;d++){b=g[d];for(e=0;e<b.length;e++)if(c=b[e],c._isImpressionSent)return c;for(e=0;e<b.length;e++)if(c=b[e],c.getRendererController().getRendererState()!==a.RendererFailedState.instance&&!c._translated)return c}return null},toString:function(){return"[Slot "+
c+"]"},getAdInstances:function(){for(var a=[],b=0;b<g.length;++b)for(var c=g[b],d=0;d<c.length;++d){var e=c[d];if(e.isPlayable()){a.push(e);break}}return a},getPlayheadTime:function(){for(var a=0,b=this.getAdInstances(),c=0;c<b.length;++c)if(b[c]===f){b=f.getPlayheadTime();-1<b&&(a+=b);break}else{var d=b[c].getDuration();-1<d&&(a+=d)}q&&a>q&&(a=q);return a},getTotalDuration:function(){if(d!==a.SLOT_TYPE_TEMPORAL)return-1;for(var b=0,c=this.getAdInstances(),e=0;e<c.length;++e){var f=c[e].getDuration();
-1<f&&(b+=f)}return q=b},playCompanionAds:function(b){a.log("Slot.playCompanionAds");var c=[];b._parentAdInstancesGroup=c;c.push(b);g.push(c);v=!0;f&&this.stop();this.play()},getState:function(){return A},setAcceptCompanion:function(a){D=a},getAcceptCompanion:function(){return D},setInitialAdOption:function(a){K=a},getInitialAdOption:function(){return K}}};a.SurveyExtension=function(){this._surveyPingedIds=[]};a.SurveyExtension.prototype={init:function(b){this._context=b;a.log("SurveyExtension.init("+
Array.prototype.slice.call(arguments).join(",")+")");this._onAdStarted=a.Util.bind(this,function(b){this._parameters=this._getParameters();if(this._parameters.enabled){a.log("SurveyExtension.onAdStarted()");var c=b.adInstance;if(-1<this._surveyPingedIds.indexOf(c.getAdId()))a.log("won't pingback survey since it has been pinged back");else{var e=c._creative.getParameter("_fw_survey_url");if(e)try{a.log("append"+e+" to head");var f=document.getElementsByTagName("head")[0],k=document.createElement("script");
k.setAttribute("type","text/javascript");k.setAttribute("src",e);f.appendChild(k);this._surveyPingedIds.push(c.getAdId())}catch(g){a.warn("Append survey to head",b.type,g)}}}});this._context.addEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted)},dispose:function(){a.log("SurveyExtension.dispose()");this._context.removeEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted);this._parameters=this._onAdStarted=null},_getParameters:function(){var b={};b.enabled="false"!==this._context.getParameter(a.PARAMETER_EXTENSION_SURVEY_ENABLED);
a.log(b);return b}};a.SurveyExtension.prototype.constructor=a.SurveyExtension;a.ExtensionManager=function(b){this._extensions={};this._context=b;this._surveyExtension=new a.SurveyExtension;this._surveyExtension.init(b);this._videoStateExtension=new a.VideoStateExtension;this._videoStateExtension.init(b);this._displayRefreshExtension=new a.DisplayRefreshExtension;this._displayRefreshExtension.init(b);this._contentVideoExtension=new a.ContentVideoExtension;this._contentVideoExtension.init(b);this._pauseAdExtension=
new a.PauseAdExtension;this._pauseAdExtension.init(b);this._omsdkExtension=new a.OMSDKExtension;this._omsdkExtension.init(b)};a.ExtensionManager.prototype={_scriptLoaded:function(b){if(null==this._extensions[b])this._loadFail(b,"Extension supposed to be loaded but not found");else{var c=a.Util.getObject(b);"function"!==typeof c?this._loadFail(b,"Script loaded but extension class not found"):(c=new c,"function"===typeof c.init&&"function"===typeof c.dispose?(a.log("Extension loaded: "+b),c.init(this._context),
this._context.dispatchEvent(a.EVENT_EXTENSION_LOADED,{success:!0,moduleName:b})):this._loadFail(b,"Extension loaded but is not supported"))}},_getExtensionNameFromUrl:function(a){for(var b=/(?!.*\.{2})(?:[\\/\?=#])([a-z][\w\.]+)(?:\.js(#|\?|$))/gi,d,e;null!=(d=b.exec(a));)e=d;return e?e[1]:null},_loadFail:function(b,c){a.log("Extension failed to load. "+b+" : "+c);this._context.dispatchEvent(a.EVENT_EXTENSION_LOADED,{success:!1,errorVal:c,moduleName:b})},load:function(b){if(b){var c=this._getExtensionNameFromUrl(b);
if(null==c)this._loadFail(c,"Extension name not exists in the Url. Url: "+b);else if(this._extensions[c]===b)a.log("Extension is already loaded"),this._loadFail(c,"Extension is already loaded");else{var d=1*this._context.getParameter("moduleLoadTimeout")||6E4,e=!1,f=this,k=window.setTimeout(function(){e=!0;f._loadFail(c,"Timeout occured while loading extension. Url: "+b)},d);a.Util.lazyJavaScriptLoad(b,function(){a.log("async load extension successful, URL:"+b);window.clearTimeout(k);e?a.debug("Extension loaded after timeout, do nothing."):
(f._extensions[c]=b,f._scriptLoaded(c))})}}else this._loadFail(c,"Url cannot be empty")},dispose:function(){this._extensions=null;this._surveyExtension.dispose();this._surveyExtension=null;this._displayRefreshExtension.dispose();this._displayRefreshExtension=null;this._pauseAdExtension.dispose();this._pauseAdExtension=null;this._omsdkExtension.dispose();this._omsdkExtension=null;this._videoStateExtension.dispose();this._videoStateExtension=null;this._contentVideoExtension.dispose();this._context=
this._contentVideoExtension=null}};a.ExtensionManager.prototype.constructor=a.ExtensionManager;a.EventCallback=function(a){this._url=this._name=this._type=null;this._showBrowser=!1;this._trackingUrls=[];this._adInstance=this._slot=null;this._context=a};a.EventCallback.prototype={};a.EventCallback.prototype.constructor=a.EventCallback;a.EventCallback.getEventCallback=function(b,c,d){for(var e,f=0;f<b.length;f++)if(e=b[f],e._name===c&&e._type===d)return e;for(f=0;f<b.length;f++)if(e=b[f],e._type===
a.EVENT_TYPE_GENERIC){if(c=a.EventCallback.newEventCallback(e._context,c,d))c._url=e._url,c._slot=e._slot,c._adInstance=e._adInstance,b.push(c);return c}return null};a.EventCallback.newEventCallback=function(b,c,d){if(d===a.EVENT_TYPE_GENERIC)b=new a.EventCallback(b);else if(d===a.EVENT_TYPE_ERROR)b=new a.ErrorEventCallback(b);else if(d===a.EVENT_TYPE_CLICK)b=new a.AdClickEventCallback(b);else if(d===a.EVENT_TYPE_STANDARD)b=new a.AdStandardEventCallback(b);else if(c===a.EVENT_SLOT_IMPRESSION||c===
a.EVENT_SLOT_END)b=new a.SlotImpressionEventCallback(b);else if(c===a.EVENT_AD_IMPRESSION||c===a.EVENT_AD_IMPRESSION_END)b=new a.AdImpressionEventCallback(b);else if(c===a.EVENT_VIDEO_VIEW)b=new a.VideoViewEventCallback(b);else if(c===a.EVENT_RESELLER_NO_AD)b=new a.ResellerNoAdEventCallback(b);else if(c===a.EVENT_AD_FIRST_QUARTILE||c===a.EVENT_AD_MIDPOINT||c===a.EVENT_AD_THIRD_QUARTILE||c===a.EVENT_AD_COMPLETE)b=new a.AdQuartileEventCallback(b);else if(c===a.EVENT_AD_PROGRESS)b=new a.AdProgressEventCallback(b);
else return null;b._name=c;b._type=d;return b};a.EventCallback.getShortType=function(b){var c="";switch(b){case a.EVENT_TYPE_IMPRESSION:c=a.SHORT_EVENT_TYPE_IMPRESSION;break;case a.EVENT_TYPE_CLICK:c=a.SHORT_EVENT_TYPE_CLICK;break;case a.EVENT_TYPE_STANDARD:c=a.SHORT_EVENT_TYPE_STANDARD;break;case a.EVENT_TYPE_ERROR:c=a.SHORT_EVENT_TYPE_ERROR}return c};a.Util.mixin(a.EventCallback.prototype,{parse:function(a){if(a){this._usage=a.use;this._type=a.type;this._name=a.name;this._url=a.url;this._showBrowser=
a.showBrowser;this._trackingUrls=[];var b=0;for(a=a.trackingUrls||[];b<a.length;b++)this._trackingUrls.push(a[b].value)}},copy:function(){var a=new this.constructor(this._context);a._type=this._type;a._name=this._name;a._url=this._url;a._showBrowser=this._showBrowser;a._trackingUrls=this._trackingUrls.slice();a._slot=this._slot;a._adInstance=this._adInstance;return a},getUrl:function(b){var c=this._replaceMacrosInUrl(this._url,b);this._name===a.EVENT_AD_MEASUREMENT?(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_ET,
a.SHORT_EVENT_TYPE_IMPRESSION),c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CONCRETE_EVENT_ID,b[a.INFO_KEY_CONCRETE_EVENT_ID])):c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_ET,a.EventCallback.getShortType(this._type));c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CN,this._name);this._adInstance&&0<this._adInstance._creativeRenditionId&&(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CREATIVE_RENDITION_ID,this._adInstance._creativeRenditionId));return c},getTrackingUrls:function(b){var c=
this._trackingUrls;if(this._adInstance){var d=this._type;d===a.EVENT_TYPE_CLICK&&(d=a.EVENT_TYPE_CLICK_TRACKING);c=c.concat(this._adInstance.getExternalEventCallbackUrls(this._name,d))}d=[];for(var e=0;e<c.length;e++){var f=a.Util.trim(this._replaceMacrosInUrl(c[e],b));a.Util.isBlank(f)||d.push(f)}return d},process:function(b){b=b||{};this._processTrackingUrls(b);a.Util.pingURL(this.getUrl(b))},_processTrackingUrls:function(b){this._shouldSkipSendingTrackingAndExternalUrls()||a.Util.pingURLs(this.getTrackingUrls(b))},
_shouldSkipSendingTrackingAndExternalUrls:function(){return!1},_needEmptyCT:function(b){var c=!1;b&&!0===b[a.INFO_KEY_NEED_EMPTY_CT]&&(c=!0);return c},_getAdPlayheadTime:function(){var a=-1;this._adInstance&&(a=this._adInstance.getPlayheadTime());return a},_getCreativeAssetLocation:function(){var a=null;this._adInstance&&this._adInstance.getActiveCreativeRendition()&&this._adInstance.getActiveCreativeRendition().getPrimaryCreativeRenditionAsset()&&(a=this._adInstance.getActiveCreativeRendition().getPrimaryCreativeRenditionAsset().getProxiedUrl());
return a},_getParameter:function(a){return this._adInstance?this._adInstance._rendererController.getParameter(a):this._slot?this._slot.getParameter(a):this._context.getParameter(a)},_replaceVASTMacro:function(b,c,d){a.log("replace VAST Macro: url=",b+", macro="+c+", value="+d);b&&c&&(d=encodeURIComponent(d?d:""),b=b.replace("["+c+"]",d),b=b.replace("%5B"+c+"%5D",d));return b},_replaceMacrosInUrl:function(b,c){if(a.Util.isBlank(b))return b;c&&c[a.INFO_KEY_VAST_ERROR_CODE]&&(b=this._replaceVASTMacro(b,
"ERRORCODE",c[a.INFO_KEY_VAST_ERROR_CODE]));this._getCreativeAssetLocation()&&(b=this._replaceVASTMacro(b,"ASSETURI",this._getCreativeAssetLocation()));var d=this._context._getContentPlayheadTime();if(this._adInstance){c=null!=d&&0<=Number(d)?a.Util.secondsToHms(d):"";b=this._replaceVASTMacro(b,"CONTENTPLAYHEAD",c);b=this._replaceVASTMacro(b,"CACHEBUSTING",a.Util.getFixedDigitRandomNumber(8));b=this._replaceVASTMacro(b,"TIMESTAMP",a.Util.getDateStringInISOFormat(new Date));b=this._replaceVASTMacro(b,
"OMIDPARTNER",a.OMSDK_PARTNER_NAME+"/"+this._context._adManager.getVersion());c=[];if(this._context._overriddenAdRenderers&&null!=this._context._overriddenAdRenderers){var e=[];this._context._adResponse&&this._context._adResponse._adRenderers&&(e=this._context._overriddenAdRenderers.concat(this._context._adResponse._adRenderers));for(var f=0;f<e.length;f++){var k=e[f].creativeApi||"";k.includes("VPAID")?c.push(a.IAB_API_FRAMEWORKS_VPAID_2):k.includes("MRAID")&&c.push(a.IAB_API_FRAMEWORKS_MRAID_1)}}this._context.getParameter(a.PARAMETER_EXTENSION_OMSDK_ENABLED)&&
c.push(a.IAB_API_FRAMEWORKS_OMID_1);c=c.sort().filter(function(a,b,c){return!b||a!=c[b-1]});b=this._replaceVASTMacro(b,"APIFRAMEWORKS",c.toString())}b=b.replace(/#(ce?)\{([^\}]+)\}/g,a.Util.bind(this,function(b,c,e){a.log("matchedSubString"+b);b="ce"===c;c=null;switch(e){case "ad.playheadTime":e=this._getAdPlayheadTime();c=0<=e?Math.round(e)+"":"";break;case "content.playheadTime":c=0<=d?Math.round(d)+"":"";break;case "creative.assetLocation":c=this._getCreativeAssetLocation();break;default:0===e.indexOf("parameter.")&&
(c=this._getParameter(e.substr(10)))}a.Util.isBlank(c)&&(c="");return b?encodeURIComponent(c):c}));c="";try{c=a.Util.getParameterInURL(b,a.URL_PARAMETER_KEY_CR)}catch(g){return a.warn(g),b}a.Util.isBlank(c)||(b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_CR,this._replaceMacrosInUrl(c)));return b}});a.AdClickEventCallback=function(b){a.EventCallback.call(this,b)};a.AdClickEventCallback.prototype=new a.EventCallback;a.AdClickEventCallback.prototype.constructor=a.AdClickEventCallback;a.Util.mixin(a.AdClickEventCallback.prototype,
{getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,b);b[a.INFO_KEY_URL]&&(a.Util.isParameterInURL(c,a.URL_PARAMETER_KEY_CR)||(c=c+"&"+a.URL_PARAMETER_KEY_CR+"="),c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CR,b[a.INFO_KEY_URL]));return c},process:function(b){b=b||{};var c=this.getUrl(b),d=!0===this._showBrowser;d=b.hasOwnProperty(a.INFO_KEY_SHOW_BROWSER)?!0===b[a.INFO_KEY_SHOW_BROWSER]:d;b[a.INFO_KEY_URL]&&(d=!0);d&&!a.Util.isBlank(c)?(window.open(c),this._processTrackingUrls(b)):
a.EventCallback.prototype.process.call(this,b)}});a.AdImpressionEventCallback=function(b){a.EventCallback.call(this,b)};a.AdImpressionEventCallback.prototype=new a.EventCallback;a.AdImpressionEventCallback.prototype.constructor=a.AdImpressionEventCallback;a.Util.mixin(a.AdImpressionEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==a.INIT_VALUE_ONE},_getInitValue:function(){return this._adInstance.getSlot().isPauseSlot()||!this._processed?a.INIT_VALUE_ONE:
a.INIT_VALUE_TWO},_getStartTimePosition:function(){return this._adInstance.getStartTimePosition()},_getAutoPlayBlocked:function(){return this._adInstance.getSlot().getAutoPlayBlocked()},getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,b);c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_METR,this._adInstance._metr);if(this._name!==a.EVENT_AD_IMPRESSION)c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CT,this._needEmptyCT(b)?"":this._adInstance._timer.tick());else if(-1<this._getStartTimePosition()&&
(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_START_TIME_POSITION,this._getStartTimePosition())),this._getAutoPlayBlocked()){b="";try{b=a.Util.getParameterInURL(c,a.URL_PARAMETER_KEY_AUTO_PLAY_BLOCKED)}catch(d){return a.warn(d),c}c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_AUTO_PLAY_BLOCKED,b|a.URL_PARAMETER_KEY_AUTO_PLAY_BLOCKED_VALUE)}return c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_INIT,this._getInitValue())},process:function(b){a.MODULE_TYPE_TRANSLATOR!==this._adInstance.getRendererController().getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&
(a.EventCallback.prototype.process.call(this,b),this._processed=!0)}});a.AdQuartileEventCallback=function(b){a.EventCallback.call(this,b)};a.AdQuartileEventCallback.prototype=new a.EventCallback;a.AdQuartileEventCallback.prototype.constructor=a.AdQuartileEventCallback;a.Util.mixin(a.AdQuartileEventCallback.prototype,{_getInitValue:function(){return this._adInstance.getSlot().isPauseSlot()||!this._processed?a.INIT_VALUE_ONE:a.INIT_VALUE_TWO},getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,
b);c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_METR,this._adInstance._metr);c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CT,this._needEmptyCT(b)?"":this._adInstance._timer.tick());null!=this._adInstance._context.getParameter(a.PARAMETER_ENABLE_COUNTING_REPLAY_CALLBACK)&&"true"==this._adInstance._context.getParameter(a.PARAMETER_ENABLE_COUNTING_REPLAY_CALLBACK)&&(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_INIT,this._getInitValue()));return c},process:function(b){var c=null!=this._adInstance._context.getParameter(a.PARAMETER_ENABLE_COUNTING_REPLAY_CALLBACK)?
"true"==this._adInstance._context.getParameter(a.PARAMETER_ENABLE_COUNTING_REPLAY_CALLBACK):!1;if(!this._processed||c)a.EventCallback.prototype.process.call(this,b),this._processed=!0}});a.AdStandardEventCallback=function(b){a.EventCallback.call(this,b)};a.AdStandardEventCallback.prototype=new a.EventCallback;a.AdStandardEventCallback.prototype.constructor=a.AdStandardEventCallback;a.AdProgressEventCallback=function(b){a.EventCallback.call(this,b)};a.AdProgressEventCallback.prototype=new a.EventCallback;
a.AdProgressEventCallback.prototype.constructor=a.AdProgressEventCallback;a.Util.mixin(a.AdProgressEventCallback.prototype,{getTrackingUrls:function(){for(var b=[],c=0;c<this._trackingUrls.length;c++)a.Util.isBlank(this._trackingUrls[c])||b.push(this._trackingUrls[c]);return b},process:function(b){this._shouldSkipSendingTrackingAndExternalUrls()||a.Util.pingURLs(this.getTrackingUrls())}});a.ErrorEventCallback=function(b){a.EventCallback.call(this,b)};a.ErrorEventCallback.prototype=new a.EventCallback;
a.ErrorEventCallback.prototype.constructor=a.ErrorEventCallback;a.Util.mixin(a.ErrorEventCallback.prototype,{getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,b),d=b[a.INFO_KEY_ERROR_CODE];d||(d=a.ERROR_UNKNOWN);var e=b[a.INFO_KEY_ERROR_INFO];e||(e="");(b=b[a.INFO_KEY_ERROR_MODULE])||(b="");c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CN,d);return c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_KEY_VALUE,encodeURIComponent(a.URL_PARAMETER_KEY_ERROR_MODULE)+"="+encodeURIComponent(b)+
"&"+encodeURIComponent(a.URL_PARAMETER_KEY_ERROR_INFO)+"="+a.PLATFORM_ID+"/"+encodeURIComponent(e))}});a.ResellerNoAdEventCallback=function(b){a.EventCallback.call(this,b)};a.ResellerNoAdEventCallback.prototype=new a.EventCallback;a.ResellerNoAdEventCallback.prototype.constructor=a.ResellerNoAdEventCallback;a.Util.mixin(a.ResellerNoAdEventCallback.prototype,{});a.SlotImpressionEventCallback=function(b){a.EventCallback.call(this,b)};a.SlotImpressionEventCallback.prototype=new a.EventCallback;a.SlotImpressionEventCallback.prototype.constructor=
a.SlotImpressionEventCallback;a.Util.mixin(a.SlotImpressionEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==a.INIT_VALUE_ONE},_getInitValue:function(){return this._slot.isPauseSlot()||!this._processed?a.INIT_VALUE_ONE:a.INIT_VALUE_TWO},getUrl:function(b){b=a.EventCallback.prototype.getUrl.call(this,b);return b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_INIT,this._getInitValue())},process:function(b){a.EventCallback.prototype.process.call(this,
b);this._processed=!0}});a.VideoViewEventCallback=function(b){a.EventCallback.call(this,b)};a.VideoViewEventCallback.prototype=new a.EventCallback;a.VideoViewEventCallback.prototype.constructor=a.VideoViewEventCallback;a.Util.mixin(a.VideoViewEventCallback.prototype,{_getInitValue:function(){return this._processed?a.INIT_VALUE_ZERO:a.INIT_VALUE_ONE},_getCTValue:function(){return this._context._videoAsset?this._context._videoAsset.getPlayheadTime():0},getUrl:function(b){b=a.EventCallback.prototype.getUrl.call(this,
b);b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_INIT,this._getInitValue());return b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_CT,this._getCTValue())},_shouldSkipSendingTrackingAndExternalUrls:function(){return this._processed},process:function(b){a.EventCallback.prototype.process.call(this,b);this._processed=!0}});a.VideoRenderer=function(){this._adVideo=null;this._duration=this._playheadTime=-1;this._dragging=this._stopInvoked=this._isEnded=!1;this._volume=1;this._rendererController=null;
this._isBuffering=!1;this._autoPauseAdOnVisibilityChange=!0;this._hls=null;this._adVideoPauseState=""};a.VideoRenderer.prototype={pause:function(){this._rendererController&&this._rendererController.processEvent({name:a.EVENT_AD_PAUSE});this._adVideo&&!this._adVideo.paused&&this._adVideo.pause();this._adVideoPauseState=this._hls&&this._adVideoPauseState===a.AD_VIDEO_PAUSED_BY_TAB_SWITCH?a.AD_VIDEO_HLS_PAUSED_BY_RENDERER_AFTER_TAB_SWITCH:a.AD_VIDEO_PAUSED_BY_RENDERER},resume:function(){this._rendererController&&
this._rendererController.processEvent({name:a.EVENT_AD_RESUME});this._adVideo&&this._adVideo.paused&&this._adVideo.play();this._adVideoPauseState=a.AD_VIDEO_UNPAUSED},start:function(b){this._rendererController=b;var c=this._rendererController.getAdInstance(),d=c.getSlot(),e=this,f=!1,k=!1;this._autoPauseAdOnVisibilityChange=this._rendererController.getParameter(a.PARAMETER_AUTO_PAUSE_AD_ONVISIBILITYCHANGE);if(a.PLATFORM_NOT_SUPPORT_VIDEO_AD)this._onRendererFailed(a.ERROR_DEVICE_LIMIT,d.getTimePositionClass());
else if(a.PLATFORM_NOT_SUPPORT_MIDROLL_AD&&d.getTimePositionClass()===a.TIME_POSITION_CLASS_MIDROLL)this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"midroll");else{a.log("VideoRenderer.start",d.getTimePositionClass(),c);var g=this._rendererController.getContentVideoElement();a.debug("VideoRenderer","use content video element");g.controls=!1;this._adVideo=g;var n=null,h=null,l=null,A=null,q=d.getVideoDisplaySize().width,I=d.getVideoDisplaySize().height;b=c.getRenderableCreativeRenditions();var m=(q=(new a.RenditionSelector(this._rendererController.getParameter(a.PARAMETER_DESIRED_BITRATE)||
1E3,this._rendererController.getParameter("arWeight")||1,this._rendererController.getParameter("pxWeight")||1,.2)).getBestFitRendition(b,q,I))?q.getPrimaryCreativeRenditionAsset():null;if(m&&b.length)if(b=m.getProxiedUrl()){c.setActiveCreativeRendition(q);a.log("VideoRenderer.start selected rendition is:",b);b=m.getMimeType();var r=a.Util.isMimeTypeHls(b);this._rendererController.setCapability(a.EVENT_AD_QUARTILE,a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_MUTE,a.CAPABILITY_STATUS_ON);
this._rendererController.setCapability(a.EVENT_AD_PAUSE,a.CAPABILITY_STATUS_ON);var x=!a.PLATFORM_NOT_SUPPORT_CLICK_FOR_VIDEO;x||this._rendererController.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF);var L=a.PLATFORM_EVENT_CLICK,M=a.MOBILE_EVENT_DRAG;this._volume=this._rendererController.getContext().getAdVolume();this._adVideo.volume=this._volume;this._adVideo.muted=0===this._volume;var N=function(b){a.debug("VideoRenderer.checkTimeUpdate timeout");V(b)},Q=function(){h&&(clearTimeout(h),
h=null)},U=a.Util.bind(this,function(b){a.debug("onAdVideoBufferEmpty(): Ad video event "+b.type);b=this._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_PLAY_AFTER_STALLED);null!==b&&"undefined"!==typeof b&&!1!==a.Util.str2bool(b)&&(a.debug("play the ad immediately after the stalled event"),g&&g._fw_videoAdPlaying&&g.play())}),R=function(b){e._isBuffering||(e._isBuffering=!0,e._rendererController.processEvent({name:a.EVENT_AD_BUFFERING_START}),a.debug("onAdVideoBufferingStarted(): Ad video event "+
b.type))},t=function(b){e._isBuffering&&(e._isBuffering=!1,e._rendererController.processEvent({name:a.EVENT_AD_BUFFERING_END}),a.debug("onAdVideoBufferingEnded(): Ad video event "+b.type))};b=this._rendererController.getParameter(a.PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT);var F=null;b&&(F=document.getElementById(b));F||(F=g);var u=a.Util.bind(this,function(b){if(g.paused&&a.PLATFORM_NOT_FIRE_CLICK_WHEN_AD_VIDEO_PAUSED)g.play();else{var c=this._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_CLICK_DETECTION);
null==c&&(c="true");!1!==a.Util.str2bool(c)&&(k?(a.debug("Ad video event "+b.type),this._dragging?this._dragging=!1:this._rendererController.processEvent({name:a.EVENT_AD_CLICK})):a.debug("Ad not started, ignore click."))}}),w=a.Util.bind(this,function(b){a.debug("Ad video event "+b.type);this._dragging=!0}),v,G=function(b){a.debug("Ad video event "+b.type+" ended: "+g.ended+" playing:"+g._fw_videoAdPlaying);if(g.ended&&.2>Math.abs(g.duration-g.currentTime)||!g._fw_videoAdPlaying)v=setTimeout(function(){a.warn("Force ad video end bc ad paused with ended = true");
b.type="ended";J(b)},200);else{var c=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE);null==c&&(c="true");!1===a.Util.str2bool(c)?a.debug("Pause controls disabled"):g.controls=!0;Q()}},y=function(b){a.debug("Ad video event "+b.type);g.controls=!1},D=0,K=function(b){a.debug("Ad video event "+b.type);0>=g.currentTime?a.debug("VideoRenderer.onAdVideoTimeUpdate currentTime is less than or 0"):(Q(),g.paused||(b=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT)||
8E3,h=setTimeout(N,b,b+"ms timeout when playing")),k||(k=!0,e._playheadTime=g.currentTime,0>e._playheadTime&&(e._playheadTime=0),n&&(clearTimeout(n),n=null),e._quartileTimerId=setInterval(function(){var b=g.currentTime,c=g.duration;0<b&&(e._playheadTime=b);0<c&&(e._duration=c);"number"!==typeof b||"number"!==typeof c||l||(e._rendererController&&(e._rendererController.checkProgress(b),e._rendererController.checkForSkippableStateChange()),b>=.25*c&&1>D&&(e._rendererController.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),
D=1),b>=.5*c&&2>D&&(e._rendererController.processEvent({name:a.EVENT_AD_MIDPOINT}),D=2),b>=.75*c&&3>D&&(clearInterval(e._quartileTimerId),e._quartileTimerId=null,e._rendererController.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),D=3))},1E3),c.adjustOffsetAndProgressWithRendererDuration(g.duration),e._rendererController.handleStateTransition(a.RENDERER_STATE_STARTED)))};this.dispose=a.Util.bind(this,function(){J()});var J=function(b){var c=l;b&&b.type&&(a.debug("Ad video event "+b.type),"error"===
b.type&&(a.warn(b.target.src),a.warn(b.target.currentSrc),t(b)));Q();n&&(clearTimeout(n),n=null);x&&(F.removeEventListener(L,u,!1),F.removeEventListener(M,w,!1));v&&(clearTimeout(v),v=null);O&&e._autoPauseAdOnVisibilityChange&&(document.removeEventListener("visibilitychange",O,!1),O=null);g.removeEventListener("ended",J,!1);g.removeEventListener("error",J,!0);g.removeEventListener("pause",G,!1);g.removeEventListener("playing",y,!1);g.removeEventListener("timeupdate",K,!1);g.removeEventListener("stalled",
U,!1);g.removeEventListener("waiting",R,!1);g.removeEventListener("canplay",t,!1);g.paused||(a.debug("try pausing video before complete"),g.pause());b&&"error"===b.type&&(c="video error",(b=g.error||b.target.error)&&(c="error:"+b+",code:"+b.code));c||(e._isEnded=!0);a.log("VideoRenderer.complete");f?e._rendererController.checkProgress(g.duration):(f=!0,delete g._fw_videoAdPlaying,e._adVideo=null,e._quartileTimerId&&(clearInterval(e._quartileTimerId),e._quartileTimerId=null),c?e._onRendererFailed(A,
c):(e._stopInvoked||(g.currentTime>=.25*g.duration&&1>D&&(e._rendererController.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),D=1),g.currentTime>=.5*g.duration&&2>D&&(e._rendererController.processEvent({name:a.EVENT_AD_MIDPOINT}),D=2),g.currentTime>=.75*g.duration&&3>D&&(e._rendererController.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),D=3),g.currentTime>=g.duration-.5&&4>D&&(e._rendererController.checkProgress(g.duration),e._rendererController.processEvent({name:a.EVENT_AD_COMPLETE}),D=4)),e._stopInvoked=
!1,e._rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED)));e._rendererController=null;e._hls&&e._hls.destroy()};var V=function(b){l=b;A=a.ERROR_TIMEOUT;a.warn(l);a.PLATFORM_WAIT_WHEN_AD_VIDEO_TIMEOUT||J()},O=function(b){a.log("onVisibilityChange:"+(document.hidden?"invisible":"visible"));document.hidden?e._adVideoPauseState!==a.AD_VIDEO_PAUSED_BY_RENDERER&&(g&&!g.paused&&g.pause(),e._adVideoPauseState=a.AD_VIDEO_PAUSED_BY_TAB_SWITCH,e._rendererController&&e._rendererController.processEvent({name:a.EVENT_AD_PAUSE}),
n&&(clearTimeout(n),n=null)):e._adVideoPauseState===a.AD_VIDEO_PAUSED_BY_TAB_SWITCH?(e.resume(),k||!g._fw_fromVideoPool&&!a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT||(b=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT)||5E3,n=setTimeout(V,b,b+"ms timeout before playing"))):e._adVideoPauseState===a.AD_VIDEO_HLS_PAUSED_BY_RENDERER_AFTER_TAB_SWITCH&&e._rendererController&&e._rendererController.processEvent({name:a.EVENT_AD_RESUME})};g._fw_videoAdPlaying=!0;var E=
!1,S=function(){if(!E){E=!0;x&&(F.addEventListener(L,u,!1),F.addEventListener(M,w,!1));g.addEventListener("ended",J,!1);g.addEventListener("error",J,!0);g.addEventListener("pause",G,!1);g.addEventListener("playing",y,!1);g.addEventListener("timeupdate",K,!1);g.addEventListener("stalled",U,!1);g.addEventListener("waiting",R,!1);g.addEventListener("canplay",t,!1);if(r)if("undefined"!==typeof Hls){if(Hls.isSupported()){var b=Hls.version;b=b.replace("-beta","");0<=a.Util.compareVersion(b,a.PLATFORM_HLSJS_MIN_VERSION)?
(a.log("VideoRenderer loading hls rendition using hls.js version",b),e._hls=new window.Hls,e._hls.on(Hls.Events.ERROR,function(b,c){if(c.fatal)switch(c.type){case Hls.ErrorTypes.NETWORK_ERROR:a.debug("VideoRenderer has encountered fatal hls network error and attempting to recover");e._hls.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:a.debug("VideoRenderer has encountered fatal hls media error and attempting to recover");e._hls.recoverMediaError();break;default:e._hls.destroy(),a.debug("VideoRenderer has encountered unrecoverable fatal hls error. Details: "+
c.details),e._onRendererFailed(a.ERROR_HLSJS,c.details)}else a.debug("VideoRenderer has encountered non-fatal hls network error. Automatic recovery attempt by hls.js.")}),e._hls.attachMedia(g),e._hls.on(Hls.Events.MEDIA_ATTACHED,function(){e._hls.loadSource(m.getProxiedUrl());e._hls.on(Hls.Events.MANIFEST_PARSED,function(b,c){a.debug("VideoRenderer hls manifest successfully parsed, found "+c.levels.length+" quality level")})})):0>a.Util.compareVersion(b,a.PLATFORM_HLSJS_MIN_VERSION)?a.warn("Found hls.js version is too old and incompatible. Please upgrade to v0.11.0 or higher. Current version:",
b):a.warn("Unable to find successful hls support.")}}else g.src=m.getProxiedUrl(),a.debug("VideoRenderer loading hls rendition on Safari "+g.src),g.load();else g.src=m.getProxiedUrl(),a.debug("VideoRenderer loading video ad "+g.src),g.load();if(g._fw_fromVideoPool||a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT)b=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT)||5E3,n=setTimeout(V,b,b+"ms timeout before playing");a.PLATFORM_VIDEO_DOESNOT_SUPPORT_TIMEUPDATE&&e._rendererController.handleStateTransition(a.RENDERER_STATE_STARTED);
b=100;0<a.PLATFORM_ANDROID_VERSION&&(b=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_ANDROID_DELAY)||100);setTimeout(function(){var b=g.play();b&&a.PLATFORM_BLOCKS_AUTOPLAY&&b.catch(function(b){if(b&&"AbortError"===b.name||"NotAllowedError"===b.name)a.warn("Blocked by browser, need player to display a start button. Details: %o",b),n&&(clearTimeout(n),n=null),d.setAutoPlayBlocked(!0),e._rendererController.processEvent({name:a.EVENT_AD_AUTO_PLAY_BLOCKED,info:{apiOnly:!0}})});document.hidden&&
g&&e._autoPauseAdOnVisibilityChange&&(a.log("VideoRenderer pause ad when tab is invisible."),g&&!g.paused&&(g.pause(),e._adVideoPauseState=a.AD_VIDEO_PAUSED_BY_TAB_SWITCH,e._rendererController&&e._rendererController.processEvent({name:a.EVENT_AD_PAUSE})),n&&(clearTimeout(n),n=null))},b);e._autoPauseAdOnVisibilityChange&&document.addEventListener("visibilitychange",O,!1)}};a.VideoRenderer._fw_playedDummyVideo||d.getTimePositionClass()!==a.TIME_POSITION_CLASS_PREROLL||!a.PLATFORM_PLAY_DUMMY_VIDEO_FOR_PREROLL||
/\.webm$/.test(m.getProxiedUrl())?S():(a.VideoRenderer._fw_playedDummyVideo=!0,a.debug("play dummy video for iOS 3.2-4.1"),g.src="http://127.0.0.1:1/404.mp4",g.load(),g.play(),g._fw_videoAdPlaying=!0,g.addEventListener("error",function(){event.target.removeEventListener("error",g,!0);S()},!0),setTimeout(S,a.PLATFORM_NOT_WAIT_FOR_ERROR_WHEN_PLAY_DUMMY_VIDEO_FOR_PREROLL?500:5E3))}else this._onRendererFailed(a.ERROR_NULL_ASSET);else this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"no compatible asset")}},
stop:function(){a.debug("VideoRenderer stop");this._stopInvoked=!0;this._adVideo&&(this._adVideo._fw_videoAdPlaying=!1,this._adVideo.pause(),this.dispose());this._rendererController=null},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){if(this._isEnded&&0<this._duration)return this._duration;if(this._adVideo){var a=this._adVideo.currentTime;if(0<a)return a}return this._playheadTime},getDuration:function(){return this._duration},setVolume:function(b){a.debug("VideoRenderer setVolume("+
b+")");this._adVideo?(this._adVideo.volume=b,this._adVideo.muted=0===b,this._volume!==b&&this._rendererController.processEvent({name:a.EVENT_AD_VOLUME_CHANGE}),0===this._volume&&0!==b?this._rendererController.processEvent({name:a.EVENT_AD_UNMUTE}):0!==this._volume&&0===b&&this._rendererController.processEvent({name:a.EVENT_AD_MUTE}),this._volume=b):a.debug("VideoRenderer ad video is null, ignore.")},_onRendererFailed:function(b,c,d){var e={};e[a.INFO_KEY_ERROR_MODULE]="VideoRenderer";e[a.INFO_KEY_ERROR_CODE]=
b;d||(d=a.ERROR_VAST_GENERAL_LINEAR_ERROR);e[a.INFO_KEY_VAST_ERROR_CODE]=d;c&&(e[a.INFO_KEY_ERROR_INFO]=c);this._rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,e)}};a.VideoRenderer.prototype.constructor=a.VideoRenderer;a.AdRequest=function(b){this._context=b;this._capabilities=new a.Capabilities;this._keyValues=[];this._playerProfile="";this._compatibleDimensions=null;this._temporalSlots=[];this._siteSectionId=this._siteSectionCustomId="";this._siteSectionNetworkId=0;this._siteSectionFallbackId=
"";this._siteSectionViewRandom=0;this._requestMode=this._visitorIpV4Address=this._visitorCustomId="";this._subsessionToken=this._requestDuration=0;this._candidateAdIds=[];this._slotScanner=new a.PageSlotScanner(b);this._urlParams={};this._urlKeyValues=[];this._customInfo=""};a.AdRequest.prototype={setCapability:function(a,c){this._capabilities.setCapability(a,c)},addKeyValue:function(b,c){"string"!==typeof b||"string"!==typeof c||0===b.length?a.warn("AdRequest.addKeyValue:","key and value required"):
(b=encodeURIComponent(b)+"="+encodeURIComponent(c),0>this._keyValues.indexOf(b)&&this._keyValues.push(b))},removeKey:function(b){if("string"!==typeof b||0===b.length)a.warn("AdRequest.removeKey:","key required");else{b=encodeURIComponent(b);for(var c=this._keyValues,d=c.length-1;0<=d;--d)c[d].split("=")[0]===b&&this._keyValues.splice(d,1)}},setProfile:function(b){"string"!==typeof b?a.warn("AdRequest.setProfile:","player profile required"):this._playerProfile=b},setVideoDisplayCompatibleSizes:function(b){if(b&&
b.length){for(var c=[],d={},e=0;e<b.length;++e)if(a.debug("dimension is:",b[e].width,"X",b[e].height),0<b[e].width&&0<b[e].height){var f=b[e].width+","+b[e].height;null==d[f]&&(d[f]="",c.push(f))}0<c.length&&(this._compatibleDimensions=c.join("|"))}else a.warn("AdRequest.setVideoDisplayCompatibleSizes:","compatible dimensions required")},setSiteSection:function(b,c,d,e,f){if(b){switch(e){case a.ID_TYPE_FW:this._siteSectionId=b;break;case a.ID_TYPE_GROUP:this._siteSectionId="g"+b;break;default:this._siteSectionCustomId=
b}0<1*c&&(this._siteSectionNetworkId=1*c);0<1*d&&(this._siteSectionViewRandom=1*d);"number"===typeof f&&0<f?this._siteSectionFallbackId=""+f:"string"===typeof f&&(this._siteSectionFallbackId=f.trim())}else a.warn("AdRequest.setSiteSection: id required")},setVisitor:function(b,c){"string"!==typeof b?a.warn("AdRequest.setVisitor:","customId required"):(this._visitorCustomId=b,"string"===typeof c&&""!==c&&(this._visitorIpV4Address=c))},setRequestMode:function(b){b!==a.REQUEST_MODE_ON_DEMAND&&b!==a.REQUEST_MODE_LIVE?
a.warn("AdRequest.setRequestMode:","unknown mode: "+b):(this._requestMode=b,this._requestMode===a.REQUEST_MODE_LIVE&&0===this._subsessionToken&&this.setSubsessionToken(1E4*Math.random()+1))},setRequestDuration:function(b){"number"!==typeof b?a.warn("AdRequest.setRequestDuration:","request duration required"):(0>b&&(a.warn("AdRequest.setRequestDuration:","requestDuration is negative, reset it to 0"),b=0),this._requestDuration=b)},addCandidateAd:function(b){"number"!==typeof b?a.warn("AdRequest.addCandidateAd:",
"candidate ad ID required"):0>b?a.warn("AdRequest.addCandidateAd","invalid ad ID, ignore"):this._candidateAdIds.push(b)},addTemporalSlot:function(b,c,d,e,f,k,g,n,h,l){if(a.Util.isBlank(b)||a.Util.isBlank(c)||0>d)a.warn("AdRequest.addTemporalSlot:","invalid parameters");else{for(var z=0;z<this._temporalSlots.length;z++)if(this._temporalSlots[z].getCustomId()===b){a.warn("AdRequest.addTemporalSlot:","slot with custom Id: "+b+" is already added, ignoring the duplicate addition");return}z=new a.Slot(this._context);
z.setCustomId(b);z.setAdUnit(c);z.setTimePosition(d);z.setSlotProfile(e);z.setCuepointSequence(1*f);z.setMaxDuration(k);z.setMinDuration(g);z.setAcceptContentType(n);z.setSignalId(h);z.setMaxAds(l);this._temporalSlots.push(z)}},setSubsessionToken:function(a){this._subsessionToken=a},scanPageSlots:function(){this._slotScanner.scanPageSlots()},generateTypeBRequestUrl:function(){var b=this._context._adManager._serverURL.split("?"),c=b[0],d=[/fwmrm\.net$/,/fwmrm\.net\/$/,/fwmrm\.net\/ad$/,/fwmrm\.net\/ad\/$/,
/fwmrm\.net\/ad\/g$/,/fwmrm\.net\/ad\/g\/$/,/fwmrm\.net\/ad\/g\/1$/];if(0===c.indexOf("http://")||0===c.indexOf("https://"))for(var e=0;e<d.length;++e)if(c.match(d[e])){c=c.slice(0,c.indexOf("fwmrm.net")+9)+"/ad/g/1";break}this.parseQueryStr(b.slice(1).join("?"));b=this.generateGlobalParametersQueryStr()+";"+this.generateKeyValuesStr()+";";this._capabilities.getCapability(a.CAPABILITY_SKIP_AD_SELECTION)&&1===this._capabilities.getCapability(a.CAPABILITY_SKIP_AD_SELECTION)||(b+=this.generateSlotsTypeBStr());
a.Util.isBlank(this._customInfo)||(b+=";"+this._customInfo);return c+"?"+b},generateVideoViewRequestUrlWithDummyContextInstanceId:function(b){this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_ON);this._context.setCapability(a.CAPABILITY_SKIP_AD_SELECTION,a.CAPABILITY_STATUS_ON);var c=this.generateTypeBRequestUrl();c=a.Util.setParameterInURL(c,"cbfn","tv.freewheel.SDK._instanceQueue['Context_"+b+"']._videoAsset.requestComplete");a.debug("generateVideoViewRequestUrlWithDummyContextInstanceId():"+
c);this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_UNSET);this._context.setCapability(a.CAPABILITY_SKIP_AD_SELECTION,a.CAPABILITY_STATUS_UNSET);return c},parseQueryStr:function(b){var c=b;a.debug("AdRequest.parseQueryStr("+Array.prototype.slice.call(arguments).join(",")+")");this._urlParams={};this._urlKeyValues=[];this._customInfo="";if(c){";"===c.charAt(c.length-1)&&(c=c.substring(0,c.length-1));c=c.split(";");var d;if(c[0]){var e=c[0].split("&");for(d=0;d<e.length;++d){var f=
e[d].split("=");2===f.length&&(this._urlParams[f[0]]=f[1])}}if(c[1])for(e=c[1].split("&"),d=0;d<e.length;++d)this._urlKeyValues.push(e[d]);c[2]&&(this._customInfo=c.slice(2).join(";"))}},generateGlobalParametersQueryStr:function(){a.debug("AdRequest.generateGlobalParametersQueryStr");var b=this._context.getParameter("wrapperVersion");b=[["prof",this._playerProfile,"string"],["nw",this._context._adManager._networkId,"number"],["caid",this._context._videoAsset._customId,"string"],["asid",this._context._videoAsset._id,
"string"],["vdur",this._context._videoAsset._duration,"number"],["asnw",this._context._videoAsset._networkId,"number"],["asml",this._context._videoAsset._location,"string"],["vprn",this._context._videoAsset._viewRandom,"number"],["afid",this._context._videoAsset._fallbackId,"string"],["vdty",this._context._videoAsset._durationType,"string"],["vtpo",this._context._videoAsset._currentTpos,"number"],["csid",this._siteSectionCustomId,"string"],["ssid",this._siteSectionId,"string"],["ssnw",this._siteSectionNetworkId,
"number"],["pvrn",this._siteSectionViewRandom,"number"],["sfid",this._siteSectionFallbackId,"string"],["vcid",this._visitorCustomId,"string"],["mode",this._requestMode,"string"],["vrdu",this._requestDuration,"number"],["ssto",this._subsessionToken,"number"],["cd",this._compatibleDimensions||this.detectScreenDimension(),"string"],["vclr",a.version+(b?","+b:""),"string"],["resp",a.PLATFORM_SEND_REQUEST_BY_FORM?"json2":"json","string"],["orig",window.location.protocol+"//"+window.location.host,"string"],
["cbfn","tv.freewheel.SDK._instanceQueue['Context_"+this._context._instanceId+"'].requestComplete","string"],["vip",this._visitorIpV4Address,"string"],["cana",this._candidateAdIds.join(","),"string"]];for(var c=0;c<b.length;c++){var d=b[c];switch(d[2]){case "string":a.Util.isBlank(d[1])||(this._urlParams[d[0]]=encodeURIComponent(d[1]));break;case "number":0<d[1]&&(this._urlParams[d[0]]=d[1])}}b="";for(var e in this._urlParams)this._urlParams.hasOwnProperty(e)&&(b+=e+"="+this._urlParams[e]+"&");b=
b.substring(0,b.length-1);0<this._slotScanner._candidateAds.length&&(null==this._capabilities._capabilities[a.CAPABILITY_CHECK_COMPANION]&&this._capabilities.setCapability(a.CAPABILITY_CHECK_COMPANION,a.CAPABILITY_STATUS_ON),null==this._capabilities._capabilities[a.CAPABILITY_CHECK_TARGETING]&&this._capabilities.setCapability(a.CAPABILITY_CHECK_TARGETING,a.CAPABILITY_STATUS_OFF));this._context._videoAsset._eventCallback||this._context._videoAsset._requestedVideoViewUrl||!this._context._videoAsset._id&&
!this._context._videoAsset._customId||this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_ON);this._capabilities._capabilities[a.CAPABILITY_DISPLAY_REFRESH]&&this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_OFF);b=this._capabilities.parseCapabilities(b);this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_UNSET);switch(this._context._videoAsset._autoPlayType){case a.VIDEO_ASSET_AUTO_PLAY_TYPE_CLICK_TO_PLAY:e=
"+cltp";break;case a.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED:e="+play+uapl";break;case a.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE:e="-play";break;default:e="+play-uapl"}return b=b.replace(/flag=/,"flag="+encodeURIComponent(e))},generateKeyValuesStr:function(){a.debug("AdRequest.generateKeyValuesStr");var b=a.Util.flashVersion();b=this._keyValues.concat(["_fw_h_x_flash_version="+encodeURIComponent(b),"_fw_dpr="+(void 0===window.devicePixelRatio?"1":window.devicePixelRatio.toFixed(2).toString())]);for(var c=0;c<
this._urlKeyValues.length;c++){var d=this._urlKeyValues[c];0>b.indexOf(d)&&b.push(d)}(c=this._context._adManager._location)&&b.push("ltlg="+encodeURIComponent(Math.round(1E4*c.coords.latitude)/1E4+","+Math.round(1E4*c.coords.longitude)/1E4));return b.join("&")},generateSlotsTypeBStr:function(){a.debug("AdRequest.generateSlotsTypeBStr");for(var b="",c=[],d=0;d<this._temporalSlots.length;d++){var e=this._temporalSlots[d];e=[["slid",e.getCustomId(),"string"],["slau",e.getAdUnit(),"string"],["ptgt","a",
"string"],["tpos",e.getTimePosition(),"number"],["cpsq",e.getCuepointSequence(),"number"],["envp",e.getSlotProfile(),"string"],["maxd",e.getMaxDuration(),"number"],["mind",e.getMinDuration(),"number"],["prct",e.getAcceptContentType(),"string"],["sgid",e.getSignalId(),"string"],["maxa",e.getMaxAds(),"number"]];for(var f=[],k=0;k<e.length;k++){var g=e[k];switch(g[2]){case "string":a.Util.isBlank(g[1])||f.push(g[0]+"="+encodeURIComponent(g[1]));break;case "number":-1<["cpsq","maxd","mind","maxa"].indexOf(g[0])?
0<g[1]&&f.push(g[0]+"="+g[1]):0<=g[1]&&f.push(g[0]+"="+g[1])}}c.push(f.join("&"))}0<c.length&&(b=c.join(";")+";");return b+=this._slotScanner.slotsToTypeBStr()},detectScreenDimension:function(){a.debug("AdRequest.detectScreenDimension:",screen.width+","+screen.height);return screen.width+","+screen.height},useTCFAPI:function(){a.debug("AdRequest.useTCFAPI");if(this._context.getParameter(a.PARAMETER_USE_GDPR_TCFAPI)){var b=this._context._adManager._fwGDPR||"",c=this._context._adManager._fwGDPRConsent||
"";this.removeKey("_fw_gdpr");this.removeKey("_fw_gdpr_consent");this.addKeyValue("_fw_gdpr",b.toString());this.addKeyValue("_fw_gdpr_consent",c)}},useUSPAPI:function(){a.debug("AdRequest.useUSPAPI");if(this._context.getParameter(a.PARAMETER_USE_CCPA_USPAPI)){var b=this._context._adManager._fwUSPString||"";""!=b&&(this.removeKey("_fw_us_privacy"),this.addKeyValue("_fw_us_privacy",b))}}};a.AdInstance=function(b){this._context=b;this._creativeRenditionId=this._creativeId=this._soAdUnit=this._adId=this._slot=
null;this._universalAdIdRegistry=this._universalAdId=this._action=this._marketUnifiedAdId=this._openExchangeId=this._dealId=this._replicaId="";this._primaryCreativeRendition=this._creative=null;this._creativeRenditions=[];this._noLoad=!1;this._companionAdInstances=[];this._eventCallbacks=[];this._externalEventCallbackUrlsDictionary={};this._rendererController=new a.RendererController(b,this);this._timer=new a.Timer;this._metr=0;this._state=a.MediaInitState.instance;this._isStartSuccessfully=this._translated=
this._isImpressionSent=this._isInitiatedSent=!1;this._lastDurationFromRenderer=-1;this._slotCustomId=this._parentAdInstancesGroup=null;this._isSkipped=!1;this._wrapperCount=0;this._startTimePosition=-1;this._adVerifications=[];this._skipOffset=-1;this._progressEventCallbackUrlsDict={};this._progressPercentageEventCallbackUrlsDict={};this._skipOffsetPercentage=-1};a.AdInstance.prototype={};a.AdInstance.prototype.constructor=a.AdInstance;a.METR_MASK_QUARTILE=0;a.METR_MASK_MIDPOINT=1;a.METR_MASK_COMPLETE=
2;a.METR_MASK_VOLUME=3;a.METR_MASK_SIZE=4;a.METR_MASK_CONTROL=5;a.METR_MASK_REWIND=6;a.METR_MASK_ACCEPT_INVITATION=7;a.METR_MASK_CLOSE=8;a.METR_MASK_MINIMIZE=9;a.METR_MASK_CLICK=10;a.AdInstance._metrDictionary={};a.AdInstance._metrDictionary[a.EVENT_AD_FIRST_QUARTILE]=a.AdInstance._metrDictionary[a.EVENT_AD_THIRD_QUARTILE]=a.AdInstance._metrDictionary[a.EVENT_AD_QUARTILE]=1<<a.METR_MASK_QUARTILE|1<<a.METR_MASK_MIDPOINT|1<<a.METR_MASK_COMPLETE;a.AdInstance._metrDictionary[a.EVENT_AD_MIDPOINT]=1<<a.METR_MASK_MIDPOINT|
1<<a.METR_MASK_COMPLETE;a.AdInstance._metrDictionary[a.EVENT_AD_COMPLETE]=1<<a.METR_MASK_COMPLETE;a.AdInstance._metrDictionary[a.EVENT_AD_MUTE]=1<<a.METR_MASK_VOLUME;a.AdInstance._metrDictionary[a.EVENT_AD_UNMUTE]=1<<a.METR_MASK_VOLUME;a.AdInstance._metrDictionary[a.EVENT_AD_COLLAPSE]=1<<a.METR_MASK_SIZE;a.AdInstance._metrDictionary[a.EVENT_AD_EXPAND]=1<<a.METR_MASK_SIZE;a.AdInstance._metrDictionary[a.EVENT_AD_PAUSE]=1<<a.METR_MASK_CONTROL;a.AdInstance._metrDictionary[a.EVENT_AD_RESUME]=1<<a.METR_MASK_CONTROL;
a.AdInstance._metrDictionary[a.EVENT_AD_REWIND]=1<<a.METR_MASK_REWIND;a.AdInstance._metrDictionary[a.EVENT_AD_ACCEPT_INVITATION]=1<<a.METR_MASK_ACCEPT_INVITATION;a.AdInstance._metrDictionary[a.EVENT_AD_CLOSE]=1<<a.METR_MASK_CLOSE;a.AdInstance._metrDictionary[a.EVENT_AD_MINIMIZE]=1<<a.METR_MASK_MINIMIZE;a.AdInstance._metrDictionary[a.EVENT_AD_CLICK]=1<<a.METR_MASK_CLICK;a.Util.mixin(a.AdInstance.prototype,{getAdId:function(){return this._adId},getUniversalAdId:function(){if(""!=this._universalAdId)return{idRegistry:this._universalAdIdRegistry,
idValue:this._universalAdId};var a=this.getActiveCreativeRendition();return a?a.getUniversalAdId():null},getSoAdUnit:function(){return this._soAdUnit},getParameter:function(a){var b=[];this._context.getParameter(a)&&b.push(this._context.getParameter(a));this._primaryCreativeRendition.getParameter(a)&&b.push(this._primaryCreativeRendition.getParameter(a));this._creative.getParameter(a)&&b.push(this._creative.getParameter(a));this._slot.getParameter(a)&&b.push(this._slot.getParameter(a));return b},
addProgressEventCallbackUrls:function(a,c){this._progressEventCallbackUrlsDict.hasOwnProperty(a)?(c=this._progressEventCallbackUrlsDict[a].concat(c),this._progressEventCallbackUrlsDict[a]=c):this._progressEventCallbackUrlsDict[a]=c||[]},addPercentageProgressEventCallbackUrls:function(a,c){this._progressPercentageEventCallbackUrlsDict.hasOwnProperty(a)?(c=this._progressPercentageEventCallbackUrlsDict[a].concat(c),this._progressPercentageEventCallbackUrlsDict[a]=c):this._progressPercentageEventCallbackUrlsDict[a]=
c||[]},adjustOffsetAndProgressWithRendererDuration:function(b){-1!==this._skipOffsetPercentage&&(this._skipOffset=a.Util.offsetStringToSecond(this._skipOffsetPercentage+"%",b));if(0!==Object.keys(this._progressPercentageEventCallbackUrlsDict).length){this._progressEventCallbackUrlsDict={};for(var c in this._progressPercentageEventCallbackUrlsDict){var d=a.Util.offsetStringToSecond(c+"%",b);this._progressEventCallbackUrlsDict[d]=this._progressEventCallbackUrlsDict[d]?this._progressEventCallbackUrlsDict[d].concat(this._progressPercentageEventCallbackUrlsDict[c]):
[].concat($jscomp.arrayFromIterable(this._progressPercentageEventCallbackUrlsDict[c]))}}},getAdSkippableState:function(){return"VPAID"===this.getActiveCreativeRendition().getCreativeApi()?this._rendererController.getRenderer().getAdSkippableState():-1===this.getSkipOffset()?!1:this.getPlayheadTime()>=this.getSkipOffset()},getEventCallbackUrls:function(b,c){var d=[],e=c===a.EVENT_TYPE_CLICK,f=c===a.EVENT_TYPE_CLICK_TRACKING;b=a.EventCallback.getEventCallback(this._eventCallbacks,b,f?a.EVENT_TYPE_CLICK:
c);if(!b)return d;c={};c[a.INFO_KEY_NEED_EMPTY_CT]=!0;e?b._showBrowser&&d.push(b.getUrl(c)):f?b._showBrowser||d.push(b.getUrl(c)):d.push(b.getUrl(c));e||(d=d.concat(b.getTrackingUrls()));return d},addEventCallbackUrls:function(a,c,d){d&&this._isValidEventNameAndType(a,c)&&(this._externalEventCallbackUrlsDictionary[c+"-"+a]=this.getExternalEventCallbackUrls(a,c).concat(d))},setClickThroughUrl:function(b,c){c&&this._isValidEventNameAndType(b,a.EVENT_TYPE_CLICK)&&(b=this.getEventCallback(b,a.EVENT_TYPE_CLICK))&&
(a.Util.isParameterInURL(b._url,a.URL_PARAMETER_KEY_CR)||(b._url=b._url+"&"+a.URL_PARAMETER_KEY_CR+"="),b._url=a.Util.setParameterInURL(b._url,a.URL_PARAMETER_KEY_CR,c),b._showBrowser=!0)},addAdVerifications:function(a){for(var b=0;b<a.length;b++)this._adVerifications.push(a[b])},addCreativeRendition:function(){var b=new a.CreativeRendition;b.parse({creativeRenditionId:this._creativeRenditionId,adReplicaId:this._replicaId,preference:0});b.setBaseUnit(this._creative.getBaseUnit());b.setDuration(this._creative.getDuration());
this._creativeRenditions.push(b);this.isPlaceholder()&&(this._noLoad=!1);return b},getRendererController:function(){return this._rendererController},getSlot:function(){this._slot||(this._slot=this._context._adResponse.getSlotByCustomId(this._slotCustomId));return this._slot},getCompanionSlots:function(){for(var a=[],c=0;c<this._companionAdInstances.length;c++)a.push(this._companionAdInstances[c]._slot);return a},getActiveCreativeRendition:function(){return this._primaryCreativeRendition},setActiveCreativeRendition:function(b){b?
(-1===this._creativeRenditions.indexOf(b)&&this._creativeRenditions.push(b),this._primaryCreativeRendition=b,this._creativeRenditionId=b.getId()):a.warn("AdInstance.setActiveCreativeRendition","rendition is null")},getAllCreativeRenditions:function(){var a=this._creativeRenditions.slice();a.sort(function(a,b){return b.getPreference()-a.getPreference()});var c=a.indexOf(this._primaryCreativeRendition);-1<c&&(a.splice(c,1),a.unshift(this._primaryCreativeRendition));return a},getRenderableCreativeRenditions:function(){var a=
this._creativeRenditions.slice().sort(function(a,b){return b.getPreference()-a.getPreference()}).filter(function(a){return this._rendererController.rendererMatch(a)},this),c=a.indexOf(this._primaryCreativeRendition);-1<c&&(a.splice(c,1),a.unshift(this._primaryCreativeRendition));return a},getPlayheadTime:function(){var b=-1;if(this._rendererController.getRenderer()&&"function"===typeof this._rendererController.getRenderer().getPlayheadTime)try{b=this._rendererController.getRenderer().getPlayheadTime()}catch(c){a.warn("AdInstance.getPlayheadTime",
c.description)}return b},getDuration:function(){var a=-1;this._rendererController.getRenderer()&&"function"===typeof this._rendererController.getRenderer().getDuration&&(this._lastDurationFromRenderer=a=this._rendererController.getRenderer().getDuration());-1===a&&(a=-1<this._lastDurationFromRenderer?this._lastDurationFromRenderer:this.getActiveCreativeRendition().getDuration());return a},parse:function(b){if(b){this._adId=b.adId||null;this._creativeId=b.creativeId||null;this._creativeRenditionId=
b.creativeRenditionId||null;this._replicaId=b.hasOwnProperty("replicaId")?b.replicaId:"";this._dealId=b.hasOwnProperty("dealId")?b.dealId:"";this._openExchangeId=b.hasOwnProperty("openExchangeId")?b.openExchangeId:"";this._marketUnifiedAdId=b.hasOwnProperty("marketUnifiedAdId")?b.marketUnifiedAdId:"";this._action=b.hasOwnProperty("action")?b.action:"";this._universalAdId=b.hasOwnProperty("universalAdId")?b.universalAdId:"";this._universalAdIdRegistry=b.hasOwnProperty("universalAdIdRegistry")?b.universalAdIdRegistry:
"";this._noLoad=this._context._adResponse.getAd(this._adId).getNoLoad();this._soAdUnit=this._context._adResponse.getAd(this._adId).getSoAdUnit();this._creative=this._context._adResponse.getCreative(this._adId,this._creativeId);this._creativeRenditions=this._creative.getEligibleCreativeRenditionsForAdInstance(this);var c,d;var e=0;for(c=b.eventCallbacks||[];e<c.length;e++){var f=c[e];if(d=a.EventCallback.newEventCallback(this._context,f.name,f.type))d._adInstance=this,d.parse(f),this._eventCallbacks.push(d)}e=
0;for(c=b.companionAds||[];e<c.length;++e)(f=c[e])&&f.adSlotCustomId&&(d=new a.AdInstance(this._context),d._slotCustomId=f.adSlotCustomId,d.parse(f),this._companionAdInstances.push(d));e=0;for(c=b.fallbackAds||[];e<c.length;++e)f=c[e],d=new a.AdInstance(this._context),this._parentAdInstancesGroup.push(d),d._slot=this._slot,d._parentAdInstancesGroup=this._parentAdInstancesGroup,d.parse(f);0<this._creativeRenditions.length&&(this._primaryCreativeRendition=this._creativeRenditions[0])}},play:function(){a.log("AdInstance.play "+
this._slotCustomId);this._timer.tick();this.processEvent(a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION);this._isStartSuccessfully||(a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&this._context.dispatchEvent(a.EVENT_AD_IMPRESSION,{adInstance:this,slotCustomId:this._slotCustomId}),this._isStartSuccessfully=!0);this._state.play(this);if(this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]===a.MODULE_TYPE_RENDERER)for(var b=0;b<this._companionAdInstances.length;b++)this._companionAdInstances[b].isPlaceholder()||
this._companionAdInstances[b].getSlot().playCompanionAds(this._companionAdInstances[b])},pause:function(){a.log("AdInstance.pause "+this._slotCustomId);this._isStartSuccessfully?this._rendererController&&this._rendererController.pause():a.log("Ad hasn't started yet. Ignore.")},resume:function(){a.log("AdInstance.resume"+this._slotCustomId);this._isStartSuccessfully?this._rendererController&&this._rendererController.resume():a.log("Ad hasn't started yet. Ignore.")},skip:function(){a.log("AdInstance.skip");
"VPAID"!==this.getActiveCreativeRendition().getCreativeApi()?(this._processSkipEvent(),this.stop()):this._rendererController.getRenderer().attemptSkip()},_processSkipEvent:function(){this._isSkipped=!0;this.processEvent(a.EVENT_AD_SKIPPED,a.EVENT_TYPE_STANDARD)},stop:function(){a.log("AdInstance.stop");this._rendererController.stop()},fakeComplete:function(){this._slot.getTimePositionClass()===a.TIME_POSITION_CLASS_DISPLAY&&(this._isStartSuccessfully=!1,this._slot.playNextAdInstance())},complete:function(){this._isStartSuccessfully&&
(this.processEvent(a.EVENT_AD_IMPRESSION_END,a.EVENT_TYPE_IMPRESSION),a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&this._context.dispatchEvent(a.EVENT_AD_IMPRESSION_END,{adInstance:this}));this._state.complete(this);this._rendererController._restorePlaceholdersForHybrid();this._rendererController.setRenderer(null);this._isStartSuccessfully=!1;this._slot.playNextAdInstance()},isStarted:function(){return this._isStartSuccessfully},onStartPlaying:function(){a.MODULE_TYPE_RENDERER===
this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]?this._isImpressionSent=!0:this._translated=!0},onCompletePlaying:function(){},onStartReplaying:function(){},onCompleteReplaying:function(){},getEventCallback:function(b,c){return a.EventCallback.getEventCallback(this._eventCallbacks,b,c)},processEvent:function(b,c,d,e){var f=!0;c=this.getEventCallback(b,c);b===a.EVENT_AD_IMPRESSION&&this._isStartSuccessfully&&(c=this.getEventCallback(a.EVENT_ERROR,a.EVENT_TYPE_ERROR),d={errorInfo:"Trying to send defaultImpression multiple times"},
f=!1);c?e||c.process(d):f=!1;b===a.EVENT_AD_CLICK&&this._context.dispatchEvent(a.EVENT_AD_CLICK,{adInstance:this});if(b!==a.EVENT_AD_IMPRESSION&&b!==a.EVENT_AD_IMPRESSION_END||a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE])e={subType:b,adInstance:this,slot:this._slot},b===a.EVENT_AD_SKIPPABLE_STATE_CHANGED&&(e[a.INFO_KEY_AD_SKIPPABLE_STATE]=this.getAdSkippableState()),b===a.EVENT_ERROR&&(e[a.INFO_KEY_ERROR_CODE]=d[a.INFO_KEY_ERROR_CODE],e[a.INFO_KEY_ERROR_INFO]=
d[a.INFO_KEY_ERROR_INFO],e[a.INFO_KEY_ERROR_MODULE]=d[a.INFO_KEY_ERROR_MODULE]),b===a.EVENT_AD_MEASUREMENT&&(e[a.INFO_KEY_CONCRETE_EVENT_ID]=d[a.INFO_KEY_CONCRETE_EVENT_ID]),this._context.dispatchEvent(a.EVENT_AD,e);return f},processProgressEvent:function(b){var c=a.EventCallback.newEventCallback(this._rendererController.getContext(),a.EVENT_AD_PROGRESS);c._trackingUrls=this._progressEventCallbackUrlsDict[b];this._context.dispatchEvent(a.EVENT_AD,{subType:a.EVENT_AD_PROGRESS,adInstance:this,slot:this._slot,
offset:b});c.process()},setVolume:function(b){a.debug("AdInstance.setVolume("+b+")");this.isStarted()&&"function"===typeof this._rendererController.getRenderer().setVolume&&this._rendererController.getRenderer().setVolume(b)},setMetr:function(b,c){var d=a.AdInstance._metrDictionary[b],e=c;d&&(b===a.EVENT_AD_CLICK&&(e=!c),this._metr=e===a.CAPABILITY_STATUS_ON||!0===e?this._metr|d:this._metr&~d)},getExternalEventCallbackUrls:function(a,c){return(this._externalEventCallbackUrlsDictionary[c+"-"+a]||[]).slice()},
reset:function(){this._rendererController.reset();for(var b=0;b<this._companionAdInstances.length;b++){var c=this._companionAdInstances[b];c._state!==a.MediaPlayingState.instance&&c._state!==a.MediaReplayingState.instance||c.stop();c._rendererController.reset()}},cloneForTranslation:function(){var b=new a.AdInstance(this._context);b._adId=this._adId;b._creativeId=this._creativeId;b._creative=this._creative.cloneForTranslation();b._creativeRenditionId=this._creativeRenditionId;b._isInitiatedSent=this._isInitiatedSent;
b._noLoad=this._noLoad;b._slot=this.getSlot();b._soAdUnit=this.getSoAdUnit();b._replicaId=this._replicaId;b._dealId=this._dealId;b._openExchangeId=this._openExchangeId;b._marketUnifiedAdId=this._marketUnifiedAdId;b._action=this._action;b._universalAdId=this._universalAdId;b._universalAdIdRegistry=this._universalAdIdRegistry;b._wrapperCount=this._wrapperCount;b._adVerifications=this._adVerifications;b._skipOffset=this._skipOffset;b._skipOffsetPercentage=this._skipOffsetPercentage;for(var c=0;c<this._eventCallbacks.length;c++){var d=
this._eventCallbacks[c].copy();d._adInstance=b;b._eventCallbacks.push(d)}b._externalEventCallbackUrlsDictionary=a.Util.copy(this._externalEventCallbackUrlsDictionary);b._progressEventCallbackUrlsDict=a.Util.copy(this._progressEventCallbackUrlsDict);b._progressPercentageEventCallbackUrlsDict=a.Util.copy(this._progressPercentageEventCallbackUrlsDict);for(c=0;c<this._companionAdInstances.length;c++)this._companionAdInstances[c].isPlaceholder()?b._companionAdInstances.push(this._companionAdInstances[c].cloneForTranslation()):
b._companionAdInstances.push(this._companionAdInstances[c]);return b},isPlaceholder:function(){return this._noLoad},setMediaState:function(a){this._state=a},_isValidEventNameAndType:function(b,c){return a.Util.isBlank(b)||a.Util.isBlank(c)?!1:c===a.EVENT_TYPE_CLICK||c===a.EVENT_TYPE_CLICK_TRACKING||c===a.EVENT_TYPE_IMPRESSION&&(b===a.EVENT_AD_IMPRESSION||b===a.EVENT_AD_FIRST_QUARTILE||b===a.EVENT_AD_MIDPOINT||b===a.EVENT_AD_THIRD_QUARTILE||b===a.EVENT_AD_COMPLETE)||c===a.EVENT_TYPE_STANDARD&&(b===
a.EVENT_AD_PAUSE||b===a.EVENT_AD_RESUME||b===a.EVENT_AD_REWIND||b===a.EVENT_AD_MUTE||b===a.EVENT_AD_UNMUTE||b===a.EVENT_AD_COLLAPSE||b===a.EVENT_AD_EXPAND||b===a.EVENT_AD_MINIMIZE||b===a.EVENT_AD_CLOSE||b===a.EVENT_AD_ACCEPT_INVITATION||b===a.EVENT_AD_SKIPPED||b===a.EVENT_AD_PROGRESS)||c===a.EVENT_TYPE_ERROR&&b===a.EVENT_ERROR},isPlayable:function(){var b=!(this._rendererController.getRendererState()===a.RendererFailedState.instance&&!this._isImpressionSent);if(!b)return a.debug("AdInstance.isPlayable returning false isImpressionSent:",
this._isImpressionSent),b;(b=b&&!this._translated)||a.debug("AdInstance.isPlayable returning false translated:",this._translated);return b},toString:function(){return"[AdInstance "+this._adId+"]"},getCompanionAdInstances:function(){for(var a=[],c=0;c<this._companionAdInstances.length;++c)this._companionAdInstances[c].isPlaceholder()||a.push(this._companionAdInstances[c]);return a},isRequiredToShow:function(){return this._context._adResponse.getAd(this._adId).isRequiredToShow()},incrementWrapperCount:function(){this._wrapperCount++},
getWrapperCount:function(){return this._wrapperCount},getDealId:function(){return this._dealId},getOpenExchangeId:function(){return this._openExchangeId},getMarketUnifiedAdId:function(){return this._marketUnifiedAdId},getAction:function(){return this._action},setStartTimePosition:function(b){!isNaN(b)&&-1<b&&b<this.getDuration()?this._startTimePosition=Math.round(b):a.warn("AdInstance.setStartTimePosition","invalid start time position")},getStartTimePosition:function(){return this._startTimePosition},
getSkipOffset:function(){return this._skipOffset},_setSkipOffset:function(b){this._skipOffset=a.Util.offsetStringToSecond(b,this.getDuration())},_setSkipOffsetPercentage:function(b){this._skipOffsetPercentage=a.Util.offsetStringToPercentage(b)}});a.EventDispatcher=function(){this._listeners={}};a.EventDispatcher.prototype={addEventListener:function(a,c){"undefined"===typeof this._listeners[a]&&(this._listeners[a]=[]);this._listeners[a].push(c)},dispatchEvent:function(b){"string"===typeof b&&(b={type:b});
b.target||(b.target=this);if(b.type&&this._listeners[b.type]instanceof Array)for(var c=this._listeners[b.type],d=0,e=c.length;d<e;d++)try{c[d]&&c[d].call(this,b)}catch(f){a.warn("EventDispatcher.dispatchEvent",b.type,f)}},removeEventListener:function(a,c){if(this._listeners[a]instanceof Array){var b=this._listeners[a];if(null==c)this._listeners[a]=[];else{a=0;for(var e=b.length;a<e;a++)if(b[a]===c){b.splice(a,1);break}}}}};a.EventDispatcher.prototype.constructor=a.EventDispatcher;a.DashRenderer=function(){this._fwDashPlayer=
null;this._duration=this._playheadTime=-1;this._dragging=this._stopInvoked=this._isEnded=!1;this._volume=1;this._rendererController=null;this._isBuffering=!1;this._autoPauseAdOnVisibilityChange=!0;this._dashjs=window.tv.freewheel.Dashjs;this._adVideoPauseState=""};a.DashRenderer.prototype={pause:function(){this._rendererController&&this._rendererController.processEvent({name:a.EVENT_AD_PAUSE});this._fwDashPlayer&&!this._fwDashPlayer.isPaused()&&this._fwDashPlayer.pause();this._adVideoPauseState=a.AD_VIDEO_PAUSED_BY_RENDERER},
resume:function(){this._rendererController&&this._rendererController.processEvent({name:a.EVENT_AD_RESUME});this._fwDashPlayer&&this._fwDashPlayer.isPaused()&&this._fwDashPlayer.play();this._adVideoPauseState=a.AD_VIDEO_UNPAUSED},start:function(b){this._rendererController=b;var c=this._rendererController.getAdInstance(),d=c.getSlot(),e=this,f=!1,k=!1;this._autoPauseAdOnVisibilityChange=this._rendererController.getParameter(a.PARAMETER_AUTO_PAUSE_AD_ONVISIBILITYCHANGE);if(a.PLATFORM_NOT_SUPPORT_VIDEO_AD)this._onRendererFailed(a.ERROR_DEVICE_LIMIT,
d.getTimePositionClass());else if(a.PLATFORM_NOT_SUPPORT_MIDROLL_AD&&d.getTimePositionClass()===a.TIME_POSITION_CLASS_MIDROLL)this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"midroll");else if(a.PLATFORM_NOT_SUPPORT_DASH)this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"MPEG-DASH playback not supported on this platform");else{a.log("DashRenderer.start",d.getTimePositionClass(),c);var g=this._rendererController.getContentVideoElement(),n=d.getVideoDisplaySize().width,h=d.getVideoDisplaySize().height,l=c.getRenderableCreativeRenditions();
b=(b=this._rendererController.getParameter(a.PARAMETER_DESIRED_BITRATE))&&0<Number(b)?Number(b):null;if((n=(h=(new a.RenditionSelector(b||1E3,this._rendererController.getParameter("arWeight")||1,this._rendererController.getParameter("pxWeight")||1,.2)).getBestDashRendition(l,n,h))?h.getPrimaryCreativeRenditionAsset():null)&&l.length)if(n.getProxiedUrl()){c.setActiveCreativeRendition(h);a.log("DashRenderer.start selected rendition is:",n.getUrl());this._rendererController.setCapability(a.EVENT_AD_QUARTILE,
a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_MUTE,a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_PAUSE,a.CAPABILITY_STATUS_ON);var q=!a.PLATFORM_NOT_SUPPORT_CLICK_FOR_VIDEO;q||this._rendererController.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF);var P=a.PLATFORM_EVENT_CLICK,I=a.MOBILE_EVENT_DRAG;a.debug("DashRenderer","use content video element");g.controls=!1;var m=this._dashjs.MediaPlayer().create();m.initialize();l=m.getVersion();
a.debug("dash.js -v "+m.getVersion()+" loaded");if(0!==a.Util.compareVersion(l,a.PLATFORM_DASHJS_SUPPORTED_VERSION))this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"Unsupported tv.freewheel.Dash.js version");else{m.setAutoPlay(!1);m.attachView(g);b&&m.updateSettings({streaming:{abr:{initialBitrate:{video:b}}}});m.attachSource(n.getUrl());m.preload();this._fwDashPlayer=m;var r=null,x=null,L=null;this._volume=this._rendererController.getContext().getAdVolume();m.setVolume(this._volume);m.setMute(0===this._volume);
var M=function(b){a.debug("DashRenderer.checkTimeUpdate timeout");J(b)},N=function(){x&&(clearTimeout(x),x=null)},Q=a.Util.bind(this,function(b){a.debug("onAdVideoPlaybackStalled(): Ad video event "+b.type);b=this._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_PLAY_AFTER_STALLED);null!==b&&"undefined"!==typeof b&&!1!==a.Util.str2bool(b)&&(a.debug("play the ad immediately after the stalled event"),m&&m._fw_videoAdPlaying&&m.play())}),U=function(b){e._isBuffering||(e._isBuffering=!0,e._rendererController.processEvent({name:a.EVENT_AD_BUFFERING_START}),
a.debug("onAdVideoBufferingStarted(): Ad video event "+b.type))},R=function(b){e._isBuffering&&(e._isBuffering=!1,e._rendererController.processEvent({name:a.EVENT_AD_BUFFERING_END}),a.debug("onAdVideoBufferingEnded(): Ad video event "+b.type))};b=this._rendererController.getParameter(a.PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT);var t=null;b&&(t=document.getElementById(b));t||(t=g);var F=a.Util.bind(this,function(b){if(m.isPaused()&&a.PLATFORM_NOT_FIRE_CLICK_WHEN_AD_VIDEO_PAUSED)m.play();else{var c=
this._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_CLICK_DETECTION);null==c&&(c="true");!1!==a.Util.str2bool(c)&&(k?(a.debug("Ad video event "+b.type),this._dragging?this._dragging=!1:this._rendererController.processEvent({name:a.EVENT_AD_CLICK})):a.debug("Ad not started, ignore click."))}}),u=a.Util.bind(this,function(b){a.debug("Ad video event "+b.type);this._dragging=!0}),w,v=function(b){a.debug("Ad video event "+b.type+" ended: "+g.ended+" playing: "+m._fw_videoAdPlaying);b=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE);
null==b&&(b="true");!1===a.Util.str2bool(b)?a.debug("Pause controls disabled"):g.controls=!0;N()},G=function(b){a.debug("Ad video event "+b.type);g.controls=!1;e._videoPausedByRenderer=!1},y=0,D=function(b){a.debug("Ad video event "+b.type);0>=m.time()?a.debug("DashRenderer.onAdVideoTimeUpdate currentTime is less than or 0"):(N(),m.isPaused()||(b=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT)||8E3,x=setTimeout(M,b,b+"ms timeout when playing")),k||(k=!0,e._playheadTime=
m.time(),0>e._playheadTime&&(e._playheadTime=0),r&&(clearTimeout(r),r=null),e._quartileTimerId=setInterval(function(){var b=m.time(),c=m.duration();0<b&&(e._playheadTime=b);0<c&&(e._duration=c);"number"!==typeof b||"number"!==typeof c||L||(e._rendererController&&(e._rendererController.checkProgress(b),e._rendererController.checkForSkippableStateChange()),b>=.25*c&&1>y&&(e._rendererController.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),y=1),b>=.5*c&&2>y&&(e._rendererController.processEvent({name:a.EVENT_AD_MIDPOINT}),
y=2),b>=.75*c&&3>y&&(clearInterval(e._quartileTimerId),e._quartileTimerId=null,e._rendererController.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),y=3))},1E3),c.adjustOffsetAndProgressWithRendererDuration(m.duration()),e._rendererController.handleStateTransition(a.RENDERER_STATE_STARTED)))};this.dispose=a.Util.bind(this,function(){K()});var K=function(b){e.playAdAfterStartDelay&&(clearTimeout(e.playAdAfterStartDelay),e.playAdAfterStartDelay=null);var c=L;b&&b.type&&(a.debug("DashRenderer onAdVideoEnded. Ad video event: "+
b.type),"error"===b.type&&b.target&&(a.warn(b.target.src),a.warn(b.target.currentSrc),R(b)));N();r&&(clearTimeout(r),r=null);q&&(t.removeEventListener(P,F,!1),t.removeEventListener(I,u,!1));w&&(clearTimeout(w),w=null);V&&e._autoPauseAdOnVisibilityChange&&(document.removeEventListener("visibilitychange",V,!1),V=null);var d=e._dashjs.MediaPlayer.events;m.off(d.PLAYBACK_ENDED,K,e);m.off(d.PLAYBACK_ERROR,K,e);m.off(d.ERROR,K,e);m.off(d.PLAYBACK_PAUSED,v,e);m.off(d.PLAYBACK_PLAYING,G,e);m.off(d.PLAYBACK_TIME_UPDATED,
D,e);m.off(d.PLAYBACK_STALLED,Q,e);m.off(d.BUFFER_EMPTY,U,e);m.off(d.BUFFER_LOADED,R,e);m.off(d.PLAYBACK_NOT_ALLOWED,O,e);m.isPaused()||(a.debug("try pausing video before complete"),m.pause());b&&"error"===b.type&&b.target?(c="video error",(b=g.error||b.target.error)&&(c="error:"+b+",code:"+b.code)):b&&"error"===b.type&&b.error?c="dashjs error, dashjs-error-message: "+b.error.message+", dashjs-error-code: "+b.error.code:b&&"playbackError"===b.type&&b.error&&(c="dashjs playbackError");c||(e._isEnded=
!0);a.log("DashRenderer.complete");if(f)e._rendererController.checkProgress(m.duration());else{f=!0;delete m._fw_videoAdPlaying;b=m.time();d=m.duration();e._fwDashPlayer=null;try{m.reset()}catch(W){a.warn("Error resetting fw dashjs player: ",W)}m=null;e._quartileTimerId&&(clearInterval(e._quartileTimerId),e._quartileTimerId=null);c?(b=null,c.includes("timeout")?b=a.ERROR_TIMEOUT:c.includes("dashjs")&&(b=a.ERROR_DASHJS),e._onRendererFailed(b,c)):(e._stopInvoked||(b>=.25*d&&1>y&&(e._rendererController.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),
y=1),b>=.5*d&&2>y&&(e._rendererController.processEvent({name:a.EVENT_AD_MIDPOINT}),y=2),b>=.75*d&&3>y&&(e._rendererController.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),y=3),b>=d-.5&&4>y&&(e._rendererController.checkProgress(d),e._rendererController.processEvent({name:a.EVENT_AD_COMPLETE}),y=4)),e._stopInvoked=!1,e._rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED))}e._rendererController=null};var J=function(b){L=b;a.warn(L);a.PLATFORM_WAIT_WHEN_AD_VIDEO_TIMEOUT||K()},V=function(b){a.log("onVisibilityChange:"+
(document.hidden?"invisible":"visible"));document.hidden?e._adVideoPauseState!==a.AD_VIDEO_PAUSED_BY_RENDERER&&(m&&!m.isPaused()&&m.pause(),e._adVideoPauseState=a.AD_VIDEO_PAUSED_BY_TAB_SWITCH,e._rendererController&&e._rendererController.processEvent({name:a.EVENT_AD_PAUSE}),r&&(clearTimeout(r),r=null)):e._adVideoPauseState===a.AD_VIDEO_PAUSED_BY_TAB_SWITCH&&(e.resume(),k||!m._fw_fromVideoPool&&!a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT||(b=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT)||
5E3,r=setTimeout(J,b,b+"ms timeout before playing")))},O=function(){a.warn("Blocked by browser, need player to display a start button");e._fwDashPlayer.off(e._dashjs.MediaPlayer.events.PLAYBACK_NOT_ALLOWED,O,e);r&&(clearTimeout(r),r=null);d.setAutoPlayBlocked(!0);e._rendererController.processEvent({name:a.EVENT_AD_AUTO_PLAY_BLOCKED,info:{apiOnly:!0}})};m._fw_videoAdPlaying=!0;var E=!1;(function(){if(!E){E=!0;q&&(t.addEventListener(P,F,!1),t.addEventListener(I,u,!1));var b=e._dashjs.MediaPlayer.events;
m.on(b.PLAYBACK_ENDED,K,e);m.on(b.PLAYBACK_ERROR,K,e);m.on(b.ERROR,K,e);m.on(b.PLAYBACK_PAUSED,v,e);m.on(b.PLAYBACK_PLAYING,G,e);m.on(b.PLAYBACK_TIME_UPDATED,D,e);m.on(b.PLAYBACK_STALLED,Q,e);m.on(b.BUFFER_EMPTY,U,e);m.on(b.BUFFER_LOADED,R,e);m.on(b.PLAYBACK_NOT_ALLOWED,O,e);a.log("DashRenderer, play video ad "+m.getSource());if(m._fw_fromVideoPool||a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT)b=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT)||5E3,r=setTimeout(J,
b,b+"ms timeout before playing");a.PLATFORM_VIDEO_DOESNOT_SUPPORT_TIMEUPDATE&&e._rendererController.handleStateTransition(a.RENDERER_STATE_STARTED);b=100;0<a.PLATFORM_ANDROID_VERSION&&(b=e._rendererController.getParameter(a.PARAMETER_RENDERER_VIDEO_ANDROID_DELAY)||100);e.playAdAfterStartDelay=setTimeout(function(){e.playAdAfterStartDelay=null;document.hidden&&e._autoPauseAdOnVisibilityChange?(a.log("DashRenderer pause ad when tab is invisible."),e._adVideoPauseState=a.AD_VIDEO_PAUSED_BY_TAB_SWITCH,
m&&m.pause(),e._rendererController&&e._rendererController.processEvent({name:a.EVENT_AD_PAUSE}),r&&(clearTimeout(r),r=null)):m.play()},b);e._autoPauseAdOnVisibilityChange&&document.addEventListener("visibilitychange",V,!1)}})()}}else this._onRendererFailed(a.ERROR_NULL_ASSET);else this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"no compatible asset")}},stop:function(){a.debug("DashRenderer stop");this._stopInvoked=!0;this._fwDashPlayer&&(this._fwDashPlayer._fw_videoAdPlaying=!1,this._fwDashPlayer.pause(),
this.dispose());this._rendererController=null},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){if(this._isEnded&&0<this._duration)return this._duration;if(this._fwDashPlayer){var a=this._fwDashPlayer.time();if(0<a)return a}return this._playheadTime},getDuration:function(){return this._duration},setVolume:function(b){a.debug("DashRenderer setVolume("+b+")");this._fwDashPlayer?(this._fwDashPlayer.setVolume(b),this._fwDashPlayer.setMute(0===b),this._volume!==b&&
this._rendererController.processEvent({name:a.EVENT_AD_VOLUME_CHANGE}),0===this._volume&&0!==b?this._rendererController.processEvent({name:a.EVENT_AD_UNMUTE}):0!==this._volume&&0===b&&this._rendererController.processEvent({name:a.EVENT_AD_MUTE}),this._volume=b):a.debug("DashRenderer ad video is null, ignore.")},_onRendererFailed:function(b,c,d){var e={};e[a.INFO_KEY_ERROR_MODULE]="DashRenderer";e[a.INFO_KEY_ERROR_CODE]=b;d||(d=a.ERROR_VAST_GENERAL_LINEAR_ERROR);e[a.INFO_KEY_VAST_ERROR_CODE]=d;c&&
(e[a.INFO_KEY_ERROR_INFO]=c);this._rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,e)}};a.DashRenderer.prototype.constructor=a.DashRenderer;a.HTMLAdGenerator={log:function(b){a.log("HTMLAdGenerator\t"+b)},getExtension:function(a){return a?(a=a.match(/^[^?]+\/[^?.]*(\.\w+)+/))?a[a.length-1].slice(1):"":""},generateAd:function(b,c,d,e,f,k,g){a.HTMLAdGenerator.log("generatorAd("+[].slice.call(arguments,0).join(",")+")");var n=k,h=!1;null==n&&(h=!0,n=a.HTMLAdGenerator.getExtension(b).toLowerCase());
switch(n){case "jpeg":case "jpg":case "gif":case "png":case "image/jpeg":case "image/jpg":case "image/gif":case "image/png":case "image/bmp":n=a.HTMLAdGenerator.generateImageHTML(b,c);break;case "swf":case "application/x-shockwave-flash":n=a.HTMLAdGenerator.generateFlashHTML(b,c,d,e,f);break;case "script":case "js":case "text/javascript":case "text/js_ref":case "application/x-javascript":n=a.HTMLAdGenerator.generateScriptHTML(b,d,e,f);break;case "iframe":case "html":case "htm":case "text/html":case "text/html_doc_ref":case "text/html_lit_nowrapper":case "text/html_doc_lit_mobile":n=
a.HTMLAdGenerator.generateIFrameHTML(b,c,d,e,f);break;default:n=h?a.HTMLAdGenerator.generateIFrameHTML(b,c,d,e,f):a.HTMLAdGenerator.generateAd(b,c,d,e,f,null,g)}return"text/html_doc_lit_mobile"===g?a.HTMLAdGenerator.htmlLitToHTMLDocLitMobile(n):n},generateImageHTML:function(b,c){a.HTMLAdGenerator.log("generateImageHTML");return c?'<a rel="noopener noreferrer" href="'+c+'" target="_blank"><img src="'+b+'" border="0" /></a>':'<img src="'+b+'" border="0" />'},generateFlashHTML:function(b,c,d,e,f){a.HTMLAdGenerator.log("generateFlashHTML");
var k=b;c&&0<c.length&&(k+=-1===b.indexOf("?")?"?":"&",k+="clickTag="+encodeURIComponent(c));b='<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"WIDTH="'+e+'" HEIGHT="'+f+'" id="'+d+'_external_ad">'+('<PARAM NAME=movie VALUE="'+k+'"/>')+'<PARAM NAME=quality VALUE=high/><PARAM NAME=bgcolor VALUE=#FFFFFF/><PARAM NAME="allowScriptAccess" VALUE="always"/><PARAM NAME="loop" VALUE="true"/>';b+='<EMBED src="'+
k+'" ';return b+('quality=high bgcolor=#FFFFFF WIDTH="'+e+'" HEIGHT="'+f+'"NAME="'+d+'_external_video" ALIGN="" TYPE="application/x-shockwave-flash"PLUGINSPAGE="http://www.macromedia.com/go/getflashplayer"></EMBED></OBJECT>')},generateIFrameHTML:function(b,c,d,e,f){a.HTMLAdGenerator.log("generateIFrameHTML");return'<iframe height="'+f+'" width="'+e+'" frameborder="0" scrolling="no" allowtransparency="true" leftmargin="0" rightmargin="0" marginwidth="0" marginheight="0" src="'+b+'"></iframe>'},docLitToHTMLLit:function(b,
c,d,e){a.HTMLAdGenerator.log("docLitToHTMLLit");return'<iframe id="_fw_frame_'+c+'" width="'+d+'" height="'+e+'" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe><script language="javascript" type="text/javascript" id="_fw_container_js_'+c+"\">if(!fw_targets) {var fw_targets = [];}var _fw_wr;var fw_scope = document;var fw_content = '"+a.Util.encodeToHex(b)+"';var trgtFrm = fw_scope.getElementById(\"_fw_frame_"+c+'");trgtFrm = (trgtFrm.contentWindow) ? trgtFrm.contentWindow : (trgtFrm.contentDocument.document) ? trgtFrm.contentDocument.document : trgtFrm.contentDocument;fw_targets["'+
c+'"] = trgtFrm;if(navigator.userAgent.match(/\\bMSIE\\b/) || navigator.userAgent.match(/\\bOpera\\b/)){trgtFrm.document.open();trgtFrm.document.write(fw_content);setTimeout(function(){fw_close(fw_targets["'+c+'"])}, 7500);} else if (navigator.userAgent.match(/\\bFirefox\\b/)) {if(true && fw_content.length < 2000){var ec = escape(fw_content);var fw_iframe_url = "http://m2.feiwei.tv/g/lib/template/echo.html?s="+ec;fw_scope.getElementById("_fw_frame_'+c+'").src = fw_iframe_url;} else {trgtFrm.document.open();trgtFrm.document.write(fw_content);trgtFrm.document.close();}} else {trgtFrm.document.open();trgtFrm.document.write(fw_content);trgtFrm.document.close();}function fw_close(theFrame){theFrame.document.close();}\x3c/script>'},
htmlLitToDocLit:function(b){a.HTMLAdGenerator.log("htmlLitToDocLit");return'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>Advertisement</title></head><body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">'+b+"</body></html>"},wrapUnsafeHTML:function(b,c,d,e){return a.HTMLAdGenerator.htmlLitToHTMLDocLitMobile(a.HTMLAdGenerator.docLitToHTMLLit(a.HTMLAdGenerator.htmlLitToDocLit(b),c,d,e))},wrapJSCode:function(b,
c,d,e){return a.HTMLAdGenerator.wrapUnsafeHTML('<script language="javascript" type="text/javascript">'+b+"\x3c/script>",c,d,e)},generateScriptHTML:function(b,c,d,e){a.HTMLAdGenerator.log("generateScriptHTML");return a.HTMLAdGenerator.wrapUnsafeHTML('<script language="javascript" type="text/javascript" src="'+b+'">\x3c/script>',c,d,e)},htmlLitToHTMLDocLitMobile:function(b){a.HTMLAdGenerator.log("htmlLitToHTMLDocLitMobile");return'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta name = "viewport" content = "initial-scale = 1.0, target-densitydpi = device-dpi" /><title>Advertisement</title><script type="text/javascript">window._fw_page_url = "";\x3c/script></head><body style="margin:0px;background-color:transparent;">'+
b+"</body></html>"}};a.AdVerification=function(a){this.vendorKey="";this.javaScriptResources=this._parseJavaScriptResources(a);this.executableResources=this._parseExecutableResources(a);this.verificationParameters="";this.trackingEvents={};a["@attributes"]&&a["@attributes"].vendor&&(this.vendorKey=a["@attributes"].vendor);a.VerificationParameters&&a.VerificationParameters.value&&(this.verificationParameters=a.VerificationParameters.value);if(a.TrackingEvents&&a.TrackingEvents.Tracking)if(a=a.TrackingEvents.Tracking,
a.length)for(var b=0;b<a.length;b++)this._pushTrackingEvents(a[b]);else this._pushTrackingEvents(a)};a.AdVerification.prototype={dispatchAdVerificationNotExecutedWithReason:function(b){for(var c=this.trackingEvents[a.AD_VERIFICATION_EVENT_NOT_EXECUTED],d=0;d<c.length;d++){var e=c[d].replace("[REASON]",b);a.Util.pingURL(e)}},_pushTrackingEvents:function(a){var b=a["@attributes"].event;this.trackingEvents[b]?this.trackingEvents[b].push(a.value):this.trackingEvents[b]=[a.value]},_parseJavaScriptResources:function(a){return this._parseResources(a.JavaScriptResource,
this._parseJavaScriptResourceNode.bind(this))},_parseExecutableResources:function(a){return this._parseResources(a.ExecutableResource,this._parseExecutableResourceNode.bind(this))},_parseResources:function(a,c){var b=[];if(a)if(a.length)for(var e=0;e<a.length;e++){var f=c(a[e]);b.push(f)}else f=c(a),b.push(f);return b},_parseJavaScriptResourceNode:function(a){return{url:this._parseUrl(a),apiFramework:this._parseApiFramework(a),browserOptional:this._parseBrowserOptional(a)}},_parseExecutableResourceNode:function(a){return{url:this._parseUrl(a),
apiFramework:this._parseApiFramework(a),type:this._parseType(a)}},_parseUrl:function(b){try{return new URL(b.value),b.value}catch(c){return a.debug('AdVerification._parseUrl Error parsing "'+b.value+'". Error message:',c.message),""}},_parseApiFramework:function(a){return this._parseFromAttributes(a,"apiFramework")},_parseBrowserOptional:function(a){return this._parseFromAttributes(a,"browserOptional")},_parseType:function(a){return this._parseFromAttributes(a,"type")},_parseFromAttributes:function(a,
c){return(a=a["@attributes"])&&void 0!=a[c]?a[c]:""}};a.RenditionSelector=function(a,c,d,e){this._targetByterate=a;this._arWeight=c;this._pxWeight=d;this._conversionFactor=e};a.RenditionSelector.prototype={getBestFitRendition:function(b,c,d){b.reverse();b=b.filter(function(b){return b&&b.getPrimaryCreativeRenditionAsset()&&(b.getPrimaryCreativeRenditionAsset().getProxiedUrl()||b.getPrimaryCreativeRenditionAsset().getContent())&&a.Util.canPlayVideoType(b.getPrimaryCreativeRenditionAsset().getMimeType())}).sort(function(a,
b){return a.getBitrate()-b.getBitrate()});return b.length?this._getBitRateFilteredRenditions(b,c,d,this):null},getCustomPlayerBestFitRendition:function(a,c,d){a.reverse();a=a.filter(function(a){return a&&a.getPrimaryCreativeRenditionAsset()&&(a.getPrimaryCreativeRenditionAsset().getProxiedUrl()||a.getPrimaryCreativeRenditionAsset().getContent())}).sort(function(a,b){return a.getBitrate()-b.getBitrate()});return a.length?this._getBitRateFilteredRenditions(a,c,d,this):null},_getBitRateFilteredRenditions:function(a,
c,d,e){var b=Number.MAX_VALUE,k=a.filter(function(a){a=a.getBitrate();b=a<b?a:b;return a<=e._targetByterate});k.length||(k=a.filter(function(a){return a.getBitrate()<=b}));return k.sort(function(a,b){return e.compareVisualMetrics(a,b,c,d)}).pop()},getBestDashRendition:function(a,c,d){var b=this;a.reverse();return a.sort(function(a,e){return b.compareVisualMetrics(a,e,c,d)})[a.length-1]},compareVisualMetrics:function(a,c,d,e){var b=this.calculateVisualRatios(a.getWidth(),a.getHeight(),d,e);e=this.calculateVisualRatios(c.getWidth(),
c.getHeight(),d,e);return!b&&e?-1:b&&!e?1:b&&e&&(d=this._conversionFactor*this._arWeight*Math.log(e.arRatio),e=this._pxWeight*Math.log(e.pixelation),b=this.findDistance(this._conversionFactor*this._arWeight*Math.log(b.arRatio),this._pxWeight*Math.log(b.pixelation),0,0),d=this.findDistance(d,e,0,0),d!==b)?d-b:a.getPreference()-c.getPreference()},calculateVisualRatios:function(a,c,d,e){if(0<a&&0<c&&0<d&&0<e){var b=a/c,k=d/e;b>k?e=d/b:d=e*b;return{arRatio:b/k,pixelation:a*c/(d*e)}}return null},findDistance:function(a,
c,d,e){return isNaN(a)||isNaN(d)||isNaN(c)||isNaN(e)?NaN:Math.sqrt(Math.pow(d-a,2)+Math.pow(e-c,2))}};a.RenditionSelector.prototype.constructor=a.RenditionSelector;a.PageSlotScanner=function(a){this.OPTION_INIT=1;this.OPTION_FCAI=2;this.OPTION_NIIC=4;this.OPTION_NOSA=8;this.OPTION_NSIT=16;this._knownSlots=[];this._slots={};this._candidateAds=[];this._slotOptionFound=!1;this._context=a};a.PageSlotScanner.prototype={isSlotDuplicate:function(a){for(var b=0;b<this._knownSlots.length;++b)if(this._knownSlots[b].id===
a)return!0;return!1},findPageSlotByScope:function(b){var c=b.document;if(c){var d=/(^|\s)_fwph(\s|$)/,e=c.getElementsByTagName("span");b._fw_admanager||(b._fw_admanager={});b._fw_admanager.pageScanState=!0;for(b=0;b<e.length;++b){var f;var k=e[b];if(d.test(k.className)&&(k=k.getAttribute("id"),(f=c.getElementById("_fw_input_"+k))&&!this.isSlotDuplicate(k)&&(f=f.getAttribute("value")))){";"!==f.charAt(f.length-1)&&(f+=";");f=f.split(";");var g=f[f.length-2],n=!1;-1!==g.search("lo=i")&&(n=!0);var h=
!1;-1!==g.search("prct=")&&(h=!0);0>g.search("flag=")&&(g+="&flag=");0>g.search("ptgt=")&&(g="ptgt=s&"+g);f=[];var l=g.split("&"),q,P;g=!0;for(var I=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,m=0;m<l.length;++m){var r=l[m].split("=");if(2===r.length){r[1]=decodeURIComponent(r[1]);if("ssct"===r[0])if(h)continue;else h=!0,r[0]="prct";"flag"===r[0]?(-1===r[1].search(/[-\+]cmpn/)&&(r[1]+="+cmpn"),"+"!==r[1].charAt(0)&&"-"!==r[1].charAt(0)&&(r[1]="+"+r[1]),n&&-1===r[1].search("-init")&&(r[1]+="-init"),-1!==
r[1].search("-nrpl")&&(r[1]=r[1].replace("-nrpl","+cmpn")),-1!==r[1].search("-cmpn")&&(g=!1),I=this._getInitialOption(r[1]),this._slotOptionFound||(I=n?a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL:a.SLOT_OPTION_INITIAL_AD_STAND_ALONE)):"w"===r[0]?q=Number(r[1]):"h"===r[0]?P=Number(r[1]):"cana"===r[0]&&this._addCandidateAds(r[1]);r=encodeURIComponent(r[0])+"="+encodeURIComponent(r[1]);f.push(r)}}h||""==this._context.getParameter(a.PARAMETER_PAGE_SLOT_CONTENT_TYPE)||(n=this._context.getParameter(a.PARAMETER_PAGE_SLOT_CONTENT_TYPE)||
"text/html_doc_lit_mobile,text/html_doc_ref",f.push("prct="+encodeURIComponent(n)));(n=c.getElementById("_fw_container_"+k))?(this._slots[k]=f.join("&")+";",this._knownSlots.push({id:k,width:q,height:P,element:n,acceptCompanion:g,initialAdOption:I})):a.warn("Failed to find container for slot "+k)}}}},scanPageSlots:function(){for(var b=0;b<window.frames.length;++b)try{a.debug("scanPageSlots in frame",b),this.findPageSlotByScope(window.frames[b])}catch(c){a.debug("PageSlotScanner: scanPageSlots exception "+
c)}try{window.parent&&window.parent!==window&&(a.debug("scanPageSlots in parent frame"),this.findPageSlotByScope(window.parent))}catch(c){a.debug("PageSlotScanner: scanPageSlots exception "+c)}try{a.debug("scanPageSlots in current window"),this.findPageSlotByScope(window)}catch(c){a.debug("PageSlotScanner: scanPageSlots exception "+c)}},slotsToTypeBStr:function(){var a="",c;for(c in this._slots)if(this._slots.hasOwnProperty(c)){var d=this._slots[c];-1===d.search("slid=")&&(d="slid="+encodeURIComponent(c)+
"&"+d);a+=d;";"!==a.charAt(a.length-1)&&(a+=";")}a&&(a=a.substring(0,a.length-1));return a},_addCandidateAds:function(a){a=a.split(",");for(var b=0;b<a.length;b++){var d=parseInt(a[b],10);0<d&&this._candidateAds.push(d)}},_parseFlags:function(a){var b=[],d=[],e="",f=!0;a+="+";for(var k=0;k<a.length;++k){var g=a.charAt(k);switch(g){case "+":case "-":""!==e&&((f?b:d).push(e),e="");f="+"===g;break;default:e+=g}}return[b,d]},_getInitialOption:function(b){var c=!0,d=!1,e=0;b=this._parseFlags(b);for(var f=
a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,k=0;k<b.length;++k)for(var g=0;g<b[k].length;++g)switch(b[k][g].toString().toLowerCase()){case "cmpn":c=0===k;break;case "nrpl":c=0!==k;break;case "init":e=0===k?e&~this.OPTION_INIT:e|this.OPTION_INIT;d=!0;break;case "fcai":e=0===k?e|this.OPTION_FCAI:e&~this.OPTION_FCAI;d=!0;break;case "niic":e=0===k?e|this.OPTION_NIIC:e&~this.OPTION_NIIC;d=!0;break;case "nosa":e=0===k?e|this.OPTION_NOSA:e&~this.OPTION_NOSA;d=!0;break;case "nsit":e=0===k?e|this.OPTION_NSIT:e&~this.OPTION_NSIT,
d=!0}a.debug("PageSlotScanner: _getInitialOption: acceptCompanion = "+c);switch(e){case 0:d&&(f=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE);break;case 1:f=a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL;break;case 3:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY;break;case 2:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE;break;case 6:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE;break;case 8:f=a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE;break;case 10:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE;
break;case 16:f=a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE_IF_TEMPORAL;break;case 18:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL;break;default:f=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE}this._slotOptionFound=d;return f}};a.PageSlotScanner.prototype.constructor=a.PageSlotScanner;a.DisplayRefreshExtension=function(){this.REFRESH_TYPE_NONE="refresh_none";this.REFRESH_TYPE_AD="refresh_ad";this.REFRESH_TYPE_TIME="refresh_time";this.REPLACE_TYPE_NONE="replace_none";this.REPLACE_TYPE_BLANK=
"replace_blank";this.REPLACE_TYPE_AD="replace_ad";this._subContext=null;this._displaySlots=[];this._companionSlots=[];this._keyValues=[];this._globalParameters=[];this._overrideParameters=[];this._refreshType=this.REFRESH_TYPE_NONE;this._replaceType=this.REPLACE_TYPE_NONE;this._refreshInterval=0;this._refreshTimer=null;this._firstTemporalAd=!0;this._REQUEST_TIME_OUT=5};a.DisplayRefreshExtension.prototype={init:function(b){this._context=b;a.debug("DisplayRefreshExtension.init(context)");this._onRendererEvent=
a.Util.bind(this,function(b){a.debug("DisplayRefreshExtension._onRendererEvent()");b.subType===a.EVENT_AD_IMPRESSION&&this._onAdStarted(b)});this._onSlotEnded=a.Util.bind(this,function(b){var c=b.slot.getTimePositionClass();b=b.slot;a.debug("DisplayRefreshExtension._onSlotEnded()",b,c);if(null!=b&&c!==a.TIME_POSITION_CLASS_DISPLAY&&0!==b.getAdInstances().length)if(this._refreshType===this.REFRESH_TYPE_AD)this._resetSubContext(),this._refreshSlots(this._displaySlots);else if(this._refreshType===this.REFRESH_TYPE_TIME){this._resetSubContext();
this._refreshSlots(this._displaySlots);var e=this;this._refreshTimer=setInterval(function(){a.debug("DisplayRefreshExtension._onTimeout()");e._resetSubContext();e._refreshSlots(e._displaySlots)},1E3*this._refreshInterval)}});this._onRequestComplete=a.Util.bind(this,function(b){a.debug("DisplayRefreshExtension._onRequestComplete()");if(b.success){switch(this._context.getParameter("refreshType")){case "ad":this._refreshType=this.REFRESH_TYPE_AD;break;case "time":this._refreshInterval=this._context.getParameter("refreshInterval");
this._refreshType=0<this._refreshInterval?this.REFRESH_TYPE_TIME:this.REFRESH_TYPE_NONE;break;default:this._refreshType=this.REFRESH_TYPE_NONE}switch(this._context.getParameter("replaceMissingCompanion")){case "blank":this._replaceType=this.REPLACE_TYPE_BLANK;break;case "ad":this._replaceType=this.REPLACE_TYPE_AD;break;default:this._replaceType=this.REPLACE_TYPE_NONE}if(this._refreshType!==this.REFRESH_TYPE_NONE||this._replaceType!==this.REPLACE_TYPE_NONE){if(this._displaySlots=this._context.getSlotsByTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),
this._companionSlots=this._displaySlots.filter(function(a){return a.getAcceptCompanion()}),this._keyValues=this._context._adRequest._keyValues,this._globalParameters=this._context._globalLevelParameterDictionary,this._overrideParameters=this._context._overrideLevelParameterDictionary,this._firstTemporalAd=!0,this._context.addEventListener(a.EVENT_AD,this._onRendererEvent),this._context.addEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._refreshType===this.REFRESH_TYPE_TIME){var c=this;this._refreshTimer=
setInterval(function(){a.debug("DisplayRefreshExtension._onTimeout()");c._resetSubContext();c._refreshSlots(c._displaySlots)},1E3*this._refreshInterval)}}else this._refreshTimer&&clearInterval(this._refreshTimer)}else a.debug("DisplayRefreshExtension: request complete failed")});this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete)},_resetSubContext:function(){a.debug("DisplayRefreshExtension._resetSubContext()");this._subContext=this._context._adManager.cloneContext(this._context);
this._subContext._extensionManager._displayRefreshExtension.dispose();this._subContext._extensionManager._videoStateExtension.dispose();this._subContext.setCapability(a.CAPABILITY_SLOT_TEMPLATE,a.CAPABILITY_STATUS_OFF);this._subContext.setCapability(a.CAPABILITY_DISPLAY_REFRESH,a.CAPABILITY_STATUS_ON);this._playRefreshedSlots=a.Util.bind(this,function(b){a.debug("DisplayRefreshExtension._playRefreshedSlots()");if(b.success){b=this._subContext.getSlotsByTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY);
for(var c=0;c<b.length;c++)b[c].play()}else a.debug("DisplayRefreshExtension._playRefreshedSlots(): subContext refresh request error:",b)});this._subContext.addEventListener(a.EVENT_REQUEST_COMPLETE,this._playRefreshedSlots);for(var b=this._subContext._adRequest._keyValues,c=0;c<this._keyValues.length;c++)0>b.indexOf(this._keyValues[c])&&b.push(this._keyValues[c]);for(var d in this._globalParameters)this._globalParameters.hasOwnProperty(d)&&this._subContext.setParameter(d,this._globalParameters[d],
a.PARAMETER_LEVEL_GLOBAL);for(d in this._overrideParameters)this._overrideParameters.hasOwnProperty(d)&&this._subContext.setParameter(d,this._overrideParameters[d],a.PARAMETER_LEVEL_OVERRIDE)},_onAdStarted:function(b){a.debug("DisplayRefreshExtension._onAdStarted()");var c=b.adInstance.getSlot();a.debug("DisplayRefreshExtension._onAdStarted(): slot: ",c," | timePositionClass:",c.getTimePositionClass());if(null!=c&&c.getTimePositionClass()!==a.TIME_POSITION_CLASS_DISPLAY&&(this._resetSubContext(),
this._refreshTimer&&clearInterval(this._refreshTimer),this._replaceType!==this.REPLACE_TYPE_NONE)){b=b.adInstance;c=c.getAdInstances();for(var d=0;d<c.length;d++)b.getAdId()===c[d].getAdId()&&this._checkMissingCompanionForAd(b)}},_checkMissingCompanionForAd:function(b){a.debug("DisplayRefreshExtension._checkMissingCompanionForAd()",b);var c=this._companionSlots.slice();b=b.getCompanionAdInstances();var d;for(d=0;d<b.length;d++){var e=c.indexOf(b[d].getSlot());-1<e&&c.splice(e,1)}this._firstTemporalAd&&
(this._firstTemporalAd=!1,c=c.filter(function(b){if(b.getInitialAdOption()!==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY&&b.getInitialAdOption()!==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE&&b.getInitialAdOption()!==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE&&b.getInitialAdOption()!==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE&&b.getInitialAdOption()!==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL)return a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): firstCompanionAsInitial false in slot ",
b.getCustomId()),!0;for(var c=b.getAdInstances(),d=0;d<c.length;d++)if(!c[d].isPlaceholder())return a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): first companion found in slot ",b.getCustomId()),!1;a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): firstCompanionAsInitial true, no ad in slot ",b.getCustomId());return!0}));if(this._replaceType===this.REPLACE_TYPE_BLANK)for(d=0;d<c.length;d++)c[d].stop(),this._subContext._replacePageSlot(c[d].getCustomId(),"");else this._replaceType===
this.REPLACE_TYPE_AD&&this._refreshSlots(c)},_refreshSlots:function(b){a.debug("DisplayRefreshExtension._refreshSlots()",b);if(null!=b&&0!==b.length){for(var c=0;c<b.length;c++)b[c].stop(),this._subContext._refreshSlots.push(b[c].getCustomId());this._subContext._isRefreshRequest=!0;this._subContext.submitRequest(this._REQUEST_TIME_OUT)}},dispose:function(){a.debug("DisplayRefreshExtension.dispose()");this._context&&(this._context.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete),
this._context.removeEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._context.removeEventListener(a.EVENT_AD,this._onRendererEvent),this._context=null);this._subContext&&(this._subContext.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._playRefreshedSlots),this._subContext=null);this._displaySlots=[];this._companionSlots=[];this._keyValues=[];this._globalParameters=[];this._overrideParameters=[];this._refreshType=this.REFRESH_TYPE_NONE;this._replaceType=this.REPLACE_TYPE_NONE;this._refreshInterval=
0;this._refreshTimer&&clearInterval(this._refreshTimer);this._refreshTimer=null;this._firstTemporalAd=!0}};a.DisplayRefreshExtension.prototype.constructor=a.DisplayRefreshExtension;a.Ad=function(){this._id=null;this._creatives=[];this._noLoad=!1;this._soAdUnit=null;this._isRequiredToShow=!1};a.Ad.prototype={isRequiredToShow:function(){return this._isRequiredToShow},parse:function(b){if(b){this._id=b.adId||null;this._noLoad=b.noLoad;this._soAdUnit=b.adUnit;b.hasOwnProperty("required")&&(this._isRequiredToShow=
b.required);var c=0;for(b=b.creatives||[];c<b.length;c++){var d=b[c],e=new a.Creative;e.parse(d);this._creatives.push(e)}}},getSoAdUnit:function(){return this._soAdUnit},getId:function(){return this._id},getNoLoad:function(){return this._noLoad},getCreative:function(a){for(var b=0;b<this._creatives.length;b++)if(this._creatives[b].getId()===a)return this._creatives[b];return null},addCreativeRendition:function(){var b=new a.Creative;this._creatives.push(b);return b}};a.Ad.prototype.constructor=a.Ad;
a.Creative=function(){this._duration=this._baseUnit=this._id=null;this._parameters={};this._creativeRenditions=[]};a.Creative.prototype={getId:function(){return this._id},getBaseUnit:function(){return this._baseUnit},getDuration:function(){return this._duration},getParameter:function(a){return this._parameters[a]},setParameter:function(a,c){null==c?delete this._parameters[a]:this._parameters[a]=c},parse:function(b){if(b){this._id=b.creativeId||null;this._baseUnit=b.baseUnit||null;this._duration=1*
b.duration;if(b.parameters)if(b.parameters.constructor===Array)for(var c=0,d=b.parameters||[];c<d.length;c++){var e=d[c];this._parameters[e.name]=e.value}else"object"===typeof b.parameters&&(this._parameters=a.Util.copy(b.parameters));c=0;for(d=b.creativeRenditions||[];c<d.length;c++){e=d[c];b=new a.CreativeRendition;b.parse(e);b.setDuration(this._duration);b.setBaseUnit(this._baseUnit);for(var f in this._parameters)this._parameters.hasOwnProperty(f)&&b.setParameter(f,this._parameters[f]);this._creativeRenditions.push(b)}}},
getAllCreativeRenditions:function(){return this._creativeRenditions},addCreativeRendition:function(a){this._creativeRenditions.push(a)},getEligibleCreativeRenditionsForAdInstance:function(a){var b=[],d=[],e;for(e=0;e<this._creativeRenditions.length;e++){var f=this._creativeRenditions[e];f.getId()===a._creativeRenditionId&&f.getReplicaId()===a._replicaId&&b.push(f);""===f.getReplicaId()&&d.push(f)}return 0===b.length?d:b},cloneForTranslation:function(){var b=new a.Creative;b.parse({creativeId:this._id,
baseUnit:this._baseUnit,duration:this._duration,parameters:a.Util.copy(this._parameters)});return b}};a.Creative.prototype.constructor=a.Creative;a.CreativeRendition=function(){this._id=null;this._creativeApi="None";this._baseUnit=null;this._replicaId="";this._bitrate=this._height=this._width=this._preference=this._wrapperUrl=this._wrapperType=this._contentType=null;this._parameters={};this._primaryCreativeRenditionAsset=null;this._otherCreativeRenditionAssets=[];this._universalAdId=this._duration=
null};a.CreativeRendition.prototype={getId:function(){return this._id},getCreativeApi:function(){return this._creativeApi},setCreativeApi:function(a){this._creativeApi=a||"None"},getReplicaId:function(){return this._replicaId},getContentType:function(){return this._contentType?this._contentType:this._primaryCreativeRenditionAsset&&this._primaryCreativeRenditionAsset.getContentType()?this._primaryCreativeRenditionAsset.getContentType():null},setContentType:function(a){this._contentType=a},getWrapperType:function(){return this._wrapperType},
setWrapperType:function(a){this._wrapperType=a},getWrapperUrl:function(){return this._wrapperUrl},setWrapperUrl:function(a){this._wrapperUrl=a},getBaseUnit:function(){return this._baseUnit},setBaseUnit:function(a){this._baseUnit=a},getPreference:function(){return this._preference},setPreference:function(a){this._preference=a},getWidth:function(){return this._width},setWidth:function(a){this._width=a},getHeight:function(){return this._height},setHeight:function(a){this._height=a},getDuration:function(){return this._duration},
setDuration:function(a){this._duration=a},getParameter:function(a){return this._parameters[a]},setParameter:function(a,c){null==c?delete this._parameters[a]:this._parameters[a]=c},getUniversalAdId:function(){return this._universalAdId},setUniversalAdId:function(a){this._universalAdId=a},getPrimaryCreativeRenditionAsset:function(){return this._primaryCreativeRenditionAsset},getOtherCreativeRenditionAssets:function(){return this._otherCreativeRenditionAssets.slice()},addCreativeRenditionAsset:function(b,
c){var d=new a.CreativeRenditionAsset;d.setName(b);c?this._primaryCreativeRenditionAsset=d:this._otherCreativeRenditionAssets.push(d);return d},getBitrate:function(){var a=this._duration,c=this._primaryCreativeRenditionAsset._bytes;return c&&a&&!isNaN(c)&&!isNaN(a)&&0<c&&0<a?8*c/1E3/a:0<this._bitrate?this._bitrate:-1},parse:function(b){if(b){this._id=b.creativeRenditionId||null;this._creativeApi=b.creativeApi||"None";this._replicaId=b.hasOwnProperty("adReplicaId")?b.adReplicaId:"";this._contentType=
b.contentType||null;this._wrapperType=b.wrapperType||null;this._wrapperUrl=b.wrapperUrl||null;this._preference=1*b.preference;this._width=1*b.width;this._height=1*b.height;this._bitrate=b.hasOwnProperty("bitrate")?1*b.bitrate:null;for(var c,d=0,e=b.parameters||[];d<e.length;d++)c=e[d],this._parameters[c.name]=c.value;this._primaryCreativeRenditionAsset=new a.CreativeRenditionAsset;this._primaryCreativeRenditionAsset.parse(b.asset);d=0;for(e=b.otherAssets||[];d<e.length;d++)c=e[d],b=new a.CreativeRenditionAsset,
b.parse(c),this._otherCreativeRenditionAssets.push(b)}}};a.CreativeRendition.prototype.constructor=a.CreativeRendition;a.CreativeRenditionAsset=function(){this._bytes=this._mimeType=this._contentType=this._content=this._proxiedUrl=this._url=this._name=this._id=null};a.CreativeRenditionAsset.prototype={getName:function(){return this._name},setName:function(a){this._name=a},getUrl:function(){return this._url},getProxiedUrl:function(){return this._proxiedUrl},setUrl:function(b){this._url=b;this._proxiedUrl=
a.Util.transformCreativeUrlToProxy(this._url)},getContent:function(){return this._content},setContent:function(a){this._content=a},getContentType:function(){return this._contentType},setContentType:function(a){this._contentType=a},getMimeType:function(){return this._mimeType},setMimeType:function(a){this._mimeType=a},getBytes:function(){return this._bytes},setBytes:function(a){this._bytes=a},parse:function(b){b&&(this._id=b.id||null,this._name=b.name||null,this._url=b.url||null,this._proxiedUrl=a.Util.transformCreativeUrlToProxy(this._url),
this._content=b.content||null,this._contentType=b.contentType||null,this._mimeType=b.mimeType||null,this._bytes=1*b.bytes)}};a.CreativeRenditionAsset.prototype.constructor=a.CreativeRenditionAsset;a.AdManager=function(b){var c=this,d=this;this._context=this.newContext();this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,function(a){d.onRequestComplete(a)});this._networkId=this._serverURL="";this._location=null;if(b){var e=a.Util.validateJSON(b,{adNetworkID:{allowedTypes:["number","string"]},
adProfileID:{allowedTypes:["string"]},adServerUrl:{allowedTypes:["string"]},adSiteSectionID:{allowedTypes:["string"]},adAssetNetworkID:{allowedTypes:["number","string"],isOptional:!0},adOptOut:{allowedTypes:["number","boolean"],isOptional:!0},appBundleID:{allowedTypes:["string"],isOptional:!0},appName:{allowedTypes:["string"],isOptional:!0},appVersion:{allowedTypes:["string"],isOptional:!0},authenticationEntity:{allowedTypes:["string"],isOptional:!0},coppa:{allowedTypes:["string"],isOptional:!0},
deviceAdAttributes:{allowedTypes:["string"],isOptional:!0},distributorAppID:{allowedTypes:["string"],isOptional:!0},ifa:{allowedTypes:["string"],isOptional:!0},ifaValue:{allowedTypes:["string"],isOptional:!0},privacyData:{allowedTypes:["string"],isOptional:!0}},"adConfig");if(e)throw b="Unable to initialize AdManager instance. "+e.message,a.warn(b),Error(b);this._adConfig=Object.assign({},b);"boolean"===typeof b.adOptOut&&(this._adConfig.adOptOut=Number(b.adOptOut));"string"===typeof b.adNetworkID&&
(this._adConfig.adNetworkID=Number(b.adNetworkID));"string"===typeof b.adAssetNetworkID&&(this._adConfig.adAssetNetworkID=Number(b.adAssetNetworkID));this.setNetwork(b.adNetworkID);b=b.adServerUrl;b.startsWith("https://")||b.startsWith("http://")||(b="https://"+b);this.setServer(b)}this._fwGDPRConsent=this._fwGDPR=null;this._fwTCFAPIExecuted=!1;this._fwUSPString=null;this._isListeningForTCData=this._fwUSPAPIExecuted=!1;this._tcfapiImpl=null;this._tcfapiCallback=function(b,d){d?c._onTCFSuccess(b):
(c._fwTCFAPIExecuted=!0,c._isListeningForTCData=!1,a.warn("TCFAPI add listener failed."))};this._fetchGDPRData();this._fetchCCPAData()};a.AdManager.prototype={getVersion:function(){if(a.version){var b=a.version.match(/^js-(\d)\.(\d)\.(\d).(\d)/)||a.version.match(/^js-(\d)\.(\d)\.(\d)/)||a.version.match(/^js-(\d)\.(\d)/);if(null!=b&&0<b.length){for(var c=0,d=0;d<b.length-1;d++)c+=b[b.length-d-1]<<(d<<3);return c}if(0===a.version.indexOf("js-master"))return 4294967295}return 0},setNetwork:function(b){a.debug("AdManager.setNetwork("+
Array.prototype.slice.call(arguments).join(",")+")");if(0<1*b){this._networkId=1*b;for(var c in a._instanceQueue)if(a._instanceQueue.hasOwnProperty(c)){var d=a._instanceQueue[c];d&&d._videoAsset&&d._videoAsset._videoPlayPending&&d._videoAsset.play()}}else a.warn("AdManager.setNetwork","valid networkId required")},setServer:function(b){a.debug("AdManager.setServer("+Array.prototype.slice.call(arguments).join(",")+")");if(b&&"string"===typeof b){this._serverURL=b;for(var c in a._instanceQueue)if(a._instanceQueue.hasOwnProperty(c)){var d=
a._instanceQueue[c];d&&d._videoAsset&&d._videoAsset._videoPlayPending&&d._videoAsset.play()}}else a.warn("AdManager.setServer","server url required")},setLocation:function(b){a.debug("AdManager.setLocation("+Array.prototype.slice.call(arguments).join(",")+")");this._location=b},newContext:function(b,c){a.debug("AdManager.newContext("+Array.prototype.slice.call(arguments).join(",")+")");var d=this._validateVideoConfig(b,c);if(0<d.length)throw d="Unable to initialize Context instance."+d,a.warn(d),
Error(d);return new a.Context(this,b,c)},_validateVideoConfig:function(b,c){var d=[];b&&!this._adConfig?d.push("A videoConfig object should only be used to initialize Context when AdManager was initialized with an adConfig object."):!b&&this._adConfig?d.push("A videoConfig object is required to initialize Context when AdManager was initialized with an adConfig object."):b&&(((b=a.Util.validateJSON(b,{mode:{validationFunction:function(a){return a&&("live"===a.toLowerCase()||"on-demand"===a.toLowerCase())}},
duration:{allowedTypes:["number"]},customID:{allowedTypes:["string"]},language:{allowedTypes:["string"],isOptional:!0},genre:{allowedTypes:["string"],isOptional:!0},brand:{allowedTypes:["string"],isOptional:!0},rating:{allowedTypes:["string"],isOptional:!0},provider:{allowedTypes:["string"],isOptional:!0},title:{allowedTypes:["string"],isOptional:!0},series:{allowedTypes:["string"],isOptional:!0},autoPlay:{allowedTypes:["boolean"],isOptional:!0},idType:{isOptional:!0,validationFunction:function(b){return b===
a.ID_TYPE_CUSTOM||b===a.ID_TYPE_FW||b===a.ID_TYPE_GROUP}},durationType:{isOptional:!0,validationFunction:function(b){return b&&(b.toLowerCase()===a.VIDEO_ASSET_DURATION_TYPE_EXACT||b.toLowerCase()===a.VIDEO_ASSET_DURATION_TYPE_VARIABLE)}},fallbackId:{allowedTypes:["number","string"],isOptional:!0},location:{allowedTypes:["string"],isOptional:!0}},"videoConfig"))&&d.push(b.message),c)?"string"!==typeof c&&"object"!==typeof c?d.push("The player argument is the incorrect type. It should either be a string or an object."):
"object"===typeof c&&(b=a.Util.validateCustomPlayer(c))&&d.push(b.message):d.push("No player argument was passed. The player argument is required when using a videoConfig object."));return a.Util.arrayToString(d)},newContextWithContext:function(b){a.debug("AdManager.newContextWithContext("+Array.prototype.slice.call(arguments).join(",")+")");var c=this.cloneContext(b);c._temporalSlotBase=b._temporalSlotBase;b.getContentVideoElement()&&(c.setContentVideoElement(b.getContentVideoElement()),delete c._temporalSlotBase["_fw_contentVideo_"+
b._instanceId]);c._videoDisplaySize=b._videoDisplaySize;c._overriddenAdRenderers=b._overriddenAdRenderers;c._currentContentPlayheadTime=b._currentContentPlayheadTime;c.startSubsession(b._adRequest._subsessionToken);c.setRequestMode(b._adRequest._requestMode);c._adRequest._compatibleDimensions=b._adRequest._compatibleDimensions;c._adRequest._keyValues=b._adRequest._keyValues;c._videoAsset._state=b._videoAsset._state;c._videoAsset._callbackTimer=b._videoAsset._callbackTimer;c._videoAsset._videoPlayPending=
b._videoPlayPending;c._videoAsset._requestedVideoViewUrl=b._videoAsset._requestedVideoViewUrl;c._videoAsset._delay=b._videoAsset._delay;c._videoAsset._durationType=b._videoAsset._durationType;b._customPlayer&&(c._customPlayer=b._customPlayer);var d=b._extensionManager.extensions,e;for(e in d)d.hasOwnProperty(e)&&c.loadExtension(d[e]);return this._context=c},_setupConsentPostMessage:function(b){a.debug("AdManager.setupConsentPostMessage");var c=b+"Locator",d=b+"Call",e=b+"Return",f=a.Util.getFrameAncestor(c),
k={};window[b]=function(a,b,e){if(f){var g=Math.random()+"",h={};a=(h[d]={command:a,parameter:b,callId:g},h);k[g]=e;f.postMessage(a,"*")}else e({msg:c+" not found"},!1)};window.addEventListener("message",function(b){try{var c="string"===typeof b.data?JSON.parse(b.data):b.data;if(c[e]){var d=c[e];"function"===typeof k[d.callId]&&(k[d.callId](d.returnValue,d.success),delete k[d.callId])}}catch(C){a.warn("Consent postMessage listener error:",C)}},!1)},_retrieveGDPRWithPostMessage:function(){a.debug("AdManager.retrieveGDPRWithPostMessage");
this._setupConsentPostMessage("__tcfapi");this._tcfapiImpl=window.__tcfapi;this._getGdprConsentData()},_fetchGDPRData:function(){a.debug("AdManager.fetchGDPRData");try{this._tcfapiImpl=a.Util.getTopMostWindow().__tcfapi,this._getGdprConsentData()}catch(b){a.warn("__tcfapi function on top window is inaccessible due to the following error: "+b),this._retrieveGDPRWithPostMessage()}},_addEventListenerForTCData:function(){a.debug("AdManager._addEventListenerForTCData");this._isListeningForTCData=!0;try{this._tcfapiImpl("addEventListener",
a.GDPR_TCFAPI_VERSION,this._tcfapiCallback.bind(this))}catch(b){this._fwTCFAPIExecuted=!0,a.warn("AdManager._addEventListenerForTCData failed with err: ",b,b.description)}},_removeEventListenerForTCData:function(){a.debug("AdManager._removeEventListenerForTCData");this._isListeningForTCData=!1;try{this._tcfapiImpl("removeEventListener",a.GDPR_TCFAPI_VERSION,function(b){b?a.log("removeEventListener succeeded"):a.warn("TCFAPI remove listener failed.")},this._tcfapiCallback.bind(this))}catch(b){a.warn("AdManager._removeEventListenerForTCData failed with err: ",
b,b.description)}},_getTCStringFromTCData:function(b){var c=b.gdprApplies;null!==c?void 0==c?this._fwGDPR="":"boolean"==typeof c?this._fwGDPR=c?1:0:(this._fwGDPR=c.toString(),a.warn("VendorConsentData's gdprApplies value is malformed.")):a.warn("VendorConsentData's gdprApplies value is missing.");b=b.tcString;null!=b?"string"==typeof b?this._fwGDPRConsent=b:(this._fwGDPRConsent=b.toString(),a.warn("VendorConsentData's consentData value is malformed.")):a.warn("VendorConsentData's consentData value is missing.")},
_onTCFSuccess:function(b){a.debug("AdManager._onTCFSuccess with event status ",b.eventStatus);this._getTCStringFromTCData(b);"tcloaded"==b.eventStatus||"useractioncomplete"==b.eventStatus?(this._fwTCFAPIExecuted=!0,this._isListeningForTCData&&this._removeEventListenerForTCData()):"cmpuishown"==b.eventStatus?this._isListeningForTCData||this._addEventListenerForTCData():(this._fwGDPRConsent=this._fwGDPR="",this._fwTCFAPIExecuted=!0,a.warn("VendorConsentData's event status is missing or not valid."))},
_getGdprConsentData:function(){a.debug("AdManager.getGdprConsentData");if("function"==typeof this._tcfapiImpl)try{this._tcfapiImpl("getTCData",a.GDPR_TCFAPI_VERSION,this._tcfapiCallback.bind(this))}catch(b){this._fwTCFAPIExecuted=!0,a.warn("AdManager.getGdprConsentData failed with err: ",b,b.description)}else this._fwTCFAPIExecuted=!0,a.warn("TCFAPI function cannot be found. _fw_gdpr: "+this._fwGDPR+", _fw_gdpr_consent: "+this._fwGDPRConsent)},_retrieveCCPAWithPostMessage:function(){a.debug("AdManager.retrieveCCPAWithPostMessage");
this._setupConsentPostMessage("__uspapi");this._getUSPData(window.__uspapi)},_fetchCCPAData:function(){a.debug("AdManager.fetchCCPAData");try{var b=a.Util.getTopMostWindow().__uspapi;this._getUSPData(b)}catch(c){a.warn("__uspapi function on top window is inaccessible due to the following error: "+c),this._retrieveCCPAWithPostMessage()}},_getUSPData:function(b){a.debug("AdManager.getUSPData");if("function"==typeof b)try{var c=this;b("getUSPData",1,function(b,e){e?(b=b.uspString,null!=b?"string"==typeof b?
c._fwUSPString=b:(c._fwUSPString=b.toString(),a.warn("USPData's uspString value is malformed.")):a.warn("USPData's uspString value is missing.")):a.warn("Cannot retrieve CCPA params from USPAPI.");c._fwUSPAPIExecuted=!0},this)}catch(d){this._fwUSPAPIExecuted=!0,a.warn("AdManager.getUSPData "+d.description)}else this._fwUSPAPIExecuted=!0,a.warn("USPAPI function cannot be found. _fw_us_privacy: "+this._fwUSPString)},dispose:function(){a.debug("AdManager.dispose()");this._context.dispose()},cloneContext:function(b){var c=
new a.Context(this),d=b._adRequest._capabilities._capabilities,e;for(e in d)d.hasOwnProperty(e)&&c.setCapability(e,d[e]);c.setProfile(b._adRequest._playerProfile);c.setSiteSection(b._ss_id,b._ss_networkId,b._ss_pageViewRandom,b._ss_idType,b._ss_fallbackId);c.setVideoAsset(b._va_id,b._va_duration,b._va_networkId,b._va_location,b._va_autoPlayType,b._va_viewRandom,b._va_idType,b._va_fallbackId,b._va_durationType);c.setVisitor(b._adRequest._visitorCustomId,b._adRequest._visitorIpV4Address);return c}};
a.AdManager.prototype.constructor=a.AdManager;a._instanceCounter=0;a._instanceQueue={};a.Context=function(b,c,d){this._adManager=b;this._eventDispatcher=new a.EventDispatcher;this._adRequest=new a.AdRequest(this);this._adResponse=null;this._videoAsset=new a.VideoAsset(this);this._customPlayer=this._temporalSlotBase=null;this._videoDisplaySize={};this._globalLevelParameterDictionary={};this._overrideLevelParameterDictionary={};this._globalLevelParameterDictionary[a.PARAMETER_AUTO_PAUSE_AD_ONVISIBILITYCHANGE]=
!0;this._globalLevelParameterDictionary[a.PARAMETER_DISABLE_CORS_ENFORCEMENT]=!0;this._globalLevelParameterDictionary[a.PARAMETER_USE_GDPR_TCFAPI]=!0;this._globalLevelParameterDictionary[a.PARAMETER_USE_CCPA_USPAPI]=!0;this._globalLevelParameterDictionary[a.PARAMETER_CONSENT_RETRIEVAL_TIMEOUT]=500;this._globalLevelParameterDictionary[a.PARAMETER_ENABLE_ACCESS_CONTROL_ALLOW_CREDENTIALS]=!1;a.Util.setContext(this);this._rendererManifest={};this._overriddenAdRenderers=[];this._extensionManager=new a.ExtensionManager(this);
this._totalSetDisplaySizeCount=this._autoSetDisplaySizeCount=this._requestState=0;this._instanceId=a._instanceCounter;a._instanceQueue["Context_"+a._instanceCounter]=this;a._instanceCounter++;this._contentVideoAttached=!1;this._currentContentPlayheadTime=0;this._ss_id="";this._ss_networkId=this._ss_pageViewRandom=0;this._ss_idType=a.ID_TYPE_CUSTOM;this._va_location=this._va_networkId=this._va_duration=this._va_id=this._ss_fallbackId="";this._va_autoPlayType=a.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED;this._va_fallbackId=
"";this._va_viewRandom=0;this._va_idType=a.ID_TYPE_CUSTOM;this._va_durationType=a.VIDEO_ASSET_DURATION_TYPE_EXACT;this._isRefreshRequest=!1;this._refreshSlots=[];this._adVolume=1;this._onVolumeChange=this.__onVolumeChange.bind(this);if(c){b=b._adConfig;this.setProfile(b.adProfileID);var e=b.adNetworkID;b.adAssetNetworkID&&(e=b.adAssetNetworkID);var f=null;!1===c.autoPlay?f=a.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE:!0===c.autoPlay&&(f=a.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED);var k=this._va_idType;null!=c.idType&&
(k=c.idType);var g=this._va_durationType;null!=c.durationType&&(g=c.durationType.toLowerCase());var h=a.Util.getFixedDigitRandomNumber(8);this.setVideoAsset(c.customID,c.duration,e,c.location,f,h,k,c.fallbackId,g);e=a.Util.getFixedDigitRandomNumber(8);this.setSiteSection(b.adSiteSectionID,b.adNetworkID,e);this.setRequestMode(c.mode.toLowerCase());"object"===typeof d?this._registerCustomPlayer(d):this.registerVideoDisplayBase(d);this.addKeyValue("_fw_content_id",c.customID);null!=c.language&&this.addKeyValue("_fw_content_language",
c.language);null!=c.genre&&this.addKeyValue("_fw_content_genre",c.genre);null!=c.brand&&this.addKeyValue("_fw_content_programmer_brand",c.brand);null!=c.rating&&this.addKeyValue("_fw_content_rating",c.rating);null!=c.provider&&this.addKeyValue("_fw_content_provider",c.provider);null!=c.title&&this.addKeyValue("_fw_content_title",c.title);null!=c.series&&this.addKeyValue("_fw_content_series",c.series);null!=b.appBundleID&&this.addKeyValue("_fw_app_bundle",b.appBundleID);null!=b.appName&&this.addKeyValue("_fw_app_name",
b.appName);null!=b.appVersion&&this.addKeyValue("_fw_app_version",b.appVersion);null!=b.authenticationEntity&&this.addKeyValue("_fw_ae",b.authenticationEntity);null!=b.coppa&&this.addKeyValue("_fw_coppa",b.coppa);null!=b.deviceAdAttributes&&this.addKeyValue("_fw_ad_attributes",b.deviceAdAttributes);null!=b.distributorAppID&&this.addKeyValue("_fw_app_platform",b.distributorAppID);null!=b.ifa&&this.addKeyValue("_fw_ifa",b.ifa);null!=b.ifaValue&&this.addKeyValue("_fw_ifa_value",b.ifaValue);null!=b.adOptOut&&
this.addKeyValue("_fw_opt_out",b.adOptOut.toString());if(null!=b.privacyData)try{var l=atob(b.privacyData);a.debug("Context.constructor: Decoded adConfig.privacyData value:",l);this.addKeyValue("_fw_opt_out_data",l)}catch(C){a.warn("Context.constructor: An error occurred while decoding adConfig.privacyData:",C)}}};a.Context.prototype={getAdVolume:function(){return this._customPlayer?(a.warn("Context.getAdVolume: volume control is not supported when using custom player"),-1):this._adVolume},setAdVolume:function(b){if(this._customPlayer)a.warn("Context.setAdVolume: volume control is not supported when using custom player");
else if(a.debug("Context.setAdVolume",b),this.getContentVideoElement())if("number"!==typeof b||0>b||1<b)a.debug("Invalid volume: "+b);else if((a.PLATFORM_IS_IPHONE_IPOD||a.PLATFORM_IS_IPAD)&&0<b&&1>b)a.debug("iOS doesn't allow volume values other than 0 and 1, ignore.");else if(b===this._adVolume)a.debug("Volume did not change, ignore.");else{this._adVolume=b;b=this.getTemporalSlots();for(var c=0;c<b.length;++c){var d=b[c];if(d.getType()===a.SLOT_TYPE_TEMPORAL&&d.getState()!==a.MediaInitState.instance&&
d.getState()!==a.MediaEndState.instance&&(d=d.getCurrentAdInstance())){d.setVolume(this._adVolume);break}}}else a.debug("No video element set, ignore.")},__onVolumeChange:function(b){a.debug("Context._onVolumeChange(): event = "+b.type);a.debug("Context._onVolumeChange(): video element is muted: "+this.getContentVideoElement().muted);0!==this._adVolume||this.getContentVideoElement().muted?this.setAdVolume(this.getContentVideoElement().muted?0:this.getContentVideoElement().volume):this.setAdVolume(this.getContentVideoElement().volume)},
addRenderer:function(a,c,d,e,f,k,g){this._overriddenAdRenderers.push({url:a,baseUnit:c,contentType:d,creativeApi:k,slotType:e,soAdUnit:f,parameter:g})},setCapability:function(b,c){a.debug("Context.setCapability",b,c);this._adRequest.setCapability(b,c)},addKeyValue:function(b,c){a.debug("Context.addKeyValue",b,c);this._adRequest.addKeyValue(b,c)},setParameter:function(b,c,d){a.debug("Context.setParameter",b,c,d);if(d===a.PARAMETER_LEVEL_GLOBAL)d=this._globalLevelParameterDictionary;else if(d===a.PARAMETER_LEVEL_OVERRIDE)d=
this._overrideLevelParameterDictionary;else return;null==c?delete d[b]:d[b]=c},getParameter:function(a){return a?this._overrideLevelParameterDictionary.hasOwnProperty(a)?this._overrideLevelParameterDictionary[a]:this._adResponse&&this._adResponse._profileParameters.hasOwnProperty(a)?this._adResponse._profileParameters[a]:this._globalLevelParameterDictionary.hasOwnProperty(a)?this._globalLevelParameterDictionary[a]:null:null},setVideoState:function(b){a.debug("Context.setVideoState",b);this._videoAsset&&
this._videoAsset.setVideoState(b)},registerVideoDisplayBase:function(b){a.debug("Context.registerVideoDisplayBase",b);if(b&&"string"===typeof b){if(this._temporalSlotBase&&this._temporalSlotBase.id===b){a.debug("Context.registerVideoDisplayBase","register the same display base, will only change size");var c=this._temporalSlotBase.getElementsByTagName("video")}else{this._temporalSlotBase&&this.getContentVideoElement().removeEventListener("volumechange",this._onVolumeChange);this._temporalSlotBase=
document.getElementById(b);if(!this._temporalSlotBase){a.warn("Context.registerVideoDisplayBase","could not get element",b);return}c=this._temporalSlotBase.getElementsByTagName("video");if(0===c.length){a.warn("Context.registerVideoDisplayBase","could not get video element from",b);this._temporalSlotBase=null;return}this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=c[0];this.getContentVideoElement().addEventListener("volumechange",this._onVolumeChange);this._adVolume=c[0].muted?0:c[0].volume}this._setVideoDisplaySizeByContentVideo(c[0])}else a.warn("Context.registerVideoDisplayBase",
"id required")},setContentVideoElement:function(b){a.debug("Context.setContentVideoElement()");if(b&&b.parentNode){var c=this._temporalSlotBase;this._temporalSlotBase=b.parentNode;this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]===b?a.debug("Context.setContentVideoElement","set the same video in same div, will only change size"):(c&&c["_fw_contentVideo_"+this._instanceId]&&c["_fw_contentVideo_"+this._instanceId].removeEventListener("volumechange",this._onVolumeChange),this._temporalSlotBase["_fw_contentVideo_"+
this._instanceId]=b,this.getContentVideoElement().addEventListener("volumechange",this._onVolumeChange),this._adVolume=this.getContentVideoElement().muted?0:this.getContentVideoElement().volume);this._setVideoDisplaySizeByContentVideo(b)}else a.warn("Context.setContentVideoElement","contentVideo and contentVideo.parentNode is required")},registerCustomPlayer:function(b){a.debug("Context.registerCustomPlayer");var c=a.Util.validateCustomPlayer(b);c?a.warn("Context.registerCustomPlayer: "+c.message):
this._registerCustomPlayer(b)},_registerCustomPlayer:function(a){this._customPlayer=a;this._videoDisplaySize={left:0,top:0,width:0,height:0,position:0}},getContentVideoElement:function(){return this._temporalSlotBase?this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]:(a.warn("Context.getContentVideoElement: SlotBase is null"),null)},getCustomPlayer:function(){return this._customPlayer?this._customPlayer:(a.warn("Context.getCustomPlayer: customPlayer was null"),null)},setVideoDisplaySize:function(b,
c,d,e,f){a.debug("Context.setVideoDisplaySize("+Array.prototype.slice.call(arguments).join(",")+")");this._totalSetDisplaySizeCount++;this._videoDisplaySize={left:b,top:c,width:d,height:e,position:f};for(var k=this.getTemporalSlots(),g=0;g<k.length;++g){var h=k[g];h.setWidth(d);h.setHeight(e);if(h.getState()===a.MediaPlayingState.instance||h.getState()===a.MediaReplayingState.instance){if(k=h.getCurrentAdInstance())(k=k.getRendererController().getRenderer())&&k.resize?k.resize():a.debug("renderer do not support resize");
break}}},getVideoDisplaySize:function(){function a(a){a=parseInt(a,10);isNaN(a)&&(a=0);return a}this._videoDisplaySize.left=a(this._videoDisplaySize.left);this._videoDisplaySize.top=a(this._videoDisplaySize.top);this._videoDisplaySize.width=a(this._videoDisplaySize.width);this._videoDisplaySize.height=a(this._videoDisplaySize.height);return this._videoDisplaySize},setVideoDisplayCompatibleSizes:function(b){a.debug("Context.setVideoDisplayCompatibleSizes",b);this._adRequest.setVideoDisplayCompatibleSizes(b)},
resize:function(b,c){a.debug("Context.resize("+Array.prototype.slice.call(arguments).join(",")+")");if(!this._temporalSlotBase)return a.warn("SlotBase is null"),null;this.setVideoDisplaySize(this._videoDisplaySize.left,this._videoDisplaySize.top,b,c,this._videoDisplaySize.position)},setProfile:function(b){a.debug("Context.setProfile",b);this._adRequest.setProfile(b)},setVideoAsset:function(b,c,d,e,f,k,g,h,l){a.debug("Context.setVideoAsset("+Array.prototype.slice.call(arguments).join(",")+")");this._videoAsset.setVideoAsset(b,
c,d,e,f,k,g,h,l);this._va_id=b;this._va_duration=c;this._va_networkId=d;this._va_location=e;this._va_autoPlayType=f;this._va_viewRandom=k;this._va_idType=g;this._va_fallbackId=h;this._va_durationType=l},setVideoAssetCurrentTimePosition:function(b){a.debug("Context.setVideoAssetCurrentTimePosition("+b+")");this._videoAsset.setVideoAssetCurrentTimePosition(b)},setSiteSection:function(b,c,d,e,f){a.debug("Context.setSiteSection("+Array.prototype.slice.call(arguments).join(",")+")");this._adRequest.setSiteSection(b,
c,d,e,f);this._ss_id=b;this._ss_networkId=c;this._ss_pageViewRandom=d;this._ss_idType=e;this._ss_fallbackId=f},setVisitor:function(b,c){a.debug("Context.setVisitor("+Array.prototype.slice.call(arguments).join(",")+")");this._adRequest.setVisitor(b,c)},startSubsession:function(b){a.debug("Context.startSubsession("+b+")");this._adRequest.setSubsessionToken(b)},setRequestMode:function(b){a.debug("Context.setRequestMode("+b+")");this._adRequest.setRequestMode(b)},setRequestDuration:function(b){a.debug("Context.setRequestDuration("+
b+")");this._adRequest.setRequestDuration(b)},addCandidateAd:function(b){a.debug("Context.addCandidateAd("+b+")");this._adRequest.addCandidateAd(b)},addTemporalSlot:function(b,c,d,e,f,k,g,h,l,q){a.debug("Context.addTemporalSlot("+Array.prototype.slice.call(arguments).join(",")+")");this._adRequest.addTemporalSlot(b,c,d,e,f,k,g,h,l,q)},getTemporalSlots:function(){return this._adResponse?this._adResponse._temporalSlots.slice():[]},getSlotByCustomId:function(a){return this._adResponse?this._adResponse.getSlotByCustomId(a):
null},getSlotsByTimePositionClass:function(a){var b=[],d;if(this._adResponse){for(d=0;d<this._adResponse._temporalSlots.length;d++)this._adResponse._temporalSlots[d].getTimePositionClass()===a&&b.push(this._adResponse._temporalSlots[d]);for(d=0;d<this._adResponse._siteSectionNonTemporalSlots.length;d++)this._adResponse._siteSectionNonTemporalSlots[d].getTimePositionClass()===a&&b.push(this._adResponse._siteSectionNonTemporalSlots[d]);for(d=0;d<this._adResponse._videoPlayerNonTemporalSlots.length;d++)this._adResponse._videoPlayerNonTemporalSlots[d].getTimePositionClass()===
a&&b.push(this._adResponse._videoPlayerNonTemporalSlots[d])}return b},_isConsentRequired:function(){var b=this.getParameter(a.PARAMETER_USE_GDPR_TCFAPI)&&!this._adManager._fwTCFAPIExecuted,c=this.getParameter(a.PARAMETER_USE_CCPA_USPAPI)&&!this._adManager._fwUSPAPIExecuted;return b||c},submitRequest:function(b){a.debug("Context.submitRequest",b);var c=0;if(!this._isConsentRequired()||this._isRefreshRequest)this._submitValidatedRequest(b);else var d=this.getParameter(a.PARAMETER_CONSENT_RETRIEVAL_TIMEOUT),
e=setInterval(function(){c+=100;if(!this._isConsentRequired()||c>=d)clearInterval(e),this._submitValidatedRequest(b)}.bind(this),100)},_submitValidatedRequest:function(b){this.dispatchEvent(a.EVENT_REQUEST_INITIATED,{});this._adManager._isListeningForTCData&&this._adManager._removeEventListenerForTCData();if(this._requestState)a.warn("Context.submitRequest: request already submitted");else if(a.Util.isBlank(this._adManager._serverURL))a.warn("Context.submitRequest: serverURL is not set");else{this._requestState=
1;this._adRequest.useTCFAPI();this._adRequest.useUSPAPI();this._adRequest.scanPageSlots();if(this._isRefreshRequest){var c={},d=[],e,f;for(e=0;e<this._refreshSlots.length;e++){var k=this._refreshSlots[e];if(void 0!==this._adRequest._slotScanner._slots[k]){c[k]=this._adRequest._slotScanner._slots[k];var g=c[k].split("&");for(f=0;f<g.length;f++)-1!==g[f].search("flag")&&(g[f]="flag=-cmpn");c[k]=g.join("&")}for(f=0;f<this._adRequest._slotScanner._knownSlots.length;f++)this._adRequest._slotScanner._knownSlots[f].id===
k&&(g=this._adRequest._slotScanner._knownSlots[f],g.acceptCompanion=!1,g.initialAdOption=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,d.push(g))}this._adRequest._slotScanner._slots=c;this._adRequest._slotScanner._knownSlots=d}this.getParameter(a.PARAMETER_ENABLE_FORM_TRANSPORT)?(a.debug("Context.submitRequest: enabling Safari transport mechanism globally"),a.PLATFORM_SEND_REQUEST_BY_FORM=!0,a.PLATFORM_SEND_REQUEST_BY_JS=!1,this.setParameter(a.PARAMETER_ENABLE_JS_TRANSPORT,!1,a.PARAMETER_LEVEL_GLOBAL)):this.getParameter(a.PARAMETER_ENABLE_JS_TRANSPORT)?
(a.debug("Context.submitRequest: enabling JS transport mechanism globally"),a.PLATFORM_SEND_REQUEST_BY_JS=!0,a.PLATFORM_SEND_REQUEST_BY_FORM&&a.warn("PARAMETER_ENABLE_FORM_TRANSPORT was enabled while attempting to use PARAMETER_ENABLE_JS_TRANSPORT. This will prevent PARAMETER_ENABLE_JS_TRANSPORT from working properly. Please disable PARAMETER_ENABLE_FORM_TRANSPORT before attempting to use PARAMETER_ENABLE_JS_TRANSPORT."),this.setParameter(a.PARAMETER_ENABLE_FORM_TRANSPORT,!1,a.PARAMETER_LEVEL_GLOBAL)):
a.PLATFORM_SEND_REQUEST_BY_JS=!1;c=this._adManager._serverURL;".js"!==c.substring(c.length-3,c.length)&&(c=this._adRequest.generateTypeBRequestUrl());d=function(){1===this._requestState&&(a.warn("Context.submitRequest: request timeout"),this.requestComplete(null))}.bind(this);b&&"number"===typeof b&&0<b&&(a.CONTEXT_REQUEST_TIMEOUT=b);setTimeout(d,1E3*a.CONTEXT_REQUEST_TIMEOUT);a.log("Context.submitRequest: sending request to",c,"timeout",a.CONTEXT_REQUEST_TIMEOUT);a.PLATFORM_SEND_REQUEST_BY_FORM?
(a.debug("Context.submitRequest:","use json2"),a.Util.pingURLWithForm(c,this._instanceId,!0),this._onMessagePosted=function(a){"object"===typeof a.data&&a.data.hasOwnProperty("cbfn")&&-1<a.data.cbfn.indexOf("['Context_"+this._instanceId+"']")&&this.requestComplete(a.data.response)}.bind(this),window.addEventListener("message",this._onMessagePosted,!1)):a.PLATFORM_SEND_REQUEST_BY_JS?a.Util.sendAdRequestWithXMLHTTPRequest(c):a.Util.pingURLWithScript(c)}},requestComplete:function(b){if(1!==this._requestState)a.warn("ad request complete after timeout"),
this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!1});else{this._requestState=2;a.debug("Context.requestComplete");if(a.PLATFORM_SEND_REQUEST_BY_FORM){window.removeEventListener("message",this._onMessagePosted,!1);var c=document.getElementById("_fw_request_iframe_"+this._instanceId);document.body.removeChild(c)}if(null!=b){a._instanceQueue["Context_"+this._instanceId]=null;this._adResponse=new a.AdResponse(this);this._adResponse.parse(b,this._temporalSlotBase);a.log("Ad request succeeded");if(this._adResponse._profileParameters.autoloadExtensions){c=
this._adResponse._profileParameters.autoloadExtensions.split(",");for(var d=0;d<c.length;d++){var e=c[d].trim();a.log("Loading extension: "+e);this.loadExtension(e)}}this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!0,response:b});c=this._adResponse.getSiteSectionNonTemporalSlots();for(b=0;b<c.length;++b)a.log("Auto play site section nonTemporal slots"),c[b].play();c=this._adResponse.getVideoPlayerNonTemporalSlots();for(b=0;b<c.length;++b)a.log("Auto play video player nonTemporal slots"),c[b].play()}else a.warn("Ad request failed"),
this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!1})}},addEventListener:function(b,c){a.debug("Context.addEventListener",b);this._eventDispatcher.addEventListener(b,c)},removeEventListener:function(b,c){a.debug("Context.removeEventListener",b);this._eventDispatcher.removeEventListener(b,c)},dispatchEvent:function(b,c){a.log("Context.dispatchEvent type: "+b+", payload: "+c);if(b===a.EVENT_SLOT_STARTED){var d=c.slot.getTimePositionClass();if(d===a.TIME_POSITION_CLASS_PREROLL||d===a.TIME_POSITION_CLASS_MIDROLL||
d===a.TIME_POSITION_CLASS_POSTROLL||d===a.TIME_POSITION_CLASS_PAUSE_MIDROLL)this._contentVideoAttached=!0,this._markCurrentContentPlayheadTime()}else b===a.EVENT_SLOT_ENDED&&(d=c.slot.getTimePositionClass(),d===a.TIME_POSITION_CLASS_PREROLL||d===a.TIME_POSITION_CLASS_MIDROLL||d===a.TIME_POSITION_CLASS_POSTROLL||d===a.TIME_POSITION_CLASS_PAUSE_MIDROLL)&&(this._contentVideoAttached=!1);c=c||{};c.type=b;c.target=this;this._eventDispatcher.dispatchEvent(c)},dispose:function(){a.debug("Context.dispose");
this.setVideoState(a.VIDEO_STATE_STOPPED);this._videoAsset=null;if(this._adResponse){if(this._temporalSlotBase||this._customPlayer)for(var b=0,c=this._adResponse._temporalSlots||[];b<c.length;++b){var d=c[b];d.getCurrentAdInstance()&&d.stop();if(d._onContentVideoTimeUpdate&&this._temporalSlotBase){var e=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId];e&&e.removeEventListener("timeupdate",d._onContentVideoTimeUpdate,!1);d._onContentVideoTimeUpdate=null}}this._customPlayer&&(this._customPlayer=
null);this._temporalSlotBase&&(this.getContentVideoElement().removeEventListener("volumechange",this._onVolumeChange),this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=null);this._isRefreshRequest=!1;this._refreshSlots=[];this._extensionManager.dispose();this._extensionManager=null}},loadExtension:function(a){this._extensionManager.load(a,this)},_markCurrentContentPlayheadTime:function(){if(this._customPlayer)this._currentContentPlayheadTime=this._customPlayer.getPlayheadTime()||0;else if(this._temporalSlotBase){var a=
this._temporalSlotBase["_fw_contentVideo_"+this._instanceId].currentTime;0<a&&(this._currentContentPlayheadTime=a)}},_getContentPlayheadTime:function(){var a=-1;this._customPlayer?a=this._currentContentPlayheadTime:!this._contentVideoAttached&&this._temporalSlotBase&&this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]&&(a=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId].currentTime);return 0<a?a:this._currentContentPlayheadTime},_requestContentVideoToPauseBySlot:function(a){this._videoAsset.requestPauseBySlot(a)},
_requestContentVideoToResumeBySlot:function(a){this._videoAsset.requestResumeBySlot(a)},_setVideoDisplaySizeByContentVideo:function(a){if(this._autoSetDisplaySizeCount===this._totalSetDisplaySizeCount){var b=a.style.left,d=a.style.top,e=a.offsetWidth?a.offsetWidth:a.style.pixelWidth,f=a.offsetHeight?a.offsetHeight:a.style.pixelHeight;a=a.style.position;this._autoSetDisplaySizeCount++;this.setVideoDisplaySize(b,d,e,f,a)}},_replacePageSlot:function(b,c){a.debug("fw replace %s",b);var d;try{var e=document.getElementById(b)?
document:parent.document.getElementById(b)?parent.document:null;var f=document.getElementById(b)?"window":parent.document.getElementById(b)?"parent":null}catch(z){f=e=null}if(!e)for(var k=0;k<window.frames.length;k++)try{window.frames[k].document.getElementById(b)&&(e=window.frames[k].document,f="window.frames["+k+"]")}catch(z){a.debug(z)}f&&(d=f+".document");a.debug("fw replacing slot %s in frame %s",b,d);if(!e)throw"Slot element not found: "+b;k=e.getElementById("_fw_container_"+b);k.innerHTML=
c;c=k.getElementsByTagName("script");var g=e.getElementsByTagName("head")[0];for(k=0;k<c.length;++k)if(a.PLATFORM_IS_FIREFOX||c[k].src){var h=e.createElement("script");c[k].charset&&(h.charset=c[k].charset);c[k].src&&(h.src=c[k].src);c[k].innerHTML&&(h.innerHTML=c[k].innerHTML);h.onload=h.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||g.removeChild(h)};a.debug("fw append script for %s",b);g.appendChild(h)}else h=c[k].innerHTML,h=h.replace(/var fw_scope = document;/,
"var fw_scope="+d+";"),h=h.replace(/var fw_scope_window = window;/,"var fw_scope_window="+f+";"),a.debug("fw eval in %s for %s, %s",d,b,h),eval(h);a.debug("fw finish replace %s",b)}};a.Context.prototype.constructor=a.Context;a.Capabilities=function(){this._capabilities={};this.init()};a.Capabilities.prototype={init:function(){for(var b=[a.CAPABILITY_SLOT_TEMPLATE,a.CAPABILITY_MULTIPLE_CREATIVE_RENDITIONS,a.CAPABILITY_FALLBACK_UNKNOWN_ASSET,a.CAPABILITY_FALLBACK_UNKNOWN_SITE_SECTION,a.CAPABILITY_FALLBACK_ADS,
a.CAPABILITY_SLOT_CALLBACK,a.CAPABILITY_NULL_CREATIVE,a.CAPABILITY_AUTO_EVENT_TRACKING,a.CAPABILITY_RENDERER_MANIFEST],c=0;c<b.length;c++)this._capabilities[b[c]]=a.CAPABILITY_STATUS_ON},setCapability:function(a,c){this._capabilities[a]=c},getCapability:function(a){return this._capabilities[a]},parseCapabilities:function(b){var c="",d;for(d in this._capabilities)if(this._capabilities.hasOwnProperty(d)){switch(this._capabilities[d]){case a.CAPABILITY_STATUS_ON:c+="+"+d;break;case a.CAPABILITY_STATUS_OFF:c+=
"-"+d}b=b.replace(new RegExp("(%2B|-|\\+)"+d,"g"),"")}c=encodeURIComponent(c);return b=-1<b.indexOf("flag=")?b.replace(/flag=/,"flag="+c):b+("&flag="+c)}};a.OMSDKExtension=function(){this._adSession=this._mediaEvents=this._adEvents=this._ad=this._videoElement=this._sessionClient=this._context=null;this._cachedEvents=[];this._omsdkIframe=null;this._omsdkIframeLoaded=!1;this._sessionScript=null;this._pendingSessionStartRequest=this._sessionScriptLoaded=!1;this._onAdInitiated=this._onAdInitiated.bind(this);
this._adEventListener=this._adEventListener.bind(this);this._videoDidLoad=this._videoDidLoad.bind(this);this._onRequestComplete=this._onRequestComplete.bind(this)};a.OMSDKExtension.prototype={init:function(b){a.debug("OMSDKExtension.init(context)");this._context=b;this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete)},_getVideoElement:function(){this._videoElement=this._context.getContentVideoElement();return null==this._videoElement?(a.debug("OMSDKExtension: Error: Cannot use OMSDK because no video element was found"),
null):this._videoElement},_onRequestComplete:function(b){a.Util.getBooleanParameter(a.PARAMETER_EXTENSION_OMSDK_ENABLED,!1)?b.success?null!=this._getVideoElement()&&this._initWithScripts():a.debug("OMSDKExtension: request complete failed."):a.debug("OMSDKExtension: return since OMSDKExtension is disabled")},_initWithScripts:function(){a.debug("OMSDKExtension._initWithScripts");this._addServiceScript();this._addSessionScript();this._context.addEventListener(a.EVENT_AD,this._onAdInitiated)},_addServiceScript:function(){this._omsdkIframe=
this._addIframe(a.OMSDK_SERVICE_SCRIPT_URL,"_fw_omsdk_service_script_",function(){a.debug("OMSDKExtension: on OMSDK iframe load");this._omsdkIframeLoaded=!0;this._checkIfAdSessionShouldStart()})},_addSessionScript:function(){this._sessionScript=this._addScript(a.OMSDK_SESSION_SCRIPT_URL,"_fw_omsdk_session_script_",function(){a.debug("OMSDKExtension: on session script load");window.OmidSessionClient&&window.OmidSessionClient.default?(a.debug("OMSDKExtension: setting session client."),this._sessionClient=
window.OmidSessionClient.default,this._sessionScriptLoaded=!0,this._checkIfAdSessionShouldStart()):(a.debug("OMSDKExtension: Error: Cannot use OMSDK because session client was null."),this.dispose())})},_addIframe:function(b,c,d){a.debug("OMSDKExtension._addIframe");var e=document.createElement("iframe");e.sandbox="allow-scripts allow-same-origin";e.style.display="none";e.srcdoc="<script src="+b+">\x3c/script>";return this._addElement(e,c,d)},_addScript:function(b,c,d){a.debug("OMSDKExtension._addScript");
var e=document.createElement("script");e.type="text/javascript";e.src=b;return this._addElement(e,c,d)},_addElement:function(b,c,d){b.id=c+this._context._instanceId;b.onload=d.bind(this);b.onerror=function(){a.debug("OMSDKExtension: Error adding element: ",b);this.dispose()}.bind(this);return document.body.appendChild(b)},_checkIfAdSessionShouldStart:function(){a.debug("OMSDKExtension: _checkIfAdSessionShouldStart");this._omsdkIframeLoaded&&this._sessionScriptLoaded&&this._pendingSessionStartRequest&&
this._prepareAdSession()},_onAdInitiated:function(b){if(b.subType===a.EVENT_AD_PREINIT&&b.adInstance&&(a.debug("OMSDKExtension_onAdInitiated"),null!=this._getVideoElement())){b=b.adInstance;var c=b.getActiveCreativeRendition();c=b._rendererController._matchRendererClassName(c);this._isRendererSupported(c)?this._isTimePositionClassSupported(b)?null==b._adVerifications||0==b._adVerifications.length?a.debug("OMSDKExtension: No AdVerifications found."):(this._videoElement.addEventListener("loadeddata",
this._videoDidLoad),this._context.addEventListener(a.EVENT_AD,this._adEventListener),this._ad=b,this._prepareAdSession()):a.debug("OMSDKExtension: The selected ad's slot time position class is not supported by OMSDK Web Video: "+timePositionClass):a.debug("OMSDKExtension: The selected renderer does not support OMSDK Web Video: "+c)}},_isRendererSupported:function(b){a.debug("OMSDKExtension._isRendererSupported:",b);switch(b){case h+".VideoRenderer":case h+".DashRenderer":case h+".CustomPlayerRenderer":return!0;
default:return!1}},_isTimePositionClassSupported:function(b){b=b.getSlot().getTimePositionClass();a.debug("OMSDKExtension._isTimePositionClassSupported: "+b);switch(b){case a.TIME_POSITION_CLASS_PREROLL:return!0;case a.TIME_POSITION_CLASS_MIDROLL:return!0;case a.TIME_POSITION_CLASS_POSTROLL:return!0;default:return!1}},_prepareAdSession:function(){a.debug("OMSDKExtension._prepareAdSession");if(this._omsdkIframeLoaded&&this._sessionScriptLoaded){var b=this._getVerificationResourcesFromAdVerifications();
0<b.length?(b=this._createOMSDKContext(b),this._createAdSession(b)):(a.debug("OMSDKExtension: No VerificationScriptResources were created."),this._cleanupAfterAdSession())}else a.debug("OMSDKExtension scripts are not loaded, cannot start ad session at this time."),this._pendingSessionStartRequest=!0},_getVerificationResourcesFromAdVerifications:function(){var b=this._ad._adVerifications;a.debug("OMSDKExtension._getVerificationResourcesFromAdVerifications",JSON.stringify(b));for(var c=[],d=0;d<b.length;d++){for(var e=
0,f=b[d],k=f.javaScriptResources.concat(f.executableResources),g=0;g<k.length;g++)try{var h=k[g],l=new this._sessionClient.VerificationScriptResource(h.url,f.vendorKey,f.verificationParameters,a.OMSDK_ACCESS_MODE);c.push(l);e++}catch(C){a.debug("OMSDKExtension: An error occured while trying to create a verification script resource: "+C+(" verification script url: "+(null!=h.url)?h.url:"No verification script url provided"))}0===e&&(a.debug("OMSDKExtension: Failed to create a verification script resource"),
f.dispatchAdVerificationNotExecutedWithReason(a.VERIFICATION_RESOURCE_LOAD_ERROR))}return c},_createOMSDKContext:function(b){a.debug("OMSDKExtension._createOMSDKContext");var c=this._context._adManager.getVersion()+"";c=new this._sessionClient.Partner(a.OMSDK_PARTNER_NAME,c);var d=this._getContentURL();b=new this._sessionClient.Context(c,b,d);b.setVideoElement(this._videoElement);b.setServiceWindow(this._omsdkIframe.contentWindow);return b},_getContentURL:function(){var b=null;try{b=a.Util.getTopMostWindow().location.href}catch(c){b=
document.referrer,a.debug("OMSDKExtension could not retrieve url from top most window. Using document referrer. Error: "+c)}return b},_createAdSession:function(b){a.debug("OMSDKExtension._createAdSession");try{var c=new this._sessionClient.AdSession(b);c.isSupported()?this._startAdSession(c):(a.debug("OMSDKExtension: Error: Cannot use OMSDK because adSession was not supported."),this._cleanupAfterAdSession())}catch(d){a.debug("OMSDKExtension: Error: "+d),this._cleanupAfterAdSession()}},_startAdSession:function(b){b.setCreativeType(a.OMSDK_CREATIVE_TYPE_VIDEO);
b.setImpressionType(a.OMSDK_IMPRESSION_TYPE_BEGIN_TO_RENDER);this._mediaEvents=new this._sessionClient.MediaEvents(b);this._adEvents=new this._sessionClient.AdEvents(b);this._adSession=b;this._adSession.start();for(a.debug("OMSDKExtension: adSession.start() called");0<this._cachedEvents.length;)a.debug("Firing cached event:",this._cachedEvents[0].subType),this._onAdEvent(this._cachedEvents.shift())},_videoDidLoad:function(){a.debug("OMSDKExtension._videoDidLoad");this._videoElement.removeEventListener("loadeddata",
this._videoDidLoad);this._adEventListener({subType:"loaded"})},_adEventListener:function(b){a.debug("OMSDKExtension._adEventListener",b.subType);this._adSession?this._onAdEvent(b):this._cachedEvents.push(b)},_onAdEvent:function(b){a.debug("OMSDKExtension._onAdEvent:",b.subType);if(b&&b.subType)switch(b.subType){case "loaded":this._onVideoLoaded();break;case a.EVENT_AD_IMPRESSION:try{this._adEvents.impressionOccurred(),this._mediaEvents.start(this._ad.getDuration(),this._videoElement.volume)}catch(c){a.debug("OMSDKExtension: Error: "+
c)}break;case a.EVENT_AD_FIRST_QUARTILE:this._mediaEvents.firstQuartile();break;case a.EVENT_AD_MIDPOINT:this._mediaEvents.midpoint();break;case a.EVENT_AD_THIRD_QUARTILE:this._mediaEvents.thirdQuartile();break;case a.EVENT_AD_COMPLETE:this._mediaEvents.complete();break;case a.EVENT_AD_IMPRESSION_END:this._endAdSession();break;case a.EVENT_AD_PAUSE:this._mediaEvents.pause();break;case a.EVENT_AD_RESUME:this._mediaEvents.resume();break;case a.EVENT_AD_BUFFERING_START:this._mediaEvents.bufferStart();
break;case a.EVENT_AD_BUFFERING_END:this._mediaEvents.bufferFinish();break;case a.EVENT_AD_VOLUME_CHANGE:this._mediaEvents.volumeChange(this._videoElement.volume);break;case a.EVENT_AD_CLICK:this._mediaEvents.adUserInteraction("click");break;case a.EVENT_AD_SKIPPED:this._mediaEvents.skipped();break;case a.EVENT_ERROR:this._adSession.error("media",b.errorInfo||"An error occured during ad playback."),this._endAdSession()}},_onVideoLoaded:function(){a.debug("OMSDKExtension._onVideoLoaded");var b=this._ad.getSlot().getTimePositionClass().toLowerCase(),
c=this._ad.getSkipOffset(),d=-1<c;d||(c=0);b=new this._sessionClient.VastProperties(d,c,this._context._va_autoPlayType!=a.VIDEO_ASSET_AUTO_PLAY_TYPE_CLICK_TO_PLAY&&this._context._va_autoPlayType!=a.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE,b);this._adEvents.loaded(b)},_endAdSession:function(){a.debug("OMSDKExtension._endAdSession()");this._adSession.finish();this._cleanupAfterAdSession()},_cleanupAfterAdSession:function(){a.debug("OMSDKExtension._cleanupAfterAdSession()");this._cachedEvents=[];this._adSession=
this._ad=this._adEvents=this._mediaEvents=null;this._videoElement&&this._videoElement.removeEventListener("loadeddata",this._videoDidLoad);this._context&&this._context.removeEventListener(a.EVENT_AD,this._adEventListener)},dispose:function(){a.debug("OMSDKExtension.dispose()");this._cleanupAfterAdSession();this._context&&(this._context.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete),this._context.removeEventListener(a.EVENT_AD,this._onAdInitiated));this._context=this._videoElement=
this._sessionClient=null;this._omsdkIframe&&(this._omsdkIframe.onload=null,this._omsdkIframe.onerror=null);this._sessionScript&&(this._sessionScript.onload=null,this._sessionScript.onerror=null);setTimeout(function(){this._omsdkIframeLoaded&&(document.body.removeChild(this._omsdkIframe),this._omsdkIframeLoaded=!1);this._sessionScriptLoaded&&(document.body.removeChild(this._sessionScript),this._sessionScriptLoaded=!1);this._sessionScript=this._omsdkIframe=null}.bind(this),3E3)}};a.OMSDKExtension.prototype.constructor=
a.OMSDKExtension;a.VideoAsset=function(b){this._defaultTimeouts=[5,10,15,30,60,120,180,300];this._context=b;this._internalState=a.MediaInitState.instance;this._eventCallback=this._state="";this._callbackTimer=null;this._requestedVideoViewUrl=this._videoPlayPending=!1;this._dummyInstanceId="";this._delay=0;this._location=this._networkId=this._duration=this._customId=this._id="";this._autoPlayType=null;this._fallbackId="";this._viewRandom=0;this._durationType=null;this._currentTpos=0};a.VideoAsset.prototype=
{setVideoAsset:function(b,c,d,e,f,k,g,h,l){if(b){switch(g){case a.ID_TYPE_FW:g=this._id!==b;this._id=b;break;case a.ID_TYPE_GROUP:g=this._id!=="g"+b;this._id="g"+b;break;default:g=this._customId!==b,this._customId=b}g&&(this._eventCallback="");"number"===typeof c&&(this._duration=Math.round(10*c)/10);0<1*d&&(this._networkId=1*d);"string"===typeof e&&(this._location=e);"number"===typeof f&&(this._autoPlayType=f);0<1*k&&(this._viewRandom=1*k);"number"===typeof h&&0<h?this._fallbackId=""+h:"string"===
typeof h&&(this._fallbackId=h.trim());if(l===a.VIDEO_ASSET_DURATION_TYPE_EXACT||l===a.VIDEO_ASSET_DURATION_TYPE_VARIABLE)this._durationType=l;this._videoPlayPending&&this.play()}else a.warn("AdRequest.setVideoAsset","id is required.")},setVideoAssetCurrentTimePosition:function(b){!b||0>b?a.warn("AdRequest.setVideoAssetCurrentTimePosition","valid timePosition is required"):this._currentTpos=b},setVideoState:function(b){b===a.VIDEO_STATE_PLAYING?(this._state===a.VIDEO_STATE_PAUSED&&this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_RESUMED),
this.play()):b===a.VIDEO_STATE_PAUSED||b===a.VIDEO_STATE_STOPPED?(this.pause(),b===a.VIDEO_STATE_PAUSED&&this._state===a.VIDEO_STATE_PLAYING&&this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_PAUSED)):b===a.VIDEO_STATE_COMPLETED&&this.complete();this._state=b},callback:function(b){this._eventCallback?this._eventCallback.process():b=!0;b||((b=this._defaultTimeouts.shift())||(b=300),this._callbackTimer=new a.Timer(b,a.Util.bind(this,this.callback)),this._callbackTimer.start())},getPlayheadTime:function(){var a=
this._delay;this._delay=0;a+=this._callbackTimer?this._callbackTimer.getCTValue():0;return Math.floor(a)},play:function(){this._context._adManager._serverURL&&this._context._adManager._networkId&&(this._id||this._customId)?this._eventCallback?(this._videoPlayPending=!1,this._internalState.play(this)):this._requestedVideoViewUrl||(this._requestedVideoViewUrl=!0,this.requestForVideoViewCallback(),this._callbackTimer||(this._callbackTimer=new a.Timer,this._callbackTimer.tick())):(a.warn("Server URL or Network ID or Video Asset id/customId is not set, delay video asset state change until these are provided."),
this._videoPlayPending=!0,this._callbackTimer||(this._callbackTimer=new a.Timer,this._callbackTimer.tick()))},pause:function(){this._internalState.pause(this)},complete:function(){this._internalState.complete(this)},onStartPlaying:function(){this.callback()},onStartReplaying:function(){this.callback()},onPausePlaying:function(){this.callback(!0);this._callbackTimer.pause()},onResumePlaying:function(){this._callbackTimer.start()},onCompletePlaying:function(){this.callback(!0);this._callbackTimer.stop();
this._callbackTimer=null;this._eventCallback="";this._requestedVideoViewUrl=!1},onCompleteReplaying:function(){this.onCompletePlaying()},setMediaState:function(a){this._internalState=a},requestPauseBySlot:function(b){a.debug("requestPauseBySlot");this._internalState===a.MediaPlayingState.instance||this._internalState===a.MediaReplayingState.instance?this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,{slot:b}):a.debug("Not sending content pause request because content video state is",
JSON.stringify(this._internalState))},requestResumeBySlot:function(b){a.debug("requestResumeBySlot");this._internalState===a.MediaPausedState.instance||this._internalState===a.MediaReplayPausedState.instance?this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,{slot:b}):a.debug("Not sending content resume request because content video state is ",JSON.stringify(this._internalState))},requestForVideoViewCallback:function(){var b=new a.Context(this._context._adManager);b._videoAsset=this;
this._dummyInstanceId=b._instanceId;b=this._context._adRequest.generateVideoViewRequestUrlWithDummyContextInstanceId(b._instanceId);var c=this;a.PLATFORM_SEND_REQUEST_BY_FORM?(a.debug("Context.submitRequest:","use json2"),a.Util.pingURLWithForm(b,this._dummyInstanceId,!0),c._onMessagePosted=function(a){"object"===typeof a.data&&a.data.hasOwnProperty("cbfn")&&-1<a.data.cbfn.indexOf("['Context_"+this._dummyInstanceId+"']")&&c.requestComplete(a.data.response)},window.addEventListener("message",c._onMessagePosted,
!1)):a.PLATFORM_SEND_REQUEST_BY_JS?a.Util.pingURLWithXMLHTTPRequest(b):a.Util.pingURLWithScript(b)},requestComplete:function(b){this._delay=this._callbackTimer.tick();this._callbackTimer=null;if(a.PLATFORM_SEND_REQUEST_BY_FORM){window.removeEventListener("message",this._onMessagePosted,!1);var c=document.getElementById("_fw_request_iframe_"+this._dummyInstanceId);document.body.removeChild(c)}null!=b?(a._instanceQueue["Context_"+this._dummyInstanceId]=null,this.parse(a.Util.getObject("siteSection.videoPlayer.videoAsset",
b)||{}),this.play()):a.warn("Failed to get video view callback url.")},parse:function(b){if(b){this._customId=b.customId;this._networkId=parseInt(b.networkId);for(var c=0,d=b.eventCallbacks||[];c<d.length;c++){b=d[c];var e=a.EventCallback.newEventCallback(this._context,b.name,b.type);if(e&&b.name===a.EVENT_VIDEO_VIEW){e.parse(b);this._eventCallback=e;a.debug("Parsed video view url: "+this._eventCallback._url);break}}}}};a.NullRenderer=function(){this._rendererController=null};a.NullRenderer.prototype=
{start:function(b){this._rendererController=b;this._rendererController.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF);this._rendererController.handleStateTransition(a.RENDERER_STATE_STARTED);this._rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED)},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){return-1},getDuration:function(){return-1}};a.NullRenderer.prototype.constructor=a.NullRenderer;a.VPAIDWrapper=function(){this._creative=null;
this._timeoutInMs=0;this._eventHandlers={};this._timeoutTimer=null;this._timeoutOperation="";this.timeoutReached=!1;this._visibilityChangeListener=null;this._creativePausedByTabSwitch=!1;this._autoPauseAdOnVisibilityChange=!0;this._loadIntervalTimer=null;this._isCORSEnforcementDisabled=!0};a.VPAIDWrapper.prototype={_isCreativeFunctionInvokable:function(a){return this._creative?(a=this._creative[a])&&"function"===typeof a:!1},checkVPAIDInterface:function(a){for(var b={passed:!0,missingInterfaces:""},
d=a.length-1;0<=d;d--)this._isCreativeFunctionInvokable(a[d])||(b.passed=!1,b.missingInterfaces+=a[d]+" ");return b},loadCreativeAsset:function(b){a.log("loadCreativeAsset("+b+")");var c=document.getElementById("vpaidFrame"),d=document.createElement("iframe");d.id="vpaidFrame";null==c?document.body.appendChild(d):document.body.replaceChild(d,c);d.width=0;d.height=0;d.style.display="none";d.contentWindow.document.open();if(this._isCORSEnforcementDisabled){a.log("CORS Enforcement Disabled");setTimeout(function(){d.contentWindow.document.write('<script type="text/javascript" src="'+
b+'"> \x3c/script>');d.contentWindow.document.close()},0);this._timeoutOperation="loadCreativeAsset";this._waitForTimeout();var e=this;this._loadIntervalTimer=setInterval(function(){var b=document.getElementById("vpaidFrame").contentWindow.getVPAIDAd;b&&"function"===typeof b&&(clearInterval(e._loadIntervalTimer),b=b(),"undefined"===typeof b?a.debug("getVPAIDAd() returns undefined value"):null==b?a.debug("getVPAIDAd() returns null"):(e._creative=b,e._eventHandlers.CreativeAssetLoaded()))},200)}else{d.contentWindow.document.close();
this._timeoutOperation="loadCreativeAsset";e=this;var f=new XMLHttpRequest;f.open("GET",b);f.timeout=e._timeoutInMs;f.onreadystatechange=function(){if(4==f.readyState)if(200===f.status)try{d.contentWindow.eval(f.responseText);var c=d.contentWindow.getVPAIDAd;if(c&&"function"===typeof c){var g=c();if("undefined"===typeof g)throw"getVPAIDAd() returns undefined value";if(null==g)throw"getVPAIDAd() returns null";e._creative=g;e._eventHandlers.CreativeAssetLoaded()}else throw"getVPAIDAd() funtion does not exist";
}catch(n){a.warn(n),e._eventHandlers.loaderror(a.ERROR_3P_COMPONENT,"Creative is not VPAID: "+n)}else 400<=f.status&&e._eventHandlers.loaderror(a.ERROR_IO,"creativeUrl="+b+"; status code="+f.status+"; status text="+f.statusText)};f.ontimeout=function(){e._eventHandlers.timeout.call()};f.onerror=function(){0===f.status?(a.warn("CORS error"),e._eventHandlers.loaderror(a.ERROR_SECURITY,"creativeUrl="+b+";cors error")):(a.warn("exception:"+f.statusText),e._eventHandlers.loaderror(a.ERROR_IO,"creativeUrl="+
b+";exception="+f.statusText))};f.send()}},setCallbacksForCreative:function(a,c){for(var b in a)a.hasOwnProperty(b)&&this._creative.subscribe(a[b],b,c)},removeCallbacksForCreative:function(a){for(var b in a)a.hasOwnProperty(b)&&this._creative.unsubscribe(a[b],b)},handshakeVersion:function(b){a.log("VPAID Creative: handshakeVersion("+b+")");return this._creative.handshakeVersion(b)},initAd:function(b,c,d,e,f,k){a.log("VPAID Creative: initAd()");this._timeoutOperation="initAd";this._waitForTimeout();
this._creative.initAd(b,c,d,e,f,k)},startAd:function(){a.log("VPAID Creative: startAd()");this._timeoutOperation="startAd";this._waitForTimeout();this._creative.startAd();document.hidden&&this._autoPauseAdOnVisibilityChange&&(a.log("VPAIDRenderer pause ad when tab is invisible"),this._creative.pauseAd(),this._creativePausedByTabSwitch=!0)},stopAd:function(){a.log("VPAID Creative: stopAd()");"loadCreativeAsset"===this._timeoutOperation?(clearInterval(this._loadIntervalTimer),this._timeoutOperation=
"loadCreativeAsset and stopAd"):"startAd"===this._timeoutOperation?(clearTimeout(this._timeoutTimer),this._timeoutOperation="startAd and stopAd"):this._timeoutOperation+="stopAd";this._creative&&(this._waitForTimeout(),this._creative.stopAd())},isCreativeSkippable:function(){return this._isCreativeFunctionInvokable("skipAd")&&this._isCreativeFunctionInvokable("getAdSkippableState")},getAdSkippableState:function(){return this._isCreativeFunctionInvokable("getAdSkippableState")&&this._creative.getAdSkippableState()},
skipAd:function(){a.log("VPAID Creative: skipAd()");this._creative.skipAd()},canPauseAd:function(){return this._isCreativeFunctionInvokable("pauseAd")},canResumeAd:function(){return this._isCreativeFunctionInvokable("resumeAd")},canResizeAd:function(){return this._isCreativeFunctionInvokable("resizeAd")},pauseAd:function(){this.canPauseAd()&&(a.log("VPAID Creative: pauseAd()"),this._creative.pauseAd())},resumeAd:function(){this.canResumeAd()&&(a.log("VPAID Creative: resumeAd()"),this._creative.resumeAd())},
resizeAd:function(b,c,d){this.canResizeAd()?(a.log("VPAID Creative: resizeAd()"),this._creative.resizeAd(b,c,d)):a.log("The creative is not able to resize")},getAdVolume:function(){return this._isCreativeFunctionInvokable("getAdVolume")?this._creative.getAdVolume():-1},setAdVolume:function(a){this._isCreativeFunctionInvokable("setAdVolume")&&this._creative.setAdVolume(a)},getAdExpanded:function(){return this._isCreativeFunctionInvokable("getAdExpanded")?this._creative.getAdExpanded():!1},getAdRemainingTime:function(){return this._isCreativeFunctionInvokable("getAdRemainingTime")?
this._creative.getAdRemainingTime():-1},getAdDuration:function(){return this._isCreativeFunctionInvokable("getAdDuration")?this._creative.getAdDuration():-1},getAdLinear:function(){return this._creative.getAdLinear()},getAdCompanions:function(){return this._isCreativeFunctionInvokable("getAdCompanions")?this._creative.getAdCompanions():""},setTimeoutValueInMs:function(a){this._timeoutInMs=a},cancelTimeoutEvent:function(){a.log("cancelTimeoutEvent");var b="startAd and stopAd"!==this._timeoutOperation;
clearTimeout(this._timeoutTimer);if(!b){this._timeoutOperation="startAd";var c=this;setTimeout(function(){c._eventHandlers&&c._eventHandlers.timeout&&c._eventHandlers.timeout.call()},500)}},addEventListener:function(a,c){this._eventHandlers[a]=c},removeEventListener:function(a){this._eventHandlers[a]=null},_waitForTimeout:function(){a.log("Wait for "+this._timeoutOperation+" for "+this._timeoutInMs+"ms");if(this._eventHandlers.timeout){var b=this;this._timeoutTimer=setTimeout(function(){b.timeoutReached||
(b.timeoutReached=!0);"startAd"===b._timeoutOperation?b.stopAd():("loadCreativeAsset"===b._timeoutOperation&&clearInterval(b._loadIntervalTimer),b._eventHandlers&&b._eventHandlers.timeout&&b._eventHandlers.timeout.call())},this._timeoutInMs)}},getTimeoutOperation:function(){return this._timeoutOperation}};a.VPAIDWrapper.prototype.constructor=a.VPAIDWrapper;a.VPAIDRenderer=function(){this._rendererController=null;this._isCORSEnforcementDisabled=!0;this.vpaidCreative=null;this.vpaidVolume=this.vpaidDuration=
-1;this.creativeEventCallbacks={};this.isMuted=!1;this.adPlaybackState="";this.creativeTimeoutDelayInMs=1E4;this.vpaidDesiredBitrate=268;this.vpaidViewmode="normal";this.playheadTime=0;this.videoBase=document.createElement("div");this.videoParent=null;this.SUPPORTED_CREATIVE_VPAID_VERSION_MIN=this.PLAYER_VPAID_VERSION=2};a.VPAIDRenderer.prototype={};a.VPAIDRenderer.prototype.constructor=a.VPAIDRenderer;a.VPAIDRenderer.VastCompanion=function(a,c,d,e){this._width=a;this._height=c;this._apiFramework=
d;this._xmlNode=e};a.VPAIDRenderer.VastCompanion.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},_isValidResource:function(a,c){return"StaticResource"===a&&c["@attributes"].creativeType||"IFrameResource"===a&&c.value||"HTMLResource"===a&&c.value},hasValidRendtions:function(){for(var a in this._xmlNode)if(this._xmlNode.hasOwnProperty(a)&&("StaticResource"===a||"IFrameResource"===a||"HTMLResource"===a))for(var c=[].concat(this._xmlNode[a]),d=c.length-1;0<=
d;d--)if(this._isValidResource(a,c[d]))return!0;return!1},translateToAdInstance:function(b){this._xmlNode.CompanionClickThrough&&b.setClickThroughUrl(a.EVENT_AD_CLICK,this._xmlNode.CompanionClickThrough.value);var c;if(this._xmlNode.TrackingEvents){var d=this._xmlNode.TrackingEvents;if(d.Tracking){d=[].concat(d.Tracking);var e=[];for(c=d.length-1;0<=c;c--)"creativeView"===d[c]["@attributes"].event&&e.push(d[c].value);0<e.length&&b.addEventCallbackUrls(a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,
e)}}for(var f in this._xmlNode)if(this._xmlNode.hasOwnProperty(f)&&("StaticResource"===f||"IFrameResource"===f||"HTMLResource"===f))for(d=[].concat(this._xmlNode[f]),c=d.length-1;0<=c;c--)if(this._isValidResource(f,d[c])){e=d[c];var k=b.addCreativeRendition();k.setWidth(this._width);k.setHeight(this._height);k.setCreativeApi("None");var g=k.addCreativeRenditionAsset("VPAIDAsset"+c,!0);g.setContentType("text/html_doc_lit_mobile");g.setMimeType("text/html");var h=b.getEventCallbackUrls(a.EVENT_AD_CLICK,
a.EVENT_TYPE_CLICK)[0],l=f;if("HTMLResource"===l)g.setContent(a.HTMLAdGenerator.wrapUnsafeHTML(e.value,b.getSlot().getCustomId(),this._width,this._height));else{var q;"IFrameResource"===l?q="iframe":"StaticResource"===l&&(q=this._xmlNode.creativeType);g.setContent(a.HTMLAdGenerator.generateAd(e.value,h,b.getSlot().getCustomId(),this._width,this._height,q,g.getContentType()))}a.debug("rendtion width: "+k.getWidth()+" height:"+k.getHeight()+" asset content:"+g.getContent())}}};a.VPAIDRenderer.VastCompanion.prototype.constructor=
a.VPAIDRenderer.VastCompanion;a.VPAIDRenderer.VastAdSelect=function(){};a.VPAIDRenderer.VastAdSelect.prototype={_getDeadSpaceRatio:function(b,c){var d=b.getWidth();b=b.getHeight();var e=c.getWidth();c=c.getHeight();var f=1;d<=e&&b<=c&&(f=1-d*b/(e*c));a.debug("computing dead space ratio ("+f+") for slot "+e+"x"+c+" and ad "+d+"x"+b);return f},matchAdsWithSlots:function(b,c){a.log("VPAIDRenderer: Matching ads with slots");var d;for(d=0;d<c.length;++d)c[d].matched=!1;var e=[],f=[];for(d=0;d<b.length;d++)for(var k=
0;k<c.length;k++)f.push({ratio:this._getDeadSpaceRatio(b[d],c[k]),adIndex:d,slotIndex:k});f.sort(function(a,b){return a.ratio-b.ratio});for(d=0;d<f.length&&1!==f[d].ratio;d++){k=f[d];var g=b[k.adIndex],h=c[k.slotIndex];g.matched||h.matched||(a.log("Winning ratio:"+k.ratio+" Winning ad:"+g.getWidth()+"x"+g.getHeight()+" for slot:"+h.getWidth()+"x"+h.getHeight()),e.push({ad:g,slot:h}),g.matched=!0,h.matched=!0)}return e}};a.VPAIDRenderer.VastAdSelect.prototype.constructor=a.VPAIDRenderer.VastAdSelect;
a.Util.mixin(a.VPAIDRenderer.prototype,{_initParams:function(){var b=this._rendererController.getParameter(a.PARAMETER_VPAID_CREATIVE_TIMEOUT_DELAY);this._isCORSEnforcementDisabled=this._rendererController.getParameter(a.PARAMETER_DISABLE_CORS_ENFORCEMENT);b&&0<Number(b)&&(this.creativeTimeoutDelayInMs=Number(b));a.log("initParams(), creative timeout delay in miliseconds:"+this.creativeTimeoutDelayInMs);b=parseFloat(this._rendererController.getParameter(a.PARAMETER_DESIRED_BITRATE));this.vpaidDesiredBitrate=
0<b?b:this.vpaidDesiredBitrate;a.log("initParams(), desired bitrate: "+this.vpaidDesiredBitrate)},_failWithError:function(b,c,d){var e={};e[a.INFO_KEY_ERROR_MODULE]="VPAIDRenderer";e[a.INFO_KEY_ERROR_CODE]=b;d||(d=a.ERROR_VAST_GENERAL_VPAID_ERROR);e[a.INFO_KEY_VAST_ERROR_CODE]=d;c&&(e[a.INFO_KEY_ERROR_INFO]=c);this._rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,e);this.dispose()},onCreativeLoadError:function(b,c){a.log("VPAIDRenderer: onCreativeLoadError()");this.vpaidCreative.cancelTimeoutEvent();
this._failWithError(b,c)},onCreativeTimeout:function(){a.log("VPAIDRenderer: onCreativeTimeout()");var b=this.vpaidCreative.getTimeoutOperation();this._failWithError(a.ERROR_TIMEOUT,"loadCreativeAsset"!==b?"Creative function "+b+" timeout":"load creative asset timeout")},setVolume:function(b){a.log("VPAIDRenderer: setVolume("+b+")");this.vpaidCreative&&this.vpaidCreative.setAdVolume(b)},onAdVolumeChange:function(){a.log("VPAIDRenderer: onAdVolumeChange()");var b=this.vpaidCreative.getAdVolume();0>
b||1<b?a.log("Invalid ad volume value"):(this.isMuted&&2<100*b?(this.isMuted=!1,this._rendererController.processEvent({name:a.EVENT_AD_UNMUTE})):!this.isMuted&&2>100*b&&(this.isMuted=!0,this._rendererController.processEvent({name:a.EVENT_AD_MUTE})),this._rendererController.processEvent({name:a.EVENT_AD_VOLUME_CHANGE}))},onAdExpandedChange:function(){a.log("VPAIDRenderer: onAdExpandedChange()");this.vpaidCreative.getAdExpanded()?this._rendererController.processEvent({name:a.EVENT_AD_EXPAND}):this._rendererController.processEvent({name:a.EVENT_AD_COLLAPSE})},
onAdDurationChange:function(){a.log("VPAIDRenderer: onAdDurationChange(): duration changed to "+this.vpaidCreative.getAdDuration())},onAdClickThru:function(b,c,d){a.log("VPAIDRenderer: onAdClickThru() with url:"+b+" id:"+c+" playerHandles:"+d);c={name:a.EVENT_AD_CLICK,info:{}};c.info[a.INFO_KEY_SHOW_BROWSER]=!0===d;!0===d?b?(a.log("onAdClickThru(): open window with overrided url"),c.info[a.INFO_KEY_URL]=b):a.log("onAdClickThru(): open window with url booked in MRM UI or VAST clickthru url"):a.log("onAdClickThru(): send click tracking");
this._rendererController.processEvent(c)},onCreativeAssetLoaded:function(){a.log("VPAIDRenderer: onCreativeAssetLoaded()");this.vpaidCreative.cancelTimeoutEvent();var b=this,c=function(){var c=b.vpaidCreative.handshakeVersion(b.PLAYER_VPAID_VERSION.toFixed(1));return c?parseFloat(c)<b.SUPPORTED_CREATIVE_VPAID_VERSION_MIN?(b._failWithError(a.ERROR_INVALID_VALUE,"Only support creatives with VPAID version >= "+b.SUPPORTED_CREATIVE_VPAID_VERSION_MIN.toFixed(1)),!1):!0:(b._failWithError(a.ERROR_3P_COMPONENT,
"Cannot get VPAID version from the creative"),!1)};if(function(){var c=b.vpaidCreative.checkVPAIDInterface("handshakeVersion initAd startAd stopAd subscribe unsubscribe getAdLinear".split(" "));c.passed||b._failWithError(a.ERROR_3P_COMPONENT,"Missing interfaces in the VPAID creative: "+c.missingInterfaces);return c.passed}()&&c()){b.creativeEventCallbacks={AdStarted:b.onAdStarted,AdStopped:b.onAdStopped,AdSkipped:b.onAdSkipped,AdLoaded:b.onAdLoaded,AdLinearChange:b.onAdLinearChange,AdSizeChange:b.onAdSizeChange,
AdExpandedChange:b.onAdExpandedChange,AdDurationChange:b.onAdDurationChange,AdVolumeChange:b.onAdVolumeChange,AdImpression:b.onAdImpression,AdClickThru:b.onAdClickThru,AdSkippableStateChange:b.onAdSkippableStateChange,AdVideoFirstQuartile:b.onAdVideoFirstQuartile,AdVideoMidpoint:b.onAdVideoMidpoint,AdVideoThirdQuartile:b.onAdVideoThirdQuartile,AdVideoComplete:b.onAdVideoComplete,AdUserAcceptInvitation:b.onAdUserAcceptInvitation,AdUserMinimize:b.onAdUserMinimize,AdUserClose:b.onAdUserClose,AdPaused:b.onAdPaused,
AdPlaying:b.onAdResumed,AdError:b.onAdError,AdLog:b.onAdLog};b.vpaidCreative.setCallbacksForCreative(b.creativeEventCallbacks,b);this._rendererController.setCapability(a.EVENT_AD_QUARTILE,a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_MUTE,a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_EXPAND,a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_PAUSE,a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_CLOSE,
a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_MINIMIZE,a.CAPABILITY_STATUS_ON);this._rendererController.setCapability(a.EVENT_AD_ACCEPT_INVITATION,a.CAPABILITY_STATUS_ON);(c=this.rendition?this.rendition.getParameter("creativeData"):null)||(c=this.rendition?this.rendition.getParameter("VPAID_creativeData"):null);c&&(c=a.Util.trim(c));c={AdParameters:c};var d=this._rendererController.getAdInstance().getSlot();this.videoBase.style.width="0px";this.videoBase.style.height=
"0px";this.videoBase.style.zIndex="100000";this.videoBase.style.position="absolute";this.videoBase.style.left=this._rendererController.getContentVideoElement().style.left;this.videoBase.style.top=this._rendererController.getContentVideoElement().style.top;this.videoBase.className="fw_vpaid_slot";this.videoParent=d.getBase();var e=this._rendererController.getContentVideoElement();if("nodeType"in e&&0<e.nodeType)try{this.videoParent.insertBefore(this.videoBase,this._rendererController.getContentVideoElement())}catch(k){this.videoParent.insertBefore(this.videoBase,
this.videoParent.firstChild)}else this.videoParent.insertBefore(this.videoBase,this.videoParent.firstChild);e={slot:this.videoBase,videoSlot:this._rendererController.getContentVideoElement(),videoSlotCanAutoPlay:!0};var f=d.getWidth();d=d.getHeight();f&&d||!this.rendition||(f=this.rendition.getWidth(),d=this.rendition.getHeight());this.vpaidViewmode=f>=screen.width&&d>=screen.height?"fullscreen":"normal";a.log("VPAIDRenderer ad init videoMode: "+this.vpaidViewmode);this.vpaidCreative.initAd(f,d,this.vpaidViewmode,
this.vpaidDesiredBitrate,c,e)}},onAdLoaded:function(){a.log("VPAIDRenderer: onAdLoaded()");this.vpaidCreative.cancelTimeoutEvent();a.log("Ad duration:"+this.getDuration());var b=this,c=function(c,d){var e=d;a.debug(e.length+" companion slots to fill.");if(0!==e.length&&0!==c.length){var f=(new a.VPAIDRenderer.VastAdSelect).matchAdsWithSlots(c,e);if(0!==f.length){c=[];e=[];for(d=f.length-1;0<=d;d--)c.push(f[d].ad),e.push(f[d].slot);e=b._rendererController.scheduleAdInstances(e);for(d=e.length-1;0<=
d;d--)c[d].translateToAdInstance(e[d])}}},d=function(b){if(!b)return a.log("The adCompanions property is empty."),null;a.log("parsing adCompanions: "+b);if(window.DOMParser)var c=(new DOMParser).parseFromString(b,"text/xml");else c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(b);b=a.Util.xmlToJson(c);if(!b||!b.CompanionAds||!b.CompanionAds.Companion)return a.log("No companion ads found in parsed xml"),[];b=[].concat(b.CompanionAds.Companion);c=[];for(var d=b.length-1;0<=d;d--){var e=
b[d];if(e["@attributes"]){var h=e["@attributes"].width,l=e["@attributes"].height;if(!h||!l||0>h||0>l)a.log("Missing width/height for companion.");else{var q=e["@attributes"].apiFramework||"";a.debug("Companion "+h+"x"+l+" api:"+q);e=new a.VPAIDRenderer.VastCompanion(h,l,q,e);e.hasValidRendtions()&&c.push(e)}}}return c}(b.vpaidCreative.getAdCompanions());d&&0<d.length?c(d,this._rendererController.getCompanionSlots()):a.log("VPAIDAdRenderer: No companions from VPAID creative.");c=this._rendererController.getAdInstance()._context.getAdVolume();
!this.isMuted&&2>100*c&&(this.isMuted=!0);this.setVolume(c);this.vpaidCreative.startAd()},onVisibilityChange:function(){a.log("onVisibilityChange:"+(document.hidden?"invisible":"visible"));a.log("Current playback state:"+this.adPlaybackState);document.hidden&&"playing"===this.adPlaybackState?(a.log("Pause the VPAID creative"),this.vpaidCreative.pauseAd(),this.vpaidCreative._creativePausedByTabSwitch=!0):!document.hidden&&"paused"===this.adPlaybackState&&this.vpaidCreative._creativePausedByTabSwitch&&
(a.log("Resume the VPAID creative"),this.vpaidCreative.resumeAd(),this.vpaidCreative._creativePausedByTabSwitch=!1)},onAdStarted:function(){a.log("VPAIDRenderer: onAdStarted()");this.vpaidCreative.timeoutReached?a.log("VPAID ad has already failed due to timeout. The AdStarted event will not be handled."):(this.vpaidCreative.cancelTimeoutEvent(),this.vpaidCreative._autoPauseAdOnVisibilityChange&&(this._visibilityChangeListener=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",
this._visibilityChangeListener,!1)))},onAdStopped:function(){a.log("VPAIDRenderer: onAdStopped()");this.vpaidCreative?(this.vpaidCreative.cancelTimeoutEvent(),this.timePositionClass===a.TIME_POSITION_CLASS_OVERLAY&&this.vpaidCreative.getAdLinear()&&this._rendererController.requestContentStateChange(!1),this.vpaidCreative&&!this.vpaidCreative.timeoutReached&&(this.adPlaybackState?(this._rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED),this.dispose()):(a.warn("Expecting AdStarted and AdImpression events but got AdStopped event instead. Fail."),
this._failWithError(a.ERROR_3P_COMPONENT,"Expecting AdStarted and AdImpression events from the VPAID creative but got AdStopped event instead")))):a.log("The VPAID creative has been disposed. Return.")},onAdImpression:function(){a.log("VPAIDRenderer: onAdImpression()");if(this.vpaidCreative.timeoutReached)a.log("VPAID ad has already failed due to timeout. The AdImpression event will not be handled.");else{var b=this.vpaidCreative.getAdVolume();this.isMuted=0<b&&2>=100*b;this.adPlaybackState="playing";
this._rendererController.handleStateTransition(a.RENDERER_STATE_STARTED)}},onAdLinearChange:function(){a.log("VPAIDRenderer: onAdLinearChange()");var b=this.vpaidCreative.getAdLinear();b?a.log("onAdLinearChange(): non-linear click to linear -> request content video to pause"):a.log("onAdLinearChange(): linear back to non-linear -> request content video to resume");this._rendererController.requestContentStateChange(b)},onAdSizeChange:function(){a.log("VPAIDRenderer: onAdSizeChange()")},onAdPaused:function(){a.log("VPAIDRenderer: onAdPaused()");
"playing"===this.adPlaybackState&&this._rendererController.processEvent({name:a.EVENT_AD_PAUSE});this.adPlaybackState="paused"},onAdResumed:function(){a.log("VPAIDRenderer: onAdResumed()");"paused"===this.adPlaybackState&&this._rendererController.processEvent({name:a.EVENT_AD_RESUME});this.adPlaybackState="playing"},attemptSkip:function(){a.log("VPAIDRenderer: attemptSkip()");this.vpaidCreative.isCreativeSkippable()?this.vpaidCreative.getAdSkippableState()?this.vpaidCreative.skipAd():(a.log("VPAIDRenderer: creative adSkippableState is false, adding SkippableStateChange listener"),
this._isAttemptSkipCalled=!0):(a.log("VPAIDRenderer: creative does not have skip functionality, calling rendererController.stop()"),this._rendererController.getAdInstance()._processSkipEvent(),this._rendererController.stop(),this.adPlaybackState||this._rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED))},onAdSkippableStateChange:function(){a.log("VPAIDRenderer: onAdSkippableStateChange()");this.vpaidCreative.getAdSkippableState()&&this._isAttemptSkipCalled?(this._isAttemptSkipCalled=
!1,this.vpaidCreative.skipAd()):a.log("VPAIDRenderer: creative adSkippableState is false, unable to skip");this._rendererController.processEvent({name:a.EVENT_AD_SKIPPABLE_STATE_CHANGED})},onAdSkipped:function(){a.log("VPAIDRenderer: onAdSkipped()");this._rendererController.getAdInstance()._processSkipEvent();this.dispose();this._rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED)},onAdVideoFirstQuartile:function(){a.log("VPAIDRenderer: onAdVideoFirstQuartile()");this._rendererController.processEvent({name:a.EVENT_AD_FIRST_QUARTILE})},
onAdVideoMidpoint:function(){a.log("VPAIDRenderer: onAdVideoMidpoint()");this._rendererController.processEvent({name:a.EVENT_AD_MIDPOINT})},onAdVideoThirdQuartile:function(){a.log("VPAIDRenderer: onAdVideoThirdQuartile()");this._rendererController.processEvent({name:a.EVENT_AD_THIRD_QUARTILE})},onAdVideoComplete:function(){a.log("VPAIDRenderer: onAdVideoComplete");this._rendererController.processEvent({name:a.EVENT_AD_COMPLETE})},onAdUserAcceptInvitation:function(){a.log("VPAIDRenderer: onAdUserAcceptInvitation()");
this._rendererController.processEvent({name:a.EVENT_AD_ACCEPT_INVITATION})},onAdUserClose:function(){a.log("VPAIDRenderer: onAdUserClose()");this._rendererController.processEvent({name:a.EVENT_AD_CLOSE})},onAdUserMinimize:function(){a.log("VPAIDRenderer: onAdUserMinimize()");this._rendererController.processEvent({name:a.EVENT_AD_MINIMIZE})},onAdLog:function(b){a.log("VPAIDRenderer: onAdLog: "+b)},onAdError:function(b){a.log("VPAIDRenderer: onAdError(): "+b);this._failWithError(a.ERROR_3P_COMPONENT,
"AdError event:"+b)},start:function(b){a.log("VPAIDRenderer start()");this._rendererController=b;this._isAttemptSkipCalled=!1;this.timePositionClass=this._rendererController.getAdInstance().getSlot().getTimePositionClass();this.rendition=this._rendererController.getAdInstance().getActiveCreativeRendition();this._initParams();if(b=(b=this.rendition?this.rendition.getPrimaryCreativeRenditionAsset():null)?b.getProxiedUrl():null){this.vpaidCreative=new a.VPAIDWrapper;this.vpaidCreative._autoPauseAdOnVisibilityChange=
this._rendererController.getParameter(a.PARAMETER_AUTO_PAUSE_AD_ONVISIBILITYCHANGE);this.vpaidCreative._isCORSEnforcementDisabled=this._isCORSEnforcementDisabled;this.vpaidCreative.setTimeoutValueInMs(this.creativeTimeoutDelayInMs);this.vpaidCreative.addEventListener("loaderror",this.onCreativeLoadError.bind(this));this.vpaidCreative.addEventListener("timeout",this.onCreativeTimeout.bind(this));this.vpaidCreative.addEventListener("CreativeAssetLoaded",this.onCreativeAssetLoaded.bind(this));try{this.vpaidCreative.loadCreativeAsset(b)}catch(c){a.warn(c),
this._isCORSEnforcementDisabled?(this._failWithError(a.ERROR_UNKNOWN,"Error when loading creative"+c),this.cancelTimeoutEvent()):that._eventHandlers.loaderror(a.ERROR_UNKNOWN,"Error when loading creative: "+c)}}else this._failWithError(a.ERROR_NULL_ASSET,"Creative asset url cannot be null")},stop:function(){a.log("VPAIDRenderer stop()");this.vpaidCreative.stopAd();this.vpaidCreative&&"loadCreativeAsset and stopAd"==this.vpaidCreative.getTimeoutOperation()&&this.dispose()},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},
getPlayheadTime:function(){var a=this.vpaidCreative.getAdDuration(),c=this.vpaidCreative.getAdRemainingTime();0<=a&&0<=c&&(this.playheadTime=a-c);0>this.playheadTime&&(this.playheadTime=-1);return this.playheadTime},getDuration:function(){var a=this.vpaidCreative.getAdDuration();return 0<=a?a:-1},pause:function(){a.log("VPAIDRenderer pause()");this._rendererController.processEvent({name:a.EVENT_AD_PAUSE});this.vpaidCreative.canPauseAd()?"playing"===this.adPlaybackState&&(this.adPlaybackState="pausing",
this.vpaidCreative.pauseAd()):a.log("The creative is not able to pause")},resume:function(){a.log("VPAIDRenderer resume()");this._rendererController.processEvent({name:a.EVENT_AD_RESUME});this.vpaidCreative.canResumeAd()?"paused"===this.adPlaybackState&&(this.adPlaybackState="resuming",this.vpaidCreative.resumeAd()):a.log("The creative is not able to resume")},dispose:function(){a.log("VPAIDRenderer dispose()");this.vpaidCreative&&(this.videoParent&&(this.videoParent.removeChild(this.videoBase),this.videoParent=
null),this._visibilityChangeListener&&this.vpaidCreative._autoPauseAdOnVisibilityChange&&(a.log("remove visibilitychange listener"),document.removeEventListener("visibilitychange",this._visibilityChangeListener,!1)),this.vpaidCreative.removeCallbacksForCreative(this.creativeEventCallbacks),this.vpaidCreative.removeEventListener("CreativeAssetLoaded"),this.vpaidCreative.removeEventListener("timeout"),this.vpaidCreative.removeEventListener("loaderror"),this.vpaidCreative=null)},resize:function(){a.log("VPAIDAdRenderer resize()");
var b=this._rendererController.getAdInstance().getSlot(),c=b.getWidth();b=b.getHeight();a.log("VPAIDRenderer new size width:"+c+" height:"+b);this.vpaidViewmode=c>=screen.width&&b>=screen.height?"fullscreen":"normal";a.log("VPAIDRenderer videoMode: "+this.vpaidViewmode);this.vpaidCreative.resizeAd(c,b,this.vpaidViewmode)},getAdSkippableState:function(){return this.vpaidCreative.getAdSkippableState()}});a.VastTranslator=function(){this._rendererController=this._request=null};a.VastTranslator.prototype=
{start:function(b){function c(b){a.log("VastTranslator\t"+b)}function d(b){a.warn("VastTranslator\t"+b)}function e(a,b){if(a)if(a.length&&"string"!==typeof a)for(var c=0;c<a.length;c++)b(a[c].value);else a.value&&b(a.value)}function f(a,b){e(b,function(b){b&&a.push(b)})}function k(b){if(!b)return!1;for(var c=0;c<F.length;c++)if(a.Util.trim(F[c]).toLowerCase()===a.Util.trim(b).toLowerCase())return!0;return!1}function g(b){if(!b)return null;"string"!==typeof b&&(b=b.toString());b=a.Util.trim(b);return-1<
b.indexOf("://")?b:null}function h(b,c){if(b&&b.length)for(var d=0;d<b.length;d++)h(b[d],c);else if(b.AdVerifications&&b.AdVerifications.Verification)if(b=b.AdVerifications.Verification,b.length)for(d=0;d<b.length;d++){var e=new a.AdVerification(b[d]);c.adVerifications.push(e)}else e=new a.AdVerification(b),c.adVerifications.push(e)}function l(a){this.code=this.url=null;this.height=this.width=NaN;this.resourceType=this.creativeType=null;this.bitrate=NaN;this.creativeApi=null;this.ad=a;this.clickThrough=
null;this.clickTrackings=[];this.customClicks=[];this.creativeData=null}function q(){this.creativeView=[];this.start=[];this.firstQuartile=[];this.midpoint=[];this.thirdQuartile=[];this.complete=[];this.mute=[];this.unmute=[];this.pause=[];this.rewind=[];this.resume=[];this.replay=[];this.fullscreen=[];this.expand=[];this.collapse=[];this.acceptInvitation=[];this.stop=[];this.skip=[];this.progress={};this.percentageProgress={}}function A(a){this._impressions=[];this.clickThrough=null;this.clickTrackings=
[];this.customClicks=[];this.creativeData=null;this.sequence=-1;this.universalAdId=null;this.vastRenditions=[];this.duration=NaN;this.adp=a;this.isDrivingAd=!1}function P(a){A.call(this,a)}function I(a){A.call(this,a)}function m(a){A.call(this,a)}function r(){}function x(a,b,d,e){if(a&&e&&0<e.length){c("augmentCallbacks("+b+", "+d+", "+e+")");for(var f=a.getEventCallbackUrls(b,d),p=0;p<f.length;p++)-1<e.indexOf(f[p])&&(c("augmentCallbacks() url = "+f[p]),e.unshift(f[p]));a.addEventCallbackUrls(b,
d,e)}else c("augmentCallbacks("+b+", "+d+", "+e+"), empty callbacks")}function L(b,d){c("initErrorTrackings()");b&&d&&x(b,a.EVENT_ERROR,a.EVENT_TYPE_ERROR,d.errorTrackings)}function M(b,d){c("initTrackingEvents()");if(d&&b){x(b,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,d.creativeView);x(b,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,d.start);x(b,a.EVENT_AD_FIRST_QUARTILE,a.EVENT_TYPE_IMPRESSION,d.firstQuartile);x(b,a.EVENT_AD_MIDPOINT,a.EVENT_TYPE_IMPRESSION,d.midpoint);x(b,a.EVENT_AD_THIRD_QUARTILE,
a.EVENT_TYPE_IMPRESSION,d.thirdQuartile);x(b,a.EVENT_AD_COMPLETE,a.EVENT_TYPE_IMPRESSION,d.complete);x(b,a.EVENT_AD_MUTE,a.EVENT_TYPE_STANDARD,d.mute);x(b,a.EVENT_AD_UNMUTE,a.EVENT_TYPE_STANDARD,d.unmute);x(b,a.EVENT_AD_PAUSE,a.EVENT_TYPE_STANDARD,d.pause);x(b,a.EVENT_AD_RESUME,a.EVENT_TYPE_STANDARD,d.resume);x(b,a.EVENT_AD_REWIND,a.EVENT_TYPE_STANDARD,d.rewind);x(b,a.EVENT_AD_EXPAND,a.EVENT_TYPE_STANDARD,d.fullscreen);x(b,a.EVENT_AD_COLLAPSE,a.EVENT_TYPE_STANDARD,d.collapse);x(b,a.EVENT_AD_EXPAND,
a.EVENT_TYPE_STANDARD,d.expand);x(b,a.EVENT_AD_CLOSE,a.EVENT_TYPE_STANDARD,d.stop);x(b,a.EVENT_AD_ACCEPT_INVITATION,a.EVENT_TYPE_STANDARD,d.acceptInvitation);x(b,a.EVENT_AD_SKIPPED,a.EVENT_TYPE_STANDARD,d.skip);for(var e=Object.keys(d.progress),f=0;f<e.length;f++){var p=e[f];b.addProgressEventCallbackUrls(p,d.progress[p])}e=Object.keys(d.percentageProgress);for(f=0;f<e.length;f++)p=e[f],b.addPercentageProgressEventCallbackUrls(p,d.percentageProgress[p])}}function N(b,d,e,f,g){c("initClickAndImpressionEvents");
if(b){d&&b.setClickThroughUrl(a.EVENT_AD_CLICK,d);e&&0<e.length&&x(b,a.EVENT_AD_CLICK,a.EVENT_TYPE_CLICK_TRACKING,e);if(f&&0<f.length)for(d=0;d<f.length;d++)f[d].url&&x(b,f[d].id,a.EVENT_TYPE_CLICK_TRACKING,[f[d].url]);g&&x(b,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,g)}}function Q(a,b){c("initTemporalAdInstance");a||d("initTemporalAdInstance: Invalid adInstance");if(b.selectedDrivingAd){b.surveyUrl&&a._creative.setParameter("_fw_survey_url",b.surveyUrl);var e=b.selectedDrivingAd,f=b.selectedDrivingRenditions;
c("vastRenditions:"+f);for(var p=4===y,g=0;g<f.length;g++){var h=a.addCreativeRendition();var B=h.addCreativeRenditionAsset("VAST_CRA",!0);var l=f[g];a:{var m=l.creativeType;switch(m){case "video/mp4":m="video/mp4-h264";break a;case "video/3gp":m="video/3gpp"}}c("initTemporalAdInstance() set rendition/asset [vastRd.creativeApi,vastAd.duration,vastRd.width,vastRd.height,vastRd.url,assetContentType,vastRd.creativeType] =  "+[l.creativeApi,e.duration,l.width,l.height,l.url,m,l.creativeType]);h.setCreativeApi(l.creativeApi);
isNaN(e.duration)||h.setDuration(e.duration);l.width&&!isNaN(l.width)&&h.setWidth(l.width);l.height&&!isNaN(l.height)&&h.setHeight(l.height);e.universalAdId&&h.setUniversalAdId(e.universalAdId);l.url&&B.setUrl(l.url);l.code&&B.setContent(l.code);B.setMimeType(l.creativeType);"static"===l.resourceType&&"text/html"===l.creativeType?B.setContentType("text/html_doc_ref"):"application/x-javascript"===l.creativeType||"application/javascript"===l.creativeType?B.setContentType("text/js_ref"):"iframe"===l.resourceType?
B.setContentType("text/html_doc_ref"):"text/html"===l.creativeType||"text/html_doc_ref"===l.creativeType?B.setContentType("text/html_doc_ref"):"text/html_doc_lit_mobile"===l.creativeType?B.setContentType("text/html_doc_lit_mobile"):p||k(m)?(B.setContentType("text/html_doc_lit_mobile"),B.setUrl(null),B.setContent(U(a,G.getCustomId(),e,l,"text/html_doc_lit_mobile"))):B.setContentType(m);e.creativeData&&0!==e.creativeData.length&&(c("initTemporalAdInstance(), set asset parameter creativeData:"+e.creativeData),
h.setParameter("creativeData",e.creativeData));p||k(m)||(l=l.bitrate,!isNaN(l)&&0<l&&B.setBytes(1E3*l*e.duration/8));m=K;B=J;l=!1;if(h.getContentType()&&m){var n=h.getContentType().toLowerCase(),q=m.toLowerCase();if(n===q)l=!0;else if(0===n.indexOf("video/mp4")&&0===q.indexOf("video/mp4")||"application/javascript"===q&&"text/js_ref"===n)h.setContentType(m),l=!0}m=!1;h.getCreativeApi()&&B&&(n=h.getCreativeApi().toLowerCase(),q=B.toLowerCase(),n===q?m=!0:0===n.indexOf("mraid")&&0===q.indexOf("mraid")&&
(m=!0,h.setCreativeApi(B)));l&&m?h.setPreference(10):m?h.setPreference(6):l?h.setPreference(5):h.setPreference(0);c("adjustMatchedRendition "+h.getId()+", contentType "+h.getContentType()+", creativeAPI "+h.getCreativeApi()+", preference "+h.getPreference())}M(a,e.trackingEvents);L(a,b);N(a,p?f[0].clickThrough:e.clickThrough,e.clickTrackings,e.customClicks,e.impressions);a.addAdVerifications(b.adVerifications)}else h=a.addCreativeRendition(),h.setContentType("null/null"),B=h.addCreativeRenditionAsset("VAST_CRA",
!0),B.setContentType("null/null")}function U(b,d,e,f,g){c("getCoadHTML, ad id = "+b.getAdId());return f.url&&0<f.url.length?((e=f.clickThrough)&&0<e.length&&b.setClickThroughUrl(a.EVENT_AD_CLICK,e),b=b.getEventCallbackUrls(a.EVENT_AD_CLICK,a.EVENT_TYPE_CLICK)[0],a.HTMLAdGenerator.generateAd(f.url,b,d,f.width,f.height,f.creativeType,g)):f.code&&0<f.code.length?"script"===f.resourceType||"text/javascript"===f.resourceType||"text/js_ref"===f.resourceType||"application/x-javascript"===f.resourceType?
a.HTMLAdGenerator.wrapJSCode(f.code,d,f.width,f.height):a.HTMLAdGenerator.wrapUnsafeHTML(f.code,d,f.width,f.height):null}function R(b,d,e,f){c("initPageAdInstance ad:"+d.getAdId());var p=e.vastRenditions[0];if(p.url||p.code){var g=d.addCreativeRendition(),h=g.addCreativeRenditionAsset("VAST_CRA",!0);g.setCreativeApi(p.creativeApi);g.setWidth(p.width);g.setHeight(p.height);"static"===p.resourceType&&"text/html"===p.creativeType||"iframe"===p.resourceType?(h.setContentType("text/html_doc_ref"),h.setUrl(p.url)):
"HTML"===p.resourceType?(h.setContentType("text/html_doc_lit_mobile"),h.setContent(a.HTMLAdGenerator.wrapUnsafeHTML(p.code,b.getCustomId(),p.width,p.height))):(h.setContentType("text/html_doc_lit_mobile"),h.setContent(U(d,b.getCustomId(),e,p,"text/html_doc_lit_mobile")));h.setMimeType("text/html")}else c("initPageAdInstance will add a tracking only companion ad");M(d,e.trackingEvents);L(d,f);N(d,p.clickThrough,p.clickTrackings,p.customClicks,e.impressions)}function t(b){if(200<=b.status&&400>b.status)if(b.responseXML){var d=
(new r).parseAdData(b.responseXML);if(d){c("scheduleVastAds");if(d&&0!==d.length)if(b=d[0].selectedPackage,d=d[0].redirectPackage,!b&&!d)if(c("scheduleVastAds(), no ads from vast response!!!"),u)if(4!==y)v.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE,"Expecting linear ad but returned non-linear ad",a.ERROR_VAST_LINEARITY_NOT_MATCH);else v.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE,"Expecting non-linear ad but returned linear ad",a.ERROR_VAST_LINEARITY_NOT_MATCH);else v.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE,
"wrapperUrl="+E);else if(!b&&d){c("scheduleVastAds(), no ads scheduled, redirect to downstream Secondary Ad Server");c("scheduleRedirect");b=[];var e=[];b.push(G);e.push({});for(var f=D,g=d.selectedCompanionAds,p=0;p<f.length;p++){var h=f[p];g&&g[h.getCustomId()]&&(b.push(h),e.push(g[h.getCustomId()]))}(f=v._rendererController.scheduleAdInstances(b))&&0<f.length&&(g=f[0],p=g.addCreativeRendition(),p.setWrapperUrl(a.Util.transformUrlToProxy(d.tagUrl)),p.setWrapperType(V),p.setContentType(K),p.setCreativeApi(J),
M(g,d.getTrackingEventsOfWrapper()),L(g,d),N(g,d.getClickThroughOfWrapper(),d.getClickTrackingsOfWrapper(),d.getCustomClicksOfWrapper(),d.getImpressionOfWrapper()),g.addAdVerifications(d.adVerifications));c("scheduleRedirect, schedule companion for redirect ad "+d);for(p=1;p<f.length;p++)if(g=f[p])h=e[p],h instanceof m&&R(b[p],g,h,d)}else{if(b){c("scheduleVastAds(), ads returned from vast response, going to schedule them");b.selectedDrivingAd?(c("scheduleVastAds(), ads returned from vast response, going to schedule them with driving ad"),
b.selectedDrivingAd.isDrivingAd=!0):c("scheduleVastAds(), ads returned from vast response, going to schedule them without driving ad");c("scheduleAdPackage()");d=[];e=[];d.push(G);b.selectedDrivingAd&&e.push(b.selectedDrivingAd);f=D;g=b.selectedCompanionAds;for(p=0;p<f.length;p++)h=f[p],g&&g[h.getCustomId()]&&(d.push(h),e.push(g[h.getCustomId()]));g=v._rendererController.scheduleAdInstances(d);if(0<g.length){c("scheduleAdPackage, scheduled "+g.length+" ads"+b.selectedDrivingAd?"":", 1 of it is nullAd for pure companion ad schedule");
b.selectedDrivingAd||c("Driving ad is not selected, will create a dummy null ad.");b.selectedDrivingAd||(d.shift(),Q(g.shift(),b));for(p=0;p<g.length;p++)if(h=g[p]){var k=e[p];k instanceof m?R(d[p],h,k,b):Q(h,b)}!b.selectedDrivingAd&&0<f.length&&0<b.companionAds.length&&0===e.length&&(c("found empty companion slots and companion ads in package, but none of them matches slot size"),v.onTranslatorFailed(a.ERROR_UNMATCHED_SLOT_SIZE))}else c("scheduleAdPackage, no ad scheduled.")}}else c("no ads for scheduleVastAds");
v._request=null;v._rendererController.handleStateTransition(a.TRANSLATOR_STATE_STARTED);v._rendererController.handleStateTransition(a.TRANSLATOR_STATE_COMPLETED)}}else v.onTranslatorFailed(a.ERROR_PARSE,"wrapperUrl="+E,a.ERROR_VAST_XML_PARSING);else if(0!=b.status)v.onTranslatorFailed(a.ERROR_IO,"wrapperUrl="+E)}this._rendererController=b;var F="image/gif image/jpeg image/png text/html text/javascript text/html_doc_ref text/html_doc_lit_mobile application/x-javascript application/javascript".split(" "),
u=!1,w=this._rendererController.getAdInstance(),v=this,G=w.getSlot(),y=function(){if(!G)return 1;switch(G.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_POSTROLL:return 2;case a.TIME_POSITION_CLASS_OVERLAY:return 4;case a.TIME_POSITION_CLASS_DISPLAY:return G&&!G.getBase()?8:1;default:return 1}}(),D=this._rendererController.getCompanionSlots().filter(function(b){if(!b)return!1;switch(b.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_PAUSE_MIDROLL:case a.TIME_POSITION_CLASS_POSTROLL:return!1;
default:return!0}});c("Checking CompanionSlots, length = "+D.length+", this._rendererController.getCompanionSlots().length = "+this._rendererController.getCompanionSlots().length+", AdInstance.getCompanionSlots.length = "+w.getCompanionSlots().length);var K=w.getActiveCreativeRendition().getContentType(),J=w.getActiveCreativeRendition().getCreativeApi()||"None";this.log("ExpectedDrivingContentType:"+K+", ExpectedDrivingAPI:"+J);var V=w.getActiveCreativeRendition().getWrapperType();l.prototype={init:function(a,
b,c,d,e,f,g,h){this.log("init("+[].slice.call(arguments,0).join(",")+")");this.url=a;this.width=1*b;this.height=1*c;this.creativeType=d;this.resourceType=e;this.bitrate=f;var p;if((p=g)&&0!==p.length)switch(p.toLowerCase()){case "flashvar":case "flashvars":p="clickTag";break;case "vpaid":p="VPAID";break;case "mraid":p="MRAID-1.0"}else p="None";this.creativeApi=p;this.code=h||null},log:function(b){a.log("VastTranslator.VastRendition\t"+b)},toString:function(){var a=[],b;for(b in this)this.hasOwnProperty(b)&&
"function"!==typeof this[b]&&"ad"!==b&&a.push(b+":"+this[b]);return a.join(",")}};l.prototype.constructor=l;A.prototype={parse:function(b){this.log("parse()");b["@attributes"]&&b["@attributes"].hasOwnProperty("skipoffset")&&(w._setSkipOffset(b["@attributes"].skipoffset),w._setSkipOffsetPercentage(b["@attributes"].skipoffset));if(b.Duration)if(b.Duration.value){var c=/(\d+):(\d+):(\d+)/.exec(b.Duration.value);c?this.duration=3600*c[1]+60*c[2]+1*c[3]:this.warn("Failed to parse duration value for creative "+
b)}else this.warn("No duration value set for creative "+b);b.VideoClicks&&(b.VideoClicks=[].concat(b.VideoClicks),a.Util.forEachOnArray(b.VideoClicks,function(a){a.ClickThrough&&a.ClickThrough.value&&(this.clickThrough=g(a.ClickThrough.value));var b;if(a.ClickTracking){a.ClickTracking=[].concat(a.ClickTracking);for(var c=0;c<a.ClickTracking.length;c++)(b=g(a.ClickTracking[c].value))&&this.clickTrackings.push(b)}if(a.CustomClick)for(a.CustomClick=[].concat(a.CustomClick),c=0;c<a.CustomClick.length;c++){var d=
null;a.CustomClick[c]["@attributes"]&&(d=a.CustomClick[c]["@attributes"].id);(b=g(a.CustomClick[c].value))&&this.customClicks.push({id:d,url:b})}},this));b.MediaFiles&&b.MediaFiles.MediaFile&&(b.MediaFiles.MediaFile=[].concat(b.MediaFiles.MediaFile),a.Util.forEachOnArray(b.MediaFiles.MediaFile,function(a){var b=g(a.value),c=NaN,d=NaN,e=null,f="None",h=NaN;a["@attributes"]&&(c=a["@attributes"].width||NaN,d=a["@attributes"].height||NaN,e=a["@attributes"].type,f=a["@attributes"].apiFramework||"None",
h=a["@attributes"].bitrate||NaN);b&&-1!==b.indexOf(":")?(a=new l(this),a.init(b,c,d,e,"",h,f,null),a.clickThrough=this.clickThrough,this.vastRenditions.push(a),(isNaN(c)||isNaN(d))&&this.log("continue with missing [width,height]"+[c,d])):this.warn("will ignore this mediaFile because some required field is missing [url,width,height]:"+[b,c,d])},this));b.TrackingEvents&&this.parseTrackingEvents(b.TrackingEvents,this.setTrackingEvents());b.AdParameters&&(this.log("parse() got AdParameters:"+b.AdParameters.value),
this.creativeData=b.AdParameters.value);b.Companion&&(b.Companion=[].concat(b.Companion),a.Util.forEachOnArray(b.Companion,function(b){var c=null,d=null,e="",f="",h=null,p=null,B=!1;b.CompanionClickThrough&&(f=g(b.CompanionClickThrough.value));b.StaticResource&&(c=g(b.StaticResource.value),b.StaticResource["@attributes"]&&(d=b.StaticResource["@attributes"].creativeType),e="static");b.IFrameResource&&(c=g(b.IFrameResource.value))&&(d="text/html_doc_ref",e="iframe");b.HTMLResource&&(h=b.HTMLResource["#cdata-section"]||
"",h=a.Util.trim(h))&&(d="text/html_doc_lit_mobile",e="HTML");b.TrackingEvents&&(p=b.TrackingEvents);var T=new m(this.adp);T.sequence=this.sequence;T.clickThrough=f;p&&T.parseTrackingEvents(p,T.setTrackingEvents());if(b["@attributes"]){p=b["@attributes"].width||NaN;var n=b["@attributes"].height||NaN;b=b["@attributes"].apiFramework||"None";if((c&&-1!==c.indexOf(":")||h)&&!isNaN(p)&&!isNaN(n)&&k(d)||this.adp.isWrapper){var q=new l(T);q.init(c,p,n,d,e,NaN,b,h);q.clickThrough=f;T.vastRenditions.push(q)}else B=
!0,this.warn("will ignore this rendition because some required fields is missing or incompatible [creativeType,url,code,width,height]:"+[d,c,h,p,n])}else this.adp.isWrapper||(B=!0,this.warn("for InLine ad package, No attributes found for the Companion ads:"+b));B?this.adp.isWrapper&&this.adp.companionAds.push(T):this.adp.companionAds.push(T)},this));b.NonLinear&&(b.NonLinear=[].concat(b.NonLinear),a.Util.forEachOnArray(b.NonLinear,function(b){var c=null,d=null,e="",f="",h="",p=null,B=!1;b.AdParameters&&
(h=b.AdParameters.value);b.NonLinearClickThrough&&(f=g(b.NonLinearClickThrough.value));b.StaticResource&&(c=g(b.StaticResource.value),b.StaticResource["@attributes"]&&(d=b.StaticResource["@attributes"].creativeType),e="static");b.IFrameResource&&(c=g(b.IFrameResource.value),d="text/html_doc_ref",e="iframe");b.HTMLResource&&(p=b.HTMLResource["#cdata-section"]||"",p=a.Util.trim(p),d="text/html_doc_lit_mobile",e="HTML");var m=new I(this.adp);m.sequence=this.sequence;m.clickThrough=f;m._trackingEvents=
this._trackingEvents;h&&(m.creativeData=h);if(b["@attributes"]){h=b["@attributes"].width||NaN;var n=b["@attributes"].height||NaN;b=b["@attributes"].apiFramework||"None";if(!c&&!p||isNaN(h)||isNaN(n)||!k(d))B=!0,this.warn("will ignore this rendition because some required fields is missing or incompatible:[creativeType,url,code,width,height]:"+[d,c,p,h,n]);else{var T=new l(m);T.init(c,h,n,d,e,NaN,b,p);T.clickThrough=f;m.vastRenditions.push(T)}}else this.adp.isWrapper||(B=!0,this.warn("for InLine ad package, No attributes found for the NonLinear ads:"+
b));this.adp.nonLinearAds.push(m);B?this.adp.isWrapper&&this.adp.nonLinearAds.push(m):this.adp.nonLinearAds.push(m)},this))},parseLinears:function(a){2!==y?(this.log("TargetAdType != TARGET_LINEAR, skipping parse"),u=!0):this.parse(a)},parseNonLinears:function(a){4!==y?(this.log("TargetAdType != TARGET_NONLINEAR, skipping parse"),u=!0):this.parse(a)},parseCompanionAds:function(a){this.parse(a)},setTrackingEvents:function(){this._trackingEvents||(this._trackingEvents=new q);return this._trackingEvents},
parseTrackingEvents:function(b,c){this.log("parseTrackingEvents");b.Tracking&&(b.Tracking=[].concat(b.Tracking),a.Util.forEachOnArray(b.Tracking,function(b){var d=b["@attributes"].event,e=g(b.value);if(e)switch(d){case "creativeView":case "start":case "firstQuartile":case "midpoint":case "thirdQuartile":case "complete":case "mute":case "unmute":case "pause":case "resume":case "rewind":case "replay":case "fullscreen":case "expand":case "collapse":case "acceptInvitation":case "stop":case "skip":c[d].push(e);
break;case "progress":d=a.Util.offsetStringToSecond(b["@attributes"].offset,this.duration);-1!=d&&(c.progress[d]||(c.progress[d]=[]),c.progress[d].push(e));b=a.Util.offsetStringToPercentage(b["@attributes"].offset);-1!=b&&(c.percentageProgress[b]||(c.percentageProgress[b]=[]),c.percentageProgress[b].push(e));break;case "close":c.stop.push(e)}},this),a.debug("********** events:",c))},toString:function(){return this.constructor.name+", renditions:"+this.vastRenditions},log:function(b){a.log("VastTranslator."+
this.constructor.name+"\t"+b)},warn:function(b){a.warn("VastTranslator."+this.constructor.name+"\t"+b)}};b=Object.defineProperty||function(a,b,c){c.get&&a.__defineGetter__(b,c.get);c.set&&a.__defineSetter__(b,c.set)};b(A.prototype,"trackingEvents",{get:function(){this.log("get trackingEvents()");return this._trackingEvents?this._trackingEvents:this.isDrivingAd?this.adp.trackingEvents:null}});b(A.prototype,"impressions",{set:function(a){this._impressions=a},get:function(){return this.isDrivingAd?this._impressions.concat(this.adp.impressions):
this._impressions}});A.prototype.constructor=A;P.prototype=new A;P.prototype.constructor=P;I.prototype=new A;I.prototype.constructor=I;m.prototype=new A;m.prototype.getPrimaryRendition=function(){return this.vastRenditions[0]||null};b(m.prototype,"impressions",{get:function(){return 8===y?this._impressions.concat(this.adp.impressions):this._impressions}});m.prototype.constructor=m;var O=function(){this.impressions=[];this.errorTrackings=[];this.linearAds=[];this.nonLinearAds=[];this.companionAds=
[];this.extensions=[];this.tagUrl="";this.isWrapper=!1;this.surveyUrl=null;this.selectedDrivingRenditions=[];this.selectedDrivingAd=null;this.selectedCompanionAds={};this.adVerifications=[]};O.prototype={parse:function(a){this.log("parse("+a+")");if(a)if(this.isWrapper||a.Creatives&&a.Creatives.Creative){a.Creatives=a.Creatives||[];f(this.impressions,a.Impression);f(this.extensions,a.Extensions);f(this.errorTrackings,a.Error);this.isWrapper&&a.VASTAdTagURI&&(this.tagUrl=a.VASTAdTagURI.value||"");
a.Survey&&a.Survey.value&&0<a.Survey.value.length&&(this.surveyUrl=a.Survey.value);a.Creatives.Creative=a.Creatives.Creative?[].concat(a.Creatives.Creative):[];for(var b=0;b<a.Creatives.Creative.length;b++){var c=a.Creatives.Creative[b],d=-1;c["@attributes"]&&(d=c["@attributes"].sequence||-1,d*=1);if(c.Linear){var e=new P(this);e.sequence=d;e.parseLinears(c.Linear);this.linearAds.push(e)}else c.NonLinearAds?(e=new I(this),e.sequence=d,e.parseNonLinears(c.NonLinearAds)):c.CompanionAds&&(e=new m(this),
e.sequence=d,e.parseCompanionAds(c.CompanionAds));e&&c.UniversalAdId?(e.universalAdId={idRegistry:c.UniversalAdId["@attributes"].idRegistry,idValue:c.UniversalAdId["@attributes"].idValue},this.log("Universal Ad ID with idRegistry "+e.universalAdId.idRegistry+" and idValue "+e.universalAdId.idValue)):this.log("No Universal Ad ID is present in the VAST response.")}a.Extensions&&a.Extensions.Extension&&h(a.Extensions.Extension,this);a.AdVerifications&&h(a,this)}else this.warn("parse(): no creative found!");
else this.warn("parse(): empty adpackage")},testAndUpdatePackageForTemporalSlot:function(a){this.log("testAndUpdatePackageForTemporalSlot("+a+")");a=a?this.linearAds:this.nonLinearAds;if(1>a.length)return!1;this.log("testAndUpdatePackageForTemporalSlot(), ads.length = "+a.length+"");var b=!1;if(!b)for(var c=0;c<a.length;c++){var d=this.findRenditionGroupByContentType(a[c]);if(0<d.length){this.log("testAndUpdatePackageForTemporalSlot() : found driving ad and renditions group: "+d);this.selectedDrivingRenditions=
d;this.selectedDrivingAd=a[c];b=!0;break}}return b},testAndUpdatePackageForPageSlots:function(a){var b=!1,c=this.companionAds,d=D.slice(0);this.log("testAndUpdatePackageForPageSlots("+a+"), ads are "+c.join(",")+", slots are "+d.join(","));if(a){if(a=this.matchAdsToSlots(c,d),0<a.length)for(b=!0,c=0;c<a.length;c++){d=a[c];var e=d.ad;this.selectedCompanionAds[d.slot.getCustomId()]=e}}else a=this.matchAdsToSlots(c,[G]),1===a.length?(b=!0,this.selectedDrivingAd=a[0].ad):this.selectedDrivingAd=null;return b},
renditionFitsInSlot:function(a,b){return a?a.width<=b.getWidth()&&a.height<=b.getHeight():!1},calcDeadSpaceRatio:function(a,b){a=a.getPrimaryRendition();if(!a)return 0;this.log("ad w,h  slot w,h"+[a.width,a.height,b.getWidth(),b.getHeight()]);return this.renditionFitsInSlot(a,b)?1-a.width*a.height/b.getWidth()*b.getHeight():1},matchAdsToSlots:function(a,b){this.log("matchAdsToSlots(ads="+a.join(",")+", slots="+b.join(",")+")");for(var c=[],d=null,e=null,f=1,g=0;g<a.length;g++)for(var h=a[g],k=0;k<
b.length;k++){var p=b[k],l=this.calcDeadSpaceRatio(h,p);l<f&&(d=h,e=p,f=l)}null!=d&&(c.push({ad:d,slot:e}),a.splice(a.indexOf(d),1),b.splice(b.indexOf(e),1),c=c.concat(this.matchAdsToSlots(a,b)));this.log("matchAdsToSlots: winningAd:"+d+" winningSlot:"+e+" ratio:"+f);return c},getAllRenditions:function(a){return a.vastRenditions},findRenditionGroupByContentType:function(b){this.log("findRenditionGroupByContentType:"+b);var c=[];if(b instanceof P&&isNaN(b.duration))return this.warn("findRenditionGroupByContentType(), duration of linear ad is NaN, will not used for scheduling"),
c;for(var d=this.getAllRenditions(b),e=0;e<d.length;e++){var f=d[e];if(b instanceof P){if(null==f.creativeType||""===a.Util.trim(f.creativeType)){this.warn("findRenditionGroupByContentType, the contentType "+f.creativeType+" not supported for linearAd");continue}}else if(!k(f.creativeType)){this.warn("findRenditionGroupByContentType, the contentType "+f.creativeType+" not supported for non-linearAd");continue}c.push(f)}return c},formalizeString:function(b){return b?a.Util.trim(b).toLowerCase():""},
getAdsByTargetType:function(){this.log("getAdsByTargetType");var a=[];switch(y){case 8:a=this.companionAds;break;case 2:a=this.linearAds;break;case 4:a=this.nonLinearAds}for(var b=0;b<a.length;b++)a[b].isDrivingAd=!0;return a},getImpressionOfWrapper:function(){this.log("getImpressionOfWrapper");for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d&&d._impressions&&0<d._impressions.length){b=d._impressions;break}}b||(b=this.impressions);return b},getTrackingEventsOfWrapper:function(){this.log("getTrackingEventsOfWrapper");
for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d&&d._trackingEvents){b=d._trackingEvents;break}}return b},getClickThroughOfWrapper:function(){this.log("getClickThroughOfWrapper");for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d){d.clickThrough&&(b=d.clickThrough);d=d.vastRenditions;for(var e=0;e<d.length;e++){var f=d[e];if(f.clickThrough){b=f.clickThrough;break}}if(b)break}}return b},getClickTrackingsOfWrapper:function(){this.log("getClickTrackingsOfWrapper");
for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d){d.clickTrackings&&0<d.clickTrackings.length&&(b=d.clickTrackings);d=d.vastRenditions;for(var e=0;e<d.length;e++){var f=d[e];if(f.clickTrackings&&0<f.clickTrackings.length){b=f.clickTrackings;break}}if(b)break}}return b},getCustomClicksOfWrapper:function(){this.log("getCustomClicksOfWrapper");for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d){d.customClicks&&0<d.customClicks.length&&(b=d.customClicks);
d=d.vastRenditions;for(var e=0;e<d.length;e++){var f=d[e];if(f.customClicks&&0<f.customClicks.length){b=f.customClicks;break}}if(b)break}}return b},testWrapperForRedirect:function(){this.log("testAndUpdateWrapperForRedirect()");return this.tagUrl&&0<this.tagUrl.length},log:function(b){a.log("VastTranslator.VastAdPackage\t"+b)},warn:function(b){a.warn("VastTranslator.VastAdPackage\t"+b)}};O.prototype.constructor=O;r.prototype={getVastVersion:function(a){this.log("getVastVersion("+a+")");return a&&
0!==a.indexOf(".")?0<a.indexOf(".")?parseInt(a.substring(0,a.indexOf("."))):parseInt(a):-1},parseAdData:function(b){this.log("parseAdData()");var c={},d;c.selectedPackage=null;c.redirectPackage=null;var e=a.Util.xmlToJson(b);if(e)if(e.VAST&&e.VAST["@attributes"])if(this.getVastVersion(e.VAST["@attributes"].version)<a.MINIMUM_VAST_VERSION_SUPPORTED||this.getVastVersion(e.VAST["@attributes"].version)>a.MAXIMUM_VAST_VERSION_SUPPORTED)v.onTranslatorFailed(a.ERROR_PARSE,"wrapperUrl="+E,a.ERROR_VAST_VERSION_NOT_SUPPORTED);
else{if(e.VAST.Ad){e.VAST.Ad=[].concat(e.VAST.Ad);var f=[];b=[];for(d=0;d<e.VAST.Ad.length;d++){var g=new O;g.isWrapper=!!e.VAST.Ad[d].Wrapper;g.isWrapper?(g.parse(e.VAST.Ad[d].Wrapper),b.push(g)):(g.parse(e.VAST.Ad[d].InLine),f.push(g))}e=!1;if(0===f.length&&0===b.length)return this.log("parseAdData(): no ads from vast response!!!"),[c];this.log("parseAdData(): "+f.length+"inline ads, "+b.length+" wrapper ads.");g=null;for(d=0;d<f.length;d++)if(this.selectUsableAdsForDrivingSlot(f[d])){this.log("parseAdData(): package for driving slot is found!!!");
g=f[d];break}d=0<D.length&&w.getSlot().getTimePositionClass()!==a.TIME_POSITION_CLASS_DISPLAY;if(g)d&&this.selectUsableAdsCompanionSlots(g)&&this.log("parseAdData(): companion ads are found for companion slots, with driving slot"),c.selectedPackage=g;else if(d){d=!1;for(var h=0;h<f.length;h++)g=f[h],this.selectUsableAdsCompanionSlots(g)&&(this.log("parseAdData(): companion ads are found for companion slots,without driving slot"),c.selectedPackage=g,d=!0);d||(this.log("parseAdData(): companion ads are not found for companion slots,without driving slot"),
e=!0)}else this.log("parseAdData(): no usable ads found in vast response!!!"),e=!0;if(e&&0<b.length)for(f=0;f<b.length;f++)if(this.testWrapperForRedirect(b[f])){c.redirectPackage=b[f];w.incrementWrapperCount();this.selectUsableAdsCompanionSlots(b[f])&&this.log("parseAdData(): companion ads are found for wrapper ad");break}return[c]}e.VAST.Error&&x(w,a.EVENT_ERROR,a.EVENT_TYPE_ERROR,e.VAST.Error.value);v.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE,"wrapperUrl="+E,a.ERROR_VAST_NO_AD)}else v.onTranslatorFailed(a.ERROR_PARSE,
"wrapperUrl="+E,a.ERROR_VAST_SCHEMA_VALIDATION);else v.onTranslatorFailed(a.ERROR_PARSE,"wrapperUrl="+E,a.ERROR_VAST_XML_PARSING)},selectUsableAdsForDrivingSlot:function(a){this.log("selectUsableAdsForDrivingSlot()");switch(y){case 2:a=this.testAndUpdatePackageForTemporalSlot(a,!0);break;case 4:a=this.testAndUpdatePackageForTemporalSlot(a,!1);break;case 8:a=this.testAndUpdatePackageForPageSlots(a,!1);break;default:a=!1}return a},selectUsableAdsCompanionSlots:function(a){this.log("selectUsableAdsCompanionSlots(pk)");
return this.testAndUpdatePackageForPageSlots(a,!0)},testAndUpdatePackageForTemporalSlot:function(a,b){this.log("testAndUpdatePackageForTemporalSlot(pk,isLinear), isLinear = "+b);return a.testAndUpdatePackageForTemporalSlot(b)},testAndUpdatePackageForPageSlots:function(a,b){this.log("testAndUpdatePackageForPageSlots(pk,isCompanion) isCompanion = "+b);return a.testAndUpdatePackageForPageSlots(b)},testWrapperForRedirect:function(a){this.log("testWrapperForRedirect(pk)");return a.testWrapperForRedirect()},
log:function(b){a.log("VastTranslator.VastParser\t"+b)},warn:function(b){a.warn("VastTranslator.VastParser\t"+b)}};var E=w.getActiveCreativeRendition().getWrapperUrl();b=w.getActiveCreativeRendition().getWrapperType();c("AdInstance.getActiveCreativeRendition().getWrapperUrl()="+E+", getWrapperType()="+b);if(0!==b.indexOf("external/vast-"))v.onTranslatorFailed(a.ERROR_NO_RENDERER,"wrapperType="+b+";wrapperUrl="+E,a.ERROR_VAST_TRACKING_ERROR);else if(E&&0!==E.length){var S=a.VAST_DEFAULT_MAX_WRAPPER_COUNT;
(b=this._rendererController.getParameter(a.PARAMETER_VAST_MAX_WRAPPER_COUNT))&&0<Number(b)&&(S=Number(b));if(w.getWrapperCount()>=S)v.onTranslatorFailed(a.ERROR_IO,"maximum wrapper limit is reached "+w.getWrapperCount(),a.ERROR_VAST_WRAPPER_LIMIT_REACH);else{S=this._rendererController.getParameter("translator.vast.asyncLoad");S=!0===a.Util.str2bool(S);c("will load vast xml, asyncAjax:"+S);var X=this._rendererController.getParameter("translator.vast.loadWithCookie");X=!0===a.Util.str2bool(X);var H=
null,W=5E3;(b=this._rendererController.getParameter(a.PARAMETER_VAST_TIMEOUT_IN_MILLISECONDS))&&0<Number(b)&&(W=Number(b));try{window.XDomainRequest?(H=new XDomainRequest,S=!0):(H=new XMLHttpRequest,H.withCredentials=X),v._request=H,S?(H.open("GET",E),window.XDomainRequest?H.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(H.responseText);H.responseXML=a;H.status=200;t(H)}:(H.timeout=W,H.onreadystatechange=function(){4===H.readyState&&t(H)}),H.ontimeout=function(){v.onTranslatorFailed(a.ERROR_TIMEOUT,
"wrapperUrl="+E+" timed out.",a.ERROR_VAST_URI_TIMEOUT)},H.onerror=function(){window.XDomainRequest&&(H.status=0);0===H.status?(d("CORS error"),v.onTranslatorFailed(a.ERROR_SECURITY,"wrapperUrl="+E)):(d("exception:"+H.statusText),v.onTranslatorFailed(a.ERROR_UNKNOWN,"wrapperUrl="+E+";exception="+H.statusText))},H.send()):(H.open("GET",E,!1),H.send(),t(H))}catch(p){b=!1;if(!window.XMLHttpRequestException)p.code===DOMException.NETWORK_ERR&&(d("CORS in IE10"),b=!0);else if(p instanceof XMLHttpRequestException)switch(p.code){case XMLHttpRequestException.NETWORK_ERR:b=
!0}b?(d("CORS error:"+p),v.onTranslatorFailed(a.ERROR_SECURITY,"wrapperUrl="+E)):(d("exception:"+p),v.onTranslatorFailed(a.ERROR_UNKNOWN,"wrapperUrl="+E+";exception="+p))}}}else v.onTranslatorFailed(a.ERROR_NULL_ASSET,"wrapperUrl="+E,a.ERROR_VAST_TRACKING_ERROR)},info:function(){return{moduleType:a.MODULE_TYPE_TRANSLATOR}},log:function(b){a.log("VastTranslator\t"+b)},warn:function(b){a.warn("VastTranslator\t"+b)},getPlayheadTime:function(){return-1},getDuration:function(){return-1},stop:function(){a.debug("VastTranslator stop");
this._request&&(this._request.abort(),a.log("VastTranslator Stop: request aborted"));this._request=null;this._rendererController&&this._rendererController.handleStateTransition(a.TRANSLATOR_STATE_COMPLETED)},onTranslatorFailed:function(b,c,d){this._request&&(this._request=null);var e={};e[a.INFO_KEY_ERROR_MODULE]="VastTranslator";e[a.INFO_KEY_ERROR_CODE]=b;e[a.INFO_KEY_VAST_ERROR_CODE]=d;c&&(e[a.INFO_KEY_ERROR_INFO]=c);this._rendererController.handleStateTransition(a.TRANSLATOR_STATE_FAILED,e)}};
a.VastTranslator.prototype.constructor=a.VastTranslator;a.ContentVideoExtension=function(){this.autoSourceRestore=this.respondPauseResume=!0;this._originalTime=0;this._contentVideoControls=this._contentVideoSrc=null};a.ContentVideoExtension.prototype={_isEnabled:function(){var b=this._context.getParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED);return(null==b||!0===a.Util.str2bool(b))&&null!=this._context.getContentVideoElement()},init:function(b){a.debug("ContentVideoExtension.init(context)");
this._context=b;this._fixContentVideoCurrentTime=a.Util.bind(this,function(b){a.log("_fixContentVideoCurrentTime: event = "+b.type);if(!(0>=this._context.getContentVideoElement().currentTime||0>=this._context.getContentVideoElement().seekable.length)&&(this._context.getContentVideoElement().removeEventListener("timeupdate",this._fixContentVideoCurrentTime,!1),0<this._context.getContentVideoElement().currentTime&&1>this._context.getContentVideoElement().currentTime&&1<this._originalTime)){a.log("ContentVideoExtension: seeking to original time",
this._originalTime);try{this._context.getContentVideoElement().currentTime=this._originalTime}catch(d){a.warn("ContentVideoExtension: seek error")}}});this._pause=a.Util.bind(this,function(b){a.log("_pause: event = "+b.type);this._isEnabled()?this._respondPauseResume()&&(a.debug("ContentVideoExtension: EVENT_CONTENT_VIDEO_PAUSE_REQUEST pausing content video",this._context.getContentVideoElement().src),this._originalTime=this._context.getContentVideoElement().currentTime,this._context.getContentVideoElement().pause()):
a.debug("ContentVideoExtension: extension is not enabled, do nothing.")});this._resume=a.Util.bind(this,function(b){a.log("_resume: event = "+b.type);this._isEnabled()?this._respondPauseResume()&&(a.debug("ContentVideoExtension: EVENT_CONTENT_VIDEO_RESUME_REQUEST resume content video",this._context.getContentVideoElement().src),!this._context._videoAsset||null!=this._context._videoAsset._state&&this._context._videoAsset._state!==a.VIDEO_STATE_COMPLETED?(a.log("ContentVideoExtension: resume content video"),
this._context.getContentVideoElement().play(),a.PLATFORM_AUTO_SEEK_AFTER_MIDROLL&&!0===a.Util.getBooleanParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SEEK_BACK,!0)&&this._context.getContentVideoElement().addEventListener("timeupdate",this._fixContentVideoCurrentTime,!1)):a.warn("ContentVideoExtension: video state is uninitialized or completed, skip resume.")):a.debug("ContentVideoExtension: extension is not enabled, do nothing.")});this._onAttach=a.Util.bind(this,function(b){if(!this._isEnabled())a.debug("ContentVideoExtension: extension is not enabled, do nothing.");
else if(this._autoSourceRestore())switch(b.slot.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:a.debug("ContentVideoExtension: store current content video src",this._context.getContentVideoElement().src),this._contentVideoSrc=this._context.getContentVideoElement().src,this._contentVideoControls=this._context.getContentVideoElement().controls,this._context.getContentVideoElement().paused||this._context.getContentVideoElement().pause()}});this._onDetach=
a.Util.bind(this,function(b){if(!this._isEnabled())a.debug("ContentVideoExtension: extension is not enabled, do nothing.");else if(this._autoSourceRestore())switch(b=b.slot.getTimePositionClass(),b){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:a.debug("ContentVideoExtension: restore content video src to",this._contentVideoSrc),this._context.getContentVideoElement().src!==this._contentVideoSrc&&(this._context.getContentVideoElement().src=this._contentVideoSrc),this._context.getContentVideoElement().controls=
this._contentVideoControls,b===a.TIME_POSITION_CLASS_PREROLL&&this._context.getContentVideoElement().load()}});a.debug("ContentVideoExtension: enabling content video pause resume request handling.");this._context.addEventListener(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,this._pause);this._context.addEventListener(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,this._resume);a.debug("ContentVideoExtension: enabling content video source management.");this._context.addEventListener(a.EVENT_SLOT_STARTED,this._onAttach);
this._context.addEventListener(a.EVENT_SLOT_ENDED,this._onDetach)},_respondPauseResume:function(){return a.Util.getBooleanParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_RESPOND_PAUSE_RESUME,!0)},_autoSourceRestore:function(){return a.Util.getBooleanParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SOURCE_RESTORE,!0)},dispose:function(){a.debug("ContentVideoExtension.dispose()");this._context&&(this._context.removeEventListener(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,this._pause),this._context.removeEventListener(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,
this._resume),this._context.removeEventListener(a.EVENT_SLOT_STARTED,this._onAttach),this._context.removeEventListener(a.EVENT_SLOT_ENDED,this._onDetach),this._context=null)}};a.ContentVideoExtension.prototype.constructor=a.ContentVideoExtension;return a};l.tv.freewheel.SDK||(l.tv.freewheel.SDK=l.tv.freewheel[h]("tv.freewheel.SDK"));return l})();
