var Q=Object.defineProperty;var Y=var g=import{x as _,z as j,A as J,bc as U,r as f,j as e,g as w,bE as X,m as I,o as H,an as V}from"./e5833d38.js";import{aV as q,aW as ee,bd as P,a6 as te,t as se,A as M,d as z,a7 as R,o as ae,G as ie,T as d,D as C,N as ne,O as W,H as K,R as G,_ as Z,be as oe,aT as re,M as B,Y as ce,z as le,a5 as de}from"./48a35c56.js";import{H as pe}from"./02f08ba7.js";import{H as me}from"./e76d2cab.js";var T=((T||{});class ue{andleError(t,a){q.trackException(a);const s=ee(a);throw new Error(`${t} Info: ${s}`)}async getTimeSlots(t){const a=`${this.baseEndpoint()}/time-slots`;try{return(await P.post(a,t)).data}catch(s){this.handleError(`Attempted to hit the endpoint "${a}" but encountered an error.`,s)}}async getServices(){const t=`${this.baseEndpoint()}/services`;try{return(await P.get(t)).data}catch(a){this.handleError(`Attempted to hit the endpoint "${t}" but encountered an error.`,a)}}async createBooking(t){const a=this.baseEndpoint();try{return(await P.post(a,t)).data}catch(s){this.handleError(`Attempted to create a booking via "${a}" but encountered an error.`,s)}}}const $=new ue;var he=Object.defineProperty,xe=Object.getOwnPropertyDescriptor,c=class r{constructor(t){g(this,"telemetry");g(this,"isLoadingTopics",!1);g(this,"confirmedBooking");g(this,"selectedTopic");g(this,"topics",_.map({}));g(this,"hasTopics",!1);g(this,"isLoadingTimeSlots",!1);g(this,"timeSlot");g(this,"timeSlots");g(this,"currentState",T.Topic);g(this,"isCreatingMeeting",!1);g(this,"topicLoadingError");g(this,"checkTimeSlots",()=>{this.selectedTopic&&!this.timeSlots&&this.telemetry.trackEvent("Bookings - No timeslots loaded",{service:this.selectedTopic.fullName})});g(this,"submitMeeting",async t=>{this.setIsCreatingMeeting(!0);try{const a=await $.createBooking(t);this.setConfirmedBooking(a),this.setCurrentState(T.Confirmed)}catch(a){this.telemetry.trackException(a),this.telemetry.trackEvent("Bookings - Error creating booking",{service:this.selectedTopic.fullName,booking:t,error:a}),se("Sorry, we couldn't book that appointment, please choose another time.",!0),this.selectTopic(this.selectedTopic)}finally{this.setIsCreatingMeeting(!1)}});this.igniteDateBuilderService=t,J(this),this.telemetry=te}setCurrentState(t){this.currentState=t}async loadTopics(){this.setIsLoadingTopics(!0),this.setTopicLoadingError(void 0);try{const t=await $.getServices();this.buildTopicsMap(t)}catch(t){this.telemetry.trackException(t),this.telemetry.trackEvent("Bookings - Error loading services",{error:t}),this.setTopicLoadingError(t.message)}finally{this.setIsLoadingTopics(!1)}}setTopicLoadingError(t){this.topicLoadingError=t}setIsLoadingTopics(t){this.isLoadingTopics=t}updateTopicMapuildTopicsMap(t){(t==null?void 0:t.length)>0&&(this.hasTopics=!0),this.topics.clear(),t.sort((a,s)=>a.area===s.area?0:a.area>s.area?1:-1),t.forEach(}async loadTimeSlots(){if(this.selectedTopic){this.timeSlot=void 0,this.timeSlots=void 0,this.isLoadingTimeSlots=!0;try{const t=await $.getTimeSlots(this.selectedTopic);this.processTimeSlotsResponse(t)}catch(t){this.telemetry.trackException(t),this.telemetry.trackEvent("Bookings - Error loading timeslots",{service:this.selectedTopic.fullName})}return this.setIsLoadingTimeSlots(!1),Promise.resolve()}}processTimeSlotsResponse(t){const a=t==null?void 0:t.filter(s=>new Date(s.timeBlock.start)>this.igniteDateBuilderService.currentDateTime);this.timeSlots=a,this.setCurrentState(T.Date),this.checkTimeSlots()}setIsLoadingTimeSlots(t){this.isLoadingTimeSlots=t}tIsCreatingMeeting(t){this.isCreatingMeeting=t}c([_],r.prototype,"isLoadingTopics",2);c([_],r.prototype,"confirmedBooking",2);c([_],r.prototype,"selectedTopic",2);c([_],r.prototype,"topics",2);c([_],r.prototype,"hasTopics",2);c([_],r.prototype,"isLoadingTimeSlots",2);c([_],r.prototype,"timeSlot",2);c([_],r.prototype,"timeSlots",2);c([_],r.prototype,"currentState",2);c([_],r.prototype,"isCreatingMeeting",2);c([_],r.prototype,"topicLoadingError",2);c([j],r.prototype,"setCurrentState",1);c([j],r.prototype,"setTopicLoadingError",1);c([j],r.prototype,"setIsLoadingTopics",1);c([j],r.prototype,"updateTopicMap",1);c([j],r.prototype,"buildTopicsMap",1);c([j],r.prototype,"loadTimeSlots",1);c([j],r.prototype,"processTimeSlotsResponse",1);c([j],r.prototype,"setIsLoadingTimeSlots",1);c([j],r.prototype,"selectTopic",1);c([j],r.prototype,"selectTimeSlot",1);c([j],r.prototype,"setIsCreatingMeeting",1);c([j],r.prototype,"setConfirmedBooking",1);c([j],r.prototype,"submitMeeting",2);const be=({topic:i,timeSlot:t,handleCancel:a,handleSubmission:s,isSubmitting:p})=>{const m=M(),h="discard-",l={register:b,control:L,formState:{errors:k},handleSubmit:N}=U({mode:"onTouched"}),{profileStore:x}=z(),{selectedTimezone:S}=R(),[n,u]=f.useState(!1),v=o=>{const y=[];i.questions.forEach(E=>{y.push({id:E.id,answer:o[E.id],question:E.question})});const F={answeredQuestionList:y,customerConsentText:i.customerConsentText,customerEmail:x.email,customerName:x.displayName,customerTimeZone:S,start:t.timeBlock.start,startInCustomerTimeZone:t.timeBlock.start,serviceId:i.serviceId,staffList:t.staffList,serviceEndpoint:i.serviceEndpoint};s(F)},A=O=o=>(o.forEach(y=>{y.id==="25c6e91e-7745-4bef-981a-2c8b097f4665"?(y.prefilledValue=x.companyName,y.isHidden=!!y.prefilledValue):y.id==="81ed8ce1-f419-48be-ac23-b969ad73a7ed"&&(y.prefilledValue=x.country,y.isHidden=!!y.prefilledValue)}),o);return e.jsx("form",{className:"expert-connect__questions",onSubmit:N(v),children:e.jsxs("fieldset",{disabled:p,children:[O(i.questions).map(o=>{var y;return e.jsx("div",{className:w({hidden:o.isHidden}),children:((y=o.options)==null?void 0:y.length)>0?e.jsxs(e.Fragment,{children:[e.jsx(X,{control:L,defaultValue:o.options[0],name:o.id,render:({field:{onChange:F,value:E}})=>e.jsx(ae,{id:o.id,availableOptions:o.options,label:o.question,fullWidth:!1,defaultOption:E,telemetryLabel:"app-consult-confirmation-select",required:o.required,onSelect:F,ariaLabel:""},o.id),rules:{required:o.required}}),k[o.id]&&e.jsx("span",{className:"m-alert f-warning",role:"alert",children:"This field is required"})]}):e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:o.id,className:"c-label",children:o.question}),e.jsx("input",{id:o.id,...b(o.id,{required:o.required}),type:"text",className:"c-text-field f-flex",required:o.required,defaultValue:o.prefilledValue?o.prefilledValue:""}),k[o.id]&&e.jsx("span",{className:"m-alert f-warning",role:"alert",children:"This field is required"})]})},o.id)}),e.jsxs("div",{children:[e.jsx("div",{className:"c-checkbox",children:e.jsxs("label",{className:"c-label",children:[e.jsx("input",{"aria-label":i.customerConsentText,...b(l("consent-checkbox"),{required:!0}),type:"checkbox",id:l("consent-checkbox"),defaultChecked:n,"aria-checked":n,required:!0,onChange:A,"data-m":m({aN:"translate.base.app-consults.info.confirm-details",cN:i.customerConsentText,cNPostFix:n?"_unselect":"_select"})}),e.jsxs("span",{children:[i.customerConsentText,e.jsx(ie,{href:"/app-consult-terms",ariaLabel:"translate.base.app-consults.labels.terms-and-conditions",telemetryIdentifier:"telemetry.expert-connect.app-consult-terms",target:"_blank",children:e.jsx(d,{textKey:"translate.base.app-consults.labels.terms-and-conditions"})})]})]})}),k[l("consent-checkbox")]&&e.jsx("span",{className:"m-alert f-warning",role:"alert",children:"This field is required"})]}),p&&e.jsx(me,{}),e.jsxs("div",{className:"expert-connect__buttons",children:[e.jsx(C,{className:"expert-connect__submit-button",telemetryIdentifier:"telemetry.expert-connect.confirm-meeting",dataCy:"expert-connect-submit",ariaLabel:"translate.base.generic.actions.submit",onClickFunction:()=>N(v),type:"submit",analyticsTag:m({aN:D,cN:"translate.base.generic.actions.submit",cNPostFix:"_CTA"}),children:e.jsx(d,{textKey:"translate.base.generic.actions.submit"})}),e.jsx(C,{className:"expert-connect__cancel-button",telemetryIdentifier:"telemetry.expert-connect.cancel-meeting",onClickFunction:dataCy:"expert-connect-submit",ariaLabel:"translate.base.generic.actions.cancel",analyticsTag:m({aN:D,cN:"translate.base.generic.actions.cancel",cNPostFix:"_CTA"}),children:e.jsx(d,{textKey:"translate.base.generic.actions.cancel"})})]})]})})},ge=be,fe=({timeSlot:i,confirmedBooking:t})=>{if(!i)return null;const a=I(i.timeBlock.start);return e.jsxs("div",{children:[e.jsx(ne,{date:a,format:W.atFullDateTimeString}),"Â ",e.jsx(d,{textKey:K("translate.base.generic.date-time.for-duration",{duration:t==null?void 0:t.formattedDuration})})]})},ye=({topic:i,timeSlot:t,confirmedBooking:a})=>{const{profileStore:s}=z(),p=M(),m=V(),h,l=f.useCallback(()=>{m.push(G.AuthenticatedHome)},[m]);return e.jsx("div",{id:"meetingConfirmed",children:a&&e.jsxs("div",{className:"expert-connect__container-padding",children:[e.jsx("h3",{className:"c-heading-3 expert-connect__title",children:e.jsx(d,{textKey:"translate.base.app-consults.info.meeting-confirmation"})}),e.jsxs("div",{"data-grid":"col-12",className:"expert-connect__details-container",children:[e.jsx("div",{"data-grid":"col-12",className:"expert-connect__thank-you-text expert-connect__text",children:e.jsx(d,{textKey:"translate.base.app-consults.info.thanks-for-confirming"})}),e.jsxs("div",{"data-grid":"col-12 stack-2",children:[e.jsx("div",{"data-grid":"col-3",className:"expert-connect__label",children:e.jsx(d,{textKey:"translate.base.app-consults.labels.topic"})}),e.jsx("div",{"data-grid":"col-9",className:"expert-connect__text","data-cy":"expert-connect-submitted-topic",children:i==null?void 0:i.name})]}),e.jsxs("div",{"data-grid":"col-12 stack-2",children:[e.jsx("div",{"data-grid":"col-3",className:"expert-connect__label",children:e.jsx(d,{textKey:"translate.base.app-consults.labels.date-and-time"})}),e.jsx("div",{"data-grid":"col-9",className:"expert-connect__text","data-cy":"expert-connect-submitted-date",children:e.jsx(fe,{timeSlot:t,confirmedBooking:a})})]}),e.jsxs("div",{"data-grid":"col-12 stack-2",children:[e.jsx("div",{"data-grid":"col-3",className:"expert-connect__label",children:e.jsx(d,{textKey:"translate.base.app-consults.labels.location"})}),e.jsx("div",{"data-grid":"col-9",className:"expert-connect__text",children:e.jsx(d,{textKey:"translate.base.app-consults.labels.location-override"})})]}),e.jsxs("div",{"data-grid":"col-12 stack-2",children:[e.jsx("div",{"data-grid":"col-3",className:"expert-connect__label",children:e.jsx(d,{textKey:"translate.base.app-consults.labels.attendee"})}),e.jsx("div",{"data-grid":"col-9",className:"expert-connect__text",children:s.displayName})]}),e.jsx("div",{"data-grid":"col-12 stack-2",children:e.jsx("div",{"data-grid":"col-9",className:"expert-connect__text",children:e.jsx(d,{textKey:h()})})})]}),e.jsx(C,{onClickFunction:l,buttonStyle:"primary",className:"expert-connect__home-page-button",telemetryIdentifier:"telemetry.expert-connect.go-home",ariaLabel:"translate.base.app-consults.labels.home-page",analyticsTag:p({aN:"App Consult",cN:"translate.base.app-consults.labels.home-page"}),children:e.jsx(d,{textKey:"translate.base.app-consults.labels.home-page"})})]})})},Te=H(ye),je=({currentState:i,handleClick:t})=>{const a=M(),s;return e.jsx("div",{className:"expert-connect__breadcrumbs__container",children:e.jsxs("div",{className:"expert-connect__breadcrumbs",children:[e.jsx("div",{className:w("expert-connect__breadcrumb",{"expert-connect__breadcrumb--selected":i==T.Topic}),children:e.jsx(C,{buttonStyle:"text",telemetryIdentifier:"telemetry.expert-connect.scroll-to.topic",onClickFunction:()=>t(T.Topic),ariaLabel:"translate.base.app-consults.labels.area-of-topic",analyticsTag:s("translate.base.app-consults.labels.area-of-topic"),children:e.jsx(d,{textKey:"translate.base.app-consults.labels.area-of-topic"})})}),e.jsx("div",{className:w("expert-connect__breadcrumb",{"expert-connect__breadcrumb--selected":i==T.Date}),children:e.jsx(C,{buttonStyle:"text",telemetryIdentifier:"telemetry.expert-connect.scroll-to.date",onClickFunction:()=>t(T.Date),ariaLabel:"translate.base.app-consults.labels.date-and-time-list",analyticsTag:s("translate.base.app-consults.labels.date-and-time-list"),children:e.jsx(d,{textKey:"translate.base.app-consults.labels.date-and-time-list"})})}),e.jsx("div",{className:w("expert-connect__breadcrumb",{"expert-connect__breadcrumb--selected":i==T.Confirm}),children:e.jsx(C,{buttonStyle:"text",telemetryIdentifier:"telemetry.expert-connect.scroll-to.confirmation",onClickFunction:()=>t(T.Confirm),ariaLabel:"translate.base.app-consults.labels.confirm-meeting",analyticsTag:s("translate.base.app-consults.labels.confirm-meeting"),children:e.jsx(d,{textKey:"translate.base.app-consults.labels.confirm-meeting"})})})]})})},_e=f.lazy(()=>Z(()=>import("./bf07e4f5.js"),["assets/bf07e4f5.js","assets/e5833d38.js","assets/48a35c56.js","assets/b4ed1a0a.css"])),ve=({items:i,handleClick:t})=>{const a=M(),{timeRangeString:s}=oe(),{selectedTimezone:p}=R(),{now:m}=re(),[h,l]=f.useState(null);if(!i)return e.jsx(B,{});const b=new Map;i.map(n=>{const u=I.tz(n.timeBlock.start,p).format(W.fullMonthDayFormat);b.has(u)?b.get(u).push(n):b.set(u,[n])});const L=(n,u)=>{const v=m(),A=I(b.get(n)[0].timeBlock.start).clone().startOf("day");return A.isAfter(v)?u===0:!A.isSame(v,"day")},k=n=>{const u=I(n.timeBlock.start),v=I(n.timeBlock.end);return s({start:u,end:v,timezone:"long"})},N=n=>{t(n),l)},x=n=>{let u="time-slot-selector__time-button";return n===h&&(u+=" time-slot-selector__time-button--selected"),u},S=(n,u)=>n.timeBlock.start===u.timeBlock.start?0:new Date(n.timeBlock.start)>new Date(u.timeBlock.start)?1:-1;return e.jsx(f.Suspense,{fallback:e.jsx(B,{}),children:e.jsx(_e,{id:"time-slot-pivot",items:b,itemName:"Time slot",handleClick:N,containerClasses:["time-slot-panel","time-slot-selector"],itemGroupClasses:"time-slot-selector__time-slots",customActiveTabSelector:L,customItemComparer:S,render:(n,u)=>{const v=k(n);return e.jsx(C,{className:x(n),telemetryIdentifier:"telemetry.time-slot-selector.availability-selected",ariaLabel:K("translate.base.app-consults.aria-label.select-a-date",{timeSlot:v}),onClickFunction:()=>u(n),analyticsTag:a({aN:D,cN:`Select timeslot:_${v}`,cNPostFix:"_CTA"}),children:e.jsx("span",{children:v})},`${n.timeBlock.start}-${n.timeBlock.end}`)}})})},Se=H(ve),Ce=({isLoadingTimeslots:i,timeSlots:t,handleClick:a})=>e.jsx("div",{id:"date",className:"scroll-block",children:i?e.jsx("div",{children:e.jsx(B,{})}):t!==void 0&&e.jsxs("div",{children:[e.jsx("h3",{className:"c-heading-3 expert-connect__title",children:e.jsx(d,{textKey:"translate.base.app-consults.info.select-a-date"})}),(t==null?void 0:t.length)>0?e.jsx(Se,{items:t,handleClick:a}):e.jsx("div",{className:"expert-connect__text-warn",role:"alert",children:e.jsx(d,{textKey:"translate.base.app-consults.info.no-timeslots"})})]})}),ke=f.lazy),Ne=({topics:i,selectedTopic:t,handleClick:a})=>{const s=M(),{translate:p}=ce(),m,h;return e.jsx(f.Suspense,{fallback:e.jsx(B,{}),children:e.jsx(ke,{id:"topics-pivot",items:i,itemName:"Topic",handleClick:a,containerClasses:["topic-selector"],itemGroupClasses:"topic-selector__cards",customItemComparer:h,render:(l,b)=>e.jsxs("div",{className:"topic-selector__card",children:[e.jsx("h3",{className:"c-heading-3 f-lean topic-selector__title","data-cy":"topic-selector-title",children:l.name}),e.jsx("div",{className:"c-paragraph-4 topic-selector__card-description",children:l.description}),e.jsx("div",{className:"topic-selector__button-container",children:e.jsx(C,{onClickFunction,telemetryIdentifier:`telemetry.topic-selector.topic-selected-${l.fullName}`,className:m(l),dataCy:"topic-selector-button",ariaLabel:K("translate.base.app-consults.labels.select-topic",{topic:l.name}),analyticsTag:s({aN:D,cN:`${p("translate.base.generic.labels.select")}_${l.name}`,cNPostFix:"_CTA"}),children:e.jsx("span",{children:e.jsx(d,{textKey:"translate.base.generic.labels.select"})})})})]},l.serviceId)})})},Le=({topics:i,selectedTopic:t,handleClick:a,error:s})=>e.jsxs("div",{id:"topic",className:"scroll-block topic-selector",children:[e.jsx("h3",{className:"c-heading-3 expert-connect__title expert-connect__title--topic",children:e.jsx(d,{textKey:"translate.base.app-consults.info.select-a-topic"})}),i.size>0&&!s?e.jsx(Ne,{selectedTopic:t,topics:i,handleClick:a}):e.jsxs("div",{className:"expert-connect__text-warn",role:"alert",children:[e.jsx(d,{textKey:"translate.base.app-consults.info.no-topics"}),s&&e.jsx("div",{style:{display:"none"},children:s})]}),e.jsx("hr",{className:"c-divider"})]}),D="App consults",Ae=H(()=>{const{profileStore:i}=z(),{dialogDispatcherService:t,igniteDateBuilderService:a}=le(),[s]=f.useState(new r(a)),p=V(),m=f.useCallback,[s]);f.useEffect(()=>{!s.hasTopics&&!s.isLoadingTopics&&!s.topicLoadingError&&m()},[s.hasTopics,s.isLoadingTopics,s.topicLoadingError,m]);const h=x=>{setTimeout(()=>{const S=document.getElementById(x),n=S==null?void 0:S.querySelector('a, button:not([tabindex="-1"]), input, textarea, select, details,[tabindex]:not([tabindex="-1"])');n==null||n.focus(),S==null||S.scrollIntoView()},100)},l=f.useCallback,[]),b=f.useCallback(x=>{s.selectTopic(x).then)},[s]),L=f.useCallback(x=>{s.selectTimeSlot(x),h(T.Confirm)},[s]),k=f.useCallback,[s]),N=f.useCallback(()=>{t.confirm("translate.base.meeting.actions.confirm-cancel").then)},[t,p]);return e.jsxs("div",{className:"expert-connect app-consult","data-cy":"expert-connect",children:[e.jsx(de,{mainTitle:"translate.base.generic.route-names.expert-connect"}),e.jsxs("div",{id:"primaryArea",role:"main","data-grid":"col-12",className:"content-container",tabIndex:-1,children:[e.jsx(pe,{headerMessage:"translate.base.app-consults.header-message",subHeaderMessage:"translate.base.app-consults.sub-header-message"}),s.isLoadingTopics&&e.jsx(B,{}),e.jsx(Te,{topic:s.selectedTopic,timeSlot:s.timeSlot,confirmedBooking:s.confirmedBooking}),!s.isLoadingTopics&&!s.confirmedBooking&&i.hasScope("expertconnect")&&e.jsxs("div",{className:"expert-connect__container-padding",children:[e.jsx(je,{currentState:s.currentState,handleClick:l}),e.jsx(Le,{selectedTopic:s.selectedTopic,topics:s.topics,handleClick:b,error:s.topicLoadingError}),e.jsx(Ce,{isLoadingTimeslots:s.isLoadingTimeSlots,timeSlots:s.timeSlots,handleClick:L}),e.jsx("div",{id:"confirm",className:"scroll-block",children:s.timeSlot&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"c-heading-3 expert-connect__title",children:e.jsx(d,{textKey:"translate.base.app-consults.info.confirm-details"})}),e.jsx(ge,{topic:s.selectedTopic,timeSlot:s.timeSlot,handleCancel:N,handleSubmission:k,isSubmitting:s.isCreatingMeeting})]})})]})]})]})});export{D as appConsultAreaName,Ae as default};
