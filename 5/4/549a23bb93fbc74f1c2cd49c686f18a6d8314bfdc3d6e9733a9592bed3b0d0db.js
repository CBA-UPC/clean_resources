(window.officehome_webpackJsonp=window.officehome_webpackJsonp||[]).push([[78],{"6wyt":function(e,n,t){"use strict";t.d(n,"a",(function(){return S}));var r=t("QjXU"),o=t("keVe"),i=t("Dn7E"),l=t("laSs"),s=t("lUkk"),a=t("CMIS"),u=t("rTyw"),c=(t("lrJm"),t("hhzZ")),h=t("BaAg"),m=t("p6Zr"),d=(t("QOOv"),t("fKR7")),f=(t("hZW2"),t("Uqr9")),p=t("cgnd"),g=(t("/I02"),t("PBJH"),t("JH4S"),t("lwM0")),v=t("OPwp"),S=function(){function e(e,n,t,r,i,l,s,a,u,c,h,m){this.shareControlService=e,this.mruConfigService=n,this.clientStartupConfigService=t,this.contextService=r,this.startupConfigService=i,this.locService=l,this.instrumentationService=s,this.renderer=a,this.globalErrorHandler=u,this.documentService=c,this.userContextService=h,this.changeDetectorRef=m,this.dismiss=new o.q}return Object.defineProperty(e.prototype,"shareIframe",{set:function(e){var n=this;e&&!this._shareIframe&&(this.mobileShareMenu&&(setTimeout((,0),this.documentService.disableTouchMove()),this.initControl()),this._shareIframe=e},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.isComponentReady()&&(this.isLoading=!0),this.errorText="",this.loadingText=this.locService.ShareControlLoadingText,this.titleAriaLabel=this.locService.ShareControlTitleAriaLabel,this.style=this.getStyleForMode(this.mode),this.isMsa=this.clientStartupConfigService.config.authType===p.a.MSA,this.initTokens()},e.prototype.ngAfterViewInit=function(){var e=this;(this.mobileShareMenu||this.contentShareMenu)&&(this.shareControlOpenSubscription=this.shareControlService.subscribeToOpenEvents((function(n){e.file=n.file,e.index=n.index,e.mode=n.mode,e.nav=n.nav,e.defaultRecipients=n.defaultRecipients,e.onGrantAccessComplete=n.onGrantAccessComplete,e.style=e.getStyleForMode(e.mode),e.isLoading=!0,e.initTokens(),e.changeDetectorRef.detectChanges()})),this.shareControlCloseSubscription=this.shareControlService.subscribeToCloseEvents(())},e.prototype.ngOnDestroy=e.prototype.onLeavingIframeFocus=e.prototype.handleClose=function(e){e&&e.preventDefault(),this.dismiss.emit(),this.onGrantAccessComplete&&!this.grantAccessCalled&&this.onGrantAccessComplete(!1,!0),(this.mobileShareMenu||this.contentShareMenu)&&this.shareControlService.hideControl({file:this.file,index:this.index,mode:this.mode})},e.prototype.isComponentReady=function(){return this.file&&null!=this.index&&null!=this.mode},e.prototype.resetComponent=function(){if(this.windowMessageListener&&this.windowMessageListener(),this.removeCloseListeners(),clearTimeout(this.errorTimeout),this.isLoading){var e=f.a.now(),n=this.commonInstrumentationParams();n.Latency=Math.round(e-this.startInitTime).toString(),this.instrumentationService.logGenericEvent("Share_Control_Abandon",n),Object(i.a)({featureName:"ShareControl",eventName:"Share_Control_Abandon",params:n})}(this.mobileShareMenu||this.contentShareMenu)&&(this._shareIframe=null,this.file=null,this.index=null,this.mode=null,this.nav=void 0,this.defaultRecipients=void 0,this.onGrantAccessComplete=void 0,this.grantAccessCalled=!1,this.errorText=null,this.isLoading=!1)},e.prototype.initTokens=function(){this.isComponentReady()&&(this.startInitTime=f.a.now(),this.tokenType=this.isMsa?"Graph":this.shareControlService.getTokenType(this.file.documentUrl),this.tokenPromise=this.shareControlService.getToken(this.file.documentUrl,this.mruConfigService.config.shareControlCAPPopupEnabled,this.file.fileType,this.tokenType))},e.prototype.initControl=function(){var n=this;if(this.isComponentReady()){setTimeout((function(){return n.loadingContainer.nativeElement.focus()}),0);var t=function(e,t,r,o){n.isLoading&&(n.errorText=n.locService.ShareControlErrorText,n.isLoading=!1,n.setCloseListeners()),(r||o)&&(e=e+". Error message: "+r+". Debug error message: "+o),n.instrumentError(e,t)};this.tokenPromise.then((function(o){var l;if(o.success){var s=f.a.now();n.shareInfo=Object(r.__assign)(Object(r.__assign)({},n.getShareControlIdentifier(n.file)),{authToken:n.isMsa?o.token.trim():"Bearer "+o.token.trim(),clientId:"officecom",itemName:n.file.fileName,siteSubscriptionId:n.startupConfigService.config.tenantId,webAbsoluteUrl:null===(l=n.file.sharepointIds)||void 0===l?void 0:l.siteUrl,isODB:!n.isMsa&&"OneDrive"===n.tokenType,mode:n.mode,organizationName:n.userContextService.user.companyDisplayName,correlationId:n.startupConfigService.config.sharedClientStartupContext.correlationId,navId:n.nav,defaultRecipients:n.defaultRecipients,hasTokenProvider:n.shareControlService.getUseHasTokenProvider()}),n.shareControlService.getDarkMode()&&(n.shareInfo.theme={palette:{themePrimary:"#3A96DD",themeLighterAlt:"#eff6fc",themeLighter:"#deecf9",themeLight:"#c7e0f4",themeTertiary:"#71afe5",themeSecondary:"#2b88d8",themeDarkAlt:"#106ebe",themeDark:"#004578",themeDarker:"#34365c",neutralLighterAlt:"#292827",neutralLighter:"#323130",neutralLight:"#3B3A39",neutralQuaternaryAlt:"#484644",neutralQuaternary:"#605E5C",neutralTertiaryAlt:"#484644",neutralTertiary:"#A19F9D",neutralSecondary:"#BEBBB8",neutralPrimaryAlt:"#E1DFDD",neutralPrimary:"#F3F2F1",neutralDark:"#FAF9F8",redDark:"#FF4343",black:"#FFFFFF",white:"#252423",primaryBackground:"#f9f8f7",primaryText:"#252423",bodyBackground:"#252423",bodyText:"#252423",disabledBackground:"#3B3A39",disabledText:"#c8c8c8"}});var a=!n.isMsa&&n.shareControlService.getUseCompliantShareApi()?n.shareInfo.webAbsoluteUrl+"/_layouts/15/sharedialog.aspx?crossdomain=true&migratedhosting=true&clientId=officecom&clickTime="+Date.now():n.mruConfigService.config.shareApiEndpoint+"?smkt="+n.contextService.sharedContext.officeMarket;n.isMsa&&(a+="&consumer=true");var u=JSON.stringify(n.shareInfo).replace(/"/g,"&quot;"),c=e.iframeHtmlTemplate.replace("SHAREAPIENDPOINT",a).replace("POSTJSON",(function(){return u})),h=n._shareIframe.nativeElement.contentDocument;h.body.innerHTML=c,h.getElementById("shareform").submit(),n.errorTimeout=setTimeout((,15e3),n.windowMessageListener=n.renderer.listen("window","message",(function(e){var r,o=e.origin;if(a.startsWith(o)){var l=JSON.parse(e.data);switch(l.name){case"share_started":var u=n.commonInstrumentationParams(),c=f.a.now();u.Latency=Math.round(c-n.startInitTime).toString(),u.ShareControlLatency=Math.round(c-s).toString(),n.instrumentationService.logGenericEvent("Share_Control_Started",u),Object(i.a)({featureName:"ShareControl",eventName:"Share_Control_Started"});break;case"share_ready":n.isLoading=!1,n.errorText=null,n.changeDetectorRef.detectChanges(),setTimeout((,0),clearTimeout(n.errorTimeout),n.instrumentImpression(s);break;case"share_resize":var h=l.width,m=l.height;0!==h&&0!==m&&(n.style.width=n.mobileShareMenu?"100%":h+"px",n.style.height=m+"px");break;case"share_dismiss":n.instrumentClick(l.name),n.handleClose();break;case"share_outlookClicked":case"share_copyLinkClicked":case"share_sendClicked":n.instrumentClick(l.name);break;case"share_error":var d=l&&l.error?l.error.toString():"error not provided",p=l&&l.errorCategory?l.errorCategory.toString():"error category not provided";t(d,p,l&&l.errorMessage?l.errorMessage:"error message not provided",l&&l.debugErrorMessage?l.debugErrorMessage:"debug error message not provided"),n.onGrantAccessComplete(!1,!1,!0);break;case"share_grantAccessCompleted":var g=l.successful;g&&n.onGrantAccessComplete&&(n.onGrantAccessComplete(g),n.grantAccessCalled=!0);break;case"share_getToken":if(!n.shareInfo.hasTokenProvider)break;try{n.tokenPromise=n.shareControlService.getToken(n.file.documentUrl,n.mruConfigService.config.shareControlCAPPopupEnabled,n.file.fileType,n.tokenType,null===(r=l.claimsChallenge)||void 0===r?void 0:r.claims),n.tokenPromise.then((function(e){if(!e.success)return t("Unable to receive token response"),void n._shareIframe.nativeElement.contentWindow.postMessage(JSON.stringify({name:"share_newToken",error:"Unable to receive token response"}),o);n._shareIframe.nativeElement.contentWindow.postMessage(JSON.stringify({name:"share_newToken",token:e.token.trim()}),o)}))}catch(e){return t("Token fetch failed"),void n._shareIframe.nativeElement.contentWindow.postMessage(JSON.stringify({name:"share_newToken",error:"Token fetch failed"}),o)}}}}))}else t("Token fetch failed")})).catch((function(e){n.globalErrorHandler.handleError(e,"oGPOu"),t("Initialization error")}))}},e.prototype.getStyleForMode=function(e){var n=this.mobileShareMenu?"100%":"320px";switch(e){case v.a.Share:return{width:n,height:"400px"};case v.a.CopyLink:return{width:n,height:"238px"};case v.a.AtMention:return{width:n,height:"405px"};default:return{width:n,height:"150px"}}},e.prototype.setCloseListeners=function(){var e=this;this.mobileShareMenu&&(this.shareControlClickListener=this.renderer.listen(this.documentService.nativeDocument,"click",(function(n){return e.handleClose(n)})),this.shareControlTouchListener=this.renderer.listen(this.documentService.nativeDocument,"touchend",(function(n){return e.handleClose(n)})),this.shareControlKeyListener=this.renderer.listen(this.documentService.nativeDocument,"keyup",())},e.prototype.getShareControlIdentifier=function(e){var n,t,r;return(null===(n=e.sharepointIds)||void 0===n?void 0:n.listId)&&(null===(t=e.sharepointIds)||void 0===t?void 0:t.listItemId)?{listId:e.sharepointIds.listId,listItemId:e.sharepointIds.listItemId}:(null===(r=e.sharepointIds)||void 0===r?void 0:r.listItemUniqueId)?{uniqueId:e.sharepointIds.listItemUniqueId,isFolder:!1}:{itemUrl:g.a.decodeUrl(e.canonicalUrl)}},e.prototype.removeCloseListeners=function(){this.shareControlClickListener&&this.shareControlClickListener(),this.shareControlTouchListener&&this.shareControlTouchListener(),this.shareControlKeyListener&&this.shareControlKeyListener(),this.documentService.enableTouchMove()},e.prototype.instrumentImpression=function(e){if(!this.loggedImpression){var n=f.a.now(),t=this.commonInstrumentationParams();t.Latency=Math.round(n-this.startInitTime).toString(),t.ShareControlLatency=Math.round(n-e).toString(),t.ImpressionId="share-control",this.instrumentationService.logImpressionEvent("Share_Control_Impression",t),Object(l.a)({eventName:"Share_Control",id:"share-control",area:this.contextService.isEdgeworth?c.b.Edgeworth:c.b.Documents}),Object(i.a)({featureName:"ShareControl",eventName:"Share_Control",params:t}),this.loggedImpression=!0}},e.prototype.instrumentClick=function(e){var n=this.commonInstrumentationParams(),t=null;"share_outlookClicked"===e&&(t=m.a.Mail),this.instrumentationService.logClickEvent("Share_Control_Click",e,this.contextService.isEdgeworth?c.b.Edgeworth:c.b.Documents,t,"Web",n),Object(s.a)({eventName:"Share_Control_Click",id:e,area:this.contextService.isEdgeworth?c.b.Edgeworth:c.b.Documents,result:t?"Refer":"Navigate",target:t?Object(u.a)(t):"Other"})},e.prototype.instrumentError=function(e,n){var t=this.commonInstrumentationParams();t.Error=e,t.ItemCategory=n,this.instrumentationService.logGenericEvent("Share_Control_Error",t),Object(a.a)({eventName:"Share_Control",message:e}),Object(i.a)({featureName:"ShareControl",eventName:"Share_Control",params:t})},e.prototype.commonInstrumentationParams=function(){var e={};e.Index=this.index.toString(),e.DocumentType=this.file.fileTypeName,e.ShareControlMode=v.a[this.mode];var n=h.a.referralFromFileLocation(this.file.url);return!n&&h.a.isConsumerDocument(this.file.url)?n="Consumer":n===m.a.OneDrive?n="OneDrive":n===m.a.SharePoint&&(n="SharePoint"),e.StorageType=n,e.FileFormat=d.a[this.file.format],e},e.iframeHtmlTemplate='<!DOCTYPE html><html><head></head><body><form id="shareform" action="SHAREAPIENDPOINT" method="post"><input type="text" name="context" value="POSTJSON" style="display: none"/></form></body></html>',e}()},"8rwQ":function(e,n,t){"use strict";t.d(n,"a",(function(){return o})),t.d(n,"b",(function(){return r}));var r=t("6wyt").a,o=)},zqZp:function(e,n,t){"use strict";t.d(n,"a",();var r=t("keVe"),o=t("TOqr"),i=t("6wyt"),l=t("OPwp"),s=t("QOOv"),a=t("cgnd"),u=t("/I02"),c=t("PBJH"),h=t("hhzZ"),m=t("lrJm"),d=t("hZW2"),f=t("JH4S"),p=r.Fb({encapsulation:2,styles:[],data:{animation:[{type:7,name:"openAndClose",definitions:[{type:1,expr:"* => open",animation:{type:10,animation:{type:8,animation:[{type:6,styles:{transform:"translate3d(0, 100%, 0)"},offset:null},{type:4,styles:{type:6,styles:{transform:"translate3d(0, 0, 0)"},offset:null},timings:"{{ slideDuration }} cubic-bezier(0.1, 0.9, 0.2, 1)"}],options:{params:{slideDuration:"300ms"}}},options:null},options:null},{type:1,expr:"open => closing",animation:{type:10,animation:{type:8,animation:[{type:6,styles:{opacity:1},offset:null},{type:4,styles:{type:6,styles:{opacity:0},offset:null},timings:"{{ fadeDuration }} 0ms linear"}],options:{params:{fadeDuration:"100ms"}}},options:null},options:null}],options:{}}]}});unction v(e){return r.jc(0,[(e()(),r.Hb(0,0,null,null,3,"div",[],null,null,null,null,null)),(e()(),r.Hb(1,0,null,null,0,"div",[["class","ms-Spinner-circle ms-Spinner--medium"]],null,null,null,null,null)),(e()(),r.Hb(2,0,null,null,1,"div",[["class","share-control__label share-control__spinner-label"],["role","status"]],null,null,null,null,null)),(e()(),r.gc(3,null,["",""]))],null,(function(e,n){e(n,3,0,n.component.loadingText)}))}function S(e){return r.jc(0,[(e()(),r.Hb(0,0,null,null,2,"div",[["role","status"]],null,null,null,null,null)),(e()(),r.Hb(1,0,null,null,1,"div",[["class","share-control__label share-control__error-label"]],null,null,null,null,null)),(e()(),r.gc(2,null,["",""]))],null,(function(e,n){e(n,2,0,n.component.errorText)}))}function b(e){return r.jc(0,[(e()(),r.Hb(0,0,[[2,0],["loadingContainer",1]],null,8,"div",[["class","officeHome-callout-main ms-bgc-w"],["tabindex","0"]],[[24,"@openAndClose",0]],null,null,null,null)),r.Gb(1,278528,null,0,o.i,[r.x,r.y,r.o,r.K],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),r.Zb(2,{"share-control--mobile":0,"share-control--content":1}),r.Gb(3,278528,null,0,o.n,[r.o,r.y,r.K],{ngStyle:[0,"ngStyle"]},null),(e()(),r.Hb(4,0,null,null,4,"div",[["class","spinner-container"]],null,null,null,null,null)),(e()(),r.qb(16777216,null,null,1,null,v)),r.Gb(6,16384,null,0,o.k,[r.W,r.S],{ngIf:[0,"ngIf"]},null),(e()(),r.qb(16777216,null,null,1,null,S)),r.Gb(8,16384,null,0,o.k,[r.W,r.S],{ngIf:[0,"ngIf"]},null)],(function(e,n){var t=n.component,r=e(n,2,0,t.mobileShareMenu,t.contentShareMenu&&!t.mobileShareMenu);e(n,1,0,"officeHome-callout-main ms-bgc-w",r),e(n,3,0,t.style),e(n,6,0,t.isLoading),e(n,8,0,t.errorText)}),()}function C(e){return r.jc(0,[(e()(),r.Hb(0,0,null,null,7,null,null,null,null,null,null,null)),(e()(),r.Hb(1,0,null,null,6,"div",[],[[4,"display",null]],null,null,null,null)),(e()(),r.Hb(2,0,null,null,0,"a",[["href","#"],["style","width:0; height:0;"]],null,[[null,"focus"]],(function(e,n,t){var r=!0;return"focus"===n&&(r=!1!==e.component.onLeavingIframeFocus()&&r),r}),null,null)),(e()(),r.Hb(3,0,[[1,0],["shareIframe",1]],null,3,"iframe",[["class","officeHome-callout-main share-iframe"]],[[1,"aria-label",0]],null,null,null,null)),r.Gb(4,278528,null,0,o.i,[r.x,r.y,r.o,r.K],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),r.Zb(5,{"share-control--mobile":0,"share-control--content":1}),r.Gb(6,278528,null,0,o.n,[r.o,r.y,r.K],{ngStyle:[0,"ngStyle"]},null),(e()(),r.Hb(7,0,null,null,0,"a",[["href","#"],["style","width:0; height:0;"]],null,[[null,"focus"]],(,null,null))],(function(e,n){var t=n.component,r=e(n,5,0,t.mobileShareMenu,t.contentShareMenu&&!t.mobileShareMenu);e(n,4,0,"officeHome-callout-main share-iframe",r),e(n,6,0,t.style)}),(function(e,n){var t=n.component;e(n,1,0,t.isLoading||t.errorText?"none":""),e(n,3,0,t.titleAriaLabel)}))}function y(e){return r.jc(0,[(e()(),r.Hb(0,0,null,null,8,"div",[],null,null,null,null,null)),r.Gb(1,278528,null,0,o.i,[r.x,r.y,r.o,r.K],{ngClass:[0,"ngClass"]},null),r.Zb(2,{"page-overlay":0}),(e()(),r.qb(16777216,null,null,1,null,g)),r.Gb(4,16384,null,0,o.k,[r.W,r.S],{ngIf:[0,"ngIf"]},null),(e()(),r.qb(16777216,null,null,1,null,b)),r.Gb(6,16384,null,0,o.k,[r.W,r.S],{ngIf:[0,"ngIf"]},null),(e()(),r.qb(16777216,null,null,1,null,C)),r.Gb(8,16384,null,0,o.k,[r.W,r.S],{ngIf:[0,"ngIf"]},null)],(function(e,n){var t=n.component,r=e(n,2,0,t.contentShareMenu);e(n,1,0,r),e(n,4,0,(t.mobileShareMenu||t.contentShareMenu)&&t.isComponentReady()),e(n,6,0,t.isLoading||t.errorText),e(n,8,0,t.isComponentReady())}),null)}function I(e){return r.jc(0,[r.cc(671088640,1,{shareIframe:0}),r.cc(671088640,2,{loadingContainer:0}),(e()(),r.qb(16777216,null,null,1,null,y)),r.Gb(3,16384,null,0,o.k,[r.W,r.S],{ngIf:[0,"ngIf"]},null)],(function(e,n){var t=n.component;e(n,3,0,t.isComponentReady()||t.isLoading||t.errorText)}),null)}var k=r.Db("ohp-share",i.a,(function(e){return r.jc(0,[(e()(),r.Hb(0,0,null,null,1,"ohp-share",[],null,null,null,I,p)),r.Gb(1,4440064,null,0,i.a,[l.b,s.a,a.b,u.a,a.b,c.a,h.a,r.K,m.b,d.a,f.a,r.h],null,null)],(,null)}),{file:"file",index:"index",mode:"mode",nav:"nav",defaultRecipients:"defaultRecipients",mobileShareMenu:"mobileShareMenu",contentShareMenu:"contentShareMenu",onGrantAccessComplete:"onGrantAccessComplete"},{dismiss:"dismiss"},[])}}]);
//# sourceMappingURL=fl-cnt~share-control.e0d38b7a71eb27d78fd0.chunk.v7.js.map