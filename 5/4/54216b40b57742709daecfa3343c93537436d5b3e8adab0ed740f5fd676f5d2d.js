/*! For license information please see redgalaxy-player.core-2.39.0.min.js.LICENSE.txt */
(()=>{var e={7061:8698:4687:,t={};.n=n.d=n.o=n.r=(()=>{"use strict";var e={};LEARKEY:()=>va,FAIRPLAY:()=>ya,PLAYREADY:()=>ba,WIDEVINE:);var v=n(4687),y=n.n(v),b=navigator.userAgent,T=const E={isMobile:isAndroid:function(){return T(/Android/i)},isIOS:function(){return T(/iPhone|iPad|iPod/i)},isMobileOpera:function(){return T(/Opera Mini/i)},isMobileWindows:function(){return T(/IEMobile/i)},isFirefox:isOpera:function(){return!!window.opera||b.indexOf("OPR/")>=0},isSafari:isSafariWithSiteSpecificHacks:function(){return!this.isSafari()&&(/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString())},isTizen:getFirefoxVersion:function(){var e=b.indexOf("Firefox");return parseFloat(b.substring(e+8))},isWidevineSupported:function(){return(!this.isFirefox()||!(this.getFirefoxVersion()<47||-1!==b.indexOf("Windows NT 5.1")))&&(!(-1!==b.toLowerCase().indexOf("linux")&&this.getFirefoxVersion()<47)&&!!navigator.requestMediaKeySystemAccess)},getLanguage:function(){return void 0!==navigator.language?navigator.language:void 0!==navigator.languages?navigator.languages[0].split("-")[0]:null}};var S=function(){eturn d(e,[{key:"on",value:function(e,t){this.callbacks=this.callbacks||{},this.callbacks.hasOwnProperty(e)||(this.callbacks[e]=[]),this.callbacks[e].push(t)}},{key:"once",value:function(e,t){this.on(e,(function n(){var r=Array.prototype.slice.call(arguments);this.off(e,n),t.apply(this,r)}))}},{key:"off",value:function(e,t){if(this.callbacks=this.callbacks||{},null!=e&&""!==e)if(t){if(this.callbacks[e]&&this.callbacks[e].length)for(var n;-1!==(n=this.callbacks[e].indexOf(t));)this.callbacks[e].splice(n,1)}else delete this.callbacks[e];else this.callbacks={}}},{key:"trigger",value:function(e){var t,n=Array.prototype.slice.call(arguments);if(this.callbacks=this.callbacks||{},n.shift(),this.callbacks.hasOwnProperty(e)){t=this.callbacks[e].slice();for(var r=0;r<t.length;r++)t[r].apply(this,n)}}}]),e}();function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}var w=S),D="resize",O="visibilitychange",A="acquiringLicense",L="audioTrackChanged",P="audioTracks",R="canplay",I="destroy",C="error",x="encrypted",M="ended",_="fullscreenChanged",N="headTime",B="initialized",F="licenseAcquired",j="manifestLoaded",U="manifestUpdated",V="manifestUpdateError",H="nativeTextTracksListAddTrack",W="metadata",Y="monitor",G="networkMetric",K="newMedia",q="live",z="source",Q="paused",X="period",$="periodChanging",Z="periodUpdated",J="playing",ee="playInterrupted",te="playPromiseResolved",ne="playRequest",re="profileChangeRequest",ie="profileChanged",ae="profileChanging",oe="profiles",se="ready",ue="reconnect",ce="seekRequest",le="seekToRequest",de="seeked",fe="seeking",he="started",ge="stopped",me="stopRequest",pe="streamEvent",ve="time",ye="visibilitychange",be="volumeChangeRequest",Te="waiting",Ee="waitingEnd";const Se={DRM_GENERATE_LICENSE_CHALLENGE_FAILED:"drm.generate.license.challenge.failed",DRM_LOAD_LICENSE_CHALLENGE_FAILED:"drm.load.license.challenge.failed",DRM_GENERATE_MEDIA_KEYS_FAILED:"drm.generate.media.keys.failed",DRM_SESSION_UPDATE_FAILED:"drm.session.update.failed",DRM_LOAD_CERTIFICATE_FAILED:"drm.load.certificate.failed",DRM_LOAD_LICENSE_KEY_FAILED:"drm.load.license.key.failed",DRM_NO_KEY_PROVIDED:"drm.no.key.provided",DRM_SESSION_KEY_ERROR:"drm.session.key.error",GENERIC_ERROR:"generic.error",LICENSE_RESPONSE_REJECTED:"license.response.rejected",LOAD_MANIFEST_ERROR:"load.manifest.error",LOAD_SEGMENT_ERROR:"load.segment.error",MEDIA_ERR_ABORTED:"media.err.aborted",MEDIA_ERR_DECODE:"media.err.decode",MEDIA_ERR_NETWORK:"media.err.network",MEDIA_ERR_SRC_NOT_SUPPORTED:"media.err.src.not.supported",NO_SUPPORTED_RENDERER:"no.supported.renderer",NO_SUPPORTED_CODEC:"no.supported.codec",NOT_SECURE_CONTEXT:"drm.not.secure.context.error",PARSE_MANIFEST_ERROR:"parse.manifest.error",PLAYBACK_ERROR:"playback.error"};ar we;const De=(ke(we={},Se.NO_SUPPORTED_RENDERER,200),ke(we,Se.NO_SUPPORTED_CODEC,201),ke(we,Se.PLAYBACK_ERROR,204),ke(we,Se.MEDIA_ERR_ABORTED,205),ke(we,Se.MEDIA_ERR_DECODE,206),ke(we,Se.MEDIA_ERR_NETWORK,207),ke(we,Se.MEDIA_ERR_SRC_NOT_SUPPORTED,208),ke(we,Se.LOAD_MANIFEST_ERROR,400),ke(we,Se.LOAD_SEGMENT_ERROR,401),ke(we,Se.PARSE_MANIFEST_ERROR,500),ke(we,Se.GENERIC_ERROR,900),we);var Oe="playback-start",Ae="autoAdaptation",Le="resolution",Pe="allowFastSwitch",Re="allowUpwardSwitchAfter",Ie="minimumBandwidthSurplusToSwitchUpward",Ce="minimumBandwidthSurplusToFastSwitchUpward",xe="bufferLength",Me="preventOverrideDefaultBitrateOnStart",_e="switchInterval",Ne="autoplay",Be="bufferBehind",Fe="cacheDrmSessionByKeyId",je="clearVideoSourceOnRemove",Ue="considerDroppedFrames",Ve="createSegmentsOnTheFly",He="cssPrefix",We="defaultAudioLanguage",Ye="defaultBitrate",Ge="defaultLiveDelay",Ke="disableCheckingDecodedFramesCount",qe="disableNativeControls",ze="disableVideoLoadOnDestroy",Qe="drm",Xe="drmConfig",$e="drmSystems",Ze="fairplayContentType",Je="fastSwitchSafeMargin",et="fastSwitchMinTime",tt="file",nt="files",rt="fixAppleSiteSpecificHacks",it="guardLivePosition",at="guardTimeShiftSafeSeek",ot="httpConfig",st="immediatelySwitch",ut="lastBitrateCaching",ct="live",lt="liveDelay",dt="maxAutoBitrate",ft="maxBufferLength",ht="minAutoBitrate",gt="minBufferTime",mt="minLiveDelay",pt="minimumUpdatePeriodEnabled",vt="modules",yt="name",bt="playsInline",Tt="poster",Et="prefetchHlsPlaylist",St="preventStreamEventsForPartiallyPlayedPeriods",kt="resolveRedirects",wt="seekPrecision",Dt="sessionHistory",Ot="smartTV",At="startBufferLength",Lt="startTime",Pt="periodObserverInterval",Rt="streamWithCredentials",It="timeShift",Ct="timeShiftEnabled",xt="timeShiftParams",Mt="useDownlinkBitrate",_t="UTCTimeServer",Nt="UTCTimeServerUpdateInterval",Bt="volume",Ft="volumeLocalStorageEnabled",jt="volumeLocalStorageKey",Ut="volumeMuted",Vt="volumeMutedLocalStorageKey",Ht="manifest-manager",Wt="media-element",Yt="media-source",Gt="stream-manager",Kt="video-wrapper";const qt=function(e,t,n){return t.slice().sort((function(e,t){return e.priority-t.priority})).reduce((function(t,r){return Object.entries(e).forEach((function(e){var a=i(e,2),o=a[0],s=i(a[1],1)[0].src;Object.entries(r.mediaTypes).forEach((function(e){var a=i(e,2),u=a[0],c=a[1],l=r.canPlayType(c,n);o.toUpperCase()===u&&l&&t.push({url:s,renderer:r,mimeType:c,mediaType:u})}))})),t}),[])};unction Qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qt(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $t,Zt={VIDEO:'video/mp4; codecs="avc1.42E01E"'},Jt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps.1_0",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},en={L1:"HW_SECURE_ALL",L3:"SW_SECURE_CRYPTO"},tn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=["cenc"],i="required",a=["persistent-license"],o=e.reduce((function(e,n){var r=n.contentType,i=n.type;return Xt(Xt({},e),{},ke({},"".concat(i,"Capabilities"),[{contentType:r,robustness:t["".concat(i,"Robustness")]||""}]))}),{});return n?[Xt({initDataTypes:r,persistentState:i,sessionTypes:a},o)]:[Xt({initDataTypes:r},o)]},nn=function(e,t){return navigator.requestMediaKeySystemAccess(e,t)},rn=function(){var e=o(y().mark((function e(){var t,n,r,a=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:Zt,n=[Jt.WIDEVINE,Jt.PLAYREADY,Jt.FAIRPLAY].reduce((function(e,n){return[].concat(zt(e),zt(Object.entries(t).flatMap((function(e){var t=i(e,2),r=t[0],a=t[1];return Object.entries(en).flatMap((function(e){var t=i(e,2),o=t[0],s=t[1],u=tn([{contentType:a,type:r.toLowerCase()}],ke({},"".concat(r.toLowerCase(),"Robustness"),s));return nn(n,u).then(().catch((function(){}))}))}))))}),[]),e.next=5,Promise.all(n);case 5:return r=e.sent,e.abrupt("return",Promise.resolve(r.filter(Boolean)));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),an="fullscreenchange",on="fullscreenElement",sn=E.isIOS(),un=[["exitFullscreen","requestFullscreen",on,"fullscreenEnabled",an,"fullscreenerror"],["webkitExitFullscreen","webkitRequestFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitCancelFullScreen","webkitRequestFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozCancelFullScreen","mozRequestFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msExitFullscreen","msRequestFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],cn="webkitbeginfullscreen",ln="webkitendfullscreen",dn=function(e,t){if(sn){var n=fn(e),r=function(e){e.target===n&&t(!0)},i=return n.addEventListener(cn,r),n.addEventListener(ln,i),function(){n.removeEventListener(cn,r),n.removeEventListener(ln,i)}}var a=return document.addEventListener(gn[an],a),,fn=function(e){return"VIDEO"!==e.tagName?e.querySelector("video"):e},hn=function(e){return sn&&e?!!fn(e).webkitDisplayingFullscreen:gn?!!document[gn[on]]:void 0},gn=function(){for(var e,t=null,n=0;n<un.length;n++)if(un[n][0]in document){e=un[n];break}if(e){t={};for(var r=0;r<e.length;r++)t[un[0][r]]=e[r]}return t}(),mn={ALL:"all",DEBUG:"debug",ERROR:"error",INFO:"info",TRACE:"trace",WARN:"warn"},pn={CALLBACK_FUNCTION:"callback-function",CONSOLE:"console"},vn=(ke($t={},mn.DEBUG,"1"),ke($t,mn.ERROR,"1"),ke($t,mn.INFO,"1"),ke($t,mn.WARN,"1"),ke($t,mn.TRACE,"0.5"),$t),yn={"video-stream":"#109fff","audio-stream":"#33a700",manifest:"#ba0037",period:"#f3750f","playback-start":"#5d0d0d"},bn=function(){return""},Tn=function(){function e(t,n){u(this,e),this.callbackFunction=bn,this.color=n,this.enabledLevels=[],this.initTime=Date.now(),this.label=t,this.output=pn.CONSOLE}return d(e,[{key:"setLevel",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null==n||n.forEach(()}},{key:"setOutput",value:function(e){this.output=e}},{key:"setCallbackFunction",value:,{key:"removeLevel",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null==n||n.forEach(()}},{key:"debug",value:function(e){this._print("log",e,mn.DEBUG)}},{key:"info",value:function(e){this._print("log",e,mn.INFO)}},{key:"trace",value:function(e){this._print("log",e,mn.TRACE)}},{key:"warn",value:function(e){this._print("warn",e,mn.WARN)}},{key:"error",value:,{key:"_print",value:function(e,t,n){if(this.isEnabled(n))if(this.output!==pn.CALLBACK_FUNCTION){var r,i,a,o,s,u,c=this.color||yn[this.label]||"#f0f",l=(r=vn[n],i=c.replace("#",""),a=6===i.length,o=parseInt(a?i.slice(0,2):i.slice(0,1),16),s=parseInt(a?i.slice(2,4):i.slice(1,2),16),u=parseInt(a?i.slice(4,6):i.slice(2,3),16),"rgba(".concat(o,",").concat(s,",").concat(u,",").concat(r,")"));console[e]("%c".concat(this.label),"background: ".concat(l,"; color: #fff; padding: 1px 2px"),t)}else{var d=((Date.now()-this.initTime)/1e3).toFixed(4);this.callbackFunction(this.label,parseFloat(d),n,t)}}},{key:"isEnabled",value:function(e){return this.enabledLevels.includes(e)||this.enabledLevels.includes(mn.ALL)}}]),e}(),En=function(){function e(){u(this,e),this.initTime=null,this.loggers=[],this.defaultCallbackFunction=bn,this.defaultOutput=pn.CONSOLE,this.Level=mn,this.Output=pn}return d(e,[{key:"get",value:,{key:"initSession",value:,{key:"destroySession",value:,{key:"setDefaultOutput",value:function(e){this.defaultOutput=e,this.loggers.forEach((function(t){t.output=e}))}},{key:"setDefaultCallbackFunction",value:function(e){this.defaultCallbackFunction=e,this.loggers.forEach((function(t){t.callbackFunction=e}))}},{key:"getLabels",value:,{key:"_create",value:function(e,t){var n=new Tn(e,t);return n.setOutput(this.defaultOutput),n.setCallbackFunction(this.defaultCallbackFunction),n.initTime=this.initTime||Date.now(),this.loggers.push(n),n}},{key:"_find",value:]),e}(),Sn=new En;Object.assign(Sn,mn);const kn=Sn;unction Dn(e){var t,n=this;this.promise=new Promise((function(e){return t=e})),e(()}Dn.source=function(){var e,t=new Dn((function(t){return e=t}));return{cancel:e,token:t}};const On=Dn;var An="aborted",Ln="failed",Pn="progress",Rn="success",In="xml",Cn="document",xn="arraybuffer";function Mn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mn(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nn={responseType:"text",method:"GET",retryAttempts:3,retryDelay:1e3,timeout:8e3,withCredentials:!1,cancelToken:null},Bn={get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.responseType===In&&(t.responseType=Cn),Fn(e,_n({},t))},getBinary:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fn(e,_n({responseType:xn},t))},head:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fn(e,_n({method:"HEAD"},t))},post:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fn(e,_n({method:"POST"},t))},put:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fn(e,_n({method:"PUT"},t))},del:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fn(e,_n({method:"DELETE"},t))}};function Fn(e,t){var n,r,a=Date.now(),o=!1,s=1;return new Promise((function(u,c){var l=_n(_n({},Nn),t),d=l||{},f=d.cancelToken,h=d.headers,g=void 0===h?{}:h,m=d.method,p=d.onProgress,v=d.params,y=d.responseType,b=d.retryAttempts,T=d.retryDelay,E=d.withCredentials;f&&f.promise.then((function(){return O()}));var S=function(e,t){if(!t||0===Object.keys(t).length)return e;var n=Object.entries(t).map(().join("&"),r=e.includes("?")?"&":"?";return"".concat(e).concat(r).concat(n)}(e,v),k=function(){n=new XMLHttpRequest,E&&(n.withCredentials=!0),n.open(m,S),n.responseType=y,y===In&&n.overrideMimeType("text/xml"),Object.entries(g).forEach((),p&&(n.onprogress=function(e){return w(e)}),n.onreadystatechange=function(){return D()},n.send(l.data||null)},w=function(e){var t=Date.now(),n={bps:Math.round(e.loaded/((t-a)/1e3)*8),event:e,timestamp:t,loaded:e.loaded,started:a,status:Pn};p(n)},D=function(){if(4===n.readyState){var e=Date.now(),t=e-a,i={duration:t,timestamp:e,url:S,statusCode:n.status,status:Rn};if(200===n.status){var d=function(e,t){switch(t.responseType){case In:case Cn:return e.responseXML;case xn:return new Uint8Array(e.response);default:return e.responseText}}(n,l);i.bps=Math.round(d.length/(t/1e3)*8),u({metric:i,data:d,url:S,status:Rn,responseUrl:n.responseURL,xhr:n})}else o?(i.status=An,c({error:An,metric:i,xhr:n})):s>b?(i.status=Ln,c({error:Ln,metric:i,xhr:n})):(s++,i.status="retry",r=setTimeout(k,T),p&&p(i))}},O=function(){o=!0,clearTimeout(r),n.abort(),c(An)};k()}))}Bn.CancelToken=On;const jn=Bn;const Un=function(){var e=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g;function t(e,t){for(var n=""+Math.abs(e),r=t||2;n.length<r;)n="0"+n;return n}return{format:function(n,r){for(var i=r||"YYYY-MM-DD HH:mm:ss",a=new Date(n),o=i.match(e),s=[],u=0,c=o.length;u<c;u++){var l=o[u];switch(l){case"YYYY":s.push(a.getFullYear());break;case"YY":s.push(a.getFullYear()%100);break;case"MM":case"M":s.push(t(a.getMonth()+1));break;case"DD":case"D":s.push(t(a.getDate()));break;case"HH":case"H":s.push(t(a.getHours()));break;case"mm":case"m":s.push(t(a.getMinutes()));break;case"ss":case"s":s.push(t(a.getSeconds()));break;case"ms":s.push(a.getMilliseconds);break;default:s.push(l)}}return s.join("")}}}();var Vn={VERSION:"2.39.0",BUILD:"2023-09-04 11:31:02",ROOT_URL:"//r.dcs.redcdn.pl/file/o2/web/player/redcdn/",REVISION:"acb0475"};Vn.INFO="version: ".concat(Vn.VERSION,", build: ").concat(Vn.BUILD,", revision: ").concat(Vn.REVISION);const Hn=Vn;var Wn={extend:extendDeep:function(e,t){var n;for(n in e=e||{},t)t.hasOwnProperty(n)&&("object"===s(t[n])&&null!==t[n]?(e[n]="[object Array]"===Object.prototype.toString.call(t[n])?[]:{},this.extendDeep(e[n],t[n])):e[n]=t[n]);return e},generateRandomString:function(e){var t,n="",r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(t=0;t<e;t++)n+=r.charAt(Math.floor(Math.random()*r.length));return n},formatTime:function(e){isNaN(e)&&(e=0);var t=Math.floor(e/3600),n=Math.floor(e/60)%60,r=Math.floor(e)%60;return(t?Wn.addLeadingZero(t)+":":"")+Wn.addLeadingZero(n)+":"+this.addLeadingZero(r)},formatDateTime:addLeadingZero:parseTime:function(e){for(var t=e.split(":"),n=0,r=2;t.length>0;)n+=Math.pow(60,r)*parseInt(t.shift(),10),r--;return n},isDST:function(e){var t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1);return Math.min(t.getTimezoneOffset(),n.getTimezoneOffset())===e.getTimezoneOffset()},parseDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0:0:0",n=e.split("-");n[1]--;var r=t.split(":"),a=i(r,3),o=a[0],s=a[1],u=a[2],c=Wn.isDST(new Date(n[0],n[1],n[2],parseInt(o),parseInt(s),parseInt(u))),l=new Date(new Date(n[0],n[1],n[2]).getTime()).getTimezoneOffset()+(c?120:60);return l*=60,new Date(n[0],n[1],n[2]).getTime()/1e3-l},calculateBaseTime:function(e){var t=e.split(" ");return Wn.parseDate(t[0],t[1])+Wn.parseTime(t[1])},parseDateTime:function(e){var t,n=0,r=e.split(/([\+\-Z])(.{2,9})?$/),a=/Z$/.test(e),o=r.length<=1,s=r[0].split(/[T\s]/),u=i(s[0].split("-"),3),c=u[0],l=u[1],d=u[2],f=i(s[1].split(":"),3),h=f[0],g=f[1],m=f[2],p=Wn.isDST(new Date(c,l-1,d,h,g,m));return a||o||(n=-1*+(r[1]+(3600*(t=r[2].split(/[:.]/))[0]+60*t[1]))),n+=60*(p?120:60),this.calculateBaseTime(s[0]+" "+s[1])+(o?0:n)},getCssUrl:function(e){var t=e.name,n=void 0===t?"default":t,r=e.url,i="".concat(Hn.ROOT_URL).concat(Hn.VERSION,"/css/");return r||"".concat(i).concat(n,".css")},loadSkin:loadCss:function(e){var t=document.createElement("link"),n=zt(document.querySelectorAll("link")).find(();return n?Promise.resolve():new Promise((function(n,r){t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.querySelector("head").appendChild(t),t.onload=function(){return n()},t.onerror=))},getBrowserLanguage:function(){var e,t,n,r=(null===(e=navigator)||void 0===e?void 0:e.language)||(null===(t=navigator)||void 0===t||null===(n=t.languages)||void 0===n?void 0:n[0]);return null==r?void 0:r.split("-")[0]}};const Yn=Wn;function Gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gn(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qn(e){var t="mediaItem_"+Yn.generateRandomString(16),n=void 0,r=void 0,a=void 0,o=void 0,s=void 0,u=void 0,c=void 0;function l(e){var t,n,a;null===(t=r=e&&Object.entries(e).reduce((function(e,t){var n=i(t,2),r=n[0],a=n[1];return Kn(Kn({},e),{},ke({},r.toLowerCase(),"string"==typeof a?{src:a}:a))}),{}))||void 0===t||null===(n=t.widevine)||void 0===n||null===(a=n.multikey)||void 0===a||a.sort((function(e,t){return e.securityLevel===t.securityLevel?e.maxHeight-t.maxHeight:e.securityLevel<t.securityLevel?1:-1}))}unction f(e){a=e}function h(e){o=e}function g(e){s=e}function m(e){u=e}eturn void 0!==e&&function(e){var t=e.drm,n=e.rating,r=e.sources,i=e.splashscreen,a=e.stripe,o=e.subtitles,s=e.thumbnail;d(r),h(a),f(o),m(s),g(i),p(n),l(t)}(e),e=e={},{getByKey:function(t){return e[t]},getId:function(){return t},getDrm:function(){return r},setDrm:l,getSource:function(){return n},setSource:d,getStripe:function(){return o},getSubtitles:function(){return a},setThumbnail:m,getThumbnail:function(){return u},getSplashscreen:function(){return s},setSplashscreen:g,getRating:function(){return c},setRating:p}}function zn(e){var t=e.options,n=[],r={};return{fetch:function(){var e=t.get(tt),i=t.get("playlist")||t.get(nt);return e?function(e){var i=new qn,a={};if(n=[],r={},"string"==typeof e){var o="mp4";-1!==e.indexOf("#")&&(o=e.split("#")[1]),a[o]=[{src:e}]}else for(var s in e)e.hasOwnProperty(s)&&(a[s]=[{src:e[s]}]);return i.setSource(a),i.setDrm(t.get(Qe)),n.push(i),r[i.getId()]=i,Promise.resolve()}(e):i?function(e){if(n=[],r={},"object"===s(e)){if(Array.isArray(e))for(var i=0;i<e.length;i++)n.push(e[i]);else n.push(e);return Promise.resolve()}var a=(t.get(ot)||{}).playlist,o=void 0===a?{}:a,u=o.headers,c=o.params,l=o.withCredentials;return jn.get(e,{headers:u,params:c,withCredentials:!!l}).then((function(e){var t=JSON.parse(e.data);if(Array.isArray(t))n=t.map((function(e){var t=new qn(e);return r[t.getId()]=t,t}));else{var i=new qn(t);r[i.getId()]=i,n.push(i)}}))}(i):Promise.reject()},list:function(){return n},first:getById:function(e){return r[e]}}}var Qn,Xn=function(e,t){for(var n=!e.startsWith("http"),r=n?"https://".concat(e):e,i=new URL(r),a=i.searchParams,o=i.hash,s=arguments.length,u=new Array(s>2?s-2:0),c=2;c<s;c++)u[c-2]=arguments[c];var l=u[0];i.hash="",a.has(l)&&a.delete(l);var d=i.search.substring(1),f=[d];zt(a.keys()).forEach((function(e){return a.delete(e)})),a[t].apply(a,u);var h=a.has(l)&&a.get(l);h&&(a.delete(l),f.push("".concat(l,"=").concat(h)));var g=i.toString().replace(n?i.protocol:"",""),m=f.filter(Boolean).join("&");return m=m?"?".concat(m):"","".concat(g).concat(m).concat(o)},$n=Zn="urn:mpeg:dash:utc:direct:2014",Jn="urn:mpeg:dash:utc:http-head:2014",er="urn:mpeg:dash:utc:http-iso:2014",tr=function(e,t){return jn.get(e.replace("http://","//"),{cancelToken:new jn.CancelToken((function(e){return Qn=e}))}).then((function(e){var t=e.data;return new Date(t).getTime()||Date.now()})).catch((function(e){return e.error===An?Promise.reject(e):Date.now()}))},nr=rr=0;function ir(e){var t,n=e.options,r=1e3*n.get(Nt),i=n.get(_t).replace("http:","");function a(){return s.apply(this,arguments)}function s(){return s=o(y().mark((function e(){var n,o,s,u,c,l,d=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=d.length>0&&void 0!==d[0]?d[0]:{},s=o.schemeIdUri,u=o.value,ke(n={},Zn,nr),ke(n,Jn,tr),ke(n,er,tr),!(c=n)[s]){e.next=8;break}return e.next=5,c[s](u);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,tr(i);case 10:e.t0=e.sent;case 11:return l=e.t0,rr=Date.now()-l,r>0&&s!==Zn&&(t=setTimeout((,r)),e.abrupt("return",ir.getTime());case 15:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function u(){return u=o(y().mark((function e(){var t,n,r,i,a=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},n=t.schemeIdUri,r=t.value,n!==Zn){e.next=6;break}return e.next=4,nr(r);case 4:i=e.sent,rr=Date.now()-i;case 6:return e.abrupt("return",ir.getTime());case 7:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}return{sync:a,syncDirect:function(){return u.apply(this,arguments)},stop:function(){var e;clearTimeout(t),null===(e=Qn)||void 0===e||e(),Qn=void 0},getTime:function(){return ir.getTime()}}}ir.getTime=const ar=ir;var or="live",sr="liveDelayed",ur="vod",cr="vodShifted";const lr=function(e){var t;e.on(B,m),e.on("styles",m),e.on(j,(function(e){d=e.availabilityStartTime||0,e.presentationTimeOffset||(f=d)})),e.once(W,();var n=e.options,r=k(),i=null,a=!1,o=-1,s=-1,u=-1,c=-1,l=-1,d=0,f=978307200,h=null===(t=r)||void 0===t?void 0:t.unixTimestamp,g=n.get(xt);function m(){r=k(),e.options.get(Ct)&&(i=or),r&&(void 0!==r.baseTimeStamp&&(f=r.baseTimeStamp),r.dvrWindow&&(a=!0,s=r.dvrWindow),r.start&&(o=Yn.parseDateTime(r.start)),r.play&&(l=Yn.parseDateTime(r.play)),r.start&&r.stop&&(c=Yn.parseDateTime(r.stop),l&&n.set(Lt,Math.floor(l-o))),null===i&&(i=or,r.play&&(i=sr),r.start&&r.stop&&(i=ur)),setTimeout(e.trigger.bind(e,"timeShift"),0))}function p(){return i===or||i===sr}unction y(){return f}function b(){return Math.min(s,S()-o)}function T(){return l}ction w(){var e=S(),t=b();return a&&t>0&&e>0?e-t:o}return h&&(f=0),{update:m,getStart:w,getInitialStart:function(){return u},getPlayStart:T,getStop:E,isLive:p,isVod:getDvrWindow:b,getInitialDvrWindow:function(){return s},getMode:function(){return i},isEnabled:v,generateUrl:function(e){if(g.disableUrlModification)return e;var t=h?1:1e3,n=(h?0:y())*t,r=w()*t-n,a=E()*t-n,o=T()*t-n;return e.endsWith("&")&&(e=e.slice(0,-1)),p()&&r>0&&s<=0&&(e=$n(e,g.startTime,r)),s>0&&(e=$n(e,g.dvr,1e3*s)),i!==ur&&i!==cr||(e=$n(e,g.startTime,r),e=$n(e,g.stopTime,a)),i!==sr||s||(e=$n(e,g.startTime,o)),e},setDvrWindow:function(e){v()&&(a=!0,s=e)},getBaseTimeStamp:y,getAvailabilityStartTime:function(){return d},setAvailabilityStartTime:function(e){d=e},setMode:function(e){i=e},reset:function(){i===sr&&(i=or),i===cr&&(i=ur)},isVodEnded:getLiveNowUTC:S,getHeadTime:function(){return S},setLive:setPlay:function(e){l=e}}};var dr,fr;function hr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hr(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var mr=(ke(fr={},"advertLabel","REKLAMA: "),ke(fr,Ae,(ke(dr={},Re,0),ke(dr,Pe,!0),ke(dr,"droppedFrames",!1),ke(dr,Le,!1),ke(dr,xe,0),ke(dr,_e,5),ke(dr,Ie,25),ke(dr,Ce,60),ke(dr,Me,!1),dr)),ke(fr,"autofocus",!0),ke(fr,Ne,!0),ke(fr,"autoplayBlockedRule","resume"),ke(fr,Be,30),ke(fr,"bufferTime",2),ke(fr,Fe,!0),ke(fr,Ue,!1),ke(fr,"controlsLayout","classic"),ke(fr,Ve,!1),ke(fr,He,"rgpl"),ke(fr,"controls","default"),ke(fr,"customTtmlParser",null),ke(fr,"debug",!1),ke(fr,We,null),ke(fr,Ye,null),ke(fr,"defaultGuiLanguage","pl"),ke(fr,Ge,15),ke(fr,Ke,!1),ke(fr,qe,!0),ke(fr,ze,!1),ke(fr,Qe,null),ke(fr,Xe,{}),ke(fr,$e,void 0),ke(fr,"extra",{}),ke(fr,Ze,"application/octet-stream"),ke(fr,Je,0),ke(fr,et,5),ke(fr,tt,void 0),ke(fr,nt,void 0),ke(fr,rt,!1),ke(fr,"fullscreen",!0),ke(fr,"gstream",void 0),ke(fr,it,!0),ke(fr,at,.25),ke(fr,"height",400),ke(fr,"hideControls",!0),ke(fr,"holder",null),ke(fr,ot,{}),ke(fr,st,!0),ke(fr,"keyboardEvents",!1),ke(fr,ut,!1),ke(fr,ct,!1),ke(fr,lt,0),ke(fr,"layout",void 0),ke(fr,dt,null),ke(fr,ft,20),ke(fr,ht,null),ke(fr,gt,null),ke(fr,mt,0),ke(fr,pt,!0),ke(fr,vt,[]),ke(fr,yt,void 0),ke(fr,"pauseOnVideoClick",!0),ke(fr,"persistentLicense",!1),ke(fr,"playbackRates",[.25,.5,1,1.5,2]),ke(fr,bt,!1),ke(fr,Tt,void 0),ke(fr,Et,!1),ke(fr,St,!1),ke(fr,"reconnect",!1),ke(fr,"rendererPriority",["dash","html5"]),ke(fr,kt,!0),ke(fr,"rootUrl",null),ke(fr,"seekChangeStep",10),ke(fr,wt,"time"),ke(fr,"settings",["profile","audio","subtitle","playbackRate"]),ke(fr,"showButtonsOverVideo",!0),ke(fr,"showButtonsOverVideoOnHover",!0),ke(fr,"showJumpButtonsOverVideo",!0),ke(fr,"showPauseButtonOverVideo",!0),ke(fr,"showSpinnerTimeout",700),ke(fr,"skin",{name:"default",url:null}),ke(fr,Ot,!1),ke(fr,At,0),ke(fr,Lt,0),ke(fr,Pt,500),ke(fr,Rt,!1),ke(fr,Ct,!1),ke(fr,xt,{dvr:"dvr",startTime:"startTime",stopTime:"stopTime"}),ke(fr,"tooltips",!0),ke(fr,Mt,!1),ke(fr,_t,"//r.dcs.redcdn.pl/utc"),ke(fr,Nt,60),ke(fr,It,null),ke(fr,Bt,void 0),ke(fr,"volumeChangeStep",5),ke(fr,Ft,!0),ke(fr,jt,"redgalaxy-player-volume"),ke(fr,Ut,void 0),ke(fr,Vt,"redgalaxy-player-volume-muted"),ke(fr,"volumeType","horizontal"),ke(fr,"width",600),fr),pr=function(){function e(){u(this,e),this.options=Yn.extendDeep({},mr),this.options.name=this.options.name||Yn.generateRandomString(10)}return d(e,[{key:"get",value:,{key:"set",value:function(e,t){this.options[e]=t}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!1!==e[Ae]&&(e[Ae]=gr(gr({},mr[Ae]),e[Ae])),this.options=gr(gr({},this.options),e),this.options.name="player_renderer_".concat(Yn.generateRandomString(10)),this.options.deviceControls=!1,E.isMobile()&&(this.options.autoplay=!0),this.options}},{key:"getWidthWithUnit",value:function(){return vr(this.options.width)}},{key:"getHeightWithUnit",value:]),e}();function vr(e,t){var n=e.toString().replace(/\d+/g,"");return n.length||(n=t||"px"),parseInt(e,10)+n}var yr="100%";const br=function(e,t){var n=document.querySelector("#".concat(e)),r=t.get(He),i={},a=n.querySelector(".".concat(r,"-container"));a&&n.removeChild(a);var o=document.createElement("div"),s=document.createElement("div"),u=document.createElement("div");if(n)return n.appendChild(o),o.appendChild(s),o.appendChild(u),n.classList.add(r),o.classList.add("".concat(r,"-container")),s.classList.add("".concat(r,"-renderers")),u.classList.add("".concat(r,"-gui-container")),E.isMobile()&&o.classList.add("".concat(r,"-container--mobile")),o.style.background="#000",o.style.width=yr,o.style.height=yr,s.style.width=yr,s.style.height=yr,c(),{addRenderer:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&(s.innerHTML=""),e.setAttribute("width",yr),e.setAttribute("height",yr),s.appendChild(e)},addComponent:function(e,t){i[t]=e,u.appendChild(e.getElm())},getEl:function(){return o},getComponent:function(e){return i[e]},getHolderEl:function(){return n},getRendererContainer:function(){return s},hideGuiContainer:function(){u.style.display="none"},removeComponent:function(e){var t="string"==typeof e?i[e]:e;t&&(u.removeChild(t.getElm()),delete i[t.id],t=null)},showGuiContainer:updateDims:c};function c(){n.style.width=t.getWidthWithUnit(),n.style.height=t.getHeightWithUnit()}};function Tr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}var Er=[],Sr=[],kr=[],wr=function(e){g(c,e);var t,n,r,a=Tr(c);function c(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(u(this,c),(t=a.call(this)).holderId=void 0,t._rendererObj=null,t.components={},t.beforePlayTaskQueue=[],t.supportedDrmSystems=null,t.destroyed=!1,t.playbackStartlogger=kn.get(Oe),t.playbackStartlogger.info("PLAYER INITIALIZED"),t.once(J,(),t.on(C,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.code,r=e.message;return t.playbackStartlogger.error("ERROR [".concat(n,"] ").concat(r))})),s(e)){case"object":t._rendererObj=e;break;case"string":n=!0,t.holderId=e}t.options=new pr,t.playlist=new zn(f(t)),t.autoLoad=n,t.renderer=null,t.mediaItem=null,t.frozen=!1,t.timeShift=null,t.onVisibilityChangeRef=function(){return t.onVisibilityChange()},document.addEventListener(O,t.onVisibilityChangeRef);var r=Date.now();return t.once(J,(function(){return t.trigger(he,(Date.now()-r)/1e3)})),Er.push(f(t)),t}return d(c,[{key:"renderers",get:function(){return Sr.slice()}},{key:"setup",value:function(e){return this.options.update(e),this.trigger("setup"),this.autoLoad&&this.load(),this}},{key:"load",value:(r=o(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.destroyed=!1,null!==this.renderer&&this.renderer.destroy(),t&&this.options.set(tt,t),e.abrupt("return",this._initialize());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_initialize",value:(n=o(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.registerModules();case 2:return this.timeShift=new lr(this),this.trigger(B),e.prev=4,this.playbackStartlogger.debug("PLAYLIST LOADING"),e.next=8,this.playlist.fetch();case 8:if(this.playbackStartlogger.info("PLAYLIST LOADED"),this.mediaItem=this.playlist.first(),this.supportedDrmSystems||!this.mediaItem.getDrm()||E.isIOS()){e.next=16;break}return this.playbackStartlogger.debug("DRM CHECKING SUPPORTED SYSTEMS"),e.next=14,rn();case 14:this.supportedDrmSystems=e.sent,this.playbackStartlogger.debug("DRM CHECKED SUPPORTED SYSTEMS");case 16:this.trigger("playlist",this.playlist.list()),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(4),this.trigger(C,{code:220,type:"PLAYLIST_ERROR",renderer:null,message:"Failed to load playlist."});case 22:if(!this.destroyed){e.next=24;break}return e.abrupt("return");case 24:if(!this.mediaItem){e.next=27;break}return e.next=27,this._create();case 27:case"end":return e.stop()}}),e,this,[[4,19]])}))),function(){return n.apply(this,arguments)})},{key:"_create",value:(t=o(y().mark((function e(){var t,n,r,a,o,s,u,c=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(t=qt(this.mediaItem.getSource(),Sr,this.options),n=i(t,1),r=n[0]){e.next=5;break}return e.abrupt("return",this.throwNoSupportedRendererError());case 5:if(!(a=r.renderer.create)){e.next=12;break}return e.next=9,a(this,this._rendererObj).catch((function(){return c.throwNoSupportedRendererError()}));case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=new r.renderer(this,this._rendererObj);case 13:if(this.renderer=e.t0,this.renderer&&!this.destroyed){e.next=16;break}return e.abrupt("return");case 16:this.renderer.setMediaItem(r),this._registerEvents(),o=this._rendererObj||this.renderer.getRendererElm(),this.holderId&&((s=new br(this.holderId,this.options)).addRenderer(o),this.addComponent(s,Kt)),u=dn(this.getFullscreenElement(),(function(e){return c.trigger(_,e)})),this.on(I,u),this.trigger(se,this.renderer);case 23:case"end":return e.stop()}}),e,this)}))),},{key:"freeze",value:function(){this.frozen=!0}},{key:"unFreeze",value:,{key:"addComponent",value:,{key:"getComponent",value:,{key:"removeComponent",value:function(e){this.components[e.id]=void 0,delete this.components[e.id]}},{key:"getRendererObj",value:function(){return this._rendererObj}},{key:"switchMedia",value:function(e){var t=this;this.renderer&&this.renderer.destroy();var n=this.getComponent(Kt);this.renderer=new Renderer(e,this),n.addRenderer(this.renderer.getRendererElm(),!0),this.renderer.on(Y,(function(e,n){return t.trigger(ve,e,n)})),this.renderer.on(Y,()}},{key:"isIndexMode",value:,{key:"getRendererElm",value:function(){var e;return null===(e=this.renderer)||void 0===e?void 0:e.getRendererElm()}},{key:"getMediaType",value:function(){var e;return null===(e=this.renderer)||void 0===e?void 0:e.rendererType}},{key:"getRenderer",value:function(){return this.renderer}},{key:"_registerEvents",value:function(){var e=this;this.renderer.on(Y,this.trigger.bind(this,ve)),this.renderer.on(Y,this.trigger.bind(this,Y)),this.on(se,this.ready.bind(this)),this.on(ne,(function(){return e._play()})),this.on(be,(function(t){return e._setVolume(t)})),this.on("volumeMuteRequest",(function(t){return e._setMuted(t)})),this.on(17,(function(t,n){return e.trigger(le,n)})),this.on(le,(function(t){return e._seekTo(t)})),this.on(ce,(function(t){return e._seek(t)})),this.on("togglePlayPauseRequest",(function(){return e.togglePlayPause()}))}},{key:"registerModules",value:function(){var e=this,t=this.options.get(vt),n=[];return kr.forEach((function(r){if(r.enabled||-1!==t.indexOf(r.moduleId)){var i=new r(e);i.initAsync&&n.push(i.initAsync())}})),Promise.all(n)}},{key:"onVisibilityChange",value:function(){this.trigger(ye,"visible"===document.visibilityState)}},{key:"ready",value:function(){this.options.get(Ne)&&this.renderer.play()}},{key:"onVolumeChanged",value:function(e){var t;this.options.get(Ft)&&(null===(t=localStorage)||void 0===t||t.setItem(this.options.get(jt),e))}},{key:"restart",value:function(){this.frozen||(this.timeShift.isEnabled()&&this.timeShift.reset(),this.renderer.restart()),this.trigger("restartRequest")}},{key:"switchProfile",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;null!==this.renderer&&this.renderer.switchProfile(e,t,n)}},{key:"switchAudioTrack",value:,{key:"getDroppedFrameCount",value:function(){return this.renderer.getDroppedFrameCount()}},{key:"getDecodedFrameCount",value:function(){return this.renderer.getDecodedFrameCount()}},{key:"getBuffered",value:function(){return this.renderer.getBuffered()}},{key:"getPlayed",value:function(){return this.renderer.getPlayed()}},{key:"getProfile",value:function(){return this.renderer.getProfile()}},{key:"_play",value:,{key:"play",value:function(){var e=this;return new Promise((function(t,n){e.trigger(ne);var r=e.once(te,(),e.once(ee,()}))}},{key:"pause",value:function(){this.frozen||this.renderer.pause(),this.trigger("pauseRequest")}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.renderer.stop(),e||this.trigger(me)}},{key:"head",value:,{key:"isPaused",value:,{key:"resize",value:,{key:"setVolume",value:,{key:"_setVolume",value:function(e){this.renderer.setVolume(e)}},{key:"getVolume",value:function(){return this.renderer.getVolume()}},{key:"_setMuted",value:,{key:"isMuted",value:function(){var e;return null===(e=this.renderer)||void 0===e?void 0:e.isMuted()}},{key:"mute",value:function(){return this._setMuted(!0)}},{key:"unMute",value:,{key:"volumeUp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=parseFloat(this.renderer.getVolume());(t+=e/10)>1&&(t=1),this.renderer.setVolume(100*t)}},{key:"volumeDown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=parseFloat(this.renderer.getVolume());(t-=e/10)<0&&(t=0),this.renderer.setVolume(100*t)}},{key:"setDrm",value:function(e){this.mediaItem.setDrm(e)}},{key:"isStreamStarted",value:function(){var e;return null===(e=this.renderer)||void 0===e?void 0:e.isStarted}},{key:"isStreamPaused",value:function(){var e;return null===(e=this.renderer)||void 0===e?void 0:e.isPaused}},{key:"isLive",value:function(){var e;return null===(e=this.renderer)||void 0===e?void 0:e.isLive()}},{key:"isLiveWithoutTimeShift",value:,{key:"isFullscreen",value:function(e){return hn(e||this.getFullscreenElement())}},{key:"getFullscreenElement",value:function(){var e=this.options.get("fullscreenElement");if(e)return e;var t=this.options.get("fullscreenElementId")||this.holderId;return document.getElementById(t)||this.renderer.getRendererElm()}},{key:"getMediaItem",value:function(){return this.mediaItem}},{key:"getUrl",value:function(){var e;return null===(e=this.renderer)||void 0===e?void 0:e.url}},{key:"getCurrentTime",value:function(){var e;return Math.max(0,null===(e=this.renderer)||void 0===e?void 0:e.getCurrentTime())}},{key:"getCurrentTimeUTC",value:function(){var e=this.getCurrentTime();return this.isLive()&&this.timeShift.isEnabled()&&(e+=this.getLiveStartUTC()),e}},{key:"getDuration",value:function(){return null===this.renderer?NaN:this.renderer.getDuration()}},{key:"getBufferLength",value:function(){return null===this.renderer?NaN:this.renderer.getBufferLength()}},{key:"setMaxBufferLength",value:function(e){var t;null===(t=this.renderer)||void 0===t||t.setMaxBufferLength(e),this.options.set("maxBufferLength",e)}},{key:"getCurrentProfile",value:function(){var e;return null===(e=this.renderer)||void 0===e?void 0:e.getCurrentProfile()}},{key:"getProfiles",value:function(){return this.renderer.getProfiles()}},{key:"getAudioTracks",value:function(){return this.renderer.getAudioTracks()}},{key:"getCurrentAudioTrack",value:function(){return this.renderer.getCurrentAudioTrack()}},{key:"getTextTracks",value:function(){return this.renderer.getTextTracks()}},{key:"seek",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this._createSeekPromise((function(){return e.trigger.apply(e,[ce].concat(n))}))}},{key:"seekTo",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this._createSeekPromise(()}},{key:"seekToHead",value:function(){var e=this;return this._createSeekPromise((function(){e.timeShift.isEnabled()&&e.timeShift.setMode(or),e.renderer.seekToHead()}))}},{key:"_createSeekPromise",value:function(e){var t=this;return new Promise(()}},{key:"_seek",value:function(){if(!this.frozen){this.timeShift.isLive()&&this.timeShift.setMode(sr);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.renderer.seek.apply(this.renderer,t)}}},{key:"_seekTo",value:function(){if(!this.frozen){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.renderer.seekTo.apply(this.renderer,t)}}},{key:"updateTimeShift",value:function(e){this.options.set(It,e),this.timeShift.update()}},{key:"togglePlayPause",value:function(){this.isPaused()?(!this.timeShift.isEnabled()&&this.isLive()&&this.seekToHead(),this.play()):this.pause()}},{key:"getTimeShift",value:,{key:"getTimeShiftStart",value:function(){return this.timeShift.getStart()}},{key:"getTimeShiftHead",value:function(){return this.timeShift.getLiveNowUTC()}},{key:"getLiveHeadUTC",value:,{key:"getLiveNowUTC",value:function(){return this.timeShift.getLiveNowUTC()}},{key:"getLiveStartUTC",value:function(){return this.timeShift.getStart()}},{key:"getLiveDelay",value:function(){var e;return this.isLive()&&(null===(e=this.renderer)||void 0===e?void 0:e.getLiveDelay())||0}},{key:"getLiveLatency",value:function(){var e=this.getCurrentTime(),t=this.isLive()&&!this.timeShift.isEnabled()?0:this.getLiveStartUTC();return this.getLiveNowUTC()-t-e}},{key:"getCurrentPeriod",value:,{key:"getDownloadSpeed",value:function(){return this.renderer.getDownloadSpeed()}},{key:"getPlaybackRate",value:function(){return this.renderer.getPlaybackRate()}},{key:"setPlaybackRate",value:,{key:"getOptions",value:function(){return this.options.options}},{key:"throwNoSupportedRendererError",value:function(){this.trigger(C,{code:De[Se.NO_SUPPORTED_RENDERER],type:Se.NO_SUPPORTED_RENDERER,renderer:null,message:"Given media file is not supported by any renderer."})}},{key:"destroy",value:function(){this.destroyed=!0,this.beforePlayTaskQueue=[],this.trigger(I,this.getCurrentTime()),this.off(),document.removeEventListener(O,this.onVisibilityChangeRef),this.renderer&&this.renderer.destroy(),-1!==Er.indexOf(this)&&Er.splice(Er.indexOf(this),1)}}],[{key:"players",get:function(){return Er.slice()}},{key:"renderers",get:function(){return Sr.slice()},set:,{key:"addModule",value:function(e){kr.push(e)}},{key:"addRenderer",value:,{key:"modules",get:function(){return kr.slice()},set:]),c}(w);const Dr=wr;r Lr="redgalaxy-player-bitrate",Pr=["timeupdate","progress","seeking","play","playing","ended","waiting","pause","seeked","loadedmetadata","loadeddata","loadstart","stalled","error","canplay","ratechange","volumechange"],Rr="AbortError",Ir="addtrack";function Cr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,r=e||document.createElement("video"),i=[];r.setAttribute("width","100%"),r.setAttribute("height","100%"),t.get(Ne)&&r.setAttribute("autoplay","autoplay"),t.get(bt)&&r.setAttribute(bt.toLowerCase(),""),r.setAttribute("crossorigin","anonymous");var a=t.get(Tt);function s(e){r.currentTime=e}unction c(){n.off(),i.forEach(()}function l(){try{r.load()}catch(e){}}function d(){return r.paused}function f(){return r.volume}function h(e){r.volume=e}function g(e){r.muted=e}function m(){return r.muted}function p(){return r.src}function v(e){r.src=e}function b(){t.get(je)&&(r.src=""),r.removeAttribute("src")}unction S(){return k.apply(this,arguments)}function k(){return(k=o(y().mark((function e(){var t,i,a,o,s,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){var e;return null===(e=r.play())||void 0===e?void 0:e.catch(()},i=function(){return n.trigger(te)},a=3,e.next=5,t();case 5:if(o=e.sent){e.next=8;break}return e.abrupt("return",i());case 8:if(o.name!==Rr){e.next=19;break}s=0;case 10:if(!(s<a)){e.next=19;break}return e.next=13,t();case 13:if(o=e.sent,(null===(u=o)||void 0===u?void 0:u.name)===Rr){e.next=16;break}return e.abrupt("break",19);case 16:s++,e.next=10;break;case 19:if(o){e.next=21;break}return e.abrupt("return",i());case 21:n.trigger(ee,o);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return r.duration}function D(){return r.offsetWidth}function O(){return r.offsetHeight}function A(){return Array.from(r.audioTracks||[])}function L(){return r.textTracks}function P(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=zt(r.textTracks).some(();!t&&n||e.forEach((function(e){var t=r.addTextTrack("subtitles",e.language,e.language);t.customCreated=!0,e.trackId&&(t.trackId=e.trackId)}))}function R(){c(),Pr.forEach((function(e){var t={fn:name:e};r.addEventListener(t.name,t.fn),i.push(t)}));var e=L(),t={fn:function(e){var t=e.track;return n.trigger(H,t,L())},name:Ir};e.addEventListener(Ir,t.fn),i.push(t)}turn a&&r.setAttribute("poster",a),E.isMobile()&&r.setAttribute("autoplay","autoplay"),t.get(qe)&&r.removeAttribute("controls"),R(),{on:this.on.bind(this),once:this.once.bind(this),off:u,seek:s,load:l,getVolume:f,setVolume:h,setMuted:g,getSource:p,setSource:v,removeSource:b,pause:T,play:S,getDuration:w,getNativeAudioTracks:A,getNativeTextTracks:L,addNativeTextTracks:P,getWidth:D,getHeight:O,getPlaybackRate:C,setPlaybackRate:I,isPaused:d,isMuted:m,getVideo:function(){return r},get height(){return r.offsetHeight},getCurrentTime:function(){return r.currentTime},getBufferLengthFromTime:getBufferLength:getBuffered:function(){return r.buffered},getPlayed:function(){return r.played},getTotalPlayed:function(){for(var e=this.getPlayed(),t=0,n=0;n<e.length;n++){var r=e.start(n);t+=e.end(n)-r}return t},getBufferRange:getReadyState:function(){return r.readyState},getDecodedFrameCount:function(){return HTMLVideoElement.prototype.getVideoPlaybackQuality?r.getVideoPlaybackQuality().totalVideoFrames:"webkitDecodedFrameCount"in r?r.webkitDecodedFrameCount:-1},getDroppedFrameCount:function(){return HTMLVideoElement.prototype.getVideoPlaybackQuality?r.getVideoPlaybackQuality().droppedVideoFrames:"webkitDroppedFrameCount"in r?r.webkitDroppedFrameCount:-1},hasBuffered:function(){return!!r.buffered.length},hasPlayed:isSeeking:}function xr(e,t){var n,r,i=0;if(e.buffered.length)for(var a=0;a<e.buffered.length;a++)n=e.buffered.start(a),r=e.buffered.end(a),n<=t&&r>=t&&(i=r-t);return i}function Mr(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,r=e.buffered||[],i=0;i<r.length;i++){var a=r.start(i),o=r.end(i);if(a>=t&&a<n)return{start:a,end:o}}return null}Cr.prototype=Object.create(S.prototype);const _r=Cr;const Nr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=null,i=0;function a(){o(),i=Date.now(),r=setInterval(t,e),n&&t()}unction s(t){t&&(e=t),a()}eturn{getDuration:u,start:a,restart:s,stop:o}};function Br(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}var Fr=function(e){g(n,e);var t=Br(n);function n(e,r){var i;return u(this,n),(i=t.call(this)).player=e,i.options=e.options,i.timeShift=i.player.timeShift,i.isStarted=!1,i.isPaused=!1,i.url=null,i.baseUrl=null,i.lastEvent=null,i.mediaItem=void 0,i.timer=new Nr(350,(function(){return i.monitor()})),i.currentRenderer=f(i),i.protectionManger=void 0,i.initialLatency=void 0,i.liveLatencyBeforeAppHiding=void 0,i.volumeLocalStorageKey=i.options.get(jt),i.volumeMutedLocalStorageKey=i.options.get(Vt),i.mediaElement=new _r(r||document.createElement("video"),i.options),e.addComponent(i.mediaElement,Wt),e.on(ye,(function(e){return i.onVisibilityChange(e)})),i.updateVolume(),i}return d(n,[{key:"onVisibilityChange",value:function(e){if(this.isLive()){var t=this.player.getLiveLatency()-(this.liveLatencyBeforeAppHiding||0);e&&t>20&&this.player.seekToHead(),this.liveLatencyBeforeAppHiding=e?void 0:this.player.getLiveLatency()}}},{key:"mediaType",get:function(){return this.rendererType.toUpperCase()}},{key:"isTimeShiftDvrWindow",get:,{key:"monitor",value:function(){this.guardLivePlaybackRate(),this.trigger(Y,this.getCurrentTime(),this.getDuration())}},{key:"guardLivePlaybackRate",value:function(){(this.isLive()||1!==this.getPlaybackRate())&&(this.player.getLiveLatency()<5||this.getCurrentTime()<0)&&this.setPlaybackRate(1)}},{key:"setMediaItem",value:,{key:"updateVolume",value:function(){var e,t,n=0,r=!1;this.options.get(Ft)&&(n=parseFloat(null===(e=localStorage)||void 0===e?void 0:e.getItem(this.options.get(jt))),r="true"===(null===(t=localStorage)||void 0===t?void 0:t.getItem(this.options.get(Vt))));var i=this.options.get(Bt),a=this.options.get(Ut),o=void 0!==i?i:n||50;this.setVolume(o);var s=void 0!==a?a:r;s&&this.setMuted(s)}},{key:"updateLocalStorage",value:function(){var e,t;this.options.get(Ft)&&(null===(e=localStorage)||void 0===e||e.setItem(this.options.get(jt),this.getVolume()),null===(t=localStorage)||void 0===t||t.setItem(this.options.get(Vt),this.isMuted()))}},{key:"getRendererElm",value:function(){return this.mediaElement.getVideo()}},{key:"getVideo",value:function(){return this.mediaElement.getVideo()}},{key:"isMuted",value:function(){return this.mediaElement.isMuted()}},{key:"setMuted",value:function(e){this.mediaElement.setMuted(e),e||0!==this.getVolume()||this.setVolume(50)}},{key:"getVolume",value:,{key:"getCurrentProfile",value:function(){return 0}},{key:"setVolume",value:function(e){e>100&&(e=100),e<0&&(e=0),this.mediaElement.setVolume(e/100),0===e&&this.setMuted(!0)}},{key:"seek",value:function(e){this.seekTo(this.getDuration()/100*e)}},{key:"seekTo",value:,{key:"seekToHead",value:function(){var e=Math.min(this.getDuration(),Number.MAX_SAFE_INTEGER);this.seekTo(e-(this.isLive()?this.getLiveDelay():0))}},{key:"getDroppedFrameCount",value:function(){return this.mediaElement.getDroppedFrameCount()}},{key:"getDecodedFrameCount",value:function(){return this.mediaElement.getDecodedFrameCount()}},{key:"getPlayed",value:function(){return this.mediaElement.getPlayed()}},{key:"getBuffered",value:function(){return this.mediaElement.getBuffered()}},{key:"getDownloadSpeed",value:,{key:"getPlaybackRate",value:function(){return this.mediaElement.getPlaybackRate()}},{key:"setPlaybackRate",value:,{key:"getLiveDelay",value:,{key:"getBufferLength",value:function(){return this.mediaElement.getBufferLength()}},{key:"getCurrentTime",value:function(){return this.mediaElement.getCurrentTime()}},{key:"getDuration",value:,{key:"isLive",value:function(){return this.options.get(ct)}},{key:"registerEvents",value:function(){var e=this;Pr.forEach((function(t){var n="on".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));"function"==typeof e[n]&&e.mediaElement.on(t,e[n].bind(e))})),this.mediaElement.on(ee,(function(t){return e.player.trigger(ee,t)})),this.mediaElement.on(C,(),this.mediaElement.on(te,(),this.mediaElement.on(H,()}},{key:"unRegisterEvents",value:function(){this.mediaElement.off()}},{key:"setSource",value:,{key:"playSource",value:,{key:"restart",value:,{key:"play",value:function(){this.isPaused=!1,this.isStarted?this.mediaElement.play():this.setSource(this.mediaItem.url),this.timer.start(),this.isStarted=!0}},{key:"pause",value:,{key:"stop",value:function(){this.mediaElement.pause(),this.player.trigger(ge,this.mediaElement.getCurrentTime()),this.destroy()}},{key:"guardLivePosition",value:function(){this.isLive()&&!this.timeShift.isEnabled()&&this.getCurrentTime()>0&&this.seekToHead()}},{key:"guardTimeShiftPosition",value:function(){this.timeShift.isEnabled()&&this.getCurrentTime()<0&&this.player.seekTo(this.options.get(at))}},{key:"triggerOnSeekStartEvents",value:function(){var e=this.getCurrentTime();this.player.trigger(fe,e),this.mediaElement.isPaused()&&this.player.trigger("syntheticWaiting",e)}},{key:"destroy",value:function(){var e;null===(e=this.timer)||void 0===e||e.stop(),this.isStarted=!1,this.isPaused=!1,this.unRegisterEvents(),this.mediaElement.pause(),this.mediaElement.off(),this.mediaElement.getSource()&&this.mediaElement.removeSource(),this.options.get(ze)||this.mediaElement.load(),this.player.removeComponent(this.mediaElement)}},{key:"onPlay",value:function(){this.player.trigger("play",this.getCurrentTime()),this.options.get(it)&&this.guardLivePosition()}},{key:"onPlaying",value:function(){this.lastEvent===de&&this.player.trigger(Ee,this.getCurrentTime()),this.lastEvent!==J&&(this.lastEvent=J,this.player.trigger(J,this.getCurrentTime())),this.guardTimeShiftPosition()}},{key:"onTimeupdate",value:function(){this.isLive()&&!this.initialLatency&&Math.floor(this.getCurrentTime())>0&&this.timeShift.getMode()!==sr&&(this.initialLatency=this.player.getLiveLatency())}},{key:"onPause",value:function(){this.lastEvent=Q,this.player.trigger(Q,this.getCurrentTime())}},{key:"onWaiting",value:function(){this.lastEvent=Te,this.player.trigger(Te,this.getCurrentTime())}},{key:"onEnded",value:function(){this.lastEvent=M,this.player.trigger(M,this.getCurrentTime())}},{key:"onCanplay",value:function(){this.lastEvent!==Ee&&(this.lastEvent=Ee,this.player.trigger(Ee,this.getCurrentTime())),this.player.trigger(R)}},{key:"onSeeked",value:function(){this.player.trigger(de,this.getCurrentTime()),this.mediaElement.isPaused()||this.lastEvent===J||this.player.trigger(J,this.getCurrentTime()),this.lastEvent=de}},{key:"onRatechange",value:,{key:"onVolumechange",value:function(){this.player.trigger("volumeChanged",this.getVolume(),this.isMuted()),this.updateLocalStorage()}},{key:"onError",value:function(e){var t=this.mediaElement.getVideo().error,n=Se.PLAYBACK_ERROR,r=Se.PLAYBACK_ERROR,i=De[Se.PLAYBACK_ERROR];if(t)switch(n=t.message,t.code){case 1:i=De[Se.MEDIA_ERR_ABORTED],r=Se.MEDIA_ERR_ABORTED;break;case 2:i=De[Se.MEDIA_ERR_NETWORK],r=Se.MEDIA_ERR_NETWORK;break;case 3:i=De[Se.MEDIA_ERR_DECODE],r=Se.MEDIA_ERR_DECODE;break;case 4:i=De[Se.MEDIA_ERR_SRC_NOT_SUPPORTED],r=Se.MEDIA_ERR_SRC_NOT_SUPPORTED}this.lastEvent=C,this.player.trigger(C,{code:i,type:r,message:n,renderer:this.mediaType,originalEvent:t||e})}}]),n}(S);const jr=Fr;var Ur="endOfStream",Vr="failedToLoadManifest",Hr="failedToLoadSegment",Wr="representationChanged",Yr="segmentAppended",Gr="segmentProgress",Kr="segmentDownloaded",qr="sourceBufferCleared",zr="sourceclose",Qr="sourceended",Xr="sourceopen",$r="metadata",Zr=["impression","start"],Jr=function(){function e(t,n){var r=this;u(this,e),this.player=t,this.options=this.player.options,this.video=n,this.manifestManager=t.getComponent(Ht),this.mediaElement=t.getComponent(Wt),this.preventStreamEventsForPartiallyPlayedPeriods=this.options.get(St),this.currentTime,this.currentPeriod,this.textTrack,t.on(U,(function(){return r.updateCues()})),t.on(X,(function(){return r.onPeriodUpdate()})),t.on(R,(function(){return r.onPeriodUpdate()}))}return d(e,[{key:"onPeriodUpdate",value:function(){this.currentTime=this.mediaElement.getCurrentTime(),this.currentPeriod=this.manifestManager.findPeriodByTime(this.currentTime),this.updateCues()}},{key:"createTextTrack",value:function(){var e=this,t=this.mediaElement.getVideo();this.textTrack=t.addTextTrack($r,$r),this.textTrack.oncuechange=function(){return e.sendEvent()}}},{key:"updateCues",value:function(){var e,t,n=this,r=null===(e=this.currentPeriod)||void 0===e?void 0:e.eventStreams[0],i=this.manifestManager.manifest.periods,a=i.indexOf(this.currentPeriod),o=i[a+1];if(null!=r&&r.length||null!=o&&null!==(t=o.eventStreams[0])&&void 0!==t&&t.length){this.textTrack||this.createTextTrack();var s=window.VTTCue||window.TextTrackCue,u=[this.currentPeriod],c=[],l=[this.currentPeriod.id,null==o?void 0:o.id];zt(this.textTrack.cues).forEach((),o&&u.push(o),u.forEach((function(e){c.push({streamEvents:null==e?void 0:e.eventStreams[0],periodId:null==e?void 0:e.id})})),c.forEach((function(e){var t=e.streamEvents,r=e.periodId,i=zt(n.textTrack.cues).find((function(e){return e.periodId===r}));n.currentPeriod.eventStreams.length||(n.currentPeriod=o),!i&&t&&n.currentTime&&(null==t||t.forEach((function(e){var t=e.start,i=e.eventData;if(!isNaN(t)&&"string"==typeof i){var a=new s(t,t+1,i);a.data=e,a.data.fired=!1,a.periodId=r,n.textTrack.addCue(a)}})))}))}}},{key:"sendEvent",value:function(){var e=this;this.textTrack.activeCues.length&&zt(this.textTrack.activeCues).forEach((function(t){if(!t.data.fired){var n=zt(e.currentPeriod.eventStreams[0])[0];(!e.preventStreamEventsForPartiallyPlayedPeriods||n.fired||Zr.includes(t.data.event))&&(e.player.trigger(pe,t.data),t.data.fired=!0)}}))}}]),e}();function ei(e){var t=e.accessibility,n=e.codecs,r=e.enabled,i=e.id,a=e.kind,o=e.label,s=e.lang,u=e.language,c=e.mimeType,l=e.role;this.accessibility=t,this.codecs=n,this.enabled=r,this.id=i,this.kind=a,this.label=o,this.lang=s||u,this.mimeType=c,this.role=l}const ti={VIDEO:"video",AUDIO:"audio",TEXT:"text"};var ni=Object.values(ti),ri=3600,ii=86400,ai=["stpp"],oi=function(e){if(!e)return null;var t=/^P(?:([0-9]*)Y)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(e);if(!t)return null;var n=i(t.slice(1,6).map((),4),r=n[0],a=n[1],o=n[2],s=n[3],u=parseFloat(t[5]||0);return 31536e3*r+ii*a+ri*o+60*s+u},si=function(e){if(e){var t=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e),n=i(t.slice(1,7).map((),6),r=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],l=parseFloat(t[7]||0),d=Date.UTC(r,a-1,o,s,u,c||0,l);return new Date(d).getTime()/1e3}},ui=ci=function(e,t){var n;return(null===(n=ui(e,t))||void 0===n?void 0:n[0])||null},li=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0";e.length<t;)e="".concat(n).concat(e);return e},di=fi=function(e,t){var n=e.bandwidth,r=e.id,i=e.segmentTemplate,a=e.url,o=t.index,s=t.startTime;return function(e,t,n){var r=e.indexOf("$".concat(t));if(r<0)return e;var i=e.indexOf("$",r+t.length),a=e.indexOf("%0",r+t.length),o=0;if(a>=0)switch(o=e.substring(a+"%0".length,i-1),e.charAt(i-1)){case"d":case"i":case"u":n=li(n.toString(),o,"0");break;case"o":n=li(n.toString(8),o,"0");break;case"x":n=li(n.toString(16),o,"0")}return e.substring(0,r)+n+e.substring(i+1)}([a,i.media].join(""),"Number",o).replace("$Time$",s).replace("$RepresentationID$",r).replace("$Bandwidth$",n)},hi=function(e){var t=e.getAttribute("codecs"),n=e.getAttribute("contentType"),r=e.getAttribute("mimeType");return ni.includes(n)?n:ai.includes(t)?ti.TEXT:r?ni.find(():void 0};const gi=d(();var mi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.presentationTimeOffset,n=e.timescale;return t/n||0},pi=function(e,t){if(e.hasOwnSegments){var n=e.duration,r=e.indexMode,i=e.segmentTemplate,a=t.duration,o=t.start,s=i.segmentDuration,u=i.startNumber,c=i.timeline,l=i.timescale,d=(c||{}).timePoints,f=e.isDynamic&&!a,h=o*l,g=u,m=[];if(r&&f)return m;if(s){var p=a||n,v=Math.ceil(p/(s/l));m=Array.from({length:v}).map((function(e,t){var n=new gi;return n.startTime=h+t*s,n.start=n.startTime/l,n.duration=s/l,n.index=g+t,n}))}else if(d)for(var y,b=(null===(y=d[0])||void 0===y?void 0:y.startTime)||0,T=b-mi(i)*l+o*l,E=0,S=d.length;E<S;E++)for(var k=d[E].repeat||0,w=0;w<=k;w++){var D=new gi,O=d[E].duration;D.index=g,D.startTime=b,D.start=T/l,D.duration=O/l,m.push(D),g++,b+=O,T+=O}return m}},vi=function(e,t){var n=e.availabilityStartTime,r=e.dvrWindow,i=e.segmentList,a=e.segmentTemplate,o=e.timeShiftBufferDepth,s=a.timescale,u=a.startNumber,c=r>0?r:o,l=mi(a),d=a.segmentDuration/s,f=Math.max(0,Math.ceil(n-l)),h=function(e){return e&&e.length?e[e.length-1]:null}(i),g=u,m=l?t-(l+f):c,p=l;l||(p=t-f-c,g+=Math.floor(p/d)),h&&(m=t-(f+l+h.start+d),p=h.start+d+l,g=h.index+1);var v=Math.ceil(m/d);if(v){var y=Array.from({length:Math.min(1e5,v)}).map((function(e,t){var n=new gi,r=di(p+t*d);return n.startTime=r+f,n.start=r-l,n.duration=d,n.index=g+t,n}));i.push.apply(i,zt(y))}};function yi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}var bi=function(e){g(n,e);var t=yi(n);function n(){var e;return u(this,n),(e=t.call(this)).id=null,e.segmentList=null,e.adaptationSets=[],e.timeline=null,e.baseUrl=null,e.start=null,e.end=null,e.duration=null,e.segmentTemplate=null,e.eventStreams=[],e}return d(n,[{key:"createEvents",value:function(e){var t=this;this.eventStreams=e.map((function(e){var n=ui(e,"Event"),r=e.getAttribute("timescale")||1e3;return zt(n).map((function(e){var n=new Ti,i=parseInt(e.getAttribute("presentationTime"))/r;return n.id=e.getAttribute("id"),n.presentationTime=i,n.start=t.start+i,n.messageData=e.getAttribute("messageData")||e.textContent,n.eventData=e.textContent,n.event=e.getAttribute("event"),n}))}))}}]),n}(S),Ti=d((function e(){u(this,e),this.id=void 0,this.start=void 0,this.messageData=void 0,this.eventData=void 0,this.fired=!1}));const Ei=bi;onst ki=function(){eturn d(e,[{key:"parse",value:function(e){this.timePoints=e.map((function(e,t){var n=new Si;return n.index=t,n.duration=parseInt(e.getAttribute("d")),n.startTime=parseInt(e.getAttribute("t")),n.repeat=parseInt(e.getAttribute("r")),n}))}}]),e}();const wi=d((function e(){u(this,e),this.timescale=1,this.presentationTimeOffset=0,this.segmentDuration=null,this.initialization=null,this.media=null,this.duration=null,this.startNumber=1,this.timeline=null,this.hasIndex=!1,this.hasTimeline=!1}));const Di=d((function e(){u(this,e),this.duration=null,this.maxSegmentDuration=0,this.minBufferTime=6,this.periods=[],this.baseUrl=null,this.location=null,this.type=null,this.minimumUpdatePeriod=null,this.maxSegmentDuration=null,this.publishTime=null,this.startTime=0,this.availabilityStartTime=0,this.availabilityEndTime=0,this.UTCTiming=null,this.timeShiftBufferDepth=null,this.suggestedPresentationDelay=null}));var Oi=d((function e(){u(this,e),this.period=null,this.availabilityEndTime=null,this.url=null,this.minBufferTime=null,this.duration=0,this.publishTime=null,this.suggestedPresentationDelay=null,this.presentationTimeOffset=0,this.timeShiftBufferDepth=null,this.segmentTemplate=null,this.codecs=null,this.mimeType=null,this.contentType=null,this.type=null,this.segmentList=null,this.lang=null,this.label=null,this.representations=[],this.availabilityStartTime=null,this.indexMode=!1,this.dvrWindow=-1,this.hasOwnSegments=!0,this.unsupportedCodecs=[]}));const Ai=d((function e(){u(this,e),this.id=void 0,this.adaptationSetId=void 0,this.period=void 0,this.bandwidth=void 0,this.mimeType=void 0,this.width=void 0,this.height=void 0,this.codecs=void 0,this.mimeCodec=void 0,this.mediaType=void 0,this.url=void 0,this.segmentList=void 0,this.segmentTemplate=void 0,this.hasOwnSegments=!0}));function Li(e){var t,n;this.mpd=null,this.player=e,this.options=e.options,this.createSegmentsOnTheFly=this.options.get(Ve),this.timeShift=e.timeShift,this.mediaItem=e.mediaItem,this.widevineConfig=(null===(t=this.player.mediaItem.getDrm())||void 0===t?void 0:t.widevine)||{},this.widevineSupportedConfigs=null===(n=this.player.supportedDrmSystems)||void 0===n?void 0:n.filter((function(e){return e.keySystem===Jt.WIDEVINE}))}function Pi(e,t){var n,r=ci(e,"BaseURL"),i=null;if(null!==r&&null!==(n=r.textContent))if(n))i=n;else if(i=[t.slice(0,t.lastIndexOf("/")),n].join("/"),n.startsWith("/"))try{i="".concat(new URL(t).origin).concat(n)}catch(e){}return i}Li.prototype={parse:function(e,t,n){var r,a=this;this.mpd=new Di,this.mpd.dvrWindow=this.timeShift.getDvrWindow();var o=(new DOMParser).parseFromString(e,"text/xml"),s=ci(o,"MPD");if(null===s)return null;n||(n=t),n=n.split("?")[0],this.mpd.timeStamp=(new Date).getTime(),this.mpd.responseUrl=n,this.mpd.type=s.getAttribute("type"),this.mpd.duration=oi(s.getAttribute("mediaPresentationDuration")),this.mpd.mediaPresentationDuration=oi(s.getAttribute("mediaPresentationDuration")),this.mpd.minBufferTime=oi(s.getAttribute("minBufferTime"))||0,this.mpd.minimumUpdatePeriod=oi(s.getAttribute("minimumUpdatePeriod")),this.mpd.maxSegmentDuration=oi(s.getAttribute("maxSegmentDuration")),this.mpd.suggestedPresentationDelay=oi(s.getAttribute("suggestedPresentationDelay"))||0,this.mpd.timeShiftBufferDepth=oi(s.getAttribute("timeShiftBufferDepth"))||0,this.mpd.location=null===(r=ci(s,"Location"))||void 0===r?void 0:r.textContent,this.mpd.periods=[],this.mpd.availabilityStartTime=si(s.getAttribute("availabilityStartTime"))||0;var u=ci(s,"UTCTiming");u&&(this.mpd.utcTiming={schemeIdUri:u.getAttribute("schemeIdUri"),value:u.getAttribute("value")});var c=Pi(s,n);null===this.mpd.duration&&(this.mpd.duration=Number.MAX_VALUE),null!==this.mpd.mediaPresentationDuration&&(this.mpd.duration=this.mpd.mediaPresentationDuration),this.mpd.availabilityStartTime=si(s.getAttribute("availabilityStartTime"))||0,this.mpd.availabilityEndTime=si(s.getAttribute("availabilityEndTime"))||0,this.mpd.availabilityStartTime&&this.mpd.mediaPresentationDuration&&!this.mpd.availabilityEndTime&&(this.mpd.availabilityEndTime=this.mpd.availabilityStartTime+this.mpd.mediaPresentationDuration),this.mpd.startTime=0,this.mpd.publishTime=s.getAttribute("publishTime");var l=Array.from(ui(s,"Period")||[]).map(();l.forEach((function(e,t){var n=l[t-1]||{};n&&(n.end=e.start,n.duration=e.start-n.start),a.createSegmentsOnTheFly&&a.mpd.indexMode||e.adaptationSets.forEach((function(t){t.segmentList=pi(t,e),t.representations.forEach((function(n){n.segmentList=pi(n,e),n.hasOwnSegments||(n.segmentList=t.segmentList)}))}))}));var d=this.widevineConfig.multikey;if(d&&this.widevineSupportedConfigs.length){var f=i(l.flatMap(().filter((function(e){return e.mediaType===ti.VIDEO})).sort((function(e,t){return t.height-e.height})),1)[0],h=f&&d.find(();this.widevineConfig.multikeySrc=null==h?void 0:h.src}return this.mpd.periods=l,this.mpd},createPeriod:function(e,t,n){var r=new Ei,i=ui(e,"AdaptationSet"),a=Pi(e,n);null===a&&(a=t),r.id=e.getAttribute("id")||"period_".concat(Date.now()),r.start=oi(e.getAttribute("start")),r.baseUrl=a||function(e){var t=e.lastIndexOf("/");return t=-1===t?e.length:t+1,e.substring(0,t)}(n),r.segmentTemplate=this.createSegmentTemplate(e),this.createAdaptationSets(this.mpd,r,i);var o=ui(e,"EventStream");return o.length&&r.createEvents(o),r},createAdaptationSets:function(e,t,n){for(var r=1,i=!0,a=void 0,o=0;o<n.length;o++){var s=n[o],u=this.getAdaptationSetType(s);if(a=u===ti.AUDIO?a||s:a,!this.shouldDiscardAdaptation(s,u)){u===ti.AUDIO&&(i=!1);var c=this.createAdaptationSet(e,t,s,{trackId:r,type:u});c.representations.length&&(c.type!==ti.VIDEO&&r++,t.adaptationSets.push(c))}}if(i&&a){var l=this.createAdaptationSet(e,t,a,{trackId:r,type:ti.AUDIO});t.adaptationSets.push(l)}},createAdaptationSet:function(e,t,n,r){var a,o,s,u=this,c=new Oi,l=r.trackId,d=r.type;c.periodId=t.id,c.url=t.baseUrl,c.segmentTemplate=this.createSegmentTemplate(n,t.segmentTemplate||{}),c.segmentTemplate||(c.hasOwnSegments=!1),c.indexMode=c.segmentTemplate&&c.segmentTemplate.duration&&!c.segmentTemplate.hasTimeline,c.publishTime=this.mpd.publishTime,c.dvrWindow=e.dvrWindow,c.timeShiftBufferDepth=this.mpd.timeShiftBufferDepth,c.suggestedPresentationDelay=this.mpd.suggestedPresentationDelay,c.availabilityStartTime=this.mpd.availabilityStartTime,c.suggestedPresentationDelay=this.mpd.suggestedPresentationDelay,c.availabilityEndTime=this.mpd.availabilityEndTime,c.duration=this.mpd.duration,c.minBufferTime=this.mpd.minBufferTime,c.isDynamic="dynamic"===this.mpd.type,e.indexMode=c.indexMode,c.codecs=n.getAttribute("codecs"),c.lang=n.getAttribute("lang"),c.label=n.getAttribute("label"),c.mimeType=n.getAttribute("mimeType"),c.type=d,c.accessibility=null===(a=ci(n,"Accessibility"))||void 0===a?void 0:a.getAttribute("value"),c.role=null===(o=ci(n,"Role"))||void 0===o?void 0:o.getAttribute("value"),n.getAttribute("id")&&(c.id=parseInt(n.getAttribute("id"))),c.type!==ti.VIDEO&&isNaN(c.id)&&(c.id=l);for(var f=ui(n,"Representation"),h=function(){var n=u.createRepresentation(c,f[g]),r=n.hasOwnSegments,i=n.mediaType,a=n.mimeCodec,o=n.segmentTemplate;if(n.periodId=t.id,r&&o.hasIndex&&!o.hasTimeline&&(e.indexMode=!0),[ti.AUDIO,ti.VIDEO].includes(i)&&a&&!window.MediaSource.isTypeSupported(a))return c.unsupportedCodecs.push(a),"continue";var s=(u.widevineConfig||{}).multikey;if(i===ti.VIDEO&&s&&u.widevineSupportedConfigs.length&&!!(null==s||!s.find((function(e){var t=e.maxHeight,r=e.securityLevel;return n.height<=t&&u.widevineSupportedConfigs.find((function(e){return e.level===r}))}))))return"continue";c.representations.push(n)},g=0;g<f.length;g++)h();if(null!==(s=c.representations)&&void 0!==s&&s.length){var m=i(c.representations,1)[0];null===c.mimeType&&null!==m.mimeType&&(c.mimeType=m.mimeType),c.codecs||(c.codecs=m.codecs),c.codecs&&(c.contentType="".concat(c.mimeType,';codecs="').concat(c.codecs,'"'))}return c.representations.sort(this.sortFn),c},getAdaptationSetType:function(e){var t=hi(e);if(!t){var n=i(ui(e,"Representation"),1)[0];return hi(n)}return t},createRepresentation:function(e,t){var n=new Ai;return n.id=t.getAttribute("id"),n.adaptationSetId=e.id,n.bandwidth=parseInt(t.getAttribute("bandwidth")),n.mimeType=t.getAttribute("mimeType"),n.width=parseInt(t.getAttribute("width")),n.height=parseInt(t.getAttribute("height")),n.mediaType=e.type,n.url=e.url,n.segmentList=e.segmentList,n.availabilityStartTime=e.availabilityStartTime,n.timeShiftBufferDepth=e.timeShiftBufferDepth,n.indexMode=e.indexMode,n.dvrWindow=e.dvrWindow,n.codecs=t.getAttribute("codecs"),"mp4a.40.1"===n.codecs&&(n.codecs="mp4a.40.2"),n.codecs&&e.mimeType&&(n.mimeCodec="".concat(e.mimeType,';codecs="').concat(n.codecs,'"')),n.segmentTemplate=this.createSegmentTemplate(t),!n.segmentTemplate&&e.segmentTemplate&&(n.hasOwnSegments=!1,n.segmentTemplate=e.segmentTemplate),n},createSegmentTemplate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.initialization,r=t.media,i=t.startNumber,a=void 0===i?1:i,o=ci(e,"SegmentTemplate");if(o){var s=ci(o,"SegmentTimeline"),u=new wi;if(u.timeline=new ki,s){var c=ui(s,"S");u.timeline.parse(c)}u.timescale=parseInt(o.getAttribute("timescale"))||1,u.segmentDuration=parseInt(o.getAttribute("duration")),u.segmentDurationInSeconds=u.segmentDuration/u.timescale;var l=o.getAttribute("startNumber");return u.hasIndex=!!l,u.hasTimeline=!!s,u.startNumber=null!==l?parseInt(l,10):a,u.duration=parseInt(o.getAttribute("duration")),u.presentationTimeOffset=parseInt(o.getAttribute("presentationTimeOffset"))||0,u.offset=(u.startNumber-1)*u.segmentDurationInSeconds,u.initialization=o.getAttribute("initialization")||n,u.media=o.getAttribute("media")||r,u.maxIndex=Math.ceil(this.mpd.duration/u.segmentDurationInSeconds)+(u.startNumber-1),u}},shouldDiscardAdaptation:function(e,t){var n=this.options.get("allowedAudioLanguages"),r=this.options.get("allowedSubtitleLanguages"),i=e.getAttribute("lang");if(i)return n&&t===ti.AUDIO?!n.includes(i):r&&t===ti.TEXT?!r.includes(i):void 0},sortFn:function(e,t){return t.bandwidth-e.bandwidth},update:function(e,t,n){var r=this,a=this.timeShift.getDvrWindow()>0?this.timeShift.getDvrWindow():n;if(t.periods.forEach((function(t){var i=e.periods.find((),a=e.periods.find((function(e){var n=e.start,r=e.end;return n===t.start&&!r}));i||e.periods.push(t),a&&r.updatePeriod(a,t,n)})),e.periods.sort((function(e,t){return e.start-t.start})),e.periods.length>1){var o=i(e.periods,1)[0],s=i(e.periods.slice(-1),1)[0],u=s.start-o.start;a>0&&u>a&&(e.periods=e.periods.reduce((function(e,t){return(t.end||t.start)>=s.start-a&&e.push(t),e}),[]))}return this.updatePeriodsDuration(e.periods),e.publishTime=t.publishTime,e.baseUrl=t.baseUrl,e.minimumUpdatePeriod=t.minimumUpdatePeriod,e},updatePeriod:function(e,t,n){for(var r=this,i=function(){var i=e.adaptationSets[a],o=t.adaptationSets[a],s=i.segmentList,u=o.segmentList;i.url=o.url,(null==u?void 0:u.length)>0&&(i.segmentList=r.merge(s,u,n)),i.representations.forEach((function(e,t){var i=o.representations[t];if(null!=i&&i.segmentList){e.segmentList=r.merge(e.segmentList,i.segmentList,n),e.url=o.url;var a=e.segmentTemplate.presentationTimeOffset;e.segmentTemplate=i.segmentTemplate,e.segmentTemplate.presentationTimeOffset=a}}))},a=0;a<t.adaptationSets.length;a++)i()},updatePeriodsDuration:function(e){var t;e.forEach((function(e){if(t){var n=t,r=n.duration,i=n.start;t.end=e.start,t.duration=e.start-i,r||t.trigger(Z,t)}t=e}))},merge:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=[],o=i(t,1),s=o[0];if(!s)return e;e=e.filter(();var u=(n=[].concat(zt(e),zt(t)))[0].index,c=n.slice(-1),l=i(c,1),d=l[0],f=0===r?0:d.start-r;return n.forEach((function(e){e.index>u&&(u=e.index),e.index=u,e.start>f&&(a.push(e),u++)})),a}};const Ri=Li;function Ii(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ci(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ii(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ii(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}var Mi=function(e){g(n,e);var t=xi(n);function n(e,r){var i,a,o,s,c;return u(this,n),c=t.call(this),r.addComponent(f(c),Ht),c.video=e,c.player=r,c.logger=kn.get("manifest"),c.playbackStartlogger=kn.get(Oe),c.options=c.player.options,c.httpConfig=c.options.get(ot),c.createSegmentsOnTheFly=c.options.get(Ve),c.headers=null===(i=c.httpConfig)||void 0===i||null===(a=i.manifest)||void 0===a?void 0:a.headers,c.params=null===(o=c.httpConfig)||void 0===o||null===(s=o.manifest)||void 0===s?void 0:s.params,c.streamWithCredentials=c.options.get(Rt),c.minimumUpdatePeriodEnabled=c.options.get(pt),c.timeShift=c.player.timeShift,c.utcTime=new ar(r),c.manifest=null,c.parser=new Ri(r),c.updating=!1,c.adaptations=[],c.videoAdaptation=null,c.audioAdaptation=null,c.cancelRequest=function(){},c.monitorTimer=null,c.headSegmentIndex=-1,c.duration=-1,c.url=null,c.utcHeadTime=0,c}return d(n,[{key:"monitor",value:function(){var e=this.manifest.location||this.url;if(this.isIndexMode()){var t=this.utcTime.getTime();if(t>0){this.createSegmentsOnTheFly||this.updateTimeLine(t),this.utcHeadTime=t-this.parser.mpd.availabilityStartTime;var n=((new Date).getTime()-this.parser.mpd.timeStamp)/1e3;this.minimumUpdatePeriodEnabled&&n>this.manifest.minimumUpdatePeriod&&this.update(e,"startTime"))}}else this.updating||this.update(e)}},{key:"load",value:function(e){var t=this;return this.url=e,this.updating=!0,this.abort(),this.monitorTimer&&this.monitorTimer.stop(),this.playbackStartlogger.info("MANIFEST LOADING "),this.fetch(this.url).then(function(){var e=o(y().mark((function e(n){var r,i,a,o,s,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.metric,i=n.data,a=n.url,o=n.responseUrl,t.sendMetric(r),t.playbackStartlogger.info("MANIFEST LOADED"),t.manifest=t.parse(i,a,o),t.playbackStartlogger.debug("MANIFEST PARSED"),t.adaptations=t.getAllAdaptationSets(),t.videoAdaptation=t.getAdaptationSetByType(ti.VIDEO),t.audioAdaptation=t.getAdaptationSetByType(ti.AUDIO),t.duration=t.manifest.duration,t.updating=!1,!t.isLive()){e.next=20;break}return e.next=13,t.utcTime.sync(t.manifest.utcTiming);case 13:s=e.sent,t.trigger(N,s),u=1e3*t.manifest.minimumUpdatePeriod||2e3,t.isIndexMode()&&(u=1e3),t.monitorTimer=new Nr(u,(function(){return t.monitor()})),t.monitorTimer.start(),t.isIndexMode()&&t.monitor();case 20:return t.logger.info("MANIFEST LOADED: duration: ".concat(r.duration/1e3,", url: ").concat(t.url)),t.trigger(j,t.manifest),e.abrupt("return",t.manifest);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(n){var r=n.error,i=n.metric,a=n.xhr;return t.updating=!1,r===An?Promise.reject({error:r}):r===Ln?(t.sendMetric(i),t.logger.error("MANIFEST LOADED: duration: ".concat(i.duration/1e3,", url: ").concat(t.url)),Promise.reject({error:Vr,url:e,xhr:a})):void 0}))}},{key:"update",value:function(e){var t=this;this.updating=!0;var n=0;this.timeShift.isEnabled()||(n=60),this.parser.mpd.timeShiftBufferDepth&&(n=this.parser.mpd.timeShiftBufferDepth),this.fetch(e).then(function(){var r=o(y().mark((function r(i){var a,o,s,u,c,l,d;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=i.metric,o=i.data,s=i.url,u=i.responseUrl,c=t.parse(o,s,u),l=t.manifest.minimumUpdatePeriod,r.next=5,t.utcTime.syncDirect(c.utcTiming);case 5:return t.sendMetric(a),t.manifest=t.parser.update(t.manifest,c,n),t.trigger(N,t.utcTime.getTime()),t.trigger(U,t.manifest),t.updating=!1,d=t.manifest.minimumUpdatePeriod,l===d||t.isIndexMode()||t.monitorTimer.restart(1e3*d),t.logger.info("MANIFEST UPDATED: duration: ".concat(a.duration/1e3,", url: ").concat(e)),r.abrupt("return",t.manifest);case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()).catch((function(n){var r=n.error,i=n.metric;r===Ln&&(t.trigger(V),t.logger.error("MANIFEST LOADED: duration: ".concat(i.duration/1e3,", url: ").concat(e)),t.sendMetric(i)),t.updating=!1}))}},{key:"fetch",value:function(e){var t=this,n=this.httpConfig.manifest,r=void 0===n?{}:n,i=r.retryAttempts,a=r.retryDelay,o=r.withCredentials;return jn.get(e,Ci(Ci(Ci({cancelToken:new jn.CancelToken((),withCredentials:this.streamWithCredentials||!!o},i&&{retryAttempts:i}),a&&{retryDelay:a}),{},{headers:this.headers,params:this.params}))}},{key:"sendMetric",value:function(e){this.player.trigger(G,{duration:e.duration,status:e.status,statusCode:e.statusCode,timestamp:(new Date).getTime(),url:e.url,type:"MANIFEST"})}},{key:"minBufferTime",get:,{key:"maxBufferLength",get:function(){var e=this.options.get(ft);return this.startBufferLength>=e?this.startBufferLength+1:e},set:,{key:"startBufferLength",get:function(){return this.options.get(At)}},{key:"minAutoBitrate",get:function(){return this.options.get(ht)}},{key:"maxAutoBitrate",get:,{key:"suggestedPresentationDelay",get:function(){var e;return null===(e=this.manifest)||void 0===e?void 0:e.suggestedPresentationDelay}},{key:"segmentDuration",get:function(){return this.videoAdaptation.segmentTemplate?this.videoAdaptation.segmentTemplate.segmentDuration?this.videoAdaptation.segmentTemplate.segmentDuration/this.videoAdaptation.segmentTemplate.timescale:this.videoAdaptation.segmentList.length?this.videoAdaptation.segmentList[0].duration:0:0}},{key:"destroy",value:function(){this.monitorTimer&&this.monitorTimer.stop(),this.utcTime.stop(),this.abort()}},{key:"abort",value:,{key:"getPresentationTimeOffset",value:,{key:"parse",value:function(e,t,n){return this.parser.parse(e,t,n)}},{key:"updateManifest",value:,{key:"isIndexMode",value:,{key:"isLive",value:,{key:"getLiveDelay",value:function(){if(this.startBufferLength)return this.startBufferLength;var e=this.options.get(Ge),t=this.options.get(lt),n=this.options.get(mt);return t||Math.max(n,this.suggestedPresentationDelay||e)}},{key:"getAudioProfiles",value:function(e){return this.getRepresentationsByType(ti.AUDIO,e)}},{key:"getVideoProfiles",value:function(e){return this.getAdaptationSetsByType(ti.VIDEO,e).reduce((function(e,t){var n=t.representations;return[].concat(zt(e),zt(n))}),[]).sort(()}},{key:"getVideoNearestBandwidth",value:function(e,t){var n=this.getVideoProfiles(t).map((function(e){return e.bandwidth}));return n.find(()||n[n.length-1]}},{key:"getTextAdaptations",value:,{key:"getAudioAdaptations",value:,{key:"getAudioAdaptation",value:function(e,t){var n=this.getAudioAdaptations(t),r="string"==typeof e?"lang":"id";return n.find((function(t){return t[r]===e}))}},{key:"getAudioTracks",value:function(){return this.getAudioAdaptations().map(()}},{key:"updateTimeLine",value:function(e){var t=i(this.getPeriods().slice().reverse(),1)[0];this.getAllAdaptationSets(t).forEach((function(t){t.segmentTemplate&&vi(t,e),t.representations.forEach((function(t){t.hasOwnSegments&&t.segmentTemplate.hasIndex&&vi(t,e)}))}))}},{key:"getLastSegmentByType",value:function(e){var t=i(this.getPeriods().slice(-1),1)[0],n=i(this.getRepresentationsByType(e,t),1)[0];if(this.createSegmentsOnTheFly&&n.indexMode)return this.utcTime.getTime()-n.availabilityStartTime;var r=(n||{}).segmentList;return null==r?void 0:r[(null==r?void 0:r.length)-1]}},{key:"getFirstSegmentStartTimeByType",value:function(e){var t,n,r=i(this.getRepresentationsByType(e),1)[0];if(this.createSegmentsOnTheFly&&r.indexMode){var a=r.dvrWindow,o=r.timeShiftBufferDepth,s=Math.max(0,a)||o||this.utcTime.getTime()-r.availabilityStartTime;return this.utcTime.getTime()-r.availabilityStartTime-s}return(null==r||null===(t=r.segmentList)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.start)||0}},{key:"getStartTime",value:,{key:"getAdaptations",value:function(e,t,n){return this.manifest&&this.getAdaptationsSetByType(e,t,n)}},{key:"getAllAdaptationSets",value:,{key:"getAdaptationSetMimeType",value:function(e){var t=i(this.getAdaptations(e),1)[0];return t&&"".concat(t.mimeType,"; codecs=").concat(t.codecs)}},{key:"getPeriods",value:,{key:"getPeriod",value:function(e){var t,n;return(null===(t=this.getPeriods())||void 0===t?void 0:t.find((function(t){var n=t.id,r=t.start;return n===(null==e?void 0:e.id)&&r===(null==e?void 0:e.start)})))||(null===(n=this.getPeriods())||void 0===n?void 0:n[0])}},{key:"getNextPeriod",value:function(e){var t=this.getPeriods(),n=t.indexOf(e);return n>=0&&t[n+1]}},{key:"getLastPeriod",value:,{key:"getPeriodById",value:function(e){var t,n;return(null===(t=this.getPeriods())||void 0===t?void 0:t.find((function(t){return t.id===e})))||(null===(n=this.getPeriods())||void 0===n?void 0:n[0])}},{key:"getAdaptationSetById",value:function(e,t){var n;return null===(n=this.getPeriod(t))||void 0===n?void 0:n.adaptationSets.find((function(t){return t.id===e}))}},{key:"getAdaptationsSetByType",value:function(e,t){var n;return null===(n=this.getPeriod(t))||void 0===n?void 0:n.adaptationSets.filter((function(t){return t.type===e}))}},{key:"getAdaptationSetsByType",value:function(e,t,n){var r=this.getAdaptationsSetByType(e,t);if(n){var i=n.id,a=n.lang;return r.filter(()||r.filter((function(e){return e.lang===a}))||r}return r}},{key:"getAdaptationSetByType",value:function(e,t,n){var r;return(null===(r=this.getAdaptationSetsByType(e,t,n))||void 0===r?void 0:r[0])||null}},{key:"getRepresentationsByType",value:function(e,t){var n=this.getAdaptationSetByType(e,t);return null===n?[]:n.representations}},{key:"getRepresentationByBandwidth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ti.VIDEO,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=this.getAdaptationSetsByType(t,n,r),a=i.reduce((function(e,t){var n=t.representations;return[].concat(zt(e),zt(n))}),[]),o=e||this.getAverageBandwidth(a);return a.find(()||null}},{key:"getAverageBandwidth",value:function(e){var t=e.map(();return t[Math.floor(t.length/2)-(t.length%2==0?1:0)]}},{key:"findPeriodByTime",value:function(e){var t=this.manifest.periods;return(null==t?void 0:t.find((function(t){var n=t.start,r=t.end;return e>=n&&e<(r||1/0)})))||(null==t?void 0:t[0])}}]),n}(S);const _i={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4};var Ni="abort",Bi="error",Fi="updateend";const ji=function(){eturn d(e,[{key:"currentTask",get:,{key:"addTask",value:function(e){var t,n,r=new Promise((),i={fn:e,p:{resolve:t,reject:n}};return this.taskQueue.push(i),1===this.taskQueue.length&&this.runTask(),r}},{key:"runTask",value:function(){var e=i(this.taskQueue,1)[0];if(e&&!this.sourceBuffer.updating)try{e.result=e.fn()}catch(t){this.taskQueue.shift(),e.p.reject(t),this.runTask()}}},{key:"onSuccess",value:function(){var e=this.taskQueue.shift();e.p.resolve(e.result),this.runTask()}},{key:"onError",value:function(e){i(this.taskQueue,1)[0].p.reject(e)}},{key:"empty",value:function(){for(var e;e=this.taskQueue.shift();)e.p.reject()}}]),e}();const Ui=function(e,t){var n=e.addSourceBuffer(t),r=new ji(n),i=0,a=1/0;function o(e,t){i=e,a=t,n.appendWindowStart=0,n.appendWindowEnd=a,n.appendWindowStart=i,l()}function s(e){for(var t=u()||[],n=0;n<t.length;n++){var r=t.start(n),i=t.end(n);if(e>=r&&e<i)return{start:r,end:i}}return null}unction c(e){return r.addTask(e)}function l(){r.onSuccess()}eturn n.mimeType=t,n.addEventListener(Fi,l),n.addEventListener(Bi,d),n.addEventListener(Ni,d),{abort:function(){var e;if(!(null===(e=r.currentTask)||void 0===e?void 0:e.fn.toString().includes("remove")))try{n.abort(),c(()}catch(e){}},appendBuffer:destroy:function(){n.removeEventListener(Fi,l),n.removeEventListener(Bi,d),n.removeEventListener(Ni,d),r.empty()},getBufferRange:s,getBufferRanges:function(){for(var e=u()||[],t=[],n=0;n<e.length;n++){var r=e.start(n),i=e.end(n);t.push({start:r,end:i})}return t},getBufferLength:function(e){var t=s(e);return t?t.end-e:0},getAppendWindow:queue:c,remove:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1?arguments[1]:void 0;n.remove(t,r||e.duration||Number.MAX_VALUE)},setAppendWindow:o,setTimestampOffset:};function Vi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vi(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Wi.prototype=Object.create(S.prototype);function Wi(e,t,n){var r=this,i=e.options,a=i.get(Ve),s=i.get(Rt),u=e.getComponent(Ht),c=e.getComponent(Wt),l=kn.get("".concat(t,"-stream")),d=kn.get(Oe),f=i.get(ot)||{},h=(null==f?void 0:f.fragment)||{},g=h.headers,m=h.params,p=null,v=null,b=[],T={},E=!1,S=!1,k=null,w=!1,D=!1,O=null,A=0,L=void 0;function P(){M(),_(),v=null,b=[],k=null,S=!1}function R(){S=!1,D=!1,C()}function I(e,n){var r,i=B(e),a=v||{},o=a.start,s=a.duration,c=e+(i>n?i:n);if(null!==v||t!==ti.AUDIO&&t!==ti.TEXT||(c=e+n),null!==v&&c<=o+s&&(c=o+s+.01),null!==(r=L)&&void 0!==r&&r.end&&v){var l,d=p.segmentList,f=(null===(l=d[d.length-1])||void 0===l?void 0:l.start)===v.start,h=u.getNextPeriod(L);f&&h&&(c=h.start)}if(!(c-e>u.maxBufferLength+1))return c}function C(){return x.apply(this,arguments)}function x(){return(x=o(y().mark((function e(){var i,a,o,s,c,l,d,f;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(w||D||E)){e.next=2;break}return e.abrupt("return");case 2:if(i=n(),a=i.time,o=i.bufferLength,s=I(a,o),!isNaN(s)){e.next=6;break}return e.abrupt("return");case 6:if(c=u.findPeriodByTime(s),L&&L.id!==(null==c?void 0:c.id)&&(D=!0,S=!1,G("NEXT PERIOD: ".concat(c.id,", PREV: ").concat(L.id))),S||!c){e.next=28;break}if(l=t===ti.VIDEO?u.getVideoNearestBandwidth(A,c):A,p=u.getRepresentationByBandwidth(l,t,c,O)){e.next=13;break}return e.abrupt("return");case 13:return r.trigger($,c),r.trigger(Wr,p,c),G("START LOADING INIT: ".concat(p.bandwidth,", PERIOD: ").concat(c.id)),E=!0,e.next=19,H(p,c);case 19:if(d=e.sent,D=!1,k=null,E=!1,d){e.next=25;break}return e.abrupt("return");case 25:G("LOADED INIT: ".concat(p.bandwidth,", PERIOD: ").concat(c.id)),S=!0,b.push(d);case 28:if(L=c,G("LOOKING FOR SEGMENT: [".concat(p.id,"]: start: ").concat(s,", bandwidth: ").concat(p.bandwidth/1e3)),f=F(s,p)){e.next=33;break}return e.abrupt("return");case 33:if(G("FOUND SEGMENT: [".concat(p.id,"]: start: ").concat(f.start,", id: ").concat(f.index,", bandwidth: ").concat(p.bandwidth/1e3)),!(null!==v&&v.start>=f.start)){e.next=36;break}return e.abrupt("return");case 36:return e.abrupt("return",W(f,p,o).then((function(){return f})));case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}unction _(){k?k():E=!1}function N(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];b=e?[]:b.filter(()}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return b.filter((function(t){var n=t.start,r=t.duration;return n>=e||n<e&&n+r>e})).reduce((function(t,n,r){var i=n.start,a=n.duration;return 0===r&&(t-=e-i),t+a}),0)}function F(e,n){var r;if(isNaN(e))return null;if(e=Math.max(0,di(e)),!n){var i=u.findPeriodByTime(e),o=A;t===ti.VIDEO&&(o=u.getVideoNearestBandwidth(A,i)),n=u.getRepresentationByBandwidth(o,t,i,O)}if(a&&n.indexMode){var s=n,c=s.availabilityStartTime,l=s.segmentTemplate,d=l.maxIndex,f=l.offset,h=l.segmentDurationInSeconds,g=l.startNumber,m=Math.min(d,Math.floor(e/h)+g),p=new gi;return p.index=m,p.start=Math.max(0,di((m-1)*h-f)),p.startTime=p.start+c-f,p.duration=h,p}var v=(null===(r=n)||void 0===r?void 0:r.segmentList)||[];if(!v.length)return null;(0===e||e<v[0].start)&&(e=di(v[0].start));for(var y,b=0,T=v.length-1;b<=T;){var E=v[y=(b+T)/2|0],S=E.start,k=E.duration,w=di(S),D=di(w+k);if(e>=w&&e<D)return E;w>e?T=y-1:b=y+1}return null}function j(){var e;return null===(e=p)||void 0===e?void 0:e.segmentList}function U(){var e=(p||{}).indexMode;if(a&&e)return F(u.duration);var t=j();return null==t?void 0:t[t.length-1]}function V(e){if(a&&p.indexMode)return F(e.start+e.duration);var t=j(),n=t.indexOf(e)+1;return n>=t.length-1?t[t.length-1]:t[n]}function H(e,n){var i="".concat(n.id,"_").concat(e.adaptationSetId,"_").concat(e.id);if(T[i])return Promise.resolve(T[i]);var a=function(e){var t=e.bandwidth,n=e.id,r=e.segmentTemplate;return[e.url,r.initialization].join("").replace("$RepresentationID$",n).replace("$Bandwidth$",t)}(e),o=n.start,s=n.end,u=e.bandwidth,c=e.id,l=e.segmentTemplate,d=l.presentationTimeOffset,f=l.timescale,h={appendWindowStart:o,appendWindowEnd:s||1/0,bandwidth:u,duration:0,index:-1,mediaType:t,offset:o-(d/f||0),representationId:c,periodId:n.id,type:"initialization"};return Y(a).then((function(e){var t=e.data,n=e.metric,a=Hi(Hi({},h),{},{data:t});return T[i]=a,r.trigger(Kr,Hi(Hi({},n),{},{segmentInfo:h})),a})).catch((function(e){var t=e.error,n=e.metric,i=e.xhr;t===Ln&&r.trigger(Hr,Hi(Hi({},n),{},{segmentInfo:h}),i)}))}function W(e,t,n){var i=fi(t,e),a=e.start,o=e.duration,s=e.index,u=t.id,d=t.bandwidth,f=t.mediaType,h=t.periodId;E=!0;var g={bandwidth:d,duration:o,index:s,mediaType:f,representation:t,representationId:u,start:a,periodId:h};return Y(i,{onProgress:function(e){Pn&&e.bps>0&&e.loaded>5e3&&r.trigger(Gr,Hi(Hi({},e),{},{status:Pn,buffer:n}))}}).then((function(t){var n=t.data,i=t.metric;v=e,i.segmentInfo=g,l.info("[".concat(c.getCurrentTime(),"] DOWNLOADED SEGMENT: [").concat(u,"]: start: ").concat(g.start,", id: ").concat(s,", bandwidth: ").concat(d/1e3)),b.push(Hi(Hi({},g),{},{data:n})),r.trigger(Kr,i)})).catch((function(e){var t=e.error,n=e.metric,i=e.xhr;t===Ln&&(n.segmentInfo=g,r.trigger(Hr,n,i))})).then(()}function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=f||{},r=n.fragment,i=void 0===r?{}:r,a=i.retryAttempts,o=i.retryDelay,u=i.withCredentials;return jn.getBinary(e,Hi(Hi(Hi(Hi({},t),{},{cancelToken:new jn.CancelToken((),withCredentials:s||!!u},a&&{retryAttempts:a}),o&&{retryDelay:o}),{},{headers:g,params:m}))}function G(e){l.trace("[".concat(c.getCurrentTime(),"] ").concat(e))}return{on:r.on.bind(r),off:r.off.bind(r),trigger:r.trigger.bind(r),switchAdaptation:function(e,t){var n=e.id,r=e.lang;void 0!==n&&(O={id:n,lang:r},p=null,D=!1,t&&(P(),C()),G("START SWITCHING: [".concat(n,"] ").concat(r)))},switchProfile:function(e,t){G("START SWITCHING PROFILE: ".concat(e)),d.info("PROFILE START SWITCHING ".concat(e)),A=e,t&&(P(),C())},getAdaptation:getBandwidth:function(){return A},getPeriod:getRepresentation:function(){return p},findSegmentByPosition:F,getNextSegmentToSwitch:function(e){var t,n=F(Math.round(e)),r=0,i=0;if(null===n)return null;for(;r<n.duration&&i<4;)r=(t=V(n)).start-e,n=t,i++;return t},getQueue:function(){return b},getQueueStart:function(){return b.length?b[0].start:null},getAllSegments:j,getQueueLengthFromTime:B,start:R,stop:function(){D=!0,_(),v=null,b=[],S=!1},next:C,pause:M,abort:_,update:function(){_(),N(!1),v=null,C()},flush:N,resume:function(){if(D)return!1;w=!1,S||E||R()},restart:getLastSegment:U,isLastSegment:function(e){var t,n,r=e.index;return(p||{}).periodId===(null===(t=u.getLastPeriod())||void 0===t?void 0:t.id)&&(null===(n=U())||void 0===n?void 0:n.index)===r},isProcessingRequest:function(){return E}}}var Yi="open",Gi=.1;function Ki(e,t,n){var r=this,a=kn.get("".concat(t,"-stream")),s=kn.get(Oe),u=e.getComponent(Ht),c=e.getComponent(Wt),l=e.getComponent(Yt),d=e.options,f=!1,h=!1,g=null,m=!1,p=!1,v=0,b=!1,T=!1,E=void 0,S=u.maxBufferLength,k=new Wi(e,t,O);k.on(Hr,(),k.on(Kr,(),t===ti.AUDIO&&k.on(Wr,(function(e,t){var n=e.adaptationSetId,i=u.getAdaptationSetById(n,t);r.trigger(L,i)})),t===ti.VIDEO&&(e.on(ie,(function(){return _(0,Math.max(0,c.getCurrentTime()-2))})),k.on(Gr,(function(e){r.trigger(Gr,e)})),k.on(Wr,(function(e){r.trigger(ae,e)})),k.on($,(function(t){e.trigger($,t)}))),e.once(J,(function(){p=!0}));var w=new Nr(500,A);unction O(){var e=c.getCurrentTime();return{time:c.getReadyState()===_i.HAVE_NOTHING?v:e,bufferLength:g.getBufferLength(e)}}unction P(){return P=o(y().mark((function e(){var n,o,l,d,h,p,v,w,D,L,P,I,C,_,B,F,j,U,V;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==g&&!b){e.next=2;break}return e.abrupt("return");case 2:if(n=O(),o=n.time,l=n.bufferLength,d=c.getDuration(),h=k.getQueueLengthFromTime(o),x(),h+l>S?k.pause():k.resume(),k.next(),p=R(o),v=Math.min(S,120),!(p>=h&&o+h<d-Gi&&t===ti.VIDEO)){e.next=12;break}return e.abrupt("return");case 12:if(m=!0,w=k.getQueue(),D=i(w,1),!((L=D[0])&&l<v)){e.next=23;break}if(L!==E){e.next=17;break}return e.abrupt("return");case 17:return E=L,-1===L.index&&(I=u.duration,C=!u.isLive()&&k.getPeriod()===(null===(P=u.getLastPeriod())||void 0===P?void 0:P.id)&&I,_=C||L.appendWindowEnd+.5,g.queue(().catch((function(){})),g.queue((function(){return g.setAppendWindow(Math.max(0,L.appendWindowStart-1),_)})).then((function(){var e=g.getAppendWindow(),t=e.appendWindowStart,n=e.appendWindowEnd;a.info("[".concat(c.getCurrentTime(),"] APPEND WINDOW: start: ").concat(t,", end: ").concat(n,", offset: ").concat(L.offset))})).catch((function(){}))),e.next=21,g.queue(().catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(null==L?void 0:L.segmentInfo)||{},r=n.index,i=n.start,o=n.representationId,s=n.periodId,u="[".concat(c.getCurrentTime(),"] ERROR APPEND ").concat(null==t?void 0:t.toUpperCase());return u+=" ".concat(r,", ").concat(i,", ").concat(o," ").concat(s,", ERROR: ").concat(e.code,", ").concat(e.message),a.error(u),E=void 0,22===e.code?S=Math.max(10,S-5):T?(T=!1,k.restart()):T=!0,!1}));case 21:e.sent&&(T=!1,t===ti.VIDEO&&r.trigger(Yr,L),B=(L.bandwidth/1e3).toFixed(0)||"",F="APPENDED SEGMENT [".concat(L.representationId,"]:"),F+=" id: ".concat(L.index,", "),L.index>=0&&(F+="start: ".concat(L.start,", "),F+="end: ".concat(L.start+L.duration,", "),F+="duration: ".concat(L.duration,", ")),F+="bandwidth: ".concat(B),a.info("[".concat(c.getCurrentTime(),"] ").concat(F)),s.debug("SEGMENT APPENDED - [".concat(t,"][").concat(B,"][").concat(L.index,"] ").concat(L.start||"")),j=g.getBufferRanges().reduce((function(e,t){var n=t.start,r=t.end;return e+=" | ".concat(n," - ").concat(r," ")}),""),a.info("[".concat(c.getCurrentTime(),"] BUFFER RANGES: ").concat(j)),L.index>=0&&f&&(N(),f=!1),U=k.getQueue(),(V=U.indexOf(L))>=0&&U.splice(V,1),!u.isLive()&&k.isLastSegment(L)&&M(),A());case 23:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}function R(t){var n=u.minBufferTime;if(!p){var r;isNaN(u.startBufferLength)||(n=u.startBufferLength);var i,a=e.getDownloadSpeed(),o=null===(r=k.getRepresentation())||void 0===r?void 0:r.bandwidth;if(o&&a>0&&1.25*a<o)n=(null===(i=k.findSegmentByPosition(t))||void 0===i?void 0:i.duration)||2}return n}function I(){return I=o(y().mark((function e(t){var n,i=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],!t){e.next=7;break}return f=n,k.switchAdaptation(t,!!g),e.next=6,_(0);case 6:r.trigger(L,t);case 7:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function C(){return C=o(y().mark((function e(t,n){var r,i,a,o,s,u,l,h=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>2&&void 0!==h[2]&&h[2],t!==k.getBandwidth()){e.next=3;break}return e.abrupt("return");case 3:if(g&&k.pause(),n&&g){e.next=7;break}return k.switchProfile(t,!!g),e.abrupt("return");case 7:if(!r){e.next=13;break}return e.next=10,_();case 10:f=!0,e.next=22;break;case 13:if(a=d.get(Je),o=d.get(et),s=c.getCurrentTime(),u=a?s+a:Math.max(null===(i=k.getNextSegmentToSwitch(s))||void 0===i?void 0:i.start,o)-Gi,l=g.getBufferLength(s),!(l+s-u>0)){e.next=22;break}return e.next=22,_(u);case 22:k.switchProfile(t,!!g);case 23:case"end":return e.stop()}}),e)}))),C.apply(this,arguments)}function x(){if(!u.isLive()&&l.getReadyState()===Yi){var e=k.getLastSegment();if(e){var t=c.getCurrentTime(),n=u.getLastPeriod();Math.round(t)>=Math.round(null==e?void 0:e.start)&&u.findPeriodByTime(t)===n&&k.getPeriod()===n.id&&M()}}}unction _(e,t){return!g||t<=e?Promise.resolve():g.queue(().then((function(){r.trigger(qr,e,t),a.info("[".concat(c.getCurrentTime(),"] CLEAR BUFFER: ").concat(e," - ").concat(t||"Infinity"))})).catch((function(){}))}function N(){c.seek(c.getCurrentTime()-.05)}eturn{on:r.on.bind(r),off:r.off.bind(r),trigger:r.trigger.bind(r),init:function(){E=void 0,g=new Ui(l,n),w.start(),k.start()},abort:D,update:A,pause:function(){b=!0},resume:function(){b=!1},stop:function(){w.stop(),D(),l.endOfStream(),k.stop(),null!==g&&(l.getReadyState()===Yi&&g.abort(),g.destroy(),g=null)},clearBuffer:_,getAdaptation:function(){return k.getAdaptation()},findSegmentByPosition:B,getNearestSegmentPosition:function(e){var t=B(e);return null!==t?t.start:-1},setStartTime:function(e){v=e},isStreamStarted:function(){return m},isProcessingRequest:function(){return k.isProcessingRequest()},switchProfile:updatePosition:function(e){v!==e&&(v=e,0===g.getBufferLength(e)&&k.update(),A())},switchTrack:setMaxBufferLength:getRepresentation:function(){return k.getRepresentation()},getRepresentations:sourceOpen:isEndOfStream:function(){return h},endOfStream:getMediaType:function(){return t},getSegmentManager:}i.prototype=Object.create(S.prototype);var zi=E.isTizen()?.1:0,Qi=function(e){g(n,e);var t=qi(n);function n(e){var r;return u(this,n),(r=t.call(this,e)).player=e,r.options=e.options,r.timeShift=e.timeShift,r.mediaElement=e.getComponent(Wt),r.manifestManager=e.getComponent(Ht),r.streamManager=null,r.videoStream=null,e.addComponent(f(r),Gt),r.isLive=!1,r.liveDelay=0,r.lastPosition=-1,r.deadlockTimeout=0,r.decodedFrameCount=-1,r.frameDeadlockTimeout=null,r.hasFrameDeadlockTimeout=!1,r.hasDeadlockTimeout=!1,r.metric={},r.segmentList=[],r.lastProfile=null,r.isMetadataLoaded=!1,r.timer=new Nr(250,(function(){return r.monitor()})),r.player.on(I,(function(){return r.destroy()})),r.player.on(ge,(function(){return r.destroy()})),r.player.on(C,(function(){return r.destroy()})),r.player.on(Te,(function(){return r.seekToNextBufferRangeStart()})),r.player.on(W,(),r}return d(n,[{key:"observe",value:function(){var e=this;this.destroy(),this.isLive=this.manifestManager.isLive(),this.timer.start(),this.streamManager=this.player.getComponent(Gt),this.videoStream=this.streamManager.getVideoStream(),this.videoStream&&(this.videoStream.on(Yr,(),this.videoStream.on(qr,()),this.isLive&&(this.liveDelay=this.manifestManager.getLiveDelay())}},{key:"seekToNextBufferRangeStart",value:function(){var e,t=this.mediaElement.getCurrentTime(),n=(null===(e=this.mediaElement.getPlayed())||void 0===e?void 0:e.length)?t+2:Number.MAX_SAFE_INTEGER;if(this.mediaElement.hasBuffered()){var r=this.mediaElement.getBufferRange(t,n);r&&r.start!==t&&this.mediaElement.seek(r.start+zi)}}},{key:"monitor",value:function(){var e,t=this,n=this.streamManager.getStartTime(),r=this.streamManager.isProcessingRequest(),i=this.mediaElement.getCurrentTime(),a=this.mediaElement.getBufferLengthFromTime(i+zi),o=this.mediaElement.getReadyState(),s=null===(e=this.mediaElement.getPlayed())||void 0===e?void 0:e.length,u=Date.now(),c=this.streamManager.isStreamsStarted(),l=!this.options.get(Ke);if(this.detectProfileChange(i),this.isMetadataLoaded){if(this.options.get(Ot)&&c&&!s&&!this.lastPosition&&0===i&&n>0&&this.mediaElement.seek(n),0===a&&o<=_i.HAVE_CURRENT_DATA){var d=this.manifestManager.getStartTime();s&&this.timeShift.isEnabled()&&i>=0&&i<d?this.mediaElement.seek(d):this.seekToNextBufferRangeStart()}if(this.mediaElement.isPaused())return this.hasFrameDeadlockTimeout=!1,void clearTimeout(this.frameDeadlockTimeout);o===_i.bufferLength&&a<2&&this.seekToNextBufferRangeStart(),o===_i.HAVE_METADATA&&n>i&&Math.abs(n-i)<2&&this.mediaElement.seek(n);var f=this.mediaElement.getDecodedFrameCount();if(f<this.decodedFrameCount&&(f=this.decodedFrameCount),l&&this.videoStream&&a>0&&this.decodedFrameCount>=0&&f===this.decodedFrameCount&&!document.hidden){if(!this.hasFrameDeadlockTimeout){var h=3e3;this.options.get(Ot)&&(h+=3e3),this.decodedFrameCount=f,this.hasFrameDeadlockTimeout=!0,this.frameDeadlockTimeout=setTimeout((function(){t.hasFrameDeadlockTimeout=!1,t.mediaElement.seek(t.mediaElement.getCurrentTime()+.1)}),h)}}else this.hasFrameDeadlockTimeout=!1,clearTimeout(this.frameDeadlockTimeout);if(o>_i.HAVE_METADATA&&!r&&(Math.floor(this.lastPosition)>0&&this.lastPosition===i||0===a)){var g=this.mediaElement.getBufferRange(i);if(null!==g&&i+5>g.start)this.mediaElement.seek(g.start+1e-5);else if(!this.hasDeadlockTimeout&&this.isLive)return this.hasDeadlockTimeout=!0,void(this.deadlockTimeout=setTimeout((function(){var e;null===(e=t.streamManager)||void 0===e||e.reconnect(0),t.hasDeadlockTimeout=!1}),5e3))}else clearTimeout(this.deadlockTimeout),this.hasDeadlockTimeout=!1,this.decodedFrameCount=f;if(o<=_i.HAVE_CURRENT_DATA)if(this.metric.time!==i||this.metric.bufferLength!==a||l&&this.metric.decodedFrameCount!==f)this.metric.lastChange=u,this.metric.time=i,this.metric.bufferLength=a,this.metric.decodedFrameCount=f;else if((u-this.metric.lastChange)/1e3>2&&c&&(this.metric.lastChange=u,a>0)){var m,p=(null===(m=this.streamManager.getVideoStream())||void 0===m?void 0:m.findSegmentByPosition(i))||{},v=p.start,y=p.duration;v&&y&&this.mediaElement.seek(v+y)}this.lastPosition=i,clearTimeout(this.hasDeadlockTimeout)}}},{key:"onSegmentAppended",value:function(e){var t=e.index,n=e.representation,r=e.start,i=e.duration;if(!(t<0)){var a=r+i,o=this.segmentList.find(();o?o.representation=n:this.segmentList.push({start:r,stop:a,representation:n})}}},{key:"onSourceBufferCleared",value:function(e,t){this.segmentList=this.segmentList.reduce((function(n,r){return e<=r.start&&t>=r.stop||n.push(r),n}),[])}},{key:"detectProfileChange",value:function(e){var t=this.segmentList.find(();if(t){var n=t.representation,r=n.bandwidth;r!==this.lastProfile&&this.trigger(ie,n),this.lastProfile=r}}},{key:"destroy",value:function(){clearTimeout(this.deadlockTimeout),clearTimeout(this.frameDeadlockTimeout),this.decodedFrameCount=-1,this.lastPosition=0,this.hasDeadlockTimeout=!1,this.hasDeadlockTimeout=!1,this.hasFrameDeadlockTimeout=!1,this.isMetadataLoaded=!1,this.timer.stop(),this.lastProfile=null,this.segmentList=[]}}]),n}(S);const Xi=Qi;var $i=Zi=function(){function e(t){var n=this;u(this,e),this.player=t,this.currentPeriod=null,this.manifestManager=t.getComponent(Ht),this.mediaElement=t.getComponent(Wt),this.logger=kn.get("period"),this.options=t.options,this.periodObserverInterval=this.options.get(Pt),this.timer=new Nr(this.periodObserverInterval,(function(){return n.onTimer()}),!0),this.player.once(J,(),this.player.once(I,(function(){return n.timer.stop()})),this.player.once(ge,(function(){return n.timer.stop()})),this.player.once(C,()}return d(e,[{key:"init",value:,{key:"onTimer",value:function(){var e=this.mediaElement.getCurrentTime(),t=this.manifestManager.findPeriodByTime(e);this.currentPeriod!==t&&(this.currentPeriod&&this.currentPeriod.off(),this.updatePeriod(t,e))}},{key:"getCurrentPeriod",value:,{key:"updatePeriod",value:function(e,t){var n=this;this.currentPeriod=e,this.currentPeriod.on(Z,(),this.player.trigger(X,$i(this.currentPeriod));var r=this.currentPeriod,i=r.id,a=r.start,o=r.duration;this.logger.info("[".concat(t,"] PERIOD CHANGED: ").concat(this.currentPeriod.id," ").concat(i,", ").concat(a," ").concat(o))}}]),e}();const Ji=Zi;r na=1e6;function ra(e){var t=this,n=e.getComponent(Wt),r=e.getComponent(Ht),a=e.timeShift,o=e.options,s=o.get(wt),u=new Ji(e),c=new Xi(e),l=new Nr(5e3,(function(){var e=o.get(Be);if(e&&!n.isSeeking()){var t=n.getCurrentTime()-e;t>0&&O(0,t)}})),d=null,f=!1,h=0,g=[],m=null,p=null,v=null,y=!1;function b(n,r){var i=new Ki(e,n,r);return i.on(Ur,w),i.on(Gr,(),i.on(Kr,(),i.on(Hr,(function(e,n){y||(T(e),f&&P()<1&&D(2e3),e.status===Ln&&t.trigger(Hr,e.url,n))})),i.on(L,(function(t){var n=C(t);v=n.lang,e.trigger(L,n)})),i.on(ae,(function(e){return t.trigger(ae,e)})),i}function T(t){e.trigger(G,ta(ta({},t),{},{downloadingBitrate:t.bps,type:"SEGMENT"}))}function S(e,t,n){var r;l.restart(),null===(r=m)||void 0===r||r.switchProfile(e,t,n)}function k(e,t){var i=r.findPeriodByTime(n.getCurrentTime()),a=r.getAudioAdaptation(e,i);p.switchTrack(a,t)}function w(){var e=g.every(();d.getReadyState()===Yi&&e&&d.endOfStream()}function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;t.trigger(ue,e)}function O(e,t){d.getReadyState()===Yi&&g.forEach(()}function A(){return a.getDvrWindow()>=0?a.getDvrWindow():a.getStart()>=0&&a.getStop()<0?a.getLiveNowUTC()<0?0:a.getLiveNowUTC()-a.getStart():a.getStart()>=0&&a.getStop()>=0?a.getStop()-a.getStart():n?n.getDuration():0}function P(){return(null==n?void 0:n.getBufferLength())||0}function R(){var e=o.get(Lt),t=0;if(e)return o.set(Lt,null),e;if(f)t=I(),g.forEach((function(e){return e.setStartTime(t)}));else{var n=[];g.forEach((function(e){var t,a,o=i(r.getAdaptations(e.getMediaType()),1)[0],s=e.getNearestSegmentPosition((null===(t=o.segmentList)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.start)||0);e.setStartTime(s),n.push(s)})),t=Math.max.apply(Math,n)}return Math.round(1e3*t)/1e3}function I(){var t=0,n=a.getBaseTimeStamp(),i=r.getStartTime(),s=r.getLastSegmentByType(ti.VIDEO)||r.getLastSegmentByType(ti.AUDIO),u=s.start+s.duration,c=u-r.getLiveDelay(),l=a.getPlayStart()-n,d=a.getStart()-n,f=e.getLiveNowUTC()-n-u;if(t=c,f>0&&(t+=f),!r.isIndexMode()){var h=Math.min(2*s.duration,o.get(Ge)),g=s.start-h;t=Math.min(t,g)}return a.getMode()===sr&&l>=0&&d<=l&&c>=l&&(t=l-d,a.getDvrWindow()>0&&(t=l)),Math.max(i,t)}eturn l.immediateUpdate=!1,c.on(ie,(function(e){return function(e){t.trigger(ie,e)}(e)})),{on:t.on.bind(t),off:t.off.bind(t),trigger:t.trigger.bind(t),getCurrentTime:function(){var e=(null==n?void 0:n.getCurrentTime())||0;return 0===e||a.isEnabled()&&a.isVod()?e:f&&!a.isEnabled()&&e>0?e+a.getAvailabilityStartTime():f&&a.isEnabled()?a.getBaseTimeStamp()+e-a.getStart():e},getDuration:A,destroy:function(){l.stop(),g.forEach((),g=[]},reconnect:D,initStreams:createStreams:function(e,n){d=e,f=n,y=!1;var i,a,s,l,T,w,D,O,A,L=r.getAdaptationSetMimeType(ti.AUDIO),P=r.getAdaptationSetMimeType(ti.VIDEO);if(L){var I=o.get(We);p=b(ti.AUDIO,L),g.push(p),k(v||I||E.getLanguage())}if(P&&(m=b(ti.VIDEO,P),g.push(m)),h=R(),P){var C=r.findPeriodByTime(h),x=r.getAdaptationSetByType(ti.VIDEO,C),M=r.getAverageBandwidth(null==x?void 0:x.representations),_=(T=1e3*o.get(Ye),w=o.get(ut)?parseFloat(null===(i=localStorage)||void 0===i?void 0:i.getItem(Lr)):0,D=(null===(a=r.getAudioProfiles()[0])||void 0===a?void 0:a.bandwidth)||0,O=o.get(Mt)?(null===(s=navigator)||void 0===s||null===(l=s.connection)||void 0===l?void 0:l.downlink)*na-D:0,(A=T||O||w)&&r.getVideoNearestBandwidth(A)||M),N=r.getRepresentationByBandwidth(_,ti.VIDEO,C);S(_),t.trigger(ie,N)}c.observe(),u.updatePeriod(r.findPeriodByTime(h),h)},hasActiveStreams:function(){return g.length},getBufferLength:P,getStartTime:function(){return h},clearBuffer:O,updatePosition:function(e){g.forEach((function(t){return t.updatePosition(e)}))},seek:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,o=A()-e.getLiveDelay(),u=o*t/100;if(u>o&&(u=o),a.isEnabled()){var c=r.getStartTime();u=Math.max(c,e.getLiveStartUTC()+u-a.getBaseTimeStamp())}if("time"!==i&&(u=m.getNearestSegmentPosition(u)),100===t&&a.isEnabled())return a.setLive(),l.restart(),h=R(),void n.seek(h);u>=0&&n.seek(u)},seekToHead:switchProfile:S,getProfiles:function(){return m.getRepresentations()},getCurrentProfile:function(){return m.getRepresentation()},getCurrentAudioTrack:getCurrentPeriod:setMaxBufferLength:function(e){g.forEach((function(t){return t.setMaxBufferLength(e)}))},isReconnecting:function(){return y},isStreamsStarted:isProcessingRequest:function(){return g.every(()},setReconnecting:function(){y=!0},switchAudioTrack:k,sourceOpen:function(){g.forEach(()},getAudioStream:function(){return p},getVideoStream:function(){return m}}}function ia(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}ra.prototype=Object.create(S.prototype);var aa=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_SAFE_INTEGER,n=e.sort((function(e,t){return t.bandwidth-e.bandwidth}));if(!n.length)return[];var r=n.filter((function(e){var n=e.width;return t>=(n||Number.MAX_SAFE_INTEGER)}));return r.length||(r=[n[n.length-1]]),r.map((function(e){return e.bandwidth}))},oa=function(e){g(n,e);var t=ia(n);function n(e){var r;return u(this,n),(r=t.call(this,e)).player=e,r.mediaElement=e.getComponent(Wt),r.renderer=e.getRenderer(),r.manifest=e.getComponent(Ht),r.options=e.options,r.timer=new Nr(500,(function(){return r.update()})),r.droppedFramesTimer=new Nr(5e3,(function(){return r.checkDroppedFrames()})),r.representations=r.manifest.getVideoProfiles(),r.opts=r.options.get(Ae),r.supportResolution=r.opts[Le],r.minimumBufferLength=r.opts[xe],r.allowFastSwitch=r.opts[Pe],r.allowUpwardSwitchAfter=r.opts[Re],r.minimumBandwidthSurplusToSwitchUpward=r.opts[Ie],r.minimumBandwidthSurplusToFastSwitchUpward=r.opts[Ce],r.preventOverrideDefaultBitrateOnStart=r.opts[Me],r.switchInterval=r.opts[_e],r.metrics=[],r.representation=null,r.bandwidths=aa(r.representations),r.minBandwidth=1e3*parseFloat(r.manifest.minAutoBitrate)||null,r.maxBandwidth=1e3*parseFloat(r.manifest.maxAutoBitrate)||Number.POSITIVE_INFINITY,r.lastSwitch=0,r.droppedFrames=0,r.droppedFramesTimeoutId=0,r.isFirstFragmentBuffered=!1,r.updateMaxBandwidthHandler=function(){return r.updateMaxBandwidth()},e.on($,(function(e){return r.onPeriodChanging(e)})),e.on(ae,(function(e){return r.onProfileChanging(e)})),r.supportResolution&&(window.addEventListener(D,r.updateMaxBandwidthHandler),r.updateMaxBandwidth()),r.timer.start(),r.options.get(Ue)&&r.droppedFramesTimer.start(),r}return d(n,[{key:"addMetric",value:function(e){null!==this.representation&&(this.preventOverrideDefaultBitrateOnStart&&!this.isFirstFragmentBuffered&&this.player.getBufferLength()>0&&(this.isFirstFragmentBuffered=!0),this.bandwidths.length<2||(this.metrics.push(e),this.metrics.length>10&&this.metrics.shift(),this.update()))}},{key:"update",value:function(){var e,t=Date.now(),n=this.calculateAvgBps(),r=this.mediaElement.getPlayed().length>0,i=!1;if(null!==this.representation&&this.renderer.isAbr&&!this.mediaElement.isSeeking()&&!(t-this.lastSwitch<1e3*this.switchInterval)&&n>=0){e=this.getTargetBandwidth(n);var a=this.mediaElement.getCurrentTime(),o=xr(this.mediaElement.getVideo(),a),s=this.representation,u=s.bandwidth,c=s.segmentTemplate,l=e>u;if(l&&this.allowUpwardSwitchAfter){var d=this.mediaElement.getTotalPlayed();if(this.allowUpwardSwitchAfter>d)return}if(l&&this.preventOverrideDefaultBitrateOnStart&&!this.isFirstFragmentBuffered)return;if(e!==u){if(l&&o<2)return void(this.lastSwitch=0);var f=c.duration/c.timescale||0,h=this.minimumBufferLength||Math.max(f,4)+2;if(!l&&(this.lastSwitch=0,o>h&&u<this.maxBandwidth))return;if(this.allowFastSwitch&&l)n>e+e*(this.minimumBandwidthSurplusToFastSwitchUpward/100)&&(i=!0);if(!i&&l&&o<h)return;if(!i&&l&&!r)return;this.change(e,i)}}}},{key:"change",value:function(e,t){this.trigger(re,e,t),this.metrics=[],this.lastSwitch=Date.now()}},{key:"calculateAvgBps",value:function(){if(this.metrics.length<=4){var e=i(this.metrics.slice().reverse(),1)[0];return e&&Date.now()-e.started>3e3?e.bps:-1}return parseInt(this.metrics.slice(this.metrics.length-4,this.metrics.length).reduce((function(e,t,n){return e+t.bps}),0)/4)}},{key:"getDownloadSpeed",value:function(){var e=i(this.metrics,1)[0];return null==e?void 0:e.bps}},{key:"checkDroppedFrames",value:function(){var e=this,t=this.mediaElement.getDroppedFrameCount();if(t-this.droppedFrames>20&&this.bandwidths.length>1&&this.representation){var n=i(this.bandwidths.slice().reverse().slice(1),1);this.maxBandwidth=n[0],this.representation.bandwidth>this.maxBandwidth&&(this.change(this.maxBandwidth,!0),this.droppedFramesTimer.stop(),this.droppedFramesTimeoutId=setTimeout((,1e4))}this.droppedFrames=t}},{key:"getTargetBandwidth",value:function(e){var t=this.bandwidths[this.bandwidths.length-1];return e-=e*(this.minimumBandwidthSurplusToSwitchUpward/100),this.minBandwidth&&e<this.minBandwidth&&(e=this.minBandwidth),this.maxBandwidth&&e>this.maxBandwidth&&(e=this.maxBandwidth),this.bandwidths.find((function(t){return e>=t}))||t}},{key:"updateMaxBandwidth",value:function(){var e=this;setTimeout((function(){var t=i(aa(e.representations,e.mediaElement.getWidth()),1);e.maxBandwidth=t[0]}),0)}},{key:"onPeriodChanging",value:function(e){this.representations=this.manifest.getVideoProfiles(e),this.bandwidths=aa(this.representations),this.supportResolution&&this.updateMaxBandwidth()}},{key:"onProfileChanging",value:,{key:"destroy",value:function(){var e,t;null===(e=this.timer)||void 0===e||e.stop(),null===(t=this.droppedFramesTimer)||void 0===t||t.stop(),clearTimeout(this.droppedFramesTimeoutId),window.removeEventListener(D,this.updateMaxBandwidthHandler),this.metrics=[]}}]),n}(S);const sa=oa;function ua(e){var t=this,n=new window.MediaSource;function r(){t.trigger(zr)}function i(){t.trigger(Xr)}unction o(){return n.readyState}return n.addEventListener(zr,r),n.addEventListener(Xr,i),n.addEventListener(Qr,a),e.setSource(URL.createObjectURL(n)),{on:t.on.bind(t),off:t.off.bind(t),trigger:t.trigger.bind(t),addSourceBuffer:function(e){return n.addSourceBuffer(e)},destroy:function(){zt(n.sourceBuffers).forEach((function(e){return e)})),n.removeEventListener(zr,r),n.removeEventListener(Xr,i),n.removeEventListener(Qr,a),t.off()},setDuration:function(e){n.duration=e},endOfStream:function(){if(o()===Yi)try{n.endOfStream()}catch(e){}},getReadyState:o,getActiveSourceBuffers:function(){return n.activeSourceBuffers},setLiveSeekableRange:function(e,t){"function"==typeof n.setLiveSeekableRange&&"function"==typeof n.clearLiveSeekableRange&&n.readyState===Yi&&(n.clearLiveSeekableRange(),n.setLiveSeekableRange(e,t))}}}ua.prototype=Object.create(S.prototype),ua.isSupported=function(e){return window.MediaSource.isTypeSupported(e)};const ca=ua;function la(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}var da=function(e){g(r,e);var t,n=la(r);function r(e,t){var i;return u(this,r),(i=n.call(this,e,t)).rendererType=r.id,i.playbackStartLogger=kn.get(Oe),i.url=null,i.isAbr=!0,i.streams=[],i.abr=null,i.currentBandwidth=null,i.manifestManager=new Mi(i.mediaElement.getVideo(),i.player),i.manifestManager.on(U,i.onManifestUpdated.bind(f(i))),i.manifestManager.on(V,i.onManifestUpdateError.bind(f(i))),i.manifestManager.on(j,i.onManifestLoaded.bind(f(i))),i.streamManager=new ra(i.player,i.manifestManager),i.player.addComponent(i.streamManager,Gt),i.streamManager.on(Gr,(),i.streamManager.on(ie,(function(e){return i.onProfileChanged(e)})),i.streamManager.on(ae,(function(e){return i.onProfileChanging(e)})),i.streamManager.on(ue,i.reconnect.bind(f(i))),i.streamManager.on(Hr,i.onFailedToLoadSegment.bind(f(i))),i.streamManager.on(M,i.onEnded.bind(f(i))),i.streamEvent=new Jr(i.player),i.player.on(X,(function(e){return i.onPeriod(e)})),i.reconnectTimeout=0,i.currentProfile=null,i}return d(r,[{key:"onManifestLoaded",value:function(){var e=this.manifestManager.manifest;this.player.trigger(j,e)}},{key:"onManifestUpdated",value:function(){var e=this.manifestManager.manifest;this.player.trigger(U,e),this.streamManager.clearBuffer(0,this.mediaElement.getCurrentTime()-60)}},{key:"onManifestUpdateError",value:function(){this.reconnect()}},{key:"onProfileChanged",value:function(e){if(e){var t=e.bandwidth;this.currentProfile!==e&&(this.currentBandwidth=t,this.currentProfile=e,this.player.trigger(ie,e,this.getCurrentTime(),this.isAbr),this.playbackStartLogger.info("PROFILE SWITCHED ".concat(t)),this.options.get(ut)&&localStorage.setItem(Lr,t))}}},{key:"onProfileChanging",value:function(e){this.player.trigger(ae,e,this.getCurrentTime(),this.isAbr),this.player.trigger("profile",this.getCurrentTime(),e,this.isAbr)}},{key:"onFailedToLoadSegment",value:function(e,t){this.trigger(Hr,e),this.player.trigger(C,{code:De[Se.LOAD_SEGMENT_ERROR],renderer:"DASH",message:Se.LOAD_SEGMENT_ERROR,url:e,xhr:t})}},{key:"isIndexMode",value:function(){return this.manifestManager.isIndexMode()}},{key:"setSource",value:function(e){var t=this;this.destroy(),this.isAbr=!!this.options.get(Ae),this.url=e,null===this.baseUrl&&(this.baseUrl=this.url),this.player.trigger(z,this.url),this.timeShift.isEnabled()&&(this.url=this.timeShift.generateUrl(this.url)),this.manifestManager.load(this.url).then((function(e){if(t.isLive()&&t.player.trigger(q),!e)return t.player.trigger(C,{code:De[Se.PARSE_MANIFEST_ERROR],renderer:"DASH",message:Se.PARSE_MANIFEST_ERROR});t.player.trigger(oe,t.manifestManager.getVideoProfiles()),t.player.trigger(P,t.manifestManager.getAudioTracks()),t.playSource()})).catch((function(e){var n=e.error,r=e.url,i=e.xhr;n===Vr&&(t.isLive()?t.timeShift.isLive()?t.reconnect(4e3,t.baseUrl):t.reconnect(4e3):t.destroy(),t.player.trigger(C,{code:De[Se.LOAD_MANIFEST_ERROR],renderer:"DASH",message:Se.LOAD_MANIFEST_ERROR,url:r,xhr:i}))}))}},{key:"isLive",value:function(){var e;return Ar(p(r.prototype),"isLive",this).call(this)||(null===(e=this.manifestManager)||void 0===e?void 0:e.isLive())}},{key:"destroy",value:function(){var e,t;clearTimeout(this.reconnectTimeout),this.manifestManager.destroy(),this.streamManager.destroy(),null===(e=this.mediaSource)||void 0===e||e.destroy(),null===(t=this.abr)||void 0===t||t.destroy(),Ar(p(r.prototype),"destroy",this).call(this)}},{key:"onPeriod",value:function(e){var t=e.id,n=this.manifestManager.getPeriodById(t),r=this.manifestManager.getVideoProfiles(n);this.player.trigger(oe,r)}},{key:"onEnded",value:,{key:"onSeeking",value:,{key:"onLoadedmetadata",value:function(){this.lastEvent=W,this.player.trigger(K,this.manifestManager.isLive()?-1:this.manifestManager.duration),this.player.trigger(W,{duration:this.manifestManager.duration})}},{key:"reconnect",value:function(e,t,n){var r=this;this.streamManager&&this.streamManager.getBufferLength()>1&&!n||(e=e||2e3,t=t||this.url,this.streamManager.setReconnecting(),this.options.autoplay=!0,clearTimeout(this.reconnectTimeout),this.player.trigger(Te,this.mediaElement.getCurrentTime()),this.timeShift.isEnabled()&&this.timeShift.isLive()&&this.timeShift.setLive(),this.reconnectTimeout=setTimeout((,e))}},{key:"switchProfile",value:function(e,t,n){var r=(null==e?void 0:e.bandwidth)||e;"auto"===r?(this.isAbr=!0,this.player.trigger(ie,this.currentProfile,this.getCurrentTime(),this.isAbr)):(this.isAbr=!1,this.streamManager.switchProfile(r,t,void 0!==n?n:this.options.get(st)))}},{key:"switchAudioTrack",value:function(e,t){this.streamManager.switchAudioTrack(e,t)}},{key:"playSource",value:(t=o(y().mark((function e(t){var n,r,i,a,o,s,u=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(this.reconnectTimeout),n=this.manifestManager,r=n.videoAdaptation,i=n.audioAdaptation,null!==(a=r||i)){e.next=6;break}return this.reconnect(5e3),e.abrupt("return");case 6:if(a.representations.length){e.next=10;break}return a.unsupportedCodecs.length&&this.player.trigger(C,{code:De[Se.NO_SUPPORTED_CODEC],renderer:"DASH",message:Se.NO_SUPPORTED_CODEC,data:a.unsupportedCodecs}),this.destroy(),e.abrupt("return");case 10:if(void 0===t){e.next=13;break}return this.setSource(t),e.abrupt("return");case 13:if(!(o=this.player.beforePlayTaskQueue).length){e.next=20;break}return this.playbackStartLogger.info("DRM INITIALIZING"),s=o.map((function(e){return e()})),e.next=19,Promise.all(s);case 19:this.playbackStartLogger.info("DRM INITIALIZED");case 20:if(!this.player.destroyed){e.next=22;break}return e.abrupt("return");case 22:this.abr=new sa(this.player),this.mediaSource=new ca(this.mediaElement),this.player.addComponent(this.mediaSource,Yt),this.mediaSource.on(Xr,(function(){return u.onSourceOpen()})),this.registerEvents(),this.abr.on(re,(function(e,t){setTimeout((,0)})),this.isPaused?(this.mediaElement.pause(),this.player.trigger(Q,this.getCurrentTime())):this.mediaElement.play();case 29:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"seek",value:function(){this.triggerOnSeekStartEvents();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.streamManager.seek.apply(this.streamManager,t)}},{key:"seekTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0];if(this.timeShift.isEnabled())return this.triggerOnSeekStartEvents(),t[0]=r/(this.getDuration()-this.player.getLiveDelay())*100,void this.streamManager.seek.apply(this.streamManager,t);t[0]=r/this.getDuration()*100,this.seek.apply(this,t)}},{key:"seekToHead",value:,{key:"getDuration",value:function(){return this.streamManager.getDuration()}},{key:"getCurrentTime",value:function(){return this.streamManager.getCurrentTime()}},{key:"getBufferLength",value:function(){return this.streamManager.getBufferLength()}},{key:"getLiveDelay",value:function(){return this.manifestManager.getLiveDelay()}},{key:"getDownloadSpeed",value:function(){return this.abr.getDownloadSpeed()}},{key:"setMaxBufferLength",value:function(e){return this.streamManager.setMaxBufferLength(e)}},{key:"getCurrentProfile",value:function(){return this.streamManager.getCurrentProfile()}},{key:"getProfiles",value:function(){return this.streamManager.getProfiles()}},{key:"getProfile",value:function(){return this.currentProfile}},{key:"getAudioTracks",value:function(){return this.manifestManager.getAudioTracks()}},{key:"getCurrentAudioTrack",value:function(){return this.streamManager.getCurrentAudioTrack()}},{key:"getTextTracks",value:function(){return this.mediaElement.getNativeTextTracks()}},{key:"getCurrentPeriod",value:function(){return this.streamManager.getCurrentPeriod()}},{key:"stop",value:function(){this.player.trigger(ge,this.mediaElement.getCurrentTime()),this.isPaused=!1,this.destroy()}},{key:"resume",value:function(){this.isPaused=!1,this.mediaElement.play()}},{key:"onSourceOpen",value:function(){if(this.streamManager.hasActiveStreams())this.streamManager.sourceOpen();else{var e=this.manifestManager.duration;this.timeShift.isEnabled()&&this.timeShift.isLive()&&(e=Number.MAX_VALUE),this.mediaSource.setDuration(e),this.manifestManager.isLive()&&this.options.get(Ot)&&this.mediaSource.setLiveSeekableRange(0,Number.MAX_VALUE),this.streamManager.createStreams(this.mediaSource,this.manifestManager.isLive()&&!this.timeShift.isVod()),null!==this.currentBandwidth&&this.streamManager.switchProfile(this.currentBandwidth),this.streamManager.initStreams(),this.mediaElement.getCurrentTime()!==this.streamManager.getStartTime()&&this.mediaElement.seek(this.streamManager.getStartTime())}}}],[{key:"canPlayType",value:function(e,t){return!!t.get("forceDash")||(!t.get(rt)||!E.isSafariWithSiteSpecificHacks())&&(!(E.isSafari()&&!t.get(Ot))&&(!(!E.isWidevineSupported()&&E.isFirefox())&&void 0!==window.MediaSource))}}]),r}(jr);da.id="dash",da.enabled=!0,da.priority=100,da.mediaTypes={DASH:"application/dash+xml"};const fa=da;function ha(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}var ga=function(e){g(r,e);var t,n=ha(r);function r(e,t){var i;return u(this,r),(i=n.call(this,e,t)).rendererType=r.id,i.utcTime=new ar(i.player),i.utcTimeStamp=0,i.liveStart=0,i.timeShiftStart=0,i}return d(r,[{key:"setSource",value:(t=o(y().mark((function e(t){var n,r,a,o,s,u,c,l,d,f,h,g,m;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.options.get(kt),r=this.options.get(Et),a=this.player.beforePlayTaskQueue,this.registerEvents(),!this.timeShift.isEnabled()){e.next=8;break}return e.next=7,this.utcTime.sync();case 7:this.utcTimeStamp=e.sent;case 8:if(null===this.baseUrl&&(this.baseUrl=t),this.player.trigger(z,t),!a.length){e.next=14;break}return o=a.map((),e.next=14,Promise.all(o);case 14:if(this.timeShift.isEnabled()&&(t=this.timeShift.generateUrl(t,!0)),!n){e.next=19;break}return e.next=18,jn.head(t).then((function(e){return e.responseUrl})).catch((function(){return t}));case 18:t=e.sent;case 19:if(s=this.mediaItem.mediaType,!r||"HLS"!==s){e.next=35;break}return e.prev=21,e.next=24,jn.get(t).then((function(e){return e.data}));case 24:return u=e.sent,c=u.match(/(http|https).*/)||[],l=i(c,1),d=l[0],e.next=28,jn.get(d).then((function(e){return e.data}));case 28:f=e.sent,h=f.match(/#EXT-X-PROGRAM-DATE-TIME:(.*)/)||[],(g=i(h,2))[0],m=g[1],this.liveStart=Yn.parseDateTime(m),e.next=35;break;case 33:e.prev=33,e.t0=e.catch(21);case 35:!this.timeShift.params&&this.isLive()&&this.player.trigger(q),this.playSource(t);case 37:case"end":return e.stop()}}),e,this,[[21,33]])}))),function(e){return t.apply(this,arguments)})},{key:"seek",value:function(e){var t=this.getDuration()/100*e;this.seekTo(t)}},{key:"seekTo",value:function(e){this.triggerOnSeekStartEvents(),this.timeShift.getDvrWindow()>0&&(e+=this.timeShift.getLiveNowUTC()-this.utcTimeStamp+this.getCurrentTimeOffset()),this.mediaElement.seek(e)}},{key:"getCurrentTime",value:function(){var e=this.mediaElement.getCurrentTime();if(this.isLive()&&!this.timeShift.isEnabled())return e+this.liveStart;if(this.timeShift.getDvrWindow()>0){if(0===Math.floor(e))return 0;e-=this.timeShift.getLiveNowUTC()-this.utcTimeStamp,e-=this.getCurrentTimeOffset()}return e}},{key:"guardTimeShiftPosition",value:function(){this.timeShift.isEnabled()&&this.getCurrentTime()<0&&this.player.seekTo(this.options.get(at)+this.getCurrentTimeOffset())}},{key:"getDuration",value:function(){return this.timeShift.getStart()>=0&&this.timeShift.getStop()<0?this.timeShift.getLiveNowUTC()-this.timeShift.getStart():this.timeShift.getStart()>=0&&this.timeShift.getStop()>=0?this.timeShift.getStop()-this.timeShift.getStart():this.mediaElement.getDuration()}},{key:"getCurrentTimeOffset",value:,{key:"isLive",value:function(){return Ar(p(r.prototype),"isLive",this).call(this)||this.getDuration()===1/0||this.timeShift.isLive()}},{key:"onLoadedmetadata",value:function(){var e,t=this;this.player.trigger(K,this.isLive()?-1:this.getDuration()),this.player.trigger(W,{duration:this.getDuration()}),this.isLive()&&this.player.trigger(q),this.timeShift.isEnabled()&&this.timeShift.getDvrWindow()>=0&&this.timeShift.getPlayStart()>=0&&(e=this.timeShift.getPlayStart()-this.timeShift.getStart()),this.options.get(Lt)&&(e=this.options.get(Lt),this.options.set(Lt,null)),e&&this.mediaElement.once(J,()}},{key:"onTimeupdate",value:function(){this.isLive()&&!this.liveStart&&Math.floor(this.getCurrentTime())>0&&this.timeShift.getMode()!==sr&&(this.liveStart=this.timeShift.getLiveNowUTC()-(this.mediaElement.getCurrentTime()+6)),Ar(p(r.prototype),"onTimeupdate",this).call(this)}},{key:"getProfile",value:function(){return""}},{key:"onLoadeddata",value:function(){this.player.trigger("data");var e=this.getAudioTracks();if(e.length){this.player.trigger(P,e);var t=this.getActiveAudioTrack();if(this.defaultAudioLanguage=this.options.get(We),this.defaultAudioLanguage){var n=this.getAudioTrackByLang(this.defaultAudioLanguage);n&&t!==n?this.switchAudioTrack(n):this.player.trigger(L,t)}else this.player.trigger(L,t)}}},{key:"play",value:function(){if(this.timeShift.isEnabled()&&this.getCurrentTime()<0)return this.mediaElement.seek(0),void this.player.restart();Ar(p(r.prototype),"play",this).call(this)}},{key:"switchAudioTrack",value:function(e){var t="object"===s(e)?e.id:e,n=this.mediaElement.getNativeAudioTracks(),r=n.find(();r&&(n.forEach((),this.player.trigger(L,this.createAudioTrackDTO(r)))}},{key:"getAudioTrackByLang",value:function(e){return this.getAudioTracks().find((function(t){var n=t.label;return t.lang===e||n===e}))}},{key:"getActiveAudioTrack",value:,{key:"getCurrentAudioTrack",value:,{key:"getAudioTracks",value:,{key:"getTextTracks",value:function(){return zt(this.mediaElement.getNativeTextTracks()).filter(()}},{key:"createAudioTrackDTO",value:function(e){return new ei(e)}}],[{key:"canPlayType",value:]),r}(jr);ga.id="html5",ga.priority=200,ga.mediaTypes={MP4:"video/mp4",HLS:"application/x-mpegURL",AAC:"audio/mp4",MP3:"audio/mpeg",MOV:"video/mp4; codecs='avc1.42E01E, mp4a.40.2'",WEBM:"video/webm",OGG:"video/ogg"};const ma=ga;const pa={NO_KEY_PROVIDED:503,FAILED_TO_GENERATE_MEDIA_KEYS:504,FAILED_TO_GENERATE_LICENSE_CHALLENGE:505,FAILED_TO_UPDATE_SESSION:506,FAILED_TO_LOAD_KEY:507,SESSION_KEY_ERROR:508,FAILED_TO_LOAD_CERTIFICATE:509,NOT_SECURE_CONTEXT:510,LICENSE_RESPONSE_REJECTED:511,FAILED_TO_LOAD_LICENSE_CHALLENGE:512};var va="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",ya="94ce86fb-07ff-4f43-adb8-93d2fa968ca2",ba="9a04f079-9840-4286-ab92-e65be0885f95",Ta="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Ea(e){if(null===e)return[];for(var t=new DataView(e),n=!1,r=[],i=0;!n;){var a,o,s=void 0,u=void 0,c=i;if(i>=t.buffer.byteLength){n=!0;break}a=i+t.getUint32(i),i+=4,1886614376===t.getUint32(i)?(i+=4,0===(o=t.getUint8(i))||1===o?(i++,i+=3,s=Sa(new Uint8Array(e,i,16)),i+=16,s=s.toLowerCase(),0===o&&(u=Sa(new Uint8Array(e,Math.min(i+8,e.byteLength-16),16))),i+=4,r.push({id:s,data:t.buffer.slice(c,a),keyId:u}),i=a):i=a):i=a}return r}function Sa(e){var t=[],n=function(e){for(var t="",n=0;n<e.length;++n){var r=e[n].toString(16);1==r.length&&(r="0"+r),t+=r}return t};return t.push(n(e.subarray(0,4))),t.push(n(e.subarray(4,6))),t.push(n(e.subarray(6,8))),t.push(n(e.subarray(8,10))),t.push(n(e.subarray(10,16))),t.join("-")}unction wa(e){var t;return null===(t=Object.entries(Jt).find((function(t){var n=i(t,2),r=(n[0],n[1]);return e===r})))||void 0===t?void 0:t[0]}function Da(e,t){if(e.byteLength!==t.byteLength)return!1;for(var n=new Uint8Array(e),r=new Uint8Array(t),i=0;i<n.length;i++)if(n[i]!==r[i])return!1;return!0}function Oa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Aa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oa(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var La=Object.keys(Jt).map((function(e){return e.toLowerCase()})),Pa={EXPIRED:"expired",RELEASED:"released"};function Ra(){return Ra=o(y().mark((function t(n,r){var a,s,u,c,l,d,f,h,g,m,p,v,b,T,E,S,k,w,D,O,L,P,R,_,N,B,j,U,V,H,W,Y,K,q,z,Q,X,$;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if($=function(){L=[],S.forEach((function(e){e.close().catch((function(){})),e.removeEventListener("message",Y),e.removeEventListener("keystatuseschange",q),e=null})),S=[],P&&P(),u.removeEventListener("encrypted",j)},X=function(e,t){e.update(t).then(().catch((function(e){var t=Se.DRM_SESSION_UPDATE_FAILED,n=pa.FAILED_TO_UPDATE_SESSION;"Rejected with system code (18)"===e.message&&(t=Se.LICENSE_RESPONSE_REJECTED,n=pa.LICENSE_RESPONSE_REJECTED),N(n,t,e)}))},Q=function(e,t,r){n.trigger(A,e,wa(k.keySystem));var i=(c.get(ot)||{}).drm,a=void 0===i?{}:i,o=a.headers||{},s=Aa(Aa({},r),o);return jn.post(e,{cancelToken:new jn.CancelToken((function(e){return P=e})),data:t,responseType:xn,withCredentials:a.withCredentials,headers:s,params:a.params}).then((function(t){var r=t.data,i=t.metric,a=t.xhr;return n.trigger(G,{duration:i.duration,type:"LICENSE",statusCode:a.status,url:e,timestamp:Date.now()}),r})).catch((function(t){var r=t.metric,i=t.xhr;N(pa.FAILED_TO_LOAD_KEY,Se.DRM_LOAD_LICENSE_KEY_FAILED),n.trigger(G,{duration:r.duration,type:"LICENSE",statusCode:i.status,url:e,timestamp:Date.now})}))},z=function(){var e,t=E,n=t.initData,r=t.initDataType,i=t.keyId,a=t.mediaKeys;null===(e=localStorage)||void 0===e||e.removeItem(T),T=null,V(a,r,n,i)},q=function(e){v&&e.target.keyStatuses.forEach((function(t){[Pa.RELEASED,Pa.EXPIRED].includes(t)&&e.target.close().then((function(){return z()}))}))},K=function(){return K=o(y().mark((function e(t){var n,r,i,a,o,s,u,c,l,h,g,m;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.target,r=t.message,i=[],d.info("DRM REQUEST GENERATED");try{if(a=new Uint16Array(r),o=String.fromCharCode.apply(null,a),s=new DOMParser,(u=s.parseFromString(o,"application/xml")).getElementsByTagName("Challenge")[0])for((r=u.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)&&(r=atob(r)),c=u.getElementsByTagName("name"),l=u.getElementsByTagName("value"),h=0;h<c.length;h++)i[c[h].childNodes[0].nodeValue]=l[h].childNodes[0].nodeValue}catch(e){}return d.info("DRM LOADING LICENSE"),g=f[D].multikeySrc||f[D].src,e.next=9,Q(g,r,i);case 9:m=e.sent,d.info("DRM LOADED LICENSE"),m&&X(n,m);case 12:case"end":return e.stop()}}),e)}))),K.apply(this,arguments)},Y=function(e){return K.apply(this,arguments)},W=function(e){e.load(T).then(().catch((function(){N(pa.FAILED_TO_LOAD_LICENSE_CHALLENGE,Se.DRM_LOAD_LICENSE_CHALLENGE_FAILED)}))},H=function(e,t,n){e.generateRequest(t,n).then((function(){var t;v&&(null===(t=localStorage)||void 0===t||t.setItem(b,e.sessionId))})).catch((function(){N(pa.FAILED_TO_GENERATE_LICENSE_CHALLENGE,Se.DRM_GENERATE_LICENSE_CHALLENGE_FAILED)}))},V=function(e,t,n,r){var i=e.createSession(v?"persistent-license":"temporary");i.keyId=r,i.addEventListener("message",Y),i.addEventListener("keystatuseschange",q),d.info("DRM REQUEST GENERATING"),T?W(i):H(i,t,n),S.push(i)},U=function(e,t){return l?!!ka(L,t):L.some(()},j=function(t){if(u.mediaKeys){d.info("DRM ON ENCRYPTED");var r=Ea(new Uint8Array(t.initData).buffer),i=e[D.toUpperCase()].toLowerCase(),a=r.find((function(e){return e.id===i})),o=(null==a?void 0:a.keyId)||i;if(!U(t.initData,o)){n.trigger(x,t);var s=new Ia;s.keyId=o,l||(s.initData=t.initData),L.push(s),v&&(E={mediaKeys:u.mediaKeys,initDataType:t.initDataType,initData:t.initData,keyId:o}),V(u.mediaKeys,t.initDataType,t.initData,o)}}},B=N=function(e,t,r){n.trigger(C,{code:e,message:t,type:"DRM_ERROR",renderer:"DASH",originalMessage:r})},_=function(){return(_=o(y().mark((function e(t){var n,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=void 0;case 1:if(!t.length||n){e.next=9;break}return i=t.shift(),a=tn(r,h[i],v),e.next=6,nn(Jt[i.toUpperCase()],a).catch((function(){}));case 6:n=e.sent,e.next=1;break;case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)},R=function(e){return _.apply(this,arguments)},u=n.getRendererElm(),c=n.options,l=c.get(Fe),d=kn.get(Oe),n.on(I,$),n.on(ge,$),n.on(M,$),f=n.mediaItem.getDrm(),h=c.get(Xe),g=c.get($e)||La,m=Object.keys(f),p=g.filter((function(e){return m.includes(e)})),v=h.usePersistentLicense,b=h.persistentLicenseSessionId,T=null===(a=localStorage)||void 0===a?void 0:a.getItem(b),E={},S=[],0!==p.length){t.next=35;break}return N(pa.NO_KEY_PROVIDED,Se.DRM_NO_KEY_PROVIDED),t.abrupt("return",Promise.resolve());case 35:return t.next=37,R(p.slice());case 37:if(k=t.sent){t.next=41;break}return B(),t.abrupt("return",Promise.resolve());case 41:if(w=k.keySystem,D=null===(s=Object.entries(Jt).find((function(e){var t=i(e,2);t[0];return t[1]===w})))||void 0===s?void 0:s[0].toLowerCase(),t.t0=u.mediaKeys,t.t0){t.next=48;break}return t.next=47,k.createMediaKeys().catch(B);case 47:t.t0=t.sent;case 48:return O=t.t0,t.next=51,u.setMediaKeys(O).catch(B);case 51:return u.addEventListener("encrypted",j),L=[],P=null,t.abrupt("return",{destroy:$});case 55:case"end":return t.stop()}}),t)}))),Ra.apply(this,arguments)}onst Ca=function(e,t){return Ra.apply(this,arguments)};function xa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const Ma=function(e){var t=e.options,n=e.getRendererElm();n.addEventListener("webkitneedkey",u);var r,i,a=e.mediaItem.getDrm().fairplay,o=a&&a.src,s=a&&a.cert;function u(t){var a=t.initData,o=function(e){var t=(r=e,i=new Uint16Array(r.buffer),String.fromCharCode.apply(null,i)),n=document.createElement("a");var r,i;return n.href=t,n.hostname}(a);(function(){if(i)return Promise.resolve(i);return jn.getBinary(s).then((function(e){return e.data}))})().then((function(s){i=new Uint8Array(s),a=function(e,t,n){"string"==typeof t&&(t=t));var r=0,i=new ArrayBuffer(e.byteLength+4+t.byteLength+4+n.byteLength),a=new DataView(i),o=new Uint8Array(i,r,e.byteLength);o.set(e),r+=e.byteLength,a.setUint32(r,t.byteLength,!0),r+=4;var s=new Uint16Array(i,r,t.length);return s.set(t),r+=s.byteLength,a.setUint32(r,n.byteLength,!0),r+=4,new Uint8Array(i,r,n.byteLength).set(n),new Uint8Array(i,0,i.byteLength)}(a,o,i),n.webkitKeys||n.webkitSetMediaKeys(new WebKitMediaKeys(Jt.FAIRPLAY)),(r=n.webkitKeys.createSession("video/mp4",a)).contentId=o,e.trigger(x,t),r.addEventListener("webkitkeymessage",c)})).catch((function(){e.trigger(C,{code:pa.FAILED_TO_LOAD_CERTIFICATE,type:"DRM_ERROR",renderer:"HLS",message:Se.DRM_LOAD_CERTIFICATE_FAILED})}))}function c(n){e.trigger(A,o,wa(Jt.FAIRPLAY)),function(n,i){var a,s=t.get(ot)||{},u=s.drm||{},c=u.headers,d=u.params,f={"Content-Type":t.get(Ze)},c);jn.post(n,{data:i,responseType:xn,withCredentials:null==s||null===(a=s.drm)||void 0===a?void 0:a.withCredentials,headers:f,params:d}).then((function(t){return i=(n=t).data,a=n.metric,s=n.xhr,e.trigger(G,{duration:a.duration,type:"LICENSE",statusCode:s.status,url:o,timestamp:Date.now()}),r.update(new Uint8Array(i)),void e.trigger(F);var n,i,a,s})).catch(()}(o,n.message)}function l(t){var n=t.metric,r=t.xhr;e.trigger(C,{code:pa.FAILED_TO_LOAD_KEY,renderer:"HLS",type:"DRM_ERROR",message:Se.DRM_LOAD_LICENSE_KEY_FAILED}),e.trigger(G,{duration:n.duration,type:"LICENSE",statusCode:r.status,url,timestamp:Date.now()})}function d(){var e,t;n.removeEventListener("webkitneedkey",u),null===(e=(t=r).removeEventListener)||void 0===e||e.call(t,"webkitkeymessage",c)}e.on(I,d),e.on(ge,d),e.on(M,d)};function _a(e){e.on(se,(function(){var t=e.beforePlayTaskQueue;e.mediaItem.getDrm()&&t.push((function(){return new Promise(function(){var t=o(y().mark((function t(n){var r,i,a;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.getComponent(Ht),i=null==r?void 0:r.getAllAdaptationSets().filter((function(e){var t=e.contentType,n=e.type;return t&&[ti.AUDIO,ti.VIDEO].includes(n)})).map((),a=Na(e.getRendererElm(),i),t.prev=3,t.next=6,new a(e,i);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),e.trigger(C,{code:pa.FAILED_TO_GENERATE_MEDIA_KEYS,message:Se.DRM_GENERATE_MEDIA_KEYS_FAILED,type:"DRM_ERROR",renderer:"DASH",originalMessage:null===t.t0||void 0===t.t0?void 0:t.t0.message});case 11:n();case 12:case"end":return t.stop()}}),t,null,[[3,8]])})));return function(e){return t.apply(this,arguments)}}())}))}))}function Na(e,t){return void 0===t?Ma:void 0!==e.onencrypted&&void 0!==e.mediaKeys&&void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess?Ca:void 0}_a.enabled=!0,_a.moduleId="drm";const Ba=_a;var Fa=[],ja={},Ua=function(e){window[e]=window[e]||ja,Fa.push(e)};!function(e){Object.assign(ja,e)}(Hn);const Va=ja;var Ha={maxRetention:Number.POSITIVE_INFINITY,maxSamples:120,interval:10};const Wa=function(e){var t=[],n=e.options.get(Dt).videoMetrics||Ha;Yn.extend(Ha,n),n.interval<=0&&(n.interval=Ha.interval);var r=n.maxRetention,i=n.maxSamples,a=!1;unction s(){var n=[],r=e.getBuffered();if(r&&r.length)for(var i=0;i<r.length;i++)n.push({start:r.start(i),stop:r.end(i)});var a=[],o=e.getPlayed();if(o&&o.length)for(var s=0;s<o.length;s++)a.push({start:o.start(s),stop:o.end(s)});var u=0;e.getProfile()&&(u=e.getProfile().bandwidth);var c={videoTime:Number(e.getCurrentTime().toFixed(3)),paused:e.isPaused(),buffer:Number(e.getBufferLength().toFixed(3)),buffered:n,played:a,profile:u,decodedFrames:e.getDecodedFrameCount(),droppedFrames:e.getDroppedFrameCount(),timestamp:(new Date).getTime()};t.push(c)}e.on(J,(function(){if(a)return;!function(){a=!0;var e=1e3*n.interval;s(),u=setInterval((function(){s()}),e)}()})),e.on(ge,o),e.on(I,o),e.on(M,o);var u=setInterval((function(){c()}),1e4);function c(){t.length&&(((new Date).getTime()>t[0].timestamp+1e3*r||t.length>i)&&(t.shift(),c()))}return{getMetrics:function(){return c(),t}}};function Ya(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ga(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ya(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ya(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ka={maxRetention:Number.POSITIVE_INFINITY,maxSamples:120};const qa=function(e){var t=[],n=e.options.get(Dt).networkMetrics||Ka;Yn.extend(Ka,n);var r=n.maxRetention,i=n.maxSamples;e.on(G,(function(n){var r=n.segmentInfo&&Ga({},n.segmentInfo);null==r||delete r.representation,t.push(Ga(Ga({},n),r&&{segmentInfo:r})),e.trigger("networkMetricsUpdated",n)}));var a=setInterval((function(){o()}),1e4);function o(){if(t.length){if((new Date).getTime()>t[0].timestamp+1e3*r||t.length>i)return t.shift(),void o();t.slice()}}return{getMetrics:function(){return o(),t},destroy:};var za={maxRetention:Number.POSITIVE_INFINITY,maxSamples:120},Qa=[z,J,Te,fe,Q,M,ge,ie,C];const Xa=function(e){var t=[],n="",r=e.options.get(Dt).sessionEvents||za;Yn.extend(za,r);var i=r.maxRetention,a=r.maxSamples;function o(e,r,i){if(e===ie||e===C||n!==e){n=e;var a={timestamp:(new Date).getTime(),event:e,videoTime:r};if(e===z&&(a.url=r,a.videoTime=-1),e===ie&&(a.bandwidth=(null==r?void 0:r.bandwidth)||-1),e===C){if(!r||!r.code)return;a.videoTime=-1,a.code=r.code}t.push(a)}}function s(){t.length&&(((new Date).getTime()>t[0].timestamp+1e3*i||t.length>a)&&(t.shift(),s()))}return Qa.forEach((function(t){e.on(t,(function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.unshift(t),o.apply(null,n)}))})),setInterval((,1e4),{getEvents:};const $a=const Za=function(e,t){var n=e.options.get(yt),r=new $a;r.userAgent=navigator.userAgent,r.setup=e.options.options,r.start=(new Date).getTime(),r.mediaUrl="",e.on(z,(function(e){r.mediaUrl=e}));var i=new qa(e),a=new Wa(e),o=new Xa(e);function s(){return r}function u(){return i.getMetrics()}return{sessionId:n,getInfo:s,getNetworkMetrics:u,getVideoMetrics:function(){return a.getMetrics()},getEvents:function(){return o.getEvents()},serialize:function(){var e={info:s(),networkMetrics:u()};return JSON.stringify(e)}}};var Ja=[];function eo(e){function t(){var t=new Za(e);e.getSession=function(){return t},Va.addSession(t);for(var n=e.options.get(Dt).maxSessions||5;Ja.length>n;)Ja.shift();e.trigger("session",t)}e.setSessionHistory=function(n){"object"===s(n)&&null!==n&&(e.options.set(Dt,n),t())},e.options.get(Dt)&&e.on(se,t)}Dr.addSession=function(e){return Ja.push(e)},Dr.getSession=Dr.getSessionList=function(){return Ja},Va.addSession=Dr.addSession,Va.getSession=Dr.getSession,Va.getSessionList=Dr.getSessionList,eo.enabled=!0,eo.moduleId="reports";const to=eo;var no="advert-id",ro="impression",io="start",ao="metadata",oo="hidden",so=.5,uo=2,co=function(){function e(t){var n=this;u(this,e),this.player=t,this.options=t.options,this.preventStreamEventsForPartiallyPlayedPeriods=this.options.get(St),this.activeEventId,this.trackListTimer=new Nr(5e3,(function(){return n.updateEventList()}),!0),this.monitorTimer=new Nr(1e3,(function(){return n.monitor()}),!0),this.player.on(H,(function(e){return n.onAddTrack(e)})),E.isIOS()&&this.player.on(_,(function(e){return n.onFullScreen(e)})),this.player.once(J,(function(){return n.monitorTimer.start()})),this.player.once(ge,(function(){return n.onDestroy()})),this.player.once(I,(function(){return n.onDestroy()})),this.obervedTextTracks=[],this.eventList=[]}return d(e,[{key:"onFullScreen",value:function(e){zt(this.player.getComponent(Wt).getNativeTextTracks()).forEach((function(t){t.kind===ao&&e&&(t.mode=oo)}))}},{key:"onAddTrack",value:function(e){e.kind===ao&&(e.mode=oo,this.obervedTextTracks.push(e),this.trackListTimer.start())}},{key:"updateEventList",value:function(){var e=this;this.obervedTextTracks.forEach((function(t){zt(t.cues).filter(().map((function(e){var t,n={};try{(n=JSON.parse(atob((t=e.value.data,t.replace(/\-/g,"+").replace(/_/g,"/")+"==".substring(0,3*t.length%4)))).vast.event).start=n.offset/1e3+978307200}catch(e){}return n})).forEach((function(t){e.eventList.find(()||e.eventList.push(t)}))}))}},{key:"monitor",value:function(){var e=this,t=this.player.getCurrentTimeUTC();this.eventList.filter((function(n){var r=n.fired,i=n.start,a=n[no],o=n.event;return i>=t-so&&i<t+uo&&(!e.preventStreamEventsForPartiallyPlayedPeriods||o===ro||o===io||a===e.activeEventId)&&!r})).forEach((function(t){t.event!==ro&&t.event!==io||(e.activeEventId=t[no]),t.messageData=btoa(t.url),e.player.trigger(pe,t),t.fired=Date.now()}))}},{key:"onDestroy",value:function(){var e,t;null===(e=this.trackListTimer)||void 0===e||e.stop(),null===(t=this.monitorTimer)||void 0===t||t.stop(),this.obervedTextTracks=[],this.eventList=[]}}]),e}();co.enabled=!0,co.moduleId="stream-event";const lo=co;Dr.renderers=[fa,ma],Dr.modules=[Ba,to,lo],Va.Player=Dr,Ua("redcdnplayer"),Ua("redGalaxy")})()})();
//# sourceMappingURL=redgalaxy-player.core-2.39.0.min.js.map((typeof module!=='undefined')?module.exports=window.redcdnplayer:null);