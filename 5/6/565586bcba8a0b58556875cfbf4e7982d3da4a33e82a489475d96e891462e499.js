var rudderanalytics=function(e){"use strict";function t(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function n(e){return function n(r){return 0===arguments.length||t(r)?n:e.apply(this,arguments)}}function r(e){return function r(s,i){switch(arguments.length){case 0:return r;case 1:return t(s)?r:n((function(t){return e(s,t)}));default:return t(s)&&t(i)?r:t(s)?n((function(t){return e(t,i)})):t(i)?n((function(t){return e(s,t)})):e(s,i)}}}function s(e){return function s(i,o,a){switch(arguments.length){case 0:return s;case 1:return t(i)?s:r((function(t,n){return e(i,t,n)}));case 2:return t(i)&&t(o)?s:t(i)?r((function(t,n){return e(t,o,n)})):t(o)?r((function(t,n){return e(i,t,n)})):n((function(t){return e(i,o,t)}));default:return t(i)&&t(o)&&t(a)?s:t(i)&&t(o)?r((function(t,n){return e(t,n,a)})):t(i)&&t(a)?r((function(t,n){return e(t,o,n)})):t(o)&&t(a)?r((function(t,n){return e(i,t,n)})):t(i)?n((function(t){return e(t,o,a)})):t(o)?n((function(t){return e(i,t,a)})):t(a)?n((function(t){return e(i,o,t)})):e(i,o,a)}}}function i(e,t){return Object.prototype.hasOwnProperty.call(t,e)}const o=n((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function a(e){return"[object Object]"===Object.prototype.toString.call(e)}const l=Number.isInteger||function(e){return e<<0===e};var u=r((function(e,t){var n=e<0?t.length+e:e;return function(e){return"[object String]"===Object.prototype.toString.call(e)}(t)?t.charAt(n):t[n]}));const c=u;function d(e,t,n){if(n||(n=new g),function(e){var t=typeof e;return null==e||"object"!=t&&"function"!=t}(e))return e;var r,s=function(r){var s=n.get(e);if(s)return s;for(var i in n.set(e,r),e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t?d(e[i],!0,n):e[i]);return r};switch(o(e)){case"Object":return s(Object.create(Object.getPrototypeOf(e)));case"Array":return s([]);case"Date":return new Date(e.valueOf());case"RegExp":return r=e,new RegExp(r.source,r.flags?r.flags:(r.global?"g":"")+(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.sticky?"y":"")+(r.unicode?"u":"")+(r.dotAll?"s":""));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return e.slice();default:return e}}var g=function(){function e(){this.map={},this.length=0}return e.prototype.set=function(e,t){const n=this.hash(e);let r=this.map[n];r||(this.map[n]=r=[]),r.push([e,t]),this.length+=1},e.prototype.hash=function(e){let t=[];for(var n in e)t.push(Object.prototype.toString.call(e[n]));return t.join()},e.prototype.get=function(e){if(this.length<=180){for(const t in this.map){const n=this.map[t];for(let t=0;t<n.length;t+=1){const r=n[t];if(r[0]===e)return r[1]}}return}const t=this.hash(e),n=this.map[t];if(n)for(let t=0;t<n.length;t+=1){const r=n[t];if(r[0]===e)return r[1]}},e}();const h=n((function(e){return null!=e&&"function"==typeof e.clone?e.clone():d(e,!0)}));const p=r((function(e,t){return e.map((function(e){for(var n,r=t,s=0;s<e.length;){if(null==r)return;n=e[s],r=l(n)?c(n,r):r[n],s+=1}return r}))}));const f=r((function(e,t){return p([e],t)[0]}));var v=s((function(e,t,n){var r,s={};for(r in n=n||{},t=t||{})i(r,t)&&(s[r]=i(r,n)?e(r,t[r],n[r]):t[r]);for(r in n)i(r,n)&&!i(r,s)&&(s[r]=n[r]);return s}));const y=v;const m=s((function e(t,n,r){return y((function(n,r,s){return a(r)&&a(s)?e(t,r,s):t(n,r,s)}),n,r)}));const b=s((function(e,t,n){return m((function(t,n,r){return e(n,r)}),t,n)}));const E=r((function(e,t){var n={};for(var r in t)e(t[r],r,t)&&(n[r]=t[r]);return n})),I=e=>"function"==typeof e&&Boolean(e.constructor&&e.call&&e.apply),S=e=>"string"==typeof e,k=e=>null===e,w=e=>void 0===e,T=e=>k(e)||w(e),A=e=>!w(e),P=e=>!T(e),R=e=>e instanceof Error,C=(e,t)=>{const n=t.split(".");return f(n,e)},$=e=>!k(e)&&"object"==typeof e&&!Array.isArray(e),O=e=>!k(e)&&"[object Object]"===Object.prototype.toString.call(e),D=(e,t)=>{if(!Array.isArray(e)||!Array.isArray(t))return h(t);const n=h(e);return t.forEach(((e,t)=>{n[t]=Array.isArray(e)||$(e)?M(n[t],e):e})),n},M=(e,t)=>b(D,e,t),B=e=>O(e)&&Object.keys(e).length>0,L=e=>{const t=E(A,e);return Object.keys(t).forEach((e=>{const n=t[e];O(n)&&(t[e]=L(n))})),t},U=e=>{const t=E(P,e);return Object.keys(t).forEach((e=>{const n=t[e];O(n)&&(t[e]=U(n))})),t},j=e=>{let t=e;if(!S(e)&&!T(e))try{t=JSON.stringify(e)}catch(e){t=null}return t},N=e=>(e=>{const t=Array.from(e,(e=>String.fromCodePoint(e))).join("");return globalThis.btoa(t)})((new TextEncoder).encode(e)),H=(e,t,n,r,s)=>{const i={category:e,name:t,properties:n,options:r};return I(s)&&(i.callback=s),I(r)&&(i.category=e,i.name=t,i.properties=n,delete i.options,i.callback=r),I(n)&&(i.category=e,i.name=t,delete i.properties,delete i.options,i.callback=n),I(t)&&(i.category=e,delete i.name,delete i.properties,delete i.options,i.callback=t),I(e)&&(delete i.category,delete i.name,delete i.properties,delete i.options,i.callback=e),O(e)?(delete i.name,delete i.category,i.properties=e,i.options=t):O(t)&&(delete i.name,i.properties=t,i.options=I(n)?null:n),S(e)&&!S(t)&&(delete i.category,i.name=e),A(i.category)||delete i.category,A(i.name)||delete i.name,i.properties=i.properties?h(i.properties):{},A(i.options)?i.options=h(i.options):delete i.options,i.properties=M(O(i.properties)?i.properties:{},{name:S(i.name)?i.name:null,category:S(i.category)?i.category:null}),i},x=(e,t,n,r)=>{const s={name:e,properties:t,options:n};return I(r)&&(s.callback=r),I(n)&&(s.properties=t,delete s.options,s.callback=n),I(t)&&(delete s.properties,delete s.options,s.callback=t),s.properties=P(s.properties)?h(s.properties):{},A(s.options)?s.options=h(s.options):delete s.options,s},_=(e,t,n,r)=>{const s={userId:e,traits:t,options:n};return I(r)&&(s.callback=r),I(n)&&(s.userId=e,s.traits=t,delete s.options,s.callback=n),I(t)&&(s.userId=e,delete s.traits,delete s.options,s.callback=t),(O(e)||k(e))&&(s.userId=null,s.traits=e,s.options=t),A(s.userId)?s.userId=j(s.userId):delete s.userId,O(s.traits)?s.traits=h(s.traits):delete s.traits,A(s.options)?s.options=h(s.options):delete s.options,s},F=(e,t,n,r)=>{const s={to:e,from:t,options:n};return I(r)&&(s.callback=r),I(n)&&(s.to=e,s.from=t,delete s.options,s.callback=n),I(t)?(s.to=e,delete s.from,delete s.options,s.callback=t):(O(t)||k(t))&&(s.to=e,delete s.from,s.options=t),I(e)?(delete s.to,delete s.from,delete s.options,s.callback=e):(O(e)||k(e))&&(delete s.to,delete s.from,s.options=e),A(s.to)?s.to=j(s.to):delete s.to,A(s.from)?s.from=j(s.from):delete s.from,A(s.options)?s.options=h(s.options):delete s.options,s},Q=(e,t,n,r)=>{const s={groupId:e,traits:t,options:n};return I(r)&&(s.callback=r),I(n)&&(s.groupId=e,s.traits=t,delete s.options,s.callback=n),I(t)&&(s.groupId=e,delete s.traits,delete s.options,s.callback=t),I(e)?(s.groupId=null,delete s.traits,delete s.options,s.callback=e):(O(e)||k(e))&&(s.groupId=null,s.traits=e,s.options=I(t)?null:t),A(s.groupId)?s.groupId=j(s.groupId):delete s.groupId,s.traits=O(s.traits)?h(s.traits):{},A(s.options)?s.options=h(s.options):delete s.options,s},K="CapabilitiesManager",G="ConfigManager",z="EventManager",V="PluginsManager",q="UserSessionManager",W="ErrorHandler",J="PluginEngine",X="StoreManager",Z="RudderStackApplication",Y="AnalyticsCore",ee="RudderLabs JavaScript SDK",te="3.0.0-beta.19",ne="RudderJS-Initiated",re="preloadedEventsBuffer",se="ajs_aid",ie="ajs_uid",oe="ajs_event",ae=18e5,le=(e="app")=>{globalThis.RudderStackGlobals||(globalThis.RudderStackGlobals={}),globalThis.RudderStackGlobals[e]||(globalThis.RudderStackGlobals[e]={})},ue=(e,t,n="app")=>{le(n),globalThis.RudderStackGlobals[n][e]=t};const ce=(e,t)=>{const n={};return e.forEach(((r,s)=>{if(s.startsWith(t)){const r=s.substring(t.length);n[r]=e.get(s)}})),n},de=e=>{const t=((e,t="app")=>(le(t),globalThis.RudderStackGlobals[t][e]))(re)||[];((e=[])=>{const t="ajs_trait_",n="ajs_prop_",r=new URLSearchParams(globalThis.location.search);r.get(oe)&&e.unshift(["track",r.get(oe),ce(r,n)]),r.get(ie)&&e.unshift(["identify",r.get(ie),ce(r,t)]),r.get(se)&&e.unshift(["setAnonymousId",r.get(se)])})(t),t.length>0&&(e.enqueuePreloadBufferEvents(t),ue(re,[]))},ge=(e,t)=>{const n=e.shift();let r;if(I(t[n])){switch(n){case"page":r=H(...e);break;case"track":r=x(...e);break;case"identify":r=_(...e);break;case"alias":r=F(...e);break;case"group":r=Q(...e);break;default:t[n](...e)}r&&t[n](r)}},he=":: ",pe=(e,t)=>`Failed to load the script with the id "${e}" from URL "${t}".`,fe=(e,t,n)=>{const r=[];return function(s,i){if(!(t?.includes(s)||e&&T(i))){if("object"!=typeof i||k(i))return i;for(;r.length>0&&r[r.length-1]!==this;)r.pop();return r.includes(i)?(n?.warn(((e,t)=>`${e}${he}A circular reference has been detected in the object and the property "${t}" has been dropped from the output.`)("JSONStringify",s)),"[Circular Reference]"):(r.push(i),i)}}},ve=(e,t,n,r)=>{try{return JSON.stringify(e,fe(t,n,r))}catch(e){return r?.warn("Failed to convert the value to a JSON string.",e),null}},ye=(e,t)=>{let n=e;return R(e)?n.message=`${t}: ${e.message}`:n=new Error(`${t}: ${ve(e)}`),n},me=(e,t,n,r=!0,s)=>new Promise(((i,o)=>{document.getElementById(t)&&o(new Error((e=>`A script with the id "${e}" is already loaded. Skipping the loading of this script to prevent conflicts.`)(t)));try{let a;(e=>{const t=document.getElementsByTagName("head");if(t.length>0)return void t[0]?.insertBefore(e,t[0]?.firstChild);const n=document.getElementsByTagName("script");if(n.length>0&&n[0]?.parentNode)return void n[0]?.parentNode.insertBefore(e,n[0]);const r=document.createElement("head");r.appendChild(e);const s=document.getElementsByTagName("html")[0];s?.insertBefore(r,s.firstChild)})(((e,t,n=!0,r=null,s=null,i={})=>{const o=document.createElement("script");return o.type="text/javascript",o.onload=r,o.onerror=s,o.src=e,o.id=t,o.async=n,o.setAttribute("data-append-origin","RS_JS_SDK"),Object.keys(i).forEach((e=>{o.setAttribute(e,i[e])})),o})(e,t,r,(()=>{globalThis.clearTimeout(a),i(t)}),(()=>{globalThis.clearTimeout(a),o(new Error(pe(t,e)))}),s)),a=globalThis.setTimeout((()=>{o(new Error(((e,t,n)=>`A timeout of ${n} ms occurred while trying to load the script with id "${e}" from URL "${t}".`)(t,e,n)))}),n)}catch(n){o(ye(n,pe(t,e)))}}));class be{hasErrorHandler=!1;constructor(e,t,n=1e4){this.errorHandler=e,this.logger=t,this.timeout=n,this.hasErrorHandler=Boolean(this.errorHandler),this.onError=this.onError.bind(this)}loadJSFile(e){const{url:t,id:n,timeout:r,async:s,callback:i,extraAttributes:o}=e,a=!I(i);me(t,n,r||this.timeout,s,o).then((e=>{a||i(e)})).catch((e=>{this.onError(e),a||i()}))}onError(e){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,"ExternalSrcLoader")}}function Ee(){throw new Error("Cycle detected")}var Ie=Symbol.for("preact-signals");function Se(){if(Ae>1)Ae--;else{for(var e,t=!1;void 0!==Te;){var n=Te;for(Te=void 0,Pe++;void 0!==n;){var r=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&De(n))try{n.c()}catch(n){t||(e=n,t=!0)}n=r}}if(Pe=0,Ae--,t)throw e}}function ke(e){if(Ae>0)return e();Ae++;try{return e()}finally{Se()}}var we=void 0,Te=void 0,Ae=0,Pe=0,Re=0;function Ce(e){if(void 0!==we){var t=e.n;if(void 0===t||t.t!==we)return t={i:0,S:e,p:we.s,n:void 0,t:we,e:void 0,x:void 0,r:t},void 0!==we.s&&(we.s.n=t),we.s=t,e.n=t,32&we.f&&e.S(t),t;if(-1===t.i)return t.i=0,void 0!==t.n&&(t.n.p=t.p,void 0!==t.p&&(t.p.n=t.n),t.p=we.s,t.n=void 0,we.s.n=t,we.s=t),t}}function $e(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}function Oe(e){return new $e(e)}function De(e){for(var t=e.s;void 0!==t;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function Me(e){for(var t=e.s;void 0!==t;t=t.n){var n=t.S.n;if(void 0!==n&&(t.r=n),t.S.n=t,t.i=-1,void 0===t.n){e.s=t;break}}}function Be(e){for(var t=e.s,n=void 0;void 0!==t;){var r=t.p;-1===t.i?(t.S.U(t),void 0!==r&&(r.n=t.n),void 0!==t.n&&(t.n.p=r)):n=t,t.S.n=t.r,void 0!==t.r&&(t.r=void 0),t=r}e.s=n}function Le(e){$e.call(this,void 0),this.x=e,this.s=void 0,this.g=Re-1,this.f=4}function Ue(e){var t=e.u;if(e.u=void 0,"function"==typeof t){Ae++;var n=we;we=void 0;try{t()}catch(t){throw e.f&=-2,e.f|=8,je(e),t}finally{we=n,Se()}}}function je(e){for(var t=e.s;void 0!==t;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,Ue(e)}function Ne(e){if(we!==this)throw new Error("Out-of-order effect");Be(this),we=e,this.f&=-2,8&this.f&&je(this),Se()}function He(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}function xe(e){var t=new He(e);try{t.c()}catch(e){throw t.d(),e}return t.d.bind(t)}$e.prototype.brand=Ie,$e.prototype.h=function(){return!0},$e.prototype.S=function(e){this.t!==e&&void 0===e.e&&(e.x=this.t,void 0!==this.t&&(this.t.e=e),this.t=e)},$e.prototype.U=function(e){if(void 0!==this.t){var t=e.e,n=e.x;void 0!==t&&(t.x=n,e.e=void 0),void 0!==n&&(n.e=t,e.x=void 0),e===this.t&&(this.t=n)}},$e.prototype.subscribe=function(e){var t=this;return xe((function(){var n=t.value,r=32&this.f;this.f&=-33;try{e(n)}finally{this.f|=r}}))},$e.prototype.valueOf=function(){return this.value},$e.prototype.toString=function(){return this.value+""},$e.prototype.toJSON=function(){return this.value},$e.prototype.peek=function(){return this.v},Object.defineProperty($e.prototype,"value",{get:function(){var e=Ce(this);return void 0!==e&&(e.i=this.i),this.v},set:function(e){if(we instanceof Le&&function(){throw new Error("Computed cannot have side-effects")}(),e!==this.v){Pe>100&&Ee(),this.v=e,this.i++,Re++,Ae++;try{for(var t=this.t;void 0!==t;t=t.x)t.t.N()}finally{Se()}}}}),(Le.prototype=new $e).h=function(){if(this.f&=-3,1&this.f)return!1;if(32==(36&this.f))return!0;if(this.f&=-5,this.g===Re)return!0;if(this.g=Re,this.f|=1,this.i>0&&!De(this))return this.f&=-2,!0;var e=we;try{Me(this),we=this;var t=this.x();(16&this.f||this.v!==t||0===this.i)&&(this.v=t,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return we=e,Be(this),this.f&=-2,!0},Le.prototype.S=function(e){if(void 0===this.t){this.f|=36;for(var t=this.s;void 0!==t;t=t.n)t.S.S(t)}$e.prototype.S.call(this,e)},Le.prototype.U=function(e){if(void 0!==this.t&&($e.prototype.U.call(this,e),void 0===this.t)){this.f&=-33;for(var t=this.s;void 0!==t;t=t.n)t.S.U(t)}},Le.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;void 0!==e;e=e.x)e.t.N()}},Le.prototype.peek=function(){if(this.h()||Ee(),16&this.f)throw this.v;return this.v},Object.defineProperty(Le.prototype,"value",{get:function(){1&this.f&&Ee();var e=Ce(this);if(this.h(),void 0!==e&&(e.i=this.i),16&this.f)throw this.v;return this.v}}),He.prototype.c=function(){var e=this.S();try{if(8&this.f)return;if(void 0===this.x)return;var t=this.x();"function"==typeof t&&(this.u=t)}finally{e()}},He.prototype.S=function(){1&this.f&&Ee(),this.f|=1,this.f&=-9,Ue(this),Me(this),Ae++;var e=we;return we=this,Ne.bind(this,e)},He.prototype.N=function(){2&this.f||(this.f|=2,this.o=Te,Te=this)},He.prototype.d=function(){this.f|=8,1&this.f||je(this)};const _e={LOG:0,INFO:1,DEBUG:2,WARN:3,ERROR:4,NONE:5},Fe="ERROR";const Qe=new class{constructor(e=Fe,t="",n=console){this.minLogLevel=_e[e],this.scope=t,this.logProvider=n}log(...e){this.outputLog("LOG",e)}info(...e){this.outputLog("INFO",e)}debug(...e){this.outputLog("DEBUG",e)}warn(...e){this.outputLog("WARN",e)}error(...e){this.outputLog("ERROR",e)}outputLog(e,t){this.minLogLevel<=_e[e]&&this.logProvider[e.toLowerCase()]?.(...this.formatLogData(t))}setScope(e){this.scope=e||this.scope}setMinLogLevel(e){this.minLogLevel=_e[e],w(this.minLogLevel)&&(this.minLogLevel=_e[Fe])}formatLogData(e){if(Array.isArray(e)&&e.length>0){let t="%c RS SDK";this.scope&&(t=`${t} - ${this.scope}`);t=`${t} %c ${S(e[0])?e[0].trim():""}`;const n=[t,"font-weight: bold; background: black; color: white;","font-weight: normal;"];return S(e[0])||n.push(e[0]),n.push(...e.slice(1)),n}return e}},Ke=["localStorage","memoryStorage","cookieStorage","sessionStorage","none"],Ge="cookieStorage",ze="Unable to process/parse source configuration response.",Ve=(e,t,n)=>`${e} due to timeout or no connection (${t?t.type:""}) for URL: ${n}.`,qe="Failed to invoke the ready callback",We="js-integrations",Je="plugins",Xe="modern",Ze="https://cdn.rudderlabs.com",Ye=`${Ze}/beta/3.0.0-beta/${Xe}/${We}`,et=`${Ze}/beta/3.0.0-beta/${Xe}/${Je}`,tt="https://api.rudderstack.com",nt="bugsnag",rt="v3",st={oneTrust:"OneTrustConsentManager",ketch:"KetchConsentManager",custom:"CustomConsentManager"},it={[nt]:"Bugsnag"},ot={[rt]:"StorageEncryption",legacy:"StorageEncryptionLegacy"},at=Oe(h({logLevel:"ERROR",configUrl:tt,loadIntegration:!0,sessions:{autoTrack:!0,timeout:ae},sameSiteCookie:"Lax",polyfillIfRequired:!0,integrations:{All:!0},useBeacon:!1,beaconQueueOptions:{},destinationsQueueOptions:{},queueOptions:{},lockIntegrationsVersion:!1,uaChTrackLevel:"none",plugins:[],useGlobalIntegrationsConfigInEvents:!1,bufferDataPlaneEventsUntilReady:!1,dataPlaneEventsBufferTimeout:1e4,storage:{encryption:{version:rt},migrate:!1},sendAdblockPageOptions:{}})),lt={userId:"rl_user_id",userTraits:"rl_trait",anonymousId:"rl_anonymous_id",groupId:"rl_group_id",groupTraits:"rl_group_trait",initialReferrer:"rl_page_init_referrer",initialReferringDomain:"rl_page_init_referring_domain",sessionInfo:"rl_session",authToken:"rl_auth_token"},ut={userId:"",userTraits:{},anonymousId:"",groupId:"",groupTraits:{},initialReferrer:"",initialReferringDomain:"",sessionInfo:{},authToken:null},ct={autoTrack:!0,timeout:ae},dt={userId:Oe(ut.userId),userTraits:Oe(ut.userTraits),anonymousId:Oe(ut.anonymousId),groupId:Oe(ut.groupId),groupTraits:Oe(ut.groupTraits),initialReferrer:Oe(ut.initialReferrer),initialReferringDomain:Oe(ut.initialReferringDomain),sessionInfo:Oe(ut.sessionInfo),authToken:Oe(ut.authToken)},gt={isOnline:Oe(!0),storage:{isLocalStorageAvailable:Oe(!1),isCookieStorageAvailable:Oe(!1),isSessionStorageAvailable:Oe(!1)},isBeaconAvailable:Oe(!1),isLegacyDOM:Oe(!1),isUaCHAvailable:Oe(!1),isCryptoAvailable:Oe(!1),isIE11:Oe(!1),isAdBlocked:Oe(!1)},ht={isErrorReportingEnabled:Oe(!1),isMetricsReportingEnabled:Oe(!1),errorReportingProviderPluginName:Oe(void 0)},pt=Oe(void 0),ft={activeDataplaneUrl:Oe(void 0),integrationsCDNPath:Oe(Ye),pluginsCDNPath:Oe(et),sourceConfigUrl:Oe(void 0),status:Oe(void 0),initialized:Oe(!1),logLevel:Oe("ERROR"),loaded:Oe(!1),readyCallbacks:Oe([]),writeKey:Oe(void 0),dataPlaneUrl:Oe(void 0)},vt={enabled:Oe(!1),initialized:Oe(!1),data:Oe({}),activeConsentManagerPluginName:Oe(void 0),preConsent:Oe({enabled:!1}),postConsent:Oe({}),resolutionStrategy:Oe("and"),provider:Oe(void 0),metadata:Oe(void 0)},yt={retries:Oe(0),dropped:Oe(0),sent:Oe(0),queued:Oe(0),triggered:Oe(0)},mt={app:Oe({name:ee,namespace:"com.rudderlabs.javascript",version:te}),traits:Oe(null),library:Oe({name:ee,version:te,snippetVersion:globalThis.RudderSnippetVersion}),userAgent:Oe(""),device:Oe(null),network:Oe(null),os:Oe({name:"",version:""}),locale:Oe(null),screen:Oe({density:0,width:0,height:0,innerWidth:0,innerHeight:0}),"ua-ch":Oe(void 0),timezone:Oe(void 0)},bt={configuredDestinations:Oe([]),activeDestinations:Oe([]),loadOnlyIntegrations:Oe({}),failedDestinations:Oe([]),loadIntegration:Oe(!0),initializedDestinations:Oe([]),clientDestinationsReady:Oe(!1),integrationsConfig:Oe({})},Et={toBeProcessedArray:Oe([]),readyCallbacksArray:Oe([])},It={ready:Oe(!1),loadedPlugins:Oe([]),failedPlugins:Oe([]),pluginsToLoadFromConfig:Oe([]),activePlugins:Oe([]),totalPluginsToLoad:Oe(0)},St={encryptionPluginName:Oe(void 0),migrate:Oe(!1),type:Oe(void 0),cookie:Oe(void 0),entries:Oe({}),trulyAnonymousTracking:Oe(!1)},kt={...h({capabilities:gt,consents:vt,context:mt,eventBuffer:Et,lifecycle:ft,loadOptions:at,metrics:yt,nativeDestinations:bt,plugins:It,reporting:ht,session:dt,source:pt,storage:St})};const wt=new class{plugins=[];byName={};cache={};config={throws:!0};constructor(e={},t){this.config={throws:!0,...e},this.logger=t}register(e,t){if(!e.name){const t=`${J}${he}Plugin name is missing.`;if(this.config.throws)throw new Error(t);this.logger?.error(t,e)}if(this.byName[e.name]){const t=((e,t)=>`${e}${he}Plugin "${t}" already exists.`)(J,e.name);if(this.config.throws)throw new Error(t);this.logger?.error(t)}this.cache={},this.plugins=this.plugins.slice();let n=this.plugins.length;this.plugins.forEach(((t,r)=>{t.deps?.includes(e.name)&&(n=Math.min(n,r))})),this.plugins.splice(n,0,e),this.byName[e.name]=e,I(e.initialize)&&e.initialize(t)}unregister(e){const t=this.byName[e];if(!t){const t=`${J}${he}Plugin "${e}" not found.`;if(this.config.throws)throw new Error(t);this.logger?.error(t)}const n=this.plugins.indexOf(t);if(-1===n){const t=((e,t)=>`${e}${he}Plugin "${t}" not found in plugins but found in byName. This indicates a bug in the plugin engine. Please report this issue to the development team.`)(J,e);if(this.config.throws)throw new Error(t);this.logger?.error(t)}this.cache={},delete this.byName[e],this.plugins=this.plugins.slice(),this.plugins.splice(n,1)}getPlugin(e){return this.byName[e]}getPlugins(e){const t=e??".";return this.cache[t]||(this.cache[t]=this.plugins.filter((e=>{if(e.deps?.some((e=>!this.byName[e]))){const t=e.deps.filter((e=>!this.byName[e]));return this.logger?.error(((e,t,n)=>`${e}${he}Plugin "${t}" could not be loaded because some of its dependencies "${n}" do not exist.`)(J,e.name,t)),!1}return"."===t||((e,t)=>Boolean(C(e,t)))(e,t)}))),this.cache[t]}processRawPlugins(e){e(this.plugins),this.cache={}}invoke(e,t=!0,...n){let r=e;if(!r)throw new Error("Failed to invoke plugin because the extension point name is missing.");const s=r.startsWith("!"),i=this.config.throws??r.endsWith("!");if(r=r.replace(/(^!|!$)/g,""),!r)throw new Error("Failed to invoke plugin because the extension point name is invalid.");const o=r.split(".");o.pop();const a=o.join(".");return(t?this.getPlugins(r):[this.getPlugins(r)[0]]).map((e=>{const t=C(e,r);if(!I(t)||s)return t;try{return t.apply(C(e,a),n)}catch(t){if(i)throw t;this.logger?.error(((e,t,n)=>`${e}${he}Failed to invoke the "${t}" extension point of plugin "${n}".`)(J,r,e.name),t)}return null}))}invokeSingle(e,...t){return this.invoke(e,!1,...t)[0]}invokeMultiple(e,...t){return this.invoke(e,!0,...t)}}({throws:!0},Qe),Tt="The request failed",At=[Tt];const Pt=new class{constructor(e,t){this.logger=e,this.pluginEngine=t}init(e){if(this.pluginEngine)try{const t="errorReporting.init",n=this.pluginEngine.invokeSingle(t,kt,this.pluginEngine,e,this.logger);n instanceof Promise&&n.then((e=>{this.errReportingClient=e})).catch((e=>{this.logger?.error(`${W}${he}Failed to initialize the error reporting plugin.`,e)}))}catch(e){this.onError(e,W)}}onError(e,t="",n="",r=!1){let s=(e=>{let t;try{t=S(e)?e:e instanceof Error||e.message?e.message:ve(e)}catch(e){t=`Unknown error: ${e.message}`}return t})(e);if(!s)return;s=`${t}${he}${n} ${s}`.replace(/ {2,}/g," ");let i=e;if(R(e)?i.message=s:i=new Error(s),this.notifyError(i),!this.logger)throw i;if(this.logger.error(s),r)throw i}leaveBreadcrumb(e){if(this.pluginEngine)try{this.pluginEngine.invokeSingle("errorReporting.breadcrumb",this.pluginEngine,this.errReportingClient,e,this.logger)}catch(e){this.onError(e,W,"errorReporting.breadcrumb")}}notifyError(e){if(this.pluginEngine&&(e=>!e.message||!At.some((t=>e.message.includes(t))))(e))try{this.pluginEngine.invokeSingle("errorReporting.notify",this.pluginEngine,this.errReportingClient,e,kt,this.logger)}catch(e){this.logger?.error(`${W}${he}Failed to notify the error.`,e)}}}(Qe,wt),Rt=e=>Boolean("cloud"!==e.config.connectionMode||!0===e.config.useNativeSDKToSend||!0===e.config.useNativeSDK),Ct=["BeaconQueue","Bugsnag","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ErrorReporting","ExternalAnonymousId","GoogleLinker","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],$t={rudderAnalyticsRemotePlugins:{url:()=>Promise.resolve(window.RudderStackGlobals&&window.RudderStackGlobals.app&&window.RudderStackGlobals.app.pluginsCDNPath?window.RudderStackGlobals.app.pluginsCDNPath+"/rsa-plugins.js":"https://cdn.rudderlabs.com/beta/3.0.0-beta/modern/plugins/rsa-plugins.js"),format:"esm",from:"vite"}},Ot=async(e,t)=>{const n="function"==typeof e?await e():e,r=document.createElement("script");r.type="text/javascript",r.onload=t,r.src=n,document.getElementsByTagName("head")[0].appendChild(r)},Dt=e=>({});function Mt(e,t){if(!e?.default&&t){let t=Object.create(null);return t.default=e,t.__esModule=!0,t}return e}function Bt(e,t){return async function(e){const t=$t[e];return t.inited?t.lib:"var"===t.format?new Promise((n=>Ot(t.url,(()=>{t.inited||(t.lib=window[e],t.lib.init(Dt(t.from)),t.inited=!0),n(t.lib)})))):["esm","systemjs"].includes(t.format)?new Promise(((e,n)=>{("function"==typeof t.url?t.url:()=>Promise.resolve(t.url))().then((r=>{import(r).then((n=>{if(!t.inited){const e=Dt(t.from);n.init(e),t.lib=n,t.lib.init(e),t.inited=!0}e(t.lib)})).catch(n)}))})):void 0}(e).then((e=>e.get(t).then((e=>e()))))}const Lt=e=>{const t={};return e.forEach((e=>{if(Ct.includes(e)){const n=(e=>{switch(e){case"BeaconQueue":return()=>Bt("rudderAnalyticsRemotePlugins","./BeaconQueue").then((e=>Mt(e,!0)));case"Bugsnag":return()=>Bt("rudderAnalyticsRemotePlugins","./Bugsnag").then((e=>Mt(e,!0)));case"CustomConsentManager":return()=>Bt("rudderAnalyticsRemotePlugins","./CustomConsentManager").then((e=>Mt(e,!0)));case"DeviceModeDestinations":return()=>Bt("rudderAnalyticsRemotePlugins","./DeviceModeDestinations").then((e=>Mt(e,!0)));case"DeviceModeTransformation":return()=>Bt("rudderAnalyticsRemotePlugins","./DeviceModeTransformation").then((e=>Mt(e,!0)));case"ErrorReporting":return()=>Bt("rudderAnalyticsRemotePlugins","./ErrorReporting").then((e=>Mt(e,!0)));case"ExternalAnonymousId":return()=>Bt("rudderAnalyticsRemotePlugins","./ExternalAnonymousId").then((e=>Mt(e,!0)));case"GoogleLinker":return()=>Bt("rudderAnalyticsRemotePlugins","./GoogleLinker").then((e=>Mt(e,!0)));case"KetchConsentManager":return()=>Bt("rudderAnalyticsRemotePlugins","./KetchConsentManager").then((e=>Mt(e,!0)));case"NativeDestinationQueue":return()=>Bt("rudderAnalyticsRemotePlugins","./NativeDestinationQueue").then((e=>Mt(e,!0)));case"OneTrustConsentManager":return()=>Bt("rudderAnalyticsRemotePlugins","./OneTrustConsentManager").then((e=>Mt(e,!0)));case"StorageEncryption":return()=>Bt("rudderAnalyticsRemotePlugins","./StorageEncryption").then((e=>Mt(e,!0)));case"StorageEncryptionLegacy":return()=>Bt("rudderAnalyticsRemotePlugins","./StorageEncryptionLegacy").then((e=>Mt(e,!0)));case"StorageMigrator":return()=>Bt("rudderAnalyticsRemotePlugins","./StorageMigrator").then((e=>Mt(e,!0)));case"XhrQueue":return()=>Bt("rudderAnalyticsRemotePlugins","./XhrQueue").then((e=>Mt(e,!0)));default:return}})(e);n&&(t[e]=n)}})),t},Ut=e=>Lt?.(e)||{},jt={};class Nt{constructor(e,t,n){this.engine=e,this.errorHandler=t,this.logger=n,this.onError=this.onError.bind(this)}init(){kt.lifecycle.status.value="pluginsLoading",ue("pluginsCDNPath",kt.lifecycle.pluginsCDNPath.value),this.setActivePlugins(),this.registerLocalPlugins(),this.registerRemotePlugins(),this.attachEffects()}attachEffects(){xe((()=>{(0===kt.plugins.activePlugins.value.length||kt.plugins.loadedPlugins.value.length+kt.plugins.failedPlugins.value.length===kt.plugins.totalPluginsToLoad.value)&&ke((()=>{kt.plugins.ready.value=!0,kt.lifecycle.status.value="pluginsReady"}))}))}getPluginsToLoadBasedOnConfig(){let e=kt.plugins.pluginsToLoadFromConfig.value;if(!e)return[];const t=Object.values(it);var n;e=kt.reporting.errorReportingProviderPluginName.value?e.filter((e=>!(e!==kt.reporting.errorReportingProviderPluginName.value&&t.includes(e)))):e.filter((e=>!("ErrorReporting"===e||t.includes(e)))),!0===kt.loadOptions.value.useBeacon&&kt.capabilities.isBeaconAvailable.value?e=e.filter((e=>"XhrQueue"!==e)):(!0===kt.loadOptions.value.useBeacon&&this.logger?.warn(`${V}${he}The Beacon API is not supported by your browser. The events will be sent using XHR instead.`),e=e.filter((e=>"BeaconQueue"!==e))),e.includes("XhrQueue")||e.includes("BeaconQueue")||e.push("XhrQueue"),0===(n=kt.nativeDestinations.configuredDestinations.value??[],n.filter(Rt)).length&&(e=e.filter((e=>!["DeviceModeDestinations","DeviceModeTransformation","NativeDestinationQueue"].includes(e))));const r=Object.values(st);let s=e=>!(e!==kt.consents.activeConsentManagerPluginName.value&&r.includes(e));kt.consents.enabled.value||(s=e=>!r.includes(e)),e=e.filter(s);const i=Object.values(ot);return e=e.filter((e=>!(e!==kt.storage.encryptionPluginName.value&&i.includes(e)))),kt.storage.migrate.value||(e=e.filter((e=>"StorageMigrator"!==e))),[...Object.keys({}),...e]}setActivePlugins(){const e=this.getPluginsToLoadBasedOnConfig(),t=[...Object.keys(jt),...Ct],n=[],r=[];e.forEach((e=>{t.includes(e)?n.push(e):r.push(e)})),r.length>0&&this.onError(new Error(`Ignoring loading of unknown plugins: ${r.join(",")}. Mandatory plugins: ${Object.keys({}).join(",")}. Load option plugins: ${kt.plugins.pluginsToLoadFromConfig.value.join(",")}`)),ke((()=>{kt.plugins.totalPluginsToLoad.value=e.length,kt.plugins.activePlugins.value=n,kt.plugins.failedPlugins.value=r}))}registerLocalPlugins(){Object.values(jt).forEach((e=>{I(e)&&kt.plugins.activePlugins.value.includes(e().name)&&this.register([e()])}))}registerRemotePlugins(){const e=(t=kt.plugins.activePlugins.value,{...Ut(t)});var t;Promise.all(Object.keys(e).map((async t=>{await e[t]().then((e=>this.register([e.default()]))).catch((e=>{kt.plugins.failedPlugins.value=[...kt.plugins.failedPlugins.value,t],this.onError(e,t)}))}))).catch((e=>{this.onError(e)}))}invokeMultiple(e,...t){try{return this.engine.invokeMultiple(e,...t)}catch(t){return this.onError(t,e),[]}}invokeSingle(e,...t){try{return this.engine.invokeSingle(e,...t)}catch(t){return this.onError(t,e),null}}register(e){e.forEach((e=>{try{this.engine.register(e,kt)}catch(t){kt.plugins.failedPlugins.value=[...kt.plugins.failedPlugins.value,e.name],this.onError(t)}}))}unregisterLocalPlugins(){Object.values(jt).forEach((e=>{try{this.engine.unregister(e().name)}catch(e){this.onError(e)}}))}onError(e,t){if(!this.errorHandler)throw e;this.errorHandler.onError(e,V,t)}}const Ht=(e,t)=>{try{return JSON.parse(e||"")}catch(e){const n=ye(e,"Failed to parse response data");if(!I(t))throw n;t(n)}},xt={headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},method:"GET"},_t=(e,t,n)=>{const r=M(xt,t||{});return n&&(r.headers=M(r.headers,{Authorization:n})),r.url=e,r},Ft=(e,t=1e4,n)=>new Promise(((r,s)=>{let i;if(!0===e.sendRawData)i=e.data;else if(i=ve(e.data,!1,[],n),k(i))return void s({error:new Error("Failed to prepare data for the request."),undefined:void 0,options:e});const o=new XMLHttpRequest,a=t=>{s({error:new Error(Ve(Tt,t,e.url)),xhr:o,options:e})};o.ontimeout=a,o.onerror=a,o.onload=()=>{var t,n,i,a;o.status>=200&&o.status<400?r({response:o.responseText,xhr:o,options:e}):s({error:new Error((t=Tt,n=o.status,i=o.statusText,a=e.url,`${t} with status: ${n}, ${i} for URL: ${a}.`)),xhr:o,options:e})},o.open(e.method,e.url),o.timeout=t,Object.keys(e.headers).forEach((t=>{e.headers[t]&&o.setRequestHeader(t,e.headers[t])}));try{o.send(i)}catch(t){s({error:ye(t,(l=Tt,u=e.url,`${l} for URL: ${u}`)),xhr:o,options:e})}var l,u}));class Qt{hasErrorHandler=!1;constructor(e,t){this.errorHandler=e,this.logger=t,this.hasErrorHandler=Boolean(this.errorHandler),this.onError=this.onError.bind(this)}async getData(e){const{url:t,options:n,timeout:r,isRawResponse:s}=e;try{const e=await Ft(_t(t,n,this.basicAuthHeader),r,this.logger);return{data:s?e.response:Ht(e.response,this.onError),details:e}}catch(e){return this.onError(e.error??e),{data:void 0,details:e}}}getAsyncData(e){const{callback:t,url:n,options:r,timeout:s,isRawResponse:i}=e,o=!I(t);Ft(_t(n,r,this.basicAuthHeader),s,this.logger).then((e=>{o||t(i?e.response:Ht(e.response,this.onError),e)})).catch((e=>{this.onError(e.error??e),o||t(void 0,e)}))}onError(e){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,"HttpClient")}setAuthHeader(e,t=!1){const n=t?e:N(`${e}:`);this.basicAuthHeader=`Basic ${n}`}resetAuthHeader(){this.basicAuthHeader=void 0}}const Kt=new Qt(Pt,Qe),Gt="cookieStorage",zt="localStorage",Vt="sessionStorage",qt="memoryStorage",Wt="none",Jt="clientDataInCookie",Xt="clientDataInLocalStorage",Zt="clientDataInSessionStorage",Yt=["userId","userTraits","anonymousId","groupId","groupTraits","initialReferrer","initialReferringDomain","sessionInfo","authToken"],en={[Gt]:Jt,[zt]:Xt,[qt]:"clientDataInMemory",[Vt]:Zt},tn=()=>!T(globalThis.navigator.userAgentData),nn={URL:()=>!I(globalThis.URL)||!globalThis.URLSearchParams,MutationObserver:()=>w(MutationObserver),Promise:()=>w(Promise),"Number.isNaN":()=>!Number.isNaN,"Number.isInteger":()=>!Number.isInteger,"Array.from":()=>!Array.from,"Array.prototype.find":()=>!Array.prototype.find,"Array.prototype.includes":()=>!Array.prototype.includes,"String.prototype.endsWith":()=>!String.prototype.endsWith,"String.prototype.startsWith":()=>!String.prototype.startsWith,"String.prototype.includes":()=>!String.prototype.includes,"Object.entries":()=>!Object.entries,"Object.values":()=>!Object.values,"Object.assign":()=>"function"!=typeof Object.assign,"Element.prototype.dataset":()=>!(()=>{const e=document.createElement("div");return e.setAttribute("data-a-b","c"),!!e.dataset&&"c"===e.dataset.aB})(),"String.prototype.replaceAll":()=>!String.prototype.replaceAll,TextEncoder:()=>w(TextEncoder)||w(TextDecoder),"String.fromCodePoint":()=>!String.fromCodePoint,requestAnimationFrame:()=>!I(globalThis.requestAnimationFrame)||!I(globalThis.cancelAnimationFrame),CustomEvent:()=>!I(globalThis.CustomEvent),"navigator.sendBeacon":()=>!I(navigator.sendBeacon),ArrayBuffer:()=>!I(Uint8Array)},rn=()=>{let e={density:0,width:0,height:0,innerWidth:0,innerHeight:0};return e={width:globalThis.screen.width,height:globalThis.screen.height,density:globalThis.devicePixelRatio,innerWidth:globalThis.innerWidth,innerHeight:globalThis.innerHeight},e},sn=e=>{const t=["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"].includes(e.name)||[22,1014].includes(e.code);return e instanceof DOMException&&t},on=(e=zt,t,n)=>{let r,s;try{switch(e){case qt:return!0;case Gt:r=t,s="test_rudder_cookie";break;case zt:r=t??globalThis.localStorage,s="test_rudder_ls";break;case Vt:r=t??globalThis.sessionStorage,s="test_rudder_ss";break;default:return!1}return!!r&&(r.setItem(s,"true"),!!r.getItem(s)&&(r.removeItem(s),!0))}catch(t){const r=`${K}${he}The "${e}" storage type is `;let s="unavailable";return sn(t)&&(s="full"),n?.error(`${r}${s}.`,t),!1}},an=(e,t)=>{try{return encodeURIComponent(e)}catch(e){return void t?.error("Failed to encode the cookie data.",e)}},ln=e=>{try{return decodeURIComponent(e)}catch(e){return}},un=()=>(e=>{const t={},n=e.split(/\s*;\s*/);let r;return n[0]?(n.forEach((e=>{r=e.split("=");const n=r[0]?ln(r[0]):void 0;n&&(t[n]=r[1]?ln(r[1]):void 0)})),t):t})(globalThis.document.cookie),cn=function(e,t,n,r){switch(arguments.length){case 4:case 3:case 2:return((e,t,n,r)=>{const s={...n}||{};let i=`${an(e,r)}=${an(t,r)}`;k(t)&&(s.maxage=-1),s.maxage&&(s.expires=new Date(+new Date+s.maxage)),s.path&&(i+=`; path=${s.path}`),s.domain&&(i+=`; domain=${s.domain}`),s.expires&&(i+=`; expires=${s.expires.toUTCString()}`),s.samesite&&(i+=`; samesite=${s.samesite}`),s.secure&&(i+="; secure"),globalThis.document.cookie=i})(e,t,n,r);case 1:return e?(e=>un()[e])(e):un();default:return un()}},dn=e=>{const t="function"!=typeof globalThis.URL?(e=>{const t=document.createElement("a");return t.href=e,t.hostname})(e):new URL(e).hostname,n=t?.split(".")??[],r=n[n.length-1],s=[];if(4===n.length&&r&&r===parseInt(r,10).toString())return s;if(n.length<=1)return n[0]&&-1!==n[0].indexOf("localhost")?["localhost"]:s;for(let e=n.length-2;e>=0;e-=1)s.push(n.slice(e).join("."));return s},gn=()=>{const e=(e=>{const t=dn(e);for(let e=0;e<t.length;e+=1){const n=t[e],r="__tld__",s={domain:`${-1!==n.indexOf("localhost")?"":"."}${n}`};if(cn(r,1,s),cn(r))return cn(r,null,s),n}return""})(globalThis.location.href);return{maxage:31536e6,path:"/",domain:e&&"."!==e?e:void 0,samesite:"Lax",enabled:!0}};class hn{static globalSingleton=null;isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e={},t){if(hn.globalSingleton)return hn.globalSingleton;this.options=gn(),this.logger=t,this.configure(e),hn.globalSingleton=this}configure(e){return this.options=M(this.options??{},e),e.sameDomainCookiesOnly&&delete this.options.domain,this.isSupportAvailable=on(Gt,this,this.logger),this.isEnabled=Boolean(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){return cn(e,t,this.options,this.logger),this.length=Object.keys(cn()).length,!0}getItem(e){const t=cn(e);return w(t)?null:t}removeItem(e){const t=this.setItem(e,null);return this.length=Object.keys(cn()).length,t}clear(){}key(e){const t=cn(),n=Object.keys(t);return w(n[e])?null:n[e]}}const pn=new class{isEnabled=!0;length=0;data={};constructor(e,t){this.options={enabled:!0},this.logger=t,this.configure(e??{})}configure(e){return this.options=M(this.options,e),this.isEnabled=Boolean(this.options.enabled),this.options}setItem(e,t){return this.data[e]=t,this.length=Object.keys(this.data).length,t}getItem(e){return e in this.data?this.data[e]:null}removeItem(e){return e in this.data&&delete this.data[e],this.length=Object.keys(this.data).length,null}clear(){this.data={},this.length=0}key(e){return Object.keys(this.data)[e]?Object.keys(this.data)[e]:null}}({},Qe);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function fn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var vn={exports:{}};vn.exports=function(){function e(e){return e=JSON.stringify(e),!!/^\{[\s\S]*\}$/.test(e)}function t(e){return void 0===e||"function"==typeof e?e+"":JSON.stringify(e)}function n(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}}function r(e){return"[object Function]"==={}.toString.call(e)}function s(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){var t="_Is_Incognit",n="yes";try{e||(e=window.localStorage),e.setItem(t,n),e.removeItem(t)}catch(t){var r={_data:{},setItem:function(e,t){return r._data[e]=String(t)},getItem:function(e){return r._data.hasOwnProperty(e)?r._data[e]:void 0},removeItem:function(e){return delete r._data[e]},clear:function(){return r._data={}}};e=r}finally{e.getItem(t)===n&&e.removeItem(t)}return e}var o=i();function a(){if(!(this instanceof a))return new a}a.prototype={set:function(n,r){if(n&&!e(n))o.setItem(n,t(r));else if(e(n))for(var s in n)this.set(s,n[s]);return this},get:function(e){if(void 0===e){var t={};return this.forEach((function(e,n){return t[e]=n})),t}if("?"===e.charAt(0))return this.has(e.substr(1));var r=arguments;if(r.length>1){for(var s={},i=0,a=r.length;i<a;i++){var l=n(o.getItem(r[i]));this.has(r[i])&&(s[r[i]]=l)}return s}return n(o.getItem(e))},clear:function(){return o.clear(),this},remove:function(e){var t=this.get(e);return o.removeItem(e),t},has:function(e){return{}.hasOwnProperty.call(this.get(),e)},keys:function(){var e=[];return this.forEach((function(t){e.push(t)})),e},forEach:function(e){for(var t=0,n=o.length;t<n;t++){var r=o.key(t);e(r,this.get(r))}return this},search:function(e){for(var t=this.keys(),n={},r=0,s=t.length;r<s;r++)t[r].indexOf(e)>-1&&(n[t[r]]=this.get(t[r]));return n}};var l=null;function u(t,n){var i=arguments,o=null;if(l||(l=a()),0===i.length)return l.get();if(1===i.length){if("string"==typeof t)return l.get(t);if(e(t))return l.set(t)}if(2===i.length&&"string"==typeof t){if(!n)return l.remove(t);if(n&&"string"==typeof n)return l.set(t,n);n&&r(n)&&(o=null,o=n(t,l.get(t)),u.set(t,o))}if(2===i.length&&s(t)&&r(n))for(var c=0,d=t.length;c<d;c++)o=n(t[c],l.get(t[c])),u.set(t[c],o);return u}for(var c in a.prototype)u[c]=a.prototype[c];return u}();const yn=fn(vn.exports);const mn=new class{isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e={},t){this.options={enabled:!0},this.logger=t,this.configure(e)}configure(e){return this.options=M(this.options,e),this.isSupportAvailable=on(zt,this,this.logger),this.isEnabled=Boolean(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){yn.set(e,t),this.length=yn.keys().length}getItem(e){const t=yn.get(e);return w(t)?null:t}removeItem(e){yn.remove(e),this.length=yn.keys().length}clear(){yn.clear(),this.length=0}key(e){return yn.keys()[e]?yn.keys()[e]:null}}({},Qe);const bn=new class{isSupportAvailable=!0;isEnabled=!0;length=0;store=globalThis.sessionStorage;constructor(e={},t){this.options={enabled:!0},this.logger=t,this.configure(e)}configure(e){return this.options=M(this.options,e),this.isSupportAvailable=on(Vt,this,this.logger),this.isEnabled=Boolean(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){this.store.setItem(e,t),this.length=this.store.length}getItem(e){const t=this.store.getItem(e);return w(t)?null:t}removeItem(e){this.store.removeItem(e),this.length=this.store.length}clear(){this.store.clear(),this.length=0}key(e){return this.store.key(e)}}({},Qe),En=e=>{switch(e){case zt:return mn;case Vt:return bn;case qt:return pn;case Gt:return new hn({},Qe);default:return pn}},In=(e={},t={},n={},r={})=>{var s;s=e,new hn({},Qe).configure(s),(e=>{mn.configure(e)})(t),(e=>{pn.configure(e)})(n),(e=>{bn.configure(e)})(r)};class Sn{hasErrorHandler=!1;constructor(e,t,n){this.id=e.id,this.name=e.name,this.isEncrypted=e.isEncrypted??!1,this.validKeys=e.validKeys??{},this.engine=t??En(zt),this.noKeyValidation=0===Object.keys(this.validKeys).length,this.noCompoundKey=e.noCompoundKey,this.originalEngine=this.engine,this.errorHandler=e.errorHandler??Pt,this.hasErrorHandler=Boolean(this.errorHandler),this.logger=e.logger??Qe,this.pluginsManager=n}createValidKey(e){const{name:t,id:n,validKeys:r,noKeyValidation:s,noCompoundKey:i}=this;if(s)return i?e:[t,n,e].join(".");let o;return Object.values(r).forEach((r=>{r===e&&(o=i?e:[t,n,e].join("."))})),o}swapQueueStoreToInMemoryEngine(){const{name:e,id:t,validKeys:n,noCompoundKey:r}=this,s=En(qt);Object.keys(n).forEach((i=>{const o=this.get(n[i]),a=r?i:[e,t,i].join(".");s.setItem(a,o),this.remove(i)})),this.engine=s}set(e,t){const n=this.createValidKey(e);if(n)try{this.engine.setItem(n,this.encrypt(ve(t,!1,[],this.logger)))}catch(n){sn(n)?(this.logger?.warn(`${`Store ${this.id}`}${he}The storage is either full or unavailable, so the data will not be persisted. Switching to in-memory storage.`),this.swapQueueStoreToInMemoryEngine(),this.set(e,t)):this.onError(ye(n,(e=>`Failed to save the value for "${e}" to storage`)(e)))}}get(e){const t=this.createValidKey(e);try{if(!t)return null;const e=this.decrypt(this.engine.getItem(t));return T(e)?null:JSON.parse(e)}catch(t){return this.onError(new Error(`${(e=>`Failed to retrieve or parse data for "${e}" from storage`)(e)}: ${t.message}`)),null}}remove(e){const t=this.createValidKey(e);t&&this.engine.removeItem(t)}getOriginalEngine(){return this.originalEngine}decrypt(e){return T(e)?null:this.crypto(e,"decrypt")}encrypt(e){return this.crypto(e,"encrypt")}crypto(e,t){const n=!this.isEncrypted||!e||"string"!=typeof e||""===(e=>e.replace(/^\s+|\s+$/gm,""))(e);if(n)return e;const r=`storage.${t}`,s=this.pluginsManager?this.pluginsManager.invokeSingle(r,e):e;return void 0===s?e:s??""}onError(e){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,`Store ${this.id}`)}}class kn{stores={};isInitialized=!1;hasErrorHandler=!1;constructor(e,t,n){this.errorHandler=t,this.logger=n,this.hasErrorHandler=Boolean(this.errorHandler),this.pluginsManager=e,this.onError=this.onError.bind(this)}init(){if(this.isInitialized)return;const e=kt.loadOptions.value,t={cookieStorageOptions:{samesite:e.sameSiteCookie,secure:e.secureCookie,domain:e.setCookieDomain,sameDomainCookiesOnly:e.sameDomainCookiesOnly,enabled:!0},localStorageOptions:{enabled:!0},inMemoryStorageOptions:{enabled:!0},sessionStorageOptions:{enabled:!0}};In(L(M(t.cookieStorageOptions??{},kt.storage.cookie?.value??{})),L(t.localStorageOptions),L(t.inMemoryStorageOptions),L(t.sessionStorageOptions)),this.initClientDataStores(),this.isInitialized=!0}initClientDataStores(){this.initializeStorageState();[qt,zt,Gt,Vt].forEach((e=>{En(e)?.isEnabled&&this.setStore({id:en[e],name:en[e],isEncrypted:!0,noCompoundKey:!0,type:e})}))}initializeStorageState(){let e=kt.storage.type.value,t=kt.loadOptions.value.storage?.entries;const n=kt.consents.postConsent.value.storage;(A(n?.type)||A(n?.entries))&&(e=n?.type,t=n?.entries);let r=!0,s={};Yt.forEach((n=>{const i=n,o=n,a=t?.[i]?.type,l=((e,t)=>{let n;if(e.consents.preConsent.value.enabled)switch(e.consents.preConsent.value.storage?.strategy){case"none":n=Wt;break;case"session":"sessionInfo"!==t&&(n=Wt);break;case"anonymousId":"anonymousId"!==t&&(n=Wt)}return n})(kt,n),u=l??a??e??Ge,c=this.getResolvedStorageTypeForEntry(u,n);c!==Wt&&(r=!1),s={...s,[n]:{type:c,key:lt[o]}}})),ke((()=>{kt.storage.type.value=e,kt.storage.entries.value=s,kt.storage.trulyAnonymousTracking.value=r}))}getResolvedStorageTypeForEntry(e,t){let n=e;switch(e){case zt:En(zt)?.isEnabled||(n=qt);break;case Vt:En(Vt)?.isEnabled||(n=qt);break;case qt:case Wt:break;default:n=En(Gt)?.isEnabled?Gt:En(zt)?.isEnabled?zt:En(Vt)?.isEnabled?Vt:qt}return n!==e&&this.logger?.warn(((e,t,n,r)=>`${e}${he}The storage type "${n}" is not available for entry "${t}". The SDK will initialize the entry with "${r}" storage type instead.`)(X,t,e,n)),n}setStore(e){const t=En(e.type);return this.stores[e.id]=new Sn(e,t,this.pluginsManager),this.stores[e.id]}getStore(e){return this.stores[e]}onError(e){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,X)}}const wn=e=>e&&e.endsWith("/")?wn(e.substring(0,e.length-1)):e,Tn=e=>{try{const t=new URL(e);return Boolean(t)}catch(e){return!1}},An=e=>{let t="";try{t=new URL(e).host}catch(e){}return t},Pn=e=>{const t={};try{const n=new URL(e),r="utm_";n.searchParams.forEach(((e,n)=>{if(n.startsWith(r)){let s=n.substring(r.length);"campaign"===s&&(s="name"),t[s]=e}}))}catch(e){}return t},Rn=(e,t)=>{(e=>{if(!S(e)||0===e.trim().length)throw new Error((e=>`The write key "${e}" is invalid. It must be a non-empty string. Please check that the write key is correct and try again.`)(e))})(e),(e=>{if(e&&!Tn(e))throw new Error((e=>`The data plane URL "${e}" is invalid. It must be a valid URL string. Please check that the data plane URL is correct and try again.`)(e))})(t)},Cn=["BeaconQueue","Bugsnag","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ErrorReporting","ExternalAnonymousId","GoogleLinker","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],$n=e=>"number"==typeof e&&!Number.isNaN(e),On=e=>$n(e)&&e>=0&&Number.isInteger(e),Dn=(e,t,n,r)=>{const s=new URLSearchParams({p:"cdn",v:te,build:Xe,writeKey:t,lockIntegrationsVersion:n.toString()});let i=tt,o=s,a="/sourceConfig/",l="";if(e)try{const t=new URL(e);wn(t.pathname).endsWith("/sourceConfig")||(t.pathname=`${wn(t.pathname)}/sourceConfig/`),t.pathname=t.pathname.replace(/\/{2,}/g,"/"),s.forEach(((e,n)=>{null===t.searchParams.get(n)&&t.searchParams.set(n,e)})),i=t.origin,a=t.pathname,o=t.searchParams,l=t.hash}catch(t){r?.warn(((e,t)=>`${e}${he}The provided config URL "${t}" is invalid. Using the default value instead.`)(G,e))}return`${i}${a}?${o}${l}`},Mn="US",Bn=(e,t)=>{if(!e||["US","EU"].includes(e))return e;t?.warn(`${G}${he}The residency server region "${e}" is not supported. Please choose one of the following supported regions: "US, EU". The default region "${Mn}" will be used instead.`)},Ln=(e,t,n,r)=>{if(e&&Object.keys(e).length>0){const t=(e=>{if(Array.isArray(e)&&e.length>0){const t=e.find((e=>!0===e.default));if(t&&Tn(t.url))return t.url}})(e[Bn(n,r)??Mn]||e[Mn]);if(t)return t}if(t)return t},Un="none",jn="immediate",Nn={All:!0},Hn=e=>B(e)||Array.isArray(e),xn=(e,t)=>{let{provider:n}=e;const r=st[n];var s;return n&&!r&&(t?.error((s=st,`${G}${he}The consent manager "${n}" is not supported. Please choose one of the following supported consent managers: "${Object.keys(s)}".`)),n=void 0),{provider:n,consentManagerPluginName:r}},_n=(e,t)=>{let n,r,s=[],i=[],o=!1,a=!0===e?.enabled;B(e)&&a&&(({provider:r,consentManagerPluginName:n}=xn(e,t)),Hn(e.allowedConsentIds)&&(s=e.allowedConsentIds,o=!0),Hn(e.deniedConsentIds)&&(i=e.deniedConsentIds,o=!0));const l={allowedConsentIds:s,deniedConsentIds:i};return a=a&&Boolean(n),{provider:r,consentManagerPluginName:n,initialized:o,enabled:a,consentsData:l}},Fn=()=>{const e=document.getElementsByTagName("script");let t;return Array.prototype.slice.call(e).some((e=>{const n=wn(e.getAttribute("src"));if(n){if(n.match(/^.*rsa?(\.min)?\.js$/))return t=n,!0}return!1})),t},Qn=(e,t)=>{var n,r,s;if(kt.reporting.isErrorReportingEnabled.value=!(n=e.source.config,!0!==n?.statsCollection?.errors?.enabled||window.chrome&&window.chrome.runtime&&window.chrome.runtime.id),kt.reporting.isMetricsReportingEnabled.value=(e=>!0===e?.statsCollection?.metrics?.enabled)(e.source.config),kt.reporting.isErrorReportingEnabled.value){const n=(e=>e?.statsCollection?.errors?.provider)(e.source.config),i=n?it[n]:void 0;w(n)||i||t?.warn((r=it,s=nt,`${G}${he}The error reporting provider "${n}" is not supported. Please choose one of the following supported providers: "${Object.keys(r)}". The default provider "${s}" will be used instead.`)),kt.reporting.errorReportingProviderPluginName.value=i??it[nt]}},Kn=e=>{const t=kt.loadOptions.value.storage;let n=t?.type;A(n)&&!(e=>"string"==typeof e&&Ke.includes(e))(n)&&(e?.warn(((e,t,n)=>`${e}${he}The storage type "${t}" is not supported. Please choose one of the following supported types: "${Ke}". The default type "${n}" will be used instead.`)(G,n,Ge)),n=Ge);let r=t?.encryption?.version;const s=r&&ot[r];var i,o;!w(r)&&w(s)?(e?.warn((i=ot,o=rt,`${G}${he}The storage encryption version "${r}" is not supported. Please choose one of the following supported versions: "${Object.keys(i)}". The default version "${o}" will be used instead.`)),r=rt):w(r)&&(r=rt);const a=t?.migrate,l=a&&r===rt;!0===a&&l!==a&&e?.warn(((e,t,n)=>`${e}${he}The storage data migration has been disabled because the configured storage encryption version (${t}) is not the latest (${n}). To enable storage data migration, please update the storage encryption version to the latest version.`)(G,r,rt)),ke((()=>{kt.storage.type.value=n,kt.storage.cookie.value=t?.cookie,kt.storage.encryptionPluginName.value=ot[r],kt.storage.migrate.value=l}))},Gn=e=>{const{provider:t,consentManagerPluginName:n,initialized:r,enabled:s,consentsData:i}=_n(kt.loadOptions.value.consentManagement,e),o=kt.loadOptions.value.preConsent;let a=o?.storage?.strategy??Un;var l,u;A(a)&&!["none","session","anonymousId"].includes(a)&&(a=Un,e?.warn((l=G,u=o?.storage?.strategy,`${l}${he}The pre-consent storage strategy "${u}" is not supported. Please choose one of the following supported strategies: "none, session, anonymousId". The default strategy "${Un}" will be used instead.`)));let c=o?.events?.delivery??jn;A(c)&&!["immediate","buffer"].includes(c)&&(c=jn,e?.warn(((e,t,n)=>`${e}${he}The pre-consent events delivery type "${t}" is not supported. Please choose one of the following supported types: "immediate, buffer". The default type "${n}" will be used instead.`)(G,o?.events?.delivery,jn))),ke((()=>{kt.consents.activeConsentManagerPluginName.value=n,kt.consents.initialized.value=r,kt.consents.enabled.value=s,kt.consents.data.value=i,kt.consents.provider.value=t,kt.consents.preConsent.value={enabled:!0===kt.loadOptions.value.preConsent?.enabled&&!1===r&&!0===s,storage:{strategy:a},events:{delivery:c}}}))};class zn{hasErrorHandler=!1;constructor(e,t,n){this.errorHandler=t,this.logger=n,this.httpClient=e,this.hasErrorHandler=Boolean(this.errorHandler),this.onError=this.onError.bind(this),this.processConfig=this.processConfig.bind(this)}attachEffects(){xe((()=>{this.logger?.setMinLogLevel(kt.lifecycle.logLevel.value)}))}init(){this.attachEffects(),Rn(kt.lifecycle.writeKey.value,kt.lifecycle.dataPlaneUrl.value);const e=kt.loadOptions.value.lockIntegrationsVersion,t=((e,t,n)=>{let r="";if(n){if(r=wn(n),!r||r&&!Tn(r))throw new Error("Failed to load the SDK as the CDN base URL for integrations is not valid.");return r}const s=Fn();return r=s&&S(s)?s.split("/").slice(0,-1).concat(We).join("/"):Ye,t&&(r=r.replace("v3",e)),r})(te,e,kt.loadOptions.value.destSDKBaseURL),n=(e=>{let t="";if(e){if(t=wn(e),!t||t&&!Tn(t))throw new Error("Failed to load the SDK as the CDN base URL for plugins is not valid.");return t}const n=Fn();return t=n&&S(n)?n.split("/").slice(0,-1).concat(Je).join("/"):et,t})(kt.loadOptions.value.pluginsSDKBaseURL);Kn(this.logger),Gn(this.logger),ke((()=>{kt.lifecycle.integrationsCDNPath.value=t,kt.lifecycle.pluginsCDNPath.value=n,kt.loadOptions.value.logLevel&&(kt.lifecycle.logLevel.value=kt.loadOptions.value.logLevel),kt.lifecycle.sourceConfigUrl.value=Dn(kt.loadOptions.value.configUrl,kt.lifecycle.writeKey.value,e,this.logger)})),this.getConfig()}onError(e,t,n){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,G,t,n)}processConfig(e,t){if(!e)return void this.onError((n=t?.error,`Failed to fetch the source config. Reason: ${n}`));var n;let r;try{r=S(e)?JSON.parse(e):e}catch(e){return void this.onError(e,ze,!0)}if(!(e=>O(e)&&O(e.source)&&!T(e.source.id)&&O(e.source.config)&&Array.isArray(e.source.destinations))(r))return void this.onError(new Error(ze),void 0,!0);Qn(r,this.logger);const s=Ln(r.source.dataplanes,kt.lifecycle.dataPlaneUrl.value,kt.loadOptions.value.residencyServer,this.logger);if(!s)return void this.onError(new Error("Failed to load the SDK as the data plane URL could not be determined. Please check that the data plane URL is set correctly and try again."),void 0,!0);const i=r.source.destinations.length>0?(e=>{const t=[];return e.forEach((e=>{e.enabled&&!e.deleted&&t.push({id:e.id,displayName:e.destinationDefinition.displayName,config:e.config,shouldApplyDeviceModeTransformation:e.shouldApplyDeviceModeTransformation||!1,propagateEventsUntransformedOnError:e.propagateEventsUntransformedOnError||!1,userFriendlyId:`${e.destinationDefinition.displayName.replaceAll(" ","-")}___${e.id}`})})),t})(r.source.destinations):[];ke((()=>{kt.source.value={config:r.source.config,id:r.source.id},kt.nativeDestinations.configuredDestinations.value=i,kt.plugins.pluginsToLoadFromConfig.value=kt.loadOptions.value.plugins??[],(e=>{let t,n=kt.consents.resolutionStrategy.value;O(e.consentManagementMetadata)&&(kt.consents.provider.value&&(n=e.consentManagementMetadata.providers.find((e=>e.provider===kt.consents.provider.value))?.resolutionStrategy??kt.consents.resolutionStrategy.value),t=e.consentManagementMetadata),"custom"===kt.consents.provider.value&&(n=void 0),ke((()=>{kt.consents.metadata.value=h(t),kt.consents.resolutionStrategy.value=n}))})(r),kt.lifecycle.activeDataplaneUrl.value=wn(s),kt.lifecycle.status.value="configured"}))}getConfig(){const e=kt.loadOptions.value.getSourceConfig;if(e){if(!I(e))throw new Error('"getSourceConfig" must be a function. Please make sure that it is defined and returns a valid source configuration object.');const t=e();t instanceof Promise?t.then((e=>this.processConfig(e))).catch((e=>{this.onError(e,"SourceConfig")})):this.processConfig(t)}else this.httpClient.getAsyncData({url:kt.lifecycle.sourceConfigUrl.value,options:{headers:{"Content-Type":void 0}},callback:this.processConfig})}}const Vn=()=>document?.referrer||"$direct",qn=()=>{const e=(()=>{const e=document.getElementsByTagName("link");let t="";for(let n=0;e[n];n+=1){const r=e[n];if("canonical"===r.getAttribute("rel")&&!t){t=r.getAttribute("href")??"";break}}return t})();let t=globalThis.location.pathname;const{href:n}=globalThis.location;let r=n;const{search:s}=globalThis.location;if(e)try{const n=new URL(e);r=""===n.search?e+s:e,t=n.pathname}catch(e){}const i=(e=>{let t=e;try{const n=new URL(e);t=n.origin+n.pathname+n.search}catch(e){}return t})(r),{title:o}=document,a=Vn();return{path:t,referrer:a,referring_domain:An(a),search:s,title:o,url:i,tab_url:n}},Wn=`https://polyfill.io/v3/polyfill.min.js?version=3.111.0&features=${Object.keys(nn).join("%2C")}`,Jn="rudderstackPolyfill";class Xn{constructor(e,t){this.logger=t,this.errorHandler=e,this.externalSrcLoader=new be(this.errorHandler,this.logger),this.onError=this.onError.bind(this),this.onReady=this.onReady.bind(this)}init(){try{this.prepareBrowserCapabilities(),this.attachWindowListeners()}catch(e){this.onError(e)}}detectBrowserCapabilities(){ke((()=>{kt.capabilities.storage.isCookieStorageAvailable.value=on(Gt,En(Gt),this.logger),kt.capabilities.storage.isLocalStorageAvailable.value=on(zt,void 0,this.logger),kt.capabilities.storage.isSessionStorageAvailable.value=on(Vt,void 0,this.logger),kt.capabilities.isBeaconAvailable.value=!T(globalThis.navigator.sendBeacon)&&I(globalThis.navigator.sendBeacon),kt.capabilities.isUaCHAvailable.value=tn(),kt.capabilities.isCryptoAvailable.value=!T(globalThis.crypto)&&I(globalThis.crypto.getRandomValues),kt.capabilities.isIE11.value=Boolean(globalThis.navigator.userAgent.match(/Trident.*rv:11\./)),kt.capabilities.isOnline.value=globalThis.navigator.onLine,kt.context.userAgent.value=(()=>{if(w(globalThis.navigator))return null;let{userAgent:e}=globalThis.navigator;const{brave:t}=globalThis.navigator;if(t&&Object.getPrototypeOf(t).isBrave){const t=e.match(/(chrome)\/([\w.]+)/i);t&&(e=`${e} Brave/${t[2]}`)}return e})(),kt.context.locale.value=w(globalThis.navigator)?null:globalThis.navigator.language??globalThis.navigator.browserLanguage,kt.context.screen.value=rn(),kt.context.timezone.value=(()=>{const e=(new Date).toString().match(/([A-Z]+[+-]\d+)/);return e&&e[1]?e[1]:"NA"})(),tn()&&((e,t="none")=>{"none"===t&&e(void 0),"default"===t&&e(navigator.userAgentData),"full"===t&&navigator.userAgentData?.getHighEntropyValues(["architecture","bitness","brands","mobile","model","platform","platformVersion","uaFullVersion","fullVersionList","wow64"]).then((t=>{e(t)})).catch((()=>{e()}))})((e=>{kt.context["ua-ch"].value=e}),kt.loadOptions.value.uaChTrackLevel)})),xe((()=>{!0===kt.loadOptions.value.sendAdblockPage&&void 0!==kt.lifecycle.sourceConfigUrl.value&&((e,t)=>{const n=new URL(kt.lifecycle.sourceConfigUrl.value),r=`${n.origin}${n.pathname}?view=ad`,s=new Qt(e,t);s.setAuthHeader(kt.lifecycle.writeKey.value),s.getAsyncData({url:r,options:{method:"HEAD",headers:{"Content-Type":void 0}},isRawResponse:!0,callback:(e,t)=>{kt.capabilities.isAdBlocked.value=void 0!==t?.error||t?.xhr?.responseURL!==r}})})(this.errorHandler,this.logger)}))}prepareBrowserCapabilities(){kt.capabilities.isLegacyDOM.value=(()=>{const e=Object.keys(nn);let t=!1;for(let n=0;n<e.length;n++){const r=nn[e[n]];if(I(r)&&r()){t=!0;break}}return t})();let e=kt.loadOptions.value.polyfillURL??Wn;if(kt.loadOptions.value.polyfillIfRequired&&kt.capabilities.isLegacyDOM.value&&Boolean(e)){const t=e!==kt.loadOptions.value.polyfillURL;if(t){const t=`RS_polyfillCallback_${kt.lifecycle.writeKey.value}`,n=()=>{this.onReady(),delete globalThis[t]};globalThis[t]=n,e=`${e}&callback=${t}`}this.externalSrcLoader?.loadJSFile({url:e,id:Jn,async:!0,timeout:1e4,callback:n=>{n?t||this.onReady():this.onError(new Error(((e,t)=>`Failed to load the polyfill script with ID "${e}" from URL ${t}.`)(Jn,e)))}})}else this.onReady()}attachWindowListeners(){globalThis.addEventListener("offline",(()=>{kt.capabilities.isOnline.value=!1})),globalThis.addEventListener("online",(()=>{kt.capabilities.isOnline.value=!0})),globalThis.addEventListener("resize",function(e,t,n=250){let r;return(...s)=>{globalThis.clearTimeout(r),r=globalThis.setTimeout((()=>{e.apply(t,s)}),n)}}((()=>{kt.context.screen.value=rn()}),this))}onReady(){this.detectBrowserCapabilities(),kt.lifecycle.status.value="browserCapabilitiesReady"}onError(e){if(!this.errorHandler)throw e;this.errorHandler.onError(e,K)}}for(var Zn,Yn=[],er=0;er<256;er++)Yn[er]=(er+256).toString(16).substring(1);function tr(){var e;(!Zn||er+16>4096)&&(e=4096,Zn=crypto.getRandomValues(new Uint8Array(e)),er=0);for(var t,n=0,r="";n<16;n++)t=Zn[er+n],r+=6==n?Yn[15&t|64]:8==n?Yn[63&t|128]:Yn[t],1&n&&n>1&&n<11&&(r+="-");return er+=16,r}for(var nr,rr=256,sr=[];rr--;)sr[rr]=(rr+256).toString(16).substring(1);const ir=()=>!T(globalThis.crypto)&&I(globalThis.crypto.getRandomValues)?tr():function(){var e,t=0,n="";if(!nr||rr+16>256){for(nr=Array(t=256);t--;)nr[t]=256*Math.random()|0;t=rr=0}for(;t<16;t++)e=nr[rr+t],n+=6==t?sr[15&e|64]:8==t?sr[63&e|128]:sr[e],1&t&&t>1&&t<11&&(n+="-");return rr++,n}(),or=["integrations","anonymousId","originalTimestamp"],ar=["library","consentManagement","userAgent","ua-ch","screen"],lr=["anonymousId","sentAt","receivedAt","timestamp","originalTimestamp","event","messageId","channel"],ur=e=>{const t=Date.now();return Boolean(!e||t>e)},cr=(e,t)=>{return!!(e&&On(e)&&(n=10,r=e,r.toString().length>=n))||(t?.warn(((e,t,n)=>`${e}${he}The provided session ID (${t}) is either invalid, not a positive integer, or not at least "${n}" digits long. A new session ID will be auto-generated instead.`)(q,e,10)),!1);var n,r},dr=(e,t)=>({id:cr(e,t)?e:Date.now(),sessionStart:void 0,manualTrack:!0}),gr=e=>Boolean(e===Gt||e===zt||e===Vt||e===qt),hr=()=>ir(),pr=e=>{const t=qn(),n={};return Object.keys(t).forEach((r=>{n[r]=e?.[r]||t[r]})),n.initial_referrer=e?.initial_referrer||kt.session.initialReferrer.value,n.initial_referring_domain=e?.initial_referring_domain||kt.session.initialReferringDomain.value,n},fr=(e,t,n)=>{O(e)&&Object.keys(e).forEach((e=>{(lr.includes(e)||lr.includes(e.toLowerCase()))&&n?.warn(((e,t,n,r)=>`${e}${he}The "${t}" property defined under "${n}" is a reserved keyword. Please choose a different property name to avoid conflicts with reserved keywords (${r}).`)(z,e,t,lr))}))},vr=(e,t,n)=>{let r=e;return Object.keys(t).forEach((e=>{if(!or.includes(e)&&!ar.includes(e))if("context"!==e)r=M(r,{[e]:t[e]});else if(!w(t[e])&&O(t[e])){const n={};Object.keys(t[e]).forEach((r=>{ar.includes(r)||(n[r]=t[e][r])})),r=M(r,{...n})}else n?.warn(`${z}${he}Please make sure that the "context" property in the event API's "options" argument is a valid object literal with key-value pairs.`)})),r},yr=(e,t)=>{O(t)&&(((e,t)=>{t.anonymousId&&S(t.anonymousId)&&(e.anonymousId=t.anonymousId),O(t.integrations)&&(e.integrations=t.integrations),t.originalTimestamp&&S(t.originalTimestamp)&&(e.originalTimestamp=t.originalTimestamp)})(e,t),e.context=vr(e.context,t))},mr=e=>{let t;return t=kt.loadOptions.value.useGlobalIntegrationsConfigInEvents&&(O(kt.consents.postConsent.value?.integrations)||O(kt.nativeDestinations.loadOnlyIntegrations.value))?h(kt.consents.postConsent.value?.integrations??kt.nativeDestinations.loadOnlyIntegrations.value):O(e)?e:Nn,t},br=(e,t,n,r)=>{const s={channel:"web",context:{traits:h(kt.session.userTraits.value),sessionId:kt.session.sessionInfo.value.id||void 0,sessionStart:kt.session.sessionInfo.value.sessionStart||void 0,...kt.consents.enabled.value&&{consentManagement:{deniedConsentIds:h(kt.consents.data.value.deniedConsentIds),allowedConsentIds:h(kt.consents.data.value.allowedConsentIds),provider:kt.consents.provider.value,resolutionStrategy:kt.consents.resolutionStrategy.value}},"ua-ch":kt.context["ua-ch"].value,app:kt.context.app.value,library:kt.context.library.value,userAgent:kt.context.userAgent.value,os:kt.context.os.value,locale:kt.context.locale.value,screen:kt.context.screen.value,campaign:Pn(globalThis.location.href),page:pr(n),timezone:kt.context.timezone.value},originalTimestamp:(new Date).toISOString(),integrations:Nn,messageId:ir(),userId:e.userId||kt.session.userId.value};gr(kt.storage.entries.value.anonymousId?.type)?s.anonymousId=kt.session.anonymousId.value:s.anonymousId=hr(),kt.storage.trulyAnonymousTracking.value&&(s.context.trulyAnonymousTracking=!0),"identify"===e.type&&(s.context.traits=kt.storage.entries.value.userTraits?.type!==Wt?h(kt.session.userTraits.value):e.context.traits),"group"===e.type&&((e.groupId||kt.session.groupId.value)&&(s.groupId=e.groupId||kt.session.groupId.value),(e.traits||kt.session.groupTraits.value)&&(s.traits=kt.storage.entries.value.groupTraits?.type!==Wt?h(kt.session.groupTraits.value):e.traits));const i=M(e,s);return void 0===i.event&&(i.event=null),void 0===i.properties&&(i.properties=null),yr(i,t),((e,t)=>{const{properties:n,traits:r,context:s}=e,{traits:i}=s;fr(n,"properties",t),fr(r,"traits",t),fr(i,"context.traits",t)})(i,r),i.integrations=mr(i.integrations),i};class Er{constructor(e){this.logger=e}generatePageEvent(e,t,n,r){let s=n??{};s.name=t,s.category=e,s=((e,t)=>{const n=t?.page||{},r=e,s=qn();return Object.keys(s).forEach((e=>{w(r[e])&&(r[e]=n[e]||s[e])})),w(r.initial_referrer)&&(r.initial_referrer=n.initial_referrer||kt.session.initialReferrer.value),w(r.initial_referring_domain)&&(r.initial_referring_domain=n.initial_referring_domain||kt.session.initialReferringDomain.value),r})(s,r);return br({properties:s,name:t,category:e,type:"page"},r,s,this.logger)}generateTrackEvent(e,t,n){return br({properties:t,event:e,type:"track"},n,void 0,this.logger)}generateIdentifyEvent(e,t,n){return br({userId:e,type:"identify",context:{traits:t}},n,void 0,this.logger)}generateAliasEvent(e,t,n){const r=br({previousId:t,type:"alias"},n,void 0,this.logger);return r.userId=e??r.userId,r}generateGroupEvent(e,t,n){const r={type:"group"};return e&&(r.groupId=e),t&&(r.traits=t),br(r,n,void 0,this.logger)}create(e){let t;switch(e.type){case"page":t=this.generatePageEvent(e.category,e.name,e.properties,e.options);break;case"track":t=this.generateTrackEvent(e.name,e.properties,e.options);break;case"identify":t=this.generateIdentifyEvent(e.userId,e.traits,e.options);break;case"alias":t=this.generateAliasEvent(e.to,e.from,e.options);break;case"group":t=this.generateGroupEvent(e.groupId,e.traits,e.options)}return t}}class Ir{constructor(e,t,n,r){this.eventRepository=e,this.userSessionManager=t,this.errorHandler=n,this.logger=r,this.eventFactory=new Er(this.logger),this.onError=this.onError.bind(this)}init(){this.eventRepository.init()}resume(){this.eventRepository.resume()}addEvent(e){this.userSessionManager.refreshSession();const t=this.eventFactory.create(e);t?this.eventRepository.enqueue(t,e.callback):this.onError(new Error("Failed to generate the event object."))}onError(e,t,n){if(!this.errorHandler)throw e;this.errorHandler.onError(e,z,t,n)}}class Sr{constructor(e,t,n,r){this.storeManager=r,this.pluginsManager=n,this.logger=t,this.errorHandler=e,this.onError=this.onError.bind(this)}init(){this.syncStorageDataToState(),this.registerEffects()}syncStorageDataToState(){this.migrateStorageIfNeeded(),this.migrateDataFromPreviousStorage(),this.setUserId(this.getUserId()),this.setUserTraits(this.getUserTraits()),this.setGroupId(this.getGroupId()),this.setGroupTraits(this.getGroupTraits()),this.setAnonymousId(this.getAnonymousId(kt.loadOptions.value.anonymousIdOptions)),this.setAuthToken(this.getAuthToken()),this.setInitialReferrerInfo(),this.configureSessionTracking()}configureSessionTracking(){let e=this.getSessionInfo();if(this.isPersistenceEnabledForStorageEntry("sessionInfo")){const t=this.getConfiguredSessionTrackingInfo(),n=this.getSessionInfo()??ct;e={...n,...t,autoTrack:t.autoTrack&&!0!==n.manualTrack}}this.setSessionInfo(e)}setInitialReferrerInfo(){const e=this.getInitialReferrer(),t=this.getInitialReferringDomain();if(e&&t)this.setInitialReferrer(e),this.setInitialReferringDomain(t);else{const t=e||Vn();this.setInitialReferrer(t),this.setInitialReferringDomain(An(t))}}isPersistenceEnabledForStorageEntry(e){return gr(kt.storage.entries.value[e]?.type)}migrateDataFromPreviousStorage(){const e=kt.storage.entries.value,t=[Gt,zt,Vt];Object.keys(e).forEach((n=>{const r=n,s=e[r]?.type,i=this.storeManager?.getStore(en[s]);i&&t.forEach((e=>{const t=this.storeManager?.getStore(en[e]);if(t&&e!==s){const e=t.get(lt[r]);(e=>P(e)&&""!==e)(e)&&i.set(lt[r],e),t.remove(lt[r])}}))}))}migrateStorageIfNeeded(){if(!kt.storage.migrate.value)return;const e=[];[Jt,Xt,Zt].forEach((t=>{const n=this.storeManager?.getStore(t);n&&e.push(n)})),Object.keys(lt).forEach((t=>{const n=lt[t];e.forEach((e=>{const t=this.pluginsManager?.invokeSingle("storage.migrate",n,e.engine,this.errorHandler,this.logger);T(t)||e.set(n,t)}))}))}getConfiguredSessionTrackingInfo(){let e,t=!1!==kt.loadOptions.value.sessions?.autoTrack;if(!t)return{autoTrack:t};const n=kt.loadOptions.value.sessions?.timeout;return On(n)?e=n:(this.logger?.warn(((e,t,n)=>`${e}${he}The session timeout value "${t}" is not a number. The default timeout of ${n} ms will be used instead.`)(q,n,ae)),e=ae),0===e&&(this.logger?.warn(`${q}${he}The session timeout value is 0, which disables the automatic session tracking feature. If you want to enable session tracking, please provide a positive integer value for the timeout.`),t=!1),e>0&&e<1e4&&this.logger?.warn(((e,t,n)=>`${e}${he}The session timeout value ${t} ms is less than the recommended minimum of ${n} ms. Please consider increasing the timeout value to ensure optimal performance and reliability.`)(q,e,1e4)),{timeout:e,autoTrack:t}}onError(e){if(!this.errorHandler)throw e;this.errorHandler.onError(e,q)}syncValueToStorage(e,t){const n=kt.storage.entries.value,r=n[e]?.type,s=n[e]?.key;if(gr(r)){const e=this.storeManager?.getStore(en[r]);t&&S(t)||B(t)?e?.set(s,t):e?.remove(s)}}registerEffects(){Yt.forEach((e=>{xe((()=>{this.syncValueToStorage(e,kt.session[e].value)}))}))}setAnonymousId(e,t){let n=e;if(this.isPersistenceEnabledForStorageEntry("anonymousId")){if(!n&&t){const e=this.pluginsManager?.invokeSingle("userSession.anonymousIdGoogleLinker",t);n=e}n=n||hr()}else n=ut.anonymousId;kt.session.anonymousId.value=n}getAnonymousId(e){const t=kt.storage.entries.value.anonymousId?.type;if(gr(t)){let t=this.getEntryValue("anonymousId");if(!t&&e){const n=this.pluginsManager?.invokeSingle("storage.getAnonymousId",En,e);t=n}kt.session.anonymousId.value=t||hr()}return kt.session.anonymousId.value}getEntryValue(e){const t=kt.storage.entries.value,n=t[e]?.type;if(gr(n)){const r=this.storeManager?.getStore(en[n]),s=t[e]?.key;return r?.get(s)??null}return null}getUserId(){return this.getEntryValue("userId")}getUserTraits(){return this.getEntryValue("userTraits")}getGroupId(){return this.getEntryValue("groupId")}getGroupTraits(){return this.getEntryValue("groupTraits")}getInitialReferrer(){return this.getEntryValue("initialReferrer")}getInitialReferringDomain(){return this.getEntryValue("initialReferringDomain")}getSessionInfo(){return this.getEntryValue("sessionInfo")}getAuthToken(){return this.getEntryValue("authToken")}getSessionId(){const e=kt.session.sessionInfo.value;return e.autoTrack&&!ur(e.expiresAt)||e.manualTrack?e.id??null:null}refreshSession(){let e=kt.session.sessionInfo.value;(e.autoTrack||e.manualTrack)&&(e.autoTrack&&this.startOrRenewAutoTracking(),e=kt.session.sessionInfo.value,void 0===e.sessionStart?kt.session.sessionInfo.value={...e,sessionStart:!0}:e.sessionStart&&(kt.session.sessionInfo.value={...e,sessionStart:!1}))}reset(e,t){const{session:n}=kt,{manualTrack:r,autoTrack:s}=n.sessionInfo.value;ke((()=>{n.userId.value=ut.userId,n.userTraits.value=ut.userTraits,n.groupId.value=ut.groupId,n.groupTraits.value=ut.groupTraits,n.authToken.value=ut.authToken,e&&this.setAnonymousId(),t||(s?(n.sessionInfo.value=ut.sessionInfo,this.startOrRenewAutoTracking()):r&&this.startManualTrackingInternal())}))}setSessionInfo(e){kt.session.sessionInfo.value=this.isPersistenceEnabledForStorageEntry("sessionInfo")?e:ut.sessionInfo,kt.session.sessionInfo.value.autoTrack&&this.startOrRenewAutoTracking()}setUserId(e){kt.session.userId.value=this.isPersistenceEnabledForStorageEntry("userId")&&e?e:ut.userId}setUserTraits(e){kt.session.userTraits.value=this.isPersistenceEnabledForStorageEntry("userTraits")&&e?M(kt.session.userTraits.value??{},e):ut.userTraits}setGroupId(e){kt.session.groupId.value=this.isPersistenceEnabledForStorageEntry("groupId")&&e?e:ut.groupId}setGroupTraits(e){kt.session.groupTraits.value=this.isPersistenceEnabledForStorageEntry("groupTraits")&&e?M(kt.session.groupTraits.value??{},e):ut.groupTraits}setInitialReferrer(e){kt.session.initialReferrer.value=this.isPersistenceEnabledForStorageEntry("initialReferrer")&&e?e:ut.initialReferrer}setInitialReferringDomain(e){kt.session.initialReferringDomain.value=this.isPersistenceEnabledForStorageEntry("initialReferringDomain")&&e?e:ut.initialReferringDomain}startOrRenewAutoTracking(){const e=kt.session.sessionInfo.value;if(ur(e.expiresAt))kt.session.sessionInfo.value=(e=>{const t=Date.now(),n=e||ae;return{id:t,expiresAt:t+n,timeout:n,sessionStart:void 0,autoTrack:!0}})(e.timeout);else{const t=Date.now(),n=e.timeout;kt.session.sessionInfo.value=M(e,{expiresAt:t+n})}}start(e){kt.session.sessionInfo.value=dr(e,this.logger)}startManualTrackingInternal(){this.start(Date.now())}end(){kt.session.sessionInfo.value={}}setAuthToken(e){kt.session.authToken.value=this.isPersistenceEnabledForStorageEntry("authToken")&&e?e:ut.authToken}}class kr{constructor(){this.items=[]}enqueue(e){this.items.push(e)}dequeue(){return 0===this.items.length?null:this.items.shift()}isEmpty(){return 0===this.items.length}size(){return this.items.length}clear(){this.items=[]}}const wr="dataplaneEventsQueue",Tr="destinationsEventsQueue",Ar=(e,t)=>{const n=h(e),r=e.integrations??Nn,s=t.nativeDestinations.integrationsConfig.value,i=((e,t)=>Object.keys(e).filter((n=>!0!==e[n]||!t[n])).reduce(((t,n)=>{const r=h(t);return r[n]=e[n],r}),{}))(r,s);return n.integrations=M(s,i),n};class Pr{constructor(e,t,n,r){this.pluginsManager=e,this.errorHandler=n,this.logger=r,this.httpClient=new Qt(n,r),this.storeManager=t,this.onError=this.onError.bind(this)}init(){try{this.dataplaneEventsQueue=this.pluginsManager.invokeSingle(`${wr}.init`,kt,this.httpClient,this.storeManager,this.errorHandler,this.logger)}catch(e){this.onError(e,"XhrQueuePlugin initialization failed")}try{this.dmtEventsQueue=this.pluginsManager.invokeSingle("transformEvent.init",kt,this.pluginsManager,this.httpClient,this.storeManager,this.errorHandler,this.logger)}catch(e){this.onError(e,"DeviceModeTransformationPlugin initialization failed")}try{this.destinationsEventsQueue=this.pluginsManager.invokeSingle(`${Tr}.init`,kt,this.pluginsManager,this.storeManager,this.dmtEventsQueue,this.errorHandler,this.logger)}catch(e){this.onError(e,"NativeDestinationQueuePlugin initialization failed")}xe((()=>{!0===kt.nativeDestinations.clientDestinationsReady.value&&(this.destinationsEventsQueue?.start(),this.dmtEventsQueue?.start())}));const e=(e=>e.consents.preConsent.value.enabled&&"buffer"===e.consents.preConsent.value.events?.delivery&&("session"===e.consents.preConsent.value.storage?.strategy||"none"===e.consents.preConsent.value.storage?.strategy))(kt);let t;xe((()=>{const n=!0===kt.loadOptions.value.bufferDataPlaneEventsUntilReady&&!1===kt.nativeDestinations.clientDestinationsReady.value;!1!==kt.nativeDestinations.activeDestinations.value.some((e=>{return t=e,Boolean("hybrid"===t.config.connectionMode||!0===t.config.useNativeSDKToSend);var t}))&&!1!==n||e||!0===this.dataplaneEventsQueue?.scheduleTimeoutActive||(globalThis.clearTimeout(t),this.dataplaneEventsQueue?.start())})),!0===kt.loadOptions.value.bufferDataPlaneEventsUntilReady&&(t=globalThis.setTimeout((()=>{!0!==this.dataplaneEventsQueue?.scheduleTimeoutActive&&this.dataplaneEventsQueue?.start()}),kt.loadOptions.value.dataPlaneEventsBufferTimeout))}resume(){!0!==this.dataplaneEventsQueue?.scheduleTimeoutActive&&(kt.consents.postConsent.value.discardPreConsentEvents&&(this.dataplaneEventsQueue?.clear(),this.destinationsEventsQueue?.clear()),this.dataplaneEventsQueue?.start())}enqueue(e,t){let n;try{n=Ar(e,kt),this.pluginsManager.invokeSingle(`${wr}.enqueue`,kt,this.dataplaneEventsQueue,n,this.errorHandler,this.logger)}catch(e){this.onError(e,"XhrQueuePlugin event enqueue failed")}try{const t=h(e);this.pluginsManager.invokeSingle(`${Tr}.enqueue`,kt,this.destinationsEventsQueue,t,this.errorHandler,this.logger)}catch(e){this.onError(e,"NativeDestinationQueuePlugin event enqueue failed")}try{t?.(n)}catch(e){this.onError(e,"API Callback Invocation Failed")}}onError(e,t,n){if(!this.errorHandler)throw e;this.errorHandler.onError(e,"EventRepository",t,n)}}const Rr=e=>{const t=new CustomEvent(e,{detail:{analyticsInstance:globalThis.rudderanalytics},bubbles:!0,cancelable:!0,composed:!0});globalThis.document.dispatchEvent(t)};class Cr{constructor(){this.preloadBuffer=new kr,this.initialized=!1,this.errorHandler=Pt,this.logger=Qe,this.externalSrcLoader=new be(this.errorHandler,this.logger),this.capabilitiesManager=new Xn(this.errorHandler,this.logger),this.httpClient=Kt}load(e,t,n={}){if(kt.lifecycle.status.value)return;let r=h(t),s=h(n);$(t)&&(s=t,r=void 0),ke((()=>{kt.lifecycle.writeKey.value=e,kt.lifecycle.dataPlaneUrl.value=r,kt.loadOptions.value=((e,t)=>{const n=h(t);return S(n.setCookieDomain)||delete n.setCookieDomain,["Strict","Lax","None"].includes(n.sameSiteCookie)||delete n.sameSiteCookie,n.secureCookie=!0===n.secureCookie,["none","default","full"].includes(n.uaChTrackLevel)||delete n.uaChTrackLevel,O(n.integrations)||delete n.integrations,n.plugins=n.plugins??Cn,n.useGlobalIntegrationsConfigInEvents=!0===n.useGlobalIntegrationsConfigInEvents,n.bufferDataPlaneEventsUntilReady=!0===n.bufferDataPlaneEventsUntilReady,n.sendAdblockPage=!0===n.sendAdblockPage,O(n.sendAdblockPageOptions)||delete n.sendAdblockPageOptions,A(n.loadIntegration)?n.loadIntegration=!0===n.loadIntegration:delete n.loadIntegration,O(n.storage)?(n.storage=U(n.storage),n.storage.migrate=!0===n.storage?.migrate):delete n.storage,O(n.beaconQueueOptions)?n.beaconQueueOptions=U(n.beaconQueueOptions):delete n.beaconQueueOptions,O(n.destinationsQueueOptions)?n.destinationsQueueOptions=U(n.destinationsQueueOptions):delete n.destinationsQueueOptions,O(n.queueOptions)?n.queueOptions=U(n.queueOptions):delete n.queueOptions,n.lockIntegrationsVersion=!0===n.lockIntegrationsVersion,$n(n.dataPlaneEventsBufferTimeout)||delete n.dataPlaneEventsBufferTimeout,O(n.storage?.cookie)?n.storage.cookie=U(n.storage?.cookie):delete n.storage?.cookie,O(n.preConsent)?n.preConsent=U(n.preConsent):delete n.preConsent,M(e,n)})(kt.loadOptions.value,s),kt.lifecycle.status.value="mounted"})),kt.loadOptions.value.logLevel&&this.logger?.setMinLogLevel(kt.loadOptions.value.logLevel),ue("state",kt,e),this.startLifecycle()}startLifecycle(){xe((()=>{try{switch(kt.lifecycle.status.value){case"mounted":this.onMounted();break;case"browserCapabilitiesReady":this.onBrowserCapabilitiesReady();break;case"configured":this.onConfigured();break;case"pluginsLoading":case"destinationsLoading":case"readyExecuted":default:break;case"pluginsReady":this.onPluginsReady();break;case"initialized":this.onInitialized();break;case"loaded":this.onLoaded();break;case"destinationsReady":this.onDestinationsReady();break;case"ready":this.onReady()}}catch(e){const t="Failed to load the SDK";this.errorHandler.onError(ye(e,t),Y)}}))}onBrowserCapabilitiesReady(){de(this),this.prepareInternalServices(),this.loadConfig()}onLoaded(){this.processBufferedEvents(),!0===kt.consents.preConsent.value.enabled?kt.lifecycle.status.value="ready":this.loadDestinations()}onMounted(){this.capabilitiesManager.init()}enqueuePreloadBufferEvents(e){Array.isArray(e)&&e.forEach((e=>this.preloadBuffer.enqueue(h(e))))}processDataInPreloadBuffer(){for(;this.preloadBuffer.size()>0;){const e=this.preloadBuffer.dequeue();e&&ge([...e],this)}}prepareInternalServices(){this.pluginsManager=new Nt(wt,this.errorHandler,this.logger),this.storeManager=new kn(this.pluginsManager,this.errorHandler,this.logger),this.configManager=new zn(this.httpClient,this.errorHandler,this.logger),this.userSessionManager=new Sr(this.errorHandler,this.logger,this.pluginsManager,this.storeManager),this.eventRepository=new Pr(this.pluginsManager,this.storeManager,this.errorHandler,this.logger),this.eventManager=new Ir(this.eventRepository,this.userSessionManager,this.errorHandler,this.logger)}loadConfig(){kt.lifecycle.writeKey.value&&this.httpClient.setAuthHeader(kt.lifecycle.writeKey.value),this.configManager?.init()}onPluginsReady(){this.errorHandler.init(this.externalSrcLoader),this.storeManager?.init(),this.userSessionManager?.init(),kt.consents.enabled.value&&!kt.consents.initialized.value&&(this.pluginsManager?.invokeSingle("consentManager.init",kt,this.logger),!1===kt.consents.preConsent.value.enabled&&this.pluginsManager?.invokeSingle("consentManager.updateConsentsInfo",kt,this.storeManager,this.logger)),this.eventManager?.init(),kt.lifecycle.status.value="initialized"}onConfigured(){this.pluginsManager?.init()}onInitialized(){this.processDataInPreloadBuffer(),I(kt.loadOptions.value.onLoaded)&&kt.loadOptions.value.onLoaded(globalThis.rudderanalytics),ke((()=>{kt.lifecycle.loaded.value=!0,kt.lifecycle.status.value="loaded"})),this.initialized=!0,Rr("RSA_Initialised")}onReady(){kt.lifecycle.status.value="readyExecuted",kt.eventBuffer.readyCallbacksArray.value.forEach((e=>{try{e()}catch(e){this.errorHandler.onError(e,Y,qe)}})),Rr("RSA_Ready")}processBufferedEvents(){let e=kt.eventBuffer.toBeProcessedArray.value;for(;e.length>0;){const t=e.shift();if(kt.eventBuffer.toBeProcessedArray.value=e,t){const e=t[0];I(this[e])&&this[e](...t.slice(1),!0)}e=kt.eventBuffer.toBeProcessedArray.value}}loadDestinations(){if(kt.nativeDestinations.clientDestinationsReady.value)return;this.pluginsManager?.invokeSingle("nativeDestinations.setActiveDestinations",kt,this.pluginsManager,this.errorHandler,this.logger);const e=kt.nativeDestinations.activeDestinations.value.length;0!==e?(kt.lifecycle.status.value="destinationsLoading",this.pluginsManager?.invokeSingle("nativeDestinations.load",kt,this.externalSrcLoader,this.errorHandler,this.logger),xe((()=>{(0===e||kt.nativeDestinations.initializedDestinations.value.length+kt.nativeDestinations.failedDestinations.value.length===e)&&ke((()=>{kt.lifecycle.status.value="destinationsReady",kt.nativeDestinations.clientDestinationsReady.value=!0}))}))):kt.lifecycle.status.value="destinationsReady"}onDestinationsReady(){"ready"!==kt.lifecycle.status.value&&(kt.lifecycle.status.value="ready")}ready(e,t=!1){const n="ready";if(kt.lifecycle.loaded.value)if(this.errorHandler.leaveBreadcrumb(`New ${n} invocation`),I(e))if("readyExecuted"===kt.lifecycle.status.value)try{e()}catch(e){this.errorHandler.onError(e,Y,qe)}else kt.eventBuffer.readyCallbacksArray.value=[...kt.eventBuffer.readyCallbacksArray.value,e];else this.logger.error(`${"readyApi"}${he}The callback is not a function.`);else kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[n,e]]}page(e,t=!1){const n="page";kt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} event`),kt.metrics.triggered.value+=1,this.eventManager?.addEvent({type:"page",category:e.category,name:e.name,properties:e.properties,options:e.options,callback:e.callback}),!0===kt.capabilities.isAdBlocked.value&&e.category!==ne&&this.page(H(ne,"ad-block page request",{path:"/ad-blocked"},kt.loadOptions.value.sendAdblockPageOptions))):kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[n,e]]}track(e,t=!1){const n="track";kt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} event`),kt.metrics.triggered.value+=1,this.eventManager?.addEvent({type:n,name:e.name||void 0,properties:e.properties,options:e.options,callback:e.callback})):kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[n,e]]}identify(e,t=!1){const n="identify";if(!kt.lifecycle.loaded.value)return void(kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[n,e]]);this.errorHandler.leaveBreadcrumb(`New ${n} event`),kt.metrics.triggered.value+=1;Boolean(e.userId&&kt.session.userId.value&&e.userId!==kt.session.userId.value)&&this.reset(),k(e.userId)||this.userSessionManager?.setUserId(e.userId),this.userSessionManager?.setUserTraits(e.traits),this.eventManager?.addEvent({type:n,userId:e.userId,traits:e.traits,options:e.options,callback:e.callback})}alias(e,t=!1){const n="alias";if(!kt.lifecycle.loaded.value)return void(kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[n,e]]);this.errorHandler.leaveBreadcrumb(`New ${n} event`),kt.metrics.triggered.value+=1;const r=e.from??this.userSessionManager?.getUserId()??this.userSessionManager?.getAnonymousId();this.eventManager?.addEvent({type:n,to:e.to,from:r,options:e.options,callback:e.callback})}group(e,t=!1){const n="group";kt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} event`),kt.metrics.triggered.value+=1,k(e.groupId)||this.userSessionManager?.setGroupId(e.groupId),this.userSessionManager?.setGroupTraits(e.traits),this.eventManager?.addEvent({type:n,groupId:e.groupId,traits:e.traits,options:e.options,callback:e.callback})):kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[n,e]]}reset(e,t=!1){const n="reset";kt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} invocation, resetAnonymousId: ${e}`),this.userSessionManager?.reset(e)):kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[n,e]]}getAnonymousId(e){return this.userSessionManager?.getAnonymousId(e)}setAnonymousId(e,t,n=!1){const r="setAnonymousId";kt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${r} invocation`),this.userSessionManager?.setAnonymousId(e,t)):kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[r,e,t]]}getUserId(){return kt.session.userId.value}getUserTraits(){return kt.session.userTraits.value}getGroupId(){return kt.session.groupId.value}getGroupTraits(){return kt.session.groupTraits.value}startSession(e,t=!1){const n="startSession";kt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} invocation`),this.userSessionManager?.start(e)):kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[n,e]]}endSession(e=!1){const t="endSession";kt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${t} invocation`),this.userSessionManager?.end()):kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,[t]]}getSessionId(){const e=this.userSessionManager?.getSessionId();return e??null}consent(e,t=!1){kt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb("New consent invocation"),ke((()=>{kt.consents.preConsent.value={...kt.consents.preConsent.value,enabled:!1},kt.consents.postConsent.value=(e=>{const t={sendPageEvent:!1,trackConsent:!1,discardPreConsentEvents:!1};if(O(e)){const n=h(e);t.storage=n.storage,A(n.integrations)&&(t.integrations=O(n.integrations)?n.integrations:Nn),t.discardPreConsentEvents=!0===n.discardPreConsentEvents,t.sendPageEvent=!0===n.sendPageEvent,t.trackConsent=!0===n.trackConsent,B(n.consentManagement)&&(t.consentManagement=M(n.consentManagement,{enabled:kt.consents.enabled.value}))}return t})(e);const{initialized:t,consentsData:n}=_n(kt.consents.postConsent.value.consentManagement,this.logger);kt.consents.initialized.value=t||kt.consents.initialized.value,kt.consents.data.value=n})),kt.consents.enabled.value&&!kt.consents.initialized.value&&this.pluginsManager?.invokeSingle("consentManager.updateConsentsInfo",kt,this.storeManager,this.logger),this.storeManager?.initializeStorageState(),this.userSessionManager?.syncStorageDataToState(),this.eventManager?.resume(),this.loadDestinations(),this.sendTrackingEvents(t)):kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,["consent",e]]}sendTrackingEvents(e){if(kt.consents.postConsent.value.trackConsent){const t=x("Consent Management Interaction");e?kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,["track",t]]:this.track(t)}if(kt.consents.postConsent.value.sendPageEvent){const t=H();e?kt.eventBuffer.toBeProcessedArray.value=[...kt.eventBuffer.toBeProcessedArray.value,["page",t]]:this.page(t)}}setAuthToken(e){this.userSessionManager?.setAuthToken(e)}}class $r{static globalSingleton=null;analyticsInstances={};defaultAnalyticsKey="";logger=Qe;constructor(){if($r.globalSingleton)return $r.globalSingleton;this.setDefaultInstanceKey=this.setDefaultInstanceKey.bind(this),this.getAnalyticsInstance=this.getAnalyticsInstance.bind(this),this.load=this.load.bind(this),this.ready=this.ready.bind(this),this.triggerBufferedLoadEvent=this.triggerBufferedLoadEvent.bind(this),this.page=this.page.bind(this),this.track=this.track.bind(this),this.identify=this.identify.bind(this),this.alias=this.alias.bind(this),this.group=this.group.bind(this),this.reset=this.reset.bind(this),this.getAnonymousId=this.getAnonymousId.bind(this),this.setAnonymousId=this.setAnonymousId.bind(this),this.getUserId=this.getUserId.bind(this),this.getUserTraits=this.getUserTraits.bind(this),this.getGroupId=this.getGroupId.bind(this),this.getGroupTraits=this.getGroupTraits.bind(this),this.startSession=this.startSession.bind(this),this.endSession=this.endSession.bind(this),this.getSessionId=this.getSessionId.bind(this),this.setAuthToken=this.setAuthToken.bind(this),this.consent=this.consent.bind(this),$r.globalSingleton=this,this.triggerBufferedLoadEvent()}setDefaultInstanceKey(e){e&&(this.defaultAnalyticsKey=e)}getAnalyticsInstance(e){const t=e??this.defaultAnalyticsKey;return Boolean(this.analyticsInstances[t])||(this.analyticsInstances[t]=new Cr),this.analyticsInstances[t]}load(e,t,n){S(e)?this.analyticsInstances[e]||(this.setDefaultInstanceKey(e),this.analyticsInstances[e]=new Cr,this.getAnalyticsInstance(e).load(e,t,n)):this.logger.error(((e,t)=>`${e}${he}The write key "${t}" is not a string. Please check that the write key is correct and try again.`)(Z,e))}triggerBufferedLoadEvent(){const e=Array.isArray(globalThis.rudderanalytics)?globalThis.rudderanalytics:[];(e=>{const t="consent",n=e.filter((e=>e[0]===t)),r=e.filter((e=>e[0]!==t));e.splice(0,e.length,...n,...r)})(e);const t=(e=>{let t=[],n=0;for(;n<e.length;){if(e[n]&&"load"===e[n][0]){t=h(e[n]),e.splice(n,1);break}n+=1}return t})(e);ue(re,h(e)),t.length>0&&(t.shift(),this.load.apply(null,t))}ready(e){this.getAnalyticsInstance().ready(e)}page(e,t,n,r,s){this.getAnalyticsInstance().page(H(e,t,n,r,s))}track(e,t,n,r){this.getAnalyticsInstance().track(x(e,t,n,r))}identify(e,t,n,r){this.getAnalyticsInstance().identify(_(e,t,n,r))}alias(e,t,n,r){this.getAnalyticsInstance().alias(F(e,t,n,r))}group(e,t,n,r){0!==arguments.length?this.getAnalyticsInstance().group(Q(e,t,n,r)):this.logger.error(`${Z}${he}The group() method must be called with at least one argument.`)}reset(e){this.getAnalyticsInstance().reset(e)}getAnonymousId(e){return this.getAnalyticsInstance().getAnonymousId(e)}setAnonymousId(e,t){this.getAnalyticsInstance().setAnonymousId(e,t)}getUserId(){return this.getAnalyticsInstance().getUserId()}getUserTraits(){return this.getAnalyticsInstance().getUserTraits()}getGroupId(){return this.getAnalyticsInstance().getGroupId()}getGroupTraits(){return this.getAnalyticsInstance().getGroupTraits()}startSession(e){return this.getAnalyticsInstance().startSession(e)}endSession(){return this.getAnalyticsInstance().endSession()}getSessionId(){return this.getAnalyticsInstance().getSessionId()}setAuthToken(e){return this.getAnalyticsInstance().setAuthToken(e)}consent(e){return this.getAnalyticsInstance().consent(e)}}const{setDefaultInstanceKey:Or,getAnalyticsInstance:Dr,load:Mr,ready:Br,page:Lr,track:Ur,identify:jr,alias:Nr,group:Hr,reset:xr,getAnonymousId:_r,setAnonymousId:Fr,getUserId:Qr,getUserTraits:Kr,getGroupId:Gr,getGroupTraits:zr,startSession:Vr,endSession:qr,getSessionId:Wr,consent:Jr,setAuthToken:Xr}=new $r;return e.alias=Nr,e.consent=Jr,e.endSession=qr,e.getAnalyticsInstance=Dr,e.getAnonymousId=_r,e.getGroupId=Gr,e.getGroupTraits=zr,e.getSessionId=Wr,e.getUserId=Qr,e.getUserTraits=Kr,e.group=Hr,e.identify=jr,e.load=Mr,e.page=Lr,e.ready=Br,e.reset=xr,e.setAnonymousId=Fr,e.setAuthToken=Xr,e.setDefaultInstanceKey=Or,e.startSession=Vr,e.track=Ur,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),e}({});
//# sourceMappingURL=rsa.min.js.map
