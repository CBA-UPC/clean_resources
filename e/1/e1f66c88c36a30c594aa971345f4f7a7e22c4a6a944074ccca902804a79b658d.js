(window.webpackJsonp=window.webpackJsonp||[]).push([[236],{1333:function(e,r,a){"use strict";a.r(r);var t=a(940),i=a(1104),d=a(1105),s=a(1106),h=a(974),o=a(975),n=a(1113),l=a(1107),u=a(976),c=a(971),p=a(912),f={components:{ThreadPreviewMerchantLabel:a(1108).a,ThreadDescription:p.a,ThreadPreviewVoucherCodeLabel:i.a,ThreadPreviewVoucherCodeButton:d.a,ThreadPreviewVoteControl:s.a,ThreadPreviewImage:h.a,ThreadPreviewTitle:o.a,ThreadPreviewPriceLabel:n.a,ThreadPreviewShippingLabel:l.a,ThreadPreviewAuthor:u.a,ThreadExclusiveBadge:c.a},mixins:[t.b,t.d,t.a,t.c,t.f]},v=a(45),y=Object(v.a)(f,(function(){var e=this,r=e._self._c;return r(e.layoutType,{tag:"Component",attrs:{"thread-type":e.thread.type},scopedSlots:e._u([{key:"header",fn:function(){return[r("ThreadPreviewVoteControl",{attrs:{layout:e.layout}})]},proxy:!0},{key:"image",fn:function(){return[r("ThreadPreviewImage",{attrs:{value:e.image,placeholder:"/assets/img/default-voucher_b97b9.svg",obfuscated:e.thread.nsfw,layout:e.layout,disabled:e.disabled,features:e.features}})]},proxy:!0},{key:"title",fn:function(){return[r("ThreadPreviewTitle",{attrs:{value:e.thread.title,layout:e.layout,placeholder:e.i18n.titlePlaceholder}},[e.thread.isExclusive?[r("ThreadExclusiveBadge",{staticClass:"space--mr-2",attrs:{expired:e.thread.isExpired}})]:e._e()],2)]},proxy:!0},{key:"labels",fn:function(){return[r("ThreadPreviewPriceLabel",{attrs:{thread:e.thread,layout:e.layout,disabled:e.disabled}}),e.features.shipping?r("ThreadPreviewShippingLabel",{attrs:{value:e.thread.shippingPrice,"is-free":e.thread.freeShipping}}):e._e(),e.hasMerchant?[e.thread.price>0||e.thread.percentage>0||e.thread.shippingPrice||e.thread.freeShipping?r("div",{staticClass:"thread-divider"}):e._e(),r("ThreadPreviewMerchantLabel",{attrs:{merchant:e.thread.merchant,disabled:e.disabled}})]:e._e()]},proxy:!0},{key:"body",fn:function(){return[e.showDescription?r("ThreadDescription",{attrs:{value:e.thread.description||e.i18n.descriptionPlaceholder,"max-length":160,modifier:"size--all-s size--fromW4-m overflow--clamp-s-2 overflow--fromW4-clamp-m-2"}}):e._e()]},proxy:!0},{key:"author",fn:function(){return[r("ThreadPreviewAuthor",{attrs:{user:e.thread.user||e.currentUser,"best-badge":e.features.showUserBestBadge}})]},proxy:!0},{key:"primary-action",fn:function(){return[e.hasLink||e.hasVoucher&&e.hasLink?[e.hasLink?r("ThreadPreviewVoucherCodeButton",{attrs:{"thread-type":e.thread.type,disabled:e.disabled,"has-code":e.hasVoucher}}):e._e()]:e._e()]},proxy:!0}])})}),[],!1,null,null,null);r.default=y.exports}}]);ect(f.e)(e),features:Object(f.c)(e,o.o),settings:Object(f.f)(e),thread:Object(f.g)(e)}),v={routeData:b};var y=Object(n.defineComponent)(Object.assign({},v,{__name:"thread-submission-voucher",setup(e){const{baseLayout:t,thread:r,groups:i,countries:o,events:s,locations:c,features:u}=Object(h.c)(),m=Object(n.computed)((()=>u.data.value.multiStepForm));return g((()=>({thread:r.data.value,groups:i.data.value,countries:o.data.value,events:s.data.value,locations:c.data.value,features:u.data.value.threadForm}))),{__sfc:!0,routeData:b,baseLayout:t,thread:r,groups:i,countries:o,events:s,locations:c,features:u,isMultiStepForm:m,TwigPortal:a.a,VoucherSubmissionWizard:l,BaseLayout:d.a}}})),O=Object(u.a)(y,(function(){var e=this._self._c,t=this._self._setupProxy;return e(t.BaseLayout,{attrs:{twig:"","route-data":t.baseLayout,"hide-footer":t.isMultiStepForm}},[e(t.TwigPortal,{attrs:{to:"#threadSubmissionFormPortal"}},[e(t.VoucherSubmissionWizard,{attrs:{"is-multi-step-form":t.isMultiStepForm}})],1)],1)}),[],!1,null,null,null);t.default=O.exports},307:function(e,t,r){var n=r(309),a=r(88),i=r(182),o=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(i(e))return NaN;if(a(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=a(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=n(e);var r=s.test(e);return r||c.test(e)?u(e.slice(2),r?2:8):o.test(e)?NaN:+e}},308:function(e,t,r){var n=r(80);e.exports=function(){return n.Date.now()}},309:function(e,t,r){var n=r(310),a=/^\s+/;e.exports=function(e){return e?e.slice(0,n(e)+1).replace(a,""):e}},310:function(e,t){var r=/\s/;e.exports=function(e){for(var t=e.length;t--&&r.test(e.charAt(t)););return t}},521:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return d}));var n=r(10),a=r.n(n),i=r(11),o=r.n(i);let s=function(e){return e.CROP="cp",e.RESIZE="re",e.BLUR="bl",e.FIT="fi",e.FIT_BY_SIZE="fs",e.QUALITY="qt",e.FILE_TYPE="ft",e}({}),c=function(e){return e.ANIMATED_SOURCE="as",e}({});const u={[s.CROP]:"crop",[s.RESIZE]:"resize",[s.BLUR]:"blur",[s.FIT]:"fit",[s.FIT_BY_SIZE]:"fitBySize",[s.QUALITY]:"quality",[s.FILE_TYPE]:"fileType"};let l=function(){function e(t,r){if(a()(this,e),t){if("object"==typeof t){const{path:e,name:n}=t;if(!e||!n)throw Error("Invalid picsy image object");const a=t.animated?"".concat(c.ANIMATED_SOURCE,"/"):"",{name:i=n,ext:o="jpg"}=r||{},s=t.ext||o;this.path="".concat("https://static-pepper.dealabs.com","/").concat(e,"/").concat(n,"/").concat(a),this.file="".concat(i,".").concat(s)}else{if("string"!=typeof t)throw Error("Expected picsy image path, but received: ".concat(t));if("string"!=typeof r)throw Error("Expected picsy image file name, but received: ".concat(r));this.path=t,this.file=r}Object.freeze(this)}}return o()(e,[{key:"blur",value:function(e){return e>0&&e<=100?this.addOperation(s.BLUR,e):this}},{key:"quality",value:function(e){return e>=0&&e<=100?this.addOperation(s.QUALITY,e):this}},{key:"resize",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.dimOperation(s.RESIZE,...t)}},{key:"fit",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.dimOperation(s.FIT,...t)}},{key:"fitBySize",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.dimOperation(s.FIT_BY_SIZE,...t)}},{key:"crop",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.dimOperation(s.CROP,...t)}},{key:"fileType",value:function(t){if(!t||!this.file)return this;const r="".concat(this.file.substr(0,this.file.lastIndexOf(".")),".").concat(t);return new e(this.path,r)}},{key:"toString",value:function(){return this.path?this.path+this.file:""}},{key:"apply",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((e,t)=>{let[r,...n]=t;const a=u[r];return a?e[a](...n):e}),this)}},{key:"dimOperation",value:function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=Math.round(t)||"",i=Math.round(r)||"";return a||i?this.addOperation(e,"".concat(a).concat(i?"x"+i:"").concat(n?"w":"")):this}},{key:"addOperation",value:function(t,r){return this.path?new e("".concat(this.path).concat(t,"/").concat(r,"/"),this.file):this}}]),e}();const d=e=>{const t=[s.CROP,s.RESIZE,s.FIT,s.FIT_BY_SIZE];for(const[r,n,a]of e)if(t.includes(r))return{width:n,height:a};return{width:0,height:0}}},564:function(e,t,r){"use strict";r.d(t,"o",(function(){return l})),r.d(t,"p",(function(){return d})),r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return m})),r.d(t,"d",(function(){return p})),r.d(t,"f",(function(){return g})),r.d(t,"g",(function(){return f})),r.d(t,"i",(function(){return b})),r.d(t,"c",(function(){return v})),r.d(t,"j",(function(){return y})),r.d(t,"k",(function(){return O})),r.d(t,"n",(function(){return j})),r.d(t,"l",(function(){return I})),r.d(t,"m",(function(){return w})),r.d(t,"h",(function(){return F})),r.d(t,"e",(function(){return S}));var n=r(642),a=r(1),i=r(6);const o={startWithProtocol:["^","(?:(?:(?:https?):)?\\/\\/)"],makeProtocolOptional:["?"],continue:["(?:\\S+(?::\\S*)?@)?","(?:","(?!(?:10|127)(?:\\.\\d{1,3}){3})","(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})","(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})","(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])","(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}","(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))","|","(?:","(?:","[a-z0-9\\p{L}]","[a-z0-9\\p{L}-]{0,62}",")?","[a-z0-9\\p{L}]\\.",")+","(?:[a-z\\p{L}]{2,}\\.?)",")","(?::\\d{2,5})?","(?:[/?#]\\S*)?","$"]};var s=r(5),c=r(579);const u=function(e,t,r,a){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"value";return n.b.withParams({type:t,validationData:{},field:e},(async t=>{if(o&&Object(n.d)(t))return!0;const c={remote:!0,messages:[],valid:!0};try{var u;c._data=await Object(i.b)({req:r,params:{field:e,[s]:t,validations:a}}).request,c.messages=null!==(u=c._data.validation)&&void 0!==u?u:[],c.valid=0===c.messages.length}catch(e){c.messages=e.validation,c.valid=!1}return c}))},l=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return u(e,"validRemoteField",a.md,r,t)},d=e=>n.b.withParams({type:"validRemoteFields",validationData:{},fields:e},(async()=>{const t={remote:!0,multiple:!0,messages:[],valid:!0};try{var r;t._data=await Object(i.b)({req:a.nd,params:{fields:e}}).request,t.messages=null!==(r=t._data.validation)&&void 0!==r?r:[],t.valid=0===t.messages.length}catch(e){t.messages=e.validation,t.valid=!1}return t})),h=(e,t,r)=>n.b.withParams({type:"betweenNumeric",validationData:Object.assign({min:e,max:t},r)},(r=>Object(n.a)(r)||r>=e&&r<=t)),m=(e,t,r)=>n.b.withParams({type:"betweenString",validationData:Object.assign({min:e,max:t},r)},(r=>Object(n.d)(r)||"string"==typeof r&&r.length>=e&&r.length<=t)),p=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.b.withParams({type:"maxArray",validationData:Object.assign({max:e},t)},(t=>{const a=r?t.filter(r):t;return Object(n.c)(a)||Array.isArray(a)&&a.length<=e}))},g=(e,t)=>n.b.withParams({type:"maxString",validationData:Object.assign({max:e},t)},(t=>Object(n.d)(t)||"string"==typeof t&&t.length<=e)),f=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.b.withParams({type:"minArray",validationData:Object.assign({min:e},t)},(t=>{const a=r?t.filter(r):t;return Object(n.c)(a)||Array.isArray(a)&&a.length>=e}))},b=(e,t)=>n.b.withParams({type:"minNumeric",validationData:Object.assign({min:e},t)},(t=>Object(n.a)(t)||"number"==typeof t&&t>=Object(s.unref)(e))),v=e=>n.b.withParams({type:"localNumeric",validationData:Object.assign({},e)},(e=>Object(n.a)(e)||/^[0-9,. ]+$/.test(e))),y=e=>n.b.withParams({type:"required",validationData:Object.assign({},e)},n.b.req),O=(e,t)=>n.b.withParams({type:"required",validationData:Object.assign({},t)},(t=>{let r=!1;if("function"==typeof e)r=e.call(void 0,t);else{const t=Object(s.unref)(e);r=t&&0!==t}return!r||n.b.req(t)})),j=(e,t)=>n.b.withParams({type:"url",validationData:Object.assign({},t)},(t=>Object(n.d)(t)||"string"==typeof t&&function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new RegExp(o.startWithProtocol.concat(e?o.makeProtocolOptional:[]).concat(o.continue).join(""),"iu")}(e).test(t))),I=e=>n.b.withParams({type:"sameOriginUrl",validationData:Object.assign({},e)},(e=>Object(n.d)(e)||"string"==typeof e&&new URL(e).origin===window.location.origin)),w=(e,t)=>n.b.withParams({type:"treeSelectRequiredWith",validationData:Object.assign({},t)},(t=>{const r=Object(c.a)(t);return!Object(s.unref)(e)||r.length>0})),F=(e,t)=>n.b.withParams({type:"minDatetime",validationData:Object.assign({minDate:e},t)},(t=>{var r;const a=null===(r=Object(s.unref)(e))||void 0===r?void 0:r.timestamp;return Object(n.a)(t.timestamp)||Object(n.a)(a)||t.timestamp>=a})),S=(e,t)=>n.b.withParams({type:"maxDatetime",validationData:Object.assign({maxDate:e},t)},(t=>{var r;const a=null===(r=Object(s.unref)(e))||void 0===r?void 0:r.timestamp;return Object(n.a)(t.timestamp)||t.timestamp<=a}))},566:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return c}));var n=r(680),a=r.n(n);const i=e=>e.files&&e.files.length?a()(e.files):null,o=6144,s=e=>e.size>6291456,c=e=>{const t=new Image;return new Promise(((r,n)=>{t.addEventListener("load",(()=>{r({width:t.naturalWidth,height:t.naturalHeight})})),t.addEventListener("error",n),t.src=e}))}},567:function(e,t,r){"use strict";(function(e){r.d(t,"d",(function(){return b})),r.d(t,"h",(function(){return y})),r.d(t,"j",(function(){return P})),r.d(t,"m",(function(){return S})),r.d(t,"e",(function(){return D})),r.d(t,"g",(function(){return E})),r.d(t,"f",(function(){return F})),r.d(t,"l",(function(){return v})),r.d(t,"c",(function(){return I})),r.d(t,"b",(function(){return w})),r.d(t,"a",(function(){return j})),r.d(t,"i",(function(){return T})),r.d(t,"k",(function(){return _}));var n=r(32),a=r.n(n),i=r(5),o=r(87),s=r(4),c=r(104),u=r(616),l=r(6),d=r(611),h=r(513),m=r(1),p=r(21),g=r(653);const f=["wysiwyg"];function b(){const e=P(),t=Object(h.b)(),r=Object(i.ref)(!!e.value.threadId||function(e){return e.type===m.Ab.Deal&&Boolean(e.link||e.title||e.price||e.scheduledReleaseDate.date||e.endDate.date)}(e.value));return Object(p.j)(["thread_created_location"]),{isFullForm:r,showFullForm:function(){r.value=!0,t.replace({query:Object.assign({},t.currentRoute.query),hash:"#thread-details"})}}}const v=()=>{const e=P(),t=Object(i.ref)(null);Object(i.onUnmounted)((()=>{y().value.destroy()}));const{submitForm:r,validationMessages:n}=O({form:t,route:Object(h.a)()});return{form:t,thread:e,formOptions:F(),submitForm:r,validationMessages:n}},y=()=>Object(i.computed)((()=>c.b.create("threadSubmit"))),O=e=>{let{form:t,route:r}=e;const n=Object(i.ref)([]);return{submitForm:async function(){const e=y();if(e.value.isLoading())return;let a=null;try{var o;await Object(d.a)(),e.value.reset(),e.value.add(new Promise((e=>{a=e}))),t&&t.value.updateShortcodes();const c=F(),h=(e=>{const t={threadCreatedLocation:{name:"thread_created_location",data:e.query.thread_created_location}};return Object(i.ref)(t)})(r),m=P();m.value.isLocal&&(m.value.dispatchedFrom=null);const p="thread-desc-".concat(null!==(o=m.value.threadId)&&void 0!==o?o:"new"),f=Object(l.b)({req:u.e,params:{threadData:m.value,mentions:c.wysiwyg.plugins.mentions,morph:"threads.switch"===r.name,token:s.a.state.threadForm.token,ocular:h.value.threadCreatedLocation.data?h.value:null}}),b=await e.value.add(f.request),{thread:v,validation:y,responseMessages:O=[]}=j(b);if(n.value=y,!v)return a(),{responseMessages:O};Object(g.a)(p),window.onbeforeunload=()=>null,window.onunload=()=>null,window.location.href=null==v?void 0:v.url}catch(t){var c;console.error(t),null===(c=a)||void 0===c||c();const{validation:r,responseMessages:i}=j(t);return n.value=r,e.value.reset(),{responseMessages:i}}},validationMessages:n}};function j(e){if(e.errors&&e.errors.length)return{thread:null,validation:[],responseMessages:[]};const{messages:t}=e,{thread:r,validation:n}=e.persistThread||{};if(n&&n.length)return{thread:null,validation:n,responseMessages:[]};return(null!=t?t:[]).some((e=>"error"===e.type))?{thread:null,validation:[],responseMessages:t}:{thread:r,validation:[],responseMessages:t}}const I=async(e,t)=>{var r;const{submitForm:n,validationMessages:a}=O({route:e}),{responseMessages:i}=null!==(r=await n())&&void 0!==r?r:{};s.a.dispatch("pageMsgs/set",i),Object(u.d)(t,a.value)},w=()=>{const e=new URLSearchParams(window.location.search).get("imageurl");e&&s.a.dispatch("threadForm/addGalleryImages",[{remoteUrl:e}])},F=()=>{const e=Object(o.d)({countries:{namespace:"threadForm",path:"countries"},groups:{namespace:"threadForm",path:"groups"},locations:{namespace:"threadForm",path:"locations"},events:{namespace:"threadForm",path:"events"}});return e.wysiwyg={plugins:S()},e},S=()=>{const e=Object(o.d)({mentions:{namespace:"threadForm",path:"mentions"},shortcodes:{namespace:"threadForm",path:"thread.shortcodes"}});return e.link={href:"",content:""},e.emoji=!0,e},D=()=>{const e=F(),t=P();return Object(i.computed)((()=>{var r;const n=s.a.state.threadForm.features||{},{wysiwyg:i={}}=n,o=a()(n,f),c=i.html&&(!t.value.threadId||(null===(r=t.value.user)||void 0===r?void 0:r.userId)===s.a.getters["auth/me"].userId);return Object.assign({},o,{wysiwyg:Object.assign({},i,{html:c}),dispatchedFrom:o.dispatchedFrom&&e.countries.length,locations:o.locations&&!!e.locations.id,events:o.events&&e.events.length,groups:o.groups&&e.groups.length})}))},E=e=>{const t=F();return Object(i.computed)((()=>({groups:t.groups,max:e})))},P=()=>{const{thread:e}=Object(o.d)({thread:{namespace:"threadForm",path:"thread",deep:!0}});return Object(i.ref)(e)},T=e=>{const t=P(),r=Object(i.watch)(t,(n=>{n&&(window.onbeforeunload=()=>"Vous avez des changements non enregistrés !",((e,t)=>{const r=t?"MultiStep":"SinglePage",n=["THREAD_SUBMISSION"],a=[m.Ab.Deal].includes(e.value.type)?"".concat(r).concat(e.value.type,"Abandoned"):null;window.onunload=()=>{a&&n.includes(m.q[a])&&e.value.link&&!e.value.threadId&&(localStorage.setItem("formAbandoned",m.q[a]),localStorage.setItem("formAbandonedTimer",String(Date.now())))}})(t,e),r())}),{deep:!0})},_=()=>{const t=P(),r=Object(i.computed)((()=>t.value.locations.checked));return Object(i.computed)((()=>{if(!t.value.isLocal)return null;if(r.value)return"National";if(!t.value.locations||!t.value.locations.items)return null;const n=t.value.locations.items.filter((e=>e.checked)),a=t.value.locations.items.reduce(((e,t)=>(t.items&&!t.checked&&e.push(...t.items.filter((e=>e.checked))),e)),[]);return[n.length?e("{1} :count région|{2} :count régions|[3,*] :count régions",{count:n.length}):"",a.length?e("{1} :count département|{2} :count départements|[3,*] :count départements",{count:a.length}):""].filter((e=>e)).join(" / ")}))}}).call(this,r(70).translation)},579:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n=e=>{const t=[];return function e(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!r)return;if(r.checked)return void t.push(r.id);if(!r.items)return;r.items.map(e)}(e),t}},586:function(e,t){e.exports=function(e){if(null==e)throw new TypeError("Cannot destructure "+e)},e.exports.__esModule=!0,e.exports.default=e.exports},611:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return h}));var n=r(4),a=r(1),i=r(682),o=r(60),s=r(17),c=r(324);const u=e=>e.groups.some((e=>e.source===o.b)),l=r.n(c)()((async e=>await Object(a.Nb)({filter:e})),(e=>{var t,r;return"".concat(e.terms.join("_"),"_").concat(null!==(t=null===(r=e.price)||void 0===r?void 0:r.eq)&&void 0!==t?t:"")})),d=async()=>{if(!n.a.getters["threadForm/canAutoAssignGroups"])return;const e=n.a.state.threadForm.thread;if(![s.f,s.g].includes(e.type))try{var t;const r=n.a.state.threadForm.groups,a=null!==(t=n.a.state.threadForm.fetchedFromUrl.title)&&void 0!==t?t:"",c={threadId:{eq:e.threadId},threadUrl:{eq:e.link},threadTypeName:{eq:e.type},terms:[e.title,a]};null!==e.price&&void 0!==e.price&&""!==e.price&&(c.price={eq:e.price});const{data:{groups:d}}=await l(c),h=e.type===s.e;if(d.length<1)return n.a.commit("threadForm/UPDATE_FIELD",{path:"thread.groups",value:e.groups.filter((e=>!e.assignedBySystem))}),void n.a.commit("threadForm/UPDATE_FIELD",{path:"groups",value:r.filter((e=>Object(i.g)(e,h)!==o.a||!e.assignedBySystem)).map((e=>Object.assign({},e,{matchesAutoAssignment:!1})))});if(u(e)&&!h||u(e)&&(e=>e.groups.some((e=>e.source===o.c)))(e))return;const m=d.map((e=>Object.assign({},e,{assignedBySystem:!0}))),p=m.reduce(((e,t)=>(e.primary||Object(i.g)(t,h)!==o.b||(e.groups.push(t),e.primary=!0),e.secondary||Object(i.g)(t,h)!==o.c||(e.groups.push(t),e.secondary=!0),Object(i.g)(t)===o.a&&e.groups.push(t),e)),{primary:!1,secondary:!1,groups:[]}),g=[...r.filter((e=>!m.some((t=>t.threadGroupId===e.threadGroupId)))).map((e=>Object.assign({},e,{matchesAutoAssignment:!1}))),...m.filter((e=>Object(i.g)(e,h)!==o.a)).map((e=>Object.assign({},e,{matchesAutoAssignment:!0})))],f=[...e.groups.filter((e=>!e.assignedBySystem)),...p.groups];n.a.commit("threadForm/UPDATE_FIELD",{path:"groups",value:g}),n.a.commit("threadForm/UPDATE_FIELD",{path:"thread.groups",value:f})}catch(e){}},h=e=>{const{cpcLink:t,claimCodeCampaignId:r,isExclusive:a,nsfw:i,scheduledReleaseDate:o,events:c,disclaimers:u,uploadImage:l}=n.a.state.threadForm.features,d=t||r||a||i||o||c||u;return e.type===s.e?d||l:d}},616:function(e,t,r){"use strict";r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return y})),r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return j})),r.d(t,"c",(function(){return I})),r.d(t,"d",(function(){return w}));var n=r(32),a=r.n(n),i=r(1),o=r(642),s=r(753);var c=r(107),u=r(6),l=r(120),d=r(724),h=r(17);const m=["merchant","morphsTo","user","shippingPrice","freeShipping","events","groups","images","imageSuggestions","mainImage","galleryImages","disclaimers","titleSlug","threadTypeId","preparedHtmlDescription"],p=["isSelected","source","matchesAutoAssignment"],g=["checked"],f=(e,t)=>{let{mentions:r,morph:n}=t;const{merchant:{merchantId:i,merchantName:u}={},shippingPrice:l,freeShipping:d,events:f,groups:b,galleryImages:v,disclaimers:y}=e,O=a()(e,m);switch(O.mentions=r,n&&(O.morph=O.type),i&&(O.merchant={merchantId:i,merchantName:u}),O.groups=b.map((e=>a()(e,p))),O.events=f.map((e=>a()(e,g))),O.locations.id||delete O.locations,O.startDate.timestamp||(O.startDate=null),O.endDate.timestamp||(O.endDate=null),O.scheduledReleaseDate.timestamp||(O.scheduledReleaseDate=null),Object(o.a)(d)&&Object(o.a)(l)||(O.shipping={isFree:!!d,price:l||0}),[h.o,h.a,h.g].includes(O.type)?((O.type===h.a&&!O.price&&!Object(s.b)(O.price)||[h.o,h.g].includes(O.type)&&Object(s.a)(O.price))&&(O.price=""),O.percentage||(O.percentage=0)):(delete O.price,delete O.percentage,delete O.isLocal),O.discountType){case h.c:delete O.price;break;case h.d:delete O.percentage;break;case h.b:delete O.price,delete O.percentage}return O.type===h.a?O.nextBestPrice||(O.nextBestPrice=0):O.nextBestPrice||delete O.nextBestPrice,O.disclaimers=y.map((e=>{let{threadDisclaimerId:t}=e;return{threadDisclaimerId:t}})),Object.assign({},O,"locations"in O&&{locations:(j=O.locations,"1"===j.id&&j.checked&&delete j.items,j)},{galleryImages:{bucket:"threads",slots:v.map((e=>{const t={remoteUrl:e.remoteUrl||"",slotData:null};return e.remoteUrl||(t.slotData=Object(c.d)(e)?Object.assign({},e.slots[0]):Object.assign({},e)),t}))}});var j},b=function(){let{threadData:e,mentions:t="",morph:r=!1,token:n=null,ocular:a=null,descriptionEditOnly:o=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.Ac)({payload:{thread:f(e,{mentions:t,morph:r}),token:n,ocular:a,descriptionEditOnly:o}})},v=e=>{const t=[];return Object.entries(e).forEach((e=>{let[r,n]=e;if(Array.isArray(n)&&n.length){const e=n[0].translations[0];t.push({title:e.title,text:e.body,type:r})}})),t},y=async function(e){const t=await Object(d.f)(e);return{request:t.request.then(v),cancel:t.cancel}},O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=Object(u.d)(Object(d.a)(e,t),11e3);return{request:r.request.then((e=>{var t;let{duplicates:r}=e;return null!=r&&null!==(t=r.threads)&&void 0!==t&&t.length?r:null})),cancel:r.cancel}},j=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=Object(u.d)(Object(d.b)(e,t,r),5e3);return{request:n.request.then((e=>{let{duplicates:t}=e;return null!=t&&t.length?t:[]})),cancel:n.cancel}},I=()=>Object(l.c)(),w=(e,t)=>{t.map((t=>{let r=t.path;return"threadLocationSelected"===r&&(r="locations"),e.setMessages(r,t.translations.map((e=>({text:e.body}))))}))}},642:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a})),r.d(t,"d",(function(){return i})),r.d(t,"c",(function(){return o}));r(315);const n={req:e=>{if(Array.isArray(e))return!!e.length;if(null==e)return!1;if(!1===e)return!0;if(e instanceof Date)return!isNaN(e.getTime());if("object"==typeof e){for(let t in e)return!0;return!1}return!!String(e).length},withParams:(e,t)=>async function(){const r=await t(...arguments);return"object"==typeof r?e=Object.assign({},e,r):e.valid=r,e}},a=e=>null==e||""===e,i=e=>a(e)||""===e,o=e=>a(e)||Array.isArray(e)&&0===e.length},653:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(14);t.b={created(){this.markForRestore=this.markForRestore.bind(this),this.undoRestore=this.undoRestore.bind(this),this.clearRestore=this.clearRestore.bind(this),this.restoreStorage=new n.a("redactor-restore")},data:()=>({restoredContent:"",initialContent:"",restoreId:""}),watch:{restoredContent(e){this.$emit("canRestore",Boolean(e))}},methods:{restoreConfig(){return{markForRestore:this.markForRestore}},markForRestore(e){let{restoreId:t,restoredContent:r,initialContent:n}=e;this.restoreId=t,this.restoredContent=r||"",this.initialContent=n||""},undoRestore(){this.$editor.code.set(this.initialContent,!0),this.clearRestore()},clearRestore(){this.restoreStorage.del(this.restoreId),this.restoredContent=""}}};const a=e=>{new n.a("redactor-restore").del(e)}},680:function(e,t,r){e.exports=r(681)},681:function(e,t){e.exports=function(e){return e&&e.length?e[0]:void 0}},682:function(e,t,r){"use strict";r.d(t,"g",(function(){return s})),r.d(t,"d",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"b",(function(){return l})),r.d(t,"e",(function(){return d})),r.d(t,"h",(function(){return h})),r.d(t,"a",(function(){return m})),r.d(t,"c",(function(){return p}));var n=r(60),a=r(17),i=r(564);const o=function(e){return!!(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.isDefault&&e.isDiscussion:e.isDefault&&!e.isDiscussion)},s=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.source?e.source:o(e,t)?"primary":e.isDefault&&t?"secondary":e.isDefault?"tertiary":"other"},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.map((e=>Object.assign({},e,{source:s(e,t)})))},u=e=>!!e.isSelected,l=e=>!(!e.assignedBySystem||!e.matchesAutoAssignment),d=(e,t)=>{const r=[...t],n=r.findIndex((t=>t.threadGroupId===e.threadGroupId));return n>-1&&r.splice(n,1),u(e)&&r.push(e),r},h=(e,t,r)=>{const a=((e,t)=>{const r=e.find((e=>e.threadGroupId===t.id));return r?(r.isSelected=t.isSelected,r.source=r.source||n.a,r):null})(t,r);return a?d(a,e):null},m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const r={threadGroups:[],systemAssignedGroups:[]},n=e===a.e,s=n?"discussionThreadGroups":"threadGroups",c=e=>o(e,n);return n&&(r.discussionThreadGroups=[]),r[s].push(Object(i.j)({translation:"Veuillez sélectionner la catégorie la plus pertinente"}),Object(i.g)(1,{},c)),t&&r[s].push(Object(i.d)(t,{},c)),r};function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"groups";const r=Object.assign({},e);return Object.keys(r).forEach((e=>{r[e]={fieldName:t,rules:r[e]}})),r}},724:function(e,t,r){"use strict";r.d(t,"f",(function(){return i})),r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return c})),r.d(t,"e",(function(){return u})),r.d(t,"d",(function(){return l}));var n=r(1),a=r(6);const i=async e=>{const t=[n.h,n.g,n.Hb,n.f,n.e],r={url:e,field:"link",value:e},i=await Object(a.c)({queries:t});return await i(r)},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(a.b)({req:n.bc,params:{url:e,filter:t},options:r})},s=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(a.b)({req:n.cc,params:{url:e,voucherCode:t,filter:r},options:i})},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(a.b)({req:n.Yc,params:e,options:t})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(a.b)({req:n.Xc,params:e,options:t})},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(a.b)({req:n.uc,params:{url:e},options:t})}},728:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={images:"getImageSuggestions",price:"getPriceSuggestion",shippingPrice:"getShippingPriceSuggestion",specification:"getSpecificationSuggestion",title:"getTitleSuggestion"}},753:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return i}));var n=r(548);const a=e=>("string"==typeof e?""!==e.trim():null!=e)&&0===Number(Object(n.b)(e)),i=e=>!Number(Object(n.b)(e))},806:function(e,t,r){"use strict";var n=r(540),a=r.n(n),i=r(17),o=r(87),s=r(682),c=r(107),u=r(521),l=r(566),d=r(43),h=r(728),m=r(724),p=r(6),g=r(616);const f=function(e,t,r){var n,a,o,u;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const d=e.shipping||{isFree:null,price:null},h=d.isFree,m=d.price,p=null!=e&&null!==(n=e.startDate)&&void 0!==n&&n.timestamp?e.startDate:{},g=null!=e&&null!==(a=e.endDate)&&void 0!==a&&a.timestamp?e.endDate:{},f=null!=e&&null!==(o=e.scheduledReleaseDate)&&void 0!==o&&o.timestamp?e.scheduledReleaseDate:{},b=e.type||t||"";return{threadId:e.threadId||null,type:b,images:Object(c.d)(e.images)?e.images:{bucket:"threads",slots:[]},link:e.link||"",galleryImages:e.galleryImages||[],user:e.user||null,claimCodeCampaignId:e.claimCodeCampaignId||"",discountType:e.discountType||null,disclaimers:e.disclaimers||[],cpcLink:e.cpcLink||"",price:e.price||null,percentage:e.percentage||null,nextBestPrice:e.nextBestPrice||null,title:e.title||"",titleSlug:e.titleSlug||"",threadTypeId:e.threadTypeId||null,description:e.description||"",groups:e.groups?Object(s.d)(e.groups,b===i.e):[],freeShipping:h,shippingPrice:m,startDate:p,endDate:g,scheduledReleaseDate:f,voucherCode:e.voucherCode||"",isLocal:!!(e.isLocal||!e.threadId&&l.preSelectIsLocal),isExclusive:!!e.isExclusive,locations:e.locations||r,dispatchedFrom:e.dispatchedFrom||null,nsfw:!!e.nsfw,events:e.events||[],eventOnly:!!e.eventOnly,merchant:e.merchant||{},morphsTo:e.morphsTo||[],shortcodes:e.shortcodes||[],imageSuggestions:e.imageSuggestions||[],preparedHtmlDescription:(null===(u=e.threadDetails)||void 0===u?void 0:u.preparedHtmlDescription)||null}},b=function(){let{formId:e="threadForm",thread:t={},locations:r={id:null},countries:n=[],events:a=[],groups:i=[],mentions:o="",threadType:s="",features:c={},imageSuggestions:u=[],fetchedFromUrl:l={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const d={formId:e,thread:f(t,s,r,c),locations:r,countries:n,events:a,groups:i,mentions:o,features:c,imageSuggestions:u,fetchedFromUrl:l};return Object.assign({},d,{token:Object(g.c)()})},v={getField:o.c,getGalleryImageUrl:e=>function(t){let{pixVariant:r="thread_medium",picsyVariant:n=[["re",300,300],["ft","jpg"],["qt",60]]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=e.thread.galleryImages[t];return a?"remoteUrl"in a?a.remoteUrl:Object(c.d)(a)?Object(c.e)(a,a.slots[0].name,r):new u.a(a).apply(n).toString():""},isShowGalleryImageSizeWarning:e=>t=>{const r=e.thread.galleryImages[t];return!!r&&("remoteUrl"in r?r.isPoorQuality:Object(c.d)(r)?!!Object(c.f)(r,r.slots[0].name,{}).isPoorQuality:r.isPoorQuality)},isAnyGalleryImageSizeWarning:(e,t)=>e.thread.galleryImages.some(((e,r)=>t.isShowGalleryImageSizeWarning(r))),canAutoAssignGroups:e=>{if(0===e.groups.length)return!0;return!e.thread.groups.some((e=>!e.assignedBySystem))}},y={clearFormSuggestionsFromLink(e){let{commit:t}=e;t("UPDATE_FIELD",{path:"fetchedFromUrl",value:{}})},getFormSuggestionsFromLink(e,t){let{dispatch:r,commit:n,state:a}=e,{url:i}=t;if(!i)return;const o={},s=e=>{var t;return!(null===(t=o[e])||void 0===t||!t.isLoading())},{thread:c}=a,u={images:0===c.galleryImages.length,price:!c.price,shippingPrice:!0,title:!0};Object.keys(u).forEach((e=>u[e]&&(e=>{const t=d.b.create(h.a[e]);o[e]=t,t.startLoading()})(e)));const l=Object(p.d)(Object(m.c)(Object.assign({url:i},u)),11e3);return l.request.then((e=>{let{submissionSuggestion:t}=e;const{images:i,price:o,title:c}=t.external,{shippingCosts:u}=t.internal;var l,d;s("images")&&null!=i&&i.length&&r("addGalleryImages",i.slice(0,8).map((e=>({remoteUrl:e.url})))),l="price",d=o.value,s(l)&&d&&n("UPDATE_FIELD",{path:"thread.".concat(l),value:d}),n("UPDATE_FIELD",{path:"fetchedFromUrl",value:Object.assign({},a.fetchedFromUrl,{title:c,price:o.value,shippingCosts:null==u?void 0:u.map((e=>e.price))})})})).finally((()=>{Object.keys(o).forEach((e=>{o[e].stopLoading()}))})),l},addGalleryImages(e){let{state:t,commit:r,dispatch:n}=e;const o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map((e=>Object.assign({},e,{id:a()("gallery_")})));r("UPDATE_FIELD",{path:"thread.galleryImages",value:t.thread.galleryImages.concat(o)}),o.forEach((e=>{e.remoteUrl&&Object(l.c)(e.remoteUrl).then((t=>{let{width:r,height:a}=t;n("updateGalleryImageById",{id:e.id,data:Object.assign({},e,{isPoorQuality:Object(i.x)(r,a)})})})).catch((()=>{}))}))},removeGalleryImage(e,t){let{state:r,commit:n}=e;const a=[...r.thread.galleryImages];a.splice(t,1),n("UPDATE_FIELD",{path:"thread.galleryImages",value:a})},removeAllGalleryImages(e){let{commit:t}=e;t("UPDATE_FIELD",{path:"thread.galleryImages",value:[]})},changeGalleryImagesOrder(e,t){let{state:r,commit:n}=e,{from:a,to:i}=t;const o=[...r.thread.galleryImages],s=o.splice(a,1)[0];o.splice(i,0,s),n("UPDATE_FIELD",{path:"thread.galleryImages",value:o})},updateGalleryImageById(e,t){let{state:r,commit:n}=e,{id:a,data:i}=t;const o=[...r.thread.galleryImages],s=o.findIndex((e=>e.id===a));s>=0&&(o[s]=i,n("UPDATE_FIELD",{path:"thread.galleryImages",value:o}))},getMerchantFromThreadLink(e,t){let{commit:r}=e;const n=Object(m.d)(t);return n.request.then((e=>{let{merchant:t}=e;return r("UPDATE_FIELD",{path:"thread.merchant",value:t||{}}),t})),n},getProductSpecificationFromLink(e,t){let{state:r,commit:n}=e;const{thread:a,features:i}=r;function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";n("UPDATE_FIELD",{path:"fetchedFromUrl",value:Object.assign({},r.fetchedFromUrl,{specification:e})})}if(!(i.specification&&!a.title&&!a.description&&!a.threadId))return;o("");const s=d.b.create(h.a.specification);s.startLoading();const c=Object(m.e)(t);return c.request.then((e=>{let{submissionSuggestion:t}=e;const{specification:r}=t.external;o(r)})).finally((()=>{s.stopLoading()})),c}},O={UPDATE_FIELD:o.b,UPDATE_TOKEN(e){e.token=Object(g.c)()}};t.a=e=>({namespaced:!0,state:b(e),getters:v,actions:y,mutations:O})},840:function(e,t,r){"use strict";r.d(t,"f",(function(){return s})),r.d(t,"g",(function(){return c})),r.d(t,"b",(function(){return u})),r.d(t,"a",(function(){return l})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return m}));var n=r(6),a=r(1),i=r(17);const o=!0;function s(e){return Object(n.c)({queries:[a.xb],merge:!0})({threadTypeId:i.m[e]}).then((e=>e.request)).then((e=>e.groups))}function c(){return Object(n.c)({queries:[a.yb],merge:!0})({}).then((e=>e.request)).then((e=>e.locations))}function u(){return Object(n.c)({queries:[a.vb],merge:!0})({}).then((e=>e.request)).then((e=>e.events))}function l(){return Object(n.c)({queries:[a.ub],merge:!0})({}).then((e=>e.request)).then((e=>e.countries))}function d(e){return Object(n.c)({queries:[a.wb],merge:!0})({threadTypeId:i.m[e]}).then((e=>e.request)).then((e=>e.features))}function h(){return Object(n.c)({queries:[a.zb],merge:!0})({}).then((e=>e.request)).then((e=>e.settings.thread))}function m(e){if(!o)throw Error("FE query to fetch a Thread for edit form is not implemented yet: fetchFormThread(".concat(e,")"));return Promise.reject()}},854:function(e,t,r){"use strict";r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return i})),r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return l}));var n=r(840);const a=(e,t)=>{let{beforeEnter:r}=e;return r((e=>e?e.groups:Object(n.f)(t)),[])},i=e=>{let{beforeEnter:t}=e;return t((e=>e?e.locations:Object(n.g)()),[])},o=e=>{let{beforeEnter:t}=e;return t((e=>e?e.events:Object(n.b)()),[])},s=e=>{let{beforeEnter:t}=e;return t((e=>e?e.countries:Object(n.a)()),[])},c=(e,t)=>{let{beforeEnter:r}=e;return r((e=>e?e.features:Object(n.c)(t)),[])},u=e=>{let{beforeEnter:t}=e;return t((e=>e?e.settings.thread:Object(n.d)()),[])},l=e=>{let{beforeEnter:t,param:r}=e;return t(((e,t)=>t?t.thread:e?Object(n.e)(e):null),[r("threadId")])}},86:function(e,t,r){var n=r(88),a=r(308),i=r(307),o=Math.max,s=Math.min;e.exports=function(e,t,r){var c,u,l,d,h,m,p=0,g=!1,f=!1,b=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var r=c,n=u;return c=u=void 0,p=t,d=e.apply(n,r)}function y(e){var r=e-m;return void 0===m||r>=t||r<0||f&&e-p>=l}function O(){var e=a();if(y(e))return j(e);h=setTimeout(O,function(e){var r=t-(e-m);return f?s(r,l-(e-p)):r}(e))}function j(e){return h=void 0,b&&c?v(e):(c=u=void 0,d)}function I(){var e=a(),r=y(e);if(c=arguments,u=this,m=e,r){if(void 0===h)return function(e){return p=e,h=setTimeout(O,t),g?v(e):d}(m);if(f)return clearTimeout(h),h=setTimeout(O,t),v(m)}return void 0===h&&(h=setTimeout(O,t)),d}return t=i(t)||0,n(r)&&(g=!!r.leading,l=(f="maxWait"in r)?o(i(r.maxWait)||0,t):l,b="trailing"in r?!!r.trailing:b),I.cancel=function(){void 0!==h&&clearTimeout(h),p=0,c=m=u=h=void 0},I.flush=function(){return void 0===h?d:j(a())},I}}}]);