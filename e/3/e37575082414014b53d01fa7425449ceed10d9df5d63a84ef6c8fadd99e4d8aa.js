// For license information, see `https://assets.adobedtm.com/39952453358b/bbeab55061fe/e390521b0a94/RC15c3ff42debd4c9791b89be4909e7c3c-source.js`.
_satellite.__registerScript('https://assets.adobedtm.com/39952453358b/bbeab55061fe/e390521b0a94/RC15c3ff42debd4c9791b89be4909e7c3c-source.min.js', "!function(){var t=document.createElement(\"script\");t.setAttribute(\"src\",\"https://cdn.cookielaw.org/opt-out/otCCPAiab.js\"),t.setAttribute(\"id\",\"privacyCookie\"),t.setAttribute(\"type\",\"text/javascript\"),t.setAttribute(\"charset\",\"UTF-8\"),t.setAttribute(\"ccpa-opt-out-ids\",\"USP\"),t.setAttribute(\"ccpa-opt-out-geo\",\"US\"),t.setAttribute(\"ccpa-opt-out-lspa\",\"false\"),document.body.appendChild(t)}();");s.googleusercontent.com",FACEBOOK_CLIENT_ID:"356180435225530",LINKEDIN_CLIENT_ID:"77z180k7pbxg1j",TWITTER_CLIENT_ID:"EV96Fmj64ExUBZZ0jzLAlsNhr",GOOGLE_PAY_ENV:"TEST",LOG_LEVEL:3,TEST_MODE:!1,SOUTHERN_THING_ALIAS:"southernthing.com",TNR_ALIAS:"newrepublic.com",BAFFLER_ALIAS:"thebaffler.com",BLINK_PAY_URL:"https://blink.net",BLINK_API_URL:"https://api.blink.net",WS_API_URL:"wss://ws.blink.net",PUBLIC_DATA_BASE_URL:"https://blink.net/json",IS_PRODUCTION:!0},v="blinkSDKReady",b="widget",w={auth:"auth",subscribe:"subscribe",giftSubscription:"giftSubscription",payment:"payment",donation:"donation",shop:"shop",custom:"custom",newsletter:"newsletter",dashboard:"dashboard",empty:"empty"},S={cover:"cover",preview:"preview",popup:"popup",popupGate:"popupGate",banner:"banner"},A={top:"top",center:"center",bottom:"bottom"},C="replaceChildren",E="firstChild",x="lastChild",T=[{selector:".blink-container,#blink-container",type:w.payment},{selector:".blink-donation-container,#blink-donation-container",type:w.donation},{selector:".blink-subscription-container,#blink-subscription-container",type:w.subscribe,gateType:S.preview},{selector:".blink-purchase-container,#blink-purchase-container",type:w.payment,gateType:S.preview},{selector:".blink-newsletter-container,#blink-newsletter-container",type:w.newsletter}],I="data-blink-panel-inserted",P="createPanel",O="callback",D=250,k=D+"ms ease",L=375,N=o+"/e/",R="blink-|-",_={loggerLevel:"Logger.loggerLevel",onBoardingBehaviour:"UXManager.onboardingBehaviour",merchantSessionId:"Analytics.sessionId",merchantLocalId:"Analytics.localId",selectedUserJourneys:"UJ-selected",pageVisits:"UJ-visits-",variables:"variables",authToken:"authToken",utm:"utm",referrer:"referrer"},F=["medium","campaign","source","term","content"],M={};function B(e){M[e]=0|performance.now()}function j(){const e=["Android","webOS","iPad","iPhone","iPod","BlackBerry","Windows Phone"];for(let t of e)if(-1!==navigator.userAgent.indexOf(t))return!0;return!1}const W=450,q=650;function U(e){return null==e?[]:Array.isArray(e)?e:[e]}function z(e){if(null!=e&&!1!==e)return e}function H(e){for(;$(e);)e=e();return z(e)}function V(e,t){if(void 0===t&&(t=z),null==e||!1===e)return[];Array.isArray(e)||(e=e[Symbol.iterator]&&!Y(e)?Array.from(e):[e]);let n=[];for(const s of e){if(null==s)continue;const e=Array.isArray(s)?s:t(s);if(null!=e)if(Array.isArray(e)){const s=V(e,t);for(const e of s)n.push(e)}else n.push(e)}let s=n.length===e.length;for(let t=0;s&&t<n.length;t+=1)n[t]!==e[t]&&(s=!1);return s?e:n}function G(e,t){return X(e)?e+t:e}function J(e,t){if(e.length>t){const n=e.substring(0,t)+`...[${e.length} initial chr.]`;n.length<e.length&&(e=n)}return e}function K(e,t){return e.__proto__=t.prototype,e}function $(e){return"function"==typeof e}function X(e){return"number"==typeof e||e instanceof Number}function Y(e){return"string"==typeof e||e instanceof String}function Q(e){return!(!e||"object"!=typeof e||e.constructor&&e.constructor!=Object)}function Z(e,t,n){t.forEach(((s,i)=>{i+1<t.length?(e[s]||(e[s]={}),e=e[s]):e[s]=n}))}function ee(){let e=arguments[0]||{};"object"!=typeof e&&"function"!=typeof e&&(e={});for(let t=1;t<arguments.length;t+=1){let n=arguments[t];if(null!=n)for(let[t,s]of Object.entries(n))if(s&&Q(s)||Array.isArray(s)){let n,i=e[t];n=Array.isArray(s)?i&&Array.isArray(i)?i:[]:i&&Q(i)?i:{},e[t]=ee(n,s)}else e[t]=s}return e}const te=()=>{};function ne(e,t){let{maxIter:n=32,args:s=null,allowUnresolved:i=!1}=void 0===t?{}:t;for(;n>0&&$(e);)e=e(...s),n-=1;return i||0!==n||console.error("Failed to resolve value to a non-function"),e}class CallModifier{wrap(e){throw Error("Implement wrap method")}call(e){return this.wrap(e)()}toFunction(){return e=>this.wrap(e)}}class CallThrottler extends CallModifier{constructor(e){void 0===e&&(e={}),super(),this.lastCallTime=0,this.pendingCall=null,this.pendingCallArgs=[],this.pendingCallExpectedTime=0,this.numCalls=0,this.totalCallDuration=0,Object.assign(this,e)}isThrottleOnAnimationFrame(){return this.throttle===this.constructor.ON_ANIMATION_FRAME}clearPendingCall(){this.pendingCall=null,this.pendingCallArgs=[],this.pendingCallExpectedTime=0}cancel(){this.pendingCall&&this.pendingCall.cancel(),this.clearPendingCall()}flush(){this.pendingCall&&this.pendingCall.flush(),this.clearPendingCall()}cleanup(){this.cancel()}computeExecutionDelay(e){let t=null;return null!=this.throttle&&(t=Math.max(this.lastCallTime+this.throttle-e,0)),null!=this.debounce&&(t=Math.min(null!=t?t:this.debounce,this.debounce)),t}replacePendingCall(e,t,n){if(this.cancel(),this.isThrottleOnAnimationFrame()){const n=requestAnimationFrame(t);return void(e.cancel=()=>cancelAnimationFrame(n))}const s=Date.now();let i=this.computeExecutionDelay(s);if(this.dropThrottled)return 0==i&&t();const o=setTimeout(t,i);e.cancel=()=>clearTimeout(o),this.pendingCall=e,this.pendingCallArgs=n,this.pendingCallExpectedTime=s+i}updatePendingCall(e){if(this.pendingCallArgs=e,!this.isThrottleOnAnimationFrame()){const e=Date.now();this.pendingCallExpectedTime=e+this.computeExecutionDelay(e)}}wrap(e){var t=this;const n=()=>{const t=Date.now();!this.isThrottleOnAnimationFrame()&&t+1<this.pendingCallExpectedTime?this.replacePendingCall(s,n,this.pendingCallArgs):(this.lastCallTime=t,this.clearPendingCall(),e(...this.pendingCallArgs))},s=function(){for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return t.pendingCall&&e===t.pendingCall.originalFunc?t.updatePendingCall(o):t.replacePendingCall(s,n,o)};return s.originalFunc=e,s.cancel=te,s.flush=()=>{s===this.pendingCall&&(this.cancel(),s())},s}}CallThrottler.ON_ANIMATION_FRAME=Symbol(),CallThrottler.AUTOMATIC=Symbol();const se={};function ie(e,t){if(typeof e!=typeof t)return!1;if(null==e||null==t)return e===t;if(!Q(e)&&!Array.isArray(e))return e===t;const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const s of n)if(!ie(e[s],t[s]))return!1;return!0}function oe(e){return function(e){try{return JSON.parse(e)}catch(t){try{return JSON.parse(decodeURIComponent(e))}catch(t){try{return decodeURIComponent(e)}catch(e){return null}}}}(new URLSearchParams(window.location.search).get(e))}function re(){const e=Date.now().toString(16)+parseInt(1e18*Math.random()).toString(16)+parseInt(1e18*Math.random()).toString(16);return[e.substr(0,8),e.substr(8,4),`4${e.substr(12,3)}`,`8${e.substr(15,3)}`,e.substr(18,12)].join("-")}function ae(){var e;return null!=(e=se.iFrameState)&&e.screen&&j()?se.iFrameState.screen.width:window.screen&&j()?window.screen.width:window.innerWidth}function le(){var e;return null!=(e=se.iFrameState)&&null!=(e=e.screen)&&e.isEmulatorScreen?se.iFrameState.screen.width<=W:window.screen&&j()?ae()<=W:ae()<=q}class DispatcherHandle{constructor(e,t){this.dispatcher=e,this.callback=t}remove(){this.dispatcher?(this.dispatcher.removeListener(this.callback),this.dispatcher=void 0,this.callback=void 0):console.warn("Removing a dispatcher twice")}cleanup(){this.remove()}}class Dispatcher{constructor(e){void 0===e&&(e={}),this.options=e,this.listeners=[]}callbackExists(e){for(let t=0;t<this.listeners.length;t+=1)if(this.listeners[t]===e)return!0;return!1}addListener(e){if("function"==typeof e){if(!this.callbackExists(e))return this.listeners.push(e),new DispatcherHandle(this,e);console.error("Can't re-register for the same callback: ",this," ",e)}else console.error("The listener needs to be a function: ",e)}addListenerOnce(e){let t=this.addListener((function(){e(...arguments),t.remove()}));return t}async awaitOnce(){return new Promise((e=>this.addListenerOnce((function(){return e(...arguments)}))))}removeListener(e){for(let t=0;t<this.listeners.length;t+=1)if(this.listeners[t]===e)return this.listeners.splice(t,1)[0]}removeAllListeners(){this.listeners=[]}dispatch(e){for(let e=0;e<this.listeners.length;){let t=this.listeners[e];t(...arguments),t===this.listeners[e]&&e++}}}const de=Symbol("Dispatchers");class Dispatchable{get dispatchers(){return this[de]||(this[de]=new Map)}getDispatcher(e,t){void 0===t&&(t=!0);let n=this.dispatchers.get(e);return!n&&t&&(n=new Dispatcher,this.dispatchers.set(e,n)),n}dispatch(e,t){let n=this.getDispatcher(e,!1);if(n)if(arguments.length<=2)n.dispatch(t);else{let e=Array.prototype.slice.call(arguments,1);n.dispatch(...e)}}addListenerGeneric(e,t,n){return Array.isArray(t)?new CleanupJobs(t.map((t=>this[e](t,n)))):this.getDispatcher(t)[e](n)}addListener(e,t){return this.addListenerGeneric("addListener",e,t)}addListenerOnce(e,t){return this.addListenerGeneric("addListenerOnce",e,t)}removeListener(e,t){const n=this.getDispatcher(e,!1);null==n||n.removeListener(t)}removeAllListeners(e){const t=this.getDispatcher(e,!1);null==t||t.removeAllListeners()}cleanup(){this.runCleanupJobs(),delete this[de]}addCleanupJob(e){return this.hasOwnProperty("_cleanupJobs")||(this._cleanupJobs=new CleanupJobs),this._cleanupJobs.add(e),e}runCleanupJobs(){this._cleanupJobs&&this._cleanupJobs.cleanup()}detachListener(e){this._cleanupJobs?this._cleanupJobs.remove(e):e.remove()}attachTimeout(e,t){const n=setTimeout(e,t);return this.addCleanupJob((()=>clearTimeout(n))),n}attachInterval(e,t){const n=setInterval(e,t);return this.addCleanupJob((()=>clearInterval(n))),n}attachAnimationFrame(e){const t=requestAnimationFrame(e);return this.addCleanupJob((()=>cancelAnimationFrame(t))),t}addChangeListener(e){return this.addListener("change",e)}dispatchChange(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.dispatch("change",...t,this)}}function he(e){let t="add"+e,n="remove"+e;return function(e){let s=Array.prototype.slice.call(arguments,1),i=e[t](...s);return i||(i=()=>{e[n](...s)}),this.addCleanupJob(i),i}}Dispatchable.prototype.attachListener=he("Listener"),Dispatchable.prototype.attachEventListener=he("EventListener"),Dispatchable.prototype.attachCreateListener=he("CreateListener"),Dispatchable.prototype.attachDeleteListener=he("DeleteListener"),Dispatchable.prototype.attachChangeListener=he("ChangeListener"),Dispatchable.prototype.attachListenerOnce=he("ListenerOnce"),Dispatcher.Global=new Dispatchable;class CleanupJobs{constructor(e){void 0===e&&(e=[]),this.jobs=e}add(e){this.jobs.push(e)}cleanup(){for(let e of this.jobs)"function"==typeof e.cleanup?e.cleanup():"function"==typeof e.remove?e.remove():e();this.jobs=[]}remove(e){if(e){const t=this.jobs.indexOf(e);t>=0&&this.jobs.splice(t,1),e.remove()}else this.cleanup()}}class OnceDispatcher extends Dispatcher{dispatch(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.dispatchArgs=t,super.dispatch(...t)}haveDispatched(){return this.dispatchArgs}addListener(e){if(this.haveDispatched())return e(...this.dispatchArgs),new CleanupJobs;const t=super.addListener((function(){e(...arguments),t.remove()}));return t}addListenerOnce(e){return this.addListener(e)}}let ce=null,ue=null;const pe=new OnceDispatcher;function me(e,t){void 0===t&&(t="merchantId");for(const n of Object.keys(ue&&ue.state||{}))if(n.toLowerCase()===e.toLowerCase()){const e=ue.state[n]||[];return null!=t?e.filter((e=>null==e[t]||e[t]===ce)):e}return[]}function ge(e){return pe.addListenerOnce(e)}function fe(){return ce}function ye(){return me("Merchant","id")[0]||null}function ve(){var e;return"active"===(null==(e=ye())?void 0:e.sdkStatus)}function be(e){return me("MerchantUserJourney").find((t=>t.id==e||t.alias==e))}function we(){return me("MerchantPanel")}function Se(e){return we().find((t=>t.id==e||t.alias==e))}class MerchantStorage{constructor(e){this.getStorage=e}getItem(e){try{let t=this.getStorage().getItem(R+e);return JSON.parse(t)}catch(e){return null}}setItem(e,t){try{t=JSON.stringify(t),this.getStorage().setItem(R+e,t)}catch(e){}}removeItem(e){try{this.getStorage().removeItem(R+e)}catch(e){}}}const Ae=new MerchantStorage((()=>window.localStorage)),Ce=new MerchantStorage((()=>window.sessionStorage)),Ee={items:new Map,getItem:e=>Ee.items.get(e),setItem:(e,t)=>Ee.items.set(e,t),removeItem:e=>Ee.items.delete(e)},xe=new MerchantStorage((()=>Ee)),Te={PERMANENT:"permanent",TAB:"tab",MEMORY:"memory"};function Ie(e){return e===Te.PERMANENT?Ae:e===Te.TAB?Ce:xe}let Pe=null,Oe=null;function De(){if(null==Pe){const t=Ce.getItem(_.utm)||{};Pe={};for(const n of F){var e;const s=null!=(e=oe(`utm_${n}`))?e:t[n];null!=s&&(Pe[n]=s)}Object.keys(Pe).length>0&&Ce.setItem(_.utm,Pe)}return Pe}function ke(){return null==Oe&&(Oe=Ce.getItem(_.referrer)||document.referrer||null,Oe&&Ce.setItem(_.referrer,Oe)),Oe}const Le={},Ne={utm:De()},Re=new class MerchantVariableModule extends Dispatcher{constructor(){super(...arguments),this.memory=xe.getItem(_.variables)||{},this.tab=Ce.getItem(_.variables)||{},this.permanent=Ae.getItem(_.variables)||{}}add(e){Object.assign(Ne,e)}has(e){return this.memory.hasOwnProperty(e)||this.tab.hasOwnProperty(e)||this.permanent.hasOwnProperty(e)||Ne.hasOwnProperty(e)}get(e){return this.memory.hasOwnProperty(e)?this.memory[e]:this.tab.hasOwnProperty(e)?this.tab[e]:this.permanent.hasOwnProperty(e)?this.permanent[e]:Ne[e]}set(e,t,n){void 0===n&&(n=Te.MEMORY),n===Te.PERMANENT?this.permanent[e]=t:(delete this.permanent[e],n===Te.TAB?this.tab[e]=t:(delete this.tab[e],this.memory[e]=t)),this.store()}delete(e){delete this.memory[e],delete this.tab[e],delete this.permanent[e],this.store()}all(){return e({},Ne,this.permanent,this.tab,this.memory)}store(){Ce.setItem(_.variables,this.tab),Ae.setItem(_.variables,this.permanent),xe.setItem(_.variables,this.memory),this.dispatch()}};function _e(e,t){let n=null;return()=>{null==n&&(n=setTimeout((()=>{e(),n=null}),t))}}function Fe(e,t){let n=null;return()=>{null!=n&&clearTimeout(n),n=setTimeout((()=>{e(),n=null}),t)}}function Me(){return ae()<L?L/ae():1}const Be=[],je=Fe((function(){console.groupCollapsed("[BlinkSDK] Errors while running journeys");for(const{exception:e,key:t,code:n}of Be)console.group(t?"in function "+t:"in anonymous expression:"),n&&console.log(n),console.error(e),console.groupEnd();console.groupEnd(),Be.splice(0,Be.length)}),10);function We(e,t,n){Be.push({exception:e,key:t,code:n}),je()}const qe=new class MerchantFunctionModule{constructor(){this.functions={},this.exceptionHandler=We}get(e){return this.all()[e]}add(e){Object.assign(this.functions,e)}delete(e){delete this.functions[e]}all(){return e({},Le,this.functions)}call(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];Array.isArray(e)&&(n=[...e,...n],[e,...n]=n);let i=this.get(e);if(null==i){const t=Y(e)?e.split("."):[e];let n=window;for(const e of t){if(!n||!n[e]){n=null;break}n=n[e]}i=n}let o=null;if(null==i)return this.handleException(new ReferenceError(`Function not found for key '${e}'.`),e),[!1,null];try{o=i(...n)}catch(t){return this.handleException(t,e),[!1,null]}return[!0,o]}handleException(e,t,n){setTimeout((()=>this.exceptionHandler(e,t,n)),0)}addAnonymous(e){const t="f_"+re().replace(/-/g,"_");return this.add({[t]:e}),t}};class ExprEvaluator{constructor(t,n){void 0===n&&(n=!0),n&&(t=e({},Re.all(),qe.all(),t)),this.context=t}eval(e){return this.rawEvaluator||(this.rawEvaluator=function(e){const t=function(e,t){const n={},s=(e,t)=>e.length-t.length,i=Object.keys(e).sort(s);for(const e of i){const t=e.split(".");Z(n,t,`Blink$Variables["${e}"]`)}return Object.keys(n).sort(s).map((e=>`${e} = ${Ue(n[e])}`))}(e);let n="'use strict';\n";return t.length>0&&(n+=`var ${t.join(",\n  ")};\n`),t=>{const s=n+"return "+t,i=new Function("Blink$Variables",s);try{return i(e)}catch(e){return qe.handleException(e,null,s),null}}}(this.context)),this.rawEvaluator(e)}withExtraContext(t){return new ExprEvaluator(e({},this.context,t),!1)}processPanelNode(t){const n=t.tag.toLowerCase();if("if"===n){const e=this.eval(t.expr)?t.then||t.children:t.else;return this.evaluateNode(e)}if("for"===n){const{entriesExpr:n,indexName:i,varName:o}=function(t){let n="index",s="entry";delete(t=e({},t)).tag,delete t.children,t.indexName&&(n=t.indexName,delete t.indexName);let i=t.entries;if(!t.entries){const e=Object.keys(t);if(1!==e.length)throw Error("Ambiguous For element. The field 'entries' is required, otherwise there should be only one field");s=e[0],i=t[s]}return{entriesExpr:i,indexName:n,varName:s}}(t),r=this.eval(n);let a=[];for(const[e,n]of r.entries()){const r=this.withExtraContext({[o]:n,[i]:e});for(const e of t.children){const t=r.evaluateNode(Y(s=e)?String(s):ee({},s));a.push(t)}}return a}var s;return t}evaluateNode(e){if(Y(e))return e.startsWith("expr:")?this.eval(e.substr(5)):e.replace(/{{([^{}]*)}}/g,((e,t)=>{var n;return String(null!=(n=this.eval(t))?n:"")}));if(Array.isArray(e))return e.map((e=>this.evaluateNode(e)));if(!Q(e))return e;if(Y(e.tag)){const t=this.processPanelNode(e);if(t!==e)return t;e=t}const t={};for(const n of Object.keys(e))t[n]=this.evaluateNode(e[n]);return t}}function Ue(e){return Y(e)?e:"{"+Object.keys(e).map((t=>`"${t}": ${Ue(e[t])}`)).join(",")+"}"}function ze(e,t){return new ExprEvaluator(t).evaluateNode(e)}const He={parentPanel:null,type:w.custom,subscriptionOffer:null,donationOffer:null,newsletter:null,products:null,skipCTA:!1,editRecurring:!1,dashboardTabs:null,authSocialProviders:["facebook","google","twitter","linkedin"],paymentDetails:null,logoSrc:null,logoAlt:"",logoStyle:{},text:null,textStyle:{},title:null,buttonText:"Continue",actionButtonStyle:{},fonts:[],theme:{},messages:{},metadata:{},content:null,context:null,frame:"logo",gateType:null,customStyle:{},basePanelStyle:{},cancelButtonCustomStyle:{},previewHeight:200,previewFadeOut:!0,previewFadeOutHeight:100,previewFadeOutToColor:"white",coverColor:"rgba(255, 255, 255, 0.9)",coverPanelPosition:A.center,mountType:x,get disableUserClose(){return this.inlineFlow},scrimClickCollapse:!0,inlineFlow:!1,flowSuccessType:null,selectedDiscountCode:null,selectedSubscriptionOfferId:null,onSuccessCrossSell:null,hideDiscountCodeInput:!1,onMount:null,onFlowCheckpoint:null,onFlowSuccess:null,onFlowFinish:null},Ve={[w.subscribe]:{content:'<div style="padding: 20px 30px;text-align: center;">\n            <Text>You need to be a subscriber to access this content.</Text>\n            <SubscribeButton label="Subscribe"></SubscribeButton>\n            <LoginFooter label="Already a subscriber?"></LoginFooter>\n            <PoweredByBlink></PoweredByBlink>\n        </div>'},[w.giftSubscription]:{content:'<div style="padding: 20px 30px;text-align: center;">\n        <Text>Gift a subscription to someone you love!</Text>\n        <GiftSubscriptionButton label="Gift a subscription"></GiftSubscriptionButton>\n        <PoweredByBlink></PoweredByBlink>\n    </div>'},[w.donation]:{content:'<div style="padding: 20px 30px;text-align: center;">\n            <Text><strong>{{publisher_name}}</strong> relies on support from readers like yourself. Even a small amount would help us improve our coverage.</Text>\n            <DonateButton label="Donate"></DonateButton>\n            <LoginFooter label="Already a donor?"></LoginFooter>\n            <PoweredByBlink></PoweredByBlink>\n        </div>'},[w.payment]:{content:'<div style="padding: 20px 30px;text-align: center;">\n        <Text>{{publisher_name}} uses Blink to allow access to individual articles.</Text>\n        <PurchaseButton></PurchaseButton>\n        <If expr="!blinkSDK.isAuthenticated()">\n            <Text>Get <b>$2</b> credit when you create an account.</Text>            \n        </If>\n        <LoginFooter label="Already purchased?"></LoginFooter>\n        <PoweredByBlink></PoweredByBlink>\n    </div>'},[w.newsletter]:{content:'<div style="padding: 20px 30px;text-align: center;">\n        <Text>Subscribe to our newsletter to keep yourself updated with our latest content.</Text>\n        <NewsletterButton></NewsletterButton>\n        <PoweredByBlink></PoweredByBlink>\n    </div>'}};function Ge(t,n){n&&Object.assign(t,n,{fonts:[...t.fonts||[],...n.fonts||[]],theme:e({},t.theme,n.theme),messages:e({},t.messages,n.messages),metadata:e({},t.metadata,n.metadata),context:e({},t.context,n.context)})}function Je(e,t){return e.find((e=>e.id==t||e.alias==t))}function Ke(e){for(const t of Object.keys(e))t.startsWith("analytics-")&&(e["data-"+t]=e[t]);return e}function $e(t){Y(t.content)?t.contentAST=function(t,n){void 0===n&&(n=e=>e);const s=(new DOMParser).parseFromString(`<body>${t}</body>`,"text/xml"),i=t=>{if(t.nodeType===Node.TEXT_NODE){const e=t.wholeText;let n=e.trim();return n?(n[0]!==e[0]&&(n=" "+n),n[n.length-1]!==e[e.length-1]&&(n+=" "),n):null}if(t.nodeType!==Node.ELEMENT_NODE)return null;let s={};return t.getAttributeNames().forEach((e=>{s[e]=t.getAttribute(e)})),n(e({tag:t.tagName,children:[...t.childNodes].map(i).filter(Boolean)},s))};return[...s.childNodes[0].childNodes].map(i).filter(Boolean)}(t.content,Ke):t.contentAST=ee({},t.content),t.contentAST=ze(t.contentAST,t.context)}function Xe(e,t,n){void 0===t&&(t=we()),void 0===n&&(n=Re.all()),e=function(e,t,n){var s;void 0===n&&(n={});const i={};Ge(i,He);const o=ye();o&&Ge(i,{context:{publisher_name:o.name,merchant_name:o.name}});const r=[];let a=e.panel;for(;null!=a;){const e=Je(t,a);if(null==e)break;r.push(e),a=e.options.parentPanel}0===r.length&&!e.type&&Object.values(w).indexOf(e.panel)>=0&&(e.type=e.panel,delete e.panel);const l=e.type||(null==(s=r.find((e=>{var t;return null==e||null==(t=e.options)?void 0:t.type})))||null==(s=s.options)?void 0:s.type),d=Je(t,l);l!==w.custom&&d&&r.push(d);const h=Ve[l];h&&r.push({options:h});const c=Je(t,"base");c&&r.push(c);const u=r[0];Ge(i,{metadata:{panelId:null==u?void 0:u.id,panelAlias:(null==u?void 0:u.alias)||i.type}});for(const e of r.reverse())Ge(i,e.options);return Ge(i,{context:n}),Ge(i,e),i.mountType||(i.mountType=i.gateType?x:C),window.isInPreviewMode&&(i.isInPreviewMode=!0),i}(e,t,n),$e(e);for(const t of Object.keys(e))"context"!==t&&"parentPanel"!==t&&"content"!==t&&"contentAST"!==t&&(e[t]=ze(e[t],e.context));return e}function Ye(e,t){if(Array.isArray(e)){for(const n of e)Ye(n,t);return}const n=Se(e);n&&(n.options=n.options||{},Ge(n.options,t))}const Qe="blinkPay-",Ze="requestAmazonPay",et="routeChange",tt="requestUpdatePanelSize",nt="destroyPanel",st="updateAnalyticsDataFromSDK",it="amazonPayEvent";function ot(e){return Qe+e}function rt(e){if(!e)return;let t="",n="";for(;e&&e!==document.body;e=e.parentNode){t=e.className.split(" ").map((e=>e?"."+CSS.escape(e):"")).join("")+(e.id?"#"+CSS.escape(e.id):"")+n+t;let s=e.tagName.toLowerCase();if(1===document.querySelectorAll(s+t).length)return s+t;n=e.parentNode?`>:nth-child(${[...e.parentNode.children].indexOf(e)+1})`:""}return e?e.tagName.toLowerCase()+t:t}const at={key:"pageView",flush:!0},lt={key:"flowStart",flush:!0},dt={key:"custom",flush:!0};let ht=null;class AnalyticsClient extends Dispatchable{constructor(e){super(),this.eventQueue=[],this.environment={},this.identity={},this.preprocessors=[],this.origin=e,this.submitEnqueuedEventsDebounced=Fe((()=>this.submitEnqueuedEvents()),100),ht=this}addNodeAnalyticsData(e,t){if(e.dataset)for(const[s,i]of Object.entries(e.dataset))if(s.startsWith("analytics")&&"analytics"!==s){const e=(n=s.slice(9))&&n.charAt(0).toLowerCase()+n.slice(1);t.hasOwnProperty(e)||(t[e]=i)}var n;const s=e.parentElement;s&&this.addNodeAnalyticsData(s,t)}addEventNodeDataToPayload(t,n){var s;let i=t.currentTarget||t.target;if(i===document&&(i=t.target||t.currentTarget),null!=(s=i)&&s.tagName){const s={};this.addNodeAnalyticsData(i,s),n.domEventType=t.type,n.domEventTarget=e({selector:rt(i),text:J(i.innerText,200)},s)}}submitEnqueuedEvents(e){if(0===this.eventQueue.length)return;const t=(e=>JSON.stringify({method:"xhr",origin:this.origin,identity:this.identity,events:this.eventQueue}))();this.eventQueue=[];const n=new XMLHttpRequest;n.open("POST",N,!0),n.send(t)}enqueueEvent(t,n){void 0===n&&(n={});const s=self.event;s&&this.addEventNodeDataToPayload(s,n);let i={type:t.key,timestamp:+Date.now()/1e3,localSessionTime:performance.now()/1e3,payload:e({},this.environment,n)};for(const e of this.preprocessors)i=e(i)||i;this.dispatch("event",e({origin:this.origin,identity:e({},this.identity)},i)),this.eventQueue.push(i),this.eventQueue.length>=16?this.submitEnqueuedEvents():t.flush&&(t.now?this.submitEnqueuedEvents(1):this.submitEnqueuedEventsDebounced())}updateEnvironment(e){Object.assign(this.environment,e)}updateIdentity(e){Object.assign(this.identity,e)}}function ct(e,t){void 0===t&&(t={});try{var n;null==(n=ht)||n.enqueueEvent(e,t)}catch(e){console.error("Blink analytics caught an error:",e)}}const ut=new class SDKMessagingChannelClass extends Dispatchable{constructor(){super(),this.attachEventListener(window,"message",(t=>{if(t.origin!==i||"object"!=typeof t.data)return;const{data:n}=t,{appType:s,type:o}=n;if(!("string"==typeof o||o instanceof String)||!o.startsWith(Qe))return;const r=[...document.getElementsByTagName("iframe")].find((e=>e.contentWindow===t.source)),a=e({},n,{type:n.type.substring(Qe.length),origin:t.origin});this.dispatch(a.type,a,r,s)}))}},pt=new OnceDispatcher;function mt(e,t){let n=[];const s=()=>{e.getAttribute("htmlLoaded")&&e.contentWindow&&(n.forEach((t=>e.contentWindow.postMessage(t,"*"))),n=[])};if(!e.getAttribute("htmlLoaded")){const n=ut.addListener("iFrameHtmlLoaded",((i,o)=>{let{version:r}=i;o===e&&(e.setAttribute("htmlLoaded",!0),t===b&&pt.dispatch(r),s(),n.remove())}))}return function(e,i){void 0===i&&(i={}),i.type=ot(e),i.appType=t,n.push(i),s()}}class NodeElement extends Dispatchable{constructor(t,i){void 0===t&&(t={}),void 0===i&&(i=null),super(),this.options=e({},this.getDefaultOptions(),t),this.node=i||document.createElement(this.options.nodeType),n&&!s||this.options.testId&&this.node.setAttribute("test-id",this.options.testId)}getDefaultOptions(){return{nodeType:"div",style:{}}}updateOptions(e){Object.assign(this.options,e),this.refreshStyle(),n&&!s||this.node&&e.testId&&this.node.setAttribute("test-id",e.testId)}refreshStyle(){this.setStyle(this.options.style)}mount(e,t){var n;void 0===t&&(t=null),null==t?e.appendChild(this.node):e.insertBefore(this.node,null==(n=e.children)?void 0:n[t]),this.refreshStyle(),this.onMount()}setStyle(e,t){this.node&&("object"==typeof e?Object.assign(this.node.style,e):this.node.style[e]=t)}destroyNode(){var e;this.cleanup(),null==(e=this.node)||e.remove(),delete this.node}onMount(){this.attachEventListener(window,"resize",_e((()=>this.refreshStyle()),100))}}const gt=new class SDKState extends Dispatchable{constructor(){super(...arguments),this.preferredEmail=null,this.allowUserToCoverFees=!1,this.hideWallet=!1}update(e){Object.assign(this,e),this.dispatchChange(e)}},ft=new Set,yt=new Dispatcher;class IFrameElement extends NodeElement{constructor(e,t){void 0===e&&(e={}),void 0===t&&(t=null),super(e,t),this.lastSentIframeParams=null,this.node.src||(this.node.src=`${i}/iframe.html`,this.node.sandbox="allow-popups allow-scripts allow-same-origin allow-popups-to-escape-sandbox  allow-top-navigation-by-user-activation allow-forms",this.node.frameBorder=0),this.sendMessage=mt(this.node,this.appType)}get appType(){return null}getDefaultOptions(){return e({},super.getDefaultOptions(),{nodeType:"iframe",testId:"blinkIframe"})}updateOptions(e){super.updateOptions(e),this.resendIFrameParams()}getIFrameParams(){return e({},this.options,{forceHideWallet:gt.hideWallet,preferredEmail:gt.preferredEmail,allowUserToCoverFees:gt.allowUserToCoverFees,screen:{width:Me()*ae(),height:Me()*document.documentElement.clientHeight,isEmulatorScreen:!0},merchantPageUrl:window.location.href||"",merchantPageReferrerUrl:ke()})}resendIFrameParams(){if(!this.node)return void(this.lastSentIframeParams=null);const e=this.getIFrameParams();ie(e,this.lastSentIframeParams)||(this.lastSentIframeParams=e,this.sendMessage("updateAppState",{iframeParams:e}))}addSdkListener(e,t){this.attachListener(ut,e,((e,n,s)=>{n===this.node&&s===this.appType&&t(e)}))}getIFrameInitData(){return{merchantId:fe(),publicData:ue,iframeParams:this.getIFrameParams(),merchantToken:Ae.getItem(_.authToken)||Ce.getItem(_.authToken),appType:this.appType}}initialize(){this.addCleanupJob(ge((()=>{ve()?(this.sendMessage("createIframeApp",{iFrameInitData:this.getIFrameInitData()}),ft.add(this),yt.dispatch(this),this.addCleanupJob((()=>ft.delete(this)))):this.destroyNode()})))}onMount(){super.onMount(),this.initialize(),this.attachChangeListener(gt,(()=>this.resendIFrameParams())),this.attachEventListener(window,"resize",_e((()=>this.resendIFrameParams()),20)),n&&!s||this.addSdkListener("transitionChange",(e=>{let{transitioning:t}=e;(this.constructor.totalTransitioning||t)&&(this.constructor.totalTransitioning+=t?1:-1,this.node.setAttribute("transitioning",this.constructor.totalTransitioning>0))}))}}function vt(e,t){return void 0===t&&(t=0),(null==e?void 0:e.activeUntil)&&Date.now()-new Date(e.activeUntil).getTime()<t}IFrameElement.totalTransitioning=0;const bt={userPreferencesChange:new Dispatcher,authenticationChange:new Dispatcher,subscriptionChange:new Dispatcher,userData:{userId:null,alwaysShowBalance:null,showOnboarding:null,subscription:null,activeRecurringDonation:null,latestOneTimeDonation:null,activeNewsletters:[],newsletterIds:[],metadata:{}},init(){ut.addListener("updateSdkUserData",(t=>{let{userData:n}=t;const s=e({},this.userData);Object.assign(this.userData,n),s.userId!==n.userId&&this.authenticationChange.dispatch(),ie(s.subscription,n.subscription)||this.subscriptionChange.dispatch(n.subscription),ie(s,n)||this.userPreferencesChange.dispatch()})),ut.addListener("setMerchantToken",(e=>{let{token:t}=e;return this.setMerchantToken(t)}))},setMerchantToken(e){e?(Ae.setItem(_.authToken,e),Ce.setItem(_.authToken,e)):(Ae.removeItem(_.authToken),Ce.removeItem(_.authToken)),ft.forEach((t=>{t.sendMessage("updateMerchantToken",{token:e})}))},isAuthenticated(){return null!=this.userData.userId},isRecurringDonor(){return vt(this.userData.activeRecurringDonation)},isDonor(){return vt((e=this.userData).activeRecurringDonation)||vt(e.latestOneTimeDonation,7776e6);var e},isSubscriber(){return vt(this.userData.subscription)},isNewsletterSubscriber(e){return e=e.newsletterId||e,this.userData.newsletterIds.includes(e)},exposeMerchantFunctions(){var e=this;const t={};for(const n in this)n.startsWith("is")&&(t[n]=function(){return!!e[n](...arguments)});return t}},wt={INDEX_COLLAPSED:"empty",INDEX_EXPANDED:"widget-index-expanded",ADD_FUNDS:"widget-add-funds",AUTOPAY:"widget-autopay",ADD_CARD:"widget-add-card",CHOOSE_CARD:"widget-choose-card",INSUFFICIENT_FUNDS:"widget-insufficient-funds"},St={gate:{pointerEvents:"initial",height:"100%",display:"flex"}};class GateElement extends NodeElement{constructor(e,t){super(e),this.styleSheet=St,this.panel=t}refreshStyle(){var e;super.refreshStyle(),this.setStyle(this.styleSheet.gate),Object.assign(this.parentNode.style,this.computeParentStyle()),this.panel.updateOptions({style:this.getPanelStyle()}),this.setStyle(null!=(e=this.options.customStyle)?e:{})}getPanelStyle(){return{maxWidth:"100%",minWidth:"100%",border:0,height:0}}computeParentStyle(){return{}}mount(e){this.initialParentStyle={};for(const t of e.style)this.initialParentStyle[t]=e.style[t];this.parentNode=e,this.options.mountType===C?(e.innerHTML="",super.mount(e,0)):this.options.mountType===E?super.mount(e,0):this.options.mountType===x&&super.mount(e,e.childNodes.length),this.panel.mount(this.node)}destroyNode(){this.panel.destroyNode();const e={};for(const t of Object.keys(this.computeParentStyle()))e[t]="";Object.assign(this.parentNode.style,e,this.initialParentStyle),super.destroyNode()}getInteractiveHandlers(){return{remove:()=>{this.node?this.destroyNode():console.error("Panel has already been destroyed.")},updatePanel:e=>{this.panel?this.panel.updateOptions(e):console.error("Panel has already been destroyed.")}}}onMount(){super.onMount(),this.panel.sizeChange.addListener((()=>this.refreshStyle())),this.panel.addSdkListener(nt,(()=>{this.destroyNode()})),this.attachEventListener(document,"visibilitychange",(()=>{"visible"===document.visibilityState&&this.refreshStyle()}))}}const At={gate:e({},St.gate,{top:0,left:0,width:"100%",height:"100%",position:"absolute"}),panelBasicStyle:{position:"absolute"},panelStyle:{[A.top]:{top:0,bottom:"auto"},[A.center]:{margin:"auto",top:0,bottom:0},[A.bottom]:{top:"auto",bottom:0}}},Ct={gate:e({},St.gate,{display:"flex",flexDirection:"column",position:"absolute",boxSizing:"border-box",width:"100%",top:0,left:0})},Et={close:{background:"linear-gradient(60deg, #085B68, #064953)",width:"52px",height:"52px",borderRadius:"100%",position:"absolute",zIndex:5,overflow:"hidden",transition:k,outline:0,cursor:"pointer",border:"none","-webkit-user-select":"none",userSelect:"none",boxShadow:"none",textShadow:"none"},collapsed:{opacity:0,transform:"scale(0)"},expanded:{opacity:1,transform:"scale(1)"}};class WidgetClose extends NodeElement{constructor(){super(...arguments),this.pointerEventsTimeout=null,this.node.innerHTML='<svg width="18px" style="margin:auto" version="1.1" viewBox="0 0 16 16"><g fill="none" fill-rule="evenodd"><g transform="translate(-1221 -791)" fill="#fff" fill-rule="nonzero"><g transform="translate(896 395)"><g transform="translate(306 377)"><g transform="translate(14.5 14.5)"><polygon points="19.792 6.6771 18.323 5.2083 12.5 11.031 6.6771 5.2083 5.2083 6.6771 11.031 12.5 5.2083 18.323 6.6771 19.792 12.5 13.969 18.323 19.792 19.792 18.323 13.969 12.5"/></g></g></g></g></g></svg>'}getDefaultOptions(){return e({},super.getDefaultOptions(),{testId:"blinkWidgetCloseButton",expanded:!1,positionBottom:0,positionRight:0,activePanel:!1,visible:!1})}refreshStyle(){super.refreshStyle(),this.setStyle(Et.close);const e=this.options.positionBottom+680+72;this.setStyle({display:le()||e>document.documentElement.clientHeight?"none":"flex",bottom:this.options.positionBottom+"px",right:this.options.positionRight+"px"}),clearTimeout(this.pointerEventsTimeout),this.options.expanded&&!this.options.activePanel&&this.options.visible?(this.setStyle(Et.expanded),this.pointerEventsTimeout=this.attachTimeout((()=>{this.setStyle("pointerEvents","all")}),D)):(this.setStyle(Et.collapsed),this.setStyle("pointerEvents","none"),this.node.blur())}}const xt={background:"none",height:"52px",borderRadius:"40px",position:"absolute",zIndex:3,display:"flex",outline:0,cursor:"pointer",border:"none","-webkit-user-select":"none","-webkit-tap-highlight-color":"transparent",userSelect:"none",boxShadow:"none",textShadow:"none"};class WidgetButton extends NodeElement{constructor(){super(...arguments),this.pointerEventsTimeout=null}getDefaultOptions(){return e({},super.getDefaultOptions(),{testId:"blinkWidgetButton",expanded:!1,positionBottom:0,positionRight:0,activePanel:!1,visible:!1})}refreshStyle(){super.refreshStyle(),this.setStyle(e({},xt,{width:(this.options.showBalance?114:52)+"px",bottom:this.options.positionBottom+"px",right:this.options.positionRight+"px"})),clearTimeout(this.pointerEventsTimeout),this.options.expanded||this.options.activePanel||!this.options.visible?(this.setStyle("pointerEvents","none"),this.node.blur()):this.pointerEventsTimeout=this.attachTimeout((()=>{this.setStyle("pointerEvents","all")}),D)}}const Tt={widget:{border:"none",zIndex:2,overflow:"hidden",alignSelf:"flex-end",position:"absolute",height:"100%",width:"100%",bottom:0,transition:D+"ms ease"},skipTransition:{transition:"none"},expandedMobile:{height:"100%",left:0,right:0,margin:"0 auto"},expandedDesktop:{left:"",right:"",margin:""},collapsed:{transform:"",transformOrigin:"",left:"",pointerEvents:"none"}};class Widget extends IFrameElement{constructor(){super(...arguments),this.pointerEventsTimeout=null,this.visibilityTimeout=null,this.skipTransition=!1}get appType(){return b}getDefaultOptions(){return e({},super.getDefaultOptions(),{positionBottom:0,route:wt.INDEX_COLLAPSED,expanded:!1,visible:!1,activePanel:!1})}updateOptions(e){var t,i;(null!=e.positionBottom&&e.positionBottom!==this.options.positionBottom&&(this.skipTransition=!0),super.updateOptions(e),!n||s)&&(e.route&&(null==(t=this.node)||t.setAttribute("route",e.route)),!1===e.activePanel&&(null==(i=this.node)||i.setAttribute("panel-type",w.empty)),this.attachTimeout((()=>{var e;null==(e=this.node)||e.setAttribute("expanded",this.options.expanded||this.options.activePanel)}),D))}refreshStyle(){super.refreshStyle(),this.setStyle(Tt.widget),this.skipTransition&&(this.setStyle(Tt.skipTransition),this.skipTransition=!1),clearTimeout(this.pointerEventsTimeout),clearTimeout(this.visibilityTimeout),this.options.activePanel||this.options.visible&&this.options.expanded?(le()?this.setStyle(Tt.expandedMobile):this.setStyle(Tt.expandedDesktop),this.setStyle("visibility","visible"),this.pointerEventsTimeout=this.attachTimeout((()=>{this.setStyle("pointerEvents","all")}),D)):(this.setStyle(Tt.collapsed),this.visibilityTimeout=this.attachTimeout((()=>{this.setStyle("visibility",gt.hideWallet?"hidden":"visible")}),D))}onMount(){super.onMount();const e=_e((()=>{this.refreshStyle(),this.sendMessage("repositionWidget")}),100);this.attachEventListener(window,"resize",e),this.attachEventListener(window,"orientationchange",e)}}let It=!1;const Pt={position:"fixed",pointerEvents:"none",transition:"opacity ease .3s",display:"flex",flexDirection:"column",top:0,left:0,opacity:1,caretColor:"transparent",outline:"none",cursor:"default",zIndex:9999999,width:"100%",overflow:"initial",visibility:"visible"};class WidgetContainer extends NodeElement{getDefaultOptions(){return e({},super.getDefaultOptions(),{desktopBottomOffset:0,mobileBottomOffset:0,visible:!1,showBalance:!1,expanded:!1,activePanel:!1})}constructor(){super(...arguments),this.widget=new Widget,this.widgetClose=new WidgetClose,this.widgetButton=new WidgetButton,this.node.classList.add("blink-sdk-widget-container")}getOffset(){return{positionBottom:24+(le()?this.options.mobileBottomOffset:this.options.desktopBottomOffset),positionRight:(le()?10:24)+(this.options.extraRightOffset||0)}}mountOnBody(){const e=()=>{document.body?(this.mount(document.body),this.widget.mount(this.node),this.widgetClose.mount(this.node),this.widgetButton.mount(this.node),ge((()=>{ve()||this.destroyNode()}))):requestAnimationFrame(e)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}updateOptions(e){super.updateOptions(e);const{expanded:t,showBalance:n,visible:s,activePanel:i}=this.options;this.widget.updateOptions({expanded:t,activePanel:i,visible:s}),this.widgetClose.updateOptions({expanded:t,activePanel:i,visible:s&&bt.isAuthenticated()}),this.widgetButton.updateOptions({expanded:t,showBalance:n,activePanel:i,visible:s&&bt.isAuthenticated()})}refreshStyle(){super.refreshStyle(),this.setStyle(Pt),this.setStyle(function(){if(ae()>=L)return{width:"100%",transform:"",height:"100%"};if(!It){const e=document.createElement("style");e.innerHTML="body>.blink-sdk-widget-container {max-width: initial !important;}",document.head.appendChild(e),It=!0}return{width:"375px",transform:`scale(${1/Me()})`,transformOrigin:"top left",height:100*Me()+"%"}}());const e=this.getOffset();this.widget.updateOptions(e),this.widgetClose.updateOptions(e),this.widgetButton.updateOptions(e)}}function Ot(e,t,n){const s=()=>{const t=(Date.now()-o)/n;!document.body.contains(e)||t>1?i.remove():(Object.assign(i.style,(t=>{const n=le()?.4:1,s=60+170*t,{left:i,top:o,width:r,height:a}=e.getBoundingClientRect();return{position:"fixed",left:i+r/2-s/2+"px",top:o+a/2-s/2+"px",height:s+"px",width:s+"px",opacity:n*(1-t),zIndex:1,borderRadius:"100%",backgroundColor:"#4897a3",cursor:"pointer",pointerEvents:"none"}})(t)),requestAnimationFrame(s))},i=document.createElement("div");let o;return document.body.appendChild(i),setTimeout((()=>{o=Date.now(),requestAnimationFrame(s)}),t),i}const Dt=new Set(["border-radius","border-bottom-left-radius","border-bottom-right-radius","border-top-left-radius","border-top-right-radius","border-bottom-width","border-left-width","border-right-width","border-top-width","border-width","bottom","font-size","font-stretch","height","layer-grid-char","layer-grid-char-spacing","layer-grid-line","left","letter-spacing","line-height","margin","margin-bottom","margin-left","margin-right","margin-top","marker-offset","max-height","max-width","min-height","min-width","outline-width","padding","padding-bottom","padding-left","padding-right","padding-top","right","size","top","width","word-spacing","gap"]);class ClassNameSet extends Set{static create(e){return K(new Set(String(e||"").split(" ")),this)}toString(){return Array.from(this).join(" ")}}class NodeAttributes{constructor(t){Object.assign(this,t),this.className instanceof ClassNameSet&&(this.className=ClassNameSet.create(String(this.className))),Q(this.style)&&(this.style=e({},this.style))}setAttribute(e,t,n,s){void 0===s&&(s=this.constructor.defaultAttributesMap),s.has(e)||(this.whitelistedAttributes=this.whitelistedAttributes||{},this.whitelistedAttributes[e]=!0),this[e]=t,n&&this.applyAttribute(e,n,s)}applyStyleToNode(e,t,n){"function"==typeof t&&(t=t()),X(t)&&0!=t&&Dt.has(function(e){let t="";for(let n=0;n<e.length;n++)"A"<=e[n]&&e[n]<="Z"?(n>0&&(t+="-"),t+=e[n].toLowerCase()):t+=e[n];return t==e?e:t}(e))&&(t+="px"),n&&n.style[e]!==t&&(n.style[e]=t)}ensureNoStringStyle(){Y(this.style)&&(this.styleString=this.style,delete this.style)}setStyle(e,t,n){if(t=ne(t),Y(e))void 0!==t?(this.ensureNoStringStyle(),this.style=this.style||{},this.style[e]=t,this.applyStyleToNode(e,t,n)):this.removeStyle(e,n);else for(const t of Object.keys(e))this.setStyle(t,e[t],n)}removeStyle(e,t){this.style&&delete this.style[e],t&&t.style[e]&&delete t.style[e]}static getClassArray(e){return e?Array.isArray(e)?e.map((e=>String(e).trim())):String(e).trim().split(" "):[]}getClassNameSet(){return this.className instanceof ClassNameSet||(this.className=ClassNameSet.create(this.className||"")),this.className}addClass(e,t){e=this.constructor.getClassArray(e);for(let n of e)this.getClassNameSet().add(n),t&&t.classList.add(n)}removeClass(e,t){e=this.constructor.getClassArray(e);for(let n of e)this.getClassNameSet().delete(n),t&&t.classList.remove(n)}hasClass(e){return this.getClassNameSet().has(Y(e)?e:e.className)}applyAttribute(e,t,n){let s=n.get(e);if(!s){if(!this.whitelistedAttributes||!(e in this.whitelistedAttributes))return;s={domName:e}}let i=this[e];"function"==typeof i&&(i=i()),s.noValue&&(i=i?"":void 0),void 0!==i?t.setAttribute(s.domName,i):t.removeAttribute(s.domName)}applyClassName(e){if(this.className){const t=String(this.className);e.className!=t&&(e.className=t)}else e.className&&e.removeAttribute("class")}apply(e,t){let n={};this.whitelistedAttributes;let s=e.attributes;for(let i=s.length-1;i>=0;i--){let o=s[i].name;if("style"===o||"class"===o)continue;let r=t.getKeyFromDOMName(o);if(this.hasOwnProperty(r)){let s=this[r],i=t.get(r);i&&i.noValue&&(s=s?"":void 0),null!=s?(e.setAttribute(o,s),n[r]=!0):e.removeAttribute(o)}else e.removeAttribute(o)}for(let s in this)n[s]||this.applyAttribute(s,e,t);if(this.applyClassName(e),e.removeAttribute("style"),this.ensureNoStringStyle(),this.styleString&&(e.style=this.styleString),this.style)for(const t of Object.keys(this.style))this.applyStyleToNode(t,this.style[t],e)}}function kt(e){self.STEM_DEBUG&&(e.node.stemElement=e)}NodeAttributes.defaultAttributesMap=new class DOMAttributesMap{constructor(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=[]),this.allowedAttributesMap=new Map,this.reverseNameMap=new Map,this.fallbackMapping=e;for(let e of t)Array.isArray(e)||(e=[e]),this.setAttribute(e[0],e[1]);this.allowedPrefixes=n}setAttribute(e,t){(t=t||{}).domName=t.domName||e,this.allowedAttributesMap.set(e,t),this.reverseNameMap.set(t.domName,e)}get(e){for(const t of this.allowedPrefixes)if(e.startsWith(t))return{domName:e};let t=this.allowedAttributesMap.get(e);return!t&&this.fallbackMapping&&(t=this.fallbackMapping.get(e)),t}has(e){return this.allowedAttributesMap.has(e)||this.fallbackMapping&&this.fallbackMapping.has(e)}getKeyFromDOMName(e){let t=this.reverseNameMap.get(e);return!t&&this.fallbackMapping&&(t=this.fallbackMapping.getKeyFromDOMName(e)),t}}(null,[["id"],["action"],["checked",{noValue:!0}],["colspan"],["default"],["disabled",{noValue:!0}],["fixed"],["forAttr",{domName:"for"}],["hidden"],["href"],["rel"],["minHeight"],["minWidth"],["role"],["target"],["domTitle",{domName:"title"}],["type"],["placeholder"],["src"],["alt"],["height"],["width"],["tabIndex"],["data"]],["data-","aria-"]);class ThemeType{constructor(e,t,n){Y(n=n||{})&&(n={comment:n}),this.type=e,this.value=t,this.options=n}}var Lt;class Theme extends Dispatchable{constructor(t,n,s){super(),this.classSet=new Set,this.styleSheetInstances=new Map,this.updateThrottled=new CallThrottler({throttle:50}).wrap((()=>this.updateStyleSheets())),this.name=n,this.baseTheme=t,this.properties=e({theme:this},s),this.propTypes={},this.props=new Proxy(this.properties,{get:(e,t,n)=>{const s=ne(this.getProperty(t),{args:[this.props]});return self.STEM_DEBUG&&void 0===s&&console.warn("Failed to find theme prop",t),s},set:(e,t,n)=>(this.setProperties({[t]:n}),!0)}),this.styleSheetSymbol=Symbol(this.name+"StyleSheet"),window.addEventListener("resize",(()=>this.updateThrottled()))}fork(e,t){return new Theme(this,e,t)}register(e,t){e.theme=this,e[this.styleSheetSymbol]=t,this.classSet.add(e)}getStyleSheet(e){var t;return e[this.styleSheetSymbol]||(null==(t=this.baseTheme)?void 0:t.getStyleSheet(e))}getProperty(e){var t;return this.properties.hasOwnProperty(e)?this.properties[e]:null==(t=this.baseTheme)?void 0:t.getProperty(e)}setProperties(e,t){void 0===t&&(t=!0);for(const[t,n]of Object.entries(e))n instanceof ThemeType?(this.properties[t]=n.value,this.propTypes[t]=n):this.properties[t]=n;t&&this.updateThrottled()}getAllStyleSheets(){let e=new Set(this.styleSheetInstances.values());for(const t of this.classSet.values())e.add(this.getStyleSheet(t));return Array.from(e).map((e=>e.getInstance(this)))}getStyleSheetInstance(e){let t=this.styleSheetInstances.get(e);return t||(t=new e({theme:this}),this.styleSheetInstances.set(e,t)),t}updateStyleSheets(){this.dispatch("beforeUpdateStyleSheets");for(const e of this.getAllStyleSheets())e.update();this.dispatch("afterUpdateStyleSheets")}static register(e,t){return this.Global.register(...arguments)}static setProperties(e){this.Global.setProperties(...arguments)}static get props(){return this.Global.props}}Lt=Theme,Theme.Global=new Lt(null,"Global");const Nt=[],Rt=new class OncePerTickRunner{constructor(e){this.callback=e,this.throttle=new WeakMap}maybeEnqueue(e){const t=this.throttle.get(e);for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return this.throttle.set(e,s),!t&&(queueMicrotask((()=>{const t=this.throttle.get(e);t&&(this.clear(e),this.callback(e,...t))})),!0)}clear(e){this.throttle.delete(e)}}(((e,t)=>e.node&&e.redraw(t))),_t={};function Ft(e){return V(e,H)}class BaseUIElement extends Dispatchable{canOverwrite(e){return this.constructor===e.constructor&&this.getNodeType()===e.getNodeType()}applyRef(){var e,t;null!=(e=this.options)&&e.ref&&(this.options.ref.parent[null!=(t=this.options.ref.name)?t:this.options.ref.key]=this);this.cancelEnqueuedRedraw()}removeRef(){var e;if(null!=(e=this.options)&&e.ref){let e=this.options.ref.parent,t=this.options.ref.name;e[t]===this&&(e[t]=void 0)}}enqueueRedraw(e){Rt.maybeEnqueue(this,e)}cancelEnqueuedRedraw(){Rt.clear(this)}onMount(){}onUnmount(){}destroyNode(){var e;this.dispatch("unmount",this),this.onUnmount(),this.cleanup(),this.removeRef(),null==(e=this.node)||e.remove(),delete this.node}}_t.TextElement=class UITextElement extends BaseUIElement{constructor(e){var t;void 0===e&&(e=""),super(),e&&e.hasOwnProperty("value")&&Q(e)?(this.value=e.value,this.options=e):this.value=null!=(t=e)?t:""}mount(e,t){this.parent=e,this.node?this.redraw():(this.createNode(),this.applyRef()),e.node.insertBefore(this.node,t),this.onMount()}getNodeType(){return Node.TEXT_NODE}copyState(e){this.value=e.value,this.options=e.options}createNode(){return this.node=document.createTextNode(this.getValue()),kt(this),this.node}setValue(e){this.value=null!=e?e:"",this.node&&this.redraw()}getValue(){return String(this.value)}toString(){return this.getValue()}redraw(){if(this.node){let e=this.getValue();this.node.nodeValue!==e&&(this.node.nodeValue=e)}this.applyRef()}};class UIElement extends BaseUIElement{constructor(e){void 0===e&&(e={}),super(),this.children=[],this.options=e,this.state=this.getDefaultState(),this.setOptions(e)}getDefaultOptions(e){}getCleanedOptions(){let t=e({},this.options);return delete t.ref,delete t.children,delete t.key,delete t.nodeType,t}getDefaultState(){return{}}getPreservedOptions(){}setOptions(e){let t=this.getDefaultOptions(e);t&&(e=Object.assign(t,e)),this.options=e}updateOptions(e){this.setOptions(Object.assign(this.options,e)),this.redraw()}setChildren(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.updateOptions({children:Ft(t)})}copyState(e){let t=e.options,n=this.getPreservedOptions();n&&(t=Object.assign({},t,n)),this.setOptions(t),this.addListenersFromOptions()}getNodeType(){return this.options.nodeType||"div"}static create(e,t){const n=new this(t);return n.mount(e,null),n.dispatch("mount",n),n}getGivenChildren(){return this.options.children||[]}render(){return this.options.children}createNode(){return this.node=document.createElement(this.getNodeType()),kt(this),this.node}cleanup(){this.runCleanupJobs();for(const e of this.children)e.destroyNode();this.clearNode(),super.cleanup()}overwriteChild(e,t){return e.copyState(t),e}getElementKeyMap(e){if(!e||!e.length)return;let t=new Map;for(let n=0;n<e.length;n+=1){let s=e[n].options&&e[n].options.key||"autokey"+n;t.set(s,e[n])}return t}getChildrenToRender(){return this.render()}getExtraContext(){const{theme:e}=this.options;return e?{theme:e}:null}updateContext(t){var n;void 0===t&&(t=null==(n=this.parent)?void 0:n.context);const s=this.getExtraContext();this.context=s?e({},t,s):t}getChildrenForRedraw(){Nt.push(this);let e=Ft(this.getChildrenToRender());return Nt.pop(),e}redraw(){if(!this.node)return console.error("Element not yet mounted. Redraw aborted!",this),!1;this.updateContext();let e=this.getChildrenForRedraw();if(e===this.children){for(const t of e)t.redraw();return this.applyNodeAttributes(),this.applyRef(),!0}let t=this.node,n=this.getElementKeyMap(this.children);for(let i=0;i<e.length;i++){var s;let o=e[i],r=i>0?e[i-1].node:null,a=r?r.nextSibling:t.firstChild;o.getNodeType||(o=o.toUI?o.toUI(this):new _t.TextElement({value:String(o)}),e[i]=o);let l=(null==(s=o.options)?void 0:s.key)||"autokey"+i,d=n&&n.get(l);d&&e[i].canOverwrite(d)?(d!==e[i]&&(e[i]=this.overwriteChild(d,e[i])),e[i].redraw(),e[i].node!==a&&t.insertBefore(e[i].node,a)):o.mount(this,a)}if(this.children.length){let t=new Set(e);for(const e of this.children)t.has(e)||e.destroyNode()}return this.children=e,this.applyNodeAttributes(),this.applyRef(),!0}getOptionsAsNodeAttributes(){return K(this.options,NodeAttributes)}instantiateNodeAttributes(){return new NodeAttributes(this.options)}getNodeAttributes(){var e;const t=this.instantiateNodeAttributes(),n=null==(e=this.styleSheet)?void 0:e.container;return n&&t.addClass(n),t}extraNodeAttributes(e){}applyNodeAttributes(){const e=this.getNodeAttributes();this.extraNodeAttributes(e),e.apply(this.node,this.constructor.domAttributesMap)}setAttribute(e,t){this.getOptionsAsNodeAttributes().setAttribute(e,t,this.node,this.constructor.domAttributesMap)}setStyle(e,t){if("object"!=typeof e)this.getOptionsAsNodeAttributes().setStyle(e,t,this.node);else for(const[t,n]of Array.from(Object.entries(e)))this.setStyle(t,n)}removeStyle(e){this.getOptionsAsNodeAttributes().removeStyle(e,this.node)}addClass(e){this.getOptionsAsNodeAttributes().addClass(e,this.node)}removeClass(e){this.getOptionsAsNodeAttributes().removeClass(e,this.node)}hasClass(e){return this.getOptionsAsNodeAttributes().hasClass(e)}toggleClass(e){this.hasClass(e)?this.removeClass(e):this.addClass(e)}getTheme(){var e;return this.options.theme||(null==(e=this.context)?void 0:e.theme)||Theme.Global}get styleSheet(){var e;let{styleSheet:t}=this.options;const n=this.getTheme();return t||(t=n.getStyleSheet(this.constructor)),null==(e=t)?void 0:e.getInstance(n)}get themeProps(){var e;return(null==(e=this.options.styleSheet)?void 0:e.themeProps)||this.getTheme().props}addListenersFromOptions(){var e=this;for(const t in this.options)if("string"==typeof t&&t.startsWith("on")&&t.length>2){const n=t.substring(2),s="add"+n+"Listener",i="on"+n+"Handler";"function"!=typeof this[s]||this.hasOwnProperty(i)||(this[i]=function(){if(e.options[t]){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];e.options[t](...s,e)}},this[s](this[i]))}}refLink(e){return{parent:this,name:e}}refLinkArray(e,t){return this[e]||(this[e]=[]),{parent:this[e],name:t}}bindToNode(e,t){return this.node=e,t&&(this.clearNode(),this.redraw()),this}mount(e,t){if(e.node||(e=(new _t.Element).bindToNode(e)),this.parent=e,this.node)return e.insertChildNodeBefore(this,t),void this.dispatch("changeParent",this.parent);this.createNode(),this.redraw(),e.insertChildNodeBefore(this,t),this.addListenersFromOptions(),this.onMount()}appendChild(e){if(this.children!==this.options.children)throw"Can't properly handle appendChild, you need to implement it for "+this.constructor;return this.options.children.push(e),e.mount(this,null),e}insertChild(e,t){if(this.children!==this.options.children)throw"Can't properly handle insertChild, you need to implement it for "+this.constructor;t=t||0,this.options.children.splice(t,0,e);const n=t+1<this.options.children.length?this.children[t+1].node:null;return e.mount(this,n),e}eraseChild(e,t){void 0===t&&(t=!0);let n=this.options.children.indexOf(e);return n<0?null:this.eraseChildAtIndex(n,t)}eraseChildAtIndex(e,t){if(void 0===t&&(t=!0),e<0||e>=this.options.children.length)return void console.error("Erasing child at invalid index ",e,this.options.children.length);if(this.children!==this.options.children)throw"Can't properly handle eraseChild, you need to implement it for "+this.constructor;let n=this.options.children.splice(e,1)[0];return t?n.destroyNode():this.node.removeChild(n.node),n}show(){this.removeClass("hidden")}hide(){this.addClass("hidden")}insertChildNodeBefore(e,t){this.node.insertBefore(e.node,t)}clearNode(){for(;this.node&&this.node.lastChild;)this.node.removeChild(this.node.lastChild)}isInDocument(){return document.body.contains(this.node)}getWidthOrHeight(e){let t=this.node;return t&&parseFloat("width"===e?t.offsetWidth:t.offsetHeight)||0}getHeight(){return this.getWidthOrHeight("height")}getWidth(){return this.getWidthOrHeight("width")}setHeight(e){this.setStyle("height",G(e,"px")),this.dispatch("resize")}setWidth(e){this.setStyle("width",G(e,"px")),this.dispatch("resize")}addNodeListener(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];this.node.addEventListener(e,t,...s);const o={remove:()=>{this.removeNodeListener(e,t,...s)}};return this.addCleanupJob(o),o}removeNodeListener(e,t){this.node.removeEventListener(e,t)}addClickListener(e){return this.addNodeListener("click",e)}removeClickListener(e){this.removeNodeListener("click",e)}addDoubleClickListener(e){return this.addNodeListener("dblclick",e)}removeDoubleClickListener(e){this.removeNodeListener("dblclick",e)}}_t.createElement=function(e,t){if(e){t=t||{};for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];if(t.children=Ft(s),t.ref){if("string"==typeof t.ref){if(!(Nt.length>0))throw Error("Failed to automatically link ref, there needs to be an element in the rendering stack");t.ref={parent:Nt[Nt.length-1],name:t.ref}}t.key&&console.error("Warning! UI Element cannot have both a key and a ref fieldname. Key will be overriden.\nAre you using the options from another object? Shame!",t),t.key="_ref"+t.ref.name}return t.hasOwnProperty("class")&&console.error("Invalid UI Element attribute: class. Did you mean className?"),"string"==typeof e&&(t.nodeType=e,e=UIElement),new e(t)}console.error("Create element needs a valid object tag, did you mistype a class name?")},UIElement.domAttributesMap=NodeAttributes.defaultAttributesMap,_t.Element=UIElement,_t.str=e=>new _t.TextElement(e);let Mt=new WeakMap;_t.Primitive=(e,t)=>{t||(t=e,e=_t.Element);let n=Mt.get(e);n||(n=new Map,Mt.set(e,n));let s=n.get(t);return s||(s=class Primitive extends e{getNodeType(){return t}},n.set(t,s),s)};class ScriptResolver extends Dispatchable{constructor(e){super(),this.loaded=!1,this.jobs=[];let t=document.createElement("script");t.async=!0,t.src=e,t.onload=()=>this.onLoad(),document.getElementsByTagName("head")[0].appendChild(t)}onLoad(){this.loaded=!0;for(let e=0;e<this.jobs.length;e+=1)this.jobs[e](this);this.jobs=[]}resolve(e){this.loaded?e(this):this.jobs.push(e)}}let Bt=new Map;function jt(t,n,s,i){const o=e({},s,{appType:i,type:ot(n)});t===window&&window.postBlinkMessageSync?window.postBlinkMessageSync(o):t.postMessage(o,"*")}const Wt=new class IFrameConnection extends Dispatchable{constructor(){super(),this.appType=null,this.allIframesDispatch=new Dispatchable,window.blinkIframeConnections?window.blinkIframeConnections.push(this):window.blinkIframeConnections=[this],window.postBlinkMessageSync||(window.postBlinkMessageSync=function(e){for(const t of window.blinkIframeConnections)t.processWindowEventData(e)}),this.attachEventListener(window,"message",(e=>{let{data:t}=e;"object"==typeof t&&(e.source===window&&this.appType===t.appType||(t.eventOrigin=e.origin,this.processWindowEventData(t)))}))}processWindowEventData(e){e.eventOrigin||(e.eventOrigin=window.location.origin);const{type:t}=e;("string"==typeof t||t instanceof String)&&t.startsWith(Qe)&&(this.allIframesDispatch.dispatch(t.substring(Qe.length),e),e.appType&&this.appType&&this.appType!==e.appType||this.dispatch(t.substring(Qe.length),e))}setAppType(e){this.appType=e}sendToSDK(e,t){void 0===t&&(t={}),jt(window.parent,e,t,this.appType)}sendToOpener(e,t){void 0===t&&(t={}),jt(window.opener,e,t,this.appType)}sendToIFrames(e,t){void 0===t&&(t={});const{frames:n}=window.parent;for(let s=0;s<n.length;s+=1)try{const i=n[s];i.origin===window.origin&&jt(i,e,t,this.appType)}catch(e){}}addIframesListener(e,t){return this.allIframesDispatch.addListener(e,(function(e){if(e.eventOrigin===window.origin){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];t(e,...s)}}))}},qt={popup:"true",scope:"profile postal_code payments:widget payments:shipping_address"};let Ut=null;class AmazonPayWidget extends _t.Element{constructor(){super(...arguments),this.userData=null}static show(e){const{publicConfig:t}=e.amazonPaymentProcessor;this.isReady?this.insertModal(e):(window.onAmazonLoginReady=()=>{amazon.Login.setClientId(t.clientId),amazon.Login.setSandboxMode(t.sandbox),amazon.Login.setMerchantID(t.merchantId),this.isReady=!0,this.insertModal(e)},async function(e,t){let n=(e=U(e)).map((e=>async function(e){let t=Bt.get(e);return t||(t=new ScriptResolver(e),Bt.set(e,t)),new Promise((function(e,n){t.resolve(e,n)}))}(e)));Promise.all(n).then((function(){t&&t(...arguments)}))}(t.sandbox?"https://static-na.payments-amazon.com/OffAmazonPayments/us/sandbox/js/Widgets.js":"https://static-na.payments-amazon.com/OffAmazonPayments/us/js/Widgets.js"))}static insertModal(e){amazon.Login.authorize(qt,(()=>this.create(document.body,e)))}static requestWidgetInSDK(e,t){this.finishCallback=t,e=e.toSDK(),Wt.sendToSDK(Ze,{amazonPaymentProcessor:e}),this.addedSDKListeners||(this.addedSDKListeners=!0,Wt.addListener(it,(e=>{this.finishCallback(e.orderReferenceId),this.finishCallback=null})))}extraNodeAttributes(e){e.setStyle({zIndex:99999910,height:"100%",width:"100%",position:"fixed",background:"gray",top:0,left:0,opacity:1,display:"flex",alignItems:"center",justifyContent:"center"})}getAmazonConfig(){return this.options.amazonPaymentProcessor.publicConfig}getAmazonSellerId(){return this.getAmazonConfig().merchantId}updateRecurringPaymentConsent(e){const t="true"==e.getConsentStatus();this.okButton.updateOptions({disabled:!t})}finishFlow(e){if(e&&this.orderReferenceId){const{iframeElement:e}=this.options,t={orderReferenceId:this.orderReferenceId};mt(e,"panel")(it,t)}this.destroyNode()}render(){const e={fontFamily:"sans-serif",fontSize:14,height:40,width:120,borderRadius:4,cursor:"pointer",margin:"0px 8px"};return _t.createElement("div",{style:{width:"100%",maxWidth:375,boxSizing:"border-box",background:"white",padding:20}},_t.createElement("div",{id:"walletWidgetDiv",style:{height:228,width:"100%",marginBottom:16}}),_t.createElement("div",{id:"consentWidgetDiv",style:{height:140,width:"100%",margin:"16px 0px"}}),_t.createElement("div",{style:{marginTop:16,textAlign:"center"}},_t.createElement("button",{style:e,onClick:()=>this.finishFlow()},"Cancel"),_t.createElement("button",{style:e,ref:"okButton",disabled:!0,onClick:()=>this.finishFlow(!0)},"OK")))}async onAmazonAuth(e){this.showPaymentWidget()}showAddressWidget(){new OffAmazonPayments.Widgets.AddressBook({sellerId:this.getAmazonSellerId(),agreementType:"BillingAgreement",onReady:e=>{console.warn("Got billing agreement:",e.getAmazonBillingAgreementId(),e,performance.now())},onAddressSelect:e=>{console.warn("Address select:",e,performance.now())},design:{designMode:"responsive"},onError:e=>{console.error("Amazon address widget error:",e.getErrorCode(),e.getErrorMessage())}}).bind("addressBookWidgetDiv")}showPaymentWidget(){new OffAmazonPayments.Widgets.Wallet({sellerId:this.getAmazonSellerId(),design:{designMode:"responsive"},agreementType:"BillingAgreement",onReady:e=>{Ut.billingAgreementId=e.getAmazonBillingAgreementId(),console.warn("Billing agreement",Ut.billingAgreementId,e)},onOrderReferenceCreate:e=>{Ut.orderReferenceId=e.getAmazonOrderReferenceId(),console.log("Order ref",Ut.orderReferenceId,e)},onPaymentSelect:e=>{console.warn("Payment selected: ",this.orderReferenceId,e),Ut.showRecurringPaymentConsentWidget()},onError:e=>{console.error("Amazon payment widget error:",e.getErrorCode(),e.getErrorMessage())}}).bind("walletWidgetDiv")}showRecurringPaymentConsentWidget(){new OffAmazonPayments.Widgets.Consent({sellerId:this.getAmazonSellerId(),amazonBillingAgreementId:this.orderReferenceId,design:{designMode:"responsive"},onReady:e=>{Ut.updateRecurringPaymentConsent(e)},onConsent:e=>{Ut.updateRecurringPaymentConsent(e)},onError:e=>{console.error("Amazon payment widget error:",e.getErrorCode(),e.getErrorMessage())}}).bind("consentWidgetDiv")}onMount(){Ut=this,this.showPaymentWidget()}}AmazonPayWidget.addedSDKListeners=!1;const zt=new class PurchaseModule{constructor(){this.paymentRequestReceived=new Dispatcher,this.paymentRequestCompleted=new Dispatcher,this.paymentRequests=new Map,this.paymentCallbacks=new Map,this.pendingRequests=[],this.lastPaymentRequestData={}}init(){ut.addListener("makePaymentViaSDK",(e=>{let{request:t}=e;return this.requestPayment(t)})),ut.addListener("paymentResponse",(e=>{let{request:t,response:n,error:s}=e;const i=this.paymentCallbacks.get(t.offerId)||{onSuccess:[],onError:[]};n?(this.paymentRequests.set(t.offerId,{request:t,response:n}),i.onSuccess.forEach((e=>e(n))),i.onSuccess=[]):(this.paymentRequests.set(t.offerId,{request:t,error:s}),i.onError.forEach((e=>e(s))),i.onError=[],t.offerId===this.lastPaymentRequestData.offerId&&1207===s.code&&Ht.changeRoute(wt.INSUFFICIENT_FUNDS)),this.paymentRequestCompleted.dispatch()}))}resolvePendingRequests(){const e=this.pendingRequests;this.pendingRequests=null;for(const t of e)this.requestPayment(...t)}requestPayment(e,t,n){if(void 0===t&&(t=te),void 0===n&&(n=te),null!=this.pendingRequests)return void this.pendingRequests.push(arguments);this.lastPaymentRequestData=e,this.paymentRequests.set(e.offerId,{request:e});const s=this.paymentCallbacks.get(e.offerId)||{onSuccess:[],onError:[]};s.onSuccess.push(t),s.onError.push(n),this.paymentCallbacks.set(e.offerId,s),this.paymentRequestReceived.dispatch(),Ht.widget.sendMessage("paymentRequest",e)}};class PanelElement extends IFrameElement{constructor(){super(...arguments),this.flowCheckpoint=new Dispatcher,this.flowFinish=new Dispatcher,this.flowSuccess=new Dispatcher,this.sizeChange=new Dispatcher,this.height=null,this.width=null,n&&!s||(this.node.setAttribute("route",this.options.type),this.node.setAttribute("panel-type",this.options.type),this.node.setAttribute("gate-type",this.options.gateType),this.node.setAttribute("expanded",!1))}get appType(){return"panel"}getPaymentDetails(){return this.options.paymentDetails||zt.lastPaymentRequestData}getPaymentRequestStatus(){const e=this.getPaymentDetails();return zt.paymentRequests.get(null==e?void 0:e.offerId)}getIFrameParams(){return e({},super.getIFrameParams(),{paymentDetails:this.getPaymentDetails()})}isFlowSuccess(){const e=U(this.options.flowSuccessType||this.options.type),t={[w.subscribe]:()=>bt.isSubscriber()&&!this.options.inlineFlow&&!this.options.editRecurring,[w.payment]:()=>{var e;return null!=(null==(e=this.getPaymentRequestStatus())?void 0:e.response)},[w.auth]:()=>bt.isAuthenticated()};for(const n of e){const e=t[n];if(e&&e())return n}return null}checkFlowSuccess(){const e=this.isFlowSuccess();e&&this.flowSuccess.dispatch(e)}recalcPanelContent(){$e(this.options);const{contentAST:e}=this.options;this.sendMessage("updatePanelContent",{contentAST:e})}refreshStyle(){super.refreshStyle(),this.setStyle({visibility:"visible"}),this.height&&this.width&&this.options.gateType!==S.popup&&this.setStyle({height:X(this.height)?this.height+"px":this.height,width:X(this.width)?this.width+"px":this.width,transition:k})}destroyNode(){return this.flowFinish.dispatch(),super.destroyNode()}onMount(){super.onMount(),this.addSdkListener("updatePanelSize",(e=>{let{height:t,width:i}=e;t<50||(this.height=t,this.width=i,this.refreshStyle(),this.sizeChange.dispatch({height:t,width:i}),n&&!s||this.attachTimeout((()=>this.node.setAttribute("expanded","true")),D))})),this.addSdkListener("checkFlowDone",(()=>{this.checkFlowSuccess()})),this.attachEventListener(window,"resize",_e((()=>this.sendMessage(tt)))),this.attachEventListener(document,"visibilitychange",(()=>{"visible"===document.visibilityState&&this.sendMessage(tt)})),this.addSdkListener("scrollIframeTop",(e=>{var t;let{windowScroll:n}=e;null==(t=this.node)||t.scrollIntoView({behavior:"smooth"}),n&&window.scrollTo(n)})),this.addSdkListener("flowCheckpoint",(e=>{let{event:t}=e;return this.flowCheckpoint.dispatch(t)})),this.attachListener(zt.paymentRequestReceived,(()=>this.resendIFrameParams())),this.attachListener(zt.paymentRequestCompleted,(()=>this.resendIFrameParams())),n&&!s||this.addSdkListener(et,(e=>{let{route:t}=e;this.node.setAttribute("route",t)})),this.attachListener(bt.authenticationChange,(()=>{this.recalcPanelContent()})),this.checkFlowSuccess(),this.attachListener(bt.userPreferencesChange,(()=>this.checkFlowSuccess())),this.attachListener(zt.paymentRequestCompleted,(()=>this.checkFlowSuccess()))}}const Ht=new class WalletModule{constructor(){this.scrim=null,this.panelDestroyTimeout=null,this.panelDestroyFunction=null,this.pendingChangeRoutes=[],this.currentRoute=wt.INDEX_COLLAPSED,this.pulseAnimation=void 0,this.activePanelHandler=void 0,this.widgetContainer=new WidgetContainer}init(){this.widgetContainer.mountOnBody(),this.widgetContainer.widgetButton.node.addEventListener("click",(()=>this.changeRoute(wt.INDEX_EXPANDED))),this.widgetContainer.widgetClose.node.addEventListener("click",(()=>this.changeRoute(wt.INDEX_COLLAPSED))),ut.addListener(et,((e,t)=>{t===this.widget.node&&this.onRouteChange(e)})),ut.addListener("showAutopay",(()=>{this.changeRoute(wt.AUTOPAY)})),ut.addListener("sessionPaymentMade",(()=>{gt.hideWallet||this.isExpanded()||this.isPopupFlowActive()||(this.pulseAnimation=function(e){const t=Ot(e,0,1e3),n=Ot(e,250,1250);return{remove(){t.remove(),n.remove()}}}(this.widgetContainer.widgetButton.node))})),ut.addListener(Ze,((t,n)=>{AmazonPayWidget.show(e({},t,{iframeElement:n}))})),bt.userPreferencesChange.addListener((()=>this.widgetContainer.updateOptions({showBalance:!!bt.userData.alwaysShowBalance})))}get widget(){return this.widgetContainer.widget}renderWallet(e){var t,n;this.widgetContainer.updateOptions({desktopBottomOffset:null!=(t=null==e?void 0:e.desktop)?t:0,mobileBottomOffset:null!=(n=null==e?void 0:e.mobile)?n:0,visible:!gt.hideWallet});const s=()=>{const e=()=>{this.widgetContainer.updateOptions({visible:!gt.hideWallet}),this.updateScrim()};this.isExpanded()&&gt.hideWallet?setTimeout(e,D):e(),gt.hideWallet&&!this.isPopupFlowActive()&&this.isExpanded()&&this.changeRoute(wt.INDEX_COLLAPSED)};bt.authenticationChange.addListener(s),gt.addChangeListener(s),s()}changeRoute(e){this.isPopupFlowActive()?this.pendingChangeRoutes.push(arguments):this.widget.sendMessage(et,{route:e})}showModal(e){if(this.panelDestroyFunction&&this.panelDestroyFunction(),this.isPopupFlowActive()){const e=this.activePanelHandler;setTimeout((()=>e.remove()))}else this.changeRoute(wt.INDEX_COLLAPSED),this.widgetContainer.updateOptions({expanded:!1});const t=new PanelElement(e,this.widget.node),n={panel:t,remove:()=>{n===this.activePanelHandler&&t.sendMessage(et,{url:w.empty}),this.panelDestroyFunction=()=>{n===this.activePanelHandler&&(this.activePanelHandler=null),t.node=null,t.destroyNode(),this.widgetContainer.updateOptions({activePanel:this.isPopupFlowActive()});for(const e of this.pendingChangeRoutes)this.changeRoute(...e);this.pendingChangeRoutes=[],this.updateScrim(),this.panelDestroyFunction=null,clearTimeout(this.panelDestroyTimeout),this.panelDestroyTimeout=null},this.panelDestroyTimeout=setTimeout(this.panelDestroyFunction,300)},updatePanel:e=>{n===this.activePanelHandler?t.updateOptions(e):console.error("Panel has already been destroyed.")}};return this.activePanelHandler=n,this.widgetContainer.updateOptions({activePanel:!0}),t.onMount(),t.resendIFrameParams(),t.sendMessage(et),this.activePanelHandler=n,this.updateScrim(),t.addSdkListener(nt,(e=>{let{expandWallet:t}=e;n.remove(),t&&this.changeRoute(wt.INDEX_EXPANDED)})),{panel:t,handler:n}}isExpanded(){return this.currentRoute!==wt.INDEX_COLLAPSED}isPopupFlowActive(){return!!this.activePanelHandler}updateScrim(){this.isPopupFlowActive()||!gt.hideWallet&&this.isExpanded()?this.scrim||(this.scrim=function(){const e=document.documentElement.clientHeight!==document.documentElement.scrollHeight?document.documentElement:document.body,t=window.innerWidth-e.clientWidth,n=getComputedStyle(e),s=n.getPropertyValue("padding-right"),i={overflow:n.getPropertyValue("overflow"),paddingRight:s};return i.overflow.endsWith("hidden")?{scrollbarWidth:t,restore:te}:(Object.assign(e.style,{overflow:"hidden",paddingRight:`${parseFloat(s)+t}px`}),{scrollbarWidth:t,restore:()=>{Object.assign(e.style,i)}})}(),this.widgetContainer.updateOptions({extraRightOffset:this.scrim.scrollbarWidth})):this.scrim&&(this.widgetContainer.updateOptions({extraRightOffset:0}),this.scrim.restore(),this.scrim=null)}onRouteChange(e){-1!==Object.values(wt).indexOf(e.route)&&e.appType===b&&(this.currentRoute=e.route),this.isPopupFlowActive()||this.widget.updateOptions({route:this.currentRoute}),this.widgetContainer.updateOptions({expanded:this.isExpanded()}),this.updateScrim(),this.isExpanded()&&this.pulseAnimation&&(this.pulseAnimation.remove(),this.pulseAnimation=null)}},Vt={gate:e({},St.gate,{background:"#FFF",boxShadow:"0px -2px 4px rgba(0, 0, 0, 0.1)",display:"flex",boxSizing:"border-box",left:0,bottom:0,width:"100%",position:"fixed",zIndex:9999997,height:null})},Gt={gate:e({},St.gate,{top:0,left:0,width:"100%",height:"100%",position:"fixed",background:"rgba(154, 151, 151, 0.88)"})},Jt={[S.cover]:class CoverGate extends GateElement{constructor(){super(...arguments),this.styleSheet=At}getPanelStyle(){return e({},super.getPanelStyle(),this.styleSheet.panelBasicStyle,this.styleSheet.panelStyle[this.options.coverPanelPosition])}refreshStyle(){super.refreshStyle(),this.setStyle("background",this.options.coverColor)}},[S.preview]:class PreviewGate extends GateElement{constructor(){super(...arguments),this.styleSheet=Ct,this.preview=document.createElement("div"),this.node.appendChild(this.preview),this.options.previewFadeOut&&(this.fadeOut=document.createElement("div"),Object.assign(this.fadeOut.style,{background:`linear-gradient(rgba(255,255,255,0),${this.options.previewFadeOutToColor})`,height:this.options.previewFadeOutHeight+"px"}),this.node.appendChild(this.fadeOut))}refreshStyle(){var e;super.refreshStyle(),Object.assign(this.preview.style,{height:this.options.previewHeight+"px"}),this.setStyle(null!=(e=this.options.customStyle)?e:{})}getPanelStyle(){return e({},super.getPanelStyle(),{background:this.options.previewFadeOutToColor})}computeParentStyle(){var t,n,s;const i=((null==(t=this.preview)?void 0:t.offsetHeight)||0)+((null==(n=this.fadeOut)?void 0:n.offsetHeight)||0)+((null==(s=this.panel)?void 0:s.height)||0)+"px";return e({},super.computeParentStyle(),{overflow:"hidden",minHeight:i,maxHeight:i,height:i})}},[S.banner]:class BannerGate extends GateElement{constructor(){super(...arguments),this.styleSheet=Vt}refreshStyle(){var e;super.refreshStyle(),this.setStyle(null!=(e=this.options.customStyle)?e:{})}},[S.popupGate]:class PopupGate extends GateElement{constructor(){super(...arguments),this.styleSheet=Gt}computeParentStyle(){return{overflow:"hidden",paddingRight:"15px"}}}},Kt=new class PanelModule{constructor(){this.pendingRequests=[],this.rules=T,this.cachedBannerGates=new Map}init(){new PanelElement({type:w.empty,gateType:S.popup},Ht.widget.node).initialize(),this.scanForPanels(),setInterval((()=>this.scanForPanels()),200)}addRule(e){this.rules.push(e),this.scanForPanels()}scanForPanels(t){void 0===t&&(t=document);for(const n of this.rules)for(const s of t.querySelectorAll(n.selector)){if("true"===s.getAttribute(I))return;s.setAttribute(I,"true");const t=e({},n);delete t.selector,this.createPanel(s,t)}}resolvePendingRequests(){const e=this.pendingRequests;this.pendingRequests=null;for(const t of e)this.createPanel(...t)}createPanel(e,t){if(e=e||document.body,null!=this.pendingRequests)return void this.pendingRequests.push(arguments);if(Y(e)&&(e=[...document.querySelectorAll(e)]),Array.isArray(e)){e.length=Math.min(4,e.length);for(const n of e)this.createPanel(n,t);return}t=Xe(t);const n=new CleanupJobs;for(const e of["onFlowCheckpoint","onFlowFinish","onFlowSuccess","onMount"])if("function"==typeof t[e]){const s=qe.addAnonymous(t[e]);t[e]=s,n.add((()=>qe.delete(s)))}const s=t.gateType;if(!ve())return void console.error("[BlinkSDK] Blink SDK is inactive!");const i=e;let o,r;if(s===S.popup){const e=Ht.showModal(t);o=e.panel,r=e.handler}else{const e=s?Jt[s]:GateElement;if(null==e)return void console.error("[BlinkSDK] Unknown gate type",s);const n=t.panel;if(s===S.banner&&n&&this.cachedBannerGates.has(n)){const e=this.cachedBannerGates.get(n);r=e.getInteractiveHandlers(),o=e.panel,o.updateOptions(t)}else{o=new PanelElement(t);const a=new e(t,o);a.mount(i),r=a.getInteractiveHandlers(),s===S.banner&&this.cachedBannerGates.set(n,a)}}o.addCleanupJob(n),t.onFlowFinish&&o.flowFinish.addListener((function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return qe.call(t.onFlowFinish,...n)})),t.onFlowCheckpoint&&o.flowCheckpoint.addListener((e=>qe.call(t.onFlowCheckpoint,e)));const a=e=>{(s!==S.popup||"donation"!==e&&"subscription"!==e)&&r.remove(),t.onFlowSuccess&&qe.call(t.onFlowSuccess)};o.isFlowSuccess()?a():o.flowSuccess.addListener(a),t.onMount&&qe.call(t.onMount,r)}createPopup(t){this.createPanel(document.body,e({},t,{gateType:S.popup}))}},$t=new class UXFlowModule{init(){ut.addListener("redirectToUrl",(e=>{let{url:t,newTab:n,logOut:s}=e;s&&bt.setMerchantToken(null),function(e,t){void 0===e&&(e=""),void 0===t&&(t="_blank"),window.open(e,t,"opener")}(t||window.location.href,n?"_blank":"_self")})),ut.addListener("startFlowRequest",(e=>{let{flowType:t,options:n}=e;return this.enterFlow(t,n)}))}enterFlow(t,n){n.type=n.type||t,n.flowType=t;const s=e({flowType:n.type,journeyId:n.journeyId,journeyAlias:n.journeyAlias},n.metadata),i=Se(n.panel);i&&(s.panelId=i.id,s.panelAlias=i.alias),ct(lt,s),!n.editRecurring&&(t===w.subscribe&&bt.userData.subscription||t===w.donation&&bt.isRecurringDonor())?gt.hideWallet?Kt.createPopup(e({},n,{type:w.dashboard})):Ht.changeRoute(wt.INDEX_EXPANDED):Kt.createPopup(n)}},Xt=50;let Yt=null;const Qt=new Dispatcher;function Zt(e){return Y(e)&&(e=new URL(e,self.location.href)),e.pathname+(e.pathname.endsWith("/")?"":"/")}function en(e,t){return Zt(e)===Zt(t)}function tn(){const e=Ae.getItem(_.pageVisits);return new Map((null==e?void 0:e.v)||[])}function nn(t,n){let s=tn();const i=Zt(t),o=Date.now(),r=e({firstVisit:o},s.get(i),n,{lastVisit:o});if(s.set(i,r),s.size>Xt){const e=[...s].sort(((e,t)=>t[1].lastVisit-e[1].lastVisit)).slice(0,Xt);s=new Map(e)}return Ae.setItem(_.pageVisits,{v:[...s]}),[r,s]}function sn(e){const t=[location.pathname,...tn().keys()];for(const n of t)if(en(e,n))return!0;return!1}function on(e){return 0===Qt.listeners.length&&(Yt=self.location.href,setInterval((()=>{const e=self.location.href;e!==Yt&&(Yt=e,Qt.dispatch(e))}),200)),e(Yt),Qt.addListener(e)}function rn(e,t){nn(e,t),function(e){Qt.dispatch(e)}(e)}const an=new class AnalyticsModule{constructor(){this.allEventsDispatcher=new Dispatcher,this.eventsByTypeDispatcher=new Dispatchable,this.shouldStoreCookies=null,this.client=new AnalyticsClient("sdk")}init(){on((()=>this.updateEnvironment(this.getDefaultEnvironment()))),this.initDispatchers(),ge((()=>{if(!ve())return;const e=fe();if(!e)return;const t={merchantId:e},n=ye();n&&n.alias&&(t.merchantAlias=n.alias),this.client.updateIdentity(t),this.broadcastEnvironment()})),yt.addListener((e=>{e.sendMessage(st,{environment:this.client.environment,identity:this.client.identity,iframeSelector:rt(e.node)})})),bt.authenticationChange.addListener((()=>{bt.userData.userId?this.client.identity.userId=bt.userData.userId:delete this.client.identity.userId,this.broadcastEnvironment()}))}setEnableStorage(e){e!==this.shouldStoreCookies&&(this.shouldStoreCookies=e,e?(this.localId=Ae.getItem(_.merchantLocalId)||this.localId,this.sessionId=Ce.getItem(_.merchantSessionId)||this.sessionId):(delete this.localId,delete this.sessionId),this.initIdentity(),this.broadcastEnvironment())}initIdentity(){this.shouldStoreCookies&&(this.localId=this.localId||Ae.getItem(_.merchantLocalId),this.localId||(this.localId=re(),Ae.setItem(_.merchantLocalId,this.localId)),this.sessionId=this.sessionId||Ce.getItem(_.merchantSessionId),this.sessionId||(this.sessionId=re(),Ce.setItem(_.merchantSessionId,this.sessionId))),this.client.updateIdentity({localId:this.localId,sessionId:this.sessionId})}broadcastEnvironment(){ft.forEach((e=>{e.sendMessage(st,{identity:this.client.identity,environment:this.client.environment})}))}getDefaultEnvironment(){return{referrerURL:ke(),url:window.location.href}}updateEnvironment(e,t){void 0===t&&(t=!0),this.client.updateEnvironment(e),t&&this.broadcastEnvironment()}initDispatchers(){this.client.addListener("event",(e=>{this.allEventsDispatcher.dispatch(e),this.eventsByTypeDispatcher.dispatch(e.type,e)})),ut.addListener("analyticsEvent",(e=>{let{event:t}=e;this.allEventsDispatcher.dispatch(t),this.eventsByTypeDispatcher.dispatch(t.type,t)}))}};function ln(e){const t=e.reduce(((e,t)=>Math.max(e,t.priority||1)),1),n=(e=e.filter((e=>(e.priority||1)===t))).reduce(((e,t)=>e+(t.weight||1)),0),s=Math.random()*n;let i=0;for(const t of e)if(i+=t.weight||1,s<i)return t;return e[0]}class Condition extends Dispatchable{constructor(e,t,n){super(),this.ops=[],this.journey=e,this.options=t,this.requestReEval=()=>n()}evaluate(){return null}cleanup(){super.cleanup(),this.ops.forEach((e=>e.cleanup()))}}function dn(e,t){return class SimpleCondition extends Condition{constructor(){super(...arguments),t instanceof Dispatchable&&this.attachChangeListener(t,this.requestReEval),t instanceof Dispatcher&&this.attachListener(t,this.requestReEval)}evaluate(){return e(this.options,this.journey,this)}}}function hn(e,t,n,s,i){if(!e||!Y(e))return!1;const o=U(t||".*").map((e=>RegExp(`^${e}$`)));if(null!=U(n).map((e=>RegExp(`^${e}$`))).find((t=>t.test(e)||t.test(e+"/"))))return!1;if(null==o.find((t=>t.test(e)||t.test(e+"/"))))return!1;if(null!=s&&!(s=U(s)).find((t=>t&&en(t,e))))return!1;if(null!=i){const[t,n]=qe.call(i,e);if(!t||!n)return!1}return!0}const cn={atLeast:"atLeast",exact:"exact",atMost:"atMost"},un=dn((function(e){const t=Re.get(e.key);return e.hasOwnProperty("equal")?t===e.equal:t}),Re),pn=new Dispatcher;function mn(e,t,n){document.cookie=`${e}=${t}; path=/; max-age=${n};`,pn.dispatch()}function gn(e){let t=(document.cookie||"").split(";");for(let n of t)if(n=n.trim(),n.startsWith(e+"="))return n.substring(e.length+1);return""}const fn=dn((function(e){const t=gn(e.key);return e.hasOwnProperty("equal")?t===e.equal:t}),pn),yn=5,vn=200;let bn=!1,wn=null,Sn=new Dispatcher;const An=["pub_300x250","pub_300x250m","pub_728x90","text-ad","textAd","text_ad","text_ads","text-ads","text-ad-links","banner-ad-box","mod_ad_square","mod_ad_side","mod_ad_main","ad_title","ad_pic","banner-ad-box","ad-banner","ad960","index_ad_column2","index_ad_a6","index_ad_a5","index_ad_a4","mod_r_ad1","mod_r_ad","mod_index_ad","mod_ad_text","mod_ad_t25","index_ad_a2","hp_textlink_ad","head_ad","channel_ad_2016","ad_hover_href","adClose","top-ads","ad-bottom","ad-region","ad728x90","adCell","adVertical","adWrapper","ad_click","ad_content","ad_image","adpic","ads-image","ads_area","ads_title","adsense-right","advert-wide","advertiseText","b_adLastChild","banner-300x250","banner-728","block-ads","centered-ad","content_ad","contentad","detail-ads","google_adsense","gujAd","house-ad","internal-ad","is-sponsored","item-ad","jquery-script-ads","ligatus","middlead","native-ad","overlay-ad","related-ads","side-ads","sidead","sponsor-link","sticky-ad-wrapper","top-ads","vce-ad-below-header","vce-ad-container","video-ads","wide-ad","widget-ads"],Cn=["ad-left","adBannerWrap","ad-frame","ad-header","ad-img","ad-inner","ad-label","ad-lb","ad-footer","ad-container","ad-container-1","ad-container-2","Ad300x145","Ad300x250","Ad728x90","AdArea","AdFrame1","AdFrame2","AdFrame3","AdFrame4","AdLayer1","AdLayer2","Ads_google_01","Ads_google_02","Ads_google_03","Ads_google_04","DivAd","DivAd1","DivAd2","DivAd3","DivAdA","DivAdB","DivAdC","AdImage","AdDiv","AdBox160","AdContainer","glinkswrapper","adTeaser","banner_ad","adBanner","adAd","bannerad","ad_box","ad_channel","adserver","bannerid","adslot","popupad","adsense","google_ad","outbrain-paid","sponsored_link","adframe_wrap_ad","bunyad_ads_","l_qq_com","adzone_","sponsorText","dfp-tlb"],En={height:"1px",width:"1px",opacity:"1",position:"absolute",left:"-999px",top:"-999px"};function xn(e){wn=e,Sn.dispatch(e)}function Tn(e,t){!function(e){return!document.body.contains(e)||null!==window.document.body.getAttribute("abp")||0===e.clientHeight||0===e.clientWidth||0===e.offsetParent||0===e.offsetHeight||0===e.offsetLeft||0===e.offsetTop||0===e.offsetWidth||0===e.style.opacity||"hidden"===e.style.display||"none"===e.style.visibility}(t)?e===yn?xn(!1):setTimeout((()=>{Tn(e+1,t)}),vn):xn(!0)}function In(e){Tn(0,function(){const e=document.createElement("div");return e.id=Cn[Math.floor(Math.random()*Cn.length)],e.setAttribute("class",An.join(" ")),e.setAttribute("ad-id","googlead_"),Object.assign(e.style,En),document.body.appendChild(e),e}())}const Pn={AND:"and",OR:"or",NOT:"not"},On=e({[Pn.AND]:class AndCondition extends Condition{evaluate(){let e=!1;for(const t of this.ops){const n=t.evaluate();if(!1===n)return!1;e=e||null==n}return!e||null}},[Pn.OR]:class OrCondition extends Condition{evaluate(){let e=!1;for(const t of this.ops){const n=t.evaluate();if(n)return!0;e=e||null==n}return!!e&&null}},[Pn.NOT]:class NotCondition extends Condition{evaluate(){const e=this.ops[0].evaluate();return null==e?null:!e}},true:class TrueCondition extends Condition{evaluate(){return!0}},expr:class ExprCondition extends Condition{constructor(){super(...arguments),this.attachListener(Re,this.requestReEval)}evaluate(){return!!(new ExprEvaluator).eval(this.options.value)}},function:class FunctionCondition extends Condition{constructor(){super(...arguments),this.havePendingResult=!1,null!=this.options.event&&this.attachEventListener(window,this.options.event,this.requestReEval),null!=this.options.interval&&this.attachInterval(this.requestReEval,this.options.interval)}evaluateResult(e){return this.options.hasOwnProperty("equal")?e===this.options.equal:!!e}resolvePromiseResult(e){this.havePendingResult=!1,this.cachedResult=e,this.requestReEval()}evaluate(){if(null!=this.cachedResult)return this.evaluateResult(this.cachedResult);if(this.havePendingResult)return null;const[e,t]=qe.call(this.options.function);return e?t instanceof Promise?(this.cachedResult=null,this.havePendingResult=!0,t.then((e=>this.resolvePromiseResult(e)),(()=>this.resolvePromiseResult(null))),null):this.evaluateResult(t):null}},variable:un,device:class DeviceCondition extends Condition{attachWindowResizeListener(){this.resizeHandler||(this.resizeHandler=this.attachEventListener(window,"resize",this.requestReEval))}evaluate(){let e=!0;const{screenWidth:t,screenHeight:n,os:s,browser:i}=this.options,o=(t,n)=>{if(!n)return;const[s,i]=n;e&&(e=!s||s<=t),e&&(e=!i||t<=i)};return o(window.screen.width,t),o(window.screen.height,n),(t||n)&&this.attachWindowResizeListener(),e}},inactive:class InactiveCondition extends Condition{constructor(){super(...arguments);let e=null;const t=()=>{this.isInactive=!1,clearTimeout(e),e=this.attachTimeout((()=>{this.isInactive=!0,this.requestReEval()}),1e3*this.options.seconds)};t(),this.attachEventListener(window,"mousemove",t),this.attachEventListener(window,"scroll",t),this.attachEventListener(window,"click",t)}evaluate(){return this.isInactive}},stayOnPage:class StayOnPageCondition extends Condition{constructor(){super(...arguments),this.stayedOnPage=!1,this.attachTimeout((()=>{this.stayedOnPage=!0,this.requestReEval()}),1e3*this.options.seconds)}evaluate(){return this.stayedOnPage}},pageScroll:class PageScrollCondition extends Condition{constructor(){super(...arguments),this.attachEventListener(window,"scroll",this.requestReEval)}evaluate(){var e,t;const n=null!=(e=null==(t=window.visualViewport)?void 0:t.pageTop)?e:window.scrollY,s=null!=(i=null==(o=window.visualViewport)?void 0:o.height)?i:window.innerHeight;var i,o;const r=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);let a=!0;if(null!=this.options.amount&&a&&(a=n>=this.options.amount),null!=this.options.fraction||null!=this.options.percent){var l;const e=null!=(l=this.options.fraction)?l:this.options.percent/100;a&&(a=n/(r-s)>=e)}return a}},nthPage:class NthPageVisitCondition extends Condition{constructor(){super(...arguments);const{numPages:e=1,activationType:t=cn.atLeast,scope:n=this.journey.alias,altScope:s,timeWindow:i}=this.options;on((o=>{const r=Zt(o),a=this.testPath(r),[l,d]=nn(o,{[n]:a}),h=i?Date.now()-1e3*i:-1/0,c=[...d.values()].filter((e=>e.lastVisit>=h&&e[n])).length;Re.set(n+".count",c),s&&Re.set(s+".count",c);const u=this.cachedResult;this.cachedResult=a&&function(e,t,n){return n===cn.exact?e===t:n===cn.atMost?e<=t:e>=t}(c,e,t),function(e,t){return t===cn.exact||(t===cn.atMost?!0===e:!1===e)}(this.cachedResult,t)&&nn(o,{["numVisits."+n]:c}),null!=u&&this.requestReEval()}))}testPath(e){return hn(e,this.options.pathInclude,this.options.pathExclude,this.options.pathOneOf,this.options.filterFunction)}evaluate(){return this.cachedResult}},adBlockEnabled:dn((function(){return bn||(bn=!0,setTimeout((()=>In()),400)),wn}),Sn),userAgent:class UserAgentCondition extends Condition{evaluate(){let e=!0;return this.options.device&&e&&(e=-1!==U(this.options.device).indexOf(j()?"mobile":"desktop")),e}},utm:class UTMCondition extends Condition{evaluate(){const e=De(),t=t=>!this.options.hasOwnProperty(t)||U(this.options[t]).indexOf(e[t])>=0;for(const e of F)if(!t(e))return!1;return!0}},path:class PathCondition extends Condition{evaluate(){return hn(window.location.pathname,this.options.includePattern,this.options.excludePattern,this.options.oneOf,this.options.filterFunction)}},referrer:class ReferrerCondition extends Condition{evaluate(){return hn(ke(),this.options.includePattern,this.options.excludePattern,this.options.oneOf,this.options.filterFunction)}},cookie:fn},function(){const e=bt.exposeMerchantFunctions();for(const[t,n]of Object.entries(e))e[t]=dn(n,bt.userPreferencesChange);return e}());class ScopedActionThrottler{constructor(e,t,n){this.cachedTimestamps=[],this.throttleRules=[],this.maxCount=0,this.name=e,this.storage=t;for(const e of n)this.throttleRules.push({duration:1e3*(e.duration||1/0),count:e.count}),e.count>this.maxCount&&(this.maxCount=e.count)}execute(e){const t=Date.now();let n=this.storage.getItem(this.name)||[...this.cachedTimestamps];n.sort();for(let e of this.throttleRules){const s=n.length-e.count;if(s>=0&&t-n[s]<e.duration)return!1}return n.push(t),n.length>this.maxCount&&(n=n.slice(n.length-this.maxCount)),e||(this.cachedTimestamps=n,this.storage.setItem(this.name,n)),!0}}class SessionActionThrottler{constructor(e,t){this.throttlers=[];for(const n of Object.values(Te)){const s=t.filter((e=>e.scope===n||n===Te.PERMANENT&&!e.scope));s.length&&this.throttlers.push(new ScopedActionThrottler(e,Ie(n),s))}}execute(e){return!this.throttlers.filter((e=>!e.execute(!0))).length&&(e||this.throttlers.forEach((e=>e.execute())),!0)}}class JourneyActionRunner{constructor(e,t){void 0===t&&(t=!0);const{action:n,throttle:s}=e.options;if(this.journey=e,this.actions=U(n),t&&s){let t=ze(U(s));this.throttler=new SessionActionThrottler(e.alias+"-throttle",t)}else this.throttler=null}runAction(){for(const e of this.actions)if(e.type===P&&e.gateType===S.popup&&(Ht.isExpanded()||Ht.isPopupFlowActive()))return;if(null==this.throttler||this.throttler.execute())for(const e of this.actions)Dn(this.journey,e)}}function Dn(t,n){switch((n=ze(n)).type||O){case O:for(const e of Object.keys(n))"type"!==e&&qe.call([e,...U(n[e]),t]);break;case"blinkAction":Ln(n.blinkAction);break;case"setVariable":for(const e of Object.keys(n))"type"!==e&&Re.set(e,n[e]);break;case"editPanel":{const t=e({},n);delete t.type,delete t.panel,Ye(n.panel,t);break}case P:{const{loop:s,selector:i}=n,o=e({},n,{journeyId:t.id,journeyAlias:t.alias});delete o.loop,delete o.type,s?Kt.addRule(o):(delete o.selector,Kt.createPanel(i,o));break}}}const kn={login:e=>$t.enterFlow(w.auth,{panel:e}),donate:e=>$t.enterFlow(w.donation,{panel:e,skipCTA:bt.isAuthenticated()}),giftSubscription:e=>$t.enterFlow(w.giftSubscription,{panel:e}),subscribe:e=>$t.enterFlow(w.subscribe,{panel:e}),newsletter:e=>Kt.createPopup({panel:e,type:w.newsletter,skipCTA:!0}),setToken:e=>{try{e=function(e,t){let{jsonFormat:n=!0}={};return e=atob(e),n&&(e=JSON.parse(e)),e}(e),bt.setMerchantToken({key:e.t,expiresAt:e.e})}catch(e){console.error("Failed to set the token",e)}},markVisit:e=>rn(e),dashboard:e=>Kt.createPopup({panel:e,type:w.dashboard})};function Ln(e){Y(e)&&(e=e.split(","));for(const t of U(e)){if(!Y(t)){new JourneyActionRunner({options:{action:t},alias:"inline_journey"},!1).runAction();continue}const e=t.split("!");if(0===e.length)continue;const n=be(e[0]);n?new JourneyActionRunner(n,!1).runAction():kn[e[0]]&&kn[e[0]](...e.slice(1))}}function Nn(t,n,s){Array.isArray(n)&&(n={type:Pn.AND,ops:n}),n.exclude&&(n={type:Pn.NOT,op:e({},n,{exclude:void 0})}),("string"==typeof n||n instanceof String)&&(n={type:n});const i=On[n.type];if(!i)throw`Unknown condition type: ${n.type}`;const o=new i(t,n,s);return n.type!==Pn.AND&&n.type!==Pn.OR||(o.ops=n.ops.map((e=>Nn(t,e,s)))),n.type===Pn.NOT&&(o.ops=[Nn(t,n.op,s)]),o}class JourneyConditionEvaluator{constructor(e){this.journey=e,this.runner=new JourneyActionRunner(e);const t=Fe((()=>this.evaluate()),0),n=ze(e.options.condition||"true");this.condition=Nn(e,n,t),this.evaluate();for(const n of U(null==(s=e.options)?void 0:s.reeval)){var s;"auth"===n?bt.authenticationChange.addListener((()=>{var n;null==(n=this.condition)||n.cleanup();const s=ze(e.options.condition||"true");this.condition=Nn(e,s,t),this.evaluate()})):console.warn("Unknown reeval condition",n)}}evaluate(){const e=this.condition.evaluate();e&&this.haveEvaluatedOnce&&console.debug("Running again",this.journey),e&&this.runner.runAction(),this.haveEvaluatedOnce=!0}cleanup(){this.condition.cleanup()}}function Rn(e){const{precondition:t}=e.options;if(!t)return!0;const n=Nn(e,t,te),s=n.evaluate();return n.cleanup(),null==s?(qe.handleException(new Error(`Precondition for journey '${e.alias}' could not be evaluated synchronously.`),e.alias),!1):s}function _n(e){return new JourneyConditionEvaluator(e)}const Fn=new class UserJourneyModule{init(t){var n;t=function(t){if(!t)return[];const n=[];for(let s of t){const t=[];for(const n of U(s)){if(!n)continue;let s=be(n.alias||n);s&&(Y(n)||(delete n.options,s=e({},s,n)),t.push(s))}t.length>0&&n.push(t)}return n}(t);const s=Ae.getItem(_.selectedUserJourneys),i=new Set(null!=(n=null==s?void 0:s.aliases)?n:[]),o={};for(const e of t){let t=e.filter(Rn);if(0===t.length)continue;for(const e of t)if(i.has(e.alias)){t=[e];break}const n=ln(t);i.add(n.alias),Ae.setItem(_.selectedUserJourneys,{aliases:[...i]}),e.length>1&&(o[n.alias]=n.id),Object.keys(o).length&&an.updateEnvironment({journeys:o}),_n(n)}}};function Mn(e){return e?Q(e)?(e.panel=e.panel||e.pgId||e.panelId||e.panelAlias,e):{panel:e}:{}}let Bn=null;const jn={build:a,time:new Date(l)};let Wn=null,qn=!1,Un=!1;const zn=new class BlinkSDK{constructor(){this.PANEL_TYPE=w,this.GATE_TYPE=S,this.GATE_COVER_PANEL_POSITION=A,B("sdkJS"),Object.assign(Le,e({},bt.exposeMerchantFunctions(),{chooseRandom:e=>e&&e[Math.floor(e.length*Math.random())],isURLViewed:sn,screenWidth:ae,isSmallScreen:le,getQueryParam:oe,setCookie:mn,getCookie:gn,getVariable:e=>Re.get(e),hasVariable:e=>Re.has(e),setVariable:(e,t,n)=>Re.set(e,t,n),deleteVariable:e=>Re.delete(e),addVariables:e=>Re.add(e),createPanel:(t,n)=>{const{loop:s,selector:i}=t;t=e({},t),n&&(t.journeyId=n.id,t.journeyAlias=n.alias),delete t.loop,s?Kt.addRule(t):(delete t.selector,Kt.createPanel(i,t))},editPanel:t=>Ye(t.panel,e({},t,{panel:void 0})),runBlinkAction:Ln})),an.init(),bt.init(),zt.init(),Ht.init(),Kt.init(),$t.init(),ut.addListener("widgetDataLoaded",(()=>{ct(at,M),window.dispatchEvent(new CustomEvent("blinkSDKSetup",{})),Wn.journeys&&Fn.init(Wn.journeys),Kt.resolvePendingRequests(),zt.resolvePendingRequests(),Ln(oe("blinkaction")),window.dispatchEvent(new CustomEvent(v,{})),Un=!0}));const t=function(){try{return new URL(document.currentScript.src).searchParams.get("clientId")}catch(e){return null}}();t&&this.init({clientId:t})}doInit(t){Wn=e({storeAnalyticsCookies:!0},function(){const e=me("MerchantSDKSettings")[0];return(null==e?void 0:e.options)||{}}(),t),Wn.allowUserToCoverFees&&gt.update({allowUserToCoverFees:Wn.allowUserToCoverFees}),Wn.variables&&Re.add(Wn.variables),an.setEnableStorage(!!Wn.storeAnalyticsCookies),gt.update({hideWallet:!!Wn.hideWallet}),Ht.renderWallet(Wn.widgetPositionYOffset),window.dispatchEvent(new CustomEvent("blinkPaywallInitialized",{})),B("sdkInit")}async init(e){qn||(qn=!0,async function(e){var t;const n=oe("blinkversion"),s=n?e+"."+n:e,i=(r||o)+"/public_data."+s+".json";try{const e=await fetch(i);ue=await e.json()}catch(e){return void console.error("[BlinkSDK] Failed to load settings")}const a=me("Merchant",null);ce=null==(t=a.find((t=>t.id==e||t.alias==e)))?void 0:t.id,ce?(B("publicData"),pe.dispatch(ue)):console.error("[BlinkSDK]: Unrecognized clientId or invalid settings version:",s)}(e.clientId||e.publisherDomainId),pt.addListener((e=>{Bn=e,B("iFrameJS")})),await Promise.all([pt.awaitOnce(),pe.awaitOnce()]),this.doInit(e))}isInitialized(){return Un}setOptions(e){qn?gt.update(e):this.init(e)}requestPayment(e,t,n){void 0===t&&(t=te),void 0===n&&(n=te),zt.requestPayment(e,t,n)}createPanel(e,t){Kt.createPanel(e,Mn(t))}createPopup(e){Kt.createPopup(Mn(e))}promptAuth(e){$t.enterFlow(w.auth,Mn(e))}promptSubscription(e){$t.enterFlow(w.subscribe,Mn(e))}promptGiftSubscription(e){$t.enterFlow(w.giftSubscription,Mn(e))}promptDonation(e){$t.enterFlow(w.donation,Mn(e))}promptShop(e){$t.enterFlow(w.shop,Mn(e))}promptEmailNewsletter(e){$t.enterFlow(w.newsletter,Mn(e))}promptManageAccount(t){this.createPopup(e({},Mn(t),{type:w.dashboard}))}getUserData(){return bt.userData}isAuthenticated(){return bt.isAuthenticated()}isSubscribed(){return bt.isSubscriber()}getSubscription(){return bt.userData.subscription}getStore(e){return me(e)}onAuthenticationChange(e,t){void 0===t&&(t=!1);const n=()=>e({authenticated:this.isAuthenticated()});if(bt.authenticationChange.addListener(n),t)if(Un)n();else{const e=()=>{n(),window.removeEventListener(v,e)};window.addEventListener(v,e)}}onSubscriptionChange(e){bt.subscriptionChange.addListener((()=>e(bt.userData.subscription)))}setAnalyticsStorageEnabled(e){an.setEnableStorage(!!e)}showWallet(){this.setOptions({hideWallet:!1})}hideWallet(){this.setOptions({hideWallet:!0})}hasVariable(e){return Re.has(e)}getVariable(e){return Re.get(e)}setVariable(e,t,n){return void 0===n&&(n=Te.MEMORY),Re.set(e,t,n)}evaluatePanelOptions(e){return Xe({panel:e})}allVariables(){return Re.all()}hasFunction(e){return!!qe.get(e)}getFunction(e){return qe.get(e)}addFunction(e,t){return qe.add({[e]:t})}addFunctions(e){return qe.add(e)}callFunction(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return qe.call(e,...n)}allFunctions(){return qe.all()}getExceptionHandler(){return qe.exceptionHandler}setExceptionHandler(e){const t=qe.exceptionHandler;return qe.exceptionHandler=e,t}sendAnalyticsEvent(e){ct(dt,e)}addAnalyticsEventListener(e,t){const n=function(){try{t(...arguments)}catch(e){console.error(e)}};return"*"===e?an.allEventsDispatcher.addListener(n):an.eventsByTypeDispatcher.addListener(e,n)}getSplitJourneys(){var e;return null==(e=an.client)||null==(e=e.environment)?void 0:e.journeys}getBuildVersion(){return{sdkVersion:jn,widgetVersion:Bn}}printBuildVersion(){const e=this.getBuildVersion(),t=(e,t)=>{console.group(e),console.log("build: ",t.build),console.log("time: ",t.time),console.log("age: ",function(e){const t=Date.now()-e,n=36e5,s=864e5,i=parseInt(t/s,10),o=parseInt(t%s/n,10),r=parseInt(t%n/6e4,10);let a=`${r} minute${1===r?"":"s"} ago`;return(i||o)&&(a=`${o} hour${1===o?"":"s"}, `+a,i&&(a=`${i} day${1===i?"":"s"}, `+a)),a}(t.time)),console.groupEnd()};t("Blink SDK",e.sdkVersion),t("Iframe",e.widgetVersion)}runAction(e){Ln(e)}markURLVisited(e,t){rn(e,t)}testJourneyOptions(e){const t="test_journey_id_"+re().replace(/-/g,"_"),n="test_journey_alias_"+re().replace(/-/g,"_"),s=_n({id:t,alias:n,options:e});return{id:t,alias:n,cleanup:()=>null==s?void 0:s.cleanup()}}getUserMetadata(e){void 0===e&&(e=null);const{metadata:t}=this.getUserData();return null!=e?t[e]:t}async setUserMetadata(e){Ht.widget.sendMessage("editMerchantUserMetadata",{metadata:e,merchantId:fe()})}async attemptAuth(e){}setEnableAnalyticsStorage(e){this.setAnalyticsStorageEnabled(e)}promptSubscriptionPopup(e){this.promptSubscription(e)}promptGiftSubscriptionPopup(e){this.promptGiftSubscription(e)}promptDonationPopup(e){this.promptDonation(e)}onSubscriptionStatusChange(e){this.onSubscriptionChange((t=>e({subscribed:!!t})))}};return null==self.blink&&(self.blink=zn),zn}();
//# sourceMappingURL=blink-sdk.js.map
