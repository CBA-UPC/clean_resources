VK.Share.count(0, 1);ject"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var s in r)("object"==typeof exports?exports:e)[s]=r[s]}}(self,(function(){return function(){var e={5630:function(e,t,r){r(223),r(63783),r(48305),r(98837)},21158:function(e,t,r){r(36354),r(60977)},70139:function(){!function(e){e.mediaPoll=e.mediaPoll||{},e.mediaPoll.offsetTop=20}(window)},915:function(e,t,r){r(66201),r(85978),r(60795)},66201:function(){!function(e,t,r){"use strict";var s=r.Basic,n=r.Mixins,i=s.getModel,o=s.Extend;i(function(){function e(e){var t=this._opts.storage;-1!==((this._storageTools=new r.Tools.LocalStorage(t.options)).getItem(t.subscribedChroniclesIds)||[]).indexOf(e.chronicle_id.toString())&&this.setState({is_subscribed:1})}function t(e){e=e||{};var t=this._opts,r=this._state,s=t.urls,n=this.isSubscribed()?s.unsubscribe:s.subscribe,i=o(!0,{},t.requestParams,e),a=t.transport||this.transport;r.loading||(r.loading=!0,this._trigger("loading"),n&&a({url:n,data:i,method:"POST",csrf:!0}).then(function(e){1===e.status&&e.data?(this.setState({loading:!1,email:e.email,chronicle_id:e.data.chronicle.id,chronicle_title:e.data.chronicle.title,chronicle_action:"pending",is_subscribed:1}),this._trigger("update")):this._trigger("error")}.bind(this),function(){r.loading=!1,this._trigger("error")}.bind(this)))}return{_Events:["loading","update","error"],_mixins:[n.transport],_Init:function(t){t=t||{},this._state={is_subscribed:0},e.call(this,t)},isSubscribed:function(){var e=this._state.is_subscribed;return void 0===e?null:1===e},toggle:function(e){t.call(this,e)},setState:function(e){this._state=o(this._state,e)},getState:function(){return o(!0,{},this._state)},update:function(e){var t=this._opts.storage,s=this._storageTools=new r.Tools.LocalStorage(t.options),n=s.getItem(t.subscribedChroniclesIds)||[];"reject"==e.chronicle_action?-1!==n.indexOf(e.chronicle_id.toString())&&(n=n.filter((function(t){return t!==e.chronicle_id.toString()})),s.setItem(n,!1,t.subscribedChroniclesIds),this.setState({is_subscribed:0,chronicle_action:e.chronicle_action,chronicle_id:e.chronicle_id})):"confirm"==e.chronicle_action&&this.setState({chronicle_action:e.chronicle_action,chronicle_id:e.chronicle_id}),this._trigger("update")}}}(),{urls:{subscribe:null,unsubscribe:null},transport:null,requestParams:{},storage:{options:{root:"ru.mail.newsletter",defaultKeySuffix:"subscribedChronicles"},subscribedChroniclesIds:"subscribedChronicles.ids",subscribedChroniclesEmail:"subscribedChronicles.email"}},null,"NewsletterModel")}(window.jQuery||window.$,window,window.ru.mail.cpf)},85978:function(){!function(e,t,r){"use strict";var s="NewsletterView",n=r.Basic.getView,i=r.Basic.moduleOpts.setParams,o=r.Types.String.Url.getParams,a=r.Tools.getTemplate,l={cssSels:{Main:{button:".js-newsletter__button",toggleElem:".js-newsletter__toggle"}},cssClss:{subscribed:"button_toggle"},paramName:null,toggleParent:!1,checkOnInit:!1,templates:{alert:a("ct-popup-alert.xml"),subscribe:a("ct-popup-chronicle-subscribe.xml")},texts:null};n(function(){function e(){var e=this._elems,t=this._opts.cssClss,r=this._model,s=e.toggleElem,n=r.isSubscribed();(s||{}).length&&null!==n&&s.toggleClass(t.subscribed,n)}return{_Events:["noAuth","checkUser"],_Handlers:{dom:{"submit:Main.form":function(e){e.preventDefault();var t=this._elems,r=this._opts,s=this._model,n=r.cssClss,i=t.input,o=i.find("input").val(),a=/^.+@[\\.\w-]+$/.test(o);if(i.toggleClass(n.inputInvalid,!a),a){var l={email:o};s.toggle(l)}}},model:{update:e}},_Init:function(){var r=this._opts,s=this._model,n=this._elems;if(n.toggleElem=r.toggleParent?n.parent:n.toggleElem,r.checkOnInit&&this._trigger("checkUser"),e.call(this),t.location.search){var i=t.location.origin+t.location.pathname,a=o(t.location.search);a&&a.hasOwnProperty(r.paramName)&&(s.update(a),t.history.replaceState(null,null,i))}}}}(),l,null,s),i(s,{acceptTypes:["NewsletterModel"]})}(window.jQuery||window.$,window,window.ru.mail.cpf)},98837:function(){!function(e,t,r){"use strict";var s=r.Basic.moduleOpts,n=r.Tools;s.setParams("AsyncForms",{options:{cssClss:{serverError:"popup_error",fieldsError:"popup__form_error",sentSuccess:"popup_done"},transport:function(e){return e.csrf=!0,e.type="POST",n.transport(e)}}})}(window.jQuery,window,window.ru.mail.cpf)},60977:function(){!function(e,t,r){"use strict";var s=r.Tools;r.Basic.moduleOpts.setParams("FoundMistake",{options:{templates:{form:"ct-popup-mistake.xml"},attrs:{mistakeId:"data-mistake-id",mistakeType:"data-mistake-type",mistakeUrl:"data-mistake-url"},onPrepareParams:function(e){var t=this._opts.attrs,r=t.mistakeId,s=t.mistakeType,n=t.mistakeUrl,i=this._elems.parent.get(0),o=i.getAttribute(r),a=i.getAttribute(s),l=i.getAttribute(n);return e.templateParams=e.templateParams||{},e.templateParams.id=o,e.templateParams.type=a,e.serverApi.send.url=l,e},transport:function(e){return e.csrf=!0,e.type="POST",s.transport(e)}}})}(window.jQuery,window,window.ru.mail.cpf)},60795:function(){!function(e,t,r){"use strict";var s=r.Basic,n=s.moduleOpts.setParams,i=s.typeOf,o=s.Constructors._repo.get("Popup");function a(t){var r=this._opts.templates.alert;r&&t&&(this._alertPopup=new o(null,e(r(t))),this._alertPopup.show())}n("NewsletterView",{options:{cssSels:{Main:{form:".js-newsletter__form",input:".js-newsletter__input"}},cssClss:{subscribed:"hidden",inputInvalid:"error"}}}),n("NewsletterView.Chronicle",{options:{_Handlers:{model:{update:function(){var e=this._opts,t=this._elems,r=this._model,s=r.getState(),n=r._storageTools,o=r._opts.storage,l={},c=s.chronicle_id.toString();if("pending"==s.chronicle_action){var u=n.getItem(o.subscribedChroniclesIds)||[];i(u,"array")||u.split(","),u.push(c),n.setItem(u,!0,o.subscribedChroniclesIds),n.setItem(s.email,!0,o.subscribedChroniclesEmail),l={title:"Рассылка новостей темы",text:"<p>Вы успешно подписались на рассылку новостей по теме:</p><p><strong>"+s.chronicle_title+".</strong></p><p>Проверьте, пожалуйста, свою почту и подтвердите рассылку</p>"}}else"confirm"==s.chronicle_action?l={title:"Подтверждение подписки",text:"<p>Подписка успешно подтверждена</p>"}:"reject"==s.chronicle_action&&(l={title:"Удаление подписки",text:"<p>Вы успешно отписались от рассылки</p>"});t.parent.toggleClass(e.cssClss.subscribed,r.isSubscribed()),a.call(this,l)}}},paramName:"chronicle_action",toggleParent:!0}})}(window.jQuery||window.$,window,window.ru.mail.cpf)},48305:function(){var e,t,r,s,n,i,o,a,l,c,u,p,d;e=window.jQuery||window.$,window,t=window.ru.mail.cpf,r=t.Basic,s=r.typeOf,n=r.Extend,i=r.getByPath,o=t.Tools,a=o.Forms.Validation,l=a.getInvalidFields,c=a.processInvalidFields,u="AsyncForms",p={cssSels:{Form:"form",Fields:"input",errorMessage:".js-form__error-message"},cssClss:{serverError:"",fieldsError:"",sentSuccess:""},serverApi:{initial:{url:null,callback:null,addParams:null,prepare:null},send:{url:null,addParams:null,prepare:null},response:{errorMessage:"errors._form",errorField:"errors"}},validate:{prepare:null},Templates:{block:null,form:null},clearOnShow:null,validateOnChange:!0,templateParams:null,popupOpts:null,initBlock:null,prepareHeaders:null,popupExt:"asyncForm",transport:function(){return o.transport.apply(e,arguments)}},d=r.Constructors.getView(function(){var r,o=!1;function a(e,t,n){var i=this._opts,a=this._Elems,l=a.Form,u=a.errorMessage,p=!!e&&(s(e,"object")||e.length>0)||s(n,"string")&&n.length>0;!t&&p||(n?(u||(a.errorMessage=u=a.Parent.find(i.cssSels.errorMessage),r=u.text()),o=!0,u.text(n)):o&&(o=!1,u.text(r)),l.toggleClass(i.cssClss.fieldsError,p)),c(l,e,t),this._trigger("fieldsProcessed",e,t,n)}function u(){var e=this._opts,t=e.serverApi.initial,r=t.url,i=t.callback,o=t.addParams,a=t.prepare,l=s(i,"function"),c=s(e.prepareHeaders,"function");s(a,"function")&&(o=a.call(this,o)),(r?e.transport({type:"GET",url:r,dataType:"json",data:o,headers:c?e.prepareHeaders.call(this):{}}):Promise.resolve()).then(function(e){e=n(o,e),l?i.call(this,e).then(p.bind(this)).then(d.bind(this)):p.call(this,e).then(d.bind(this))}.bind(this))}function p(e){return Promise.resolve({server:e,template:this._opts.templateParams})}function d(e){var r=this._elems,s=this._opts,n=s.initBlock;return Promise.resolve(s.Templates.form).then(function(){this._Popup=t.Tools.initModule(["Popup",s.popupExt],null,{templates:{parent:s.Templates.form}},e),r.parent=this._Popup.getBlockElement(),r.Form=null,this._Overlay=this._Popup.getOverlay(),this._Popup.on("show",f.bind(this,!0)),this._Popup.on("hide",f.bind(this,!1)),this._getElements(s.cssSels.Form,"Form"),this._bindHandlerSet("Form"),t.Tools.initModules(r.parent,null,e),n&&n.call(this,r.parent,e),h.call(this)}.bind(this))}function h(){var e=this._elems,t=this._opts,r=t.cssClss;t.clearOnShow&&(e.Form.removeClass(r.fieldsError).get(0).reset(),e.parent.removeClass(r.sentSuccess)),e.parent.removeClass(r.serverError),this._Popup.show()}function f(e){var t=this._opts;if(e){var r=this._getElements(t.cssSels.Fields,this._Elems.Form,"fields"),s=t.popupOpts&&t.popupOpts.onShow;r&&r.not(":disabled,[type=hidden]").first().focus(),s&&s.call(this)}else t.clearOnShow&&(this._Popup.destroy(),this._Popup=null);this._trigger(e?"show":"hide")}function m(){for(var e,t,r,n=this._elems.Form.serializeArray(),i={},o=0,a=n.length;o<a;o++)(e=n[o]).value&&(r=i[t=e.name],i[t]=(s(r,"undefined")?"":r+",")+e.value);return i}function g(e,t){var r,n,o,l,c=this._opts,u=c.cssClss,p=this._Elems.Parent;!0===e&&(e=(r=s(t,"object"))&&!!t.status),e||r&&(o=[n=i(c.serverApi.response.errorField,t),!0],(l=i(c.serverApi.response.errorMessage,t))?o.push(l):s(n,"array")||s(n,"object")||(o=null)),o?a.apply(this,o):p.toggleClass(u.serverError,!e).toggleClass(u.sentSuccess,e),this._trigger("formSent",e,t)}return{_Events:["show","hide","formSubmit","formSent","fieldsProcessed"],_Handlers:{"set:Form":{submit:function(e){var t,r,i=this._opts,o=this._elems,c=o.parent,u=o.Form,p=i.serverApi.send,d=p.prepare,h=m.call(this),f=i.validate.prepare,_=s(i.prepareHeaders,"function");e.preventDefault(),s(f,"function")&&f.call(this,u,c),(t=l(u)).length||(n(h,p.addParams),(h=d?d.call(this,h):Promise.resolve(h)).then(function(e){e&&(r=i.transport({url:p.url||u.attr("action"),dataType:"json",data:e,headers:_?i.prepareHeaders.call(this):{},type:u.attr("method")||"GET"}).then(g.bind(this,!0),g.bind(this,!1)),this._Overlay.showLoading(r),this._trigger("formSubmit",n({},e)))}.bind(this))),a.call(this,t,!0)},"change:Fields":function(){var e=this._opts;if(!1!==e.validateOnChange){var t=this._elems,r=t.parent,n=t.Form,i=e.validate.prepare;s(i,"function")&&i.call(this,n,r),a.call(this,l(r),!1)}}}},_parentElement:function(){var t=this._opts.Templates.block,r=s(t,"function")?t.call(this):"<div />";return e(r)},_Init:function(){if(!s(this._opts.Templates.form,"function"))throw new TypeError("Can not continue without form template");this._Popup=null,this._Overlay=null},Show:function(){this._Popup?h.call(this):u.call(this)},Hide:function(){this._Popup&&this._Popup.hide()}}}(),p,null,u),r.moduleOpts.registerModule(u,(function(e){return new d(e)})),n(!0,t,{Modules:{AsyncForms:d}})},36354:function(){!function(e,t,r){"use strict";var s=r.Basic,n=r.Tools.getTemplate,i="FoundMistake",o={url:"/ajax/feedback/",templates:{form:"ct-feedback.xml"},onPrepareParams:null,selectorExcluded:[],selectorExcludedCheck:function(t){return this._opts.selectorExcluded.some((function(r){return e(t.target).hasClass(r)}))}};s.getView(function(){function s(){var r,s,n,i,o,a=!("getSelection"in t),l=a?document.selection.createRange():t.getSelection(),c=e(a?l.parentElement():l.anchorNode);this._elems.selectionParent=c;var u=this._Elems.Parent[0],p=/\.\S[\w-\s\.\,]*\{[^\}]*\}/g,d=/@media[^\}]*\}/g;if(!c.closest(this._Elems.Parent).length||"None"===l.type)return!1;if(a)l.expand("word"),(r=t.document.selection.createRange()).moveStart("character",-20),r.setEndPoint("EndToStart",l),r.expand("word"),s=r.text,r.moveEnd("character",20),r.setEndPoint("StartToEnd",l),r.expand("word"),n=r.text,i=l.text;else{if(!l.getRangeAt)return!1;o=l.getRangeAt(0),(r=document.createRange()).setStartBefore(u),r.setEnd(o.startContainer,o.startOffset),(s=r.toString().replace(p,"").replace(d,"")).length>30&&(s=s.substr(s.length-30).replace(/^\S{1,10}\s+/,"")),r.setStart(o.endContainer,o.endOffset),r.setEndAfter(u),(n=r.toString().replace(p,"").replace(d,"")).length>30&&(n=n.substr(0,30).replace(/\s+\S{1,10}$/,"")),i=l.toString()}return{text:[s,"[",i,"]",n].join("").replace(/\r?\n?/g,""),selectionText:i}}return{_Events:[],_Handlers:{dom:{"keydown:document":"_onKeydown"}},_onKeydown:function(e){if(e.ctrlKey&&13==e.keyCode){var i=this._opts,o=i.selectorExcludedCheck,a=i.selectorExcluded;if("function"==typeof o&&a.length&&o.call(this,e))return!1;var l=s.call(this);if(e.preventDefault(),l.text){var c={serverApi:{send:{url:i.url}},Templates:{form:n(i.templates.form)},validateOnChange:!1,templateParams:{mistake:!0,lnk:t.location.href,text:l.text,isBigMsg:l.selectionText.length>90}};"function"==typeof i.onPrepareParams&&(c=i.onPrepareParams.call(this,c)),new r.Modules.AsyncForms(c,null).Show()}}}}}(),o,null,i),s.moduleOpts.setParams({paramAttrs:{url:"data-action"}}),s.Extend(!0,r,{Modules:{FoundMistake:i}})}(window.jQuery||window.$,window,window.ru.mail.cpf)},63783:function(){!function(e,t){var r=t.Basic,s=r.moduleOpts,n=r.typeOf,i=r.Extend,o={cssClss:{invalidField:"invalid"},cssSels:{fieldCont:".js-field__cont",fieldErrorText:".js-field__error",Input:"input,textarea,select,button"},Attrs:{errorText:"data-errortext",patternOptions:"data-pattern-opts"}},a=["required","pattern"],l=["checkbox","radio"];function c(e){return i(!0,{},o,s.get("Validation"),e)}function u(e,t){var r=c(t),s=r.cssSels,n=[],i={};for(var o in[].forEach.call(e.find(s.Input),(function(e){var t,s,n=e.getAttribute("name"),o={},c=!1;if(!e.disabled&&!0!==i[n]){for(var u=a.length;u--;)t=a[u],e.hasAttribute(t)&&(c=!0,o[t]=e.getAttribute(t),"pattern"===t&&r.Attrs.patternOptions&&(o.patternOptions=e.getAttribute(r.Attrs.patternOptions)));c&&(s=e.value,l.indexOf(e.type)>-1&&(s=e.checked?s:""),i[n]=function(e,t){var r,s,n=!0;if(""===e&&!("required"in t))return!0;for(var i=0;i<a.length;i++)if(s=a[i],t.hasOwnProperty(s))switch(s){case"required":n=n&&null!==e&&e.length>0;break;case"pattern":if((r=t[s]).length)try{n=new RegExp(r,t.patternOptions||"igm").test(e)}catch(e){n=!0}}return n}(s,o))}})),i)i.hasOwnProperty(o)&&!1===i[o]&&n.push(o);return n}function p(e,t,r){var s;n(r,"object")?s=r.markInvalid:(s=r,r=null);var i=c(r),o=i.cssSels,a=i.cssClss.invalidField,l=i.Attrs,u=o.fieldCont,p=!!t,d=p&&Array.isArray(t);[].forEach.call(e.find(u).add(e.filter(u)),(function(e){var r,n,i=!1,c=Array.prototype.slice.call(e.querySelectorAll(o.Input)).map((function(e){var r=e.getAttribute("name"),s=p&&(d?t.indexOf(r)>-1:r in t);return i=i||s,s&&!d&&t[r]||null}));if(i){if(!s)return;(r=e.querySelector(o.fieldErrorText))&&((n=r.getAttribute(l.errorText))||(n=r.innerText,r.setAttribute(l.errorText,n)),r.innerText=!d&&c.join("")||n)}a.split(" ").forEach((function(t){e.className=e.className.replace(new RegExp("(?:^|[^S])"+t+"(?=[^S]|$)","ig"),"").replace(/^\s/,"")+(i?" "+a:"")}))}))}i(!0,t,{Tools:{Forms:{Validation:{getFieldCont:function(e){var t=c();return e.closest(t.cssSels.fieldCont)},processInvalidFields:p,getInvalidFields:u,validateFields:function(e,t){var r=u(e,t);return p(e,r,i({markInvalid:!0},t)),r}}}}})}(window,window.ru.mail.cpf)},223:function(){!function(e,t){"use strict";var r,s,n=t.Basic.typeOf,i=t.Basic.Extend,o=["setSelectionRange","createTextRange","createRange"],a=!!(o[0]in document.createElement("input")),l=a?function(){return[this.selectionStart,this.selectionEnd]}:function(){var e=document.selection,t="INPUT"===this.tagName;if(e&&o[2]in e){var r=e[o[2]](),s=(t?this.value:this.text).length,n=r.duplicate();r.parentElement()!==this&&this.focus();var i=s-n.moveEnd("character",s);return[i-r.text.length,i]}},c=(r=function(e){var t=parseInt(e[0])||0,r=parseInt(e[1]);return isNaN(r)?[t,t]:[t,r]},a?function(){var e=Array.prototype.slice.call(arguments);this[o[0]].apply(this,r(e))}:function(){var e=Array.prototype.slice.call(arguments);if(o[1]in this){var t=this[o[1]](),s=r(e);t.collapse(!0),t.moveEnd("character",s[1]),t.moveStart("character",s[0]),t.select()}}),u=(s=function(t,r){if(t){var s=document.createElement("option"),i=t._attrs;if(n(i,"object"))for(var o in delete t._attrs,i)i.hasOwnProperty(o)&&s.setAttribute(o,i[o]);for(var a in t)if(t.hasOwnProperty(a)&&a in s)try{s[a]=t[a]}catch(t){e.DEBUG&&e.console.log('Unable to set HTMLOptionElement property "'+a+'"')}"text"in t||(s.text=s.title||r.getAttribute("data-title")),""===s.innerHTML&&(s.innerHTML=s.text),r.appendChild(s)}},function(e,t,r){var i,o,a,l=n(t,"function"),c=0;for(r=r||document.createElement("select");i=e[c++];)if(a=null,l&&(i=t(i)),Array.isArray(o=i.values)){n(i.title,"string")&&((a=document.createElement("optgroup")).setAttribute("title",i.title),a.setAttribute("label",i.title),i.value&&a.setAttribute("data-value",i.value),i.selected&&a.setAttribute("data-selected",""),r.appendChild(a));for(var u=0;u<o.length;u++)i=o[u],l&&(i=t(i)),s(i,a||r)}else n(i.value,"undefined")||s(i,r);return r});i(!0,e.getNameSpace("Tools.Forms",t),{Text:{getSelection:l,setSelection:c},Select:{createSelect:u}})}(window,window.ru.mail.cpf)}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,r),i.exports}return r(70139),r(915),r(5630),r(21158),{}}()}));
//# sourceMappingURL=page-news.js.map