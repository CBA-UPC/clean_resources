SWR.Newsletter=function(e){var t,a="newsletter",n="swr."+a,r="."+n,i=e.fn[a],s="8080"===window.location.port?"/cms/system/servlet/captcha.servlet":"/system/servlet/captcha.servlet",l=window.isFractal?`https://www.swr.de${s}`:`${window.location.protocol}//${window.location.host}${s}`,o="8080"===window.location.port?"/cms/system/servlet/newsletter.servlet?target=js":"/system/servlet/newsletter.servlet?target=js",d=window.isFractal?`https://www.swr.de${o}`:`${window.location.protocol}//${window.location.host}${o}`,c='[data-spy="newsletter"]',u=null,p=!1,m=0,f={},h=[{name:"rp",addressInterfaceId:"18096",headerCaption:"Newsletter abonnieren",headline:"SWR Aktuell Newsletter - jetzt abonnieren",text:'Morgens direkt auf dem neuesten Stand sein? Mit dem Newsletter "SWR Aktuell - der Morgen in Rheinland-Pfalz" landen die Nachrichten montags bis freitags direkt im Mailpostfach.',paths:["/swraktuell/swraktuell-rp-100.html","/swraktuell/rheinland-pfalz/index.html"],startDates:[new Date("Oct 16, 2023 00:00:00").getTime(),new Date("Oct 30, 2023 00:00:00").getTime()],endDates:[new Date("Oct 23, 2023 00:00:00").getTime(),new Date("Nov 11, 2023 00:00:00").getTime()],timespan:!0,cssClass:"modal-swraktuell"},{name:"bw",addressInterfaceId:"18103",headerCaption:"Newsletter abonnieren",headline:"SWR Aktuell Newsletter - jetzt abonnieren",text:'Morgens direkt auf dem neuesten Stand sein? Mit dem Newsletter "SWR Aktuell - der Morgen in Baden-Württemberg" landen die Nachrichten montags bis freitags direkt im Mailpostfach.',paths:["/swraktuell/swraktuell-bw-100.html","/swraktuell/baden-wuerttemberg/index.html"],startDates:[new Date("Oct 16, 2023 00:00:00").getTime(),new Date("Oct 30, 2023 00:00:00").getTime()],endDates:[new Date("Oct 23, 2023 00:00:00").getTime(),new Date("Nov 11, 2023 00:00:00").getTime()],timespan:!0,cssClass:"modal-swraktuell"},{name:"aktuell",addressInterfaceId:"17126",headerCaption:"Newsletter abonnieren",headline:"SWR Aktuell Newsletter - Der Tag im Südwesten - jetzt abonnieren",text:"Sie möchten auf dem Laufenden bleiben, was im Südwesten passiert? Dann abonnieren Sie den SWR Aktuell Newsletter - Der Tag im Südwesten. Montag bis Freitag kommt der Newsletter nachmittags zu Ihnen.",paths:["/swraktuell/swraktuell-100.html","/swraktuell/index.html"],structureNode:"/swraktuell/",triggerByElement:'aside a[href="/swraktuell/newsletter-anmeldung-100.html"]',cssClass:"modal-swraktuell",extraHtml:'<fieldset class="form-fieldset form-fieldset-radio"><legend class="form-fieldset-legend">Welches Bundesland interessiert Sie besonders?</legend><div class="radio" data-required="false"><label for="badenwuerttemberg"><input type="radio" id="badenwuerttemberg" name="regionale_praeferenz" aria-invalid="false" value="Baden-Württemberg" required><span class="form-control-indicator"></span>Baden-Württemberg</label></div><div class="radio" data-required="false"><label for="rheinlandpfalz"><input type="radio" id="rheinlandpfalz" name="regionale_praeferenz" aria-invalid="false" value="Rheinland-Pfalz" required><span class="form-control-indicator"></span>Rheinland-Pfalz</label></div><div class="radio" data-required="false"><label for="beide"><input type="radio" id="beide" name="regionale_praeferenz" aria-invalid="false" checked value="Beide Bundesländer" required><span class="form-control-indicator"></span>Beide Bundesländer</label></div></fieldset><input type="hidden" name="userDetails" value="regionale_praeferenz">'}],w=function(){function a(t){var a=this;a.element=t,a.$element=e(a.element),e(document).on("swr:newsletter:show",(function(e,t){if(t=null!=t&&t,!window.isFractal){if(COMMON.Storage.local.getItem("newsletter."+f.name+".overlay.abonniert"))return!1;var n=COMMON.Storage.local.getItem("newsletter."+f.name+".overlay");if(!0!==t&&n)return!1}p||COMMON.isOpen||a._initCaptcha()})),e(document).on("swr:newsletter:show:custom",(function(e,t){if(!p&&!COMMON.isOpen){if(t){for(var n=0;n<h.length;n++)if(h[n].name===t){f=h[n];break}if(0===Object.keys(f).length)return void console.log("Keine Region übergeben")}a._initCaptcha()}})),a._checkType()}return a.prototype._checkType=function(){switch(u){case"inline":console.log("Newsletter auf der Seite - kein Overlay"),this._bindEvents();break;case"overlay":console.log("Kein Newsletter auf der Seite - Overlay anzeigen"),this._createOverlay()}},a.prototype._createOverlay=function(){var t=SWR.Util.getNow();if(COMMON.Browser.isBot)console.log("Newsletter-Modal should not be displayed");else{window.isFractal&&(h[2].timespan&&(h[2].startDates=[(new Date).getTime(),(new Date).getTime()+2e3],h[2].endDates=[(new Date).getTime()+1e3,(new Date).getTime()+3e3]),h[2].hasOwnProperty("triggerByElement")&&h[2].hasOwnProperty("structureNode")&&-1!==window.location.search.indexOf("structureNode=true")?h[2].structureNode=window.location.pathname:-1===window.location.search.indexOf("structureNode=true")&&-1!==window.location.search.indexOf("showNewsletter=true")&&(f=h[2]));for(var a=0;a<h.length;a++)if(h[a].paths.includes(window.location.pathname)){f=h[a];break}if(0===Object.keys(f).length)for(var n=0;n<h.length;n++){if(h[n].hasOwnProperty("triggerByElement")&&h[n].hasOwnProperty("structureNode"))if(-1!==window.location.pathname.indexOf(h[n].structureNode))0!==e(h[n].triggerByElement).length&&(f=h[n])}if(console.log(f),0!==Object.keys(f).length){if(f.timespan&&f.hasOwnProperty("startDates")&&f.hasOwnProperty("endDates")){if(t<f.startDates[0])return void console.log(`Startdatum (${new Date(f.startDates[0]).toDateString()}) noch nicht erreicht.`);if(t<f.startDates[1]&&t<f.endDates[0])console.log(`Woche 1: Overlay sichtbar. Von ${new Date(f.startDates[0]).toDateString()} bis ${new Date(f.endDates[0]).toDateString()}`);else{if(t<f.startDates[1]&&t>f.endDates[0])return void console.log(`Woche 2: Overlay nicht sichtbar. Von ${new Date(f.endDates[0]).toDateString()} bis ${new Date(f.startDates[1]).toDateString()}`);if(t>f.startDates[1]&&t>f.endDates[0]&&t<f.endDates[1])console.log(`Woche 3: Overlay sichtbar. Von ${new Date(f.startDates[1]).toDateString()} bis ${new Date(f.endDates[1]).toDateString()}`);else if(t>f.startDates[1]&&t>f.endDates[1])return void console.log(`Woche 4 ff: Overlay nicht sichtbar. Ab ${new Date(f.endDates[1]).toDateString()}`)}}e(document).trigger("swr:newsletter:show")}else console.log("Newsletter-Modal wird nicht angezeigt, da nicht auf definierter Seite.")}},a.prototype._initCaptcha=function(){var t=this;m>3?console.error("captcha could not be loaded"):(m++,e.ajax({url:l,dataType:"json",crossDomain:!0}).done((function(e,a,n){e.hasOwnProperty("id")&&null!==e.id&&e.hasOwnProperty("question")&&null!==e.question&&t._showOverlay(e)})).fail((function(e,a,n){console.error("captcha could not be loaded"),t._initCaptcha()})))},a.prototype._showOverlay=function(a){var n=COMMON.Utils.uuid(),r=COMMON.Utils.modalHeader(f.headerCaption),i=COMMON.Utils.modalBody(COMMON.Utils.template('<h2>{headline}</h2><p>{text}</p><form class="form form-modal" id="form-newsletter" data-pjax="false" action="#" method="post" data-pjax="false"><p class="help-block">Mit einem * markierte Felder müssen ausgefüllt werden.</p><div class="form-group empty-input" data-required="true"><label for="newsletter-email">E-Mail:<span class="required"> *</span></label><input class="form-control" id="newsletter-email" type="email" name="emailAddress" aria-invalid="false" placeholder="E-Mail" required pattern="^[a-zA-Z0-9.!#$%&amp;\'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$"></div><div class="form-group empty-input"  data-required="true"><label for="newsletterCaptcha"><span class="sr-only">Sicherheitsabfrage: </span>{captcha_question}<span class="required"> *</span></label><input class="form-control" id="newsletterCaptcha" name="captchaAnswer" type="text" placeholder="Bitte beantworten Sie die Frage" required><input type="hidden" name="captchaIndex" value="{captcha_id}"><p class="help-block">Sicherheitsfrage</p></div>{extraHtml}<input type="hidden" name="addressInterfaceId" value="{addressInterfaceId}"/><input type="hidden" name="formField_useDoubleOptIn" value="false"><button type="submit" class="btn btn-primary" data-loading-text="Daten werden übermitteln …">Abonnieren</button></form>',{headline:f.headline,captcha_id:a.id,captcha_question:a.question,extraHtml:f.extraHtml??"",addressInterfaceId:f.addressInterfaceId,text:f.text}));(t=e(COMMON.Utils.modalDialog(n,r,i))).addClass("modal-extended "+f.cssClass),this._bindEvents(),t.appendTo("body"),t.modal({backdrop:!1,focus:!1}),COMMON.isOpen=p=!0;try{PIANO.UsabilityClick.usabilityClickEvent({type:"action",click:"Das Modalfenster hat sich geöffnet",click_chapter1:"Modal",click_chapter3:t.find(".modal-title").text()})}catch(e){console.warn(e)}},a.prototype._bindEvents=function(){var a,n;"overlay"!==u?(a=this.$element,n="form"):(a=t,n=".modal-body"),a.on("submit","form",(function(r){console.log("SUBMIT"),r.preventDefault(),a.find('[data-dismiss="modal"]').prop("disabled",!0);var i=a.find("button[type=submit], input[type=submit]");i.addClass("disabled").attr("disabled","disabled").prop("disabled",!0);var s=i.is("input")?"val":"html";i.data("resetText",i[s]()),i[s](i.data("loadingText")),a.find(".alert.alert-danger").remove(),a.find(".has-error,.form-group-error").removeClass("has-error form-group-error"),a.find(".form-error").remove();var l=a.find("form").serializeArray();e.ajax({url:d,data:l,method:"post",crossDomain:!0}).done((function(e,r,i){a.find(n).empty().append('<div class="alert alert-success"><h2>Erfolgreich versendet</h2><p>Vielen Dank für Ihr Interesse an unserem Newsletter-Angebot. Sie erhalten in Kürze eine E-Mail zur Bestätigung Ihrer Anmeldung, bitte klicken Sie dort auf den Bestätigungslink.</p><p>Falls Sie die Bestätigungsmail nicht in Ihrem Posteingang vorfinden, überprüfen Sie bitte Ihren Spam-Ordner.</p></div>'),"overlay"===u&&t.modal("handleUpdate");var s=new Date;s.setFullYear(s.getFullYear()+10),COMMON.Storage.local.setItem("newsletter."+f.name+".overlay.abonniert",!0,s)})).fail((function(r,l,o){if(400===r.status)e.each(r.responseJSON.errorMessages,(function(e,t){var n=a.find('[name="'+e+'"]').closest(".form-group");n.addClass("has-error form-group-error"),"Fehler bei der Verarbeitung"===t&&(t="Bitte wählen Sie ein Bundesland."),n.append(COMMON.Utils.template('<p class="form-error">{text}</p>',{text:t}))})),i.removeClass("disabled").prop("disabled",!1),i[s]("Abonnieren");else a.find(n).prepend('<div class="alert alert-danger"><h2>Fehler beim Versenden</h2><p>Bitte versuchen Sie es zu einem späteren Zeitpunkt erneut.</p></div>'),"overlay"===u&&t.modal("handleUpdate")})).always((function(){a.find('[data-dismiss="modal"]').prop("disabled",!1)}))})),"inline"!==u&&(t.on("click",'[data-dismiss="modal"]',(function(){t.find("button[type=submit], input[type=submit]").prop("disabled",!0);var e=new Date;e.setTime(e.getTime()+7776e6),window.isFractal&&e.setTime(e.getTime()+60),COMMON.Storage.local.setItem("newsletter."+f.name+".overlay",!0,e),COMMON.isOpen=p=!1})),t.on("hidden.bs.modal",(function(e){u=null,COMMON.isOpen=p=!1,t.off(),t.remove(),t=void 0})),e(document).one("pjax:beforeReplace",(function(){t&&t.modal("hide")})))},a.prototype.dispose=function(){this.$element.off(r),this.$element.find(".hgroup").remove(),this.$element=null,this.element=null,e(document).off(r)},a._jQueryInterface=function(){return this.each((function(){var t=e(this).data(n);t||(t=new a(this),e(this).data(n,t))}))},a}();if(0===e(c).length){var g=e("body");u="overlay",w._jQueryInterface.call(g,g.data())}else e(c).each((function(){var a=e(this);t=e(this),u="inline",w._jQueryInterface.call(a,a.data())}));return e(document).on("pjax:end",(function(a,n,r){if(0===e(r.container).find(c).length){var i=e("body");u="overlay",w._jQueryInterface.call(i,i.data())}else e(r.container).find(c).each((function(){var a=e(this);t=e(this),u="inline",w._jQueryInterface.call(a,a.data())}))})),e.fn[a]=w._jQueryInterface,e.fn[a].Constructor=w,e.fn[a].noConflict=function(){return e.fn[a]=i,w._jQueryInterface},w}(window.jQuery);
//# sourceMappingURL=swr-newsletter.min.js.map
