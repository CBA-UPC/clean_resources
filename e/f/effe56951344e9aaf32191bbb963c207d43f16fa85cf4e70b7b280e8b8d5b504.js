var e=r n=9007199254740991,o="[object Arguments]",c="[object Function]",a="[object GeneratorFunction]",i=/^(?:0|[1-9]\d*)$/;var u,s,l=Object.prototype,f=l.hasOwnProperty,p=l.toString,d=l.propertyIsEnumerable,v=(u=Object.keys,s=Object,; m=Array.isArray;ar g=k=0;var w=function(e,r){var t,n={url:e,callback_param:"callback",callback_header:"__jspcb__",query:{}};function o(e){var r,t,o=(n.callback_header||"__jspcb__")+(k+=1);window[o]=n.query[n.callback_param]=o,(r=document.createElement("script")).src=function(e,r){return e+"?"+g(r),().join("&")}(n.url,n.query),r.async=!0,(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(r,t)}return"function"==typeof r?o(r):t={query:options:end:o}},x=function(e,r,t){switch(arguments.length){case 3:case 2:return function(e,r,t){t=t||{};var n=j(e)+"="+j(r);null==r&&(t["max-age"]=-1);t["max-age"]&&(t.expires=new Date(+new Date+t["max-age"]));t.path&&(n+="; path="+t.path);t.domain&&(n+="; domain="+t.domain);t.expires&&(n+="; expires="+t.expires.toUTCString());t.secure&&(n+="; secure");document.cookie=n}(e,r,t);case 1:return e);default:return q()}};function q(){return function(e){var r,t={},n=e.split(/ *; */);if(""==n[0])return t;for(var o=0;o<n.length;++o)if(O((r=n[o].split("="))[0]))try{t[E(r[0])]=E(r[1])}catch(e){console.warn("error `parse("+value+")` - "+e)}return t}(document.cookie)}function j(e){try{return encodeURIComponent(e)}catch(r){console.warn("error `encode("+e+")` - "+r)}}unction O(e){return!!e&&("krt"===e.substr(0,3)||"ktid"===e.substr(0,4)||"__pck__"===e.substr(0,7)||"test"===e.substr(0,4))}options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var C=),S={},A=I=function(e){P({options:e}).catch(()},P=function(e){var n=e.options;return r(void 0,void 0,void 0,(function(){var e,o,c,a,i,u,s,l,f;return t(this,(function(p){switch(p.label){case 0:return e=n.variables.legacy_message.action,o=new C(n),c={},[4,Promise.all(["jquery","lodash","moment"].map((function(e){return r(void 0,void 0,void 0,(function(){var n;return t(this,(function(o){switch(o.label){case 0:return[4,(a="https://static.karte.io/libs/tracker.".concat(e,".js"),r(void 0,void 0,void 0,())];case 1:return n=o.sent(),c[e]=n[e],[2]}var a}))}))})))];case 1:p.sent();try{a=c.jquery,i=c.lodash,u=c.moment,s=i,l=decodeURIComponent(null===(f=e.content)||void 0===f?void 0:f.script),new Function("_","moment","jquery","jsonp","cookie","tracker",l)(s,u,a,w,x,o)}catch(e){e instanceof Error&&(null===console||void 0===console||console.log("karte.tracker error:",e),o.track("_error",{type:"action",error_message:e.message,error_stack:e.stack}))}return U(e).forEach((),[2]}}))}))},U=function(e){var r;if(0!=e.send_event){var t=[],n={message:{shorten_id:e.shorten_id||"",title:(null===(r=e.content)||void 0===r?void 0:r.title)||"",campaign_id:e.campaign_id||""}};return e.encrypted_trigger&&(n.message.encrypted_trigger=e.encrypted_trigger),t.push({event_name:"script_fired",values:n}),e.should_send_duplicated_events&&e.should_send_duplicated_events.includes("script_fired")&&t.push({event_name:"__script_fired",values:n}),t}return[]};export{I as default};