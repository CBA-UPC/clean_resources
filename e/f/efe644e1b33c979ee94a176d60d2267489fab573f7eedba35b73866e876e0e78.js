import{TemplateInstance as m}from"../lib/template-instance.js";import{directive as t,NodePart as p,reparentNodes as u,TemplateResult as g}from"../lit-html.js";const h=new WeakMap;export const cache=t(value=>part=>{if(!(part instanceof p)){throw new Error("cache can only be used in text bindings")}let o=h.get(part);if(o===undefined){o=new WeakMap;h.set(part,o)}const i=part.value;if(i instanceof m){if(value instanceof g&&i.template===part.options.templateFactory(value)){part.setValue(value);return}else{let t=o.get(i.template);if(t===undefined){t={instance:i,nodes:document.createDocumentFragment()};o.set(i.template,t)}u(t.nodes,part.startNode.nextSibling,part.endNode)}}if(value instanceof g){const t=part.options.templateFactory(value);const l=o.get(t);if(l!==undefined){part.setValue(l.nodes);part.commit();part.value=l.instance}}part.setValue(value)});