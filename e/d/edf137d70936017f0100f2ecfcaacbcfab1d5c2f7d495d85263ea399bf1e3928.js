!this,function(){var e=function(e){return e.reduce(0)},t=function(e){for(var t=[],n=7;n>=0;n--)t.push(!!(e&1<<n));return t},n=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],n=0;n<e;n++)t.push(this.readByte());return t},this.read=this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},r=function(n,r){r||(r={});var i=function(e){for(var t=[],r=0;r<e;r++)t.push(n.readBytes(3));return t},a=function(){var e,t;t="";do{e=n.readByte(),t+=n.read(e)}while(0!==e);return t},o=function(o){o.leftPos=n.readUnsigned(),o.topPos=n.readUnsigned(),o.width=n.readUnsigned(),o.height=n.readUnsigned();var l=t(n.readByte());o.lctFlag=l.shift(),o.interlaced=l.shift(),o.sorted=l.shift(),o.reserved=l.splice(0,2),o.lctSize=e(l.splice(0,3)),o.lctFlag&&(o.lct=i(1<<o.lctSize+1)),o.lzwMinCodeSize=n.readByte();var s=a();o.pixels=function(e,t){for(var n,r,i=0,a=function(e){for(var n=0,r=0;r<e;r++)t.charCodeAt(i>>3)&1<<(7&i)&&(n|=1<<r),i++;return n},o=[],l=1<<e,s=l+1,c=e+1,d=[],u=function(){d=[],c=e+1;for(var t=0;t<l;t++)d[t]=[t];d[l]=[],d[s]=null};;)if(r=n,(n=a(c))!==l){if(n===s)break;if(n<d.length)r!==l&&d.push(d[r].concat(d[n][0]));else{if(n!==d.length)throw new Error("Invalid LZW code.");d.push(d[r].concat(d[r][0]))}o.push.apply(o,d[n]),d.length===1<<c&&c<12&&c++}else u();return o}(o.lzwMinCodeSize,s),o.interlaced&&(o.pixels=o.pixels,o.width)),r.img&&r.img(o)},l=function(){var i={};switch(i.sentinel=n.readByte(),String.fromCharCode(i.sentinel)){case"!":i.type="ext",function(i){switch(i.label=n.readByte(),i.label){case 249:i.extType="gce",function(i){n.readByte();var a=t(n.readByte());i.reserved=a.splice(0,3),i.disposalMethod=e(a.splice(0,3)),i.userInput=a.shift(),i.transparencyGiven=a.shift(),i.delayTime=n.readUnsigned(),i.transparencyIndex=n.readByte(),i.terminator=n.readByte(),r.gce&&r.gce(i)}(i);break;case 254:i.extType="com",function(e){e.comment=a(),r.com&&r.com(e)}(i);break;case 1:i.extType="pte",function(e){n.readByte(),e.ptHeader=n.readBytes(12),e.ptData=a(),r.pte&&r.pte(e)}(i);break;case 255:i.extType="app",function(e){switch(n.readByte(),e.identifier=n.read(8),e.authCode=n.read(3),e.identifier){case"NETSCAPE":!function(e){n.readByte(),e.unknown=n.readByte(),e.iterations=n.readUnsigned(),e.terminator=n.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(e)}(e);break;default:!function(e){e.appData=a(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)}(e)}}(i);break;default:i.extType="unknown",function(e){e.data=a(),r.unknown&&r.unknown(e)}(i)}}(i);break;case",":i.type="img",o(i);break;case";":i.type="eof",r.eof&&r.eof(i);break;default:throw new Error("Unknown block: 0x"+i.sentinel.toString(16))}"eof"!==i.type&&setTimeout(l,0)};!function(){var a={};if(a.sig=n.read(3),a.ver=n.read(3),"GIF"!==a.sig)throw new Error("Not a GIF file.");a.width=n.readUnsigned(),a.height=n.readUnsigned();var o=t(n.readByte());a.gctFlag=o.shift(),a.colorRes=e(o.splice(0,3)),a.sorted=o.shift(),a.gctSize=e(o.splice(0,3)),a.bgColor=n.readByte(),a.pixelAspectRatio=n.readByte(),a.gctFlag&&(a.gct=i(1<<a.gctSize+1)),r.hdr&&r.hdr(a)}(),setTimeout(l,0)};return function(e){var t,i,a={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var o in e)a[o]=e[o];a.vp_w&&a.vp_h&&(a.is_vp=!0);var l=null,s=!1,c=null,d=null,u=null,h=null,p=null,f=null,g=null,_=!0,y=!1,w=[],v=[],m=a.gif;void 0===a.auto_play&&(a.auto_play=!m.getAttribute("rel:auto_play")||"1"==m.getAttribute("rel:auto_play"));var x,b,T,B,C=a.hasOwnProperty("on_end")?a.on_end:null,P=a.hasOwnProperty("loop_delay")?a.loop_delay:0,k=a.hasOwnProperty("loop_mode")?a.loop_mode:"auto",S=!a.hasOwnProperty("draw_while_loading")||a.draw_while_loading,A=!!S&&(!a.hasOwnProperty("show_progress_bar")||a.show_progress_bar),E=a.hasOwnProperty("progressbar_height")?a.progressbar_height:25,I=a.hasOwnProperty("progressbar_background_color")?a.progressbar_background_color:"rgba(255,255,255,0.4)",U=a.hasOwnProperty("progressbar_foreground_color")?a.progressbar_foreground_color:"rgba(255,0,22,.8)",O=function(){c=null,d=null,p=u,u=null,f=null},R=function(){try{r(t,H)}catch(e){D("parse")}},z=function(e,t){x.width=e*L(),x.height=t*L(),T.style.minWidth=e*L()+"px",B.width=e,B.height=t,B.style.width=e+"px",B.style.height=t+"px",B.getContext("2d").setTransform(1,0,0,1,0,0)},N=function(e,t,n){if(n&&A){var r,i,o,l=E;a.is_vp?y?(i=(a.vp_t+a.vp_h-l)/L(),l/=L(),r=a.vp_l/L()+e/t*(a.vp_w/L()),o=x.width/L()):(i=a.vp_t+a.vp_h-l,l=l,r=a.vp_l+e/t*a.vp_w,o=x.width):(i=(x.height-l)/(y?L():1),r=e/t*x.width/(y?L():1),o=x.width/(y?L():1),l/=y?L():1),b.fillStyle=I,b.fillRect(r,i,o-r,l),b.fillStyle=U,b.fillRect(0,i,r,l)}},D=function(e){l=e,i={width:m.width,height:m.height},w=[],b.fillStyle="black",b.fillRect(0,0,a.c_w?a.c_w:i.width,a.c_h?a.c_h:i.height),b.strokeStyle="red",b.lineWidth=3,b.moveTo(0,0),b.lineTo(a.c_w?a.c_w:i.width,a.c_h?a.c_h:i.height),b.moveTo(0,a.c_h?a.c_h:i.height),b.lineTo(a.c_w?a.c_w:i.width,0),b.stroke()},F=function(){f&&(w.push({data:f.getImageData(0,0,i.width,i.height),delay:d}),v.push({x:0,y:0}))},M=function(){var e,t,n,r=-1,i=0,o=function(e){r+=e,c()},s=(e=!1,t=function(){null!==C&&C(m),i++,!1!==k||i<0?n():(e=!1,_=!1)},n=function(){if(e=_){o(1);var i=10*w[r].delay;i||(i=100),0==(r+1+w.length)%w.length?(i+=P,setTimeout(t,i)):setTimeout(n,i)}},,c=function(){var e;(r=parseInt(r,10))>w.length-1&&(r=0),r<0&&(r=0),e=v[r],B.getContext("2d").putImageData(w[r].data,e.x,e.y),b.globalCompositeOperation="copy",b.drawImage(B,0,0)};return{init:function(){l||(a.c_w&&a.c_h||b.scale(L(),L()),a.auto_play?s():(r=0,c()))},step:s,play:pause:playing:_,move_relative:o,current_frame:function(){return r},length:function(){return w.length},move_to:}(),G=function(e){N(t.pos,t.data.length,e)},j=W=function(e,t){return ,H={hdr:W(function(e){z((i=e).width,i.height)}),gce:W(function(e){F(),O(),c=e.transparencyGiven?e.transparencyIndex:null,d=e.delayTime,u=e.disposalMethod}),com:W(j),app:{NETSCAPE:W(j)},img:W(function(e){f||(f=B.getContext("2d"));var t=w.length,n=e.lctFlag?e.lct:i.gct;t>0&&(3===p?null!==h?f.putImageData(w[h].data,0,0):f.clearRect(g.leftPos,g.topPos,g.width,g.height):h=t-1,2===p&&f.clearRect(g.leftPos,g.topPos,g.width,g.height));var r=f.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(function(e,t){e!==c&&(r.data[4*t+0]=n[e][0],r.data[4*t+1]=n[e][1],r.data[4*t+2]=n[e][2],r.data[4*t+3]=255)}),f.putImageData(r,e.leftPos,e.topPos),y||(b.scale(L(),L()),y=!0),S&&(b.drawImage(B,0,0),S=a.auto_play),g=e},!0),eof:function(e){F(),G(!1),a.c_w&&a.c_h||(x.width=i.width*L(),x.height=i.height*L()),M.init(),s=!1,X&&X(m)}},q=function(){var e=m.parentNode,t=document.createElement("div");x=document.createElement("canvas"),b=x.getContext("2d"),T=document.createElement("div"),B=document.createElement("canvas"),t.width=x.width=m.width,t.height=x.height=m.height,T.style.minWidth=m.width+"px",t.className="jsgif",T.className="jsgif_toolbar",t.appendChild(x),t.appendChild(T),e.insertBefore(t,m),e.removeChild(m),a.c_w&&a.c_h&&z(a.c_w,a.c_h),V=!0},L=function(){return a.max_width&&i&&i.width>a.max_width?a.max_width/i.width:1},V=!1,X=!1,Z=function(e){return!s&&(X=e||!1,s=!0,w=[],O(),h=null,p=null,f=null,g=null,!0)};return{play:M.play,pause:M.pause,move_relative:M.move_relative,move_to:M.move_to,get_playing:function(){return _},get_canvas:function(){return x},get_canvas_scale:get_loading:get_auto_play:get_length:function(){return M.length()},get_current_frame:load_url:function(e,r){if(Z(r)){var i=new XMLHttpRequest;i.open("GET",e,!0),"overrideMimeType"in i?i.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in i?i.responseType="arraybuffer":i.setRequestHeader("Accept-Charset","x-user-defined"),i.onloadstart=i.onload=function(e){200!=this.status&&D("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var r=this.response;r.toString().indexOf("ArrayBuffer")>0&&(r=new Uint8Array(r)),t=new n(r),setTimeout(R,0)},i.onprogress=function(e){e.lengthComputable&&N(e.loaded,e.total,!0)},i.onerror=i.send()}},load:function(e){this.load_url(m.getAttribute("rel:animated_src")||m.src,e)},load_raw:function(e,r){Z(r)&&(V||q(),t=new n(e),setTimeout(R,0))},set_frame_offset:function(e,t){v[e]?(void 0!==t.x&&(v[e].x=t.x),void 0!==t.y&&(v[e].y=t.y)):v[e]=t}}}});