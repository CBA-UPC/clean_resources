(function(){var o,e,et;try{var f=Microsoft.Maps,r=f.Internal,gt=r.__assign,ni=r.__extends,y=r.__spreadArray,h=f.globalConfig,ti=r.coreConfig,n=h.features,ii=n.advertising,ri=n.autosuggest,ui=n.calendar,fi=n.collections,ei=n.directions,oi=n.feedback,si=n.flyover,hi=n.landmarks3D,ci=n.map3D,li=n.richMapsInfobox,ai=n.labels,vi=n.layerManager,yi=n.localGuide,pi=n.localSearch,wi=n.mapBuilder,bi=n.mapDelay,ki=n.optIn,di=n.print,gi=n.sharing,nr=n.streetside,tr=n.taskBar,ir=n.taskFramework,p=n.trafficControl,u=n.traffic,rr=n.trafficExperiences,ur=n.mapBuilderExperiences,fr=n.transit,er=n.travel,or=n.xsr,l=atlas.data,w=atlas.layer,d=atlas.math,g=atlas.Pixel,nt=f.BingMapStyle,s=f.Color,sr=f.Point,st=f.ResourceManager,hr=f.Size,i=r.AtlasHelper,c=r.AzureMapEvents,a=r.JSEvent,tt=r.LruCache,it=r.MapsInfobox,rt=r.Network,cr=r.ObjectWithId,b=r.TimeoutWrapper,ht=r.ControlTemplate,ct=r.dependencyResolver,lt=r.ExternalPromise,t=st.MapDelay,at='<div class="{Binding rootClassName}" data-tag="trafficCameraPopupRoot">    <a class="cameraClose" data-tag="cameraClose" event:click="onCameraCloseClick" role="button" aria-label="{Binding resources.L_CameraCloseAriaLabel}"><\/a>    <a class="customAction" data-tag="customAction" event:click="onCustomActionClick" role="button" style:display="{Binding onCustomActionClick Converter=nullToDisplayNone}" aria-label="{Binding customActionAriaLabel}" />    <div class="cameraDesc" data-tag="cameraDesc">        <TextBlock Text="{Binding description}" />    <\/div>    <div class="trfcLoading loading"><\/div>    <img alt="{Binding altImageText}" class="cameraImg loading" data-tag="cameraImg" />    <video class="cameraVideo loading" loop="" muted="" alt="{Binding altImageText}" data-tag="cameraVideo"><\/video>    <div class="trfCamAgencyAttrib" data-text="copyright">        <TextBlock Text="{Binding copyright}" />    <\/div>    <div class="trfCamCtrl">        <div class="trfcPlayPause">            <svg class="trfcCtrlBtn trfcPlayBtn" width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg">                <path d="M12.2221 5.68458C13.2586 6.25438 13.2586 7.74373 12.2221 8.31354L2.22259 13.8105C1.22292 14.36 -5.23707e-08 13.6367 0 12.496L5.04711e-07 1.50214C5.57082e-07 0.361374 1.22292 -0.361883 2.22259 0.187655L12.2221 5.68458Z" />            <\/svg>            <svg class="trfcCtrlBtn trfcPauseBtn" width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">                <path d="M9 1.5C9 0.671573 9.67157 0 10.5 0H12.5C13.3284 0 14 0.671573 14 1.5V14.5C14 15.3284 13.3284 16 12.5 16H10.5C9.67157 16 9 15.3284 9 14.5V1.5ZM0 1.5C0 0.671573 0.671573 0 1.5 0H3.5C4.32843 0 5 0.671573 5 1.5V14.5C5 15.3284 4.32843 16 3.5 16H1.5C0.671573 16 0 15.3284 0 14.5V1.5Z" />            <\/svg>        <\/div>        <div class="trfcProgress">            <div class="trfcProgressBarBack">                <div class="trfcProgressBarFront"><\/div>                <div class="trfcProgressSlider"><\/div>            <\/div>        <\/div>    <\/div><\/div>',vt='<div class="bm_trfcIncidentWrapper">    <div data-tag="incidentPopupRoot">        <div>            <div class="incidentTitleRoot">                <h4 class="incidentTitle" data-tag="incidentTitle">                    <TextBlock Text="{Binding incidentTitle}" />                <\/h4>                <p class="{Binding severityType Converter=severityTypeToClass}" data-tag="severity">                    <span>                        <TextBlock Text="{Binding severity}" />                    <\/span>                <\/p>            <\/div>            <div class="incidentDescriptionRoot">                <p class="incidentDescription" data-tag="trafficDescription">                    <span><TextBlock Text="{Binding description}" /><\/span>                    <span><TextBlock Text="{Binding preceedingDescription}" /><\/span>                    <span class="incidentDescriptionRoadName"><TextBlock Text="{Binding roadName}" /><\/span>                    <span><TextBlock Text="{Binding succeedingDescription}" /><\/span>                <\/p>                <p class="incidentTime" data-tag="start" style:display="{Binding start Converter=nullToDisplayNone}">                    <span><TextBlock Text="{Binding resources.L_TrafficPopupStartTime_Text}"/><\/span><span><TextBlock Text="{Binding start}" /><\/span>                <\/p>                <p class="incidentTime" data-tag="end" style:display="{Binding end Converter=nullToDisplayNone}">                    <span><TextBlock Text="{Binding resources.L_TrafficPopupEstEndTime_Text}"/><\/span><span><TextBlock Text="{Binding end}" /><\/span>                <\/p>            <\/div>        <\/div>    <\/div><\/div>',yt='<div class="bm_trfcIncidentWrapper expiredIncident">    <div data-tag="incidentPopupRoot">        <div>            <div class="incidentTitleRoot">                <h4 class="incidentTitle" data-tag="incidentTitle">                    <TextBlock Text="{Binding incidentTitle}" />                <\/h4>                <p class="{Binding severityType Converter=severityTypeToClass}" data-tag="severity">                    <span>                        <TextBlock Text="{Binding severity}" />                    <\/span>                <\/p>            <\/div>            <div class="incidentDescriptionRoot">                <p class="incidentDescription" data-tag="trafficDescription">                    <span><TextBlock Text="{Binding description}" /><\/span>                <\/p>            <\/div>            <div class="incidentTypeMessageRoot">                <p class="incidentTypeMessage" data-tag="incidentTypeMessage">                    <span><TextBlock Text="{Binding incidentTypeMessage}" /><\/span>                <\/p>            <\/div>        <\/div>    <\/div><\/div>';(function(n){var t=function(){function n(n,t){var i=this;this._trafficRasterLayers=["microsoft.bing.maps.traffic.CJK","microsoft.bing.maps.traffic.Raster"];this._map=n;this._layerCallback=t;this._sourceId="TrafficFlowManager_source";this._flowLayerIdPrefix="TrafficFlowManager_flow";this._isFlowShown=!1;this._showAnimation=!0;this._opacity=p.defaultTrafficLayerOpacity;this._trafficFlowAnimationLayers=[];this._trafficFlowAnimationTimers=[];this._disposables=[c.add(this._map,"stylechanged",function(){return i._onMapStyleChanged()})];this._map.mapLoaded.then(function(){i._delayAnimation();i._disposables.push(c.add(i._map,"moveend",)})}return n.prototype.showFlow=function(){var n=this;this._isFlowShown||(this._isFlowShown=!0,Promise.all([this._map.mapLoaded,this._getAnimationPromise()]).then(function(){n._isFlowShown&&(n._map.setTraffic({flow:"relative"}),n._updateRasterLayerVisibility("visible"),n._showAnimation&&n.showAnimation())}))},n.prototype.hideFlow=function(){this._map.setTraffic({flow:"none"});this._updateRasterLayerVisibility("none");this.hideAnimation(!0);this._removeTrafficSource();this._isFlowShown=!1},n.prototype.showAnimation=function(){var n=this;this._isFlowShown&&(this._showAnimation=!0,this._getAnimationPromise().then(function(){n._isFlowShown&&n._showAnimation&&(n._createTrafficSource(),p.disableAnimation||n._trafficFlowAnimationLayers.length||n._convertStyleToAnimationLayers(),n._addOrMoveAnimationLayers(),n._delayAnimation())}))},n.prototype.hideAnimation=function(n){var i,t,r,u;for(this._pauseOrPlayAnimation(!0),i=this._map.layers,t=0,r=this._trafficFlowAnimationLayers;t<r.length;t++)u=r[t],i.getLayerById(u.getId())&&i.remove(u);this._removeTrafficSource();n||(this._showAnimation=!1)},n.prototype.setOpacity=function(n){var u,s,t,f,e,r,o,i;if(this._opacity!==n){for(this._opacity=n,u=this._map._getMap(),s=this._getTrafficLayersFromStyleDef(),t=0,f=s;t<f.length;t++)i=f[t],e=i.id,u.getLayer(e)&&u.setPaintProperty(e,"line-opacity",n);for(r=0,o=this._trafficFlowAnimationLayers;r<o.length;r++)i=o[r],i.setOptions({opacity:n})}},n.prototype.dispose=function(){this.hideFlow();i._clearDisposables(this._disposables);this._disposeTrafficAnimation();this._removeTrafficSource();delete this._trafficFlowSource},n.prototype._onMapStyleChanged=function(){this._isFlowShown&&(this._showAnimation&&(this._disposeTrafficAnimation(),this.showAnimation()),this._updateRasterLayerVisibility("visible"))},n.prototype._addOrMoveAnimationLayers=function(){for(var i,n=0,t=this._trafficFlowAnimationLayers;n<t.length;n++)i=t[n],this._addOrMoveLayer(i)},n.prototype._disposeTrafficAnimation=function(){this.hideAnimation(!0);this._trafficFlowAnimationLayers=[];i._clearDisposables(this._trafficFlowAnimationTimers);this._trafficFlowAnimationTimers=[]},n.prototype._createTrafficSource=function(){var t,n;this._trafficFlowSource||(t=this._map._getMap().getStyle().sources,t&&(n=t["bing-traffic"],n&&(this._trafficFlowSource=new atlas.source.VectorTileSource(this._sourceId,{tiles:n.tiles,maxZoom:n.maxzoom,minZoom:n.minzoom}))));!this._map.sources.getById(this._sourceId)&&this._trafficFlowSource&&this._map.sources.add(this._trafficFlowSource)},n.prototype._removeTrafficSource=function(){var n=this._map.sources;this._trafficFlowSource&&n.getById(this._sourceId)&&n.remove(this._trafficFlowSource)},n.prototype._convertStyleToAnimationLayers=function(){var t,i,r;if(this._trafficFlowSource){var u=this._getTrafficLayersFromStyleDef(),f=new s("hsl(0, 0%, 100%)",4),e=new s("hsl(0, 0%, 13%)",4),o=function(t){for(var c,u=t.paint||{},i=u["line-color"],o=new Set,l=(i instanceof Array?i:[i]).filter(function(n,t){var r=!1,i;return u["line-dasharray"]||(i=typeof n=="string"&&s.parse(n),r=i&&!s.areEqual(i,f)&&!s.areEqual(i,e),r&&o.add(t)),r}),a=function(r){var h=n._getSpeedLevelFromColor(r),f=n._getDarkerColor(r,30),e=void 0,u,s;i instanceof Array&&(e=y([],i,!0).map(function(n,t){var i=n;return o.has(t)&&(i=n===r?f:"transparent"),i}));u=n._getAnimationLayerFromStyleLayer(n._trafficFlowSource,t,e||f,f);n._layerCallback&&n._layerCallback(u,!0);n._trafficFlowAnimationLayers.push(u);s=n._getFlowAnimationTimer(u,h);n._trafficFlowAnimationTimers.push(s)},r=0,h=l;r<h.length;r++)c=h[r],a(c)},n=this;for(t=0,i=u;t<i.length;t++)r=i[t],o(r)}},n.prototype._getAnimationLayerFromStyleLayer=function(n,t,i,r){var u=t.paint||{},f="".concat(this._flowLayerIdPrefix,"_").concat(t.id,"_animation_").concat(r),e=n.getOptions(),o={sourceLayer:t["source-layer"],filter:t.filter,strokeColor:i,blur:1,strokeWidth:u["line-width"],visible:!1,minZoom:e.minZoom};return new w.LineLayer(n,f,o)},n.prototype._getFlowAnimationTimer=function(n,t){var i=this._getFlowAnimationOptions(t);return atlas.animations.flowingDashedLine(n,i)},n.prototype._getFlowAnimationOptions=function(n){var t=Math.pow(2,n-1);return{duration:2e3,loop:!0,reverse:!0,dashLength:2,gapLength:t*2,speedMultiplier:t*.2}},n.prototype._delayAnimation=function(){var n=this;c.addOnce(this._map,"render",function(){n._pauseOrPlayAnimation(!0);c.addOnce(n._map,"idle",})},n.prototype._pauseOrPlayAnimation=function(n){var t,u,i,r,f,e;if(!p.disableAnimation&&this._isFlowShown&&this._showAnimation)for(t=0,u=this._trafficFlowAnimationTimers;t<u.length;t++)if(i=u[t],n)i.pause();else if(!i.isPlaying())for(i.play(),r=0,f=this._trafficFlowAnimationLayers;r<f.length;r++)e=f[r],e.setOptions({visible:!0})},n.prototype._getSpeedLevelFromColor=function(n){var i,r=(i=n.match(s.hslRegex))!==null&&i!==void 0?i:[],t=parseFloat(r[1]),u=parseFloat(r[3]);return t>=320||t<20?u<65?0:1:t>=20&&t<80?2:3},n.prototype._getDarkerColor=function(n,t){var u=parseInt(i._getUrlParam(window.location,"animationColorShift")),r=new s(n,4),e=typeof u=="number"&&!isNaN(u),f=1-i._clamp(e?u:t,0,99)/100;return r.red=Math.round(f*r.red),r.green=Math.round(f*r.green),r.blue=Math.round(f*r.blue),r.toRgba()},n.prototype._addOrMoveLayer=function(n){var i=this._map.layers,r=this._map._getMap(),t=this._getAnimationInsertBeforeId(),u;n instanceof w.LineLayer||n instanceof w.SymbolLayer?(u=n.getId(),i.getLayerById(u)||i.add(n,t),t&&!i.getLayerById(t)?r.moveLayer(u,t):i.move(n,t)):r.getLayer(n.id)||r.addLayer(n,t)},n.prototype._getTrafficLayersFromStyleDef=function(){var n;return((n=this._map.layers.getLayerById("traffic_relative"))===null||n===void 0?void 0:n.layers)||[]},n.prototype._getAnimationInsertBeforeId=function(){var r,t=this._getTrafficLayersFromStyleDef(),u=t===null||t===void 0?void 0:t.length,f,n,i;return u&&(f=t[u-1].id,n=this._map._getMap().getStyle().layers,n&&(i=n.findIndex(,i>-1&&i<n.length-1&&(r=n[i+1].id))),r},n.prototype._getAnimationPromise=function(){var n=new lt;return ct.resolveBySourceKey("AzureMapAnimation",function(){n.resolve()}),n},n.prototype._updateRasterLayerVisibility=function(n){var t=this;this._trafficRasterLayers.forEach(},n}();n.TrafficFlowManager=t})(e||(e={})),function(n){function f(n,t){var i=t.point.coordinates,r=n.getCamera().bounds,u=[i[1],i[0]];return l.BoundingBox.containsPosition(r,u)}function ut(n){for(var t=1;t<=11;t++)n(t)}var r,e=300,s=512,v=500,p=new Map([[1,u.minZoomForLowImpactIncidents],[2,u.minZoomForMinorIncidents],[3,u.minZoomForModerateIncidents],[0,u.minZoomForAllCameras]]),w=new Set([1,2,3,4,6,7,8,9,10,11,12,15,16,18,19,20,23,24,25,26]),k=new Set([25,63,911,916,921,922,923,1001,1002,1003,1004,1006,1007,1008,1010,1011,1012,1013,1014,1015,1016,1037,1038,1044,1047,1055,1059,1128,1130,1205,1309,1318,1323,1472,1482,1804,]),it=function(){function it(n){var i=this,r,t;this._alwaysShownIncidentIds=new Set;this._excludedIncidentIconTypes=new Set;this._excludeRoadClosureIcon=!1;this._currentState=2;this._pendingIncidentRequests=new Set;this._map=n;this._disposables=[nt.init(n)];r=v;this._primitiveCache=new tt(r);this._incidentExpirationTimes=new tt(r);t=this._primitiveManager=new nt.PrimitiveManager(n);t.id="TrafficIncidentManager;".concat(t.id);this._alwaysShownPins=[];this._hideIncidents=!0;this._hideCameras=!0;this._disposables.push(this.incidentClicked=new a,this.incidentHoverStart=new a,this.incidentHoverStop=new a,this.incidentsUpdated=new a,t.primitiveClicked.add(function(n){return i._onPrimitiveSelected(n.primitive,!1)}),t.primitiveHoverStart.add(,t.primitiveHoverStop.add(,n.mapClicked.add(function(n){var t=n.originalEvent;t&&t.type!=="contextmenu"&&i.resetPrimitive(!1)}),t)}return it.prototype.isShowing=it.prototype.show=it.prototype.hide=function(){this._hideIncidents=!0;this._hideCameras=!0;this._removeOnMoveEndHandler();this._updateTrafficPrimitives();this.resetPrimitive(!1)},it.prototype.showIncidents=function(){this._hideIncidents=!1;this._addOnMoveEndHandler();this._updateTrafficPrimitives()},it.prototype.hideIncidents=function(){this._hideIncidents=!0;this._removeOnMoveEndHandler();this._updateTrafficPrimitives()},it.prototype.showCameras=function(){this._hideCameras=!1;this._addOnMoveEndHandler();this._updateTrafficPrimitives()},it.prototype.hideCameras=it.prototype.areCamerasHidden=it.prototype.hasCamera=function(){var t=this._primitiveManager.getPrimitives();return t&&Object.keys(t).some(function(i){var r=t[i].primitive;return n.isCamera(r.incident)})},it.prototype.addAlwaysShownPins=function(n){var t;n&&((t=this._alwaysShownPins).push.apply(t,n),this._updateTrafficPrimitives())},it.prototype.removeAlwaysShownPins=function(n){n&&(this._alwaysShownPins=this._alwaysShownPins.filter(,this._updateTrafficPrimitives())},it.prototype.setPinDisplayFilter=it.prototype.setExcludedIcons=function(n,t){var i=!1;n&&(this._excludedIncidentIconTypes=n,i=!0);typeof t=="boolean"&&(this._excludeRoadClosureIcon=t,i=!0);i&&this._updateTrafficPrimitives()},it.prototype.setPreselectedPin=function(n,t,i,r){var f,u,e;this._preselectedPrimitive={id:"".concat(n),type:r};typeof t!="number"||isNaN(t)||typeof i!="number"||isNaN(i)||(this._preselectedPrimitive.location=[t,i],f=this._getCacheZoom(!1),u=this._getTileXY(t,i,f),u&&(e=this._getCacheKey(u,!1),this._preselectedPrimitive.tileCacheKey=e))},it.prototype.setRecentCameras=function(n){this._recentCameras=n?y([],n,!0):undefined;this._updateTrafficPrimitives()},it.prototype.highlightPrimitive=it.prototype.getPrimitives=it.prototype.dispose=function(){this.hide();i._clearDisposables(this._disposables);i._nullifyClass(this);this.isDisposed=!0},it.prototype.resetPrimitive=function(n){var t=o.hide(n);this._selectedPrimitive&&t&&(this._selectedPrimitive.state=this._currentState,this._primitiveManager.update([this._selectedPrimitive]),this._selectedPrimitive=undefined)},it.prototype.setPrimitiveStates=function(n){var t,u,i,f,e,r;for(this._currentState=n,t=[],u=this._primitiveManager.getPrimitives(),i=0,f=Object.keys(u);i<f.length;i++)e=f[i],r=u[e].primitive,r!==this._selectedPrimitive&&(r.state=n,t.push(r));t.length&&this._primitiveManager.update(t)},it.prototype._updateTrafficPrimitives=function(){var l=this,o,n,t,r,s,c;if(!this.isDisposed){if(o=this._map.getCamera().zoom,this._primitiveManager.clear(),!this.isShowing()||o<i.convertZoom(u.minZoomLevelToShowIncidents,1)){this._addTrafficPrimitives([]);return}var f=o<=i.convertZoom(u.maxZoomForSevereIncidentsOnly,1),a=this._getCacheZoom(f),v=this._getCacheTileXYs(a),y=v[0],p=v[1],e=[],w=["incidents"];for(f||w.push("cameras"),n=y.x;n<=p.x;n++)for(t=y.y;t<=p.y;t++)r=this._getCacheKey({x:n,y:t,z:-1},f),s=this._getCachedPrimitives(r),s?e.push.apply(e,s):this._pendingIncidentRequests.has(r)||(this._pendingIncidentRequests.add(r),c=u.incidentsUrlFormat.replace("{bounds}",this._getQueryBoundsString(n,t,a)).replace("{sev}",f?"4":"0,1,2,3,4").replace("{credentials}",h.dynamicProperties.sessionKey).replace("{cmnPltParam}",h.platformCommonParam).replace("{includeItems}",w.join("|")),rt.downloadJsonp(c,"trfinc",function(n){return l._processErrors(n)},undefined,!1,{key:r,url:c},3));e.length&&this._addTrafficPrimitives(e)}},it.prototype._processResponse=function(i,r){var tt=this,c,l,a,v,y,p,e,o,f,s,h,w,b,k,d,nt,g;if(!this.isDisposed){if(e=r.key,this._pendingIncidentRequests.delete(e),this._incidentExpirationTimes.addItem(e,Date.now()+u.incidentsLayerRefreshInterval),o=[],s=i.resourceSets,s&&s.length>0)for(h=0,w=s[0].resources;h<w.length;h++)b=w[h],k=n.createIncidentPrimitive(b,this._excludedIncidentIconTypes,this._excludeRoadClosureIcon),o.push(k),"".concat(b.incidentId)===((c=this._preselectedPrimitive)===null||c===void 0?void 0:c.id)&&(f=k);d=(l=this._preselectedPrimitive)===null||l===void 0?void 0:l.location;nt=(a=this._preselectedPrimitive)===null||a===void 0?void 0:a.tileCacheKey;!f&&nt===e&&d&&(g=(v=this._preselectedPrimitive)===null||v===void 0?void 0:v.id,f=n.createIncidentPrimitive({incidentId:g,point:{coordinates:d},description:t.L_TrafficExpired_Description,type:(p=(y=this._preselectedPrimitive)===null||y===void 0?void 0:y.type)!==null&&p!==void 0?p:-1,isExpired:!0},this._excludedIncidentIconTypes,this._excludeRoadClosureIcon),o.push(f),n.instrumentationHelper===null||n.instrumentationHelper===void 0?void 0:n.instrumentationHelper.logInstrumentationEvent("EXPINC",{IID:g}));this._primitiveCache.addItem(e,o);this._addTrafficPrimitives(o).then(}},it.prototype._processErrors=function(t){var i=t===null||t===void 0?void 0:t.key;this._pendingIncidentRequests.delete(i);n.instrumentationHelper===null||n.instrumentationHelper===void 0?void 0:n.instrumentationHelper.logInstrumentationEvent("INCRQERR",{REQURL:t.url})},it.prototype._addTrafficPrimitives=function(t){var r=this,e=y([],this._alwaysShownPins,!0),o,s,c,l,h,a,v;if(this.isShowing()&&(o=this._map.getCamera().zoom,typeof o=="number")){if(o<=i.convertZoom(u.minZoomForAllCameras,1)&&!this._hideCameras&&this._recentCameras)for(s=0,c=this._recentCameras;s<c.length;s++)l=c[s],f(this._map,l.incident)&&e.push(l);for(e.push.apply(e,t.filter(function(n){var t=n.incident,i=r._shouldShowIncident(t,o);return r._pinDisplayFilter&&(r._overrideDefaultPinFilter||i)?r._pinDisplayFilter(t,o):i})),h=0,a=e;h<a.length;h++)v=a[h],v.stylesheetEntryState=n.getIncidentStyleSheetEntryState(v.incident,this._excludedIncidentIconTypes,this._excludeRoadClosureIcon)}return this._primitiveManager.add(e).then(function(){var i,u,t;return r.isDisposed||(i=r._selectedPrimitive,i?(t=e.find(,u=r._currentState===5,t&&t.state!==(u?6:4)&&(t.state=u&&!n.isCamera(t.incident)?6:4,r._primitiveManager.update([t]),r._selectedPrimitive=t)):(t=e.find(,t&&(t.state=2,r._primitiveManager.update([t]))),r.incidentsUpdated.invoke()),Promise.resolve()})},it.prototype._getCacheTileXYs=function(n){var t=this._map.getCamera().bounds;return[this._getTileXY(t[3],t[0],n),this._getTileXY(t[1],t[2],n)]},it.prototype._getQueryBoundsString=function(n,t,i){var r=s,u=n*r,f=t*r,c=u+r,l=f+r,e=d.mercatorPixelsToPositions([new g(u,f),new g(c,l)],i),o=e[0],h=e[1];return"".concat(h[1],",").concat(o[0],",").concat(o[1],",").concat(h[0])},it.prototype._shouldShowIncident=function(n,t){var u,e,o,r=!0,s,c,h;switch(n.type){case 12:break;case 2:n.isJamcident||(r=!1);break;case 4:r=n.severity!==1&&!this._hideIncidents;break;case 11:r=((u=n.severity)!==null&&u!==void 0?u:1)>2&&!this._hideIncidents;break;default:r=!this._hideIncidents}return r=r&&f(this._map,n),s=(e=n.incidentId)!==null&&e!==void 0?e:"",c=this._alwaysShownIncidentIds.has(s)||((o=this._preselectedPrimitive)===null||o===void 0?void 0:o.id)===s,r&&!c&&(n.levelOfDetail!==undefined?this._isIncidentHighPriority(n)||(r=r&&t>=i.convertZoom(n.levelOfDetail,1)):typeof n.severity=="number"&&(h=p.get(n.severity),typeof h=="number"&&(r=r&&t>=i.convertZoom(h,1)))),n.severity===0&&(r=r&&!this._hideCameras),r},it.prototype._getCachedPrimitives=function(n){var t=this._primitiveCache.getItem(n),i=this._incidentExpirationTimes.getItem(n),r=!t||!i||Date.now()>i;return r?undefined:t},it.prototype._onPrimitiveHoverEnd=function(n){var t=this;window.clearTimeout(r);r=b.setTimeout(function(){o.preventAutoClose()||t.resetPrimitive(!0);n.state===(t._currentState===5?6:4)&&(n.state=t._currentState,t._primitiveManager.update([n]))},e);this.incidentHoverStop.invoke(n)},it.prototype._onPrimitiveSelected=function(t,i){var u=this,f;t?(delete this._preselectedPrimitive,o.preventAutoClose()||(f=function(){o.initialize(u._map);o.show(t,i);u._selectedPrimitive&&t!==u._selectedPrimitive&&(u._selectedPrimitive.state=u._currentState,u._primitiveManager.update([u._selectedPrimitive]));u._selectedPrimitive=i?undefined:t;var r=t.incident;u._logTrafficInstrumentation(t.incident,n.isCamera(r)?2:1,!i)},window.clearTimeout(r),i?r=b.setTimeout(function(){f()},e):f()),i?this.incidentHoverStart.invoke(t):this.incidentClicked.invoke(t)):this.resetPrimitive(i)},it.prototype._isIncidentHighPriority=function(n){var t,i;return u.useAlertCSeverity?!n.isJamcident&&(!!n.roadClosed||!!((t=n.alertCCodes)===null||t===void 0?void 0:t.some(function(n){return w.has(n)}))||!!((i=n.eventList)===null||i===void 0?void 0:i.some()):n.severity===4},it.prototype._logTrafficInstrumentation=function(t,i,r){var f,e,u;e=i===2||i===3?r?"CAMCLK":"CAMHVR":r?"INCCLK":"INCHVR";u={};u.IUT=i;i===1&&(u.ST=t.severity,u.IT=t.type,u.IC=t.roadClosed,u.IID=((f=t.incidentId)!==null&&f!==void 0?f:"").toString());n.instrumentationHelper&&n.instrumentationHelper.logInstrumentationEvent(e,u)},it.prototype._getCacheKey=function(n,t){return"".concat(t?"overview_":"detailed_").concat(n.x,"_").concat(n.y)},it.prototype._getCacheZoom=it.prototype._getTileXY=function(n,t,r){var f=s,h=new l.Position(t,n),c=d.mercatorPositionsToPixels([h],r),u=c[0],e;if(u){var o=Math.ceil(512*Math.pow(2,r)),a=Math.floor(i._clamp(u[0],0,o-1)/f),v=Math.floor(i._clamp(u[1],0,o-1)/f);e={x:a,y:v,z:-1}}return e},it.prototype._addOnMoveEndHandler=function(){var n=this;!this._onMoveEndDisposable&&this.isShowing()&&(this._onMoveEndDisposable=c.add(this._map,"moveend",)},it.prototype._removeOnMoveEndHandler=function(){this._onMoveEndDisposable&&!this.isShowing()&&(this._onMoveEndDisposable.dispose(),delete this._onMoveEndDisposable)},it}();n.TrafficIncidentManager=it;n.incidentWithinMap=f;n.forEachValidIncidentType=ut}(e||(e={})),function(n){function ct(n){w||(c=n,s=!1,v=t,w=!0)}unction d(n){var t=!1;return r&&(!n||n&&s)&&(r.setOptions({visible:!1}),s=!1,a=undefined,t=!0),t}function bt(n,t,i){var h,u,v,b,y;if(n&&n.incident){u=n.incident;s=!!t;v=e.isCamera(u);a=u.incidentId;var f=n.geometry,p=it.getAdjustedAnchor(c,{pixelOffset:n.incident.type===12?st:ot,position:new l.Position(f.x,f.y)}),k=p.anchor,d=p.pixelOffset,w={infoboxContent:ui(u,v,!!i),visible:!0,position:new l.Position(f.x,f.y),anchor:k,keepOpenOnMouseleave:!t,pixelOffset:d};r?r.setOptions(w):r=new it(c,w);v&&(b=r.getRootNode(),y=(h=b.querySelector("".concat(o)))===null||h===void 0?void 0:h.parentElement,y&&y.classList.add("bm_trfcCam"),g(u,!1,)}}function g(n,t,i){var r=nt(n,t);r.indexOf("data:image")>-1?i(n,r,!1):rt.downloadGeneric(r,"cameraVisual","blob",}function nt(n,t){var e=n.images&&n.images.length>0?n.images[0]:null,i=e&&e.imageUrl;if(i&&i.indexOf("data:image")>-1)return i;var r=u.cameraUrlFormat.replace("{imageUrl}",i?i+(t?"&routeCamera=1":""):"").replace("{credentials}",h.dynamicProperties.sessionKey).replace("{cmnPltParam}",h.platformCommonParam),f="&setfeatures=",o="".concat(f,"mp4cameras"),s=r.indexOf(f);return s===-1?r+=o:r=r.replace(f,"".concat(o,",")),r}unction tt(n,t,i){return t?pt(n,i,v):wt(n,v)}function dt(n,t,i,r){var f="video/mp4",u,e;i.type===f?(u=new FileReader,u.onloadend=function(){var t;try{var e=u.result,i=atob(e.slice(e.indexOf(",")+1)),o=new Array(i.length);for(t=0;t<i.length;t++)o[t]=i.charCodeAt(t);var s=new Uint8Array(o),h=new Blob([s],{type:f}),c=URL.createObjectURL(h);r(n,c,!0)}catch(l){r(n,undefined,!0)}},u.readAsDataURL(i)):(e=URL.createObjectURL(i),r(n,e,!1))}function gt(n,t,i){var r,o;t&&a===n.incidentId&&(r=ft(i),i&&r&&(f=r,r.addEventListener("loadeddata",,r.addEventListener("timeupdate",function(){f&&y(f.currentTime/f.duration)}),o=!0,r.addEventListener("canplaythrough",function(){o&&u.cameraAnimationAutoPlay&&(f.muted=!0,f.play(),o=!1)}),r.addEventListener("error",function(){var n;(n=e.instrumentationHelper)===null||n===void 0?void 0:n.logInstrumentationEvent("CAMERR",{})})),r===null||r===void 0?void 0:r.setAttribute("src",t),ni(i))}function ni(n){var i=r===null||r===void 0?void 0:r.getRootNode(),t;if(i){var u="loading",f="loaded",e=i.querySelector("".concat(o," .trfcLoading"));e&&e.classList.replace(u,f);t=ft(n);t&&t.classList.replace(u,f)}}unction ii(){var n=r===null||r===void 0?void 0:r.getRootNode(),t,i,e;n&&(t=n.querySelector("".concat(o," .").concat(u.cameraAnimationAutoPlay?"trfcPauseBtn":"trfcPlayBtn")),t&&t.classList.add(p),i=n.querySelector("".concat(o," .trfCamCtrl")),i&&(i.style.display="flex"),e=n.querySelector("".concat(o," .trfcPlayPause")),e&&(e.onclick=function(n){var t=f&&f.paused;ut(t,!0);n.stopImmediatePropagation()}),ri(n))}function ri(n){var t=n.querySelector("".concat(o," .trfCamCtrl")),r=n.querySelector("".concat(o," .trfcProgressSlider"));if(f&&t&&r){y(0);var u=!1,e=0,s=0,v=36,h=254,c=function(n,t,r){var a=i._clamp(n.pageX-e+s,0,h),u=f.duration,o=a/h,c=t?Math.round(o*u)/u:o,l;y(c);r&&(l=c*u,f.currentTime=l)},l=function(n){u&&(u=!1,c(n,!1,!0),et("CAMDRAG"))},a=r.addEventListener("touchmove",!0);r.onpointerdown=function(n){a(n);ut(!1,!1);u=!0;s=r.offsetLeft-v;e=n.pageX};t.onpointermove=function(n){u&&c(n,!1,!1)};t.onpointerup=function(n){l(n)};t.onpointerleave=}function y(n){var f=100*n,t=r===null||r===void 0?void 0:r.getRootNode(),i,u;t&&(i=t.querySelector("".concat(o," .trfcProgressBarFront")),i&&(i.style.width="".concat(f,"%")),u=t.querySelector("".concat(o," .trfcProgressSlider")),u&&(u.style.marginLeft="calc(-8px + ".concat(f,"%)")))}function ut(n,t){var e=r===null||r===void 0?void 0:r.getRootNode();if(e&&f){var s=e.querySelector("".concat(o," .trfcPlayBtn")),h=e.querySelector("".concat(o," .trfcPauseBtn")),i=p,u=void 0;s&&h&&(n?(s.classList.remove(i),h.classList.add(i),f.play(),u="CAMPLAY"):(h.classList.remove(i),s.classList.add(i),f.pause(),u="CAMPAUSE"));t&&u&&et(u)}}function ft(n){var t=r===null||r===void 0?void 0:r.getRootNode();return t&&t.querySelector("".concat(o," ").concat(n?".cameraVideo":".cameraImg"))}function ui(n,t,i){var e=fi(n,t),u=tt(n,t,i),r,f;return t&&(r=u,r.onCameraCloseClick=ti,r.customActionAriaLabel=k,r.onCustomActionClick=,f=new ht(e,u),f.applyDataTemplate(u)}function fi(t,i){return i?n.cameraPopupTemplate!==null&&n.cameraPopupTemplate!==void 0?n.cameraPopupTemplate:at:t.isExpired?n.expiredIncidentPopupTemplate!==null&&n.expiredIncidentPopupTemplate!==void 0?n.expiredIncidentPopupTemplate:yt:n.incidentPopupTemplate!==null&&n.incidentPopupTemplate!==void 0?n.incidentPopupTemplate:vt}function et(n){var t=f&&f.duration;t&&e.instrumentationHelper&&e.instrumentationHelper.logInstrumentationEvent(n,{L:t})}var o=".MicrosoftMap .bm_trfcCamWrapper",p="active",ot=[13,-13],st=[4,-4],w,c,r,a,s,f,b,k,v;n.initialize=ct;n.preventAutoClose=lt;n.hide=d;n.show=bt;n.getCameraVisualUrl=g;n.getCameraSrcUrl=nt;n.setPopupCustomAction=kt;n.createViewModel=tt}(o||(o={})),function(n){function r(n){return!!(n&&n.type===12&&n.images&&n.images.length>0)}function u(n,r,u){var s,h=n.type===12,c=n.point.coordinates,l=9,e,o;return h&&(l=15),e={id:""+n.incidentId,incident:n,incidentTitle:h?n.description:k(n.type),incidentDescription:n.description,geometry:{geometryType:1,x:c[1],y:c[0]},bucket:f(n),primitiveType:l,state:2,stylesheetEntryState:i(n,r,u)},h?e.cameraImageUrl=(s=n.images&&n.images[0]&&n.images[0].imageUrl)!==null&&s!==void 0?s:"":(o=e,o.startTime=v(n.start),o.endTime=n.isEndTimeBackfilled?t.L_IncidentEndTimeUnknown_Text:v(n.end),o.severity=ft(n)),e}function i(n,t,i){if(n.type===12)return undefined;var r="lowSeverity";switch(n.severity){case 4:r="highSeverity";break;case 3:r="mediumSeverity"}return n.type!==1||(t===null||t===void 0?void 0:t.has(1))?n.type!==9||(t===null||t===void 0?void 0:t.has(9))?n.roadClosed&&!i&&(r+=";closure"):r+=";construction":r+=";accident",r}function f(n){var t="344";return n.type===12&&(t="1441"),t}n.isCamera=r;n.createIncidentPrimitive=u;n.getIncidentStyleSheetEntryState=i}(e||(e={}));function pt(n,i,r){var f,e,o;return{resources:r,rootClassName:"bm_trfcCamWrapper".concat(u.cameraAnimationEnabled?" camAnimation":""),description:(f=n.description)!==null&&f!==void 0?f:"",copyright:(e=n.copyright)!==null&&e!==void 0?e:"",altImageText:t.L_TrafficCurrentCameraImage_Text.replace("{0}",(o=n.description)!==null&&o!==void 0?o:""),nullToDisplayNone:ut}}function wt(n,i){var f,e,s=kt(n),r=(f=n.title)!==null&&f!==void 0?f:"",o=r.length?n.description.indexOf(r):-1,u=o>=0,h=k(n.type);return{resources:i,incidentTitle:s,severity:ft(n),severityType:(e=n.severity)!==null&&e!==void 0?e:0,description:u?"":n.description,preceedingDescription:u?n.description.substring(0,o):"",roadName:u?r:"",succeedingDescription:u?n.description.substring(o+r.length):"",tooltip:n.description,start:v(n.start),incidentType:n.type||6,end:n.isEndTimeBackfilled?t.L_IncidentEndTimeUnknown_Text:v(n.end),incidentTypeMessage:n.isExpired?t.L_TrafficExpired_TypeFormat.replace("{0}",h):"",severityTypeToClass:bt,nullToDisplayNone:ut}}nction v(n){var f="",e,r,u;return n&&(e=/\(([\d]+)\)/,r=e.exec(n),r&&r.length>1&&(u=new Date(parseInt(r[1],10)),f=i._formatString(t.L_TrafficDateTimeFormat,i._formatShortDateString(u),i._formatTimeString(u)))),f}function k(n){switch(n){case 9:return t.L_TrafficScheduledConstruction_Text;case 6:return t.L_TrafficOtherNews_Text;case 2:return t.L_TrafficCongestion_Text;case 1:return t.L_TrafficAccident_Text;case 3:return t.L_TrafficDisabledVehicle_Text;case 8:return t.L_TrafficRoadHazard_Text;case 10:return t.L_TrafficUnScheduledContruction_Text;case 7:return t.L_TrafficPlannedEvent_Text;case 4:return t.L_TrafficMassTransit_Text;case 11:return t.L_TrafficWeather_Text;case 5:return t.L_TrafficMiscellaneous_Text;case-1:return t.L_TrafficUnknown_Text;default:return""}}function ft(n){var f=n.severity,r=n.alertCCodes,i;if(n.isJamcident)i=t.L_TrafficIncidentDelay_Text.replace("{0}",dt(n.delay));else{switch(f){case 1:i=t.L_TrafficSeverityLowImpact_Text;break;case 2:i=t.L_TrafficSeverityMinor_Text;break;case 3:i=t.L_TrafficSeverityModerate_Text;break;case 4:i=t.L_TrafficSeveritySerious_Text;break;default:i=""}u.overrideMinorIncidentStrings&&f===2&&(r===null||r===void 0?void 0:r.some()&&(i=t.L_TrafficSeveritySerious_Text)}return i}function kt(n){return n.isExpired?t.L_TrafficExpired_Text:n.roadClosed&&n.type===5?t.L_TrafficRoadClosed_Text:k(n.type)}function dt(n){var r=Math.round(n/60),u=r%60,i=Math.floor(r/60),f=i===0?t.L_TrafficDelayDuration_Min_Short:t.L_TrafficDelayDuration_HrMin_Short;return i===0?f.replace("{0}",u.toString()):f.replace("{0}",i.toString()).replace("{1}",u.toString())}et=f.Traffic=f.Traffic||{};et.TrafficPrimitivePopup=o;f.TrafficControl=e}catch(ot){if(f&&f.logger)f.logger.logCriticalError(ot);else throw ot;}}).call(window)