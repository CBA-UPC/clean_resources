;
(self.AMP=self.AMP||[]).push({m:1,v:"2312191621000",n:"amp-consent",ev:"0.1",l:!0,f:function(t,n){(()=>{var n;ar i={isArray:s}=Array;ar r,{hasOwnProperty:h,toString:c}=Object.prototype;tion d(t,n,e,i,s,o,r,h,c,a,u){return t}function f(t,n){return t.replace(/^|,/g,`$&${n} `)}ar _=["Webkit","webkit","Moz","moz","ms","O","o"];function P(t){const n=t.replace(/[A-Z]/g,();return _.some(()?`-${n}`:n}unction v(t,n,e,i,s){const o=g(t.style,n,s);if(!o)return;const r=i?e+i:e;t.style.setProperty(P(o),r)}/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;unction C(t){const n=u();if(!t)return n;let e;for(;e=M.exec(t);){const t=T(e[1],e[1]),i=e[2]?T(e[2].replace(/\+/g," "),e[2]):"";n[t]=i}return n}function w(t){const{location:n}=t||self;return C(n.originalHash||n.hash)}var V="";function k(t){var n;return V||(V=(null===(n=t.AMP_CONFIG)||void 0===n?void 0:n.v)||"012312191621000"),V}elf.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var O=self.__AMP_LOG;G(t,n){return function(t,n){const e=J(t,n);if(e)return e;const s=K(t);return s[n]=function(){const t=new i,{promise:n,reject:e,resolve:s}=t;return n.catch((()=>{})),{obj:null,promise:n,resolve:s,reject:e,context:null,ctor:null}}(),s[n].promise}(B(t),n)}=>F(t,"owners"),Z=t=>q(t,"url-replace"),X=tt="notificationUIManager";ot={};.appconsent={"consentInstanceId":"appconsent","checkConsentHref":"https://collector.appconsent.io/amp/check-consent","promptUISrc":"https://cdn.appconsent.io/loader.html"},ot.ConsentManager={"consentInstanceId":"ConsentManager","checkConsentHref":"https://delivery.consentmanager.net/delivery/ampcheck.php","promptUISrc":"https://delivery.consentmanager.net/delivery/ampui.php"},ot.didomi={"consentInstanceId":"didomi","checkConsentHref":"https://api.privacy-center.org/amp/check-consent","promptUISrc":"https://sdk-amp.privacy-center.org/loader.html"},ot.iubenda={"consentInstanceId":"iubenda","checkConsentHref":"https://amp.iubenda.com/checkConsent","promptUISrc":"https://www.iubenda.com/en/help/22135-cookie-solution-amp"},ot.sirdata={"consentInstanceId":"sirdata","checkConsentHref":"https://choices.consentframework.com/api/v1/public/amp/check","promptUISrc":"https://ui.consentframework.com/amp/loader.html"},ot.Marfeel={"consentInstanceId":"Marfeel","checkConsentHref":"https://live.mrf.io/cmp/marfeel/amp/check-consent","promptUISrc":"https://live.mrf.io/cmp/marfeel/amp/index.html"},ot.Ogury={"consentInstanceId":"Ogury","checkConsentHref":"https://api.ogury.mgr.consensu.org/v1/check-for-consent","promptUISrc":"https://www.ogury.mgr.consensu.org/amp.html"},ot.onetrust={"consentInstanceId":"onetrust","checkConsentHref":"https://cdn.cookielaw.org/amp/consent/check","promptUISrc":" https://amp.onetrust.mgr.consensu.org/"},ot.opencmp={"consentInstanceId":"opencmp","checkConsentHref":"https://amp.opencmp.net/consent/check","promptUISrc":"https://cdn.opencmp.net/tcf-v2/amp/cmp.html"},ot.pubtech={"consentInstanceId":"pubtech","checkConsentHref":"https://amp.pubtech.it/cmp-amp-check-consent","promptUISrc":"https://cdn.pubtech.ai/amp/index.html"},ot.quantcast={"consentInstanceId":"quantcast","checkConsentHref":"https://apis.quantcast.mgr.consensu.org/amp/check-consent","promptUISrc":"https://quantcast.mgr.consensu.org/tcfv2/amp.html"},ot.SourcePoint={"consentInstanceId":"SourcePoint","checkConsentHref":"https://sourcepoint.mgr.consensu.org/consent/v2/amp","promptUISrc":"https://amp.pm.sourcepoint.mgr.consensu.org/"},ot.UniConsent={"consentInstanceId":"UniConsent","checkConsentHref":"https://edge.uniconsent.com/amp/check-consent","promptUISrc":"https://cmp.uniconsent.com/amp/index.html"},ot.Usercentrics={"consentInstanceId":"Usercentrics","checkConsentHref":"https://consents.usercentrics.eu/amp/checkConsent","promptUISrc":"https://amp.usercentrics.eu/amp.html"},ot.LiveRamp={"consentInstanceId":"LiveRamp","checkConsentHref":"https://api.privacymanager.io/amp/check-consent","promptUISrc":"https://amp-consent-tool.privacymanager.io/1/index.html"},ot.googlefc={"consentInstanceId":"googlefc","checkConsentHref":"https://fundingchoicesmessages.google.com/amp/consent/check?pvid=PAGE_VIEW_ID_64&anonid=CONSENT_PAGE_VIEW_ID_64&href=SOURCE_URL","promptUISrc":"https://fundingchoicesmessages.google.com/amp/consent/message?pvid=PAGE_VIEW_ID_64&anonid=CONSENT_PAGE_VIEW_ID_64&href=SOURCE_URL&clientConfig=CONSENT_INFO(clientConfig)","xssiPrefix":")]}'","uiConfig":{"overlay":!0},"clearDirtyBitOnResponse_dontUseThisItMightBeRemoved":!0};var ct,at={"-":"+","_":"/",".":"="},ut={"+":"-","/":"_","=":"."},lt=(()=>self.AMP.config.urls)(),pt=new Set(["c","v","a","ad"]),dt=function ft(t,n){return ct||(ct=self.document.createElement("a")),ct,t)}unction _t(t){return lt.cdnProxyRegex.test(dt(t).origin)}ar gt=vt=((),At="-test-amp-cookie-tmp";r yt=31536e6;var Rt="removeEventListener";nction Tt(t,n,e){if(!t&&!n)return!0;if(t&&n){const i=Mt(t.consentState)===Mt(n.consentState),s=(t.consentString||"")===(n.consentString||"");let o;o=e?!!t.isDirty==!!e:!!t.isDirty==!!n.isDirty;const r=b(t.consentMetadata,n.consentMetadata),h=b(t.purposeConsents,n.purposeConsents),c=t.tcfPolicyVersion==n.tcfPolicyVersion;return i&&s&&r&&h&&o&&c}return!1}t="CONSENT-STATE-MANAGER";ar Ut="amp-consent/consent-config",jt="amp-story-consent",Dt={"promptUI":!0,"checkConsentHref":!0,"promptIfUnknownForGeoGroup":!0,"onUpdateHref":!0},Nt={"CANONICAL_URL":!0,"PAGE_VIEW_ID":!0,"PAGE_VIEW_ID_64":!0,"SOURCE_URL":!0};function Lt(t,n,e){const i=st({"CLIENT_ID":Ht(t),"CONSENT_PAGE_VIEW_ID_64":()=>xt(t).then((t=>t.consentPageViewId64()))},e);return Z(t).expandUrlAsync(n,i,st(st({},i),Nt))}function Ht(t){return(n=t,G(n,"cid")).then((t=>t.get({scope:"AMP-CONSENT",createCookieIfNotPresent:!0},e())));var n}var Ft,qt="consent-policy-manager",Gt={"default":!0,"_till_responded":!0,"_till_accepted":!0,"_auto_reject":!0};function $t(t){const n=t.tagName;return n.startsWith("AMP-")&&!("AMP-STICKY-AD-TOP-PADDING"==n||"AMP-BODY"==n)}ar Bt=['<svg viewBox="0 0 40 40"><defs><linearGradient id=grad><stop stop-color="rgb(105, 105, 105)"></stop><stop offset=100% stop-color="rgb(105, 105, 105)" stop-opacity=0></stop></linearGradient></defs><path d="M11,4.4 A18,18, 0,1,0, 38,20" stroke=url(#grad)></path></svg>'],Wt="amp-consent-ui",Jt=["allow-popups-to-escape-sandbox","allow-top-navigation-by-user-activation"],Kt="i-amphtml-consent-ui-iframe-fullscreen",Qt="i-amphtml-consent-ui-iframe-active",Yt="i-amphtml-consent-ui-modal",Zt="i-amphtml-consent-ui-in",Xt="i-amphtml-consent-ui-loading",tn="i-amphtml-consent-ui-border-enabled",nn=class{constructor(t,n,e){this.att=t,this.Rnt=!1,this.Vnt=!1,this.rs=!1,this.Unt=!1,this.vy=!1,this.jnt=null,this.Dnt=n.uiConfig&&!0===n.uiConfig.overlay,this.Nnt=n.captions&&n.captions.consentPromptCaption||"User Consent Prompt",this.Lnt=n.captions&&n.captions.buttonActionCaption||"Focus Prompt",this.Hnt=!1,this.Fnt=!0,this.mX=null,this.qnt=null,this.Gnt=null,this.Ni=t.getAmpDoc(),this.Uu=F(this.Ni,"viewport"),this.Fe=(t=>F(this.Ni,"viewer"))(),this.qt=t.element,this.i=t.win,this.Zh=this.i.document,this.$nt=null,this.SM=!1,this.Bnt=null,this.vb=null,this.Wnt="30vh",this.Jnt=!0,this.Knt=!1,this.Qnt=!1,this.Ynt=this.Znt.bind(this),this.OE=n,this.Au(n,e)}Au(t,n){if(n){const t=this.Ni.getElementById(n);return t||U().error(Wt,"postPromptUI element with id=%s not found",n),this.jnt=t,void(this.Vnt=!0)}const e=t.promptUI,i=t.promptUISrc;if(e){const t=this.Ni.getElementById(e);t&&this.qt.contains(t)||U().error(Wt,"child element of <amp-consent> with promptUI id %s not found",e),this.jnt=t}else i&&(this.Rnt=!0,mt(i,this.qt),this.jnt=this.Xnt(i),this.vb=this.cit(),this.Bnt=t.clientConfig||null)}show(t){if(!this.jnt)return;if(this.Vnt&&!this.qt.contains(this.jnt))return void I(this.jnt,!0);I(this.qt,!0);const{classList:n}=this.qt;if(n.add("amp-active"),n.remove("amp-hidden"),this.att.getViewport().addToFixedLayer(this.qt,!0),this.Rnt)this.Qnt=t,this.ait().then((()=>{this.att.mutateElement((()=>{this.Vnt||(this.Gnt=this.Zh.activeElement),this.pit(),this.dit(),this.fit()}))}));else{const t=()=>{this.jnt&&(I(this.jnt,!0),this.Vnt||(this.Gnt=this.Zh.activeElement,this.pit(),this.resume(),this.jnt.focus()))};$t(this.jnt)?function(t){if(d($t(t)),t.createdCallback)return Promise.resolve(t);if(!t.__AMP_UPG_PRM){const n=new i;t.__AMP_UPG_PRM=n.promise,t.__AMP_UPG_RES=n.resolve}const n=t.__AMP_UPG_PRM;return d(n),n}(this.jnt).then(().then(():t()}this.rs=!0}hide(){this.jnt&&(this.pause(),this.att.mutateElement((()=>{if(this.Rnt&&this.mit(),!this.Vnt){const{classList:t}=this.qt;t.remove("amp-active"),t.add("amp-hidden")}this._it(),this.Pit(),this.git(),this.vit(),this.att.getViewport().removeFromFixedLayer(this.qt),I(this.jnt,!1),this.rs=!1,this.Gnt?(this.Gnt.focus(),this.Gnt=null):this.i.document.body.children.length>0&&this.i.document.body.children[0].focus()})))}pauseesumeit(t){if(this.Wnt="30vh",this.Jnt=!0,this.Knt=!1,t.initialHeight)if("string"==typeof t.initialHeight&&t.initialHeight.indexOf("vh")>=0){const n=parseInt(t.initialHeight,10);this.Wnt=n>=80?"80vh":this.Wnt,n>=10&&n<=80?(this.Wnt=`${n}vh`,this.Knt=n>60,this.Dnt=this.Knt||this.Dnt):U().error(Wt,`Inavlid initial height: ${t.initialHeight}.Minimum: 10vh. Maximum: 80vh.`)}else U().error(Wt,`Inavlid initial height: ${t.initialHeight}.Must be a string in "vh" units.`);!1!==t.border||this.Knt||(this.Jnt=!1),this.$nt.resolve()}Iit(){if(!this.jnt||!this.rs||this.vy)return;this.vit(),this.bit("requestFullOverlay");const{classList:t}=this.qt;t.add(Kt),this.P4(),this.vy=!0}bitnt(t){const n=this.qt.ownerDocument.createElement("iframe"),e=this.yit(t);n.setAttribute("sandbox",e);const{classList:i}=n;return i.add("i-amphtml-consent-ui-fill"),n}yititit(){return(this.OE.sandbox||"").split(" ").filter(Boolean).filter((t=>{const n=-1!==Jt.indexOf(t);return n||U().error(Wt,`The sandbox attribute "${t}" is not allowed`),n}))}cit(){const t=this.qt.ownerDocument.createElement("placeholder");I(t,!1),t.classList.add("i-amphtml-consent-ui-placeholder");const n=function(t){const n=t.ownerDocument||t;return Ft&&Ft.ownerDocument===n||(Ft=n.createElement("div")),zt}(t)(Bt);return t.appendChild(n),t}Mit(){return xt(this.Ni).then((t=>t.getLastConsentInstanceInfo().then((t=>({"clientConfig":this.Bnt,"consentState":St(t.consentState),"consentStateValue":St(t.consentState),"tcfPolicyVersion":t.tcfPolicyVersion,"consentMetadata":t.consentMetadata,"consentString":t.consentString,"promptTrigger":this.Qnt?"action":"load","isDirty":!!t.isDirty,"purposeConsents":t.purposeConsents})))))}ait(){this.$nt=new i;const{classList:t}=this.qt;var n;n=this.qt,m("placeholder"),n.querySelector("placeholder")||R(this.qt,this.vb),t.add(Xt),I(this.jnt,!1),this.SM=!1;const e=this.Mit().then((t=>Lt(this.qt,this.OE.promptUISrc,{"CONSENT_INFO":).then((n=>{this.jnt.src=n,this.jnt.setAttribute("name",JSON.stringify(t)),this.i.addEventListener("message",this.Ynt),R(this.qt,this.jnt)}))));return Promise.all([e,this.$nt.promise,this.att.mutateElement(()])}fit(){const{classList:t}=this.qt;t.add(Qt),I(this.vb,!1),I(this.jnt,!0),this.Knt&&(t.add(Yt),E(this.jnt)),this.vit(),this.att.mutateElement((()=>{t.remove(Xt),this.att.mutateElement((()=>{t.add(Zt),this.Unt=!0,this.Tit()}))}))}mit(){const{classList:t}=this.qt;t.remove(Qt),t.remove(Yt),t.remove(tn),this.i.removeEventListener("message",this.Ynt),t.remove(Kt),this.vy?this.bit("cancelFullOverlay"):this.Knt&&this.Uu.leaveLightboxMode(),this.vy=!1,t.remove(Zt),this.Unt=!1,this.jnt.removeAttribute("name"),I(this.vb,!1),this.SM=!0,this.i.setTimeout((,1e3)}dit(){if(this.Hnt||this.Knt)return;const t=this.Zh.createElement("div"),n=this.Zh.createElement("button"),e=this.Zh.createElement("div");t.setAttribute("role","alertdialog"),e.textContent=this.Nnt,n.textContent=this.Lnt,n.onclick=t.appendChild(e),t.appendChild(n);const{classList:i}=t;i.add("i-amphtml-consent-alertdialog"),this.att.element.appendChild(t),E(n),this.Hnt=!0,this.qnt=t}itit(){const{classList:t}=this.qt;this.jnt&&A(this.jnt,{height:this.Wnt}),function(t,n){const{style:e}=t;for(const t in n)e.setProperty(P(g(e,t)),String(n[t]),"important")}(this.qt,{"--i-amphtml-modal-height":`${this.Wnt}`}),t.add("i-amphtml-consent-ui-iframe-transform"),(this.Jnt||this.Knt)&&t.add(tn),this.Knt&&this.Uu.enterLightboxMode()}pitit(t){if(this.jnt.contentWindow!==t.source)return;const n=nt(t);if(!n||"consent-ui"!=n.type)return;const e=n.action,i=n.type;if("ready"===e&&this.Ait(n),"enter-fullscreen"===e){if(!this.Unt||this.Knt||this.Zh.activeElement!==this.jnt&&!this.Qnt)return void this.Cit(i,e,!0);this.Cit(i,e),this.att.mutateElement(()}}Cit(t,n,e=!1){this.wit("amp-consent-response",t,n,e?"error":"success",e?"Could not enter fullscreen. Fullscreen is only supported when the iframe is visible as a bottom sheet and after user interaction.":"Entering fullscreen.")}wit,en=null,sn="*",on=/^[a-zA-Z0-9\-_.]+$/,rn="amp-analytics/linker";function hn(t,n){const e=n||0;return function(t){en||(en=));const n=(e=t,"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):rt(unescape(encodeURIComponent(e))));var e;let i=-1>>>0;for(let t=0;t<n.length;t++){const e=255&(i^n[t]);i=i>>>8^en[e]}return(-1^i)>>>0}([),Math.floor(Date.now()/6e4)-e,t].join(sn)).toString(36)}ar an="amp-consent/cookie-writer",un={"referrerDomains":!0,"enabled":!0,"cookiePath":!0,"cookieMaxAge":!0,"cookieSecure":!0,"cookieDomain":!0},ln={"LINKER_PARAM":!0},pn="amp-consent",dn="loaded",fn=mn="consentStateManager",_n="consentPolicyManager",Pn="amp-consent",gn="accept",vn="reject",An="dismiss",In=class extends t.BaseElement{constructor(t){super(t),this.Vit=null,this.kit=null,this.Sit=null,this.Oit=null,this.xit=null,this.AV=null,this.Uit=null,this.jit=null,this.Dit=null,this.Nit=!1,this.Lit=!1,this.Hit=!1,this.ar=this.getVsync(),this.Fit=null,this.qit=null,this.Git=null,this.$it=null}uildCallback(){L(this.element.getAttribute("id"),"amp-consent should have an id");const t=new class{tMatchedGeoGroup(){return this.Git}Bit(t){const n=t.consents;if(!t.consents)return t;const e=Object.keys(n);if(L(e.length<=1,"%s: only single consent instance is supported",Ut),e.length>0){t.consentInstanceId=e[0];const n=t.consents[e[0]],i=Object.keys(n);for(let e=0;e<i.length;e++){const s=i[e];!t[s]&&Dt[s]&&(t[i[e]]=n[i[e]])}}return delete t.consents,t}zit(){const t=this.Bit(L(this.ent(),"%s: Inline config not found")),n=p(this.Wit()||{},t||{},1);if(L(n.consentInstanceId,"%s: consentInstanceId to store consent info is required",Ut),n.policy){const t=Object.keys(n.policy);for(let e=0;e<t.length;e++)"default"!=t[e]&&delete n.policy[t[e]]}const e=n.promptIfUnknownForGeoGroup;return"string"==typeof e?(n.consentRequired=!1,n.geoOverride={[e]:{"consentRequired":!0}}):void 0===n.consentRequired&&n.checkConsentHref&&(n.consentRequired="remote"),this.Jit(n).then((t=>this.Kit(t))).then(()}Jit(t){return t.geoOverride?(n=this.yf,n,"geo","amp-geo")).then((n=>{L(n,"%s: requires <amp-geo> to use `geoOverride`",Ut);const e=u(t),i=Object.keys(t.geoOverride);for(let s=0;s<i.length;s++)if(2===n.isInCountryGroup(i[s])){const n=t.geoOverride[i[s]];l(n,"consentInstanceId")&&(U().error(Ut,"consentInstanceId cannot be overriden in geoGroup:",i[s]),delete n.consentInstanceId),p(e,n,1),this.Git=i[s];break}return delete e.geoOverride,e})):Promise.resolve(t);var n}Kitit(t){return n=this.yf,m(jt),"> amp-story-consent",n.querySelector(f("> amp-story-consent",":scope"))&&L(!t.promptUISrc,"%s: `promptUiSrc` cannot be specified while using %s.",Ut,jt),t;var n}ent(){try{return function(t){const n=(i=t,m("script"),i.querySelectorAll(f("> script",":scope"))),{length:e}=n;var i;if(1!==e)throw new Error(`Found ${e} <script> children. Expected 1.`);const s=n[0];if(!function(t){var n;return"SCRIPT"==t.tagName&&"APPLICATION/JSON"==(null===(n=t.getAttribute("type"))||void 0===n?void 0:n.toUpperCase())}(s))throw new Error('<script> child must have type="application/json"');try{var o;return r=null!==(o=s.textContent)&&void 0!==o?o:"",JSON.parse(r)}catch(t){throw new Error("Failed to parse <script> contents. Is it valid JSON?")}var r}(this.yf)}catch(t){throw U(this.yf).createError(Ut,t)}}Witit(t){const n=["consentInstanceId","checkConsentHref","promptUISrc"];for(let e=0;e<n.length;e++)N(t[n[e]])}}(this.element);return t.getConsentConfigPromise().then((n=>{this.Git=t.getMatchedGeoGroup(),this.pe(n)}))}pauseCallback(){this.xit&&this.xit.pause()}e(t){this.AV=t,this.qit=this.AV.consentInstanceId,this.AV.postPromptUI&&(this.jit=new nn(this,{},this.AV.postPromptUI));const n=this.AV.policy||{};this.Uit=n,this.qit);const i=function(t,n){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)!(function(t){let n;var e;return"string"==typeof t?n=t:1==(null==(e=t)?void 0:e.nodeType)&&(n=t.tagName),!!n&&n.toLowerCase().startsWith("i-")}(i=n)||i.nodeType===Node.ELEMENT_NODE&&(i.hasAttribute("placeholder")||i.hasAttribute("fallback")||i.hasAttribute("overflow")))&&e.push(n);var i;return e}(this.element);for(let t=0;t<i.length;t++){const n=i[t];I(n,!1),Y(this.element).setOwner(n,this.element)}const s=G(this.getAmpDoc(),_n).then((t=>{this.kit=t,this.kit.setLegacyConsentInstanceId(this.qit);const n=Object.keys(this.Uit);for(let t=0;t<n.length;t++)this.kit.registerConsentPolicyInstance(n[t],this.Uit[n[t]])})),r=G(this.getAmpDoc(),mn).then((t=>{t.registerConsentInstance(this.qit,this.AV),this.Vit=t})),h=G(this.getAmpDoc(),tt).then((),c=this.AV.cookies?new class{constructor(t,n,e){this.i=t,this.yf=n,this.Zit=null,this.OE=e,this.Xit=new class{t(t){const n=C(this.i.location.search);return l(n,t)?n[t]):null}}(t)}write(){return this.Zit||(this.Zit=this.Au()),this.Zit}Au(){if(!this.bst(this.i,this.yf))return e();if(!l(this.OE,"cookies"))return e();if(!a(this.OE.cookies))return U().error(an,"cookies config must be an object"),e();const t=this.OE.cookies;if(!1===t.enabled)return e();const n=this.yst(t),i=Object.keys(t),s=[];for(let e=0;e<i.length;e++){const o=i[e],r=t[o];this.Rst(o,r)&&s.push(this.Est(o,r.value,n))}return Promise.all(s)}t(t,n,e){return Z(this.yf).expandStringAsync(n,{"LINKER_PARAM":,ln).then((n=>{if(n){const i=Date.now()+e;!function(t,n,e,i,s={}){let r;!t,s,n),s.domain?r=s.domain:s.highestAvailableDomain&&(r=function(t){const n=t.document.head&&t.document.head.querySelector("meta[name='amp-cookie-scope']");if(n){const e=n.getAttribute("content")||"",i=ft(Pt(t.location.href)).origin;return o(i,"."+e)?e:i.split("://")[1]}if(!_t(t.location.href)){const n=t.location.hostname.split(".");let e=n[n.length-1];const i=t);for(let s=n.length-2;s>=0;s--)if(e=n[s]+"."+e,bt(t,i,"delete",Date.now()+1e3,e),"delete"==It(t,i))return bt(t,i,"delete",Date.now()-1e3,e),e}return null}(t)),bt(t,n,e,i,r,s.sameSite,s.secure)}(this.i,t,n,i,{highestAvailableDomain:!0})}})).catch((t=>{U().error(an,"Error expanding cookie string",t)}))}bst(){return!((t=this.yf).classList.contains("i-amphtml-fie")||t)||_t(this.i.location)||"inabox"==function(t){const n=t||self;return n.__AMP_MODE?n.__AMP_MODE:n.__AMP_MODE=n)}(this.i).runtime);var t}}(this.win,this.element,this.AV).write():e();Promise.all([r,h,s,c]).then((()=>{this.Au()}))}Mst(){this.registerAction("accept",(t=>{this.Tst(gn,t)})),this.registerAction("reject",(),this.registerAction("dismiss",(()=>{this.Tst(An)})),this.registerAction("setPurpose",(),this.registerAction("prompt",(t=>this.wst(t))),this.Vst()}Tst(t,n){this.kst()&&this.Sst(t,n).then((()=>{this.XF(t)}))}Vst(){this.win.addEventListener("message",(t=>{if(!this.Nit)return;let n,e,i;const s=nt(t);if(!s||"consent-response"!=s.type)return;if(!s.action)return void U().error(Pn,"consent-response message missing required info");void 0!==s.info&&("string"!=typeof s.info&&(U().error(Pn,"consent-response info only supports string, %s, treated as undefined",s.info),s.info=void 0),s.action===An&&(s.info&&this.user().error(Pn,"Consent string value %s not applicable on user dismiss, stored value will be kept and used",s.info),s.info=void 0),n=s.info,e=this.Ost(s.tcfPolicyVersion),i=this.xst(s.consentMetadata));const o=this.element.querySelectorAll("iframe");for(let r=0;r<o.length;r++)if(o[r].contentWindow===t.source){const{action:t,purposeConsents:o}=s;if(!fn(t)||!this.kst())continue;o&&Object.keys(o).length&&t!==An&&(this.Ust(o),this.Vit.updateConsentInstancePurposes(o)),this.XF(t,n,i,e)}}))}jst2(t){this.Nit&&D().error(Pn,"Attempt to show an already displayed prompt UI"),this.ar.mutate((()=>{this.xit.show(t),this.Nit=!0}));const n=new i;return this.Dit=n.resolve,n.promise}o3stF(t,n,i,s){(fn(t)&&this.AV.clearDirtyBitOnResponse_dontUseThisItMightBeRemoved?this.Vit.setDirtyBit(!1):e()).then(()}Dstst(t,n){var i;return"boolean"!=typeof(null==n||null===(i=n.args)||void 0===i?void 0:i.purposeConsentDefault)?e():t===An?(D.warn(Pn,"Dismiss cannot have a `purposeConsentDefault` parameter."),e()):this.Nst().then((t=>{if(!t||!t.length)return;const e={},i=n.args.purposeConsentDefault;t.forEach((),this.Vit.updateConsentInstancePurposes(e,!0)}))}wst(t){const{args:n}=t;(!0===(null==n?void 0:n.expireCache)?this.Vit.setDirtyBit():e()).then(()}Cst(t){if(!t||!t.args||!Object.keys(t.args).length)return void D().error(Pn,"Must have arugments for `setPurpose`.");const{args:n}=t;this.kst()&&(this.Ust(n),this.Vit.updateConsentInstancePurposes(n))}Au(){this.Lst(),this.Hst(),this.Fst(),this.qst().then((t=>this.Gst(t))).then((t=>{t&&this.$st(),this.kit.enableTimeout()})).catch((),this.Mst()}qst(){return this.Vit.getConsentInstanceInfo().then((t=>{if(kt(t))return Promise.resolve(!0);const n=this.AV.consentRequired;return"boolean"==typeof n?Promise.resolve(n):this.zst().then((t=>!!t&&(void 0!==t.consentRequired?!!t.consentRequired:!!t.promptIfUnknown)))}))}Lst(){const t=this.zst().then((t=>t&&void 0!==t.sharedData?t.sharedData:null));this.Vit.setConsentInstanceSharedData(t)}Hst(){this.zst().then((t=>{t&&((t.expireCache||t.forcePromptOnNext)&&this.Vit.setDirtyBit(),t.consentRequired&&!this.Lit&&this.Bst(t.consentStateValue,t.consentString||void 0,t.consentMetadata,t.purposeConsents,t.tcfPolicyVersion))}))}Bst(t,n,e,i,s){const o="accepted"===(r=t)?1:"rejected"===r?2:"unknown"===r?5:null;var r;null!==o&&(i&&a(i)&&Object.keys(i).length&&(this.Ust(i),this.Vit.updateConsentInstancePurposes(i)),this.Vit.updateConsentInstanceState(o,n,this.xst(e),s))}zst(){if(this.Fit)return this.Fit;const{"checkConsentHref":t}=this.AV;if(t){const n=this.Vit.getLastConsentInstanceInfo();this.Fit=n.then((n=>{const e={credentials:"include",method:"POST",body:{"consentInstanceId":this.qit,"consentStateValue":St(n.consentState),"consentMetadata":n.consentMetadata,"consentString":n.consentString,"tcfPolicyVersion":n.tcfPolicyVersion,"isDirty":!!n.isDirty,"matchedGeoGroup":this.Git,"purposeConsents":n.purposeConsents,"clientConfig":this.AV.clientConfig}};mt(t,this.element);const i=this.getAmpDoc(),s=Pt(i.getUrl()),o=(h=t,c=dt(c=s),new URL(h,c.href).toString()),r=X(this.win);var h,c;return i.whenFirstVisible().then((()=>Lt(this.element,o).then((t=>r.fetchJson(t,e).then((t=>r.xssiJson(t,this.AV.xssiPrefix).catch((t=>{U().error(Pn,"Could not parse the `checkConsentHref` response.",t)}))))))))}))}else this.Fit=Promise.resolve(null);return this.Fit}Wst(t){return this.Nst().then((n=>{if(null==n||!n.length)return this.Vit.hasAllPurposeConsents(),!0;const e=t.purposeConsents;if(!e||Object.keys(e).length<n.length)return!1;for(let t=0;t<n.length;t++)if(!l(e,n[t]))return!1;return this.Vit.hasAllPurposeConsents(),!0}))}Nst(){if(this.$it)return this.$it;const t=this.AV.purposeConsentRequired;return s(t)?this.$it=Promise.resolve(t):this.$it=this.zst().then((t=>t&&s(t.purposeConsentRequired)?t.purposeConsentRequired:null)),this.$it}Jst(){return this.Vit.getConsentInstanceInfo().then((t=>kt(t)?this.Wst(t):Promise.resolve(!1)))}Gst(t){return this.xit=new nn(this,N(this.AV)),this.Jst().then((n=>!!n||(t?(this.jst(!1),!0):(this.Vit.updateConsentInstanceState(4),!1))))}$st(){this.jit&&(this.Oit.onQueueEmpty((()=>{this.ar.mutate(()})),this.Oit.onQueueNotEmpty((()=>{this.ar.mutate(()})))}getConsentStateManagerForTesting(){return this.Vit}etIsPromptUiOnForTesting(){return this.Nit}Ust(t){Object.keys(t).forEach(()}Ostst(t){if(t){if(a(t))return function(t){const n=t.consentStringType,e=t.additionalConsent,i=t.gdprApplies,s=t.purposeOne,o=[];var r;n&&1!==(r=n)&&2!==r&&3!==r&&(delete t.consentStringType,o.push("consentStringType")),e&&"string"!=typeof e&&(delete t.additionalConsent,o.push("additionalConsent")),i&&"boolean"!=typeof i&&(delete t.gdprApplies,o.push("gdprApplies")),s&&"boolean"!=typeof s&&(delete t.purposeOne,o.push("purposeOne"));for(let t=0;t<o.length;t++)U().error("amp-consent",'Consent metadata value "%s" is invalid.',o[t])}(t),wt(t.consentStringType,t.additionalConsent,t.gdprApplies,t.purposeOne);U().error(Pn,"CMP metadata is not an object.")}}Fst(){if(!this.AV.exposesTcfApi)return;if(this.win.frames.__tcfapiLocator)return;this.Sit=new class{constructor(t){this.Kst=t,this.Qst=u(),this.Yst=null,this.Zst=0,t.setOnPolicyChange((()=>{this.Xst()}))}handleTcfCommand(t,n){if(!this.tot(t.__tcfapiCall))return;const e=t.__tcfapiCall,{command:i}=e;switch(i){case"ping":this.not(e,n);break;case"getTCData":this.eot(e,n);break;case"addEventListener":this.iot(e,n);break;case Rt:this.sot(e,n);break;default:return}}iotot(t,n){const{callId:e,parameter:i}=t,s=!!this.Qst[i];s&&delete this.Qst[i],this.oot(n,void 0,e,s)}Xst(){Object.keys(this.Qst).length&&this.rot().then((t=>{const n=t[2];if(!n||n===this.Yst)return;this.Yst=n;const e=Object.keys(this.Qst);for(let i=0;i<e.length;i++){const s=Number(e[i]);if(!l(this.Qst,s))continue;const{payload:o,win:r}=this.Qst[s],{callId:h}=o,c=this.hot(t[0],t[1],n,s,t[3]);this.oot(r,c,h,!0)}}))}rotot(t,n){this.rot().then((e=>{const i=this.hot(e[0],e[1],e[2],void 0,e[3]),{callId:s}=t;this.oot(n,i,s,!0)}))}hotot(t,n){const e=this.Kst.getConsentMetadataInfo("default"),i=this.Kst.getTcfPolicyVersion("default");Promise.all([e,i]).then((e=>{const i=this.cot(e[0],e[1]),{callId:s}=t;this.oot(n,i,s)}))}cotot(t,n,e,i){if(!t)return;const s={returnValue:n,callId:e,success:i};t.postMessage({__tcfapiReturn:s},"*")}tot(t){if(!a(t))return U().error(pn,`"tcfapiCall" is not an object: ${t}`),!1;const{command:n,parameter:e,version:i}=t;return"getTCData"!==(s=n)&&"ping"!==s&&"addEventListener"!==s&&"removeEventListener"!==s?(U().error(pn,`Unsupported command found in "tcfapiCall": ${n}`),!1):e&&n!=Rt?(U().error(pn,`Unsupported parameter found in "tcfapiCall": ${e}`),!1):2==i||(U().error(pn,`Found incorrect version in "tcfapiCall": ${i}`),!1);var s}this.kit),this.win.addEventListener("message",(t=>this.aot(t)));const t=this.element.ownerDocument.createElement("iframe");t.setAttribute("name","__tcfapiLocator"),t.setAttribute("aria-hidden","true"),I(t,!1),this.element.appendChild(t)}aot;t.registerElement("amp-consent",In,"amp-consent{position:fixed!important;bottom:0;left:0;overflow:hidden!important;background:hsla(0,0%,100%,0.7);width:100%;z-index:2147483645}amp-consent[i-amphtml-notbuilt]>*{display:none!important}amp-consent>*{max-height:100vh!important}amp-consent.amp-active{visibility:visible}amp-consent.amp-hidden{visibility:hidden}@keyframes amp-consent-ui-placeholder-spin{0%{transform:rotate(0deg)}to{transform:rotate(360deg)}}.i-amphtml-consent-ui-placeholder{width:100%;height:100%;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}.i-amphtml-consent-ui-placeholder>svg{width:30px;height:30px;fill:none;stroke-width:1.5px;transform-origin:50% 50%;animation:amp-consent-ui-placeholder-spin 1000ms linear infinite}.i-amphtml-consent-alertdialog{overflow:hidden;position:absolute;height:1px;width:1px;top:auto;left:auto}.i-amphtml-consent-ui-fill{position:absolute;top:0;left:0;width:100%}iframe.i-amphtml-consent-ui-fill{border:none}amp-consent.i-amphtml-consent-ui-iframe-active{width:100%!important;height:100%!important;padding:0px!important;margin:0px!important;overflow:auto!important;transform:translate3d(0px,100vh,0px)!important}amp-consent.i-amphtml-consent-ui-iframe-active.i-amphtml-consent-ui-modal{box-sizing:border-box;top:0;right:0;animation:i-amphtml-modal-appear 0.5s;animation-fill-mode:forwards;height:var(--i-amphtml-modal-height)!important;width:90vw!important;margin:auto!important;max-width:760px}amp-consent.i-amphtml-consent-ui-border-enabled{border-top-left-radius:8px!important;border-top-right-radius:8px!important;box-shadow:0 0 5px 0 rgba(0,0,0,0.2)!important}amp-consent.i-amphtml-consent-ui-modal.i-amphtml-consent-ui-border-enabled{border-radius:8px!important;box-shadow:0 0 5px 0 rgba(0,0,0,0.2)!important}amp-consent.i-amphtml-consent-ui-iframe-active.i-amphtml-consent-ui-iframe-transform{transform:translate3d(0px,calc(100% - var(--i-amphtml-modal-height)),0px)!important}amp-consent.i-amphtml-consent-ui-iframe-active.i-amphtml-consent-ui-in{transition:transform 0.5s ease-out!important}amp-consent.i-amphtml-consent-ui-iframe-active.i-amphtml-consent-ui-in.i-amphtml-consent-ui-iframe-fullscreen{top:0px!important;transform:translateZ(0px)!important;border-top-left-radius:0px!important;border-top-right-radius:0px!important}amp-consent.i-amphtml-consent-ui-in.i-amphtml-consent-ui-iframe-fullscreen>.i-amphtml-consent-ui-fill{height:100%!important}@keyframes i-amphtml-consent-ui-mask{0%{opacity:0.0}to{opacity:0.2}}@keyframes i-amphtml-modal-appear{0%{transform:translateY(100vh);opacity:0}to{transform:translate(0);opacity:1}}.i-amphtml-consent-ui-mask{position:fixed!important;top:0!important;left:0!important;width:100vw!important;height:100vh!important;opacity:0.2;animation:i-amphtml-consent-ui-mask 0.25s ease-in;background-image:none!important;background-color:#000;z-index:2147483644}\n/*# sourceURL=/extensions/amp-consent/0.1/amp-consent.css*/"),t.registerServiceForDoc(tt,class{constructor(){this.uot=0,this.lot=e(),this.pot=()=>{},this.dot=onQueueEmptynQueueNotEmptyegisterUI(t){0==this.uot&&this.dot(),this.uot++;const n=this.lot.then((()=>t().then((()=>{this.uot--,0==this.uot&&this.pot()}))));return this.lot=n,n}}),t.registerServiceForDoc(mn,class{constructor(t){this.Ni=t,this.fot=null,this.mot=null,this._ot=null,this.Pot=null,this.got=null,this.vot=void 0;const n=new i;this.Aot=n.resolve,this.Iot=n.promise,this.consentPageViewId64=function(t){let n=!1,e=null,i=t;return(...t)=>(n||(e=i.apply(self,t),n=!0,i=null),e)}((()=>function(t){const n=function(t){const n=t);return n||String(t.location.href+Date.now()+t.Math.random()+t.screen.width+t.screen.height)}(t);if("string"==typeof n)return(e=t,H(e,"crypto")).sha384Base64(n);var e,i;{const t=n;return i=()=>t).replace(/\.+$/,""),new Promise(()}}(this.Ni.win)))}registerConsentInstance(t,n){this.mot?D().error(Ot,"Cannot register consent instance %s, instance %s has already been registered.",t,this.fot):(this.fot=t,this.mot=new class{constructor(t,n,e){this.Ni=t,this.di=n,this.sharedDataPromise=null,this.bot=(t=>{const n=z(t),e=H(n.win,"ampdoc"),i=e.isSingleDoc()?e.getSingleDoc():null;return G(i&&i.win==n.win?i:n,"storage")})(t),this.yot=null,this.Rot=null,this.Eot="amp-consent:"+n,this.Mot=e.onUpdateHref||null,this.Mot&&mt(this.Mot,"AMP-CONSENT"),this.Tot=void 0}setDirtyBit(t=!0){return this.Tot=t,this.get().then((n=>{Et(n)!==t&&this.update(n.consentState,n.consentString,n.purposeConsents,n.consentMetadata,t)}))}update(t,n,e,i,s,o){const r=(c=this.yot&&this.yot.consentState,1!==(a=h=t)&&2!==a&&3!==a&&4!==a&&5!==a&&(h=5),3==h?c||5:4==h&&c&&5!=c?c:h);var h,c,a,u,l,p,d;if(3===t)return void(this.yot=Ct(r,null===(u=this.yot)||void 0===u?void 0:u.consentString,null===(l=this.yot)||void 0===l?void 0:l.consentMetadata,null===(p=this.yot)||void 0===p?void 0:p.purposeConsents,void 0,null===(d=this.yot)||void 0===d?void 0:d.tcfPolicyVersion));const f=this.yot;s&&Et(f)?this.yot=Ct(r,n,i,e,!0,o):this.yot=Ct(r,n,i,e,void 0,o);const m=Ct(r,n,i,e,this.Tot,o);Tt(m,this.Rot)||this.Cot(m)}Cot(t){this.bot.then((n=>{if(!Tt(t,this.yot,this.Tot))return;if(5===t.consentState)return void n.remove(this.Eot);const e=function(t){const n=u(),e=t.consentState;if(1==e)n.s=1;else{if(2!=e)return null;n.s=0}return t.consentString&&(n.r=t.consentString),t.tcfPolicyVersion&&(n.e=t.tcfPolicyVersion),!0===t.isDirty&&(n.d=1),t.consentMetadata&&(n.m=function(t){const n=u();return t.consentStringType&&(n.cst=t.consentStringType),t.additionalConsent&&(n.ac=t.additionalConsent),null!=t.gdprApplies&&(n.ga=t.gdprApplies),null!=t.purposeOne&&(n.po=t.purposeOne),n}(t.consentMetadata)),t.purposeConsents&&(n.pc=t.purposeConsents),0==Object.keys(n)?null:n}(t);null!=e&&(this.Rot=t,n.setNonBoolean(this.Eot,e),this.wot(t))}))}get(){if(this.yot)return Promise.resolve(this.yot);let t;return this.bot.then((n=>(t=n,t.get(this.Eot)))).then((n=>{if(this.yot)return this.yot;const e=n);return this.Rot=e,Et(e)&&(this.wot(Ct(5)),t.remove(this.Eot),this.Rot=null),this.yot=e,this.yot})).catch((t=>(D().error(Ot,"Failed to read storage",t),Ct(5))))}wot(t){if(!this.Mot)return;if(Et(t))return;const n=Mt(t.consentState);Ht(this.Ni).then((e=>{const i={"consentInstanceId":this.di,"ampUserId":e};null!=n&&(i.consentState=n),i.consentStateValue=St(t.consentState),t.consentString&&(i.consentString=t.consentString),t.consentMetadata&&(i.consentMetadata=t.consentMetadata),t.purposeConsents&&(i.purposeConsents=t.purposeConsents),t.tcfPolicyVersion&&(i.tcfPolicyVersion=t.tcfPolicyVersion);const s={credentials:"include",method:"POST",body:i,ampCors:!1};this.Ni.whenFirstVisible().then((()=>{Lt(this.Ni.getHeadNode(),this.Mot).then((t=>{X(this.Ni.win).fetchJson(t,s)}))}))}))}}(this.Ni,t,n),this.got&&(this.got(),this.got=null))}updateConsentInstanceStatepdateConsentInstancePurposes(t,n=!1){this.vot||(this.vot={}),Object.keys(t).forEach((e=>{if(n&&l(this.vot,e))return;const i=t[e]?1:2;this.vot[e]=i}))}etConsentInstanceInfo(){return N(this.mot),this.mot.get().then((t=>Et(t)?Ct(5):t))}onConsentStateChange(t){N(this.mot),N(!this._ot),this._ot=t,this.getConsentInstanceInfo().then(()}setConsentInstanceSharedDataenHasAllPurposeConsents(){return this.Iot}etConsentInstanceSharedDatahenConsentReady,t.registerServiceForDoc(_n,class{constructor(t){this.Ni=t,this.Vot=u(),this.kot=u(),this.Sot=G(this.Ni,"consentStateManager"),this.Oot=new i;const n=new i;this.xot=n.promise,this.Uot=n.resolve,this.jot=new class{dd(t){return this.Vt||(this.Vt=[]),this.Vt.push(t),remove(t){this.Vt&&this.Vt,t)}ire(t){if(this.Vt)for(const n of this.Vt.slice())n(t)},this.Dot=null,this.Ry=null,this.Ey=null,this.Not=null,this.xw=null,this.vot=null,this.Lot=null}egisterConsentPolicyInstance(t,n){if(this.kot[t])return;const e=Object.keys(n.waitFor||{});if(1!==e.length||e[0]!==this.Dot)return void U().error(qt,"invalid waitFor value, consent policy will never resolve");const s=new class{constructor(t){this.OE=t;const n=new i;this.ri=n.promise,this.ai=n.resolve,this.Hot=4,this.Fot=t.unblockOn||[1,3]}startTimeout(t){const n=this.OE.timeout;let e,i=null;var s;null!=n&&(a(n)?(n.fallbackAction&&"reject"==n.fallbackAction?e=2:n.fallbackAction&&"dismiss"!=n.fallbackAction&&U().error(qt,"unsupported fallbackAction %s",n.fallbackAction),i=n.seconds):i=n,L("number"==typeof(s=i)&&isFinite(s),"invalid timeout value %s",i)),null!=i&&t.setTimeout((()=>{e=e||5,this.evaluate(e,!0)}),1e3*i)}evaluate(t,n=!1){t&&(n&&!this.ai||(this.Hot=1===t?1:2===t?2:4===t?3:4,this.ai&&(this.ai(),this.ai=null)))}getReadyPromise(){return this.ri}n);this.kot[t]=s,this.Vot[t]&&(this.Vot[t].resolve(),this.Vot[t]=null),this.xot.then((()=>{this.Ry&&s.evaluate(this.Ry),this.jot.add((),this.Oot.promise.then(()}))}Au(){this.Sot.then((t=>{t.whenConsentReady().then((()=>{t.onConsentStateChange((t=>{this.qot(t),this.Uot&&(this.Uot(),this.Uot=null)}))}))}))}ot(t){const n=t.consentState,e=t.consentString,i=t.tcfPolicyVersion,s=t.consentMetadata,o=t.purposeConsents,{xw:r,Ey:h,vot:c,Not:a}=this;this.Ey=e,this.Not=i,this.xw=s,this.vot=o,5!==n&&(4==n?1!=this.Ry&&2!=this.Ry&&(this.Ry=4):3==n?(null===this.Ry&&(this.Ry=5),this.Ey=h,this.Not=a,this.xw=r,this.vot=c):this.Ry=n,this.jot.fire(this.Ry),this.Lot&&this.Lot())}henPolicyResolved(t){return Gt[t]?this.Got(t).then((()=>this.kot[t].getReadyPromise().then((()=>this.kot[t].getCurrentPolicyStatus())))):(U().error(qt,"can not find policy %s, only predefined policies are supported",t),Promise.resolve(4))}whenPolicyUnblock(t){return Gt[t]?this.Got(t).then((()=>this.kot[t].getReadyPromise().then(())):(U().error(qt,"can not find policy %s, only predefined policies are supported",t),Promise.resolve(!1))}getMergedSharedData(t){return this.whenPolicyResolved(t).then((()=>this.Sot)).then((t=>t.getConsentInstanceSharedData()))}getConsentStringInfo(t){return this.whenPolicyResolved(t).then((()=>this.Ey))}getTcfPolicyVersion(t){return this.whenPolicyResolved(t).then((()=>this.Not))}getConsentMetadataInfo(t){return this.whenPolicyResolved(t).then(()}whenPurposesUnblock(t){return this.Sot.then(().then((()=>!!this.vot&&t.every((t=>l(this.vot,t)&&1===this.vot[t]))))}Got)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-consent-0.1.mjs.map