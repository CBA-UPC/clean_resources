(()=>{var E=Object.create;var O=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var _=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var H=(t,e,i,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of j(e))!L.call(t,s)&&s!==i&&O(t,s,{get:()=>e[s],enumerable:!(o=W(e,s))||o.enumerable});return t};var T=(t,e,i)=>(i=t!=null?E(N(t)):{},H(e||!t||!t.__esModule?O(i,"default",{value:t,enumerable:!0}):i,t));var w=_(C=>{"use strict";C.parse=K;C.serialize=J;var F=decodeURIComponent,U=encodeURIComponent,V=/; */,g=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function K(t,e){if(typeof t!="string")throw new TypeError("argument str must be a string");for(var i={},o=e||{},s=t.split(V),a=o.decode||F,c=0;c<s.length;c++){var d=s[c],l=d.indexOf("=");if(!(l<0)){var S=d.substr(0,l).trim(),m=d.substr(++l,d.length).trim();m[0]=='"'&&(m=m.slice(1,-1)),i[S]==null&&(i[S]=R(m,a))}}return i}function J(t,e,i){var o=i||{},s=o.encode||U;if(typeof s!="function")throw new TypeError("option encode is invalid");if(!g.test(t))throw new TypeError("argument name is invalid");var a=s(e);if(a&&!g.test(a))throw new TypeError("argument val is invalid");var c=t+"="+a;if(o.maxAge!=null){var d=o.maxAge-0;if(isNaN(d)||!isFinite(d))throw new TypeError("option maxAge is invalid");c+="; Max-Age="+Math.floor(d)}if(o.domain){if(!g.test(o.domain))throw new TypeError("option domain is invalid");c+="; Domain="+o.domain}if(o.path){if(!g.test(o.path))throw new TypeError("option path is invalid");c+="; Path="+o.path}if(o.expires){if(typeof o.expires.toUTCString!="function")throw new TypeError("option expires is invalid");c+="; Expires="+o.expires.toUTCString()}if(o.httpOnly&&(c+="; HttpOnly"),o.secure&&(c+="; Secure"),o.sameSite){var l=typeof o.sameSite=="string"?o.sameSite.toLowerCase():o.sameSite;switch(l){case!0:c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"strict":c+="; SameSite=Strict";break;case"none":c+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return c}function R(t,e){try{return e(t)}catch{return t}}});var p=T(w());var A=T(w());function I(){return typeof document=="object"&&typeof document.cookie=="string"}function $(t,e){return typeof t=="string"?A.parse(t,e):typeof t=="object"&&t!==null?t:{}}function G(t,e){return typeof e>"u"&&(e=!t||t[0]!=="{"&&t[0]!=="["&&t[0]!=='"'),!e}function v(t,e){e===void 0&&(e={});var i=B(t);if(G(i,e.doNotParse))try{return JSON.parse(i)}catch{}return t}function B(t){return t&&t[0]==="j"&&t[1]===":"?t.substr(2):t}var h=function(){return h=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},h.apply(this,arguments)},z=function(){function t(e,i){var o=this;this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.cookies=$(e,i),new Promise(function(){o.HAS_DOCUMENT_COOKIE=I()}).catch(function(){})}return t.prototype._updateBrowserValues=function(e){this.HAS_DOCUMENT_COOKIE&&(this.cookies=p.parse(document.cookie,e))},t.prototype._emitChange=function(e){for(var i=0;i<this.changeListeners.length;++i)this.changeListeners[i](e)},t.prototype.get=function(e,i,o){return i===void 0&&(i={}),this._updateBrowserValues(o),v(this.cookies[e],i)},t.prototype.getAll=function(e,i){e===void 0&&(e={}),this._updateBrowserValues(i);var o={};for(var s in this.cookies)o[s]=v(this.cookies[s],e);return o},t.prototype.set=function(e,i,o){var s;typeof i=="object"&&(i=JSON.stringify(i)),this.cookies=h(h({},this.cookies),(s={},s[e]=i,s)),this.HAS_DOCUMENT_COOKIE&&(document.cookie=p.serialize(e,i,o)),this._emitChange({name:e,value:i,options:o})},t.prototype.remove=function(e,i){var o=i=h(h({},i),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=h({},this.cookies),delete this.cookies[e],this.HAS_DOCUMENT_COOKIE&&(document.cookie=p.serialize(e,"",o)),this._emitChange({name:e,value:void 0,options:i})},t.prototype.addChangeListener=function(e){this.changeListeners.push(e)},t.prototype.removeChangeListener=function(e){var i=this.changeListeners.indexOf(e);i>=0&&this.changeListeners.splice(i,1)},t}(),k=z;var P=k;var q=t=>{let e=window.location.href,o=new RegExp(`[\\?&]${t}=([^&#]*)`).exec(e);return o===null?null:o[1]},D=()=>q("capdebug")!==null,y=t=>t.replace(/(<([^>]+)>)/gi,""),r=t=>{typeof t!="object"&&(t=[t]),console&&typeof console.log=="function"&&D()&&console.log("%cCAPPING","display: inline-block; color: #61d2a3; background: #193a4a; padding: 1px 4px; border-radius: 3px;",...t)},u=t=>{typeof t!="object"&&(t=[t]),console&&typeof console.error=="function"&&D()&&console.error("%cCAPPING","display: inline-block; color: #ff0000; background: #193a4a; padding: 1px 4px; border-radius: 3px;",...t)},M=()=>`_${Math.random().toString(36).substr(2,9)}`,b=(t,e)=>(Object.keys(e).forEach(i=>{typeof t[i]>"u"?t[i]=e[i]:typeof e[i]!=typeof t[i]?r(`bad configuration type for ${i}, must be an instance of ${typeof t[i]}`):typeof e[i]=="object"?b(t[i],e[i]):t[i]=e[i]}),t);var x={enable:!0,url:"https://capping.sirius.press",mode:"reading",timeout:3e3,cookieName:"lmd_cap",copyPasteObserver:{enable:!1,characterLimit:140,countTimeWindow:"7d",stopCounting:!1,stopCountingAt:1/0}};typeof CAPPING_CONFIG<"u"?b(x,CAPPING_CONFIG):typeof window.siriusCapping<"u"&&typeof window.siriusCapping.config<"u"&&b(x,window.siriusCapping.config);var n=x;var f={locked:!1,stayTunedRunning:!1,lastAction:"",state:"stop",publishedAt:null,contentTxt:"",contentHtml:"",copyWithCounter:!1,copyCounterWithLocalStorage:!0,timeWindowDurationMs:0,timeWindowDurationS:0,copyModificationText:null,copyModificationType:null,lastCount:0,lastCpoCountKey:"lastCpoCount",hello(){this.state!=="hello"&&(this.state="hello",this.lastAction="hello",r("hello"),window.fetch(`${n.url}/hello?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}&mode=${this.mode}`).then(t=>t.json()).then(t=>{this.state==="hello"&&this.pauseBlockOrContinue(t)}).catch(t=>{this.state="stop",u(`Error with hello - ${t}`)}))},bye(){r("bye"),window.fetch(`${n.url}/bye?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}&mode=${this.mode}`)},event(t){r(`event ${t}`),window.fetch(`${n.url}/event?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&mode=${this.mode}&event=${t}`)},determined(){if(this.state==="determined"||this.state==="hello"||this.state==="ping")return;this.state==="staytuned"&&(n.togglePopinFunction?n.togglePopinFunction({}):n.hidePopinFunction&&n.hidePopinFunction()),this.state="determined",this.lastAction="determined",r("hello determined");let t=`${n.url}/hello?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}&mode=${this.mode}&determined=1`;window.fetch(t).then(e=>e.json()).then(()=>{this.state==="determined"&&this.ping()}).catch(e=>{this.state="stop",u(`Error with hello - ${e}`)})},ping(){this.state!=="ping"&&(this.state="ping",this.lastAction="ping",setTimeout(this.doPing.bind(this),n.timeout))},doPing(){document[this.hidden]||this.state!=="ping"?r("stop to ping"):(r("ping"),window.fetch(`${n.url}/ping?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}&mode=${this.mode}`).then(t=>t.json()).then(t=>{this.state==="ping"&&this.pauseBlockOrContinue(t)}).catch(t=>{this.state="stop",u(`Error with ping - ${t}`)}))},staytuned(){this.state!=="staytuned"&&(this.state="staytuned",this.lastAction="staytuned",setTimeout(this.doStaytuned.bind(this),n.timeout))},doStaytuned(){document[this.hidden]||this.state!=="staytuned"?r("stop to stay tuned"):(r("stay tuned"),window.fetch(`${n.url}/stayTuned?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}&mode=${this.mode}`).then(t=>t.json()).then(t=>{if(this.state==="staytuned")if(t.block===!0)document[this.hidden]?(this.state="stop",r("stop to stay tuned")):(this.state="stop",this.staytuned());else{if(document[this.hidden]){this.state="stop",r("stop to stay tuned");return}r("unblock"),n.togglePopinFunction?n.togglePopinFunction({}):n.hidePopinFunction&&n.hidePopinFunction(),this.state==="staytuned"&&this.hello()}}).catch(t=>{this.state="stop",u(`Error with stay tuned - ${t}`)}))},pauseBlockOrContinue(t){if(t.pause===!0)r("pause"),t.block===!0?(r("block"),n.togglePopinFunction?n.togglePopinFunction(t):n.showPopinFunction&&(n.showPopinFunction(t),this.event("popinDisplayed")),this.staytuned()):(this.state="stop",this.lastAction="");else{if(document[this.hidden]){this.state="stop",r("stop to ping");return}this.state="stop",this.ping()}},start(){if(typeof document.hidden<"u"?(this.hidden="hidden",this.visibilityChange="visibilitychange"):typeof document.msHidden<"u"?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):typeof document.webkitHidden<"u"&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),(typeof n.userId>"u"||n.userId==="")&&(n.userId=null,n.enable=!1),typeof n.brand>"u"||(typeof n.tolerance>"u"&&(n.tolerance=""),n.mode!=="reading"&&n.mode!=="device"&&n.mode!=="conversion"))return;if(typeof n.deviceId<"u")this.deviceId=n.deviceId;else{let e=new P;this.deviceId=e.get(n.cookieName),this.deviceId||(this.deviceId=M(),e.set(n.cookieName,this.deviceId,{path:"/",maxAge:60*60*24*365,domain:"."+window.location.hostname.split(".").reverse().splice(0,2).reverse().join("."),secure:!0,sameSite:"Lax"}))}if(this.userId=n.userId,this.brand=n.brand,this.tolerance=n.tolerance,this.mode=n.mode,n.enable===!0){if(typeof n.restrictArticlesOlderThan<"u"&&typeof n.restrictArticlesAccessFunction<"u"){let e;if((e=document.querySelector("meta[property='og:article:published_time']"))!==null)this.publishedAt=e.getAttribute("content");else if((e=document.querySelector("[itemprop='datePublished']"))!==null)this.publishedAt=e.getAttribute("datetime");else{let i=[];i.push({searchObject:"datePublished",searchAtt:"",localVar:"publishedAt"}),this.jsonldSearch(i)}if(this.publishedAt!==null&&this.publishedAt!==""){let i=Date.parse(this.publishedAt);if(isNaN(i)){r("Not a valid date format.");return}this.publishedAt=Math.floor(i/1e3);let o=parseInt(n.restrictArticlesOlderThan);if(o>=30){let s=Math.floor(Date.now()/1e3)-o*24*60*60;if(r(`restrict articles older than ${o} days`),this.publishedAt<s){n.restrictArticlesAccessFunction();return}}else r("Skipping restricting old articles because restrictArticlesOlderThan > 30 days")}}if(this.mode==="reading"||this.mode==="device")this.hello();else if(this.mode==="conversion"){this.event("conversion");return}}this.copyPasteObserver();let t=()=>{if(document[this.hidden])r("visibility hidden"),this.state==="ping"&&(this.state="stop",this.bye()),this.state==="hello"&&(this.state="stop",setTimeout(this.bye.bind(this),n.timeout));else{if(this.lastAction==="staytuned"){this.staytuned();return}(this.lastAction==="ping"||this.lastAction==="hello")&&this.hello()}};typeof document.addEventListener>"u"||typeof document[this.hidden]>"u"?u("Capping requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API."):n.enable===!0&&document.addEventListener(this.visibilityChange,t,!1)},stop(){this.state="stop"},getSelectionHtml(){let t="";if(typeof window.getSelection<"u"){let e=window.getSelection();if(e.rangeCount){let i=document.createElement("div");for(let o=0,s=e.rangeCount;o<s;++o)i.appendChild(e.getRangeAt(o).cloneContents());t=i.innerHTML}}else typeof document.selection<"u"&&document.selection.type=="Text"&&(t=document.selection.createRange().htmlText);return t},copyPasteObserver(){n.copyPasteObserver.enable===!0&&(this.initClipboardHandler(),r("Copy paste observer launched"),["cut","copy"].forEach(t=>{document.addEventListener(t,e=>{if(typeof e.clipboardData<"u"&&(this.contentTxt=window.getSelection().toString(),this.contentHtml=this.getSelectionHtml(),this.contentTxt.length>n.copyPasteObserver.characterLimit)){if(!n.copyPasteObserver.modifications){this.fetchCopyApiIfUser();return}e.preventDefault(),this.copyWithCounter===!0?this.copyCounterWithLocalStorage===!0?this.incrementWithLocalStorage():this.incrementWithApiFetch():this.fetchCopyApiIfUser(),this.alterClipboard(),e.clipboardData.setData("Text",this.contentTxt),e.clipboardData.setData("text/plain",this.contentTxt),e.clipboardData.setData("text/html",this.contentHtml)}})}))},fetchCopyApiIfUser(){this.userId&&(r("Copy event! (without counter)"),window.fetch(`${n.url}/copy?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}`))},getPreviousLastCount(){if(this.lastCount===0){let t=JSON.parse(localStorage.getItem(this.lastCpoCountKey));if(t){let e=Date.now(),i=t.filter(o=>e-o.timestamp<this.timeWindowDurationMs);if(localStorage.setItem(this.lastCpoCountKey,JSON.stringify(i)),i.length>0){let o=i.reduce((s,a)=>a.timestamp>s.timestamp?a:s);r("--> previous copy count: "+o.lastCount),this.lastCount=o.lastCount,this.handleModifications()}}}},incrementWithApiFetch(){if(n.copyPasteObserver.stopCounting)return;this.getPreviousLastCount(),r("Copy event! (with counter)");let t=`${n.url}/copy?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&ctw=${this.timeWindowDurationS}&sca=${n.copyPasteObserver.stopCountingAt}`;window.fetch(t).then(e=>e.json()).then(e=>{r("--> copy count: "+e.count),this.lastCount=e.count,this.handleModifications();let i=JSON.parse(localStorage.getItem(this.lastCpoCountKey))||[];i.push({timestamp:Date.now(),lastCount:e.count}),localStorage.setItem(this.lastCpoCountKey,JSON.stringify(i))})},incrementWithLocalStorage(){let t="cpoCount",e=JSON.parse(localStorage.getItem(t))||[],i=Date.now(),o=e.filter(s=>i-s.timestamp<this.timeWindowDurationMs);localStorage.setItem(t,JSON.stringify(o)),o.push({timestamp:Date.now()}),localStorage.setItem(t,JSON.stringify(o)),r("--> copy count: "+o.length),this.lastCount=o.length,this.handleModifications()},handleModifications(){n.copyPasteObserver.stopCounting||(n.copyPasteObserver.stopCountingAt&&this.lastCount>=n.copyPasteObserver.stopCountingAt&&(n.copyPasteObserver.stopCounting=!0,r("Stop counting")),n.copyPasteObserver.modifications.forEach(t=>{let e=t.text,i=t.type,o=t.count;if(o&&typeof o=="object"){let s=o.min??0,a=o.max??1/0;this.lastCount>=s&&this.lastCount<=a&&(this.copyModificationText=e,this.copyModificationType=i)}}))},initClipboardHandler(){let t=n.copyPasteObserver.modifications,i=n.copyPasteObserver.countTimeWindow.match(/(\d+)(h|m|s|d)/),o=i[1];switch(i[2]){case"d":this.timeWindowDurationS=o*24*60*60,this.timeWindowDurationMs=this.timeWindowDurationS*1e3;break;case"h":this.timeWindowDurationS=o*60*60,this.timeWindowDurationMs=this.timeWindowDurationS*1e3;break;case"m":this.timeWindowDurationS=o*60,this.timeWindowDurationMs=this.timeWindowDurationS*1e3;break;case"s":this.timeWindowDurationS=o,this.timeWindowDurationMs=this.timeWindowDurationS*1e3;break}t&&(t.forEach(a=>{let c=a.text,d=a.type;a.count&&typeof a.count=="object"?(this.copyWithCounter=!0,a.count.stopCounting&&a.count.min?n.copyPasteObserver.stopCountingAt=a.count.min:!a.count.stopCounting&&a.count.max&&(n.copyPasteObserver.stopCountingAt=a.count.max)):(this.copyModificationText=c,this.copyModificationType=d)}),this.copyWithCounter&&this.userId&&(this.copyCounterWithLocalStorage=!1))},alterClipboard(){r("alter type: "+this.copyModificationType),this.copyModificationType==="replace"?(this.contentTxt=y(this.copyModificationText),this.contentHtml=this.copyModificationText):this.copyModificationType==="prepend"?(this.contentTxt=y(this.copyModificationText)+this.contentTxt,this.contentHtml=this.copyModificationText+this.contentHtml):this.copyModificationType==="append"&&(this.contentTxt=this.contentTxt+y(this.copyModificationText),this.contentHtml=this.contentHtml+this.copyModificationText)},jsonldSearch(t){let e=document.querySelectorAll("script[type='application/ld+json']");for(let i of t)for(let o of e)try{let s=JSON.parse(o.innerHTML),a=typeof i.searchAtt>"u"?s[i.searchObject][i.searchAtt]:s[i.searchObject];if(typeof a<"u"){this[i.localVar]=a;break}}catch{break}}};f.start();window.restartCapping=function(){f.determined()};window.stopCapping=function(){f.stop()};window.siriusCapping={config:n,stop(){f.stop()},continueReading(){f.determined()}};})();
/*! Bundled license information:

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)
*/
