"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[4338],{67731:(e,i,a)=>{a.r(i),a.d(i,{default:()=>Li});var s=a(50959),n=a(74979),t=a(15880),l=a(85648),r=a(13481),d=a(58800),c=a(83335),o=a(54941),u=a(13734),m=a(41891),x=a(72445),f=a(2800),g=a(80626),h=(a(86277),a(19877)),v=a(82187),j=a.n(v),b=a(69736),y=a(11317),p=a(87608),N=a(16972),k=a(27838),C=a(33981),L=a(75463),I=a(86696),E=a(41736),S=a(60046),w=a(43316),O=a(17053),T=a(10956),U=a(33598),A=a(45438),D=a(22527),M=a(82857),B=a(64169),_=a(70488),F=a(11527);const P=e=>{const{timestamp:i,isNowPlaying:a}=e;return a?(0,F.jsx)(x.ws,{label:l.ag.get("time.now"),children:(0,F.jsx)(B.h,{"aria-label":l.ag.get("time.now"),size:"small"})}):(0,F.jsx)("span",{children:(0,_.l)(i)})},z="gj9SOnCIzruGWAM5m3XO",J="VLKqDIGaQn2bILzJKSZ0",Y="oWQvtc5QZlmB60A9ejJx",K="dLg5WMgjh1kfYtZ_MnZz",Z="VBQoaks4ZkfIknTKmxXZ",q="Irsd58UNEmDPxdhXKXCs",H="_Xe25F2aC59Kljgqyw3G",R="P7j2kCLc27vLybuzy5XB",W="ktMuChpoidaEvECE7y8f",V="LywlKLgNaEtHZzLM3EX5",Q="mthrc5U9wb8F4zMBqlPy",G="dvb9y9hcP8sUfMhUASKO",X="kE5DI3BkNlo9zuO7K3aO",$="hnEmEncF7kB2TnE_Uyja",ee="j7K7_Zly3G1HS9MlKoao",ie="gY0qK1gmEdhq5idwQc8C",ae="MObmOrMxbQpO10ebAtZA",se="cBPbfBWIIPDzhIT6i3ih",ne="PjDcsgAPmXlcTBJRGpIu",te="IRpPQFA57qgQ5jicWWaD",le="Hm3nIbegLclY1uCAmnx_",re="bhRoVUHjWdo9mgUkU6fe",de="BliqfY7vu_qE2C9zs5Ou",ce="qdYWuHZd4HdSWfd4pSQB",oe="DhvYWKjDc7uyF3HfkDJJ",ue="ralK8s_OmE8a8zWcfNKM",me=e=>Date.now()-e<9e5,xe=(e,i)=>{var a;switch(null===(a=(0,y.EC)(e))||void 0===a?void 0:a.type){case y.JM.PLAYLIST:case y.JM.PLAYLIST_V2:return(0,F.jsx)(C.X,{uri:e});case y.JM.EPISODE:case y.JM.SHOW:return(0,F.jsx)(L.M,{uri:e});case y.JM.ALBUM:return(0,F.jsx)(N.Y,{uri:e,artistUri:i});case y.JM.ARTIST:return(0,F.jsx)(k.m,{uri:e});default:return null}},fe=e=>{switch(e){case y.JM.ALBUM:return M.p.ALBUM;case y.JM.ARTIST:return M.p.ARTIST;case y.JM.SHOW:return M.p.SHOW;case y.JM.EPISODE:return M.p.EPISODE;case y.JM.PLAYLIST:case y.JM.PLAYLIST_V2:return M.p.PLAYLIST;default:return}},ge=e=>{var i,a,n,t,r,d,c,o,m,x,f,h,v,N,C,L,M;const{show:B=!0,spec:_,friend:J}=e,Y=(0,s.useMemo)((()=>J.user.imageUrl?[{url:J.user.imageUrl,width:0,height:0}]:[]),[J.user.imageUrl]),ee=(0,u.o)(),ie=(0,g.$P)(),ae=J.track,se=ae.uri,{togglePlay:ne,isPlaying:te,isActive:le}=(0,D.n)({uri:se},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}),re=(0,y.EC)(null===(i=ae.context)||void 0===i?void 0:i.uri),de=null==re?void 0:re.type,ce=(0,s.useCallback)((()=>{ne(),ee({intent:te?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:se});const e=_.friendRowFactory().playButtonFactory();le?te?ie.logInteraction(e.hitPause({itemToBePaused:se})):ie.logInteraction(e.hitResume({itemToBeResumed:se})):ie.logInteraction(e.hitPlay({itemToBePlayed:se}))}),[ee,te,se,_,le,ne,ie]),oe=(0,s.useCallback)(((e,i)=>{ie.logInteraction(_.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:i}))}),[ie,_]),ue=(0,O.O)({itemUris:[se],dragLabelText:ae.name}),ge=(0,O.O)({itemUris:[null===(a=ae.artist)||void 0===a?void 0:a.uri],dragLabelText:null===(n=ae.artist)||void 0===n?void 0:n.name}),he=(0,O.O)({itemUris:[null===(t=ae.context)||void 0===t?void 0:t.uri],dragLabelText:null===(r=ae.context)||void 0===r?void 0:r.name});return B?(0,F.jsxs)("div",{className:j()(z),children:[(0,F.jsx)(T._,{menu:xe(null===(d=ae.context)||void 0===d?void 0:d.uri,null===(c=ae.artist)||void 0===c?void 0:c.uri),children:(0,F.jsxs)("div",{className:K,children:[(0,F.jsx)(p.q,{label:J.user.name,width:40,userIconSize:"small",images:Y,withBadge:me(J.timestamp)}),(0,F.jsx)(w.I,{className:Z,iconClassName:q,isPlaying:te,isLocked:!1,onClick:ce,playAriaLabel:te?l.ag.get("pause"):`${l.ag.get("play")} ${ae.artist.name} ${ae.name}`})]})}),(0,F.jsxs)("div",{className:j()(H),children:[(0,F.jsxs)("div",{className:R,children:[(0,F.jsx)(b.x,{as:"p",variant:"bodySmallBold",className:j()(W,"ellipsis-one-line"),children:(0,F.jsx)(A.JL,{value:"/buddyfeed_user_profile",children:(0,F.jsx)(T._,{menu:(0,F.jsx)(E.I,{uri:J.user.uri}),children:(0,F.jsx)(S.Link,{title:J.user.name,to:J.user.uri,dir:"auto",onClick:()=>oe("profile_link",J.user.uri),children:J.user.name})})})}),(0,F.jsx)(b.x,{as:"p",variant:"marginal",className:j()(V),children:(0,F.jsx)(P,{timestamp:J.timestamp,isNowPlaying:me(J.timestamp)})})]}),(0,F.jsxs)(b.x,{as:"p",variant:"marginal",className:Q,children:[(0,F.jsx)(A.JL,{value:"/buddyfeed_track",children:(0,F.jsx)(T._,{menu:(0,F.jsx)(I.$,{uri:ae.uri,contextUri:null===(o=ae.context)||void 0===o?void 0:o.uri,albumUri:null===(m=ae.album)||void 0===m?void 0:m.uri,artists:[ae.artist]}),children:(0,F.jsx)(S.Link,{title:ae.name,to:se,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:ue,onClick:()=>oe("track_link",se),children:ae.name})})}),(0,F.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,F.jsx)(A.JL,{value:"/buddyfeed_artist",children:(0,F.jsx)(T._,{menu:ae.artist?(0,F.jsx)(k.m,{uri:ae.artist.uri}):null,children:(0,F.jsx)(S.Link,{title:null===(x=ae.artist)||void 0===x?void 0:x.name,to:null===(f=ae.artist)||void 0===f?void 0:f.uri,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:ge,onClick:()=>{var e;return oe("artist_link",null===(e=ae.artist)||void 0===e?void 0:e.uri)},children:null===(h=ae.artist)||void 0===h?void 0:h.name})})})]}),(0,F.jsx)(b.x,{as:"p",variant:"marginal",className:j()("ellipsis-one-line",X),children:(0,F.jsx)(A.JL,{value:"/buddyfeed_context",children:(0,F.jsx)(T._,{menu:xe(null===(v=ae.context)||void 0===v?void 0:v.uri,null===(N=ae.artist)||void 0===N?void 0:N.uri),children:(0,F.jsxs)(S.Link,{title:null===(C=ae.context)||void 0===C?void 0:C.name,to:null===(L=ae.context)||void 0===L?void 0:L.uri,className:$,draggable:!0,onDragStart:he,onClick:()=>{var e;return oe("context_link",null===(e=ae.context)||void 0===e?void 0:e.uri)},children:[(0,F.jsx)(U.t,{type:fe(de),iconSize:16,className:G}),(0,F.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:null===(M=ae.context)||void 0===M?void 0:M.name})]})})})})]})]},J.user.uri):null};function he(e){let{friends:i,spec:a}=e;return(0,F.jsx)(h.U5,{flipKey:i.map((e=>e.user.uri)).join(""),children:(0,F.jsx)("ol",{children:i.map(((e,i)=>(0,F.jsx)(h.$3,{flipId:e.user.uri,children:(0,F.jsx)("li",{children:(0,F.jsx)(ge,{friend:e,show:i<100,spec:a},e.user.uri)})},e.user.uri)))})})}var ve=a(92075),je=a(43286),be=a(29380),ye=a(74883),pe=a(39505),Ne=(a(46758),a(53321),a(49857)),ke=a(45540),Ce=(a(80378),a(7863)),Le=a(61408),Ie=a(394),Ee=a(60637);const Se="w5nHQ74JGTytKwWanjvB",we="u11kJflcqt7CSXo9qL_T",Oe="MmENkh6tW0MyjTtTtPHZ",Te="Gl0dkNQbAyNjVZ1IpghI",Ue=e=>{let{name:i,following:a,imageUrl:t,uri:r}=e;const d=(0,Ie.q)(),c=(0,u.o)(),o=s.createRef(),[x,f]=(0,s.useState)(a);(0,Ee.d)(Le.rA.OPERATION_COMPLETE,(e=>{if(e.data.uris.includes(r))switch(e.data.operation){case Le.BM.FOLLOW_USER:f(!0);break;case Le.BM.UNFOLLOW_USER:f(!1)}}));const g=(0,s.useCallback)((()=>{x?d.unfollowUsers([r]):(d.followUsers([r]),c({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),o.current&&o.current.blur()}),[x,o,r,d,c]);return(0,s.useEffect)((()=>{f(a)}),[a]),(0,F.jsxs)("div",{className:Se,children:[(0,F.jsx)(p.q,{label:i,width:40,userIconSize:"small",images:(0,s.useMemo)((()=>[{width:40,height:40,url:t}]),[t])}),(0,F.jsxs)("div",{className:j()(we,"ellipsis-one-line"),children:[(0,F.jsx)(b.x,{as:"p",variant:"bodySmallBold",className:"ellipsis-one-line",children:i}),x&&(0,F.jsx)(b.x,{as:"p",variant:"marginal",className:"ellipsis-one-line",children:l.ag.get("following")})]}),(0,F.jsx)("div",{className:Oe,children:(0,F.jsx)(m.E,{className:Te,size:"sm",ref:o,onClick:g,ariaLabel:x?l.ag.get("buddy-feed.button.remove-friend"):l.ag.get("buddy-feed.button.add-friend"),icon:x?Ce.k:n.t})})]})},Ae="nGInMrf62TCFD9MBnEzz";function De(e){let{facebookFriends:i}=e;return(0,F.jsx)("div",{className:Ae,children:i.map((e=>{let{uri:i,following:a,title:s,image:n}=e;return(0,F.jsx)(Ue,{uri:i,name:s,imageUrl:n,following:a},`fb-friend-${i}`)}))})}var Me=a(56839);const Be="n6rSk6R7nfmSGSgTRR5_";function _e(){return(0,F.jsx)("div",{className:Be,children:Array(20).fill(0).map(((e,i)=>(0,F.jsx)(Me.C,{isLoading:!0,charCount:100,as:"p",variant:"titleSmall"},i)))})}var Fe=a(41194),Pe=a(1494);const ze="pZFwflwH1vXVCmAO5vbz",Je="yPL55nV5rC97vJhAf7ke",Ye="qpgo9DQ9rVZbO5pLJog5",Ke="A3hvkJOGkBNa6zWj6oZa",Ze="pIyez6N1SF3jW0U5VUx4",qe="lIxuZR4lYTrEKkMYedty",He="VEmC3OHK3uAasHvO5OuA",Re="wzGPtuvvLpOpY1PDu4Qv",We="YoJTUV4hazVCFNbfKoNq",Ve=e=>{let{onBackButtonClick:i}=e;const[a,n]=(0,s.useState)(""),{isLoading:t,friends:r}=(e=>{const i=(0,Pe.I)(),a=e.trim().toLowerCase(),{data:s,isLoading:n}=(0,Fe.a)({queryKey:["useFacebookFriends"],queryFn:async()=>(await i.fetchFacebookFriends()).sort(((e,i)=>e.title>i.title?1:-1))});return{isLoading:n,friends:(null==s?void 0:s.filter((e=>{let{title:i}=e;return-1!==i.trim().toLowerCase().indexOf(a)})))??[]}})(a),d=(0,Ne.y1)((e=>{n(e.target.value)}),100),c=(0,s.useCallback)((e=>{null!==e&&e.focus()}),[]);return(0,F.jsxs)("div",{className:ze,children:[(0,F.jsx)(m.E,{ariaLabel:l.ag.get("buddy-feed.button.back"),onClick:i,ref:c,className:Je,icon:ve.e,size:"sm",testId:"back-to-friends"}),(0,F.jsxs)("div",{className:Ye,children:[(0,F.jsx)("div",{className:Ke,children:(0,F.jsx)(be.z,{className:Ze,size:"large"})}),(0,F.jsx)("div",{className:qe,children:t?(0,F.jsx)(Me.C,{isLoading:!0,charCount:25,as:"p",variant:"bodySmall"}):(0,F.jsx)(b.x,{as:"p",variant:"bodySmall",children:l.ag.get("buddy-feed.number-of-friends",r.length)})})]}),t?(0,F.jsx)(_e,{}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:He,children:[(0,F.jsx)(ke.j,{className:We,size:"small",role:"presentation"}),(0,F.jsx)("input",{onChange:d,className:Re,placeholder:l.ag.get("buddy-feed.find-in-playlists")})]}),(0,F.jsx)(De,{facebookFriends:r})]})]})};var Qe=a(29608);function Ge(e){let{isOpen:i,onClose:a,onConfirm:s}=e;return(0,F.jsx)(Qe.Q,{onClose:a,"aria-label":l.ag.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:s,titleText:l.ag.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:l.ag.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:l.ag.get("queue.cancel-button"),confirmText:l.ag.get("web-player.buddy-feed.connect-button"),isOpen:i})}let Xe=function(e){return e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e}({});const $e="EmZCbU1_B_J9RAHebolL",ei="Ym6Yyx83U7mNKOMw9dxw",ii="NXcZaSipzomJ6d4_nM94",ai="b9rqRkvRvhrSY4FYHQVC",si="xHc_2FQr3NxfCgfDSVhY",ni="QAJYN0xWh3h2A5d8_C1g",ti="PKhH1CknobkjJdVITsb4",li="HgRmCE3NxfiYNtv6pF3H",ri="HnA5mipUMkheAlbxqCn_",di="mvp0xhvZTo0xv0TIwi9u",ci=e=>{const i=(0,u.o)(),{onBackButtonClick:a,feedIsEmpty:n,goToAddFriends:t=!1}=e,r=function(){const e=(0,Pe.I)(),[i,a]=(0,s.useState)(Xe.LOADING);return(0,s.useEffect)((()=>e.subscribeToFacebookConnectionState((e=>{a(e.connection?Xe.CONNECTED:Xe.DISCONNECTED)})).cancel),[e]),i}(),d=(0,Pe.I)(),[c,o]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),[g,h]=(0,s.useState)(!1),v=(0,s.useCallback)((e=>{null!==e&&e.focus()}),[]),j=(0,s.useCallback)((()=>{location.reload()}),[]);if(x)return(0,F.jsxs)("div",{className:ri,children:[(0,F.jsx)(m.E,{onClick:a,ref:v,className:ii,ariaLabel:l.ag.get("buddy-feed.button.back"),icon:ve.e,size:"sm"}),(0,F.jsxs)("div",{className:di,children:[(0,F.jsx)(b.x,{as:"h1",variant:"bodyMediumBold",className:ei,children:l.ag.get("error-dialog.generic.header")}),(0,F.jsx)(b.x,{as:"p",variant:"bodySmall",className:ai,children:l.ag.get("error-dialog.generic.body")}),(0,F.jsx)(je.D,{colorSet:"invertedLight",onClick:j,children:l.ag.get("error.reload")})]})]});const y=(t||g)&&r===Xe.CONNECTED;return(0,F.jsxs)("div",{className:$e,children:[y&&(0,F.jsx)(Ve,{onBackButtonClick:()=>{n&&h(!1),a()}}),!y&&(0,F.jsxs)("div",{className:ni,children:[(0,F.jsx)(m.E,{ariaLabel:l.ag.get("buddy-feed.button.back"),onClick:a,className:ii,ref:v,icon:ve.e,size:"sm"}),(0,F.jsx)(b.x,{as:"h1",variant:"bodyMediumBold",className:ei,children:l.ag.get("buddy-feed.friend-activity")}),(0,F.jsx)(b.x,{as:"p",variant:"bodySmall",className:ai,children:l.ag.get("buddy-feed.facebook.connect-with-friends-default")}),(0,F.jsx)("div",{className:ti,children:(0,F.jsx)(je.D,{className:li,size:"small",iconLeading:be.z,UNSAFE_colorSet:(0,ye.Ev)("#2374E1",pe.ixZ),onClick:()=>{i({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),r!==Xe.CONNECTED?o(!0):h(!0)},children:l.ag.get("buddy-feed.facebook.button")})}),(0,F.jsx)(b.x,{as:"p",variant:"marginal",className:si,children:l.ag.get("buddy-feed.facebook.disclaimer")}),(0,F.jsx)(Ge,{isOpen:c,onClose:()=>{o(!1)},onConfirm:()=>{d.connectToFacebook().then((()=>{h(!0),o(!1)})).catch((()=>{f(!0)}))}})]})]})};var oi=a(36275),ui=a(80956);const mi=e=>{let{showOnlineIndicator:i}=e;return(0,F.jsxs)("div",{className:ne,children:[(0,F.jsxs)("div",{className:te,children:[(0,F.jsx)(ui.f,{size:"medium"}),i?(0,F.jsx)("div",{className:le}):null]}),(0,F.jsxs)("div",{className:re,children:[(0,F.jsx)("div",{className:j()(de,ce)}),(0,F.jsx)("div",{className:de}),(0,F.jsx)("div",{className:de})]})]})},xi=()=>(0,F.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:ae,children:[(0,F.jsx)(b.x,{as:"p",className:se,children:l.ag.get("buddy-feed.let-followers-see-your-listening")}),(0,F.jsx)(mi,{showOnlineIndicator:!0}),(0,F.jsx)(mi,{showOnlineIndicator:!0}),(0,F.jsx)(mi,{}),(0,F.jsx)(b.x,{as:"p",className:se,children:l.ag.get("buddy-feed.enable-share-listening-activity")}),(0,F.jsx)(oi.rU,{to:"/preferences",className:oe,children:(0,F.jsx)(je.D,{colorSet:"invertedLight",className:ue,children:l.ag.get("desktop.settings.settings")})})]});var fi=a(22049),gi=a(71113);const hi="jUF2eKgYMm64aYykubct",vi="zhL_lhJqzKfJVy7L5VuY",ji="XqquM_o2eODcnD8Y4QhS",bi="UGtycHBJ4egymBSmD_lX",yi="ND2ydDPzwQZB7HyaGCN8",pi="D9YN554UFGJle2CPP1TA",Ni="v7Zcy9UKVUTDZIMKB6ZF",ki="RX3U6eAasqazEkuFdnj0",Ci=e=>{let{children:i,page:a}=e;const s=0===a,n=i.filter(((e,i)=>i!==a));return(0,F.jsx)(fi.Z,{component:null,children:n.map((e=>(0,F.jsx)(gi.Z,{in:s,timeout:500,classNames:{enter:s?hi:yi,enterActive:s?vi:pi,exit:s?ji:Ni,exitActive:s?bi:ki},children:e},s?"first-page":"second-page")))})},Li=e=>{let{friends:i}=e;const a=(0,u.o)(),h=(0,g.$P)(),{spec:v}=(0,g.fU)(t.J,{});(0,s.useEffect)((()=>{a({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[a]),(0,s.useEffect)((()=>{h.logImpression(v.impression())}),[h,v]);const[j,b]=(0,s.useState)(!1),y=()=>{j||h.logInteraction(v.addFriendButtonFactory().hitUiReveal()),b(!j)},p=0===i.length,N=(0,s.useCallback)((()=>{h.logInteraction(v.closeButtonFactory().hitUiHide())}),[h,v]);return(0,F.jsx)(f.DJ.Provider,{value:"buddy_feed",children:(0,F.jsx)(r.l,{label:l.ag.get("buddy-feed.friend-activity"),children:(0,F.jsxs)(Ci,{page:j?1:0,children:[(0,F.jsx)("div",{className:J,children:(0,F.jsx)(ci,{onBackButtonClick:y,feedIsEmpty:p,goToAddFriends:j})}),(0,F.jsx)("div",{className:Y,children:(0,F.jsxs)(d.K,{children:[(0,F.jsx)(c.V,{title:l.ag.get("buddy-feed.friend-activity"),panel:o.s.BuddyFeed,onClose:N,actions:(0,F.jsx)(x.ws,{label:l.ag.get("buddy-feed.add-friends"),children:(0,F.jsx)(m.E,{ariaLabel:l.ag.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:y,icon:n.t})})}),(0,F.jsx)("div",{className:ee,children:(0,F.jsx)(m.E,{ariaLabel:l.ag.get("buddy-feed.add-friends"),className:ie,size:"sm",onClick:y,icon:n.t})}),p?(0,F.jsx)(xi,{}):(0,F.jsx)(he,{friends:i,spec:v})]})})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed.cb8a1a7b.js.map