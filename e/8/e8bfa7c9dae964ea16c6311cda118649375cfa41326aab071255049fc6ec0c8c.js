!);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"redpop@b474a6ad4354f4ba5fde672fa4e9c2c267684761"};"use strict";(self.webpackChunk_tumblr_redpop=self.webpackChunk_tumblr_redpop||[]).push([[4465],{80518:(e,s,t)=>{t.d(s,{Z:()=>p});var n=t(5754),a=t.n(n),i=t(45222),r=t(44009),o=t(37236);let l={chatListItemWrapper:"_vFtf",chatListItem:"leMd5",avatar:"xCv4H",content:"GyW8v",header:"uX3_z",name:"pTvJc",unread:"lx_bn",new:"Y8xri",preview:"FZe6i",previewTwoLines:"sAY6a",previewOneLine:"iVhqZ",isMobile:"F1eQQ"};var d=t(2629);let p=e=>{var s=e.previewContent,t=e.otherParticipant,n=e.label,p=e.openConversationOnClick,h=e.isMobile,c=e.unread,g=e.isOnline,u=e.conversationId,v=a()(l.chatListItem,{[l.isMobile]:h}),m=h?38:34,x="string"==typeof s,C=a()(l.preview,{[l.previewOneLine]:x,[l.previewTwoLines]:!x}),b=a()(l.header,{[l.unread]:c});return(0,d.jsxs)(r.Z,{wrapperClassName:l.chatListItemWrapper,className:v,onClick:e=>p(e,{conversationId:u,otherParticipantName:t.name}),label:n,children:[(0,d.jsx)("div",{className:l.avatar,children:(0,d.jsx)(i.Z,{dimension:m,avatarShape:o.o.Circle,imageResponse:t.avatar,isOnline:g,isAdult:t.isAdult})}),(0,d.jsxs)("div",{className:l.content,children:[(0,d.jsxs)("div",{className:b,children:[(0,d.jsx)("div",{className:l.name,children:t.name}),c&&(0,d.jsx)("div",{className:l.new})]}),(0,d.jsx)("div",{className:C,children:s})]})]})}},18434:(e,s,t)=>{t.d(s,{Z:()=>C});var n=t(50209),a=t.n(n),i=t(5754),r=t.n(i),o=t(95004),l=t(45222),d=t(44009),p=(0,t(36343).q)("messaging-smiley");p.defaultProps={size:{width:49,height:49}};var h=t(78667),c=t(63084),g=t(63583),u=t.n(g);let v={empty:"QH5q4",prompt:"uPfvs",suggestions:"qdKhK",avatar:"e8_q_",wiggle:"d76rQ"};var m=t(2629);class x extends o.Component{constructor(){super(...arguments),a()(this,"state",{currentIndex:0}),a()(this,"refreshRandomIndexMS",3e3),a()(this,"getOnClick",e=>s=>this.props.openConversationOnClick(s,{otherParticipantName:e}))}componentDidMount(){var e=this.props.suggestedParticipants;0!==e.length&&(this.currentIndexInterval=setInterval(()=>{this.setState({currentIndex:(0,c.Z)(0,e.length-1)})},this.refreshRandomIndexMS))}ender(){var e=this.props,s=e.appContext._t,t=e.suggestedParticipants,n=this.state.currentIndex;return(0,m.jsxs)("div",{className:v.empty,children:[(0,m.jsx)("div",{className:v.smiley,children:(0,m.jsx)(p,{size:{width:64,height:64},colors:{primary:u().paletteGray65}})}),(0,m.jsx)("div",{className:v.prompt,children:s("Talk to a Tumblr")}),t.length>0&&(0,m.jsx)("div",{className:v.suggestions,children:t.map((e,t)=>(0,m.jsx)(d.Z,{label:s("Start conversation"),wrapperClassName:r()(v.avatar,{[v.wiggle]:n===t}),onClick:this.getOnClick(e.name),children:(0,m.jsx)(l.Z,{dimension:35,imageResponse:e.avatar})},t))})]})}}let C=(0,h.HJ)(x)},73536:(e,s,t)=>{t.d(s,{Z:()=>u});var n=t(95004),a=t(25190),i=t(10131),r=t(78667),o=t(50869),l=t(68868),d=t(80518);let p={previewContentSpecial:"GC6tB"};var h=t(2629);class c extends n.Component{render(){var e=this.props,s=e.selectedBlog,t=e.conversations,n=e.openConversationOnClick,i=(0,e.appContext._t)("Conversation");return(0,h.jsx)(a.ZP,{children:e=>{var a=e.isMobile;return t.map((e,t)=>{var r=e.participants.find(,l=e.messages.data[0];if(!l)return null;var p=e.participants.find(,c=!!p&&this.getPreviewContent(l,p.name),g=(0,o.k)(null==r?void 0:r.secondsSinceLastActivity);return r&&(0,h.jsx)(d.Z,{otherParticipant:r,conversationId:e.id,previewContent:c,label:i,isMobile:a,unread:e.unreadMessagesCount>0,isOnline:g,openConversationOnClick:n},t)})}})}getPreviewContent(e,s){var t,n=[i.C.Post,i.C.Image,i.C.Sticker].includes(e.type)?p.previewContentSpecial:"";return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("span",{className:n,children:this.getMessagePreviewText(e,s)}),e.post&&e.type===i.C.Post&&!(0,l.A)(e.post)&&(null===(t=e.post)||void 0===t?void 0:t.summary)&&(0,h.jsxs)("span",{children:['"',e.post.summary,'"']},"summary")]})}getMessagePreviewText(e,s){var t=this.props,n=t.selectedBlog,a=t.appContext._t;switch(e.type){case i.C.Image:case i.C.Sticker:return a("%1$s sent a photo",[s]);case i.C.Post:return a(e.post&&!(0,l.A)(e.post)?"%1$s sent a post":"%1$s sent a post that's no longer available",[s]);case i.C.Text:var r,o=e.participant===n.uuid?(0,h.jsxs)("span",{className:p.previewContentSpecial,children:[n.name,":"]}):"",d=null===(r=e.content)||void 0===r?void 0:r.text;return(0,h.jsxs)("span",{children:[o," ",d]})}}}let g=(0,r.HJ)(c),u=function(e){var s=e.conversations,t=e.selectedBlog,n=e.openConversationOnClick;return(0,h.jsx)("div",{className:"ftU4D",children:(0,h.jsx)(g,{conversations:s,selectedBlog:t,openConversationOnClick:n})})}},73831:(e,s,t)=>{t.d(s,{Z:()=>w});var n=t(54138),a=t.n(n),i=t(50209),r=t.n(i),o=t(5754),l=t.n(o),d=t(95004),p=t(93853),h=t(37548),c=t(17144),g=t(85795),u=t(78667),v=t(42914),m=t(399),x=t(80518);let C={newMessage:"M34dz",searchWrapper:"glTqf",searchLoader:"P4xeq",suggestedResults:"n23S3",suggestedParticipantsTitle:"X_lFW",isMobile:"wSjVv",noResults:"oLgq2"};var b=t(2629);class f extends d.Component{constructor(){var e;super(...arguments),r()(this,"state",{blogSearchText:"",searchedParticipants:[]}),r()(this,"newMessageListItemLabel",this.props.appContext._t("New Message")),r()(this,"maxResultsToDisplay",5),r()(this,"apiHelper",(0,g.ZP)(this.props.appContext.apiFetch)),r()(this,"debounceGetSearchedParticipants",(0,v.Z)(null!==(e=this.props.debounceTime)&&void 0!==e?e:100)),r()(this,"placeholders",(0,m.Qe)(this.props.appContext._c)),r()(this,"openConversationOnFirstSearchResult",e=>{if(e.key===p.SV.Enter&&!e.nativeEvent.isComposing){var s=this.props.openConversationOnClick,t=this.state.searchedParticipants;t.length&&s(null,{otherParticipantName:t[0].name})}}),r()(this,"setInputRef",e=>this.input=e),r()(this,"handleTextChange",e=>{var s=e.target.value;s!==this.state.blogSearchText&&this.setState({blogSearchText:s,searchInProgress:!0},this.debounceGetSearchedParticipants)}),r()(this,"refreshSearchedParticipants",()=>{var e=this.state.blogSearchText,s=this.props.selectedBlog,t={searchInProgress:!1,noResultsPlaceholder:(0,c.I)(this.placeholders)};return e.length?this.apiHelper.getSuggestedParticipants(s.name,{limit:this.maxResultsToDisplay,q:e}).fetch().then(e=>{var s=e.response;this.setState(a()(a()({},t),{},{searchedParticipants:s.blogs}))}):Promise.resolve(this.setState(a()(a()({},t),{},{searchedParticipants:[]})))})}componentDidMount(){this.focusInput()}ender(){var e=this.state,s=e.blogSearchText,t=e.searchedParticipants,n=e.searchInProgress;return this.props.inNewMessageMode&&(0,b.jsxs)("div",{className:C.newMessage,children:[(0,b.jsx)(p.ZP,{disable:[...p.z9]}),this.renderSearchbar(),n&&(0,b.jsx)(h.Z,{className:C.searchLoader}),!!s.length&&(t.length?this.renderSearchResults():this.renderNoSearchResults()),this.shouldShowSuggestedResults()&&this.renderSuggestedResults()]})}renderSearchbar(){var e=this.props.appContext._t;return(0,b.jsxs)("div",{className:C.searchWrapper,children:[(0,b.jsx)("span",{children:e("To:")})," ",(0,b.jsx)("input",{type:"text",value:this.state.blogSearchText,onChange:this.handleTextChange,onKeyDown:this.openConversationOnFirstSearchResult,ref:this.setInputRef})]})}shouldShowSuggestedResults(){var e=this.state,s=e.blogSearchText,t=e.searchedParticipants,n=this.props.suggestedParticipants;return!!n&&!!n.length&&(!s.length||!!s.length&&!!t.length)}enderSearchResults(){var e=this.state.searchedParticipants,s=this.props,t=s.isMobile,n=s.openConversationOnClick;return e.map(e=>(0,b.jsx)(x.Z,{otherParticipant:e,previewContent:e.title,label:this.newMessageListItemLabel,isMobile:t,openConversationOnClick:n},e.uuid))}renderNoSearchResults(){var e=this.state,s=e.searchInProgress,t=e.blogSearchText,n=e.noResultsPlaceholder;return(!s||s&&t.length>1)&&(0,b.jsx)("div",{className:C.noResults,children:n})}renderSuggestedResults(){var e=this.props,s=e.suggestedParticipants,t=e.openConversationOnClick,n=e.isMobile,a=e.appContext._t,i=this.state.searchedParticipants,r=this.maxResultsToDisplay-i.length;return r>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:l()(C.suggestedParticipantsTitle,{[C.isMobile]:n}),children:a("Recently followed")}),(0,b.jsx)("div",{className:C.suggestedResults,children:s.map((e,s)=>s<r&&(0,b.jsx)(x.Z,{otherParticipant:e,previewContent:e.title,label:this.newMessageListItemLabel,isMobile:n,openConversationOnClick:t},e.uuid))})]})}}let w=(0,u.HJ)(f)},85846:(e,s,t)=>{t.r(s),t.d(s,{default:()=>Z});var n=t(54138),a=t.n(n),i=t(50209),r=t.n(i),o=t(37548),l=t(6135),d=t(26705),p=t(53714),h=t(25190),c=t(95004),g=t(85795),u=t(59215),v=t(19542),m=t(63583),x=t.n(m),C=t(73536),b=t(18434),f=t(55673),w=t(20069),P=t(44009),I=t(53451),M=t(43523),S=t(78667),N=t(22424);let j={header:"HPx0P",headerDesktop:"kyh7r",selector:"Go9jW",new:"x8sYn",newMessage:"DBG9_",nevermind:"mA8xO"};var R=t(2629);let k=e=>{var s=e.blogs,t=e.selectedBlog,n=e.pathGenerator,a=e.inNewMessageMode,i=e.setInNewMessageMode,r=e.onClickSelectedBlog,o=(0,S.bp)()._t,l=(0,N.wL)().logEvent,d=(0,h.v$)().isMobile,p=()=>{a||l({eventName:M.J.MessagesPopoverNewMessage}),i(!a)},c=(0,R.jsx)("div",{className:j.selector,children:(0,R.jsx)(w.ZP,{blogs:s,onClickSelectedBlog:r?e=>{l({eventName:M.J.MessagesPopoverSwitchBlog}),null==r||r(e)}:void 0,selectedBlog:t,showUnreadMessagesCount:!0,displayAvatar:!d,pathGenerator:d?n:void 0})});if(d)return(0,R.jsxs)("div",{className:j.header,children:[c,(0,R.jsx)(f.rU,{className:j.new,to:`/messaging/new/${t.name}`,state:{selectedBlog:t},children:(0,R.jsx)(I.Z,{size:{width:20,height:20},filledIconColors:{primary:x().paletteTransparentWhite65}})})]});var g=o("Nevermind"),u=o("New Message");return(0,R.jsxs)("div",{className:j.headerDesktop,children:[c,a?(0,R.jsx)(P.Z,{className:j.nevermind,label:g,onClick:p,children:g}):(0,R.jsx)(P.Z,{className:j.newMessage,label:u,onClick:p,children:u})]})};var y=t(73831);let T={messaging:"_v5gz",messagingDesktop:"FBnVP",inboxWrapper:"EXUkD",paginationLoader:"PDF9O",headerWrapper:"mBa_9",hidden:"Tjbvn"};var O=t(94742);class B extends c.Component{constructor(){super(...arguments),r()(this,"state",{blogs:[],inNewMessageMode:!1}),r()(this,"inboxWrapperRef",null),r()(this,"apiHelper",(0,g.ZP)(this.props.appContext.apiFetch)),r()(this,"setInboxWrapperRef",,r()(this,"messagingPathGenerator",e=>"/messaging"+(e.primary?"":`/${e.name}`)),r()(this,"onClickSelectedBlog",e=>{e!==this.state.selectedBlog&&(this.setState({selectedBlog:e}),this.refreshFetchableContents())}),r()(this,"setInNewMessageMode",,r()(this,"onPagination",e=>{var s,t=e.response;if(this.props.appContext.features.redpopRealTimeDashboardMessaging){var n=this.props.messagingContext.updateInboxData,a=null===(s=this.state.selectedBlog)||void 0===s?void 0:s.uuid;a&&n(a,t.response)}}),r()(this,"getConversationsFromResponse",,r()(this,"renderInboxLoader",()=>this.state.selectedBlog&&(0,R.jsx)(o.Z,{})),r()(this,"renderEmptyInbox",e=>{var s=this.state.suggestedParticipants;return s?(0,R.jsx)(b.Z,{suggestedParticipants:s,openConversationOnClick:this.openConversationOnClick(e)}):this.renderInboxLoader()}),r()(this,"renderPaginatorContent",e=>s=>{var t=s.objects;return this.state.selectedBlog&&(0,R.jsx)(C.Z,{conversations:t,selectedBlog:this.state.selectedBlog,openConversationOnClick:this.openConversationOnClick(e)})}),r()(this,"renderPaginatorLoader",()=>(0,R.jsx)("div",{className:T.paginationLoader,children:(0,R.jsx)(l.Z,{centerOrientation:"horizontal",color:x().gray65,small:!0})})),r()(this,"openConversationOnClick",e=>(s,t)=>{var n=this.props.messagingContext.openConversationWindow,i=this.state.selectedBlog;i&&(n(a()(a()({},t),{},{selectedBlogName:i.name})),null==e||e.closeContainingPopover())}),r()(this,"refreshFetchableContents",()=>this.getUserInfo().then(),r()(this,"getSuggestedParticipants",()=>this.apiHelper.getSuggestedParticipants(this.props.selectedBlogName,{limit:8}).fetch().then(e=>{var s=e.response;return this.setState({suggestedParticipants:s.blogs})}).catch(),r()(this,"updateInboxEndpointApiRequest",()=>{this.setState(e=>{var s=e.selectedBlog;null!=s&&s.uuid&&this.setState({inboxEndpointApiRequest:this.apiHelper.getInboxData(s.uuid)})})}),r()(this,"getUserInfo",()=>this.props.appContext.getUserInfo().then(this.processUserInfo)),r()(this,"processUserInfo",e=>{var s=this.state.selectedBlog?this.state.selectedBlog.name:this.props.selectedBlogName,t=(0,O.$)(e,s),n=e.blogs.filter(;this.setState({selectedBlog:t,blogs:n})})}ender(){return(0,R.jsx)(h.ZP,{children:e=>{var s=e.isMobile;return(0,R.jsxs)("div",{className:s?T.messaging:T.messagingDesktop,children:[this.renderHeader(),(0,R.jsx)(p.LW.Consumer,{children:e=>(0,R.jsxs)("div",{className:T.inboxWrapper,ref:this.setInboxWrapperRef,children:[this.renderInbox(s,e),this.renderNewMessage(s,e)]})})]})}})}renderHeader(){var e=this.state,s=e.selectedBlog,t=e.blogs,n=e.inNewMessageMode;return s&&t?(0,R.jsx)("div",{className:T.headerWrapper,children:(0,R.jsx)(k,{blogs:t,selectedBlog:s,inNewMessageMode:n,pathGenerator:this.messagingPathGenerator,setInNewMessageMode:this.setInNewMessageMode,onClickSelectedBlog:this.onClickSelectedBlog})}):null}renderInbox(e,s){var t=this.state,n=t.inNewMessageMode,a=t.inboxEndpointApiRequest,i=n?T.hidden:"";return a?(0,R.jsx)("div",{className:i,children:!!this.inboxWrapperRef&&(0,R.jsx)(d.ZP,{scrollContainer:this.inboxWrapperRef,fetchDistance:100,endpointApiRequest:a,getObjectsFromResponse:this.getConversationsFromResponse,pullToRefresh:e,onPagination:this.onPagination,emptyView:this.renderEmptyInbox(s),initialLoader:this.renderInboxLoader(),loader:this.renderPaginatorLoader(),children:this.renderPaginatorContent(s)})}):null}renderNewMessage(e,s){var t=this.state,n=t.inNewMessageMode,a=t.selectedBlog,i=t.suggestedParticipants;return a?(0,R.jsx)(y.Z,{selectedBlog:a,suggestedParticipants:i||[],inNewMessageMode:n,isMobile:e,openConversationOnClick:this.openConversationOnClick(s)}):null}}let Z=(0,u.X9)(B,{appContext:!0,messagingContext:!0})},17144:(e,s,t)=>{t.d(s,{I:()=>a});var n=t(68782);,10131:(e,s,t)=>{t.d(s,{C:()=>n,b:()=>r});var n={}),a=function(e){return e.Active="ACTIVE",e.Inactive="INACTIVE",e}(a||{}),i=i||{}),r={})},19542:(e,s,t)=>{t.d(s,{P:()=>a});var n=t(10240),a=,68868:(e,s,t)=>{t.d(s,{A:);var n=}]);