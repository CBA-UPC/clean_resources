/*!
 * Copyright (c) 2023 Oracle and/or its affiliates.
 * All rights reserved. Oracle Digital Assistant Client Web SDK, Release: 22.12.0
 */
var e,factory;e=self,factory=function(){return function(){"use strict";var e={216:function(e,t,i){var s;i.d(t,{a:function(){return k},b:function(){return v},c:function(){return s},d:function(){return o}}),s||(s={}));const n=Object.keys(s).map((e=>s[e]));ar a;!function(e){e[e.Connecting=0]="Connecting",e[e.Open=1]="Open",e[e.Closing=2]="Closing",e[e.Closed=3]="Closed"}(a||(a={}));var r=i(24);const c=window.audioinput; p=window.AudioContext;const u=window.navigator;let g=u.mediaDevices;const m=u.webkitGetUserMedia,f=u.mozGetUserMedia,b=!!(g&&g.getUserMedia||m||f);var v;!function(e){e.RecognitionNotAvailable="RecognitionNotAvailable",e.RecognitionNotReady="RecognitionNotReady",e.RecognitionNoAPI="RecognitionNoAPI",e.RecognitionProcessingFailure="RecognitionProcessingFailure",e.RecognitionTooMuchSpeechTimeout="RecognitionTooMuchSpeechTimeout",e.RecognitionNoSpeechTimeout="RecognitionNoSpeechTimeout",e.RecognitionMultipleConnection="RecognitionMultipleConnection"}(v||(v={}));var w=const x=4096,C=48e3;let S,y=!0;class k{tatic getInstance(){return this._service||(this._service=new k),this._service}startRecognition(e){var t,i;return this._startPromise=new r.Deferred,e&&(this._onRecognitionText=e.onRecognitionText,this._onAnalyserReady=e.onAnalyserReady,this._onVisualData=e.onVisualData,this._onSpeechNetworkChange=e.onSpeechNetworkChange),(null===(t=this._connection)||void 0===t?void 0:t.readyState)===a.Closing||(null===(i=this._connection)||void 0===i?void 0:i.readyState)===a.Connecting?Promise.reject(new Error(v.RecognitionMultipleConnection)):(this._isRecording?this._startPromise.resolve():this._url?this._setupRecognition():this._buildServerURL().then((()=>this._setupRecognition())),this._startPromise.promise)}pRecognition(){return new Promise(((e,t)=>{b?e,t):void 0!==l()?function(e,t){d().then((()=>h({audioSourceType:6,bufferSize:x,streamToWebAudio:!0}).then(())).catch(()}(e,t):t(Error(v.RecognitionNoAPI))})).then(().catch(()}onOpen(){this._config.tokenGenerator?this._authService.get().then((e=>{this._connection.send(`Bearer ${e.token}`),this._setConnectionState(a.Open),this._sendPreConnectionBuffer()})):(this._setConnectionState(a.Open),this._sendPreConnectionBuffer())}_onClose(){this._isRecording&&this._stopProcessing(),this._stopPromise&&(this._stopPromise.resolve(),this._stopPromise=void 0),this._setConnectionState(a.Closed)}onError(){this._connection.readyState===a.Open&&(this._notifyError(v.RecognitionProcessingFailure),this._connection.close())}ndBuffer(e){this._connection.readyState!==a.Open||this._streamBuffer.length?this._streamBuffer.push(e):this._connection.send(e)}_sendPreConnectionBuffer(){if(this._connection.readyState===a.Open)for(;this._streamBuffer.length;){const e=this._streamBuffer.shift();e&&this._connection.send(e)}}_stopProcessing(){var e,t;this._isRecording=!1,this._connection&&(this._connection.readyState===a.Open&&(this._connection.send("Done"),this._connection.close()),this._audioWorklet&&this._audioWorklet.disconnect(),this._analyser&&this._analyser.disconnect(),l()?d():(e=this._context,(t=this._stream)&&(t.mediaStream&&t.mediaStream.getAudioTracks().forEach((e=>{e.stop()})),t.disconnect()),e&&e.close()),this._audioWorklet=void 0,this._analyser=void 0,this._stream=void 0,this._context=void 0,this._streamBuffer=[],y=!0,S=new Float32Array(0))}}const _="/voice/stream/recognize",T="generic";onst A=[-25033838264794034e-21,-3645156113737857e-20,-11489993827892933e-21,393243788874656e-19,6998419352067277e-20,37556691270439976e-21,-476966455345305e-19,-.00011379935461751734,-8400957697117619e-20,4208817777607469e-20,.00016391587447478332,.00015508372993570357,-1253765788919669e-20,-.00021258262011091092,-.0002524059896175195,-51874329668708116e-21,.0002479230009768214,.00037351534477673157,.00016157590781788105,-.0002541085239198603,-.000510486865332593,-.0003246104617540939,.00021219136947965464,.0006488877825604561,.0005444416935293036,-.0001016639071691704,-.0007673001147209819,-.0008176720912938691,-972696982411551e-19,.0008376185852528038,.0011319450250252222,.0004008193339799052,-.0008262743020160207,-.0014643282305934196,-.0008183365045047033,.0006964471772153777,.001780467922489105,.0013489288090360295,-.00041122152287042,-.0020347535966250413,-.0019782994815083733,-6247794246099269e-20,.002171643809964705,.0026761621389245617,.00074944268608935,-.00212817775887288,-.003394541347147186,-.0016615884301227524,.001837545335885159,.004067170702246546,.0027936171643976352,-.001233420727213658,-.004610035314537476,-.004119319153202972,.00025459137646049936,.00492286494534436,.005588805700369816,.001150762425755883,-.004891042781491068,-.0071267634777626675,-.003021979039818941,.00438688631315642,.008631467181982988,.005385139236634672,-.003268406079325266,-.009973661255235284,-.008256256502745316,.0013719935383757782,.010993210336541666,.011651337116264694,.0015082475865128093,-.01148872195209017,-.015609515327517686,-.005671504441670989,.011188303272599716,.02024519058502148,.011637590928971467,-.009667754909210324,-.025878090076785515,-.020500381603699786,.006098908137700642,.033428666116203716,.03513487017573178,.001719739622764723,-.046085580848361105,-.06623078150315037,-.023349941728869696,.08292213207159124,.21069217442624302,.2973829711397418,.2973829711397419,.21069217442624305,.08292213207159124,-.023349941728869693,-.06623078150315037,-.046085580848361105,.0017197396227647225,.03513487017573178,.033428666116203716,.006098908137700641,-.020500381603699783,-.025878090076785508,-.009667754909210326,.011637590928971469,.020245190585021472,.011188303272599716,-.00567150444167099,-.015609515327517682,-.01148872195209017,.001508247586512809,.011651337116264699,.010993210336541666,.0013719935383757782,-.008256256502745314,-.009973661255235283,-.0032684060793252657,.00538513923663467,.008631467181982988,.004386886313156419,-.0030219790398189413,-.0071267634777626675,-.0048910427814910715,.0011507624257558842,.005588805700369813,.00492286494534436,.00025459137646049936,-.004119319153202973,-.004610035314537475,-.0012334207272136583,.002793617164397636,.004067170702246546,.0018375453358851592,-.0016615884301227509,-.0033945413471471847,-.0021281777588728797,.0007494426860893505,.0026761621389245612,.0021716438099647056,-6247794246099253e-20,-.001978299481508373,-.0020347535966250404,-.00041122152287042,.0013489288090360292,.0017804679224891048,.0006964471772153777,-.0008183365045047026,-.00146432823059342,-.0008262743020160207,.0004008193339799063,.0011319450250252222,.0008376185852528037,-9726969824115494e-20,-.0008176720912938694,-.0007673001147209783,-.00010166390716916983,.0005444416935293033,.0006488877825604562,.0002121913694796546,-.00032461046175409424,-.000510486865332593,-.00025410852391986036,.0001615759078178811,.0003735153447767315,.00024792300097682137,-5187432966870808e-20,-.0002524059896175194,-.00021258262011091095,-1253765788919669e-20,.0001550837299357036,.0001639158744747833,42088177776074685e-21,-8400957697117623e-20,-.00011379935461751733,-4769664553453051e-20,3755669127044002e-20,699841935206728e-19,393243788874656e-19,-11489993827892933e-21,-3645156113737856e-20,-2503383826479402e-20],E=[-5044267067893139e-21,5738740247594612e-21,1611195555688156e-20,10560179594562795e-21,-1242816862904201e-20,-3084430704328611e-20,-18160396924882423e-21,2303124169528074e-20,5216612702894834e-20,2806026886746509e-20,-389608521587068e-19,-8174245278012476e-20,-4037543061985353e-20,619375276294956e-19,.00012143092661620545,55083199655424166e-21,-9401891583478883e-20,-.00017326981522755043,-7198069055926206e-20,.0001376274218691789,.00023946132645647525,9064030545698025e-20,-.00019557611633250834,-.0003223511502826996,-.00011036322783022617,.0002710935667931249,.00042440564349633953,.00013013140955365376,-.00036784896615780913,-.0005481886438481025,-.00014855826094166272,.0004899798946967381,.000696340560985472,.00016383778624615643,-.0006421263408051642,-.0008715631880363658,-.00017369118859371453,.000829476349448821,.0010766146787146871,.00017530890385814463,-.0010578310750603923,-.001314320458073489,-.0001652844648711556,.0013337004262191077,.0015876076783199174,.000139534308084411,-.0016644454627712116,-.001899573527380014,-9319422024995832e-20,.002058491185395933,.0022536018141979036,20477911370491685e-21,-.0025256449668619525,-.0026535487754524955,8552498376473957e-20,.0030775744811722015,.0031040297261921,-.00023314744969763122,-.003728529808331677,-.003610856230113392,.000432598472497653,.0044964472481822506,.004181705019767344,-.0006966685466235378,-.005404666489478738,-.00482715710731867,.0010418556659416306,.006484667519607787,.00556235368742558,-.0014902159613265254,-.007780573986407925,-.0064097301786953595,.002072517010858728,.009356870546119134,.0074037416266333166,-.00283386009764953,-.011312323822665827,-.008599512596140524,.003844300507349054,.013806774337071994,.01008985372973804,-.005220460312862638,-.01711716324115331,-.01204196749753927,.007174046245357611,.021768247992024713,.01478690833035584,-.010136389804721707,-.02888735624896028,-.019078400739739057,.015146805312378952,.041410446665863104,.027068163980255515,-.025512027260482153,-.07011218378743589,-.04829678433503421,.06041368701604651,.21199607414538668,.3213532652447261,.3213532652447261,.21199607414538668,.060413687016046526,-.04829678433503422,-.07011218378743589,-.025512027260482153,.027068163980255515,.041410446665863104,.015146805312378952,-.019078400739739057,-.02888735624896028,-.010136389804721703,.01478690833035584,.021768247992024713,.007174046245357611,-.01204196749753927,-.01711716324115331,-.005220460312862639,.010089853729738038,.013806774337071994,.0038443005073490553,-.008599512596140524,-.011312323822665827,-.0028338600976495314,.007403741626633317,.009356870546119134,.002072517010858727,-.006409730178695359,-.007780573986407925,-.001490215961326526,.005562353687425577,.006484667519607787,.0010418556659416256,-.004827157107318673,-.005404666489478739,-.0006966685466235378,.004181705019767345,.004496447248182251,.0004325984724976533,-.003610856230113392,-.003728529808331677,-.0002331474496976315,.0031040297261921003,.003077574481172201,8552498376473897e-20,-.002653548775452496,-.002525644966861952,2047791137049164e-20,.002253601814197904,.002058491185395933,-9319422024995909e-20,-.001899573527380014,-.0016644454627712118,.00013953430808441038,.0015876076783199174,.0013337004262191077,-.0001652844648711556,-.0013143204580734896,-.0010578310750603925,.00017530890385814333,.0010766146787146878,.0008294763494488195,-.00017369118859371463,-.00087156318803637,-.0006421263408051633,.00016383778624615698,.0006963405609854716,.0004899798946967381,-.00014855826094166245,-.0005481886438481027,-.00036784896615780924,.00013013140955365368,.00042440564349633964,.00027109356679312505,-.00011036322783022619,-.0003223511502826996,-.00019557611633250842,9064030545698017e-20,.00023946132645647525,.00013762742186917883,-7198069055926207e-20,-.0001732698152275505,-9401891583478886e-20,5508319965542416e-20,.00012143092661620549,6193752762949557e-20,-4037543061985352e-20,-8174245278012477e-20,-38960852158706805e-21,28060268867465078e-21,52166127028948336e-21,2303124169528077e-20,-18160396924882423e-21,-30844307043286126e-21,-12428168629042018e-21,10560179594562806e-21,1611195555688157e-20,5738740247594605e-21,-5044267067893138e-21];,197:function(e,t,i){i.d(t,{a:function(){return o},b:function(){return a},c:function(){return ie},d:function(){return n},e:function(){return L},f:function(){return s},g:function(){return b.a},h:function(){return b.b},i:function(){return r},j:function(){return h.c},k:function(){return c},l:function(){return l},m:function(){return W},n:function(){return H},o:function(){return G},p:function(){return j},q:function(){return z},r:function(){return R},s:function(){return B},t:function(){return X},u:function(){return m},v:function(){return f},w:function(){return u},x:function(){return g},y:function(){return d},z:function(){return p},A:function(){return A},B:function(){return h.d},C:function(){return U},D:function(){return v},E:function(){return x},F:function(){return D},G:function(){return P}});var s,n,o,a,r,c,l,h=i(216);nction u(e){return void 0!==e.fields}function g(e){return void 0!==e.formRows}function m(e){return void 0!==e.fields}function(e){e.Open="open",e.Close="close",e.Error="error",e.Message="message",e.MessageReceived="message:received",e.MessageSent="message:sent",e.State="state"}(s||(s={})),n||(n={})),o||(o={})),a||(a={})),function(e){e.Attachment="attachment",e.Card="card",e.Location="location",e.Postback="postback",e.Raw="raw",e.Suggest="suggest",e.Text="text",e.CloseSession="closeSession",e.SessionClosed="sessionClosed",e.Table="table",e.Form="form",e.TableForm="tableForm",e.Status="status",e.EditForm="editForm",e.FormSubmission="formSubmission"}(r||(r={})),function(e){e.Skill="bot",e.User="user"}(c||(c={})),l||(l={}));var b=i(721); y=Object.values(b.b);nction T(e){const t=e.displayType;return t&&A(t)&&k(e)}const I=[b.a.Text,b.a.Link,b.a.Image,b.a.Media,b.a.ActionDisplay];ar E,M=i(24);!E||(E={}));const L=Object.assign(Object.assign(Object.assign({},E),M.AuthError),h.b);function P(e,t,i){e.setRequestHeader(t,i)}unction O(e){return e.lastIndex=0,e}nst V=navigator,N=V&&V.geolocation;"; ",K="",Y=/<[^>]+>/g,J=/&#(\d+);/g,Z=/&#[xX]([\da-fA-F]+);/g;function X(e,t){const i=e.messagePayload;let s=K;switch(i.type){case r.Attachment:s=i,t);break;case r.Card:s=i,t);break;case r.Location:s=i);break;case r.Text:s=i.text;break;case r.Table:s=i,t);break;case r.Form:s=i,t);break;case r.TableForm:s=i,t);break;case r.EditForm:s=function(e,t){return m(e)?te(e.fields,t):e.formRows.map(().join(q)}(i,t)}return n=function(e,t){const i=e.headerText||K,s=e.footerText||K,n=i+(i&&t?q:K)+t+Q(e.actions)+(s?`${q}${s}`:K)+Q(e.globalActions);return n}(i,s),n&&n.length?n.replace(O(J),().replace(O(Z),().replace(O(Y),K):K;var n}function Q(e){let t=K;return e&&e.forEach((),t}unction te(e,t){return e&&e.length?e.filter(().map((e=>function(e,t){const i=e.displayType;if(A(i))return`${e.label}: ${"link"===e.displayType?(t.linkField||"").replace("{0}",e.label):e.value}`;let s=`${e.label}: ${i}`;switch(i){case b.a.SingleSelect:case b.a.MultiSelect:s+=`: ${n=e.options,n&&n.length?n.filter(().map((e=>e.label)).join(q):K}`;break;case b.a.Toggle:const t=e;s+=`: ${t.labelOn||t.valueOn} ${t.labelOff||t.valueOff}`}var n;return s}(e,t))).join(q):K},721:function(e,t,i){var s;i.d(t,{a:function(){return s},b:function(){return n}}),s||(s={}));const n={MapVariable:"mapVariable",SeparateVariables:"separateVariables",CompositeBag:"compositeBag"}},930:function(e,t,i){i.r(t),i.d(t,{ActionType:function(){return x.a},AttachmentType:function(){return x.b},ConnectionState:function(){return x.d},CoreError:function(){return x.e},CoreEvent:function(){return x.f},DisplayType:function(){return x.g},FILE_TYPES:function(){return O},FormSubmissionProcessingMethod:function(){return x.h},MAX_MB:function(){return L},MessageType:function(){return x.i},RecognitionLocale:function(){return x.j},SenderType:function(){return x.k},SkillMessageSource:function(){return x.l},WebCore:function(){return R},buildPostbackMessage:function(){return x.m},buildUserAttachmentMessage:function(){return x.n},buildUserMessage:function(){return x.o},buildUserTextMessage:function(){return x.p},getCurrentPosition:function(){return x.q},getError:function(){return x.r},getRejectPromiseError:function(){return x.s},getUtteranceText:function(){return x.t},isEditFormPayloadWithFields:function(){return x.u},isEditFormPayloadWithRows:function(){return x.v},isFormEntityWithFields:function(){return x.w},isFormEntityWithRows:function(){return x.x},isMessagePayload:function(){return x.y},isPostbackPayload:function(){return x.z},isValidLocale:function(){return x.B},isValidLocation:function(){return x.C},isValidMessage:function(){return x.D},isValidProfileMessage:function(){return x.E}});var s=i(24);let n=1,o=1,a=1;const r=window,c=r.addEventListener,l=r.speechSynthesis,h=r.SpeechSynthesisUtterance,d=r.navigator,p=clearTimeout;i(216),x=i(197);const C={state:{type:"ping"}};class S extends x.c{pen(){return this.isOpen()?Promise.resolve():navigator.onLine?this.connect():(0,x.s)(x.e.NetworkOffline)}onnect(){return this.closePromise||(this.xhr.abort(),this.closePromise=new s.Deferred,this.setState(x.d.Closing),this.onClose()),this.closePromise.promise}(e){this.dispatcher.trigger(x.f.Error,e)}}const y=Promise,k=3e6,_=window;class T extends x.c{d(e){return new y(((t,i)=>{if(this.ws&&this.isOpen()){this.isTokenValid=!0;try{this.ws.send(JSON.stringify(e)),t(e),(s=e).state&&s.state.type&&"ping"===s.state.type||(this.dispatcher.trigger(x.f.Message,e),this.dispatcher.trigger(x.f.MessageSent,e))}catch(e){i((0,x.r)(x.e.NetworkFailure))}}else i((0,x.r)(x.e.ConnectionNone));var s}))}ticateConnection(){var e;this.isTokenValid=!1,null===(e=this.authService)||void 0===e||e.get().then((e=>{this.send(function(e){return{state:{token:e,tokenType:"jwt",type:"auth"}}}(e.token)).then(()})).catch(()}Message(e){try{const t=JSON.parse(e.data);!t)?t.suggestions&&this.suggestionPromise?this.suggestionPromise.resolve(t.suggestions):(this.dispatcher.trigger(x.f.Message,t),this.dispatcher.trigger(x.f.MessageReceived,t)):this.isHeartBeatAlive=!0}catch(e){this.onError(e)}}ss A{d(e){return this.currentConnection.send(e)}isOpen(){return this.currentConnection.isOpen()}isClosed(){return this.currentConnection.isClosed()}getState(){return this.currentConnection.getState()}n(e,t){this.dispatcher.bind(e,t)}off(e,t){this.dispatcher.unbind(e,t)}tUpgradeToWebSocketTimer(){return window.setTimeout(this.open.bind(this),3e5)}}const E={isLongPoll:!1,isTLS:!0};onst L=25,P=1024*L*1024;onst O={AUDIO:".aac, .amr, .m4a, .mp3, .mp4a, .mpga, .oga, .ogg, .wav, audio/*",FILE:".7z, .csv, .doc, .docx, .eml, .ics, .key, .log, .msg, .neon, .numbers, .odt, .pages, .pdf, .pps, .ppsx, .ppt, .pptx, .rtf, .txt, .vcf, .xls, .xlsx, .xml, .yml, .yaml, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",IMAGE:".gif, .jfif, .jpeg, .jpg, .png, .svg, .tif, .tiff, .webp, image/*",VIDEO:".3g2, .3gp, .avi, .m4v, .mov, .mp4, .mpeg, .mpg, .ogv, .qt, .webm, .wmv, video/*",ALL:""};O.ALL=`${O.AUDIO},${O.FILE},${O.IMAGE},${O.VIDEO}`;,532:function(e,t,i){var s;i.r(t),i.d(t,{ChatEvent:function(){return s},ConnectionState:function(){return T.d},DOMUtil:function(){return Oe},Logger:function(){return R},MessageComponentFactory:function(){return _t},RecognitionLocale:SDK_VERSION:function(){return U},ShareCategory:function(){return Fe},StorageType:function(){return Ne},WidgetComponent:function(){return ti},WidgetTheme:function(){return ze},configureLocale:function(){return C},debounce:function(){return S},deepFreeze:function(){return o},getValues:function(){return a},isAnyVoiceAvailable:function(){return r},setObjectReadOnly:function(){return f},syncTTSLocaleIfUnavailable:function(){return v},updateCSSVar:),s||(s={}));const n=st c=/(?:youtube\.com\/watch\?v=|youtu.be\/)([^#&?\s]*)/gim;onst h=/(?:https?:\/\/)?videohub\.oracle\.com\/media\/\S+\/([\w]+)/gim;onst p=[{match:/<([a-z])/gi,replace:(e,t)=>`&#x3c;${t}`},{match:/<\/([a-z])/gi,replace:]; v=(();T=i(197);function I(e){return e.filter((e=>{const t=e.getActionType();return t===T.a.Postback||t===T.a.Location}))}VEL={DEBUG:4,ERROR:1,INFO:3,NONE:0,WARN:2},R.logLevel=R.LOG_LEVEL.ERROR,R.history=[],R.historyEnabled=!1,R._historySize=100;.logger=new R("ActionComponentFactory"),function(e){e.LEFT="left",e.RIGHT="right"}(_||(_={}));class V{constructor(e,t,i,s,n,o){this.settings=e,this.util=t,this.side=s,this.source=n,this.actions=[],this.globalActions=[],this._postActions=[],this.locale=e.locale,this.translations=e.i18n[this.locale],o&&o.locale&&(this.locale=o.locale,this.translations=Object.assign(Object.assign({},this.translations),this.settings.i18n[o.locale]));let a="";switch(i.type){case T.i.Card:i.cards.forEach(();break;case T.i.Text:a=i.text;break;case T.i.Attachment:a=i.attachment.url;break;case T.i.Location:const e=i.location;a=`${e.title?`${e.title} - `:""}${e.latitude}, ${e.longitude}`}if(i.actions&&(this.actions=N(i.actions,t,e.openLinksInNewWindow,a,e.linkHandler,o,this.handleOnActionClick.bind(this))),this._isActionsExternal=e.displayActionsAsPills,i.globalActions){const s=N(i.globalActions,t,e.openLinksInNewWindow,a,e.linkHandler,o,this.handleOnActionClick.bind(this));this.globalActions=this.globalActions.concat(s)}this.headerText=i.headerText,this.footerText=i.footerText,this.type=i.type,this._postActions=I(this.actions).concat(I(this.globalActions))}ableActions(){this.actions.forEach((e=>{e.disable()})),this.globalActions.forEach((e=>{e.disable()}))}disablePostbacks(){this._postActions.forEach((e=>{e.disable()}))}nder(e){const t=this,i=t.util,s=t.actions,n=t.globalActions,o=i.createDiv(["message"]);o.lang=t.locale;const a=i.createDiv(["message-wrapper"]);o.appendChild(a);const r=t.getContent(e);if(this.type!==T.i.EditForm&&t.headerText&&a.appendChild(t.getHeader()),a.appendChild(r),s&&s.length){const e=t.getActions();(t._isActionsExternal?a:r).appendChild(e),t.firstActionButton||(t.firstActionButton=e.firstElementChild)}if(t.footerText&&a.appendChild(t.getFooter()),n&&n.length){const e=t.getGlobalActions();o.appendChild(e),t.firstActionButton||(t.firstActionButton=e.firstElementChild)}return o}getHeader(){return z(this.headerText,"message-header",this.util)}CATION_REQUEST_DENIED=1,$.CHAT_SCROLL_DELAY=300,$.WEBSOCKET_READY_STATE=["CONNECTING","OPEN","CLOSING","CLOSED"],$.WEBSOCKET_CLOSE_EVENT={CODE:{ABNORMAL_CLOSURE:1006}},$.ATTACHMENT_HEADER={AUTHORIZATION:"Authorization",FILE_AUTH_TYPE:"x-oda-meta-file-authType",FILE_IS_PROTECTED:"x-oda-meta-file-isProtected",FILE_SIZE:"x-oda-meta-file-size"},$.MAX_SUGGESTIONS_COUNT=5,$.MIN_SUGGESTIONS_COUNT=1,$.SUGGESTIONS_COUNT_THRESHOLD=30,$.TIME={MIN_FIFTY:3e6};const U="22.12",H=1024,j=26214400,W=1e3,G=Ce('<path d="M11.007 15.117A1 1 0 0 0 13 15V7l-.005-.176A3 3 0 0 0 7 7v8l.005.217A5 5 0 0 0 17 15V5h2v10a7 7 0 1 1-14 0V7a5 5 0 0 1 10 0v8l-.005.176A3 3 0 0 1 9 15V9h2v6z"/>'),q=Ce('<path d="M4 2h10.414L20 7.586V10h-2V9h-5V4H6v16h12v-1h2v3H4zm11 3.414L16.586 7H15z"/><path d="m7.764 17 1.849-4.87h1.012L12.486 17H11.32l-.32-.998H9.204L8.882 17zm1.722-1.883h1.226l-.617-1.916zm3.278-.415v-2.573h1.045v2.553c0 .531.079.916.235 1.152.156.233.404.349.744.349.344 0 .591-.116.743-.349.157-.236.235-.62.235-1.152v-2.553h1.045v2.573c0 .822-.165 1.427-.496 1.816-.326.384-.835.576-1.527.576s-1.204-.192-1.535-.576c-.326-.389-.489-.994-.489-1.816zM17.686 17v-4.87h1.635c.795 0 1.396.205 1.802.616.407.41.61 1.018.61 1.822 0 .795-.203 1.4-.61 1.816-.402.41-1.002.616-1.802.616zm1.622-4.02h-.577v3.17h.577c.45 0 .786-.128 1.005-.383.223-.259.335-.659.335-1.2s-.11-.94-.329-1.198c-.218-.26-.556-.389-1.011-.389z"/>'),K=Ce('<path d="M6.35 8L5 9.739 12 16l7-6.261L17.65 8 12 13.054z"/>'),Y=Ce('<path d="M8 17.65L9.739 19 16 12 9.739 5 8 6.35 13.054 12z"/>'),J=Ce('<path d="M16 17.65L14.261 19 8 12l6.261-7L16 6.35 10.946 12z"/>'),Z=Ce('<path d="M6 11h8v2H6zm0-4h12v2H6z"/><path d="M2 2v20h3.5l3-4H14v-2H7.5l-3 4H4V4h16v6h2V2z"/><path d="M20.3 12.3L19 13.6l-1.3-1.3-1.4 1.4 1.3 1.3-1.3 1.3 1.4 1.4 1.3-1.3 1.3 1.3 1.4-1.4-1.3-1.3 1.3-1.3z"/>'),X=Ce('<path d="M17.524 5 19 6.476 13.475 12 19 17.524 17.524 19 12 13.475 6.476 19 5 17.524 10.525 12 5 6.476 6.476 5 12 10.525z"/>'),Q=Ce('<path d="M11 13v9H9v-5.586l-6.293 6.293-1.414-1.414L7.586 15H2v-2zM21.293 1.293l1.414 1.414L16.414 9H22v2h-9V2h2v5.586z"/>'),ee=Ce('<path d="M4 15v5h16v-5h2v7H2v-7zm9-13v10.587l3.293-3.294 1.414 1.414L12 16.414l-5.707-5.707 1.414-1.414L11 12.585V2z"/>'),te=Ce('<path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zM8.707 7.293l8 8-1.414 1.414-8-8z"/></svg>'),ie=Ce('<path class="st0" d="M20 20H4V4h7V2H2v20h20v-9h-2z"/><path xmlns="http://www.w3.org/2000/svg" class="st0" d="M14 2v2h4.6L8.3 14.3l1.4 1.4L20 5.4V10h2V2z"/>'),se=Ce('<path d="M14.414 2 21 8.584V22H3V2.009zM13 3.999l-8 .007v15.995h14V9.996l-6 .001zm4.585 3.998L15 5.413v2.585z"/>'),ne=Ce('<path d="M4 2h10.414L20 7.586V22H4zm2 2v16h12V9h-5V4zm9 1.414L16.586 7H15z"/><path d="M16 12a1 1 0 11-2 0 1 1 0 012 0zm-6.143 1L7 19h10l-2.857-4.5L12 16.75z"/>'),oe=Ce('<path d="M22 5v14H2V5zm-2 2H4v10h16zM7 13v2H5v-2zm12 0v2h-2v-2zm-4 0v2H9v-2zM7 9v2H5V9zm12 0v2h-2V9zm-4 0v2h-2V9zm-4 0v2H9V9z" />'),ae=Ce('<path d="M13 14c-1.5 0-2.9-.4-4-1.1 1.1-2.4 1.7-5 1.9-6.9h9V4H7V2H5v2H2v2h6.9c-.2 1.7-.7 3.7-1.5 5.6C6.5 10.5 6 9.2 6 8H4c0 1.9.9 4 2.5 5.5C5.3 15.5 3.8 17 2 17v2c2.6 0 4.6-1.9 6.1-4.3 1.4.8 3 1.3 4.9 1.3zm7.6 4.6L17 10.5l-3.6 8.1-1.3 3 1.8.8L15 20h4l1.1 2.4 1.8-.8zm-4.7-.6l1.1-2.5 1.1 2.5z"/>'),re='<svg width="36" height="36" viewBox="0 0 36 36"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.875 8.625a2.25 2.25 0 00-2.25 2.25v16c0 .621.504 1.125 1.125 1.125h.284c.298 0 .585-.119.796-.33l2.761-2.76a2.25 2.25 0 011.59-.66h15.944a2.25 2.25 0 002.25-2.25V10.875a2.25 2.25 0 00-2.25-2.25H7.875zM24.75 18a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5zm-4.5-2.25a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-9 2.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" fill="#fff"/></svg>',ce=Ce('<path d="M4.014 3C2.911 3 2 3.888 2 4.992v15c0 .6.408 1.008 1.007 1.008h.6a.887.887 0 0 0 .695-.288l3.094-3.12c.407-.384.91-.6 1.415-.6h11.175C21.089 16.992 22 16.104 22 15V4.992C22 3.888 21.089 3 19.986 3zm3.981 7.008A1.986 1.986 0 0 1 6.005 12c-1.103 0-1.99-.888-1.99-1.992s.887-2.016 1.99-2.016 1.99.912 1.99 2.016zm5.995 0C13.99 11.112 13.103 12 12 12s-1.99-.888-1.99-1.992.887-2.016 1.99-2.016 1.99.912 1.99 2.016zm5.996 0c0 1.104-.888 1.992-1.99 1.992s-1.991-.888-1.991-1.992.887-2.016 1.99-2.016 1.99.912 1.99 2.016z" fill="#fff"/>'),le=Ce('<path d="M7 22v-2h4v-2.062C7.06 17.444 4 14.073 4 10h2c0 3.309 2.691 6 6 6s6-2.691 6-6h2c0 4.072-3.059 7.444-7 7.938V20h4v2h-6zm5-20c2.206 0 4 1.794 4 4v4c0 2.206-1.794 4-4 4s-4-1.794-4-4V6c0-2.206 1.794-4 4-4zm0 2c-1.103 0-2 .897-2 2v4c0 1.103.897 2 2 2s2-.897 2-2V6c0-1.103-.897-2-2-2z"/>'),he=Ce('<path d="M19.33 23.02l-7.332-3.666-7.332 3.666 1.418-7.995L1 9.555l7.331-1.222L11.998 1l3.666 7.333 7.332 1.222-5.084 5.47z"/>'),de=Ce('<path d="M13 22V5.414l5.293 5.293 1.414-1.414L12 1.585 4.293 9.293l1.414 1.414L11 5.414V22h2z" fill="#161513"/>'),pe=Ce('<path d="M22 2v20H2V2zm-2 2H4v16h16zm-3 1.674V14a2 2 0 11-2.15-1.995L15 12V8.326l-5 1.428V16a2 2 0 11-2.15-1.995L8 14V8.246z"/>'),ue=Ce('<path d="M13.414 2L17 5.586V7h.414L21 10.586V22H7v-4H3V2zM17 9.414V18H9v2h10v-8.586zm-2-3L12.586 4H5v12h10zM13 11v2H7v-2zm-2-4v2H7V7z"/>'),ge=Ce('<path d="M12 2c3.874 0 6.994 3.28 6.99 7.214l.011.285c.008.927-.202 2.23-.787 3.837-.96 2.639-2.73 5.452-5.49 8.353L12 22.45l-.724-.761c-2.76-2.901-4.53-5.714-5.49-8.353-.627-1.722-.823-3.095-.782-4.03l.006-.252C5.134 5.147 8.205 2 12 2zm0 2C9.254 4 7.006 6.362 7.002 9.386L7 9.529c-.004.694.168 1.753.667 3.123.741 2.036 2.038 4.221 4.014 6.507l.32.365.32-.365c1.867-2.159 3.127-4.228 3.886-6.166l.128-.34c.535-1.469.694-2.58.664-3.259l-.008-.32C16.879 6.244 14.676 4 12 4zm0 2a3 3 0 1 1-.001 6A3 3 0 0 1 12 6zm0 2a1 1 0 1 0 .001 2A1 1 0 0 0 12 8z"/>'),me=Ce('<path d="M22 2v16h-4v4H2V6h4V2zm-9.036 12.378L6.93 20H16v-2.585zM16 8H4v11.999l9.036-8.377L16 14.585zm4-4H8v2h10v10h2zM7 9a2 2 0 110 4 2 2 0 010-4z"/>'),fe=Ce('<path d="M1.707.293l22 22-1.414 1.414L12 13.414V21l-6.35-5.114H1V7.954h4.65l.5-.39L.293 1.707zM19.67 4.446c2.119 1.967 3.302 4.613 3.33 7.452a10.363 10.363 0 01-1.392 5.295l-1.476-1.476c.58-1.18.88-2.472.868-3.8-.023-2.29-.981-4.43-2.697-6.025zM7.583 8.996l-1.232.955H3v3.964h3.351L10 16.875v-5.461zm8.051-1.68C17.15 8.547 17.991 10.21 18 11.999c.003.482-.055.956-.17 1.416l-1.86-1.86c-.133-1.017-.691-1.964-1.604-2.706zM12 3v4.586L9.424 5.01z"/>'),be=Ce('<path d="M13 3v18l-6.35-5.114H2V7.954h4.65zm5.67 1.446c2.119 1.967 3.302 4.613 3.33 7.452.029 2.904-1.15 5.658-3.316 7.75l-1.396-1.421c1.772-1.71 2.735-3.95 2.712-6.31-.023-2.29-.981-4.43-2.697-6.025zM11 7.125L7.351 9.95H4v3.964h3.351L11 16.875zm4.634.19C17.15 8.548 17.991 10.212 18 12c.01 1.806-.828 3.5-2.358 4.771l-1.284-1.519c1.065-.885 1.65-2.037 1.642-3.242-.006-1.187-.587-2.309-1.634-3.16z"/>'),ve=Ce('<path d="M4 2h10.414L20 7.586V10h-2V9h-5V4H6v16h12v-1h2v3H4zm11 3.414L16.586 7H15z"/><path d="m12.36 17-1.796-4.87h1.18l1.138 3.584 1.153-3.585h1.132L13.37 17zm3.33 0v-4.87h1.046V17zm1.996 0v-4.87h1.635c.795 0 1.396.205 1.802.616.407.41.61 1.018.61 1.822 0 .795-.203 1.4-.61 1.816-.402.41-1.002.616-1.802.616zm1.622-4.02h-.577v3.17h.577c.45 0 .786-.128 1.005-.383.223-.259.335-.659.335-1.2s-.11-.94-.329-1.198c-.218-.26-.556-.389-1.011-.389z"/>'),we=Ce('<path d="M11 11h2v4h-2zm0 6h2v2h-2z"/><path d="M12 1.8L1.9 22h20.2L12 1.8zm0 4.4L18.9 20H5.1L12 6.2z"/>'),xe=Ce('<path d="M11 2a9 9 0 017.032 14.617l3.675 3.676-1.414 1.414-3.676-3.675A9 9 0 1111 2zm0 2a7 7 0 100 14 7 7 0 000-14zm1 3v3h3v2h-3v3h-2v-3H7v-2h3V7z"/>');ar Se=i(24);const ye="aria-expanded",ke="aria-activedescendant",_e="expand",Te=/http/gi,Ie="ODA_MASK_3-2-0",Ae=new RegExp(Ie,"gi"),Ee=/www/gi,Me="ODA_MASK_2-6-1",Le=new RegExp(Me,"gi"),Pe=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gim,De=/([-+&@#/%?=~_|!:,.;])?(\bwww\.[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gim;class Oe{e,t,i=_.LEFT){const s="message",n=this.createDiv([`${s}-block`,"flex",i]),o=this.createDiv([`${s}s-wrapper`]),a=this.createDiv([`${s}-list`,"flex","col"]);if(t){const e=this.createImageIcon({icon:t,iconCss:["message-icon"],title:i===_.LEFT?this.locale.avatarBot:this.locale.avatarUser}),s=this.createDiv(["icon-wrapper"]);s.appendChild(e),n.appendChild(s)}return a.appendChild(e),o.appendChild(a),n.appendChild(o),n}Locale(e){this.locale=e}mbedYouTube(e){return`<div class="${this.cssPrefix}-youtube-wrapper"><iframe width="100%" src="https://www.youtube.com/embed/${e}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`}cusPreviousItem(e){const t=e.getAttribute(ke),i=e.querySelector(`#${t}`);this.popupFocusItem(i.previousSibling||e.lastChild,e)}e,ze,Fe,$e,Ue;!function(e){e.SESSION="sessionStorage",e.LOCAL="localStorage"}(Ne||(Ne={})),function(e){e.CLASSIC="classic",e.DEFAULT="default",e.REDWOOD_DARK="redwood-dark"}(ze||(ze={})),function(e){e.AUDIO="audio",e.FILE="file",e.LOCATION="location",e.VISUAL="visual"}(Fe||(Fe={})),$e||($e={})),Ue||(Ue={}));const He={AUDIO:".aac, .amr, .m4a, .mp3, .mp4a, .mpga, .oga, .ogg, .wav, audio/*",FILE:".7z, .csv, .doc, .docx, .eml, .ics, .key, .log, .msg, .neon, .numbers, .odt, .pages, .pdf, .pps, .ppsx, .ppt, .pptx, .rtf, .txt, .vcf, .xls, .xlsx, .xml, .yml, .yaml, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",IMAGE:".gif, .jfif, .jpeg, .jpg, .png, .svg, .tif, .tiff, .webp, image/*",VIDEO:".3g2, .3gp, .avi, .m4v, .mov, .mp4, .mpeg, .mpg, .ogv, .qt, .webm, .wmv, video/*",ALL:""};He.ALL=`${He.AUDIO},${He.FILE},${He.IMAGE},${He.VIDEO}`;const je=window.setTimeout;class We extends Ve{constructor(e,t,i,n,o,a,r,c,l,h){if(super(),this.util=e,this.onSend=t,this.onUpload=i,this.settings=n,this.onQueryChange=o,this.onSpeechToggle=a,this.onShareLocation=r,this.sendUserTypingStatusMessage=c,this.eventDispatcher=l,this.widget=h,this.mode=void 0,this.fileMaxSize=j,this._navKeys=[],this.isDisabledVoiceButtonLang=!1,this.isDisabledVoiceButtonNetwork=!1,this.recognitionRequested=!1,this.isFocusableDevice=!0,this.isTyping=!1,this.triggerTypingEvent=y((,1e3),this.sendTypingStatus=y((,this.settings.typingStatusInterval*W),this.cssPrefix=n.name,this.i18n=n.i18n,this.icons=n.icons,this.locale=this.i18n[n.locale],this.isFocusableDevice=!(0,Se.isMobile)(),this._shareBtnID=`${this.cssPrefix}-share-button`,this.element=this._createElement(),n.enableSpeech){const e=this._createVoiceComponent();this.element.appendChild(e)}const d=this._createKeyboardComponent();this.element.appendChild(d),this.setInputMode(Ue.KEYBOARD),this.disable(!0),window.addEventListener("resize",S((()=>{this._expand()}),100))}setInputMode(e){e!==this.mode&&(this.settings.enableSpeech?(this.mode=e,this.mode===Ue.KEYBOARD?this._showKeyboardMode():this._showVoiceMode()):(this.mode=Ue.KEYBOARD,this._showKeyboardMode()))}VoiceRecording(e){this.settings.enableSpeech&&(e&&this.recognitionRequested?this.setInputMode(Ue.VOICE):e||this.setInputMode(Ue.KEYBOARD))}updateVisualizer(e,t){this.mode===Ue.VOICE&&(0,Se.drawVisualizer)(e,this._visualizerCanvas,t)}sable(e=!0){const t=this.util,i="disabled";this.settings.enableAttachment&&(this._shareButton.disabled=e),e?(t.addCSSClass(this._textArea,i),this.settings.enableAutocomplete&&(this._invalidateSuggestions(),this._removeSuggestionsPopup())):(t.removeCSSClass(this._textArea,i),this.updateSendButtonDisabledState()),this.settings.enableSpeech&&(this.setInputMode(Ue.KEYBOARD),this.disableVoiceModeButton(e,{src:"network"})),this.isFooterDisabled=e}isDisabled(){return this.isFooterDisabled}tSuggestions(){return this._suggestions}getSuggestionsValid(){return this._isSuggestionsValid}onDisabledState(){const e=this._sendButton;if(e&&e.nodeType){const t=this.util,i="none",s=this._textArea;s&&s.value&&s.value.trim().length&&this.mode!==Ue.VOICE?t.removeCSSClass(this._sendButton,i):t.addCSSClass(e,i)}}InputKeyUp(e){var t;const i=null===(t=this._textArea.value)||void 0===t?void 0:t.trim();if(this.isDisabled())return this._invalidateSuggestions(),void this._removeSuggestionsPopup();if(this.triggerTypingEvent(),this.settings.enableSendTypingStatus&&(i?this.sendTypingStatus(i):this.sendUserTypingStatusMessage("LISTENING")),clearTimeout(this.listeningStatusTimer),this.listeningStatusTimer=je((,this.settings.typingStatusInterval*W),this.updateSendButtonDisabledState(),!e.isComposing&&this.settings.enableAutocomplete){if(this._onNavigateSuggestion(e))return;e.code===Se.KeyCode.Backspace&&(this._previousInputValue=void 0,this._invalidateSuggestions(),this._removeSuggestionsPopup(),clearTimeout(this._suggestionsRequest)),this._getNavKeys().indexOf(e.code)<0&&(i.length>=3?this._previousInputValue!==this._textArea.value&&(this._previousInputValue=this._textArea.value,clearTimeout(this._suggestionsRequest),this._setSuggestionsRequestTimer()):(this._previousInputValue=void 0,this._removeSuggestionsPopup(),clearTimeout(this._suggestionsRequest)))}},t){e.title=t}.SUGGESTIONS_ID="chat_widget_suggestions";ass Qe{ateAttachment(e,t){const i=this.util,s=this.settings,n=i.createDiv(["attachment"]),o=i.createDiv(["attachment-placeholder","flex"]),a=i.createDiv(["attachment-icon"]),r=i.createImageIcon({icon:e,title:""});a.appendChild(r);const c=this._title,l=i.createDiv(["attachment-footer","flex",this.hasActions&&"with-actions"]),h=i.createElement("label",["attachment-title"]),d=i.createDiv(["attachment-controls","flex"]);if(h.innerText=c,h.setAttribute("title",c),l.appendChild(h),this._type===T.b.Image){const e=i.createIconButton({css:["attachment-control-icon","attachment-button","flex"],icon:s.icons.expandImage||xe,iconCss:["attachment-expand-icon"],title:s.i18n[s.locale].imageViewerOpen});e.onclick=d.appendChild(e)}if(this.side===_.LEFT&&d.appendChild(this.createDownloadButton(this._url)),t)switch(o.appendChild(t),t.onerror=this._type){case T.b.Image:t.onload=t.onclick=break;case T.b.Audio:case T.b.Video:t.onloadeddata=else o.appendChild(a),l.appendChild(d);return n.appendChild(o),null==n||n.appendChild(l),n}class et extends Qe{render(){const e=this.util,t=this.settings,i=t.icons.fileAudio||q,s=e.createMedia("video",this._url,["attachment-audio"]);s.controls=!0,s.preload="metadata",_.RIGHT===this.side&&s.setAttribute("controlsList","nodownload");const n=`<a href="${this._url}">`,o=t.i18n[t.locale].attachmentAudioFallback.replace("{0}",n).replace("{/0}","</a>");return s.innerHTML=o,t.linkHandler?g(s,t.linkHandler):t.openLinksInNewWindow&&m(s),this.createAttachment(i,s)}}ass st extends Qe{render(){const e=this.util,t=this.settings,i=t.icons.fileVideo||ve;if(l(this._url)){const i=e.createElement("span");return i.innerHTML=e.linkify(this._url,{emHTML:!0,emVideo:t.embeddedVideo}),i}const s=e.createMedia("video",this._url,["attachment-video"]);s.controls=!0,s.preload="metadata",_.RIGHT===this.side&&s.setAttribute("controlsList","nodownload");const n=`<a href="${this._url}">`,o=t.i18n[t.locale].attachmentVideoFallback.replace("{0}",n).replace("{/0}","</a>");return s.innerHTML=o,this.settings.linkHandler?g(s,t.linkHandler):this.settings.openLinksInNewWindow&&m(s),this.createAttachment(i,s)}}t.tokenRegex=/token=[a-z\.\d]+/i;s lt extends V{etContent(){const e=this.settings,t=this.util,i=t.createDiv();return i.innerHTML=t.linkify(this._text,{emHTML:this.side===_.LEFT,emVideo:!0}),e.linkHandler?g(i,e.linkHandler):e.openLinksInNewWindow&&m(i),super.getContent(i)}}ar dt=i(721);class pt extends V{constructor(e,t,i,s,n,o){super(e,t,i,s,n,o),this._actions=[],this.cssPrefix=e.name,this._options=o,this._payload=i,this._isActionsExternal=!0,this.actions=this.actions.filter((e=>e.getActionType()!==T.a.SubmitForm||(this._submitFormAction=e,!1)))}disableActions(){super.disableActions(),this._actions.forEach((e=>e.disable())),this._submitFormAction&&this._submitFormAction.disable()}disablePostbacks(){super.disablePostbacks(),I(this._actions).forEach((e=>e.disable()))}enableActions(){super.enableActions(),this._actions.forEach((e=>e.enable())),this._submitFormAction&&this._submitFormAction.disable()}enablePostbacks(){super.enablePostbacks(),I(this._actions).forEach((e=>e.enable()))}etHeader(){const e=this.util,t=super.getHeader();return e.addCSSClass(t,"message-header-yellow"),t}ction mt(e,t,i,s,n){const o=`${t}-field`,a=[o,`${o}-col-${s}`],r=i.createDiv(a),c=i.createDiv([`${t}-key`]),l=i.createDiv([`${t}-value`]);if(c.innerText=e.label,e.displayType===T.g.Link){const t=i.createDiv(),s=i.createElement("a",e.linkLabel?[]:["ellipsis"]);s.href=e.value,s.innerText=e.linkLabel||b(e.value)||"",s.setAttribute("target","_blank"),t.appendChild(s),n.linkHandler?g(t,n.linkHandler):n.openLinksInNewWindow&&m(t),l.appendChild(s)}else l.innerText=e.value||"";const h=e.alignment;return h&&(c.style.textAlign=h,l.style.textAlign=h),r.appendChild(c),r.appendChild(l),r}class ft extends pt{etContent(){const e=this._payload,t=this.settings,i=this.util,s="form-message",n=`${s}-item`,o=`${s}-actions-col`,a=i.createDiv([s]),r=i.createDiv([n]);if(e.formColumns>2&&(e.formColumns=1),this.headerText){const e=i.createDiv([`${s}-header`]);e.innerText=this.headerText,a.appendChild(e)}return e.fields.filter((e=>e)).forEach((n=>{(0,T.A)(n.displayType)?r.appendChild(mt(n,s,i,e.formColumns,t)):r.appendChild(this.renderEditableFieldElement(n,s))})),this._actionsDiv=i.createDiv("horizontal"!==t.formActionsLayout?["form-actions","col",o]:["form-actions"]),this._actionsDiv.appendChild(this._submitFormAction.render()),r.appendChild(this._actionsDiv),this._errorElems.length&&this.renderErrorMessage(this._actionsDiv,e.errorMessage||this.translations.editFormErrorMessage,!0),a.appendChild(r),super.getContent(a)}validateForm(){var e;let t=!0;return this._errorElems.forEach((e=>{e.remove()})),this._inputElements.forEach((e=>{const i=e.dataset.error,s=e.tagName.toLowerCase(),n=e.nextElementSibling;let o,a=!0;switch(s){case"select":const t=e;t.checkValidity()||(a=!1,o=i||t.validationMessage);break;case"form":const s=e,n=s.ariaLabel;n===dt.a.MultiSelect&&"true"===s.ariaRequired?s.querySelectorAll("input[type='checkbox']:checked").length||(a=!1,o=i||s.querySelector("input").validationMessage):n!==dt.a.SingleSelect||s.checkValidity()||(a=!1,o=i||s.querySelector("input").validationMessage);break;case"input":const r=e;"checkbox"===r.type||r.checkValidity()||(o=i||r.validationMessage,a=!1);break;case"textarea":const c=e;c.required&&(c.checkValidity()||(o=i||c.validationMessage,a=!1));break;case"div":const l=e;"true"===l.getAttribute("aria-required")&&(o=i,a=!!l.firstElementChild.firstElementChild)}a?(e.parentElement.classList.remove(`${this.cssPrefix}-error`),"SPAN"===(null==n?void 0:n.tagName)&&n.remove()):n&&"SPAN"===n.tagName||this.renderErrorMessage(e,o),t=t&&a})),t?null===(e=this._errorElems[0])||void 0===e||e.remove():this.renderErrorMessage(this._actionsDiv,this.translations.editFormErrorMessage,!0),t}enderEditableFieldElement(e,t){var i,s,n;const o=this.util,a=`${t}-field`,r=[a,`${a}-col-1`,`edit-${a}`],c=o.createDiv(r),l=o.createDiv([`${t}-key`,"with-margin"]),{id:h,displayType:d,placeholder:p,required:u,clientErrorMessage:g,serverErrorMessage:m,autoSubmit:f}=e;let b,v;switch(l.innerText=e.label,c.appendChild(l),d){case dt.a.SingleSelect:const a=e;if(v=a.defaultValue,v&&(this._submittedFields[h]=v),"radioGroup"===a.layoutStyle){const e=o.createElement("form",[`${t}-value`,"form-container","col"]);o.setAttributes(e,{id:h,ariaLabel:d,errorMsg:g}),a.options.forEach((t=>{const i=o.createInputElement({type:"radio",name:h,value:t.label,required:u,checked:t.value===v},["radio-input"]);i.onchange=()=>{i.checked&&(this._submittedFields[h]=t.value),this.partialSubmit(h,f)};const s=o.createElement("label");s.innerText=t.label,s.prepend(i),e.appendChild(s)})),this._inputElements.push(e),c.appendChild(e),this.renderErrorMessage(e,m)}else{const e=o.createElement("select",[`${t}-value`]),i=o.createElement("option"),s={};o.setAttributes(e,{id:h,required:u,errorMsg:g}),e.style.backgroundImage=`url("data:image/svg+xml;utf8,${encodeURI(K)}")`,i.hidden=!0,i.label=p,e.appendChild(i),a.options.forEach((),e.onchange=()=>{this._submittedFields[h]=s[e.value],this.partialSubmit(h,f)},this._inputElements.push(e),c.appendChild(e),this.renderErrorMessage(e,m)}break;case dt.a.MultiSelect:const r=e;if(v=r.defaultValue,this._submittedFields[h]=v||[],"checkboxes"===r.layoutStyle){const e=o.createElement("form",[`${t}-value`,"form-container","col"]);o.setAttributes(e,{id:h,ariaLabel:d,errorMsg:g,ariaRequired:u?"true":""}),r.options.forEach((t=>{const i=o.createInputElement({type:"checkbox",name:h,value:t.label,checked:null==v?void 0:v.includes(t.value),required:u},["radio-input"]),s=o.createElement("label");s.innerText=t.label,s.prepend(i),i.onchange=()=>{if(i.checked)this._submittedFields[h].push(t.value);else{const e=this._submittedFields[h];e.splice(e.indexOf(t.value),1)}this.partialSubmit(h,f)},e.appendChild(s)})),this._inputElements.push(e),c.appendChild(e),this.renderErrorMessage(e,m)}else{const e=o.createDiv([`${t}-value`,"text-field-container"]),i=o.createElement("ul",["selected-options"]),s=o.createElement("ul",["popup","multi-select-list"]);e.setAttribute("aria-expanded","false"),e.onclick=e.setAttribute("aria-required",u?"true":""),e.setAttribute("data-error",g),r.options.forEach((t=>{const n=a=o.createListItem(t.label,t.label,t.label,"","",(i=>{let a=i.target;"LI"!==a.tagName&&(a=a.parentElement),e.removeAttribute("aria-expanded"),o.removeCSSClass(s,"expand"),s.removeChild(a),this._submittedFields[h].push(t.value),n(a),this.partialSubmit(h,f)}));a.onkeydown=(null==v?void 0:v.includes(t.value))?n(a):s.appendChild(a)})),e.appendChild(i),this._inputElements.push(e),c.appendChild(e),c.appendChild(s),this.renderErrorMessage(e,m)}break;case dt.a.Toggle:const l=e,w=o.createElement("label",[`${t}-value`,"toggle"]);b=o.createInputElement({id:h,placeholder:p,required:u,type:"checkbox",checked:l.defaultValue===l.valueOn,errorMsg:g,valueOn:l.valueOn,valueOff:l.valueOff});const x=l.labelOn||l.valueOn,C=l.labelOff||l.valueOff;b.setAttribute("aria-label",b.checked?x:C),this.renderErrorMessage(b.parentElement,m),b.oninput=()=>{b.setAttribute("aria-label",b.checked?x:C),this.partialSubmit(h,f)},w.appendChild(b),w.appendChild(o.createDiv(["round-slider"])),c.appendChild(w);break;case dt.a.DatePicker:const S=e;b=o.createInputElement({type:"date",id:h,placeholder:p,required:u,defaultValue:S.defaultValue,min:S.minDate,max:S.maxDate,errorMsg:g},[`${t}-value`]);break;case dt.a.TimePicker:const y=e;b=o.createInputElement({type:"time",id:h,placeholder:p,required:u,defaultValue:y.defaultValue,min:y.minTime,max:y.maxTime,errorMsg:g},[`${t}-value`]);break;case dt.a.TextInput:const k=e;if(k.multiLine){const e=o.createElement("textarea",[`${t}-value`]);o.setAttributes(e,{id:h,required:u,minLength:k.minLength,maxLength:k.maxLength,defaultValue:k.defaultValue,placeholder:k.placeholder,errorMsg:g}),e.oninput=()=>{e.style.height="auto",e.style.height=`${e.scrollHeight}px`,this.partialSubmit(h,f)},c.appendChild(e),this._inputElements.push(e),this.renderErrorMessage(e,m)}else b=o.createInputElement({type:k.inputStyle||"text",id:h,placeholder:p,required:u,defaultValue:k.defaultValue,errorMsg:g,minLength:k.minLength,maxLength:k.maxLength,pattern:k.validationRegularExpression},[`${t}-value`]);break;case dt.a.NumberInput:const _=e;b=o.createInputElement({type:"number",id:h,placeholder:p,required:u,defaultValue:null===(i=_.defaultValue)||void 0===i?void 0:i.toString(),min:null===(s=_.minValue)||void 0===s?void 0:s.toString(),max:null===(n=_.maxValue)||void 0===n?void 0:n.toString(),errorMsg:g},[`${t}-value`])}return b&&("checkbox"!==b.type&&(c.appendChild(b),this.renderErrorMessage(b,m),f&&(b.oninput=),this._inputElements.push(b)),c}artialSubmit(e,t){t&&this._submitFormAction.getEventPayload().then((t=>{const i=(0,T.o)(Object.assign(Object.assign({},t),{submittedFields:this.getSubmittedFields(),partialSubmitField:e,type:T.i.FormSubmission}));this._options.webCore.sendMessage(i,{sdkMetadata:{version:U}}).then(()}))}const bt=100;class vt extends pt{getContent(){const e=this.util,t=this._payload,i=xt(t.headings),s="table-message",n=e.createDiv([`${s}-wrapper`]),o=e.createElement("table",[s]);n.appendChild(o);const a=e.createElement("tr",[`${s}-headings`]);return i.forEach((t=>{const i=wt(e,[`${s}-heading`],t.width,t.alignment);i.innerText=t.label,a.appendChild(i)})),o.appendChild(a),t.rows.forEach((t=>{const n=e.createElement("tr",[`${s}-row`]);t.fields.forEach(((t,o)=>{const a=wt(e,[`${s}-item`],i[o].width,t.alignment);if("link"===t.displayType){const i=t,s=e.createDiv(),n=e.createElement("a",i.linkLabel?[]:["ellipsis"]);n.href=t.value,n.innerText=i.linkLabel||b(t.value)||"",n.setAttribute("target","_blank"),s.appendChild(n),this.settings.linkHandler?g(s,this.settings.linkHandler):this.settings.openLinksInNewWindow&&m(s),a.appendChild(n)}else a.innerText=t.value||"";n.appendChild(a)})),o.appendChild(n)})),super.getContent(n)}}ss St extends pt{getContent(){const e=this.util,t=this._payload;t.headings.push({alignment:"center",label:""});const i=xt(t.headings),s="table-message",n=e.createDiv([`${s}-wrapper`]),o=e.createElement("table",[s,"tableform-message"]);n.appendChild(o);const a=e.createElement("tr",[`${s}-headings`]);return i.forEach((),o.appendChild(a),a.lastElementChild.style.width="32px",t.rows.forEach(((n,a)=>{const r=e.createElement("tr",[`${s}-row`]);n.fields.forEach(((t,n)=>{const o=wt(e,[`${s}-item`],i[n].width,t.alignment);if("link"===t.displayType){const i=t,s=e.createElement("a",i.linkLabel?[]:["ellipsis"]);s.href=t.value,s.innerText=i.linkLabel||b(t.value)||"",o.appendChild(s)}else o.innerText=t.value||"";r.appendChild(o)})),t.formColumns>2&&(t.formColumns=2);const c=t.forms[a],l=wt(e,[`${s}-item`,"button-cell"]),h=e.createIconButton({css:[`${s}-item`,`${s}-item-form-toggle`],icon:K,iconCss:[],title:c.title||""});l.appendChild(h),r.appendChild(l);const d="none",p="rotate-180",[u,g]=gt(e,c,t.formColumns,this.settings,this.handleOnActionClick.bind(this),this._options);this._actions=this._actions.concat(g),e.addCSSClass(u,d);let m=!1;r.onclick=o.appendChild(r),o.appendChild(u)})),super.getContent(n)}}ass _t{static fromMessage(e,t,i,s){let n,o;yt(i)?(n=_.LEFT,o=i.source||T.l.Bot):(n=_.RIGHT,i.messagePayload.type===T.i.Postback&&(i=(0,T.o)({text:i.messagePayload.text,type:T.i.Text})));const a=i.messagePayload;switch(a.type){case T.i.Text:return a.channelExtensions&&"stars"===a.channelExtensions.displayType?new ht(e,t,a,n,o,s):new lt(e,t,a,n,o,s);case T.i.Attachment:return new nt(e,t,a,n,o,s);case T.i.Card:return new at(e,t,a,n,o,s);case T.i.Location:return new rt(e,t,a,n,o,s);case T.i.Table:return new vt(e,t,a,n,o,s);case T.i.Form:return new ut(e,t,a,n,o,s);case T.i.TableForm:return new St(e,t,a,n,o,s);case T.i.EditForm:return new ft(e,t,a,n,o,s);case T.i.Raw:return new ct(e,t,a,n,o,s);default:throw Error(`Wrong message payload type:${a.type}`)}}}lass It{ender(){const e=this.util,t=this.settings.icons,i=e.createDiv(["attachment"]),s=this.side===_.LEFT?t.avatarBot:t.avatarUser,n=e.createDiv(["attachment-footer","flex"]),o=e.createDiv(["attachment-title"]);o.innerText=this.text,n.appendChild(o);const a=e.createDiv(["attachment-placeholder","flex"]);return a.appendChild(new Tt(e).render()),i.appendChild(a),i.appendChild(n),this._element=e.getMessageBlock(this.side,i,s),this._element}class At{ender(e){const t=this.util,i=this.settings.icons,s="message",n=t.createDiv([`${s}-content`]),o=this.side===_.LEFT?i.avatarBot:i.avatarUser;if(e){t.addCSSClass(n,`${s}-with-icon`);const i=t.createImageIcon({icon:e,title:""}),o=t.createDiv([`${s}-icon`]);o.appendChild(i),n.appendChild(o)}const a=t.createDiv([`${s}-text`]),r=t.createDiv([`${s}-title`]),c=t.createDiv([`${s}-description`]);return r.innerText=this.title,c.innerText=this.text,a.appendChild(r),a.appendChild(c),n.appendChild(a),t.getMessageBlock(this.side,n,o,this.isError)}}onst Mt=["no-referrer","no-referrer-when-downgrade","origin","origin-when-cross-origin","same-origin","strict-origin","strict-origin-when-cross-origin","unsafe-url"],Lt=["allow-downloads-without-user-activation","allow-downloads","allow-forms","allow-modals","allow-orientation-lock","allow-pointer-lock","allow-popups","allow-popups-to-escape-sandbox","allow-presentation","allow-same-origin","allow-scripts","allow-storage-access-by-user-activation","allow-top-navigation","allow-top-navigation-by-user-activation"],Pt="none",Dt="webview-container",Ot=`${Dt}-open`,Rt=`${Dt}-close`;onst Vt=window.setTimeout,Nt=window.setInterval,zt=36e5,Ft=864e5,$t="relTimeNow",Ut="relTimeMoment",Ht="relTimeMin",jt="relTimeHr"; Jt=window.BroadcastChannel,Zt="collapsed",Xt="expanded",Qt="none",ei=window.setTimeout;class ti extends Ve{constructor(e,t,i,s,n,o,a,r,c,l,h,d){var p,u;super(),this.settings=e,this.util=t,this.connect=i,this.openChat=s,this.closeChat=n,this.handleSessionEnd=o,this.receivedMessage=a,this.sentMessage=r,this.getUnreadMessagesCount=c,this.onConnectionStatusChange=l,this._core=h,this._eventDispatcher=d,this.FINAL_RESULT_DISPLAY_TIMEOUT=200,this._logger=new R("ChatComponent"),this._attachmentDivs=[],this._unreadMsgCount=0,this._latestSkillMessages=[],this._skillMessages=[],this._isNewMessage=!0,this.isTTSMute=!0,this.isInitMessageSent=!1,this.isExpanded=!1,this.isFirstMessage=!0,this.isResponseReceived=!1,this.messageIDs=[],this.cssPrefix=e.name,this.currentLocale=e.locale,this._localeText=e.i18n[e.locale],this.isOpen=!1,this.isExpanded="init"===(null===(p=e.initMessageOptions)||void 0===p?void 0:p.sendAt)||e.openChatOnLoad||e.embedded,this.isInitMessageSent=e.enableHeadless,this._isFirstConnect=!0,this.enableDefaultBotResponse=this.settings.enableDefaultClientResponse,this._configureStorage(),this.lastMessageHasGlobalAction=!1;const g=this.storageService.getItem(this._userAvatarStorageId);if(g&&(e.icons.avatarUser=g),this.settings.enableEndConversation){const e=this._localeText;this.endConversationPrompt=t.getBanner({text:e.endConversationConfirmMessage||"",description:e.endConversationDescription||"",actions:[{label:e.noText,handler:this.closePrompt},{label:e.yesText,handler:this.endConversation,type:"filled"}]},this),t.addCSSClass(this.endConversationPrompt,"end-conversation-prompt")}this.settings.enableTabsSync||(this._initBroadcaster=()=>{}),this._core.on(T.f.Open,(),this._core.on(T.f.State,(e=>this._onChatServerStatusChange(e))),this._core.on(T.f.MessageReceived,(),this.element=this._createElement(),this.settings.enableBotAudioResponse&&(this.isTTSMute=this.settings.initBotAudioMuted),this.settings.multiLangChat&&this._initMultiLangChat(),"function"!=typeof l&&(this.onConnectionStatusChange=()=>{}),this.settings.showTypingIndicator&&(this.typingIndicator=new Et(_.LEFT,e,t)),!this.settings.enableTimestamp||"relative"!==this.settings.timestampMode&&"default"!==this.settings.timestampMode?(this.setTimestampHeaderIfNewDate=()=>{},this.updateRelativeTimestamp=()=>{}):this.relativeTimestamp=new Wt(e,t),"action"!==(null===(u=this.settings.focusOnNewMessage)||void 0===u?void 0:u.toLowerCase())&&(this.focusMessageFirstAction=;const m=this.storageService.getItem(this._agentNameStorageId);m&&(this.agentSession=JSON.parse(m),this.setAgentTypingCue())}tMessage(e){this.footer.setUserInputText(e)}setUserInputPlaceholder(e){this.footer.setUserInputPlaceholder(e)}getWebViewComponent(){return this.webViewComponent}nMessageActionClicked(e){switch(this.onSpeechToggle(!1),e.type){case T.a.Postback:this._scrollToBottom(),e.getPayload().then(();break;case T.a.Location:this._shareUserLocation();break;case T.a.Share:navigator.share?e.getPayload().then((t=>{navigator.share({text:t,title:e.label}).then((()=>this._disablePastActions([e.messageComponent])))})):this._showBanner(this._localeText.shareFailureMessage);break;case T.a.SubmitForm:const t=e.messageComponent;if(!t.validateForm())break;this._scrollToBottom(),e.getPayload().then(()}}applyDelegates(e){var t;const i=[T.i.Text,T.i.Location,T.i.Attachment,T.i.FormSubmission];let s;return s="string"==typeof e?(0,T.p)(e,null===(t=this.speechFinalResult)||void 0===t?void 0:t.speechId):(0,T.z)(e)?(0,T.m)(e):(0,T.y)(e)?(0,T.o)(e):e,i.indexOf(s.messagePayload.type)>=0&&this.settings.delegate.beforeSend&&(0,Se.isFunction)(this.settings.delegate.beforeSend)?s=this._executeSendDelegate(s,this.settings.delegate.beforeSend):s.messagePayload.type===T.i.Postback&&this.settings.delegate.beforePostbackSend&&(0,Se.isFunction)(this.settings.delegate.beforePostbackSend)&&(s=this._executeSendDelegate(s,this.settings.delegate.beforePostbackSend)),s}ploadFile(e,t){const i=this._localeText;this._ttsCancel(),this._onSendMessage();const s=new Promise(((s,n)=>{var o,a;if(this.settings.enableHeadless)this._core.uploadAttachment(e,{sdkMetadata:{version:U}}).then((e=>this._core.sendMessage(this.settings.delegate?this.applyDelegates(e):e,{sdkMetadata:{version:U}}))).then((e=>{s(e)})).catch(();else{this._scrollToBottom();const r=`${null===(o=e.name)||void 0===o?void 0:o.replace(/[\s:'"\\/[\]~,.;^`()@#%*+=$&!{}?<>|]/g,"")}${Math.floor(1e4+9e4*Math.random())}${Date.now()%1e5}`,c=this.util.createDiv();c.id=r,this._attachmentDivs.push({divId:r,fileName:e.name}),this.setTimestampHeaderIfNewDate(new Date),this._appendMessageToConversation(c);const l=t?t.maxSize:j;if(e.size>l){this._scrollToBottom();const t=l/1048576;let s=t.toString();"number"==typeof(a=t)&&isFinite(a)&&Math.floor(a)===a||(s=t.toFixed(3));const o=`${e.name} - ${i.uploadFailed}`,c=i.uploadFileSizeLimitExceeded.replace("{0}",s);this._displayUploadError(o,c,r),this.updateRelativeTimestamp(T.k.User),n(new Error(c))}else if(0===e.size){this._scrollToBottom();const t=`${e.name} - ${i.uploadFailed}`,s=i.uploadFileSizeZeroByte;this._displayUploadError(t,s,r),this.updateRelativeTimestamp(T.k.User),n(new Error(s))}else{const t=new It(e.name,_.RIGHT,this.settings,this.util);this.updateRelativeTimestamp(T.k.User),c.appendChild(t.render()),this._scrollToBottom(),this._core.uploadAttachment(e,{sdkMetadata:{version:U}}).then(().then(().catch(()}}}));return s.catch((),s}tUnreadMsgsCount(){return this._unreadMsgCount}tAgentDetails(){return this.agentSession}aveMessage(e){const t=this.getMessages();t.length>=this.settings.messageCacheSizeLimit&&t.splice(0,t.length-(this.settings.messageCacheSizeLimit-1));let i=JSON.stringify(e).substring(1,JSON.stringify(e).length-1);i=`{${i}, "date":"${new Date}"}`,t.push(JSON.parse(i)),this.storageService.setItem(this._chatStorageId,JSON.stringify(t))}ge(e,t){var i;const s=this.util.wrapMessageBlock(t.render(),this.settings.icons.avatarBot,_.LEFT);s.id=e,this._conversationContainer.appendChild(s),(null===(i=this.typingIndicator)||void 0===i?void 0:i.isVisible())&&this.hideTypingIndicator()}serLocation(){const e=this._localeText;if(navigator&&navigator.geolocation){const t=new It(e.requestLocation,_.RIGHT,this.settings,this.util);this._appendMessageToConversation(t.render()),this._scrollToBottom(),(0,T.q)().then((,()}else this._showBanner(e.requestLocationDeniedUnavailable)}splayUploadError(e,t,i){const s=new At(e,t,_.RIGHT,this.settings,this.util,!0),n=document.getElementById(i);n.firstElementChild&&n.removeChild(n.firstElementChild),this._attachmentDivs=this._attachmentDivs.filter(();const o=this.settings.icons.error||te;n.appendChild(s.render(o))}sages(e,t){const i=this.util,s={locale:this.currentLocale,webviewLinkHandler:this.webviewLinkHandler,webCore:this._core};(null==t?void 0:t.length)&&(s.authToken=t,s.uri=this.settings.URI),e.forEach((e=>{var t,n,o,a,r,c;const l=yt(e)?T.k.Skill:T.k.User,h=this.shouldMergeMessages(e,l);let d;this.lastMessageSenderType=l,this.lastMessageTime=Date.now(),this.lastMessageHasGlobalAction=e.messagePayload.globalActions&&0!==e.messagePayload.globalActions.length,this.lastMessageSenderName=(null===(n=null===(t=e.messagePayload.channelExtensions)||void 0===t?void 0:t.agentSession)||void 0===n?void 0:n.name)||"",yt(e)&&(this.lastMessageSenderSource=e.source),h||(d=i.createDiv(["message-block","flex"]),this.lastMessageBlock=d);const p=_t.fromMessage(this.settings,this.util,e,s);if(p.onActionClick=this.onMessageActionClicked.bind(this),void 0!==p.ratingId&&(this.pendingFeedback=p),yt(e)){this._isNewMessage?this._onReceiveMessage(p):this._skillMessages.push(p);const t=kt(e);if(this.messageIDs.indexOf(t)>=0)return;this.messageIDs.push(t),e.source===T.l.Agent?((null===(o=e.messagePayload.channelExtensions)||void 0===o?void 0:o.agentName)&&this.setAgentDetails({name:e.messagePayload.channelExtensions.agentName,avatarImage:this.settings.icons.avatarAgent,nameTextColor:null,avatarTextColor:null,avatarBackgroundColor:null}),(null===(a=e.messagePayload.channelExtensions)||void 0===a?void 0:a.agentSession)&&this.setAgentDetails(e.messagePayload.channelExtensions.agentSession)):(this.storageService.removeItem(this._agentNameStorageId),this.agentSession=null),this.focusMessageFirstAction(p)}else if(this.pendingFeedback){const t=e;if(t.messagePayload.type===T.i.Text||t.messagePayload.type===T.i.Postback){const e=t.messagePayload;this.pendingFeedback.highlightRating(e.text)}this.pendingFeedback=null}this.setTimestampHeaderIfNewDate(e.date||new Date),d&&(this.createMessageBlock(e,d),this._appendMessageToConversation(d));const u=this.lastMessageBlock.querySelector('[class*="message-list"]'),g=this._renderMessage(e,p,u);if(g){if(e.messagePayload.type===T.i.Card){const e=u.querySelectorAll('[class*="message-bubble"]');e.length&&e[e.length-1].classList.add(`${this.cssPrefix}-before-card`)}e.messagePayload.type===T.i.EditForm&&(null===(r=e.messagePayload.channelExtensions)||void 0===r?void 0:r.replaceMessage)&&u.lastElementChild?null===(c=u.lastElementChild)||void 0===c||c.replaceWith(g):u.appendChild(g)}this.updateRelativeTimestamp(l)}))}shouldMergeMessages(e,t){var i,s,n,o,a;const r=null===(i=e.messagePayload.channelExtensions)||void 0===i?void 0:i.replaceMessage;if((!0===r||r&&"true"===(null===(s=r)||void 0===s?void 0:s.toLowerCase()))&&(null===(n=this.lastMessageBlock)||void 0===n?void 0:n.className.includes(`${this.cssPrefix}-left`)))return!0;if(!(Date.now()-this.lastMessageTime<1e4))return!1;if(yt(e)&&e.source===T.l.Agent&&(null===(o=e.messagePayload.channelExtensions)||void 0===o?void 0:o.agentSession)){const t=null===(a=e.messagePayload.channelExtensions)||void 0===a?void 0:a.agentSession;return this.lastMessageSenderName===t.name}return!(this.lastMessageSenderType!==t||yt(e)&&e.source!==this.lastMessageSenderSource||this.lastMessageHasGlobalAction)}createMessageBlock(e,t){const i=this.settings.icons,s=this._localeText,n=this.util;let o,a,r;if(yt(e)){if(e.source===T.l.Agent?(o=this.agentSession.name&&this.getAgentNameDiv(e,t),a=i.avatarBot&&(this.agentSession.avatarImage||!this.agentSession.name)&&(this.agentSession.avatarImage||i.avatarBot),r=s.agentMessage.replace("{0}",`${this.agentSession.name||s.agent}`)):(this.settings.showTypingIndicator&&(this.typingIndicator.remove(),this.typingIndicator=new Et(_.LEFT,this.settings,this.util)),a=i.avatarBot,r=s.skillMessage),n.addCSSClass(t,"left"),a){const i=this.getAvatar(a,e.source===T.l.Agent&&s.avatarAgent||s.avatarBot);i.style.marginTop=e.source===T.l.Agent&&this.agentSession.name&&"16px",t.appendChild(i)}}else n.addCSSClass(t,"right"),r=s.userMessage,i.avatarUser&&t.appendChild(this.getAvatar(i.avatarUser,s.avatarUser));const c=n.createDiv(["messages-wrapper","flex","col"]);o&&c.appendChild(o);const l=this.util.createElement("span",["screen-reader-only"]);l.innerText=r,c.appendChild(l);const h=n.createDiv(["message-list","flex","col"]);if(c.appendChild(h),this.settings.enableTimestamp&&"absolute"===this.settings.timestampMode){const e=this.getTime();c.appendChild(e)}t.appendChild(c)}n(){("none"===this.settings.disablePastActions?this._skillMessages:this._latestSkillMessages).forEach((e=>{e.enablePostbacks()}))}ent(e){this._saveMessage(e),this._scrollToBottom(),e&&(this._broadcast(e),e.messagePayload&&[T.i.Suggest,T.i.SessionClosed,T.i.CloseSession,T.i.Status].indexOf(e.messagePayload.type)<0&&(this.isOpen||this.updateNotificationBadge(++this._unreadMsgCount),this._renderMessagesAndScroll([e])))}sCancel(){this._core.cancelTTS()}},49:24:function(e,t,i){ar n,o,a;i.r(t),i.d(t,{AuthError:function(){return a},AuthTokenService:function(){return l},Deferred:function(){return f},JWT:function(){return r},KeyCode:function(){return n},ShareCategory:function(){return o},buildURL:function(){return Z},drawVisualizer:function(){return J},formatDate:function(){return Y},generateEventDispatcher:function(){return s},getLongPollURL:function(){return Q},getWebSocketURL:function(){return X},isAndroid:function(){return G},isApple:function(){return q},isFunction:function(){return W},isMobile:function(){return K},isSameDay:function(){return ee},startTimer:function(){return H},supportedLang:function(){return j}}),n||(n={})),function(e){e.Audio="audio",e.File="file",e.Location="location",e.Visual="visual"}(o||(o={})),function(e){e.AuthExpiredToken="AuthExpiredToken",e.AuthNoToken="AuthNoToken",e.AuthNoChannelId="AuthNochannelId",e.AuthNoUserId="AuthNouserId",e.AuthNoExp="AuthNoexp",e.AuthNoIat="AuthNoiat",e.AuthInvalidChannelId="AuthInvalidchannelId",e.AuthInvalidUserId="AuthInvaliduserId",e.AuthInvalidExp="AuthInvalidexp",e.AuthInvalidIat="AuthInvalidiat",e.AuthEmptyChannelIdClaim="AuthInvalidchannelId",e.AuthEmptyUserIdClaim="AuthInvaliduserId",e.AuthNegativeExp="AuthNegativeexp",e.AuthNegativeIat="AuthNegativeiat",e.AuthExpLessThanIat="AuthExpLessThanIat"}(a||(a={}));onst c=Promise;onst h="string",d="number",p="exp";b=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|Z|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,v=/\[([^]*?)\]/gm;ar x=ar S=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],y=["January","February","March","April","May","June","July","August","September","October","November","December"],k=w(y,3),_={dayNamesShort:w(S,3),dayNames:S,monthNamesShort:k,monthNames:y,amPm:["am","pm"],DoFn:,T=C({},_),I=A={D:function(e){return String(e.getDate())},DD:function(e){return I(e.getDate())},Do:d:function(e){return String(e.getDay())},dd:function(e){return I(e.getDay())},ddd:function(e,t){return t.dayNamesShort[e.getDay()]},dddd:function(e,t){return t.dayNames[e.getDay()]},M:function(e){return String(e.getMonth()+1)},MM:MMM:function(e,t){return t.monthNamesShort[e.getMonth()]},MMMM:YY:YYYY:function(e){return I(e.getFullYear(),4)},h:function(e){return String(e.getHours()%12||12)},hh:H:function(e){return String(e.getHours())},HH:function(e){return I(e.getHours())},m:function(e){return String(e.getMinutes())},mm:function(e){return I(e.getMinutes())},s:function(e){return String(e.getSeconds())},ss:S:SS:SSS:a:A:ZZ:Z:,E=(x("monthNamesShort"),x("monthNames"),{default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",isoDate:"YYYY-MM-DD",isoDateTime:"YYYY-MM-DDTHH:mm:ssZ",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"}),M=const L=window.setInterval,P=window.setTimeout,D=36e5,O=864e5;let R;const B=V=N=(e,t)=>{V(e,t,60,6e4,"relTimeMin",z)},z=(e,t)=>{V(e,t,24,D,"relTimeHr",F)},F=$=U=H=j={ar:"العربية",de:"Deutsch",en:"English",es:"Español",fr:"Français",it:"Italiano",nl:"Nederlands",bt:"Português",hi:"instanceof Function,G=()=>/Android/i.test(navavhats===s.ionsERSIONo.eumersOwn_esModule",{value:!0})};var s=i(424);return s=s.default}()},"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("WebSDK",[],factory):"object"==typeof exports?exports.WebSDK=factory():e.WebSDK=factory();self.WebSDK=factory();