nction e(t,n,r,o){return void 0===n&&(n=500),void 0===r&&(r=4),new Promise(function(c,a){t()?c(0):0!==r?setTimeout(function(){o&&o()&&a("condition rejected "+i(function(){return t.toString()})),e(t,n,r-1).then(c).catch(a)},n):a("condition rejected "+i(function(){return t.toString()}))})}function r(t){return i(function(){return t.toString()},"")}function i(t,n){void 0===n&&(n=void 0);try{return t()}catch(t){return n}}function o(t,n,e){void 0===n&&(n=5),void 0===e&&(e=500),n>=0&&!i(t)&&setTimeout(function(){i(t)||o(t,n-1)},e)}function c(){window.loomi_ctx=window.loomi_ctx||{}}function a(t){window.loomi_ctx.tagIds=window.loomi_ctx.tagIds||new Set,t.forEach(,window.loomi_ctx.gtags=window.loomi_ctx.gtags||[]}var u,s,l,f,d={DEBUG:{name:"DEBUG",severity:10},INFO:{name:"INFO",severity:100},WARN:{name:"WARN",severity:1e3},ERROR:{name:"ERROR",severity:1e4},NONE:{name:"NONE",severity:1e4}};function p(){return u||(t=i(?d.WARN:d.NONE,n={minLogLevel:t},Object.values(d).forEach(function(e){var r=e.name,i=e.severity;n[r.toLowerCase()]=function(){var n=[].slice.call(arguments);if(i>=t.severity&&n.length>0&&"NONE"!=t.name){var e,o=n[0],c=n.splice(1),a="[VSLY-"+r+"] "+o;if("DEBUG"===r||"INFO"===r)(e=console).log.apply(e,[a].concat(c));else if("WARN"===r){var u;(u=console).warn.apply(u,[a].concat(c))}else{var s;(s=console).error.apply(s,[a].concat(c))}}}}),u=n);var t,n}!function(t){t.JSCondition="jsCondition",t.JSFunction="jsFunction",t.JSEvent="jsEvent",t.Selector="selector",t.ElementEvent="elementEvent",t.PageLoad="pageLoad",t.Timeout="timeout",t.ExitIntent="exitIntent",t.Conjunction="conjunction"}(s||(s={})),l||(l={})),f||(f={}));var m="lmi_preview";function h(t){return i(function(){return window.visually.flags[t]},!1)}var v=/*#__PURE__*/function(){eturn t.prototype.withScript=function(t){var n=this;return function(e,r){if(!h("kill-logs")&&(n.env===f.PROD||n.env===f.STAGE)){r&&p().error(t,r,e);var i={userId:t+"_"+n.version+"_"+n.storeAlias+"_"+n.anonymousUserId,message:e+" host: "+location.hostname+" path: "+location.pathname};return fetch("https://logs.loomi-"+(n.env==f.STAGE?"stg":"prod")+".xyz/6087fbd0-8017-4c6b-bb36-67c2efdf2a57/logs",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json; charset=UTF-8"}})}}},t}(),g=function(t){for(var n=t||window.location.search.substring(1),e={},r=("?"===n[0]?n.substr(1):n).split("&"),i=0;i<r.length;i++){var o=r[i].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]||"")}return e},w={utm_source:"source",utm_medium:"medium",utm_campaign:"campaign",utm_term:"term",utm_content:"content"},_=function(t){var n={utm:{}};for(var e in t)if(t.hasOwnProperty(e)){var r=w[e];r&&(n.utm[r]=t[e])}return n};function y(t,n){void 0===n&&(n=20);var e=0;return function(){var r=arguments;clearTimeout(e),e=setTimeout(function(){return t.apply(void 0,[].slice.call(r))},n)}}var P=function(t,n){void 0===n&&(n=8397271938200529);for(var e,r=3735928559^n,i=1103547991^n,o=0;o<t.length;o++)e=t.charCodeAt(o),r=Math.imul(r^e,2654435761),i=Math.imul(i^e,1597334677);return r=Math.imul(r^r>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),""+(4294967296*(2097151&(i=Math.imul(i^i>>>16,2246822507)^Math.imul(r^r>>>13,3266489909)))+(r>>>0))},S="lmi_utm_data";function I(){var t,n,e,r,o=(t=function(t){if(t))return null;var n={};return t.campaign&&(n.campaign=t.campaign),t.medium&&(n.medium=t.medium),t.source&&(n.source=t.source),t.term&&(n.term=t.term),t.content&&(n.content=t.content),n}(i(function(){return _(g()).utm})),n=[],null!=(e=localStorage.getItem(S))&&(n=[].concat(JSON.parse(e)).slice(0,20)),t&&(t.ts=new Date,n=[t].concat(n)),r=n,localStorage.setItem(S,JSON.stringify(r)),r);return i(function(){return o.filter(function(t){return t.campaign}).reduce(o[0]).campaign})||""}var k="vsly_session";function E(){var t=O();t.last_interaction=new Date,C(t)}function O(){var t=window.loomi_ctx.session||i(function(){var t=JSON.parse(localStorage.getItem(k));return t.last_interaction=new Date(t.last_interaction),t.start_at=new Date(t.start_at),t})||A();return function(t){var n=new Date,e=t.last_interaction;return(n.valueOf()-e.valueOf())/6e4>30||I()!==t.utm_campaign||t.last_interaction.getDate()!==n.getDate()}(t)&&(t=A()),window.loomi_ctx.session=t,t}function A(){var t={id:P(window.loomi_ctx.storeAlias+window.loomi_ctx.userId+(new Date).valueOf()+I()),utm_campaign:I(),last_interaction:new Date,start_at:new Date};return C(t),t}function C(t){var n=JSON.stringify(t);localStorage.setItem(k,n),window.loomi_ctx.session=t}function T(t,e){if(!t&&!e)return!0;if(!t&&e)return!1;if(t&&!e)return!1;var r=Object.keys(t).sort(function(t,n){return t.localeCompare(n)}),i=Object.keys(e).sort(;if(r.length!==i.length)return!1;for(var o,c=r);!(o=c()).done;){var a=o.value,u=t[a],s=e[a],l=N(u)&&N(s);if(l&&!T(u,s)||!l&&u!==s)return!1}return!0}ar b="lmi_type",x="lmi_from",R="lmi_class";function j(t){return i(function(){return[R,x,b].includes(t)})}var D,L,U=G={utm_source:"source",utm_medium:"medium",utm_campaign:"campaign",utm_term:"term",utm_content:"content"},M={gclid:!0,fbclid:!0,dclid:!0};!L||(L={}));var q=new Map;ar H,F=B=/*#__PURE__*/function(){ar n=t.prototype;return n.save=function(t){var n,e,r,i;n=this.cookieName,e=encodeURIComponent(JSON.stringify(t)),r=this.cookieDomain,i="http:"!==document.location.protocol,document.cookie=encodeURIComponent(n)+"="+e+"; path=/; expires=Fri, 31 Dec 9999 23:59:59 GMT"+(r?"; domain="+r:"")+(i?"; secure":"")},n.restore=function(){var t,n=(t=this.cookieName)&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;if(n)try{var e=JSON.parse(decodeURIComponent(n));if("object"!=typeof e)return;return e}catch(t){return}},n.delete=function(){},t}(),z=/*#__PURE__*/function(){ar n=t.prototype;return n.save=n.restore=function(){},n.delete=function(){},t}(),V=/*#__PURE__*/function(){function n(){this.userIdPersistence=void 0,this.propsPersistance=void 0,this.anonymousId="",this.userProperties={},this.permanentProperties={globalProps:{},propsPerEvent:{}},this.cookieDomain="",this.trackingHost="",this.idCookieName="",this.randomizeUrl=!1,this.apiKey="",this.initialized=!1,this._3pCookies={},this.initialOptions=void 0,this.cookiePolicy="keep",this.ipPolicy="keep",this.runningUseCases=new Set,this.getAnalyticsCtx=var e=n.prototype;return e.id=function(n,e){return this.userProperties=t({},this.userProperties,n),this.userIdPersistence&&this.userIdPersistence.save(n),e?Promise.resolve():this.track("user_identify",{})},e.makeEvent=function(n,e,c){var a;this.restoreId();var u,s=this.getCtx(),l=(u="vsly_edgetag",o(function(){return F()&&localStorage.setItem(u,F()),!0}),i(F)||localStorage.getItem(u));l&&(s.edgetag=l);var f=t({},this.permanentProperties.globalProps,null!=(a=this.permanentProperties.propsPerEvent[n])?a:{}),d=t({api_key:this.apiKey,src:e,event_type:n},c);return s=function(t,n){try{Object.keys(t).forEach(function(t){if(i(&&t.toUpperCase()===t){var e=i(function(){return t.split("_").map(},[""]);switch(e.length){case 1:i(&&delete n[e[0]];break;case 2:i(&&delete n[e[0]][e[1]];break;case 3:i(function(){return n[e[0]][e[1]][e[2]]})&&delete n[e[0]][e[1]][e[2]];break;case 4:i(function(){return n[e[0]][e[1]][e[2]][e[3]]})&&delete n[e[0]][e[1]][e[2]][e[3]]}}})}catch(e){p().error("vsly err code 666:"+r(n)+":"+r(t))}return n}(c,s),t({},f,s,d)},e.sendJson=function(t){var n="keep"!==this.cookiePolicy?"&cookie_policy="+this.cookiePolicy:"",e="keep"!==this.ipPolicy?"&ip_policy="+this.ipPolicy:"",r=this.trackingHost+"/api/v1/event?token="+this.apiKey+n+e;return this.randomizeUrl&&(r=this.trackingHost+"/api."+U()+"?p_"+U()+"="+this.apiKey+n+e),navigator.sendBeacon(r,new Blob([JSON.stringify(t)],{type:"text/plain"})),Promise.resolve()},e.getCtx=function(){var n,e,r=this,o=new Date;return t({event_id:"",user:t({anonymous_id:this.anonymousId},this.userProperties),ids:this._getIds(),user_agent:navigator.userAgent,utc_time:(n=o.toISOString(),e=n.split(".")[1],e?e.length>=7?n:n.slice(0,-1)+"0".repeat(7-e.length)+"Z":n),local_tz_offset:o.getTimezoneOffset(),referer:document.referrer,url:window.location.href,page_title:document.title,doc_path:document.location.pathname,doc_host:document.location.hostname,doc_search:window.location.search,screen_resolution:window.screen.width+"x"+window.screen.height,user_language:navigator.language,doc_encoding:document.characterSet,alias:window.loomi_ctx.storeAlias,sid:i(function(){return window.loomi_ctx.session.id}),sid_start:i(},i({}),function(){var t=window.Shopify;if(!t)return{};if(!i(function(){return t.checkout}))return{};var n=t.checkout,e={customer_id:i(function(){return n.customer_id.toString()})};return i(function(){return n.order_id})&&(e.order_id=i(function(){return n.order_id.toString()}),e.order_created_at=i(function(){return n.created_at.toString()})),e}(),function(t){var n={utm:{},click_id:{},lmi_params:{}};for(var e in t)if(t.hasOwnProperty(e)){var r=t[e],i=G[e];i?n.utm[i]=r:M[e]?n.click_id[e]=r:j(e)&&(n.lmi_params[e]=decodeURIComponent(r))}return n}(function(t){for(var n=window.location.search.substring(1),e={},r=("?"===n[0]?n.substr(1):n).split("&"),i=0;i<r.length;i++){var o=r[i].split("="),c=decodeURIComponent(o[1]||"");c.endsWith("\\")&&(c=c.replace(/.$/,"")),e[decodeURIComponent(o[0])]=c}return e}()))},e._getIds=function(){for(var t=function(t){if(void 0===t&&(t=!1),t&&D)return D;for(var n={},e=document.cookie.split(";"),r=0;r<e.length;r++){var i=e[r],o=i.indexOf("=");o>0&&(n[i.substr(r>0?1:0,r>0?o-1:o)]=i.substr(o+1))}return D=n,n}(!1),n={},e=0,r=Object.entries(t);e<r.length;e++){var i=r[e],o=i[0],c=i[1];this._3pCookies[o]&&(n["_"==o.charAt(0)?o.substr(1):o]=c)}return n},e.track=function(t,n,e){try{var r=this;if(r.skipTracking())return Promise.resolve();t===L.USE_CASE&&function(t){h("kill-ga")||i(||function(t){try{return c(),a(function(){for(var t=document.getElementsByTagName("script"),n=[],e=0;e<t.length;e++)try{var r=t[e];r.src.includes("www.googletagmanager.com/gtag/js")&&n.push(new URL(r.src).searchParams.get("id"))}catch(t){}return n}()),window.loomi_ctx.gtags=[].concat(window.loomi_ctx.gtags,[function(n){var e=J(t.gaName),r=J(t.gaVariant),o=""+n+e+r;q.get(o)||(window.gtag&&q.set(o,!0),i(function(){window.gtag("event","VISUALLY",{EXPERIENCE:e,VARIANT:r,non_interaction:!0,send_to:n})}))}]),i(&&window.loomi_ctx.tagIds.add("G-D5DRR8JQ64"),window.loomi_ctx.tagIds.forEach(,Promise.resolve()}catch(t){return Promise.reject(t)}}(t).catch()}(e),i(E);var o=r.makeEvent(t,"jitsu",n||{});return Promise.resolve(r.sendJson(o).catch()}catch(o){return Promise.reject(o)}},e.skipTracking=function(){var t=this;return i(function(){return"test"===t.apiKey||"UNDEROUTFIT"===window.loomi_ctx.storeAlias&&window.location.pathname.endsWith("the-comfort-shaping-bra-rp")})},e.init=function(t){var n=this;if(this.ipPolicy="keep",this.getAnalyticsCtx=t.analyticsContext,t.ip_policy&&(this.ipPolicy=t.ip_policy),t.cookie_policy&&(this.cookiePolicy=t.cookie_policy),"strict"===t.privacy_policy&&(this.ipPolicy="strict",this.cookiePolicy="strict"),"comply"===this.cookiePolicy&&(this.cookiePolicy="strict"),this.initialOptions=t,t.key){if(this.cookieDomain=t.cookie_domain||document.location.hostname.replace("www.",""),this.trackingHost=function(t){for(;(n=t).includes("/",n.length-1);)t=t.substr(0,t.length-1);var n;return 0===t.indexOf("https://")||0===t.indexOf("http://")?t:"//"+t}(t.tracking_host||"t.jitsu.com"),this.randomizeUrl=t.randomize_url||!1,this.idCookieName=t.cookie_name||"__eventn_id",this.apiKey=t.key,this.propsPersistance="strict"===this.cookiePolicy?new z:new B(this.cookieDomain,this.idCookieName+"_props"),this.userIdPersistence="strict"===this.cookiePolicy?new z:new B(this.cookieDomain,this.idCookieName+"_usr"),this.propsPersistance){var e,r,o=this.propsPersistance.restore();o&&(this.permanentProperties=o,this.permanentProperties.globalProps=null!=(e=o.globalProps)?e:{},this.permanentProperties.propsPerEvent=null!=(r=o.propsPerEvent)?r:{}),p().debug("",this.permanentProperties)}!1===t.capture_3rd_party_cookies?this._3pCookies={}:(t.capture_3rd_party_cookies||["_ga","_fbp","_ym_uid","ajs_user_id","ajs_anonymous_id"]).forEach(,"strict"!==this.cookiePolicy&&(this.anonymousId="TANAOR_IL"===window.loomi_ctx.storeAlias?i(:window.loomi_ctx.userId),this.initialized=!0}},e.restoreId=function(){if(this.userIdPersistence){var n=this.userIdPersistence.restore();n&&(this.userProperties=t({},n,this.userProperties))}},e.set=function(n,e){var r=i(function(){return e.eventType}),o=i(function(){return e.persist});if(void 0!==r){var c,a=null!=(c=this.permanentProperties.propsPerEvent[r])?c:{};this.permanentProperties.propsPerEvent[r]=t({},a,n)}else this.permanentProperties.globalProps=t({},this.permanentProperties.globalProps,n);this.propsPersistance&&o&&this.propsPersistance.save(this.permanentProperties)},e.unset=function(t,n){var e=i(function(){return n.eventType}),r=i(function(){return n.persist});e?this.permanentProperties.propsPerEvent[e]&&delete this.permanentProperties.propsPerEvent[e][t]:delete this.permanentProperties.globalProps[t],this.propsPersistance&&r&&this.propsPersistance.save(this.permanentProperties)},e.register=e.getRunningUseCases=e.setAnalyticsContext=n}();function W(t){switch(t){case f.PROD:return{trackingHost:"jitsu-api.loomi-prod.xyz"};case f.STAGE:case f.LOCAL:return{trackingHost:"jitsu-api.loomi-stg.xyz"};case f.TEST:return{trackingHost:"http://localhost:8088"}}}!H||(H={}));var $=y(function(t,n){var e=function(t,n){var e=new Event("targeting-changed");return e.key=t,e.value=n,e}(t,n);document.dispatchEvent(e),console.debug("Targeting has changed:",e)},80);unction X(){return e(function(){return i(},100,100)}function K(){if(i(){var n=localStorage.getItem(Q);if(n)try{window.loomi_ctx=t({},window.loomi_ctx||{},{cart:JSON.parse(n)})}catch(t){p().error("failed parsing cart",n)}}return i(function(){return window.loomi_ctx.cart})}var Q="loomi-cart";function Z(t){var n=i(function(){return t.data.cartLinesAdd.cart}),e=i(function(){return t.data.cartLinesUpdate.cart}),r=i(;return function(t){if(void 0!==t)return i(function(){return{item_count:t.totalQuantity,token:t.id.replace("gid://shopify/Cart/",""),total_price:parseFloat(t.cost.totalAmount.amount),currency:t.cost.totalAmount.currencyCode,note:t.note,attributes:t.attributes,items:t.lines.edges.map(function(t){var n=t.node,e=n.merchandise;return{id:n.id,quantity:n.quantity,variant_id:parseInt(e.id.replace("gid://shopify/ProductVariant/","")),handle:e.product.handle,product_id:parseInt(e.product.id.replace("gid://shopify/Product/","")),price:i(function(){return parseFloat(e.priceV2.amount)},i()}})}})}(i(function(){return t.data.cart})||n||e||r)}var tt=function(t){(function(t,n){try{return!T(t,n)&&void 0!==n}catch(t){return!0}})(K(),t)&&(!0===i(function(){return window.visually.flags["sdk-enable-cart-enrichment"]},!1)?function(t){try{var n=function(){return Promise.resolve(t)};if(i()return Promise.resolve(t);var e=function(n,e){try{var r=(o=i([]).map(function(t){return{name:t,oneOf:{productInfo:{handle:t,includeCollections:!0,includeTags:!0}}}}),Promise.resolve(window.loomi_api.allocatorQuery({queries:o})).then(function(n){t.items=t.items.map(function(t){return t.tags=i(function(){return n.results[t.handle].tags},[]),t.collections=i([]),t})}))}catch(t){return e(t)}var o;return r&&r.then?r.then(void 0,e):r}(0,function(n){!function(){var t;(window.location.search.includes("lmi_debug")||i()&&(t=console).error.apply(t,["loomi-editor"].concat([].slice.call(arguments)))}("failed to enrich cart with error",n,t)});return Promise.resolve(e&&e.then?e.then(n):n())}catch(t){return Promise.reject(t)}}(t).then(function(t){at(t),Y(H.CART_CHANGE,i(function(){return window.loomi_ctx.cart}))}):(at(t),Y(H.CART_CHANGE,i()))},nt=y(tt,400),et=function(t){!0===i(!1)?nt(t):tt(t)};function rt(t,n){st(t)&&et(t),it(n)&&et(Z(t)),i(&&pt()}ar ot=function(t,n,e){var r="";return!!it(t)&&(r=function(t){var n="";return"object"==typeof t?n=i(:"string"==typeof t&&(n=t.toLowerCase()),n}(n),!!e.find()},ct="loomi-cart-history";function at(n){(function(t){try{var n=function(t){return i(function(){return t.items.map(function(t){return{price:t.price,variant_id:""+t.variant_id,product_id:""+t.product_id,quantity:t.quantity,timestamp:(new Date).toISOString()}})},[])}(t);e=function(t){var n=K(),e=i(function(){return n.items.map(function(t){return""+t.variant_id})},[]),r=JSON.parse(localStorage.getItem(ct)||"[]"),o=i(function(){return r.map(});return i(function(){return t.forEach(function(t){var n=o.indexOf(""+t.variant_id),i=e.includes(""+t.variant_id),c=n<0;c?r=[t].concat(r):i||c||(r[n]=t)})}),r}(n),localStorage.setItem(ct,JSON.stringify(e.slice(0,25)))}catch(t){p().error("handleCartItemsHistory",t)}var e})(n),localStorage.setItem(Q,JSON.stringify(n)),window.loomi_ctx=t({},window.loomi_ctx||{},{cart:n})}function ut(t){var n=".myshopify.com";return window.location.hostname==i(||i(||t===i(function(){return window.loomi_ctx.storeAlias.toLowerCase().replace("_","-")+n})}function st(t){return i(function(){return void 0!==t.items})&&i(function(){return void 0!==t.total_price})&&i(}unction ft(t){var n={},e=function(t){return i(function(){return decodeURIComponent(t).split("&").find(function(t){return"quantity"===t.split("=")[0]}).split("=")[1]})||i(function(){return dt(t).quantity.toString()})}(t),r=function(t){return i(function(){return decodeURIComponent(t).split("&").find(.split("=")[1].split(":")[0]})||i(}(t);return r&&!lt(r)||(r="0"),lt(e)||(n.qty=e),lt(r)||(n.variantId=r),n}function dt(t){try{return i(function(){return JSON.parse(t).items[0]})}catch(t){return}}function pt(){i(||fetch("/cart.json?vsly=t").then(function(){return i(}).catch()}function mt(){var t=window.ShopifyAnalytics;if(!t)return{};try{var n=function(t){return i(function(){return t.lib.integrations})}(t),e=function(t){return i(function(){return t.meta.product})}(t),r=function(t,n){var e=i(function(){return t.meta.selectedVariantId},"0");return gt(e)&&vt(n,e)||(e=function(){try{return new URL("http://"+window.location.pathname+window.location.search).searchParams.get("variant")}catch(t){return p().info("vsly-e: 444"),""}}()),gt(e)||(e=i(),function(t){var n=Number(t),e=isNaN(n)?Number((""+t).replace(/[^\d.]+/g,""))||void 0:n;if(void 0!==e)return""+e}(e)}(t,e),c=vt(e,r),a={uniqToken:wt(n),cartId:ht(t)};return function(t){return i(}(t)&&(a.page={pageType:_t(t)}),i(function(){return!!e.id})&&(a.product={id:i(function(){return e.id.toString()}),vendor:i(function(){return e.vendor.toString()}),type:i(function(){return e.type.toString()})}),r&&(a.variant={id:r,price:i(function(){return c.price})}),void 0!==window.__st&&window.__st.cid&&(a.clientId=(o(function(){var t=new Function(document.querySelector('script[id="__st"]').textContent+";return __st.cid.toString()")();return window.localStorage.setItem("vsly__st",t),!0}),i(||window.localStorage.getItem("vsly__st"))),a}catch(t){return p().error("vsly-e 555",t),{}}}function ht(t){var n=i(function(){return t.lib.config.initialDocumentCookie}),e=/cart=(.*?);/.exec(n);return i(function(){return e[1]})}function vt(t,n){return i(function(){return t.variants.find(})}function gt(t){return("string"==typeof t||"number"==typeof t)&&""!==t&&0!==t}function wt(t){return i(function(){return t.find(.defaultAttributes.uniqToken})}function _t(t){return i(function(){return t.meta.page.pageType.toString()})}var yt=!1;function Pt(t){var n=t&&"function"==typeof i(function(){return t.indexOf})&&0==t.indexOf("/")?window.location.origin+t:t,e=n.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),r=e&&e[1]||"";return{domain:r,path:n.replace("https://","").replace(r,"").replace("http://","")}}var St=[],It="loomi:isLoggedIn",kt="loomi_session_products";function Et(n){localStorage.setItem(kt,JSON.stringify(n)),window.loomi_ctx=t({},window.loomi_ctx||{},{sessionProducts:n})}var Ot="loomi_purchased_products",At=HTMLFormElement.prototype.submit,Ct=(new Date).getTime(),Tt=function(){return function(){try{return Promise.resolve(e(function(){return!!i(function(){return window.loomi.jitsu})},500,120)).then(function(){return i(function(){return window.loomi.jitsu})})}catch(t){return Promise.reject(t)}}().then(function(){return window.loomi.jitsu.track(L.SIGNUP,{PAGE_LOAD_ID:"i"+Ct})})};function Nt(t,n,e,r,o,c){"POST"===n&&(ut(t)?e)&&Tt():function(t){var n=i(;return!!n&&n.pathname.endsWith("api/public/v1/point_redemptions")}(e)&&document.dispatchEvent(new CustomEvent("vsly:loyalty-changed")))}HTMLFormElement.prototype.submit=function(){var t=this;try{var n=this.getAttribute("action"),e=this.getAttribute("method");"/account"===n&&"post"===e?Tt().then(:At.call(this)}catch(t){At.call(this)}},window.vslyIntegrationType="static";var bt={initialize:function(n,o,u){try{return void 0===u&&(u=f.PROD),Promise.resolve(function(s,l){try{var d=(function(){try{var t=arguments;return h("kill-proxy")||(function(){if(!yt){var t=navigator.sendBeacon;navigator.sendBeacon=function(n,e){try{var r=new URL(n);if("analytics.google.com"===r.hostname){var i=r.searchParams.get("tid");i&&(c(),a([]),window.loomi_ctx.tagIds.add(i),window.loomi_ctx.gtags&&window.loomi_ctx.gtags.map(function(t){return t(i)}))}}catch(t){}return t.call(this,n,e)},yt=!0}}(),[].slice.call(t).forEach(function(t){(function(t){try{return Promise.resolve(e(function(){return!!window.XMLHttpRequest})).then(function(){if(window.XMLHttpRequest&&(!1===(o=!!(r=navigator.userAgent.toLowerCase()).includes("msie")&&parseInt(r.split("msie")[1]))||o>9)){var n=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(){return this.reqBody=arguments[0],n.apply(this,arguments)};var e=XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){var n=arguments,r=this;e.apply(this,arguments);try{var o=Pt(arguments[1]),c=o.domain,a=o.path,u=i(function(){return n[0]}),s=i(function(){return n[1]});this.requestDetails={method:u,url:s,domain:c,path:a},i(function(){return r.addEventListener("load",function(){var n=this,e=this.requestDetails,r=e.method,o=e.domain,c=e.path,a=i({});t(o,r||"GET",c,this.reqBody,a,"xhr")})})}catch(t){}}}var r,o})}catch(t){return Promise.reject(t)}})(t).catch(),function(t){try{return Promise.resolve(e().then(function(){if(window.fetch){var n=window.fetch;window.fetch=function(){var e=arguments,r=arguments[0],o=i(||{};return n.call(this,r,o).then(function(n){try{if("string"!=typeof r)return n;var e,c=Pt(r),a=c.domain,u=c.path;try{e=JSON.parse(i(function(){return o.body}))}catch(t){e=i(function(){return o.body})}n.clone().text().then(function(n){var r=i(function(){return JSON.parse(n)},n);t(a,i(function(){return o.method},"GET"),u,e,r,"fetch")}).catch()}catch(t){}return n})}}})}catch(t){return Promise.reject(t)}}(t).catch()})),Promise.resolve()}catch(t){return Promise.reject(t)}}(function(t,n,e,r,o,c){if(ut(t)){var a=i(function(){return n.toUpperCase()});if("POST"===a){if(function(t,n){return t.match(/^\/cart\/add.*/)||t.match(/cart\/add\.(js|json)$/)||!!i(}(e,r))X().then(,rt(o,e);else if(function(t,n){return t.match(/^\/cart\/change.*/)||t.match(/^\/cart\/update.*/)&&!t.includes("vsly=t")||t.match(/cart\/(change|update)\.(js|json)$/)||!!i(function(){return ot(t,n,["cartlinesupdate","cartlinesremove","cartlineupdate","cartattributesupdate"])})}(e,r)){var u=ft(r),s=function(t){if(i(function(){return!t.qty})||i(function(){return!t.variantId}))return null;var n=i(function(){return K().items.find(.quantity});if(!n)return L.CHANGE_QTY;var e=parseInt(t.qty);return 0===e?L.REMOVE_FROM_CART:e===n?null:e>n?L.ADD_TO_CART:L.REMOVE_FROM_CART}(u);s&&X().then(,rt(o,e)}it(e)&&et(Z(o))}else"GET"!==a&&a||e)&&o&&st(o)&&et(o)}},Nt).then(),Promise.resolve(function(){try{return Promise.resolve(e(function(){return!!i(function(){return!!window.loomi_ctx.userId})},500,101)).then(}catch(t){return Promise.reject(t)}}()).then(function(){if(!h("kill-switch")&&!h("kill-tracking"))return Promise.resolve(function(t,n){void 0===t&&(t=100),void 0===n&&(n=100);try{return Promise.resolve(e(function(){return void 0!==window.ShopifyAnalytics},t,n)).then(}catch(t){return Promise.reject(t)}}(100,100)).then(function(){var e=mt(),c=function(n,e){return function(n,e,r){return o={key:n,tracking_host:W(e).trackingHost,analyticsContext:function(){return t({},mt(),{userCanBeTracked:i(function(){return window.Shopify.customerPrivacy.userCanBeTracked()},!1),userDataCanBeSold:i(function(){return window.Shopify.customerPrivacy.userDataCanBeSold()},!1)})}},(c=new V).init(o),c;var o,c}(n,e)}(n,u);return function(n,e,r){var o=function(t,n){return new v(t,"0.8.160",n,i(function(){return window.loomi_ctx.userId}))}(e,r);i(O),window.loomi=t({},window.loomi||{},{jitsu:n,reportAnalyticsErr:i(function(){return o.withScript("loomi-analytics-sdk")}),reportSdkErr:i(function(){return o.withScript("loomi-sdk")})})}(c,u,o),function(t){(function(){try{return!!i(function(){return i(function(){return new URL(window.location.href).searchParams.get(m)})||sessionStorage.getItem(m)})}catch(t){return p().error("failed getting lmi_preview for preview"),!1}})()&&function(t){i(function(){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.appendChild(document.createTextNode("#preview-bar-iframe { display: none;}")),t.appendChild(n)});var n=t===f.STAGE?"stg":"prod";p().info("loading preview widget for",n);var e=document.createElement("script");e.type="text/javascript",e.src="https://sdk.loomi-"+n+".xyz/preview-widget.js";var r=document.getElementsByTagName("script")[0];i(}(t)}(u),function(t){St.forEach(clearTimeout),St=[],[{s:0,e:10},{s:11,e:30},{s:31,e:60},{s:61,e:180},{s:181,e:600},{s:601,e:1800},{s:1800,e:1e4}].forEach(function(n){St.push(setTimeout(1e3*n.s))})}(c),function(t){var n,e=localStorage.getItem(It)||"";"undefined"!=typeof __st&&i(function(){return!!__st.cid})&&(n=__st.cid),localStorage.setItem(It,r(n)),(e||n)&&e!=n&&(!e&&n?t.track(L.LOGIN):e&&!n&&t.track(L.LOGOUT,{clientId:e}))}(c),function(t){var n=i(function(){return t.product}),e=i(function(){return t.variant});if(e||n){var r=localStorage.getItem(kt),o=function(t,n){return{productId:parseInt(i(function(){return t.id})||"0"),variantId:parseInt(i(function(){return n.id})||"0"),handle:i(||"",price:i(function(){return n.price})||0,vendor:i(function(){return t.vendor})||""}}(n,e);if(r){var c=JSON.parse(r);(c=c.filter(function(t){return!((n=t).variantId==(e=o).variantId&&n.productId==e.productId);var n,e})).push(o),c.length>20&&c.shift(),Et(c)}else Et([o])}}(e),function(t){try{if(i()return;var n=JSON.parse(localStorage.getItem(Ot)||"[]"),e=!1;n=i(function(){return n.map(function(n){return i(?(e=!0,t):n})}),e||(n=[t].concat(n)),localStorage.setItem(Ot,JSON.stringify(n.slice(0,25)))}catch(t){p().error("failed persisting line items",t)}}(function(){var t=window.Shopify;if(!i(function(){return t.checkout}))return{line_items:[]};var n=t.checkout;return{line_items:i(function(){return n.line_items.map(function(t){return{variant_id:i(function(){return t.variant_id.toString()}),product_id:i(function(){return t.product_id.toString()}),price:parseFloat(t.price)||0,quantity:t.quantity}})},[]),order_id:i(function(){return n.order_id.toString()}),created_at:i(function(){return n.created_at.toString()})}}()),function(t,n){if(sessionStorage){var e=i(function(){return new URLSearchParams(n||window.location.search)});if(e){var r=i(function(){return e.get("vsly-redirected-from")});if(r){var o=i(;o&&t.track(o.type,o.payload,o.options)}}}}(c,location.search),Promise.resolve(c.track(L.PAGE_LOAD)).then(})}))}catch(t){return l(t)}return d&&d.then?d.then(void 0,l):d}(0,function(t){p().error("vsly","init failed",t),i(function(){return window.loomi.reportAnalyticsErr("init analytics:"+function(t){return r(t)+" stack: "+i(function(){return t.stack},"")}(t)+" , alias: "+o)})}))}catch(t){return Promise.reject(t)}}};export{bt as sdk};
