"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9682],{2612:function(e,t,i){i.d(t,{r:function(){return EmptyList}});var s=i(52322),r=i(83122);let EmptyList=t.Z=,23093:function(e,t,i){i.d(t,{W:function(){return PresentButton},Z:function(){return OfflineBar}});var s=i(52322),r=i(2784),n=i(99219),o=i(83122),l=i(57289),a=i(29119),u=i(5632),d=i(56958);function OfflineBar(e){let{projectId:t}=e,[i,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&a.w.project.findFirst({where:t}).then(},[t]);let c=(0,r.useCallback)(()=>{d.A.promise((0,l.W3)(a.w,t).then(async()=>{let e=await a.w.project.findFirst({where:t});u(!!e)}),{loading:"Downloading...",success:"Downloaded!",error:"Error downloading"})},[t]);return(0,s.jsxs)("div",{className:(0,o.AK)("hidden","pwa:flex items-center justify-between rounded-md border bg-white px-4 py-3"),children:[(0,s.jsxs)("div",{className:"grid gap-1.5",children:[(0,s.jsxs)("div",{className:"flex items-center text-sm font-medium text-gray-700",children:[(0,s.jsx)(n.wQA,{className:"mr-1 h-3.5 w-3.5"}),"Offline version"]}),(0,s.jsx)("div",{className:"flex text-sm text-gray-500",children:i?"Version available":"No downloaded versions"})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsx)("button",{onClick:c,className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Download"}),(0,s.jsx)(PresentButton,{projectId:t,disabled:!i})]})})]})}function PresentButton(e){let{handlePresent:t,projectId:i,disabled:r}=e,n=(0,u.useRouter)();return(0,s.jsx)("button",{disabled:r,onClick:()=>{if(t){t(i);return}n.push({pathname:"/launchpad/present/offline/[id]",query:{id:i}})},className:"duration-70 flex items-center justify-between rounded-md border border-[#455CAD] bg-[#455CAD] px-3 py-1 text-sm text-white transition-all hover:bg-[#4258a6] focus:border-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-300 disabled:cursor-not-allowed disabled:opacity-75",children:"Present"})}},99260:function(e,t,i){i.d(t,{Z:function(){return OfflineDemoList}});var s=i(52322),r=i(2784),n=i(2612),o=i(99219),l=i(49323),a=i(29119),u=i(23093);let d=[{Header:"Name",width:"100%",Cell:e=>{let{cell:{row:{original:{name:t}}}}=e;return(0,s.jsx)("div",{className:"flex items-center text-gray-900",children:t})}},{Header:"",accessor:"id",Cell:e=>{let{cell:{value:t},handlePresent:i}=e;return(0,s.jsx)(u.W,{projectId:t,handlePresent:i})}}],Empty=()=>(0,s.jsx)(n.r,{title:"No existing downloads",description:"Downloaded demos can be used offline",icon:(0,s.jsx)(o.ReH,{className:"mx-auto h-6 w-6 text-gray-300"})});function OfflineDemoList(e){let{handlePresent:t}=e,[i,n]=(0,r.useState)(null),[o,u]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{a.w.project.findMany().then(},[]),(0,s.jsx)(l.Z,{columns:d,cellProps:{handlePresent:t},data:i||[],loading:o,Empty:Empty})}},57289:function(e,t,i){i.d(t,{W3:function(){return syncProject}});var s=i(47330),r=i(24065),n=i(61543),o=i(81332),l=i(47147),a=i(73750),u=i(81525),d=i(3583),c=i(83615),p=i(20851);async function syncStaticResource(e,t,i,s){if(t.startsWith("data:"))return;let n=(0,r.m1)(t);if(n){let o=await (0,r.M2)(e,t,i,s);if(!o)return;let l=(0,a.C)(o);if(!l)return;let{mime:u,base64:d}=l;if(!u.startsWith("text/css"))return;let c=d?atob(l.body):l.body,p=(0,r.d1)(i,{staticResourceId:n});await (0,r.$_)(e,c,p);return}let o=await (0,r.Cz)(t,s);if(!o)return;let l=(0,a.C)(o);if(!l)return o;let{mime:u,base64:d}=l;if(!u.startsWith("text/css"))return o;let c=d?atob(l.body):l.body,p=c;return await (0,r.Cf)(c,async(t,s)=>{let n=s[0].includes("@import"),o=(0,r.m1)(t),l=o?(0,r.d1)(i,{staticResourceId:o}):i,a=await syncStaticResource(e,t,l,n?"text/css":void 0);a&&(p=p.replace(t,a))}),"data:text/css;base64,".concat(btoa(p))}async function syncWebCapture(e,t,i){let{id:s,published:n}=t,o=(null==n?void 0:n.captureVersionId)||(null==n?void 0:n.id);if(o&&i.allWebCaptureVersions[o])return;i.allWebCaptureVersions[o]=!0;let l={id:o,webCaptureId:s,node:await (0,r.rT)({id:o})};if(!l.node){console.error("Capture ".concat(o," not found"));return}let a=(0,r.d1)(i,{webCaptureVersionId:o});return a.webCaptureVersionToStaticResources[o]=[],await (0,u.hv)(l.node,[(0,r.Or)({filter:c.hK,operation:(0,r.rw)(e,a)}),(0,r.tZ)({filter:r.u4,operation:(0,r.GR)(e,a)}),(0,r.tZ)({filter:r.If,operation:(0,r.Xw)(e,a)}),(0,r.tZ)({filter:r.aI,operation:(0,r.kC)(e,a)}),(0,r.tZ)({filter:r.Yn,operation:(0,r.dv)(e,a)}),(0,r.tZ)({filter:r.wq,operation:(0,r.oB)(e,a)}),(0,r.tZ)({filter:r.FU,operation:(0,r.EA)(e,a)}),(0,r.tZ)({filter:r.TE,operation:(0,r.hQ)(e,a)})],!0),a.guideToWebCaptureVersions[i.guideId].push(o),await e.webCaptureVersion.upsert({data:l})}async function syncWebCaptures(e,t,i){return await Promise.all(t.map(t=>syncWebCapture(e,t,i)))}async function syncMediaCapture(e,t,i){if(i.allScreenshotCaptures[t.id])return;i.allScreenshotCaptures[t.id]=!0;let{deviceScreenshot:s,deviceTemplate:n,...l}=t,a={...l,deviceScreenshot:s,deviceTemplate:void 0};if(s&&(a.deviceScreenshot=await (0,r.Cz)(s)),n){let e=o.Ak.find(;if(null==e?void 0:e.image){let t=(0,o.Gc)(e),i=await (0,r.Cz)(t);i&&(a.deviceTemplate={...e,image:i})}}return i.guideToScreenshotCaptures[i.guideId].push(t.id),await e.screenshotCapture.upsert({data:a})}async function syncMediaCaptures(e,t,i){return await Promise.all(t.map()}async function syncFlow(e,t,i){if(i.allGuides[t.id])return;if(i.allGuides[t.id]=!0,!("published"in t)){let e=await (0,r.sj)(t.id);if(!e){console.error("Flow ".concat(t.id," not found"));return}e.guide&&(e.published=e.guide),t=e}let n=t,o=(0,r.d1)(i,{guideId:n.id});o.guideToWebCaptureVersions[n.id]=[],o.guideToScreenshotCaptures[n.id]=[],o.guideToStaticResources[n.id]=[];let l=[],{steps:a,...u}=n.published,d=[],c=[],h=[];if(a)for(let{webCapture:t,screenshotCapture:i,...r}of a){if(t&&d.push(t),i&&c.push(i),(r.appearance===s.XB.Modal||r.appearance===s.XB.Tooltip)&&r.content){let t=(0,p.OA)(r.content);if(t)for(let i in t.entityMap)try{let s=t.entityMap[i];s.data.src&&l.push(syncStaticResource(e,s.data.src,o))}catch(e){}}h.push({...r,webCapture:t?{id:t.id,name:t.name}:void 0})}let{published:f,...w}=n.published.theme||{};f&&l.push(syncThemeVersion(e,f,o));let m={...n,published:{...u,steps:h,theme:n.published.theme?w:void 0},type:n.type};if((null==d?void 0:d.length)&&l.push(syncWebCaptures(e,d,o)),(null==c?void 0:c.length)&&l.push(syncMediaCaptures(e,c,o)),m.published.steps.length)for(let t of m.published.steps){let{backBtn:i,nextBtn:s,beacons:r,buttons:n,triggers:a}=t;(null==i?void 0:i.actions)&&l.push(scanActionsForFlowStarts(e,i.actions,o)),(null==s?void 0:s.actions)&&l.push(scanActionsForFlowStarts(e,s.actions,o)),(null==r?void 0:r.length)&&l.push(Promise.all(r.map(async t=>{t.actions&&await scanActionsForFlowStarts(e,t.actions,o)}))),(null==n?void 0:n.length)&&l.push(Promise.all(n.map(async t=>{t.actions&&await scanActionsForFlowStarts(e,t.actions,o)}))),(null==a?void 0:a.length)&&l.push(Promise.all(a.map(async t=>{t.actions&&await scanActionsForFlowStarts(e,t.actions,o)})))}l.push(e.guide.upsert({data:m})),await Promise.all(l)}async function syncChecklist(e,t,i){if(i.allGuides[t.id])return;if(i.allGuides[t.id]=!0,!("published"in t)){let e=await (0,r.sj)(t.id);if(!e){console.error("Checklist ".concat(t.id," not found"));return}let{guide:i,...s}=e;t={...s,published:i}}let s=t,n=(0,r.d1)(i,{guideId:s.id});n.guideToWebCaptureVersions[s.id]=[],n.guideToScreenshotCaptures[s.id]=[];let o=[],{steps:l,...a}=s.published,{published:u,...d}=s.published.theme||{};u&&o.push(syncThemeVersion(e,u,n));let c={...s,published:{...a,theme:s.published.theme?d:void 0},type:s.type};if(c.published.tasks)for(let t of c.published.tasks)t.actions&&o.push(scanActionsForFlowStarts(e,t.actions,n));o.push(e.guide.upsert({data:c})),await Promise.all(o)}let scanActionsForFlowStarts=async(e,t,i)=>await Promise.all(t.map(async t=>{t.startFlowId&&await syncFlow(e,{id:t.startFlowId},i)})),syncThemeVersion=async(e,t,i)=>{if(i.allThemeVersions[t.id]){i.themeVersionToGuides[t.id].includes(i.guideId)||i.themeVersionToGuides[t.id].push(i.guideId);return}if(i.allThemeVersions[t.id]=!0,i.themeVersionToGuides[t.id]=[i.guideId],t.dialogFontUrl){let s=await syncStaticResource(e,t.dialogFontUrl,i,"text/css");s&&(t.dialogFontUrl=s)}return await e.themeVersion.upsert({data:t})};async function syncProject(e,t){let i=await (0,r.$M)(t);if(!i){console.error("Project ".concat(t," not found"));return}if((0,l.MH)(i)){console.error("Project ".concat(t," is passcode protected"));return}let{checklist:s,flow:o,...a}=i,u={...a,flowId:null==o?void 0:o.id,checklistId:null==s?void 0:s.id},d=(0,r.d1)(t),c=[];if(o&&c.push(syncFlow(e,o,d)),s&&c.push(syncChecklist(e,s,d)),c.length&&await Promise.all(c),!u.screenshot){let e="";if(o){var p,h,f;let t=null===(p=o.published.steps)||void 0===p?void 0:p.find(e=>{var t,i,s;return(null===(i=e.webCapture)||void 0===i?void 0:null===(t=i.published)||void 0===t?void 0:t.id)||(null===(s=e.screenshotCapture)||void 0===s?void 0:s.deviceScreenshot)});t&&(e=(null===(h=t.screenshotCapture)||void 0===h?void 0:h.deviceScreenshot)?null===(f=t.screenshotCapture)||void 0===f?void 0:f.deviceScreenshot:(0,n.m$)(t.webCapture.published.id))}e&&(u.screenshot=await (0,r.Cz)(e,null))}await updateItemConnections(e,d),await e.project.upsert({data:u})}async function updateItemConnections(e,t){var i,s,r;let{projectId:n,themeVersionToGuides:o,guideToScreenshotCaptures:l,guideToWebCaptureVersions:a,guideToStaticResources:u,webCaptureVersionToStaticResources:c,staticResourceToStaticResources:h}=t,f={};for(let e in o)for(let t of o[e])f[t]=e;let w={};for(let e in l)for(let t of l[e])w[t]=w[t]||[],w[t].push(e);let m={};for(let e in a)for(let t of a[e])m[t]=m[t]||[],m[t].push(e);let g={};for(let e in c)for(let t of c[e])g[t]=g[t]||[],g[t].push(e);let v={};for(let e in h)for(let t of h[e])v[t]=v[t]||[],v[t].push(e);let b={};for(let e in u)for(let t of u[e])b[t]=b[t]||[],b[t].push(e);let y=Object.keys(o),C=Object.keys(a),P=Object.keys(w),j=Object.keys(m),x=Object.keys(g),F=Object.keys(v),T=Object.keys(u),I=Object.keys(b),S=[e.projectToGuides.findFirst({where:n}),Promise.all(y.map(t=>e.themeVersionToGuideVersions.findFirst({where:t}))),Promise.all(P.map(t=>e.screenshotCaptureToGuides.findFirst({where:t}))),Promise.all(C.map(t=>Promise.all([e.guideToProjects.findFirst({where:t}),e.guideToScreenshotCaptures.findFirst({where:t}),e.guideToWebCaptureVersions.findFirst({where:t})]))),Promise.all(j.map(t=>Promise.all([e.webCaptureVersionToStaticResources.findFirst({where:t}),e.webCaptureVersionToGuides.findFirst({where:t})]))),Promise.all(x.map(t=>Promise.all([e.staticResourceToStaticResources.findFirst({where:t}),e.staticResourceToWebCaptureVersions.findFirst({where:t})]))),Promise.all(F.map(t=>e.staticResourceInStaticResources.findFirst({where:t}))),Promise.all(T.map(t=>e.guideToStaticResources.findFirst({where:t}))),Promise.all(I.map()],[R,V,k,G,W,A,N,O,E]=await Promise.all(S),_=new d.ci,q=(null==R?void 0:R.guideIds)||[],M=(0,p.hp)(q,C);M.length!==q.length&&_.enqueue(e.projectToGuides.upsert({data:{projectId:n,guideIds:M}}));for(let t=0;t<y.length;++t){let i=y[t],s=V[t],r=(null==s?void 0:s.guideVersionIds)||[],n=o[i],l=(0,p.hp)(r,n);l.length!==r.length&&_.enqueue(e.themeVersionToGuideVersions.upsert({data:{themeVersionId:i,guideVersionIds:l}}))}for(let t=0;t<P.length;++t){let i=P[t],s=k[t],r=(null==s?void 0:s.guideIds)||[],n=w[i],o=(0,p.hp)(r,n);o.length!==r.length&&_.enqueue(e.screenshotCaptureToGuides.upsert({data:{screenshotCaptureId:i,guideIds:o}}))}for(let t=0;t<C.length;++t){let[i,s,r]=G[t]||[],o=C[t],u=(null==i?void 0:i.projectIds)||[],d=[n],c=(0,p.hp)(u,d);c.length!==u.length&&_.enqueue(e.guideToProjects.upsert({data:{guideId:o,projectIds:c}}));let h=(null==s?void 0:s.screenshotCaptureIds)||[],w=l[o]||[],m=(0,p.hp)(h,w);m.length!==h.length&&_.enqueue(e.guideToScreenshotCaptures.upsert({data:{guideId:o,screenshotCaptureIds:m}}));let g=(null==r?void 0:r.webCaptureVersionIds)||[],v=a[o]||[],b=(0,p.hp)(g,v);b.length!==g.length&&_.enqueue(e.guideToWebCaptureVersions.upsert({data:{guideId:o,webCaptureVersionIds:b}}));let y=f[o];y&&_.enqueue(e.guideToThemeVersion.upsert({data:{guideId:o,themeVersionId:y}}))}for(let t=0;t<j.length;++t){let[i,s]=W[t]||[],r=j[t],n=(null==i?void 0:i.staticResourceIds)||[],o=c[r]||[],l=(0,p.hp)(n,o);l.length!==n.length&&_.enqueue(e.webCaptureVersionToStaticResources.upsert({data:{webCaptureVersionId:r,staticResourceIds:l}}));let a=(null==s?void 0:s.guideIds)||[],u=m[r]||[],d=(0,p.hp)(a,u);d.length!==a.length&&_.enqueue(e.webCaptureVersionToGuides.upsert({data:{webCaptureVersionId:r,guideIds:d}}))}for(let t=0;t<x.length;++t){let[i,s]=A[t]||[],r=x[t],n=(null==i?void 0:i.staticResourceIds)||[],o=h[r]||[],l=(0,p.hp)(n,o);l.length!==n.length&&_.enqueue(e.staticResourceToStaticResources.upsert({data:{staticResourceId:r,staticResourceIds:l}}));let a=(null==s?void 0:s.webCaptureVersionIds)||[],u=g[r]||[],d=(0,p.hp)(a,u);d.length!==a.length&&_.enqueue(e.staticResourceToWebCaptureVersions.upsert({data:{staticResourceId:r,webCaptureVersionIds:d}}))}for(let t=0;t<F.length;++t){let s=(null===(i=N[t])||void 0===i?void 0:i.staticResourceIds)||[],r=v[F[t]]||[],n=(0,p.hp)(s,r);n.length!==s.length&&_.enqueue(e.staticResourceInStaticResources.upsert({data:{staticResourceId:F[t],staticResourceIds:n}}))}for(let t=0;t<T.length;++t){let i=(null===(s=O[t])||void 0===s?void 0:s.staticResourceIds)||[],r=u[T[t]]||[],n=(0,p.hp)(i,r);n.length!==i.length&&_.enqueue(e.guideToStaticResources.upsert({data:{guideId:T[t],staticResourceIds:n}}))}for(let t=0;t<I.length;++t){let i=(null===(r=E[t])||void 0===r?void 0:r.guideIds)||[],s=b[I[t]]||[],n=(0,p.hp)(i,s);n.length!==i.length&&_.enqueue(e.staticResourceToGuides.upsert({data:{staticResourceId:I[t],guideIds:n}}))}await Promise.all(_)}},47147:50733:]);
//# sourceMappingURL=9682-fd5627b2775f4a5e.js.map