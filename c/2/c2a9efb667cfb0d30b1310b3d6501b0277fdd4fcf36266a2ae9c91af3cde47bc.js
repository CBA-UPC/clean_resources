!function(){"use strict";var t={845:function(t,e,n){n.d(e,{S:function(){return h}});var s,i=n(401);class o{constructor(t){this.adRunning=!1,this.currentAdPosition=0,this.queuePlay=[],this.queueStop=[],this.adsManager=t,this.addEvents()}get getAdCurrentPosition(){return this.currentAdPosition}onResume(){this.adRunning=!0,this.queuePlay.push(this.currentAdPosition)}onPause(){this.adRunning=!1,this.queueStop.push(this.currentAdPosition)}onAdProgressnContentPauseRequested(){this.adRunning=!0}onComplete(){this.adRunning=!1,this.queueStop.push(this.currentAdPosition)}onSkipped(){this.adRunning=!1,this.queueStop.push(this.currentAdPosition)}onStarted(){this.adRunning=!0,this.queuePlay.push(0)}addEvents(){this.adsManager.addEventListener("contentPauseRequested",(()=>this.onContentPauseRequested())),this.adsManager.addEventListener("adProgress",(t=>this.onAdProgress(t))),this.adsManager.addEventListener("resume",(()=>this.onResume())),this.adsManager.addEventListener("pause",(()=>this.onPause())),this.adsManager.addEventListener("complete",(()=>this.onComplete())),this.adsManager.addEventListener("start",(()=>this.onStarted())),this.adsManager.addEventListener("skip",(()=>this.onSkipped()))}convertSecToMillisec(t){return Math.floor(1e3*t)}}class a{constructor(t){this.adRunning=!1,this.currentAdPosition=0,this.queuePlay=[],this.queueStop=[],this.bitmovinInstance=t,this.addEvents()}get getAdCurrentPosition(){return this.currentAdPosition}onComplete(){this.adRunning=!1,this.queueStop.push(this.getAdCurrentPosition)}nSkipped(){this.adRunning=!1,this.queueStop.push(this.getAdCurrentPosition)}nAdPlaying(){this.adRunning&&this.queuePlay.push(this.getAdCurrentPosition)}onAdProgressdEvents(){this.bitmovinInstance.on("adfinished",(()=>this.onComplete())),this.bitmovinInstance.on("adbreakfinished",(()=>this.adBreakFinished())),this.bitmovinInstance.on("timechanged",(()=>this.onAdProgress())),this.bitmovinInstance.on("adstarted",(()=>this.onStarted())),this.bitmovinInstance.on("adskipped",(()=>this.onSkipped())),this.bitmovinInstance.on("paused",(()=>this.onAdPaused())),this.bitmovinInstance.on("playing",(()=>this.onAdPlaying()))}convertSecToMillisec(t){return Math.floor(1e3*t)}}class r{constructor(t){this.adRunning=!1,this.currentAdPosition=0,this.queuePlay=[],this.queueStop=[],this.jwInstance=t,this.addEvents()}get getAdCurrentPosition(){return this.currentAdPosition}onComplete(){this.adRunning=!1,this.queueStop.push(this.getAdCurrentPosition),this.currentAdPosition=0}onSkipped(){this.adRunning=!1,this.queueStop.push(this.getAdCurrentPosition)}onPaused(){this.queueStop.push(this.getAdCurrentPosition)}onPlay(){this.adRunning=!0,this.queuePlay.push(this.currentAdPosition)}ddEvents(){this.jwInstance.on("adComplete",(()=>this.onComplete())),this.jwInstance.on("adTime",(),this.jwInstance.on("adPlay",(()=>this.onPlay())),this.jwInstance.on("adSkipped",(()=>this.onSkipped())),this.jwInstance.on("adPause",(()=>this.onPaused()))}convertSecToMillisec(t){return Math.floor(1e3*t)}}class d{constructor(t){this.adRunning=!1,this.currentAdPosition=0,this.adTimeOffset=0,this.queuePlay=[],this.queueStop=[],this.dmInstance=t,this.addEvents()}get getAdCurrentPosition(){return this.currentAdPosition}onComplete(){this.adRunning=!1,this.queueStop.push(this.getAdCurrentPosition),this.currentAdPosition=0,this.adTimeOffset=0}onSkipped(){this.adRunning=!1,this.queueStop.push(this.getAdCurrentPosition)}nPlay(){this.adRunning=!0,this.queuePlay.push(this.currentAdPosition)}onAdProgress(t){t>0&&(0===this.currentAdPosition&&5===t&&(this.adTimeOffset=5),this.currentAdPosition=this.convertSecToMillisec(t-this.adTimeOffset))}addEvents(){this.dmInstance.on("ad_end",(()=>this.onComplete())),this.dmInstance.on("ad_timeupdate",(),this.dmInstance.on("ad_play",(()=>this.onPlay())),this.dmInstance.on("ad_pause",(()=>this.onPaused()))}convertSecToMillisec(t){return Math.floor(1e3*t)}}class u{constructor(t){this.adRunning=!1,this.currentAdPosition=0,this.queuePlay=[],this.queueStop=[],this.kalturaInstance=t,this.addEvents()}get getAdCurrentPosition(){return this.currentAdPosition}dBreakFinished(){this.adRunning&&this.queueStop.push(this.getAdCurrentPosition),this.adRunning=!1,this.currentAdPosition=0}AdProgress(t){this.currentAdPosition=this.convertSecToMillisec(t.payload.adProgress.currentTime)}onAdPausedddEvents(){this.kalturaInstance.addEventListener("adcomplete",(()=>this.onComplete())),this.kalturaInstance.addEventListener("adprogress",(),this.kalturaInstance.addEventListener("adstarted",(()=>this.onStarted())),this.kalturaInstance.addEventListener("adresumed",(()=>this.onStarted())),this.kalturaInstance.addEventListener("adskipped",(()=>this.onSkipped())),this.kalturaInstance.addEventListener("adpaused",(()=>this.onAdPaused())),this.kalturaInstance.addEventListener("adbreakend",()}convertSecToMillisec(t){return Math.floor(1e3*t)}}window.extensionConfig=new s||(s={}));class h{constructor(t,e,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.currentPosition=0,this.currentPlaybackSpeed=1,this.lastPlaybackSpeed=1,this.currentVolume=0,this.timerIntervalMs=500,this.lastPosition=0,this.lastEvent=s.unknown,this.customParams={},this.streamStart="",i.Yd.readFromTagConf(),i.Yd.readFromLocalStorage(),this.addTag(e),this.gfkS2s=window.gfkS2s,this.gfkS2sConf=e,this.stopSegmentBeforeClose(),a||(this.setPlayer(t),this.setParameter(n,o)),this.setAgent(),setInterval((,this.timerIntervalMs),this.lastVolume=this.currentVolume}etAgent(){this.agent=this.createAgent(()}createAgent(t){const e=window.gfkS2s.getAgent(t);var n,s;return e.setExtensionVersion=(n=e.a,s="setExtensionVersion",function(){n.queue?n.queue.push({f:s,a:arguments}):n.processor[s](arguments[0])}),e.setExtensionVersion(window.extensionConfig.version),e}activateGoogleIMASupport(t){this.googleIma=new o(t),this.adAgent=this.createAgent((()=>this.googleIma.getAdCurrentPosition))}activateBitmovinAdSupport(){this.bitmovinAdExtension=new a(this.playerInstance),this.adAgent=this.createAgent((()=>this.bitmovinAdExtension.getAdCurrentPosition))}activateJWAdSupport(){this.jwAdExtension=new r(this.playerInstance),this.adAgent=this.createAgent((()=>this.jwAdExtension.getAdCurrentPosition))}activateDailyMotionAdSupport(){this.dmAdExtension=new d(this.playerInstance),this.adAgent=this.createAgent((()=>this.dmAdExtension.getAdCurrentPosition))}activateKalturaAdSupport(){this.kalturaAdExtension=new u(this.playerInstance),this.adAgent=this.createAgent(()}processAdPlayEvents(){if(this.googleIma&&this.googleIma.queuePlay.length>0){const t=this.googleIma.queuePlay.shift();this.adAgent.playStreamOnDemand("ad",`${this.streamId} ad`,t,{},this.customParams)}if(this.bitmovinAdExtension&&this.bitmovinAdExtension.queuePlay.length>0){const t=this.bitmovinAdExtension.queuePlay.shift();this.adAgent.playStreamOnDemand("ad",`${this.streamId} ad`,t,{},this.customParams)}else if(this.jwAdExtension&&this.jwAdExtension.queuePlay.length>0){const t=this.jwAdExtension.queuePlay.shift();this.adAgent.playStreamOnDemand("ad",`${this.streamId} ad`,t,{},this.customParams)}else if(this.dmAdExtension&&this.dmAdExtension.queuePlay.length>0){const t=this.dmAdExtension.queuePlay.shift();this.adAgent.playStreamOnDemand("ad",`${this.streamId} ad`,t,{},this.customParams)}else if(this.kalturaAdExtension&&this.kalturaAdExtension.queuePlay.length>0){const t=this.kalturaAdExtension.queuePlay.shift();this.adAgent.playStreamOnDemand("ad",`${this.streamId} ad`,t,{},this.customParams)}}processAdStopEvents(){if(this.googleIma&&this.googleIma.queueStop.length>0){const t=this.googleIma.queueStop.shift();this.adAgent.stop(t)}if(this.bitmovinAdExtension&&this.bitmovinAdExtension.queueStop.length>0){const t=this.bitmovinAdExtension.queueStop.shift();this.adAgent.stop(t)}else if(this.jwAdExtension&&this.jwAdExtension.queueStop.length>0){const t=this.jwAdExtension.queueStop.shift();this.adAgent.stop(t)}else if(this.dmAdExtension&&this.dmAdExtension.queueStop.length>0){const t=this.dmAdExtension.queueStop.shift();this.adAgent.stop(t)}else if(this.kalturaAdExtension&&this.kalturaAdExtension.queueStop.length>0){const t=this.kalturaAdExtension.queueStop.shift();this.adAgent.stop(t)}}stopAdAgent(){this.googleIma&&(this.googleIma.adRunning=!1,this.googleIma.queueStop.push(this.googleIma.getAdCurrentPosition)),this.bitmovinAdExtension?(this.bitmovinAdExtension.adRunning=!1,this.bitmovinAdExtension.queueStop.push(this.bitmovinAdExtension.getAdCurrentPosition)):this.jwAdExtension?(this.jwAdExtension.adRunning=!1,this.jwAdExtension.queueStop.push(this.jwAdExtension.getAdCurrentPosition)):this.dmAdExtension?(this.dmAdExtension.adRunning=!1,this.dmAdExtension.queueStop.push(this.dmAdExtension.getAdCurrentPosition)):this.kalturaAdExtension&&(this.kalturaAdExtension.adRunning=!1,this.kalturaAdExtension.queueStop.push(this.kalturaAdExtension.getAdCurrentPosition))}isAdRunning(){return this.googleIma&&this.googleIma.adRunning||this.bitmovinAdExtension&&this.bitmovinAdExtension.adRunning||this.jwAdExtension&&this.jwAdExtension.adRunning||this.dmAdExtension&&this.dmAdExtension.adRunning||this.kalturaAdExtension&&this.kalturaAdExtension.adRunning}get currentSrc(){return null}etStreamStart(t){t instanceof Date&&!isNaN(t.getTime())?this.streamStart=t.toISOString():"string"!=typeof t||isNaN(new Date(t).getTime())?this.streamStart="":this.streamStart=t}get playbackRate(){return 1}get duration(){return null}isBuffering(){return!1}isIdling(){return!1}get currentTime(){return 0}volumeChecker(){this.currentVolume=this.getVolume(),this.currentVolume!==this.lastVolume&&this.isPlaying()&&this.agent.volume(this.currentVolume.toString())}getVolume(){return null}etStreamId(){return this.playerInstance&&this.currentSrc&&""!==this.currentSrc?this.currentSrc:Math.random().toString()}setParameter(t,e,n){this.streamId=this.getStreamId(),this.contentId=t,e&&(this.customParams=e),this.setStreamStart(n)}ggerHugeTimeJump(){return Math.abs(this.currentPosition-this.lastPosition)>=3*this.timerIntervalMs}addTag(t){!function(t,e,n,s,i){if(e.getElementById(i))return;t.gfkS2sConf=n,t[i]={},t[i].agents=[];const o=["playStreamLive","playStreamOnDemand","stop","skip","screen","volume","impression"];t.gfks=function(){function t(t,e,n){return return function(e,n,s){const i={queue:[],config:e,cb:s,pId:n};for(let e=0;e<o.length;e++){const n=o[e];i[n]=t(i,n,s)}return i}}(),t[i].getAgent=function(e,s){const a={a:new t.gfks(n,s||"",e||function(){return 0})};or(let t=0;t<o.length;t++){const e=o[t];a[e]=r(a,e)}return t[i].agents.push(a),a};!function(t,n){const i=e.createElement(s),o=e.getElementsByTagName(s)[0];i.id=t,i.async=!0,i.type="text/javascript",i.src=n,i.setAttribute("crossorigin","anonymous"),o.parentNode.insertBefore(i,o)}(i,n.url)}(window,document,t,"script","gfkS2s")}stopSegmentBeforeClose(){window.onbeforeunload=()=>{this.lastEvent===s.play&&this.agent.stop(this.lastPosition)}}playStreamOnDemand(){this.agent.playStreamOnDemand(this.contentId,this.streamId,this.currentPosition,{volume:this.currentVolume.toString(),speed:this.currentPlaybackSpeed},this.customParams)}playbackSpeedChecker(){this.currentPlaybackSpeed=this.playbackRate,this.currentPlaybackSpeed!==this.lastPlaybackSpeed&&this.isPlaying()&&(this.logger("playback speed change detected"),this.lastPlaybackSpeed=this.currentPlaybackSpeed,this.agent.stop(this.lastPosition),this.playStreamOnDemand())}setPlayer(t){this.playerInstance=t,this.streamId=this.getStreamId(),this.currentVolume=t?this.getVolume():this.currentVolume}periodicTimeObserver(){if(this.processAdStopEvents(),this.playerInstance){if((this.isBuffering()||this.isIdling())&&!this.isAdRunning())return;this.currentPosition=this.convertSecToMillisec(this.currentTime),this.playbackSpeedChecker(),this.volumeChecker(),this.isHugeTimeJump()&&this.lastEvent==s.play&&!this.isAdRunning()?(this.logger("huge time jump happened"),this.agent.stop(this.lastPosition),this.lastEvent=s.timeJump):this.lastEvent==s.play&&this.convertSecToMillisec(this.duration)<=this.currentPosition&&!this.isAdRunning()?(this.logger("video ended"),this.agent.stop(),this.lastEvent=s.stop):this.lastEvent==s.timeJump&&this.isPlaying()?(this.logger("start after huge jump"),this.playStreamOnDemand(),this.lastEvent=s.play):this.lastPlayerStatusWasPlaying!==this.isPlaying()&&(this.logger("last player state was not play"),this.lastEvent==s.play?(this.logger("last player state was not play -> last event state was play"),this.agent.stop(),this.lastEvent=s.stop):this.isPlaying()&&(this.logger("last player state was not play -> else"),this.playStreamOnDemand(),this.lastEvent=s.play)),this.lastValueSetter(),this.lastPlayerStatusWasPlaying=this.isPlaying()}else this.lastEvent===s.play?(this.logger("player instance undefined"),this.agent.stop(),this.lastEvent=s.stop):this.isAdRunning()&&!this.googleIma&&(this.logger("player instance undefined stopping ad"),this.stopAdAgent());this.processAdPlayEvents()}playLiveStream(){this.agent.playStreamLive(this.contentId,this.streamStart,this.streamOffset,this.streamId,{volume:this.getVolume().toString(),speed:this.currentPlaybackSpeed},this.customParams)}stopLiveSegmentBeforeClose(){window.onbeforeunload=()=>{this.lastEvent===s.play&&this.agent.stop()}}livePeriodicTimeObserver(){if(this.processAdStopEvents(),this.playerInstance){if((this.isBuffering()||this.isIdling())&&!this.isAdRunning())return void(this.isBuffering()&&this.lastEvent===s.play&&(this.agent.stop(),this.lastEvent=s.stop,this.lastPlayerStatusWasPlaying=!1));this.currentPosition=this.convertSecToMillisec(this.currentTime),this.playbackSpeedChecker(),this.volumeChecker(),this.isHugeTimeJump()&&this.lastEvent==s.play?(i.Yd.output("huge time jump happened"),this.agent.stop(),this.lastEvent=s.timeJump):this.lastEvent==s.timeJump&&this.isPlaying()?(i.Yd.info("start after huge jump"),this.playLiveStream(),this.lastEvent=s.play):this.lastPlayerStatusWasPlaying!==this.isPlaying()&&(i.Yd.info("last player state was not play"),this.lastEvent==s.play?(this.agent.stop(),this.lastEvent=s.stop):this.isPlaying()&&(i.Yd.info("last player state was not play -> else"),this.playLiveStream(),this.lastEvent=s.play)),this.lastValueSetter(),this.lastPlayerStatusWasPlaying=this.isPlaying()}else this.lastEvent===s.play?(this.logger("player instance undefined"),this.agent.stop(),this.lastEvent=s.stop):this.isAdRunning()&&!this.googleIma&&(this.logger("player instance undefined stopping ad"),this.stopAdAgent());this.processAdPlayEvents()}}},401:function(t,e,n){n.d(e,{Yd:);onst i={none:0,error:1,warn:2,info:3,log:4,debug:5},o=["none","debug","log","info","warn","error"];logLevel="none",a.url=null}},e={};.d=n.o=function(){var t=n(845);class e extends t.S{constructor(t,e,n){super(t,e,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.logger("Sensic HTML5 player extension initialized")}getVolume(){return this.playerInstance.muted?0:Math.round(100*this.playerInstance.volume)}et playbackRate(){return this.playerInstance.playbackRate}get currentSrc(){return this.playerInstance.currentSrc}get duration(){return this.playerInstance.duration}isBuffering(){return 0===this.playerInstance.buffered.length&&!isNaN(this.duration)}isIdling(){return 0===this.playerInstance.played.length&&!isNaN(this.duration)}indow.gfkS2sExtension||(window.gfkS2sExtension={}),window.gfkS2sExtension.HTML5VODExtension=e}()}();
//# sourceMappingURL=html5vodextension.js.map