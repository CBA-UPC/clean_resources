(function(){try{var trackPlayer=function trackPlayer(el){var infoInterval=null;var particle=null;var consumedTime=0;var activeVideoId=null;var youTubePlayer=new YT.Player(el.id,{events:{"onStateChange":onPlayerStateChange.bind(this)}});function playerInfo(){var videoDuration=youTubePlayer.getDuration()*1000;var currentTime=youTubePlayer.getCurrentTime()*1000;consumedTime+=1000;particle.addEvent({video_position:"i:"+Math.round(currentTime),video_duration:"i:"+videoDuration,video_completion:"i:"+Math.round(currentTime/videoDuration*100),video_consumed_time:"i:"+consumedTime});}
var onPlay=function(){var videoData=youTubePlayer.getVideoData();var videoID=videoData.video_id;clearInterval(infoInterval);if(activeVideoId!=videoID){activeVideoId=videoID;var p_data={particle_id:videoData.video_id,title:videoData.title,object_type:"video",player:"youtube",url:el.src,img_url:"https://i1.ytimg.com/vi/"+videoID+"/default.jpg",};consumedTime=0;particle=upScore.addParticle(p_data);}
playerInfo();infoInterval=setInterval(playerInfo,1000);};var onPause=function onEnd(){activeVideoId=null;clearInterval(infoInterval);playerInfo();}
function onPlayerStateChange(){try{var data=JSON.parse(event.data);if(data.info==YT.PlayerState.ENDED){onEnd();}else if(data.info==YT.PlayerState.PLAYING){onPlay();}else if(data.info==YT.PlayerState.PAUSED){onPause();}}catch(e){console.error(e);}}};var playerElements=Array.prototype.slice.call(document.querySelectorAll("[data-upscore-video-type=\"youtube\"]"),0);var updateSource=function(el){var src=el.src.split("/");var ytID=src[src.length-1];if(!el.id){el.id=ytID;}
el.src+=(el.src.match(/[?]/g)?"&":"?")+"version=3&enablejsapi=1";};playerElements.map(updateSource);var upScoreYouTubeIframeAPIReady=function(){if(typeof YT!=="undefined"&&typeof YT.Player!=="undefined"){playerElements.map(trackPlayer);}else{var tag=document.createElement("script");tag.type="text/javascript";tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);setTimeout(upScoreYouTubeIframeAPIReady,1000);}};upScoreYouTubeIframeAPIReady();}catch(ex){console.error(ex);}})();