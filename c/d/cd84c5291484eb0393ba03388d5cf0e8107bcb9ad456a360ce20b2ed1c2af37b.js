import{hY as tt,W as P,e as st,u as ot,d as n,j as u,y as at,z as te,f as it,l as le,_ as ce,an as Oe,eE as he,a1 as I,aF as se,aG as oe,aH as ae,hZ as Ue,h_ as nt,h$ as Fe,i0 as dt,fH as rt,eN as ue,dl as N,m as Se,F as _e,gM as lt,ab as ct,az as ut,b6 as mt,N as T,aI as x,ci as D,cj as y,i1 as gt,i2 as pt,aB as It,aC as ft,aD as Tt,d9 as ht,da as Ft,ae as St,h6 as _t,ad as ve,d8 as vt,af as Ee,i3 as Le,i4 as Et,i5 as Lt,bz as bt,i6 as Ct,eF as At,eG as yt,cm as Ot,i7 as Ut,de as Vt,dc as xt,dd as Dt,ag as be}from"./index-IMvvqvG5.js";import{aR as Pt,aT as Nt,g as Mt,aU as Rt}from"./useImageMeasurer-i_xvXh1-.js";import{B as wt}from"./index-BxVjk_A7.js";import{c as kt,u as jt,d as ie,U as Ht}from"./useCloudStorageFiles-0OAYEiZl.js";import{T as zt,a as Bt,b as Gt}from"./index-3yfBtf9f.js";import{U as e,u as Kt}from"./index-ss2QbMh7.js";const Wt=[e.Images,e.Fonts,e.Audios,e.Videos];var ye;const B=tt((ye=P.categories.UPLOADS)==null?void 0:ye.tabs,Wt),de={uploadsHeader:"uploads-header",uploadedItem:"uploaded-item",uploadedSidebar:"uploaded-sidebar",uploadsTitle:"uploads-title"},$t=st(i=>({root:{width:"100%",height:32,marginTop:i.spacings.s16},checkMarked:{"&::after":{content:'"â€¢"',color:i.colors.accents.primary.base.default,paddingBottom:10,fontWeight:900}}}),{name:"uploads-chooser-header"}),Yt="Uploads",Zt=({onTabChange:i,dataVariants:g,activeTab:_})=>{var s;const h=$t(),F=ot(),v=n.useCallbac},[i]);return u.jsxs(u.Fragment,{children:[((s=P.categories.UPLOADS)==null?void 0:s.title)&&u.jsx(at.Text,{color:te.Texts.tint1,size:te.Typography.t6,weight:te.FontWeights.Bold,"data-testid":de.uploadsTitle,children:F(Yt)}),!!B.length&&u.jsx(zt,{"data-testid":de.uploadsHeader,value:B.indexOf(_),variant:Bt.Filled,onChange:v,className:h.root,columnGap:4,children:B.map(m=>u.jsx(Gt,{id:m,title:m,className:it([g[m]&&h.checkMarked]),"data-testid":`tab-${m.toLowerCase()}`,children:F(m)},m))})]})},Ce=le(()=>ce(()=>import("./index-eY9zET7R.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),Xt=le(()=>ce(()=>import("./index-Ac6Lksqy.js"),__vite__mapDeps([28,1,2,3,5,6,7,8,9,11,12,13,14,10,29,30,26,20,27]))),qt=le(()=>c),__vite__mapDeps([31,1,2,9,32,33,6,7,8,17,34,4,18,19,20,21,11,12,13,14]))),Jt=({activeTab:i,handleFontSelect:g,handleImageSelect:_,handleVideoSelect:h,fonts:F,deleteFontItem:v,addFontToList:s,hasNextFonts:m,isLoadingFonts:L,removeFontFromList:M,fetchFontsNextPage:b,images:G,deleteImageItem:O,addImageToList:K,hasNextImages:W,isLoadingImages:C,removeImageFromList:p,fetchImagesNextPage:R,videos:w,isLoadingVideos:o,fetchVideosNextPage:E,deleteVideoItem:$,removeVideoFromList:k,hasNextVideos:U,addVideoToList:Y})=>{const[S,c]=n.useState(null),A=n.useCallbac),[]),j={[e.Images]:R,[e.Fonts]:b,[e.Videos]:E,[e.Audios]:Oe};switch(Kt({callback:j[i],element:S}),i){case e.Fonts:return u.jsx(Xt,{cloudItems:F,deleteItem:v,addItemToList:s,showLocalItems:!m||!I.cloudStorage,isLoading:L,handleSelect:g,removeItemFromList:M,loadMore:b,setRef:A});case e.Audios:return u.jsx(qt,{});case e.Videos:return u.jsx(Ce,{mediaType:he.Video,cloudItems:w,setRef:A,isLoading:o,handleSelect:h,deleteItem:$,removeItemFromList:k,addItemToList:Y,showLocalItems:!U||!I.cloudStorage});case e.Images:default:return u.jsx(Ce,{mediaType:he.Image,cloudItems:G,deleteItem:O,addItemToList:K,showLocalItems:!W||!I.cloudStorage,isLoading:C,handleSelect:_,removeItemFromList:p,loadMore:R,setRef:A})}};var re))(re||{});class Qt{photoEditItemOpen(){se.sendEvent(oe.PHOTO_EDIT_ITEM_ACTION,ae.custom_event,{item:"tool_delete",source:"upload"})}photoEditItemAction(g){se.sendEvent(oe.PHOTO_EDIT_ITEM_ACTION,ae.custom_event,{item:"upload",category_name:g,action:"try"})}uploadClick(g,_){se.sendEvent(oe.UPLOAD_CLICK,ae.custom_event,{origin:"photo_editor",item:re[g],source:_,...I.editorOnly&&{button_click:re[g]}})}}const ne=new Qt,Ae={[e.Images]:!1,[e.Fonts]:!1,[e.Videos]:!1},es={[e.Audios]:[...Ue].join(", "),[e.Images]:[...nt].join(", "),[e.Fonts]:[...Fe].join(", "),[e.Videos]:[...dt,...Fe,...rt].join(", ")},ts={contentType:ue.STANDALONE,contentResourceTypes:[N.PHOTO,N.STICKER],limit:30,offset:0},ss={contentType:ue.STANDALONE,contentResourceTypes:[N.FONT],limit:30,offset:0},os={contentType:ue.STANDALONE,contentResourceTypes:[N.VIDEO],limit:30,offset:0},as=i=>({uploadedImages:At(i),uploadedVideos:yt(i),uploadedFonts:Ot(i),dropzoneContent:Ut(i),firstHoveredLayerId:Vt(i)[0],firstHoveredLayerIsCollage:xt(i),firstHoveredLayerIsPhotoOrVideoLayer:Dt(i)}),is=({hideHeader:i=!(_=>(_=P.categories.UPLOADS)==null?void 0:_.header)(),selectedTab:g})=>{var fe,Te;const{uploadedImages:h,uploadedVideos:F,uploadedFonts:v,dropzoneContent:s,firstHoveredLayerId:m,firstHoveredLayerIsCollage:L,firstHoveredLayerIsPhotoOrVideoLayer:M}=Se(as),b=g===e.Fonts,G=b?_e.FONT:_e.UPLOADS,O=(fe=P.categories.UPLOADS)==null?void 0:fe.tabs,K=O&&Object.values(e).includes(O[0])?O[0]:null,W=g||K||((Te=P.categories.UPLOADS)==null?void 0:Te.type)||e.Images,{tokenDataRef:C,tokenData:p}=lt(),[R,w]=n.useState(null),[o,E]=n.useState(W),[$,k]=n.useState(Ae),[U,Y]=n.useState(!1),S=Se(bt),c=ct();kt(R);const A=jt(),j=n.useMem),[]),H=Pt(),{setAbortableFont:Z}=mt(),me=n.useMemo(()=>s.isImage&&!s.isFont&&!s.isVideo?e.Images:s.isFont&&!s.isImage&&!s.isVideo?e.Fonts:s.isVideo&&!s.isImage&&!s.isFont?e.Videos:o,[s.isImage,s.isFont,s.isVideo,o]);n.useEffect(()=>{E(me),s.isImage&&o!==e.Images||s.isFont&&o!==e.Fonts||s.isVideo&&o!==e.Videos?(k({[e.Images]:s.isImage&&o!==e.Images,[e.Fonts]:s.isFont&&o!==e.Fonts,[e.Videos]:s.isVideo&&o!==e.Videos}),c(T.actions.resetDropzoneContent())):(s.isImage||s.isFont||s.isVideo)&&c(T.actions.resetDropzoneContent())},[o,c,s,me]),n.useEffect(()=>{const t=x.getSync(D,y.uploadedFonts)||[],a=x.getSync(D,y.uploadedVideos)||[],r=t.map(d=>{const l={...d};return d.preview_url&&(l.previewUrl=d.preview_url,delete l.preview_url),d.item_url&&(l.url=d.item_url,delete l.item_url),l});I.editorOnly||(c(T.actions.storeUploadedFonts(r.reverse())),c(T.actions.updateAllUploadMedia(a.reverse())))},[c]);const X=n.useCallback(async({font:t,index:a})=>{const r={isPremium:!1,preview_url:t.previewUrl,...t};await Z(t.fontFamily,t.fontSrc),Nt({addedFont:r,license:Ct,index:a,setFonts:Z,isFromUploads:!0,handleDeeplinkSettings:H}),ne.photoEditItemAction("text_font")},[Z,H]),q=n.useCallback(t=>!I.cloudStorage||!(p!=null&&p.access_token)?Promise.resolve({}):(Y(!0),gt(p==null?void 0:p.access_token,t)),[p==null?void 0:p.access_token]),J=n.useCallback(t=>{var a;return pt((a=C==null?void 0:C.current)==null?void 0:a.access_token,t)},[C]),{items:V,hasNext:Ve,deleteItems:xe,addItemToList:De,removeItemFromList:Pe,isLoading:Ne,fetchNextPage:Me}=ie({fetcher:q,params:ts,deleter:J,isInitialFetchDisabled:U}),{items:Q,hasNext:Re,deleteItems:we,addItemToList:ke,removeItemFromList:je,isLoading:He,fetchNextPage:ze}=ie({fetcher:q,params:ss,deleter:J,isInitialFetchDisabled:U}),{items:ee,hasNext:Be,deleteItems:Ge,addItemToList:Ke,removeItemFromList:We,isLoading:$e,fetchNextPage:Ye}=ie({fetcher:q,params:os,deleter:J,isInitialFetchDisabled:U}),{settings:ge}=It({name:ft.upload_fit_to_canvas,tag:Tt.editor}),z=n.useCallback(async({media:t},a=!1)=>{const r=ht({url:t.url,size:1920,skipWebp:!0,method:Ft.min}),d=t.thumbnailUrl||Mt(t.url,be,be);await St({imageId:String(t.id),photoData:{previewImageSrc:d,cbForUpdateUrr},image:t,isDropped:a,firstHoveredLayerId:m,isFromUploads:!0,isCollage:a&&L,isReplace:a&&M,fitCanvasToImage:ge});const l=_t(t,y.recentPhotos);c(T.actions.setRecentPhotos(l)),ne.photoEditItemAction("image")},[c,m,L,M,ge]),Ze=n.useCallback(t=>{let a;if(o===e.Images||o===e.Videos){const r=o===e.Videos;w(null);const{setShowTransformer:d}=Ee();typeof d=="function"&&d(!0),c(T.actions.setDroppableMediaFromSidebar(ve)),I.cloudStorage&&(a=r?ee.find(f=>f.uid===t):V.find(f=>f.uid===t));const l=r?F.find(f=>String(f.id)===t):h.find(f=>String(f.id)===t);l&&(z({index:(r?F:h).indexOf(l),media:l},!0),c(T.actions.setDroppableMediaFromSidebar(ve)))}if(o===e.Fonts){I.cloudStorage&&(a=Q.find(d=>d.uid===t));const r=v.fint);r&&X({index:v.indexOf(r),font:r})}I.cloudStorage&&a&&A(a,void 0,!0,void 0,!0)},[Q,V,ee,A,o,c,X,z,v,h,F]),Xe=n.useCallback(t=>{var r,d;const a=V.fint);if(a){const l={height:Number((r=a.preview)==null?void 0:r.height),width:Number((d=a.preview)==null?void 0:d.width),id:a.content.uid,type:a.content.resourceType,url:a.sourceUrl||"",thumbnailUrl:vt(a.sourceUrl||""),license:""};l.type===N.PHOTO&&w(l),Ee().setShowTransformer(!1)}},[V]),pe=n.useCallback(()=>{if(o===e.Fonts){const t=x.getSync(D,y.uploadedFonts)||[];if(!t.length)return;c(T.actions.storeUploadedFonts(t.reverse()))}if(o===e.Images){const t=x.getSync(D,y.uploadedImages)||[];if(!t.length)return;c(T.actions.updateAllUploadMedia(t.reverse()))}if(o===e.Videos){const t=x.getSync(D,y.uploadedVideos)||[];if(!t.length)return;c(T.actions.updateAllUploadMedia(t.reverse()))}},[c,o]);n.useEffec},[pe]);const qe=n.useCallbac},[]),Je=n.useCallback(()=>{const t=b?Le.Text:Le.Upload;ne.uploadClick(o,t)},[o,b]),Qe=n.useMemo(()=>{var t;return{origin:"editor",source:"upload",source_sid:j,method:"default",name:(t=S==null?void 0:S.subscription)!=null&&t.granted?"storage_full_upload_duplicate_pro":"storage_full_upload"}},[j,S==null?void 0:S.subscription]),et=n.useCallback(t=>{const{videoFiles:a,fontFiles:r,imageFiles:d}=Et(t,Oe),l=[a,r,d].filte0);if(l.length===1)switch(l[0]){case a:E(e.Videos);break;case r:E(e.Fonts);break;case d:E(e.Images);break}},[]);let Ie=I.video?es[o]:void 0;return I.allowVideoUpload&&(Ie=o===e.Audios?Ue.join(", "):Lt.join(", ")),u.jsx(Rt,{category:G,children:u.jsx(wt,{testId:de.uploadedSidebar,sidebarHeader:u.jsx(Zt,{onTabChange:qe,dataVariants:$,activeTab:o}),sidebarContent:u.jsx(Jt,{activeTab:o,handleImageSelect:z,handleFontSelect:X,handleVideoSelect:z,fonts:Q,deleteFontItem:we,addFontToList:ke,hasNextFonts:Re,isLoadingFonts:He,removeFontFromList:je,fetchFontsNextPage:ze,images:V,deleteImageItem:xe,addImageToList:De,hasNextImages:Ve,isLoadingImages:Ne,removeImageFromList:Pe,fetchImagesNextPage:Me,videos:ee,isLoadingVideos:$e,fetchVideosNextPage:Ye,deleteVideoItem:Ge,removeVideoFromList:We,hasNextVideos:Be,addVideoToList:Ke}),sidebarFooter:u.jsx(Ht,{handleUploadClickAnalytics:Je,storageFullAnalyticsParams:Qe,onFileInputChangeCb:et,acceptedFormats:Ie,type:o}),getCurrentDraggedElement:Xe,onDragEnd:Ze,showFooter:!0,hideHeader:i})})},ms=Object.freeze(Object.defineProperty({__proto__:null,default:is},Symbol.toStringTag,{value:"Module"}));export{is as U,ne as a,ms as i,de as t};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-eY9zET7R.js","assets/index-IMvvqvG5.js","assets/index-YfsWbKng.css","assets/index-Xe7JKTMN.js","assets/zh-TW-1d550385-58vOSG_i.js","assets/index-LmdOAVg5.js","assets/useImageMeasurer-i_xvXh1-.js","assets/getPressedImageData-74KNu2MQ.js","assets/index-6SJllaRd.js","assets/index-ss2QbMh7.js","assets/useCloudStorageFiles-0OAYEiZl.js","assets/NoResult-o3INJeYG.js","assets/index-knW2oKOE.js","assets/index-LV9moQ-t.js","assets/index-q2tK04gT.js","assets/index-WTJsS9b1.js","assets/index-rsdixL0D.js","assets/index-8cjPRlka.js","assets/index-j97aM_Tn.js","assets/removeItemFromRecents-T0H2Snan.js","assets/index-BxVjk_A7.js","assets/useContainerParams-DP9mHw08.js","assets/useTextStylesData-V-rq4ZoY.js","assets/index-8CFd6jyP.js","assets/index-NM_3i4B5.js","assets/testIds-poACUZMz.js","assets/useCollections-9V73-2-B.js","assets/index-3yfBtf9f.js","assets/index-Ac6Lksqy.js","assets/Upgrade-fX6X8t2p.js","assets/index-_FivrCmr.js","assets/index-CJsxnsy1.js","assets/index-NeDVU88t.js","assets/useMediaLoop-zLTC9Vbd.js","assets/index-R4OxhX0C.js"]
  }
  return indexes.ma])
}
