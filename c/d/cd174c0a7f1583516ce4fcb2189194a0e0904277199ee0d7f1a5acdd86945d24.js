"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[9540],{16476:(e,r,t)=>{t.d(r,{v:()=>m});var a=t(50959),n=t(85648),s=t(6807),i=t(45438),l=t(30751),o=t(94452),c=t(82857),u=t(24683),d=t(18674),v=t(11527);const m=a.memo((function(e){let{uri:r,artistUri:t,canPin:a=l.TL.NO,isPinned:m=!1}=e;const{spec:p}=(0,o.T)(r);return(0,v.jsx)(i.JL,{value:"album",children:(0,v.jsxs)(s.v,{children:[t&&(0,v.jsx)(u.Jh,{spec:p,divider:"after",uri:t,displayText:n.ag.get("contextmenu.go-to-artist-radio")}),a!==l.TL.NO&&(0,v.jsx)(d.X,{uri:r,canPin:a,isPinned:m,type:c.p.PRE_RELEASE,spec:p}),(0,v.jsx)(u.Jx,{uri:r,spec:p,displayText:n.ag.get("context-menu.copy-album-link")}),(0,v.jsx)(u.h$,{spec:p,divider:"before",uri:r})]})})}))},36637:(e,r,t)=>{t.d(r,{g:()=>i});var a=t(69736),n=t(63068),s=t(11527);const i=e=>{let{children:r}=e;return(0,s.jsx)(a.x,{variant:"bodySmall",className:n.Z.pretitle,children:r})}},66873:(e,r,t)=>{t.d(r,{x:()=>d});var a=t(50959),n=t(76950),s=t(50540),i=t(30374),l=t(2990),o=t(71459),c=t(8499),u=t(11527);const d=e=>{let{children:r,action:t,uri:d}=e;const v=(0,s.g)(),m=(0,l.j)();let p;const g=()=>{const e={triggerId:c.K,triggerAction:{type:t}};o.y.set((r=>({...r,...e}))),m.storeAction(i.wH,{operation:n.pT.ADD,uris:[d]})};try{p=a.Children.only(r)}catch(b){return(0,u.jsx)(u.Fragment,{children:r})}return v?a.cloneElement(p,{onClick:g}):(0,u.jsx)(u.Fragment,{children:r})}},5280:(e,r,t)=>{t.r(r),t.d(r,{AlbumPrerelease:()=>Fe});t(75930),t(46758),t(53321),t(86277),t(65484),t(35174),t(96241);var a=t(82187),n=t.n(a),s=t(75802),i=t(69736),l=t(11317),o=t(85648),c=t(66713),u=t(22527),d=t(82857),v=t(50959),m=t(20726),p=t(20580),g=t(80626);function b(e){const r=new Date;return(e instanceof Date?e:new Date(e)).getTime()-r.getTime()}var f=t(43286),x=t(61899),h=t(11527);const y=e=>{let{uri:r}=e;const t=(0,x.D)(r),{spec:a,logger:n}=(0,g.fU)(m.j,{data:{uri:r||""}}),s=(0,v.useCallback)((()=>{r&&(n.logInteraction(a.actionBarFactory().preSaveButtonFactory().hitUiNavigate({destination:r})),t())}),[t,a,r,n]);return r?(0,h.jsx)(f.D,{onClick:s,children:o.ag.get("web-player.album-prerelease.listen_now")}):null};var j=t(52438),P=t(66873),R=t(91529);const k=3e5,C=36e5;var S=t(23120),T=t(20069);const _=new S.o("AlbumPrereleasePreSavedState","query","786a00e33d92125d602df73c57581fafab31792ddd4eeb4d2c66e8969e1015bd",null),D=new S.o("PreSaveAlbumPrerelease","mutation","786a00e33d92125d602df73c57581fafab31792ddd4eeb4d2c66e8969e1015bd",null),w=new S.o("RemovePreSaveAlbumPrerelease","mutation","786a00e33d92125d602df73c57581fafab31792ddd4eeb4d2c66e8969e1015bd",null),L=e=>{const{data:r,invalidate:t,loading:a}=(n={uri:e},s={staleTime:k,gcTime:C},(0,T.a)(_,n,s));var n,s;return{isPreSaved:(0,v.useMemo)((()=>{if(!r)return!1;for(const t of r.lookup)if("PreReleaseResponseWrapper"===t.__typename&&"PreRelease"===t.data.__typename&&t.data.uri===e)return t.data.preSaved;return!1}),[r,e]),isLoading:a,invalidate:t}};var A=t(73247),U=t(65441),E=t(7627),I=t(70526),F=t(19039);const N=(e,r)=>{const{request:t}=(0,v.useContext)(U.Ax),{enqueueSnackbar:a}=(0,F.D)();return(0,A.D)({mutationFn:async r=>{const a=r?D:w,n=await(0,E.J)(t,a,{uri:e}),s=null==n?void 0:n.data;if(s)return function(e){let r;if("preSavePreReleaseToLibrary"in e&&"PreReleasePayload"===e.preSavePreReleaseToLibrary.__typename)r=e.preSavePreReleaseToLibrary.preRelease;else{if(!("removePreReleaseFromLibrary"in e)||"PreReleasePayload"!==e.removePreReleaseFromLibrary.__typename)return;r=e.removePreReleaseFromLibrary.preRelease}switch(r.__typename){case"PreRelease":return r.preSaved;case"NotFound":return!1;case"GenericError":return;default:return void(0,I._)(r)}}(s)},onSuccess:e=>{"boolean"==typeof e&&(e&&a(o.ag.get("web-player.album-prerelease.feedback_presaved")),r(e))}})};const M=e=>{let{uri:r}=e;const{isPreSaved:t,isLoading:a,addPresave:n,removePresave:s}=(e=>{const{isPreSaved:r,invalidate:t,isLoading:a}=L(e),{mutate:n,isPending:s}=N(e,t);return{isPreSaved:r,isLoading:a||s,addPresave:(0,v.useCallback)((()=>n(!0)),[n]),removePresave:(0,v.useCallback)((()=>n(!1)),[n])}})(r),{spec:i,logger:l}=(0,g.fU)(m.j,{data:{uri:r}}),c=()=>{l.logInteraction(i.actionBarFactory().preSaveButtonFactory().hitRemovePresave({prereleaseId:r,itemToBeRemovedFromPresaved:r,contextUri:r})),s()};return t?(0,h.jsx)(j.P,{disabled:a,onClick:c,children:o.ag.get("web-player.album-prerelease.presaved")}):(0,h.jsx)(P.x,{uri:r,action:R.sr.SAVE_PRERELEASE,children:(0,h.jsx)(f.D,{disabled:a,onClick:()=>{l.logInteraction(i.actionBarFactory().preSaveButtonFactory().hitPresave({prereleaseId:r,itemToBePresaved:r,contextUri:r})),n()},children:o.ag.get("web-player.album-prerelease.presave")})})};var B=t(15842),H=t(66205),O=t(97013),Q=t(16476),q=t(66819);const Z=e=>{var r,t,a;let{prerelease:n,backgroundColor:s}=e;const i=function(e){const[r,t]=(0,v.useState)((()=>!!e&&b(e)<=0));return(0,v.useEffect)((()=>{if(!e)return;const r=b(e);if(r<=0)return void t(!0);if(r>=36e5)return void t(!1);const a=setTimeout((()=>{t(!0)}),r);return()=>{clearTimeout(a)}}),[e]),r}(n.releaseDate),{spec:l,UBIFragment:c}=(0,g.fU)(m.j,{data:{uri:n.uri}}),u=(0,q.j)();return(0,h.jsx)(B.o,{backgroundColor:s,children:(0,h.jsxs)(H.F,{children:[i?(0,h.jsx)(y,{uri:null===(r=n.content)||void 0===r?void 0:r.uri}):(0,h.jsx)(M,{uri:n.uri}),(0,h.jsx)(c,{spec:l,children:(0,h.jsx)(p.yj,{menu:(0,h.jsx)(Q.v,{uri:n.uri,artistUri:null===(t=n.content)||void 0===t?void 0:t.artists[0].uri}),children:(0,h.jsx)(O.z,{label:o.ag.get("more.label.context",null===(a=n.content)||void 0===a?void 0:a.name),size:u})})})]})})};var z=t(61058),G=t(97583),W=t(93421);const J="J9GZWbcqWAQBbj0mGgBp",K="MnacN8FHHYBeSU8hx4U8",Y="HBgE42egR1M0MoBZt7MA",$="l5yLFFUEplqPqkpdgn2z",X="g0_tYvLXcZhPQLQuecrg",V="gjeF0mGZlmvlsLy5SvfQ",ee=e=>{let{value:r,label:t,hasDivider:a=!1}=e;return(0,h.jsxs)("div",{className:Y,"aria-hidden":"true",children:[(0,h.jsx)(i.x,{variant:"titleSmall",className:n()({[X]:a}),children:r}),(0,h.jsx)(i.x,{variant:"marginal",semanticColor:"textSubdued",children:t})]})};var re=t(3601);const te=1e3,ae=60*te,ne=60*ae,se=24*ne;const ie={days:0,hours:0,minutes:0,seconds:0};function le(e){return e>0?function(e){const r=Math.abs(e);return{days:Math.floor(r/se),hours:Math.floor(r%se/ne),minutes:Math.floor(r%ne/ae),seconds:Math.floor(r%ae/te)}}(e):ie}const oe=e=>{let{targetDate:r,className:t,onComplete:a,images:s,imageTitle:i}=e;const{days:l,hours:c,minutes:u,seconds:m}=((e,r)=>{const t=(0,v.useRef)(r);t.current=r;const[a,n]=(0,v.useState)((()=>le(b(e))));return(0,re.Y)((r=>{const a=b(e),s=le(a);var i;n(s),a<=0&&(r(),null===(i=t.current)||void 0===i||i.call(t))}),1e3),a})(r,a),p=void 0!==s&&s.length>0&&i,g=o.ag.get("web-player.album-prerelease.countdown_label",{days:l,hours:c,minutes:u,seconds:m});return(0,h.jsxs)("div",{className:n()(J,t,{[K]:p}),role:"timer",children:[(0,h.jsx)("span",{className:V,children:g}),p&&(0,h.jsx)(W.O,{images:s,type:d.p.ALBUM,shape:W.K.ROUNDED_CORNERS,className:$,title:i}),(0,h.jsx)(ee,{value:l,label:o.ag.get("web-player.album-prerelease.days",l),hasDivider:!0}),(0,h.jsx)(ee,{value:c,label:o.ag.get("web-player.album-prerelease.hours",c),hasDivider:!0}),(0,h.jsx)(ee,{value:u,label:o.ag.get("web-player.album-prerelease.minutes",u),hasDivider:!0}),(0,h.jsx)(ee,{value:m,label:o.ag.get("web-player.album-prerelease.seconds",m)})]})};var ce=t(62182),ue=t(81639),de=t(16118),ve=t(36637);const me="xjbmV4vvBCu7c5U6nAgL",pe=e=>{var r;let{prerelease:t,children:a}=e;return(0,h.jsx)(p._P,{menu:(0,h.jsx)(Q.v,{uri:t.uri,artistUri:null===(r=t.content)||void 0===r?void 0:r.artists[0].uri}),children:a})},ge=e=>{let{prerelease:r,backgroundColor:t}=e;const{content:a,releaseDate:n}=r,s=(0,z.jh)(),i=s===z.Uo.SMALL||s===z.Uo.XSMALL,{spec:l,logger:o}=(0,g.fU)(m.j,{data:{uri:r.uri}}),c=(0,v.useCallback)(((e,r)=>{if(l){const e=l.headerFactory().artistNameFactory().hitUiNavigate({destination:r.creator.uri});o.logInteraction(e)}}),[o,l]),u=a,d=(0,v.useMemo)((()=>n?new Date(n):void 0),[n]);return(0,h.jsxs)(ce.gF,{backgroundColor:t,size:ce.fR.LARGE,children:[(0,h.jsx)(ue.W,{children:u.name?(0,h.jsx)(de.i,{text:u.name}):null}),!i&&(0,h.jsx)(pe,{prerelease:r,children:(0,h.jsx)(ce.Oz,{images:u.coverArt.sources,name:u.name??"",placeholderType:"album"})}),(0,h.jsxs)(ce.sP,{children:[(0,h.jsx)(ve.g,{children:(0,G.R)(u.type)}),(0,h.jsx)(pe,{prerelease:r,children:(0,h.jsx)(ce.xd,{scaleAtMinWidth:ce.Fi,children:u.name})}),(0,h.jsx)(ce.QS,{creators:u.artists,onCreatorClick:c,releaseDate:n,timeZone:r.timezone}),d&&u.name?(0,h.jsx)(oe,{images:i?u.coverArt.sources:[],className:me,imageTitle:u.name,targetDate:d}):null]})]})};var be=t(36199),fe=t(61046),xe=t(73928);const he=new S.o("albumPreReleaseTracks","query","57be1f8d98e931e2b072477e574702caa67263d4ee779bc9bf4d9b0727b5effe",null),ye={totalLength:0,items:[]};function je(e){const r=e.preReleaseContent,t=[];if(null!=r&&r.tracks)for(const i of r.tracks.items){var a,n,s;t.push({uri:i.uri,name:i.name?i.name:"",isPlayable:i.playability.playable,durationMs:(null===(a=i.duration)||void 0===a?void 0:a.totalMilliseconds)??0,artists:Pe(i.artists.items),isExplicit:(null===(n=i.contentRating)||void 0===n?void 0:n.label)===xe.KS.Explicit,is19PlusOnly:(null===(s=i.contentRating)||void 0===s?void 0:s.label)===xe.KS.NineteenPlus})}return{totalLength:(null==r?void 0:r.tracks.totalCount)??0,items:t}}function Pe(e){const r=[];for(const t of e)"Artist"===t.data.__typename&&r.push({name:t.data.profile.name,uri:t.data.uri});return r}const Re=[be.QD.INDEX,be.QD.TITLE_AND_ARTIST,be.QD.DURATION],ke=v.memo((function(e){let{ariaLabel:r,nrTracks:t,prereleaseUri:a,highlightUri:n,scrollToIndex:s,usePlayContextItem:i,hasHeaderRow:l=!0,initalTracks:o}=e;const{spec:c,UBIFragment:u}=(0,g.fU)(m.j,{data:{uri:a}}),d=(e=>{const{request:r}=(0,v.useContext)(U.Ax);return(0,v.useCallback)((async(t,a)=>{const n=await r(he,{uri:e,offset:t,limit:a});for(const r of(null==n||null===(s=n.data)||void 0===s?void 0:s.lookup)||[]){var s;if("PreReleaseResponseWrapper"===r.__typename&&"PreRelease"===r.data.__typename&&r.data.uri===e)return je(r.data)}return ye}),[r,e])})(a),p=(0,v.useRef)(!1),b=(0,v.useRef)(null),[f,x]=(0,v.useState)(null),y=(0,v.useCallback)((e=>({uri:e.uri})),[]);(0,v.useEffect)((()=>{b.current&&(f?b.current.scrollToIndex(f):s&&b.current.scrollToIndex(s))}),[f,s]);const j=(0,v.useCallback)((async(e,r)=>{const t=await d(e,r);if(n&&!f){const e=t.items.findIndex((e=>(null==e?void 0:e.uri)===n));x(e||-1)}return t}),[d,n,f]),P=(0,v.useCallback)(((e,r)=>{const t=!p.current&&!!n&&n===e.uri;return t&&(p.current=!0),(0,h.jsx)(be.Ym,{uri:e.uri,isPlayable:e.isPlayable,name:e.name,trackNumber:r+1,index:r,artists:e.artists,playcount:0,contextUri:a,duration_ms:e.durationMs,usePlayContextItem:i,isMOGEFRestricted:e.is19PlusOnly,isExplicit:e.isExplicit,shouldHighLight:t,isReleased:e.isPlayable},r+e.uri)}),[n,a,i]);return(0,h.jsx)(u,{spec:c,children:(0,h.jsx)(fe.a,{columns:Re,children:(0,h.jsx)(be.Pv,{ariaLabel:r,columns:Re,hasHeaderRow:l,rowPlaceholder:be.uD,renderRow:P,resolveItem:y,nrTracks:t,fetchTracks:j,limit:300,tracks:o,outerRef:b,columnPersistenceKey:"album-tracklist"},a)})})}));var Ce=t(60162),Se=t(91643),Te=t(96989);t(80378);const _e=new S.o("albumPreRelease","query","c615072be1ea66088acb9956daf195890cedc9ea9e0a8fc6828dc73a920d9be8",null),De=(e,r)=>(0,T.a)(_e,e,r);function we(e){return e.includes("℗")?{type:"P",text:e}:{type:"C",text:e}}function Le(e){var r;const t=e.preReleaseContent;let a;if(t){var n,s,i;const r=je(e);a={artists:Ae(t.artists.items),name:t.name??void 0,uri:t.uri,coverArt:{extractedColors:null===(n=t.coverArt)||void 0===n||null===(n=n.extractedColors)||void 0===n?void 0:n.colorRaw,sources:(null===(s=t.coverArt)||void 0===s?void 0:s.sources)??[]},type:t.type,tracks:r,copyrights:(null===(i=t.copyright)||void 0===i?void 0:i.split("\n").map(we))??[]}}return{uri:e.uri,releaseDate:null===(r=e.releaseDate)||void 0===r?void 0:r.isoString,timezone:e.timezone??void 0,content:a}}function Ae(e){const r=[];for(const a of e){var t;if("Artist"===a.data.__typename)r.push({name:a.data.profile.name,id:a.data.id,uri:a.data.uri,images:(null===(t=a.data.visuals.avatarImage)||void 0===t?void 0:t.sources)??[]})}return r}var Ue=t(98716);const Ee="H2kQJCtEGTjIDaPPniwb",Ie="ZSU92ZH1fIuGwPp1cuDi",Fe=e=>{var r,t,a,m,p,g,f,x,y;const{uri:j}=e,{prerelease:P,loading:R,error:S}=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De;const{data:t,loading:a,error:n}=r({uri:e},{staleTime:k,gcTime:C});return{loading:a,error:!!n,prerelease:(0,v.useMemo)((()=>{if(!t)return null;for(const r of t.lookup)if("PreReleaseResponseWrapper"===r.__typename&&"PreRelease"===r.data.__typename&&r.data.uri===e)return Le(r.data);return null}),[t,e])}}(j),T=(e=>{var r;const t=null==e||null===(r=e.content)||void 0===r||null===(r=r.coverArt.extractedColors)||void 0===r?void 0:r.hex;return(0,Ue.Y)(t),t})(P),_=parseInt(new URLSearchParams((0,s.TH)().search).get("index")||"0",10),{usePlayContextItem:D}=(0,u.n)({uri:j,pages:[{items:(w=(null==P||null===(r=P.content)||void 0===r?void 0:r.tracks.items)||[],w.filter((e=>e.isPlayable)).map((e=>({uri:e.uri,uid:null,type:d.p.TRACK,provider:null}))))}]},{featureIdentifier:"album_prerelease"});var w;if(R||S||!P)return(0,h.jsx)(Se.h,{hasError:!!S,errorMessage:o.ag.get("error.not_found.title.album")});if(null!=P&&null!==(t=P.content)&&void 0!==t&&t.uri&&function(e,r){var t;if(null===(t=e.content)||void 0===t||!t.uri||!e.releaseDate)return!1;const a=b(e.releaseDate);if(a>0)return!1;return a<=-1*r}(P,1728e5)){var L;const e=(0,l._b)(null==P||null===(L=P.content)||void 0===L?void 0:L.uri);if(e)return(0,h.jsx)(Te.InstrumentedRedirect,{to:e.toURLPath(!0)})}return(0,h.jsxs)("section",{className:Ee,children:[(0,h.jsx)(Ce.$,{children:o.ag.get("album.page-title",(null===(a=P.content)||void 0===a?void 0:a.name)??"")}),(0,h.jsx)(ge,{prerelease:P,backgroundColor:T}),(0,h.jsx)(Z,{prerelease:P,backgroundColor:T}),null!==(m=P.content)&&void 0!==m&&m.tracks.totalLength?(0,h.jsxs)("div",{className:"contentSpacing",children:[(0,h.jsx)(i.x,{as:"h2",variant:"titleSmall",semanticColor:"textBase",children:o.ag.get("web-player.album-prerelease.tracklist_preview")}),(0,h.jsx)(ke,{prereleaseUri:j,ariaLabel:(null===(p=P.content)||void 0===p?void 0:p.name)??o.ag.get("error.not_found.title.album"),nrTracks:(null===(g=P.content)||void 0===g?void 0:g.tracks.totalLength)??0,scrollToIndex:_,usePlayContextItem:D,initalTracks:null===(f=P.content)||void 0===f?void 0:f.tracks.items,albumUri:null===(x=P.content)||void 0===x?void 0:x.uri})]}):null,(0,h.jsx)("div",{className:n()(Ie,"contentSpacing"),children:(0,h.jsx)(c.k,{copyrights:(null===(y=P.content)||void 0===y?void 0:y.copyrights)??[]})})]})}},66713:(e,r,t)=>{t.d(r,{k:()=>i});t(75930),t(92027),t(86277);var a=t(58206);const n="rTMkDBDp47Eo12ZEQv4U";var s=t(11527);const i=e=>{let{copyrights:r,courtesyLine:t}=e;const i=(r||[]).map(((e,r)=>{const t=e.text.replace(/^(\(C\)\s+)/,"").replace(/^(\(P\)\s+)/,"").replace(/^(©\s+)/,"").replace(/^(℗\s+)/,"");let n;return n="C"===e.type?"©":"P"===e.type?"℗":`(${e.type})`,(0,s.jsx)(a.D,{as:"p",variant:"finale",dir:"auto",children:`${n} ${t}`},r)}));return t&&i.unshift((0,s.jsx)(a.D,{as:"p",variant:"finale",dir:"auto",children:t},i.length)),(0,s.jsx)("div",{className:n,children:i})}}}]);
//# sourceMappingURL=xpui-routes-album-prerelease.05eb993e.js.map