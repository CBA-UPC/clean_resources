!function(){ window.UBT_LOADTIMES = (window.UBT_LOADTIMES||0) + 1;if(window.UBT_LOADTIMES >1){console.log("UBT_LOADTIMES:"+window.UBT_LOADTIMES);return;}var t={1434:function(t,e){"use strict";var r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";e.Z=function(t){try{var e=Math.random().toString(16).slice(-4);if(t<=4)return e.slice(0,t);for(var n="",o=0;o<t-e.length;o++){var i=Math.ceil(Math.random()*(r.length-1));n+=r[i]}return e+n}catch(t){console.error("genRandomStr error.",t)}}},3434:function(t,e){"use strict";var r,n;e.Z=(r=16384,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",function(t){var e=[];t=unescape(encodeURIComponent(t));for(var o=0;o<t.length;o++)e.push(t.charCodeAt(o));return function(t){var e=[],o=[],i=-1,a=0,c=0,s=0,u=0,f=[];g(19);for(var l=0;l<t.length&&c<t.length;l+=r)l>0&&(o=o.slice(r)),p();return-1!=i&&y(),2==u?(b(s<<4&63),65==n.length&&(b(64),b(64))):4==u&&(b(s<<2&63),65==n.length&&b(64)),f.join("");function p(){for(var n=d(l+32768,t.length),s=d(n,t.length-3+1);c<n;c++){var u=0,f=0;if(c<s){var p=h();if(c>=a)for(var b=e[p]-1;130!=u&&b>=0&&b>=c-r;){var m=v(b);m>=3&&m>u&&(f=c-b-(u=m)),b=o[b-l]}o[c-l]=e[p]-1,e[p]=c+1}if(u>=3){for(a=c+u,-1!=i&&(y(),i=-1),g(u-3);f>127;)g(255&(127&f|128)),f>>=7;g(f)}else c>=a&&-1==i&&(i=c)}}unction h(){for(var e=0,r=c;r<c+3;r++)e*=16777619,e^=t[r];return 16383&e}function v(e){var r,n,o=d(e+130,c);for(r=e,n=c;r<o&&n<t.length&&t[r]==t[n];r++,n++);return r-e}function y(){for(var e=i;e<c;e+=127){var r=d(127,c-e);g(255&-r);for(var n=e;n<c&&n<e+r;n++)g(t[n])}}function g(t){var e=s<<6-u;b(63&(e|=(s=255&t)>>(u+=2))),u>=6&&b(63&(e=s>>(u-=6)))}(e)})},3367:4650:function(t,e,r){"use strict";r.r(e);var n={client:{},webClient:{},miniAppClient:{},mini:{},clientType:"",clientInfo:{},watcher:{}};r(1299),r(2419),r(7941),r(2526),r(5003),r(9337),r(3321),r(9070);(x);r(3843),r(3710),r(4916),r(7601),r(4723),r(9601),r(1038),r(8783),r(6992),r(1539),r(3948),r(2772),r(2222),r(8862),r(7042),r(2564),r(8674),r(1249),r(7327),r(2479),r(6699),r(7658),r(5306),r(4603),r(8450),r(8386),r(9714),r(189),r(9554),r(4747),r(4765),r(9600);1058),r(9753),r(2023);var I={});r(1532);var _=function(){function t(){d(this,t),E(this,"watchingMap",new Map),E(this,"triggeredMap",new Map)}return y(t,[{key:"watch",value:function(t,e){var r=this;if(e=Array.isArray(e)?e:[e],this.triggeredMap.has(t)){var n=this.triggeredMap.get(t);e.forEach(()}else if(this.watchingMap.has(t)){var o=this.watchingMap.get(t)||[];o.push.apply(o,k(e)),this.watchingMap.set(t,o)}else this.watchingMap.set(t,e)}},{key:"trigger",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=Array.prototype.shift.call(arguments),o=this.watchingMap.get(n);if(this.triggeredMap.set(n,arguments),!o||0===o.length)return!1;for(var i,a=0;i=o[a++];)i.apply(this,arguments);this.watchingMap.delete(n)}},{key:"getTriggeredVal",value:function(t){if(this.triggeredMap.has(t)){var e=this.triggeredMap.get(t);if(null!=e)return Array.from(e)[0]}return null}},{key:"remove",value:]),t}(),R=_;8309),r(9826),r(561),r(1703),r(6647);var A,C,L,B=null===(A="1.1.76             ")?void 0:A.replace(/(\s*$)/,""),U=null===(C="171564/55344       ")?void 0:C.replace(/(\s*$)/,""),M={enterTs:Date.now(),instMap:new Map,curInst:null,version:B,summary:{resouceSize:parseInt(U.split("/")[0])||0,gzipSize:parseInt(U.split("/")[1])||0},setInst:function(t,e){try{if(M.curInst=e,M.instMap.size>=5){var r=M.instMap.keys().next().value;M.instMap.delete(r)}M.instMap.set(t,e)}catch(t){Xt.printError("setInst err.",t)}},registerTime:0},D=[],N=M.summary;N.tag={sdkVersion:M.version,npmVersion:(null===(L=M.ubtCom)||void 0===L?void 0:L.version)||""};var F=M,V={UBT_LASTVIEW:"UBT_LASTVIEW",BFA_LS:"UBT_BFA",OLD_MINI_BFA_LS:"CTRIP_UBT_M",UBT:"UBTPending",BFA_COOKIE:"_bfa",VID_COOKIE:"UBT_VID",UBT_DESERTED:"UBT_DESERTED",UBT_UNHANDLED:"UBT_UNHANDLED",UBT_MAGNET:"UBT_MAGNET",UBT_CID:"UBT_CID",UBT_CONFIG:"UBT_CONFIG"},G={BFA:/^1\.\d+\..{3,12}\.1\.\d+\.\d+\.\d+\.\d+\..+$/,VID:/^\d{10,13}\.[a-zA-Z0-9]{3,12}$/,UBT_LSKEY:new RegExp("^"+V.UBT+"_.+$","g"),TEST_ENV:/(\.qa\.nt\.)|(localhost|172\.16|127\.0|10\.15|10\.32)|(\.uat\.)|(\.fws\.)|(\.fat\d*\.)|(\.tripqate\.)|(\.(beta|dev)\.qunar\.)/i,TRIP:/\.trip/gi,INTRANET:/\.ctripcorp\./gi,MOBILE:/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i,TRIP_APP:/(ibuctrip)|(trip\.com_ctripwireless)/i,CTRIP_APP:/ctripwireless/i,UBTC:/^ubtc_([a-zA-Z](_?[a-zA-Z0-9]{1,20}){0,3})$/,PAGE_ID:/^[a-zA-Z0-9_]{1,50}$/},K={COOKIE_MAX:3456e7,BFS:18e5,MAGNET:3e5},q=1e4,z=30,J=["o_page_render_check","http_request_perf"],H={repeatErrorDuration:6e4,multiSendIntervalTime:1e3,logReportIt:2e3,multiSendMaxCount:50,fpVersion:"*",tcpSwitch:!1,processChunkCount:20,requestConcurrenceMaxCount:20,mpStoreMaxCount:50,storageMaxSize:2097152};function $(t,e){return null==t?0:("number"==typeof t&&(t=t.toString()),parseInt(t,e))}function W(t){switch(Object.prototype.toString.call(t)){case"[object Number]":return isNaN(t)?ne.NaN:ne.Number;case"[object Boolean]":return ne.Boolean;case"[object String]":return ne.String;case"[object Array]":return ne.Array;case"[object Object]":return ne.Object;case"[object Undefined]":return ne.Undefined;case"[object RegExp]":return ne.RegExp;case"[object Error]":return ne.Error;case"[object Function]":return ne.Function;default:return ne.Unknown}}function Q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!t)return e;var r=JSON.parse(t);return e&&Object.prototype.toString.call(e)!=Object.prototype.toString.call(r)?e:r}catch(t){return e}}function Y(t,e){var r,n=!1,o=return function(){for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];var s=a[a.length-1]===ot;s&&a.pop(),s||!n?(n=!0,t.apply(void 0,a),setTimeout(o,e)):r=a}}var X=1,Z=2,tt=3;function et(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==t||null==t?null:((e&X)==X&&(t=decodeURIComponent(t||"")),(e&Z)==Z&&(t=function(t){for(var e={},r=t.split("&")||[],n=0;n<r.length;n++){var o=r[n].split("=");o.length>1&&(e[o[0]]=o[1])}return e||{}}(t)),(e&tt)==tt&&(t=Q(t)),t)}function rt(t,e,r,n,o){!function i(){try{var a=0;if(t&&t.length>0)for(var c=t[0];c&&a<=e;)r(c),a++,t.shift(),c=t[0];o&&o(),t&&t.length>0?setTimeout((,0):n&&n()}catch(t){Xt.reportError("unitTask error.",t)}}()}var nt,ot="force-exec",it=r(1434),at=(nt="",function(t){return nt||(nt=t.isProd?t.isTrip?"https://www.trip.com":t.isLAN?"//apigateway.ctripcorp.com":t.isIPV6?"//upgrade-m.ctrip.com":"//m.ctrip.com":"//gateway.m.fws.qa.nt.ctripcorp.com")});function ct(t,e){return e||!t.isProd?"//s.uat.qa.nt.ctripcorp.com":t.isTrip?"//ubt-sin.tripcdn.com":"//s.c-ctrip.com"}function st(t){return t.isProd?t.isTrip?"//webresource.tripcdn.com":"//webresource.c-ctrip.com":t.isTrip?"//webresource.english.uat.qa.nt.ctripcorp.com":"//webresource.uat.qa.nt.ctripcorp.com"}function ut(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!t.isFile&&"mini"!=t.clientType||e?"":"https:"}function ft(t){var e=at(t),r=ut(t,e.indexOf("http")>0);return"".concat(r).concat(e,"/restapi/soa2/18088/getAppConfig.json")}function lt(t){var e=ut(t),r=at(t);return"".concat(e).concat(r,"/restapi/soa2/12538/createClientId")}function pt(t,e){var r=ut(t),n=ct(t,e);return"".concat(r).concat(n,"/bf.gif")}function dt(t,e){var r=ut(t),n=ct(t,e);return"".concat(r).concat(n,"/bee/collect")}function ht(t){var e=ut(t);return t.isProd?t.isTrip?"".concat(e,"//www.trip.com/restapi/soa2/25894/json/reportUbtLog"):"".concat(e,"//m.ctrip.com/restapi/soa2/25894/json/reportUbtLog"):"".concat(e,"//m.uat.ctripqa.com/restapi/soa2/25894/reportUbtLog")}r(4812);var vt,yt={context:["pid","vid","sid","pvid","version","appId","deviceImei","deviceMac","env","clientId","url","fromPage","fromPvid","fromSid","screenWidth","screenHeight","cookieLength","cookieCount","storageLength","lang","engine","referrer","appInfo","devicePixelRatio","other","idc","rid","fp","ffp","trafficSource","newVisitor","newSession"],user:["userId","abTest","corpid","duid"],business:["allianceId","allianceSid","allianceOuid","allianceCreateTime","sourceId","orderId","productId","innerOuId","innerSid","pushCode","attrs"],ubtList:["seq","triggerTs","type","subType","data"]},gt=(E(vt={},I.ERROR,"error"),E(vt,I.USER_BLOCK,"ub"),E(vt,I.TRACE,"tiled_tl"),E(vt,I.DEV_TRACE,"tiled_tl"),E(vt,I.PRIVATE_TRACE,"pr_t"),vt),bt=r(3434);function mt(t,e){return wt.apply(this,arguments)}function wt(){return(wt=p(S().mark((function t(e,r){var o,i,a;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=JSON.stringify({d:e}),i=dt(n.clientInfo,r),t.prev=2,!n.clientInfo.isSupportSendBeacon||!n.client.reportBySendBeacon){t.next=5;break}return t.abrupt("return",n.client.reportBySendBeacon(o,i));case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),n.clientInfo.isSupportSendBeacon=!1;case 10:return t.next=12,n.client.request({body:o,url:i},q);case 12:if(!(a=t.sent).success||200!=a.data.status){t.next=17;break}return t.abrupt("return",{success:!0});case 17:return t.abrupt("return",{success:!1,message:"postReport Faild."});case 18:case"end":return t.stop()}}),t,null,[[2,7]])})))).apply(this,arguments)}unction Et(){return(Et=p(S().mark((function t(e,r){var o;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.client.imgRequest({body:e,headers:{"Content-Type":"image/gif"},url:pt(n.clientInfo,r)});case 2:return o=t.sent,t.abrupt("return",o);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xt(t){var e={},r=function(){var r=[],o=t[n],i=yt[n];if(!i)return e[n]=o,"continue";Array.isArray(o)?o.forEach((function(t){var e=[];i.forEach((function(r,n){e[n]=t[r]})),r.push(e)})):i.forEach((function(t,e){r[e]=o[t]})),e[n]=r};for(var n in t)r();return e}unction Tt(){return(Tt=p(S().mark((function t(e,r,o){var i,a,c,s;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,Xt.log4Checking({tag:"report",data:e,ts:Date.now()}),!o&&n.client.reportMagenet&&n.client.reportMagenet((),(i=xt(e)).sendTs=Date.now(),"tcp"!=r||!n.client.reportByTcp){t.next=7;break}return t.abrupt("return",n.client.reportByTcp(i));case 7:if(a=(0,bt.Z)(JSON.stringify(i)),c="ac=b&d=".concat(a),"single"!=r){t.next=11;break}return t.abrupt("return",Ot(c,o));case 11:return s="f00".concat(i.sendTs,"!m1Legacy!").concat(c),t.abrupt("return",mt(s,o));case 15:return t.prev=15,t.t0=t.catch(0),Xt.reportError("send error.",t.t0),t.abrupt("return",{success:!1,message:null===t.t0||void 0===t.t0?void 0:t.t0.message});case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))).apply(this,arguments)}function kt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function It(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?kt(Object(r),!0).forEach((function(e){E(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var _t=function(){function t(){d(this,t),this.pendingPushQ=new Map,this.pendingSendQ=new Map,this.sendingCount=0}var e,r;return y(t,[{key:"push",value:function(t,e){try{var r;if(e.type==I.PV||t.pvSend)return this.send(t,e),!0;if(this.pendingPushQ.has(t)&&Array.isArray(this.pendingPushQ.get(t)))null===(r=this.pendingPushQ.get(t))||void 0===r||r.push(e);else this.pendingPushQ.set(t,[e]);return!0}catch(e){return Xt.reportError("multiSender push error.",e,t.instKey),!1}}},{key:"send",value:(r=p(S().mark((function t(e,r){var n,o;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="".concat(e.instKey,"_").concat(r.seq),!(this.sendingCount>=H.requestConcurrenceMaxCount)){t.next=6;break}return this.pendingSendQ.set(n,[e,r]),t.abrupt("return",!0);case 6:this.pendingSendQ.has(n)&&this.pendingSendQ.delete(n);case 7:return this.sendingCount++,t.next=10,St(It({ubtList:[r]},e.getCommon()),"single");case 10:return o=t.sent,this.completeSend(e,r,o),t.abrupt("return",o.success);case 13:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"completeSend",value:(e=p(S().mark((function t(e,r,n){var o,i,a,c,u,f=this;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sendingCount--,r.type!=I.PV||null==n||!n.success){t.next=8;break}if(e.pvSend=!0,!this.pendingPushQ.has(e)){t.next=8;break}return o=this.pendingPushQ.get(e)||[],t.next=7,Promise.all(o.map(());case 7:this.pendingPushQ.set(e,[]);case 8:if(!(i=Array.from(this.pendingSendQ.values())[0])){t.next=13;break}return a=s(i,2),c=a[0],u=a[1],t.next=13,this.send(c,u);case 13:case"end":return t.stop()}}),t,this)}))),},{key:"start",value:function(){}},{key:"close",value:function(){}},{key:"restart",value:function(){}}],[{key:"getIntance",value:function(){return this._instance||(this._instance=new t),this._instance}}]),t}(),Rt=_t;function Pt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function jt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Pt(Object(r),!0).forEach((function(e){E(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var At=Q,Ct="pv",Lt=function(){ar e;return y(t,[{key:"push",value:function(t,e){try{if(!n.client.checkLsPush())return this.senderReplacer=this.senderReplacer||Rt.getIntance(),this.senderReplacer.push(t,e);var r=t.instKey,o=t.getCommon(),i=e.type==I.PV,a="".concat(V.UBT,"_").concat(r),c=i?Ct:e.seq+"",s=n.client.getLs(a,!0);s&&s.ubts?s.ubts[c]=e:s={common:o,ubts:E({},c,e)};var u=JSON.stringify(s);return this.usedSize=u.length,n.client.setLs(a,u),(i||Object.keys(s.ubts||{}).length>=H.multiSendMaxCount)&&this.send(new Map([[a,s]])),!0}catch(e){return Xt.reportError("multiSender push error.",e,t.instKey),!1}}},{key:"beforeSend",value:function(t,e){var r=this;if(t&&e&&0!=e.length){e.forEach(();var o=n.client.getLs(t,!0);if(o){var i=o.ubts||{};e.forEach((function(t){delete i[t]})),0==Object.keys(i).length?n.client.removeLs(t):n.client.setLs(t,JSON.stringify(o)),this.usedSize=JSON.stringify(o).length}}}},{key:"completeSend",value:function(t,e){var r=this;t&&e&&0!=e.length&&e.forEach((function(e){if(r.sendingKeys.delete("".concat(t,"_").concat(e)),e==Ct){var n=t.split("_")[1],o=F.instMap.get(n);o&&(o.pvSend=!0)}}))}},{key:"getNextSendingItems",value:function(t){var e=this,r=new Map;try{var o=0,i=!1;return n.client.iterateLsKeys((function(t){if(t&&G.UBT_LSKEY.test(t)){var a=At(n.client.getLs(t)),c=(null==a?void 0:a.ubts)||{};a&&c&&0!=Object.keys(c).length||n.client.removeLs(t);var s={};if(!i)for(var u in c){if(o>=H.multiSendMaxCount)break;e.sendingKeys.has("".concat(t,"_").concat(u))||(s[u]=c[u],u!=Ct&&(i=!0,o++))}!(Ct in c)||Ct in s||e.sendingKeys.has("".concat(t,"_").concat(Ct))||(s[Ct]=c[Ct]),Object.keys(s).length>0&&r.set(t,{common:a.common,ubts:s})}})),r}catch(e){return Xt.reportError("getNextSendingItems error.",e,t),null}}},{key:"send",value:(e=p(S().mark((function t(e){var r,n=this;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],e.forEach((function(t,e){var n=t.ubts||{};Ct in n&&(r.push({lsKey:e,subKeys:[Ct],request:jt(jt({},t.common),{},{ubtList:[n[Ct]]})}),delete n[Ct]),Object.keys(n).length>0&&r.push({lsKey:e,subKeys:Object.keys(n),request:jt(jt({},t.common),{},{ubtList:Object.values(n)})})})),t.next=4,Promise.all(r.map(function(){var t=p(S().mark((function t(e){var r,o,i,a;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.lsKey,o=e.subKeys,i=e.request,n.beforeSend(r,o),t.next=4,St(i,"multi");case 4:(a=t.sent)&&a.success&&n.completeSend(r,o);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 4:return t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"scheduleSend",value:function(t,e){try{var r=this.getNextSendingItems(t);return r&&r.size>0&&(this.send(r),e&&this.scheduleSend(t,!0)),this.scheduleSend.bind(this)}catch(t){Xt.reportError("scheduleSend error.",t)}}},{key:"start",value:function(t){return!!n.clientInfo.isSupportLS&&(null!=this.timer||(this.timer=setInterval(this.scheduleSend.call(this,t),H.multiSendIntervalTime)),!0)}},{key:"close",value:function(t){n.clientInfo.isSupportLS&&null!=this.timer&&(clearInterval(this.timer),this.scheduleSend(t,!0))}},{key:"restart",value:],[{key:"getIntance",value:]),t}(),Bt=Lt,Ut=["pageId"],Mt=["orderId","productId","loginName","url","isBack","refer","abTest"];function Dt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Nt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Dt(Object(r),!0).forEach((function(e){E(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Dt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Ft=function(){function t(e){var r=this;d(this,t),E(this,"updateSessionTs",Y((function(){var t=n.client.readBfa();r.bfa&&t.id==r.bfa.id&&t.sid==r.bfa.sid&&t.pvid==r.bfa.pvid&&(r.bfa.session_ts=Date.now(),n.client.writeBfa(r,!0))}),2e3));try{n.client.refreshClientEnv(),Xt.log4Checking({tag:"new ubt",data:e}),this.props=e,ce.ubtPropsCheck(e),this.cacheGroupKey=e.cacheGroupKey,this.appId=e.appId,this.business=e.business||{},this.pageId=this.verifyPageId(e.pageId,this.business),this.initSettings(e.settings),this.isTimeout4waitingFields=!1,this.reportedErrorSet=new Set,this.pendingQueue=[],this.beginTs=e.registerTs||Date.now(),this.instKey=e.instKey,this.nextSeqNum=1,this.sender=n.clientInfo.isSupportLS&&this.sendSetting.isMultiSend?Bt.getIntance():Rt.getIntance(),this.init(),$t.handleBfRegisterReq(this.instKey)}catch(t){var o;this.initInstFailed=!0,Xt.printError("init error.",t,{tag:"Ubt.constructor err",data:{props:e,err:t.stack}}),this.clearErrorTimer&&clearInterval(this.clearErrorTimer),null!==(o=this.sender)&&void 0!==o&&o.timer&&clearInterval(this.sender.timer)}}var e;return y(t,[{key:"initSettings",value:function(t){var e,r,n,o;t=t||{},this.sendSetting={waitingFields:null!==(e=t.waitingFields)&&void 0!==e?e:[],isMultiSend:null===(r=t.isMultiSend)||void 0===r||r,waitingTimes:null!==(n=t.waitingTimes)&&void 0!==n?n:1e4,bizTokenKeys:null!==(o=t.bizTokenKeys)&&void 0!==o?o:[],urlMaxLength:t.urlMaxLength||600,referrerMaxLength:t.referrerMaxLength||500,abTestMaxLength:t.abTestMaxLength||512}}},{key:"verifyPageId",value:function(t,e){return t&&!G.PAGE_ID.test(t)?(Xt.printError("PageId is invalid. PageId must contain a maximum of 50 uppercase and lowercase letters, digits, or underscores."),e.invalidPageId=t,"default_pageId"):t}},{key:"refreshPv",value:function(){this.beginTs=Date.now(),this.init(!1)}},{key:"init",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setBfa(),this.setCommon(),this.instKey||(this.instKey=this.genInstKey()),F.setInst(this.instKey,this),t&&this.initOnlyOnce(),this.send({type:I.PV},this.beginTs),this.sendFPMetric()}},{key:"initOnlyOnce",value:function(){var t=this;this.startClearErrorTimer(),this.sendSetting.waitingFields&&this.sendSetting.waitingFields.length>0&&setTimeout((,this.sendSetting.waitingTimes),this.sender.start(this.instKey)}},{key:"startClearErrorTimer",value:function(){var t=this;try{this.clearErrorTimer&&clearInterval(this.clearErrorTimer),this.clearErrorTimer=setInterval((,H.repeatErrorDuration)}catch(t){Xt.reportError("startClearErrorTimer error.",t,this.instKey)}}},{key:"genInstKey",value:function(){var t=this.common.context.vid.split(".")[1];return"".concat(this.beginTs,"_").concat(t)}},{key:"seqNum_autoAdd",get:,{key:"set",value:function(t){try{var e=t.pageId,r=f(t,Ut);if(e){var o=this.verifyPageId(e,this.business);this.pageId=o,this.bfa.pageId=o,n.client.writeBfa(this)}return Object.assign(this.business,r),this.setCommon(),this.readyCheck(),{success:!0,readyStatus:this.readyStatus}}catch(t){return Xt.reportError("UBT.set error.",t,this.instKey),{success:!1,message:null==t?void 0:t.message}}}},{key:"send",value:function(t,e){try{if(this.updateSessionTs(),!t)throw new Zt("send request is empty !");var r=t.type,o=t.data;if(e=e||(new Date).getTime(),n.client.distinctErr&&ce.isUbtErrorData(r,o)&&this.isRepeatError(o))return{success:!1,message:"error repeat."};ce.stringifySendData(t),ce.validateSendRequest(t);var i={seq:this.seqNum_autoAdd,type:r==I.USER_BLOCK?I.ERROR:r,subType:gt[r],triggerTs:e,data:ce.transformUbtData(t)};return this.pendingQueue.push(i),this.readyCheck(),{success:!0,readyStatus:this.readyStatus}}catch(t){return Xt.reportError("send error.",t,this.instKey),{success:!1,message:null==t?void 0:t.message}}}},{key:"getCommon",value:,{key:"readyCheck",value:function(){var t=!0;if(this.pageId){if(!this.readyStatus&&!this.isTimeout4waitingFields)for(var e=Array.from(new Set(k(this.sendSetting.waitingFields||[]))),r=0;r<e.length;r++){var n=e[r];if(void 0===this.business[n]){t=!1;break}}}else t=!1;return this.readyStatus=t,t&&this.handleReady(),t}},{key:"handleReady",value:(e=p(S().mark((function t(){var e=this;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.client.bindClientInfo(this);case 2:n.clientInfo.tcpReady?St(Nt(Nt({},this.common),{},{ubtList:this.pendingQueue}),"tcp"):this.pendingQueue.forEach((),this.pendingQueue=[];case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"isRepeatError",value:function(t){if(this.clearErrorTimer){var e=[t.category,t.message,t.file,t.line,t.column].toString();if(this.reportedErrorSet.has(e))return!0;this.reportedErrorSet.add(e)}return!1}},{key:"sendFPMetric",value:function(){var t=this;$t.get({name:"afp",handleResolve:function(e){e&&t.send({type:I.METRIC,key:"bbz_ubt_fp",data:{tag:e}})}})}},{key:"setCommon",value:function(){this.common={context:{},business:{},user:{}};try{var t,e,r,o,i={pid:this.pageId,vid:this.bfa.vid,sid:this.bfa.sid,pvid:this.bfa.pvid,version:"".concat(F.version).concat(n.client.sdkVerSuffix||""),appId:this.appId,fromPage:null===(t=this.lastView)||void 0===t?void 0:t.pageId,fromPvid:null===(e=this.lastView)||void 0===e?void 0:e.pvid,fromSid:null===(r=this.lastView)||void 0===r?void 0:r.sid,trafficSource:n.client.getTrafficSource(this),newVisitor:1==this.bfa.sid,newSession:1==this.bfa.pvid},a=this.business,c=a.orderId,s=a.productId,u=a.loginName,l=(a.url,a.isBack,a.refer,a.abTest,f(a,Mt)),p=Nt({enterTs:F.enterTs},l||{});null!==(o=F.ubtCom)&&void 0!==o&&o.symbol&&(p.npmVersion=F.ubtCom.version,p.npmEnterTs=F.ubtCom.enterTs),F.tcpReady&&(p.webVid=this.bfa.vid),"mini"==n.clientType&&(p.miniAppId=n.mini.appId),this.common={context:i,business:{orderId:c,productId:s,attrs:p},user:{userId:u}},n.client.bindClientInfo(this)}catch(t){Xt.reportError("setCommon error.",t,this.instKey)}}},{key:"setBfa",value:function(){var t=this.bfa=n.client.readBfa(),e=t.genVid();this.lastView="function"==typeof n.client.readLastView?n.client.readLastView(this):t,e||(e=n.clientInfo.vid),e&&G.VID.test(e)||(e=ce.genVidVal());var r=e.split(".");(Object.assign(t,{vid:e,vid_ts:parseInt(r[0]),id:r[1]}),t.sid&&t.pvid)?(this.beginTs-t.session_ts>K.BFS?(t.sid++,t.pvid=1):t.pvid++,t.lastSession_ts=t.session_ts,t.session_ts=this.beginTs):(t.lastSession_ts=this.beginTs,t.session_ts=this.beginTs,t.sid=1,t.pvid=1);return t.pageId=this.pageId,n.client.writeBfa(this),n.client.writeVID(e),t}}]),t}(),Vt=Ft,Gt="unknown",Kt=function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e=1,function(){for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];o[0]&&1==o[0].stop&&(e=r+1),e++>r||t.apply(void 0,o)}},qt=rt,zt={success:!0},Jt=function(t){return{success:!1,message:null==t?void 0:t.message}},Ht=function(){function t(){d(this,t)}return y(t,null,[{key:"findUbtInst",value:function(t,e){var r;return t?F.instMap.get(t):e?Array.from(F.instMap.values()).find(():null!==(r=F.curInst)&&void 0!==r&&r.cacheGroupKey?void 0:F.curInst}},{key:"ubtApiPush",value:function(e,r){try{if("boolean"==typeof e)return zt;if(Xt.log4Checking({tag:"push req",data:e}),!e||!e.type||!e.data)throw new Zt("Invalid push data.");var n=e.type,o=e.data,i=e.pvId,a=e.triggerTs,c=e.context,s=e.cacheGroupKey;if(function(t,e){return"register"==e}(0,n)){var u=o;return i&&(u.instKey=i),a&&(u.registerTs=a),c&&(u.context=c),u.cacheGroupKey=s,t.register(u)}if(function(t,e){return"get"==e}(0,n))return t.get(o,i);if(function(t,e){return"send"==e}(0,n))return t.sendPush(o,i,a,r,s);if(0,n))return t.setPush(o,i,r,s)}catch(t){Xt.reportError("Push error.",t)}}},{key:"handleBfRegisterReq",value:function(e){n.client.handleAfterRegister&&n.client.handleAfterRegister();var r=[];e!=Gt&&r.push(t.BF_REGISTER_MAP.get(Gt)),r.push(t.BF_REGISTER_MAP.get(e));for(var o=0;o<r.length;o++){var i=r[o];i&&0!=i.length&&qt(i,H.processChunkCount,()}}},{key:"handleBfClientReadyReq",value:function(){qt(t.BF_CLIENTREADY_REQS,H.processChunkCount,(function(e){t.ubtApiPush(e)}))}},{key:"register",value:function(e){try{if(e.instKey){if(F.instMap.has(e.instKey))return e.instKey}else e.instKey=(0,it.Z)(6);return t.pushCheck({data:e,type:"register"})?("mini"==n.clientType&&(e.appId=e.appId||n.mini.appId),new Vt(e),e.instKey):e.instKey}catch(t){Xt.printError("register err.",t)}}},{key:"get",value:function(t,e){var r=t||{},o=r.name,i=r.timeout,a=r.sync,c=r.handleResolve,s=r.handleReject;try{if(!o)return;"function"!=typeof c&&(a=!0);var u,f=t.name+("bfa"==t.name&&e?"_".concat(e):"");if(a)return n.watcher.getTriggeredVal(f);var l=Kt(c),p=setTimeout((function(){"function"==typeof s?(s("get timeout."),l({stop:!0})):l(null)}),null!=i?i:5e3);u=n.watcher.watch(f,u)}catch(t){Xt.reportError("get error",t,e),s?s(t):c&&c(null)}}},{key:"send",value:function(t,e){return this.sendPush(t,e)}},{key:"set",value:,{key:"sendPush",value:function(e,r,n,o,i){try{if(e.samle)if(Math.floor(100*Math.random())+1>e.samle)return zt;return n=n||Date.now(),t.invokeInstApi({type:"send",data:e,pvId:r,triggerTs:n,cacheGroupKey:i},o),zt}catch(t){return Jt(t)}}},{key:"setPush",value:function(e,r,n,o){try{return t.invokeInstApi({type:"set",data:e,pvId:r,cacheGroupKey:o},n),zt}catch(t){return Jt(t)}}},{key:"pushCheck",value:function(e){return!!n.client.clientReady||(t.BF_CLIENTREADY_REQS.push(e),!1)}},{key:"invokeInstApi",value:function(e,r){var n;if(t.pushCheck(e)){var o=e.type,i=e.data,a=e.pvId,c=e.triggerTs,s=e.cacheGroupKey,u=t.findUbtInst(a,s),f=e.pvId||Gt,l=!u||!(null===(n=t.BF_REGISTER_MAP.get(f))||void 0===n||!n.length)&&!r;if(l){var p,d;if(t.BF_REGISTER_MAP.has(f)&&Array.isArray(t.BF_REGISTER_MAP.get(f)))null===(d=t.BF_REGISTER_MAP.get(f))||void 0===d||d.push(e);else t.BF_REGISTER_MAP.set(f,[e]);null===(p=t.BF_REGISTER_MAP.get(f))||void 0===p||p.push(e)}else"function"==typeof u[o]?u[o](i,c):Xt.printError("invokeInstApi error",new Zt("inst:".concat(!!u,",type:").concat(o,",bufferReq:").concat(l)))}}}]),t}();E(Ht,"BF_CLIENTREADY_REQS",[]),E(Ht,"BF_REGISTER_MAP",new Map);var $t=Ht;function Wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=O(t);if(e){var o=O(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return w(this,r)}}function Qt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Yt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Qt(Object(r),!0).forEach((function(e){E(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Xt=function(){function t(){d(this,t)}return y(t,null,[{key:"printInfo",value:function(t){console.info("[UBT INFO] ".concat(t))}},{key:"printWarn",value:,{key:"printError",value:function(e,r,n){console.error("[UBT ERROR] ".concat(e),r),n&&t.log4Checking(n)}},{key:"reportReqFail",value:function(t,e){$t.send({type:I.DEV_TRACE,key:"bbz_ubt_req_fail",data:t},e)}},{key:"reportError",value:function(e,r,n){try{t.log4Checking({tag:"error",data:"".concat(e,"-").concat(null==r?void 0:r.stack)}),r instanceof te||console.error("[UBT ERROR] ".concat(e),r),t.errStacks.push(r.stack);var o=t.errStacks.length;o>t.ERR_STACK_SIZE&&(t.errStacks=t.errStacks.slice(o-t.ERR_STACK_SIZE,o));var i="ExceptionError";r instanceof Zt?i="ValidationError":r instanceof te&&(i="IgnorableError"),t.errStacks.filter(().length>=t.LOOP_LIMIT_MAX||t.sendErrorUbt({name:e||(null==r?void 0:r.name),stack:null==r?void 0:r.stack,message:"".concat(e,"\n ").concat(null==r?void 0:r.message),extendedField:{errType:i}},"error",n)}catch(e){t.printError("reportError error.",r)}}},{key:"sendErrorUbt",value:function(t,e,r){var o=Yt({from:"framework",catcher:"auto_".concat(F.version,"_").concat(e)},null==t?void 0:t.extendedField);"mini"==n.clientType&&(o.appId=n.mini.mcdAppId),$t.send({type:I.ERROR,data:Yt(Yt({},t),{},{category:n.client.errCategory,framework:"normal",extendedField:o})},r)}},{key:"switchChecking",value:function(){try{var e=H.checkConfigs;if(!e||0==e.length)return;t.checkConfig=e.find((function(t){var e=t.urlRegex;return e&&new RegExp(e).test(n.client.getUrl())})),t.checkConfig&&(t.checkId=(0,it.Z)(6))}catch(e){t.reportError("Log.switchChecking err.",e)}}},{key:"log4Checking",value:function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!r||t.checkConfig)try{var n,o;e.data=Q(JSON.stringify(e.data));var i=(null===(n=t.checkConfig)||void 0===n?void 0:n.tags)||[],a=(null===(o=t.checkConfig)||void 0===o?void 0:o.keys)||[];if(i.length>0&&!i.includes(e.tag))return;if("report"==e.tag){var c=e.data||{},s=[];if(a.length>0){if((c.ubtList||[]).forEach((function(t){var e;(t.type==I.PV||a.includes(null===(e=t.data)||void 0===e?void 0:e.key))&&s.push(t)})),0==s.length)return;c.ubtList=s}}if(e.ts||(e.ts=Date.now()),D.push(e),!r)return;var u=D.length>=50;t.reportChecking(u?ot:null)}catch(e){t.printError("log4Checking err",e)}}}]),t}();E(Xt,"LOOP_LIMIT_MAX",5),E(Xt,"ERR_STACK_SIZE",10),E(Xt,"errStacks",[]),E(Xt,"checkConfig",null),E(Xt,"checkId",""),E(Xt,"reportChecking",Y(p(S().mark((function t(){var e,r,o,i,a;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=D.length,Xt.checkConfig&&0!=e){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,r=F.curInst||{},o=r.bfa,i=ht(n.clientInfo),a=JSON.stringify({id:Xt.checkId,page:Xt.checkConfig.pageId,bfa:o,logs:D,client:n.clientInfo}),t.next=9,n.client.request({url:i,method:"POST",body:a});case 9:D.splice(0,e),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(3),Xt.printError("reportCheckingLog err",t.t0),D.splice(0,e);case 16:case"end":return t.stop()}}),t,null,[[3,12]])}))),100));var Zt=function(t){m(r,t);var e=Wt(r);function r(t){return d(this,r),e.call(this,t)}return y(r)}(j(Error)),te=j(Error)),ee=function(){function t(){d(this,t),E(this,"clientReady",!1),E(this,"lsStatus",[new Set,0]),E(this,"distinctErr",!0),this.watcher=new R}return y(t,[{key:"handleClientReady",value:,{key:"beforeOpLs",value:function(t,e,r){var n=this.lsStatus,o=this.getLs(e);"s"==t?n[0].add(e):n[0].delete(e),null==r&&(r=""),null==o&&(o="");var i="string"==typeof r?r:JSON.stringify(r),a="string"==typeof o?o:JSON.stringify(o);n[1]+=i.length-a.length}},{key:"setVid",value:function(){var t=this.readVid();t||((t=this.readBfa().genVid())||(t=ce.genVidVal()),this.writeVID(t));return Xt.log4Checking({tag:"setVid",data:{vid:t}},!1),this.watcher.trigger("vid",t),this.clientInfo.vid=t}},{key:"triggerBfa",value:function(t){var e=this;if(t&&t.bfa){var r=t.bfa,n=t.instKey;["bfa_".concat(n),"bfa"].forEach((function(t){e.watcher.trigger(t,{vid:r.vid,sid:r.sid,pvid:r.pvid,pageId:r.pageId})}))}}}]),t}(),re={}),ne={});function oe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var ie=W;function ae(){return(ae=p(S().mark((function t(){var e,r,o,i,a,c;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={appId:"5278",categoryList:["ubtconfig"],head:{appid:"5278",cid:n.clientInfo.vid,cver:"000.001",sid:"8892"}},t.next=3,n.client.request({body:JSON.stringify(e),url:ft(n.clientInfo)});case 3:if(r=t.sent,o=r.success,i=r.data,!o){t.next=11;break}if(c=null===(a=((null==i?void 0:i.configList)||[])[0])||void 0===a?void 0:a.configContent){t.next=10;break}return t.abrupt("return");case 10:n.client.setLs(V.UBT_CONFIG,c);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var ce={refreshUbtConfigLs:function(){return ae.apply(this,arguments)},setUbtConfig:function(t){t&&(Xt.log4Checking({tag:"set config",data:t},!1),Object.assign(H,t),n.clientInfo.tcpReady=n.clientInfo.tcpReady&&H.tcpSwitch)},genVidVal:function(){return"".concat(Date.now(),".").concat((0,it.Z)(12))},isUbtErrorData:function(t,e){return t==I.ERROR},ubtPropsCheck:function(t){if(!t||!t.appId)throw new Zt("appId is required !");var e=t.appId,r=t.settings;if("web"==n.clientType&&"number"!=typeof e&&isNaN(parseInt(e)))throw new Zt("appId must be a number !");if(null!=r&&r.waitingFields&&!Array.isArray(r.waitingFields))throw new Zt("waitingFields must be type of string[] !")},validateSendRequest:function(t){var e=t.type,r=t.key,n=t.data,o=k(Object.values(I)),i="".concat(e,"-").concat(r);if(!o.includes(e))throw new Zt("".concat(i,": Unsupported sending type: ").concat(e,"! The supported types include ").concat(o.join(", "),"."));if(r&&!["number","string"].includes(u(r)))throw new Zt("".concat(i,": key supports only number or string. "));var a=ie(n);if(e==I.PV||a!=ne.Null&&a!=ne.Undefined||(t.data=""),e)){if(null!=n&&n.value&&!function(t){var e=ie(t=t||0);if(e==ne.Number)return!0;if(e==ne.Object){for(var r=Object.keys(t),n=0;n<r.length;n++)(n>=z||ie(t[r[n]])!=ne.Number)&&delete t[r[n]];return!0}return!1}(n.value))throw new Zt("".concat(i,": illegal metric value.Value:").concat(JSON.stringify(n)));if(null!=n&&n.tag&&!function(t,e,r){e=e||!1;for(var n=Object.keys(e),o=0;o<n.length;o++){var i=n[o],a=e[i],c=ie(a);(!J.includes(i)&&o>=r||![ne.String,ne.Boolean,ne.Number].includes(c))&&delete e[i]}return!0}(0,n.tag,30))throw new Zt("".concat(i,": illegal metric tag."))}if(JSON.stringify(n||"").length>51200){var c=t.data="".concat(i,": data is too long. The maximum data size is ").concat(50,"KB.");Xt.printError(c)}return!0},stringifySendData:function(t){var e=t.data;if(t.type!=I.METRIC&&e&&ie(e)==ne.Object){var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=e[n];switch(u(o)){case"undefined":case"symbol":case"function":break;case"object":var i=void 0;"extendedField"==n&&(console.log("extendedField"),i=function(t,e){return t&&"string"!=typeof e?JSON.stringify(e):e}),r[n]=JSON.stringify(o,i);break;default:r[n]=o}}t.data=r}},transformUbtData:function(t){var e=t.type,r=t.key,o=t.data,i={},a=ie(o);if(a==ne.Null||a==ne.Undefined)return null;var c=a==ne.Object?o:{data:o};switch(e){case I.TRACE:case I.DEV_TRACE:"mini"==n.clientType&&(c.applet_scene=n.mini.scene),i={key:r,val:c};break;case I.PRIVATE_TRACE:i={key:r,val:o};break;case I.METRIC:i={name:r,tags:o.tag,value:o.value};break;case I.EXPOSURE:i={key:r,data:o};break;default:i={key:r},c),e==I.ERROR&&(!i.ownerOrgId&&i.organizationId&&(i.ownerOrgId=i.organizationId),i.category=n.client.errCategory)}return i}},se=window.UBT_BIZCONFIG||{};function ue(){var t=Date.now();if(N.fpSwitch=1,"0"==H.fpVersion){var e=n.webClient.getCookie("UBT_FP");if(!e){var r=(0,it.Z)(6),o=(0,it.Z)(6),i=(0,it.Z)(6);e="".concat(r,"-").concat(o,"-").concat(i),n.webClient.setCookie("UBT_FP",e,864e5)}return F.fp=e,void n.watcher.trigger("fp",F.fp)}window.document.addEventListener("cfp_loaded",(function(){N.fpTime=Date.now()-t;try{var e=window.cfp.toString();W(e)!=ne.Object&&(e={});var r=e,o=r.browserId,i=r.secStr;F.fp=o,F.ffp=i,n.watcher.trigger("fp",o),n.watcher.trigger("ffp",i),n.watcher.trigger("afp",{fp:o,ffp:i})}catch(t){Xt.reportError("listen c_sec_loaded error.",t)}})),n.webClient.loadScript(function(t,e){var r=ut(t),n=st(t);return"".concat(r).concat(n,"/ares2/train/csec/").concat(e,"/default/sec/c-sec.js")}(n.clientInfo,H.fpVersion))}var fe={loadModules:function(){try{var t=se.isLoadFP,e=se.isLoadMarketing,r=se.isLoadRMS;!1!==t&&ue(),!1!==r&&n.webClient.loadScript(function(t){var e=ut(t),r=st(t);return"".concat(e).concat(r,"/ares2/risk/ubtrms/*/default/").concat(t.isOnline?"rms":"mrms",".js")}(n.clientInfo)),setTimeout((function(){n.clientInfo.isTrip||!1===e||n.webClient.loadScript(function(t){var e=ut(t);return t.isOnline?"".concat(e,"//webresource.c-ctrip.com/ResUnionOnline/R1/remarketing/js/remarketing.js"):"".concat(e,"//webresource.c-ctrip.com/ResUnionOnline/R7/common/h5Redirect.js")}(n.clientInfo))}),0)}catch(t){Xt.reportError("loadModules err.",t)}}},le=function(){function t(){d(this,t)}var e,r,o;return y(t,null,[{key:"initConsole",value:function(){window.UBT_DEV={cdata:function(){var e,r=(null==F||null===(e=F.curInst)||void 0===e?void 0:e.bfa)||{},o=r.vid,i=r.sid,a=r.pvid;if(o&&i&&a){var c="".concat(t.CDATA_URL,"/").concat(o,"/").concat(i,"/").concat(a).concat(n.clientInfo.isProd?"":"?env=fws");window.open(c,"_blank")}return o},magnet:function(){var e,r=((null==F||null===(e=F.curInst)||void 0===e?void 0:e.bfa)||{}).vid;if(r){var n="".concat(t.MONITOR_URL,"?id=").concat(r,"&type=vid");window.open(n,"_blank")}return r},get bfa(){var t;return(null==F||null===(t=F.curInst)||void 0===t?void 0:t.bfa)||{}},get vid}},{key:"switchMagnet",value:(o=p(S().mark((function e(){var r,o,i,a,c;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=n.webClient.getUrlSearchObject()||{},o=r.magnetKey,i=r.magnetOn,a=void 0,!o||"true"!==i){e.next=7;break}return e.next=6,t.connectMagnet(o);case 6:a=e.sent;case 7:"false"===i&&(a=!1,t.disconnectMagnet(o)),null==a&&(!(c=n.webClient.getCookie(V.UBT_MAGNET))||o&&o!=c||(a=!0)),F.magnetSwitch=a,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),Xt.reportError("switchMagnet error.",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])}))),function(){return o.apply(this,arguments)})},{key:"inMagnetDebug",value:function(){if(!F.magnetSwitch)return!1;var t=n.webClient.getCookie(V.UBT_MAGNET);return F.magnetSwitch=!!t,F.magnetSwitch}},{key:"updateMagnetMaxAge",value:function(){var t=n.webClient.getCookie(V.UBT_MAGNET);t&&n.webClient.setCookie(V.UBT_MAGNET,t,K.MAGNET)}},{key:"connectMagnet",value:(r=p(S().mark((function e(r){var o,i,a;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n.webClient.setCookie(V.UBT_MAGNET,r,K.MAGNET),o="".concat(t.MAGNET_SVC_URL,"/").concat(r,"?type=debugOn"),e.next=5,fetch(o,{headers:{"Content-Type":"application/json;charset=UTF-8"},method:"POST",body:JSON.stringify({debug:!0,vid:n.clientInfo.vid,meta:{sdkver:F.version}})});case 5:if(200!=(i=e.sent).status){e.next=11;break}return e.next=9,i.json();case 9:return a=e.sent,e.abrupt("return",!0===a.success);case 11:return e.abrupt("return",!1);case 14:return e.prev=14,e.t0=e.catch(0),Xt.reportError("connectMagnet error.",e.t0),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,null,[[0,14]])}))),function(t){return r.apply(this,arguments)})},{key:"disconnectMagnet",value:(e=p(S().mark((function t(e){return S().wrap((,t)}))),function(t){return e.apply(this,arguments)})}]),t}();E(le,"MONITOR_URL","http://magnet.mobile.uat.qa.nt.ctripcorp.com/monitor"),E(le,"MAGNET_SVC_URL","//magnet.mobile.uat.qa.nt.ctripcorp.com/web/access"),E(le,"CDATA_URL","https://mpaas.ctripcorp.com/cdataV2/session");var pe=le,de=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n?]+)/im,he=function(){eturn y(t,null,[{key:"start",value:function(){var t,e;if(this.nameRule=(null===(t=H.perfConfig)||void 0===t?void 0:t.nameRule)||{},0!=Object.keys(this.nameRule).length&&0!=(null===(e=H.perfConfig)||void 0===e?void 0:e.sample)){var r=performance.getEntriesByType("resource");this.pushResourceTiming(r||[]),this.observeResource()}}},{key:"observeResource",value:function(){var t=this;this.observed||(new PerformanceObserver(().observe({entryTypes:["resource"]}),this.observed=!0)}},{key:"triggerReport",value:,{key:"pushResourceTiming",value:function(e,r){var n,o=this;if(null==e||e.forEach((function(t){o.checkName(t.name)&&o.UBT_TIMINGS.push({name:t.name,dnsTime:t.domainLookupEnd-t.domainLookupStart,totalTime:t.responseEnd-(t.redirectStart||t.fetchStart),requestTime:t.responseEnd-t.requestStart,tcpTime:t.connectEnd-t.connectStart,redirectTime:t.redirectEnd-t.redirectStart})})),0!=this.UBT_TIMINGS.length){var i=this.lastReportTs?3e3-(Date.now()-this.lastReportTs):0;if(r||i<=0){var a=F.instMap.keys().next().value;$t.send({type:I.METRIC,key:"bbz_perf_resource_timing",data:{tag:{timings:JSON.stringify(this.UBT_TIMINGS)}},samle:null===(n=H.perfConfig)||void 0===n?void 0:n.sample},a),this.lastReportTs=Date.now(),this.UBT_TIMINGS=[]}else this.nextExecTimer||(this.nextExecTimer=window.setTimeout((,i))}}},{key:"checkName",value:function(t){if(!t)return!1;var e=t.match(de);if(!e)return!1;var r=e[1],n=(null==r?void 0:r.split("."))||[],o=n.splice(-2).join(".")||"",i=n.join(".")||"";return o in this.nameRule&&-1!=this.nameRule[o].indexOf(i)}}]),t}();E(he,"UBT_TIMINGS",[]),E(he,"nameRule",{});var ve=he,ye={start_point:null,start_touch:!1,moving:!1};function ge(t){try{if(!t||!t.reason)return;var e=t.reason,r="string"==typeof e?null:function(t){var e;if(t){var r=t.split("\n"),n=r[r.length-1],o=(n=null===(e=n)||void 0===e?void 0:e.substring(n.indexOf("(")+1,n.indexOf(")"))).split(":");if(!(o.length<3))return{column:o.pop(),line:o.pop(),file:o.join(":")}}}(null==e?void 0:e.stack),n={name:e.message||e,message:e.message||e,stack:null==e?void 0:e.stack,line:null==r?void 0:r.line,column:null==r?void 0:r.column,file:null==r?void 0:r.file};Xt.sendErrorUbt(n,"rejection")}catch(t){Xt.reportError("handleRejection error.",t)}}function be(t,e,r,n,o){try{var i,a={name:(null==o?void 0:o.name)||(null==t?void 0:t.message)||t,stack:(null==o?void 0:o.stack)||(null==t||null===(i=t.error)||void 0===i?void 0:i.stack),message:(null==o?void 0:o.message)||(null==t?void 0:t.message),line:r||(null==t?void 0:t.lineno),column:n||(null==t?void 0:t.colno),file:e||(null==t?void 0:t.file)};Xt.log4Checking({tag:"error-listener",data:a}),Xt.sendErrorUbt(a,"error")}catch(o){Xt.reportError("handleError error.",o)}}function me(t,e){var r=0;if("DIV"==e&&(t.attributes["page-url"]||t.getAttribute("page-url")))return"";if(t.parentNode)for(var n=t.parentNode.firstChild;n&&n!=t;)1==n.nodeType&&n.tagName==t.tagName&&r++,n=n.nextSibling;return r>0?"["+ ++r+"]":""}function we(t){try{if(!t||!t.target)return;var e=t.target,r=window.document.documentElement,n=window.document.body;if(e&&1==e.nodeType&&e.nodeName&&e.getBoundingClientRect){var o,i,a,c,s=e.nodeName.toUpperCase(),u=e.getBoundingClientRect(),f="",l=Math.max(r.scrollLeft,n.scrollLeft),p=Math.max(r.scrollTop,n.scrollTop),d=(null===(o=ye.start_point)||void 0===o?void 0:o.pageX)||t.pageX||0,h=(null===(i=ye.start_point)||void 0===i?void 0:i.pageY)||t.pageY||0,v=$((r.clientWidth||n.clientWidth)/2,10);if("SELECT"==s&&h-u.top-p<0?(f+="[@x='"+$(d+u.left+l-v,10)+"'][@y='"+$(h+u.top,10)+"']",a=d,c=h-p):(f+="[@x='"+(d-v)+"'][@y='"+h+"']",a=$(d-u.left-l,10)||0,c=$(h-u.top-p,10)||0),a>=0&&c>=0&&a<=screen.width+l){f+="[@rx='"+a+"']",f+="[@ry='"+c+"']";var y=function(t){for(var e,r=[],n=0;t&&9!=t.nodeType;){if(1==t.nodeType){var o=(t.nodeName||"").toUpperCase(),i=t.id||"",a=o+me(t,o);i&&"function"==typeof i.indexOf&&-1==i.indexOf("client_id_viewport")&&(a+="[@id='"+i+"']"),(e=t.getAttribute("data-ubt-key"))&&(a+="[@cid='"+e+"']"),r[n++]=a}t=t.parentNode}return r.length>2?r.reverse().join("/"):""}(e);y&&$t.send({type:I.ACTION,data:{xpath:y+f,action:"click"}})}}}catch(t){Xt.reportError("handleClick error.",t)}}function Oe(t){ye.start_point=t.touches&&t.touches[0]||t,ye.moving=!1,ye.start_touch=!0}function Ee(t){if(ye.start_touch){var e,r,n,o,i=t.touches&&t.touches[0]||t;n=Math.abs(i.pageX-((null===(e=ye.start_point)||void 0===e?void 0:e.pageX)||0)),o=Math.abs(i.pageY-((null===(r=ye.start_point)||void 0===r?void 0:r.pageY)||0)),ye.moving=!(n<6||o<6)}}function xe(t){!ye.moving&&ye.start_touch&&we(t),ye.start_touch=!1,ye.start_point=null}function Se(){var t;H.switchBackWvPv&&F.curInst&&(!se.isOpenBackWvPv&&(H.backWvPvBlackList||[]).includes(F.curInst.appId+"")||null===(t=F.curInst)||void 0===t||t.refreshPv())}var Te={init:function(){window.addEventListener("error",be),window.addEventListener("unhandledrejection",ge);var t="ontouchstart"in window,e=t?"touchstart":"mousedown",r=t?"touchmove":"mousemove",o=t?"touchend":"mouseup";window.document.addEventListener(e,Oe,!0),window.document.addEventListener(r,Ee,!0),window.document.addEventListener(o,xe,!0),window.document.addEventListener("visibilitychange",(function(t){"visible"===window.document.visibilityState&&F.curInst&&n.webClient.writeLastView(F.curInst)})),window.addEventListener("beforeunload",(function(){ve.triggerReport()})),"undefined"!=typeof CtripEventListener&&"function"==typeof CtripEventListener.addHybridEventListener&&CtripEventListener.addHybridEventListener("onPageDidAppear",Se)}};r(541);function ke(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ie(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ke(Object(r),!0).forEach((function(e){E(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ke(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var _e=window.UBT_COMP||{},Re={_trace:I.TRACE,_tracklog:I.TRACE,_devTrace:I.DEV_TRACE,_privateTrace:I.PRIVATE_TRACE,_exposure:I.EXPOSURE,_trackMetric:I.METRIC,_trackMatrix:I.METRIC,_trackError:I.ERROR,_trackUserBlock:I.USER_BLOCK};function Pe(){1==F.instMap.size&&setTimeout((function(){!function(){window.__bfi=window.__bfi||[];var t=window.__bfi;N.init_old_counts=t.length,rt(t,H.processChunkCount,Ae,(),window.$_bf=window.$_bf||{},window.$_bf._getStatus=function(){var t=F.curInst;if(!t)return{};var e=(null==t?void 0:t.getCommon())||{},r=e.context,n=e.user;return{vid:null==r?void 0:r.vid,sid:null==r?void 0:r.sid,pvid:null==r?void 0:r.pvid,abtest:null==n?void 0:n.abTest,pid:t.pageId,pv:t.pvSend}}}()}),0)}function je(){return(je=p(S().mark((function t(){var e,r,o;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,window.UBT_API=window.UBT_API||[],W(window.UBT_API)==ne.Array){t.next=4;break}return t.abrupt("return");case 4:window.UBT_API_TEMP={push:$t.ubtApiPush},W(e=n.webClient.getLs(V.UBT_UNHANDLED,!0)||[])==ne.Array&&(r=window.UBT_API).unshift.apply(r,k(e)),o=window.UBT_API,N.init_new_counts=o.length,rt(o,H.processChunkCount,$t.ubtApiPush,(function(){delete window.UBT_API_TEMP,window.UBT_API.push=$t.ubtApiPush,window.UBT_API.rewrited=!0}),(function(){try{if(0==e.length)return;e.splice(0,H.processChunkCount),n.webClient.setLs(V.UBT_UNHANDLED,JSON.stringify(e))}catch(t){Xt.printError("afterUnitTaskCb error.",t)}})),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),Xt.reportError("ProcessUbtApi error.",t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))).apply(this,arguments)}function Ae(t){Xt.log4Checking({tag:"old push",data:t});try{var e=o(y=t)||T(y)||a(y)||c(),r=e[0],n=e.slice(1);if(["_getFullPV","_getStatus","_getFP","_getPageid"].includes(r)){var i=n[0],s="function"==typeof i;switch(r){case"_getFullPV":return $t.get({name:"bfa",handleResolve:function(t){s&&i(t?"".concat(t.vid,".").concat(t.sid,".").concat(t.pvid):"")}});case"_getStatus":return $t.get({name:"bfa",handleResolve:function(t){s&&i(t?{vid:t.vid,sid:t.sid,pvid:t.pvid,pid:t.pageId}:{})}});case"_getPageid":return $t.get({name:"bfa",handleResolve:function(t){s&&i(!1,null==t?void 0:t.pageId)}});case"_getFP":var u=n[1];return $t.get({name:"fp",handleResolve:function(t){if(s){var e="";t&&(e="a".concat(encodeURIComponent(t))),u?i(JSON.stringify({fp:t,sfp:e})):i(t,e,t)}}})}return void(i&&"function"==typeof i&&i(undefined))}var f=F.curInst;if(!f)return;var l=Re[r];if(!l)return;var p,d="",h=null;switch(l){case I.TRACE:case I.DEV_TRACE:case I.PRIVATE_TRACE:case I.EXPOSURE:d=n.shift(),p=n[0],h=n[1];break;case I.METRIC:if("_trackMetric"==r){var v=n[0]||{};d=v.name,p={tag:v.tag,value:v.value}}else"_trackMatrix"==r&&(d=n[0],p={tag:n[1],value:n[2]},h=n[4]);break;case I.ERROR:case I.USER_BLOCK:p=n[0],h=n[1];break;default:throw new Zt("unsupported old push: "+JSON.stringify(t))}f.send({type:l,key:d,data:p}),"function"==typeof h&&h()}catch(t){Xt.reportError("Old api push error.",t)}var y}var Ce=!1;function Le(){Ce||window.UBT_LEAVING_TAG||(Ce=!0,Xt.log4Checking({tag:"consumer init",data:_e}),_e&&_e.symbol&&function(t,e){try{if(!t||!e)return-1;for(var r=t.split("."),n=e.split("."),o=0;o<=2;o++){var i=(r[o].match(/^\d+/g)||[])[0]||0,a=(n[o].match(/^\d+/g)||[])[0]||0;if(i>a)return 1;if(i<a)return-1}return 0}catch(r){return Xt.reportError("compareVersion error.sv:".concat(t,",cv:").concat(e),r),-1}}(_e.version,"1.1.1")<=0&&(Xt.printWarn("@ctrip/ubt-web: ".concat(_e.version,": >1.3.x")),function(){window.UBT_CTOR=Vt;var t=n.webClient.getLs(V.UBT_DESERTED,!0)||[],e=_e.insts,r=[].concat(k(t),k(e||[]));r&&0!=r.length&&(r.forEach((function(t){var e=t.props,r=t.registerTs,n=t.requestQ,o=t.instKey,i=new Vt(Ie(Ie({},e),{},{registerTs:r,instKey:o}));Pe(),t.realInst=i,n.forEach((function(t){var e=t.name,r=t.data,n=t.triggerTs;i[e](r,n),t.hasReceived=!0}))})),n.webClient.removeLs(V.UBT){je.apply(this,arguments)}())}F.consumer=Le;var Be={init:Le,handleAfterRegister:Pe},Ue=function(){function t(e){var r=this;if(d(this,t),ach((function(t){r[t]=e[t]})),e.vid&&!e.id)){var n=e.vid.split(".");this.vid_ts=parseInt(n[0]),this.id=n[1]}}return y(t,[{key:"genBfaVal",value:function(){return"1.".concat(this.vid_ts,".").concat(this.id,".1.").concat(this.lastSession_ts,".").concat(this.session_ts,".").concat(this.sid,".").concat(this.pvid,".").concat(this.pageId||0)}},{key:"genVid",value:function(){return this.vid?this.vid:this.vid_ts&&this.id?this.vid="".concat(this.vid_ts,".").concat(this.id):void 0}}],[{key:"parse",value:function(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cookie";try{if(!e)return new t;if("cookie"==n){var o=e.split(".")||[];G.BFA.test(e)&&o.length>6&&(r={vid_ts:parseInt(o[1]),id:o[2],lastSession_ts:parseInt(o[4]),session_ts:parseInt(o[5]),sid:parseInt(o[6]),pvid:parseInt(o[7]),pageId:o[8]})}else{var i=Q(e,{});i.vid&&i.sid&&i.pvid&&(r=i)}var a=new t(r);return a.genVid(),a}catch(e){return Xt.reportError("BFA parse error.",e),new t}}}])ments);return w(this,r)}}var Ge="ab_testing_tracker",Ke=function(t){m(v,t);var e,r,n,o,i,a,c,l,h=Ve(v);function v(){var t;return d(this,v),E(g(t=h.call(this)),"errCategory",window.__NEXT_DATA__&&"string"==typeof window.__NEXT_DATA__.version?"Nfes-error":"Web-error"),E(g(t),"clientType","web"),t.init(),t}return y(v,[{key:"init",value:(l=p(S().mark((function t(){var e,r,n,o;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,"undefined"!=typeof window&&(window.UBT_GLOBAL=F,F.ubtCom=window.UBT_COMP),e=Date.now(),t.next=5,this.setClientInfo();case 5:return Xt.log4Checking({tag:"sdk init"},!1),window.UBT_API=window.UBT_API||[],t.next=9,pe.switchMagnet();case 9:this.initUbtConfig(),r=Date.now(),Xt.switchChecking(),fe.loadModules(),Te.init(),Be.init(),ve.start(),pe.initConsole(),n=Date.now(),N.microTime=n-r,this.handleClientReady(),o=Date.now(),N.macroTime=o-e,t.next=27;break;case 24:t.prev=24,t.t0=t.catch(0),Xt.printError("init err",t.t0);case 27:case"end":return t.stop()}}),t,this,[[0,24]])}))),function(){return l.apply(this,arguments)})},{key:){Be.handleAfterRegister()}},{key:"refreshClientEnv",value:function(){}},{key:"initUbtConfig",value:function(){try{var t,e=null===(t=window.UBT_COMP)||void 0===t?void 0:t.ubtConfig;e?F.summary.prefetchConfig=1:(e=this.getLs("UBT_CONFIG",!0),ce.refreshUbtConfigLs()),e&&ce.setUbtConfig(e)}catch(t){Xt.reportError("initUbtConfig error.",t)}}},{kbusiness.trafficSource||""}},{key:"setClientInfo",value:(c=p(S().mark((function t(){var e,r,n,o,i,a,c,s,u,f,l,p,d,h,v,y,g,b,m;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.checkLsSupport(),r=this.getRootDomain(),n=window,o=n.location,i=n.navigator,a=null==i?void 0:i.userAgent,c=i&&i.javaEnabled()?1:0,s=G.CTRIP_APP.test(a),u=G.TRIP_APP.test(a),f=!G.MOBILE.test(a),l=null!=se.isLAN?!!se.isLAN:G.INTRANET.test(o.href),p=o.protocol,d="https:"!=p&&"http:"!=p,h=null!=se.isOverseas?se.isOverseas:G.TRIP.test(o.host),v=null!=se.isProd?se.isProd:!G.TEST_ENV.test(o.host),y=/\.uat\./.test(o.host),g=!!window.__ubt_ipv6,b=f?re.Online:s||u||d?re.hybrid:re.H5,(m={clientType:this.clientType,javaEnable:c,isCtripApp:s,isTripApp:u,isOnline:f,isFile:d,webType:b,isSupportLS:e,rootDomain:r,isTrip:h,isProd:v,isUat:y,isLAN:l,isIPV6:g,protocol:p,tcpReady:"undefined"!=typeof CtripBusiness&&"function"==typeof CtripBusiness.app_track_UBT_JS_log_V2}).isSupportSendBeacon=this.checkIsSupportSendBeacon(m),this.clientInfo=m,this.initLsStatus(),this.sdkVerSuffix="/new/".concat(h?"t":"c"),this.syncCwxParams(),this.setVid(),t.next=25,this.setClientIds();case 25:return t.abrupt("return",this.clientInfo);case 26:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"bindClientInfo",value:(a=p(S().mark((function t(e){var r,n,o,i,a,c,s,u,f,l,p,d,h;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.common,n=e.sendSetting;try{l=this.getLocals(n)||{},p={storageLength:this.clientInfo.isSupportLS?null===(o=localStorage)||void 0===o?void 0:o.length:0,env:this.clientInfo.webType,clientId:this.clientID,lang:(navigator&&navigator.language?navigator.language:"").toLowerCase(),screenWidth:screen.width,screenHeight:screen.height,url:null===(i=(null===(a=e.props.context)||void 0===a?void 0:a.url)||this.getUrl())||void 0===i?void 0:i.substring(0,n.urlMaxLength),referrer:null===(c=(null===(s=e.props.context)||void 0===s?void 0:s.referrer)||this.getReferrer())||void 0===c?void 0:c.substring(0,n.urlMaxLength),devicePixelRatio:window.devicePixelRatio||1,cookieLength:document.cookie.length,cookieCount:(document.cookie.match(/[^=]+=[^;]*;?/g)||[]).length,rid:null===(u=window.__NEXT_DATA__)||void 0===u?void 0:u.rootMessageId},Object.assign(r.context,l.context,p),Object.assign(r.business,l.business),Object.assign(r.user,Fe(Fe({},l.user),{},{userId:r.user.userId||(null===(f=l.user)||void 0===f?void 0:f.userId)})),(d=r.business.attrs.bizTokens||[]).length>0&&!r.user.duid&&(r.user.duid=d[0]),h=this.getBizTokens(n.bizTokenKeys),Object.assign(r.business.attrs,{bizTokens:h,eid:l.eid},l.ubtc)}catch(t){Xt.reportError("bindClientInfo error.",t)}case 2:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"readLastView",value:function(t){var e=this.getLs(V.UBT_LASTVIEW,!0);if(e){var r=Array.from(F.instMap.keys()),n=r.indexOf(t.instKey),o=n>=0?n-1:r.length-1,i=o>=0&&r[o]==e.instKey,a="".concat(e.host).concat(e.path);if(i||document.referrer.indexOf(a)>=0)return e;var c=e.fromPage;return c&&document.referrer.indexOf("".concat(null==c?void 0:c.host).concat(null==c?void 0:c.path))>=0&&e.pageId==t.pageId?e.fromPage:void 0}}},{key:"writeLastView",value:function(t){try{var e=t.lastView,r=Fe(Fe({},t.bfa),{},{host:location.host,path:location.pathname,instKey:t.instKey});if(e){e.fromPage;var n=f(e,De);r.fromPage=n}this.setLs(V.UBT_LASTVIEW,JSON.stringify(r))}catch(e){Xt.reportError("writeLastView error.",e,t.instKis.getCookie(V.VID_COOKIE)}},{key:"writeVID",value:function(t){this.setCookie(V.VID_COOKIE,t||"")}},{key:"readBfa",value:function(){var t=null,e=this.getCookie(V.BFA_COOKIE);if(!(t=Me.parse(e)).id){var r=this.getLs(V.BFA_LS);t=Me.parse(r,"ls")}return t}},{key:"writeBfa",value:function(t,e){this.setCookie(V.BFA_COOKIE,t.bfa.genBfaVal()),this.setLs(V.BFA_LS,JSON.stringify(t.bfa)),e||(this.writeLastView(t),this.triggerBfa(t))}},{key:"reportMagenet",value:function(t){this.clientInfo.isProd&&pe.inMagnetDebug()&&(t(),pe.updateMagnetMaxAge())}},{key:"reportByTcp",value:function(t){return CtripBusiness.app_track_UBT_JS_log_V2("ubt_js_sdk_v2",t),{success:!0}}},{key:"reportBySendBeacon",value:function(t,e){var r=new Blob([t],{type:"application/json"});return{success:navigator.sendBeacon(e,r)}}},{key:"syncCwxParams",value:function(){try{if(this.clientInfo.isOnline)return;var t=this.getUrlSearchObject("_cwxobj");if(!t)return;var e=Q(decodeURIComponent(t));if(null==e||!e.cid)return;e.cid&&e.cid.length>20&&(e.cid=e.cid.slice(0,20)),this.setLs("UBT_FROM_CWX",JSON.stringify({appid:e.appid,cid:e.cid,personalRecommendSwitch:e.personalRecommendSwitch,localRecommendSwitch:e.localRecommendSwitch,marketSwitch:e.marketSwitch})),window.__nfesGlobalDatas||(this.setLs("GUID",e.cid||""),this.setCookie("GUID",e.cid))}catch(t){Xt.reportError("syncCwxParams error.",t)}}},{key:"request",value:(i=p(S().mark((function t(e,r){var n,o,i,a,c;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=new Abounction(){return n.abort()}),r),o={headers:Fe({"Content-Type":"application/json",Accept:"application/json"},e.headers),method:e.method||"POST",body:e.body,signal:n.signal},t.next=6,fetch(e.url,o);case 6:return i=t.sent,t.next=9,i.json();case 9:return a=t.sent,c=200==i.status&&i.ok,t.abrupt("return",E({success:c},c?"data":"message",a));case 14:return t.prev=14,t.t0=t.catch(0),Xt.reportReqFail({message:t.t0.message,url:e.url,stack:t.t0.stack}),t.abrupt("return",{success:!1,message:"".concat(null===t.t0||void 0===t.t0?void 0:t.t0.stack)});case 18:case"end":return t.stop()}}),t,null,[[0,14]])}))),function(t,e){return i.apply(this,arguments)})},{key:"imgRequest",value:(o=p(S().mark((function t(e){return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){try{var n=new Image;n.referrerPolicy="no-referrer",function(){t({success:!0})},n.onerror=function(r,o,i,a,c){n.onload=n.onerror=null,t({success:!1,message:"imageReport failed.event: ".concat(r,", error: ").concat(c)}),Xt.reportReqFail({message:null==c?void 0:c.message,url:e.url,stack:null==c?void 0:c.stack})},n.src="".concat(e.url,"?").concat(e.body)}catch(t){r(t)}})));case 1:case"end":return t.stop()}}),t)}))),function(t){return o.apply(this,arguments)})},{key:"setClientIds",value:(n=p(S().mark((function t(){var e=this;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=p(S().mark((function t(r){var n,o,i,a,c;return S().wrap((function(t){for(;;)switch(t.prev=ttTimeout((function(){r(!1)}),100);try{o="",i=e.getLs("UBT_FROM_CWX",!0)||{},o=i.cid,N.cid_from=3,o||(N.cid_from=2,a=e.getCookie("GUID"),c=e.getLs("GUID"),o=a||c),o||delete N.cid_from,N.cid_type=o?/{|"|:/g.test(o||"")?2:1:0,e.clientID=o,clearTimeout(n),e.watcher.trigger("cid",o),r(!0)}catch(t){Xt.reportError("setClientIds error.",t)}case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 1:case"endrn n.apply(this,arguments)})},{key:"createCid",value:(r=p(S().mark((function t(e){var r,n,o,i,a=arguments;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:0,t.prev=1,n={head:{appid:"700062"},appId:"700062",platformCode:1,deviceId:e},t.next=5,this.request({body:JSON.stringify(n),url:lt(this.clientInfo)});case 5:if((o=t.sent).success&&o.data&&(i=o.data.clientId),i||!(r<3)){t.next=9;break}return t.abrupt("return",this.createCid(e,r++));case 9:return r>0&&(N.retryCreateCidTimes=r),t.abrupt("return",i);case 13:return t.prev=13,t.t0=t.catch(1),t.abrupt("return",this.createCid(e,r++));case 16:case"end":return t.storn r.apply(this,arguments)})},{key:"getLocals",value:function(t,e){if(this.locals&&!e)return this.locals;try{var r,n,o,i,a,c="".concat(this.clientInfo.isProd?"PRO":this.clientInfo.isUat?"UAT":"FAT","_Servers_Eid"),s=this.multiGetCookie([["Session",Z],["CtripUserInfo",Z],["StartCity_Pkg",Z],["Union",Z],["login_uid"],["weduid"],["corpid"],["bid"],["DUID"],["BDUID"],["Servers_Eid"],[c]]),u=this.batchGetLs([["SOURCEID"],["USER",tt],["CINFO",tt]]),f=s.Session||{},l=s.CtripUserInfo||{},p=(s.StartCity_Pkg,s.Union||{}),d=s.login_uid,h=s.DUID||window.ubt_duid||l.U||"",v=d;if(!h&&!v){var y=u.USER;if(y&&y.value){var g=y.value;v=g.LoginName||g.UserName,h=g.UserID}}var b=p;b||(b=this.getLs("UNION",!0));var m=Q(b.exmktID)||{},w=this.getUrlSearchObject(),O=this.getOther(),E=this.getAppInfo(u.CINFO),x=this.getIdc(),S={eid:s[c]||s.Servers_Eid,ubtc:this.readUbtc(),context:{engine:null!==(r=f.SmartLinkCode)&&void 0!==r?r:"",other:JSON.stringify(O),appInfo:E,idc:x},user:{corpid:s.corpid,duid:"we.ctrip.com"==location.hostname?s.weduid:h,userId:v,abTest:this.getABtest(t.abTestMaxLength)},business:{allianceId:null!==(n=b.AllianceID)&&void 0!==n?n:"",allianceSid:null!==(o=b.SID)&&void 0!==o?o:"",allianceOuid:null!==(i=b.OUID)&&void 0!==i?i:"",allianceCreatetime:null!==(a=b.createtime)&&void 0!==a?a:"",sourceId:u.SOURCEID,innerSid:m.innersid||w.innersid,innerOuid:m.innerouid||w.innerouid,pushCode:m.pushcode||w.pushcode}};return this.locals=S}catch(t){Xt.reportError("getLocals error.",t)}}},{key:"readUbtc",value:function(){var t={},e=this.getCookieAll();for(var r in e)G.UBTC.test(r)&&(t[r.substring(5)]=e[r]);return t}},{key:"getBizTokens",value:function(t){if(!t||0==t.length)return[];t.length>3&&(t=t.slice(0,3));var emap((function(t){return[t]})))||{};return Object.values(e).filter((function(t){return!["",null,void 0].includes(t)}))}},{key:"getAppInfo",value:function(t){var e={version:(null==t?void 0:t.internalVersion)||"",ver:null==t?void 0:t.version,net:(null==t?void 0:t.networkStatus)||"None",platform:(null==t?void 0:t.platform)||""};return JSON.stringify(e)}},{key:"getIdc",value:function(){var t="";try{var e=document.documentElement;t=e.dataset&&e.dataset.idc||e.getAttribute("data-idc")||""}catch(t){Xt.reportError("getIdc error.",t)}return(t+"").substring(0,30)}},{key:"getOther",value:function(){var t="";if("object"===u(window.Lizard)){var e=window.Lizard;t=e.selfCollection||e.version||""}var r={fef_name:"",fef_ver:"",rg:this.getCookie("_RSG",""),lang:document.documentElement.getAttribute("lang")||""};return this.clientInfo.isOnline?r.lizard=t:(r.tz=-(new Date).getTimezoneOffset(),r.dt=outerHeight-innerHeight>160||outerWidth-innerWidth>160),r}},{key:"getABtest",value:function(t){try{for(var e="",r=document.getElementById(Ge),n=[];r;){var o=r.value;/;$/.test(o)||(o+=";"),e+=o,n.push(r),r.removeAttribute("id"),r.removeAttribute("name"),r=document.getElementById(Ge)}for(var i=0;i<n.length;i++)n[i].setAttribute("id",Ge);var a=location.hash;if(a.indexOf("abtest=")>=0){var c=a.replace(/.*(abtest=)/i,"").replace(/#.*/i,"");e+=decodeURIComponent(c)}return t&&t>0?e.substring(0,t):""}catch(t){return Xt.reportError("getABtest error.",t),""}}},{key:"getReferrer",value:function(){var t="";t=document&&document.referrer;try{!t&&opener&&(t=opener.location&&opener.location.href)}catch(t){}return t}},{key:"getUrl",value:function(){return location.href}},{key:"setCookie",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.COOKIE_MAX,n=this.clientInfo.rootDomain?";domain=".concat(this.clientInfo.rootDomain):"",o="";if(r>=0){var i=new Date((new Date).getTime()+r).toUTCString();o=";expires=".concat(i)}return document.cookie="".concat(t,"=").concat(encodeURIComponent(e)).concat(n).concat(";path=/").concat(o),!0}},{key:"getCookie",value:function(t,e,r){var n=new RegExp("(^| )"+t+"=([^;]*)(;|$)"),o=document.cookie.match(n),i=e||"";return o&&(i=r?decodeURI(o[2]):o[2]),i}},{key:"checkLsPush",value:function(){return!!this.clientInfo.isSupportLS&&s(this.lsStatus,2)[1]<4194304}},{key:"initLsStatus",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"B";if(!this.clientInfo.isSupportLS)return this.lsStatus=[new Set,0];var e=0,r=new Set;for(var n in localStorage)if(Object.prototype.hasOwnProperty.call(localStorage,n)){var o=localStorage.getItem(n);null!==o&&(r.add(n),e+=o?o.length:0)}return"KB"==t&&(e=Math.ceil(e/1024)),"MB"==t&&(e=Math.ceil(e/1024)),this.lsStatus=[r,e]}},{key:"setLs",value:function(t,e){this.clientInfo.isSupportLS&&(this.beforeOpLs("s",t,e),window.localStorage.setItem(t,e))}},{key:"removeLs",value:function(t){this.clientInfo.isSupportLS&&(this.beforeOpLs("r",t),window.localStorage.removeItem(t))}},{key:"getLs",value:function(t,e){if(this.clientInfo.isSupportLS){var r=window.localStorage.getItem(t);return e?Q(r):r}}},{key:"iterateLsKeys",value:function(t){for(var e=localStorage.length,r=0;r<e;r++){var n=localStorage.key(r);n&&t(n)}}},{key:"batchGetLs",value:function(t){var e={};if(!this.clientInfo.isSupportLS)return e;var r=window.localStorage;return t.forEach((function(t){var n=s(t,2),o=n[0],i=n[1],a=r[o];a=et(a,i),e[o]=a})),e}},{key:"checkLsSupport",value:function(){if(Storage&&localStorage){try{localStorage.setItem("store_test","1"),localStorage.getItem("store_test"),localStorage.removeItem("store_test")}catch(t){return!1}return!0}return!1}},{key:"getUrlSearchObject",value:function(t){var e=document.location.search.replace("?",""),r=this.mapQuerys2Object(e)||{};return t?r[t]:r}},{key:"mapQuerys2Object",value:function(t){for(var e={},r=t.split("&")||[],n=0;n<r.length;n++){var o=r[n].split("=");o.length>1&&(e[o[0]]=o[1])}return e||{}}},{key:"checkIsSupportSendBeacon",value:function(t){return"object"===("undefined"==typeof navigator?"undefined":u(navigator))&&"function"==typeof navigator.sendBeacon&&(t.isTripApp||t.isCtripApp||"undefined"==typeof CtripBusiness)&&!t.isFile&&-1==navigator.userAgent.indexOf("tripPal")&&-1==navigator.userAgent.indexOf("AliApp")&&!/CBP(IOS)?_Wireless/i.test(navigator.userAgent)}},{key:"multiGetCookie",value:function(t){var e={},r=this.getCookieAll();return t.forEach((function(t){var n=s(t,2),o=n[0],i=n[1],a=r[o];a=et(a,i),e[o]=a})),e}},{key:"getCookieAll",value:function(){var t=document.cookie;if(!t)return{};var e={};return t.split("; ").forEach((function(t){var r=t.indexOf("="),n=t.substring(0,r),o=t.substring(r+1);e[n]=o})),e}},{key:"removeCookie",value:function(t){var e=this.getRootDomain();document.cookie="".concat(t,"=;domain=").concat(e,";expires=Thu, 01 Jan 1970 00:00:01 GMT;")}},{key:"getRootDomain",value:function(){for(var t="",e="_bfp=cookie",r=location.hostname.split("."),n=r.length-1;n>=0;n--)if(t="."+r.slice(n).join("."),document.cookie="".concat(e,";domain=").concat(t,";"),document.cookie.indexOf(e)>-1)return document.cookie="".concat(e.split("=")[0],"=;domain=").concat(t,";expires=Thu, 01 Jan 1970 00:00:01 GMT;"),t;return t}},{key:"loadScript",value:(e=p(S().mark((function t(e,r){var n,o,i,a,c=arguments;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!(c.length>2&&void 0!==c[2])||c[2],e){t.next=3;break}return t.abrupt("return");case 3:o=!1,(i=document.createElement("script")).type="text/javascript",i.async=!0,i.setAttribute("crossorigin","anonymous"),i.onload=i.onreadystatechange=function(t){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(this.onload=this.onreadystatechange=null,o=!0,r&&r(t))},n&&(e=e+"?v="+(new Date).toLocaleDateString("zh-cn").replace(/\//g,"")),i.src=e,null==(a=document.getElementsByTagName("body")[0])||a.appendChild(i);case 13:case"endrn e.apply(this,arguments)})}]),v}(ee),qe=Ke;n.client=n.webClient=new qe,n.clientType=n.client.clientType,n.clientInfo=n.client.clientInfo,n.watcher=n.client.watcher},9662:function(t,e,r){var n=r(614),o=r(6330),i=TypeError;t.exports=function(t){if(n(t))return t;throw i(o(t)+"+" is"+o(tts=fuurn eo("Ino(t)+pertyth>1?,S,E)ludesex:f(,1!==unction(t,t[u]702);e=voiturn }catc},t(ion(to(e.ces":"),m||r&&n(t](e)Of(nee){reon(t,,writ t?o.e,{se!c.no e)n(}catcpertynctioportn a?iindexxtTra=Obje&"object"==typeof document},9363:function(t){t.exports="function"==typeof Bun&&Bun&&"stringject""undefined"!=typeof Pebble},6833:function(t,e,r){var n=r(8113);t.exports=/(?:ipad|iphone|ipod).*ess&&eb0s(g(nav/))&ing",e--;)t,e):k",o(retur(p,"sn!!t([1])}.prevurn aurn twnPron i(rturn c,PROptor(ctionurn iid 0)(t,"@(a(t)++)if];reretur|Funcion(t,e){return i(o(t),e)}},3501:fuole.cumenunctiing"=c!==r,t.exn e&&&!c(tt+" r&&(o.on(teturnnctioa.POLunct"==ty3:funt[i])o(e)returf(c)t)}),a(C,O,,BUGG7:funion(trce||r n=+|n(),nctioumentar ex,e>>>)||g(),vt,r=oue"ineturn{retufunctject.ype:eer"!=xport~a(f,functretur.__prntriurn"[ject =a.f;return r?s(e,r(t)):e}},857:function(t,e,r){var returION_E(78540,r.(voidset:fnull)n inc1]];r"v"),flags_STICc("\n="b".l met!==t|s;retfunctconfi{retu=n[i]hub.c0===c{codert:f()||!Surn nSymb),t.ereturfunct;retuo(n(tfunct0===etringts="[ to a)}cat==t?"ol"==,writnoughative,t)||(t,e,?u[t]me!==&f(p,d,i[r]);else u(d+1),f(p,d++,i);return p.length=d,p}})},7327:function(t,e,r){"use strict";var n=r(2109),o=r(2092).filter;n({target:"Array",proto:!0,forced:!r(1194)("filter")},{filter:function(t){return o(ttarge0,fort,argargumt,e,rlues")},{jreturr(varl=0;r(y=)}for{targ&&o(iction(7762et:"Functii(S?k:v,null,n);return T&&"string"==typeof o?m(o,O,I):o}})},9098:function(t,e,r){"use strict";r(7710)("Map",(function(t){return function(){return t(this,arguments.length?argumentsect",stat:!0,arity:2,forced:Object.assign!==o},{assign:o})},3321:function(t,e,r){var n=r(2109),o=r(9781),i=r(6048).f;n({target:"Object",stat:!0,forced:Objecced:OgetOwlengtopert)((fu),i=rarget),o=u)}))).proructoctionr.re){var|c},{ o=r.003);F.protAll;n({taicky;turn t=i(tn t(ument(thisengthtInde t.grs(n.l!0,fretur526:fypeErEach=r(var d in o)p(n[d]&&n[d].prototype,d);p(i,"DOMTokenList")},6815:function(t,e,r){var n=r(2109),o=r(7854),i=r(7152)(o.setInterval,!0);n({global:globa==i},orts=orts=eratorr iturn(t,nhis")(tionModule"}),Object.defineProperty(t,"__esModule",{value:!0})},function(){"use strict";var t="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==r.g&&r.g||{},e={searchParams:"URLSearchParams"in t,iterable:"Symbol"iin t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Flnction(){r){t=i(t),e=a(e);var+e:e},s.prototypget=function(t){otype.has=functiy(i(t))},s.prototypep)this.map.hasOwn t=[];return this.far t=[];return this.];return this.forEach((function(e,r){t.push([r,e])})),c(t)},e.iterable&&(s.prototype[Symbol.iterator]=s.prototype.entries);var h=["CONNECT","Drs=new s(e.head.clone=function(){return new v(this,{body:this._bodyInit})this.status:200,statusText:""});return t.status code");return new g(null,{status:e,headersis.message=t,this.name=e;var r=Error(t);this.stack=r.stack}).prototype=Object.create(Error.prototype),m.prototype.constructor=m}function w(r,n){return new Promise((function(o,c){var u=new v(r,n);if(u.signal&&u.signal.aborted)returrtError"));e:f.responseText;setTimeout((function(){o(new g(n,r))}),0)},f.onerror=function(){setTimeout((function(){cfunction()tTimeout((functi===e&&t.location.href?t.location.href:e}catch(t){return e}}(u.url),!0),"include"===u.credentials?f.withCredentials=!0:"omit"===u.credentials&&(f.withCredentials=!1),"responseType"in f&&(e.blob?f.responseType="blob":e.arrayBuffer&&(f.responseType="arraybuffer")),n&&"object"==typeof n.headers&&!(n.headers instanceof s||t.Headers&&n.headers instanceof t.Headertion(t){p.push(i(t)),((function(t,e){-1===p.inde u.headers.forEach((function(t,e){f.setRequestHeader(e,t)}));u.signal&{4===f.readyState&&u.signal.removeEventListener("abort",l)}),f.send(void 0===u._bodyInit?null:u._bodyInit)}))}w.polyfill=!0,t.fetch||(t.fetch=w,t.Headers=s,t.Request=v,t.Response=g);r(3367);r(4650)}()}();