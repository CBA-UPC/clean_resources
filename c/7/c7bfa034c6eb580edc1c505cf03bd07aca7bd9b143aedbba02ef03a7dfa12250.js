import{a as e}from"./vuex.esm-bundler_aa359dca_r24-02-0_b0_t240129-161140.js";import{H as p}from"./vendor_6ed58054_r24-02-0_b0_t240129-161140.js";import{r as f}from"./rules_bb747cab_r24-02-0_b0_t240129-161140.js";import{c as S,W as b,y as w}from"./index_31ad23dc_r24-02-0_b0_t240129-161140.js";import{k as E}from"./lsanalytics-loyalty_c6fb8ea0_r24-02-0_b0_t240129-161140.js";import{c as g}from"./lsanalytics-login_d6e95fa1_r24-02-0_b0_t240129-161140.js";import{A as C}from"./AlertNotice_f548d739_r24-02-0_b0_t240129-161140.js";import{s as O}from"./serverToUserErrorMessageTransformer_631b8f39_r24-02-0_b0_t240129-161140.js";const k={mixins:[f,O],inject:["mq"],data(){return{email:"",firstName:"",lastName:"",emailOptInChecked:!1,password:"",emailValidationServerErrors:[],submitting:!1,otherErrorsExist:!1}},computed:{...p(S,["appLoyaltyType"]),...e("emailSubscriptionState",["subSource"]),...e("userProfileState",["uid"]),tempUser(){return{login:this.email.toLowerCase(),password:this.password,firstName:this.firstName,lastName:this.lastName,optIn:this.emailOptInChecked}}},methods:{register({reset:i,validate:o,disableSpinner:a}){return this.resetServerErrors(),o().then(({valid:m})=>{if(!m)return{success:!1};this.submitting=!0;const n="join modal",l=this.emailOptInChecked?"yes":"no",u=`email: ${this.uid}, subscribe: ${l}`;E(n,u);const r={tempUser:this.tempUser,disableSpinner:a};return this.subsourceIdentifier&&(r.subsource=this.subSource(this.$mq,this.subsourceIdentifier)),this.$store.dispatch("registerUser/registerUser",r).then(({status:t})=>{if(this.submitting=!1,t===b.SUCCESS){const h={email:this.email,[C]:this.appLoyaltyType};if(this.$emit("userRegistered",h),window.LSCO&&window.LSCO.dtos&&window.LSCO.dtos.globalData&&window.LSCO.dtos.globalData.customer){const s=window.LSCO.dtos.globalData.customer;w(this.email);const d=window.LSCO.dtos.globalData.customer.user_id;g(d,s.auth_status,s.levi_id,s.city,s.state,s.adobe_id)}return{success:!0}}this.otherErrorsExist=!0;const{email:c}=this.serverErrMsgMapper(t);return this.emailValidationServerErrors=c,this.password="",i(),{success:!1}}).catch(t=>{throw this.submitting=!1,this.otherErrorsExist=!0,new Error(t)})})},resetServerErrors};export{k as r};
