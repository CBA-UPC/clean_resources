<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="cache-control" content="max-age=0"><meta http-equiv="cache-control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="apple-mobile-web-app-capable" content="yes"><meta property="og:title" content="Sync to Calendar"><meta property="og:image" content="/button/v1/media/images/meta-og-logo1.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><link rel="icon" href="/button/v1/media/images/favicon.ico" sizes="32x32"><title>ECAL</title><link defer="defer" href="/button/v1/css/bundle.f52bcf4.css?_=1706766251642" rel="stylesheet"></head><body><div id="root"></div><script type="text/javascript" src="/button/v1/bundle.f52bcf4.js?_=1706766251642"></script></body></html>bed svg {\n  opacity: 0.7;\n}\n.pushly_bell:not(.subscribed) .pushly_bell-tooltip-subscribed {\n  display: none;\n}\n.pushly_bell.hover svg {\n  opacity: 0.7;\n}\n.pushly_bell.hover .pushly_bell-tooltip {\n  opacity: 1;\n}\n.pushly_bell svg {\n  z-index: 1;\n  transition: all 0.5s ease;\n  box-shadow: 0px 1px 3px #888;\n  border-radius: 1000px;\n  cursor: pointer;\n}\n.pushly_bell .pushly_bell-tooltip {\n  transition: all 0.5s ease;\n  position: relative;\n  opacity: 0;\n  pointer-events: none;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  margin-right: 7.5px;\n  margin-left: 7.5px;\n}\n.pushly_bell .pushly_bell-tooltip .pushly_bell-tooltip-text {\n  padding: 8px 16px;\n  border-radius: 3px;\n  font-size: 13px;\n}\n.pushly_bell .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n  position: relative;\n  width: 15px;\n  height: 15px;\n  border-radius: 1px;\n  transform: rotate(45deg);\n}\n@media screen and (min-width: 768px) {\n  .pushly_bell.d-top-left {\n    top: 40px;\n    left: -200px;\n  }\n  .pushly_bell.d-top-left.hover .pushly_bell-tooltip {\n    left: 0;\n  }\n  .pushly_bell.d-top-left .pushly_bell-tooltip {\n    left: -30px;\n  }\n  .pushly_bell.d-top-left .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    left: 7.5px;\n  }\n  .pushly_bell.d-top-left.pushly-prompt-visible {\n    left: 40px;\n  }\n  .pushly_bell.d-top-right {\n    top: 40px;\n    right: -200px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.d-top-right.hover .pushly_bell-tooltip {\n    right: 0;\n  }\n  .pushly_bell.d-top-right .pushly_bell-tooltip {\n    right: -30px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.d-top-right .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    right: 7.5px;\n  }\n  .pushly_bell.d-top-right.pushly-prompt-visible {\n    right: 40px;\n  }\n  .pushly_bell.d-bottom-left {\n    bottom: 40px;\n    left: -200px;\n  }\n  .pushly_bell.d-bottom-left.hover .pushly_bell-tooltip {\n    left: 0;\n  }\n  .pushly_bell.d-bottom-left .pushly_bell-tooltip {\n    left: -30px;\n  }\n  .pushly_bell.d-bottom-left .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    left: 7.5px;\n  }\n  .pushly_bell.d-bottom-left.pushly-prompt-visible {\n    left: 40px;\n  }\n  .pushly_bell.d-bottom-right {\n    bottom: 40px;\n    right: -200px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.d-bottom-right.hover .pushly_bell-tooltip {\n    right: 0;\n  }\n  .pushly_bell.d-bottom-right .pushly_bell-tooltip {\n    right: -30px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.d-bottom-right .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    right: 7.5px;\n  }\n  .pushly_bell.d-bottom-right.pushly-prompt-visible {\n    right: 40px;\n  }\n  .pushly_bell.d-disabled {\n    display: none;\n  }\n}\n@media screen and (max-width: 768px) {\n  .pushly_bell.m-top-left {\n    top: 40px;\n    left: -200px;\n  }\n  .pushly_bell.m-top-left.hover .pushly_bell-tooltip {\n    left: 0;\n  }\n  .pushly_bell.m-top-left .pushly_bell-tooltip {\n    left: -30px;\n  }\n  .pushly_bell.m-top-left .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    left: 7.5px;\n  }\n  .pushly_bell.m-top-left.pushly-prompt-visible {\n    left: 40px;\n  }\n  .pushly_bell.m-top-right {\n    top: 40px;\n    right: -200px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.m-top-right.hover .pushly_bell-tooltip {\n    right: 0;\n  }\n  .pushly_bell.m-top-right .pushly_bell-tooltip {\n    right: -30px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.m-top-right .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    right: 7.5px;\n  }\n  .pushly_bell.m-top-right.pushly-prompt-visible {\n    right: 40px;\n  }\n  .pushly_bell.m-bottom-left {\n    bottom: 40px;\n    left: -200px;\n  }\n  .pushly_bell.m-bottom-left.hover .pushly_bell-tooltip {\n    left: 0;\n  }\n  .pushly_bell.m-bottom-left .pushly_bell-tooltip {\n    left: -30px;\n  }\n  .pushly_bell.m-bottom-left .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    left: 7.5px;\n  }\n  .pushly_bell.m-bottom-left.pushly-prompt-visible {\n    left: 40px;\n  }\n  .pushly_bell.m-bottom-right {\n    bottom: 40px;\n    right: -200px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.m-bottom-right.hover .pushly_bell-tooltip {\n    right: 0;\n  }\n  .pushly_bell.m-bottom-right .pushly_bell-tooltip {\n    right: -30px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.m-bottom-right .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    right: 7.5px;\n  }\n  .pushly_bell.m-bottom-right.pushly-prompt-visible {\n    right: 40px;\n  }\n  .pushly_bell.m-disabled {\n    display: none;\n  }\n}","",{version:3,sources:["webpack://./src/sdk/styles/bell.scss"],names:[],mappings:"AAKA;EACI;IACI,wBAAA;EAJN;AACF;AAOA;EACI,aAAA;EACA,mBAAA;EACA,mBAAA;EA4EA,wBAAA;EA0GA,uBAAA;AAzLJ;AAKI;EACI,eAAA;EACA,gBAAA;EACA,yBAAA;AAHR;AAOQ;EACI,aAAA;AALZ;AAQQ;EACI,YAAA;AANZ;AAWQ;EACI,aAAA;AATZ;AAcQ;EACI,YAAA;AAZZ;AAeQ;EACI,UAAA;AAbZ;AAiBI;EACI,UAAA;EACA,yBAAA;EACA,4BAAA;EACA,qBAAA;EACA,eAAA;AAfR;AAkBI;EACI,yBAAA;EAEA,kBAAA;EAEA,UAAA;EACA,oBAAA;EAEA,aAAA;EACA,mBAAA;EACA,mBAAA;EAEA,mBAAA;EACA,kBAAA;AApBR;AAsBQ;EACI,iBAAA;EACA,kBAAA;EAEA,eAAA;AArBZ;AAwBQ;EACI,kBAAA;EAEA,WA/EA;EAgFA,YAhFA;EAkFA,kBAAA;EAEA,wBAAA;AAzBZ;AA+BI;EACI;IACI,SAAA;IACA,YAAA;EA7BV;EAgCc;IACI,OAAA;EA9BlB;EAkCU;IACI,WAAA;EAhCd;EAkCc;IACI,WAAA;EAhClB;EAoCU;IACI,UAAA;EAlCd;EAsCM;IACI,SAAA;IACA,aAAA;IAEA,2BAAA;EArCV;EAwCc;IACI,QAAA;EAtClB;EA0CU;IACI,YAAA;IACA,2BAAA;EAxCd;EA0Cc;IACI,YAAA;EAxClB;EA4CU;IACI,WAAA;EA1Cd;EA8CM;IACI,YAAA;IACA,YAAA;EA5CV;EA+Cc;IACI,OAAA;EA7ClB;EAiDU;IACI,WAAA;EA/Cd;EAiDc;IACI,WAAA;EA/ClB;EAmDU;IACI,UAAA;EAjDd;EAqDM;IACI,YAAA;IACA,aAAA;IAEA,2BAAA;EApDV;EAuDc;IACI,QAAA;EArDlB;EAyDU;IACI,YAAA;IACA,2BAAA;EAvDd;EAyDc;IACI,YAAA;EAvDlB;EA2DU;IACI,WAAA;EAzDd;EA6DM;IACI,aAAA;EA3DV;AACF;AAgEI;EACI;IACI,SAAA;IACA,YAAA;EA9DV;EAiEc;IACI,OAAA;EA/DlB;EAmEU;IACI,WAAA;EAjEd;EAmEc;IACI,WAAA;EAjElB;EAqEU;IACI,UAAA;EAnEd;EAuEM;IACI,SAAA;IACA,aAAA;IAEA,2BAAA;EAtEV;EAyEc;IACI,QAAA;EAvElB;EA2EU;IACI,YAAA;IACA,2BAAA;EAzEd;EA2Ec;IACI,YAAA;EAzElB;EA6EU;IACI,WAAA;EA3Ed;EA+EM;IACI,YAAA;IACA,YAAA;EA7EV;EAgFc;IACI,OAAA;EA9ElB;EAkFU;IACI,WAAA;EAhFd;EAkFc;IACI,WAAA;EAhFlB;EAoFU;IACI,UAAA;EAlFd;EAsFM;IACI,YAAA;IACA,aAAA;IAEA,2BAAA;EArFV;EAwFc;IACI,QAAA;EAtFlB;EA0FU;IACI,YAAA;IACA,2BAAA;EAxFd;EA0Fc;IACI,YAAA;EAxFlB;EA4FU;IACI,WAAA;EA1Fd;EA8FM;IACI,aAAA;EA5FV;AACF",sourcesContent:['@import "variables";\n\n$arrowSize: 15px;\n$tooltipAnimationDisplacement: 30px;\n\n@media print {\n    .pushly_bell {\n        display: none !important;\n    }\n}\n\n.pushly_bell {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n\n    &:not(.managed) {\n        position: fixed;\n        z-index: 1000000;\n        transition: all 0.5s ease;\n    }\n\n    &.subscribed {\n        .pushly_bell-tooltip-notsubscribed {\n            display: none;\n        }\n\n        svg {\n            opacity: 0.7;\n        }\n    }\n\n    &:not(.subscribed) {\n        .pushly_bell-tooltip-subscribed {\n            display: none;\n        }\n    }\n\n    &.hover {\n        svg {\n            opacity: 0.7;\n        }\n\n        .pushly_bell-tooltip {\n            opacity: 1;\n        }\n    }\n\n    svg {\n        z-index: 1;\n        transition: all 0.5s ease;\n        box-shadow: 0px 1px 3px #888;\n        border-radius: 1000px;\n        cursor: pointer;\n    }\n\n    .pushly_bell-tooltip {\n        transition: all 0.5s ease;\n\n        position: relative;\n\n        opacity: 0;\n        pointer-events: none;\n\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n\n        margin-right: calc($arrowSize/2);\n        margin-left: calc($arrowSize/2);\n\n        .pushly_bell-tooltip-text {\n            padding: 8px 16px;\n            border-radius: 3px;\n\n            font-size: 13px;\n        }\n\n        .pushly_bell-tooltip-arrow {\n            position: relative;\n\n            width: $arrowSize;\n            height: $arrowSize;\n\n            border-radius: 1px;\n\n            transform: rotate(45deg);\n        }\n    }\n\n    /* desktop positioning */\n\n    @media screen and (min-width: $mobile-max-size) {\n        &.d-top-left {\n            top: 40px;\n            left: -200px;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    left: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                left: -$tooltipAnimationDisplacement;\n\n                .pushly_bell-tooltip-arrow {\n                    left: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                left: 40px;\n            }\n        }\n\n        &.d-top-right {\n            top: 40px;\n            right: -200px;\n\n            flex-direction: row-reverse;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    right: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                right: -$tooltipAnimationDisplacement;\n                flex-direction: row-reverse;\n\n                .pushly_bell-tooltip-arrow {\n                    right: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                right: 40px;\n            }\n        }\n\n        &.d-bottom-left {\n            bottom: 40px;\n            left: -200px;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    left: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                left: -$tooltipAnimationDisplacement;\n\n                .pushly_bell-tooltip-arrow {\n                    left: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                left: 40px;\n            }\n        }\n\n        &.d-bottom-right {\n            bottom: 40px;\n            right: -200px;\n\n            flex-direction: row-reverse;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    right: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                right: -$tooltipAnimationDisplacement;\n                flex-direction: row-reverse;\n\n                .pushly_bell-tooltip-arrow {\n                    right: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                right: 40px;\n            }\n        }\n\n        &.d-disabled {\n            display: none;\n        }\n    }\n\n    /* mobile positioning */\n\n    @media screen and (max-width: $mobile-max-size) {\n        &.m-top-left {\n            top: 40px;\n            left: -200px;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    left: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                left: -$tooltipAnimationDisplacement;\n\n                .pushly_bell-tooltip-arrow {\n                    left: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                left: 40px;\n            }\n        }\n\n        &.m-top-right {\n            top: 40px;\n            right: -200px;\n\n            flex-direction: row-reverse;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    right: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                right: -$tooltipAnimationDisplacement;\n                flex-direction: row-reverse;\n\n                .pushly_bell-tooltip-arrow {\n                    right: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                right: 40px;\n            }\n        }\n\n        &.m-bottom-left {\n            bottom: 40px;\n            left: -200px;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    left: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                left: -$tooltipAnimationDisplacement;\n\n                .pushly_bell-tooltip-arrow {\n                    left: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                left: 40px;\n            }\n        }\n\n        &.m-bottom-right {\n            bottom: 40px;\n            right: -200px;\n\n            flex-direction: row-reverse;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    right: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                right: -$tooltipAnimationDisplacement;\n                flex-direction: row-reverse;\n\n                .pushly_bell-tooltip-arrow {\n                    right: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                right: 40px;\n            }\n        }\n\n        &.m-disabled {\n            display: none;\n        }\n    }\n}\n'],sourceRoot:""}]);const o=t},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/sdk/styles/popover.scss":(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var s=t("./node_modules/css-loader/dist/runtime/sourceMaps.js"),s=t.n(s),i=t("./node_modules/css-loader/dist/runtime/api.js"),t=t.n(i)()(s());t.push([e.id,"@media print {\n  .pushly-prompt-window,\n  .pushly_popover {\n    display: none !important;\n  }\n}\n.pushly-prompt-window,\n.pushly_popover {\n  left: 0;\n  right: 0;\n  pointer-events: none;\n  /* theme: normal */\n  /* theme: stacked */\n  /* desktop positioning */\n  /* mobile positioning */\n}\n.pushly-prompt-window:not(.managed),\n.pushly_popover:not(.managed) {\n  position: fixed;\n  z-index: 1000000;\n  transition: all 0.5s ease;\n}\n.pushly-prompt-window .pushly-prompt-slide,\n.pushly-prompt-window .pushly_popover-box,\n.pushly_popover .pushly-prompt-slide,\n.pushly_popover .pushly_popover-box {\n  pointer-events: all;\n  margin: 0px auto;\n  box-sizing: border-box;\n  display: flex;\n  width: 400px;\n  padding: 16px;\n}\n.pushly-prompt-window .pushly-prompt-slide.pushly-prompt-visible,\n.pushly-prompt-window .pushly_popover-box.pushly-prompt-visible,\n.pushly_popover .pushly-prompt-slide.pushly-prompt-visible,\n.pushly_popover .pushly_popover-box.pushly-prompt-visible {\n  top: 0;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-icon,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-first,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-icon,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-first,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-icon,\n.pushly_popover .pushly-prompt-slide .pushly_popover-first,\n.pushly_popover .pushly_popover-box .pushly-prompt-icon,\n.pushly_popover .pushly_popover-box .pushly_popover-first {\n  position: relative;\n  max-width: 80px;\n  height: 80px;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-icon img,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-first img,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-icon img,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-first img,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-icon img,\n.pushly_popover .pushly-prompt-slide .pushly_popover-first img,\n.pushly_popover .pushly_popover-box .pushly-prompt-icon img,\n.pushly_popover .pushly_popover-box .pushly_popover-first img {\n  width: 100%;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second,\n.pushly_popover .pushly_popover-box .pushly-prompt-content,\n.pushly_popover .pushly_popover-box .pushly_popover-second {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline {\n  font-size: 1em;\n  padding-top: 8px;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-subheadline {\n  font-size: 0.8em;\n  padding-top: 12px;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-actions,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-buttons,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-actions,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-buttons {\n  margin-top: 16px;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions button,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons button,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions button,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons button,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions button,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons button,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-actions button,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-buttons button,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions button,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons button,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions button,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons button,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions button,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons button,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-actions button,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-buttons button {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 16px;\n  padding-right: 16px;\n  border: none;\n  font-size: 0.8em;\n  border-radius: 3px;\n  background: none;\n  cursor: pointer;\n}\n.pushly-prompt-window.normal .pushly-prompt-slide,\n.pushly-prompt-window.normal .pushly_popover-box,\n.pushly_popover.normal .pushly-prompt-slide,\n.pushly_popover.normal .pushly_popover-box {\n  flex-direction: row;\n  justify-content: space-between;\n}\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second {\n  width: calc(100% - 80px);\n  padding-left: 16px;\n}\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline:first-child {\n  padding-top: 0 !important;\n}\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-actions,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly_popover-buttons,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-actions,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly_popover-buttons {\n  display: flex;\n  justify-content: flex-end;\n}\n.pushly-prompt-window.stacked .pushly-prompt-slide,\n.pushly-prompt-window.stacked .pushly_popover-box,\n.pushly_popover.stacked .pushly-prompt-slide,\n.pushly_popover.stacked .pushly_popover-box {\n  text-align: center;\n  flex-direction: column;\n  align-content: center;\n  align-items: center;\n}\n@media screen and (min-width: 768px) {\n  .pushly-prompt-window.d-top,\n  .pushly_popover.d-top {\n    top: -600px;\n    bottom: auto;\n  }\n  .pushly-prompt-window.d-top .pushly-prompt-slide,\n  .pushly-prompt-window.d-top .pushly_popover-box,\n  .pushly_popover.d-top .pushly-prompt-slide,\n  .pushly_popover.d-top .pushly_popover-box {\n    box-shadow: 0px 1px 1px #bbb;\n  }\n  .pushly-prompt-window.d-top.pushly-prompt-visible,\n  .pushly_popover.d-top.pushly-prompt-visible {\n    top: 0;\n  }\n  .pushly-prompt-window.d-bottom,\n  .pushly_popover.d-bottom {\n    bottom: -600px;\n    top: auto;\n  }\n  .pushly-prompt-window.d-bottom .pushly-prompt-slide,\n  .pushly-prompt-window.d-bottom .pushly_popover-box,\n  .pushly_popover.d-bottom .pushly-prompt-slide,\n  .pushly_popover.d-bottom .pushly_popover-box {\n    box-shadow: 0px -1px 1px #bbb;\n  }\n  .pushly-prompt-window.d-bottom.pushly-prompt-visible,\n  .pushly_popover.d-bottom.pushly-prompt-visible {\n    bottom: 0;\n  }\n  .pushly-prompt-window.d-disabled,\n  .pushly_popover.d-disabled {\n    display: none;\n  }\n}\n@media screen and (max-width: 768px) {\n  .pushly-prompt-window.m-top,\n  .pushly_popover.m-top {\n    top: -600px;\n    bottom: auto;\n  }\n  .pushly-prompt-window.m-top .pushly-prompt-slide,\n  .pushly-prompt-window.m-top .pushly_popover-box,\n  .pushly_popover.m-top .pushly-prompt-slide,\n  .pushly_popover.m-top .pushly_popover-box {\n    box-shadow: 0px 1px 1px #bbb;\n  }\n  .pushly-prompt-window.m-top.pushly-prompt-visible,\n  .pushly_popover.m-top.pushly-prompt-visible {\n    top: 0;\n  }\n  .pushly-prompt-window.m-bottom,\n  .pushly_popover.m-bottom {\n    bottom: -600px;\n    top: auto;\n  }\n  .pushly-prompt-window.m-bottom .pushly-prompt-slide,\n  .pushly-prompt-window.m-bottom .pushly_popover-box,\n  .pushly_popover.m-bottom .pushly-prompt-slide,\n  .pushly_popover.m-bottom .pushly_popover-box {\n    box-shadow: 0px -1px 1px #bbb;\n  }\n  .pushly-prompt-window.m-bottom.pushly-prompt-visible,\n  .pushly_popover.m-bottom.pushly-prompt-visible {\n    bottom: 0;\n  }\n  .pushly-prompt-window.m-disabled,\n  .pushly_popover.m-disabled {\n    display: none;\n  }\n}\n@media screen and (max-width: 480px) {\n  .pushly-prompt-window .pushly-prompt-slide,\n  .pushly-prompt-window .pushly_popover-box,\n  .pushly_popover .pushly-prompt-slide,\n  .pushly_popover .pushly_popover-box {\n    width: 100%;\n  }\n  .pushly-prompt-window .pushly-prompt-slide .pushly-prompt-icon,\n  .pushly-prompt-window .pushly-prompt-slide .pushly_popover-first,\n  .pushly-prompt-window .pushly_popover-box .pushly-prompt-icon,\n  .pushly-prompt-window .pushly_popover-box .pushly_popover-first,\n  .pushly_popover .pushly-prompt-slide .pushly-prompt-icon,\n  .pushly_popover .pushly-prompt-slide .pushly_popover-first,\n  .pushly_popover .pushly_popover-box .pushly-prompt-icon,\n  .pushly_popover .pushly_popover-box .pushly_popover-first {\n    max-width: calc(80px - 20px);\n    height: calc(80px - 20px);\n  }\n  .pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content,\n  .pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second,\n  .pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content,\n  .pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second,\n  .pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content,\n  .pushly_popover.normal .pushly-prompt-slide .pushly_popover-second,\n  .pushly_popover.normal .pushly_popover-box .pushly-prompt-content,\n  .pushly_popover.normal .pushly_popover-box .pushly_popover-second {\n    width: calc(100% - 80px + 20px);\n  }\n  .pushly-prompt-window.m-disabled,\n  .pushly_popover.m-disabled {\n    display: none;\n  }\n}","",{version:3,sources:["webpack://./src/sdk/styles/popover.scss"],names:[],mappings:"AAMA;EACI;;IAEI,wBAAA;EALN;AACF;AAQA;;EAQI,OAAA;EACA,QAAA;EACA,oBAAA;EAkEA,kBAAA;EAiCA,mBAAA;EAYA,wBAAA;EAoCA,uBAAA;AA3JJ;AAAI;;EACI,eAAA;EACA,gBAAA;EACA,yBAAA;AAGR;AAII;;;;EAEI,mBAAA;EACA,gBAAA;EACA,sBAAA;EACA,aAAA;EACA,YA7BA;EA8BA,aA5BE;AA4BV;AAEQ;;;;EACI,MAAA;AAGZ;AAAQ;;;;;;;;EAEI,kBAAA;EACA,eAtCA;EAuCA,YAvCA;AA+CZ;AANY;;;;;;;;EACI,WAAA;AAehB;AAXQ;;;;;;;;EAEI,aAAA;EACA,sBAAA;EACA,8BAAA;AAmBZ;AAfgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEI,cAAA;EACA,gBAAA;AA+CpB;AA5CgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEI,gBAAA;EACA,iBAAA;AA4EpB;AAxEY;;;;;;;;;;;;;;;;EAEI,gBApEN;AA4JV;AAtFgB;;;;;;;;;;;;;;;;EACI,gBAAA;EACA,mBAAA;EACA,kBAAA;EACA,mBAAA;EACA,YAAA;EACA,gBAAA;EACA,kBAAA;EACA,gBAAA;EACA,eAAA;AAuGpB;AA9FQ;;;;EAEI,mBAAA;EACA,8BAAA;AAkGZ;AAhGY;;;;;;;;EAGI,wBAAA;EACA,kBAjGN;AAwMV;AAjGwB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EACI,yBAAA;AAkI5B;AA7HgB;;;;;;;;;;;;;;;;EAEI,aAAA;EACA,yBAAA;AA6IpB;AApIQ;;;;EAEI,kBAAA;EACA,sBAAA;EACA,qBAAA;EACA,mBAAA;AAwIZ;AAlII;EACI;;IACI,WAAA;IACA,YAAA;EAqIV;EAnIU;;;;IAEI,4BAAA;EAuId;EApIU;;IACI,MAAA;EAuId;EAnIM;;IACI,cAAA;IACA,SAAA;EAsIV;EApIU;;;;IAEI,6BAAA;EAwId;EArIU;;IACI,SAAA;EAwId;EApIM;;IACI,aAAA;EAuIV;AACF;AAlII;EACI;;IACI,WAAA;IACA,YAAA;EAqIV;EAnIU;;;;IAEI,4BAAA;EAuId;EApIU;;IACI,MAAA;EAuId;EAnIM;;IACI,cAAA;IACA,SAAA;EAsIV;EApIU;;;;IAEI,6BAAA;EAwId;EArIU;;IACI,SAAA;EAwId;EApIM;;IACI,aAAA;EAuIV;AACF;AApII;EACI;;;;IAEI,WAAA;EAwIV;EAtIU;;;;;;;;IAEI,4BAAA;IACA,yBAAA;EA8Id;EAvIc;;;;;;;;IAEI,+BAAA;EA+IlB;EA1IM;;IACI,aAAA;EA6IV;AACF",sourcesContent:['@import "variables";\n\n$width: 400px;\n$imageSize: 80px;\n$padding: 16px;\n\n@media print {\n    .pushly-prompt-window,\n    .pushly_popover {\n        display: none !important;\n    }\n}\n\n.pushly-prompt-window,\n.pushly_popover {\n    &:not(.managed) {\n        position: fixed;\n        z-index: 1000000;\n        transition: all 0.5s ease;\n    }\n\n    left: 0;\n    right: 0;\n    pointer-events: none;\n\n    .pushly-prompt-slide,\n    .pushly_popover-box {\n        pointer-events: all;\n        margin: 0px auto;\n        box-sizing: border-box;\n        display: flex;\n        width: $width;\n        padding: $padding;\n\n        &.pushly-prompt-visible {\n            top: 0;\n        }\n\n        .pushly-prompt-icon,\n        .pushly_popover-first {\n            position: relative;\n            max-width: $imageSize;\n            height: $imageSize;\n\n            img {\n                width: 100%;\n            }\n        }\n\n        .pushly-prompt-content,\n        .pushly_popover-second {\n            display: flex;\n            flex-direction: column;\n            justify-content: space-between;\n\n            .pushly-prompt-message,\n            .pushly_popover-message {\n                .pushly-prompt-message-headline,\n                .pushly_popover-message-headline {\n                    font-size: 1em;\n                    padding-top: 8px;\n                }\n\n                .pushly-prompt-message-subheadline,\n                .pushly_popover-message-subheadline {\n                    font-size: 0.8em;\n                    padding-top: 12px;\n                }\n            }\n\n            .pushly-prompt-actions,\n            .pushly_popover-buttons {\n                margin-top: $padding;\n\n                button {\n                    padding-top: 8px;\n                    padding-bottom: 8px;\n                    padding-left: 16px;\n                    padding-right: 16px;\n                    border: none;\n                    font-size: 0.8em;\n                    border-radius: 3px;\n                    background: none;\n                    cursor: pointer;\n                }\n            }\n        }\n    }\n\n    /* theme: normal */\n\n    &.normal {\n        .pushly-prompt-slide,\n        .pushly_popover-box {\n            flex-direction: row;\n            justify-content: space-between;\n\n            .pushly-prompt-content,\n            .pushly_popover-second {\n                //width: calc(#{$width} - #{$imageSize} - #{$padding*3});\n                width: calc(100% - #{$imageSize});\n                padding-left: $padding;\n\n                .pushly-prompt-message,\n                .pushly_popover-message {\n                    .pushly-prompt-message-headline,\n                    .pushly_popover-message-headline {\n                        &:first-child {\n                            padding-top: 0 !important;\n                        }\n                    }\n                }\n\n                .pushly-prompt-actions,\n                .pushly_popover-buttons {\n                    display: flex;\n                    justify-content: flex-end;\n                }\n            }\n        }\n    }\n\n    /* theme: stacked */\n\n    &.stacked {\n        .pushly-prompt-slide,\n        .pushly_popover-box {\n            text-align: center;\n            flex-direction: column;\n            align-content: center;\n            align-items: center;\n        }\n    }\n\n    /* desktop positioning */\n\n    @media screen and (min-width: $mobile-max-size) {\n        &.d-top {\n            top: -600px;\n            bottom: auto;\n\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                box-shadow: 0px 1px 1px #bbb;\n            }\n\n            &.pushly-prompt-visible {\n                top: 0;\n            }\n        }\n\n        &.d-bottom {\n            bottom: -600px;\n            top: auto;\n\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                box-shadow: 0px -1px 1px #bbb;\n            }\n\n            &.pushly-prompt-visible {\n                bottom: 0;\n            }\n        }\n\n        &.d-disabled {\n            display: none;\n        }\n    }\n\n    /* mobile positioning */\n\n    @media screen and (max-width: $mobile-max-size) {\n        &.m-top {\n            top: -600px;\n            bottom: auto;\n\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                box-shadow: 0px 1px 1px #bbb;\n            }\n\n            &.pushly-prompt-visible {\n                top: 0;\n            }\n        }\n\n        &.m-bottom {\n            bottom: -600px;\n            top: auto;\n\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                box-shadow: 0px -1px 1px #bbb;\n            }\n\n            &.pushly-prompt-visible {\n                bottom: 0;\n            }\n        }\n\n        &.m-disabled {\n            display: none;\n        }\n    }\n\n    @media screen and (max-width: $small-screen) {\n        .pushly-prompt-slide,\n        .pushly_popover-box {\n            width: 100%;\n\n            .pushly-prompt-icon,\n            .pushly_popover-first {\n                max-width: calc(#{$imageSize} - 20px);\n                height: calc(#{$imageSize} - 20px);\n            }\n        }\n\n        &.normal {\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                .pushly-prompt-content,\n                .pushly_popover-second {\n                    width: calc(100% - #{$imageSize} + 20px);\n                }\n            }\n        }\n\n        &.m-disabled {\n            display: none;\n        }\n    }\n}\n'],sourceRoot:""}]);const o=t},"./node_modules/css-loader/dist/runtime/api.js":e=>{"use strict";e.exports=function(i){var d=[];return d.toString=function(){return this.map(function(e){var s="",t=void 0!==e[5];return e[4]&&(s+="@supports (".concat(e[4],") {")),e[2]&&(s+="@media ".concat(e[2]," {")),t&&(s+="@layer".concat(0<e[5].length?" ".concat(e[5]):""," {")),s+=i(e),t&&(s+="}"),e[2]&&(s+="}"),e[4]&&(s+="}"),s}).join("")},d.i=function(e,s,t,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var n={};if(t)for(var r=0;r<this.length;r++){var p=this[r][0];null!=p&&(n[p]=!0)}for(var l=0;l<e.length;l++){var u=[].concat(e[l]);t&&n[u[0]]||(void 0!==o&&(void 0!==u[5]&&(u[1]="@layer".concat(0<u[5].length?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),s&&(u[2]&&(u[1]="@media ".concat(u[2]," {").concat(u[1],"}")),u[2]=s),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),d.push(u))}},d}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":e=>{"use strict";e.exports=function(e){var s,t=e[1],i=e[3];return i?"function"==typeof btoa?(e=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),e="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e),e="/*# ".concat(e," */"),s=i.sources.map(function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}),[t].concat(s).concat([e]).join("\n")):[t].join("\n"):t}},"./node_modules/error-stack-parser/error-stack-parser.js":function(s,t,i){var o,n;!function(e){"use strict";n=[i("./node_modules/stackframe/stackframe.js")],void 0!==(n="function"==typeof(o=e)?o.apply(t,n):o)&&(s.exports=n)}(function(p){"use strict";var s=/(^|@)\S+:\d+/,t=/^\s*at .*(\S+:\d+|\(native\))/m,i=/^(eval@)?(\[native code])?$/;return{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(t))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];e=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter(function(e){return!!e.match(t)},this).map(function(e){var s=(t=(e=-1<e.indexOf("(eval ")?e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""):e).replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,"")).match(/ (\(.+\)$)/),t=s?t.replace(s[0],""):t,i=this.extractLocation(s?s[1]:t),s=s&&t||void 0,t=-1<["eval","<anonymous>"].indexOf(i[0])?void 0:i[0];return new p({functionName:s,fileName:t,lineNumber:i[1],columnNumber:i[2],source:e})},this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter(function(e){return!e.match(i)},this).map(function(e){var s,t;return-1===(e=-1<e.indexOf(" > eval")?e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1"):e).indexOf("@")&&-1===e.indexOf(":")?new p({functionName:e}):(s=(s=e.match(t=/((.*".+"[^@]*)?[^@]*)(?:@)/))&&s[1]?s[1]:void 0,t=this.extractLocation(e.replace(t,"")),new p({functionName:s,fileName:t[0],lineNumber:t[1],columnNumber:t[2],source:e}))},this)},parseOpera:function(e){return!e.stacktrace||-1<e.message.indexOf("\n")&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var s=/Line (\d+).*script (?:in )?(\S+)/i,t=e.message.split("\n"),i=[],o=2,n=t.length;o<n;o+=2){var r=s.exec(t[o]);r&&i.push(new p({fileName:r[2],lineNumber:r[1],source:t[o]}))}return i},parseOpera10:function(e){for(var s=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,t=e.stacktrace.split("\n"),i=[],o=0,n=t.length;o<n;o+=2){var r=s.exec(t[o]);r&&i.push(new p({functionName:r[3]||void 0,fileName:r[2],lineNumber:r[1],source:t[o]}))}return i},parseOpera11:function(e){return e.stack.split("\n").filter(function(e){return!!e.match(s)&&!e.match(/^Error created at/)},this).map(function(e){var s,t=e.split("@"),i=this.extractLocation(t.pop()),t=t.shift()||"",o=t.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,t=void 0===(s=t.match(/\(([^)]*)\)/)?t.replace(/^[^(]+\(([^)]*)\)$/,"$1"):s)||"[arguments not available]"===s?void 0:s.split(",");return new p({functionName:o,args:t,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:e})},this)}}})},"./node_modules/stackframe/stackframe.js":function(e,s){var t,i;!function(){"use strict";i=[],void 0!==(i="function"==typeof(t=function(){"use strict";function t(e){return!isNaN(parseFloat(e))&&isFinite(e)}function i(e){return e.charAt(0).toUpperCase()+e.substring(1)}function e(e){return function(){return this[e]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],n=["fileName","functionName","source"],r,p,l=s.concat(o,n,["args"],["evalOrigin"]);function c(e){if(!e)return;for(var s=0;s<l.length;s++)if(e[l[s]]!==undefined)this["set"+i(l[s])](e[l[s]])}c.prototype={getArgs:function(){return this.args},setArgs:function(e){if(Object.prototype.toString.call(e)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof c)this.evalOrigin=e;else if(e instanceof Object)this.evalOrigin=new c(e);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var e=this.getFileName()||"";var s=this.getLineNumber()||"";var t=this.getColumnNumber()||"";var i=this.getFunctionName()||"";if(this.getIsEval()){if(e)return"[eval] ("+e+":"+s+":"+t+")";return"[eval]:"+s+":"+t}if(i)return i+" ("+e+":"+s+":"+t+")";return e+":"+s+":"+t}},c.fromString=function e(s){var t=s.indexOf("(");var i=s.lastIndexOf(")");var o=s.substring(0,t);var n=s.substring(t+1,i).split(",");var r=s.substring(i+1);if(r.indexOf("@")===0){var p=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(r,"");var l=p[1];var u=p[2];var d=p[3]}return new c({functionName:o,args:n||undefined,fileName:l,lineNumber:u||undefined,columnNumber:d||undefined})};for(var u=0;u<s.length;u++){c.prototype["get"+i(s[u])]=e(s[u]);c.prototype["set"+i(s[u])]=function(s){return function(e){this[s]=Boolean(e)}}(s[u])}for(var d=0;d<o.length;d++){c.prototype["get"+i(o[d])]=e(o[d]);c.prototype["set"+i(o[d])]=function(s){return function(e){if(!t(e))throw new TypeError(s+" must be a Number");this[s]=Number(e)}}(o[d])}for(var a=0;a<n.length;a++){c.prototype["get"+i(n[a])]=e(n[a]);c.prototype["set"+i(n[a])]=function(s){return function(e){this[s]=String(e)}}(n[a])}return c})?t.apply(s,i):t)&&(e.exports=i)}()},"./src/sdk/styles/bell.scss":(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var s=t("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),s=t.n(s),i=t("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),i=t.n(i),o=t("./node_modules/style-loader/dist/runtime/insertBySelector.js"),o=t.n(o),n=t("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),n=t.n(n),r=t("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),r=t.n(r),p=t("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),p=t.n(p),t=t("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/sdk/styles/bell.scss"),l={};l.styleTagTransform=p(),l.setAttributes=n(),l.insert=o().bind(null,"head"),l.domAPI=i(),l.insertStyleElement=r(),s()(t.default,l);const u=t.default&&t.default.locals?t.default.locals:void 0},"./src/sdk/styles/popover.scss":(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var s=t("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),s=t.n(s),i=t("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),i=t.n(i),o=t("./node_modules/style-loader/dist/runtime/insertBySelector.js"),o=t.n(o),n=t("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),n=t.n(n),r=t("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),r=t.n(r),p=t("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),p=t.n(p),t=t("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/sdk/styles/popover.scss"),l={};l.styleTagTransform=p(),l.setAttributes=n(),l.insert=o().bind(null,"head"),l.domAPI=i(),l.insertStyleElement=r(),s()(t.default,l);const u=t.default&&t.default.locals?t.default.locals:void 0},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":e=>{"use strict";var u=[];function d(e){for(var s=-1,t=0;t<u.length;t++)if(u[t].identifier===e){s=t;break}return s}function p(e,s){for(var t={},i=[],o=0;o<e.length;o++){var n=e[o],r=s.base?n[0]+s.base:n[0],p=t[r]||0,l="".concat(r," ").concat(p),r=(t[r]=p+1,d(l)),p={css:n[1],media:n[2],sourceMap:n[3],supports:n[4],layer:n[5]};-1!==r?(u[r].references++,u[r].updater(p)):(n=function(s,e){var t=e.domAPI(e);return t.update(s),function(e){e?e.css===s.css&&e.media===s.media&&e.sourceMap===s.sourceMap&&e.supports===s.supports&&e.layer===s.layer||t.update(s=e):t.remove()}}(p,s),s.byIndex=o,u.splice(o,0,{identifier:l,updater:n,references:1})),i.push(l)}return i}e.exports=function(e,n){var r=p(e=e||[],n=n||{});return function(e){e=e||[];for(var s=0;s<r.length;s++){var t=d(r[s]);u[t].references--}for(var e=p(e,n),i=0;i<r.length;i++){var o=d(r[i]);0===u[o].references&&(u[o].updater(),u.splice(o,1))}r=e}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":e=>{"use strict";var t={};e.exports=function(e,s){if(!(e=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e)))throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");e.appendChild(s)}},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":e=>{"use strict";e.exports=function(e){var s=document.createElement("style");return e.setAttributes(s,e.attributes),e.insert(s,e.options),s}},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(e,s,t)=>{"use strict";e.exports=function(e){var s=t.nc;s&&e.setAttribute("nonce",s)}},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":e=>{"use strict";e.exports=function(n){var r=n.insertStyleElement(n);return{update:function(e){var s,t,i,o;s=r,t=n,i="",(e=e).supports&&(i+="@supports (".concat(e.supports,") {")),e.media&&(i+="@media ".concat(e.media," {")),(o=void 0!==e.layer)&&(i+="@layer".concat(0<e.layer.length?" ".concat(e.layer):""," {")),i+=e.css,o&&(i+="}"),e.media&&(i+="}"),e.supports&&(i+="}"),(o=e.sourceMap)&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,s,t.options)},remove:function(){var e;null!==(e=r).parentNode&&e.parentNode.removeChild(e)}}}},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":e=>{"use strict";e.exports=function(e,s){if(s.styleSheet)s.styleSheet.cssText=e;else{for(;s.firstChild;)s.removeChild(s.firstChild);s.appendChild(document.createTextNode(e))}}},"./src/_utils/base-64.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.arrayBufferToBase64=s.base64ToArrayBuffer=void 0;const i=t("./src/sdk/utils.ts");s.base64ToArrayBuffer=function(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const s=(0,i.atobShim)(e),t=new Uint8Array(s.length);for(let e=0;e<s.length;++e)t[e]=s.charCodeAt(e);return t},s.arrayBufferToBase64=function(e){return e=new Uint8Array(e),window.btoa(String.fromCharCode.apply(null,e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}},"./src/_utils/consent.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.buildSdkConsentEventData=s.buildSdkConsentContext=void 0;const i=t("./src/sdk/enums/consent.enum.ts");s.buildSdkConsentContext=function(e,s=!1){return{required:e=e.consentRequired||!1,status:e&&s?i.ConsentStatus.CONFIRMED:i.ConsentStatus.UNCONFIRMED}},s.buildSdkConsentEventData=function(e){return{[i.ConsentEventKeys.CONSENT_REQUIRED]:e.consent.required,[i.ConsentEventKeys.CONSENT_STATUS]:e.consent.status}}},"./src/_utils/domain-matching.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.domainMatchPredicate=void 0;const n=t("./src/_utils/global-env.ts");s.domainMatchPredicate=function(e){var s=(i=(0,n.getLocation)()).protocol+"//"+i.hostname,t=i.protocol+"//"+i.host,i=i.href;/^\*/.test(e)&&(e="."+e);const o=new RegExp(`^(http[s]?://)?${e}$`,"i");return o.test(s)||o.test(t)||o.test(i)}},"./src/_utils/flatmap.ts":()=>{Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{value:function(s,e){var t=e||this;if(null===t)throw new TypeError("Array.prototype.flatMap called on null or undefined");if("function"!=typeof s)throw new TypeError(s+" is not a function");let i=[];var o,n=Object(t),r=n.length>>>0;for(let e=0;e<r;++e)e in n&&(o=s.call(t,n[e],e,n),i=i.concat(o));return i}})},"./src/_utils/global-env.ts":(e,s)=>{"use strict";function t(){return"WorkerGlobalScope"in self}function i(){return window.self!==window.top&&window.frameElement&&"about:blank"===window.frameElement.src}function o(){return i()?top:t()?self:window}Object.defineProperty(s,"__esModule",{value:!0}),s.getDocument=s.getNavigator=s.getLocation=s.getSelf=s.inSourcelessIFrameScope=s.inWorkerGlobalScope=void 0,s.inWorkerGlobalScope=t,s.inSourcelessIFrameScope=i,s.getSelf=o,s.getLocation=function(){return o().location||{}},s.getNavigator=function(){return o().navigator||{}},s.getDocument=function(){return o().document||{}}},"./src/_utils/interval-runner.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.setIntervalRunner=void 0;s.setIntervalRunner=(e,s)=>{const t={id:void 0},i=(clearTimeout(t.id),()=>{clearTimeout(t.id),Promise.resolve(e()).then(()=>{t.id=setTimeout(i,s)})});return t.id=setTimeout(i,s),[()=>t.id,()=>clearTimeout(t.id)]}},"./src/_utils/permissions.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.getNotificationPermissions=void 0;const p=t("./src/_utils/global-env.ts");s.getNotificationPermissions=function(r){return i(this,void 0,void 0,function*(){const s=p.getSelf(),e=p.getNavigator();var t={permission:"default"};let i=t;var o,n=navigator.vendor.match(/apple/i)&&!navigator.userAgent.match(/crios/i)&&!navigator.userAgent.match(/fxios/i)&&!navigator.userAgent.match(/Opera|OPT\//);if(!n||"PushManager"in s)if(n)i.permission=s.Notification.permission;else try{"permissions"in e&&"query"in e.permissions?(o=yield e.permissions.query({name:"notifications"}),i.permission="prompt"===o.state?"default":o.state):i.permission=s.Notification.permission}catch(e){i.permission=s.Notification.permission}else{if(!r||!r.websitePushId)throw new Error("websitePushId must be provided for Safari permission check.");i=s.safari.pushNotification.permission(r.websitePushId)}return i=i||t})}},"./src/_utils/service-worker-registration.ts":function(e,s,t){"use strict";var o=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.createPushSubscription=s.getPushSubscription=s.getPushlyServiceWorkerRegistration=s.getServiceWorkerRegistrations=s.getPushlyWorkerConfig=void 0;const r=t("./src/_utils/base-64.ts"),p=t("./src/_utils/permissions.ts"),u=t("./src/sdk/services/logging.service.ts"),d=t("./src/sdk/exceptions/worker-registration.exception.ts"),c=t("./src/_utils/global-env.ts");function a(e){var s=(0,c.getLocation)();const t=s.protocol+"//"+s.hostname+(s.port?":"+s.port:"");let i=e.app.loadConfig.sw?e.app.loadConfig.sw.replace(/^\//,""):null,o=(i&&!i.includes(t)&&(i="/"+i),e.app.loadConfig.swScope?e.app.loadConfig.swScope.replace(/^\//,""):null),n=(o&&!o.includes(t)&&(o="/"+o),i||"/pushly-sdk-worker.js");var s=n.substr(0,n.lastIndexOf("/")+1)||"/",r=e.domain.hasFlag("USE_ROOT_SW_SCOPE");let p=s;o?p=o:r&&(p="/");s=p.includes(t)?p:""+t.replace(/\/$/,"")+p,r=!e.domain.hasFlag("SW_NO_DOMAIN_KEY_PARAM");return{scope:s,installationPath:n=r?`${n}${n.includes("?")?"&":"?"}domain_key=`+e.domainKey:n}}function h(s){return o(this,void 0,void 0,function*(){let e=[];return e=s.env.isPushManagerInScope()?yield(0,c.getSelf)().navigator.serviceWorker.getRegistrations():e})}function m(t,e){var s=new Promise(e=>{let s=setTimeout(()=>{clearTimeout(s),e(null)},t)});return Promise.race([e,s])}function i(l){return o(this,void 0,void 0,function*(){var e,s=(0,c.getSelf)();let t=null;if(l.env.isPushManagerInScope()){const r=a(l);for(e of yield h(l)){yield m(50,s.navigator.serviceWorker.ready);var i=e.scope;const p=(e.active||{}).scriptURL||"";var o=i===r.scope,n=-1!==p.indexOf(r.installationPath.split("?")[0]);if(o&&n){if(t=e,!l.domain.shouldUnregisterNonPushlyWorkers())break}else if(!o&&l.domain.shouldUnregisterNonPushlyWorkers()&&(yield e.unregister(),u.Logger.info("removed worker: "+JSON.stringify({scope:i,path:p}))),o&&!n&&!l.domain.shouldReplaceExistingWorkerInPushlyScope())throw new d.WorkerRegistrationException(new Error(`Implementation Error. An existing, non-push, service worker was found at scope: ${r.scope}.`))}}return t})}s.getPushlyWorkerConfig=a,s.getServiceWorkerRegistrations=h,s.getPushlyServiceWorkerRegistration=i,s.getPushSubscription=function(n){return o(this,void 0,void 0,function*(){let s=null;if(n.env.isPushManagerInScope()&&"granted"===(yield(0,p.getNotificationPermissions)()).permission){const o=yield i(n);if(o)try{s=yield new Promise((s,t)=>{const i=setTimeout(t,5e3);o.pushManager.getSubscription().then(e=>{clearTimeout(i),e?s(e):o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(0,r.base64ToArrayBuffer)(n.domain.vapidPublicKey)}).then(e=>{s(e)}).catch(e=>{t(e),clearTimeout(i)})}).catch(e=>{t(e),clearTimeout(i)})})}catch(e){try{s=yield o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(0,r.base64ToArrayBuffer)(n.domain.vapidPublicKey)})}catch(e){u.Logger.warn(e)}}}return s})},s.createPushSubscription=function(t,i){return o(this,void 0,void 0,function*(){let e=null;var s=(0,c.getSelf)();return t.env.isPushManagerInScope()&&i&&"granted"===(yield(0,p.getNotificationPermissions)()).permission&&(yield m(50,s.navigator.serviceWorker.ready),e=yield i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(0,r.base64ToArrayBuffer)(t.domain.vapidPublicKey)})),e})}},"./src/_utils/validate-only-instance-of-sdk.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.validateOnlyInstanceOfSdk=void 0;const i=t("./src/sdk/enums/exception-message.enum.ts"),o=t("./src/sdk/exceptions/exit.exception.ts");s.validateOnlyInstanceOfSdk=e=>{var s=window.PushlySDK;if(s&&"object"==typeof s&&void 0!==s.iid&&s.iid!==e.iid)throw new o.ExitException(i.ExceptionMessage.DUPLICATE_SDK_INSTANCE);if(e.context.app&&e.context.app.isLoaded)throw new o.ExitException(i.ExceptionMessage.SDK_ALREADY_LOADED)}},"./src/common/constants.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.EVENT_JITTER_MAX_MILLISECONDS=void 0,s.EVENT_JITTER_MAX_MILLISECONDS=7e3},"./src/common/data-providers/api.data-provider.ts":function(e,s,t){"use strict";var p=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.ApiDataProvider=void 0;const l=t("./src/common/utils.ts"),u=t("./src/common/constants.ts");s.ApiDataProvider=class{static get(e,s){return p(this,void 0,void 0,function*(){return this.exec(e,"GET",{},void 0,s)})}static post(e,s={},t){return p(this,void 0,void 0,function*(){return this.exec(e,"POST",{"content-type":"text/plain"},s,t)})}static exec(t,i,o,n,r){return p(this,void 0,void 0,function*(){let s=null;try{if(r){let e=0;e="object"==typeof r&&"ms"in r?r.ms:u.EVENT_JITTER_MAX_MILLISECONDS,yield l.delayRandom(e)}const e={method:i,headers:o};if("GET"!==i&&n&&(e.body="string"!=typeof n?JSON.stringify(n):n),(s=yield l.retryFetch(t,e)).ok){let e;try{e=yield s.json()}catch(e){}return e}throw new Error("Endpoint returned with status "+s.statusText)}catch(e){throw(e=e||{}).response=s,e}})}}},"./src/common/md5.ts":(e,s)=>{"use strict";function n(e,s){var t=r(e[0],n=e[1],o=e[2],i=e[3],s[0],7,-680876936),i=r(i,t,n,o,s[1],12,-389564586),o=r(o,i,t,n,s[2],17,606105819),n=r(n,o,i,t,s[3],22,-1044525330);t=r(t,n,o,i,s[4],7,-176418897),i=r(i,t,n,o,s[5],12,1200080426),o=r(o,i,t,n,s[6],17,-1473231341),n=r(n,o,i,t,s[7],22,-45705983),t=r(t,n,o,i,s[8],7,1770035416),i=r(i,t,n,o,s[9],12,-1958414417),o=r(o,i,t,n,s[10],17,-42063),n=r(n,o,i,t,s[11],22,-1990404162),t=r(t,n,o,i,s[12],7,1804603682),i=r(i,t,n,o,s[13],12,-40341101),o=r(o,i,t,n,s[14],17,-1502002290),t=l(t,n=r(n,o,i,t,s[15],22,1236535329),o,i,s[1],5,-165796510),i=l(i,t,n,o,s[6],9,-1069501632),o=l(o,i,t,n,s[11],14,643717713),n=l(n,o,i,t,s[0],20,-373897302),t=l(t,n,o,i,s[5],5,-701558691),i=l(i,t,n,o,s[10],9,38016083),o=l(o,i,t,n,s[15],14,-660478335),n=l(n,o,i,t,s[4],20,-405537848),t=l(t,n,o,i,s[9],5,568446438),i=l(i,t,n,o,s[14],9,-1019803690),o=l(o,i,t,n,s[3],14,-187363961),n=l(n,o,i,t,s[8],20,1163531501),t=l(t,n,o,i,s[13],5,-1444681467),i=l(i,t,n,o,s[2],9,-51403784),o=l(o,i,t,n,s[7],14,1735328473),t=u(t,n=l(n,o,i,t,s[12],20,-1926607734),o,i,s[5],4,-378558),i=u(i,t,n,o,s[8],11,-2022574463),o=u(o,i,t,n,s[11],16,1839030562),n=u(n,o,i,t,s[14],23,-35309556),t=u(t,n,o,i,s[1],4,-1530992060),i=u(i,t,n,o,s[4],11,1272893353),o=u(o,i,t,n,s[7],16,-155497632),n=u(n,o,i,t,s[10],23,-1094730640),t=u(t,n,o,i,s[13],4,681279174),i=u(i,t,n,o,s[0],11,-358537222),o=u(o,i,t,n,s[3],16,-722521979),n=u(n,o,i,t,s[6],23,76029189),t=u(t,n,o,i,s[9],4,-640364487),i=u(i,t,n,o,s[12],11,-421815835),o=u(o,i,t,n,s[15],16,530742520),t=d(t,n=u(n,o,i,t,s[2],23,-995338651),o,i,s[0],6,-198630844),i=d(i,t,n,o,s[7],10,1126891415),o=d(o,i,t,n,s[14],15,-1416354905),n=d(n,o,i,t,s[5],21,-57434055),t=d(t,n,o,i,s[12],6,1700485571),i=d(i,t,n,o,s[3],10,-1894986606),o=d(o,i,t,n,s[10],15,-1051523),n=d(n,o,i,t,s[1],21,-2054922799),t=d(t,n,o,i,s[8],6,1873313359),i=d(i,t,n,o,s[15],10,-30611744),o=d(o,i,t,n,s[6],15,-1560198380),n=d(n,o,i,t,s[13],21,1309151649),t=d(t,n,o,i,s[4],6,-145523070),i=d(i,t,n,o,s[11],10,-1120210379),o=d(o,i,t,n,s[2],15,718787259),n=d(n,o,i,t,s[9],21,-343485551),e[0]=a(t,e[0]),e[1]=a(n,e[1]),e[2]=a(o,e[2]),e[3]=a(i,e[3])}function p(e,s,t,i,o,n){return s=a(a(s,e),a(i,n)),a(s<<o|s>>>32-o,t)}function r(e,s,t,i,o,n,r){return p(s&t|~s&i,e,s,o,n,r)}function l(e,s,t,i,o,n,r){return p(s&i|t&~i,e,s,o,n,r)}function u(e,s,t,i,o,n,r){return p(s^t^i,e,s,o,n,r)}function d(e,s,t,i,o,n,r){return p(t^(s|~i),e,s,o,n,r)}function t(e){for(var s=e.length,t=[1732584193,-271733879,-1732584194,271733878],i=64;i<=e.length;i+=64)n(t,function(e){var s,t=[];for(s=0;s<64;s+=4)t[s>>2]=e.charCodeAt(s)+(e.charCodeAt(s+1)<<8)+(e.charCodeAt(s+2)<<16)+(e.charCodeAt(s+3)<<24);return t}(e.substring(i-64,i)));e=e.substring(i-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<e.length;i++)o[i>>2]|=e.charCodeAt(i)<<(i%4<<3);if(o[i>>2]|=128<<(i%4<<3),55<i)for(n(t,o),i=0;i<16;i++)o[i]=0;return o[14]=8*s,n(t,o),t}Object.defineProperty(s,"__esModule",{value:!0}),s.MD5=void 0;var i="0123456789abcdef".split("");function o(e){for(var s=0;s<e.length;s++)e[s]=function(e){for(var s="",t=0;t<4;t++)s+=i[e>>8*t+4&15]+i[e>>8*t&15];return s}(e[s]);return e.join("")}function c(e){return o(t(e))}s.MD5=c;let a=(e,s)=>e+s&4294967295;"5d41402abc4b2a76b9719d911017c592"!=c("hello")&&(a=(e,s)=>{var t=(65535&e)+(65535&s);return(e>>16)+(s>>16)+(t>>16)<<16|65535&t})},"./src/common/utils.ts":function(e,u){"use strict";var d=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.retryFetch=u.delayRandom=u.delay=u.awaitUntil=u.buildRegexFromArray=u.tryParseInt=u.randomString=void 0,u.randomString=(s=32)=>{var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let i="";for(let e=0;e<s;e++)i+=t[Math.floor(Math.random()*t.length)];return/undefined/i.test(i)&&"crypto"in self&&"getRandomValues"in crypto&&"Uint32Array"in self&&(i=crypto.getRandomValues(new Uint32Array(4)).join("")),i=/undefined/i.test(i)?"INVALID_RANDOM_STRING":i},u.tryParseInt=e=>{e=String(e);let s;try{isNaN(e)||(s=parseInt(e,10))}catch(e){}return s},u.buildRegexFromArray=e=>new RegExp(e.map(e=>`(${e})`).join("|"),"i"),u.awaitUntil=(o,n,r)=>d(void 0,void 0,void 0,function*(){return new Promise((s,e)=>{let t=!1;const i=setTimeout(()=>{t=!0,void 0!==r?s(r):e()},n);o.then(e=>{clearTimeout(i),t||s(e)})})}),u.delay=(t=0)=>d(void 0,void 0,void 0,function*(){return new Promise((e,s)=>{setTimeout(()=>e(),t)})});u.delayRandom=(e=0)=>d(void 0,void 0,void 0,function*(){return void 0!==e&&0<e&&(e=Math.round(Math.random()*e)),yield(0,u.delay)(e),e}),u.retryFetch=function i(o,n,r,p=8,l=800){return d(this,void 0,void 0,function*(){let e=null;var s,t=s=>d(this,void 0,void 0,function*(){var e=p-1;if(e<=0)throw s instanceof Error?s:new Error(s);return yield(0,u.delay)(l),r&&r(e),i(o,n,r,e,2*l)});try{return(e=yield fetch(o,n)).ok?e:(s=yield e.text(),t(`Retry fetch failed, ${e.status}, on url: ${o}. response object: `+s))}catch(e){return t(e)}})}},"./src/sdk/constants.ts":function(e,s,t){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,s,t,i){void 0===i&&(i=t);var o=Object.getOwnPropertyDescriptor(s,t);o&&("get"in o?s.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return s[t]}}),Object.defineProperty(e,i,o)}:function(e,s,t,i){e[i=void 0===i?t:i]=s[t]}),o=this&&this.__exportStar||function(e,s){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(s,t)||i(s,e,t)};Object.defineProperty(s,"__esModule",{value:!0}),s.UNCAUGHT_ERROR_BLACKLIST=s.DEFAULT_CLASSNAME_PROMPT_BTN_DISMISS=s.DEFAULT_CLASSNAME_PROMPT_BTN_ALLOW=s.DEFAULT_CLASSNAME_PROMPT_CUSTOM=s.DEFAULT_CLASSNAME_PROMPT_VISIBLE=s.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE=s.DEFAULT_CLASSNAME_PROMPT_INELIGIBLE=s.DEFAULT_CLASSNAME_SUBSCRIPTION_DISMISSED=s.DEFAULT_CLASSNAME_SUBSCRIPTION_DENIED=s.DEFAULT_CLASSNAME_SUBSCRIPTION_FALSE=s.DEFAULT_CLASSNAME_SUBSCRIPTION_TRUE=s.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE=s.DEFAULT_CLASSNAME_WEB_PUSH_SUPPORTED=s.DEFAULT_CLASSNAME_WEB_PUSH_UNSUPPORTED=s.MOBILE_MAX_SIZE=s.ENV_NAME_PRODUCTION=s.ENV_NAME_STAGING=s.ENV_NAME_DEV=s.ENV_NAME_LOCAL_PRODUCTION=s.ENV_NAME_LOCAL=s.PUSHLY_SETTINGS_CACHED_COOKIE_TIMEOUT=s.PUSHLY_STORE_NAME=s.PUSHLY_DB_NAME=s.PUSHLY_PROMPT_ID_QS=s.PUSHLY_SUBSCRIBED_URL_QS=s.PUSHLY_DOMAIN_KEY_QS=s.PUSHLY_PROMPT_DISMISSED_COOKIE_TIMEOUT=s.PUSHLY_UNIQUE_USER_FIRST_APPEARANCE_QS=s.PUSHLY_UNIQUE_USER_ID_QS=s.PUSHLY_SDK_APPLICATION_NAME=s.INJECTED_DOMAIN_SETTINGS=s.DOMAIN_SETTINGS_INJECTION_FAILED=s.APNS_URL=s.PROXY_URL=s.SW_DEPENDENCY_URL=s.ALLOW_ENDPOINT=s.SETTINGS_ENDPOINT=s.EVENTS_ENDPOINT=s.PUSHLY_APPLICATION_VERSION=s.ENV_NAME=void 0,s.ENV_NAME="production",s.PUSHLY_APPLICATION_VERSION="669c1d81054dad13f08c74753554f092afbd69c6",s.EVENTS_ENDPOINT="https://k.p-n.io/event-stream",s.SETTINGS_ENDPOINT="https://cdn.p-n.io/domain-settings",s.ALLOW_ENDPOINT="https://k.p-n.io/allow",s.SW_DEPENDENCY_URL="https://cdn.p-n.io/pushly-sw.min.js",s.PROXY_URL="https://notifications.p-n.io",s.APNS_URL="https://cdn.p-n.io/apns",s.DOMAIN_SETTINGS_INJECTION_FAILED=/{{INJECTED_DOMAIN_SETTINGS}}/i,s.INJECTED_DOMAIN_SETTINGS={"domain":{"id":14855,"name":"telemundo.com","domain_key":"KkVTIHCWRxKUWIkH0xvoRwl2GO6GtHf3b0Fd","integration_type":"direct","custom_allow_domain":null,"frequency_caps":null,"global_prompt_settings":{},"flags":["FEAT_VAPID_ONLY","FEAT_CUSTOM_VAPID","FEAT_NATIVE_ANDROID_NOTIFICATIONS_FG_DISPLAY","FEAT_NATIVE_IOS_NOTIFICATIONS_FG_DISPLAY"],"custom_sdk_package_name":null,"vapid_public_key":"BOwYmYpqQQF6JIO3jdgDXwWuCvB0GOILV488GmH6hMhnxn1JsC3BGDZLZPkNgNF2XSS3gnP8luCHlKWzEPQkafA","additional_subscription_data":null,"whitelist_domains":["www.telemundo.com"],"sdk_event_only_domains":[],"apns_configuration":{"is_active":true,"push_package":{"icon_source_url":"https://media.pushlycdn.com/domain_14855/images/c1yRbSexmw6HigZWKdUU_b0Yb7Wzf_400x400.jpg","website_push_id":"web.com.nbcuni.telemundo.webpush"}},"domain_integrations":null},"prompts":[{"id":16854,"domain_id":14855,"style":"NATIVE","config":{"behavior":{"cookie_length_seconds":604800}},"is_auto_show":true,"weight":100,"conditions_json":{"visitor":{"time_on_page_seconds":8}},"prompt_group_id":18955,"name":null},{"id":16855,"domain_id":14855,"style":"SLIDE","config":{"theme":{"image":"https://media.pushlycdn.com/domain_14855/images/c1yRbSexmw6HigZWKdUU_b0Yb7Wzf_400x400.jpg","title":{"text":"Recibe las últimas notificaciones primero","text_color":"#000"},"layout":"normal","position":{"mobile":"bottom","desktop":"top"},"subtitle":{"text":"Seleccione \"inscribirse\" y luego \"permitir\" notificaciones","text_color":"#000"},"allow_button":{"text":"Inscribirse","text_color":"#FFF","background_color":"#555"},"dismiss_button":{"text":"No Gracias","text_color":"#555","background_color":"#FFF"},"background_color":"#FFF"},"behavior":{"delay_seconds":0,"cookie_length_seconds":604800}},"is_auto_show":true,"weight":100,"conditions_json":{"visitor":{"time_on_page_seconds":8}},"prompt_group_id":18956,"name":null}],"prompt_groups":[{"id":18956,"domain_id":14855,"name":"Slide","is_active":true,"priority":1,"display_to_pct":100,"conditions_json":{"display":{"mobile":"enabled","desktop":"enabled"}}},{"id":18955,"domain_id":14855,"name":"Native","is_active":true,"priority":0,"display_to_pct":100,"conditions_json":{"display":{"mobile":"enabled","desktop":"enabled"}}}]},o(t("./src/common/constants.ts"),s),s.PUSHLY_SDK_APPLICATION_NAME="pushly-sdk",s.PUSHLY_UNIQUE_USER_ID_QS="pushly_unique_user_id",s.PUSHLY_UNIQUE_USER_FIRST_APPEARANCE_QS="pushly_unique_user_first_appearance",s.PUSHLY_PROMPT_DISMISSED_COOKIE_TIMEOUT=7,s.PUSHLY_DOMAIN_KEY_QS="pushly_domain_key",s.PUSHLY_SUBSCRIBED_URL_QS="pushly_subscribed_url",s.PUSHLY_PROMPT_ID_QS="pushly_prompt_id",s.PUSHLY_DB_NAME="pushly_db",s.PUSHLY_STORE_NAME="pushly_store",s.PUSHLY_SETTINGS_CACHED_COOKIE_TIMEOUT=1/24/12,s.ENV_NAME_LOCAL="local",s.ENV_NAME_LOCAL_PRODUCTION="local-production",s.ENV_NAME_DEV="dev",s.ENV_NAME_STAGING="staging",s.ENV_NAME_PRODUCTION="production",s.MOBILE_MAX_SIZE=768,s.DEFAULT_CLASSNAME_WEB_PUSH_UNSUPPORTED="pushly-web-push-unsupported",s.DEFAULT_CLASSNAME_WEB_PUSH_SUPPORTED="pushly-web-push-supported",s.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE="pushly-subscription-none",s.DEFAULT_CLASSNAME_SUBSCRIPTION_TRUE="pushly-subscription-subscribed",s.DEFAULT_CLASSNAME_SUBSCRIPTION_FALSE="pushly-subscription-unsubscribed",s.DEFAULT_CLASSNAME_SUBSCRIPTION_DENIED="pushly-subscription-denied",s.DEFAULT_CLASSNAME_SUBSCRIPTION_DISMISSED="pushly-subscription-dismissed",s.DEFAULT_CLASSNAME_PROMPT_INELIGIBLE="pushly-prompt-ineligible",s.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE="pushly-prompt-eligible",s.DEFAULT_CLASSNAME_PROMPT_VISIBLE="pushly-prompt-visible",s.DEFAULT_CLASSNAME_PROMPT_CUSTOM="pushly-prompt-custom",s.DEFAULT_CLASSNAME_PROMPT_BTN_ALLOW="pushly-prompt-buttons-allow",s.DEFAULT_CLASSNAME_PROMPT_BTN_DISMISS="pushly-prompt-buttons-dismiss",s.UNCAUGHT_ERROR_BLACKLIST=["^UnknownError","^NotAllowedError$","^AbortError$","^QuotaExceededError$","Only secure origins are allowed"]},"./src/sdk/cross-frame-messenger/base-messenger.ts":function(e,s,t){"use strict";var r=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.BaseMessenger=void 0;const p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/services/logging.service.ts");class i extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{constructor(){super(),this.portListeners={}}sendToPort(s,t,i=null,o=null,n=!1){try{var r=o||crypto.getRandomValues(new Uint8Array(10)).join("");s.postMessage({id:r,topic:t,data:i,isReply:n});let e=new Promise(e=>e());if(!n){let s=void 0;e=new Promise(e=>s=e),this.portListeners[r]=s}return e}catch(e){l.Logger.error(e)}}listenToPort(s){s.onmessage=e=>{this.handleMessageEvent(e,s)}}handleMessageEvent(e,s){const t=e.ports[0]||s;try{if(e.data&&e.data.topic){const o=e.data.topic;var i=e.data.data;const n=e.data.id;n in this.portListeners?(this.portListeners[n](i),delete this.portListeners[n]):this.dispatch(new p.EventModel(o,{port:t,data:i,reply:e=>r(this,void 0,void 0,function*(){yield this.sendToPort(t,o,e,n,!0)})}))}}catch(e){l.Logger.warn(e)}}}s.BaseMessenger=i},"./src/sdk/cross-frame-messenger/messenger-client-connection-pool.ts":function(e,s,t){"use strict";var n=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.MessengerClientConnectionPool=void 0;const r=t("./src/sdk/cross-frame-messenger/models/connection-pool-record.ts"),p=t("./src/sdk/cross-frame-messenger/messenger-client.ts"),l=t("./src/sdk/services/logging.service.ts");class u{checkout(o){return n(this,void 0,void 0,function*(){l.Logger.debug("MessengerClientConnectionPool checking out "+o);let i;return o in u.connections?(l.Logger.debug("Returning existing connection"),i=u.connections[o]):(l.Logger.debug("Creating new connection"),(i=new r.ConnectionPoolRecord).checkouts=0,i.messengerClient=new Promise((s,t)=>n(this,void 0,void 0,function*(){const e=new p.MessengerClient;try{i.close=yield e.connectUrl(o),s(e)}catch(e){l.Logger.warn(e),delete u.connections[o],t(e)}})),u.connections[o]=i),i.checkouts+=1,i.messengerClient})}release(t){return n(this,void 0,void 0,function*(){for(const e in u.connections){const s=u.connections[e];if((yield s.messengerClient)===t){l.Logger.debug("MessengerClientConnectionPool releasing connection to "+e),--s.checkouts,s.checkouts<1&&(l.Logger.debug("MessengerClientConnectionPool closing connection to "+e),s.close(),delete u.connections[e]);break}}})}}(s.MessengerClientConnectionPool=u).connections={}},"./src/sdk/cross-frame-messenger/messenger-client.ts":function(e,s,t){"use strict";var r=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},i=(Object.defineProperty(s,"__esModule",{value:!0}),s.MessengerClient=void 0,t("./src/sdk/cross-frame-messenger/base-messenger.ts"));const d=t("./src/common/utils.ts"),c=t("./src/sdk/enums/messenger-topic.enum.ts"),p=t("./src/sdk/exceptions/no-connection.exception.ts"),a=t("./src/sdk/exceptions/no-response.exception.ts"),h=t("./src/sdk/services/logging.service.ts");class o extends i.BaseMessenger{connect(l,u=3){return r(this,void 0,void 0,function*(){this.port&&(h.Logger.warn("ClientMessenger reused. Existing port closed."),this.close());let e,t=null,i=1,o=!1;do{e&&e.close();var n=new MessageChannel,r=((e=n.port1).onmessage=this.handleMessageEvent.bind(this),crypto.getRandomValues(new Uint8Array(10)).join(""));let s=void 0;var p=new Promise(e=>s=e);this.portListeners[r]=s,l.postMessage({id:r,topic:c.MessengerTopic.CONNECT_HANDSHAKE},"*",[n.port2]),u&&(t=yield(0,d.awaitUntil)(p,500*i,null),i+=1,o=!t&&i<=u)}while(o);if(!t&&u)throw new a.NoResponseException(new Error("Failed to connect"));return this.port=e,this.close.bind(this)})}connectUrl(o,n=3){return r(this,void 0,void 0,function*(){const i=document.createElement("div");return i.setAttribute("style","display:none;position:absolute;overflow:hidden;width:1px;height:1px;bottom:0;left:0"),new Promise((s,t)=>r(this,void 0,void 0,function*(){try{h.Logger.info("Creating iframe "+o);const e=document.createElement("iframe");if(e.width="1px",e.height="1px",e.setAttribute("style","width:1px;height:1px;display:none;"),e.src=o,i.appendChild(e),document.body.appendChild(i),yield(0,d.delay)(300),e.contentWindow)try{s(yield this.connect(e.contentWindow,n)),this.connectedHost=new URL(o).hostname,this.connectedElement=i}catch(e){t(e)}else t(new p.NoConnectionException(new Error("iframe failed to load "+o)))}catch(e){throw document.body.removeChild(i),e}}))})}close(){this.port.close(),this.connectedElement&&document.body.removeChild(this.connectedElement),this.connectedHost=null,this.connectedElement=null,this.port=null}send(s,t=null){return r(this,void 0,void 0,function*(){if(!this.port)throw new p.NoConnectionException(new Error("MessengerClient::send called before connection opened."));var e=(0,d.randomString)();return this.sendToPort(this.port,s,t,e,!1)})}sendTimeout(e,s=null,t){return r(this,void 0,void 0,function*(){return(0,d.awaitUntil)(this.send(e,s),t)})}}s.MessengerClient=o},"./src/sdk/cross-frame-messenger/messenger-server.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.MessengerServer=void 0,t("./src/sdk/cross-frame-messenger/base-messenger.ts"));const n=t("./src/sdk/enums/messenger-topic.enum.ts"),r=t("./src/sdk/data-providers/event.data-provider.ts"),p=t("./src/sdk/enums/event-type.enum.ts"),l=t("./src/sdk/services/logging.service.ts");class u extends o.BaseMessenger{constructor(){super(),this.ready=new Promise((e,s)=>{r.EventManager.once(p.EventType.APPLICATION_READY,()=>{l.Logger.info("Application is ready"),e()})})}accept(){window.addEventListener("message",this.handleMessageEvent.bind(this)),this.watch(n.MessengerTopic.CONNECT_HANDSHAKE,this.handleHandshakeEvent.bind(this))}handleHandshakeEvent(e){return i(this,void 0,void 0,function*(){return this.listenToPort(e.port),yield this.ready,e.reply(!0)})}}(s.MessengerServer=u).global=new u},"./src/sdk/cross-frame-messenger/models/connection-pool-record.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ConnectionPoolRecord=void 0;s.ConnectionPoolRecord=class{constructor(){this.checkouts=0}}},"./src/sdk/data-providers/abstract-permission.data-provider.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.AbstractPermissionDataProvider=void 0;const o=t("./src/_utils/base-64.ts"),n=t("./src/_utils/service-worker-registration.ts"),r=t("./src/_utils/global-env.ts");s.AbstractPermissionDataProvider=class{constructor(e){this.context=e,this.context=e}getLocalPermissions(){return i(this,void 0,void 0,function*(){let s={permission:"default",host:(0,r.getSelf)().location.hostname,subscription:null,applicationServerKey:null,deviceToken:null};if(this.context.env.isSafari()&&!this.context.env.isPushManagerInScope()){if(!this.context.domain.getWebsitePushId())throw new Error("websitePushId must be provided for Safari permission check.");s=self.safari.pushNotification.permission(this.context.domain.getWebsitePushId())||s}else if(this.context.env.isSafari())s.permission=(0,r.getSelf)().Notification?(0,r.getSelf)().Notification.permission.toString():s.permission;else try{let e=(yield navigator.permissions.query({name:"notifications"})).state;"prompt"===e&&(e="default"),s.permission=e}catch(e){s.permission=(0,r.getSelf)().Notification?(0,r.getSelf)().Notification.permission.toString():s.permission}if("granted"===s.permission&&this.context.env.isPushManagerInScope()){const e=yield(0,n.getPushSubscription)(this.context);e&&(s.subscription=e.toJSON(),s.applicationServerKey=(0,o.arrayBufferToBase64)(e.options.applicationServerKey))}return s})}unregisterWorker(){return i(this,void 0,void 0,function*(){let e=!1;if(this.context.env.isPushManagerInScope())try{const s=yield(0,n.getPushlyServiceWorkerRegistration)(this.context);s&&(e=yield s.unregister())}catch(e){}return e})}isSafari(){return navigator.vendor.match(/apple/i)&&!navigator.userAgent.match(/crios/i)&&!navigator.userAgent.match(/fxios/i)&&!navigator.userAgent.match(/Opera|OPT\//)}}},"./src/sdk/data-providers/abstract-session.data-provider.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AbstractSessionDataProvider=void 0;s.AbstractSessionDataProvider=class{}},"./src/sdk/data-providers/brokered-permission.data-provider.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.BrokeredPermissionDataProvider=void 0,t("./src/sdk/data-providers/abstract-permission.data-provider.ts"));const l=t("./src/sdk/data-providers/cookie.data-provider.ts"),n=t("./src/common/utils.ts"),r=t("./src/sdk/cross-frame-messenger/messenger-client-connection-pool.ts"),u=t("./src/_utils/global-env.ts"),p=t("./src/sdk/enums/messenger-topic.enum.ts"),d=t("./src/sdk/exceptions/no-response.exception.ts"),c=t("./src/sdk/services/logging.service.ts"),a=t("./src/sdk/enums/permission-broker-topic.enum.ts");class h extends o.AbstractPermissionDataProvider{constructor(e){super(e),this.messengerClientConnectionPool=new r.MessengerClientConnectionPool}getPushPermission(){return i(this,void 0,void 0,function*(){const e=[(0,u.getSelf)().location.hostname];var s=yield this.getLocalPermissions();let t;if("default"===s.permission&&(c.Logger.info("BrokeredPermissionDataProvider: Local permissions are: "+s.permission),this.messengerClient&&(e.push(this.messengerClient.connectedHost),t=yield h.getCalculatedPermissions(this.messengerClient)),!t||"default"===t.permission)){var i,o=l.CookieDataProvider.get("_pnpds");if(o&&-1===e.indexOf(o)&&(e.push(o),i=this.context.app.getBrokeredFrameMessengerPath(o),yield this.messengerClientConnectionPool.release(this.messengerClient),this.messengerClient=yield this.messengerClientConnectionPool.checkout(i),t=(yield h.getCalculatedPermissions(this.messengerClient))||t,c.Logger.info(`BrokeredPermissionDataProvider: ${o} permissions are: `+t.permission)),!t||"default"===t.permission)for(const p of this.context.domain.whitelistDomains)if(l.CookieDataProvider.getDomain(p)===l.CookieDataProvider.getDomain()&&-1===e.indexOf(p)){var n=this.context.app.getBrokeredFrameMessengerPath(p);if(yield this.messengerClientConnectionPool.release(this.messengerClient),this.messengerClient=yield this.messengerClientConnectionPool.checkout(n),t=(yield h.getCalculatedPermissions(this.messengerClient))||t,c.Logger.info(`BrokeredPermissionDataProvider: ${p} permissions are: `+t.permission),"default"!==t.permission)break}}let r;return t&&"default"!==t.permission?(r=t,l.CookieDataProvider.set("_pnpds",t.host)):r=s,c.Logger.info("BrokeredPermissionDataProvider: Calculated permissions are: "+r.permission),r})}removeRegistration(){return i(this,void 0,void 0,function*(){const e=[(0,u.getSelf)().location.hostname];let s=yield this.unregisterWorker();if(!s&&(this.messengerClient&&(e.push(this.messengerClient.connectedHost),s=yield h.sendUnregisterRequest(this.messengerClient)),!s)){var t=l.CookieDataProvider.get("_pnpds");if(t&&-1===e.indexOf(t)&&(e.push(t),t=this.context.app.getBrokeredFrameMessengerPath(t),yield this.messengerClientConnectionPool.release(this.messengerClient),this.messengerClient=yield this.messengerClientConnectionPool.checkout(t),s=(yield h.sendUnregisterRequest(this.messengerClient))||s),!s)for(const o of this.context.domain.whitelistDomains)if(l.CookieDataProvider.getDomain(o)===l.CookieDataProvider.getDomain()&&-1===e.indexOf(o)){var i=this.context.app.getBrokeredFrameMessengerPath(o);if(yield this.messengerClientConnectionPool.release(this.messengerClient),this.messengerClient=yield this.messengerClientConnectionPool.checkout(i),s=(yield h.sendUnregisterRequest(this.messengerClient))||s)break}}return c.Logger.info("BrokeredPermissionDataProvider: Registration removed "+s),s})}static getCalculatedPermissions(s){return i(this,void 0,void 0,function*(){try{const e=yield(0,n.awaitUntil)(s.send(a.PermissionBrokerTopic.PERMISSION_GET_PUSH_PERMISSION),500);return e&&"denied"===e.permission&&"blocked"!==l.CookieDataProvider.get("_pnss")&&(e.permission="default"),e}catch(e){throw new d.NoResponseException(new Error("Failed to get calculated permissions due to timeout."))}})}static sendUnregisterRequest(s){return i(this,void 0,void 0,function*(){let e=!1;try{e=yield(0,n.awaitUntil)(s.send(p.MessengerTopic.SERVICE_WORKER_UNREGISTER),500)}catch(e){}return e})}}s.BrokeredPermissionDataProvider=h},"./src/sdk/data-providers/brokered-session.data-provider.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.BrokeredSessionDataProvider=void 0,t("./src/sdk/data-providers/abstract-session.data-provider.ts"));const n=t("./src/sdk/enums/session-broker-topic.enum.ts");class r extends o.AbstractSessionDataProvider{constructor(e){super(),this.messengerClient=e}set(e,s){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_SET,[e,s])})}get(e){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET,[e])})}remove(e){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_REMOVE,[e])})}getCurrentPageViews(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET_CURRENT_PAGE_VIEWS)})}getCurrentTotalPageViews(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET_CURRENT_TOTAL_PAGE_VIEWS)})}setRootDomainPermissionData(e){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_SET,["rdpData",e])})}getRootDomainPermissionData(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET,["rdpData"])})}clearRootDomainPermissionData(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_REMOVE,["rdpData"])})}getCurrentSession(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET_CURRENT_SESSION)})}}s.BrokeredSessionDataProvider=r},"./src/sdk/data-providers/cookie.data-provider.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.CookieDataProvider=void 0;const r=t("./src/_utils/global-env.ts"),o=t("./src/sdk/services/logging.service.ts");function p(){return!("WorkerGlobalScope"in self)}s.CookieDataProvider=class{static get isIsolatedMode(){return!!this.domain&&this.domain.hasFlag("USE_ISOLATED_COOKIE_STORAGE_LOCATION")}static get document(){return(0,r.getDocument)()}static get location(){return(0,r.getLocation)()}static getDomain(e){let s=e||(0,r.getSelf)().location.hostname;return this.isIsolatedMode||(s=this.domain.whitelistDomains&&1==this.domain.whitelistDomains.length?this.domain.whitelistDomains[0]:(e=>{const s=(0,r.getDocument)();let t,i,o="_sw_tld_check=cookie",n=(e||s.location.hostname).split(".");for(t=n.length-2;0<=t;t--)if(i=n.slice(t).join("."),s.cookie=o+";domain=."+i+";SameSite=strict;",-1<s.cookie.indexOf(o))return s.cookie=o.split("=")[0]+"=;domain=."+i+";SameSite=strict;expires=Thu, 01 Jan 1970 00:00:01 GMT;",i})(e))||"localhost"!==(s=(0,r.getSelf)().location.hostname)&&(s="."+s.split(".").splice(-2).join(".")),s}static set(s,t,i=730,o="d"){if(p()){null==t&&(i=-1);try{const r=new Date;var n=this.getDomain();let e=1;switch(o){case"d":case"days":e=86400;break;case"h":case"hours":e=3600;break;case"m":case"minutes":e=60}return r.setTime(r.getTime()+i*e*1e3),this.document.cookie=`${this.buildName(s)}=${t};expires=${r.toUTCString()};path=/;domain=${n};SameSite=Strict`,t}catch(e){}}}static setWithRawExpires(e,s,t){if(p())try{var i=this.getDomain();return this.document.cookie=this.buildName(e)+`=${s};expires=${t};path=/;domain=${i};SameSite=Strict`,s}catch(e){o.Logger.warn(e)}}static get(i,e=null){if(p()){var o=this.document.cookie.split(";");for(let t=0;t<o.length;t++){let e=o[t],s=e.split("=");if(s[0].trim()===this.buildName(i))return s[1].trim()}return e}}static getmv(e,s=null,t=null){let i=this.get(e,null);return null===i&&null!==t&&this.has(t)&&(i=this.get(t,s),this.clear(t),null!==i&&this.set(e,i)),i||s}static clear(e){return this.set(e,null,-1)}static has(e){return null!==this.get(e)}static buildName(e){return this.isIsolatedMode?e+"_"+this.domain.domainKey.substr(-8):e}}},"./src/sdk/data-providers/event.data-provider.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.EventManager=s.EventDataProvider=void 0;const o=t("./src/sdk/enums/messenger-topic.enum.ts"),n=t("./src/sdk/enums/amp-message-topic.enum.ts"),r=t("./src/sdk/enums/event-type.enum.ts"),p=t("./src/sdk/exceptions/invalid-event.exception.ts"),l=t("./src/sdk/enums/session-broker-topic.enum.ts"),u=t("./src/sdk/enums/permission-broker-topic.enum.ts"),d=t("./src/sdk/utils.ts");class c{constructor(){this.listeners={}}on(e,s){var t;const i=[];for(t of Array.isArray(e)?e:[e]){t=t.trim(),this.validateEventType(t);let e=(0,d.randomString)();var o=t.split(".");o&&2===o.length&&(t=o[0],e=o[1]),this.listeners[t]=this.listeners[t]||{},this.listeners[t][e]=s,i.push(this.unregisterCallback(t,e))}return Array.isArray(e)?i:i[0]}once(e,t){const s=Array.isArray(e)?e:[e],i=[];return s.forEach(e=>{e=e.trim();this.validateEventType(e);let s;s=this.on(e,e=>{null!=e?t(e):t(),s()}),i.push(s)}),Array.isArray(e)?i:i[0]}dispatch(n){return i(this,void 0,void 0,function*(){this.validateEventType(n.type);var e,s,t=this.listeners[n.type]||{};const i=[];for(e of Object.keys(t)){const o=t[e];null!=n.data?(s=Array.isArray(n.data)?n.data:[n.data],i.push(o(...s))):i.push(o())}yield Promise.all(i)})}unregisterCallback(e,s){return()=>{this.listeners[e][s]&&delete this.listeners[e][s]}}validateEventType(e){const s=[].concat(Object.keys(r.EventType).map(e=>r.EventType[e]),Object.keys(o.MessengerTopic).map(e=>o.MessengerTopic[e]),Object.keys(n.AmpMessageTopic).map(e=>n.AmpMessageTopic[e]),Object.keys(l.SessionBrokerTopic).map(e=>l.SessionBrokerTopic[e]),Object.keys(u.PermissionBrokerTopic).map(e=>u.PermissionBrokerTopic[e]));if(-1===s.indexOf(e))throw new p.InvalidEventException(e)}}s.EventDataProvider=c,s.EventManager=new c},"./src/sdk/data-providers/local-permission.data-provider.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},t=(Object.defineProperty(s,"__esModule",{value:!0}),s.LocalPermissionDataProvider=void 0,t("./src/sdk/data-providers/abstract-permission.data-provider.ts"));class o extends t.AbstractPermissionDataProvider{getPushPermission(){return i(this,void 0,void 0,function*(){return this.getLocalPermissions()})}removeRegistration(){return i(this,void 0,void 0,function*(){return this.unregisterWorker()})}}s.LocalPermissionDataProvider=o},"./src/sdk/data-providers/local-session.data-provider.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.LocalSessionDataProvider=void 0,t("./src/sdk/data-providers/abstract-session.data-provider.ts"));const n=t("./src/_utils/global-env.ts"),r=t("./src/sdk/services/logging.service.ts"),p="pushly-session";class l extends o.AbstractSessionDataProvider{set(s,t){return i(this,void 0,void 0,function*(){const e=yield this.getCurrentSession();e[s]=t,l.store.setItem(p,JSON.stringify(e))})}get(e){return i(this,void 0,void 0,function*(){return(yield this.getCurrentSession())[e]})}remove(e){return i(this,void 0,void 0,function*(){return l.store.removeItem(e)})}getCurrentTotalPageViews(){return i(this,void 0,void 0,function*(){return((yield this.getCurrentSession()).pageViews||[]).length})}setRootDomainPermissionData(e){return i(this,void 0,void 0,function*(){yield this.set("rdpData",e)})}getRootDomainPermissionData(){return i(this,void 0,void 0,function*(){return this.get("rdpData")})}clearRootDomainPermissionData(){return i(this,void 0,void 0,function*(){yield this.remove("rdpData")})}getCurrentPageViews(){return i(this,void 0,void 0,function*(){return(yield this.getCurrentSession()).pageViews})}getCurrentSession(){return i(this,void 0,void 0,function*(){var s={sessionStart:Date.now(),pageViews:[]};const t=l.store;let i=t.getItem(p);if(i)try{i=JSON.parse(i)}catch(e){r.Logger.warn("Corrupt session encountered. Resetting current session."),i=Object.assign({},s),t.setItem(p,JSON.stringify(i))}else i=Object.assign({},s),t.setItem(p,JSON.stringify(i));return i.sessionStart||(r.Logger.warn("Corrupt session encountered. Resetting current session."),i=Object.assign({},s),t.setItem(p,JSON.stringify(i))),i})}static get store(){return(0,n.getSelf)().sessionStorage}}s.LocalSessionDataProvider=l},"./src/sdk/enums/amp-message-topic.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AmpMessageTopic=void 0,(s=s.AmpMessageTopic||(s.AmpMessageTopic={})).CONNECT_HANDSHAKE="topic-connect-handshake",s.NOTIFICATION_PERMISSION_STATE="topic-notification-permission-state",s.SERVICE_WORKER_STATE="topic-service-worker-state",s.SERVICE_WORKER_REGISTRATION="topic-service-worker-registration",s.SERVICE_WORKER_QUERY="topic-service-worker-query",s.STORAGE_GET="topic-storage-get"},"./src/sdk/enums/amp-worker-message-topic.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AmpWorkerMessageTopic=void 0,(s=s.AmpWorkerMessageTopic||(s.AmpWorkerMessageTopic={})).AMP_SUBSCRIPTION_STATE="amp-web-push-subscription-state",s.AMP_SUBSCRIBE="amp-web-push-subscribe",s.AMP_UNSUBSCRIBE="amp-web-push-unsubscribe"},"./src/sdk/enums/bell-prompt-display-behavior.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BellPromptDisplayBehavior=void 0,(s=s.BellPromptDisplayBehavior||(s.BellPromptDisplayBehavior={})).ALWAYS="ALWAYS",s.PRE_SUBSCRIPTION="PRE_SUBSCRIPTION",s.POST_SUBSCRIPTION="POST_SUBSCRIPTION"},"./src/sdk/enums/consent.enum.ts":(e,s)=>{"use strict";var t;Object.defineProperty(s,"__esModule",{value:!0}),s.ConsentStatus=s.ConsentEventKeys=void 0,(t=s.ConsentEventKeys||(s.ConsentEventKeys={})).CONSENT_REQUIRED="ca_rq",t.CONSENT_STATUS="ca_st",(t=s.ConsentStatus||(s.ConsentStatus={}))[t.UNCONFIRMED=0]="UNCONFIRMED",t[t.CONFIRMED=1]="CONFIRMED"},"./src/sdk/enums/debug-cookie-code.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.DebugCookieCode=void 0,(s=s.DebugCookieCode||(s.DebugCookieCode={})).sdk_impression="si",s.load_failed="lf",s.web_push_unsupported="unsp",s.mixed_integration="mxi",s.apns_not_configured="apl0",s.apns_not_enabled="apl1",s.apns_invalid_config="apl2",s.host_not_whitelisted="wlx",s.no_eligible_prompts="prx",s.platform_disabled_mobile="pldm",s.platform_disabled_desktop="pldd",s.prompt_ineligible_fcap="prif",s.user_permission_denied="updn",s.user_permission_dismissed="updm",s.user_permission_granted="upgr",s.user_ineligible="ui",s.referrer_allow="rfa",s.referrer_ignore="rfi",s.referrer_block="rfb"},"./src/sdk/enums/event-priority.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.EventPriority=void 0,(s=s.EventPriority||(s.EventPriority={}))[s.QUEUED=0]="QUEUED",s[s.IMMEDIATE=1]="IMMEDIATE"},"./src/sdk/enums/event-type.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.EventType=void 0,(s=s.EventType||(s.EventType={})).CONFIRM_CONSENT="confirm_consent",s.EXISTING_SUBSCRIPTION_DETECTED="existing_subscription_detected",s.APPLICATION_LOAD="load",s.APPLICATION_LOADED="loaded",s.APPLICATION_LOAD_ERROR="load_error",s.APPLICATION_LOAD_FAILED="load_failed",s.APPLICATION_READY="ready",s.APPLICATION_ERROR="error",s.EXIT_PERMISSIONS_DISMISSED="permission_previously_dismissed",s.EXIT_PERMISSIONS_DENIED="permission_previousy_denied",s.WEB_PUSH_SUPPORTED="web_push_supported",s.WEB_PUSH_NOT_SUPPORTED="web_push_unsupported",s.WEB_PUSH_NOT_CONFIGURED="web_push_not_configured",s.REQUEST_USER_DELETION="request_user_deletion",s.REVERT_USER_DELETION="revert_user_deletion",s.USER_DELETION_REQUEST="user_deletion_request",s.DOMAIN_APNS_NOT_CONFIGURED="apns_not_configured",s.DOMAIN_APNS_NOT_ENABLED="apns_not_enabled",s.DOMAIN_APNS_INVALID_CONFIG="apns_invalid_config",s.PROFILE_UPDATE="profile",s.PROFILE_UPDATE_EXTERNAL_ID="external_id",s.PROFILE_UPDATE_TAGS="tag",s.PROFILE_UPDATE_USER_EVENT="event",s.PROFILE_APPEND="profile_append",s.PROFILE_REMOVE="profile_remove",s.PROFILE_DEREGISTER_EXTERNAL_ID="deregister_external_id",s.PAGE_TAG_VISIT="page_tag_visit",s.PROXY_PERMISSION_DIALOG_LOAD="proxy_permission_dialog",s.PROXY_FRAME_HELPER_LOAD="proxy_frame_helper",s.AMP_FRAME_HELPER_LOAD="amp_frame_helper",s.AMP_PERMISSION_DIALOG_LOAD="amp_permission_dialog",s.AMP_HANDSHAKE="handshake",s.AMP_CONNECT="connect",s.FLOW_LOADED="flow_loaded",s.BROKERED_DATA_SERVER_LOAD="brokered_data_server",s.NO_ELIGIBLE_PROMPTS="no_eligible_prompts",s.PROMPT_ELIGIBLE="prompt_eligible",s.PROMPT_INELIGIBLE="prompt_ineligible",s.PROMPT_SHOW="show_prompt",s.PROMPT_SHOWN="prompt_shown",s.PROMPT_ALLOWED="prompt_allowed",s.PROMPT_DISMISSED="prompt_dismissed",s.PROMPT_HIDE="prompt_hide",s.PROMPT_DISABLED="prompt_disabled",s.FOLLOW_SHOWN="prompt_shown",s.FOLLOWED="followed",s.SW_INSTALLED="sw_installed",s.SW_SETUP_COMPLETE="sw_setup_complete",s.REGISTRATION_ATTEMPT="attempt_registration",s.REGISTRATION_SUBSCRIBED="subscribed",s.REGISTRATION_UNSUBSCRIBED="unsubscribed",s.REGISTRATION_MIGRATED="migrated",s.LEGACY_PERMISSION_DIALOG_SHOWN="permission_prompted",s.PERMISSION_DIALOG_SHOWN="permission_shown",s.LEGACY_PERMISSION_GRANTED="permission_accepted",s.PERMISSION_GRANTED="permission_allowed",s.PERMISSION_DISMISSED="permission_dismissed",s.PERMISSION_DENIED="permission_denied",s.FCM_TOKEN_REFRESH="token_refreshed",s.VIEW_ITEM="view_item",s.SAVE_ITEM="save_item",s.ADD_TO_CART="add_to_cart",s.UPDATE_CART_ITEM="update_cart_item",s.PURCHASE="purchase"},"./src/sdk/enums/exception-message.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ExceptionMessage=void 0,(s=s.ExceptionMessage||(s.ExceptionMessage={})).ENV_NOT_SUPPORTED="Environment is not supported.",s.USER_ABORT_REQUESTED="Aborting execution due to user request.",s.FLOW_NOT_SUPPORTED_IN_EVENT_MODE="Current flow is not supported in event only mode.",s.SDK_ALREADY_LOADED="SDK has already been loaded.",s.DUPLICATE_SDK_INSTANCE="Another instance of the Pushly SDK is already running.",s.WORKER_LOAD_FAILED="ServiceWorker could not be loaded.",s.MIGRATION_FAILED="Pushly data migration failed.",s.DOMAIN_KEY_NOT_SPECIFIED="Domain key must be specified",s.DOMAIN_UNABLE_TO_LOAD="Domain settings could not be loaded.",s.DOMAIN_APNS_NOT_CONFIGURED="Domain is not configured for use with Safari.",s.DOMAIN_APNS_NOT_ENABLED="Domain is currently disabled on Safari.",s.DOMAIN_APNS_INVALID_CONFIG="Domain configuration is invalid.",s.MIXED_INTEGRATION="Domain was configured to use both a proxy integration and native prompt.",s.HOST_NOT_WHITELISTED="Current host is not whitelisted for use",s.EXISTING_SUBSCRIPTION_DETECTED="An existing Pushly subscription has been detected",s.DIRECT_INTEGRATION_NOT_SECURE="Environment is not secure. The ServiceWorker cannot be loaded.",s.USER_UNABLE_TO_LOAD="User could not be initialized.",s.USER_INVALID_PUSH_PACKAGE="Subscription state cannot be determined.",s.USER_STATE_DENIED="Subscription state is currently set to denied.",s.USER_STATE_DISMISSED="Subscription state is currently set to dismissed.",s.USER_STATE_UNSUBBED="Subscription state is currently set to unsubscribed.",s.FAILED_TO_GET_GRANTED_TOKEN="Failed to fetch token from subscription endpoint after permission was granted. Exiting flow.",s.APNS_FAILED_TO_GET_GRANTED_TOKEN="Failed to fetch token from APNS after permission was granted. Exiting flow.",s.INVALID_TOKEN_TYPE="Token is not a valid string"},"./src/sdk/enums/integration-type.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.IntegrationType=void 0,(s=s.IntegrationType||(s.IntegrationType={})).DIRECT="direct",s.PROXY="proxy"},"./src/sdk/enums/messenger-topic.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.MessengerTopic=void 0,(s=s.MessengerTopic||(s.MessengerTopic={})).CONNECT_HANDSHAKE="topic-connect-handshake",s.SERVICE_WORKER_UNREGISTER="topic-service-worker-unregister"},"./src/sdk/enums/notification-permission-state.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.NotificationPermissionState=void 0,(s=s.NotificationPermissionState||(s.NotificationPermissionState={})).DEFAULT="default",s.GRANTED="granted",s.DENIED="denied"},"./src/sdk/enums/permission-broker-topic.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.PermissionBrokerTopic=void 0,(s.PermissionBrokerTopic||(s.PermissionBrokerTopic={})).PERMISSION_GET_PUSH_PERMISSION="permission-get-push-permission"},"./src/sdk/enums/prompt-referrer-condition.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.PromptReferrerCondition=void 0,(s=s.PromptReferrerCondition||(s.PromptReferrerCondition={})).ALLOW="allow",s.IGNORE="ignore",s.BLOCK="block"},"./src/sdk/enums/prompt-style.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.PromptStyle=void 0,(s=s.PromptStyle||(s.PromptStyle={})).Native="NATIVE",s.Custom="PUBLISHER_CUSTOM",s.Slide="SLIDE",s.Bell="BELL"},"./src/sdk/enums/runtime-environment.enum.ts":(e,s)=>{"use strict";var t,i;Object.defineProperty(s,"__esModule",{value:!0}),s.RuntimeEnvironmentName=s.RuntimeEnvironment=void 0,(i=t=s.RuntimeEnvironment||(s.RuntimeEnvironment={}))[i.DIRECT=100]="DIRECT",i[i.PROXY=200]="PROXY",i[i.PROXY_PERMISSION_DIALOG=201]="PROXY_PERMISSION_DIALOG",i[i.PROXY_FRAME_HELPER=202]="PROXY_FRAME_HELPER",i[i.AMP=300]="AMP",i[i.AMP_PERMISSION_DIALOG=301]="AMP_PERMISSION_DIALOG",i[i.AMP_FRAME_HELPER=302]="AMP_FRAME_HELPER",i[i.BROKERED_DATA_SERVER=400]="BROKERED_DATA_SERVER",i[i.SERVICE_WORKER=1e3]="SERVICE_WORKER",s.RuntimeEnvironmentName={[t.DIRECT]:"Direct",[t.PROXY]:"Proxy",[t.PROXY_PERMISSION_DIALOG]:"Proxy Permission Dialog",[t.PROXY_FRAME_HELPER]:"Proxy Frame Helper",[t.AMP]:"AMP",[t.AMP_PERMISSION_DIALOG]:"AMP Permission Dialog",[t.AMP_FRAME_HELPER]:"AMP Frame Helper",[t.BROKERED_DATA_SERVER]:"Brokered Data Server",[t.SERVICE_WORKER]:"Service Worker"}},"./src/sdk/enums/session-broker-topic.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SessionBrokerTopic=void 0,(s=s.SessionBrokerTopic||(s.SessionBrokerTopic={})).SESSION_GET="session-get",s.SESSION_SET="session-set",s.SESSION_REMOVE="session-remove",s.SESSION_GET_CURRENT_PAGE_VIEWS="session-get-current-page-views",s.SESSION_GET_CURRENT_TOTAL_PAGE_VIEWS="session-get-current-total-page-views",s.SESSION_GET_CURRENT_SESSION="session-get-current-session"},"./src/sdk/enums/steamable-event-type.enum.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.StreamableEventType=void 0,(s=s.StreamableEventType||(s.StreamableEventType={})).ERROR="error",s.UDR="udr",s.ANONYMOUS_PAGE_VIEW="anonymous_view_page",s.PAGE_VIEW="view_page",s.PAGE_TAG_VISITS="page_tag_visit",s.PROMPT_SHOWN="prompt_shown",s.PROMPT_ALLOWED="prompt_allow",s.PROMPT_DISMISSED="prompt_dismiss",s.PROMPT_NOT_SHOWN="prompt_not_shown",s.FOLLOW_SHOWN="follow_shown",s.FOLLOWED="follow",s.PERMISSION_PROMPTED="permission_prompted",s.PERMISSION_ACCEPTED="permission_accepted",s.PERMISSION_DENIED="permission_denied",s.PERMISSION_DISMISSED="permission_dismissed",s.SUBSCRIBED="subscribed",s.MIGRATED="migrated",s.SUBSCRIPTION_CHANGED="subscription_changed",s.TOKEN_REFRESHED="token_refreshed",s.UNSUBSCRIBED="unsubscribed",s.MANUAL_UNSUBSCRIBED="manual_unsubscribed",s.PROXY_WINDOW_BLOCKED="proxy_window_blocked",s.PROXY_WINDOW_OPENED="proxy_window_opened",s.PROXY_WINDOW_CLOSED="proxy_window_closed",s.PROFILE_UPDATE="profile",s.PROFILE_APPEND="profile_append",s.PROFILE_REMOVE="profile_remove",s.DEREGISTER_EXTERNAL_ID="deregister_external_id",s.SDK_IMPRESSION="sdk_impression",s.VIEW_ITEM="view_item",s.SAVE_ITEM="save_item",s.ADD_TO_CART="add_to_cart",s.UPDATE_CART_ITEM="update_cart_item",s.PURCHASE="purchase"},"./src/sdk/exceptions/domain-load.exception.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.DomainLoadException=void 0;var i=t("./src/sdk/exceptions/pushly.exception.ts");const o=t("./src/sdk/enums/exception-message.enum.ts"),n=["Failed to Fetch","Retry fetch failed","NetworkError when attempting to fetch","Network request failed","The internet connection appears to be offline","A server with the specified hostname could not be found"];class r extends i.PushlyException{constructor(e){super(e,o.ExceptionMessage.DOMAIN_UNABLE_TO_LOAD,r),this.blacklistedErrors=n,this.name="DomainLoadException"}}s.DomainLoadException=r},"./src/sdk/exceptions/exit.exception.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ExitException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(e,s){"string"==typeof e&&(s=e,e=null),super(e,s,i),this.name="ExitException"}}s.ExitException=i},"./src/sdk/exceptions/fail.exception.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.FailException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(e,s){"string"==typeof e&&(s=e,e=null),super(e,s,i),this.name="FailException"}}s.FailException=i},"./src/sdk/exceptions/invalid-event.exception.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.InvalidEventException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(e){super(null,`Invalid event '${e}' specified.`,i),this.name="InvalidEventException"}}s.InvalidEventException=i},"./src/sdk/exceptions/no-connection.exception.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.NoConnectionException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(e){super(e),this.name="NoConnectionException"}}s.NoConnectionException=i},"./src/sdk/exceptions/no-response.exception.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.NoResponseException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(e){super(e),this.name="NoResponseException"}}s.NoResponseException=i},"./src/sdk/exceptions/profile.exception.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProfileException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(e,s){"string"==typeof e&&(s=e,e=null),super(e,s,i),this.name="ProfileException"}}s.ProfileException=i},"./src/sdk/exceptions/pushly.exception.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.PushlyException=void 0;const o=t("./src/common/utils.ts"),n=["Invalid argument","無効な引数です","参数无效","Недопустимый аргумент","Ungültiges Argument","Nieprawidłowy argument","Ongeldig argument","Ogiltigt argument","Argumento inválido","Argomento non valido","Virheellinen argumentti","Argument non valide"];class i extends Error{constructor(e,s,t=i){super(s||e.message),this.isPushlyException=!0,this.suppressed=!1,this.blacklistedErrors=[],this.name="PushlyException",this.originError=e;try{Object.setPrototypeOf(this,t.prototype)}catch(e){}}shouldSuppress(){if(this.suppressed)return!0;let e=this.suppressed;var s=this.originError||this;if(!e&&0<this.blacklistedErrors.length){const t=(0,o.buildRegexFromArray)(this.blacklistedErrors);e=t.test(this.name)||t.test(this.message)||t.test(s.name)||t.test(s.message)}if(!e){const i=(0,o.buildRegexFromArray)(n);e=i.test(this.name)||i.test(this.message)||i.test(s.name)||i.test(s.message)}return e}}s.PushlyException=i},"./src/sdk/exceptions/worker-registration.exception.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WorkerRegistrationException=void 0;var i=t("./src/sdk/exceptions/pushly.exception.ts");const o=t("./src/sdk/enums/exception-message.enum.ts"),n=["ServiceWorker script evaluation failed","An unknown error occurred when fetching the script","Encountered an error during installation","Operation has been aborted","Operation was aborted","ServiceWorker cannot be started","Timed out while trying to start the service worker","Worker system has shutdown","Could not find a renderer process to run a service worker","The user denied permission to use Service Worker","An attempt was made to use an object that is not, or is no longer, usable","Request to fetch the script was interrupted","HTTP response code .?(4|5)[\\d]{2}.? was received","An SSL certificate error occurred","An SSL error has occurred","SecurityError","Please ensure that .messagingSenderId. is set correctly","The expression cannot be converted to return the specified type"];class r extends i.PushlyException{constructor(e){super(e,o.ExceptionMessage.WORKER_LOAD_FAILED,r),this.blacklistedErrors=n,this.name="WorkerRegistrationException"}}s.WorkerRegistrationException=r},"./src/sdk/factories/data-provider-factory.ts":function(e,s,t){"use strict";var p=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.DataProviderFactory=void 0;const i=t("./src/sdk/data-providers/local-session.data-provider.ts"),l=t("./src/sdk/data-providers/brokered-session.data-provider.ts"),o=t("./src/sdk/data-providers/brokered-permission.data-provider.ts"),n=t("./src/sdk/data-providers/local-permission.data-provider.ts"),u=t("./src/sdk/cross-frame-messenger/messenger-client-connection-pool.ts"),d=t("./src/_utils/global-env.ts"),c=t("./src/sdk/enums/runtime-environment.enum.ts"),a=t("./src/sdk/services/logging.service.ts");class r{static getSessionDataProvider(r){return p(this,void 0,void 0,function*(){if(!this.sessionDataProvider){const n=r.domain.whitelistDomains?r.domain.whitelistDomains[0]:(0,d.getSelf)().location.hostname;r.runtimeEnvironment!==c.RuntimeEnvironment.BROKERED_DATA_SERVER&&r.domain.hasFlag("FEAT_USE_DATA_BROKER")&&n!==(0,d.getSelf)().location.hostname?(a.Logger.info("Using BrokeredSessionDataProvider"),this.sessionDataProvider=new Promise((i,o)=>p(this,void 0,void 0,function*(){var e=r.app.getBrokeredFrameMessengerPath(n);try{const t=new u.MessengerClientConnectionPool;var s=yield t.checkout(e);i(new l.BrokeredSessionDataProvider(s))}catch(e){o(e)}}))):(a.Logger.info("Using LocalSessionDataProvider"),this.sessionDataProvider=Promise.resolve(new i.LocalSessionDataProvider))}return this.sessionDataProvider})}static getPermissionDataProvider(t){return p(this,void 0,void 0,function*(){return this.permissionDataProvider||(t.runtimeEnvironment!==c.RuntimeEnvironment.BROKERED_DATA_SERVER&&t.domain.hasFlag("FEAT_USE_DATA_BROKER")&&!t.env.isSafari()?(a.Logger.info("Using BrokeredPermissionDataProvider"),this.permissionDataProvider=new Promise((e,s)=>p(this,void 0,void 0,function*(){e(new o.BrokeredPermissionDataProvider(t))}))):(a.Logger.info("Using LocalPermissionDataProvider"),this.permissionDataProvider=Promise.resolve(new n.LocalPermissionDataProvider(t)))),this.permissionDataProvider})}}(s.DataProviderFactory=r).permissionDataProvider=null,r.sessionDataProvider=null},"./src/sdk/factories/flow.factory.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.FlowFactory=void 0;const o=t("./src/sdk/flows/proxy.flow.ts"),n=t("./src/sdk/flows/amp-frame-helper.flow.ts"),r=t("./src/sdk/enums/exception-message.enum.ts"),p=t("./src/sdk/enums/runtime-environment.enum.ts"),l=t("./src/sdk/flows/direct.flow.ts"),u=t("./src/sdk/flows/brokered-data-server.flow.ts"),d=t("./src/sdk/flows/proxy-permission-dialog.flow.ts"),c=t("./src/sdk/exceptions/exit.exception.ts"),a=t("./src/sdk/flows/amp-permission-dialog.flow.ts");s.FlowFactory=class{static getFlow(e){let s=e.env.primaryRuntimeEnvironment;var t=e.env.subRuntimeEnvironment;t&&(s=t);const i={[p.RuntimeEnvironment.DIRECT]:l.DirectFlow,[p.RuntimeEnvironment.PROXY]:o.ProxyFlow,[p.RuntimeEnvironment.PROXY_PERMISSION_DIALOG]:d.ProxyPermissionDialogFlow,[p.RuntimeEnvironment.AMP_PERMISSION_DIALOG]:a.AmpPermissionDialogFlow,[p.RuntimeEnvironment.AMP_FRAME_HELPER]:n.AmpFrameHelperFlow,[p.RuntimeEnvironment.BROKERED_DATA_SERVER]:u.BrokeredDataServerFlow}[s];if(e.domain.isEventOnlyMode()&&i!==l.DirectFlow)throw new c.ExitException(r.ExceptionMessage.FLOW_NOT_SUPPORTED_IN_EVENT_MODE);return new i(e)}}},"./src/sdk/factories/prompt.factory.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.PromptFactory=void 0;const c=t("./src/sdk/enums/prompt-style.enum.ts"),i=t("./src/sdk/prompts/native.prompt.ts"),o=t("./src/sdk/prompts/custom.prompt.ts"),a=t("./src/sdk/services/logging.service.ts");var n=t("./src/sdk/models/events/eventable.model.ts");const r=t("./src/sdk/prompts/slide.prompt.ts"),p=t("./src/sdk/prompts/bell.prompt.ts");class l extends n.EventableModel{static getPrompts(t,e={}){const i=[],s=this._selectEligiblePrompts(t,e);return 0<s.length?s.forEach(e=>{const s=this._selectPromptClass(e.prompt.style);i.push(new s(t,e))}):(this.debugPromptNotShown(t,"no_eligible_prompts"),a.Logger.info("No eligible prompts found")),i}static getPromptById(e,s){const t={};let i;if(t.prompt=e.domain.prompts.find(e=>e.id.toString()===s.toString()),t.prompt&&(t.group=e.domain.promptGroups.find(e=>e.id.toString()===t.prompt.prompt_group_id.toString())),t.group){const o=this._selectPromptClass(t.prompt.style);i=new o(e,t)}return i}static _selectPromptClass(e){return{[c.PromptStyle.Native]:i.NativePrompt,[c.PromptStyle.Slide]:r.SlidePrompt,[c.PromptStyle.Bell]:p.BellPrompt,[c.PromptStyle.Custom]:o.CustomPrompt}[e]}static _selectEligiblePrompts(n,e=0){const r=[],p=n.user.env.location.href||"",l=n.user.env.getCurrentMetaKeywords(),u=n.user.env.getDeviceType(),s=n.domain.promptGroups,d=n.domain.prompts,t=s.sort((e,s)=>e.priority>s.priority?1:e.priority<s.priority?-1:0);t.some(t=>{let e=!1,i=(n.env.requires2Step()&&(e=!0,a.Logger.info("Browser requiring 2-step detected. Filtering prompts for 2-Step experience.")),d.filter(e=>e.prompt_group_id===t.id));if(0<(i=e?i.filter(e=>e.style!==c.PromptStyle.Native):i).length){let e=!0,s;var o;return(e=t.conditions_json&&!(s=this._validatePromptConditions(n,t,u,p,l)).matched?!1:e)?(o=1===i.length?i[0]:this._pickWeightedRandomPrompt(i),r.push({group:t,prompt:o}),!0):!(!s||!s.stopEvaluation)||void 0}});let i;var o;return(i=(i=0<r.length?r[0]:i)&&i.group&&void 0!==i.group.display_to_pct&&(o=i.group.display_to_pct)<100&&o<Math.floor(100*Math.random())?void 0:i)?[i]:[]}static _validatePromptConditions(e,s,t,i,o){let n={matched:!0,stopEvaluation:!1};var r;return s.conditions_json&&(r=s.conditions_json.display||{},s=s.conditions_json.page||{},(n=this._validateDisplayConditions(r,t)).matched&&(r=this._validateMetaKeywordConditions(s,o),n.matched=r.matched),n.matched&&(t=this._validatePageUrlConditions(s,i),n.matched=t.matched)),n.stopEvaluation&&n.stopEvaluationReason&&this.debugPromptNotShown(e,n.stopEvaluationReason),n}static _validateDisplayConditions(e,s){const t={matched:!0,stopEvaluation:!1};return(e.mobile||e.desktop)&&(!(s="desktop"===s)&&t.matched&&e.mobile&&("pass"===e.mobile&&(t.matched=!1),"disabled"===e.mobile&&(t.matched=!1,t.stopEvaluation=!0,t.stopEvaluationReason="platform_disabled_mobile")),s&&t.matched&&e.desktop&&("pass"===e.desktop&&(t.matched=!1),"disabled"===e.desktop&&(t.matched=!1,t.stopEvaluation=!0,t.stopEvaluationReason="platform_disabled_desktop"))),t}static _validateMetaKeywordConditions(e,t){const i={matched:!0,stopEvaluation:!1};if(i.matched&&Array.isArray(e.keywords))if(0===t.length)i.matched=!1;else{let s=!1;e.keywords.some(e=>{if(-1!==t.indexOf(e))return s=!0}),i.matched=s}return i}static _validatePageUrlConditions(e,i){const s={matched:!0,stopEvaluation:!1};if(s.matched&&e.excluded_page_urls){let t=!1;Array.isArray(e.excluded_page_urls)&&0<e.excluded_page_urls.length&&e.excluded_page_urls.some(e=>{const s=new RegExp(this._prepareRgxUrl(e),"i");if(s.test(i))return t=!0}),s.matched=!t}if(s.matched&&e.page_urls){let t=!1;Array.isArray(e.page_urls)&&0<e.page_urls.length?e.page_urls.some(e=>{const s=new RegExp(this._prepareRgxUrl(e),"i");if(s.test(i))return t=!0}):t=!0,s.matched=t}return s}static _prepareRgxUrl(e){return e.replace(/\?/g,"\\?").replace(/\+|%20/g,"(?:\\+|%20)")}static _pickWeightedRandomPrompt(e){const s=[];for(var t of e)for(let e=0;e<t.weight;e++)s.push(t);return s[Math.floor(Math.random()*s.length)]}}s.PromptFactory=l},"./src/sdk/flows/amp-frame-helper.flow.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.AmpFrameHelperFlow=void 0;const o=t("./src/sdk/message-servers/amp-frame-helper-server.ts");var n=t("./src/sdk/flows/base.flow.ts");const r=t("./src/sdk/models/events/event.model.ts"),p=t("./src/sdk/enums/event-type.enum.ts"),l=t("./src/sdk/services/worker.service.ts");class u extends n.BaseFlow{constructor(e){super(e,!1)}_wireEvents(){this.ampFrameHelperServer=new o.AmpFrameHelperServer(this.context)}run(){return i(this,void 0,void 0,function*(){yield l.WorkerService.registerWorker(this.context),yield this.dispatch(new r.EventModel(p.EventType.FLOW_LOADED))})}}s.AmpFrameHelperFlow=u},"./src/sdk/flows/amp-permission-dialog.flow.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.AmpPermissionDialogFlow=void 0;const o=t("./src/sdk/constants.ts");var n=t("./src/sdk/flows/base.flow.ts");const r=t("./src/sdk/cross-frame-messenger/messenger-client.ts"),p=t("./src/common/utils.ts"),l=t("./src/sdk/models/events/event.model.ts"),u=t("./src/sdk/enums/amp-message-topic.enum.ts"),d=t("./src/sdk/enums/event-type.enum.ts"),c=t("./src/sdk/enums/notification-permission-state.enum.ts"),a=t("./src/sdk/services/registration.service.ts"),h=t("./src/sdk/services/logging.service.ts"),m=t("./src/sdk/services/worker.service.ts");class v extends n.BaseFlow{_wireEvents(){var e=this.handlePermissionGranted.bind(this),s=this.handlePermissionDenied.bind(this);this.watch(d.EventType.REGISTRATION_SUBSCRIBED,e),this.watch(d.EventType.PERMISSION_DENIED,s),this.watch(d.EventType.PERMISSION_DISMISSED,s)}run(){return i(this,void 0,void 0,function*(){this.messengerClient=new r.MessengerClient,yield this.messengerClient.connect(window.opener,0),yield m.WorkerService.registerWorker(this.context),this.loadLanternShark(),yield this.dispatch(new l.EventModel(d.EventType.FLOW_LOADED))})}loadLanternShark(){var e=this.context.domain.domainKey;const s=document.createElement("iframe");e=o.PROXY_URL+`/amp/${e}?pushly_domain_key=`+e;s.addEventListener("load",()=>i(this,void 0,void 0,function*(){try{this.initializeDialogContent(s.contentWindow),yield a.RegistrationService.performManualRegistrationAttempt(this.context,999)}catch(e){h.Logger.error(this.context,e)}})),s.setAttribute("src",e),s.setAttribute("frame-border","0"),s.setAttribute("style","width: 100vw; height: 100vh; border: none;"),document.body.appendChild(s)}initializeDialogContent(e){e.postMessage({action:"lite-reboot",data:{context:this.context}},"*")}handlePermissionGranted(){return i(this,void 0,void 0,function*(){try{yield(0,p.awaitUntil)(this.messengerClient.send(u.AmpMessageTopic.NOTIFICATION_PERMISSION_STATE,c.NotificationPermissionState.GRANTED),500)}catch(e){}window.close()})}handlePermissionDenied(){return i(this,void 0,void 0,function*(){try{yield(0,p.awaitUntil)(this.messengerClient.send(u.AmpMessageTopic.NOTIFICATION_PERMISSION_STATE,c.NotificationPermissionState.DENIED),500)}catch(e){}window.close()})}}s.AmpPermissionDialogFlow=v},"./src/sdk/flows/base.flow.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.BaseFlow=void 0;const p=t("./src/sdk/utils.ts"),o=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),n=t("./src/sdk/models/events/base-streamable-event.model.ts"),r=t("./src/sdk/enums/steamable-event-type.enum.ts"),l=t("./src/sdk/factories/data-provider-factory.ts");var u=t("./src/sdk/models/events/eventable.model.ts");const d=t("./src/_utils/interval-runner.ts");class c extends u.EventableModel{constructor(e,s=!0){super(),this.context=e,this.isPromptableFlow=s,this.pageChangeTrackerStarted=!1,this._wireEvents()}_startPageChangeTracker(s){let t;var e=()=>i(this,void 0,void 0,function*(){var e=this.context.env.location.href;e!=t&&(this._logSessionPageView(e),(yield this.context.user.isSubscribed(this.context))?this.post(new o.SubscriberStreamableEventModel(r.StreamableEventType.PAGE_VIEW,{meta:{subscription_data:s}},this.context)):-1!==this.context.domain.flags.indexOf("FEAT_INFORMED_CONTENT")&&this.post(new n.BaseStreamableEventModel(r.StreamableEventType.ANONYMOUS_PAGE_VIEW,{meta:{page_url:e}},this.context))),t=e});this.pageChangeTrackerStarted||(this.pageChangeTrackerStarted=!0,(0,d.setIntervalRunner)(e,1e3))}_logSessionPageView(r){return i(this,void 0,void 0,function*(){try{const n=yield l.DataProviderFactory.getSessionDataProvider(this.context);var e,s=(0,p.hashFromString)(r),t=(yield n.getCurrentSession()).pageViews||[],i=0===t.length,o=!i&&t[t.length-1]!==s;(i||o)&&(e=[...t,s],yield n.set("pageViews",e))}catch(e){}})}}s.BaseFlow=c},"./src/sdk/flows/brokered-data-server.flow.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.BrokeredDataServerFlow=void 0,t("./src/sdk/flows/base.flow.ts"));const n=t("./src/sdk/message-servers/brokered-session-server.ts"),r=t("./src/sdk/message-servers/brokered-permission-server.ts"),p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/enums/event-type.enum.ts"),u=t("./src/sdk/cross-frame-messenger/messenger-server.ts"),d=t("./src/sdk/services/registration.service.ts");class c extends o.BaseFlow{constructor(e){super(e,!1)}_wireEvents(){this.brokeredSessionServer=new n.BrokeredSessionServer(u.MessengerServer.global),this.brokeredPermissionServer=new r.BrokeredPermissionServer(this.context,u.MessengerServer.global)}run(){return i(this,void 0,void 0,function*(){yield d.RegistrationService.tryMigration(this.context,!1),yield this.dispatch(new p.EventModel(l.EventType.FLOW_LOADED))})}}s.BrokeredDataServerFlow=c},"./src/sdk/flows/direct.flow.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.DirectFlow=void 0,t("./src/sdk/flows/base.flow.ts"));const n=t("./src/_utils/global-env.ts"),r=t("./src/sdk/models/events/event.model.ts"),p=t("./src/sdk/enums/exception-message.enum.ts"),l=t("./src/sdk/enums/runtime-environment.enum.ts"),u=t("./src/sdk/enums/event-type.enum.ts"),d=t("./src/sdk/services/registration.service.ts"),c=t("./src/sdk/exceptions/exit.exception.ts"),a=t("./src/sdk/services/worker.service.ts");class h extends o.BaseFlow{_wireEvents(){}run(){return i(this,void 0,void 0,function*(){var e=yield this.context.user.getComputedPushPermission(this.context);if(!this.context.domain.isEventOnlyMode()&&this.context.env.primaryRuntimeEnvironment!==l.RuntimeEnvironment.PROXY){if(this.context.env.isPushManagerInScope()){if(!this.context.env.isHTTPS()&&!this.context.env.isDevMode())throw new c.ExitException(p.ExceptionMessage.DIRECT_INTEGRATION_NOT_SECURE);this.context.domain.shouldUseVapid()&&!(yield this.context.user.isSubscribed(this.context))||e.host===(0,n.getSelf)().location.hostname&&(yield a.WorkerService.registerWorker(this.context))}yield d.RegistrationService.tryMigration(this.context)}this._startPageChangeTracker(e.subscription),yield this.dispatch(new r.EventModel(u.EventType.FLOW_LOADED))})}}s.DirectFlow=h},"./src/sdk/flows/proxy-permission-dialog.flow.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.ProxyPermissionDialogFlow=void 0,t("./src/sdk/flows/base.flow.ts"));const n=t("./src/sdk/models/events/event.model.ts"),r=t("./src/sdk/enums/event-type.enum.ts"),p=t("./src/sdk/services/logging.service.ts"),l=t("./src/sdk/services/worker.service.ts");class u extends o.BaseFlow{_wireEvents(){var e=this._handlePermissionPrompted.bind(this),s=this._handlePermissionGranted.bind(this),t=this._handlePermissionDismissed.bind(this),i=this._handlePermissionDenied.bind(this);this.watch(r.EventType.PERMISSION_DIALOG_SHOWN,e),this.watch(r.EventType.REGISTRATION_SUBSCRIBED,s),this.watch(r.EventType.PERMISSION_DISMISSED,t),this.watch(r.EventType.PERMISSION_DENIED,i)}run(){return i(this,void 0,void 0,function*(){this.context.env.isPushManagerInScope()&&(yield l.WorkerService.registerWorker(this.context)),yield this.dispatch(new n.EventModel(r.EventType.FLOW_LOADED))})}_handlePermissionPrompted(){return i(this,void 0,void 0,function*(){this._postMessage(r.EventType.PERMISSION_DIALOG_SHOWN,void 0,!1)})}_handlePermissionGranted(e){return i(this,void 0,void 0,function*(){this._postMessage(r.EventType.REGISTRATION_SUBSCRIBED,e)})}_handlePermissionDismissed(){return i(this,void 0,void 0,function*(){this._postMessage(r.EventType.PERMISSION_DISMISSED)})}_handlePermissionDenied(){return i(this,void 0,void 0,function*(){this._postMessage(r.EventType.PERMISSION_DENIED)})}_postMessage(e,s,t=!0){try{window.opener.postMessage({action:e,data:s},"*")}catch(e){p.Logger.warn(e)}finally{t&&this._closeWindow()}}_closeWindow(){setTimeout(()=>{window.close()})}}s.ProxyPermissionDialogFlow=u},"./src/sdk/flows/proxy.flow.ts":function(e,s,t){"use strict";var o=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},i=(Object.defineProperty(s,"__esModule",{value:!0}),s.ProxyFlow=void 0,t("./src/sdk/flows/direct.flow.ts"));const n=t("./src/sdk/models/events/event.model.ts"),r=t("./src/sdk/services/user.service.ts"),p=t("./src/sdk/enums/event-type.enum.ts"),l=t("./src/sdk/services/logging.service.ts");class u extends i.DirectFlow{_wireEvents(){var e=this._handleWindowMessage.bind(this);window.addEventListener("message",e)}run(){const e=Object.create(null,{run:{get:()=>super.run}});return o(this,void 0,void 0,function*(){yield r.UserService.reloadUserWithCachePriority(this.context.user),yield e.run.call(this)})}_handleWindowMessage(i){return o(this,void 0,void 0,function*(){try{var e=this.context.domain;if(-1!==i.origin.indexOf(e.customAllowDomain)){var s=i.data.action,t=i.data.data;switch(l.Logger.info("Got message from proxy window: "+s),s){case p.EventType.PERMISSION_DIALOG_SHOWN:yield this._handlePermissionPrompted();break;case p.EventType.REGISTRATION_SUBSCRIBED:yield this._handlePermissionAccepted(t);break;case p.EventType.PERMISSION_DISMISSED:yield this._handlePermissionDismissed();break;case p.EventType.PERMISSION_DENIED:yield this._handlePermissionDenied()}yield this.dispatch(new n.EventModel(s,t))}}catch(e){l.Logger.error(this.context,e)}})}_handlePermissionPrompted(){return o(this,void 0,void 0,function*(){this.dispatch(new n.EventModel(p.EventType.PERMISSION_DIALOG_SHOWN,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId)))})}_handlePermissionAccepted(e){return o(this,void 0,void 0,function*(){this.dispatch(new n.EventModel(p.EventType.PERMISSION_GRANTED,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),yield r.UserService.setSubscriptionState(this.context.user,"subscribed",e)})}_handlePermissionDismissed(){return o(this,void 0,void 0,function*(){this.dispatch(new n.EventModel(p.EventType.PERMISSION_DISMISSED,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),yield r.UserService.setSubscriptionState(this.context.user,"dismissed")})}_handlePermissionDenied(){return o(this,void 0,void 0,function*(){this.dispatch(new n.EventModel(p.EventType.PERMISSION_DENIED,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),yield r.UserService.setSubscriptionState(this.context.user,"blocked")})}_buildClientFeedbackEventPack(e=null,s=[]){return{prompt:{id:e,keywords:s}}}}s.ProxyFlow=u},"./src/sdk/message-servers/abstract-message-server.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AbstractMessageServer=void 0;const i=t("./src/sdk/services/logging.service.ts");class o extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{andReply(e){return s=>{e(s.data).then(e=>{s.reply(e)}).catch(e=>{i.Logger.warn("MessageServerError encountered:",e)})}}}s.AbstractMessageServer=o},"./src/sdk/message-servers/amp-frame-helper-server.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.AmpFrameHelperServer=void 0,t("./src/sdk/message-servers/abstract-message-server.ts"));const n=t("./src/sdk/cross-frame-messenger/messenger-server.ts"),r=t("./src/sdk/enums/amp-message-topic.enum.ts"),p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/enums/amp-worker-message-topic.enum.ts"),u=t("./src/sdk/services/user.service.ts"),d=t("./src/sdk/enums/event-type.enum.ts"),c=t("./src/sdk/enums/notification-permission-state.enum.ts"),a=t("./src/sdk/services/registration.service.ts");class h extends o.AbstractMessageServer{constructor(e){super(),this.context=e,this.bindEvents()}bindEvents(){n.MessengerServer.global.watch(r.AmpMessageTopic.NOTIFICATION_PERMISSION_STATE,this.andReply(this.handlePermissionStateMessage.bind(this))),n.MessengerServer.global.watch(r.AmpMessageTopic.SERVICE_WORKER_STATE,this.andReply(this.handleWorkerStateMessage.bind(this))),n.MessengerServer.global.watch(r.AmpMessageTopic.SERVICE_WORKER_REGISTRATION,this.andReply(this.handleWorkerRegistrationMessage.bind(this))),n.MessengerServer.global.watch(r.AmpMessageTopic.SERVICE_WORKER_QUERY,this.andReply(this.handleWorkerQueryMessage.bind(this))),n.MessengerServer.global.watch(r.AmpMessageTopic.STORAGE_GET,this.andReply(this.handleStorageGetMessage.bind(this)))}handlePermissionStateMessage(){return i(this,void 0,void 0,function*(){return{success:!0,result:!0}})}handleWorkerStateMessage(){return i(this,void 0,void 0,function*(){return{success:!0,result:{isControllingFrame:!!window.navigator.serviceWorker.controller,url:window.navigator.serviceWorker.controller?window.navigator.serviceWorker.controller.scriptURL.split("?")[0]:null,state:window.navigator.serviceWorker.controller?window.navigator.serviceWorker.controller.state:null}}})}handleWorkerRegistrationMessage(){return i(this,void 0,void 0,function*(){return{success:!0,result:null}})}handleWorkerQueryMessage(t){return i(this,void 0,void 0,function*(){const e=this.context.user;let s=null;switch(t.topic){case l.AmpWorkerMessageTopic.AMP_SUBSCRIPTION_STATE:s=yield e.isSubscribed(this.context);break;case l.AmpWorkerMessageTopic.AMP_UNSUBSCRIBE:yield a.RegistrationService.unsubscribe(this.context);break;case l.AmpWorkerMessageTopic.AMP_SUBSCRIBE:}return{success:!0,result:s}})}handleStorageGetMessage(){return i(this,void 0,void 0,function*(){const e=this.context.user;let s=c.NotificationPermissionState.DEFAULT;return(yield e.isSubscribed(this.context))&&(s=c.NotificationPermissionState.GRANTED,"subscribed"!==e.subscriberState&&(yield u.UserService.reloadUserWithCachePriority(e),yield this.dispatch(new p.EventModel(d.EventType.REGISTRATION_SUBSCRIBED,e.token)))),(e.isBlocked()||e.isDismissed())&&(s=c.NotificationPermissionState.DENIED,"none"===e.subscriberState&&(yield this.dispatch(new p.EventModel(d.EventType.PERMISSION_DENIED)))),{success:!0,result:s}})}}s.AmpFrameHelperServer=h},"./src/sdk/message-servers/brokered-permission-server.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BrokeredPermissionServer=void 0;const i=t("./src/sdk/data-providers/local-permission.data-provider.ts");var o=t("./src/sdk/message-servers/abstract-message-server.ts");const n=t("./src/sdk/enums/messenger-topic.enum.ts"),r=t("./src/sdk/enums/permission-broker-topic.enum.ts");class p extends o.AbstractMessageServer{constructor(e,s){super(),this.context=e,this.messengerServer=s,this.dataProvider=new i.LocalPermissionDataProvider(e),this.bindEvents()}bindEvents(){this.messengerServer.watch(r.PermissionBrokerTopic.PERMISSION_GET_PUSH_PERMISSION,this.andReply(this.dataProvider.getPushPermission.bind(this.dataProvider))),this.messengerServer.watch(n.MessengerTopic.SERVICE_WORKER_UNREGISTER,this.andReply(this.dataProvider.removeRegistration.bind(this.dataProvider)))}}s.BrokeredPermissionServer=p},"./src/sdk/message-servers/brokered-session-server.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.BrokeredSessionServer=void 0,t("./src/sdk/message-servers/abstract-message-server.ts"));const n=t("./src/sdk/data-providers/local-session.data-provider.ts"),r=t("./src/sdk/enums/session-broker-topic.enum.ts");class p extends o.AbstractMessageServer{constructor(e){super(),this.messengerServer=e,this.dataProvider=new n.LocalSessionDataProvider,this.bindEvents()}bindEvents(){this.messengerServer.watch(r.SessionBrokerTopic.SESSION_GET,this.andReply(this.dataProvider.get.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_REMOVE,this.andReply(this.dataProvider.remove.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_GET_CURRENT_PAGE_VIEWS,this.andReply(this.dataProvider.getCurrentPageViews.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_GET_CURRENT_TOTAL_PAGE_VIEWS,this.andReply(this.dataProvider.getCurrentTotalPageViews.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_GET_CURRENT_SESSION,this.andReply(this.dataProvider.getCurrentSession.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_SET,this.andReply(e=>i(this,void 0,void 0,function*(){return this.dataProvider.set(e[0],e[1])})))}}s.BrokeredSessionServer=p},"./src/sdk/models/application/app.model.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AppModel=void 0;const i=t("./src/sdk/constants.ts");s.AppModel=class{constructor(){this.env=i.ENV_NAME,this.version=i.PUSHLY_APPLICATION_VERSION,this.classNames={},this.isLoaded=!1,this.isReady=!1,this.isDisabled=!1,this.isVisibleLoggingEnabled=!1,this.isEventOnlyMode=!1,this.mode="production"}getBrokeredFrameMessengerPath(e){return this.loadConfig.frameMessenger?"https://"+e+this.loadConfig.frameMessenger:this.loadConfig.sw?`https://${e}${this.loadConfig.sw.substr(0,this.loadConfig.sw.lastIndexOf("/"))}/pushly-frame-messenger.html`:`https://${e}/pn-brokered-data-server.html`}}},"./src/sdk/models/application/environment.model.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.EnvironmentModel=void 0;const o=t("./src/sdk/data-providers/local-permission.data-provider.ts"),n=t("./src/_utils/global-env.ts"),r=t("./src/sdk/utils.ts"),p=t("./src/sdk/factories/data-provider-factory.ts");s.EnvironmentModel=class{constructor(){this.mode="production"}get scope(){return(0,n.getSelf)()}get navigator(){return(0,n.getNavigator)()}get location(){return(0,n.getLocation)()}get document(){return(0,n.getDocument)()}get referrer(){return(0,n.getDocument)().referrer}get userAgent(){return(0,n.getNavigator)().userAgent}getDeviceType(){let e;return e=navigator.userAgentData?navigator.userAgentData.mobile?"mobile":"desktop":/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?"mobile":"desktop"}getCurrentMetaKeywords(){let e=[];try{const s=[...document.querySelectorAll("meta[name='keywords'], meta[name='parsely-tags'], meta[name='sailthru.tags']")||[]];e=[...new Set(s.flatMap(e=>{return null==(e=e.content)?void 0:e.split(",").flatMap(e=>e.toString().trim().toLowerCase())}))].filter(e=>e)}catch(e){}return e}getQueryString(){return(0,r.parseQueryString)(this.location.search)}getGlobalScope(){return this.inSourcelessIFrame()?top:this.inWorkerGlobalScope()?self:window}inWorkerGlobalScope(){return"WorkerGlobalScope"in self}inSourcelessIFrame(){return window.self!==window.top&&window.frameElement&&"about:blank"===window.frameElement.src}requires2Step(){if(this.isSafari())return!0;if(!navigator.userAgentData)return!0;for(const e of navigator.userAgentData.brands){if(/firefox/i.test(e.brand))return!0;if("Microsoft Edge"===e.brand)return!0}return!1}isSafari(){return navigator.vendor.match(/apple/i)&&!navigator.userAgent.match(/crios/i)&&!navigator.userAgent.match(/fxios/i)&&!navigator.userAgent.match(/Opera|OPT\//)}isSafariPushCapable(){return this.isSafari()&&"object"==typeof this.scope.safari&&"pushNotification"in this.scope.safari}isPushManagerInScope(){return"PushManager"in this.scope}isArrayFullySupported(){return"Array"in this.scope&&"from"in Array&&"some"in[]}isDevMode(){return"development"===this.mode}isHTTPS(){return"https:"===this.location.protocol}isLocal(){return"localhost"===this.location.hostname||"127.0.0.1"===this.location.hostname}getLocalPushPermission(s){return i(this,void 0,void 0,function*(){const e=yield new o.LocalPermissionDataProvider(s);return yield e.getPushPermission()})}getComputedPushPermission(s){return i(this,void 0,void 0,function*(){const e=yield p.DataProviderFactory.getPermissionDataProvider(s);return yield e.getPushPermission()})}isPushSupported(){return i(this,void 0,void 0,function*(){let s="location"in this.scope;if(s||(this.unsupportedReason="self.location not accessible"),!s||(s="navigator"in this.scope)||(this.unsupportedReason="self.navigator not accessible"),!s||(s="userAgent"in this.navigator)||(this.unsupportedReason="self.userAgent not accessible"),!s||(s=this.navigator.cookieEnabled)||(this.unsupportedReason="self.navigator.cookieEnabled is FALSE"),!s||(s="Notification"in this.scope)||(this.unsupportedReason="self.Notification not accessible"),!s||(s=this.isArrayFullySupported())||(this.unsupportedReason="required Array functionality not accessible"),!s||(s=!!this.location.host)||(this.unsupportedReason="self.location.host is undefined"),!s||(s=!!this.location.hostname)||(this.unsupportedReason="self.location.hostname is undefined"),s)try{s=!!this.location.hostname.split("")}catch(e){s=!1,this.unsupportedReason="self.location.hostname is not a valid String"}if(s){const t=/HeadlessChrome|googlebot|crawler|spider|robot|crawling|facebookexternalhit/im;(s=!t.test(this.navigator.userAgent))||(this.unsupportedReason="self.navigator.userAgent is recognizedBot"),!s||(s=!t.test(this.navigator.appVersion))||(this.unsupportedReason="self.navigator.appVersion is recognizedBot"),!s||(s=!t.test(this.navigator.appCodeName))||(this.unsupportedReason="self.navigator.appCodeName is recognizedBot"),!s||(s=!t.test(this.navigator.product))||(this.unsupportedReason="self.navigator.product is recognizedBot")}var e=this.isPushManagerInScope();if(s&&!e){const i=/iphone|ipad/i;(s=!i.test(this.navigator.userAgent))||(this.unsupportedReason="self.navigator.userAgent is iDevice"),!s||(s=!(this.navigator.platform&&i.test(this.navigator.platform)))||(this.unsupportedReason="self.navigator.platform is iDevice")}if(s&&this.isSafari()&&!e)!s||(s=this.isSafariPushCapable())||(this.unsupportedReason="self.safari.pushNotification is not accessible");else if(!s||(s="PushManager"in this.scope)||(this.unsupportedReason="self.PushManager is not accessible"),!s||(s="PushSubscription"in this.scope)||(this.unsupportedReason="self.PushSubscription is not accessible"),!s||(s=this.scope.PushSubscription.prototype.hasOwnProperty("getKey"))||(this.unsupportedReason="self.PushSubscription.prototype.getKey is not accessible"),(this.isHTTPS()||this.isDevMode())&&(s&&!(s="ServiceWorker"in this.scope)&&(this.unsupportedReason="self.ServiceWorker is not accessible"),s&&!(s="serviceWorker"in this.navigator)&&(this.unsupportedReason="self.navigator.serviceWorker is not accessible"),s&&!(s="ServiceWorkerRegistration"in this.scope)&&(this.unsupportedReason="self.ServiceWorkerRegistration is not accessible"),s&&!(s=this.scope.ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification"))&&(this.unsupportedReason="self.ServiceWorkerRegistration.prototype.showNotification is not accessible"),s))try{yield this.navigator.serviceWorker.getRegistration()}catch(e){s=!1,this.unsupportedReason="call to self.navigator.serviceWorker.getRegistration() failed"}return s})}}},"./src/sdk/models/context.model.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ContextModel=void 0;s.ContextModel=class{constructor(){this.clock=0,this.e=!1}}},"./src/sdk/models/domains/domain.model.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.DomainModel=s.DomainFrequencyCapMetric=void 0;const n=t("./src/_utils/domain-matching.ts"),i=t("./src/_utils/global-env.ts");(t=s.DomainFrequencyCapMetric||(s.DomainFrequencyCapMetric={})).DAYS="days",t.HOURS="hours",t.MINUTES="minutes";s.DomainModel=class{constructor(){this.flags=[],this.additionalSubscriptionData=[],this.promptGroups=[],this.prompts=[],this.isCached=!1}shouldReplaceExistingWorkerInPushlyScope(){return this.hasFlag("REPLACE_EXISTING_WORKERS")}shouldUnregisterNonPushlyWorkers(){return this.hasFlag("UNREGISTER_ALL_NON_PUSHLY_WORKERS")}shouldUseCustomVapidKey(){return!!this.vapidPublicKey}shouldUseVapid(){return"PushManager"in(0,i.getSelf)()}hasFlag(e){return Array.isArray(this.flags)&&-1!==this.flags.indexOf(e.toString().toUpperCase())}hasApnsConfig(){return!!this.apnsConfiguration}isApnsConfigEnabled(){return this.hasApnsConfig()&&!0===this.apnsConfiguration.is_active}getPushPackageSettings(){return(this.apnsConfiguration||{}).push_package||{}}getWebsitePushId(){return this.getPushPackageSettings().website_push_id}isEventOnlyMode(){const e=this.whitelistDomains||[],s=this.sdkEventOnlyDomains||["oceans3.deepbluedev.com"];var t=this.hasFlag("FEAT_SDK_EVENT_ONLY_DOMAINS"),i=e.some(n.domainMatchPredicate),o=s.some(n.domainMatchPredicate);return t&&i&&o}}},"./src/sdk/models/domains/global-prompt-referrer-conditions.model.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.GlobalPromptReferrerConditionsModel=void 0;const i=t("./src/sdk/enums/prompt-referrer-condition.enum.ts").PromptReferrerCondition.IGNORE;s.GlobalPromptReferrerConditionsModel=class o{constructor(){this.persist_ttl_seconds=259200}static parse(e){const s=new o;return e=e||{},s.enabled=e.enabled||!1,s.persist_ttl_seconds=e.persist_ttl_seconds||s.persist_ttl_seconds,s.when_self=e.when_self||i,s.when_blank=e.when_blank||i,s.allowed=e.allowed||void 0,s.blocked=e.blocked||void 0,s}}},"./src/sdk/models/events/base-streamable-event.model.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.BaseStreamableEventModel=void 0;const o=t("./src/sdk/constants.ts"),n=t("./src/sdk/utils.ts"),r=t("./src/sdk/enums/event-priority.enum.ts");s.BaseStreamableEventModel=class{constructor(e,s,t){this.type=e,this.additionalData=s,this.context=t,this.id=(0,n.randomString)(),this.eventDate=(new Date).toISOString()}getPostData(){return i(this,void 0,void 0,function*(){return Object.assign(Object.assign({},this.additionalData),{action:this.type,domain_id:this.context.domain.id,event_date:this.eventDate,meta:Object.assign(Object.assign({},this.additionalData.meta||{}),{event_id:this.id,source:{application:o.PUSHLY_SDK_APPLICATION_NAME,version:o.PUSHLY_APPLICATION_VERSION}})})})}getRequestObject(s,t){return i(this,void 0,void 0,function*(){let e={"content-type":"text/plain"};return t===r.EventPriority.IMMEDIATE&&(e["X-Event-Priority"]=t),{endpoint:s||o.EVENTS_ENDPOINT,method:"POST",headers:e,body:JSON.stringify(yield this.getPostData())}})}}},"./src/sdk/models/events/event.model.ts":(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.EventModel=void 0;s.EventModel=class{constructor(e,...s){this.type=e,this.data=s}}},"./src/sdk/models/events/eventable.model.ts":function(e,s,t){"use strict";var n=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.EventableModel=void 0;const r=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),i=(t("./src/sdk/enums/debug-cookie-code.enum.ts"),t("./src/sdk/utils.ts")),o=t("./src/common/data-providers/api.data-provider.ts"),p=t("./src/sdk/enums/steamable-event-type.enum.ts"),l=t("./src/sdk/data-providers/event.data-provider.ts");class u{constructor(){this.s=(0,i.randomString)()}static post(s,t,i){return n(this,void 0,void 0,function*(){var e=yield s.getRequestObject(t,i);return o.ApiDataProvider.exec(e.endpoint,e.method,e.headers,e.body,!1)})}static debug(s,t,i,o){return n(this,void 0,void 0,function*(){try{if(s.domain&&s.domain.hasFlag("SDK_DEBUG_EVENTS")){let e={};return t===p.StreamableEventType.PROMPT_NOT_SHOWN&&(e={prompt_not_shown_reason:i||"unknown"},o&&(e.error_message=o)),this.post(new r.SubscriberStreamableEventModel(t,{meta:e},s))}}catch(e){}})}static debugPromptNotShown(e,s,t){return n(this,void 0,void 0,function*(){return this.debug(e,p.StreamableEventType.PROMPT_NOT_SHOWN,s,t)})}watch(e,s){return l.EventManager.on(e,s)}watchOnce(e,s){return l.EventManager.once(e,s)}unwatch(e,s){l.EventManager.unregisterCallback(e,s)}dispatch(e){return n(this,void 0,void 0,function*(){yield l.EventManager.dispatch(e)})}post(e,s,t){return n(this,void 0,void 0,function*(){return u.post(e,s,t)})}debug(e,s,t){return n(this,void 0,void 0,function*(){return u.debug(e,s,t,null)})}debugPromptNotShown(e,s,t){return n(this,void 0,void 0,function*(){return u.debugPromptNotShown(e,s,t)})}}s.EventableModel=u},"./src/sdk/models/events/subscriber-streamable-event.model.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.SubscriberStreamableEventModel=void 0;const d=t("./src/_utils/consent.ts");var o=t("./src/sdk/models/events/base-streamable-event.model.ts");const c=t("./src/_utils/global-env.ts"),a=t("./src/sdk/utils.ts"),h=t("./src/sdk/data-providers/cookie.data-provider.ts");class n extends o.BaseStreamableEventModel{getPostData(){const u=Object.create(null,{getPostData:{get:()=>super.getPostData}});return i(this,void 0,void 0,function*(){var e=yield u.getPostData.call(this);let s,t,i,o,n,r,p,l;if(this.context.user||this.context.domain&&this.context.domain.hasFlag("SDK_DEBUG_EVENTS")){this.context.user&&(t=this.context.user.puuid,i=this.context.user.externalId,o=this.context.user.token,n=this.context.user.lastSeenPromptId),r=(0,c.getLocation)().href;try{p=Intl.DateTimeFormat().resolvedOptions().locale,l=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}}if(!t)try{let e=h.CookieDataProvider.get("pushly.user_puuid");e||(e=(0,a.randomString)(),h.CookieDataProvider.set("pushly.user_puuid",e)),t=e}catch(e){}if(t&&/undefined/i.test(t.toString())&&(t=(0,a.randomString)(),h.CookieDataProvider.set("pushly.user_puuid",t)),s=Object.assign(Object.assign(Object.assign(Object.assign({},e),{domain_key:this.context.domainKey}),(0,d.buildSdkConsentEventData)(this.context)),{meta:Object.assign(Object.assign({},e.meta),{pushly_unique_user_id:t,external_id:i})}),this.context.env&&this.context.env.isSafari()&&!this.context.env.isPushManagerInScope()&&(s.meta.apns_token=o),s.meta){let e=s.meta;e.prompt_id=e.promptId||e.prompt_id,e.prompt_id||(e.prompt_id=n),delete e.promptId}return s.meta.page_url=r,s.meta.language=p,s.meta.time_zone=l,s})}}s.SubscriberStreamableEventModel=n},"./src/sdk/models/users/user.model.ts":function(e,s){"use strict";var t=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.UserModel=void 0;s.UserModel=class i{constructor(){this.subscriberState="none",this.isInUdr=!1}static of(e){const s=new i;return Object.assign(s,e),s.subscriberState||(s.subscriberState="none"),s}isUnsubscribed(e){return t(this,void 0,void 0,function*(){return"unsubscribed"===this.subscriberState&&"default"===(yield this.getComputedPushPermission(e)).permission||this.isInUdr})}getComputedPushPermission(e){return t(this,void 0,void 0,function*(){return this._computedPushPermission||(this._computedPushPermission=yield this.env.getComputedPushPermission(e)),this._computedPushPermission})}getLocalPushPermission(e,s=!1){return t(this,void 0,void 0,function*(){return this._localPushPermission&&!s||(this._localPushPermission=yield this.env.getLocalPushPermission(e)),this._localPushPermission})}setPushPermission(e){this._localPushPermission=e,this._computedPushPermission=e}isSubscribed(e){return t(this,void 0,void 0,function*(){return("subscribed"===this.subscriberState||"granted"===(yield this.getComputedPushPermission(e)).permission)&&!this.isInUdr})}getId(){return this.puuid}isDismissed(){return"dismissed"===this.subscriberState}isBlocked(){return"blocked"===this.subscriberState}isEligibleToPrompt(e){return t(this,void 0,void 0,function*(){return!(yield this.isSubscribed(e))&&!this.isDismissed()&&!this.isBlocked()})}}},"./src/sdk/prompts/base.prompt.ts":function(e,s,t){"use strict";var u=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.BasePrompt=void 0;const d=t("./src/sdk/utils.ts"),i=t("./src/sdk/enums/prompt-style.enum.ts"),o=t("./src/sdk/models/events/event.model.ts"),n=t("./src/sdk/enums/event-type.enum.ts"),c=t("./src/sdk/services/user.service.ts"),l=t("./src/sdk/enums/prompt-referrer-condition.enum.ts"),r=t("./src/sdk/models/domains/global-prompt-referrer-conditions.model.ts"),p=t("./src/sdk/factories/data-provider-factory.ts"),a=t("./src/sdk/services/logging.service.ts");class h extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{constructor(e,s,t=!0){super(),this.context=e,this.settings=s,this.envSupported=t,this.userReferrerIsAllowed=!0,this.bypassEligibilityCheck=!1,t&&(a.Logger.info(`Preloading ${this.style} prompt ${this.promptId}, `+this.name),this._wireEvents())}get groupId(){return this.settings.group.id}get promptId(){return this.settings.prompt.id}get style(){return this.settings.prompt.style}get name(){let e=this.settings.group.name;return e=this.settings.prompt.name?e+" - "+this.settings.prompt.name:e}get promptConfig(){return this.settings.prompt.config||{}}get promptConditions(){return this.settings.prompt.conditions_json||{}}isNativePrompt(){return this.style===i.PromptStyle.Native}isSlidePrompt(){return this.style===i.PromptStyle.Slide}isBellPrompt(){return this.style===i.PromptStyle.Bell}get isUserSubscribed(){return this.context.user.isSubscribed(this.context)}run(e){return u(this,void 0,void 0,function*(){this.bypassEligibilityCheck=!!e&&!!e.bypassEligibilityCheck,this.userReferrerIsAllowed=yield this._evaluateCurrentReferrer()})}_attemptToShow(){return u(this,void 0,void 0,function*(){yield(0,d.delay)(Math.floor(50*Math.random()))})}_show(){return u(this,void 0,void 0,function*(){a.Logger.info(`Showing prompt ${this.promptId}, `+this.name),this.dispatch(new o.EventModel(n.EventType.PROMPT_SHOWN,this._buildDispatchEventPack())),this._incrementUserPromptCount(),yield this._setLastSeenPromptId()})}_buildDispatchEventPack(){return u(this,void 0,void 0,function*(){return{prompt:{id:this.promptId,keywords:[]},subscribed:this.isUserSubscribed}})}_buildPostEventPack(){return u(this,void 0,void 0,function*(){return{meta:{promptId:this.promptId,subscribed:yield this.isUserSubscribed}}})}_incrementUserPromptCount(){try{var e=this.isNativePrompt()||this.isSlidePrompt(),s=!!this.context.domain&&!!this.context.domain.frequencyCaps&&!!this.context.domain.frequencyCaps.prompt;if(e&&s){var t,i=this.context.domain.frequencyCaps.prompt.fcap_seconds;if(0<i){const o=this.context.user.promptCountState;let e=0,s=new Date;s.setTime(s.getTime()+1e3*i),!o||2===(t=o.split("|")).length&&(e=parseInt(t[0],10),s=t[1]),s instanceof Date&&(s=s.toUTCString()),c.UserService.setPromptState(this.context.user,i,e+1+"|"+s,s)}}}catch(e){a.Logger.warn("Encountered an error while updating prompt frequency cap",e)}}_setLastSeenPromptId(){return u(this,void 0,void 0,function*(){(yield this.isUserSubscribed)||(yield c.UserService.setLastSeenPromptId(this.context.user,this.promptId))})}_canShow(){return u(this,void 0,void 0,function*(){var e=this._isPlacementEnabled();return(yield this._isUserEligibleToPrompt())&&e})}_isPlacementEnabled(){let e=!1;var s="desktop"===this.context.env.getDeviceType(),t=this.promptConfig.position||{},i="disabled"!==t.desktop,t="disabled"!==t.mobile;return e=s&&i||!s&&t?!0:e}_isCustomOrBaseSubStateEligible(){return u(this,void 0,void 0,function*(){var e=yield this.context.user.getComputedPushPermission(this.context);return this.style===i.PromptStyle.Custom||"denied"!==e.permission})}_isUserEligibleToPrompt(){return u(this,void 0,void 0,function*(){let s=!1;if(this.bypassEligibilityCheck)s=yield this._isCustomOrBaseSubStateEligible();else{const i=this.context.user;var t=yield this.context.user.isEligibleToPrompt(this.context),t=this.isBellPrompt()||t;let e=!0;t&&(this.isNativePrompt()||this.isSlidePrompt())&&(e=this._evaluateFcapConditions()),this.userReferrerIsAllowed?t?e?s=!0:this.debugPromptNotShown(this.context,"prompt_ineligible_fcap"):i.isBlocked()?this.debugPromptNotShown(this.context,"user_permission_denied"):i.isDismissed()?this.debugPromptNotShown(this.context,"user_permission_dismissed"):(yield i.isSubscribed(this.context))?this.debugPromptNotShown(this.context,"user_permission_granted"):this.debugPromptNotShown(this.context,"user_ineligible"):this.debugPromptNotShown(this.context,"referrer_"+this.userReferrerState)}return s})}_evaluateRunConditions(){return u(this,void 0,void 0,function*(){return new Promise(l=>u(this,void 0,void 0,function*(){const i=this.promptConfig.behavior||{},o=this.promptConditions.visitor||{},n=!!o.time_on_page_seconds,t=!!o.session_page_views,r=!!o.session_time_on_site_seconds,e=new Promise(s=>u(this,void 0,void 0,function*(){if(t)if(yield this._evaluateSessionPageViewConditions())s();else{a.Logger.info(`Prompt condition: Page views [at least ${o.session_page_views} pages]`);const e=setInterval(()=>u(this,void 0,void 0,function*(){(yield this._evaluateSessionPageViewConditions())&&(clearInterval(e),s())}),1e3)}else s()})),s=new Promise(s=>u(this,void 0,void 0,function*(){if(r)if(yield this._evaluateSessionTimeOnSiteConditions())s();else{a.Logger.info(`Prompt condition: Time on site [at least ${o.session_time_on_site_seconds} seconds]`);const e=setInterval(()=>u(this,void 0,void 0,function*(){(yield this._evaluateSessionTimeOnSiteConditions())&&(clearInterval(e),s())}),1e3)}else s()})),p=new Promise(t=>u(this,void 0,void 0,function*(){var e=self._swclk_||0;let s=i.delay_seconds||0;n&&(s=o.time_on_page_seconds||0,a.Logger.info(`Prompt condition: Time on page [at least ${s} seconds]`)),(s=s>e?s-e:0)<0&&(s=0),yield(0,d.delay)(1e3*s),t()}));yield Promise.all([e.then(()=>{t&&a.Logger.info("Prompt condition: Page views [satisfied]")}),s.then(()=>{r&&a.Logger.info("Prompt condition: Time on site [satisfied]")}),p.then(()=>{n&&a.Logger.info("Prompt condition: Time on page [satisfied]")})]),l()}))})}_evaluateSessionPageViewConditions(){return u(this,void 0,void 0,function*(){const e=yield p.DataProviderFactory.getSessionDataProvider(this.context);let s=!1;var t=this.promptConditions.visitor.session_page_views,i=yield e.getCurrentTotalPageViews();return s=t<=i?!0:s})}_evaluateSessionTimeOnSiteConditions(){return u(this,void 0,void 0,function*(){const e=yield p.DataProviderFactory.getSessionDataProvider(this.context);let s=!1;var t=Date.now(),i=(yield e.getCurrentSession()).sessionStart,o=this.promptConditions.visitor.session_time_on_site_seconds;return s=o<=(t-i)/1e3?!0:s})}_evaluateFcapConditions(){let e=!0,s=0;try{var t=this.isNativePrompt()||this.isSlidePrompt(),i=!!this.context.domain&&!!this.context.domain.frequencyCaps&&!!this.context.domain.frequencyCaps.prompt;if(t)if(i){var o=this.context.domain.frequencyCaps.prompt;const l=this.context.user.promptCountState;var n=this.context.user.promptFcapSeconds;if(String(n)!==String(o.fcap_seconds))c.UserService.clearPromptFcapState();else if(l){var r=l.split("|");if(2===r.length){var p=r[1];if(((0,d.tryParseInt)(r[0])||0)>=o.occurrences){e=!1;try{s=Math.floor((Date.parse(p)-(new Date).getTime())/1e3)}catch(e){}}}}}else c.UserService.clearPromptFcapState()}catch(e){a.Logger.warn("Encountered an error while checking prompt frequency cap")}return e||a.Logger.info("Prompt frequency cap has been met"+(0<s?` - ${s} seconds remain`:"")),e}_evaluateCurrentReferrer(){return u(this,void 0,void 0,function*(){let e=!0;var s;return!0!==this.bypassEligibilityCheck&&(s=this.context.domain.globalPromptSettings)&&s.referrers&&(s=s.referrers,(s=r.GlobalPromptReferrerConditionsModel.parse(s)).enabled&&(s=yield this._evaluateReferrerConditions(s),this.userReferrerState=s.referrerResponse,e=s.pass)),e||a.Logger.info(`Based on client referrer, prompt, ${this.promptId}, is currently disabled`),e})}_evaluateReferrerConditions(r){return u(this,void 0,void 0,function*(){let e={pass:!0,referrerResponse:l.PromptReferrerCondition.ALLOW},s=this.context.env.referrer;var t=this.context.user.lastReferrerState,i=yield this._evaluateExistingReferrerState(r,t,s),t=!(s=t&&!i.updateRequired?i.referrer:s)||""===s;const o=String(s);var n=!t&&-1!==o.indexOf(this.context.domain.name);return!((e=t?h._evaluateSimpleReferrerCondition(r.when_blank,e):n?h._evaluateSimpleReferrerCondition(r.when_self,e):this._evaluateExternalReferrerConditions(r,e,s)).referrerResponse===l.PromptReferrerCondition.IGNORE)&&i.updateRequired&&(yield c.UserService.setLastReferrerState(this.context.user,o)),e})}_evaluateExistingReferrerState(i,o,n){return u(this,void 0,void 0,function*(){const e={referrer:n,updateRequired:!1};if(o&&o.lastSetAt){const t=new Date;var s=(t.getTime()-o.lastSetAt)/1e3;(i.persist_ttl_seconds||0)<s?(yield c.UserService.clearLastReferrerState(this.context.user),e.updateRequired=!0):e.referrer=o.referrer}return e})}static _evaluateSimpleReferrerCondition(e,s){const t=Object.assign({},s);switch(e){case l.PromptReferrerCondition.IGNORE:t.pass=!1,t.referrerResponse=l.PromptReferrerCondition.IGNORE;break;case l.PromptReferrerCondition.BLOCK:t.pass=!1,t.referrerResponse=l.PromptReferrerCondition.BLOCK}return t}_evaluateExternalReferrerConditions(e,s,t){const i=Object.assign({},s);let o=!0,n=!0,r=!1,p=!1;e.allowed&&(Array.isArray(e.allowed.contains)&&(n=e.allowed.contains.some(e=>-1!==t.indexOf(e))),Array.isArray(e.allowed.exact)&&(o=e.allowed.exact.some(e=>t===e))),e.blocked&&(Array.isArray(e.blocked.contains)&&(p=e.blocked.contains.some(e=>-1!==t.indexOf(e))),Array.isArray(e.blocked.exact)&&(r=e.blocked.exact.some(e=>t===e)));s=o||n,e=r||p;return s&&!e||(i.pass=!1,i.referrerResponse=l.PromptReferrerCondition.BLOCK),i}}s.BasePrompt=h},"./src/sdk/prompts/bell.prompt.ts":function(e,s,i){"use strict";var n=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},t=(Object.defineProperty(s,"__esModule",{value:!0}),s.BellPrompt=void 0,i("./src/sdk/prompts/dom.prompt.ts"));const o=i("./src/sdk/constants.ts"),r=i("./src/sdk/models/events/event.model.ts"),p=i("./src/sdk/enums/event-type.enum.ts"),l=i("./src/sdk/services/logging.service.ts"),u=i("./src/sdk/enums/bell-prompt-display-behavior.enum.ts"),d={"top-left":"d-top-left","top-right":"d-top-right","bottom-right":"d-bottom-right","bottom-left":"d-bottom-left",disabled:"d-disabled"},c={"top-left":"m-top-left","top-right":"m-top-right","bottom-right":"m-bottom-right","bottom-left":"m-bottom-left",disabled:"m-disabled"};let a=null;class h extends t.DomPrompt{constructor(){super(...arguments),this.stylesAdded=!1}_wireEvents(){var e=this._handleFlowLoaded.bind(this),s=this._handleShowPrompt.bind(this),t=this._handleHidePrompt.bind(this),i=this._handleSubscription.bind(this),o=this._handleUnsubscription.bind(this),n=[p.EventType.REGISTRATION_SUBSCRIBED,p.EventType.REGISTRATION_MIGRATED],r=[p.EventType.PERMISSION_DISMISSED,p.EventType.PERMISSION_DENIED];this.watch(p.EventType.FLOW_LOADED,e),this.watch(p.EventType.PROMPT_SHOW,s),this.watch(r,t),this.watch(n,i),this.watch(p.EventType.REGISTRATION_UNSUBSCRIBED,o)}_wireElementEvents(){var e=this._handleButtonMouseOver.bind(this),s=this._handleButtonMouseOut.bind(this),t=this._handleButtonClick.bind(this),i=this._handleWindowResize.bind(this);this.svgBtn.addEventListener("mouseover",e),this.svgBtn.addEventListener("mouseout",s),this.svgBtn.addEventListener("click",t),!0===this.promptConfig.preview_mode&&this.svgBtn.removeEventListener("click",t),this.context.env.scope.addEventListener("resize",i)}attachToDom(s){const t=Object.create(null,{attachToDom:{get:()=>super.attachToDom}});return n(this,void 0,void 0,function*(){var e;this.stylesAdded||(this.stylesAdded=!0,i("./src/sdk/styles/bell.scss")),yield t.attachToDom.call(this,s),this.parentReady&&(e=yield this._buildTemplate(),this.parent.appendChild(e),this._wireElementEvents())})}run(e={}){const s=Object.create(null,{run:{get:()=>super.run}});return n(this,void 0,void 0,function*(){yield s.run.call(this,e),(yield this._canShow())?(this.dispatch(new r.EventModel(p.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),yield this._evaluateDisplayBehavior(!!this.bypassEligibilityCheck)):this.dispatch(new r.EventModel(p.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack()))})}_attemptToShow(s=!1){return n(this,void 0,void 0,function*(){var e=this.settings.prompt.is_auto_show||s;this._isPlacementEnabled()?(yield this._canShow())&&e&&(yield this._evaluateRunConditions(),yield this._show()):l.Logger.info("Current prompt is not enabled for this placement")})}_show(){const e=Object.create(null,{_show:{get:()=>super._show}});return n(this,void 0,void 0,function*(){yield e._show.call(this)})}_buildTemplate(){return n(this,void 0,void 0,function*(){if(!this.element){const e=["pushly_bell",(yield this.isUserSubscribed)?"subscribed":"not-subscribed",this.promptConfig.managed?"managed":"non-managed",d[this.promptTheme.position.desktop],c[this.promptTheme.position.mobile]];this.element=this._createDivElement({className:e.join(" ")}),this.svgBtn=this._createSvgElement("0 0 512 512"),this.svgBtn.innerHTML=`
<circle fill="${this.promptTheme.primary_color}" cx="256" cy="256" r="255.059" />
<path fill="${this.promptTheme.accent_color}" d="M256,46.349C140.398,46.349,46.349,140.398,46.349,256c0,115.603,94.049,209.651,209.651,209.651
    c115.603,0,209.651-94.049,209.651-209.651C465.651,140.398,371.603,46.349,256,46.349z M256,450.411
    c-107.198,0-194.41-87.213-194.41-194.411c0-107.198,87.212-194.41,194.41-194.41c107.198,0,194.411,87.212,194.411,194.41
    C450.411,363.198,363.198,450.411,256,450.411z" />
<g>
    <path fill="${this.promptTheme.accent_color}" d="M341.024,293.378v-58.851c0-41.452-28.823-76.096-67.492-85.197c-0.235-10.897-9.101-19.647-20.033-19.647
        c-10.941,0-19.847,8.789-20.076,19.647c-38.669,9.101-67.495,43.745-67.495,85.197v58.851c-14.569,0-26.369,11.797-26.369,26.365
        v18.603h227.829v-18.603C367.389,305.175,355.596,293.378,341.024,293.378z" />
    <path fill="${this.promptTheme.accent_color}" d="M253.5,381.699c17.454,0,32.062-11.757,36.661-27.781h-73.376C221.393,369.942,236,381.699,253.5,381.699z" />
</g>
        `.trim(),this.tooltipContainer=this._createDivElement({className:"pushly_bell-tooltip-container"}),this.tooltipContainer.innerHTML=`
<div class="pushly_bell-tooltip pushly_bell-tooltip-subscribed" ${this.promptTheme.tooltip.subscribed?"":'style="display: none;"'}>
    <div class="pushly_bell-tooltip-arrow" style="background-color: ${this.promptTheme.primary_color};"></div>
    <div class="pushly_bell-tooltip-text" style="background-color: ${this.promptTheme.primary_color}; color: ${this.promptTheme.accent_color};">${this.promptTheme.tooltip.subscribed}</div>
</div>
<div class="pushly_bell-tooltip pushly_bell-tooltip-notsubscribed" ${this.promptTheme.tooltip.unsubscribed?"":'style="display: none;"'}>
    <div class="pushly_bell-tooltip-arrow" style="background-color: ${this.promptTheme.primary_color};"></div>
    <div class="pushly_bell-tooltip-text" style="background-color: ${this.promptTheme.primary_color}; color: ${this.promptTheme.accent_color};">${this.promptTheme.tooltip.unsubscribed}</div>
</div>
        `.trim(),this.element.appendChild(this.svgBtn),this.element.appendChild(this.tooltipContainer),this._updateSize()}return this.element})}_updateSize(){let e=this.promptTheme.size;this.context.env.scope.innerWidth<o.MOBILE_MAX_SIZE&&this.promptTheme.mobile_size&&(e=this.promptTheme.mobile_size),this.svgBtn.setAttribute("height",e),this.svgBtn.style.height=e,this.svgBtn.setAttribute("width",e),this.svgBtn.style.width=e}_handleFlowLoaded(){return n(this,void 0,void 0,function*(){yield this.run()})}_handleShowPrompt(){return n(this,void 0,void 0,function*(){this.context.app.loadConfig.manualPromptMode||this.element.classList.contains(o.DEFAULT_CLASSNAME_PROMPT_VISIBLE)||(yield this._evaluateDisplayBehavior(!0))})}_handleHidePrompt(){return n(this,void 0,void 0,function*(){yield this._hide()})}_handleSubscription(){return n(this,void 0,void 0,function*(){return this.element.classList.add("subscribed"),this._evaluateDisplayBehavior()})}_handleUnsubscription(){return n(this,void 0,void 0,function*(){return this.element.classList.remove("subscribed"),this._evaluateDisplayBehavior()})}_evaluateDisplayBehavior(o=!1){return n(this,void 0,void 0,function*(){var e,s,t=yield this.isUserSubscribed,i=this.promptConfig.behavior;i&&(e=i.display_behavior===u.BellPromptDisplayBehavior.PRE_SUBSCRIPTION,s=i.display_behavior===u.BellPromptDisplayBehavior.POST_SUBSCRIPTION,i.display_behavior===u.BellPromptDisplayBehavior.ALWAYS?(l.Logger.info("Bell prompt display mode: always.","User Subscribed: "+(t?"true":"false")),yield this._attemptToShow()):e?(l.Logger.info("Bell prompt display mode: pre-subscription.","User Subscribed: "+(t?"true":"false")),t?yield this._hide():yield this._attemptToShow(o)):s&&(l.Logger.info("Bell prompt display mode: post-subscription.","User Subscribed: "+(t?"true":"false")),t?yield this._attemptToShow(o):yield this._hide()))})}_handleButtonClick(){return n(this,void 0,void 0,function*(){(yield this.isUserSubscribed)||(yield this._allow())})}_handleButtonMouseOver(){return n(this,void 0,void 0,function*(){this.element.classList.add("hover")})}_handleButtonMouseOut(){return n(this,void 0,void 0,function*(){this.element.classList.remove("hover")})}_handleWindowResize(){return n(this,void 0,void 0,function*(){a&&clearTimeout(a),a=setTimeout(()=>{a=null,this._updateSize()},50)})}}s.BellPrompt=h},"./src/sdk/prompts/custom.prompt.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.CustomPrompt=void 0,t("./src/sdk/prompts/dom.prompt.ts"));const n=t("./src/sdk/constants.ts"),r=t("./src/sdk/models/events/event.model.ts"),p=t("./src/sdk/enums/event-type.enum.ts"),l=t("./src/sdk/services/logging.service.ts");class u extends o.DomPrompt{constructor(){super(...arguments),this.allowBtns=[],this.dismissBtns=[]}_wireEvents(){var e=this._handleShowPrompt.bind(this),s=this._handlePermissionGranted.bind(this),t=this._handlePermissionDismissed.bind(this),i=this._handlePermissionDenied.bind(this),o=[p.EventType.REGISTRATION_SUBSCRIBED,p.EventType.REGISTRATION_MIGRATED,p.EventType.PERMISSION_GRANTED,p.EventType.FOLLOWED],n=[p.EventType.PROMPT_DISMISSED,p.EventType.PERMISSION_DISMISSED],r=[p.EventType.PERMISSION_DENIED];this.watch(p.EventType.PROMPT_SHOW,e),this.watch(o,s),this.watch(n,t),this.watch(r,i)}_locateAndAssignElement(){const s=setInterval(()=>i(this,void 0,void 0,function*(){var e=this.parent.getElementsByClassName(n.DEFAULT_CLASSNAME_PROMPT_CUSTOM);e&&0<e.length&&(clearInterval(s),this.element=e[0],this.envSupported?(this._setSupportedClassname(),yield this._setInitialSubscriptionClassname(),this._resolveKeywords(),this._assignButtonElements()):this._setUnsupportedClassname())}),500)}attachToDom(){const e=Object.create(null,{attachToDom:{get:()=>super.attachToDom}});return i(this,void 0,void 0,function*(){yield e.attachToDom.call(this),yield this._locateAndAssignElement()})}runInUnsupportedMode(){return i(this,void 0,void 0,function*(){yield this.attachToDom()})}_run(){return i(this,void 0,void 0,function*(){l.Logger.info("Custom prompt ready"),(yield this._isUserEligibleToPrompt())?(this._setEligibleClassnames(),this.dispatch(new r.EventModel(p.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack()))):(this._setIneligibleClassnames(),this.dispatch(new r.EventModel(p.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())))})}_attemptToShow(e=0){return i(this,void 0,void 0,function*(){this.bypassEligibilityCheck&&this._setEligibleClassnames(),(yield this._isUserEligibleToPrompt())?this._setEligibleClassnames():this._setIneligibleClassnames()})}_show(){return i(this,void 0,void 0,function*(){})}_assignButtonElements(){return i(this,void 0,void 0,function*(){var e=this.element.getElementsByClassName(n.DEFAULT_CLASSNAME_PROMPT_BTN_ALLOW),s=this.element.getElementsByClassName(n.DEFAULT_CLASSNAME_PROMPT_BTN_DISMISS);e&&0<e.length?Array.from(e).forEach(e=>{e.addEventListener("click",this._allow.bind(this)),this.allowBtns.push(e)}):l.Logger.warn("Prompt allow button cannot be located"),s&&0<s.length?Array.from(s).forEach(e=>{e.addEventListener("click",this._dismiss.bind(this)),this.dismissBtns.push(e)}):l.Logger.warn("Prompt dismiss button cannot be located"),yield this._run()})}_getConfigClassNames(){const e=this.context.app.classNames||{};return e.webPushUnsupported=e.webPushUnsupported||n.DEFAULT_CLASSNAME_WEB_PUSH_UNSUPPORTED,e.webPushSupported=e.webPushSupported||n.DEFAULT_CLASSNAME_WEB_PUSH_SUPPORTED,e.subscriptionNone=e.subscriptionNone||n.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE,e.subscriptionSubscribed=e.subscriptionSubscribed||n.DEFAULT_CLASSNAME_SUBSCRIPTION_TRUE,e.subscriptionUnsubscribed=e.subscriptionUnsubscribed||n.DEFAULT_CLASSNAME_SUBSCRIPTION_FALSE,e.subscriptionDenied=e.subscriptionDenied||n.DEFAULT_CLASSNAME_SUBSCRIPTION_DENIED,e.subscriptionDismissed=e.subscriptionDismissed||n.DEFAULT_CLASSNAME_SUBSCRIPTION_DISMISSED,e.promptIneligible=e.promptIneligible||n.DEFAULT_CLASSNAME_PROMPT_INELIGIBLE,e.promptEligible=e.promptEligible||n.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE,e}_setInitialSubscriptionClassname(){return i(this,void 0,void 0,function*(){this.context.user.isBlocked()?this._setDeniedClassnames():this.context.user.isDismissed()?this._setDismissedClassnames():(yield this.isUserSubscribed)?this._setSubscribedClassnames():this._setNoSubscriptionClassnames()})}_setPromptCompositeSubscribedClassnames(){this._setIneligibleClassnames(),this._setSubscribedClassnames(),this.element.classList.remove(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_setSubscriptionDismissedClassnames(){this._setIneligibleClassnames(),this._setDismissedClassnames(),this.element.classList.remove(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_setSubscriptionDeniedClassnames(){this._setIneligibleClassnames(),this._setDeniedClassnames(),this.element.classList.remove(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_setUnsupportedClassname(){var e=this._getConfigClassNames();this.element.classList.add(e.webPushUnsupported),this.element.classList.remove(e.webPushSupported)}_setSupportedClassname(){var e=this._getConfigClassNames();this.element.classList.add(e.webPushSupported),this.element.classList.remove(e.webPushUnsupported)}_setEligibleClassnames(){var e=this._getConfigClassNames();this.element.classList.remove(e.promptIneligible),this.element.classList.add(e.promptEligible)}_setIneligibleClassnames(){var e=this._getConfigClassNames();this.element.classList.remove(e.promptEligible),this.element.classList.add(e.promptIneligible)}_setNoSubscriptionClassnames(){var e=this._getConfigClassNames();this.element.classList.add(e.subscriptionNone),this.element.classList.remove(e.subscriptionSubscribed,e.subscriptionDismissed,e.subscriptionDenied,e.subscriptionUnsubscribed)}_setSubscribedClassnames(){var e=this._getConfigClassNames();this.element.classList.add(e.subscriptionSubscribed),this.element.classList.remove(e.subscriptionNone,e.subscriptionDismissed,e.subscriptionDenied,e.subscriptionUnsubscribed)}_setDismissedClassnames(){var e=this._getConfigClassNames();this.element.classList.add(e.subscriptionDismissed),this.element.classList.remove(e.subscriptionNone,e.subscriptionSubscribed,e.subscriptionDenied,e.subscriptionUnsubscribed)}_setDeniedClassnames(){var e=this._getConfigClassNames();this.element.classList.add(e.subscriptionDenied),this.element.classList.remove(e.subscriptionNone,e.subscriptionSubscribed,e.subscriptionDismissed,e.subscriptionUnsubscribed)}_handleShowPrompt(){return i(this,void 0,void 0,function*(){var e;this.context.app.loadConfig.manualPromptMode||(e=yield this._isUserEligibleToPrompt(),!this.element.classList.contains(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)&&e&&(yield this._attemptToShow(!0)))})}_handlePermissionGranted(){return i(this,void 0,void 0,function*(){this._setPromptCompositeSubscribedClassnames(),yield this._hide()})}_handlePermissionDismissed(){return i(this,void 0,void 0,function*(){this._setSubscriptionDismissedClassnames(),yield this._hide()})}_handlePermissionDenied(){return i(this,void 0,void 0,function*(){this._setSubscriptionDeniedClassnames(),yield this._hide()})}}s.CustomPrompt=u},"./src/sdk/prompts/dom.prompt.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.DomPrompt=void 0,t("./src/sdk/prompts/base.prompt.ts"));const n=t("./src/sdk/constants.ts"),r=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/enums/prompt-style.enum.ts"),u=t("./src/sdk/enums/steamable-event-type.enum.ts"),d=t("./src/sdk/enums/event-type.enum.ts"),c=t("./src/sdk/services/user.service.ts"),a=t("./src/sdk/services/logging.service.ts"),h=t("./src/sdk/utils.ts");let m=0;class v extends o.BasePrompt{constructor(e,s,t=!0){super(e,s,t),this.parentReady=!1,this._handlePromptAllowedError=e=>i(this,void 0,void 0,function*(){/prompting has been disabled/i.test(String(e))&&this.dispatch(new p.EventModel(d.EventType.PROMPT_DISABLED,yield this._buildDispatchEventPack(),this.context,this,{message:e}))}),t&&this._wireRenderEvent()}_wireRenderEvent(){var e=this._handleFlowLoadedRender.bind(this);this.watchOnce(d.EventType.FLOW_LOADED,e)}get promptTheme(){return this.promptConfig.theme||{}}attachToDom(s){return i(this,void 0,void 0,function*(){var e;this.element||(e=this.context.env.document.body,this.parent=s||e,this.parent?this.parentReady=!0:m<5?(a.Logger.info(`Prompt parent element, ${String(this.parent)}, could not be resolved. Attempts: `+m),m++,yield(0,h.delay)(100*m*2),yield this.attachToDom(s)):a.Logger.warn(`Prompt parent element, ${String(this.parent)}, unavailable`))})}_canShow(){const s=Object.create(null,{_canShow:{get:()=>super._canShow}});return i(this,void 0,void 0,function*(){var e=yield s._canShow.call(this);return!!this.element&&e})}_show(){return i(this,void 0,void 0,function*(){a.Logger.info(`Showing prompt ${this.promptId}, `+this.name),this._incrementUserPromptCount(),yield this._setLastSeenPromptId(),this._addVisibleClassName();const e=yield this._buildPostEventPack();this._hasKeywords()&&(e.meta.keywords=this.keywords),(yield this.isUserSubscribed)?this.style===l.PromptStyle.Custom&&(this.dispatch(new p.EventModel(d.EventType.FOLLOW_SHOWN,yield this._buildDispatchEventPack())),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.FOLLOW_SHOWN,e,this.context))):(this.dispatch(new p.EventModel(d.EventType.PROMPT_SHOWN,yield this._buildDispatchEventPack())),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.PROMPT_SHOWN,e,this.context)))})}_hide(){return i(this,void 0,void 0,function*(){this._removeVisibleClassName(),this.dispatch(new p.EventModel(d.EventType.PROMPT_HIDE,yield this._buildDispatchEventPack()))})}_allow(e){return i(this,void 0,void 0,function*(){const e=yield this._buildPostEventPack();this._hasKeywords()&&(e.meta.keywords=this.keywords),(yield this.isUserSubscribed)?this.style===l.PromptStyle.Custom&&(this.dispatch(new p.EventModel(d.EventType.FOLLOWED,this._buildDispatchEventPack())),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.FOLLOWED,e,this.context))):(this.dispatch(new p.EventModel(d.EventType.PROMPT_ALLOWED,this._buildDispatchEventPack(),this.context,this)).catch(this._handlePromptAllowedError),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.PROMPT_ALLOWED,e,this.context)))})}_dismiss(e){return i(this,void 0,void 0,function*(){yield this._hide(),this.dispatch(new p.EventModel(d.EventType.PROMPT_DISMISSED,this._buildDispatchEventPack())),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.PROMPT_DISMISSED,yield this._buildPostEventPack(),this.context)),yield c.UserService.setPromptDismissed(this.context.user,this)})}_addVisibleClassName(){this.element&&this.element.classList.add(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_removeVisibleClassName(){this.element&&this.element.classList.remove(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_resolveKeywords(){try{if(this.element){const s=(this.element.dataset||{}).keywords||"";if(""!==s.trim()){const t=s.toString().split(",");var e=t.map(e=>e.toString().trim());this.keywords=[...Array.from(new Set(e))]}}}catch(e){a.Logger.warn("Could not resolve prompt keywords - "+e.message)}}_hasKeywords(){return!!this.keywords&&Array.isArray(this.keywords)&&0<this.keywords.length}_buildDispatchEventPack(){const s=Object.create(null,{_buildDispatchEventPack:{get:()=>super._buildDispatchEventPack}});return i(this,void 0,void 0,function*(){const e=yield s._buildDispatchEventPack.call(this);return e.keywords=this.keywords||[],e})}_handleFlowLoadedRender(){return i(this,void 0,void 0,function*(){"none"===this.context.user.subscriberState&&(yield this.attachToDom())})}_createDivElement(e={}){return this._createDomElement("div",e)}_createButtonElement(e={}){return this._createDomElement("button",e)}_createImgElement(e,s){const t=this._createDomElement("img");return e&&(t.src=e),s&&(t.alt=s),t}_createSvgElement(e){const s=this.context.env.document.createElementNS("http://www.w3.org/2000/svg","svg");return s.setAttribute("viewBox",e),s}_createDomElement(e,s={}){const t=this.context.env.document.createElement(e);return s.className&&t.setAttribute("class",s.className),s.style&&t.setAttribute("style",s.style),s.innerText&&(t.innerText=s.innerText),t}}s.DomPrompt=v},"./src/sdk/prompts/native.prompt.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},o=(Object.defineProperty(s,"__esModule",{value:!0}),s.NativePrompt=void 0,t("./src/sdk/prompts/base.prompt.ts"));const n=t("./src/sdk/models/events/event.model.ts"),r=t("./src/sdk/enums/exception-message.enum.ts"),p=t("./src/sdk/enums/runtime-environment.enum.ts"),l=t("./src/sdk/enums/event-type.enum.ts"),u=t("./src/sdk/services/logging.service.ts"),d=t("./src/sdk/enums/integration-type.enum.ts"),c=t("./src/sdk/exceptions/fail.exception.ts");class a extends o.BasePrompt{constructor(){super(...arguments),this.shown=!1}_wireEvents(){var e=this._handleFlowLoaded.bind(this),s=this._handleShowPrompt.bind(this);this.watch(l.EventType.FLOW_LOADED,e),this.watch(l.EventType.PROMPT_SHOW,s)}_handleFlowLoaded(){return i(this,void 0,void 0,function*(){yield this.run()})}_handleShowPrompt(){return i(this,void 0,void 0,function*(){this.context.app.loadConfig.manualPromptMode||(yield this._attemptToShow(!0))})}run(e={}){const s=Object.create(null,{run:{get:()=>super.run}});return i(this,void 0,void 0,function*(){this.shown||(yield s.run.call(this,e),this._runMixedIntegrationCheck(),(yield this._canShow())?(this.dispatch(new n.EventModel(l.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),yield this._attemptToShow(!!e.bypassEligibilityCheck)):this.dispatch(new n.EventModel(l.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())))})}_canShow(){const t=Object.create(null,{_canShow:{get:()=>super._canShow}});return i(this,void 0,void 0,function*(){var e=yield t._canShow.call(this),s=(yield this.context.user.getComputedPushPermission(this.context)).subscription;return e&&!s||u.Logger.debug("Native prompt cannot show due to current subscription state."),e&&!s})}_attemptToShow(s=!1){const t=Object.create(null,{_attemptToShow:{get:()=>super._attemptToShow}});return i(this,void 0,void 0,function*(){var e;yield t._attemptToShow.call(this),this.shown||(e=this.settings.prompt.is_auto_show||s,this._isPlacementEnabled()?(yield this._canShow())&&e&&(yield this._evaluateRunConditions(),(yield this._canShow())&&(yield this._show())):u.Logger.info("Current prompt is not enabled for this placement"))})}_show(){const e=Object.create(null,{_show:{get:()=>super._show}});return i(this,void 0,void 0,function*(){this.shown||(yield e._show.call(this),this.shown=!0,yield this.dispatch(new n.EventModel(l.EventType.PROMPT_ALLOWED,this._buildDispatchEventPack(),this.context,this)))})}_runMixedIntegrationCheck(){var e=this.context.domain.integrationType;if(this.context.env.primaryRuntimeEnvironment===p.RuntimeEnvironment.DIRECT&&e===d.IntegrationType.PROXY)throw this.debugPromptNotShown(this.context,"mixed_integration"),new c.FailException(null,r.ExceptionMessage.MIXED_INTEGRATION)}}s.NativePrompt=a},"./src/sdk/prompts/slide.prompt.ts":function(e,s,n){"use strict";var r=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})},t=(Object.defineProperty(s,"__esModule",{value:!0}),s.SlidePrompt=void 0,n("./src/sdk/prompts/dom.prompt.ts"));const i=n("./src/sdk/constants.ts"),o=n("./src/sdk/models/events/event.model.ts"),p=n("./src/sdk/enums/event-type.enum.ts"),l=n("./src/sdk/services/logging.service.ts"),u={top:"d-top",bottom:"d-bottom",disabled:"d-disabled"},d={top:"m-top",bottom:"m-bottom",disabled:"m-disabled"};class c extends t.DomPrompt{constructor(){super(...arguments),this.shown=!1,this.stylesAdded=!1}get promptImage(){return this.promptTheme.image}_wireEvents(){var e=this._handleFlowLoaded.bind(this),s=this._handlePromptHide.bind(this),t=this._handleShowPrompt.bind(this),i=[p.EventType.PROMPT_ALLOWED,p.EventType.PROMPT_DISMISSED,p.EventType.PERMISSION_DIALOG_SHOWN,p.EventType.PERMISSION_DENIED,p.EventType.REGISTRATION_SUBSCRIBED,p.EventType.REGISTRATION_MIGRATED];this.watch(p.EventType.FLOW_LOADED,e),this.watch(i,s),this.watch(p.EventType.PROMPT_SHOW,t)}_handleFlowLoaded(){return r(this,void 0,void 0,function*(){yield this.run()})}_handlePromptHide(){return r(this,void 0,void 0,function*(){yield this._hide(),this.element.remove()})}_handleShowPrompt(){return r(this,void 0,void 0,function*(){this.context.app.loadConfig.manualPromptMode||this.element&&!this.element.classList.contains(i.DEFAULT_CLASSNAME_PROMPT_VISIBLE)&&(yield this._attemptToShow(!0))})}_wireElementEvents(){this.allowBtn.addEventListener("click",this._allow.bind(this)),this.dismissBtn.addEventListener("click",this._dismiss.bind(this))}attachToDom(i){const o=Object.create(null,{attachToDom:{get:()=>super.attachToDom}});return r(this,void 0,void 0,function*(){if(this.stylesAdded||(this.stylesAdded=!0,n("./src/sdk/styles/popover.scss")),yield o.attachToDom.call(this,i),this.parentReady){var e=this._buildTemplate();const s=["pushly_popover","pushly-prompt-window",this.promptTheme.layout||"normal",this.promptConfig.managed?"managed":"non-managed",u[this.promptTheme.position.desktop],d[this.promptTheme.position.mobile]],t=this.element=this._createDivElement({className:s.join(" "),style:"z-index: 999999999"});t.appendChild(e),this.element&&this.parent.appendChild(this.element),this._wireElementEvents()}})}_buildTemplate(){const e=this._createDivElement({className:"pushly_popover-box pushly-prompt-slide",style:"background-color: "+this.promptTheme.background_color}),s=this._createDivElement({className:"pushly_popover-first pushly-prompt-icon"});e.appendChild(s),this.promptImage?(o=this._createImgElement(this.promptImage,this.context.domain.name+" Logo"),s.appendChild(o)):s.style.display="none";const t=this._createDivElement({className:"pushly_popover-second pushly-prompt-content"}),i=(e.appendChild(t),this._createDivElement({className:"pushly_popover-message pushly-prompt-message"}));t.appendChild(i);var o=this._createDivElement({className:"pushly_popover-message-headline pushly-prompt-message-headline",style:"color: "+this.promptTheme.title.text_color,innerText:this.promptTheme.title.text}),o=(i.appendChild(o),this._createDivElement({className:"pushly_popover-message-headline pushly-prompt-message-headline",style:"color: "+this.promptTheme.subtitle.text_color,innerText:this.promptTheme.subtitle.text}));i.appendChild(o);const n=this._createDivElement({className:"pushly_popover-buttons pushly-prompt-actions"});return t.appendChild(n),this.dismissBtn=this._createButtonElement({className:"pushly_popover-buttons-dismiss pushly-prompt-buttons-dismiss",style:`color: ${this.promptTheme.dismiss_button.text_color}; background-color: ${this.promptTheme.dismiss_button.background_color};`,innerText:this.promptTheme.dismiss_button.text}),n.appendChild(this.dismissBtn),this.allowBtn=this._createButtonElement({className:"pushly_popover-buttons-allow pushly-prompt-buttons-allow",style:`color: ${this.promptTheme.allow_button.text_color}; background-color: ${this.promptTheme.allow_button.background_color};`,innerText:this.promptTheme.allow_button.text}),n.appendChild(this.allowBtn),e}run(e={}){const s=Object.create(null,{run:{get:()=>super.run}});return r(this,void 0,void 0,function*(){this.shown||(yield s.run.call(this,e),(yield this._canShow())?(this.dispatch(new o.EventModel(p.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),yield this._attemptToShow(!!e.bypassEligibilityCheck)):this.dispatch(new o.EventModel(p.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())))})}_attemptToShow(s=!1){const t=Object.create(null,{_attemptToShow:{get:()=>super._attemptToShow}});return r(this,void 0,void 0,function*(){var e;yield t._attemptToShow.call(this),this.shown||(e=this.settings.prompt.is_auto_show||s,this._isPlacementEnabled()?(yield this._canShow())&&e&&(yield this._evaluateRunConditions(),yield this._show()):l.Logger.info("Current prompt is not enabled for this placement"))})}_show(){const e=Object.create(null,{_show:{get:()=>super._show}});return r(this,void 0,void 0,function*(){this.shown||(yield e._show.call(this),this.shown=!0)})}}s.SlidePrompt=c},"./src/sdk/repositories/application.repository.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.ApplicationRepository=void 0;const o=t("./src/sdk/utils.ts"),n=t("./src/sdk/data-providers/cookie.data-provider.ts"),r=t("./src/sdk/services/logging.service.ts"),p=t("./src/sdk/models/application/app.model.ts");s.ApplicationRepository=class{static get(){return i(this,void 0,void 0,function*(){let e=new p.AppModel;return r.Logger.info("Data mode: CDM"),e.isVisibleLoggingEnabled=(0,o.tryParseJSON)(yield n.CookieDataProvider.getmv("_pnvl",!1,"pushly.app_visibleLogs")),this.removeDeprecatedCookies(),e})}static set(e){return i(this,void 0,void 0,function*(){return yield n.CookieDataProvider.set("_pnvl",!0===e.isVisibleLoggingEnabled),this})}static purgeCookies(){return i(this,void 0,void 0,function*(){yield this.removeDeprecatedCookies();for(const e of["_pnvl","_pndbg","_pndbgpr"])(yield n.CookieDataProvider.has(e))&&(yield n.CookieDataProvider.clear(e))})}static removeDeprecatedCookies(){return i(this,void 0,void 0,function*(){for(const e of["pushly.app_env","pushly.app_version","pushly.app_workerVersion","pushly_view_logs"])(yield n.CookieDataProvider.has(e))&&(yield n.CookieDataProvider.clear(e))})}}},"./src/sdk/repositories/domain.repository.ts":function(e,s,t){"use strict";var o=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.DomainRepository=void 0;const n=t("./src/common/data-providers/api.data-provider.ts"),r=t("./src/sdk/constants.ts"),p=t("./src/sdk/models/domains/domain.model.ts"),l=t("./src/sdk/exceptions/domain-load.exception.ts"),u=t("./src/sdk/services/logging.service.ts");class i extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{static get(i){return o(this,void 0,void 0,function*(){var s;const t=new p.DomainModel;Object.assign(t,{}),u.Logger.info("Updating domain cache");try{let e=r.INJECTED_DOMAIN_SETTINGS;(e=!r.DOMAIN_SETTINGS_INJECTION_FAILED.test(e)&&"domain"in e?e:yield n.ApiDataProvider.get(r.SETTINGS_ENDPOINT+"/"+i))&&(s=e.domain,t.id=s.id,t.name=s.name,t.domainKey=i,t.senderId=s.sender_id,t.customAllowDomain=s.custom_allow_domain,t.frequencyCaps=s.frequency_caps,t.globalPromptSettings=s.global_prompt_settings,t.integrationType=s.integration_type,t.whitelistDomains=s.whitelist_domains,t.sdkEventOnlyDomains=s.sdk_event_only_domains,t.apnsConfiguration=s.apns_configuration,t.flags=s.flags||t.flags||[],t.vapidPublicKey=s.vapid_public_key,t.additionalSubscriptionData=s.additional_subscription_data,t.promptGroups=e.prompt_groups,t.prompts=e.prompts)}catch(e){throw u.Logger.warn("Unable to load remote domain settings.",e),this.debugPromptNotShown({domainKey:i},"load_failed"),new l.DomainLoadException(e)}return t})}}s.DomainRepository=i},"./src/sdk/repositories/subscription.repository.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.SubscriptionRepository=void 0;const o=t("./src/_utils/service-worker-registration.ts");class n extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{static unregister(t){return i(this,void 0,void 0,function*(){let s=!0;try{const e=yield(0,o.getPushlyServiceWorkerRegistration)(t);e&&(s=yield e.unregister())}catch(e){s=!1}return s})}}s.SubscriptionRepository=n},"./src/sdk/repositories/user.repository.ts":function(e,s,t){"use strict";var r=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.UserRepository=void 0;const p=t("./src/sdk/constants.ts"),l=t("./src/sdk/data-providers/cookie.data-provider.ts"),u=t("./src/sdk/prompts/base.prompt.ts"),i=t("./src/sdk/models/users/user.model.ts");s.UserRepository=class{static get(){return r(this,void 0,void 0,function*(){let e={};return e.puuid=e.puuid||l.CookieDataProvider.get("pushly.user_puuid"),e.externalId=e.externalId||l.CookieDataProvider.getmv("_pnxd",null,"pushly.user_externalId"),e.subscriberState=e.subscriberState||l.CookieDataProvider.getmv("_pnss",null,"pushly.user_subscriberState"),e.lastSeenPromptId=e.lastSeenPromptId||l.CookieDataProvider.getmv("_pnlspid",null,"pushly.user_lastSeenPromptId"),"subscribed"===e.subscriberState&&(e.token=e.token||l.CookieDataProvider.getmv("_pntx",null,"pushly.user_token")),e.promptFcapSeconds=l.CookieDataProvider.getmv("_pnfcps",null,"pushly.user_promptFcapSeconds"),e.promptCountState=l.CookieDataProvider.getmv("_pnpcs",null,"pushly.user_promptCountState"),this.removeDeprecatedCookies(),i.UserModel.of(e)})}static set(e){return r(this,void 0,void 0,function*(){return l.CookieDataProvider.set("pushly.user_puuid",e.puuid),l.CookieDataProvider.set("_pnxd",e.externalId),l.CookieDataProvider.set("_pnss",e.subscriberState),l.CookieDataProvider.set("_pnlspid",e.lastSeenPromptId),e.token?l.CookieDataProvider.set("_pntx",e.token):l.CookieDataProvider.clear("_pntx"),this})}static getWithCachePriority(){return r(this,void 0,void 0,function*(){let e={};return e.puuid=l.CookieDataProvider.get("pushly.user_puuid")||e.puuid,e.subscriberState=l.CookieDataProvider.getmv("_pnss",null,"pushly.user_subscriberState")||e.subscriberState,e.lastSeenPromptId=l.CookieDataProvider.getmv("_pnlspid",null,"pushly.user_lastSeenPromptId")||e.lastSeenPromptId,"subscribed"===e.subscriberState&&(e.token=l.CookieDataProvider.getmv("_pntx",null,"pushly.user_token")||e.token),e.promptFcapSeconds=l.CookieDataProvider.getmv("_pnfcps",null,"pushly.user_promptFcapSeconds"),e.promptCountState=l.CookieDataProvider.getmv("_pnpcs",null,"pushly.user_promptCountState"),i.UserModel.of(e)})}static setPromptState(t,i){return r(this,void 0,void 0,function*(){var{promptFcapSeconds:e,promptCountState:s}=t;return l.CookieDataProvider.setWithRawExpires("_pnfcps",e,i),l.CookieDataProvider.setWithRawExpires("_pnpcs",s,i),this})}static clearPromptState(){return r(this,void 0,void 0,function*(){return l.CookieDataProvider.clear("_pnfcps"),l.CookieDataProvider.clear("_pnpcs"),this})}static setPromptDismissedState(o,n){return r(this,void 0,void 0,function*(){let e=p.PUSHLY_PROMPT_DISMISSED_COOKIE_TIMEOUT,s="d",t={};var i;return"cookie_length_seconds"in(t=n instanceof u.BasePrompt?n.promptConfig.behavior||{}:n.promptBehavior||{})&&(null!=(i=t.cookie_length_seconds)&&(e=i,s="s")),0!==e?(o.subscriberState="dismissed",l.CookieDataProvider.set("_pnpdm",!0,e,s)):o.subscriberState="none",yield this.set(o),self})}static getPromptDismissedState(){return r(this,void 0,void 0,function*(){var e=l.CookieDataProvider.getmv("_pnpdm",!1,"pushly.prompt_dismissed");return"true"===e||!0===e})}static purgeCookies(){this.removeDeprecatedCookies();["pushly.user_puuid","_pnss","_pnlspid","_pnupf","_pntx","_pnfcps","_pnpcs","_pnpdm"].forEach(e=>{l.CookieDataProvider.has(e)&&l.CookieDataProvider.clear(e)})}static removeDeprecatedCookies(){["pushly.user_createdAt","pushly.user_updatedAt","pushly.user_profile","pushly.user_lifetimeViewedKeywordMap","pushly_uqid","pushly_uqid_timestamp","pushly_subscriber_data_updated_at","pushly_do_not_track","pushly_apns_token","pushly_fcm_token","pushly_subscribed","_pndnt","_dor","_pnupf"].forEach(e=>{l.CookieDataProvider.has(e)&&l.CookieDataProvider.clear(e)})}}},"./src/sdk/sdk.ts":function(e,s,t){"use strict";var o=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.SDK=void 0;const u=t("./src/sdk/enums/event-type.enum.ts"),n=t("./src/sdk/services/logging.service.ts"),i=t("./src/_utils/validate-only-instance-of-sdk.ts"),r=t("./src/sdk/services/user-debug.service.ts"),p=t("./src/sdk/enums/steamable-event-type.enum.ts"),l=t("./src/sdk/enums/consent.enum.ts"),d=t("./src/sdk/constants.ts"),c=t("./src/sdk/factories/data-provider-factory.ts"),a=t("./src/sdk/exceptions/exit.exception.ts"),h=t("./src/sdk/exceptions/fail.exception.ts"),m=t("./src/sdk/services/flow.service.ts"),v=t("./src/_utils/consent.ts"),y=t("./src/sdk/services/prompt.service.ts"),f=t("./src/sdk/exceptions/pushly.exception.ts"),_=t("./src/sdk/data-providers/cookie.data-provider.ts"),b=t("./src/sdk/services/app.service.ts"),g=t("./src/sdk/enums/runtime-environment.enum.ts"),w=t("./src/sdk/services/user.service.ts"),A=t("./src/sdk/services/domain.service.ts"),k=t("./src/sdk/exceptions/domain-load.exception.ts"),x=t("./src/sdk/cross-frame-messenger/messenger-server.ts"),E=t("./src/sdk/services/registration.service.ts");var I=t("./src/sdk/models/events/eventable.model.ts");const P=t("./src/sdk/models/events/event.model.ts"),S=t("./src/sdk/enums/exception-message.enum.ts"),C=t("./src/sdk/exceptions/invalid-event.exception.ts"),O=t("./src/sdk/services/environment.service.ts"),j=t("./src/sdk/exceptions/worker-registration.exception.ts"),M=t("./src/sdk/utils.ts"),D=t("./src/_utils/interval-runner.ts");class B extends I.EventableModel{constructor(e){super(),this.context=e,this.iid=(0,M.randomString)(),this._swsts_=Date.now(),this._swclk_=0,(this._swclkInitialized_=!1,i.validateOnlyInstanceOfSdk)(this),this.t(),this.p()}push(i){return o(this,void 0,void 0,function*(){let e=i[0];const s=/^on_/i;try{var t;s.test(e)?(e=e.replace(s,""),this.watch(e,i[1])):(t=new P.EventModel(e,i[1]),yield this.dispatch(t))}catch(e){if(!(e instanceof C.InvalidEventException))throw e;n.Logger.warn(e.message)}})}on(e,s){return o(this,void 0,void 0,function*(){yield this.push(["on_"+e,s])})}trigger(e,s){return o(this,void 0,void 0,function*(){yield this.push([e,s])})}showLogs(e=!0){return o(this,void 0,void 0,function*(){this.context.app.isVisibleLoggingEnabled=!!e,yield b.AppService.saveApp(this.context.app),n.Logger.setVisibleLogsEnabled(e)})}getLogs(){return n.Logger.logs}load(e,s=!1){return o(this,void 0,void 0,function*(){try{yield this.l(e,s)}catch(e){let s=!1;e&&(e instanceof h.FailException||e instanceof k.DomainLoadException||e instanceof j.WorkerRegistrationException?(s=!0,n.Logger.error(this.context,e)):(e instanceof f.PushlyException||e&&e.isPushlyException)&&(s=!0,n.Logger.warn(e.message)),(e instanceof j.WorkerRegistrationException||e instanceof k.DomainLoadException||"object"==typeof e&&"message"in e&&e.message===S.ExceptionMessage.HOST_NOT_WHITELISTED)&&this.dispatch(new P.EventModel(u.EventType.APPLICATION_ERROR,{message:e.message}))),s||(yield this.u(e))}})}requestNotificationPermission(e=0,s){return o(this,void 0,void 0,function*(){if(!this.context.domain.isEventOnlyMode())return E.RegistrationService.performManualRegistrationAttempt(this.context,e,s);n.Logger.warn("Requesting notification permission is not available while in event only mode.")})}getUser(){return this.context.user}isUserSoftUnsubscribed(){return this.context.user.isInUdr}isUserEligibleToPrompt(){return o(this,void 0,void 0,function*(){return yield this.context.user.isEligibleToPrompt(this.context)})}isUserSubscribed(){return o(this,void 0,void 0,function*(){return yield this.context.user.isSubscribed(this.context)})}l(e,s){return o(this,void 0,void 0,function*(){if(this.context.runtimeEnvironment=e._subRuntimeEnvironmentOverride,this.context.runtimeEnvironment!==g.RuntimeEnvironment.AMP_FRAME_HELPER&&this.context.runtimeEnvironment!==g.RuntimeEnvironment.BROKERED_DATA_SERVER||x.MessengerServer.global.accept(),(0,i.validateOnlyInstanceOfSdk)(this),e.domainKey&&""!==e.domainKey.trim())return this.context.c=e,this.context.domainKey=e.domainKey,this.context.consent=(0,v.buildSdkConsentContext)(e,s),n.Logger.info("Loading: "+this.context.domainKey),this.context.domain=yield A.DomainService.loadDomain(this.context.domainKey),_.CookieDataProvider.domain=this.context.domain,this._runtimeEnvShouldSendSdkImpression(e)&&!b.AppService.inUdrContext()&&this.debug(this.context,p.StreamableEventType.SDK_IMPRESSION),this.context.env=yield O.EnvironmentService.loadEnv(),yield O.EnvironmentService.verifyEnvironmentSupport(e,this.context),yield A.DomainService.verifyEnvironmentSupport(this.context),this.context.domain.hasFlag("FEAT_SDK_RESTRICT_MULTI_SUBS")&&!this.context.domain.isEventOnlyMode()&&O.EnvironmentService.verifyNoSiblingSubscriptions(e,this.context),this.h();throw new a.ExitException(null,S.ExceptionMessage.DOMAIN_KEY_NOT_SPECIFIED)})}h(){return o(this,void 0,void 0,function*(){var s=this.context.c;if(this.context.consent.required&&this.context.consent.status===l.ConsentStatus.UNCONFIRMED)n.Logger.info("Awaiting Consent");else{this.context.app=yield b.AppService.loadApp(s),this.context.env.mode=this.context.app.mode,n.Logger.setVisibleLogsEnabled(this.context.app.isVisibleLoggingEnabled);let e=this.context.app.mode;this.context.domain.isEventOnlyMode()&&(e+=" [event only]"),n.Logger.info("Application Mode: "+e),n.Logger.info("Version: "+d.PUSHLY_APPLICATION_VERSION);try{const i=yield c.DataProviderFactory.getSessionDataProvider(this.context);var t=parseInt((yield i.getCurrentSession()).sessionStart);t<this._swsts_?this._swsts_=t:yield i.set("sessionStart",this._swsts_)}catch(e){}if(this.context.user=yield w.UserService.loadUser(s,this.context),!this.context.user)throw new h.FailException(null,S.ExceptionMessage.USER_UNABLE_TO_LOAD);yield O.EnvironmentService.verifyUdrState(this.context),s.externalId&&this.push(["profile",{external_id:s.externalId}]),r.UserDebugService.shouldShowDebugPanel()&&r.UserDebugService.showDebugPanel(this.context),O.EnvironmentService.configureRuntimeEnvironments(this.context),this.context.app.isLoaded=!0,n.Logger.info("Loaded"),this.dispatch(new P.EventModel(u.EventType.APPLICATION_LOADED)),this.context.user.isInUdr?(yield this.m(),n.Logger.info("Halting (UDR)")):yield this._loadFlows(s)}})}_loadFlows(t){return o(this,void 0,void 0,function*(){if(t.disableWebFlow)yield this.m();else{const s=m.FlowService.loadFlow(this.context);var e;!t.manualPromptMode&&s.isPromptableFlow&&(yield w.UserService.verifyUserSubscriptionState(this.context),this.context.domain.isEventOnlyMode()||(e={isSafari:this.context.env.isSafari()},y.PromptService.loadPrompts(this.context,e))),yield s.run()}})}_runtimeEnvShouldSendSdkImpression(e){const s=[g.RuntimeEnvironment.AMP_FRAME_HELPER,g.RuntimeEnvironment.AMP_PERMISSION_DIALOG,g.RuntimeEnvironment.PROXY,g.RuntimeEnvironment.PROXY_FRAME_HELPER,g.RuntimeEnvironment.PROXY_PERMISSION_DIALOG,g.RuntimeEnvironment.AMP,g.RuntimeEnvironment.AMP_FRAME_HELPER,g.RuntimeEnvironment.BROKERED_DATA_SERVER];return-1===s.indexOf(e._subRuntimeEnvironmentOverride)}t(){var e,s,t,i,o,n,r,p,l;this.context.app&&this.context.app.isLoaded||(e=this.v.bind(this),s=this.m.bind(this),t=this.y.bind(this),i=this.f.bind(this),o=this._.bind(this),n=this.b.bind(this),r=this.g.bind(this),p=this.w.bind(this),l=this.A.bind(this),this.watchOnce(u.EventType.CONFIRM_CONSENT,e),this.watchOnce(u.EventType.APPLICATION_LOAD,i),this.watchOnce(u.EventType.AMP_FRAME_HELPER_LOAD,o),this.watchOnce(u.EventType.AMP_PERMISSION_DIALOG_LOAD,n),this.watchOnce(u.EventType.PROXY_PERMISSION_DIALOG_LOAD,r),this.watchOnce(u.EventType.BROKERED_DATA_SERVER_LOAD,l),this.watchOnce(u.EventType.FLOW_LOADED,s),this.watch(u.EventType.REVERT_USER_DELETION,p),this.watch(u.EventType.PROMPT_SHOW,t),w.UserService.wireProfileEvents(this.context))}v(){this.context.app&&this.context.app.isLoaded||this.load(this.context.c,!0)}w(){return o(this,void 0,void 0,function*(){_.CookieDataProvider.has("_pnudr")&&(yield w.UserService.handleUdrRevert(this.context))})}f(e){this.load(e)}_(e){e._subRuntimeEnvironmentOverride=g.RuntimeEnvironment.AMP_FRAME_HELPER,n.Logger.setSubApplicationName("amp-helper-frame"),n.Logger.setColor("#7CBE7B"),n.Logger.setBackgroundColor("black"),this.load(e)}b(e){e._subRuntimeEnvironmentOverride=g.RuntimeEnvironment.AMP_PERMISSION_DIALOG,n.Logger.setSubApplicationName("amp-permission-dialog"),this.load(e)}g(e){e._subRuntimeEnvironmentOverride=g.RuntimeEnvironment.PROXY_PERMISSION_DIALOG,n.Logger.setSubApplicationName("proxy-permission-dialog"),this.load(e)}A(e){n.Logger.setSubApplicationName("brokered-data-server"),n.Logger.setColor("#FFC152"),n.Logger.setBackgroundColor("black"),e._subRuntimeEnvironmentOverride=g.RuntimeEnvironment.BROKERED_DATA_SERVER,this.load(e)}y(e){return o(this,void 0,void 0,function*(){this.k(()=>{this.context.domain.isEventOnlyMode()?n.Logger.warn("Manual prompting is not available while in event only mode."):(this.context.app.loadConfig.manualPromptMode||n.Logger.warn("Manual prompt mode is not enabled."),y.PromptService.performManualPromptLoad(this.context,e))},"Delaying 'show_prompt' request.")})}m(){return o(this,void 0,void 0,function*(){n.Logger.info("Ready"),this.context.app.isReady=!0,this.dispatch(new P.EventModel(u.EventType.APPLICATION_READY,this.context))})}k(e,s){this.context.app&&this.context.app.isReady?e():(n.Logger.debug(s||"Delaying request until application is in ready state."),this.watchOnce(u.EventType.APPLICATION_READY,e))}u(s){return o(this,void 0,void 0,function*(){if("object"==typeof s){s.context=Object.assign(Object.assign({},s.context),{sw_error:!1});const e=new RegExp(d.UNCAUGHT_ERROR_BLACKLIST.map(e=>`(${e})`).join("|"),"i");e.test(s.name)||e.test(s.message)?n.Logger.warn(this.context,s):n.Logger.error(this.context,s)}else n.Logger.error(this.context,s)})}p(){return o(this,void 0,void 0,function*(){this._swclkInitialized_||(this._swclkInitialized_=!0,(0,D.setIntervalRunner)(()=>{this._swclk_+=1,this.context.clock=this._swclk_},1e3))})}}s.SDK=B},"./src/sdk/services/app.service.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.AppService=void 0;const o=t("./src/sdk/data-providers/cookie.data-provider.ts"),n=t("./src/sdk/repositories/application.repository.ts"),r=t("./src/sdk/exceptions/exit.exception.ts"),p=t("./src/_utils/global-env.ts");s.AppService=new class{loadApp(s){return i(this,void 0,void 0,function*(){const e=yield n.ApplicationRepository.get();if(e.loadConfig=s,e.loadConfig.classNames=e.loadConfig.classNames||{},e.mode=(e.loadConfig.mode||e.mode||"production").toString().toLowerCase(),["production","development"].includes(e.mode))return yield this.saveApp(e),e.classNames=s.classNames,e;throw new r.ExitException("Invalid sdk mode specified.")})}saveApp(e){return i(this,void 0,void 0,function*(){return yield n.ApplicationRepository.set(e),e})}processUdr(){return i(this,void 0,void 0,function*(){return o.CookieDataProvider.set("_pnudr",1),n.ApplicationRepository.purgeCookies()})}inUdrContext(){return this.udrCookiePresent()||this.udrParamPresent()}udrCookiePresent(){let e=!1;try{e=!!o.CookieDataProvider.get("_pnudr")}catch(e){}return e}udrParamPresent(){var e=(0,p.getLocation)();let s=!1;try{s=/(^|[?&#])(push(ly)?_udr)=1(?=[&#]|$)/i.test(e.search)}catch(e){}return s}}},"./src/sdk/services/domain.service.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.DomainService=void 0;const l=t("./src/_utils/global-env.ts"),o=t("./src/sdk/models/events/event.model.ts"),u=t("./src/sdk/enums/exception-message.enum.ts"),n=t("./src/sdk/enums/event-type.enum.ts"),d=t("./src/sdk/exceptions/exit.exception.ts");var r=t("./src/sdk/models/events/eventable.model.ts");const p=t("./src/sdk/repositories/domain.repository.ts");class c extends r.EventableModel{loadDomain(e){return i(this,void 0,void 0,function*(){return p.DomainRepository.get(e)})}verifyEnvironmentSupport(e){return i(this,void 0,void 0,function*(){if(e.env.isSafari()&&!e.env.isPushManagerInScope()){if(!e.domain.hasApnsConfig())throw this.debugPromptNotShown(e,"apns_not_configured"),this.dispatch(new o.EventModel(n.EventType.WEB_PUSH_NOT_CONFIGURED)),this.dispatch(new o.EventModel(n.EventType.DOMAIN_APNS_NOT_CONFIGURED)),new d.ExitException(null,u.ExceptionMessage.DOMAIN_APNS_NOT_CONFIGURED);if(!e.domain.isApnsConfigEnabled())throw this.debugPromptNotShown(e,"apns_not_enabled"),this.dispatch(new o.EventModel(n.EventType.WEB_PUSH_NOT_CONFIGURED)),this.dispatch(new o.EventModel(n.EventType.DOMAIN_APNS_NOT_ENABLED)),new d.ExitException(null,u.ExceptionMessage.DOMAIN_APNS_NOT_ENABLED);if(!e.domain.getWebsitePushId())throw this.debugPromptNotShown(e,"apns_invalid_config"),this.dispatch(new o.EventModel(n.EventType.WEB_PUSH_NOT_CONFIGURED)),this.dispatch(new o.EventModel(n.EventType.DOMAIN_APNS_INVALID_CONFIG)),new d.ExitException(null,u.ExceptionMessage.DOMAIN_APNS_INVALID_CONFIG)}this.validateHostAvailability(e)})}validateHostAvailability(e){var s=(0,l.getLocation)();let t,i=e.domain.whitelistDomains;if(i)if(Array.isArray(i)&&0!==i.length){0<i.length&&e.env.isSafari()&&(i=[i[0]]);var o=["localhost","127.0.0.1"];const n=s.protocol+"//"+s.hostname,r=s.protocol+"//"+s.host,p=s.href;s=[...i,...o].some(e=>{/^\*/.test(e)&&(e="."+e);const s=new RegExp(`^(http[s]?://)?${e}$`,"i");return s.test(n)||s.test(r)||s.test(p)});t=!s}else t=!1;else t=!1;if(t)throw this.debugPromptNotShown(e,"host_not_whitelisted"),new d.ExitException(null,u.ExceptionMessage.HOST_NOT_WHITELISTED)}}s.DomainService=new c},"./src/sdk/services/environment.service.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.EnvironmentService=void 0;const n=t("./src/sdk/services/logging.service.ts"),o=t("./src/sdk/services/app.service.ts"),r=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),p=t("./src/sdk/enums/runtime-environment.enum.ts"),l=t("./src/sdk/enums/event-type.enum.ts"),u=t("./src/sdk/services/user.service.ts");var d=t("./src/sdk/models/events/eventable.model.ts");const c=t("./src/sdk/models/events/event.model.ts"),a=t("./src/sdk/enums/exception-message.enum.ts"),h=t("./src/sdk/enums/steamable-event-type.enum.ts"),m=t("./src/sdk/models/application/environment.model.ts"),v=t("./src/sdk/factories/data-provider-factory.ts"),y=t("./src/sdk/exceptions/exit.exception.ts"),f=t("./src/sdk/enums/integration-type.enum.ts");class _ extends d.EventableModel{loadEnv(){return i(this,void 0,void 0,function*(){return new m.EnvironmentModel})}verifyNoSiblingSubscriptions(s,e){if(e.env.document.cookie.split(";").map(e=>e.toString().trim().split("=")).find(e=>/^_pnss/.test(e[0])&&!new RegExp(s.domainKey.substr(-8)+"$").test(e[0])&&"subscribed"===e[1]))throw this.debugPromptNotShown(e,"sibling_subscription_detected",e.env.unsupportedReason),this.dispatch(new c.EventModel(l.EventType.EXISTING_SUBSCRIPTION_DETECTED,void 0,s,e.env)),new y.ExitException(null,a.ExceptionMessage.EXISTING_SUBSCRIPTION_DETECTED)}verifyEnvironmentSupport(s,t){return i(this,void 0,void 0,function*(){var e=!!t.env&&(yield t.env.isPushSupported());if(e)return this.dispatch(new c.EventModel(l.EventType.WEB_PUSH_SUPPORTED)),e;throw this.debugPromptNotShown(t,"web_push_unsupported",t.env.unsupportedReason),this.dispatch(new c.EventModel(l.EventType.WEB_PUSH_NOT_SUPPORTED,void 0,s,t.env)),new y.ExitException(null,a.ExceptionMessage.ENV_NOT_SUPPORTED)})}verifyUdrState(s){return i(this,void 0,void 0,function*(){if(o.AppService.inUdrContext()){s.user.isInUdr=!0;try{o.AppService.udrParamPresent()&&!o.AppService.udrCookiePresent()&&(yield this.post(new r.SubscriberStreamableEventModel(h.StreamableEventType.UDR,{},s)),yield o.AppService.processUdr(),yield u.UserService.processUdr(),this.dispatch(new c.EventModel(l.EventType.USER_DELETION_REQUEST)));const e=yield v.DataProviderFactory.getPermissionDataProvider(s);yield e.removeRegistration()}catch(e){"NoResponseException"!==e.name&&n.Logger.warn("Error processing UDR:",e)}}})}configureRuntimeEnvironments(e){const{app:s,domain:t,env:i}=e;if(t.integrationType===f.IntegrationType.DIRECT&&t.customAllowDomain&&!i.isHTTPS()&&!i.isDevMode())i.primaryRuntimeEnvironment=p.RuntimeEnvironment.PROXY;else if(s.loadConfig._subRuntimeEnvironmentOverride){var o=s.loadConfig._subRuntimeEnvironmentOverride;switch(o){case p.RuntimeEnvironment.BROKERED_DATA_SERVER:i.primaryRuntimeEnvironment=p.RuntimeEnvironment.BROKERED_DATA_SERVER;break;case p.RuntimeEnvironment.AMP_FRAME_HELPER||p.RuntimeEnvironment.AMP_PERMISSION_DIALOG:i.primaryRuntimeEnvironment=p.RuntimeEnvironment.AMP,i.subRuntimeEnvironment=o;break;case p.RuntimeEnvironment.PROXY_PERMISSION_DIALOG:i.primaryRuntimeEnvironment=p.RuntimeEnvironment.PROXY,i.subRuntimeEnvironment=o}}i.primaryRuntimeEnvironment||(t.integrationType===f.IntegrationType.PROXY?i.primaryRuntimeEnvironment=p.RuntimeEnvironment.PROXY:i.primaryRuntimeEnvironment=p.RuntimeEnvironment.DIRECT),n.Logger.info("Current runtime environment: "+p.RuntimeEnvironmentName[i.subRuntimeEnvironment||i.primaryRuntimeEnvironment])}}s.EnvironmentService=new _},"./src/sdk/services/flow.service.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.FlowService=s.FlowSvc=void 0;const i=t("./src/sdk/factories/flow.factory.ts");class o{loadFlow(e){return i.FlowFactory.getFlow(e)}}s.FlowSvc=o,s.FlowService=new o},"./src/sdk/services/helpers/apns.service-helpers.ts":function(e,s,t){"use strict";var o=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.ApnsServiceHelpers=void 0;const u=t("./src/sdk/services/logging.service.ts"),d=t("./src/sdk/constants.ts"),n=t("./src/sdk/enums/exception-message.enum.ts"),r=t("./src/sdk/enums/notification-permission-state.enum.ts"),p=t("./src/sdk/exceptions/fail.exception.ts");s.ApnsServiceHelpers=class{static getToken(t){return o(this,void 0,void 0,function*(){let e;var s=yield t.user.getComputedPushPermission(t);return e=s.deviceToken?s.deviceToken:e})}static requestNotificationPermission(t,i){return o(this,void 0,void 0,function*(){const e={permissionState:"default"};var s=t.domain.getWebsitePushId(),s=(u.Logger.info("APNS checking permission for",s),yield t.user.getComputedPushPermission(t));if(e.permissionState=s.permission,e.permissionState===r.NotificationPermissionState.GRANTED)u.Logger.info("APNS permission already granted"),e.token=s.deviceToken;else{s=yield this._checkRemotePermission(t,e,i);if(e.permissionState=s.permission,u.Logger.info("APNS response",s),s.permission===r.NotificationPermissionState.GRANTED&&(e.token=s.deviceToken,t.user.setPushPermission(s),!e.token))throw new p.FailException(null,n.ExceptionMessage.APNS_FAILED_TO_GET_GRANTED_TOKEN)}return e})}static _checkRemotePermission(e,s,t){return o(this,void 0,void 0,function*(){if(null!==s&&s.permissionState!==r.NotificationPermissionState.DEFAULT)return s;if(t)try{t()}catch(e){}return this._requestSafariPermissions(e)})}static _requestSafariPermissions(l){return o(this,void 0,void 0,function*(){return new Promise(s=>{u.Logger.info("Setting permission scope");const t=l.env.scope,i=(u.Logger.info("Gathering permission snapshot"),t.safari.pushNotification.permission(l.domain.getWebsitePushId())||{});let o,n=0,r=!1;function p(){clearInterval(o),r=!0}u.Logger.info("Requesting permission"),t.safari.pushNotification.requestPermission(d.APNS_URL,l.domain.getWebsitePushId(),{domain_key:l.domainKey,pushly_unique_user_id:l.user.puuid},e=>{r||(p(),s(e),u.Logger.info(`Native permission response sent [${e.permission}]`))}),o=setInterval(()=>{try{var e;r||(n+=1,e=t.safari.pushNotification.permission(l.domain.getWebsitePushId())||{},600<=n?(clearInterval(o),u.Logger.info(`Fallback permission retry attempts exhausted, [${e.permission}]`)):e.permission!==i.permission&&(p(),s(e),u.Logger.info(`Fallback permission response sent [${e.permission}]`)))}catch(e){u.Logger.warn("sw.apns.error",e)}},500)})})}}},"./src/sdk/services/helpers/user-profile.service-helpers.ts":function(e,s,t){"use strict";var p=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.UserProfileServiceHelpers=void 0;const l=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),i=t("./src/sdk/enums/steamable-event-type.enum.ts"),u=t("./src/sdk/exceptions/profile.exception.ts");var o=t("./src/sdk/models/events/eventable.model.ts");const d=t("./src/sdk/utils.ts"),n=t("./src/sdk/enums/event-priority.enum.ts");class r extends o.EventableModel{static saveUserTags(e,s,t=0){return p(this,void 0,void 0,function*(){Array.isArray(s)||(s=[s]),yield this.patchProfile(i.StreamableEventType.PROFILE_UPDATE,e,{tag:s},t)})}static saveUserEvent(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_UPDATE,e,{event:[s]})})}static saveUserProfileData(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_UPDATE,e,{profile:s})})}static appendProfileArrayValue(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_APPEND,e,{profile:s})})}static removeProfileArrayValue(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_REMOVE,e,{profile:s})})}static pageTagVisit(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PAGE_TAG_VISITS,e,{page_tags:s})})}static viewItem(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.VIEW_ITEM,e,s)})}static saveItem(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.SAVE_ITEM,e,s)})}static addToCart(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.ADD_TO_CART,e,s,null,n.EventPriority.IMMEDIATE)})}static updateCartItem(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.UPDATE_CART_ITEM,e,s,null,n.EventPriority.IMMEDIATE)})}static purchase(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PURCHASE,e,s,null,n.EventPriority.IMMEDIATE)})}static saveExternalUserId(e,s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_UPDATE,e,{profile:{external_id:s}},0)})}static deregisterExternalUserId(e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.DEREGISTER_EXTERNAL_ID,e,{},0)})}static patchProfile(t,i,o,n=0,r){return p(this,void 0,void 0,function*(){try{n&&0<n&&(yield(0,d.delayRandom)(n));let e={};o&&o.meta&&(e=o.meta);var s=(yield i.user.getComputedPushPermission(i)).subscription;e.subscription_data=s||void 0,yield this.post(new l.SubscriberStreamableEventModel(t,Object.assign(Object.assign({},o),{meta:e}),i),null,r)}catch(e){throw new u.ProfileException(e)}})}}s.UserProfileServiceHelpers=r},"./src/sdk/services/helpers/vapid.service-helpers.ts":function(e,s,t){"use strict";var p=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.VapidServiceHelpers=void 0;const l=t("./src/sdk/services/logging.service.ts"),r=t("./src/common/md5.ts"),u=t("./src/sdk/services/worker.service.ts"),d=t("./src/_utils/service-worker-registration.ts"),n=t("./src/_utils/base-64.ts"),c=t("./src/sdk/data-providers/local-permission.data-provider.ts"),a=t("./src/sdk/enums/exception-message.enum.ts"),i=t("./src/sdk/enums/notification-permission-state.enum.ts"),h=t("./src/sdk/exceptions/fail.exception.ts"),m=t("./src/sdk/utils.ts");s.VapidServiceHelpers=class{static getToken(o){return p(this,void 0,void 0,function*(){let s,t=yield this.getSubscription(o,!1);var e=o.user.isSubscribed(o);if(t&&t.endpoint&&(s=(0,r.MD5)(t.endpoint),o.domain&&o.domain.vapidPublicKey)){var i=o.domain.vapidPublicKey;let e;(e=t.options&&t.options.applicationServerKey?(0,n.arrayBufferToBase64)(t.options.applicationServerKey):e)!==i&&(t=yield this.subscribe(i,o,t),s=(0,r.MD5)(t.endpoint))}i=yield o.user.getLocalPushPermission(o);return s=!s&&e&&"granted"===i.permission&&(e=yield this.handleNotificationPermissionGranted(o,{permissionState:"granted"}))&&e.token?e.token:s})}static getSubscription(s,t=!0){return p(this,void 0,void 0,function*(){let e=null;return(yield(0,d.getPushlyServiceWorkerRegistration)(s))?e=yield(0,d.getPushSubscription)(s):t&&(yield u.WorkerService.registerWorker(s)),e})}static requestNotificationPermission(t,i){return p(this,void 0,void 0,function*(){var e=yield t.user.getLocalPushPermission(t);const s={permissionState:e.permission};return"default"===e.permission&&(i&&i(),l.Logger.debug("Requesting browser notification permission"),s.permissionState=yield Notification.requestPermission()),s})}static handleNotificationPermissionGranted(o,n){return p(this,void 0,void 0,function*(){var e=yield o.user.getLocalPushPermission(o,!0);if(n.permissionState=e.permission,n.permissionState===i.NotificationPermissionState.GRANTED){let e,t,i=1e3;for(let s=0;s<10;s++){try{if(n.subscription=yield this.subscribe(o.domain.vapidPublicKey,o),e=n.subscription?n.subscription.endpoint:e)break}catch(e){s<9?l.Logger.warn(e):t=e}l.Logger.info("Retrying fetch token"),i*=3,yield(0,m.delay)(i)}if(!e)throw new h.FailException(t,a.ExceptionMessage.FAILED_TO_GET_GRANTED_TOKEN);if("string"!=typeof e){const s=new h.FailException(null,a.ExceptionMessage.INVALID_TOKEN_TYPE);throw s.context={token:e},s}n.token=(0,r.MD5)(e)}return n})}static subscribe(e,n,r){return p(this,void 0,void 0,function*(){let s=yield(0,d.getPushlyServiceWorkerRegistration)(n);s=s||(yield u.WorkerService.registerWorker(n));try{yield(0,d.createPushSubscription)(n,s)}catch(e){if(!/unsubscribe then resubscribe/i.test(e.message))throw e;var t;if(r)l.Logger.info("Attempting to unsubscribe previous subscription"),yield r.unsubscribe();else for(t of yield(0,d.getServiceWorkerRegistrations)(n)){const o=yield t.pushManager.getSubscription();yield o.unsubscribe()}l.Logger.info("Resubscribing"),yield(0,d.createPushSubscription)(n,s)}const e=new c.LocalPermissionDataProvider(n);var i=yield e.getPushPermission();return n.user.setPushPermission(i),i.subscription})}}},"./src/sdk/services/logging.service.ts":function(e,s,t){"use strict";var n=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.Logger=void 0;const i=t("./node_modules/error-stack-parser/error-stack-parser.js"),l=t("./src/sdk/constants.ts"),r=t("./src/_utils/global-env.ts"),p=t("./src/sdk/utils.ts"),u=t("./src/sdk/exceptions/pushly.exception.ts"),d=t("./src/sdk/enums/steamable-event-type.enum.ts"),c=t("./src/sdk/models/context.model.ts"),a=["test",l.ENV_NAME_DEV,l.ENV_NAME_LOCAL,l.ENV_NAME_STAGING],h=["test",l.ENV_NAME_LOCAL_PRODUCTION,l.ENV_NAME_PRODUCTION];s.Logger=new class{constructor(){this.logs=[],this.applicationName=l.PUSHLY_SDK_APPLICATION_NAME,this.color=null,this.backgroundColor=null,this.subApplicationName=null,this.plugins=[];var e=(this.visibleLogsEnabled=!1,r.getNavigator)();try{if("plugins"in e)for(var s=0;s<e.plugins.length;s++)this.plugins.push(e.plugins[s].name)}catch(e){this.plugins.push("unable to collect plugin information")}}setVisibleLogsEnabled(e){this.visibleLogsEnabled=e}getComputedApplicationName(){let e=this.applicationName;return e=this.subApplicationName?this.applicationName+"::"+this.subApplicationName:e}print(e,s){var t;if((0,r.getSelf)().console)for(t of Array.isArray(s)?s:[s]){t instanceof Object&&(t=JSON.stringify(t));const i=[`[${this.getComputedApplicationName()}] `+t],o=[];this.color&&o.push("color: "+this.color),this.backgroundColor&&o.push("background-color: "+this.backgroundColor),o&&(i[0]="%c"+i[0],i.push(o.join(";"))),console[e].apply(console,i)}}getBacktrace(s){let t=[];try{let e=(0,i.parse)(s);e.forEach(e=>{t.push({file:e.fileName,line:e.lineNumber,column:e.columnNumber,function:e.functionName})})}catch(s){this.warn(s),t.push({file:"logging.service.ts",line:"1",function:"getBacktrace"})}return t}debug(...e){this.logs=Array.prototype.concat(this.logs,e.map(e=>["debug",e])),!this.visibleLogsEnabled&&-1===a.indexOf(l.ENV_NAME)||this.print("debug",e)}info(...e){this.logs=Array.prototype.concat(this.logs,e.map(e=>["info",e])),!this.visibleLogsEnabled&&-1===a.indexOf(l.ENV_NAME)||this.print("log",e)}warn(...e){this.logs=Array.prototype.concat(this.logs,e.map(e=>["warn",e])),!this.visibleLogsEnabled&&-1===a.indexOf(l.ENV_NAME)||this.print("warn",e)}error(...o){let n;if(o[0]instanceof c.ContextModel&&(n=o.shift()),this.logs=Array.prototype.concat(this.logs,o.map(e=>["error",e])),!this.visibleLogsEnabled&&-1===a.indexOf(l.ENV_NAME)||this.print("error",o),n&&0<o.length){let e=0,t=[],s=(this.logs.forEach(e=>{var s=e[0],e=e[1]instanceof Error?e[1].message:e[1];t.push([s,e])}),1<o.length&&-1===(e=o.findIndex(e=>e instanceof Error))&&(e=0),o.splice(e,1)),i=(s&&0<s.length?s=s[0]:(s=new Error("Cannot resolve error from logs")).code="sw/cannot-resolve-error-from-logs",s instanceof Error?s:new Error(s));if(i instanceof Error){let e=!1;const p={error_type:i.name,error_message:i.message,backtrace:this.getBacktrace(i),logs:Array.from(t).splice(t.length-15,15),plugins:this.plugins};i instanceof u.PushlyException&&(e=i.shouldSuppress(),"originError"in i&&i.originError instanceof Error&&(p.error_message!=i.originError.message&&(p.error_message=p.error_message+"; "+i.originError.message),p.backtrace=this.getBacktrace(i.originError)));var{context:o,code:r}=i;r&&(p.error_code=r),p.context={suppressed:e||!1,originError:i.originError||null};try{p.context=Object.assign(Object.assign({},p.context),o)}catch(e){}let s=!1;n.domain&&n.domain.hasFlag("SDK_DEBUG_EVENTS")&&(s=!0),e&&!s||this.streamError(n,p)}}}streamError(i,o){return n(this,void 0,void 0,function*(){var e=i.domain||{},s=i.user||{},t=(o=Object.assign(Object.assign({},o),{sdk_version:2,source:{application:this.applicationName,version:l.PUSHLY_APPLICATION_VERSION},page_url:i.env.location.toString(),pushly_unique_user_id:s.puuid}),"safari"in(0,r.getSelf)()?"apns_token":"fcm_subscription_id"),t=(o[t]=s.token,{action:d.StreamableEventType.ERROR,domain_id:e.id,domain_key:i.domainKey,event_date:(new Date).toISOString(),meta:o});-1!==h.indexOf(l.ENV_NAME)?(0,p.retryFetch)(l.EVENTS_ENDPOINT,{headers:{"content-type":"text/plain"},method:"POST",body:JSON.stringify(t)},()=>{}):console.log(t)})}setSubApplicationName(e){this.subApplicationName=e}setColor(e){this.color=e}setBackgroundColor(e){this.backgroundColor=e}}},"./src/sdk/services/prompt.service.ts":function(e,s,t){"use strict";var o=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.PromptService=void 0;const n=t("./src/sdk/constants.ts"),r=t("./src/sdk/services/logging.service.ts"),p=t("./src/_utils/global-env.ts"),i=t("./src/sdk/enums/prompt-style.enum.ts"),l=t("./src/sdk/prompts/native.prompt.ts"),u=t("./src/sdk/enums/event-type.enum.ts");var d=t("./src/sdk/models/events/eventable.model.ts");const c=t("./src/sdk/models/events/event.model.ts"),a=t("./src/sdk/prompts/dom.prompt.ts"),h=t("./src/sdk/prompts/custom.prompt.ts"),m=t("./src/sdk/factories/prompt.factory.ts"),v=t("./src/sdk/prompts/bell.prompt.ts"),y=t("./src/sdk/prompts/slide.prompt.ts");class f extends d.EventableModel{constructor(){super(),this.x=[],this.I={},this._wireEvents()}_wireEvents(){var e=this._handleWebPushNotSupported.bind(this);this.watch(u.EventType.WEB_PUSH_NOT_SUPPORTED,e)}_handleWebPushNotSupported(e,s,t){this.setCustomPromptUnsupportedClassname(s,t)}performManualPromptLoad(t,i){return o(this,void 0,void 0,function*(){let e;var s;(i=i||{}).id?e=this.I[i.id]:0<this.x.length&&(e=this.x[0])&&r.Logger.info(`No prompt ID specified - using already loaded prompt ${e.promptId}.`),e?(r.Logger.info(`Prompt, ${e.promptId}, is already running.`),e.bypassEligibilityCheck=void 0===i.checkEligibility||!i.checkEligibility,e.hasOwnProperty("shown")&&!e.shown&&e.run({bypassEligibilityCheck:e.bypassEligibilityCheck})):(i.id?e=this.getPromptById(t,i.id):(s=this.loadPrompts(t,{isSafari:t.env.isSafari()}),0<length&&(e=s[0])),e&&(e instanceof a.DomPrompt&&(yield e.attachToDom()),yield e.run({bypassEligibilityCheck:void 0===i.checkEligibility||!i.checkEligibility})))})}loadPrompts(e,s={}){const t=m.PromptFactory.getPrompts(e,s);return t.forEach(e=>{this._cachePrompt(e.promptId,e)}),t&&0===length&&this.dispatch(new c.EventModel(u.EventType.NO_ELIGIBLE_PROMPTS)),t}setCustomPromptUnsupportedClassname(e,s){return o(this,void 0,void 0,function*(){(yield this._locateCustomPrompt())&&this._loadUnsupportedCustomPrompt(e,s)})}getPromptById(e,s){const t={};let i;if(t.prompt=e.domain.prompts.find(e=>e.id.toString()===s.toString()),t.prompt&&(t.group=e.domain.promptGroups.find(e=>e.id.toString()===t.prompt.prompt_group_id.toString())),t.group){const o=this._selectPromptClass(t.prompt.style);i=new o(e,t)}return i}_selectPromptClass(e){return{[i.PromptStyle.Native]:l.NativePrompt,[i.PromptStyle.Slide]:y.SlidePrompt,[i.PromptStyle.Bell]:v.BellPrompt,[i.PromptStyle.Custom]:h.CustomPrompt}[e]}_cachePrompt(e,s){this.x.push(s),this.I[e]=s}_locateCustomPrompt(){return o(this,void 0,void 0,function*(){let o=0;return new Promise((t,e)=>{const i=setInterval(()=>{20<=o&&(clearInterval(i),t(!1)),o++;const e=(0,p.getDocument)();var s;e.getElementsByClassName&&(s=e.getElementsByClassName(n.DEFAULT_CLASSNAME_PROMPT_CUSTOM))&&0<s.length&&(clearInterval(i),t(!0))},500)})})}_loadUnsupportedCustomPrompt(e,s){e={app:{loadConfig:e},user:{env:s}};const t=new h.CustomPrompt(e,{},!1);t.runInUnsupportedMode()}}s.PromptService=new f},"./src/sdk/services/registration.service.ts":function(e,s,t){"use strict";var d=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.RegistrationService=void 0;const c=t("./src/sdk/constants.ts"),r=t("./src/sdk/services/helpers/apns.service-helpers.ts"),p=t("./src/sdk/services/helpers/vapid.service-helpers.ts"),a=t("./src/sdk/services/logging.service.ts"),l=t("./src/sdk/services/user.service.ts"),o=t("./src/sdk/services/worker.service.ts"),h=t("./src/sdk/utils.ts"),m=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),u=t("./src/sdk/models/events/event.model.ts"),v=t("./src/sdk/data-providers/cookie.data-provider.ts"),y=t("./src/sdk/enums/runtime-environment.enum.ts"),f=t("./src/sdk/repositories/user.repository.ts"),_=t("./src/sdk/enums/steamable-event-type.enum.ts"),i=t("./src/sdk/prompts/dom.prompt.ts"),b=t("./src/sdk/enums/event-type.enum.ts");var n=t("./src/sdk/models/events/eventable.model.ts");const g=t("./src/sdk/prompts/base.prompt.ts");class w extends n.EventableModel{constructor(){super(),this._wireEvents()}_wireEvents(){var e=this._handlePromptAllowed.bind(this),s=this._handlePromptDisabled.bind(this);this.watch(b.EventType.PROMPT_ALLOWED,e),this.watch(b.EventType.PROMPT_DISABLED,s)}_handlePromptAllowed(e,s,t){return d(this,void 0,void 0,function*(){if(!s.domain.isEventOnlyMode())return this._tryRegistration(s,t);a.Logger.warn("Prompt events are suppressed while in event only mode")})}_handlePromptDisabled(e,s,t){return d(this,void 0,void 0,function*(){var e;s.domain.isEventOnlyMode()?a.Logger.warn("Prompt events are suppressed while in event only mode"):(e=this._getPromptRegistrationData(s,t),this._handlePermissionDenied(s,e))})}tryMigration(o,n=!0){return d(this,void 0,void 0,function*(){if(o.domain.isEventOnlyMode())a.Logger.warn("Cannot try migration while in event only mode");else{let e;var s,t,i;(e=o.env.isPushManagerInScope()?yield p.VapidServiceHelpers.getToken(o):yield r.ApnsServiceHelpers.getToken(o))&&e!==o.user.token&&(a.Logger.info("Subscription token refreshed by the remote end. Migrating subscription."),"granted"===(i=yield o.user.getLocalPushPermission(o)).permission&&(o.env.primaryRuntimeEnvironment===y.RuntimeEnvironment.PROXY||(yield o.user.isUnsubscribed(o)))||(s=yield o.user.isSubscribed(o),t=o.user.token,o.user.token=e,yield f.UserRepository.set(o.user),i=this._sendSubscriptionToRemote(o,{subscription_data:i.subscription||void 0,token:e,previous_token:t,external_id:o.user.externalId,domain_key:o.domain.domainKey,amp:o.env.primaryRuntimeEnvironment===y.RuntimeEnvironment.AMP,migrated:!0,pushly_subscriber_data_present:s}),n&&(yield i),this.dispatch(new u.EventModel(b.EventType.REGISTRATION_MIGRATED,e))))}})}_shouldOpenProxyRegistrationWindow(e){return!e.domain.isEventOnlyMode()&&e.env.primaryRuntimeEnvironment===y.RuntimeEnvironment.PROXY&&e.env.subRuntimeEnvironment!==y.RuntimeEnvironment.PROXY_PERMISSION_DIALOG}_tryRegistration(s,t){return d(this,void 0,void 0,function*(){var e;{if(!s.domain.isEventOnlyMode())return e=this._getPromptRegistrationData(s,t),this._shouldOpenProxyRegistrationWindow(s)?this._openProxyRegistrationWindow(s,e):this._register(s,e);a.Logger.warn("Cannot try registration while in event only mode")}})}performManualRegistrationAttempt(s,t,i){return d(this,void 0,void 0,function*(){var e;{if(!s.domain.isEventOnlyMode())return yield o.WorkerService.registerWorker(s),e=this._getPromptRegistrationData(s,{promptId:t,promptKeywords:i}),this._shouldOpenProxyRegistrationWindow(s)?this._openProxyRegistrationWindow(s,e):this._register(s,e);a.Logger.warn("Cannot perform manual registration attempt while in event only mode")}})}unsubscribe(i,o="blocked"){return d(this,void 0,void 0,function*(){if(i.domain.isEventOnlyMode())a.Logger.warn("Cannot perform unsubscribe request while in event only mode");else{const s=this._buildPromptPermissionEventPack(),t=yield i.user.getLocalPushPermission(i);var e=yield i.user.isSubscribed(i);t.subscription&&e&&i.env.isPushManagerInScope()&&i.env.primaryRuntimeEnvironment!==y.RuntimeEnvironment.PROXY&&(a.Logger.info("Processing subscription unsubscribe request"),s.meta=Object.assign(Object.assign({},s.meta),{subscription_data:t.subscription}),yield t.subscription.unsubscribe(),i.user.setPushPermission(t)),e&&(yield l.UserService.setSubscriptionState(i.user,o),this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.MANUAL_UNSUBSCRIBED,s,i)),this.dispatch(new u.EventModel(b.EventType.REGISTRATION_UNSUBSCRIBED,this._buildClientFeedbackEventPack())),a.Logger.info("User has been unsubscribed from notifications"))}})}_register(i,o){return d(this,void 0,void 0,function*(){if(i.domain.isEventOnlyMode())a.Logger.warn("Cannot perform registration while in event only mode");else{let e;var s=this._handlePermissionPrompted.bind(this,i,o);const{env:t}=i["user"];"granted"===(e=t.isPushManagerInScope()?yield p.VapidServiceHelpers.requestNotificationPermission(i,s):yield r.ApnsServiceHelpers.requestNotificationPermission(i,s)).permissionState?(yield this._handlePermissionGranted(i,o),i.domain.shouldUseVapid()&&(e=yield p.VapidServiceHelpers.handleNotificationPermissionGranted(i,e)),yield this._handleSubscriptionSuccess(i,e,o)):"default"===e.permissionState?this._handlePermissionDismissed(i,o):"denied"===e.permissionState?this._handlePermissionDenied(i,o):a.Logger.warn("Unknown")}})}_sendSubscriptionToRemote(t,i){return d(this,void 0,void 0,function*(){if(t.domain.isEventOnlyMode())a.Logger.warn("Cannot send subscription data while in event only mode");else if(t.user.subscriptionRegistered)a.Logger.warn(t,"Attempt to register subscription token more than once detected");else{const s={meta:Object.assign({},i)};var e=this.gatherAdditionalSubData(t),e=(e&&(s.meta.page_meta_properties=e),i.previous_token?s.meta.migrated=!0:s.meta.subscribed_referrer=(t.user.lastReferrerState||{}).referrer,new m.SubscriberStreamableEventModel(_.StreamableEventType.SUBSCRIBED,s,t));yield this.post(e,c.ALLOW_ENDPOINT),t.user.subscriptionRegistered=!0,yield f.UserRepository.set(t.user)}})}gatherAdditionalSubData(o){try{var e=o["domain"];const n={};if(Array.isArray(e.additionalSubscriptionData)){const s=e.additionalSubscriptionData;s.forEach(e=>{try{var s=e.profile_property;const i=e.selectors;if(s&&Array.isArray(i)){let t;i.some(e=>{var s=e.selector,e=e.value;return s&&e&&(s=o.env.document.head.querySelector(`[${s}~='${e}'][content]`),t=(s||{}).content),!!t}),t&&(n[s]=t)}}catch(e){}})}if(0<Object.keys(n).length)return n}catch(e){}}_handlePermissionPrompted(e,s){e.domain.isEventOnlyMode()?a.Logger.warn("Permission events are suppressed while in event only mode"):(this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PERMISSION_PROMPTED,Object.assign({},s.streamPack),e)),this.dispatch(new u.EventModel(b.EventType.LEGACY_PERMISSION_DIALOG_SHOWN)),this.dispatch(new u.EventModel(b.EventType.PERMISSION_DIALOG_SHOWN,s.clientPack)))}_handlePermissionGranted(e,s){return d(this,void 0,void 0,function*(){e.domain.isEventOnlyMode()?a.Logger.warn("Permission events are suppressed while in event only mode"):(this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PERMISSION_ACCEPTED,Object.assign({},s.streamPack),e)),this.dispatch(new u.EventModel(b.EventType.LEGACY_PERMISSION_GRANTED)),this.dispatch(new u.EventModel(b.EventType.PERMISSION_GRANTED,s.clientPack)))})}_handleSubscriptionSuccess(n,r,p){return d(this,void 0,void 0,function*(){if(n.domain.isEventOnlyMode())a.Logger.warn("Permission events are suppressed while in event only mode");else{a.Logger.info("Got token: "+r.token);const i=n["domain"];n.user.token=r.token;var s=n.env.isPushManagerInScope()?"fcm_subscription_id":"apns_token",t=n.env.getQueryString();let e=n.env.location.href;c.PUSHLY_SUBSCRIBED_URL_QS in t&&(e=decodeURIComponent(t[c.PUSHLY_SUBSCRIBED_URL_QS]));const o={[s]:i.shouldUseVapid()?void 0:r.token,subscription_data:r.subscription||void 0,external_id:n.user.externalId,subscribed_url:e,prompt_id:p.promptId,domain_key:n.domain.domainKey,amp:n.env.primaryRuntimeEnvironment===y.RuntimeEnvironment.AMP};p.promptId&&p.promptKeywords&&(o.tag=p.promptKeywords,o.keywords=p.promptKeywords),yield this._sendSubscriptionToRemote(n,o),l.UserService.setSubscriptionState(n.user,"subscribed",r.token),v.CookieDataProvider.set("_pnpds",window.location.hostname),this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PAGE_VIEW,{meta:{subscription_data:r.subscription}},n)),this.dispatch(new u.EventModel(b.EventType.REGISTRATION_SUBSCRIBED,r.token))}})}_handlePermissionDismissed(e,s){e.domain.isEventOnlyMode()?a.Logger.warn("Permission events are suppressed while in event only mode"):(this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PERMISSION_DISMISSED,Object.assign({},s.streamPack),e)),l.UserService.setSubscriptionState(e.user,"dismissed",null,s),this.dispatch(new u.EventModel(b.EventType.PERMISSION_DISMISSED,s.clientPack)))}_handlePermissionDenied(e,s){e.domain.isEventOnlyMode()?a.Logger.warn("Permission events are suppressed while in event only mode"):(this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PERMISSION_DENIED,Object.assign({},s.streamPack),e)),l.UserService.setSubscriptionState(e.user,"blocked",null,s),this.dispatch(new u.EventModel(b.EventType.PERMISSION_DENIED,s.clientPack)))}_getPromptRegistrationData(e,s){const t={};e=e.env.getQueryString();return s instanceof g.BasePrompt?(t.promptId=s?s.promptId:void 0,t.promptBehavior=s?s.promptConfig.behavior:void 0,s&&s instanceof i.DomPrompt&&(t.promptKeywords=s.keywords)):(t.promptId=(s||{}).promptId,t.promptKeywords=(s||{}).promptKeywords),c.PUSHLY_PROMPT_ID_QS in e&&(t.promptId=(0,h.tryParseInt)(e[c.PUSHLY_PROMPT_ID_QS])),t.streamPack=this._buildPromptPermissionEventPack(t.promptId,t.promptKeywords),t.clientPack=this._buildClientFeedbackEventPack(t.promptId,t.promptKeywords),t}_openProxyRegistrationWindow(l,u){return d(this,void 0,void 0,function*(){if(l.domain.isEventOnlyMode())a.Logger.warn("Cannot open proxy registration window while in event only mode");else{const t=l.env.document;var e=l.domain.customAllowDomain;const i=t.createElement("a");var s,e=`https://${e}/`+l.domain.domainKey;i.href=e;const o=(0,h.parseQueryString)(i.search),n=(o[c.PUSHLY_SUBSCRIBED_URL_QS]=encodeURIComponent(l.env.location.toString()),o[c.PUSHLY_UNIQUE_USER_ID_QS]=l.user.puuid,o[c.PUSHLY_DOMAIN_KEY_QS]=l.domain.domainKey,o[c.PUSHLY_PROMPT_ID_QS]=u.promptId,[]);for(s in o)n.push(s+"="+o[s]);e=`${i.protocol}//${i.host}${i.pathname}?`+n.join("&");const r=l.env.scope.open(e,"Push Notification Registration","directories=0,toolbar=0,status=0,menubar=0,width=680,height=550");if(r){this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PROXY_WINDOW_OPENED,{meta:{promptId:u.promptId}},l));const p=l.env.scope.setInterval(()=>{r.closed&&(clearInterval(p),this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PROXY_WINDOW_CLOSED,{meta:{promptId:u.promptId}},l)))},1e3)}else this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PROXY_WINDOW_BLOCKED,{meta:{promptId:u.promptId}},l))}})}_buildPromptPermissionEventPack(e=null,s){const t={meta:{promptId:e}};return e&&s&&(t.meta.keywords=s),t}_buildClientFeedbackEventPack(e=null,s=[]){return{prompt:{id:e,keywords:s}}}}s.RegistrationService=new w},"./src/sdk/services/user-debug.service.ts":function(e,s,t){"use strict";var i=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.UserDebugService=void 0;const g=t("./src/sdk/services/logging.service.ts"),o=t("./src/_utils/global-env.ts");s.UserDebugService=class{static shouldShowDebugPanel(){var e=(0,o.getLocation)();let s=!1;try{s="search"in e&&/(^|[?&#])((pushly_debug73485)|(push(ly)?_debug))=1(?=[&#]|$)/i.test(e.search)}catch(e){}return s}static showDebugPanel(b){return i(this,void 0,void 0,function*(){b.domain;const s=b.user,t=b.env;try{const p=t.document,l=p.createElement("style");p.head.appendChild(l),l.innerHTML=`
.sw-user-debug-drawer-wrapper {
  display: block !important;
  box-sizing: border-box;
  position: absolute;
  z-index: 7777;
  bottom: 120px;
  left: -320px;
  width: 320px;
  border: 1px solid #d9d9d9;
  border-left: none;
  box-shadow: 0 1px 4px #e9e9e9;
  background: #f5f5f7;
  transition: left .24s linear;
}
.sw-user-debug-drawer-wrapper.open {
  left: 0;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-shadow {
  visibility: hidden;
  border: none;
  box-shadow: none;
  outline: none;
  position: absolute;
  z-index: -1;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-shadow.copying {
  visibility: visible;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-handle {
  cursor: pointer;
  display: block;
  box-sizing: border-box;
  position: absolute;
  background: #0077a0;
  border-radius: 0 0 12px 12px;
  border: 1px solid #888;
  border-top: none;
  top: 50%;
  transform: translateY(-50%) rotate(-90deg);
  padding: 8px 38px 8px 38px;
  right: -90px;
  box-shadow: 0 1px 3px #e9e9e9;
  color: #fff;
  font-family: arial;
  font-size: 13px;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content {
  color: #545454;
  font-family: arial;
  font-size: 13px;
  padding: 14px;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-label {
  color: #949494;
  display: block;
  box-sizing: border-box;
  margin-bottom: 4px;
}
.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-value {
  display: block;
  word-break: break-all;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-puuid {
  border-bottom: 1px solid #d9d9d9;
  padding: 0 12px 6px;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-substate {
  border-bottom: 1px solid #d9d9d9;
  padding: 6px 12px;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-token {
  padding: 6px 12px 0;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-action-wrapper {
  text-align: right;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-copy-btn {
  display: inline-block;
  margin: 12px 12px 0;
  padding: 4px 14px;
  background: #0077a0;
  border-radius: 3px;
  color: #fff;
  transition: all .24s;
  cursor: pointer;
}
.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-copy-btn.success {
  background: green;
}
`.trim();var i,o=s.puuid,n=s.subscriberState.toString().replace(/(^.)/,e=>e.toUpperCase()),r="subscribed"===s.subscriberState?s.token:"N/A";let e="Unable to Resolve";try{t.isPushManagerInScope()?(i=(yield b.user.getComputedPushPermission(b)).subscription)&&(e=i.endpoint):e="N/A"}catch(e){}const u=p.createElement("div"),d=(u.classList.add("sw-user-debug-drawer-wrapper"),u.setAttribute("style","display:none;"),p.createElement("div")),c=(u.appendChild(d),d.classList.add("sw-user-debug-drawer"),p.createElement("div")),a=(d.appendChild(c),c.classList.add("sw-user-debug-drawer-handle"),c.onclick=()=>{u.classList.contains("open")?u.classList.remove("open"):u.classList.add("open")},c.innerHTML=`
<span class="sw-user-debug-label">
    Push SDK
</span>
`.trim(),p.createElement("div")),h=(d.appendChild(a),a.classList.add("sw-user-debug-drawer-content"),p.createElement("div")),m=(a.appendChild(h),h.classList.add("sw-user-debug-puuid"),h.innerHTML=`
<span class="sw-user-debug-label">
    Push User ID
</span>
<span class="sw-user-debug-value">
    ${o}
</span>
`.trim(),p.createElement("div")),v=(a.appendChild(m),m.classList.add("sw-user-debug-substate"),m.innerHTML=`
<span class="sw-user-debug-label">
    Subscriber State
</span>
<span class="sw-user-debug-value">
    ${n}
</span>
`.trim(),p.createElement("div")),y=(a.appendChild(v),v.classList.add("sw-user-debug-token"),v.innerHTML=`
<span class="sw-user-debug-label">
    Subscriber Token
</span>
<span class="sw-user-debug-value">
    ${r}
</span>
`.trim(),p.createElement("input")),f=(u.appendChild(y),y.classList.add("sw-user-debug-shadow"),y.type="textarea",y.defaultValue=`
Push User ID: ${o}, \r

Subscriber State: ${n}, \r

Token: ${r}, \r

Endpoint: ${e}, \r

Browser Permissions: ${(yield b.user.getComputedPushPermission(b)).permission}, \r

UserAgent: ${t.userAgent}
`.trim(),p.createElement("div")),_=(a.appendChild(f),f.classList.add("sw-user-debug-action-wrapper"),p.createElement("div"));f.appendChild(_),_.classList.add("sw-user-debug-copy-btn"),_.innerText="Copy",_.onclick=()=>{y.classList.add("copying"),y.select(),p.execCommand("copy"),y.classList.remove("copying"),_.classList.add("success"),setTimeout(()=>{_.classList.remove("success")},240)},p.body.appendChild(u)}catch(e){g.Logger.warn(e)}})}}},"./src/sdk/services/user.service.ts":function(e,s,t){"use strict";var p=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.UserService=void 0;const r=t("./src/sdk/services/helpers/user-profile.service-helpers.ts"),i=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),l=t("./src/sdk/data-providers/cookie.data-provider.ts"),o=t("./src/sdk/repositories/subscription.repository.ts"),u=t("./src/sdk/enums/event-type.enum.ts"),d=t("./src/_utils/global-env.ts"),n=t("./src/sdk/repositories/application.repository.ts"),c=t("./src/sdk/services/logging.service.ts"),a=t("./src/sdk/services/registration.service.ts");var h=t("./src/sdk/models/events/eventable.model.ts");const m=t("./src/sdk/models/events/event.model.ts"),v=t("./src/sdk/repositories/user.repository.ts"),y=t("./src/sdk/constants.ts"),f=t("./src/sdk/enums/steamable-event-type.enum.ts"),_=t("./src/sdk/utils.ts"),b=t("./src/sdk/services/worker.service.ts");class g extends h.EventableModel{constructor(){super(...arguments),this.userProfileEventsWired=!1}loadUser(e,i){return p(this,void 0,void 0,function*(){let e=yield v.UserRepository.get();var s=!e.puuid;let t;return i.env.inWorkerGlobalScope()||(t=i.env.getQueryString()[y.PUSHLY_UNIQUE_USER_ID_QS]),e.env=i.env,s&&(e.puuid=t||(0,_.randomString)()),e.puuid&&/undefined/i.test(e.puuid.toString())&&(e.puuid=(0,_.randomString)()),i.domain.isEventOnlyMode()||!(yield v.UserRepository.getPromptDismissedState())&&e.isDismissed()&&(e.subscriberState="none"),yield v.UserRepository.set(e),e})}reloadUserWithCachePriority(s){return p(this,void 0,void 0,function*(){var e=yield v.UserRepository.getWithCachePriority();return s.puuid=e.puuid||s.puuid,s.subscriberState=e.subscriberState||s.subscriberState,s.token=e.token||s.token,s})}wireProfileEvents(s){if(!this.userProfileEventsWired){this.userProfileEventsWired=!0;const e=[u.EventType.PROFILE_UPDATE,u.EventType.PROFILE_UPDATE_EXTERNAL_ID,u.EventType.PROFILE_DEREGISTER_EXTERNAL_ID,u.EventType.PROFILE_UPDATE_USER_EVENT,u.EventType.PROFILE_UPDATE_TAGS,u.EventType.PROFILE_APPEND,u.EventType.PROFILE_REMOVE,u.EventType.PAGE_TAG_VISIT,u.EventType.VIEW_ITEM,u.EventType.SAVE_ITEM,u.EventType.ADD_TO_CART,u.EventType.UPDATE_CART_ITEM,u.EventType.PURCHASE,u.EventType.REQUEST_USER_DELETION];e.forEach(e=>{this._wireProfileEvent(s,e)})}}verifyUserSubscriptionState(r){return p(this,void 0,void 0,function*(){const s=r.env,e=r.domain,t=r.user;if(e.isEventOnlyMode())c.Logger.info("Skipping user subscription state verification while in event only mode");else{c.Logger.info("Verifying user subscription state");let e;(s.isHTTPS()||s.isDevMode())&&(e=yield r.user.getComputedPushPermission(r));var i=l.CookieDataProvider.get("_pnss"),o="subscribed"===(t.subscriberState=i),n="dismissed"===i;"blocked"===i?!(r.env.isSafari()&&"PushManager"in(0,d.getSelf)())&&e&&"denied"!==e.permission?"granted"===e.permission&&e.host===(0,d.getSelf)().location.hostname?yield a.RegistrationService.performManualRegistrationAttempt(r,t.lastSeenPromptId):"default"===e.permission&&this.setSubscriptionState(t,"none"):("blocked"!==t.subscriberState&&(t.subscriberState="blocked"),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DENIED)),this.debugPromptNotShown(r,"user_permission_denied")):n?e&&"default"!==e.permission?"granted"===e.permission&&e.host===(0,d.getSelf)().location.hostname?yield a.RegistrationService.performManualRegistrationAttempt(r,t.lastSeenPromptId):"denied"===e.permission&&(yield this.setSubscriptionState(t,"blocked"),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DENIED)),this.debugPromptNotShown(r,"user_permission_denied")):("dismissed"!==t.subscriberState&&(t.subscriberState="dismissed"),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DISMISSED)),this.debugPromptNotShown(r,"user_permission_dismissed")):o?e&&"granted"!==e.permission?"default"===e.permission?(yield this.setSubscriptionState(t,"none"),yield a.RegistrationService.unsubscribe(r,"none")):"denied"===e.permission&&(t.token=null,yield a.RegistrationService.unsubscribe(r),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DENIED)),this.debugPromptNotShown(r,"user_permission_denied")):"subscribed"!==t.subscriberState&&(t.subscriberState="subscribed"):e&&"default"!==e.permission?"granted"===e.permission?(t.subscriberState="subscribed",e.host===(0,d.getSelf)().location.hostname&&(yield a.RegistrationService.performManualRegistrationAttempt(r,t.lastSeenPromptId))):"denied"===e.permission&&(yield this.setSubscriptionState(t,"blocked"),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DENIED)),this.debugPromptNotShown(r,"user_permission_denied")):"none"!==t.subscriberState&&(t.subscriberState="none")}"none"===t.subscriberState?c.Logger.info("Subscription state is currently set to none."):"subscribed"===t.subscriberState?c.Logger.info("Subscription state is currently set to subscribed."):"dismissed"===t.subscriberState?c.Logger.info("Subscription state is currently set to dismissed."):"blocked"===t.subscriberState&&c.Logger.info("Subscription state is currently set to blocked."),yield v.UserRepository.set(t)})}setExternalId(e,s){return p(this,void 0,void 0,function*(){e.externalId=s,yield v.UserRepository.set(e)})}saveExternalId(e,s){return p(this,void 0,void 0,function*(){yield this.setExternalId(e.user,s),yield r.UserProfileServiceHelpers.saveExternalUserId(e,s)})}setToken(e,s){return p(this,void 0,void 0,function*(){e.token=s,yield v.UserRepository.set(e)})}setSubscriptionState(e,s,t,i){return p(this,void 0,void 0,function*(){c.Logger.info("Updating subscriber state to "+s),e.subscriberState=s,t?e.token=t:t=null,yield v.UserRepository.set(e),"dismissed"===e.subscriberState&&i&&(yield v.UserRepository.setPromptDismissedState(e,i))})}setLastSeenPromptId(e,s){return p(this,void 0,void 0,function*(){e.lastSeenPromptId=s,yield v.UserRepository.set(e)})}setPromptState(e,s,t,i){return p(this,void 0,void 0,function*(){e.promptFcapSeconds=s,e.promptCountState=t,yield v.UserRepository.setPromptState(e,i)})}clearPromptFcapState(){return p(this,void 0,void 0,function*(){yield v.UserRepository.clearPromptState()})}setPromptDismissed(e,s){return p(this,void 0,void 0,function*(){yield v.UserRepository.setPromptDismissedState(e,s)})}setLastReferrerState(e,s){return p(this,void 0,void 0,function*(){e.lastReferrerState={referrer:s,lastSetAt:(new Date).getTime()},yield v.UserRepository.set(e)})}clearLastReferrerState(e){return p(this,void 0,void 0,function*(){delete e.lastReferrerState,yield v.UserRepository.set(e)})}handleUdrRequest(t){return p(this,void 0,void 0,function*(){var e=t.env,s=!!e&&!!l.CookieDataProvider.get("_pnudr");l.CookieDataProvider.set("_pnudr","1"),s?c.Logger.warn("User deletion has already been requested."):(yield this.post(new i.SubscriberStreamableEventModel(f.StreamableEventType.UDR,{},t)),yield o.SubscriptionRepository.unregister(t),n.ApplicationRepository.purgeCookies(),v.UserRepository.purgeCookies(),this.dispatch(new m.EventModel(u.EventType.USER_DELETION_REQUEST,void 0,t.app.loadConfig,e)))})}handleUdrRevert(e){return p(this,void 0,void 0,function*(){l.CookieDataProvider.clear("_pnudr"),yield b.WorkerService.unregisterWorker(e),yield a.RegistrationService.performManualRegistrationAttempt(e,e.user.lastSeenPromptId),c.Logger.warn("User deletion reverted")})}processUdr(){return p(this,void 0,void 0,function*(){return v.UserRepository.purgeCookies()})}_wireProfileEvent(o,n){this.watch(n,t=>{const i=()=>p(this,void 0,void 0,function*(){if(o.app&&o.app.isLoaded){var e=yield o.user.getComputedPushPermission(o);if((e.subscription||e.deviceToken||o.domain.isEventOnlyMode())&&(yield o.user.isSubscribed(o)))try{switch(n){case u.EventType.PROFILE_UPDATE:yield r.UserProfileServiceHelpers.saveUserProfileData(o,t);break;case u.EventType.PROFILE_UPDATE_EXTERNAL_ID:yield this.setExternalId(o.user,t),yield r.UserProfileServiceHelpers.saveExternalUserId(o,t);break;case u.EventType.PROFILE_DEREGISTER_EXTERNAL_ID:yield this.setExternalId(o.user,null),yield r.UserProfileServiceHelpers.deregisterExternalUserId(o);break;case u.EventType.PROFILE_UPDATE_USER_EVENT:yield r.UserProfileServiceHelpers.saveUserEvent(o,t);break;case u.EventType.PROFILE_UPDATE_TAGS:yield r.UserProfileServiceHelpers.saveUserTags(o,t);break;case u.EventType.PROFILE_APPEND:yield r.UserProfileServiceHelpers.appendProfileArrayValue(o,t);break;case u.EventType.PROFILE_REMOVE:yield r.UserProfileServiceHelpers.removeProfileArrayValue(o,t);break;case u.EventType.PAGE_TAG_VISIT:t=Array.isArray(t)?t:[t],yield r.UserProfileServiceHelpers.pageTagVisit(o,t);break;case u.EventType.VIEW_ITEM:yield r.UserProfileServiceHelpers.viewItem(o,t);break;case u.EventType.SAVE_ITEM:yield r.UserProfileServiceHelpers.saveItem(o,t);break;case u.EventType.ADD_TO_CART:yield r.UserProfileServiceHelpers.addToCart(o,t);break;case u.EventType.UPDATE_CART_ITEM:yield r.UserProfileServiceHelpers.updateCartItem(o,t);break;case u.EventType.PURCHASE:yield r.UserProfileServiceHelpers.purchase(o,t);break;case u.EventType.REQUEST_USER_DELETION:yield this.handleUdrRequest(o)}}catch(e){c.Logger.error(o,e)}else{let e=!0,s;if(n===u.EventType.PROFILE_UPDATE_EXTERNAL_ID?(s=t,e=!1):t instanceof Object&&"external_id"in t&&(s=t.external_id),s&&(yield this.setExternalId(o.user,s)),e){let e,s;e=this.watchOnce(u.EventType.REGISTRATION_SUBSCRIBED,()=>{s&&s(),i()}),s=this.watchOnce(u.EventType.REGISTRATION_MIGRATED,()=>{e&&e(),i()})}}}else this.watchOnce(u.EventType.APPLICATION_LOADED,i)});i()})}}s.UserService=new g},"./src/sdk/services/worker.service.ts":function(e,s,t){"use strict";var o=this&&this.__awaiter||function(e,r,p,l){return new(p=p||Promise)(function(t,s){function i(e){try{n(l.next(e))}catch(e){s(e)}}function o(e){try{n(l.throw(e))}catch(e){s(e)}}function n(e){var s;e.done?t(e.value):((s=e.value)instanceof p?s:new p(function(e){e(s)})).then(i,o)}n((l=l.apply(e,r||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.WorkerService=void 0;const n=t("./src/sdk/constants.ts"),r=t("./src/sdk/services/logging.service.ts"),i=t("./src/_utils/service-worker-registration.ts"),p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/enums/event-type.enum.ts"),u=t("./src/sdk/repositories/application.repository.ts");var d=t("./src/sdk/models/events/eventable.model.ts");const c=t("./src/sdk/exceptions/worker-registration.exception.ts");class a extends d.EventableModel{_installPushlyServiceWorker(t){return o(this,void 0,void 0,function*(){const e=t.env.navigator;var s=(0,i.getPushlyWorkerConfig)(t);return e.serviceWorker.register(s.installationPath,{updateViaCache:"none",scope:s.scope})})}unregisterWorker(s){return o(this,void 0,void 0,function*(){const e=yield(0,i.getPushlyServiceWorkerRegistration)(s);e&&(yield e.unregister())})}registerWorker(s){return o(this,void 0,void 0,function*(){let e=null;try{(e=yield(0,i.getPushlyServiceWorkerRegistration)(s))||(r.Logger.info("Registering new ServiceWorker"),e=yield this._installPushlyServiceWorker(s),this.dispatch(new p.EventModel(l.EventType.SW_INSTALLED,{registration:e}))),yield u.ApplicationRepository.set(s.app),this.dispatch(new p.EventModel(l.EventType.SW_SETUP_COMPLETE,{registration:e}))}catch(e){throw r.Logger.warn({type:e.type,code:e.code,message:e.message,error:e}),new c.WorkerRegistrationException(e)}return e})}loadServiceWorkerDependencyScript(i){return o(this,void 0,void 0,function*(){const e=i.env.document;if(e&&e.body){const s=e.createElement("script"),t=(s.onload=()=>{r.Logger.info("ServiceWorker dependency script loaded")},s.async=!0,s.src=n.SW_DEPENDENCY_URL,e.getElementsByTagName("script")[0]);t.parentNode.insertBefore(s,t)}})}}s.WorkerService=new a},"./src/sdk/utils.ts":(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.tryParseJSON=s.parseQueryString=s.hashFromString=s.isProductionBuild=s.simpleUnHash=s.simpleHash=s.atobShim=s.delayRandom=s.delay=s.tryParseInt=s.randomString=s.retryFetch=void 0;var i=t("./src/common/utils.ts");Object.defineProperty(s,"retryFetch",{enumerable:!0,get:function(){return i.retryFetch}}),Object.defineProperty(s,"randomString",{enumerable:!0,get:function(){return i.randomString}}),Object.defineProperty(s,"tryParseInt",{enumerable:!0,get:function(){return i.tryParseInt}}),Object.defineProperty(s,"delay",{enumerable:!0,get:function(){return i.delay}}),Object.defineProperty(s,"delayRandom",{enumerable:!0,get:function(){return i.delayRandom}});const o=t("./src/sdk/constants.ts");s.atobShim=e=>{let s="";try{if("string"==typeof(s=window.atob(e)))return s}catch(e){}s="";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(e))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");e+="==".slice(2-(3&e.length));let i,o,n,r=0;for(;r<e.length;)i=t.indexOf(e.charAt(r++))<<18|t.indexOf(e.charAt(r++))<<12|(o=t.indexOf(e.charAt(r++)))<<6|(n=t.indexOf(e.charAt(r++))),s+=64===o?String.fromCharCode(i>>16&255):64===n?String.fromCharCode(i>>16&255,i>>8&255):String.fromCharCode(i>>16&255,i>>8&255,255&i);return s},s.simpleHash=e=>window.btoa(JSON.stringify(e)),s.simpleUnHash=e=>(0,s.tryParseJSON)((0,s.atobShim)(e)),s.isProductionBuild=()=>"production"===o.ENV_NAME||"prod"===o.ENV_NAME,s.hashFromString=e=>{let s=5381,t=e.length;for(;t;)s=33*s^e.charCodeAt(--t);return s>>>0},s.parseQueryString=e=>{e=e.split("?").pop().split("&");let s={};try{for(var t of e){const i=t.split("=");i[0]&&(i[1]=i[1]?i[1].replace(/\+/gi," "):"",s[i[0]]=decodeURIComponent(i[1]))}}catch(e){}return s};s.tryParseJSON=e=>{let s;try{s=JSON.parse(e)}catch(e){}return s}}},i={};function p(e){var s=i[e];if(void 0!==s)return s.exports;s=i[e]={id:e,exports:{}};return t[e].call(s.exports,s,s.exports,p),s.exports}p.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return p.d(s,{a:s}),s},p.d=(e,s)=>{for(var t in s)p.o(s,t)&&!p.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},p.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p.nc=void 0;var l={};(()=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});var s=p("./src/sdk/exceptions/pushly.exception.ts");const e=p("./src/sdk/models/context.model.ts"),t=p("./src/sdk/sdk.ts"),i=p("./src/sdk/services/logging.service.ts");p("./src/_utils/flatmap.ts");try{const r=new t.SDK(new e.ContextModel);var o=window.PushlySDK;if(o&&o instanceof Array)for(var n of o)r.push(n);window.PushlySDK=r}catch(e){if(!(e instanceof s.PushlyException))throw e;console.log(e),i.Logger.warn("[pushly-sdk]",e.message)}})()})();

(function(){
PushlySDK.watch('ready', () => {
    try {
        let qs = document.querySelectorAll('script[type="application/ld+json"]');

        if (qs.length) {
            let keywords = [];

            qs.forEach(jsld => {
                const node = JSON.parse(jsld.innerText);
                if (node['@type'] === 'NewsArticle') {
                    if ('keywords' in node) {
                        keywords.push(...node['keywords'].split(','));
                    }
                } else if (node['@type'] === 'Dataset') {
                    if ('vertical' in node) {
                        keywords.push(node['vertical']);
                    }

                    if ('subSection' in node) {
                        keywords.push(node['subSection']);
                    }
                }
            });

            if (keywords.length) {
                PushlySDK.push(['page_tag_visit', [...new Set(keywords.map(v => v.trim().toLowerCase()))]]);
            }
        }
    } catch(e) {}
});

})();