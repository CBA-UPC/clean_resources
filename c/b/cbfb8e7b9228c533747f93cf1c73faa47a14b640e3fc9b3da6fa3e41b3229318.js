!function(){"use strict";const t="exponea",e="v3.17.0",n="true"===String(!0),r="__exponea_etc__",i="__exponea_time2__",o="__exponea_tracking_definition__",s="__exponea_banner_event__",a="__exponea_experiment_event__",c="__exponea_last_session_ping_timestamp__",u="__exponea_last_session_start_timestamp__",l="exponea",h="Exponea",p="__exponea_ab_",d="__exponea_safari_push_subscribed__",f="__exponea__sync_modifications__",g="browser_push_notification",m="browser_push_notification_vapid_key",v="snippetVersion",y="exponea-editor-params",b="exponea-experiments-editor",_="/editor/index.html?timestamp=",w="/editor/",k=["runtime","polyfills","vendor","main"],x="webxpClient";function S(t,e,n){t._&&t._.forEach((t=>{const r=t[0],i=t[1];if(r.includes(".")){const t=r.split("."),o=t[0],s=t[1];if(!(o in e))return n.error(`Failed to replay function call ${r}`),void n.error(`${o} does not exist on the object`);try{e[o][s].apply(e[o],i)}catch(t){n.error(`Failed to replay function call ${r}`,t)}}else try{e[r].apply(e,i)}catch(t){n.error(`Failed to replay function call ${r}`,t)}}))}function E(t,e,n){t.forEach(()}function T(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function C(t){return function(e,n,r){for(var i=-1,o=Object(e),s=r(e),a=s.length;a--;){var c=s[t?a:++i];if(!1===n(o[c],c,o))break}return e}}var A=C();var O="object"==typeof global&&global&&global.Object===Object&&global,j="object"==typeof self&&self&&self.Object===Object&&self,P=O||j||Function("return this")(),L=P.Symbol,I=Object.prototype,B=I.hasOwnProperty,z=I.toString,R=L?L.toStringTag:void 0;var F=Object.prototype.toString;var D=L?L.toStringTag:void 0;unction N(t){return null!=t&&"object"==typeof t}ar q=Object.prototype,W=q.hasOwnProperty,$=q.propertyIsEnumerable,H=U(function(){return arguments}())?U:function(t){return N(t)&&W.call(t,"callee")&&!$.call(t,"callee")},V=H,G=Array.isArray;var K="object"==typeof exports&&exports&&!exports.nodeType&&exports,Q=K&&"object"==typeof module&&module&&!module.nodeType&&module,J=Q&&Q.exports===K?P.Buffer:void 0,Z=(J?J.isBuffer:void 0)||function(){return!1},Y=/^(?:0|[1-9]\d*)$/;r et={};function nt(t){return function(e){return t(e)}}et["[object Float32Array]"]=et["[object Float64Array]"]=et["[object Int8Array]"]=et["[object Int16Array]"]=et["[object Int32Array]"]=et["[object Uint8Array]"]=et["[object Uint8ClampedArray]"]=et["[object Uint16Array]"]=et["[object Uint32Array]"]=!0,et["[object Arguments]"]=et["[object Array]"]=et["[object ArrayBuffer]"]=et["[object Boolean]"]=et["[object DataView]"]=et["[object Date]"]=et["[object Error]"]=et["[object Function]"]=et["[object Map]"]=et["[object Number]"]=et["[object Object]"]=et["[object RegExp]"]=et["[object Set]"]=et["[object String]"]=et["[object WeakMap]"]=!1;var rt="object"==typeof exports&&exports&&!exports.nodeType&&exports,it=rt&&"object"==typeof module&&module&&!module.nodeType&&module,ot=it&&it.exports===rt&&O.process,st=function(){try{var t=it&&it.require&&it.require("util").types;return t||ot&&ot.binding&&ot.binding("util")}catch(t){}}(),at=st&&st.isTypedArray,ct=at?nt(at):function(t){return N(t)&&tt(t.length)&&!!et[M(t)]},ut=Object.prototype.hasOwnProperty;ar ht=Object.prototype;function pt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ht)}function dt(t,e){return function(n){return t(e(n))}}var ft=dt(Object.keys,Object),gt=Object.prototype.hasOwnProperty;function mt(t){if(!pt(t))return ft(t);var e=[];for(var n in Object(t))gt.call(t,n)&&"constructor"!=n&&e.push(n);return e}ction _t(t){return bt(t)?lt(t):mt(t)}function wt(t,e){return t&&A(t,e,_t)}function kt(t,e){return function(n,r){if(null==n)return n;if(!bt(n))return t(n,r);for(var i=n.length,o=e?i:-1,s=Object(n);(e?o--:++o<i)&&!1!==r(s[o],o,s););return n}}var xt=kt(wt);function St(t){return t}function Et(t){return"function"==typeof t?t:St}nction At(t,e){for(var n=t.length;n--;)if(Ct(t[n][0],e))return n;return-1}var Ot=Array.prototype.splice;function jt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}jt.prototype.clear=function(){this.__data__=[],this.size=0},jt.prototype.delete=function(t){var e=this.__data__,n=At(e,t);return!(n<0)&&(n==e.length-1?e.pop():Ot.call(e,n,1),--this.size,!0)},jt.prototype.get=jt.prototype.has=function(t){return At(this.__data__,t)>-1},jt.prototype.set=function(t,e){var n=this.__data__,r=At(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var Pt,Lt=P["__core-js_shared__"],It=(Pt=/[^.]+$/.exec(Lt&&Lt.keys&&Lt.keys.IE_PROTO||""))?"Symbol(src)_1."+Pt:"";var Bt=Function.prototype.toString;ar Rt=/^\[object .+?Constructor\]$/,Ft=Function.prototype,Dt=Object.prototype,Mt=Ft.toString,Nt=Dt.hasOwnProperty,Ut=RegExp("^"+Mt.call(Nt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");r $t=Wt(P,"Map"),Ht=Wt(Object,"create");var Vt=Object.prototype.hasOwnProperty;var Gt=Object.prototype.hasOwnProperty;function Kt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Qt(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Jt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Kt.prototype.clear=function(){this.__data__=Ht?Ht(null):{},this.size=0},Kt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Kt.prototype.get=Kt.prototype.has=Kt.prototype.set=Jt.prototype.clear=function(){this.size=0,this.__data__={hash:new Kt,map:new($t||jt),string:new Kt}},Jt.prototype.delete=function(t){var e=Qt(this,t).delete(t);return this.size-=e?1:0,e},Jt.prototype.get=function(t){return Qt(this,t).get(t)},Jt.prototype.has=function(t){return Qt(this,t).has(t)},Jt.prototype.set=function(t,e){var n=Qt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function Zt(t){var e=this.__data__=new jt(t);this.size=e.size}Zt.prototype.clear=function(){this.__data__=new jt,this.size=0},Zt.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Zt.prototype.get=function(t){return this.__data__.get(t)},Zt.prototype.has=function(t){return this.__data__.has(t)},Zt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof jt){var r=n.__data__;if(!$t||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Jt(r)}return n.set(t,e),this.size=n.size,this};function Yt(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Jt;++e<n;)this.add(t[e])}function Xt(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}Yt.prototype.add=Yt.prototype.push=Yt.prototype.has=function(t){return this.__data__.has(t)};ar ee=P.Uint8Array;function ne(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function re(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var ie=L?L.prototype:void 0,oe=ie?ie.valueOf:void 0;function se(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function ae(t,e,n){var r=e(t);return G(t)?r:se(r,n(t))}function ce(){return[]}var ue=Object.prototype.propertyIsEnumerable,le=Object.getOwnPropertySymbols,he=le?ce,pe=he;function de(t){return ae(t,_t,pe)}var fe=Object.prototype.hasOwnProperty;var ge=Wt(P,"DataView"),me=Wt(P,"Promise"),ve=Wt(P,"Set"),ye=Wt(P,"WeakMap"),be="[object Map]",_e="[object Promise]",we="[object Set]",ke="[object WeakMap]",xe="[object DataView]",Se=zt(ge),Ee=zt($t),Te=zt(me),Ce=zt(ve),Ae=zt(ye),Oe=M;(ge&&Oe(new ge(new ArrayBuffer(1)))!=xe||$t&&Oe(new $t)!=be||me&&Oe(me.resolve())!=_e||ve&&Oe(new ve)!=we||ye&&Oe(new ye)!=ke)&&(Oe=;var je=Oe,Pe="[object Arguments]",Le="[object Array]",Ie="[object Object]",Be=Object.prototype.hasOwnProperty;nction Fe(t){return t==t&&!vt(t)} Ue=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qe=/^\w*$/;function We(t,e){if(G(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Ne(t))||(qe.test(t)||!Ue.test(t)||null!=e&&t in Object(e))}e.Cache=Jt;var He,Ve,Ge,Ke=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qe=/\\(\\)?/g,Je=(He=Ve=$e(He,(),Ge=Ve.cache,Ve),Ze=Je;function Ye(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Xe=L?L.prototype:void 0,tn=Xe?Xe.toString:void 0;nction rn(t,e){return G(t)?t:We(t,e)?[t]:Ze(nn(t))}ction cn(t,e){return null!=t&&e in Object(t)} pn=function(){try{var t=Wt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),dn=pn;function fn(t,e,n){"__proto__"==e&&dn?dn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}class gn{constructor(t){this.cookies=t}getAbTest(t,e){const n=`${p}${t}__`;let r=this.cookies.getCookie(n);return r||(r=this._selectAbTestVariant(e)),this.cookies.setCookie(n,r,"ab_test"),r}_selectAbTestVariant(t,e=Math.random()){let n=0;const r=t,(),i=e*n;return r,hn((),wt)}}
/*!
     * Sizzle CSS Selector Engine v@VERSION
     * http://sizzlejs.com/
     *
     * Copyright 2013 jQuery Foundation, Inc. and other contributors
     * Released under the MIT license
     * http://jquery.org/license
     *
     * Date: @DATE
     */var mn=function(t){var e,n,r,i,o,s,a,c,u,l,h,p,d,f,g,m,v,y,b,_="sizzle"+-new Date,w=t.document,k=0,x=0,S=it(),E=it(),T=it(),C=A="undefined",O=1<<31,j={}.hasOwnProperty,P=[],L=P.pop,I=P.push,B=P.push,z=P.slice,R=P.indexOf||F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",D="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+D+"*("+M+")(?:"+D+"*([*^$|!~]?=)"+D+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+D+"*\\]",U=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",q=new RegExp("^"+D+"+|((?:^|[^\\\\])(?:\\\\.)*)"+D+"+$","g"),W=new RegExp("^"+D+"*,"+D+"*"),$=new RegExp("^"+D+"*([>+~]|"+D+")"+D+"*"),H=new RegExp("="+D+"*([^\\]'\"]*?)"+D+"*\\]","g"),V=new RegExp(U),G=new RegExp("^"+M+"$"),K={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+D+"*(even|odd|(([+-]|)(\\d*)n|)"+D+"*(?:([+-]|)"+D+"*(\\d+)|))"+D+"*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^"+D+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+D+"*((?:-\\d)?\\d*)"+D+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,tt=/'|\\/g,et=new RegExp("\\\\([\\da-f]{1,6}"+D+"?|("+D+")|.)","ig"),nt=try{B.apply(P=z.call(w.childNodes),w.childNodes),P[w.childNodes.length].nodeType}catch(t){B={apply:P.length?}=rt.support={},o=rt.isXML=p=rt.setDocument=function(t){var e,i=t?t.ownerDocument||t:w,s=i.defaultView;return i!==d&&9===i.nodeType&&i.documentElement?(d=i,f=i.documentElement,g=!o(i),s&&s!==s.top&&(s.addEventListener?s.addEventListener("unload",(function(){p()}),!1):s.attachEvent&&s.attachEvent("onunload",()),n.attributes=st((),n.getElementsByTagName=st((),n.getElementsByClassName=Z.test(i.getElementsByClassName),n.getById=st((),n.getById?(r.find.ID=r.filter.ID=:(delete r.find.ID,r.filter.ID=,r.find.TAG=n.getElementsByTagName?r.find.CLASS=n.getElementsByClassName&&v=[],m=[],(n.qsa=Z.test(i.querySelectorAll))&&(st((),st(()),(n.matchesSelector=Z.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&st((),m=m.length&&new RegExp(m.join("|")),v=v.length&&new RegExp(v.join("|")),e=Z.test(f.compareDocumentPosition),b=e||Z.test(f.contains)?C=e?i):d},rt.matches=rt.matchesSelector=rt.contains=rt.attr=rt.error=rt.uniqueSort=i=rt.getText=r=rt.selectors={cacheLength:50,createPseudo:ot,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:CHILD:PSEUDO:,filter:{TAG:CLASS:ATTR:CHILD:PSEUDO:,pseudos:{not:ot((),has:ot((),contains:ot((),lang:ot((),target:root:function(t){return t===f},focus:enabled:function(t){return!1===t.disabled},disabled:checked:selected:empty:parent:header:function(t){return J.test(t.nodeName)},input:button:text:first:ht((),last:ht((),eq:ht((),even:ht((function(t,e){for(var n=0;n<e;n+=2)t.push(n);return t})),odd:ht((),lt:ht((),gt:ht(()}},r.pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[e]=ut(e);for(e in{submit:!0,reset:!0})r.pseudos[e]=lt(e);function dt(){} dt.prototype=r.filters=r.pseudos,r.setFilters=new dt,s=rt.tokenize=a=rt.compile=c=rt.select=n.sortStable=_.split("").sort(C).join("")===_,n.detectDuplicates=!!h,p(),n.sortDetached=st((),st(()||at("type|href|height|width",(),n.attributes&&st(()||at("value",(),st(()||at(F,(),rt}(window);class vn{constructor(t,e){this.reporter=t,this.documentContentLoaded=e}materializeValue(t,e){if("constant"===t.type)return t.value;try{let n,r;if(r="string"==typeof t.selector?{selector:t.selector,type:"css"}:t.selector,"target"===r.type){if(null==e)return null;n=[e]}else if("target_css"===r.type){if(null==e)return null;n=mn(r.selector,e)}else n=mn(r.selector);if(0===n.length)return null;const i=this._fetchRawValueFromElementList(t,n);return this._applyValueConverter(i,t.converter)}catch(t){if(!(t instanceof Error))throw t}return null}materializeProperties(t,e,n){this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{const r={};t.forEach((({key:t,value:n})=>{r[t]=this.materializeValue(n,e)})),n(r)}))}materializeIds(t,e,n){this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{if("anonymous"===t.type)n({});else if("registered"===t.type){const r=this.materializeValue(t.id,e);n(null===r?{}:{registered:r})}}))}_fetchRawValueFromElementList(t,e){const n=e[0];return n instanceof Element?"from_html"===t.type?n.innerHTML:"value"===t.attribute&&n instanceof HTMLInputElement?""!==n.value?n.value:null:n.getAttribute(t.attribute):null}_applyValueConverter(t,e){return t&&e&&"replace"===e.type?t.replace(new RegExp(e.regex,"gm"),e.replace):t}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */ wn=Object.prototype.hasOwnProperty;r Sn=Object.prototype.hasOwnProperty;function En(t){if(!vt(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=pt(t),n=[];for(var r in t)("constructor"!=r||!e&&Sn.call(t,r))&&n.push(r);return n}ar Cn="object"==typeof exports&&exports&&!exports.nodeType&&exports,An=Cn&&"object"==typeof module&&module&&!module.nodeType&&module,On=An&&An.exports===Cn?P.Buffer:void 0,jn=On?On.allocUnsafe:void 0;function Pn(t,e){if(e)return t.slice();var n=t.length,r=jn?jn(n):new t.constructor(n);return t.copy(r),r}function Ln(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var In=dt(Object.getPrototypeOf,Object),Bn=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)se(e,pe(t)),t=In(t);return e}:ce,zn=Bn;function Rn(t){return ae(t,Tn,zn)}var Fn=Object.prototype.hasOwnProperty;function Dn(t){var e=new t.constructor(t.byteLength);return new ee(e).set(new ee(t)),e}var Mn=/\w*$/;var Nn=L?L.prototype:void 0,Un=Nn?Nn.valueOf:void 0;function qn(t,e){var n=e?Dn(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}ar $n=Object.create,Hn=),Vn=Hn;function Gn(t){return"function"!=typeof t.constructor||pt(t)?{}:Vn(In(t))}var Kn=st&&st.isMap,Qn=Kn?nt(Kn):function(t){return N(t)&&"[object Map]"==je(t)};var Jn=st&&st.isSet,Zn=Jn?nt(Jn):function(t){return N(t)&&"[object Set]"==je(t)},Yn="[object Arguments]",Xn="[object Function]",tr="[object Object]",er={};function nr(t,e,n,r,i,o){var s,a=1&e,c=2&e,u=4&e;if(n&&(s=i?n(t,r,i,o):n(t)),void 0!==s)return s;if(!vt(t))return t;var l=G(t);if(l){if(s=t),!a)return Ln(t,s)}else{var h=je(t),p=h==Xn||"[object GeneratorFunction]"==h;if(Z(t))return Pn(t,a);if(h==tr||h==Yn||p&&!i){if(s=c||p?{}:Gn(t),!a)return c?function(t,e){return xn(t,zn(t),e)}(t,function(t,e){return t&&xn(e,Tn(e),t)}(s,t)):function(t,e){return xn(t,pe(t),e)}(t,function(t,e){return t&&xn(e,_t(e),t)}(s,t))}else{if(!er[h])return i?t:{};s=Wn(t,h,a)}}o||(o=new Zt);var d=o.get(t);if(d)return d;o.set(t,s),Zn(t)?t.forEach((function(r){s.add(nr(r,e,n,r,t,o))})):Qn(t)&&t.forEach((function(r,i){s.set(i,nr(r,e,n,i,t,o))}));var f=l?void 0:(u?c?Rn:de:c?Tn:_t)(t);return T(f||t,(function(r,i){f&&(r=t[i=r]),kn(s,i,nr(r,e,n,i,t,o))})),s}er[Yn]=er["[object Array]"]=er["[object ArrayBuffer]"]=er["[object DataView]"]=er["[object Boolean]"]=er["[object Date]"]=er["[object Float32Array]"]=er["[object Float64Array]"]=er["[object Int8Array]"]=er["[object Int16Array]"]=er["[object Int32Array]"]=er["[object Map]"]=er["[object Number]"]=er[tr]=er["[object RegExp]"]=er["[object Set]"]=er["[object String]"]=er["[object Symbol]"]=er["[object Uint8Array]"]=er["[object Uint8ClampedArray]"]=er["[object Uint16Array]"]=er["[object Uint32Array]"]=!0,er["[object Error]"]=er[Xn]=er["[object WeakMap]"]=!1;var rr,ir,or;function sr(t){return nr(t,5)}function ar(t){Object.keys(t).forEach((e=>{switch(typeof t[e]){case"object":t[e]&&ar(t[e]);break;case"function":t[e]=String(t[e])}}))}unction ur(t,e=window){if(t%2)throw new Error("The length of the random string should be an even number!");const n=e.crypto||e.msCrypto;if(n&&n.getRandomValues&&Array.from){const e=new Uint8Array(t/2);return n.getRandomValues(e),Array.from(e,cr).join("")}let r="";for(let e=0;e<t/2;e++)r+=cr(Math.round(256*Math.random()));return r}function lr(t,e,n,r=""){if(!n)return"Other";const i=!!t.opr&&!!t.opr.addons||!!t.opera||/ OPR\//.test(n),o=!!!e.documentMode&&!!t.StyleMedia;
// @cc_on!@
if(i)return/Mini/.test(n)?"Opera Mini":"Opera";if(o)return"Microsoft Edge";return/SAMSUNG|SGH-[I|N|T]|GT-[I|P|N]|SM-[N|P|T|Z|G]|SHV-E|SCH-[I|J|R|S]|SPH-L/i.test(n)?"Samsung Browser":/Chrome/.test(n)?"Chrome":/Apple/.test(r)?/Mobile/.test(n)?"Mobile Safari":"Safari":/Android/.test(n)?"Android Mobile":/Konqueror/.test(n)?"Konqueror":/Firefox/.test(n)?"Firefox":/MSIE/.test(n)||/Trident/.test(n)?"Internet Explorer":/Gecko/.test(n)?"Mozilla":"Other"}function hr(t){if(!t)return"Other";const e={iPhone:"iPhone",iPad:"iPad",iPod:"iPod","Windows Phone":"Windows Phone",Android:"Android",BlackBerry:"(BlackBerry|BB10|PlayBook)"};for(const n in e){if(!e.hasOwnProperty(n))continue;if(new RegExp(e[n],"i").test(t))return n}return"Other"}function pr(t,e){return{os:(n=t.navigator.userAgent,n?/Windows/i.test(n)?/Phone/.test(n)?"Windows Mobile":"Windows":/(iPhone|iPad|iPod)/.test(n)?"iOS":/Android/.test(n)?"Android":/Mac/i.test(n)?"Mac OS X":/Linux/.test(n)?"Linux":"Other":"Other"),browser:lr(t,e,t.navigator.userAgent,t.navigator.vendor),device:hr(t.navigator.userAgent)};var n}function(t){t.str2ab8=t.str2ab16=(rr||(rr={})),function(t){t.Handler=class{constructor(t,e){this.window=t,this.debug=e,this.isInitialized=new Promise(()}initialize(){return _n(this,void 0,void 0,(function*(){if(!this.window.crypto||!this.window.crypto.subtle)return this.debug.log("Crypto API is not available in this browser, browser extension communication is disabled"),void this.resolveInitialization(!1);const t=rr.str2ab8(this.window.atob("MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEApOsQPnGejMMA3SWpmByzZaXlSla2IK2NLV11r4/Qd8MgjvT63cNkM/j3w2E/fCJ1C+cdDPTCZcXgUVFdSXvVAEmNscx/3SZBCvAfXVYUj3fkk00XPO425cSQ6368/fEoa8ocqFtHwSlHyaWZBerp6tfawkhvzJSk8sSfQB0slMyy/IsPQU/jwE9sCKjvPO3QcSTvslTyKSIVeVrxOMULA7HT2u9XaVzGd45l8KxdLfTd7o1XHBw2meA566tQ65Po/wy/3ycM7b8LXG6e+I7xCrHudTlLRVISkSx4Uh4XLJF47EwRIVCvtosY7AENjzLV56D9INCeVBv8GraYPtXJQ3iF65v4bPq8kjm+RNUWxzzLYpJ/tt5Utx5ZVogtN18iObVmw+sR+yY3rJOohUyPwSEhNRfQ9qGEJAImUuqOU6HSUHDD2QDfonsHKPwfEN1l5q3oyMIe73yjtulTUkk0MVPvV0F/v7kwLGZDyoskZ6aDuhSDJf/UTxCjzpbtuYX6VUQyid0X3Dr7fswvFn9ucZydNTW1ZOC/nszmu7Rl+Fk+OsEcTLM0CfZP+1n+bd17+UtIAl4rChmJGhEyz4c4/TFuACcaz8vlIeNZ+9MbXZ1VbI9kOB6roQzGQ2qpirKk1dtrV1Lb/6ODixSGtJ0ShcH7y0icxR8HK71j+oT4mN0CAwEAAQ==".trim())),e=this.window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["wrapKey"]),n=this.window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),r=Promise.all([e,n]).then((([t,e])=>this.window.crypto.subtle.wrapKey("raw",e,t,{name:"RSA-OAEP"})));this.keys=Promise.all([n,r]).then((),e.catch((t=>{this.debug.error("Failed to import the encryption key used in BrowserExtension.Handler:",t)})),n.catch((t=>{this.debug.error("Failed to generate the encryption key used in BrowserExtension.Handler:",t)})),r.catch((t=>{this.debug.error("Failed to wrap the encryption key used in BrowserExtension.Handler:",t)})),yield this.keys.then((,()}))}sendPayload(t,e={type:"success"},n=Date.now()){const r=ur(32,this.window),i=this.sendMessage({type:"payload",id:r,timestamp:n,state:e,payload:t});return t=>{(()=>{_n(this,void 0,void 0,(function*(){yield i,yield this.updateState(r,t)}))})()}}updateState(t,e){return _n(this,void 0,void 0,(function*(){yield this.sendMessage({type:"stateupdate",target:t,state:e})}))}sendMessage(t){return _n(this,void 0,void 0,(function*(){if(!(yield this.isInitialized))return;if(!this.keys)throw new Error("BrowserExtension.Handler's keys must be assigned when initialization is resolved!");const e=sr(t);ar(e);const n=rr.str2ab16(JSON.stringify(e)),r=this.window.crypto.getRandomValues(new Uint8Array(16)).buffer;let i,o,s;try{({aes:i,aesEncrypted:o}=yield this.keys)}catch(t){return}try{s=yield this.window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},i,n)}catch(t){return void this.debug.error("Failed to encrypt the data before sending it to the extension:",t)}try{this.window.postMessage({data:s,key:o,iv:r,version:"webxp-js-client-message:v2"},"*")}catch(t){this.debug.error("Failed to send the encrypted data:",t)}}))}}}(ir||(ir={})),or||(or={}));const fr=new RegExp("[?&]+xnpe_cmp=([^&]*)","gi");class gr{tCampaignClickTokenFromUrl(){if(this.debug.log("Getting campaign click token from the URL"),this.location.search){const t=this.location.search.match(fr);if(t)return t[0].split("=")[1]}return null}trackClickEventWithToken(t){const e=this.timestamp.getTimestamp();this.debug.log("Tracking campaign click with token",t),this.queue.enqueue({name:or.Clicks,prepareData:t=>({data:{company_id:this.config.getToken(),age:t-e,url:this.location.href,timestamp:this.time.isTimeInitialized()?this.timestamp.getTimestampWithOffset():void 0,properties:pr(this.window,this.document)}})})}}function mr(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}var vr=Math.max;var yr=dn?St,br=yr,_r=Date.now;var wr=br),kr=wr;unction Sr(t,e,n){if(!vt(n))return!1;var r=typeof e;return!!("number"==r?bt(n)&&X(e,n.length):"string"==r&&e in n)&&Ct(n[e],t)}var Er=Object.prototype,Tr=Er.hasOwnProperty,Cr=xr(();ar Or=Function.prototype,jr=Object.prototype,Pr=Or.toString,Lr=jr.hasOwnProperty,Ir=Pr.call(Object);nction Rr(t,e,n,r,i,o,s){var a=zr(t,n),c=zr(e,n),u=s.get(c);if(u)Ar(t,n,u);else{var l,h=o?o(a,c,n+"",t,e,s):void 0,p=void 0===h;if(p){var d=G(c),f=!d&&Z(c),g=!d&&!f&&ct(c);h=c,d||f||g?G(a)?h=a:N(l=a)&&bt(l)?h=Ln(a):f?(p=!1,h=Pn(c,!0)):g?(p=!1,h=qn(c,!0)):h=[]:Br(c)||V(c)?(h=a,V(a)?h=a):vt(a)&&!yt(a)||(h=Gn(c))):p=!1}p&&(s.set(c,h),i(h,c,r,o,s),s.delete(c)),Ar(t,n,h)}}r Mr,Nr=(Mr=xr(()),Ur=xr((),qr=/\s/;var Wr=/^\s+/;ar Hr=/^[-+]0x[0-9a-f]+$/i,Vr=/^0b[01]+$/i,Gr=/^0o[0-7]+$/i,Kr=parseInt;ar Jr=1/0;unction Yr(t){return t!=t}function Xr(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}ar ei=ni=Math.max,ri=Math.min;unction oi(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}var si=C(!0);var ai=kt((,!0); hi=Math.max;function pi(t,e,n,r){t=bt(t)?t:li(t),n=n&&!r?Zr(n):0;var i=t.length;return n<0&&(n=hi(i+n,0)),ui(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&t,e,n)>-1}var di=st&&st.isDate,fi=di?nt(di):gi=Object.prototype.hasOwnProperty;function mi(t,e){var n;return xt(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function vi(t,e){return t&&t.length?t,hn(e)):[]}const yi=94608e3,bi=94608e3,_i=Object.freeze({hide_class:"xnpe_async_hide",timeout:4e3,mode:"async"});class wi{constructor(t,e,n={}){this.database=t,this.logger=e,this.options=wi.DEFAULT_OPTIONS,this.extendOptions(n)}getOptions(){return this.options}getToken(){if("string"!=typeof this.options.token)throw new Error("The token in config object is not set!");return this.options.token}getNewExperimentsOptions(){const t=this.getOptions().new_experiments;return!!t&&(!0===t?_i:Cr(t,_i))}getActivityHandlerOptions(){const t=this.getOptions().ping.activity;return"object"==typeof t?t:{click:!0,key:!0,scroll:!0,move:!0}}extendOptions(t){void 0!==t.track_hash_changes&&this.logger.warn("Configuration option track_hash_changes is deprecated, use the spa_reloading.on_hash_change option instead"),this.options=Ur({},t,this.options)}sSpaReloadingEnabled(t){return!0===this.getOptions().spa_reloading||!1!==this.getOptions().spa_reloading[t]}storeInIndexedDB(){if(!this.database.isSupported())return Promise.reject(new Error("Database is not supported!"));const t=sr(this.getOptions());return ar(t),this.database.setItem("config",t)}}wi.DEFAULT_OPTIONS=Object.freeze({target:"//api.exponea.com",token:null,utm_always:!1,customer:{},ping:{enabled:!0,interval:120,activity:!1,properties:{}},lazy_merge:!1,track:{auto:!0,visits:!1,visits_query_params:["pers_position","pers_content"],activity:!1,unloads:!1,exits:!0,default_properties:{},google_analytics:!0},modify:{enabled:!0,overlay:!1,delay:500},cookies:{cross_subdomain:!0,retrieve_callback:null,expires:{tracking:yi,ab_test:bi,time:3600}},track_hash_changes:!0,transfer_identity:!0,error_reporting:"errors_only",debug:!1,utm_params:["utm_source","utm_medium","utm_campaign","utm_term","utm_content","gclid","campaign_id"],dependencies:{},webOptimization:!0,push:{safari:{websitePushID:null}},spa_reloading:!0,feature_flags:null,service_worker_path:"/service-worker.js",exposed_segments:{ttl:3e5,prefetch:!1,notify:!1,segmentation_processing_delay:5e3},compliance:{opt_in:!1},link_cookie:!1});class ki{constructor(t,e){this.config=t,this.http=e}rewardBandit(t,e,n,r){const i=this.config.getOptions().target;this.http.post(`${i}/webxp/bandits/reward`,{reward_token:t,value:e},{credentials:"omit",responseType:"text"}).then((t=>t.body)).then(n,r)}}var xi,Si,Ei,Ti,Ci;function Ai(t){return function(n,r,i){try{const o=i.type,s=i.operator,a=i.operands;if(xi.whitelist.indexOf(s)>-1)return function(t,e,n,r){const i=t[n];switch(r){case xi.isSet:return null!=i;case xi.isNotSet:return null==i;case xi.hasValue:return Oi(e)?(null==i?void 0:i.length)>0:i+""!="";case xi.hasNoValue:return Oi(e)?0===(null==i?void 0:i.length):i+""==""}return!1}(n,o,r,s);if(function(t){return"string"===t}(o))return function(t,n,r,i){if(-1===Si.whitelist.indexOf(r))return e(r,"string"),!1;const o=t[n]+"";let s;switch(r){case Si.equals:return o===i[0].value;case Si.doesNotEqual:return o!==i[0].value;case Si.isIn:return s=i.map((t=>t.value)),s.indexOf(o)>-1;case Si.isNotIn:return s=i.map((t=>t.value)),-1===s.indexOf(o);case Si.contains:return o.indexOf(i[0].value)>-1;case Si.doesNotContain:return-1===o.indexOf(i[0].value);case Si.startsWith:return o.startsWith(i[0].value);case Si.endsWith:return o.endsWith(i[0].value);case Si.matchesRegex:return null!==new RegExp(i[0].value).exec(o)}return!1}(n,r,s,a);if(function(t){return"number"===t}(o))return function(t,n,r,i){if(-1===Ei.whitelist.indexOf(r))return e(r,"number"),!1;const o=parseFloat(t[n]+""),s=parseFloat(i[0].value);switch(r){case Ei.equalTo:return o===s;case Ei.inBetween:return s<=o&&o<=parseFloat(i[1].value);case Ei.lessThan:return o<s;case Ei.greaterThan:return o>s}return!1}(n,r,s,a);if(function(t){return"boolean"===t}(o))return function(t,n,r,i){if(-1===Ti.whitelist.indexOf(r))return e(r,"boolean"),!1;const o=t[n]+"",s=i.value+"";if(r===Ti.is)return o===s;return!1}(n,r,s,i);((o)&&t.error("Value filter: Date type is not supported."),Oi(o)&&t.error("Value filter: List type is not supported.")}catch(e){t.debug("Value filter error:",e)}return t.debug("Invalid value filter:",i.operator),!1};function(t){t.isSet="is set",t.isNotSet="is not set",t.hasValue="has value",t.hasNoValue="has no value",t.whitelist=[t.isSet,t.isNotSet,t.hasValue,t.hasNoValue]}(xi||(xi={})),function(t){t.equals="equals",t.doesNotEqual="does not equal",t.isIn="in",t.isNotIn="not in",t.contains="contains",t.doesNotContain="does not contain",t.startsWith="starts with",t.endsWith="ends with",t.matchesRegex="regex",t.whitelist=[t.equals,t.doesNotEqual,t.isIn,t.isNotIn,t.contains,t.doesNotContain,t.startsWith,t.endsWith,t.matchesRegex]}(Si||(Si={})),function(t){t.equalTo="equal to",t.inBetween="in between",t.lessThan="less than",t.greaterThan="greater than",t.whitelist=[t.equalTo,t.inBetween,t.lessThan,t.greaterThan]}(Ei||(Ei={})),function(t){t.is="is",t.whitelist=[t.is]}(Ti||(Ti={}));class ji{constructor(t,e){this.contextualBandit=t,this.debug=e,this.optimizationTargets=[],this.eventFilterMatcher=Ai(this.debug)}put(t,e,n,r){if(""===t)throw new Error("Event type can't be an empty string");if(""===n)throw new Error("Reward token can't be an empty string");this.optimizationTargets.push({eventType:t,valueFilters:e,rewardToken:n,rewardWeight:r})}reward(t,e){const{matchingTargets:n,remainingTargets:r}=this.optimizationTargets.reduce(function(t,e,n){return function(r,i){return i.eventType!==n?(r.remainingTargets.push(i),r):i.valueFilters.reduce(((n,r)=>n&&e(t,r.attribute.property,r.constraint)),!0)?(r.matchingTargets.push(i),r):(r.remainingTargets.push(i),r)}}(t,this.eventFilterMatcher,e),{matchingTargets:[],remainingTargets:[]});n.forEach((),this.optimizationTargets=r}}function Pi(t){if("number"!=typeof t)return t;const e=new Date;return new Date(e.getTime()+1e3*t)}!function(t){t[t.defer=0]="defer",t[t.immediate=1]="immediate"}(Ci||(Ci={}));class Li{etCookie(t){const e=this.document.cookie?this.document.cookie.split("; "):[];for(let n=0,r=e.length;n<r;n++){const r=e[n].split("="),i=r.shift();if(i){const e=decodeURIComponent(i),n=r.join("=");if(t===e)return this.parseCookieValue(n)}}}setCookie(t,e,n){let r=this.config.getOptions().cookies.expires[n];r=Pi(r);const i=function(t,e=document.location.hostname){if(!t)return"";if(ui(t))return t;const n=e.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),r=n?n[0]:"";return r||""}(this.config.getOptions().cookies.cross_subdomain);this.document.cookie=[encodeURIComponent(t),"=",encodeURIComponent(e),"; expires="+r.toUTCString(),"; path=/",i?"; domain="+i:"","https:"===this.location.protocol?"; secure; samesite=none":"; samesite=lax"].join("")}sendCustomerCookieToServer(t){this.queue.enqueue({name:or.Ids,isBlocking:!0,prepareData:processResponse:t=>{this.debug.log("received customer ids response",t);const e=t.data,n=e.cookie;this.debug.log("cookie received from server is "+n),this.setTrackingCookie(n),this.config.extendOptions({customer:e}),this.segments.prefetch()}},{process:Ci.immediate})}setTrackingCookieetFreshTrackingCookie(){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,();return this.setTrackingCookie(t),t}sanitizeCookieOptions(){let t=this.config.getOptions().cookies.expires;function e(t,e,n,r,i){"number"==typeof e&&e>0||fi(e)&&e>new Date||("number"==typeof e?r.warn(`When specifying the number of seconds for cookies.expires.${t}, you have to use a positive number. You passed in '${e}'. The SDK will use the default value of ${n}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`):fi(e)?r.warn(`When specifying a Date for cookies.expires.${t}, you have to use a date in the future. You passed in '${e}'. The SDK will use the default value of ${n}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`):r.warn(`You can only use a number or a Date object for cookies.expires.${t}, not '${typeof e}'. The SDK will use the default value of ${n}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`),i.extendOptions({cookies:{expires:{[t]:n}}}))}vt(t)&&!fi(t)||(t={tracking:t,ab_test:t,time:t},this.config.extendOptions({cookies:{expires:t}})),e("tracking",t.tracking,yi,this.logger,this.config),e("ab_test",t.ab_test,bi,this.logger,this.config),e("time",t.time,3600,this.logger,this.config)}parseCookieValue(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(/\+/g," "))}catch(e){return this.debug.error("error while parsing cookie value, ignoring",e),t}}}function Ii(t,e){const n=t.getOptions().cookies.expires,r=ti(t.getOptions().customer);return delete r.cookie,{data:{project_id:t.getToken(),cookie:e.cookie,tifc:e.tifc,customer:r,expires:Math.floor(Pi(n.tracking).getTime()/1e3)}}}unction zi(){return function(t,e,n){const r=n.value,i=Date.now(),o=r.name;return n.value=function(){try{return r.apply(this,arguments)}catch(t){throw this.reporter.sendErrorReport(t,o,i),t}},n}}const Ri=Object.freeze({immediate:!1});class Fi{constructor(t,e,n,r,i,o,s,a,c,u,l,h,p){this.reporter=t,this.config=e,this.contextualBanditEventFilter=n,this.time=r,this.timestamp=i,this.queue=o,this.debug=s,this.document=a,this.location=c,this.initializeState=u,this.window=l,this.url=h,this.browserExtension=p,this.eventTrackingListeners=[]}track(t,e={},n={},r=!1){const i=this.timestamp.getTimestamp();this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{n=Cr(n,Ri);const r=Object.assign(Object.assign(Object.assign(Object.assign({location:this.location.href},pr(this.window,this.document)),this.getUtmParamsIfEnabled()),this.getTrackDefaultPropertiesIfEnabled()),e);this.contextualBanditEventFilter.reward(r,t);const o=this.browserExtension.sendPayload({type:"event",eventType:t,eventProperties:r},{type:"pending"});this.queue.enqueue({name:or.Events,prepareData:e=>{const n=this.config.getOptions().customer;this.debug.log("Tracking event: "+t,r);const o={customer_ids:n,company_id:this.config.getToken(),type:t,age:e-i,properties:r};this.time.isTimeInitialized()&&(o.timestamp=this.timestamp.getTimestampWithOffset());try{this.triggerEventTrackingListeners(t,r)}catch(t){this.debug.error("Error triggering event tracking listeners",t)}return{data:o}},processResponse:(t,e,r)=>{Bi((),o({type:"success"})},processError:t=>{Bi((),o({type:"error",error:String(t)})}},{process:n.immediate?Ci.immediate:Ci.defer})})).then((()=>{("web_unload"===t||"user_active"===t&&r)&&this.queue.sendBulkWithBeacon()}))}getUtmParamsIfEnabled(){const t=this.config.getOptions();if(t.utm_always){return t.utm_params?this.url.getParams(t.utm_params):{}}return{}}getTrackDefaultPropertiesIfEnabled(){const t=this.config.getOptions();return t.track&&t.track.default_properties?t.track.default_properties:{}}rackPageVisitEventIfEnabled(){const t=this.config.getOptions().track;t&&t.visits&&(this.trackPageVisitEvent(),this.config.isSpaReloadingEnabled("visits")&&this.url.onChange("trackPageVisitOnUrlChange",())}trackPageVisitEvent(){this.track("page_visit",Object.assign({referrer:this.document.referrer,location:this.location.href,path:this.location.pathname},this.url.getParams(this.config.getOptions().track.visits_query_params)))}triggerEventTrackingListeners(t,e){for(let n=0;n<this.eventTrackingListeners.length;n++)try{this.eventTrackingListeners[n](t,e)}catch(t){this.debug.error(`Error when processing event listener ${this.eventTrackingListeners[n].name||n}`,t)}}}yn([zi(),bn("design:type",Function),bn("design:paramtypes",[String,Object,Object,Object]),bn("design:returntype",void 0)],Fi.prototype,"track",null);function Di(t,e,n,r=0){if(r>10)throw new Error(`Maximum number of retries reached while waiting for window.ga to appear (already waited for ${500*r}ms). window.gtag is available but it does not appear to load window.ga anymore!`);if(e.ga)return t.log(`window.ga is available after ${r} retries`),void e.ga(n);if(e.gtag)return t.log(`window.gtag is available, trying ${r} retry`),void e.setTimeout(Di.bind(void 0,t,e,n,r+1),500);throw new Error("No window.ga nor window.gtag is available in waitForGoogleAnalyticsSdkToLoad!")}var Mi,Ni;!Mi||(Mi={})),Ni||(Ni={}));class Ui{equestCustomerIdsFromServer(t,e=(()=>{})){this.queue.enqueue({name:or.Ids,isBlocking:!0,prepareData:processResponse:t=>{this.debug.log("received customer ids response",t);const n=t.data,r=n.cookie;this.debug.log("cookie received from server is "+r),this.cookies.setTrackingCookie(r),this.config.extendOptions({customer:n}),e(n),this.segments.prefetch(),this.segments.notify()}},{first:!0})}filterEmptyCustomerIds(t){const e={};for(const n in t)!t.hasOwnProperty(n)||null!==t[n]&&void 0!==t[n]&&""!==t[n]?e[n]=t[n]:this.debug.log("Removed empty customer id: "+n,t[n]);return e}identifyCustomerWithGoogleAnalyticsId(){const t=this.config.getOptions();t.customer&&t.customer.google_analytics||t.track.google_analytics&&(!this.window)?this.debug.warn("Missing Google Analytics SDK (window.ga and window.gtag are not defined). Either integrate Google Analytics with your website or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"):!function(t){return"ga"in t&&"function"!=typeof t.ga}(this.window)?Di(this.debug,this.window,(()=>{if(!this.window.ga||!this.window.ga.getAll)throw new Error("window.ga is missing the getAll function");const e=this.window.ga.getAll();if(!e)return;const n=function(t){var e;const n=t.find((t=>{var e;return null===(e=t.get)||void 0===e?void 0:e.call(t,"clientId")}));return null===(e=null==n?void 0:n.get)||void 0===e?void 0:e.call(n,"clientId")}(e);n&&(this.config.extendOptions({customer:Object.assign(Object.assign({},t.customer),{google_analytics:n})}),this.updateCustomer({}))})):this.debug.warn("Incorrect Google Analytics SDK detected (window.ga is "+typeof this.window.ga+"). Are you using an old Google Analytics SDK? This is not supported in the SDK so Google Analytics integration will not work. Either upgrade the Google Analytics SDK or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"))}updateCustomer(t,e=(()=>{}),n=(()=>{}),r=!1){this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:or.Customers,prepareData:()=>{const e=Object.assign({},t);return{data:{ids:this.config.getOptions().customer,company_id:this.config.getToken(),properties:e}}},processResponse:e,processError:n},{process:r?Ci.immediate:Ci.defer})}))}linkCustomerIds(t=(()=>{}),e=(()=>{}),n=!1){this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Mi.LinkIds,allowedToFail:!0,noBulk:!0,prepareData:()=>({data:{external_ids:this.config.getOptions().customer}}),processResponse:t,processError:e},{process:n?Ci.immediate:Ci.defer})}))}identifyCustomer(t,e={},n=(()=>{}),r=(()=>{}),i=!1,o,s){"string"!=typeof t&&"number"!=typeof t||(t={registered:t});const a=this.config.getOptions().customer,c=this.filterEmptyCustomerIds(t);c.cookie=a.cookie,a.google_analytics&&(c.google_analytics=a.google_analytics),this.debug.log("Identifying customer: ",c),this.browserExtension.sendPayload({type:"ids",ids:c}),this.config.extendOptions({customer:c}),this.updateCustomer(e,n,r,i),o&&this.linkCustomerIds(o,s,i)}}class qi{get database(){return this.isSupported()?(this.dbRequest||(this.dbRequest=function(t,e,n){const r=t.open("exponea",1);return r.onblocked=r.onupgradeneeded=t=>{!function(t,e){const n=t.result;e.oldVersion<1&&n.createObjectStore("settings",{keyPath:"key"})}(r,t)},new Promise(((t,e)=>{r.onsuccess=()=>{const e=r.result;e.onversionchange=e.onclose=t(e)},r.onerror=()=>{e(r.error)}}))}(this.window.indexedDB,this.logger,()),this.dbRequest):Promise.reject("IndexedDB is not supported, some features may be broken")}constructor(t,e){this.window=t,this.logger=e,this.database.catch((()=>{}))}setItem(t,e){return this.database.then((n=>{const r=Object.assign(Object.assign({},e),{key:t}),i=n.transaction("settings","readwrite").objectStore("settings").put(r);return new Promise(()}))}getItem(t){return this.database.then((e=>{const n=e.transaction("settings").objectStore("settings").get(t);return new Promise(((t,e)=>{n.onsuccess=n.onerror=))}))}class Wi{rror(t,...e){"string"==typeof t?this.print("error",t,...e):this.print("error",t)}log(t,...e){this.print("log",t,...e)}warn(t,...e){this.print("warn",t,...e)}anPrintMessages(t="production",e=n){return"production"!==t&&e||this.config.getOptions().debug||this.location.search.includes(`${l}_debug=true`)||!!this.storageUtils.readBooleanFromStorage("localStorage",`${l}_debug`)}print(t,...e){this.canPrintMessages()&&this.logger[t](...e.filter(())}}class $i{constructor(t,e){this.config=t,this.reporter=e,this.DEFAULT_DEPENDENCIES={exp:"https://exp-framework.exponea.com/exp.js"},this.loadedDependencies={}}oadDependency(t){let e;e="[object Array]"===Object.prototype.toString.call(t)?t:[t];try{const t=this.getDependencyUrls(e);return this.getDependencyLoadingChain(t)}catch(t){return this.reporter.reportPromiseError(Promise.reject(t))}}getDependencyUrls(t){const e=[];for(const n of t){let t=this.DEFAULT_DEPENDENCIES[n];if(this.options.dependencies&&this.options.dependencies[n]&&(t=this.options.dependencies[n]),!t)throw new Error(`unknown dependency named '${n}'`);e.push(t)}return e}getDependencyLoadingChain(t){let e=this.reporter.reportPromiseError(Promise.resolve());for(const n of t)e=e.then(();return e}adDependencyFromUrl(t){if(this.isDependencyPresent(t))return this.reporter.reportPromiseError(Promise.resolve());this.markDependencyAsPresent(t);const e=new Promise(((e,n)=>{const r=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");i.src=t;let o=!1;i.onload=i.onreadystatechange=i.onerror=function(e){const r="message"in e?`: ${e.message}`:"";n(new Error(`Loading of dependency '${t}' failed${r}`))},i.onabort=r.insertBefore(i,r.firstChild)}));return this.reporter.reportPromiseError(e)}}class Hi{constructor(t,e){this.window=t,this.document=e}whenLoaded(){return this.loadedPromise||(this.loadedPromise=new Promise((t=>function(t,e,n){let r=!1,i=!0;const o=e.documentElement,s="addEventListener"in e?"addEventListener":"attachEvent",a="removeEventListener"in e?"removeEventListener":"detachEvent",c="addEventListener"in e?"":"on";if("complete"===e.readyState)n.call(t,"lazy");else{if(e.createEventObject&&o.doScroll){try{i=!t.frameElement}catch(t){}i&&function e(){try{o.doScroll("left")}catch(t){return void setTimeout(e,50)}r=!0,n.call(t,"poll")}()}e[s](c+"DOMContentLoaded",u,!1),e[s](c+"readystatechange",u,!1),t[s](c+"load",u,!1)}function u(i){if("readystatechange"===i.type&&"complete"!==e.readyState)return;const o="load"===i.type?t:e;o[a].bind(o)(c+i.type,u,!1),r||(r=!0,n.call(t,i.type))}}(this.window,this.document,t)))),this.loadedPromise}}var Vi;!function(t){const e=["id","name","price","brand","category","variant","list","position"],n=["product_id","name","price","brand","category","variant","list","position"],r=["currencyCode"],i=["currency_code"],o=["id","name","brand","category","variant","price","quantity","coupon","position"],s=["product_id","name","brand","category","variant","price","quantity","coupon","position"],a=["id","affiliation","revenue","tax","shipping","coupon","list","step","option"],c=["transaction_id","affiliation","revenue","tax","shipping","coupon","list","step","option"],u=["id","name","creative","position"],l=["promo_id","name","creative","position"];function h(t,e,n,r=n){n.forEach(((n,i)=>{const o=r[i];e.hasOwnProperty(n)&&e[n]&&(t[o]=e[n])}))}function p(t,e){h(t,e,r,i)}.Tracker=class{rackEnhancedEcommerce(t,e="all"){Br(t)?("impressions"!==e&&"all"!==e||this.trackProductImpressions(t),"click"!==e&&"all"!==e||this.trackProductAction(t,"click","product_click"),"detail"!==e&&"all"!==e||this.trackProductAction(t,"detail","product_detail"),"add"!==e&&"all"!==e||this.trackProductAction(t,"add","product_add_to_cart"),"remove"!==e&&"all"!==e||this.trackProductAction(t,"remove","product_remove_from_cart"),"promoView"!==e&&"all"!==e||this.trackPromotionAction(t,"promoView","promo_impression"),"promoClick"!==e&&"all"!==e||this.trackPromotionAction(t,"promoClick","promo_click"),"checkout"!==e&&"all"!==e||this.trackCheckout(t),"checkout_option"!==e&&"all"!==e||this.trackCheckoutOption(t),"purchase"!==e&&"all"!==e||this.trackPurchase(t),"refund"!==e&&"all"!==e||this.trackRefund(t)):this.debug.error("Ecommerce parameter is not a plain object")}trackProductImpressions(t){t.impressions?t.impressions.forEach((r=>{const i={};p(i,t),h(i,r,e,n),this.trackEnhancedEcommerceEvent("product_impression",i)})):this.debug.warn("There are no impressions in the ecommerce object")}trackProductAction(t,e,n){var r;const i=t[e];if(!i)return void this.debug.debug(`${e} not found in the ecommerce object`);if(!i.products)return void this.debug.debug(`${e} in the ecommerce object does not have any products`);const a=null!==(r=i.actionField)&&void 0!==r?r:{};i.products.forEach((e=>{const r={};p(r,t),d(r,a),h(r,e,o,s),this.trackEnhancedEcommerceEvent(n,r)}))}trackPromotionAction(t,e,n){const r=t[e];r?r.promotions?r.promotions.forEach((e=>{const r={};p(r,t),h(r,e,u,l),this.trackEnhancedEcommerceEvent(n,r)})):this.debug.debug(`${e} in the ecommerce object does not have any promotions`):this.debug.debug(`${e} not found in the ecommerce object`)}trackCheckout(t){var e;if(!t.checkout)return void this.debug.debug("There is no checkout in the ecommerce object");this.trackProductAction(t,"checkout","product_checkout");const n=null!==(e=t.checkout.actionField)&&void 0!==e?e:{},r={};p(r,t),d(r,n),this.trackEnhancedEcommerceEvent("checkout",r)}trackCheckoutOption(t){var e;if(!t.checkout_option)return void this.debug.debug("There is no checkout option in the ecommerce object");const n=null!==(e=t.checkout_option.actionField)&&void 0!==e?e:{},r={};p(r,t),d(r,n),this.trackEnhancedEcommerceEvent("checkout_option",r)}trackPurchase(t){var e;if(!t.purchase)return void this.debug.debug("There is no purchase in the ecommerce object");this.trackProductAction(t,"purchase","product_purchase");const n=null!==(e=t.purchase.actionField)&&void 0!==e?e:{},r={};p(r,t),d(r,n),this.trackEnhancedEcommerceEvent("transaction",r)}trackRefund(t){var e;if(!t.refund)return void this.debug.debug("There is no refund in the ecommerce object");const n=null!==(e=t.refund.actionField)&&void 0!==e?e:{},r={};p(r,t),d(r,n),t.refund.products?(r.refund_type="partial",this.trackProductAction(t,"refund","product_refund")):r.refund_type="full",this.trackEnhancedEcommerceEvent("refund",r)}trackEnhancedEcommerceEvent(t,e){this.eventTracker.track(t,Object.assign({tracked_via:"eecommerce"},e))}}}(Vi||(Vi={}));class Gi{constructor(t,e,n){this.debug=e,this.reporter=n,this.reportablePromise=t.then(().catch(()}then(t){const e=this.reportablePromise.then((e=>{const n=Date.now();let r;try{r=t(e)}catch(t){throw this.debug.error(t),this.reporter.sendErrorReport(t,"promise",n),t}return r instanceof Gi?r.reportablePromise:r}));return new Gi(e,this.debug,this.reporter)}catch(t){const e=this.reportablePromise.catch((e=>{const n=Date.now();let r;try{r=t(e)}catch(t){throw this.debug.error(t),this.reporter.sendErrorReport(t,"promise",n),t}return r instanceof Gi?r.reportablePromise:r}));return new Gi(e,this.debug,this.reporter)}}class Ki{constructorndErrorReport(t,e,n=Date.now()){const r=this.serialize(t,e,n);this.debug.log("Sending error report",r),this._sendErrorReport(r).then(().catch(()}serialize(t,n,r){let i;return i=t instanceof Error?t:new Error(String(t)),{id:ur(32),instance_id:"EXP",sdk_version:e,company_id:this.config.getToken(),spans:[{id:ur(16),start_time:r/1e3,duration:(Date.now()-r)/1e3,operation:n,error:{message:i.message,name:i.name,stack:i.stack||""},tags:{url:location.href.split(/[?#]/)[0],host:location.hostname}}]}}reportError(t,e){const n=this;return function(){const r=Date.now();try{return t(...arguments)}catch(i){const o=e||t.name||"transientOperation";throw n.sendErrorReport(i,o,r),i}}}_sendErrorReport(t){return this.http.post(this._target,t,{responseType:"text",headers:{"Content-type":"application/json"},credentials:"omit"})}}var Qi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};ar Zi={exports:{}};
/**
     * @license
     * Lodash <https://lodash.com/>
     * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
     * Released under MIT license <https://lodash.com/license>
     * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
     * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     */!function(t,e){(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",o="__lodash_placeholder__",s=16,a=32,c=64,u=128,l=256,h=1/0,p=9007199254740991,d=NaN,f=4294967295,g=[["ary",u],["bind",1],["bindKey",2],["curry",8],["curryRight",s],["flip",512],["partial",a],["partialRight",c],["rearg",l]],m="[object Arguments]",v="[object Array]",y="[object Boolean]",b="[object Date]",_="[object Error]",w="[object Function]",k="[object GeneratorFunction]",x="[object Map]",S="[object Number]",E="[object Object]",T="[object Promise]",C="[object RegExp]",A="[object Set]",O="[object String]",j="[object Symbol]",P="[object WeakMap]",L="[object ArrayBuffer]",I="[object DataView]",B="[object Float32Array]",z="[object Float64Array]",R="[object Int8Array]",F="[object Int16Array]",D="[object Int32Array]",M="[object Uint8Array]",N="[object Uint8ClampedArray]",U="[object Uint16Array]",q="[object Uint32Array]",W=/\b__p \+= '';/g,$=/\b(__p \+=) '' \+/g,H=/(__e\(.*?\)|\b__t\)) \+\n'';/g,V=/&(?:amp|lt|gt|quot|#39);/g,G=/[&<>"']/g,K=RegExp(V.source),Q=RegExp(G.source),J=/<%-([\s\S]+?)%>/g,Z=/<%([\s\S]+?)%>/g,Y=/<%=([\s\S]+?)%>/g,X=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tt=/^\w*$/,et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nt=/[\\^$.*+?()[\]{}|]/g,rt=RegExp(nt.source),it=/^\s+/,ot=/\s/,st=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,at=/\{\n\/\* \[wrapped with (.+)\] \*/,ct=/,? & /,ut=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,lt=/[()=,{}\[\]\/\s]/,ht=/\\(\\)?/g,pt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dt=/\w*$/,ft=/^[-+]0x[0-9a-f]+$/i,gt=/^0b[01]+$/i,mt=/^\[object .+?Constructor\]$/,vt=/^0o[0-7]+$/i,yt=/^(?:0|[1-9]\d*)$/,bt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_t=/($^)/,wt=/['\n\r\u2028\u2029\\]/g,kt="\\ud800-\\udfff",xt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",St="\\u2700-\\u27bf",Et="a-z\\xdf-\\xf6\\xf8-\\xff",Tt="A-Z\\xc0-\\xd6\\xd8-\\xde",Ct="\\ufe0e\\ufe0f",At="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ot="[']",jt="["+kt+"]",Pt="["+At+"]",Lt="["+xt+"]",It="\\d+",Bt="["+St+"]",zt="["+Et+"]",Rt="[^"+kt+At+It+St+Et+Tt+"]",Ft="\\ud83c[\\udffb-\\udfff]",Dt="[^"+kt+"]",Mt="(?:\\ud83c[\\udde6-\\uddff]){2}",Nt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ut="["+Tt+"]",qt="\\u200d",Wt="(?:"+zt+"|"+Rt+")",$t="(?:"+Ut+"|"+Rt+")",Ht="(?:['](?:d|ll|m|re|s|t|ve))?",Vt="(?:['](?:D|LL|M|RE|S|T|VE))?",Gt="(?:"+Lt+"|"+Ft+")"+"?",Kt="["+Ct+"]?",Qt=Kt+Gt+("(?:"+qt+"(?:"+[Dt,Mt,Nt].join("|")+")"+Kt+Gt+")*"),Jt="(?:"+[Bt,Mt,Nt].join("|")+")"+Qt,Zt="(?:"+[Dt+Lt+"?",Lt,Mt,Nt,jt].join("|")+")",Yt=RegExp(Ot,"g"),Xt=RegExp(Lt,"g"),te=RegExp(Ft+"(?="+Ft+")|"+Zt+Qt,"g"),ee=RegExp([Ut+"?"+zt+"+"+Ht+"(?="+[Pt,Ut,"$"].join("|")+")",$t+"+"+Vt+"(?="+[Pt,Ut+Wt,"$"].join("|")+")",Ut+"?"+Wt+"+"+Ht,Ut+"+"+Vt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",It,Jt].join("|"),"g"),ne=RegExp("["+qt+kt+xt+Ct+"]"),re=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ie=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oe=-1,se={};se[B]=se[z]=se[R]=se[F]=se[D]=se[M]=se[N]=se[U]=se[q]=!0,se[m]=se[v]=se[L]=se[y]=se[I]=se[b]=se[_]=se[w]=se[x]=se[S]=se[E]=se[C]=se[A]=se[O]=se[P]=!1;var ae={};ae[m]=ae[v]=ae[L]=ae[I]=ae[y]=ae[b]=ae[B]=ae[z]=ae[R]=ae[F]=ae[D]=ae[x]=ae[S]=ae[E]=ae[C]=ae[A]=ae[O]=ae[j]=ae[M]=ae[N]=ae[U]=ae[q]=!0,ae[_]=ae[w]=ae[P]=!1;var ce={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ue=parseFloat,le=parseInt,he="object"==typeof Qi&&Qi&&Qi.Object===Object&&Qi,pe="object"==typeof self&&self&&self.Object===Object&&self,de=he||pe||Function("return this")(),fe=e&&!e.nodeType&&e,ge=fe&&t&&!t.nodeType&&t,me=ge&&ge.exports===fe,ve=me&&he.procet){}}(),be=ye&&ye.isArrayBuffer,_e=ye&&ye.isDate,we=ye&&ye.isMap,ke=ye&&ye.isRegExp,xe=ye&&ye.isSet,Se=ye&&ye.isTypedHe("lenfunction He(t){return function(e){return null==e?n:n=Ve({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","": e}(t):De(t)}function fn(t){return an(t)?function(t){return t.match(te)||[]}(t):function(t){return t.split("")}(t)}function gn(t){for(var e=t.length;e--&&ot.test(t.charAt(e)););return e}var mn=Ve({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var vn=function t(e){var ot=(e=null==e?de:vn.defaults(de.Object(),e,vn.pick(de,ie))).Array,kt=e.Date,xt=e.Erro.prototype,Lt=Tt.prototype,It=e["__core-js_shared__"],Bt=Pt.toString,zt=Lt.hasOwnProperty,Rt=0,Ft=function(){var t=/[^.]+$/.exec(It&&It.keys&&It.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Dt=Lt.toString,Mt=Bt.call(Tt),Nt=de._,Ut=Ct("^"+Bt.call(zt).replace(nt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qt=me?e.Buffer:n,Wt=e.Symbol,e,Kt=Lt.propertyIsEnumerable,Qt=jt.splice,Jt=Wt?Wt.isConcatSpreadable:n,Zt=Wt?Wt.iterator:n,te=Wt?Wt.toStringTag:n,ne=function(){try{var t=po(Tt,"defineProperty");return t({},"",{}),t}catch(t){}}(),ce=e.clearTimeout!==de.clearTimeout&&e.clearTimeout,he=kt&&kt.now!==de.Date.now&&kt.now,pe=e.setTimeout!==de.setTimeout&&e.setTimeout,fe=Et.ceil,ge=Et.floor,ve=Tt.getOwnPropertySymbols,ye=qt?qt.isBuffer:n,De=e.isFinite,Ve=jt.join,yn=un(Tt.keys,Tt),bn=Et.max,_n=Et.min,wn=kt.now,kn=e.parseInt,xn=Et.random,Sn=jt.reverse,En=po(e,"DataView"),Tn=po(e,"Map"),Cn=po(t?Wt.p(z__=!!e,this.__index__=0,this.__values__=n}function Hn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}functionu)||o&&("buffer"==u||"byte=200&&(o=Xe,s=!1,e=new Qn(e));t:for(;++i<a;){var l=t[i],h=null==n?l:n(l);if(l=r||0!==l?l:0,s&&h==h){for(var p=u;p--;)if(e[p]===h)continue t;c.push(l)}else o(e,h,r)||c.push(l)}return c}Un.templateSettings={escape:J,evaluate:Z,interpolate:Y,variable:"",imports:{ctor=Un,$n.prototypetotype.constructoe=function(t){var},Vn.prototype.ge:n},Vn.prototype.hajn?e[t]!==n:zt.call(his},Gn.prototypeete=function(t){v(n==e.length-1?e.turn r<0?n:e[r][1]}tion(t,e){var n=this=e,this},Kn.prototype.clear=function(){this.size=0,this.__data__={hash:nKn.prototype.delection(t){return lo(this,t).get(t)},as(t)},Kn.prototype.set=function(t,e){var n=lo(this,t),r=n.size;return n.set(ype.add=Qn.prototypenction(t){return this.__data__.has(t)},Jn.prototype.clear=function(){this._delete=function(t(t,e){var n=this.__data__;iunction(t,r,i){e(t,r,i)&&n.push(t)})),n}function yr(t,e,+gl!=c&&++__"===u||h:_]}function bi(t){return"function"==typeofon(t,n){if(292,e){if(!Xe(f,e)&&(g===t||o(!1;break}{d=":"hi,To(i)]}=t?n:t[e])||(tt.test(t)||!X.test(t)||null!=e&&t in Tt(e))}function xo(t){var e=ao(t),n=Un[e];if("function"!=typeof n||!(e in Hn.p||On&&mo(new On)!turn a[e]=r(s),Ee(t,this,a)}}function Oo(t,e){return e.length<2?t:Sr(t,ii(e,0,-1))}function jo(t,e){for(var {var s=e[i(++et.length,o=i-1;for(e=e===n?i:e;++r<e;){var s=Qr(r,o),a=t[s];t[s]=t[r],t[r]=a}return t.length=e,t}var Do=function(t){var e=Rs(t,(functioncharCodeAt(0)&&e.push(""),t.replace(et,(function(t,n,r,i){e.push(r?i.replace(ht,"$1"):n||t)}))){}}return();var e==t.__inde1,gth;if(i-1)),Ne([0]:n}vari)(e,2)):[]})),"==typeof  X&&e&&e.len{var n=nu?+t:t})).ren(t){if(Q,(functioon as(t,ection(t){r((function(t){return m((r(ss);varth)&&i instanions__.push({func:gs,args:[o],thisArg:n}),new $n(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(ot,n,1)}));vartion(t,e,n){zt.call(t,n)?t[n].push(e):1,i="funct):){o[++r]=i?Ee{t[n?0:1].push(e)}),(function(){return[[],=r?n:e,e=t&&null==e?t.length:e,Yi(t,u,n,n,n,n,e)}function js(t,e){var i;if("function"!=typeof e)throw&(0,na(i)&&()?bn(ya(iaiar e=arguments;switchon(t,e){var n=(e=1==e.length&&Vs(e[0])?Ie(e[0],Ze(uo())):Ie(yr(e,1),Ze(uo.length,nurn Ee(t,this,r)}))})),Ms=Zr((function(t,e){var r=ln(e,co(Ms));re((function(t,e){var r=ln(e,co(Ns));return Yon qs(t,e){return t===e||t!=t&&e!=e}var Ws=Gi(Cr),$s=Gi((function(t,e){return t>=e})),Hs=Lr(function(){return argum&&zt.call(t,"callee")&&!Kt.call(t,"callee")},Vs=ot.isArray,Gs=1;var e=Tr(t);return e==w||e==k||"[object AsyncFunction]"==e||"[object &t==ma(t)}function ea(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=p}function na(t){var e=typeof t;return nut)&&Tr(t)==S}function sa(t){if(!ra(t)||Tr(t)!=E)return!1;var e=Vt(t);if(null===e)return!0;var n=zt.call(en ra(t)&&Tr(t)==A};function ua(t){re(tction ga(t){return t?(t=ya(t))===h||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ma(t){var e=ga(t),n=e%1;return e==e?n?e-n:e:0}function va(t){return t?cr(ma(t),0,f):0}function ya(t){if("number"==typeof t)return t;if(la(t))return d;i.valueOf?t.valueOf():t;t=na(e)?e+"":e}if("string":8):ft.teurn Pi(t,Ba(t))}function _a(t){return null==t?"":li(t||Ks(e))Pi(e,Ia(e),t);e);var r=-],.call(t,l);function Aa(t,on(t,e,n){null!call(e)),t[e]=n}),nc(oc)),Pa=qi((function(t,e,n){nulloString&&(e=Dt.call(e)),zt.call(t,e)?t[e].push(n)Fa=ro((functi,e,e){return Vr(t,e,(funcMa(t,e){if))[]:Ye(t,Ia(t))}var Wa=Fi((function(t,e,n){return e=e.toLowerCase(),t+(n?$a(e):e)}));function $a(t){return Ya(_a(t).toLowerCase())}function Ha(t){return(t=_a(t))&&t.replace(bt,rn).replace(Xt,"")}var Va=Fi((function(t,e,n){retfunction(t,e,werCase");var Qa=Fi((fua=Ri("toUpeturn re.manction(t,e){try{retur(function(e){e=Mo(e),sr(t,e,Ps(t[e],t))})),t}));function nc(t){return ocn__;if(o||e){var n=t(this.__wrapped__),i=n.__act,n}return r.apply(t,B){}var hc);function fc(t){return k{return function(e){return Sr(e,t0);function vc(){return[]} bc=Wi((function(t,e}),1),Ec=Qi("round"),Tc=Wi((function(t,e){return t-e}),0);return Un.after=function(t,e){if("function"!=typeof e)throw new Ot(r);return t=ma(t),functIn=ka,Un.assignInWithVs(t)?t:[t]h;if(!i||en;){var );return t=e((function(n){for(var r=-1;++r<e;){var },Un.conf(t,1))},Un.concurry=function t(e,r,i){var o=Yi(e,8,n,n,n,n,n,r=i?n:r);return o.placeholder=t.placeholder,o},Un.curryRight=function t(e,r,i){var o=Yi(e,sn.defaultsDeeunction(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=r||e===n?1:ma(e))<0?0:e,i):[]},return i?(r&&"numb,e,r,i){var?0:o+r),(i=i===(i);r<i;)t[r++]=rn(Vs(t)?je:vr)(t,uo(e,3))},UatMapDeep=functin r=r===n?1:ma(r),yr(Es(t,e),r)},Un.flatten=Go,Un.flattenDeep=function(t){retur(t,e=e===n?1:ma(e)):[]},Un.flip=function(t){return Yi(t,512)},Un.flow=rc,Un.flowRight=ic,Un.fromPairs=function(t){for(var e=-1,n=null==t?0r},Un.functions=function(t){return null==t?[]:xr(t,Ia(t))},Un.functionsIn=function(t){return null==t?[]:xr(t,Ba(t))},Un.groupBy=ks,Un.initial=function(t){return(null==t?0:t.lengthvert=ja,Un.ins,Un.mapKeye=uo(e,3),wr(t,(function(t,r,i){sr(n,e(t,r,i),t)})),n},Un.mapValues=function(t,e){var n={};return e=uo(e,3),wr(t,(function(t,r,i){sr(n,r,e(t,r,i))})),n},Un.matcn(t,e){return qr(t,urergeWith=cc,Un.mixitBy=function(t,e){return Ma(t,Fs(uo(e)))},Un.once=function(t){return js(2,t)},Un.orderBy=function(t,e,r,i){return null==t?[]:(Vs(e)||(e=null==e?[]:[e]),Vs(r=i?s=Ds,Un.overEvery=pc,Un.overSome=dc,Un=Ma,Un.property?n:Sr(t,e)}},Un.pull=Xo,Un.pullAll=ts,Un.pullAllBy=function(t,e,:t},Un.pulVs(t)?jer=-1,i=[],o=t.length;for(e=un},Un.rrow new Ot(){return e=(r?wo(t,e,r):e===n)?1:ma(e),(Vs(t)?Xn:Xr)(t,euffle=function(t){return(Vs(t)?tr:ri)(t)},Un.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&wo(t,e,r)?(e=0,r=i):[]},Un.spn(t),0,rpeof t)t=ki(n,0,e);re):[]},Un.take=func)<0?0:e):[]},Un.takeRight=function(t,e,r){var i=null==t?0:t.length;retuma(e)))<0?0:ottle=function(t,e,n){var i=!0,o=!0;if("function"!=typeof t)throwtrailing"in n?!!n.trailing:o),Is(form=function(t,e,n){var r=Vs(t),i=r||Js(t)||ha(t);if(e=uo(e,4),null==n){var o=t&&t.cont(t)):{}}r})),n},Un.unUn.uniq=f,Un.uniqBy=function(t,e){return t&&t.l){return e="fuull==t||pi(t,e)},Un.unzipn){return null==t?t:di(t,e,bi(n))}eturn i="function"==typeof i?i:n,null==t?t:di(t,e,bi(r),i)},Un.values=qa,Un.valuesIn=function(t){return null==t?[]:Yerap=function(t,e){return Ms(bi(e),t)},Un.xor=us,Un.xorBy=ls,Un.xorWith=hs,Un.zip=ps,Un.zipObject=function(t,e){return vi(t||[],e||[],nr)},Un.zipObjectDeep=functi(Un,Un),Un.add=bc,Un.attempt=tc,Un.camelCase=Wa,Un.capitalize=$a,Un.ceil=_c,Un.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=ya(r))==r?r:0),e!==n&&(e=(en ur(t,4)},Un.eDeepWith=function(t,e){re,Un.cloneWith=function(t,=Ha,Un.defaultTo=function(t,e){return null==t||t!=t?e:t},Un.divide=wc,Un.endsWith=function(t,turn(r-=e.length)>=0&&t.slice(r,o)==e},Un.eq=qs,Un.escape=function(t){return(t=_a(t))&&Q.test(t)?t.replace(G,on):t},Un.escapeRegExp=function(t){return(t=_a(t))&&rt.test(t)?t.replace(nt,"\\$&"):t},Un.every=functio(t,e,r)&&(e=n),i(t,uo(e,3))},Un.find=ys,Un.findIndex=Ho,Un.findKey=function(t,e){return Me(t,uo(e,3),wr)},Un.findLast,e){return Me(t,uo(e,3),kr)},Un.floor=kc,Un.forEach=_s,Un.forEan null==t?t:br(t,uo(e,3),Ba)},Un.fort,uo(e,3),Ba)},Un.forOwn=function(t,e){return t&&w,Ar)},Un.han n<0&&(n=br)return-1;var i=null==n?0:ma(n);return i<0&&(i=bn(r+i,0)),Ue(t,e,i)},Un.inRange=function(t,e,r){return e=ga(e),r===n?(rt<bn(e,n)}(t=ya(t),e,r)},Un.invoke=La,Un.n.isArrayLi=typeof t||"function"==typeof t.splice||Js(t)||ha(t)||Hsfor(var n in t)if(zt.call(,e){return Ir(t,e)},Un.isEqualWith=function(t,e,r){var i=(r="function"=,n,r):!!i},Un.iUn.isFuncth=ea,Un.isMeof r?r:nunction(t){return oa(t)&&t!=+t},Un.isNative=function(t){if(So(t))throw new xt("Unsupported core-js use. Try https://npms.io/search?q=ponyfil},Un.isNull=function(t){return null===t},Un.isNumber=oa,Un.isObject=na,Un.isObjectLike=ra,Un.isPlainObject=sa,Un.ist){return ta(t)&&t>=-9007199254740991&&t<=p},Un.isSet=ca,Un.isString=ua,Un=function(t){return t===n},Un.isWeakMap=fue,r){var i=null==t?0:t.length;if(!i)return-1;var o=i;return r!==n&&(o=(o=ma(r))<0?bn(i+o,0):_n(o,i-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(tCase=Ga,Un.max=fu.maxBy=fu.mean=function(t){return $e(t,oc)},Un.meanBy=fe(t,uo(e,2))},turn t&&t.len.minBy=function(t,e){ray=vc,Un.stubstubString=function(){returnict=functi(t,e,n){t=_a),n)+t+Hi(fe?t+Hi(e-r,"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=ga(t),e===n?(e=t,t=0):e=ga(e)),t>e){var i=t;t=e,e=i}if(r||,e)},Un.re r(t,uo(e,4;return r(turn t.length<3?e:e.replace(t[1],t[2])},=(e=_i(e=Ec,Un.runInContext=t,Unreturn 0;if(Ks(t))return ua(t)?dn(t):t.length;var e=mo(t);retuakeCase=Qa,Un.somion(t,e){return si(,e,n){return ai(t,e,u n=null==t?0:t.lengthe){return si(t,e,!0)},Un.sorte==t?0:t.length){var n=1},Un.staa(t),n=null=rototype. St(c,f+"return "+p).apply(n,u)}));if(m.source=p,Ys(m))throw m;return m},Un.times=function(t,e){if((t=ma(t))<1||t>p)return[];var n i},Un.toFinite=ga,Un.toItion(t){Upper=functeturn ki(i,tnn(t);return obal||(o=Ct(ar p=l.indexxOf(li(o),c)!=c){var d=u.lastIndexOf(o);d>-1&&(u=u.slice(0,d))}return u+i},Un.unescape=functt},Un.uniqueId=function(t){var e=++Rt;return _a(t)+e},Un.upperCase=Za,Un.upperFirst=Ya,Un.each=_s,Un.eachRigUn,(function(t,e){zt.c.__filtered__?i.__takeCount__=_n(r,"map","takeWhile"],(fues__.push({iteratee:uo(t,otype[t]=function(){return this[n](1).value()[0]}})),Ce(["initial","tail"],(Hn.prototype[t]=functithis[n](1)}})),Hn.prototypeead()},Hn.prototype.find(t)},Hn.prototype)))},Hn.prototype.slice=funce<0)?new Hn(r):(t<0?r),e!==n&&(r=(e=ma!d;if(!s&&l){e=g?e:new Hn(this);var m=t.apply(e,a);retuop|shift)$/.test(t)i)?i:[],t)}return this[n]((function(n){return e.apply(Vs(n)?n:[]_actions__=ji(this.__.__takeCount__,t.__urn gi(t,this.__actions__);var f=[];t:,m=t[u+=e];++g<h;){v if(!_){if(1==b)con__)},Un.prototype.s.__index__++]}},Un.papped__;if(t instanceof Hn){var e=t;return this.__actions__.({func:gs,args:[ns],thisArg:n}),new $n(e,this.__chain__)}rerototype.toJSON=Un.prototype.valueOf=Un.prototype.value=function(){return gi(this.__wrapped__,this.__actions__)},Un.prototype.first=Un.prototype.head,Zt&&(Un.prototype[Zt]=function(){return this}),Un}();ge?((ge.exports=vn)._=vn,fe._=vn):de._=vn}).call(Qi)}(Zi,Zi.exports);var Yi,Xi=Zi.exports;!function(t){t.isDataLayerVariable=function(t){return"dataunction(t){return"queon(t){return"global_variable"===t.variable.type},t.isCustomFunction=function(t){return"custom_function"===t.variable.type}}(Yi||(Yi={}));var to;function eo(t,e){return t.data.find((t=>t.id===e))}function no(t,e,n,r){if(!r)return;const i=function(t){let e=[];return t.forEach((t=>{(null==t?void 0:t.page_vars)&&(e=e.concat(t.page_vars))})),e}(t);if(!i.length)return;const o={};return i.forEach((t=>{const i=t.id,s=eo(r,i);if(!s)return;const a=ro(s,e,n);void 0!==a&&(o[i]=a)})),Xi.isEmpty(o)?void 0:o}function ro(t,e,n){let r;return Yi.isDataLayerVariable(t)?r=function(t,e){const n=e.dataLayer;if(!n)return;const r=t.variable.data_layer.name;if(r)for(let t=n.length-1;t>=0;t--){const e=an(n[t],r,void 0);if(e)return e}}(t,n):Yi.isQueryParameterVariable(t)?r=function(t,e){const n=e.getAllQueryParams();if(0===Object.keys(n).length)return;const r=t.variable.query.key;if(!r)return;return n[r]}(t,e):Yi.isJavaScriptVariable(t)?r=function(t,e){const n=t.variable.global_variable.name;if(!n)return;const r=an(e,n,void 0);return r||void 0}(t,n):Yi.isCustomFunction(t)&&(r=function(t){const e=t.variable.custom_function.body;if(!e)return;let n,r;try{n=new Function(e)}catch(t){return}try{r=n()}catch(t){return}return r}(t)),r}!function(t){t.matches=function(t,e,n,r,i){return!i||i.every((i=>{let o;if(!r)return!1;try{const s=i.attribute.id,a=eo(r,s);if(!a)return!1;o=ro(a,e,t);const c={};return void 0!==o&&(c[s]=o),n(c,s,i.constraint)}catch(t){return!1}}))}}(to||(to={}));class io{static matches(t,e){return!e.enabled||!(e.from_date&&e.from_date>t)&&!(e.to_date&&e.to_date<t)}}var oo={exports:{}};oo.exports=lo;var so=oo.exports.isMobile=lo;oo.exports.default=lo;const ao=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( ;let n=ao.test(e)&&!co.test(e)||!!t.tablet&&uo.test(e);return!n&&t.tablet&&t.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==e.indexOf("Macintosh")&&-1!==e.indexOf("Safari")&&(n=!0),n}class ho{static matches(t,e){if(!t)return!0;const n=so({ua:e,tablet:!0,featureDetect:!0});return"mobile"===t.type?n:"desktop"!==t.type||!n}}class po{static matches(t,e,n,r,i,o){if(!r||!n.isStorageAvailable("localStorage"))return!0;const s=o+i,a=e.getStoredTimestamp(s+"_last_show"),c=e.getStoredTimestamp(s+"_last_interaction"),u=t.getLastSessionStart();switch(r){case"only_once":return!a;case"until_visitor_interacts":return!c;case"once_per_visit":return!a||!u||a<u}return!0}}var fo,go,mo;function vo(t,e,n){return`${t}${n?" "+n:""} was filtered out by ${e} filter`}function yo(t,e){return(n,r)=>function(t,){return i=>{const o=r(i);return o||e.log(vo(t,n,"_id"in i?i._id:void 0),i),o}}(t,e,n,r)}function bo(){let t=!1;return{initialize(){},track(){},trackLink(){},identify(){},update(){},anonymize(){},loadDependency:window[l].,notificateout((()=>{t=aged tag"}(fo||(fo={})),function(t){t.Error="error",t.PermissionDenied="permission-denied",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.Default="default",t.Unsupported="unsupported"}(go||(go={}));class _o{static matches(t,e){if("page"in e)return this.matchesURLFilter(t,e.page);if(e.exclude_pages)for(const n of e.exclude_pages)if(this.matchesURLFilter(t,n))return!1;if(e.include_pages)for(const n of e.include_pages)if(this.matchesURLFilter(t,n))return!0;return!1}static parseURL(t){const e={source:t};let n;const r=/^(.{1,5}?):\/\//;var i,o,s,a,c,u;(n=r.exec(t))&&(e.protocol=n[1],t=t.replace(r,"")),o="//",i=nn(i=t),s=null==s?0:(a=Zr(s),c=0,u=i.length,a==a&&(void 0!==u&&(a=a<=u?a:u),void 0!==c&&(a=a>=c?a:c)),a),o=en(o),i.slice(s,s+o.length)==o&&(t=t.substr(2));const l=/(.*?)(\/|$)/;if(n=l.exec(t)){const r=n[1].split(":");""!==r[0]&&(e.host=r[0]),r.length>1&&(e.port=r[1]),t=t.replace(l,"/")}const h=/(.*?)(\?|$|#)/;(n=h.exec(t))&&(e.path=n[1],t=t.replace(h,n[2]));const p=/^\?(.*?)($|#)/;(n=p.exec(t))&&(e.query=n[1],t=t.replace(p,n[2]));if((n=/^#(.*)/.exec(t))&&(e.hash=n[1]),e.we.hash}`),e.host){const t=e.port?`:${e.port}`:"";e.withoutProtocol=`//${e.host}${t}${e.withoutHost}`}return e}static escapeRegex(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}static wildcardToRegex(t){const e=("^"+this.escapeRegex(t)+"$").replace(new RegExp("\\\\\\*","g"),".*");return new RegExp(e)}static matchesExactURL(t,e){const n=this.parseURL(t),r=this.parseURL(e);return!(r.host||!r.withoutHost||!n.withoutHost||!n.withoutHost.match(this.wildcardToRtProtocol||!n.withoutProtocol||!n.withoutProtocol.match(this.wildcardToRegex(r.withoutProtocol)))||!!n.source.match(this.wildcardToRegex(r.source)))}static matchesContainsURL(t,e){return pi(t,e)}static matchesRegexURL(t,e){try{const n=new RegExp(e);if(t.match(n))return!0;const r=this.parseURL(t);return!(!r.withoutProtocol||!r.withoutProtocol.match(n))||!(!r.withoutHost||!r.withoutHost.match(n))}catch(t){if(t instanceof Error)return!1;throw t}}static matchesURLFilter(t,e){return"any"===e.type||("exact"===e.type?this.matchesExactURL(t,e.url):"contains"===e.type?this.matchesContainsURL(t,e.url):"regex"===e.type&&this.matchesRegexURL(t,e.regex))}}class wo{constructor(t,e,n,r,i,o,s,a,c,u,l,h,p,d,f){this.reporter=t,this.config=e,this.queue=n,this.timestamp=r,this.ping=i,this.modifications=o,this.experimentsEditor=s,this.tracker=a,this.location=c,this.debug=u,this.documentContentLoaded=l,this.storageUtils=h,this.newExperiments=p,this.url=d,this.window=f,this.applyingExperimentsInProgress=!1,this.experimentRevertFunctions=[]}applyExperimentModificationsAndTrackEvent(t,e=!0){var n;let r;try{r=this.modifications.applyModifications(t)}catch(t){return this.debug.error("Error applying experiment",t),()=>{}}this.experimentRevertFunctions.push(r);const i=(new Date).getTime();return this.timestamp.storeTimestamp(a+(null===(n=null==t?void 0:t.params)||void 0===n?void 0:n.experiment_id)+"_last_show",i),e&&this.tracker.track("experiment",{action:"show",experiment_id:t.params.experiment_id,experiment_name:t.params.experiment_name,variant_id:t.params.variant_id,variant_name:t.params.variant_name,location:window.location.href,path:window.location.pathname}),r}revertExistingExperiments(){for(const t of this.experimentRevertFunctions)try{t()}catch(t){this.debug.error("Error from revert experiment script",t)}this.experimentRevertFunctions=[]}loadFlickeringExperimentsScript(e){this.newExied()?this.debug.log("Not applying experiments with the SDK because new_experiments are enabled."):(this.queue.enqueue({httpMethod:void 0,noBulk:!0,name:Ni.Internal,action:()=>{ko(e,this.config)},prepareData:()=>{},processResponse:()=>{},processError:()=>{}}),e.promise.then((e=>{let n=!1;this.config.isSpaReloadingEnabled("experiments")&&this.url.onChange("onUrlChangeFilterAndApplyExperiments",(()=>{var r;if(n)return;const i=!(null===(r=window[t])||void 0===r?void 0:r.configuration),o=e!==window[x];if(i||o)return e.revert&&e.revert(),void(n=!0);e.reset&&e.reset()}))})))}processDefinition(t,e){this.newExperiments.areAlreadyApplied()?this.debug.log("Not applying experiments with the SDK because new_experiments are enableents...",t),this.filterAndApplyExperiments(t,e),this.config.isSpaReloadingEnabled("experiments")&&this.url.onChange("onUrlChangeFilterAndApplyExperiments",(()=>this.filterAndApplyExperiments(t,e))))}applyExperiment(t){if(!this.filterByCustomCondition(t))return void this.debug.log(vo(fo.Experiment,t.params.experiment_id,"custom condition"));this.debug.log(`Applying experiment ${t.params.experiment_id}...`,t);const e=this.applyExperimentModificationsAndTrackEvent(t,!0);this.experimentRevertFunctions.push(e)}filterAndApplyExperiments(t,e){if(this.applyingExperimentsInProgress)return;this.revertExistingExperiments();const n=this.filterExperimentsForCustomer(t,e);0!==n.length&&(this.ndApplyExperimentsModifications(n,e))}filterExperimentsForCustomer(t,e){const n=yo(fo.Experiment,this t.filter(n("page",(t=>_o.matches(this.location.href,t.trigger)))).filter(n("date",(t=>io.matches(this.timestamp.getTimestamp(),t.date_filter)))).filter(n("device",(t=>ho.matches(t.device_target)))).filter(n("frequency",(t=>po.matches(this.ping,this.timestamp,this.storageUtils,t.frequency,t._id,a)))).filter(n("conditions",(t=>{var n;return to.matches(this.window,this.url,r,e,null===(n=t.variables_target)||void 0===n?void 0:n.conditions)})))}queryAndApplyExperimentsModifications(t,e){const n=t.map((t=>t._id));let r=ti(this.config.getOptions().customer);const i=no(t,this.url,window,e);this.queue.enqueue({name:Mi.ExperimentsShow,noBulk:!0,prepareData:()=>(this.debug.debug("Get ti(this.confithis.config.getToken(),customer_ids:r,personalisation_ids:n,page_vars:i}}),processResponse:t=>{this.applyExperimentsModifications(t.data)},processError:()=>{this.applyingExpyExperimentsModifications(t){this.debug.log("Applying experiments..."),this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{t.forEach((t=>{this.applyExperiment(t)})),this.applyingExperimentsInProgress=!1}))}filterByCustomCondition(t){if(!t.custom_condition||this.experimentsEditor.isEditorRunning())return!0;try{return!!this.setupCustomConditionScriptFunction(t.params,t.custom_condition)()}catch(e){return this.debug.error(`Custom condition for experiment ${t.params.experiment_id} threw an error`,e),!1}}setupCustomConditionScriptFunction(t,e){const n={};n.inPreview=this.experimentsEditor.isEditorRunning(),n.sdk=n.inPreview?bo():window[l],n.data=n.params=t;let r=e;r.length>0&&r.indexOf("\n")<0&&r.indexOf(";")<0&&r.indexOf("return")<0&&(r="return "+r);const i=new Function(r).bind(n);return i.context=n,i}}function ko(e,n){const r=n.getOptions();r.customer.cookie||e.reject(new Error("Can't load flickering experiments - missing cookie."));const i=encodeURIComponent(window.location.href),o="webxpClient",s=n.getToken(),a=`${r.target}/webxp/script/${s}/${r.customer.cookie}/modifications.min.js?http-referer=${i}`;window[x]||(window[x]={}),window[x].skipExperiments=!0,window[x].legacyFlickeringMode=!0,window[o].sdk=window[t],window[o].sdkObjectName=l,window[o].sign=`${s}/${r.customer.cookie}`,window[o].path=r.target;const c=document.createElement("script");c.src=a,c.onload=()=>{var t;"function"==typeof(null===(t=window[x])||void 0===t?void 0:t.reset)?e.resolve(window[x]):e.reject("webxpClient.reset doesn't exist or not a function")},c.onerror=t=>e.reject(t);const u=document.getElementsByTagName("script")[0];u&&u.parentNode&&u.parentNode.insertBefore(c,u)}yn([zi(),bn("design:type",Function),bn("design:paramtypes",[Object,Object]),bn("design:returntype",void 0)],wo.prototype,"applyExperimentModificationsAndTrackEvent",null),yn([zi(),bn("design:type",Function),bn("design:paramtypes",[]),bn("design:returntype",void 0)],wo.prototype,"revertExistingExperiments",null),yn([zi(),bn("design:type",Function),bn("design:paramtypes",[Object]),bn("design:returntype",void 0)],wo.prototype,"applyExperiment",null);class xo{constructor(t,e,n,r,i,o,s,a){this.http=t,this.config=e,this.location=n,this.document=r,this.history=i,this.window=o,this.debug=s,this.storageUtils=a,this.urlParamsMatch=null,this.urlParamsMatchBase64=null}matchUrlWithParams(){this.(%7D|}))"),this.urlParamsMatchBase64=this.location.href.match("(?:#|\\?)?exponea-editor-params=([a-zA-Z0-9-_=]+)")}areEditorParamsInURL(){return!!this.urlParamsMatch||!!this.urlParamsMatchBase64}placeParamsFromURLToStorage(){let t="";if(this.urlParamsMatch&&(t=decodeURIComponent(this.urlParamsMatch[2])),this.urlParamsMatchBase64){const e=this.urlParamsMatchBase64[1].replace(/-/g,"+").replace(/_/g,"/");t=atob(e)}t&&(this.storageUtils.writeToStorage("sessionStorage",y,t)||this.debug.warn("The editor is not supported in this browser"))}removeParamsFromURL(){let t="";this.urlParamsMatch&&(t=this.urlParamsMatch[0]),this.urlParamsMatchBase64&&(t=this.urlParamsMatchBase64[0]),t&&(this.history&&this.history.replaceState?this.history.replaceState(null,this.document.title,this.location.href.replace(t,"")):this.location.href=this.location.href.replace(t,""))}shouldStartEditor(){return!!this.storageUtils.readStringFromStorage("sessionStorage",y)}bootstrapEditor(){return this.isEditorRunning()?(this.debug.log("The editor is already running"),Promise.resolve()):this.location.host.indexOf("localhost")>=0?(this.debug.log("Auto-launching of the editor is disabled in development environments"),Promise.resolve()):this._waitForPageToLoad().then((()=>{var t;this._insertEditorLoadingElement();const e=this._insertEditorIframe();let n=this.config.getOptions().target+_+(new Date).getTime(),r=`${this.config.getOptions().target}${w}`;try{const e=null!==(t=this.storageUtils.readStringFromStorage("sessionStorage",y))&&void 0!==t?t:"",i=JSON.parse(e);i.trackingTarget&&(n=`https:${i.trackingTarget}$Date).getTime()}`,r=`https:${i.trackingTarget}${w}`)}catch(t){this.debug.warn("No or invalid editor params found in session storage")}return this.http.get(n,{responseType:"text"}).then((t=>t.body)).then((t=>{e?e.srcdoc=t.replace(/base\shref=".*"/,`base href="${r}"`):this.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")})).catch((()=>this.http.get(this.config.getOptions().target+"/editor/version.txt?timestamp="+(new Date).getTime(),{responseType:"text"}).then((t=>{const n=t.body.trim();this.debug.log(`Fetching editor version ${n}`);const r=k.map((t=>`<script type="text/javascript" src="${this.config.getOptions().target+w+n+`/${t}.js`}"><\/script>`)).join();e?e.srcdoc=`<html><head><title>E</head><body>${r}</body></html>`:this.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")version",t)))))}))}_waitForPageToLoad(){return new Promise((t=>{this.document.body?t():this.window.addEventListener("load",(()=>t()))}))}isEditorRunning(){return!!this.document.getElementById(b)}_insertEditorLoadingElement(){this.debug.log("Inserting experiments editor loading element");const t=this.document.createElement("style");t.textContent=".exponea-loading-backdrop{margin:0;padding:0;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(87,91,154,.5);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;z-index:2147483642}.exponea-loading-icon{width:50px;height:50px;border:4px solid #ffd500;border-right-color:transparent;border-radius:50%;-webkit-animation:rotate .8s infinite linear;animation:rotate .8s infinite linear}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}t("div");e.innerHTML='<div class="exponea-loading-backdrop"><div class="exponea-loading-icon"></div></div>',this.document.head.appendChild(t),Tt(e.childNodes,(t=>this.document.body.appendChild(t)))}_insertEditorIframe(){const t=this.document.createElement("div"),e=this.document.createElement("iframe");return t.id=b,t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.border="none",t.style.width="auto",t.style.height="auto",t.style.margin="0",t.style.padding="0",t.style.backgroundColor="transparent",t.style.zIndex="2147483647",e.src="about:blank",e.frameBorder="0",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="transparent",e.style.margin="0",e.style.padding="0",e.style.display="block",e.style.visibility="visible",this.document.body.appendChild(t),t.appendChild(e),e}}class So{constructor(t,e,n,r){this.eventTracker=t,this.experimentsEditor=e,this.document=n,this.debug=r}applyModifications(t){const e=[];t.modifications=t.modifications||[];for(const n of t.modifications)switch(n.type){case"add":this._applyAddModification(n,e);break;case"remove":this._applyRemoveModification(n,e);break;case"change":this._applyChangeModification(nak;case"run":this._applyRunModification(n,t.params,e);break;case"track":this._applyTrackModification(n,e);break;case"banner":this._applyBannerModification(n,t.params,e)}return()=>{return n=t=>t(),(G(t=e)?oi:ai)(t,Et(n));var t,n}}_applyAddModification(t,e){const n=this.document.createElement("div");t.parametrized_parts?n.innerHTML=t.parametrized_parts.html:n.innerHTML=t.html;const r=[].slice.call(n.childNodes);let i;try{i=this.document.querySelector(t.place_to.element)}catch(e){return void this.debug.warn("Invalid selector, ignoring the add modification",t.place_to.element)}if(i)switch(t.place_to.placement){case"before":Tt(r,(n=>{i.parentElement?(i.parentElement.insertBefore(n,i),e.push(this._revertInsertElement.bind(this,n))):this.debug.warn("Attempting to insert HTML before an element without a parent",t.place_to.element)}));break;case"after":Tt(r,(n=>{i.parentElement?(i.parentElement.insertBefore(n,i.nextSibling),e.push(this._revertInsertElement.bind(this,n))):this.debug.warn("Attempting to insert HTML after an element without a parent",t.place_to.element)}));break;case"prepend_child":Tt(r,(t=>{i.insertBefore(t,i.firstChild),e.push(this._revertInsertElement.bind(this,t))}));break;case"append_child":Tt(r,(t=>{i.appendChild(t),e.push(this._revertInsertElement.bind(this,t))}))}else this.debug.warn("No element matched the selector, ignoring the add modification",t.place_to.element)}_applyRemoveModification(t,e){let n=[];try{const e=this.document.querySelectorAll(t.element);n=[].slice.call(e)}catch(e){return void this.debug.warn("Invalid selector, ignoring the remove modification",t.element)}0!==n.length?Tt(n,(n=>{switch(t.method){case"visibility":e.push(this._revertHideElement.bind(this,n)),n.style.visibility="hidden";break;case"display":e.push(this._revertHideElement.bind(this,n)),n.style.display="none";break;case"remove":n.parentElement?(e.push(this._revertRemoveElement.bind(this,n,n.parentElement,n.nextElementSibling)),n.parentElement.removeChild(n)):this.debug.warn("Attempting to remove an element without a parent",t.element)}})):this.debug.warn("The selector matched no elements, ignoring the remove modification",t.element)}_applyChangeModification(t,e){let n=[];try{const e=this.document.querySelectorAll(t.element);n=[].slice.call(e)}catch(e){return void this.debug.warn("Invalid selector, ignoring the change modification",t.element)}if(0===n.length)return void this.debug.warn("The selector matched no elements, ignoring the change modification",t.element);let r=[];if(t.place_to){try{const e=this.document.querySelectorAll(t.place_to.element);r=[].slice.call(e)}catch(e){return void this.debug.warn("Invalid container selector, ignoring the change modification",t.place_to.element)}if(0===r.length)return void this.debug.warn("The container selector matched no elements, ignoring the change modification",t.place_to.element);if(r.length!==n.length)return void this.debug.warn("The container selector matched a different number of elements then the source selector")}Tt(n,((n,i)=>{if(t.html){const r=this.document.createElement("div");r.innerHTML=t.html;const i=[].slice.call(r.childNodes),o=n.parentElement,s=n.nextElementSibling;o?(Tt(i,(t=>{o.insertBefore(t,n),e.push(this._revertInsertElement.bind(this,t))})),o.removeChild(n),e.push(this._revertRemoveElement.bind(this,n,o,s))):this.debug.warn("Cannot replace an element's HTML without a parent",t.element)}if(t.text){const r=n.innerHTML;n.innerText=t.text,e.push(this._revertTextChange.bind(this,n,r))}if(t.place_to){const o=r[i];if(!n.parentElement)return void this.debug.warn("Attempting to move an element without a parent",t.element);switch(e.push(this._revertRemoveElement.bind(this,n,n.parentElement,n.nextElementSibling)),t.place_to.placement){case"before":o.parentElement?o.parentElement.insertBefore(n,o):this.debug.warn("Attempting to insert an element before a container without a parent",t.place_to.element);break;case"after":o.parentElement?o.parentElement.insertBefore(n,o.nextSibling):this.debug.warn("Attempting to insert an element after a container without a parent",t.place_to.element);break;case"prepend_child":o.insertBefore(n,o.firstChild);break;case"append_child":o.appendChild(n)}}t.attributes&&ci(t.attributes,((t,r)=>{const i=n.getAttribute(r);i&&!n.getAttribute(`data-original-${r}`)&&n.setAttribute(`data-original-${r}`,i),n.setAttribute(r,t),e.push(this._revertAttributeChange.bind(this,n,r))})),t.style&&ci(t.style,((t,r)=>{n.style.setProperty(r,t,"important"),e.push(this._revertStyleChange.bind(this,n,r))}))}))}_applyTrackModification(t,e){let n=[];try{const e=this.document.querySelectorAll(t.element);n=[].slice.call(e)}catch(e){return void this.debug.warn("Invalid selector, ignoring the change modification",t.element)}0!==n.length?n.forEach((n=>{const r=this._buildTrackClickEventListener(this.eventTracker,t);n.addEventListener("click",r),e.push(this._revertClickEventTracking.bind(this,n,r))})):this.debug.warn("The selector matched no elements, ignoring the change modification",t.element)}_applyRunModification(t,e,n){const r=this;function i(){let e=null;try{const n=r.document.querySelectorAll(t.element);e=[].slice.call(n)}catch(e){r.debug.log("Invalid selector but still applying run modification",t.element)}if(e&&0===e.length){if("once_per_element"===t.execute)return void r.debug.log("The selectordification matched no elements",t.element);r.debug.log("The selector matched no elements but still applying run modification",t.element)}try{"once_per_element"===t.execute?e&&e.forEach((t=>o([t]))):o(e)}catch(t){r.debug.error("The run modification script threw an error",t)}}function o(i){const o=Eo(r._setupModificationScriptFunction(t,e,i),e.experiment_id,r.debug);yt(o)?n.push(o):dr(o)&&n.push(o.remove.bind(o))}t.execute&&"document_ready"!==t.execute||"complete"===document.readyState?i():document.addEventListener("DOMContentLoaded",i)}_applyBannerModification(t,e,n){let r=null;try{const e=this.document.querySelectorAll(t.element);r=[].slice.call(e)}catch(e){this.debug.warn("Invalid selector but still applying banner modification",t.element)}r&&0===r.length&&this.debug.warn("The selector matched no elements but still applying banner modification",t.element);try{const i=this._setupModificationScriptFunction(t,e,r);t.parametrized_parts?(i.context.html=t.parametrized_parts.html,i.context.style=t.parametrized_parts.style):(i.context.html=t.html,i.context.style=t.style);const o=Eo(i,e.experiment_id,this.debug);yt(o)?n.push(o):dr(o)&&n.push(o.remove.bind(o))}catch(t){this.debug.error("The banner modification script threw an error",t)}}_buildTrackClickEventListener(t,e){return()=>{t.tra?t.parentElement.removeChild(t):this.debug.warn("Cannot remove an inserted element without a parent")}_revertHideElementdisplay")}_revertRemoveElement(t,e,n){e?e.insertBefore(t,n):this.debug.warn("Cannot re-insert a removed element without a parent")}_reverst n=t.getAttribute(`data-original-${e}`);n&&(t.setAttribute(e,n),t.removeAttribute(`data-original-${e}`))}_revertStyleChange(t,e){t.style.removeProperty(e)}_revertTextChange(t,e){t.innerHTML=e}_setupModificationScriptFunction(t,e,n){const r={};r.inPreview=this.experimentsEditor.isEditorRunning(),r.sdk=r.inPreview?bo():window[l],r.data=r.params=e,n&&n.length>0?(r.element=n[0],r.elements=n):(r.element=null,r.elements=[]),r.selector=t.element;const i="parametrized_parts"in t?t.parametrized_parts.script:t.script;let o;try{o=new Function(i).bind(r),o.context=r}catch(t){throw this.debug.error(`Syntax error in the experiment javascript code.\n\nThis is not an SDK error but rather an error in the experiment ${e.experiment_id}\njavascript code. Check the experiment code for syntax errors, such errors are\nusually highlighted in the UI. The first line of the stack trace below should\ngive you a clue.\n\n`,t),t}return o}}function Eo(t,e,n){try{return t()}catch(t){throw n.error(`Error when executing a modification javascript code.\n\nThis is not an SDK error but rather an error in the experiment ${e}\njavascript code. Check the web layer javascript code for errors. This is not\na syntax error and may be hard to spot, but the first line of the stack trace\nbelow should give you a clue.\n\n`,t),t}}!function(t){t.ep3_use_new_experiments="ep3_use_new_experiments",t.ewxx_279_invalid_integration_monitor"}(mo||(mo={}));const To=Object.freeze({[mo.ep3_use_new_experiments]:!1,[mo.ewx_279_invalid_integration_monitor]:!1});class Co{get flags(){return this.flagConfig}constructor(t,e,n=To,r="eyJleHA3MjhfcmVtb3ZlX3dlYnhwX2NvbmZpZ19mcm9tX2FzeW5jX2FwaSI6IHRydWUsICJlcDNfdXNlX25ld19leHBlcmltZW50cyI6IHRydWUsICJld3hfMjc5X2ludmFsaWRfaW50ZWdyYXRpb25fbW9uaXRvciI6IHRydWV9Cg=="){this.debug=t,this.window=e;try{this.flagConfig=Object.freeze(Object.assign(Object.assign({},n),function(t,e,n,r){const i=t.match(/^%%%%.+%%%%$/)?"e30=":t,o=JSON.parse(r.atob(i)),s={};return ci(o,((t,r)=>{r in e?"boolean"==typeof t?s[r]=t:n.error(`Incorrect value '${t}' for feature flag '${r}', expected a boolean but received '${typeof t}'`):n.error(`Feature '${r}' is not a feature flag supported by this SDK version`)})),s}(r,n,this.debug,this.window)))}catch(t){this.debug.error("Failed to parse feature flags",t),this.flagConfig=Object.freeze(n)}this.debug.debug("Initialized feature flags",this.flags)}setFlags(t){this.flagConfig=Object.freeze(Object.assign(Object.assign({},this.flagConfig),t)),this.debug.debug("Overwritten feature flags",this.flags)}}class Ao{constructor(t,e,n,r){this.config=t,this.debug=e,this.documentContentLoaded=n,this.queue=r}getHtml(t,e){this.queue.enqueue({name:MData:()=>(this.debug.log("Get html: ",t),{data:{company_id:this.config.getToken(),customer_ids:this.config.getOptions().customer,html_campaign_name:t}}),processResponse:t=>{Bi((()=>{e(t.data)}))}})}showHtml(t,e){this.ntContentLoadt++)n[t].innerHTML=e}),(t=>{this.debug.error("Failed to show HTML",t)t.Fetch=0]="Fetch"}(Oo||(Oo={}));class jo extends Error{constructor(t){super(),this.response=t}}class Po{constructor(t=t){this.window=t,this.type=Oo.Fetch,this.fetch=(t,e)=>this.window.fetch(t,e)}static isSupported(){if(!XMLHttpRequest)return!1;return"withCredentials"in new XMLHttpRequest}post(t,e,n){return this.fetch(t,Object.assign(Object.assign({},n),{headers:Object.assign({Accept:"application/json"},n.headers||{}),method:"POST",body:JSON.stringify(e),credentials:n.credentials?n.credentials:"include"})).then(Lo).then(Io)}get(t,cept:"application/jsT"}).then(Lo).then(Io)}}function Lo(t){const{status:e}=t;return{json:function(){return n().then((t=>{try{return JSON.parse(t)}catch(e){return t}}))},text:n,status:e};function n(){return t.text()}}function Io(t){if(t.status>=200&&t.status<300)return t;throw new jo(t)}class Bo extends Error{constructor(t){super(t.message),this.name="HttpNetworkError"}}class zo extends Error{constructor(t){super(function(t){const{body:e}=t;if("stringt)),this.name="HttpServerError",this.response=t}}const Ro={responseType:"json"};class Fo{constructor(t){Po.isSupported()&&(this.transport=new Po(t))}hasTransport(){return void 0!==this.transport}get(t,e=Ro){if(e=Cr({},e,Ro),void 0===this.transport)throw new Error("Can't do a get request since no http transport is available!");return this.transport.get(t,e).catch(Mo(e)).then(Do(e))}post(t,e,n=Ro){if(n=Cr({},n,Ro),void 0===this.transport)throw new Error("Can't do a post request since no http transport is avach(Mo(n)).then(Do(n))}}function Do(t){return function(e){return function(t,e){if("text"===t)return e.text();return hen((t=>{const{status:n}=e;return{body:t,status:n}}))}}function Mo(t){return function(e){return e instanceof jo?function(t,e){const n=Do(e);return n(t.response).then((t=>Promise.reject(new zo(t))))}(e,t):e insteError?Promisew Bo(e)):Promise.reject(e)}}var No,Uo,qo;function Wo(t){return new Promise(((e,n)=>{t.execute({name:Mi.WebOptimization,noBulk:!0,httpMethod:No.get,processResponse(t){r:t=>{n(t)}})}))}functio.webOptimization&&!(n.webOptimization&&!1===n.webOptimization[e])}function Ho(t){let e,n;const r=new Promise(((t,r)=>{e=t,n=r}));return e&&n?(r.catch((e=>{t.debug("Handling promise rejection",e)})),{promise:r,resolve:e,reject:n}):(t.error("Error building promise remote: Promipromise:Promise.reject(),resolve:()=>{},reject:()=>{}})}function Vo(t){const e=t[[t.post=0]="p.automatic="automatic",t.manual="manual"}(Uo||(Uo={})),function(t){t.personalized="personalized",t.nonPersonalized="nonPersonalized"}(qo||(qo={}));class Go extends Error{constructor(t){super(t)}}class Ko{constructor(t,e,n,r,i,o,s,a,c,u,l,h,p,d,f,g,m,v,y,b,_,w,k,x,S,E,T,C=Wo){this.reporter=t,this.debug=e,this.config=n,this.time=r,this.cookies=i,this.ping=o,this.customer=s,this.userActivityTracking=a,this.experimentsEditor=c,this.experiments=u,this.webLayers=l,this.managedTags=h,this.campaignClicks=p,this.eventTracker=d,this.queryTracking=f,this.window=g,this.unloader=m,this.initializeState=v,this.queue=y,this.pushWebApi=b,this.pushSafariApi=_,this.transferIdentity=w,this.howserExtension=T,this.getDefinitions=C,this.webxpClientReadyRemote=Ho(this.logger),this.initializeCookieLinked=Ho(this.logger)}get isWebxpClientReady(){return this.webxpClientReadyRemote.promise}initialize(t){if(!this.http.hasTransport())return void this.logger.warn(`${l} sdk won't be initialized because no supported HTTP transport method was found in this browser!`);if(this.initializeState.isInitializing())return void this.debug.log("The SDK is already being initialized");if(this.initializeState.isInitialized())return void this.debug.log("The SDK is already initialized");this.debug.log("Starting to initialize the SDK"),this.debug.log("Checking the cookie first"),this.debug.log("attempting to get cookie from browser");let e=this.cookies.getCookie(r);const n=this.window[x];if(n&&n.skipExperiments){if(!e&&(this.debug.log("The SDK does not have a cookie yet, communicating with webxp client to get one"),t&&!n.init)){if("boolean"==typeof t)throw new Go("Invalid type of argument 0 - initialize, expected object but got boolean");return this.storedOptions=t,this.window.setTimeout(this.initialize.bind(this,!1),500),void this.debug.log("Initialization was postponed until the modifications script loads")}if(!t){if(!this.storedOptions)return;t=this.storedOptions}if(!e){if("boolean"==typeof t)throw new Go("Invalid type of argument 0 - initialize, expected object but got boolean");if(n.config&&n.config.cookie){let r=this.config.getOptions().cookies.cross_subdomain;t&&t.cookies&&void 0!==t.cookies.cross_subdomain&&(r=t.cookies.cross_subdomain),this.config.extendOptions({cookies:{cross_subdomain:r}}),e=n.config.cookie,this.cookies.setTrackingCookie(e)}}}if("boolean"==typeof t)throw new Go("Invalid type of argument 0 - initialize, expected object but got boolean");if(this.debug.log('Webxp client communication handled, continuing with initialization - SDK is marked as "initializing" now'),!ui(t.token))throw new Go("Invalid type of project token, expected string but got "+typeof t.token);if(""===t.token)throw new Go("Invalid value of project token, the token cannot be an empty string");if(this.isComplianceConfigurationChanged(t))throw new Go("It is disallowed to change `compliance` configuration during SDK initialization. Please set the `compliance` option in the snippet");this.errorReportInitialize(t,e)}extendOptions(t){"boolean"!=typeof t&&this.config.extendOptions({token:t.token,target:t.target,compliance:t.compliance,experimental:t.experimental,spa_reloading:t.spa_reloading})}errorReportInitialize(t,n){const r=Date.now();this.preProcessCustomerIds(t),this.config.extendOptions(t);const i=this.config.getOptions();try{this.initializeState.markInitializing(),this.browserExtension.initialize(),this.browserExtension.sendPayload({type:"versions",sdkVersion:e,snippetVersion:Vo(this.window)}),this.browserExtension.sendPayload({type:"config",config:t});(!0===i.compliance.opt_in||!0===i.compliance.opt_in.new_customer_profile)&&(n=this.cookies.setFreshTrackingCookie(),this.config.setNewCustomerIds({cookie:n}),this.browserExtension.sendPayload({type:"ids",ids:{cookie:n}})),this.cookies.sanitizeCookieOptions(),i.feature_flags&&this.featureFlags.setFlags(i.feature_flags),this.experimentsEditor.matchUrlWithParams(),this.experimentsEditor.areEditorParamsInURL()&&(this.experimentsEditor.placeParamsFromURLToStorage(),this.experimentsEditor.removeParamsFromURL()),this.time.queryTime(),this.pushWebApi.initialize(),n&&(this.config.extendOptions({customer:Object.assign(Object.assign({},i.customer),{cookie:n})}),this.debug.log("cookie retrieved from browser: "+n),Bi((()=>{yt(i.cookies.retrieve_callback)&&(i.cookies.retrieve_callback(n),i.cookies.retrieve_callback=null)})));const r=i.transfer_identity?this.transferIdentity.getTransferIdentityFirstClickToken():void 0;if(this.customer.requestCustomerIdsFromServer({cookie:n,tifc:r},(t=>{this.browserExtension.sendPayload({type:"ids",ids:t}),n||Bi((()=>{yt(i.cookies.retrieve_callback)&&(i.cookies.retrieve_callback(t.cookie),i.cookies.retrieve_callback=null)})),r&&i.link_cookie&&Bi((()=>{this.executeLinkCookies(i.link_cookie)}))})),i.transfer_identity&&(this.debug.log("transferring identity from URL"),this.config.extendOptions({customer:Object.assign(Object.assign({},i.customer),this.transferIdentity.getCustomerIdentityFromUrl())})),this.experimentsEditor.shouldStartEditor())return!this.config.getOptions().new_experiments&&this.featureFlags.flags.ep3_use_new_experiments&&ko(this.webxpClientReadyRemote,this.config),void this.experimentsEditor.bootstrapEditor();i.track&&i.track.google_analytics&&this.customer.identifyCustomerWithGoogleAnalyticsId(),this.userActivityTracking.trackExitsWithDataAttribute(),this.campaignClicks.parseUrlAndTrackCampaignClick(),i.ping&&(i.ping.enabled||(i.customer),!r&&i.link_cookie&&Bi((()=>{this.executeLinkCookies(i.link_cookie)})),i.link_cookie||(this.featureFlags.flags.ep3_use_new_experiments?Bi((()=>{this.executeLinkCookies(i.link_cookie)})):this.initializeCookieLinked.reject()),this.ping.setOptions(this.config.getOptions().ping),this.ping.restartPinging(),this.userActivityTracking.startActivityTracking(),this.eventTracker.trackPageVisitEventIfEnabled(),this.queryTracking.initialize(),this.reporter.reportPromien((t=>{this.featureFlags.flags.ep3_use_new_experiments?function(t,e,n,r,i,o,s){$o(t,"experiments")&&!t.getOptions().new_experiments&&s.promise.finally((()=>{n.loadFlickeringExperimentsScript(o)})),$o(t,"webLayers")&&e.processDefinition(i.webLayers,qo.personalized,i.vars),$o(t,"tagManager")&&r.processDefinition(i.constantManagedTags)}(this.config,this.webLayers,this.experiments,this.managedTags,t,this.webxpClientReadyRemote,this.initializeCookieLinked):function(t,e,n,r,i){$o(t,"experiments")&&e.processDefinition(i.experiments,i.vars),$o(t,"webLayers")&&n.processDefinition(i.webLayers,qo.personalized,i.vars),$o(t,"tagManager")&&r.processDefinition(i.constantManagedTags)}(this.config,this.experiments,this.webLayers,this.managedTags,t)})),$o(this.config,"experiments")&&this.newExperiments.initialize(),$o(this.config,"tagManager")&&this.managedTags.queryNonConstantManagedTagsAndShowOnUrlChange(),this.unloader.initialize(),this.pushSafariApi.handleDeniedSubscription(),this.ping.initializeWebUnloadTracking(),this.debug.log('The SDK initialization is finished, SDK is marked as "initialized" now'),this.initializeState.markInitialized()}catch(t){if(this.queue.clear(),this.initializeState.markFailedInitialization(),t instanceof Go)throw t;this.debug.error(t),this.reporter.sendErrorReport(t,"initialize",r)}}preProcessCustomerIds(t){"number"!=typeof t.customer&&"string"!=typeof t.customer||(t.customer={registered:t.customer}),t.customer&&("cookie"in t.customer&&delete t.customer.cookie,t.customer=this.customer.filterEmptyCustomerIds(t.customer),this.config.extendOptions(t))}isComplianceConfigurationChanged(t){const e=t.compliance;if(void 0===e)return!1;const n=this.config.getOptions().compliance;return!Re(e,n)}executeLinkCookies(t){let e=()=>{},n=()=>{};"object"==typeof t&&yt(t.link_cookie_initialize_success)&&(e=t.link_cookie_initialize_success,yt(t.link_cookie_initialize_error)&&(n=t.link_cookie_initialize_error)),this.customer.linkCustomerIds(((...t)=>{e(...t),this.initializeCookieLinked.resolve(!...t)=>{n(...t),this.initializeCookiealdPromiseReject=()=>{},this.initializedPromise=new Promise(((t,e)=>{this.initializedPromiseR!1}markInitialized(){this.initializing=!1,this.initialized=!0,this.initializedPromiseResolve()}markFailedInitialization(){this.initializing=!1,this.initialized=!1,this.initi){return this.initialized}whenInitialized(){return this.initializedPromise}}const Jo="sendBeacon"in navigator;var Zo;!function(t){t[t.Ready=0]="Ready",t[t.Sending=1]="Sending",t[t.Sent=2]="Sent"}(Zo||(Zo={}));class Yo{constructor(t,e,n,r,i=Jo){this.reporter=t,this.debug=e,this.eventTracker=n,this.eventTypeAndPropertiesGetter=r,this.isSendBeaconSupported=i,this.EVENT_TRIGGERED_DEADLINE=300,this.phase=Zo.Ready,this.lockedUntil=0,this.timeoutID=void 0}trackClick(t){const e=t.target,n=this.evehBeacon(n):(this.phase===Zo.Ready&&(t.preventDefault(),t.stopImmediatePropagation()),this._trackClickWithoutBeacon(e,n))}_trackClickWithBeacon({type:t,properties:e}){this.eventTracker.track(t,e)}_trackClickWithoutBeacon(t,{type:e,properties:n}){if(this.phase===Zo.Ready){const r=this.reporter.reportError((()=>{t.click()}),"click");if((new Date).getTime()<this.lockedUntil)return void this.debug.log("Ignoring apparent duplicate click");this.phase=Zo.Sending,this.timeoutID=setTimeout((()=>{this.debug.log("Click timed out"),this.phase===Zo.Sending&&r()}),this.EVENT_TRIGGERED_DEADLINE),this.eventTracker.track(e,n,{successCallback:()=>{this.debug.log("Click tracked successfully"),clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=Zo.Sent,r()},errorCallback:()=>{this.debug.error("Cannot connect to server."),clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=Zo.Sent,r()}})}else this.phase===Zo.Sending?(clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=Zo.Ready,this.lockedUntil=(new Date).getTime()+500):this.phase===Zo.Sent&&(this.phase=Zo.Ready,this.lockedUntil=(new Date).getTime()+500)}}class Xo{constructor(t,e,n,r){this.reporter=t,this.eventTracker=e,this.debug=n,this.documentContentLoaded=r}trackLink(t,e,n){const r=new Yo(this.reporter,this.debug,this.eventTracker,(t=>{if(yt(e)){return e(t)}return{type:e,properties:n||{}}}));ui(t)?this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((function(){const e=mn(t);for(let t=0;t<e.length;t++)e[t].onclick=t=>r.trackClick(t)})):t.onclick=t=>r.trackClick(t)}}function ts(t,e,n){retur es{constructor(t,e){this.reporter=t,this.document=e,this._liveEventListeners={click:[],submit:[]}}initialize(){this._registerLiveEventListener("submit"),this._registerLiveEventListener("click")}_handleLiveEventListeners(t,e){t.forEach((t=>{try{mn.matchesSeleif(!(t instanceof Error))throw t}}))}addLiveEventback:n})}clearLiveEventListeners(){this._liveEventListeners={click:[],submit:[]}}_registerLiveEventListener(t){ts(this.document,t,(e=>this._handleLiveEventListeners(this._liveEventListeners[t],e)))}}yn([zi(),bn("design:type",Function),bn("design:paramtypes",[]),bn("design:returntype",void 0)],es.prototype,"initialize",null),yn([zi(),bn("design:type",Function),bn("design:paramtypes",[Array,Event]),bn("design:returntype",void 0)],es.prototype,"_handleLiveEventListeners",null);class ns{constructor(t,e){this.console=t,thonst t=(new Date).toUTCString();return`${this.logPrefix} [${t}]`}error(...t){this.print("error",t)}log(...t){this.print("log",t)}warn(...t){this.print("warn",t)}debug(...t){this.print("debug",t)}print(t,e){this.isConsoleSupported(t)&&0!==e.length&&("string"==typeof e[0]?e[0]=`${this.getMessagePrefix()} ${e[0]}`:e.unshift(this.getMessagePrefix()),this.console[t](...e))}isConsoleSupported(t){return void 0!==this.console&&"function"==typeof this.console[t]}}var rs={exports:{}};
/**
     * @file postscribe
     * @description Asynchronously write javascript, even with document.write.
     * @version v2.0.8
     * @see {@link https://krux.github.io/postscribe}
     * @license MIT
     * @author Derek Brans
     * @copyright 2016 Krux Digital, Inc
     */!function(t,e){var n;n=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:)):t.jquery?t[0]:t,e,n];return t.postscribe={cancel:funon(t,e,n){e.__esModule=!0;var r,i=Object.assi=n(3),s=(r=o)&&r.__esModule?r:{default:r},a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnPrtAttribute(n);rnew s.default("",{autoFiion(){var t;for((t=this.wrllFunction(e):this._wriToken())&&!(n=a.isScript(e))&&!e._writeStaticTokens=funsh("atomicTag"===a.typeeType;if(!n||!p(t,"proxyof")){nrs.src||t.attrs.SRC,(t=this.opn=function(t){var e=this.parswriteStyleToken=functioneTextNode(t.content)))},t.(t.attrs,(function(t,n){e.s'+e+'"/>');var n=this.doc.rites),!this.scriptStack.lengt_shouldRelease(n),i=this.options.error(t),e()}},t.protots,0))}catch(e){return void tion(){/^(loaded|cject"===(void 0===e?"undefined":n(e)))return e.v}var r},e.last=function(t){return t[t.length-1]},e.isTag=s,e.isScript=function(t){return s(t,"script")},e.isStyle=function(t){return s(t,"style")}}])},t.exports=n()}(rs);var is=Ji(rs.exports);class os{constructor(t,e,n,r,i,o,s){this.reporter=t,this.config=e,this.queue=n,this.location=r,this.document=i,this.debug=o,this.url=s}queryNryNonConstantManagedTagsAndShow(!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeQueryNonConstantManagedTagsAndShow",(()=>{this.queryNonConstantManagedTagsAndShow(!1)}))}processDefinition(t){ts.removeOverlayAndShowManagedTags(t,!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeRemoveOverlayAndShowManagedTags",(()=>{this.removeOverlayAndShowManagedTags(t,!1)}))}showManagedTag(t){this.debug.log("Showing managed tag...",t);const e="definition"in t?t.definition:t.parametrized_definition;if("js"===t.type){let t;try{t=new Function(e)}catch(t){return this.debug.error("Syntax error in the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for syntax errors, such errors are usually\nhighlighted in the UI. The first line of the stack trace below should give you\na clue.\n\n",t)}try{t()}catch(t){this.debug.error("Error when executing the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for errors. This is not a syntax error and\nmay be hard to spot, but the first line of the stack trace below should give\nyou a clue.\n\n",t)}}else if("html"===t.type)try{is(this.document.body,e)}catch(t){this.debug.error("Error when applying an html managed tag.\n\nThere was an error when applying the html managed tag using\nPostscribe (https://github.com/krux/postscribe/).\n\n",t)}else this.debug.error(`Unknown managed tag type "${t.type}". The type\nmay only be "html" or "js".`)}removeOverlayAndShowManagedTags(t,e){if(e){const e=this.document.getElementById("__exponea__overlay__"),n=!e&&this.config.getOptions().modify.overlay&&!!window[l].__;this.filterAndShowManagedTags(t,n),e&&e.parentElement&&e.parentElement.removeChild(e)}else this.filterAndShowManagedTags(t,!1)}queryNonConstantManagedTagsAndShow(t){let e=ti(this.config.getOptions().customer);this.queue.enqueue({name:Mi.ManagedTagsShow,noBulk:!0,prepareData:()=>(this.debug.log("Gi(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:e,current_url:this.location.href}}),processResponse:e=>{this.removeOverlayAndShowManagedTags(e.data,is.debug.error("Error getting non-constant managed tags",t)}})}filterAndShowManagedTagdTags(t.filter(n("overlay",(t=>!e||!t.uses_overlay))).filter(n("page",(t=>!("trigger"in t)||_o.matches(this.location.href,t.trigger)))))}showManagedTags(t){t.forEach((t=>this.showManagedTag(t)))}}yn([zi(),bn("design:type",Function),bn("design:paramtypes",[]),bn("design:returntype",void 0)],os.prototype,"queryNonConstantManagedTagsAndShowOnUrlChange",null),yn([zi(),bn("design:type",Function),bn("design:paramtypes",[Object]),bn("design:returntype",void 0)],os.prototype,"showManagedTag",null);class ss{constructor(t,e,n,r,i,o,s){this.reporter=t,this.window=e,this.serviceWorkerManager=n,this.database=r,this.storageUtils=i,this.config=o,this.logger=s,this.webExperienceObject=this.getWebExperienceObject()}initialize(){const t=this.config.getNewExperimentsOptionManager.isAvailable()&&this.database.isSupported()&&this.storageUtils.isStorageAvailable("localStorage")){const t=this.config.storeInIndex(()=>this.serviceWworker is only required for the "sync" mode. Inea.com/docs/integrating-and-using-experiments.')}));this.reporter.reportPromiseError(t)}vObject||!this.webExperienceObject.skipExperiments)}getWebExperienceObject(){const t=this.window[l],e=t&&t.webxp,n=this.window[x];return e||n}}function as(t){t.writeToStorage("localStorage",f,!0)}yn([zi(),bn("design:type",Function),bn("design:paramtypes",[]),bn("design:returntype",void 0)],ss.prototype,"initialize",null);const cs={click:!0,key:!0,move:!0,scroll:!0},us={click:["click","mousedown","pointerdown","touchstart"],move:["mousemove","pointermove"],key:["keydown"],scroll:["wheel","touchmove","scroll"]};class ls{constructor(t,e={},n){this.window=t,this.activityCallback=n,this.listenersRegistered=!1,this.options=Cr({},e,cs)}registerActionListeners(){this.listenersRegistered||(ci(us,((t,e)=>{t.forEach((t=>{ts(this.window,t,(()=>{this.options[e]&&(this.lactivityCallback(e))}))}))})),this.listenersRegistered=!0)}setOptions(t){this.options=Cr({},t,this.options)}getLastUserActivity(){return this.lastActivity}resetActivity(){this.lastActivity=void 0}}class hs{constructor(t,e,n,r,i,o,s,a,c,u,l,h){this.reporter=t,this.config=e,this.timestamp=n,this.eventTracker=r,this.whis.document=s,this.debug=a,this.cookies=c,this.storageUtils=u,this.unloader=l,this.url=h,this.activityHandler=new ls(this.window,this.config.getActivityHandlerOptions(),(t=>this.resumePinging(t)))}sendPing(t=!1,e){const n=this.config.getOptions().ping;if(!n||!n.enabled)return this.stopPinging();const r=this.shouldCheckActivity(n.activity);if(t&&r&&!this.activityHandler.getLastUserActivity())return this.debug.log("No user activity detected so not pinging"),void this.stopPinging();const i=this.getPingParams(e);i&&(this.debug.log("Sending session ping"),this.eventTracker.track("session_ping",i)),this.onSessionPing(),this.activityHandler.resetActivity()}initializeWebUnloadTracking(){this.config.getOptions().track.unloads&&this.unloader.addListener((()=>{this.eventTracker.track("web_unload",this.getPingParams()||{})}))}restartPinging(){this.stopPinging();const t=this.config.getOptions().ping;t&&t.enabled&&(this.debug.log("Session ping is enabled"),this.activityHandler.registerActionListeners(),this.sendPing(!1,"page_load"),this.intervalId=this.window.setInterval((()=>this.sendPing(!0)),1e3*t.interval))}setOptions(t){this.debug.log("Changing ping configuration: ",t),this.config.extendOptions({ping:t}),this.setActivityHandlerOptions()}onSessionPing(t=(new Date).getTime()){const e=this.getLastSessionPing();this.storageUtils.isStorageAvailable("localStorage")&&((null===e||e<t-12e5)&&this.onSessionStart(t),this.setLastSessionPing(t))}getPingParams(t){const e=this.config.getOptions(),n=this.getLastActivity(t);if(!this.shouldSendActivity(n))return;let i={};e.utm_params&&(i=this.url.getParams(e.utm_params)),Object.assign(i,e.ping.properties),i.referrer=this.document.referrer,i.locatr);return o&&(i.cookie=o),i}getLastSessionStart(){return this.timestamp.getStoredTimestamp(u)}setActivityHandlerOptions(){t){this.timestamp.storeTimestamp(c,t)}setLastSessionStart(t){this.timestamp.storeTimestamp(u,t)}stopPinging(){this.intervalId&&(this.window.clearInterval(this.intervalId),this.intervalId=void 0)}resumePinging(t){const e=this.config.getOptions().ping;e&&e.enabled&&!this.interer.registerActionListeners(),this.sendPing(!1,t),this.intervalId=this.winInterval((()=>this.sendPing(!0)),1e3*e.interval))}getLastSessionPing(){return this.timestamp.getStoredTimestamp(c)}shouldCheckActivity(t){return"boolean"==typeof t?t:Object.values(t).some((t=>!!t))}shouldSendActivity(t){const e=this.config.getOptions().ping.activity;if("boolean"==typeof e)return!0;switch(t){case void 0:case"page_load":return!0;case"click":return!!e.click;case"scroll":return!!e.scroll;case"key":return!!e.key;case"move":return!!e.move;default:return!1}}getLastActivity(t){return t||(this.activityHandler&&this.activityHandler.getLastUserActivity()?this.activityHandler.getLastUserActivity():void 0)}}functioturn function(n,r,i){const o=i.value,s=e+String(r);return i.value=function(){return ds(t,s,arguments),fs(t,s,arguments),o.apply(this,arguments)},i}}function ds(t,e,n){const r=vi(t,(t=>!t.optional)).length;if(n.length<r)throw new Go(`Invalid number of arguments when calling ${l}.${String(e)}, expected ${r} but got ${n.length}`)}function fs(t,e,n){Tt(n,((n,r)=>{const i=t[r];if(!i){if(r>=t.length)return;throw new Go(`Missing definition for argument ${r} of ${l}.${e} inthe @${ps.name} decorator!`)}if(void 0===n){if(i.optional)return;throw new Go(`Missing argument ${r} - ${i.name} when calling ${l}.${e}, `+ms(i)+" but got "+typeof n)}const o=typeof n;let s;switch(o){case"boolean":case"number":case"bigint":case"string":case"symbol":case"function":s==n?"null";break;default:throw gs(e,r,i,typeof n,n)}if("type"in i){if(s!==i.type)throw gs(e,r,i,s,n)}else if(!function(t,e,n){var r=G(t)?Xt:mi;return n&&Sr(t,e,n)&&(e=void 0),r(t,hn(e))}(i.oneOf,(t=>t===s)))throw gs(e,r,i,s,n)}))}function gs(t,e,n,r,i){return new Go(`Invalid type of argument ${e} - ${n.name} when calling ${l}.${t}, `+ms(n)+` but got ${r}: `+function(t,e){let n=String(t);"object"===e&&(n=JSON.stringify(t));"array"===e&&(n=`[${n}]`);if("element"===e){n=`HTMLElement ${t.tagName.toLowerCase()}`}n.length>128&&(n=n.substring(0,128)+"...");return n}(i,r))}function ms(t){return"type"in t?`expected ${n:type",Function),bn("design:paramtypes",[Object,String]),bn("design:returntype",void 0)],hs.prototype,"sendPing",null);class vs{constructor(t,e){this.pushWebApi=t,this.pushSafariApi=e,this._=[]}subscribe(t=(()=>{})){this.pushWebApi.isAvailable()?this.pushWebApi.subscribe(t):this.pushSafariApi.isAvailable()?this.pushSafariApi.subscribe(t):t(go.Unsupported)}unsubscribe(t=(()=>{})){this.pushWebApi.isAvailable()?this.pushWebApi.unsubscribe(t):this.pushSafariApi.isAvailable()?this.pushSafariApi.unsubscribe(t):t(go.Unsupported)}isAvailable(t){const e=this.pushWebApi.isAvailable()||this.pushSafariApi.isAvailable();return t&&t(e),e}isSubscribed(t){this.pushWebApi.isAvailable()?this.pushWebApi.isSubscribed(t):this.pushSafariApi.isAvailable()?this.pushSafariApi.isSubscribed(t):t(!1,!1)}}yn([ps([{name:"callback",type:"function",optional:!0}],"notifications."),bn("design:type",Function),bn("design:paramtypes",[Function]),bn("design:returntype",void 0)],vs.prototype,"subscribe",null),yn([ps([{name:"callback",type:"function",optional:!0}],"notifications."),bn("design:type",Function),bn("design:paramtypes",[Function]),bn("design:returntype",void 0)],vs.prototype,"unsubscribe",null),yn([ps([{name:"callback",type:"function",optional:!0}],"notifications."),bn("design:type",Function),bn("design:paramtypes",[Function]),bn("design:returntype",Boolean)],vs.prototype,"isAvailable",null),ynpes",[Function]),bn("design:returntype",void 0)],vs.prototype,"isSubscribed",null);class ys{constructor(t,e,n,r,i){this.window=t,this.config=e,this.customer=n,this.location=r,this.storageUtils=i}subscribe(t,e={}){var n,r;const i=Object.assign({},this.config.getOptions().customer),o=this.getWebServiceUrl(),s=null===(n=this.config.getOptions().push.safari)||void 0===n?void 0:n.websitePushID;if(!s||!(null===(r=this.window.safari)||void 0===r?void 0:r.pushNotification))return void t(go.Unsupported);const a=this.window.safari.pushNotification.permission(s);if(!a)return void t(go.Error);const{permission:c}=a;"denied"!==c?this.window.safari.pushNotification.requestPermission(o,s,i,(({deviceToken:n,permission:r})=>{"granted"===r&&(this.storageUtils.writeToStorage("localStorage",d,!0),this.customer.updateCustomer(Object.assign({safari_push_notification:n},e))),t(this.getStatusForPermission(r))})):t(this.getStatusForPermission(c))}unsubscribe(t){this.storageUtils.writeToStorage("localStorage",d,!1),this.customer.updateCustomer({safari_push_notification:""},(()=>t(go.Unsubscribed)),(()=>t(go.Error)),!0)}handleDeniedSubscription(){this.isAvailable()&&this.isSafariSubscriptionEqual("denied")&&this.isPushTokenStoredInExponea((t=>{t&&this.unsubscribe((()=>{}))}))}isAvailable(t=this.location){var e,n;return!(!(null===(e=this.window.safari)||void 0===e?void 0:e.pushNotification)||!(null===(n=this.config.getOptions().push.safari)||void 0===n?void 0:n.websitePushID)||"https:"!==t.protocol&&"localhost"!==t.hostname&&"127.0.0.1"!==t.hostname)}isSubscribed(t){this.isPushTokenStoredInExponea((e=>{t(this.isSafariSubscriptionEqual("granted")&&e,this.isSafariSubscriptionEqual("denied"))}))}isPushTokenStoredInExponea(t){setTimeout((()=>{try{t(!!this.storageUtils.readBooleanFromStorage("localStorage",d))}catch(e){t(!1)}}))}isSafariSubscriptionEqual(t){var e,n;const r=null===(e=this.window.safari)||void 0===e?void 0:e.pushNotification,i=null===(n=this.config.getOptions().push.safari)||void 0===n?void 0:n.websitePushID;if(!r||!i)return!1;return r.permission(i).permission===tcts/${e}/safari`;return/^\/\//.test(n)&&(n="https:"+n),n}getStatusForPermission(t){switch(t){case"granted":return go.Subscribed;case"denied":return go.PermissionDenied;default:return go.Default}}}class bs{constructor(t,e,n,r,this.customer=o,this.queue=s,this.serviceWorkerManager=a,this._setVapidKey=()=>{},this.vapidKeyPromise=new Promise((t=>this._setVapidKey=t))}initialize(){this.isAvailable()&&this.requestVapidKey()}subscribe(t,e={},n=Notification){"granted"===n.permission?this.subscribeServiceWorker(t,e):n.requestPermission((n=>{"granted"===n?this.subscribeServiceWorker(t,e):t("default"===n?go.Default:go.PermissionDenied)}))}unsubscribe(t){this.serviceWorkerManager.isReady().then((t=>t.pushManager.getSubscription())).then((t=>{if(t)return t.unsubscribe().then((t=>{if(!t)throw new Error("Failed to unsubscribe");this.notifyServer(!1)}))})).then((()=>t(go.Unsubscribed))).catch((()=>t(go.Error)))}isAvailable(t=this.location){const e=this.window;return"Notification"in e&&"PushManager"in e&&this.serviceWorkerManager.isAvailable()&&"showNotification"in e.ServiceWorkerRegistration.prototype&&("https:"===t.protocol||"localhost"===t.hostname||"127.0.0.1"===t.hostname)}isSubscribed(t,e=Nr="denieerManager.register().then((()=>this.serviceWorkerMa))).then((t=>t.pushManager.getSubscription())).then((t=>{if(!t)throw new Error("Missing push notification subscription");return t})).then((()=>this.config.storeInIndexedDB())).then((()=>{t(!0,r)})).catch((e=>{this.logger.error("Failed to check whether the user is subscribed:",e),t(!1,r)})):t(!1,r)}notifyServer(t,e={}){if(t){const{data:n,vapidKey:r}=t;e[g]=n,e[m]=r||""}else e[g]="",e[m]="";this.custome,void 0,!0)}subscribeServiceWorker(t,e){this.serviceWorkerManager.register().then((()=>this.serviceWorkerManager.isReady())).then((t=>this.config.storeInIndexedDB().then((()=>this.vapidKeyPromise)).then((t=>{if(void 0===t)return{vapidKey:void 0,vapidKeyUint8Array:void 0};try{return{vapidKey:t,vapidKeyUint8Array:_s(t)}}catch(t){throw this.debug.error(new Error("Could not coybe it is not in the Base64 format?")),t}})).then((({vapidKey:e,vapidKeyUint8Array:n})=>t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n}).then((t=>({subscription:t,vapidKey:e}))))))).then((({subscription:n,vapidKey:r})=>{const i=Object.assign(Object.assign({},n.toJSON()),{vapidKey:!!r});this.notifyServer({data:i,vapidKey:r},e),t(go.Subscribed)})).catch((e=>{this.logger.error("Failed to subscribe the push notifications because of:",e),t(go.Error)}))}requestVapidKey(){this.queue.enqueue({name:or.PushNotificationsVapidKey,prepare.co 0)}})}}orter=t,this.config=e,this.queue=n,this.debug=r,this.timestamp=i,this.automaticTracking=o,this.window=s,this.eventTracker=a,this.customer=c,this.liveEventHandler=u,this.storageUtils=l,this.url=h}initialize(){this.config.getOptions().track.auto&&(this.liveEventHandler.initialize(),this._getTrackingDefinition())}_getTrackingDefinition(){this.debug.log("attempting to get tracking definition");const t=this._getCachedTrackingDefinition();t?this._trackByRules(t):this._fetchTrackingDefinitionAndTrackByRules()}_getCachedTrackingDefinition(){const t=this.storageUtils.readStringFromStorage("sessionStorage",o);if(!t)return this.debug.log("tracking definition not found in session storage"),null;this.debug.log("tracking definition found in session storage",t);let e=null;try{e=JSON.parse(t)}catch(t){this.debug.error("failed parsing cached tracked definition")}if(e){if(e.expires>this.timestamp.getUnixTimestamp())return e.data;this.debug.warn("tracking definition from session storage is expired")}return null}_fetchTrackingDefinitionAndTrackByRules(){this.queue.enqueue({name:or.Tracking,prepareData:()=>(this.debug.log("fetching automatic tracking definition"),{data:{company_id:this.config.getToken()}}),processResponse:t=>{const{data:e}=t;this._storeTrackingDefinitionIntoCache(e),this._trackByRules(e)},processError:t=>{this.debug.error("Error getting this.config.isSpaReloadingEnabled("automatic_tracking")&&this.url.onChange("QueryTracking.doTrackByRulesOnUrlChange",(()=>{this.liveEventHandler.clearLiveEventListeners(),this._doTrackByRules(t)}))}_doTrackByRules(t){t.filter((t=>_o.matches(this.window.location.href,t.trigger))).forEach((t=>{"visit"===t.trigger.type?this._doTrackAction(t.action,null):"click"===t.trigger.type?this._doBindOnClickHandlers(t.trigger.selector,t.action):"submit"===t.trigger.type&&this._doBindOnSubmitHandlers(t.trigger.selector,t.action)}))}_doBindOnClickHandlers(t,e){this.liveEventHandler.addLiveEventListener("click",t,(t=>{this._doTrackAction(e,t.target,{immediate:!Jo})}))}_doBindOnSubmitHandlers(t,e){this.liveEventHandler.addLiveEventListener("submit",t,(t=>{this._doTrackAction(e,t.target,{immediate:!Jo})}))}_storeTrackingDefinitionIntoCache(t){this.storageUtils.writeToStorage("sessionStorage",o,JSON.stringify({expires:this.timestamp.getUnixTimestamp()+3600,data:t}))}_doTrackAction(t,e,n={}){"track"===t.type?this.automaticTracking.materializeProperties(t.properties,e,this.reporter.reportError((e=>{this.eventTracker.track(t.event_type,e,n)}),"trackEvent")):"identify"===t.type?this.automaticTracking.materializeIds(t.as_who,e,this.reporter.reportError((t=>{this.customer.identifyCustomer(t,{},void 0,void 0,n.immediate)}),"identifyCustomer")):"update"===t.type&&this.automaticTracking.materializeProperties(t.properties,e,this.reporter.reportError((t=>{this.customer.updateCustomer(t,void 0,void 0,n.immediate)}),"on),bn("design:paramtypes",[]),bn("design:returntype",void 0)],ws.prototype,"initialize",null);const ks={track:!1,callback:!0,retry:!0};class xs{get targetUrl(){return this.getCommandTargetUrl()}get name(){return this.options.name}constructor(t,e,n,r,i,o=o){this.options=t,this.reporter=e,this.timeconfig=r,this.featureFlags=i,this.window=o,this.enqueuedAt=this.timestamp.getUnixTimestamp()}processResponse(t,e,n){const r=this.options.processResponse;r&&this.reporter.reportError((()=>r(t,e,n)),"httpRequest")()}processError(t,e={}){if((e=Cr(e,ks)).track&&this.reporter.sendErrorReport(t,"httpRequest",this.enqueuedAt),e.callback&&this.options.processError){const e=this.options.processError;this.reporter.reportError((()=>e(t)),"httpRequest")()}}prepareData(t){const e=this.options.prepareData;if(!e)return{state:void 0};try{return e(t)}catch(t){this.reporter.sendErrorReport(t,"prepareData"),this.processError(t,{retry:!1})}}getCommandTargetUrl(){if(Ts(this)){let t=Ss(`${this.cothis.featureFlags.flags.ewx_279_invalid_integration_monitor&&this.name===Mi.WebOptimization&&!this.config.getOptions().new_experiments&&function(t){return!!(t&&t.webxpClient&&t.webxpClient.init)}(this.window)&&(t+="?ii=1"),t}retu}/bulk`,this.config)}}function Ss(t,e){tomer.cookie|lace(/<cookie>/g,r)}function Es(t){return!t.options.noBulk}function Ts(t){return!!t.options.noBulk}function Cs(t){return!!t.options.action}const As=36e5;function Os(t,e=5e3eturn function(){return r++,void setTimeout((function(){let i=e*n;i>As&&(i=As);if(r>=100)return void t();const o=js(t,i,n,r);t(ofree token to take");this.takenTokens++}releaseToken(){if(!this.takenTokens)throw new Error("There are no taken tickets");this.takenTokens--}hasFreeToken(){return this.takenTokens<this.capacity}}const Ls="Command queue retry limit reached!",Is=Object.freeze({maxCommandsInQueue:1e3,maxCommandsProcessedInParallel:500,maxCommandsInBulkRequest:50,processDebounceTime:100}),Bs=Object.freeze({first:!1,process:Ci.defer});class zs{get length(){return this.commandsList.length}constructor(t,e,n,r,i,o,s,a,c={},u=s.navigator){this.reporter=t,this.config=e,this.http=n,this.debug=r,this.timestamp=i,this.unloader=o,this.window=s,this.featureFlags=a,this.navigator=u,this.commandsList=[],this.isProcessingBlockingCommands=!1,this.numberOfEnqueuedCommandsIgnored=0,tfreeze(Cr(c,Is)),this.unloader.addAfterListener((()=>{this.sendBulkWithBeacon()})),this.tokenSystem=new Ps(this.options.maxCommandsProcessedInParallel),this.debounceProcess=ii((()=>this.process()),this.options.processDebounceTime)}enqueue(t,e={}){if(e=Cr(e,Bs),this.debug.log("Enqueuing command "+t.name),this.isQueueExceeded())return this.debounceProcess(),!1;const n=new xs(t,this.reporter,this.timestamp,this.config,this.featureFlags,this.window);return e.first?this.commandsList.unshift(n):this.commandsList.push(n),e.process===Ci.immediate?this.process():e.process===Ci.defer?this.debounceProcess():this.debug.debug("Queue is not processing the enqueued command because 'process' is false"),!0}execute(t){this.debug.log("Executing command "+t.name);const e=new xs(t,this.reporter,this.timestamp,this.config,this.featureFlags,this.window),n=Os((t=>{Ds(e,this.ndSingle.bind(this),t)}),this.options.processDebounceTime,1);t.allowedToFail?this.sendSingle(e,void 0):Ds(e,this.tokenSystem,this.debug,this.sendSingle.bind(this),n)}clear(){this.commandsList=[]}registerPostBulkCallback(t){this.postBulkCallback=t}sendBulkWithBeacon(){if(0===this.commandsList.length)returnthis.commandsList.filter(Es);this.debug.log("Queue is sending "+t.length+"/"+this.commandsList.length+" commands with beacon",t);var e;if(this.commandsList=this.commandsList.filter((e=Es,t=>!e(t))),0===t.length)return;const n=this.config.getOptions().target+"/bulk",{bulkData:r}=Fs(t,this.timestamp),i={beacon:!0,commands:r},o=new Blob([JSON.stringify(i)],{type:"application/json"});this.navigator.sendBeacon(n,o)||this.debug.warn("Beacon data has not been queued for transfer!")}process(){if(this.commandsList.length<=0)return void this.debug.debug("Queue is empty, there are no commands to process");if(this.isProcessingBlockingCommands)return this.debug.debug("Queue is currently processing blocking commands and has to wait"),void this.debounceProcess();this.debug.debug("Processing queue commands"),this.debug.debug(`There are ${this.length} enqueued commands`);const t=[];for(let e=this.commandsList.shift();e;e=this.commandsList.shift()){if(Cs(e))try{e.options.action()}catch(t){throw this.reporter.sends(e)){const n=Ms(e,this.tokenSystem,this.sendSingle.bind(this));n&&t.push(n)}else{const n=Ns(e,this.commandsList,this.tokenSystem,this.debug,this.options,(()=>this.isProcessingBlockingCommands=!0),this.sendBulk.bind(this));t.push(...n)}if(this.isProcessingBlockingCommands){this.debug.debug("Queue is now blocked and it cannot continue processing commands"),t.push(...this.commandsList);break}}this.debug.debug("Queue commands have been processed"),this.debug.debug(`There are ${t.length} commands that will be processed in the next batch after a timeout`,t),this.commandsList=t,this.commandsList.length>0&&this.debounceProcess()}sendBulk(t,n){if(!t.length)return;const r=`${this.config.getOptions().target}/bulk`,{bulkData:i,commandStates:o}=Fs(t,this.timestamp),s={sdk:"js-client",sdk_version:e,sdk_snippet_version:Vo(this.window),commands:i};this.debug.log(`Queue is sending ${t.length} commands in bulk`,t),this.http.post(r,s).then((e=>{const n=e.body;this.postBulkCallback&&this.postBulkCallback(),t.forEach(((t,e)=>{t.options.isBlocking&&(this.isProcessingBlockingCommands=!1);const r=n.results[e];"ok"===r.status?t.processResponse(r,o[e],{start_time:n.start_time,end_time:n.end_time}):t.processError(new Error(r.errors.join(", ")),{retry:!1}),this.tokenSystem.releaseToken()})eue bulk request failed with errors:",e),Rs(e)&&e.response.status<500?t.forEach((t=>{t.processError(e,{retry:!1}),this.tokenSystem.releaseToken()})):(t.forEach((t=>t.processError(e,{callback:!1}))),n?(this.debug.log("Retrying the request...",t),n()):t.forEach((t=>t.processError(new Error(Ls)))))}))}sendSingle(t,e){const n=this.timestamp.getTimestamp(),r=t.prepareData(n);r&&(this.debug.log("Queue is sending a single command "+t.name,t),function(t,e,n){if(function(t){return!Ts(t)||t.options.httpMethod!==No.get}(e))return t.post(e.targetUrl,n.data);return t.get(e.targetUrl)}(this.http,t,r).then((e=>{t.options.isBlocking&&(this.isProcessingBlockingCommands=!1),t.processResponse(e.body,r.state),this.tokenSystem.releaseToken()})).catch((n=>{if(this.debug.warn("Queue single s:",n),Rs(n)&&n.response.status<500){const e=new Error(function(t){const e=t.response.body;if("string"==typeof e)return e;return Object.entries(e.errors||{}).map((([t,e])=>`${t}: ${e.join(", ")}`)).join("; ")}(n));t.processError(e,{retry:!1}),this.tokenSystem.releaseToken()}else t.processError(n,{callback:!1}),e?(this.debug.log("Retrying the request...",t),e()):t.processError(new Error(Ls))})))}isQueueExceeded(){const t=this.commandsList.length>=this.options.maxCommandsInQueue;return t?(this.numberOfEnqueuedCommandsIgnored+=1,1===this.numberOfEnqueuedCommandsIgnored&&this.debug.warn("Maximum queue length has been exceeded, further commands will be ignored")):this.numberOfEnqueuedCommandsIgnored>0&&(this.dd it can receive commands again. There were ${this.numberOfEnqueuedCommandsIgnored} commands that were ignored.`),this.numberOfEnqueuedCommandsIgnored=0),t}}function Rs(t){return t instanceof zo}function Fs(t,e){const n=[],r=[],i=e.getTimestamp();for(const e of t){const t=e.prepareData(i);t&&(n.push({name:e.name,data:t.data}),r.push(t.state))}return{bulkData:n,commandStates:r}}function Ds(t,e,n,r,i){if(Ms(t,e,r)){if(!i){const e=`Max retry count reached for ${t.name}`;return n.error(e),void t.processError(new Error(e))}n.log(`Retry ${t.name} execution later because there were no free tokens...`),i()}}function Ms(t,e,n){if(!e.hasFreeToken())return t;e.takeToken();const r=Os((e=>{n(t,e)}));return n(t,t.options.allowedToFail?void 0:r),null}function Ns(t,e,n,r,i,o,s){const a=[],c=[],u=[];for(;t;t=e.shift())if(Ts(t))c.push(t);else if(n.hasFreeToken()){if(n.takeToken(),t.options.isBlocking&&(o(),r.log("Queue encounlog("Fursts will not be made until this one finishes")),a.push(t),a.length>=i.maxCommandsInBulkRequest)break}else u.push(t);e.unshift(...c);const l=a.every((t=>!!t.options.allowedToFail)),h=Os((t=>s(a,t)));return s(a,l?void 0:h),u}class Us{constructor(t,e,n){this.config=t,this.queue=e,this.debug=n}fetch(t,e){let n;n=ui(t)?this.migrateOldGetRecommendationSignature.apply(this,e):t,this.commendation,noBulk:!0,prepareData:()=>(this.debug.log("Get recommendations: ",n.recommendationId),{data:this.processGetRecommendationOptions(n)}),processResponse:t=>{Bi((()=>{n.callback(t.data)}))}})}processGetRecommendationOptions(t){const e=this.config.getOptions(),n={project_id:this.config.getToken(),customer_ids:e.customer,engine_id:t.recommendationId,anti:!!t.anti,similarity:!!t.similarity,anonymous:!!t.anonymous,consider_known_items:!!t.considerKnowItems,fill_with_random:t.fillWithRandom,catalog_filter:t.catalogFilter,catalog_attributes_whitelist:t.catalogAttributesWhitelist,category_names:t.categoryNames};if(t.size&&(n.size=t.size)ypeof t.splice||Z(t)||ct(t)||V(t)))return!t.length;var e=je(t);if("[object Map]"==e||"[object Set]"==e)retu!1;return!0}(t.items)&&(n.items=t.items);return t.noTrack&&(n.no_track=t.noTrack),n}migrateOldGetRecommendatioctoe,this.data=null,this.updatedAt=0}get(){return this.isFresh()?this.data:null}set(t){this.data=t,this.updatedAt=this.performance.now()}clear(){this.data=null,this.updatedAt=this.performance.now()}isFresh(){return this.performance.now()-this.updatedAt<this.config.getOptions().exposed_segments.ttl}}class Ws{constructor(t,e,n,r,i=window.performance){this.reporter=t,this.config=e,this.initializeState=n,this.queue=r,this.performance=i,this._=[],this.inProgress=!1,this.discoverySubscribers=new Map,this.contentSubscribers=new Map,this.merchandisingSubscribers=new Map,this.discoverySubscriberId=0,this.contentSubscriberId=0,this.merchandisingSubscriberId=0,this.lastSegmentNotificationValue=null,this.cache=new qs(this.config,this.performance)}getSegments(t,e,n,r={force:!1}){const i=function(n){e(function(e){return e[t]}(n))};r.force&&this.cache.clear();const o=this.cache.get();o?i(o):(this.prefetch(!0),this.segmentsPromise&&this.segmentsPromise.then(hiosed_segments.prefetch||t)&&!1===this.inProgress&&(this.inPrse=this.segmentsQueuePromise(),this.segmentsPromise.then((t=>{this.cache.set(t)}),(()=>{this.cache.clear()})),this.segmentsPromise.finally((()=>{this.inProgress=!1})))}flush(){this.cache.clear()}subscribe(t,e,n){if("discovery"===t){const t=++this.discoverySubscriberId;return this.discoverySubscribers.set(t,{successCallback:e,errorCallback:n}),{unsubscribe:()=>{this.discoverySubscribers.delete(t)}}}if("content"===t){const t=++this.contentSubscriberId;return this.contentSubscribers.set(t,{successCallback:e,errorCallback:n}),{unsubscribe:()=handising"===t){const t=++this.merchandisingSubscriberId;return this.merchandisingSubscribers.set(t,{successCallback:e,errorCallback:n}),{unsubscribe:()=>{this.merchandisingSubscribers.delete(t)}}}throw new Error(`Unsupported subscription category: ${t}.`)}notify(){return _n(this,void 0,void 0,(function*(){if(this.config.getOptions().exposed_segments.notify)try{this.segmentsPromise=this.segmentsQueuePromise();const t=yield this.segmentsPromise,e=this.lastSegmentNotificationValue;this.notifySuccessSubscribers("discovery",e,t),this.notifySuccessSubscribers("content",e,t),this.notifySuccessSubscribers("merchandising",e,t),this.lastSegmentNotificationValue=t}catch(t){this.notifyErrorSubscribers("discovery",t),this.notifyErrorSubscribers("content",t),this.notifyErrorSubscribers("merchandising",t),this.lastSegmentNotificationValue=null}}))}notifySuccessSubscribers(t,e,n){let r;if("content"===t)r=this.contentSubscribers;else if("discovery"===t)r=this.discoverySubscribers;else{if("merchandising"!==t)throw new Error(`Unsupported subscription category: ${t}.`);r=(t,e,n){if(!e)return!0;if(!n&&!e)return!1;if(!n&&e)return!0;const r=e[t]||[],i=n[t]||[];if(i.length!==r.length)return!0;return i.some((t=>{const e=r.find((e=>e.segmentation_id===t.segmentation_id));return!e||!(!e||t.id===e.id)}))}(t,e,n))for(const[e,i]of r)i.successCallback(n[t])}notifyErrorSubscribers(t,e){let n;if("content"===t)n=this.contentSubscribers;else if("discovery"===t)n=this.discoverySubscribers;else{if("merchandising"!==t)throw new Error(`Unsupported subscription category: ${t}.`);n=this.merchandisingSubscribers}for(const[t,r]of n)r.errorCallback&&r.errorCallback(e)}segmentsQueuePromise(){return new Promise(((t,e)=>{this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Mi.Segments,noBulk:!0,httpMethod:No.get,processResponse:t,processError:e},{process:Ci.immediate})}))}))}}yn([zi(),bn("design:type",Function),bn("design:paramtypes",[String,Function,Function,Object]),bn("design:returntype",void 0)],Ws.prototype,"getSegments",null),yn([zi(),bn("design:type",Function),bn("design:paramtypes",[Boolean]),bn("design:returntype",void 0)],Ws.prototype,"prefetch",null),yn([zi(),bn("design:type",Function),bn("design:paramtypes",[]),bn("design:returntype",void 0)],Ws.prototype,"flush",null),yn([zi(),bn("design:type",Function),bn("design:paramtypes",[String,Function,Function]),uctor(t,e,n){this.window=t,this.debug=e,this.config=n}get serviceWorker(){return this.window.navigator.serviceWorker}get serviceWorkerPath(){return this.config.getOptions().service_worker_path}isAvailable(){return"serviceWorker"in this.window.navigator&&"ServiceWorkerRegistration"in this.window}register(){return this.serviceWorker.register(this.serviceWorkerPath,{updateViaCache:"none"}).catch((t=>{throw this.debug.error(`Failed to the register service worker on '${this.serviceWorkerPath}' because of:`,t),t}))}isReady(){return this.serviceWorker.ready}isRegistered(){return this.serviceWorker.getRegistration(this.serviceWorkerPath).then((t=>!!t))}}class Hs{constructor(t,e,n){this.logger=t,this.localStorage=e,this.sessionStorage=n,this.isAvailable={localStorage:Vs(e),sessionStorage:Vs(n)}}writeToStorage(t,e,n){if(!this.isStorageAvailable(t))return!1;try{return vt(n)?this.getStorage(t).setItem(e,JSON.stringify(n)):this.getStorage(t).setItem(e,String(n)),!0}catch(t){return this.logger.error("Couldn't write to local storage, some features may be broken.",t),!1}}removeFromStorage(t,e){return!!this.isStorageAvailable(t)&&(this.getStorage(t).removeItem(e),!0)}readStringFromStorage(t,e){if(!this.isStorageAvailable(t))return null;try{return this.getStorage(t).getItem(e)}catch(t){return null}}readNumberFromStorage(t,e){const n=this.readStringFromStorage(t,e);if(!n)return null isNaN(r)?null:r}readBooleanFromStorage(t,e){const n=this.readStringFromStorage(t,e);return null===n?null:"true"===n}isS__${l}_storage_test__`;return t.setItem(e,e),t.removeItem(e),!0}catch(t){return!1}}class Gs{constructor(t,e,n,r){this.timestamp=t,this.queue=e,this.cookies=n,this.debug=r,this.timeInitialized=!1}isTimeInitialized(){return this.timeInitialized}queryTime(t){if(this.timeInitialized)return;let e=this.cookies.getCookie(i);if("string"==typeof e&&(this.debug.log("getting time offset from cookie",e),e=Number(e),!isNaN(e)))return this.debug.log("timestamp is valid number, choosing"),this.timestamp.timestampOffset=e,this.timeInitialized=!0,void this.cookies.setCookie(i,e.toString(),"time");this.debug.log("no time offset stored, getting from server");const n=this.timestamp,r=this.cookies;this.queue.enqueue({name:or.Time,prepareData:()=>{const t=n.getTimestamp(),e={clientTS:t};return this.debug.log("getting server timestamp",e),{data:e,state:{clientTS:t}}},processResponse:(e,o,s)=>{const a=o.clientTS,c=n.getTimestamp();if(s&&s.start_time&&s.end_time){const t=c-a-(s.end_time-s.start_time);n.timestampOffset=s.end_time+t/2-c}else{this.debug.log("received time resn.timestampOffs){return(new Date).getTime()/1e3}storeTimestamp(t,e){this.storageUtils.writeToStorage("localStorage",t,e)}getStoredTimestamp(t){return this.storageUtils.readNumberFromStorage("localStoragp>=t&&(t=this.lastUsedTimestamp+.001),this.lastUsedTimestamp=t,t}getTimestampWithOffset(){return this.getTimestamp()+this.timestampOffsetValue}set timestampOffset(t){this.timestampOffsetValue=t}get timestampOffset(){return this.timestampOffsetValue}}const Qs={_keyStr:"1BGFYekyHP0tx4OKnQCIoUfMbhRaVEqrzLN._su96W5g3AcvXpZDlJdj78-mSi2wT",decode:function(t){let e="";t=t.replace(/[^A-Za-z0-9\._-]/g,"");let n=0;for(;n<t.length;){const r=this._keyStr.indexOf(t.charAt(n++)),i=this._keyStr.indexOf(t.charAt(n++)),o=this._keyStr.indexOf(t.charAt(n++)),s=this._keyStr.indexOf(t.charAt(n++)),a=r<<2|i>>4,c=(15&i)<<4|o>>2,u=(3&o)<<6|s;e+=String.fromCharCode(a),64!==o&&(e+=String.fromCharCode(c)),64!==s&&(e+=String.fromCharCode(u))}return Qs._utf8_decode(e)},_utf8_decode:function(t){let e="",n=0;const r="UTF-8 character cannot continue with: ";for(;n<t.length;){const i=t.charCodeAt(n);if(i<128)e+=String.fromCodePoint(i),n++;else if(i>191&&i<224){const o=t.charCodeAt(n+1);if(o<128||o>191)throw RangeError(r+o);e+=String.fromCodePoint((31&i)<<6|63&o),n+=2}else if(i>223&&i<240){const o=t.charCodeAt(n+1),s=t.charCodeAt(n+2);if(o<128||o>191)throw RangeError(r+o);if(s<128||s>191)throw RangeError(r+s);e+=String.fromCodePoint((15&i)<<12|(63&o)<<6|63&s),n+=3}else{if(!(i>239&&i<248))throw RangeError("UTF-8 character cannot start with: "+i);{const o=t.charCodeAt(n+1),s=t.charCodeAt(n+2),a=t.charCodeAt(n+3);if(o<128||o>191)throw RangeError(r+o);if(s<128||s>191)throw RangeError(r+s);if(a<128||a>191)throw RangeError(r+a);e+=String.fromCodePoint((7&i)<<18|(63&o)<<12|(63&s)<<6|63&a),n+=4}}}return e}};class Js{constructor(t,e){this.debug=t,this.location=e}getCustomerIdentityFromUrl(){const t=this.getTransferIdentityToken();if(!t)return null;let e;this.debug.log("found iitt token in URL",t);try{e=Qs.decode(t)}catch(t){return this.debug.error("iiit token is not valid base64 string"),null}this.debug.log("decoded token is",e);const n=e.indexOf(":");if(n<0)return this.debug.log("iit token is not valid"),null;constng transferred customer ID is",r),r}getTransferIdentityFirstClickToken(){return this.getParameterValueFromUrl("xnpe_tifc")}getTransferIdentityToken(){return this.getParameterValueFromUrl("iitt")]*)","gi"));if(!e)return;const n=e[e.length-1].match(/[?&]+[^=]+=([^&]*)/i);return n?n[1]:void 0}}class Zs{constructor(t,e){this.reporter=t,this.window=e,this.callbacks=[],this.afterCallbacks=[]}initialize(){this.window.addEventListener("pagehide",(()=>{Ys(this.reporter,this.callbacks),Ys(this.reportt.reportError(e,"unloaderCallback")()}))}class Xs{constructor(t,e,nreporter=t,this.config=e,this.location=n,this.history=r,this.window=i,this.logger=o,this.onChangeListeners=new Set}getParams(t){return function(t,e){const n={},r={};return t.forEach((t=>{r[t]=!0})),e.replace(/[?&]+([^=&]+)=([^&=decodeURIComponent(i)}catch(t){}return""})),n}(t,this.location.href)}getAllQueryParams(){return function(t){const e={};return new URL(t).searchParams.forEach(((t,n)=>{e[n]=decodeURIComponent(t)})),e}(this.location.href)}onChange(t,e){if(this.onChangeListeners.has(t))return;this.onChangeListeners.add(t);const n=ii(this.reporter.reportError(e,t),10);!function(t,e,n,r,i){if(!(!0===t.spa_reloading||t.s=t.spa_reloading.on_url_change))return;let o=n.href.replace(n.hash,"");if(!r.pushState)return;const s=r.pushState;r.pushState=(...t)=>{s.apply(r,t),o=ta(n,o,i)},ts(e,"popstate",(()=>{o=ta(n,o,i)}))}(this.config.getOptions(),this.window,this.location,this.history,n),function(t,e,n,r,i){if(!("object"==typeof t.spa_reloading&&!1!==t.spa_reloading.on_hash_change||!0===t.spa_reloading&&t.track_hash_changes))return;if(!("onhashchange"in e))return void r.warn("Browser is missing the HashChangeEvent support. The spa_reloading.on_hash_change option won't work.");ts(e,"hashchange",(o=n.hash,s=i,()=>{n.hash!==o&&(o=n.hash,s())}));var o,s}(this.config.getOptions(),this.window,this.location,this.logger,n)}}function ta(t,e,n){const r=t.href.replace(t.hash,"");return e!==r&&n(),r}class ea{constructor(t,e,n,r,i,o,s,a){this.reporter=t,this.config=e,this.linkTracker=n,this.eventTracker=r,this.window=i,this.debug=o,this.documentContentLoaded=s,this.unloader=a,this.activity={start:null,last:null},this._activityHandler=new ls(this.window)}trackExitsWithDataAttribute(){const t=this.config.getOptions().track;t&&(!0===t.exits||yt(t.exits))&&this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{let e=t.exits;yt(e)||(e=t=>{const e=t,n={location:e.href,current_location:window.location.href};return e.getAttribute("id")&&(n.element_id=e.getAttribute("id")),e.getAttribute("name")&&(n.element_name=e.getAttribute("name")),{type:"web_exit",properties:n}});const n=mn("a[data-exponea-track]");for(let t=0;t<n.length;t++)this.debug.log("Registering web exit link tracking for",n[t]),this.linkTracker.trackLink(n[t],e)}))}startActivityTracking(){const t=this.config.getOptions().track;t&&t.activity&&(this.debug.log("Activity tracking enabled"),this._activityHandler.registerActionListeners(),this.window.setInterval((()=>this.checkLastActivity()),1e3),this.unloader.addListener((()=>{this.trackActivityEvent(new Date,!0)})))}checkLastActivity(){if(this._activityHandler.getLastUserActivity()&&this._setUserWasActive(),this._activityHandler.resetActivity(),null==this.activity.last)return;const t=new Date;t.getTime()-this.activity.last.getTime()>6e4&&(this.trackActivityEvent(t),this.activity={start:null,last:null})}trackActivityEvent(t,e=!1){const n=this.config.getOptions().track;if(!e||this.activity.last&&this.activity.start||(this.activity.last=new Date,this.activity.start=this.activity.last),!n||!n.activity||null==this.activity.start||null==this.activity.last)return;const r=this.activity.start.getTime()/1e3,i=this.activity.last.getTime()/1e3;this.debug.log("Tracking user activity event"),this.eventTracker.track("user_active",{start_client_timestamp:r,end_client_timestamp:i,now_client_timestamp:t.getTime(),duration:i-r},{},e)}_setUserWasActive(){this.activity.last=new Date,null==this.activity.start&&(this.activity.start=this.activity.last)}}class na{constructor(t,e,n,r,i,o,s,a,c,u,l,h,p,d){this.reporter=t,this.config=e,this.contextualBanditEventFilter=n,this.queue=r,this.timestamp=i,this.ping=o,this.tracker=s,this.location=a,this.debug=c,this.documentContentLoaded=u,this.initializeState=l,this.storageUtils=h,this.url=p,this.window=d,this.webLayerHiders=[],this.webLayers={personalized:[],nonPersonalized:[]},this.tracker.registerEventTrackingListener(function(t,e){return function(n,r){"banner"===n&&"banner_id"in r&&(r.interaction&&ia(t,e,r.banner_id,"interaction","_last_interaction"),"show"===r.action&&ia(t,e,r.banner_id,"show event","_last_show"))}}(this.debug,this.storageUtils))}queryAndShowWebLayer(t,e={},n=!1,r){n||this.hideExistingWebLayers(),this.queryAndShowWebLayers([t],void 0,e,r,Uo.manual)}hideExistingWebLayers(){for(const t of this.webLayerHiders)try{t()}catch(t){this.debug.error("Error from hide weblayer script",t)}this.webLayerHiders=[]}registerWebLayers(t){this.webLayers.personalized=t.filter(ra),this.webLayers.nonPersonalized=t.filter((t=>!ra(t))rWebLayers(t),this.filterAndShowWebLayers(e,n,r),this.config.isSpaReloadingEnabled("banners")&&this.url.onChange(`onUrlChangeFilterAndShowWebLayers_${e}`,(()=>{this.filterAndShowWebLayers(e,n,r)}))}showWebLayer(t,e){let n,r;this.debug.log(`Showing weblayer ${e}...`);try{n=new Function(t)}catch(t){return this.debug.error(`Syntax error in the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ${e}\njavascript code. Check the web layer javascript code for syntax errors, such\nerrors are usually highlighted in the UI. The first line of the stack trace\nbelow should give you a clue.\n\n`,t)}try{r=n()}catch(t){return this.debug.error(`Error when executing the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ${e}\njavascript code. Check the web layer javascript code for errors. This is not\na syntax error and may be hard to spot, but the first line of the stack trace\nbelow should give you a clue.\n\n`,t)}r.hasOwnProperty("contextual_personalization")&&this.updateContextualBanditEventFilter(r.contextual_personalization),"function"==typeof r&&r.hasOwnProperty("remove")&&"function"==typeof r.remove&&this.webLayerHiders.push(r.remove)}filterAndShowWebLayers(t,e,n){var r;const i=!!(null===(r=this.config.getOptions().experimental)||void 0===r?void 0:r.non_peblayers);t!==qo.nonPersonalized&&i||this.hideExistingWebLayers();const o=this.webLayers[t],s=this.filterWebLayersForCustomerid:t})=>t));if(t===qo.personalized)this.queryAndShowWebLayers(a,s,{},n,Uo.automatic,e);else if(t===qo.nonPersonalized){const t=s.map((t=>{var e;return null!==(e=t.data)&&void 0!==e?e:"return {}"}));return this.showWebLayers(t,a).then((()=>{n&&Bi(n)}))}}filterWebLayersForCustomer(t,e){const n=yo(fo.WebLayer,this.debug),r=Ai(this.debug);return t.filter(n("page",(t=>_o.matches(this.location.href,t.trigger)))).filter(n("date",(t=>io.matches(this.timestamp.getTimestamp(),t.date_filter)))).filter(n("device",(t=>ho.matches(t.device_target)))).filter(n("frequency",(t=>po.matches(this.ping,this.timestamp,this.storageUtils,t.frequency,t._id,s)))).filter(n("conditions",(t=>{var n;return to.matches(this.window,this.url,r,e,null===(n=t.variables_target)||v)}showWebLayers(t,e){return this.debug.log("Showing weblayers..."),this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{t.forEach(((t,n)=>this.showWebLayer(t,e[n])))}))}queryAndShowWebLayers(t,e,n={},r,i=Uo.automatic,o){let s=ti(this.config.getOptions().customer);const a=e?no(e,this.url,window,o):void 0;this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Mi.BannersShow,noBulk:!0,prepareData:()=>(this.debug.log("Get filtered weblayers by IDs",t),s&&s.cookie||(s=ti(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:s,banner_ids:t,params:n,initiator:i,page_vars:a}}),processResponse:({data:e})=>{this.showWebLayers(e,t).then((()=>{r&&Bi(r)}))},processError:t=>{r&&Bi(r.bind(void 0,t))}})}))}updateContextualBanditEventFilter(t){var e,n,r;const i=null===(e=t.optimization_target)||void 0===e?void 0:e.type,o=null===(n=t.optimization_target)||void 0===n?void 0:n.event_type,s=(null===(r=t.optimization_target)||void 0===r?void 0:r.event_filter)||[],a=t.reward_token,c=t.reward_value||1;"event_tracked"===i&&o&&a&&this.contextualBanditEventFilter.put(o,s,a,c)}}function ra(t){return void 0===t.uses_personalization||t.uses_personalization}function ia(t,e,n,r,i){t.log(`Recording ${r} for weblayer ${n}`),e.writeToStorage("localStorage",s+n+i,(new Date).valueOf().toString())}yn([zi(),bn("design:type",Function),bn("design:paramtypes",[String,String]),bn("design:returntype",void 0)],na.prototype,"showWebLayer",null);class oa{constructor(t){t&&Tt(t,((t,e)=>{this[`_${e}`]=t}))}get location(){return this._location||(this._location=window.location),this._location}get document(){return this._document||(this._document=window.document),this._document}get date(){return this._date||(this._date=Date),this._date}get localStorage(){return this._localStorage||(this._localStorage=window.localStorage),this._localStorage}get sessionStorage(){return this._sessionStorage||(this._sessionStoragturn this._window||(this._window=window),this._window}get console(){return this._console||(this._console=window.console),this._console}get math(){return this._math||(this._math=Math),this._math}get config(){return this._config||(this._config=new wi(this.database,this.logger)),this._config}get featureFlags(){return this._featureFlags||(this._featureFlags=new Co(this.debug,this.window)),this._featureFlags}get contextualBandit(){return this._)),this._contextualBandit}get timestamp(){return this._timestamp||(this._timestamp=new Ks(this.storageUtils)),this._timestamp}get http(){return this._http||(this._http=new Fo(window)),this._http}get queue(){return this._queue||(this._queue=new zs(this.reporter,this.config,this.http,this.debug,this.timestamp,this.unloader,this.window,this.featureFlags)),this._queue}get cookies(){return this._cookies||(this._cookies=new Li(this.config,this.debug,this.logger,this.queue,this.location,this.document,this.segments)),this._cookies}get contextualBanditEventFilter(){return this._contextualBanditEventFilter||(this._contextualBanditEventFilter=new ji(this.contextualBandit,this.debug)),this._contextualBanditEventFilter}get time(){return this._time||(this._time=new Gs(this.timestamp,this.queue,this.cookies,this.debug)),this._time}get eventTracker(){return this._eventTracker||(this._eventTracker=new Fi(this.reporter,this.config,this.contextualBanditEventFilter,this.time,this.timestamp,this.queue,this.debug,this.document,this.location,this.initializeState,this.window,this.url,this.browserExtension)),this._eventTracker}get ping(){return this._ping||(this._ping=new hs(this.reporter,this.config,this.timestamp,this.eventTracker,this.window,this.location,this.document,this.debug,this.cookies,this.storageUtils,this.unloader,this.url)),this._ping}get dependencyLoader(){return this._dependencyLoader||(this._dependencyLoader=new $i(this.config,this.reporter)),this._dependencyLoader}get customer(){return this._customer||(this._customer=new Ui(this.reporter,this.config,this.queue,this.debug,this.initializeState,this.window,this.cookies,this.browserExtension,this.segments)),this._customer}get userActivityTracking(){return this._userActivityTracking||(this._userActivityTracking=new ea(this.reporter,this.config,this.linkTracker,this.eventTracker,this.window,this.debug,this.documentContentLoaded,this.unloader)),this._userActivityTracking}get experimentsEditor(){return this._experimentsEditor||(this._experimentsEditor=new xo(this.http,this.config,this.location,this.document,this.history,this.window,this.debug,this.storageUtils)),this._experimentsEditor}get experimentsModifications(){return this._experimentsModifications||(this._experimentsModifications=new So(this.eventTracker,this.experimentsEditor,this.document,this.debug)),this._experimentsModifications}get experiments(){return this._experiments||(this._experiments=new wo(this.reporter,this.config,this.queue,this.timestamp,this.ping,this.edebug,this.documentContentLoaded,this.storageUtils,this.newExperiments,this.url,this.window)),this._experiments}get abTest(){return this._abTest||(this._abTest=new gn(this.cookies)),this._abTest}get recommendations(){return this._recommendations||(this._recommendations=new Us(this.config,this.queue,this.debug)),this._recommendations}get webLayers(){return this._webLayers||(this._webLayers=new na(this.reporter,this.config,this.contextualBanditEventFilter,this.queue,this.timestamp,this.ping,this.eventTracker,this.location,this.debug,this.documentContentLoaded,this.initializeState,this.storageUtils,this.url,this.window)),this._webLayers}get managedTags(){return this._managedTags||(this._managedTags=new os(this.reporter,this.config,this.queue,this.location,this.document,this.debug,this.url)),this._managedTags}get linkTracker(){return this._linkTracker||(this._linkTracker=new Xo(this.reporter,this.eventTracker,this.debug,this.documentContentLoaded)),this._linkTracker}get unloader(){return this._unloader||(this._unloader=new Zs(this.reporter,this.window)),this._unloader}get campaignClicks(){return this._campaignClicks||(this._campaignClicks=new gr(this.location,this.queue,this.config,this.timestamp,this.time,this.debug,this.window,this.document)),this._campaignClicks}get notifications(){return this._notifications||(this._notifications=new vs(this.pushWebApi,this.pushSafariApi)),this._notifications}get pushWebApi(){return this._pushWebApi||(this._pushWebApi=new bs(this.window,this.location,this.debug,this.logger,this.config,this.customer,this.queue,this.serviceWorkerManager)),this._pushWebApi}get pushSafariApi(){return this._pushSafariApi||(this._pushSafariApi=new ys(this.window,this.config,this.customer,this.location,this.storageUtils)),this._pushSafariApi}get debug(){return this._debug||(this._debug=new Wi(this.config,this.location,this.logger,this.storageUtils)),this._debug}get reporter(){return this._reporter||(this._reporter=new Ki(this.debug,this.config,this.http)),this._reporter}get initializer(){return this._initializer||(this._initializer=new Ko(this.reporter,this.debug,this.config,this.time,this.cookies,this.ping,this.customer,this.userActivityTracking,this.experimentsEditor,this.experiments,this.webLayers,this.managedTags,this.campaignClicks,this.eventTracker,this.queryTracking,this.window,this.unloader,this.initializeState,this.queue,this.pushWebApi,this.pushSafariApi,this.transferIdentity,this.http,this.logger,this.newExperiments,this.featureFlags,this.browserExtension)),this._initializer}get queryTracking(){return this._queryTracking||(this._queryTracking=new ws(this.reporter,this.config,this.queue,this.debug,this.timestamp,this.automaticTracking,this.window,this.eventTracker,this.customer,this.liveEventHandler,this.storageUtils,this.url)),this._queryTracking}get automaticTracking(){return this._automaticTracking||(this._automaticTracking=new vn(this.reporter,this.documentContentLoaded)),this._automaticTracking}get liveEventHandler(){return this._liveEventHandler||(this._liveEventHandler=new es(this.reporterhis._documentContentLoaded=new Hi(this.window,this.document)),this._documentContentLoaded}get initializeState(){return this._initializeState||(this._initializeState=new Qo),this._initializeState}get transferIdentity(){return this._transferIdentity||(this._transferIdentity=new Js(this.debug,this.location)),this._transferIdentity}get html(){return this._html||(this._html=new Ao(this.config,this.debug,this.documentContentLoaded,this.queue)),this._html}get enhancedEcommerce(){return this._enhancedEcommerce||(this._enhancedEcommerce=new Vi.Tracker(this.debug,this.eventTracker)),this._enhancedEcommerce}get serviceWorkerManager(){return this._serviceWor_storageUtils=new Hs(this.logger,this.localStorage,this.sessionStorage)),this._storageUtils}get database(){return this._database||(this._database=new qi(this.window,this.logger)),this._database}get newExperiments(){return this._newExperiments||(this._newExperiments=new ss(this.reporter,this.window,this.serviceWorkerManager,this.database,this.storageUtils,this.cr.Handler(this.window,this.debug)),this._browserExtension}get segments(){return this._segments||(this._segments=new Ws(this.reporter,this.config,this.initializeState,this.queue)),this._segments}}const sa=["anonymize","initialize","identify","getSegments","update","track","trackLink","trackEnhancedEcommerce","getHtml","showHtml","showBanner","showWebLayer","ping","getAbTest","loadDependency","getRecommendation","reloadWebLayers","_preInitialize","_initializeConfig","_bootstrapEditor","_insertExperiment","_revertExperiments","_rewardBandit"],aa=["version","isLoaded","isInitialized","configuration"],ca=["isAvailable","isSubscribed","subscribe","unsubscribe"],ua=["subscribe"];function la(){return funrn n.value=function(){const t=!this.isInitialized,e=this.config.getOptions();ha(e)?this.reporter.reportPromiseError(this.ini.then(((guments)},n}}function ha(t){return!0===t.compliance.opt_in||!0){return window[x]}class da{get version(){return e}get isLoaded(){return!0}get isInitialized(){return this.initializeState.isInitialized()}get configuration(){return sr(this.config.getOptions())}get initializedState(){return this.initializeState}constructor({config:t,dependencyLoader:e,cookies:n,eventTracker:r,initializer:i,initializeState:o,customer:s,experimentsEditor:a,experiments:c,notifications:u,recommendations:l,abTest:h,webLayers:p,linkTracker:d,ping:f,reporter:g,contextualBandit:m,queue:v,debug:y,html:b,enhancedEcommerce:_,browserExtension:w,segments:k,featureFlags:x,logger:S,window:E}){this._=[],this.config=t,this.dependencyLoader=e,this.cookies=n,this.eventTracker=r,this.initializer=i,this.initializeState=o,this.customer=s,this.experimentsEditor=a,this.experiments=c,this.notifications=u,this.recommendations=l,this.abTest=h,this.webLayers=p,this.linkTracker=d,this.pingService=f,this.reporter=g,this.contextualBandit=m,this.queue=v,this.debug=y,this.html=b,this.enhancedEcommerce=_,this.browserExtension=w,thitureFlagnst t=this.config.getOptions().exposed_segments.segmentation_processing_delay;new Promise((e=>{setTimeout(e,t)})).then((()=>{thisments.notify()}))})),this.window.setInterval((()=>{null!==this.config.getOptions().token&&this.reporter.reportPromiseError(Wo(this.queue)).then((t=>{this.webLayers.regiinitialize(t)}_preInitialize(t){this.initializer.extendOptions(t),this.reporter.reportPromiseError(Wo(this.queue)).then((t=>this.webLayers.processDefinition(ttTracker.track(t,e,{successCallback:n,errorCallback:r,immediate:i})}identify(t,e,n,r,i,o,s){return this.customer.identifyCustomer(t,e,n,r,i,o,s)}update(t){return this.customer.updateCustomer(t)}anonymize(){const t=this.cookies.setFreshTrackingCookie();this.config.setNewCustomerIds({cookie:t}),this.browserExtension.sendPayload({type:"ids",ids:{cookie:t}}),this.debug.log("sending new anonymized cookie to server"),this.cookies.sendCustomerCookieToServer(t),this.notifications.unsubscribe((()=>{})),this.segments.notify()}getAbTest(t,e,n){const r=`${p}${t}__`,i=this.cookies.getCookie(r),o=this.abTest.getAbTest(t,e);if(i||this.eventTracker.tner(t,e,n=!1,r){return this.showWebLayer(t,e,n,r)}showWebLayer(t,e)}getRecommendation(t){return this.recommendations.fetch(t,arguments)}getSegments(t,e,n,r={force:!1}){this.segments.getSegments(t,e,ckLink(t,e,n){return this.linkTracker.trackLink(t,e,n)}loadDependency(t,e=(()=>{})){return this.ensureThatSdkIsInitialized(),this.dependencyLoader.loadDependency(t).then((()=>e())).catch((t=>e(t)))}ping(t){return void 0===t?this.pingService.sendPing():(this.pingService.setOptions(t),this.pingService.restartPinging())}reloadWebLayers(t){this.reporter.reportPromiseError(Wo(this.queue)).then((t=>{var e;(null===(e=this.config.getOptions().experimental)||voie.non_personalized_w&&this.webLayers.processDefinition(t.webLayers,qo.nonPersonalized,t.vars),this.webLayers.processDefinition(t.webLayers,qo.personalized,t.vars)})).then((()=>{t&&Bi(t)})).catch((e=>{t&&Bi((()=>t(e)))}))}_bootstrapEditor(){return this.experimentsEditor.bootstrapEditor()}_insertExperiment(t,e){if(!this.config.getOptions().new_experiments&&!this.featureFlags.flags.ep3_use_new_experiments)return this.experiments.applyExperimentModificationsAndTrackEvent(t,e);const n=pa();if(n&&n.applyModifications)return this._applyModificationsWhenMethodAvailable(t,n,e);const r=this.initializer.isWebxpClientReady.then((()=>n&&n.applyModifications?this._applyModificationsWhenMethodAvailable(t,n,e):(this.logger.error(`Unable to initialize experiment ${t.params.experiment_id}. Function applyModifications is not available.`),()=>{})),(t=>(this.logger.error("Unable to initialize experiments:",t),()=>{})));return()=>{r.then((t=>{"function"!=typeof t?this.logger.error("Unable to generate revert function"):t()}))}}_revertExperiments(){if(!this.featureFlags.flags.ep3_use_new_experiments&&!this.config.getOpError from revert experiment scriptextualBandit.rewardBandit(t,e,n,r)}trackEnhancedEcommerce(t,e="all"){this.enhancedEcommerce.trackEnhancedEcommerce(t,e)}getHtml(t,e){this.html.getHtml(t,e)}showHtml(t,e){this.html.showHtml(t,e)}ensureThatSdkIsInitialized(){if(!this.initializeState.isInitialized())throw new Error("You have to call initialize before any other Exponea SDK method can be called")}_applyModificationsWhenMethodAvailable(t,e,n){let r;try{r=e.applyModifications?e.applyModifications(t,!1):()=>{}}catch(t){return this.debug.error("Error applying experiment",t),()=>{}}return n&&this.eventTracker.track("experiment",{action:"show",experiment_id:t.params.experiment_id,experiment_name:t.params.experiment_name,variant_id:t.params.variant_id,variant_name:t.params.variant_name,location:window.location.href,path:window.location.pathname}),r}}yn([ps([{name:"options",oneOf:["boolean","object"]}]),bn("design:type",Function),bn("design:paramtypes",[Object]),bn("design:returntype",void 0)],da.prototype,"initialize",null),yn([ps([{name:"options",oneOf:["boolean","object"]}]),bn("design:type",Function),bn("design:paramtypes",[Object]),bn("design:returntype",void 0)],da.prototype,"_preInitialize",null),yn([ps([{name:"options",oneOf:["boolean","object"]}]),bn("design:type",Function),bn("design:paramtypes",[Object]),bn("design:returntype",void 0)],da.prototype,"_initializeConfig",null),yn([ps([{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[String,Object,Function,Function,Boolean]),bn("design:returntype",void 0)],da.prototype,"track",null),yn([ps([{name:"customerIds",oneOf:["object","string","number"]},{name:"customerProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[Object,Object,Function,Function,Boolean,Function,Function]),bn("design:returntype",void 0)],da.prototype,"identify",null),yn([ps([{name:"customerProperties",type:"object"}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[Object]),bn("design:returntype",void 0)],da.prototype,"update",null),yn([ps([]),la(),bn("design:type",Function),bn("design:paramtypes",[]),bn("design:returntype",void 0)],da.prototype,"anonymize",null),yn([ps([{name:"abTestName",type:"string"},{name:"variants",type:"object"},{name:"callback",type:"function",optional:!0}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[String,Object,Function]),bn("design:returntype",Object)],da.prototype,"getAbTest",null),yn([ps([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[String,Object,Object,Function]),bn("design:returntype",void 0)],da.prototype,"showBanner",null),yn([ps([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[String,Object,Object,Function]),bn("design:returntype",void 0)],da.prototype,"showWebLayer",null),yn([ps([{name:"options",type:"object"}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[Object]),bn("design:returntype",void 0)],da.prototype,"getRecommendation",null),yn([ps([{name:"exposedCategory",type:"string"},{name:"successCallback",type:"function"},{name:"errorCallback",type:"function",optional:!0},{name:"options",type:"object",optional:!0}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[String,Function,Function,Object]),bn("design:returntype",void 0)],da.prototype,"getSegments",null),yn([ps([{name:"element",oneOf:["string","element"]},{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[Object,String,Object]),bn("design:returntype",void 0)],da.prototype,"trackLink",null),yn([ps([{name:"dependencyNameOrArray",oneOf:["string","array"]},{name:"callback",type:"function",optional:!0}]),zi(),bn("design:type",Function),bn("design:paramtypes",[Object,Function]),bn("design:returntype",void 0)],da.prototype,"loadDependency",null),yn([ps([{name:"pingOptions",type:"object",optional:!0}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[Object]),bn("design:returntype",void 0)],da.prototype,"ping",null),yn([ps([{name:"callback",type:"function",optional:!0}]),zi(),la(),bn("design:type",Function),bn("design:paramtypes",[Function]),bn("design:returntype",void 0)],da.prototype,"reloadWebLayers",null),yn([ps([]),bn("design:type",Function),bn("design:paramtypes",[]),bn("design:returntype",Promise)],da.prototype,"_bootstrapEditor",null),yn([ps([{name:"experiment",type:"object"},{name:"trackEvent",type:"boolean",optional:!0}]),bn("design:type",Function),bn("design:paramtypes",[Object,Boolean]),bn("design:returntype",Function)],da.prototype,"_insertExperiment",null),yn([ps([]),bn("design:type",Function),bn("design:paramtypes",[]),bn("design:returntype",void 0)],da.prototype,"_revertExperiments",null),yn([ps([{name:"banditRewardToken",type:"string"},{name:"banditRewardValue",type:"number"},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0}]),zi(),bn("design:type",Function),bn("design:paramtypes",[String,Number,Function,Function]),bn("design:returntype",void 0)],da.prototype,"_rewardBandit",null),yn([ps([{name:"ecommerceObject",type:"object"},{name:"kind",type:"string",optional:!0}]),zi(),bn("design:type",Function),bn("design:paramtypes",[Object,String]),bn("design:returntype",void 0)],da.prototype,"trackEnhancedEcommerce",null);var fa;const ga=new ns(console,h);if(ya=navigator.userAgent,new RegExp("Googlebot\\/|Googlebot-Mobile|Googlebot-Image|Googlebot-News|Googlebot-Video|AdsBot-Google([^-]|$)|AdsBot-Google-Mobile|Feedfetcher-Google|Mediapartners-Google|Mediapartners \\(Googlebot\\)|APIs-Google|Google-InspectionTool|Storebot-Google|GoogleOther|bingbot|Slurp|[wW]get|LinkedInBot|Python-urllib|python-requests|aiohttp|httpx|libwww-perl|httpunit|nutch|Go-http-client|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|BIGLOTRON|Teoma|convera|seekbot|Gigabot|Gigablast|exabot|ia_archiver|GingerCrawler|webmon |HTTrack|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|findlink|msrbot|panscient|yacybot|AISearchBot|ips-agent|tagoobot|MJ12bot|woriobot|yanga|buzzbot|mlbot|yandex\\.com\\/bots|purebot|Linguee Bot|CyberPatrol|voilabot|Baiduspider|citeseerxbot|spbot|twengabot|postrank|Turnitin|scribdbot|page2rss|sitebot|linkdex|Adidxbot|ezooms|dotbot|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|Ahrefs(Bot|SiteAudit)|fuelbot|CrunchBot|IndeedBot|mappydata|woobot|ZoominfoBot|PrivacyAwareBot|Multiviewbot|SWIMGBot|Grobbot|eright|Apercite|semanticbot|Aboundex|domaincrawler|wbsearchbot|summify|CCBot|edisterbot|SeznamBot|ec2linkfinder|gslfbot|aiHitBot|intelium_bot|facebookexternalhit|Yeti|RetrevoPageAnalyzer|lb-spider|Sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Twitterbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|OrangeBot\\/|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|S[eE][mM]rushBot|yoozBot|lipperhey|Y!J|Domain Re-Animator Bot|AddThis|Screaming Frog SEO Spider|MetaURI|Scrapy|Livelap[bB]ot|OpenHoseBot|CapsuleChecker|collection@infegy.com|IstellaBot|DeuSu\\/|betaBot|Cliqzbot\\/|MojeekBot\\/|netEstate NE Crawler|SafeSearch microdata crawler|Gluten Free Crawler\\/|Sonic|Sysomos|Trove|deadlinkchecker|Slack-ImgProxy|Embedly|RankActiveLinkBot|iskanie|SafeDNSBot|SkypeUriPreview|Veoozbot|Slackbot|redditbot|datagnionbot|Google-Adwords-Instant|adbeat_bot|WhatsApp|contxbot|pinterest.com.bot|electricmonk|GarlikCrawler|BingPreview\\/|vebidoobot|FemtosearchBot|Yahoo Link Preview|MetaJobBot|DomainStatsBot|mindUpBot|Daum\\/|Jugendschutzprogramm-Crawler|Xenu Link Sleuth|Pcore-HTTP|moatbot|KosmioBot|[pP]ingdom|AppInsights|PhantomJS|Gowikibot|PiplBot|Discordbot|TelegramBot|Jetslide|newsharecounts|James BOT|Bark[rR]owler|TinEye|SocialRankIOBot|trendictionbot|Ocarinabot|epicbot|Primalbot|DuckDuckGo-Favicons-Bot|GnowitNewsbot|Leikibot|LinkArchiver|YaK\\/|PaperLiBot|Digg Deeper|dcrawl|Snacktory|AndersPinkBot|Fyrebot|EveryoneSocialBot|Mediatoolkitbot|Luminator-robots|ExtLinksBot|SurveyBot|NING\\/|okhttp|Nuzzel|omgili|PocketParser|YisouSpider|um-LN|ToutiaoSpider|MuckRack|Jamie's Spider|AHC\\/|NetcraftSurveyAgent|Laserlikebot|^Apache-HttpClient|AppEngine-Google|Jetty|Upflow|Thinklab|Traackr.com|Twurly|Mastodon|http_get|DnyzBot|botify|007ac9 Crawler|BehloolBot|BrandVerity|check_http|BDCbot|ZumBot|EZID|ICC-Crawler|ArchiveBot|^LCC |filterdb.iss.net\\/crawler|BLP_bbot|BomboraBot|Buck\\/|Companybook-Crawler|Genieo|magpie-crawler|MeltwaterNews|Moreover|newspaper\\/|ScoutJet|(^| )sentry\\/|StorygizeBot|UptimeRobot|OutclicksBot|seoscanners|Hatena|Google Web Preview|MauiBot|AlphaBot|SBL-BOT|IAS crawler|adscanner|Netvibes|acapbot|Baidu-YunGuanCe|bitlybot|blogmuraBot|Bot.AraTurka.com|bot-pge.chlooe.com|BoxcarBot|BTWebClient|ContextAd Bot|Digincore bot|Disqus|Feedly|Fetch\\/|Fever|Flamingo_SearchEngine|FlipboardProxy|g2reader-bot|G2 Web Services|imrbot|K7MLWCBot|Kemvibot|Landau-Media-Spider|linkapediabot|vkShare|Siteimprove.com|BLEXBot\\/|DareBoost|ZuperlistBot\\/|Miniflux\\/|Feedspot|Diffbot\\/|SEOkicks|tracemyfile|Nimbostratus-Bot|zgrab|PR-CY.RU|AdsTxtCrawler|Datafeedwatch|Zabbix|TangibleeBot|google-xrawler|axios|Amazon CloudFront|Pulsepoint|CloudFlare-AlwaysOnline|Google-Structured-Data-Testing-Tool|WordupInfoSearch|WebDataStats|HttpUrlConnection|Seekport Crawler|ZoomBot|VelenPublicWebCrawler|MoodleBot|jpg-newsbot|outbrain|W3C_Validator|Validator\\.nu|W3C-checklink|W3C-mobileOK|W3C_I18n-Checker|FeedValidator|W3C_CSS_Validator|W3C_Unicorn|Google-PhysicalWeb|Blackboard|ICBot\\/|BazQux|Twingly|Rivva|Experibot|awesomecrawler|Dataprovider.com|GroupHigh\\/|theoldreader.com|AnyEvent|Uptimebot\\.org|Nmap Scripting Engine|2ip.ru|Clickagy|Caliperbot|MBCrawler|online-webceo-bot|B2B Bot|AddSearchBot|Google Favicon|HubSpot|Chrome-Lighthouse|HeadlessChrome|CheckMarkNetwork\\/|www\\.uptime\\.com|Streamline3Bot\\/|serpstatbot\\/|MixnodeCache\\/|^curl|SimpleScraper|RSSingBot|Jooblebot|fedoraplanet|Friendica|NextCloud|Tiny Tiny RSS|RegionStuttgartBot|Bytespider|Datanyze|Google-Site-Verification|TrendsmapResolver|tweetedtimes|NTENTbot|Gwene|SimplePie|SearchAtlas|Superfeedr|feedbot|UT-Dorkbot|Amazonbot|SerendeputyBot|Eyeotabot|officestorebot|Neticle Crawler|SurdotlyBot|LinkisBot|AwarioSmartBot|AwarioRssBot|RyteBot|FreeWebMonitoring SiteChecker|AspiegelBot|NAVER Blog Rssbot|zenback bot|SentiBot|Domains Project\\/|Pandalytics|VKRobot|bidswitchbot|tigerbot|NIXStatsbot|Atom Feed Robot|[Cc]urebot|PagePeeker\\/|Vigil\\/|rssbot\\/|startmebot\\/|JobboerseBot|seewithkids|NINJA bot|Cutbot|BublupBot|BrandONbot|RidderBot|Taboolabot|Dubbotbot|FindITAnswersbot|infoobot|Refindbot|BlogTraffic\\/\\d\\.\\d+ Feed-Fetcher|SeobilityBot|Cincraw|Dragonbot|VoluumDSP-content-bot|FreshRSS|BitBot|^PHP-Curl-Class|Google-Certificates-Bridge|centurybot|Viber|e\\.ventures Investment Crawler|evc-batch|PetalBot|virustotal|(^| )PTST\\/|minicrawler|Cookiebot|trovitBot|seostar\\.co|IonCrawl|Uptime-Kuma|SeekportBot|FreshpingBot|Feedbin|CriteoBot|Snap URL Preview Service|Better Uptime Bot|RuxitSynthetic|Google-Read-Aloud|Valve\\/Steam|OdklBot\\/|GPTBot|YandexRenderResourcesBot\\/|LightspeedSystemsCrawler|ev-crawler\\/|BitSightBot\\/|woorankreview\\/|Google-Safety|AwarioBot|DataForSeoBot|Linespider|WellKnownBot|A Patent Crawler|StractBot|search\\.marginalia\\.nu|YouBot|Nicecrawler|Neevabot|BrightEdge Crawler|SiteCheckerBotCrawler|TombaPublicWebCrawler|CrawlyProjectCrawler|KomodiaBot|KStandBot|CISPA Webcrawler|MTRobot|hyscore.io|AlexandriaOrgBot|2ip bot|Yellowbrandprotectionbot|SEOlizer|vuhuvBot|INETDEX-BOT|Synapse|t3versionsBot|deepnoc|Cocolyzebot|hypestat|ReverseEngineeringBot|sempi.tech|Iframely|MetaInspector|node-fetch|lkxscan|python-opengraph|OpenGraphCheck|developers.google.com\\/\\+\\/web\\/snippet|SenutoBot|MaCoCu|NewsBlur|inoreader|NetSystemsResearch|PageThing|WordPress\\/","i").test(ya))ga.log("Crawler detected, not initializing SDK");else if(function(t,e){return"Internet Explorer"===lr(t,e,t.navigator.userAgent,t.navigator.vendor)}(window,document))ga.log("Unsupported browser detected, not initializing SDK");else if(null===(fa=window[l])||void 0===fa?void 0:fa.version)ga.log("The SDK is already available on the window, maybe the SDK file is downloaded twice?");else{const t=new oa;t.debug.log("Creating SDK instance");const e=new da(t),n=e.notifications,r=e.segments,i=function(t=window){return t[l]||(t[l]={_:[]},t[l].notifications={_:[]gments||(t[l].segments={_:[]}),t[l]}(),o=i.notifications,s=i.segments;S(i,e,t.debug),E(sa,i,e),ma=i,va=e,aa.forEach((t=>{Object.defineProperty(ma,t,{get:()=>va[t],configurable:!1,enumerable:!1})})),S(o,n,t.debug),E(ca,o,n),S(s,r,t.debug),E(ua,s,r)}var ma,va,ya}();
//# sourceMappingURL=exponea.min.js.map
